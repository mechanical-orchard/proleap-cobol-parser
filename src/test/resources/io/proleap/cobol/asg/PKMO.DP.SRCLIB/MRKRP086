REMOVE*THE 'DB2TDBA' FROM IN FRONT OF DB2TDBA.TMDSEBG BEFORE IMPLEMENT  00010058
000100***************************************************************** 00010058
000200 IDENTIFICATION DIVISION.                                         00020058
000300***************************************************************** 00030058
000400                                                                  00040058
000500 PROGRAM-ID.             MRKRP086.                                00050058
000600 AUTHOR.                 LINDA FRIESS.                            00060058
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070058
000800 DATE-WRITTEN            01-19-99.                                00080058
000900 DATE-COMPILED.                                                   00090058
001000                                                                  00100058
001100***************************************************************** 00110058
001200*                                                               * 00120058
001300*  THIS PROGRAM WILL PRINT THE INFOREM SERVICE LEVEL REPORT.    * 00130058
001400*  SERVICE LEVELS ARE CALCULATED & REPORTED BY STYLE/COLOR.     * 00140058
001500*  THE OUT-OF-INV FILE CONTAINS ALL ITEM/STORES THAT HAVE HAD   * 00150058
001600*  AN ON-HAND QUANTITY < 1 AT ANY TIME DURING THE PREVIOUS      * 00160058
001700*  WEEK.  THIS IS USED TO DETERMINE THE SERVICE LEVEL.  AN      * 00170058
001800*  EXTRACT FILE IS CREATED WITH ALL THE ITEMS AND STORES THAT   * 00180058
001900*  FELL BELOW A SET SERVICE LEVEL LIMIT (WHICH IS INPUT THROUGH * 00190058
002000*  A CONTROL CARD).  CERTAIN DEPARTMENTS ARE SUMMED UP TO THE   * 00200058
002100*  SUBCLASS LEVEL (THESE ARE ALSO INPUT THROUGH CONTROL CARDS). * 00210058
002200*                                                               * 00220058
002300***************************************************************** 00230058
002400*  CHANGE MADE:                                                 * 00240058
002500*                                                               * 00250058
002600*  CHANGED 02/04/99 BY LINDA FRIESS               WR# 5266      * 00260058
002700*    REMOVED DB2 FUNCTION TO CALCULATE AVERAGE ON-ORDER BECAUSE * 00270058
002800*    TSKSTOO DOES NOT CONTAIN ITEMS WITH ZERO ON-ORDER; ADDED   * 00280058
002900*    DIVIDE IN PROGRAM TO GET AVERAGE ON-ORDER                  * 00290058
003000*                                                               * 00300058
003100***************************************************************** 00310058
003200*                                                               * 00320058
003300*  CHANGED 05/26/99 BY SUZANNE MEYER              WR# 5266      * 00330058
003400*    ALTERED CONTROL CARD (108) TO REFLECT TWO PERCENTAGES-     * 00340058
003500*    SKU AND STORE, MODIFIED THE DETAIL (OO & OH) TO CONTAIN    * 00350058
003600*    A DECIMAL WITH ACCURACY TO THE TENTHS                      * 00360058
003700*           (SKU SET TO 90, STORES TO 70)                       * 00370058
003800***************************************************************** 00380058
003900*                                                               * 00390058
004000*  CHANGED 09/14/99 BY T BAGWELL                                * 00400058
004100*   ADDED WORK-START-DATE LIMITER TO BUYER-NAME SQL (D700)      * 00410058
004200*   ADDED TSKST TO D800, E200, AND E700 ROUTINES                * 00420058
004300***************************************************************** 00430058
004400*                                                               * 00440058
004500*  CHANGED 01/17/00 BY LINDA FRIESS             PITS# 338068    * 00450058
004600*    EXPANDED SIZE OF PV-TOTAL-CSTOCK TO HANDLE LARGE TOTALS    * 00460058
004700*    CAUSED BY INVALID DATA                                     * 00470058
004800***************************************************************** 00480058
004900*                                                               * 00490058
005000*  CHANGED 03/01/00 BY T BAGWELL                PITS# 999999    * 00500058
005100*    MODIFIED QUERIES THAT GET STORE COUNTS TO INCLUDE THE      * 00510058
005200*    ACTIVE INFOREM STORES (FT_CDE <> 'X')                      * 00520058
005300***************************************************************** 00530058
005400*                                                               * 00540058
005500*  CHANGED 03/30/01 BY DAVID COLOMBO              WR# 21599     * 00550058
005600*    MODIFIED DATABASE CALLS SO THEY DO NOT INCLUDE THE         * 00560058
005700*    E-COMMERCE STORE.                                          * 00570058
005800***************************************************************** 00580058
005801*                                                               * 00581065
005802*  CHANGED 10/04/01 BY ANNE KINTOPF            PIT# PM00424516  * 00582066
005803*    MODIFIED DATABASE CALLS FOR THE TSTR000 TABLE TO INCLUDE   * 00583065
005804*    OP_CO_NMBR = '03' AND CHANGED THE CODE FOR SELECTS FROM    * 00584065
005805*    STORE_NMBR <> '000'       TO       STORE_NMBR  > '000'     * 00584165
005806***************************************************************** 00585065
005807*  CHANGED 04/18/02 BY DON TOMLINSON                            *         
005808*    NI SKU MR PHASE 4 CHANGES - TSKXREF ADDED. MRRD031 CHANGED.*         
005809*    ADDED ISWS006 COPYBOOK TO HANDLE DIFFERENT FORMATS / SIZES *         
005810*    IN FIELDS.  SQL CHANGED FOR WHERE STATEMENTS TO REFERENCE  *         
005820*    DCLGEN FIELDS INSTEAD OF PROGRAM VARAIABLES IN WORKING     *         
005830*    STORAGE. OBTAIN DEPT AND SUBCLASS FROM TSKXREF, NOT TSK.   *         
005831***************************************************************** 00585065
005834* CHANGED 08/05/03 BY DONALD TOMLINSON  WR# 21600               *         
005835*    NI SKU FIX FOR TSKSTOO TABLE. REMOVING UNNEEDED CODE THAT  *         
005836*    REFERENCES DEPT_NBR AND SUB_CL_NBR.                        *         
005837*    SEE E300-GET-ONORDER-QTY AND E800-GET-SUBCL-ONORDER-QTY.   *         
005840*****************************************************************         
005834* CHANGED 06/09/04 BY BOB FORD          WR# 26363               *         
005835*    CHANGED PROGRAM FOR STORE NUMBER EXPANSION.                *         
005840*****************************************************************         
005834* CHANGED 07/19/22 BY JEAN KURK         WR# CHG0271937          *         
005835*    RECOMPILED FOR UPCOMING COBOL UPGRADE - ADDED MDSEBG       *         
005835*    TABLE QUALIFIER TO FIELDS FROM TMDSEBG                     *         
005840*****************************************************************         
005900*                                                               * 00590058
006000***************************************************************** 00600058
006100 ENVIRONMENT DIVISION.                                            00610058
006200***************************************************************** 00620058
006300                                                                  00630058
006400 CONFIGURATION SECTION.                                           00640058
006500                                                                  00650058
006600 SOURCE-COMPUTER.        IBM-3090.                                00660058
006700 OBJECT-COMPUTER.        IBM-3090.                                00670058
006800                                                                  00680058
006900 INPUT-OUTPUT SECTION.                                            00690058
007000                                                                  00700058
007100 FILE-CONTROL.                                                    00710058
007200*                                                                 00720058
007300     SELECT CONTROL-FILE                                          00730058
007400                             ASSIGN       TO INP01.               00740058
007500                                                                  00750058
007600     SELECT OUT-OF-INV-FILE                                       00760058
007700                             ASSIGN       TO INP02                00770058
007800                             ORGANIZATION IS INDEXED              00780058
007900                             ACCESS       IS SEQUENTIAL           00790058
008000                             RECORD KEY   IS OUT-OF-INV-KEY       00800058
008100                             FILE STATUS  IS PV-VSAM-STATUS.      00810058
008200                                                                  00820058
008300     SELECT PRINT-REPORT                                          00830058
008400                             ASSIGN       TO OUT01.               00840058
008500                                                                  00850058
008600     SELECT EXTRACT-FILE                                          00860058
008700                             ASSIGN       TO OUT02                00870058
008800                             FILE STATUS IS PV-EXT-STATUS.        00880058
008900*                                                                 00890058
009000***************************************************************** 00900058
009100 DATA DIVISION.                                                   00910058
009200***************************************************************** 00920058
009300*                                                                 00930058
009400 FILE SECTION.                                                    00940058
009500*                                                                 00950058
009600 FD  CONTROL-FILE                                                 00960058
009700     RECORDING MODE IS F                                          00970058
009800     DATA RECORD IS CONTROL-RECORD.                               00980058
009900                                                                  00990058
010000 01  CONTROL-RECORD                    PIC X(80).                 01000058
010100*                                                                 01010058
010200 FD  OUT-OF-INV-FILE                                              01020058
010300     LABEL RECORDS ARE STANDARD                                   01030058
010400     RECORD CONTAINS 65 CHARACTERS                                01040058
010500     BLOCK CONTAINS 0 RECORDS.                                    01050058
010600*                                                                 01060058
010700 01  OUT-OF-INV-RECORD.                                           01070058
010800     05  OUT-OF-INV-KEY               PIC  X(65).                 01080058
010900*                                                                 01090058
011000 FD  PRINT-REPORT                                                 01100058
011100     LABEL RECORDS ARE STANDARD                                   01110058
011200     RECORDING MODE IS F                                          01120058
011300     RECORD CONTAINS 132 CHARACTERS                               01130058
011400     BLOCK CONTAINS 0 RECORDS.                                    01140058
011500                                                                  01150058
011600 01  PRINT-LINE                       PIC X(132).                 01160058
011700*                                                                 01170058
011800 FD  EXTRACT-FILE                                                 01180058
011900     LABEL RECORDS ARE STANDARD                                   01190058
012000     RECORDING MODE IS F                                          01200058
012100     RECORD CONTAINS 164 CHARACTERS                               01210058
012200     BLOCK CONTAINS 0 RECORDS.                                    01220058
012300 01  EXTRACT-RECORD                  PIC  X(164).                 01230058
012400*                                                                 01240058
012500 WORKING-STORAGE SECTION.                                         01250058
012600*                                                                 01260058
012700 01  CONTROL-DATA-IN.                                             01270058
012800     05 CTL-PERCENTAGES-CARD.                                     01280058
012900        10 CTL-SKU-SVC-LEVEL-PCT       PIC 9(03).                 01290058
013000        10 FILLER                      PIC X.                     01300058
013100        10 CTL-STORE-SVC-LEVEL-PCT     PIC 9(03).                 01310058
013200     05 CTL-DEPT-CARD REDEFINES CTL-PERCENTAGES-CARD.             01320058
013300        10 CTL-DEPT                    PIC X(03).                 01330058
013400        10 FILLER                      PIC X(04).                 01340058
013500     05 FILLER                         PIC X(73).                 01350058
013600*                                                                 01360058
013700*                                                                 01370058
013800     COPY MRRD030.                                                01380058
013900*                                                                 01390058
014000     COPY MRRD031.                                                01400058
014100*                                                                 01410058
014200******************************************************            01420058
014300** STANDARD HEADER LINE - KOHLS 132 COL                           01430058
014400******************************************************            01440058
014500     COPY DPWS132.                                                01450058
014600*                                                                 01460058
014700 01  HEADING-LINE-2.                                              01470058
014800     05  FILLER                       PIC X(02)  VALUE SPACES.    01480058
014900     05  FILLER                       PIC X(07)  VALUE 'BUYER: '. 01490058
015000     05  HL2-BYR-NMBR                 PIC X(03).                  01500058
015100     05  FILLER                       PIC X(02)  VALUE SPACES.    01510058
015200     05  HL2-BYR-NAME                 PIC X(32).                  01520058
015300     05  FILLER                       PIC X(02)  VALUE SPACES.    01530058
015400     05  FILLER                       PIC X(28)  VALUE            01540058
015500         'INFOREM SERVICE LEVEL REPORT'.                          01550058
015600     05  FILLER                       PIC X(56)  VALUE SPACES.    01560058
015700*                                                                 01570058
015800 01  HEADING-LINE-3.                                              01580058
015900     05  FILLER                       PIC X(02)  VALUE SPACES.    01590058
016000     05  FILLER                       PIC X(07)  VALUE 'DEPT:  '. 01600058
016100     05  HL3-DEPT                     PIC Z(03).                  01610058
016200     05  FILLER                       PIC X(02)  VALUE SPACES.    01620058
016300     05  FILLER                       PIC X(17)  VALUE            01630058
016400         'BUSINESS GROUP:  '.                                     01640058
016500     05  HL3-BG-NUMBER                PIC X(03).                  01650058
016600     05  FILLER                       PIC X(01)  VALUE SPACES.    01660058
016700     05  HL3-BG-DESC                  PIC X(25).                  01670058
016800     05  FILLER                       PIC X(06)  VALUE SPACES.    01680058
016900     05  FILLER                       PIC X(53)  VALUE            01690058
017000         '* INDICATES SOME STORES DO NOT CONTAIN ALL THE ITEMS '. 01700058
017100     05  FILLER                       PIC X(13)  VALUE            01710058
017200         'IN THIS STYLE'.                                         01720058
017210*                                                                 01721058
017220 01  HEADING-LINE-3A.                                             01722058
017230     05  FILLER                       PIC X(46)  VALUE SPACES.    01723058
017240     05  FILLER                       PIC X(53)  VALUE            01724058
017250         '!!! INDICATES SIGNIFICANT CHANGE IN STORE COUNT. TOTA'. 01725058
017260     05  FILLER                       PIC X(33)  VALUE            01726058
017270         'LS ARE WRONG UP TO BUSINESS GROUP'.                     01727058
017300*                                                                 01728058
017400 01  HEADING-LINE-4.                                              01729058
017500     05  FILLER                       PIC X(04)  VALUE SPACES.    01730058
017600     05  FILLER                       PIC X(56)  VALUE SPACES.    01740058
017700     05  FILLER                       PIC X(52)  VALUE            01750058
017800         'TOTAL    TOTAL    AVG     AVG          SVC    # SKUS'.  01760058
017900     05  FILLER                       PIC X(20)  VALUE            01770058
018000         ' # STORES  AVG.     '.                                  01780058
018100*                                                                 01790058
018200 01  HEADING-LINE-5.                                              01800058
018300     05  FILLER                       PIC X(01)  VALUE SPACES.    01810058
018400     05  FILLER                       PIC X(05)  VALUE 'CLASS'.   01820058
018500     05  FILLER                       PIC X(01)  VALUE SPACES.    01830058
018600     05  FILLER                       PIC X(38)  VALUE            01840058
018700         'STYLE           DESCRIPTION           '.                01850058
018800     05  FILLER                       PIC X(24)  VALUE            01860058
018900         '    COLOR      STORES   '.                              01870058
019000     05  FILLER                       PIC X(39)  VALUE            01880058
019100         'SKUS      OH      OO  CSTOCK  LVL %   <'.               01890058
019200     05  HL5-SKU-LIMIT                PIC ZZ9.                    01900058
019300     05  FILLER                       PIC X(05)  VALUE '%   <'.   01910058
019400     05  HL5-STORE-LIMIT              PIC ZZ9.                    01920058
019500     05  FILLER                       PIC X(13)  VALUE            01930058
019600         '%  OSTRAT  LT'.                                         01940058
019700*                                                                 01950058
019800 01  DETAIL-LINE-1.                                               01960058
019900     05  FILLER                       PIC X(02)  VALUE SPACES.    01970058
020000     05  DL1-CLASS                    PIC X(02).                  01980058
020100     05  FILLER                       PIC X(02)  VALUE SPACES.    01990058
020200     05  DL1-STYLE                    PIC X(15).                  02000058
020300     05  FILLER                       PIC X(01)  VALUE SPACES.    02010058
020400     05  DL1-DESC                     PIC X(25).                  02020058
020500     05  FILLER                       PIC X(01)  VALUE SPACES.    02030058
020600     05  DL1-COLOR                    PIC X(10).                  02040058
020700     05  FILLER                       PIC X(01)  VALUE SPACES.    02050058
020800     05  DL1-TOT-STORES               PIC ZZZZ9.                  02060058
020900     05  FILLER                       PIC X(01)  VALUE SPACES.    02070058
021000     05  DL1-ASTERISK                 PIC X(01)  VALUE SPACES.    02080058
      *********TEST CHANGE TO 1                                                 
021100     05  FILLER                       PIC X(01)  VALUE SPACES.    02090058
021200     05  DL1-TOT-SKUS                 PIC Z,ZZ9.                  02100058
021300     05  FILLER                       PIC X(01)  VALUE SPACES.    02110058
021400     05  DL1-AVG-OH                   PIC ZZZZ9.9-.               02120058
021500     05  DL1-AVG-OO                   PIC ZZZZ9.9-.               02130058
021600     05  DL1-CSTOCK                   PIC ZZZZZZ9.                02140058
021700     05  FILLER                       PIC X(02)  VALUE SPACES.    02150058
021800     05  DL1-SVC-LEVEL-X              PIC X(03).                  02160058
021810     05  DL1-SVC-LEVEL REDEFINES                                  02170058
021820         DL1-SVC-LEVEL-X              PIC ZZ9.                    02180058
021900     05  FILLER                       PIC X(05)  VALUE SPACES.    02190058
022000     05  DL1-SKUS-BELOW               PIC Z,ZZ9.                  02200058
024700************TEST CHANGE TO 3                                      02445058
022100     05  FILLER                       PIC X(03)  VALUE SPACES.    02210058
022200     05  DL1-STORES-BELOW             PIC ZZ,ZZ9.                 02220058
022300     05  FILLER                       PIC X(03)  VALUE SPACES.    02230058
022400     05  DL1-AVG-OSTRAT               PIC ZZ9.9.                  02240058
022500     05  FILLER                       PIC X(01)  VALUE SPACES.    02250058
022600     05  DL1-LEAD-TIME                PIC ZZ9.                    02260058
022700*                                                                 02270058
022800 01  TOTAL-LINE-1.                                                02280058
022900     05  FILLER                       PIC X(02)  VALUE SPACES.    02290058
023000     05  TL1-CLASS                    PIC X(02).                  02300058
023100     05  FILLER                       PIC X(04)  VALUE SPACES.    02310058
023200     05  TL1-STYLE-DESC               PIC X(18).                  02320058
023300     05  FILLER                       PIC X(01)  VALUE SPACES.    02330058
023400     05  TL1-NBR-OF-STYLES            PIC ZZZZ.                   02340058
023500     05  FILLER                       PIC X(07)  VALUE SPACES.    02350058
023600     05  TL1-TOTAL-DESC               PIC X(20).                  02360058
023700     05  FILLER                       PIC X(05)  VALUE SPACES.    02370058
023800     05  TL1-TOT-SKUS                 PIC Z,ZZZ,ZZ9.              02380058
023900     05  FILLER                       PIC X(01)  VALUE SPACES.    02390058
024000     05  TL1-AVG-OH                   PIC ZZZZ9.9-.               02400058
024100     05  TL1-AVG-OO                   PIC ZZZZ9.9-.               02410058
024200     05  TL1-CSTOCK                   PIC ZZZZZZ9.                02420058
024300     05  FILLER                       PIC X(02)  VALUE SPACES.    02430058
024400     05  TL1-SVC-LEVEL-X              PIC X(03).                  02440058
024410     05  TL1-SVC-LEVEL REDEFINES                                  02441058
024420         TL1-SVC-LEVEL-X              PIC ZZ9.                    02442058
024500     05  FILLER                       PIC X(01)  VALUE SPACES.    02443058
024600     05  TL1-SKUS-BELOW               PIC Z,ZZZ,ZZ9.              02444058
024700     05  FILLER                       PIC X(01)  VALUE SPACES.    02445058
024800     05  TL1-STORES-BELOW             PIC ZZZZ,ZZ9.               02446058
024900     05  FILLER                       PIC X(03)  VALUE SPACES.    02447058
025000     05  TL1-AVG-OSTRAT               PIC ZZ9.9.                  02448058
025100     05  FILLER                       PIC X(01)  VALUE SPACES.    02449058
025200     05  TL1-LEAD-TIME                PIC ZZ9.                    02450058
025300*                                                                 02460058
025400 01  TOTAL-LINE-2.                                                02470058
025500     05  FILLER                       PIC X(02)  VALUE SPACES.    02480058
025600     05  TL2-CLASS                    PIC X(02).                  02490058
025700     05  FILLER                       PIC X(34)  VALUE SPACES.    02500058
025800     05  TL2-TOTAL-DESC               PIC X(20).                  02510058
025900     05  FILLER                       PIC X(05)  VALUE SPACES.    02520058
026000     05  TL2-TOT-SKUS                 PIC Z,ZZZ,ZZ9.              02530058
026100     05  FILLER                       PIC X(26)  VALUE SPACES.    02540058
026200     05  TL2-SVC-LEVEL-X              PIC X(03).                  02550058
026210     05  TL2-SVC-LEVEL REDEFINES                                  02560058
026220         TL2-SVC-LEVEL-X              PIC ZZ9.                    02570058
026300     05  FILLER                       PIC X(01)  VALUE SPACES.    02580058
026400     05  TL2-SKUS-BELOW               PIC Z,ZZZ,ZZ9.              02590058
026500     05  FILLER                       PIC X(01)  VALUE SPACES.    02600058
026600     05  TL2-STORES-BELOW             PIC ZZZZ,ZZ9.               02610058
026700     05  FILLER                       PIC X(12)  VALUE SPACES.    02620058
026800*                                                                 02630058
026900 01  DASHED-LINE.                                                 02640058
027000     05  FILLER                       PIC X(65)  VALUE SPACES.    02650058
027100     05  FILLER                       PIC X(50)  VALUE            02660058
027200         '--------------------------------------------------'.    02670058
027300     05  FILLER                       PIC X(06)  VALUE            02680058
027400         '------'.                                                02690058
027500     05  FILLER                       PIC X(11)  VALUE SPACES.    02700058
027600*                                                                 02710058
027700 01  BLANK-LINE.                                                  02720058
027800     05  FILLER                       PIC X(132) VALUE SPACES.    02730058
027900*                                                                 02740058
028000 01  END-OF-REPORT-LINE.                                          02750058
028100     05  FILLER                       PIC X(25)      VALUE        02760058
028200         ' ** END OF REPORT **     '.                             02770058
028300*                                                                 02780058
028400*                                                                 02790058
028500 01  PROGRAM-SWITCHES.                                            02800058
028600     05  PS-EOF-CONTROL-FILE         PIC  X(01)    VALUE 'N'.     02810058
028700         88  EOF-CONTROL-FILE                      VALUE 'Y'.     02820058
028800     05  PS-EOF-BG-DEPT-CURSOR       PIC  X(01)    VALUE 'N'.     02830058
028900         88  EOF-BG-DEPT-CURSOR                    VALUE 'Y'.     02840058
029000     05  PS-EOF-ITEM-CURSOR          PIC  X(01)    VALUE 'N'.     02850058
029100         88  EOF-ITEM-CURSOR                       VALUE 'Y'.     02860058
029200         88  NOT-EOF-ITEM-CURSOR                   VALUE 'N'.     02870058
029300     05  PS-EOF-STORE-CURSOR         PIC  X(01)    VALUE 'N'.     02880058
029400         88  EOF-STORE-CURSOR                      VALUE 'Y'.     02890058
029500         88  NOT-EOF-STORE-CURSOR                  VALUE 'N'.     02900058
029600     05  PS-ITEMS-FOUND-FOR-DEPT     PIC  X(01)    VALUE 'N'.     02910058
029700         88  ITEMS-FOUND-FOR-DEPT                  VALUE 'Y'.     02920058
029800         88  ITEMS-NOT-FOUND-FOR-DEPT              VALUE 'N'.     02930058
029900     05  PS-ITEMS-FOUND-FOR-BG       PIC  X(01)    VALUE 'N'.     02940058
030000         88  ITEMS-FOUND-FOR-BG                    VALUE 'Y'.     02950058
030100         88  ITEMS-NOT-FOUND-FOR-BG                VALUE 'N'.     02960058
030200     05  PS-END-OF-ITEM-STORES       PIC  X(01)    VALUE 'N'.     02970058
030300         88  END-OF-ITEM-STORES                    VALUE 'Y'.     02980058
030400         88  NOT-END-OF-ITEM-STORES                VALUE 'N'.     02990058
030500     05  PS-STYLE-COLOR-CHANGE       PIC  X(01)    VALUE 'N'.     03000058
030600         88  STYLE-COLOR-CHANGE                    VALUE 'Y'.     03010058
030700     05  PS-ITEM-NBR-CHANGE          PIC  X(01)    VALUE 'N'.     03020058
030800         88  ITEM-NBR-CHANGE                       VALUE 'Y'.     03030058
030900     05  PS-PRINT-DETAIL-FOR-DEPT    PIC  X(01)    VALUE 'N'.     03040058
031000         88  PRINT-DETAIL-FOR-DEPT                 VALUE 'Y'.     03050058
031100         88  NO-DETAIL-FOR-DEPT                    VALUE 'N'.     03060058
031110     05  PS-INVALID-SVC-LEVEL        PIC  X(01)    VALUE 'N'.     03070058
031120         88  INVALID-SVC-LEVEL                     VALUE 'Y'.     03080058
031130         88  VALID-SVC-LEVEL                       VALUE 'N'.     03090058
031200*                                                                 03100058
031300 01  ABEND-CODE                       PIC S9(04)     VALUE +0     03110058
031400                                                     COMP SYNC.   03120058
031500     88  ABEND-4013                                  VALUE +4013. 03130058
031600*                                                                 03140058
031700 01  PC-CONSTANTS.                                                03150058
031800     05  PC-SKU-SVC-LEVEL-LIMIT      PIC 9(03).                   03160058
031900     05  PC-STORE-SVC-LEVEL-LIMIT    PIC 9(03).                   03170058
032000     05  PC-STORE-TABLE-MAX          PIC S9(4)  VALUE +9999       03180058
032100                                                COMP-3.           03190058
032200     05  PC-DEPT-TABLE-MAX           PIC S9(3)  VALUE +200        03200058
032300                                                COMP-3.           03210058
032400     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     03220058
032500                                                   COMP SYNC.     03230058
032600     05  PC-NOT-REF-INTEGRAL         PIC S9(04)    VALUE -530     03240058
032700                                                   COMP SYNC.     03250058
032800     05  PC-MAX-RETRIES              PIC S9(03) VALUE 3 COMP-3.   03260058
032900     05  PC-MAX-LINES                PIC S9(3)     VALUE +54      03270058
033000                                                   COMP-3.        03280058
033100     05  PC-1                        PIC S9(03)    VALUE +1       03290058
033200                                                   COMP-3.        03300058
033300     05  PC-2                        PIC S9(03)    VALUE +2       03310058
033400                                                   COMP-3.        03320058
033500     05  PC-3                        PIC S9(03)    VALUE +3       03330058
033600                                                   COMP-3.        03340058
033700     05  PC-5                        PIC S9(03)    VALUE +5       03350058
033800                                                   COMP-3.        03360058
033900     05  PC-7                        PIC S9(03)    VALUE +7       03370058
034000                                                   COMP-3.        03380058
034100     05  PC-100                      PIC S9(03)    VALUE +100     03390058
034200                                                   COMP-3.        03400058
034300     05  PC-N                        PIC  X(01)    VALUE 'N'.     03410058
034400     05  PC-Y                        PIC  X(01)    VALUE 'Y'.     03420058
034500     05  PC-MRKRP086                 PIC  X(08)    VALUE          03430058
034600                                                   'MRKRP086'.    03440058
034700     05  PC-ASTERISK                 PIC  X(01)    VALUE '*'.     03450058
034800     05  PC-STYLE-DESC               PIC  X(18)    VALUE          03460058
034900         '# OF STYLE/COLORS:'.                                    03470058
034910     05  PC-INVALID-SVC-LEVEL        PIC  X(03)    VALUE '!!!'.   03480058
009000     05  PC-DS                       PIC  X(02)    VALUE 'DS'.            
035000 EJECT                                                            03490058
035100 01  PV-ACCUMULATOR-FIELDS.                                       03500058
035303                                                                          
035310     05  PV-TOT-STORES-FOR-ITEM      PIC S9(05)    VALUE ZERO     03510058
035320                                                   COMP-3.        03520058
035400     05  PV-TOT-ITEMS-FOR-STORE      PIC S9(05)    VALUE ZERO     03530058
035500                                                   COMP-3.        03540058
035600     05  PV-TOTAL-STORES             PIC S9(05)    VALUE ZERO     03550058
035700                                                   COMP-3.        03560058
035800     05  PV-TOTAL-SKUS               PIC S9(05)    VALUE ZERO     03570058
035900                                                   COMP-3.        03580058
036000     05  PV-NBR-OUT-OF-INV           PIC S9(05)    VALUE ZERO     03590058
036100                                                   COMP-3.        03600058
036200     05  PV-NBR-INSTOCK              PIC S9(05)    VALUE ZERO     03610058
036300                                                   COMP-3.        03620058
036400     05  PV-INSTOCKS-STYLE           PIC S9(07)    VALUE ZERO     03630058
036500                                                   COMP-3.        03640058
036600     05  PV-SKU-STORE-COMBOS         PIC S9(07)    VALUE ZERO     03650058
036700                                                   COMP-3.        03660058
036800     05  PV-SKUS-BELOW               PIC S9(05)    VALUE ZERO     03670058
036900                                                   COMP-3.        03680058
037000     05  PV-STORES-BELOW             PIC S9(05)    VALUE ZERO     03690058
037100                                                   COMP-3.        03700058
037200     05  PV-SC-INSTOCKS              PIC S9(07)    VALUE ZERO     03710058
037300                                                   COMP-3.        03720058
037400     05  PV-SC-COMBOS                PIC S9(07)    VALUE ZERO     03730058
037500                                                   COMP-3.        03740058
037600     05  PV-SC-TOTAL-SKUS            PIC S9(07)    VALUE ZERO     03750058
037700                                                   COMP-3.        03760058
037800     05  PV-SC-SKUS-BELOW            PIC S9(07)    VALUE ZERO     03770058
037900                                                   COMP-3.        03780058
038000     05  PV-SC-STORES-BELOW          PIC S9(07)    VALUE ZERO     03790058
038100                                                   COMP-3.        03800058
038200     05  PV-MC-INSTOCKS              PIC S9(07)    VALUE ZERO     03810058
038300                                                   COMP-3.        03820058
038400     05  PV-MC-COMBOS                PIC S9(07)    VALUE ZERO     03830058
038500                                                   COMP-3.        03840058
038600     05  PV-MC-TOTAL-SKUS            PIC S9(07)    VALUE ZERO     03850058
038700                                                   COMP-3.        03860058
038800     05  PV-MC-SKUS-BELOW            PIC S9(07)    VALUE ZERO     03870058
038900                                                   COMP-3.        03880058
039000     05  PV-MC-STORES-BELOW          PIC S9(07)    VALUE ZERO     03890058
039100                                                   COMP-3.        03900058
039200     05  PV-DP-INSTOCKS              PIC S9(07)    VALUE ZERO     03910058
039300                                                   COMP-3.        03920058
039400     05  PV-DP-COMBOS                PIC S9(07)    VALUE ZERO     03930058
039500                                                   COMP-3.        03940058
039600     05  PV-DP-TOTAL-SKUS            PIC S9(07)    VALUE ZERO     03950058
039700                                                   COMP-3.        03960058
039800     05  PV-DP-SKUS-BELOW            PIC S9(07)    VALUE ZERO     03970058
039900                                                   COMP-3.        03980058
040000     05  PV-DP-STORES-BELOW          PIC S9(07)    VALUE ZERO     03990058
040100                                                   COMP-3.        04000058
040200     05  PV-BG-INSTOCKS              PIC S9(07)    VALUE ZERO     04010058
040300                                                   COMP-3.        04020058
040400     05  PV-BG-COMBOS                PIC S9(07)    VALUE ZERO     04030058
040500                                                   COMP-3.        04040058
040600     05  PV-BG-TOTAL-SKUS            PIC S9(07)    VALUE ZERO     04050058
040700                                                   COMP-3.        04060058
040800     05  PV-BG-SKUS-BELOW            PIC S9(07)    VALUE ZERO     04070058
040900                                                   COMP-3.        04080058
041000     05  PV-BG-STORES-BELOW          PIC S9(07)    VALUE ZERO     04090058
041100                                                   COMP-3.        04100058
041200     05  PV-NBR-OF-STYLES            PIC S9(05)    VALUE ZERO     04110058
041300                                                   COMP-3.        04120058
041400*                                                                 04130058
041500 01  PV-MISC-FIELDS.                                              04140058
041600     05  PV-DP-SUB                   PIC S9(04)  VALUE +0         04150058
041700                                                 COMP SYNC.       04160058
041800     05  PV-SQL-SUB                  PIC S9(04)  VALUE +0         04170058
041900                                                 COMP SYNC.       04180058
042000     05  PV-ST-SUB                   PIC S9(05)  COMP SYNC.       04190058
042400     05  PV-MDSEBG-NBR               PIC X(03)     VALUE SPACES.  04230058
042500     05  PV-DEPT-NBR                 PIC X(03)     VALUE SPACES.  04240058
042600     05  PV-CLASS                    PIC X(02).                   04250058
042700     05  FILLER REDEFINES PV-CLASS.                               04260058
042800         10  PV-MAJOR-CLASS          PIC X.                       04270058
042900         10  PV-SUB-CLASS            PIC X.                       04280058
043000     05  PV-SKXREF-CLASS.                                         04290058
043100         10  PV-SKXREF-MAJOR-CLASS   PIC X.                       04300058
043200         10  PV-SKXREF-SUB-CLASS     PIC X.                       04310058
043300     05  PV-ITEM-NBR                 PIC S9(15)V   VALUE ZERO     04320058
043400                                                   COMP-3.        04330058
043500     05  PV-VENDOR-STYLE             PIC X(20).                   04340058
043600     05  PV-COLOR-DESC               PIC X(20).                   04350058
043700     05  PV-ITEM-DESC                PIC X(25).                   04360058
043800     05  PV-FIRST-STORE-COUNT        PIC S9(05)    VALUE ZERO     04370058
043900                                                   COMP-3.        04380058
044000     05  PV-HOLD-SVC-LVL             PIC S9(04)V9(03) VALUE ZERO  04390058
044100                                                   COMP-3.        04400058
044200     05  PV-SVC-LEVEL-PCT            PIC S9(03)    VALUE ZERO     04410058
044300                                                   COMP-3.        04420058
044400     05  PV-AVG-OSTRAT               PIC S9(04)V9  VALUE ZERO     04430058
044500                                                   COMP-3.        04440058
044600     05  PV-TOTAL-CSTOCK             PIC S9(13)    VALUE ZERO     04450058
044700                                                   COMP-3.        04460058
044800     05  PV-NULL-IND-OSTRAT          PIC S9(04)    COMP.          04470058
044900     05  PV-NULL-IND-CSTOCK          PIC S9(04)    COMP.          04480058
045000     05  PV-NULL-IND-ONHAND          PIC S9(04)    COMP.          04490058
045100     05  PV-NULL-IND-ONORDER         PIC S9(04)    COMP.          04500058
045200     05  PV-AVG-ONHAND               PIC S9(06)V9  VALUE ZERO     04510058
045300                                                   COMP-3.        04520058
045400     05  PV-SUM-ONORDER              PIC S9(09)    VALUE ZERO     04530058
045500                                                   COMP-3.        04540058
045600     05  PV-AVG-ONORDER              PIC S9(09)V9  VALUE ZERO     04550058
045700                                                   COMP-3.        04560058
045800     05  PV-HOLD-AVG-OO              PIC S9(09)V9(04) VALUE ZERO  04570058
045900                                                   COMP-3.        04580058
046000     05  PV-LEAD-TIME                PIC S9(03)    VALUE ZERO     04590058
046100                                                   COMP-3.        04600058
046200     05  PV-PAGE-CNT                 PIC S9(5)     VALUE +0       04610058
046300                                                   COMP-3.        04620058
046400     05  PV-LINE-CNT                 PIC S9(3)     VALUE +0       04630058
046500                                                   COMP-3.        04640058
046600     05  PV-PARAGRAPH-NAME           PIC X(30)     VALUE SPACES.  04650058
046700     05  PV-DB2-OPER-ATTEMPTED       PIC X(30)     VALUE SPACES.  04660058
046800     05  PV-VSAM-STATUS              PIC X(02)     VALUE SPACE.   04670058
046900         88  PV-VSAM-SUCCESSFUL                    VALUE '00'.    04680058
047000         88  PV-VSAM-NOT-FOUND                     VALUE '23'.    04690058
047100     05  PV-EXT-STATUS               PIC X(02)     VALUE SPACE.   04700058
047200         88  PV-EXT-SUCCESSFUL                     VALUE '00'.    04710058
047300     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     04720058
047400                                                   COMP SYNC.     04730058
047500     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  04740058
047600*                                                                 04750058
047700 01  CD-CPU-DATE                      PIC 9(08).                  04760058
047800 01  FILLER REDEFINES CD-CPU-DATE.                                04770058
047900     05  CD-CPU-YEAR                  PIC 9(04).                  04780058
048000     05  FILLER REDEFINES CD-CPU-YEAR.                            04790058
048100         10  CD-CPU-CC                PIC 9(02).                  04800058
048200         10  CD-CPU-YR                PIC 9(02).                  04810058
048300     05  CD-CPU-MO                    PIC 9(02).                  04820058
048400     05  CD-CPU-DY                    PIC 9(02).                  04830058
048500                                                                  04840058
048600 01  CT-CPU-TIME.                                                 04850058
048700     05  CT-CPU-HR                    PIC 9(02)     VALUE ZEROS.  04860058
048800     05  CT-CPU-MIN                   PIC 9(02)     VALUE ZEROS.  04870058
048900     05  CT-CPU-SEC                   PIC 9(02)     VALUE ZEROS.  04880058
049000     05  CT-CPU-HSEC                  PIC 9(02)     VALUE ZEROS.  04890058
049001                                                                          
049010******************************************************************        
049020*    NI SKU WORK AREA FIELDS                                              
049030******************************************************************        
049040     COPY ISWS006.                                                        
049050******************************************************************        
049100 EJECT                                                            04900058
049200*                                                                 04910058
049300***********************                                           04920058
049400*  DB2 TABLE LAYOUTS  *                                           04930058
049500***********************                                           04940058
049600*                                                                 04950058
049700     EXEC SQL                                                     04960058
049800         INCLUDE TSKXREF                                          04970058
049900     END-EXEC.                                                    04980058
050000*                                                                 04990058
050010     EXEC SQL                                                     04960058
050020         INCLUDE TMDSEAR                                          04970058
050030     END-EXEC.                                                    04980058
050040*                                                                 04990058
050100     EXEC SQL                                                     05000058
050200         INCLUDE TMDSEDP                                          05010058
050300     END-EXEC.                                                    05020058
050400*                                                                 05030058
050500     EXEC SQL                                                     05040058
050600         INCLUDE TMDSEBG                                          05050058
050700     END-EXEC.                                                    05060058
050800*                                                                 05070058
050900     EXEC SQL                                                     05080058
051000         INCLUDE TRSPBAR                                          05090058
051100     END-EXEC.                                                    05100058
051200*                                                                 05110058
051300     EXEC SQL                                                     05120058
051400         INCLUDE TSK                                              05130058
051500     END-EXEC.                                                    05140058
051600*                                                                 05150058
051700     EXEC SQL                                                     05160058
051800         INCLUDE TSKST                                            05170058
051900     END-EXEC.                                                    05180058
052000*                                                                 05190058
052100     EXEC SQL                                                     05200058
052200         INCLUDE XMT00001                                         05210058
052300     END-EXEC.                                                    05220058
052400*                                                                 05230058
052500     EXEC SQL                                                     05240058
052600         INCLUDE TMRITST                                          05250058
052700     END-EXEC.                                                    05260058
052800*                                                                 05270058
052900     EXEC SQL                                                     05280058
053000         INCLUDE TMRITEM                                          05290058
053100     END-EXEC.                                                    05300058
053200*                                                                 05310058
053300     EXEC SQL                                                     05320058
053400         INCLUDE TSKSTOO                                          05330058
053500     END-EXEC.                                                    05340058
053600 EJECT                                                            05350058
053700*                                                                 05360058
053800* DB2 COMMUNICATION AREA                                          05370058
053900*                                                                 05380058
054000     EXEC SQL                                                     05390058
054100         INCLUDE SQLCA                                            05400058
054200     END-EXEC.                                                    05410058
054300*                                                                 05420058
054400* DB2 COMMUNICATION AREA2                                         05430058
054500*                                                                 05440058
054600     COPY SQLCA2.                                                 05450058
054700 EJECT                                                            05460058
054800*                                                                 05470058
054900* CURSOR FOR BUSINESS GROUP, DEPARTMENT SELECTION                 05480058
055000*   WHERE CLAUSE FOR TEST PURPOSES ONLY                           05490058
055100*        AND A.DEPT_NBR   IN ('157','056')                        05500058
055200*                                                                 05510058
055300     EXEC SQL                                                     05520058
055400       DECLARE BG_DEPT_CSR CURSOR FOR                             05530058
055500       SELECT                                                     05540058
055600             C.MDSEBG_NBR,                                        05550058
055700             C.MDSEBG_DESC,                                       05560058
055800             A.DEPT_NBR,                                          05570058
055900             A.BYR_NBR,                                           05580058
056000             A.MDSEAR_DKEY                                        05590058
056100        FROM TMDSEAR A,                                           05600058
056200             TMDSEDP B,                                           05610058
056300             TMDSEBG C                                            05620058
056400       WHERE A.MDSELV_CDE  = 'DPT'                                05630058
056500         AND A.OPERCO_NBR  = '03'                                 05640058
056600         AND CURRENT DATE BETWEEN A.STRT_DTE AND A.END_DTE        05650058
056700         AND A.MDSEAR_DKEY = B.MDSEAR_DKEY                        05660058
056800         AND B.MDSEBG_NBR  = C.MDSEBG_NBR                         05670058
057000       ORDER BY C.MDSEBG_NBR,                                     05680058
057100                A.DEPT_NBR                                        05690058
057200       FOR FETCH ONLY                                             05700058
057300     END-EXEC.                                                    05710058
057400*                                                                 05720058
057500* CURSOR FOR CLASS, STYLE, COLOR, ITEM SELECTION                  05730058
057600*                                                                 05740058
059810     EXEC SQL                                                     05750058
059820       DECLARE ITEM_CSR CURSOR FOR                                05760058
059821       SELECT C.DEPT,                                                   58
059822              C.SUBCLASS,                                               58
059850              A.LONG_VENDOR_STYLE,                                05790058
059860              A.LONG_COLOR_DESC,                                  05800058
059870              A.ITEM_NMBR,                                        05810058
059880              C.SKU,                                                    58
059890              A.SKU_DESC,                                         05830058
059891              B.LT_QTY                                            05840058
059892         FROM TSK     A,                                          05850058
059893              TMRITEM B,                                          05860058
059894              TSKXREF C                                           05860058
059896        WHERE C.DEPT      = :NI-DEPT-9-4                                58
059897          AND ((B.RT_NBR >= 4 AND B.RT_DAY_NBR > 0) OR            05880058
059898               (B.RT_NBR  = 4 AND B.RT_DAY_NBR = 0))                    58
059899          AND A.ITEM_NMBR = B.ITEM_NBR                            05900058
059900          AND A.ITEM_NMBR = C.ITM_NBR                                   58
059901        ORDER BY C.DEPT,                                                58
059902                 C.SUBCLASS,                                              
059904                 A.LONG_VENDOR_STYLE,                             05930058
059905                 A.LONG_COLOR_DESC                                05940058
059906        FOR FETCH ONLY                                            05950058
059907     END-EXEC.                                                    05960058
059910*                                                                 05970058
060000* CURSOR FOR STORE SELECTION                                      05980058
060100*                                                                 05990058
060200     EXEC SQL                                                     06000058
060300       DECLARE STORE_CSR CURSOR FOR                               06010058
060400       SELECT LOC_NBR                                             06020058
060500         FROM XMT_LOC                                             06030058
060700        WHERE LOC_NBR     > 0                                     06050058
060800          AND LOC_TYP_CDE = :PC-DS                                06060062
060900          AND E_BUS_IND   = 'N'                                   06070058
061000        FOR FETCH ONLY                                            06080058
061100     END-EXEC.                                                    06090058
061200*                                                                 06100058
061300*---------------------------------------------------------------* 06110058
061400*   ERROR MESSAGE AREA FOR DB2                                    06120058
061500*---------------------------------------------------------------* 06130058
061600     COPY DPWS004.                                                06140058
061700*                                                                 06150058
061800 EJECT                                                            06160058
061900*                                                                 06170058
062000**************************************************************    06180058
062100*                                                                 06190058
062200*  TABLE FOR HOLDING DEPARTMENTS THAT WILL HAVE NO DETAIL         06200058
062300*  LINES ON REPORT (SUBCLASS WILL BE LOWEST LEVEL).               06210058
062400*                                                                 06220058
062500**************************************************************    06230058
062600*                                                                 06240058
062700 01  DP-DEPT-TABLE.                                               06250058
062800     05  DP-DEPT-ENTRIES OCCURS 200 TIMES                         06260058
062900                         INDEXED BY DP-INDEX.                     06270058
063000         10  DP-DEPT-NBR              PIC X(03).                  06280058
063100*                                                                 06290058
063200***************************************************************   06300058
063300*                                                                 06310058
063400*  TABLE FOR STORING NUMBER OF ITEMS THAT WERE OUT OF INVENTORY   06320058
063500*  FOR EACH STORE.  ACCESSED BY USING STORE NUMBER AS SUBSCRIPT.  06330058
063600*  VALID STORES ARE IDENTIFIED BY A 'Y' IN THE VALID-STORE-FLAG   06340058
063700*  FIELD.                                                         06350058
063800*                                                                 06360058
063900***************************************************************   06370058
064000*                                                                 06380058
064100 01  ST-STORE-TABLE.                                              06390058
064200     05  ST-STORE-ENTRIES OCCURS 9999 TIMES.                      06400058
064300         10  ST-VALID-STORE-FLAG      PIC X(01).                  06410058
064400         10  ST-OUT-OF-INV-ITEMS      PIC S9(05)  COMP-3.         06420058
064500*                                                                 06430058
064600 EJECT                                                            06440058
064700*                                                                 06450058
064800 LINKAGE SECTION.                                                 06460058
064900***************************************************************** 06470058
065000*PROCEDURE DIVISION.                                              06480058
065100***************************************************************** 06490058
065200 PROCEDURE DIVISION.                                              06500058
065300*                                                                 06510058
065400 A100-MAINLINE-PROCESSING.                                        06520058
065500*                                                                 06530058
065600     PERFORM B100-INITIALIZATION.                                 06540058
065700                                                                  06550058
065800     PERFORM B200-PROCESS-BG-DEPT-CURSOR                          06560058
065900             UNTIL EOF-BG-DEPT-CURSOR.                            06570058
066000*                                                                 06580058
066100     PERFORM B300-END-ROUTINE.                                    06590058
066200                                                                  06600058
066300     GOBACK.                                                      06610058
066400*                                                                 06620058
066500 EJECT                                                            06630058
066600***************************************************************** 06640058
066700*                                                                 06650058
066800*  LOAD STORE NUMBERS INTO STORE TABLE; READ CONTROL CARDS AND    06660058
066900*  PUT DEPARTMENT NUMBERS INTO TABLE                              06670058
067000*                                                                 06680058
067100***************************************************************** 06690058
067200 B100-INITIALIZATION.                                             06700058
067300*                                                                 06710058
067400     ACCEPT CT-CPU-TIME FROM TIME.                                06720058
067500     ACCEPT CD-CPU-DATE FROM DATE.                                06730058
067600                                                                  06740058
067700     MOVE CT-CPU-HR     TO DP132-RUN-HOUR.                        06750058
067800     MOVE CT-CPU-MIN    TO DP132-RUN-MINUTE.                      06760058
067900     MOVE CD-CPU-MO     TO DP132-RUN-MONTH.                       06770058
068000     MOVE CD-CPU-DY     TO DP132-RUN-DAY.                         06780058
068100     IF CD-CPU-YR > 80                                            06790058
068200        MOVE 19 TO CD-CPU-CC                                      06800058
068300     ELSE                                                         06810058
068400        MOVE 20 TO CD-CPU-CC.                                     06820058
068500     MOVE CD-CPU-YEAR   TO DP132-RUN-YEAR.                        06830058
068600                                                                  06840058
068700     MOVE 1           TO DP132-REPORT-NUMBER                      06850058
068800                         DP132-PAGE-NUMBER.                       06860058
068900     MOVE PC-MRKRP086 TO DP132-PROGRAM-NAME.                      06870058
069000*                                                                 06880058
069100     INITIALIZE DP-DEPT-TABLE                                     06890058
069200                ST-STORE-TABLE.                                   06900058
069300*                                                                 06910058
069400     SET NOT-EOF-STORE-CURSOR TO TRUE.                            06920058
069500     PERFORM X300-OPEN-STORE-CURSOR.                              06930058
069600*                                                                 06940058
069700     PERFORM C500-LOAD-STORE-TABLE                                06950058
069800         UNTIL EOF-STORE-CURSOR.                                  06960058
069900*                                                                 06970058
070000     PERFORM Y300-CLOSE-STORE-CURSOR.                             06980058
070100*                                                                 06990058
070200     PERFORM X700-OPEN-FILES.                                     07000058
070300*                                                                 07010058
070400     PERFORM Z100-READ-CONTROL-FILE                               07020058
070500         VARYING PV-DP-SUB FROM 1 BY 1                            07030058
070600         UNTIL EOF-CONTROL-FILE OR                                07040058
070700               (PV-DP-SUB > PC-DEPT-TABLE-MAX).                   07050058
070800*                                                                 07060058
070900     PERFORM X100-OPEN-BG-DEPT-CURSOR.                            07070058
071000*                                                                 07080058
071100***************************************************************** 07090058
071200*                                                                 07100058
071300*  FETCH BUSINESS GROUP/DEPT. CURSOR; CHECK FOR DEPT. BREAK AND   07110058
071400*  BUSINESS GROUP BREAK; PROCESS ALL ITEMS FOR THE DEPT.          07120058
071500*                                                                 07130058
071600***************************************************************** 07140058
071700 B200-PROCESS-BG-DEPT-CURSOR.                                     07150058
071800     PERFORM C100-FETCH-BG-DEPT-CSR                               07160058
071900*                                                                 07170058
072000     IF EOF-BG-DEPT-CURSOR                                        07180058
072100        PERFORM Y100-CLOSE-BG-DEPT-CURSOR                         07190058
072200        PERFORM C200-DEPT-BREAK                                   07200058
072300        PERFORM C300-BUSINESS-GROUP-BREAK                         07210058
072400     ELSE                                                         07220058
072510        PERFORM C200-DEPT-BREAK                                   07230058
072600                                                                  07240058
072700        IF MDSEBG-MDSEBG-NBR NOT = PV-MDSEBG-NBR                  07250058
072800           PERFORM C300-BUSINESS-GROUP-BREAK                      07260058
072900        END-IF                                                    07270058
073000                                                                  07280058
073100        MOVE MDSEAR-DEPT-NBR TO PV-DEPT-NBR                       07290058
073110        MOVE PV-DEPT-NBR     TO NI-DEPT-X-3                               
073120        MOVE NI-DEPT-9-3     TO NI-DEPT-9-4                               
073200                                                                        58
073300        SET NOT-EOF-ITEM-CURSOR TO TRUE                           07310058
073400        PERFORM X200-OPEN-ITEM-CURSOR                             07320058
073500                                                                  07330058
073600        PERFORM C400-PROCESS-ITEM-CURSOR                          07340058
073700            UNTIL EOF-ITEM-CURSOR                                 07350058
073800     END-IF.                                                      07360058
074210*                                                                 07370058
074220***************************************************************** 07380058
074230 B300-END-ROUTINE.                                                07390058
074240*                                                                 07400058
074300*                                                                 07410058
074400     WRITE PRINT-LINE FROM END-OF-REPORT-LINE                     07420058
074500         AFTER ADVANCING PC-2.                                    07430058
074600*                                                                 07440058
074700     PERFORM Y700-CLOSE-FILES.                                    07450058
074800*                                                                 07460058
074900***************************************************************** 07470058
075000 C100-FETCH-BG-DEPT-CSR.                                          07480058
075100     MOVE 'C100-FETCH-BG-DEPT-CSR'  TO PV-PARAGRAPH-NAME.         07490058
075200     MOVE 'BG CURSOR FETCH '        TO PV-DB2-OPER-ATTEMPTED.     07500058
075300     PERFORM                                                      07510058
075400         WITH TEST AFTER                                          07520058
075500         VARYING PV-SQL-SUB                                       07530058
075600         FROM 1 BY 1                                              07540058
075700         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        07550058
075800            OR SQLCODE = ZERO                                     07560058
075900            OR SQLCODE = +100                                     07570058
076000                                                                  07580058
076100         EXEC SQL                                                 07590058
076200             FETCH BG_DEPT_CSR                                    07600058
076300              INTO :MDSEBG-MDSEBG-NBR,                            07610058
076400                   :MDSEBG-MDSEBG-DESC,                           07620058
076500                   :MDSEAR-DEPT-NBR,                              07630058
076600                   :MDSEAR-BYR-NBR,                               07640058
076700                   :MDSEAR-DKEY                                   07650058
076800         END-EXEC                                                 07660058
076900         EVALUATE TRUE                                            07670058
077000             WHEN SQLCODE = ZERO                                  07680058
077100             WHEN SQLCODE = -904                                  07690058
077200             WHEN SQLCODE = -913                                  07700058
077300                 CONTINUE                                         07710058
077400             WHEN SQLCODE = +100                                  07720058
077500                 SET EOF-BG-DEPT-CURSOR TO TRUE                   07730058
077600             WHEN SQLWARN0 NOT = SPACES                           07740058
077700             WHEN SQLCODE  NOT = ZERO                             07750058
077800                  PERFORM Z999-SQL-ABEND                          07760058
077900         END-EVALUATE                                             07770058
078000     END-PERFORM.                                                 07780058
078100*                                                                 07790058
078200     IF PV-SQL-SUB > PC-MAX-RETRIES                               07800058
078300        MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'              07810058
078400                                   TO PV-DB2-OPER-ATTEMPTED       07820058
078500        PERFORM Z999-SQL-ABEND                                    07830058
078600     END-IF.                                                      07840058
078700*                                                                 07850058
078800 EJECT                                                            07860058
078900***************************************************************** 07870058
079000*                                                                 07880058
079100*  IF THERE WERE INFOREM ITEMS FOUND FOR THIS DEPARTMENT,         07890058
079200*  PRINT DEPT. TOTALS                                             07900058
079300*                                                                 07910058
079400***************************************************************** 07920058
079500 C200-DEPT-BREAK.                                                 07930058
079600*                                                                 07940058
079700     IF ITEMS-FOUND-FOR-DEPT                                      07950058
079800        SET ITEMS-FOUND-FOR-BG                                    07960058
079900            ITEMS-NOT-FOUND-FOR-DEPT TO TRUE                      07970058
080000                                                                  07980058
080100        IF PV-DP-COMBOS > ZERO                                    07990058
080110           IF PV-DP-INSTOCKS < ZERO                               08000058
080120              SET INVALID-SVC-LEVEL   TO TRUE                     08010058
080130           ELSE                                                   08011058
080140              SET VALID-SVC-LEVEL     TO TRUE                     08012058
080150           END-IF                                                 08013058
080200           COMPUTE PV-HOLD-SVC-LVL =                              08014058
080300                    (PV-DP-INSTOCKS / PV-DP-COMBOS) * 100         08015058
080400           COMPUTE PV-SVC-LEVEL-PCT ROUNDED = PV-HOLD-SVC-LVL     08016058
080500        ELSE                                                      08017058
080600           MOVE ZERO TO PV-SVC-LEVEL-PCT                          08018058
080700        END-IF                                                    08019058
080800*                                                                 08020058
080900        MOVE SPACES             TO TL2-CLASS                      08030058
081000        MOVE 'DEPARTMENT TOTAL' TO TL2-TOTAL-DESC                 08040058
081100        MOVE PV-DP-TOTAL-SKUS   TO TL2-TOT-SKUS                   08050058
081110        IF INVALID-SVC-LEVEL                                      08060058
081120           MOVE PC-INVALID-SVC-LEVEL TO TL2-SVC-LEVEL-X           08070058
081130        ELSE                                                      08080058
081200           MOVE PV-SVC-LEVEL-PCT     TO TL2-SVC-LEVEL             08090058
081210        END-IF                                                    08100058
081300        MOVE PV-DP-SKUS-BELOW   TO TL2-SKUS-BELOW                 08110058
081400        MOVE PV-DP-STORES-BELOW TO TL2-STORES-BELOW               08120058
081500        PERFORM T300-PRINT-DEPT-TOTALS                            08130058
081600*                                                                 08140058
081700        ADD PV-DP-INSTOCKS     TO PV-BG-INSTOCKS                  08150058
081800        ADD PV-DP-COMBOS       TO PV-BG-COMBOS                    08160058
081900        ADD PV-DP-TOTAL-SKUS   TO PV-BG-TOTAL-SKUS                08170058
082000        ADD PV-DP-SKUS-BELOW   TO PV-BG-SKUS-BELOW                08180058
082100        ADD PV-DP-STORES-BELOW TO PV-BG-STORES-BELOW              08190058
082200*                                                                 08200058
082300        MOVE ZERO TO PV-DP-INSTOCKS                               08210058
082400                     PV-DP-COMBOS                                 08220058
082500                     PV-DP-TOTAL-SKUS                             08230058
082600                     PV-DP-SKUS-BELOW                             08240058
082700                     PV-DP-STORES-BELOW                           08250058
082800     END-IF.                                                      08260058
082900*                                                                 08270058
083000***************************************************************** 08280058
083100*                                                                 08290058
083200*  IF THERE WERE INFOREM ITEMS FOUND FOR THIS BUSINESS GROUP,     08300058
083300*  PRINT BUSINESS GROUP TOTALS                                    08310058
083400*                                                                 08320058
083500***************************************************************** 08330058
083600 C300-BUSINESS-GROUP-BREAK.                                       08340058
083700*                                                                 08350058
083800     IF ITEMS-FOUND-FOR-BG                                        08360058
083900        SET ITEMS-NOT-FOUND-FOR-BG TO TRUE                        08370058
084000                                                                  08380058
084100        IF PV-BG-COMBOS > ZERO                                    08390058
084110           IF PV-BG-INSTOCKS < ZERO                               08400058
084120              SET INVALID-SVC-LEVEL    TO TRUE                    08410058
084130           ELSE                                                   08411058
084140              SET VALID-SVC-LEVEL      TO TRUE                    08412058
084150           END-IF                                                 08413058
084200           COMPUTE PV-HOLD-SVC-LVL =                              08414058
084300                    (PV-BG-INSTOCKS / PV-BG-COMBOS) * 100         08415058
084400           COMPUTE PV-SVC-LEVEL-PCT ROUNDED = PV-HOLD-SVC-LVL     08416058
084500        ELSE                                                      08417058
084600           MOVE ZERO TO PV-SVC-LEVEL-PCT                          08418058
084700        END-IF                                                    08419058
084800*                                                                 08420058
084900        MOVE SPACES                 TO TL2-CLASS                  08430058
085000        MOVE 'BUSINESS GROUP TOTAL' TO TL2-TOTAL-DESC             08440058
085100        MOVE PV-BG-TOTAL-SKUS       TO TL2-TOT-SKUS               08450058
085110        IF INVALID-SVC-LEVEL                                      08460058
085120           MOVE PC-INVALID-SVC-LEVEL   TO TL2-SVC-LEVEL-X         08470058
085130        ELSE                                                      08480058
085200           MOVE PV-SVC-LEVEL-PCT       TO TL2-SVC-LEVEL           08490058
085210        END-IF                                                    08500058
085300        MOVE PV-BG-SKUS-BELOW       TO TL2-SKUS-BELOW             08510058
085400        MOVE PV-BG-STORES-BELOW     TO TL2-STORES-BELOW           08520058
085500        PERFORM T400-PRINT-BG-TOTALS                              08530058
085600*                                                                 08540058
085700        MOVE ZERO TO PV-BG-INSTOCKS                               08550058
085800                     PV-BG-COMBOS                                 08560058
085900                     PV-BG-TOTAL-SKUS                             08570058
086000                     PV-BG-SKUS-BELOW                             08580058
086100                     PV-BG-STORES-BELOW                           08590058
086200     END-IF.                                                      08600058
086300*                                                                 08610058
086400     MOVE MDSEBG-MDSEBG-NBR TO PV-MDSEBG-NBR                      08620058
086500                               HL3-BG-NUMBER.                     08630058
086600     MOVE MDSEBG-MDSEBG-DESC TO HL3-BG-DESC.                      08640058
086700*                                                                 08650058
086800***************************************************************** 08660058
086900*                                                                 08670058
087000*  FETCH ITEM CURSOR; IF PV-TOTAL-SKUS = 0, IT IS THE FIRST ITEM  08680058
087100*  OF A NEW DEPT. (PERFORM "NEW DEPT." ROUTINES)                  08690058
087200*                                                                 08700058
087300*  IF PV-TOTAL-SKUS > 0, CHECK FOR A STYLE/COLOR BREAK, THEN      08710058
087400*  CHECK FOR SUBCLASS & MAJOR CLASS BREAKS.                       08720058
087500*                                                                 08730058
087600*  IF PV-TOTAL-SKUS = 1, IT IS THE FIRST ITEM OF A STYLE/COLOR.   08740058
087700*  READ THE OUT-OF-INV FILE FOR EACH STORE ASSOCIATED WITH THE    08750058
087800*  CURRENT ITEM, THEN CALCULATE THE ITEM'S SERVICE LEVEL.         08760058
087900*  IF BELOW THE SET LIMIT, PUT OUT AN EXTRACT RECORD.             08770058
088000*                                                                 08780058
088100*  FOR FIRST ITEM IN STYLE/COLOR, SAVE NUMBER OF STORES, THEN     08790058
088200*  COMPARE IT AGAINST SUBSEQUENT ITEMS;  IF DIFFERENT, MOVE * TO  08800058
088300*  REPORT LINE.                                                   08810058
088400*                                                                 08820058
088500***************************************************************** 08830058
088600 C400-PROCESS-ITEM-CURSOR.                                        08840058
088700*                                                                 08850058
088800     PERFORM D100-FETCH-ITEM-CSR                                  08860058
088900*                                                                 08870058
089000     IF EOF-ITEM-CURSOR                                           08880058
089100        PERFORM Y200-CLOSE-ITEM-CURSOR                            08890058
089200        IF ITEMS-FOUND-FOR-DEPT                                   08900058
089300           PERFORM D200-STYLE-COLOR-BREAK                         08910058
089400           PERFORM D300-SUBCLASS-BREAK                            08920058
089500           PERFORM D400-MAJOR-CLASS-BREAK                         08930058
089600        END-IF                                                    08940058
089700     ELSE                                                         08950058
089800        IF PV-TOTAL-SKUS = ZERO                                   08960058
089900           SET ITEMS-FOUND-FOR-DEPT TO TRUE                       08970058
090000           MOVE PV-DEPT-NBR    TO NI-DEPT-X-3                     08980058
090010           MOVE NI-DEPT-9-3    TO HL3-DEPT                        08980058
090100           MOVE MDSEAR-BYR-NBR TO HL2-BYR-NMBR                    08990058
090200                                                                  09000058
090300           PERFORM D600-CHECK-DEPT-TABLE                          09010058
090400           PERFORM D700-GET-BUYER-NAME                            09020058
090500           PERFORM Z400-PRINT-REPORT-HEADERS                      09030058
090600        ELSE                                                      09040058
090700           IF (TSK-LONG-VENDOR-STYLE NOT = PV-VENDOR-STYLE) OR    09050058
090800              (TSK-LONG-COLOR-DESC   NOT = PV-COLOR-DESC)         09060058
090900              PERFORM D200-STYLE-COLOR-BREAK                      09070058
091000           ELSE                                                   09080058
091010              MOVE SKXREF-SUBCLASS  TO NI-SUB-CLASS-9-2                   
091100              IF NI-SUB-CLASS-X-2   NOT = PV-CLASS                      58
091200                 PERFORM D200-STYLE-COLOR-BREAK                   09100058
091300              END-IF                                              09110058
091400           END-IF                                                 09120058
091500                                                                  09130058
091600           MOVE SKXREF-SUBCLASS  TO NI-SUB-CLASS-9-2                    58
091610           MOVE NI-SUB-CLASS-X-2 TO PV-SKXREF-CLASS                       
091700           IF NI-SUB-CLASS-X-2  NOT = PV-CLASS                          58
091800              PERFORM D300-SUBCLASS-BREAK                         09160058
091900           END-IF                                                 09170058
092000           IF PV-SKXREF-MAJOR-CLASS NOT = PV-MAJOR-CLASS          09180058
092100              PERFORM D400-MAJOR-CLASS-BREAK                      09190058
092200           END-IF                                                 09200058
092300        END-IF                                                    09210058
092400*                                                                 09220058
092500        ADD PC-1 TO PV-TOTAL-SKUS                                 09230058
092600        IF PV-TOTAL-SKUS = PC-1                                   09240058
092700           MOVE TSK-LONG-VENDOR-STYLE TO PV-VENDOR-STYLE          09250058
092800           MOVE TSK-LONG-COLOR-DESC   TO PV-COLOR-DESC            09260058
092900           MOVE SKXREF-SUBCLASS       TO NI-SUB-CLASS-9-2         09270058
092910           MOVE NI-SUB-CLASS-X-2      TO PV-CLASS                         
093000           MOVE MRITEM-LT-QTY         TO PV-LEAD-TIME             09280058
093100           MOVE TSK-SKU-DESC          TO PV-ITEM-DESC             09290058
093200        END-IF                                                    09300058
093300*                                                                 09310058
093400        MOVE TSK-ITEM-NMBR       TO PV-ITEM-NBR                   09320058
093500                                                                  09330058
093600        PERFORM D800-GET-STORE-COUNT                              09340058
093700*                                                                 09350058
093800        IF PV-TOT-STORES-FOR-ITEM > ZERO                          09360058
093900           SET NOT-END-OF-ITEM-STORES TO TRUE                     09370058
094000           MOVE PV-DEPT-NBR           TO MR030-DEPT-NBR           09380058
094100           MOVE PV-CLASS              TO MR030-CLASS-NBR          09390058
094200           MOVE PV-VENDOR-STYLE       TO MR030-VENDOR-STYLE       09400058
094300           MOVE PV-COLOR-DESC         TO MR030-COLOR-DESC         09410058
094400           MOVE PV-ITEM-NBR           TO MR030-ITEM-NBR           09420058
094500           MOVE ZERO                  TO MR030-STORE-NBR          09430058
094600           MOVE MR030-OUT-OF-INV-KEY  TO OUT-OF-INV-KEY           09440058
094700           PERFORM Z500-START-BROWSE-OOI-FILE                     09450058
094800                                                                  09460058
094900           PERFORM D500-PROCESS-ITEM-STORES                       09470058
095000               UNTIL END-OF-ITEM-STORES                           09480058
095100*                                                                 09490058
095200           SUBTRACT PV-NBR-OUT-OF-INV FROM PV-TOT-STORES-FOR-ITEM 09500058
095300              GIVING PV-NBR-INSTOCK                               09510058
095310           IF PV-NBR-INSTOCK < ZERO                               09520058
095320              SET INVALID-SVC-LEVEL  TO TRUE                      09530058
095330           ELSE                                                   09531058
095340              SET VALID-SVC-LEVEL    TO TRUE                      09532058
095350           END-IF                                                 09533058
095400           COMPUTE PV-HOLD-SVC-LVL =                              09534058
095500                  (PV-NBR-INSTOCK / PV-TOT-STORES-FOR-ITEM) * 100 09535058
095600           COMPUTE PV-SVC-LEVEL-PCT ROUNDED = PV-HOLD-SVC-LVL     09536058
095700        ELSE                                                      09537058
095800           MOVE ZERO TO PV-SVC-LEVEL-PCT                          09538058
095900                        PV-NBR-INSTOCK                            09539058
096000        END-IF                                                    09540058
096100*                                                                 09550058
096200        IF PV-SVC-LEVEL-PCT < PC-SKU-SVC-LEVEL-LIMIT              09560058
096300           ADD PC-1          TO PV-SKUS-BELOW                     09570058
096310           MOVE SKXREF-SKU   TO NI-SKU-9                                  
096400           MOVE NI-SKU       TO MR031-SKU                               58
096500           MOVE PV-ITEM-NBR  TO MR031-ITEM-NBR                    09590058
096600           MOVE SPACES       TO MR031-STORE                       09600058
096700           PERFORM F200-CREATE-EXTRACT-RECORD                     09610058
096800        END-IF                                                    09620058
096900*                                                                 09630058
097000        ADD PV-NBR-INSTOCK TO PV-INSTOCKS-STYLE                   09640058
097100*                                                                 09650058
097200        IF PV-FIRST-STORE-COUNT = ZERO                            09660058
097300           MOVE PV-TOT-STORES-FOR-ITEM TO PV-FIRST-STORE-COUNT    09670058
097400        ELSE                                                      09680058
097500           IF PV-TOT-STORES-FOR-ITEM NOT = PV-FIRST-STORE-COUNT   09690058
097600              MOVE PC-ASTERISK TO DL1-ASTERISK                    09700058
097700           END-IF                                                 09710058
097800        END-IF                                                    09720058
097900                                                                  09730058
098000        MOVE ZERO TO PV-NBR-INSTOCK                               09740058
098100                     PV-TOT-STORES-FOR-ITEM                       09750058
098200                     PV-NBR-OUT-OF-INV                            09760058
098300     END-IF.                                                      09770058
098460*                                                                 07400058
098500***************************************************************** 09790058
098600*                                                                 09800058
098700*  LOAD TABLE WITH STORES FROM XMT_LOC                            09810058
098800*                                                                 09820058
098900***************************************************************** 09830058
099000 C500-LOAD-STORE-TABLE.                                           09840058
099100*                                                                 09850058
099200     PERFORM F100-FETCH-STORE-CURSOR.                             09860058
099300                                                                  09870058
099400     IF EOF-STORE-CURSOR                                          09880058
099500        CONTINUE                                                  09890058
099600     ELSE                                                         09900058
099700        MOVE XMT00001-LOC-NBR   TO PV-ST-SUB                      09910058
099900        MOVE PC-Y TO ST-VALID-STORE-FLAG (PV-ST-SUB)              09930058
100000     END-IF.                                                      09940058
100100*                                                                 09950058
100200***************************************************************** 09960058
100300 D100-FETCH-ITEM-CSR.                                             09970058
100400     MOVE 'D100-FETCH-ITEM-CSR' TO PV-PARAGRAPH-NAME.             09980058
100500     MOVE 'ITEM CURSOR FETCH '  TO PV-DB2-OPER-ATTEMPTED.         09990058
100600     PERFORM                                                      10000058
100700         WITH TEST AFTER                                          10010058
100800         VARYING PV-SQL-SUB                                       10020058
100900         FROM 1 BY 1                                              10030058
101000         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        10040058
101100            OR SQLCODE = ZERO                                     10050058
101200            OR SQLCODE = +100                                     10060058
101300                                                                  10070058
101400         EXEC SQL                                                 10080058
101500             FETCH ITEM_CSR                                       10090058
101600              INTO :SKXREF-DEPT,                                        58
101700                   :SKXREF-SUBCLASS,                                    58
101800                   :TSK-LONG-VENDOR-STYLE,                        10120058
101900                   :TSK-LONG-COLOR-DESC,                          10130058
102000                   :TSK-ITEM-NMBR,                                10140058
102100                   :SKXREF-SKU,                                   10150058
102200                   :TSK-SKU-DESC,                                 10160058
102300                   :MRITEM-LT-QTY                                 10170058
102400         END-EXEC                                                 10180058
102500         EVALUATE TRUE                                            10190058
102600             WHEN SQLCODE = ZERO                                  10200058
102700             WHEN SQLCODE = -904                                  10210058
102800             WHEN SQLCODE = -913                                  10220058
102900                 CONTINUE                                         10230058
103000             WHEN SQLCODE = +100                                  10240058
103100                 SET EOF-ITEM-CURSOR TO TRUE                      10250058
103200             WHEN SQLWARN0 NOT = SPACES                           10260058
103300             WHEN SQLCODE  NOT = ZERO                             10270058
103400                  PERFORM Z999-SQL-ABEND                          10280058
103500         END-EVALUATE                                             10290058
103600     END-PERFORM.                                                 10300058
103700*                                                                 10310058
103800     IF PV-SQL-SUB > PC-MAX-RETRIES                               10320058
103900        MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'              10330058
104000                                   TO PV-DB2-OPER-ATTEMPTED       10340058
104100        PERFORM Z999-SQL-ABEND                                    10350058
104200     END-IF.                                                      10360058
104210                                                                          
104300*                                                                 10370058
104400***************************************************************** 10380058
104500*                                                                 10390058
104600*  OBTAIN OSTRAT, CSTOCK, ONORDER, & ONHAND FOR THE STYLE/COLOR.  10400058
104700*  READ THROUGH THE INTERNAL STORE TABLE TO CALCULATE EACH VALID  10410058
104800*  STORE'S SERVICE LEVEL.                                         10420058
104900*  THEN CALC THE SERVICE LEVEL FOR THE STYLE/COLOR AND PRINT THE  10430058
105000*  DETAIL LINE.                                                   10440058
105100*                                                                 10450058
105200***************************************************************** 10460058
105300 D200-STYLE-COLOR-BREAK.                                          10470058
105400*                                                                 10480058
105500     MOVE ZERO TO PV-AVG-OSTRAT                                   10490058
105600                  PV-TOTAL-CSTOCK                                 10500058
105700                  PV-AVG-ONORDER                                  10510058
105800                  PV-AVG-ONHAND.                                  10520058
105900*                                                                 10530058
106000     PERFORM E200-GET-OSTRAT-QTY.                                 10540058
106100*                                                                 10550058
106200     IF PRINT-DETAIL-FOR-DEPT                                     10560058
106300        PERFORM E300-GET-ONORDER-QTY                              10570058
106400        PERFORM E600-GET-ONHAND-QTY                               10580058
106500     END-IF                                                       10590058
106600*                                                                 10600058
106700     PERFORM E400-CALC-STORE-SVC-LEVELS                           10610058
106800         VARYING PV-ST-SUB FROM 1 BY 1                            10620058
106900         UNTIL PV-ST-SUB GREATER THAN PC-STORE-TABLE-MAX.         10630058
107000*                                                                 10640058
107100     IF PV-SKU-STORE-COMBOS > ZERO                                10650058
107110        IF PV-INSTOCKS-STYLE < ZERO                               10660058
107120           SET INVALID-SVC-LEVEL      TO TRUE                     10670058
107130        ELSE                                                      10680058
107140           SET VALID-SVC-LEVEL        TO TRUE                     10690058
107150        END-IF                                                    10700058
107200        COMPUTE PV-HOLD-SVC-LVL =                                 10710058
107300                 (PV-INSTOCKS-STYLE / PV-SKU-STORE-COMBOS) * 100  10720058
107400        COMPUTE PV-SVC-LEVEL-PCT ROUNDED = PV-HOLD-SVC-LVL        10730058
107500     ELSE                                                         10740058
107600        MOVE ZERO TO PV-SVC-LEVEL-PCT                             10750058
107700     END-IF                                                       10760058
107800*                                                                 10770058
107900     IF PRINT-DETAIL-FOR-DEPT                                     10780058
108000        PERFORM E500-FORMAT-DETAIL-LINE                           10790058
108100     END-IF                                                       10800058
108200*                                                                 10810058
108300     ADD PV-INSTOCKS-STYLE   TO PV-SC-INSTOCKS                    10820058
108400     ADD PV-SKU-STORE-COMBOS TO PV-SC-COMBOS                      10830058
108500     ADD PV-TOTAL-SKUS       TO PV-SC-TOTAL-SKUS                  10840058
108600     ADD PV-SKUS-BELOW       TO PV-SC-SKUS-BELOW                  10850058
108700     ADD PV-STORES-BELOW     TO PV-SC-STORES-BELOW                10860058
108800     ADD PC-1                TO PV-NBR-OF-STYLES                  10870058
108900*                                                                 10880058
109000     MOVE ZERO TO PV-INSTOCKS-STYLE                               10890058
109100                  PV-SKU-STORE-COMBOS                             10900058
109200                  PV-TOTAL-SKUS                                   10910058
109300                  PV-SKUS-BELOW                                   10920058
109400                  PV-STORES-BELOW                                 10930058
109500                  PV-FIRST-STORE-COUNT.                           10940058
109600*                                                                 10950058
109700***************************************************************** 10960058
109800*                                                                 10970058
109900*  CALCULATE THE SUBCLASS SERVICE LEVEL AND PRINT TOTALS          10980058
110000*                                                                 10990058
110100***************************************************************** 11000058
110200 D300-SUBCLASS-BREAK.                                             11010058
110300*                                                                 11020058
110400     MOVE ZERO TO PV-AVG-OSTRAT                                   11030058
110500                  PV-TOTAL-CSTOCK                                 11040058
110600                  PV-AVG-ONORDER                                  11050058
110700                  PV-AVG-ONHAND.                                  11060058
110800*                                                                 11070058
110900     PERFORM E700-GET-SUBCL-OSTRAT-QTY.                           11080058
111000     PERFORM E800-GET-SUBCL-ONORDER-QTY.                          11090058
111100     PERFORM E900-GET-SUBCL-ONHAND-QTY.                           11100058
111200*                                                                 11110058
111300     IF PV-SC-COMBOS > ZERO                                       11120058
111310        IF PV-SC-INSTOCKS < ZERO                                  11130058
111320           SET INVALID-SVC-LEVEL   TO TRUE                        11131058
111330        ELSE                                                      11132058
111340           SET VALID-SVC-LEVEL     TO TRUE                        11133058
111350        END-IF                                                    11134058
111400        COMPUTE PV-HOLD-SVC-LVL =                                 11135058
111500                 (PV-SC-INSTOCKS / PV-SC-COMBOS) * 100            11136058
111600        COMPUTE PV-SVC-LEVEL-PCT ROUNDED = PV-HOLD-SVC-LVL        11137058
111700     ELSE                                                         11138058
111800        MOVE ZERO TO PV-SVC-LEVEL-PCT                             11139058
111900     END-IF                                                       11140058
112000*                                                                 11150058
112100     IF PRINT-DETAIL-FOR-DEPT                                     11160058
112200        MOVE SPACES TO TL1-STYLE-DESC                             11170058
112300        MOVE ZERO   TO TL1-NBR-OF-STYLES                          11180058
112400     ELSE                                                         11190058
112500        MOVE PC-STYLE-DESC    TO TL1-STYLE-DESC                   11200058
112600        MOVE PV-NBR-OF-STYLES TO TL1-NBR-OF-STYLES                11210058
112700     END-IF                                                       11220058
112800*                                                                 11230058
112900     MOVE PV-CLASS           TO TL1-CLASS.                        11240058
113000     MOVE 'SUBCLASS TOTAL'   TO TL1-TOTAL-DESC.                   11250058
113100     MOVE PV-SC-TOTAL-SKUS   TO TL1-TOT-SKUS.                     11260058
113200     MOVE PV-AVG-ONHAND      TO TL1-AVG-OH.                       11270058
113300     MOVE PV-AVG-ONORDER     TO TL1-AVG-OO.                       11280058
113400     MOVE PV-TOTAL-CSTOCK    TO TL1-CSTOCK.                       11290058
113410     IF INVALID-SVC-LEVEL                                         11300058
113420        MOVE PC-INVALID-SVC-LEVEL  TO TL1-SVC-LEVEL-X             11310058
113430     ELSE                                                         11320058
113500        MOVE PV-SVC-LEVEL-PCT      TO TL1-SVC-LEVEL               11330058
113510     END-IF.                                                      11340058
113600     MOVE PV-SC-SKUS-BELOW   TO TL1-SKUS-BELOW.                   11350058
113700     MOVE PV-SC-STORES-BELOW TO TL1-STORES-BELOW.                 11360058
113800     MOVE PV-AVG-OSTRAT      TO TL1-AVG-OSTRAT.                   11370058
113900     MOVE PV-LEAD-TIME       TO TL1-LEAD-TIME.                    11380058
114000     PERFORM T100-PRINT-SUBCLASS-TOTALS.                          11390058
114100*                                                                 11400058
114200     ADD PV-SC-INSTOCKS     TO PV-MC-INSTOCKS                     11410058
114300     ADD PV-SC-COMBOS       TO PV-MC-COMBOS                       11420058
114400     ADD PV-SC-TOTAL-SKUS   TO PV-MC-TOTAL-SKUS                   11430058
114500     ADD PV-SC-SKUS-BELOW   TO PV-MC-SKUS-BELOW                   11440058
114600     ADD PV-SC-STORES-BELOW TO PV-MC-STORES-BELOW                 11450058
114700*                                                                 11460058
114800     MOVE ZERO TO PV-SC-INSTOCKS                                  11470058
114900                  PV-SC-COMBOS                                    11480058
115000                  PV-SC-TOTAL-SKUS                                11490058
115100                  PV-SC-SKUS-BELOW                                11500058
115200                  PV-SC-STORES-BELOW                              11510058
115300                  PV-NBR-OF-STYLES.                               11520058
115400*                                                                 11530058
115500     MOVE PV-SKXREF-SUB-CLASS TO PV-SUB-CLASS.                    11540058
115600*                                                                 11550058
115700***************************************************************** 11560058
115800*                                                                 11570058
115900*  CALCULATE THE MAJOR CLASS SERVICE LEVEL AND PRINT TOTALS       11580058
116000*                                                                 11590058
116100***************************************************************** 11600058
116200 D400-MAJOR-CLASS-BREAK.                                          11610058
116300*                                                                 11620058
116400     IF PV-MC-COMBOS > ZERO                                       11630058
116410        IF PV-MC-INSTOCKS < ZERO                                  11640058
116420           SET INVALID-SVC-LEVEL   TO TRUE                        11641058
116430        ELSE                                                      11642058
116440           SET VALID-SVC-LEVEL     TO TRUE                        11643058
116450        END-IF                                                    11644058
116500        COMPUTE PV-HOLD-SVC-LVL =                                 11645058
116600                 (PV-MC-INSTOCKS / PV-MC-COMBOS) * 100            11646058
116700        COMPUTE PV-SVC-LEVEL-PCT ROUNDED = PV-HOLD-SVC-LVL        11647058
116800     ELSE                                                         11648058
116900        MOVE ZERO TO PV-SVC-LEVEL-PCT                             11649058
117000     END-IF                                                       11650058
117100*                                                                 11660058
117200     MOVE PV-MAJOR-CLASS      TO TL2-CLASS.                       11670058
117300     MOVE 'MAJOR CLASS TOTAL' TO TL2-TOTAL-DESC.                  11680058
117400     MOVE PV-MC-TOTAL-SKUS    TO TL2-TOT-SKUS.                    11690058
117410     IF INVALID-SVC-LEVEL                                         11700058
117420        MOVE PC-INVALID-SVC-LEVEL  TO TL2-SVC-LEVEL-X             11710058
117430     ELSE                                                         11720058
117500        MOVE PV-SVC-LEVEL-PCT      TO TL2-SVC-LEVEL               11730058
117510     END-IF.                                                      11740058
117600     MOVE PV-MC-SKUS-BELOW    TO TL2-SKUS-BELOW.                  11750058
117700     MOVE PV-MC-STORES-BELOW  TO TL2-STORES-BELOW.                11760058
117800     PERFORM T200-PRINT-MAJOR-CLASS-TOTALS.                       11770058
117900*                                                                 11780058
118000     ADD PV-MC-INSTOCKS     TO PV-DP-INSTOCKS                     11790058
118100     ADD PV-MC-COMBOS       TO PV-DP-COMBOS                       11800058
118200     ADD PV-MC-TOTAL-SKUS   TO PV-DP-TOTAL-SKUS                   11810058
118300     ADD PV-MC-SKUS-BELOW   TO PV-DP-SKUS-BELOW                   11820058
118400     ADD PV-MC-STORES-BELOW TO PV-DP-STORES-BELOW                 11830058
118500*                                                                 11840058
118600     MOVE ZERO TO PV-MC-INSTOCKS                                  11850058
118700                  PV-MC-COMBOS                                    11860058
118800                  PV-MC-TOTAL-SKUS                                11870058
118900                  PV-MC-SKUS-BELOW                                11880058
119000                  PV-MC-STORES-BELOW.                             11890058
119100*                                                                 11900058
119200     MOVE SKXREF-SUBCLASS  TO NI-SUB-CLASS-9-2.                         58
119210     MOVE NI-SUB-CLASS-X-2 TO PV-CLASS.                                 58
119300*                                                                 11920058
119400***************************************************************** 11930058
119500*                                                                 11940058
119600*  READ THE OUT-OF-INV FILE FOR AN ITEM/STORE.                    11950058
119700*  IF RECORD FOUND, UPDATE THE COUNTER IN THE STORE TABLE.        11960058
119800*                                                                 11970058
119900***************************************************************** 11980058
120000 D500-PROCESS-ITEM-STORES.                                        11990058
120100*                                                                 12000058
120200     PERFORM Z600-READ-NEXT-OOI-FILE.                             12010058
120300                                                                  12020058
120400     IF END-OF-ITEM-STORES                                        12030058
120500        CONTINUE                                                  12040058
120600     ELSE                                                         12050058
120700        IF MR030-ITEM-NBR NOT = PV-ITEM-NBR                       12060058
120800           SET END-OF-ITEM-STORES TO TRUE                         12070058
120900        ELSE                                                      12080058
121000           MOVE MR030-STORE-NBR  TO PV-ST-SUB                     12090058
121200           ADD PC-1 TO ST-OUT-OF-INV-ITEMS (PV-ST-SUB)            12110058
121300                       PV-NBR-OUT-OF-INV                          12120058
121400        END-IF                                                    12130058
121500     END-IF.                                                      12140058
121600*                                                                 12150058
121700***************************************************************** 12160058
121800*                                                                 12170058
121900*  IF DEPT. NUMBER IS FOUND IN TABLE, SET FLAG TO INDICATE THAT   12180058
122000*  NO STYLE/COLOR DETAIL SHOULD BE PRINTED FOR THIS DEPT.         12190058
122100*  (WILL BE SUMMED UP TO SUBCLASS LEVEL)                          12200058
122200*                                                                 12210058
122300***************************************************************** 12220058
122400 D600-CHECK-DEPT-TABLE.                                           12230058
122500*                                                                 12240058
122600     SET DP-INDEX TO 1.                                           12250058
122700     SEARCH DP-DEPT-ENTRIES                                       12260058
122800        AT END                                                    12270058
122900           SET PRINT-DETAIL-FOR-DEPT TO TRUE                      12280058
123000        WHEN DP-DEPT-NBR (DP-INDEX) = PV-DEPT-NBR                 12290058
123100           SET NO-DETAIL-FOR-DEPT TO TRUE                         12300058
123200     END-SEARCH.                                                  12310058
123300*                                                                 12320058
123400***************************************************************** 12330058
123500 D700-GET-BUYER-NAME.                                             12340058
123600*                                                                 12350058
123700     MOVE 'D700-GET-BUYER-NAME'   TO PV-PARAGRAPH-NAME.           12360058
123800     MOVE 'SELECT FOR BUYER NAME' TO PV-DB2-OPER-ATTEMPTED.       12370058
123900     MOVE SPACES                  TO HL2-BYR-NAME.                12380058
124000*                                                                 12390058
124100     PERFORM                                                      12400058
124200         WITH TEST AFTER                                          12410058
124300         VARYING PV-SQL-SUB                                       12420058
124400         FROM 1 BY 1                                              12430058
124500         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        12440058
124600            OR SQLCODE = ZERO                                     12450058
124700            OR SQLCODE = +100                                     12460058
124800                                                                  12470058
124900     EXEC SQL                                                     12480058
125000       SELECT WORKER_FIR_NAME,                                    12490058
125100              WORKER_LAST_NAME                                    12500058
125200         INTO :RSPBAR-WORKER-FIR-NAME,                            12510058
125300              :RSPBAR-WORKER-LAST-NAME                            12520058
125400         FROM TRSPBAR                                             12530058
125500        WHERE MDSEAR_DKEY = :MDSEAR-DKEY                          12540058
125600          AND RSPLVL_CDE  = 'BYR'                                 12550058
125700          AND OPERCO_NBR  = '03'                                  12560058
125800          AND WORKER_END_DTE > CURRENT DATE                       12570058
125900          AND WORKER_STRT_DTE < CURRENT DATE                      12580058
126000     END-EXEC                                                     12590058
126100         EVALUATE TRUE                                            12600058
126200             WHEN SQLCODE = ZERO                                  12610058
126300                  STRING RSPBAR-WORKER-FIR-NAME  DELIMITED BY ' ' 12620058
126400                  ' '                     DELIMITED BY SIZE       12630058
126500                  RSPBAR-WORKER-LAST-NAME DELIMITED BY SIZE       12640058
126600                          INTO HL2-BYR-NAME                       12650058
126700             WHEN SQLCODE = -904                                  12660058
126800             WHEN SQLCODE = -913                                  12670058
126900             WHEN SQLCODE = +100                                  12680058
127000                 CONTINUE                                         12690058
127100             WHEN SQLWARN0 NOT = SPACES                           12700058
127200             WHEN SQLCODE  NOT = ZERO                             12710058
127300                  PERFORM Z999-SQL-ABEND                          12720058
127400         END-EVALUATE                                             12730058
127500     END-PERFORM.                                                 12740058
127600*                                                                 12750058
127700     IF PV-SQL-SUB > PC-MAX-RETRIES                               12760058
127800        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                    12770058
127900                                   TO PV-DB2-OPER-ATTEMPTED       12780058
128000        PERFORM Z999-SQL-ABEND                                    12790058
128100     END-IF.                                                      12800058
128200*                                                                 12810058
128300***************************************************************** 12820058
128400*                                                                 12830058
128500*  OBTAIN THE NUMBER OF STORES ASSOCIATED WITH AN ITEM            12840058
128600*                                                                 12850058
128700***************************************************************** 12860058
128800 D800-GET-STORE-COUNT.                                            12870058
128900     MOVE 'D800-GET-STORE-COUNT'   TO PV-PARAGRAPH-NAME.          12880058
129000     MOVE 'SELECT FOR STORE COUNT' TO PV-DB2-OPER-ATTEMPTED.      12890058
129100     PERFORM                                                      12900058
129200         WITH TEST AFTER                                          12910058
129300         VARYING PV-SQL-SUB                                       12920058
129400         FROM 1 BY 1                                              12930058
129500         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        12940058
129600            OR SQLCODE = ZERO                                     12950058
129700            OR SQLCODE = +100                                     12960058
129800                                                                  12970058
129900         EXEC SQL                                                 12980058
130000         SELECT COUNT (DISTINCT A.STR_NBR)                        12990058
130100           INTO :PV-TOT-STORES-FOR-ITEM                           13000058
130200           FROM TMRITST A,                                        13010058
130300                TSKST B,                                          13020063
130400                XMT_LOC C                                         13030063
130510          WHERE A.ITEM_NBR   = :PV-ITEM-NBR                       13042064
130600            AND A.STR_NBR    > 0                                  13050058
130700            AND B.ITEM_NMBR  = A.ITEM_NBR                         13060058
130800            AND B.LOC_NBR    = A.STR_NBR                          13070058
130900            AND A.FT_CDE    <> 'X'                                13080058
131000            AND C.LOC_NBR    = A.STR_NBR                          13101063
131100            AND C.E_BUS_IND  = 'N'                                13102063
131200         END-EXEC                                                 13103063
131300         EVALUATE TRUE                                            13120058
131400             WHEN SQLCODE = ZERO                                  13130058
131500             WHEN SQLCODE = -904                                  13140058
131600             WHEN SQLCODE = -913                                  13150058
131700                 CONTINUE                                         13160058
131800             WHEN SQLCODE = +100                                  13170058
131900                  SET EOF-STORE-CURSOR TO TRUE                    13180058
132000             WHEN SQLWARN0 NOT = SPACES                           13190058
132100             WHEN SQLCODE  NOT = ZERO                             13200058
132200                  PERFORM Z999-SQL-ABEND                          13210058
132300         END-EVALUATE                                             13220058
132400     END-PERFORM.                                                 13230058
132500*                                                                 13240058
132600     IF PV-SQL-SUB > PC-MAX-RETRIES                               13250058
132700        MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'              13260058
132800                                   TO PV-DB2-OPER-ATTEMPTED       13270058
132900        PERFORM Z999-SQL-ABEND                                    13280058
133000     END-IF.                                                      13290058
133100*                                                                 13300058
133200***************************************************************** 13310058
133300*                                                                 13320058
133400*  AT THE STYLE/COLOR LEVEL (INFOREM ITEMS ONLY) OBTAIN:          13330058
133500*  -- AVERAGE OSTRAT                                              13340058
133600*  -- TOTAL CSTOCK                                                13350058
133700*  -- NUMBER OF SKU/STORE COMBINATIONS                            13360058
133800*  -- NUMBER OF DISTINCT STORE NUMBERS                            13370058
133900*                                                                 13380058
134000***************************************************************** 13390058
134100 E200-GET-OSTRAT-QTY.                                             13400058
134200     MOVE 'E200-GET-OSTRAT-QTY'   TO PV-PARAGRAPH-NAME.           13410058
134300     MOVE 'SELECT FOR OSTRAT QTY' TO PV-DB2-OPER-ATTEMPTED.       13420058
134310                                                                          
134320     MOVE PV-DEPT-NBR             TO NI-DEPT-X-3.                         
134330     MOVE NI-DEPT-9-3             TO NI-DEPT-9-4.                         
134340     MOVE PV-CLASS                TO NI-SUB-CLASS-X-2.                    
134350     MOVE NI-SUB-CLASS-9-2        TO NI-SUB-CLASS-9-4.                    
134360                                                                          
134400     PERFORM                                                      13430058
134500         WITH TEST AFTER                                          13440058
134600         VARYING PV-SQL-SUB                                       13450058
134700         FROM 1 BY 1                                              13460058
134800         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        13470058
134900            OR SQLCODE = ZERO                                     13480058
135000            OR SQLCODE = +100                                     13490058
135100                                                                  13500058
135200         EXEC SQL                                                 13510058
135300           SELECT AVG(B.OSTRAT_QTY),                              13520058
135400                  SUM(B.CSTOCK_QTY),                              13530058
135500                  COUNT (*),                                      13540058
135600                  COUNT (DISTINCT B.STR_NBR)                      13550058
135700             INTO :PV-AVG-OSTRAT:PV-NULL-IND-OSTRAT,              13560058
135800                  :PV-TOTAL-CSTOCK:PV-NULL-IND-CSTOCK,            13570058
135900                  :PV-SKU-STORE-COMBOS,                           13580058
136000                  :PV-TOTAL-STORES                                13590058
136100             FROM TSK     A,                                      13600058
136200                  TMRITST B,                                      13610058
136300                  TMRITEM C,                                      13620058
136310                  TSKST   D,                                      13620058
136500                  TSKXREF F                                       13630058
136600            WHERE F.DEPT              = :NI-DEPT-9-4              13640058
136700              AND F.SUBCLASS          = :NI-SUB-CLASS-9-4         13650058
136800              AND A.LONG_VENDOR_STYLE = :PV-VENDOR-STYLE                58
136900              AND A.LONG_COLOR_DESC   = :PV-COLOR-DESC                  58
137000              AND F.ITM_NBR   = A.ITEM_NMBR                       13680058
137010              AND A.ITEM_NMBR = B.ITEM_NBR                        13680058
137100              AND A.ITEM_NMBR = C.ITEM_NBR                        13690058
137200              AND B.ITEM_NBR  = D.ITEM_NMBR                       13700058
137300              AND B.STR_NBR   = D.LOC_NBR                         13710058
137601              AND ((C.RT_NBR >= 4 AND C.RT_DAY_NBR > 0) OR                
137602                   (C.RT_NBR = 4 AND C.RT_DAY_NBR = 0))                   
137610              AND B.STR_NBR   > 0                                       58
137700              AND B.FT_CDE    <> 'X'                              13750058
137730              AND B.STR_NBR NOT IN (                                      
137740                  SELECT LOC_NBR                                          
137750                   FROM XMT_LOC                                           
137760                  WHERE E_BUS_IND   = 'Y'                                 
137780                    AND LOC_TYP_CDE = :PC-DS)                             
138000         END-EXEC                                                 13774058
138100         EVALUATE TRUE                                            13775058
138200             WHEN SQLCODE = ZERO                                  13776058
138300             WHEN SQLCODE = -904                                  13777058
138400             WHEN SQLCODE = -913                                  13778058
138500             WHEN SQLCODE = +100                                  13779058
138600                  CONTINUE                                        13780058
138700             WHEN SQLWARN0 NOT = SPACES                           13790058
138800             WHEN SQLCODE  NOT = ZERO                             13800058
138900                  PERFORM Z999-SQL-ABEND                          13810058
139000         END-EVALUATE                                             13820058
139100     END-PERFORM.                                                 13830058
139200*                                                                 13840058
139300     IF PV-SQL-SUB > PC-MAX-RETRIES                               13850058
139400        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                    13860058
139500                                   TO PV-DB2-OPER-ATTEMPTED       13870058
139600        PERFORM Z999-SQL-ABEND                                    13880058
139700     END-IF.                                                      13890058
139800*                                                                 13900058
139900***************************************************************** 13910058
140000*                                                                 13920058
140100*  GET THE AVERAGE ONORDER QUANTITY FOR A STYLE/COLOR (INFOREM    13930058
140200*  ITEMS ONLY)                                                    13940058
140300*                                                                 13950058
140400***************************************************************** 13960058
140500 E300-GET-ONORDER-QTY.                                            13970058
140600                                                                  13980058
140700     MOVE 'E300-GET-ONORDER-QTY' TO PV-PARAGRAPH-NAME.            13990058
140800     MOVE 'SELECT FOR ONORDER '  TO PV-DB2-OPER-ATTEMPTED.        14000058
140801                                                                          
140810     MOVE PV-DEPT-NBR             TO NI-DEPT-X-3.                         
140820     MOVE NI-DEPT-9-3             TO NI-DEPT-9-4.                         
140822                                                                          
140830     MOVE PV-CLASS                TO NI-SUB-CLASS-X-2.                    
140840     MOVE NI-SUB-CLASS-9-2        TO NI-SUB-CLASS-9-4.                    
140842                                                                          
140900     PERFORM                                                      14010058
141000         WITH TEST AFTER                                          14020058
141100         VARYING PV-SQL-SUB                                       14030058
141200         FROM 1 BY 1                                              14040058
141300         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        14050058
141400            OR SQLCODE = ZERO                                     14060058
141500            OR SQLCODE = +100                                     14070058
141600                                                                  14080058
141700         EXEC SQL                                                 14090058
141800           SELECT SUM(A.ONORD_UNT_QTY)                            14100058
141900             INTO :PV-SUM-ONORDER:PV-NULL-IND-ONORDER             14110058
142000             FROM TSKSTOO A,                                      14120058
142100                  TSK     B,                                      14130058
142200                  TMRITEM C,                                      14140058
142300                  TMRITST D,                                      14150058
142400                  TSKXREF E                                       14150058
142500            WHERE E.DEPT              = :NI-DEPT-9-4              14160058
142600              AND E.SUBCLASS          = :NI-SUB-CLASS-9-4         14170058
142700              AND B.LONG_VENDOR_STYLE = :PV-VENDOR-STYLE                58
142800              AND B.LONG_COLOR_DESC   = :PV-COLOR-DESC                  58
143200              AND B.ITEM_NMBR   = C.ITEM_NBR                      14230058
143300              AND B.ITEM_NMBR   = D.ITEM_NBR                      14240058
143310              AND B.ITEM_NMBR   = E.ITM_NBR                             58
143320              AND B.ITEM_NMBR   = A.ITM_NBR                             58
143400              AND D.STR_NBR     = A.STR_NBR                       14250058
143700              AND ((C.RT_NBR >= 4 AND C.RT_DAY_NBR > 0) OR        14260058
143800                   (C.RT_NBR = 4 AND C.RT_DAY_NBR = 0))           14270058
143900              AND A.STR_NBR > 0                                   14280058
144000              AND D.FT_CDE  <> 'X'                                14290058
144010              AND D.STR_NBR NOT IN (                              14300058
144020                            SELECT LOC_NBR                        14310058
144030                              FROM XMT_LOC                        14320058
144040                             WHERE E_BUS_IND   = 'Y'              14330058
144050                               AND LOC_TYP_CDE = :PC-DS)          14340058
144100         END-EXEC                                                 14350058
144200         EVALUATE TRUE                                            14360058
144300             WHEN SQLCODE = ZERO                                  14370058
144400             WHEN SQLCODE = -904                                  14380058
144500             WHEN SQLCODE = -913                                  14390058
144600             WHEN SQLCODE = +100                                  14400058
144700                 CONTINUE                                         14410058
144800             WHEN SQLWARN0 NOT = SPACES                           14420058
144900             WHEN SQLCODE  NOT = ZERO                             14430058
145000                  PERFORM Z999-SQL-ABEND                          14440058
145100         END-EVALUATE                                             14450058
145200     END-PERFORM.                                                 14460058
145300                                                                  14470058
145400     IF PV-SQL-SUB > PC-MAX-RETRIES                               14480058
145500        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                    14490058
145600                                   TO PV-DB2-OPER-ATTEMPTED       14500058
145700        PERFORM Z999-SQL-ABEND                                    14510058
145800     ELSE                                                         14520058
145900        IF SQLCODE = ZERO                                         14530058
146000           IF (PV-NULL-IND-ONORDER = -1) OR                       14540058
146100              (PV-SKU-STORE-COMBOS = ZERO)                        14550058
146200              MOVE ZERO TO PV-AVG-ONORDER                         14560058
146300           ELSE                                                   14570058
146400              DIVIDE PV-SUM-ONORDER BY PV-SKU-STORE-COMBOS        14580058
146500                  GIVING PV-HOLD-AVG-OO                           14590058
146600              COMPUTE PV-AVG-ONORDER ROUNDED = PV-HOLD-AVG-OO     14600058
146700           END-IF                                                 14610058
146800        END-IF                                                    14620058
146900     END-IF.                                                      14630058
147000*                                                                 14640058
147100***************************************************************** 14650058
147200*                                                                 14660058
147300*  FOR A VALID STORE NUMBER IN THE INTERNAL STORE TABLE,          14670058
147400*  GET THE NUMBER OF ITEMS IN THE STYLE/COLOR FOR THAT STORE.     14680058
147500*  THEN CALCULATE THE STORE'S SERVICE LEVEL.  IF BELOW THE SET    14690058
147600*  LIMIT, PUT OUT AN EXTRACT RECORD.                              14700058
147700*                                                                 14710058
147800***************************************************************** 14720058
147900 E400-CALC-STORE-SVC-LEVELS.                                      14730058
148000*                                                                 14740058
148100     IF ST-VALID-STORE-FLAG (PV-ST-SUB) = PC-Y                    14750058
148200        MOVE ZERO          TO PV-TOT-ITEMS-FOR-STORE              14760058
148300        MOVE PV-ST-SUB     TO MRITST-STR-NBR                      14770058
148500        PERFORM F300-GET-TOTAL-ITEMS                              14790058
148600                                                                  14800058
148700        IF PV-TOT-ITEMS-FOR-STORE GREATER THAN ZERO               14810058
148800                                                                  14820058
148900           IF ST-OUT-OF-INV-ITEMS (PV-ST-SUB) = ZERO              14830058
149000              MOVE PC-100 TO PV-SVC-LEVEL-PCT                     14840058
149100           ELSE                                                   14850058
149200              SUBTRACT ST-OUT-OF-INV-ITEMS (PV-ST-SUB)            14860058
149300                  FROM PV-TOT-ITEMS-FOR-STORE                     14870058
149400                GIVING PV-NBR-INSTOCK                             14880058
149410              IF PV-NBR-INSTOCK < ZERO                            14890058
149420                 SET INVALID-SVC-LEVEL  TO TRUE                   14900058
149430              ELSE                                                14910058
149440                 SET VALID-SVC-LEVEL    TO TRUE                   14920058
149450              END-IF                                              14930058
149500              COMPUTE PV-HOLD-SVC-LVL =                           14940058
149600                  (PV-NBR-INSTOCK / PV-TOT-ITEMS-FOR-STORE) * 100 14950058
149700              COMPUTE PV-SVC-LEVEL-PCT ROUNDED =                  14960058
149701                   PV-HOLD-SVC-LVL                                14970058
149800              MOVE ZERO TO PV-NBR-INSTOCK                         14980058
149900           END-IF                                                 14990058
150000*                                                                 15000058
150100           IF PV-SVC-LEVEL-PCT < PC-STORE-SVC-LEVEL-LIMIT         15010058
150200              ADD PC-1           TO PV-STORES-BELOW               15020058
150300              MOVE PV-ST-SUB     TO MR031-STORE-NBR               15030058
150400              MOVE SPACES        TO MR031-SKU                           58
150500              MOVE ZERO          TO MR031-ITEM-NBR                15050058
150600              PERFORM F200-CREATE-EXTRACT-RECORD                  15060058
150700           END-IF                                                 15070058
150800        END-IF                                                    15080058
150900                                                                  15090058
151000        MOVE ZERO TO ST-OUT-OF-INV-ITEMS (PV-ST-SUB)              15100058
151100     END-IF.                                                      15110058
151200*                                                                 15120058
151300***************************************************************** 15130058
151400 E500-FORMAT-DETAIL-LINE.                                         15140058
151500*                                                                 15150058
151600     MOVE PV-CLASS         TO DL1-CLASS.                          15160058
151700     MOVE PV-VENDOR-STYLE  TO DL1-STYLE.                          15170058
151800     MOVE PV-ITEM-DESC     TO DL1-DESC.                           15180058
151900     MOVE PV-COLOR-DESC    TO DL1-COLOR.                          15190058
152000     MOVE PV-TOTAL-STORES  TO DL1-TOT-STORES.                     15200058
152100     MOVE PV-TOTAL-SKUS    TO DL1-TOT-SKUS.                       15210058
152200     MOVE PV-AVG-ONHAND    TO DL1-AVG-OH.                         15220058
152300     MOVE PV-AVG-ONORDER   TO DL1-AVG-OO.                         15230058
152400     MOVE PV-TOTAL-CSTOCK  TO DL1-CSTOCK.                         15240058
152410     IF INVALID-SVC-LEVEL                                         15241058
152420        MOVE PC-INVALID-SVC-LEVEL TO DL1-SVC-LEVEL-X              15242058
152430     ELSE                                                         15243058
152500        MOVE PV-SVC-LEVEL-PCT     TO DL1-SVC-LEVEL                15244058
152510     END-IF.                                                      15245058
152600     MOVE PV-SKUS-BELOW    TO DL1-SKUS-BELOW.                     15246058
152700     MOVE PV-STORES-BELOW  TO DL1-STORES-BELOW.                   15247058
152800     MOVE PV-AVG-OSTRAT    TO DL1-AVG-OSTRAT.                     15248058
152900     MOVE PV-LEAD-TIME     TO DL1-LEAD-TIME.                      15249058
153000*                                                                 15250058
153100     PERFORM Z300-WRITE-DETAIL-LINE.                              15260058
153200*                                                                 15270058
153300     MOVE SPACE TO DL1-ASTERISK.                                  15280058
153400*                                                                 15290058
153500***************************************************************** 15300058
153600*                                                                 15310058
153700*  GET AVERAGE ONHAND QUANTITY FOR THE STYLE/COLOR (INFOREM ITEMS 15320058
153800*  ONLY)                                                          15330058
153900*                                                                 15340058
154000***************************************************************** 15350058
154100 E600-GET-ONHAND-QTY.                                             15360058
154200     MOVE 'E600-GET-ONHAND-QTY'   TO PV-PARAGRAPH-NAME.           15370058
154300     MOVE 'SELECT FOR ONHAND QTY' TO PV-DB2-OPER-ATTEMPTED.       15380058
154301                                                                          
154310     MOVE PV-DEPT-NBR             TO NI-DEPT-X-3.                         
154320     MOVE NI-DEPT-9-3             TO NI-DEPT-9-4.                         
154330     MOVE PV-CLASS                TO NI-SUB-CLASS-X-2.                    
154340     MOVE NI-SUB-CLASS-9-2        TO NI-SUB-CLASS-9-4.                    
154350                                                                          
154400     PERFORM                                                      15390058
154500         WITH TEST AFTER                                          15400058
154600         VARYING PV-SQL-SUB                                       15410058
154700         FROM 1 BY 1                                              15420058
154800         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        15430058
154900            OR SQLCODE = ZERO                                     15440058
155000            OR SQLCODE = +100                                     15450058
155100                                                                  15460058
155200         EXEC SQL                                                 15470058
155300           SELECT DECIMAL((AVG(B.ONHAND_QTY)+.05),6,1)            15480058
155400             INTO :PV-AVG-ONHAND:PV-NULL-IND-ONHAND               15490058
155500             FROM TSK     A,                                      15500058
155600                  TSKST   B,                                      15510058
155700                  TMRITEM C,                                      15520058
155800                  TMRITST D,                                      15530058
155900                  TSKXREF E                                       15530058
156000            WHERE E.DEPT              = :NI-DEPT-9-4                    58
156100              AND E.SUBCLASS          = :NI-SUB-CLASS-9-4               58
156200              AND A.LONG_VENDOR_STYLE = :PV-VENDOR-STYLE                58
156300              AND A.LONG_COLOR_DESC   = :PV-COLOR-DESC                  58
156400              AND A.ITEM_NMBR = B.ITEM_NMBR                       15580058
156500              AND A.ITEM_NMBR = C.ITEM_NBR                        15590058
156600              AND A.ITEM_NMBR = D.ITEM_NBR                        15600058
156610              AND A.ITEM_NMBR = E.ITM_NBR                               58
156700              AND ((C.RT_NBR >= 4 AND C.RT_DAY_NBR > 0) OR        15610058
156800                   (C.RT_NBR = 4 AND C.RT_DAY_NBR = 0))           15620058
156900              AND B.LOC_NBR > 0                                   15630058
157000              AND B.LOC_NBR = D.STR_NBR                           15640058
157100              AND D.FT_CDE <> 'X'                                 15650058
157310              AND D.STR_NBR NOT IN (                              15660058
157320                            SELECT LOC_NBR                        15670058
157330                              FROM XMT_LOC                        15680058
157340                             WHERE E_BUS_IND   = 'Y'              15690058
157350                               AND LOC_TYP_CDE = :PC-DS)          15700058
157400         END-EXEC                                                 15710058
157500         EVALUATE TRUE                                            15720058
157600             WHEN SQLCODE = ZERO                                  15730058
157700             WHEN SQLCODE = -904                                  15740058
157800             WHEN SQLCODE = -913                                  15750058
157900             WHEN SQLCODE = +100                                  15760058
158000                 CONTINUE                                         15770058
158100             WHEN SQLWARN0 NOT = SPACES                           15780058
158200             WHEN SQLCODE  NOT = ZERO                             15790058
158300                  PERFORM Z999-SQL-ABEND                          15800058
158400         END-EVALUATE                                             15810058
158500     END-PERFORM.                                                 15820058
158600*                                                                 15830058
158700     IF PV-SQL-SUB > PC-MAX-RETRIES                               15840058
158800        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                    15850058
158900                                   TO PV-DB2-OPER-ATTEMPTED       15860058
159000        PERFORM Z999-SQL-ABEND                                    15870058
159100     END-IF.                                                      15880058
159200***************************************************************** 15890058
159300*                                                                 15900058
159400*  AT THE SUBCLASS LEVEL (INFOREM ITEMS ONLY) OBTAIN:             15910058
159500*  -- AVERAGE OSTRAT                                              15920058
159600*  -- TOTAL CSTOCK                                                15930058
159700*  -- NUMBER OF SKU/STORE COMBINATIONS                            15940058
159800*  -- NUMBER OF DISTINCT STORE NUMBERS                            15950058
159900*                                                                 15960058
160000***************************************************************** 15970058
160100 E700-GET-SUBCL-OSTRAT-QTY.                                       15980058
160200     MOVE 'E700-GET-SUBCL-OSTRAT-QTY' TO PV-PARAGRAPH-NAME.       15990058
160300     MOVE 'SELECT FOR OSTRAT QTY'     TO PV-DB2-OPER-ATTEMPTED.   16000058
160301                                                                          
160310     MOVE PV-DEPT-NBR             TO NI-DEPT-X-3.                         
160320     MOVE NI-DEPT-9-3             TO NI-DEPT-9-4.                         
160330     MOVE PV-CLASS                TO NI-SUB-CLASS-X-2.                    
160340     MOVE NI-SUB-CLASS-9-2        TO NI-SUB-CLASS-9-4.                    
160350                                                                          
160400     PERFORM                                                      16010058
160500         WITH TEST AFTER                                          16020058
160600         VARYING PV-SQL-SUB                                       16030058
160700         FROM 1 BY 1                                              16040058
160800         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        16050058
160900            OR SQLCODE = ZERO                                     16060058
161000            OR SQLCODE = +100                                     16070058
161100                                                                  16080058
161200         EXEC SQL                                                 16090058
161300           SELECT AVG(B.OSTRAT_QTY),                              16100058
161400                  SUM(B.CSTOCK_QTY)                               16110058
161500             INTO :PV-AVG-OSTRAT:PV-NULL-IND-OSTRAT,              16120058
161600                  :PV-TOTAL-CSTOCK:PV-NULL-IND-CSTOCK             16130058
161700             FROM TSK     A,                                      16140058
161800                  TMRITST B,                                      16150058
161900                  TMRITEM C,                                      16160058
162000                  TSKST   D,                                      16170058
162100                  TSKXREF E                                       16170058
162200            WHERE E.DEPT      = :NI-DEPT-9-4                            58
162300              AND E.SUBCLASS  = :NI-SUB-CLASS-9-4                       58
162400              AND A.ITEM_NMBR = B.ITEM_NBR                        16200058
162500              AND A.ITEM_NMBR = C.ITEM_NBR                        16210058
162600              AND A.ITEM_NMBR = D.ITEM_NMBR                       16220058
162610              AND A.ITEM_NMBR = E.ITM_NBR                               58
162700              AND B.STR_NBR   = D.LOC_NBR                         16230058
162800              AND ((C.RT_NBR >= 4 AND C.RT_DAY_NBR > 0) OR        16240058
162900                   (C.RT_NBR  = 4 AND C.RT_DAY_NBR = 0))                58
163000              AND B.STR_NBR > 0                                   16260058
163100              AND B.FT_CDE  <> 'X'                                16270058
163310              AND B.STR_NBR NOT IN (                              16280058
163320                            SELECT LOC_NBR                        16290058
163330                              FROM XMT_LOC                        16300058
163340                             WHERE E_BUS_IND   = 'Y'              16310058
163350                               AND LOC_TYP_CDE = :PC-DS)          16320058
163400         END-EXEC                                                 16330058
163500         EVALUATE TRUE                                            16340058
163600             WHEN SQLCODE = ZERO                                  16350058
163700             WHEN SQLCODE = -904                                  16360058
163800             WHEN SQLCODE = -913                                  16370058
163900             WHEN SQLCODE = +100                                  16380058
164000                  CONTINUE                                        16390058
164100             WHEN SQLWARN0 NOT = SPACES                           16400058
164200             WHEN SQLCODE  NOT = ZERO                             16410058
164300                  PERFORM Z999-SQL-ABEND                          16420058
164400         END-EVALUATE                                             16430058
164500     END-PERFORM.                                                 16440058
164600*                                                                 16450058
164700     IF PV-SQL-SUB > PC-MAX-RETRIES                               16460058
164800        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                    16470058
164900                                   TO PV-DB2-OPER-ATTEMPTED       16480058
165000        PERFORM Z999-SQL-ABEND                                    16490058
165100     END-IF.                                                      16500058
165200*                                                                 16510058
165300***************************************************************** 16520058
165400*                                                                 16530058
165500*  GET THE AVERAGE ONORDER QUANTITY FOR A SUBCLASS (INFOREM       16540058
165600*  ITEMS ONLY)                                                    16550058
165700*                                                                 16560058
165800***************************************************************** 16570058
165900 E800-GET-SUBCL-ONORDER-QTY.                                      16580058
166000                                                                  16590058
166100     MOVE 'E800-GET-SUBCL-ONORDER-QTY' TO PV-PARAGRAPH-NAME.      16600058
166200     MOVE 'SELECT FOR ONORDER '        TO PV-DB2-OPER-ATTEMPTED.  16610058
166210                                                                          
166220     MOVE PV-DEPT-NBR             TO NI-DEPT-X-3.                         
166230     MOVE NI-DEPT-9-3             TO NI-DEPT-9-4.                         
166232                                                                          
166240     MOVE PV-CLASS                TO NI-SUB-CLASS-X-2.                    
166250     MOVE NI-SUB-CLASS-9-2        TO NI-SUB-CLASS-9-4.                    
166260                                                                          
166300     PERFORM                                                      16620058
166400         WITH TEST AFTER                                          16630058
166500         VARYING PV-SQL-SUB                                       16640058
166600         FROM 1 BY 1                                              16650058
166700         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        16660058
166800            OR SQLCODE = ZERO                                     16670058
166900            OR SQLCODE = +100                                     16680058
167000                                                                  16690058
167100         EXEC SQL                                                 16700058
167200           SELECT SUM(A.ONORD_UNT_QTY)                            16710058
167300             INTO :PV-SUM-ONORDER:PV-NULL-IND-ONORDER             16720058
167400             FROM TSKSTOO A,                                      16730058
167500                  TSK     B,                                      16740058
167600                  TMRITEM C,                                      16750058
167700                  TMRITST D,                                      16760058
167800                  XMT_LOC E,                                      16770058
167810                  TSKXREF F                                       16770058
167900            WHERE F.DEPT        = :NI-DEPT-9-4                          58
168000              AND F.SUBCLASS    = :NI-SUB-CLASS-9-4                     58
168400              AND B.ITEM_NMBR   = C.ITEM_NBR                      16830058
168500              AND B.ITEM_NMBR   = D.ITEM_NBR                      16840058
168510              AND B.ITEM_NMBR   = F.ITM_NBR                             58
168520              AND A.ITM_NBR     = F.ITM_NBR                             58
168600              AND ((C.RT_NBR >= 4 AND C.RT_DAY_NBR > 0) OR        16850058
168700                   (C.RT_NBR = 4 AND C.RT_DAY_NBR = 0))           16860058
168800              AND A.STR_NBR > 0                                   16870058
168900              AND E.LOC_NBR     = A.STR_NBR                       16880058
169000              AND E.LOC_NBR     = D.STR_NBR                       16890058
169100              AND E.E_BUS_IND   = 'N'                             16900058
169300              AND D.FT_CDE  <> 'X'                                16910058
169400         END-EXEC                                                 16920058
169500         EVALUATE TRUE                                            16930058
169600             WHEN SQLCODE = ZERO                                  16940058
169700             WHEN SQLCODE = -904                                  16950058
169800             WHEN SQLCODE = -913                                  16960058
169900             WHEN SQLCODE = +100                                  16970058
170000                 CONTINUE                                         16980058
170100             WHEN SQLWARN0 NOT = SPACES                           16990058
170200             WHEN SQLCODE  NOT = ZERO                             17000058
170300                  PERFORM Z999-SQL-ABEND                          17010058
170400         END-EVALUATE                                             17020058
170500     END-PERFORM.                                                 17030058
170600                                                                  17040058
170700     IF PV-SQL-SUB > PC-MAX-RETRIES                               17050058
170800        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                    17060058
170900                                   TO PV-DB2-OPER-ATTEMPTED       17070058
171000        PERFORM Z999-SQL-ABEND                                    17080058
171100     ELSE                                                         17090058
171200        IF SQLCODE = ZERO                                         17100058
171300           IF (PV-NULL-IND-ONORDER = -1) OR                       17110058
171400              (PV-SC-COMBOS = ZERO)                               17120058
171500              MOVE ZERO TO PV-AVG-ONORDER                         17130058
171600           ELSE                                                   17140058
171700              DIVIDE PV-SUM-ONORDER BY PV-SC-COMBOS               17150058
171800                  GIVING PV-HOLD-AVG-OO                           17160058
171900              COMPUTE PV-AVG-ONORDER ROUNDED = PV-HOLD-AVG-OO     17170058
172000           END-IF                                                 17180058
172100        END-IF                                                    17190058
172200     END-IF.                                                      17200058
172300*                                                                 17210058
172400***************************************************************** 17220058
172500*                                                                 17230058
172600*  GET AVERAGE ONHAND QUANTITY FOR THE SUBCLASS (INFOREM ITEMS    17240058
172700*  ONLY)                                                          17250058
172800*                                                                 17260058
172900***************************************************************** 17270058
173000 E900-GET-SUBCL-ONHAND-QTY.                                       17280058
173100     MOVE 'E900-GET-SUBCL-ONHAND-QTY' TO PV-PARAGRAPH-NAME.       17290058
173200     MOVE 'SELECT FOR ONHAND QTY'     TO PV-DB2-OPER-ATTEMPTED.   17300058
173210                                                                          
173220     MOVE PV-DEPT-NBR             TO NI-DEPT-X-3.                         
173230     MOVE NI-DEPT-9-3             TO NI-DEPT-9-4.                         
173240     MOVE PV-CLASS                TO NI-SUB-CLASS-X-2.                    
173250     MOVE NI-SUB-CLASS-9-2        TO NI-SUB-CLASS-9-4.                    
173260                                                                          
173300     PERFORM                                                      17310058
173400         WITH TEST AFTER                                          17320058
173500         VARYING PV-SQL-SUB                                       17330058
173600         FROM 1 BY 1                                              17340058
173700         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        17350058
173800            OR SQLCODE = ZERO                                     17360058
173900            OR SQLCODE = +100                                     17370058
174000                                                                  17380058
174100         EXEC SQL                                                 17390058
174200           SELECT DECIMAL((AVG(B.ONHAND_QTY)+.05),6,1)            17400058
174300             INTO :PV-AVG-ONHAND:PV-NULL-IND-ONHAND               17410058
174400             FROM TSK     A,                                      17420058
174500                  TSKST   B,                                      17430058
174600                  TMRITEM C,                                      17440058
174700                  TMRITST D,                                      17450058
174800                  TSKXREF E                                       17450058
174900            WHERE E.DEPT      = :NI-DEPT-9-4                            58
175000              AND E.SUBCLASS  = :NI-SUB-CLASS-9-4                       58
175100              AND A.ITEM_NMBR = B.ITEM_NMBR                       17480058
175200              AND A.ITEM_NMBR = C.ITEM_NBR                        17490058
175300              AND A.ITEM_NMBR = D.ITEM_NBR                        17500058
175310              AND A.ITEM_NMBR = E.ITM_NBR                               58
175400              AND ((C.RT_NBR >= 4 AND C.RT_DAY_NBR > 0) OR        17510058
175500                   (C.RT_NBR = 4 AND C.RT_DAY_NBR = 0))           17520058
175600              AND B.LOC_NBR     = D.STR_NBR                       17530058
175700              AND B.LOC_NBR    > 0                                17540058
175800              AND D.FT_CDE     <> 'X'                             17550058
175900              AND D.STR_NBR NOT IN (                              17560058
175910                            SELECT LOC_NBR                        17570058
175920                              FROM XMT_LOC                        17580058
176000                             WHERE E_BUS_IND   = 'Y'              17590058
176010                               AND LOC_TYP_CDE = :PC-DS)          17600058
176100         END-EXEC                                                 17610058
176200         EVALUATE TRUE                                            17620058
176300             WHEN SQLCODE = ZERO                                  17630058
176400             WHEN SQLCODE = -904                                  17640058
176500             WHEN SQLCODE = -913                                  17650058
176600             WHEN SQLCODE = +100                                  17660058
176700                 CONTINUE                                         17670058
176800             WHEN SQLWARN0 NOT = SPACES                           17680058
176900             WHEN SQLCODE  NOT = ZERO                             17690058
177000                  PERFORM Z999-SQL-ABEND                          17700058
177100         END-EVALUATE                                             17710058
177200     END-PERFORM.                                                 17720058
177300*                                                                 17730058
177400     IF PV-SQL-SUB > PC-MAX-RETRIES                               17740058
177500        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                    17750058
177600                                   TO PV-DB2-OPER-ATTEMPTED       17760058
177700        PERFORM Z999-SQL-ABEND                                    17770058
177800     END-IF.                                                      17780058
177900*                                                                 17790058
178000***************************************************************** 17800058
178100 F100-FETCH-STORE-CURSOR.                                         17810058
178200     MOVE 'F100-FETCH-STORE-CSR' TO PV-PARAGRAPH-NAME.            17820058
178300     MOVE 'STORE CURSOR FETCH '  TO PV-DB2-OPER-ATTEMPTED.        17830058
178400     PERFORM                                                      17840058
178500         WITH TEST AFTER                                          17850058
178600         VARYING PV-SQL-SUB                                       17860058
178700         FROM 1 BY 1                                              17870058
178800         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        17880058
178900            OR SQLCODE = ZERO                                     17890058
179000            OR SQLCODE = +100                                     17900058
179100                                                                  17910058
179200         EXEC SQL                                                 17920058
179300             FETCH STORE_CSR                                      17930058
179400              INTO :XMT00001-LOC-NBR                              17940058
179500         END-EXEC                                                 17950058
179600         EVALUATE TRUE                                            17960058
179700             WHEN SQLCODE = ZERO                                  17970058
179800             WHEN SQLCODE = -904                                  17980058
179900             WHEN SQLCODE = -913                                  17990058
180000                 CONTINUE                                         18000058
180100             WHEN SQLCODE = +100                                  18010058
180200                 SET EOF-STORE-CURSOR TO TRUE                     18020058
180300             WHEN SQLWARN0 NOT = SPACES                           18030058
180400             WHEN SQLCODE  NOT = ZERO                             18040058
180500                  PERFORM Z999-SQL-ABEND                          18050058
180600         END-EVALUATE                                             18060058
180700     END-PERFORM.                                                 18070058
180800*                                                                 18080058
180900     IF PV-SQL-SUB > PC-MAX-RETRIES                               18090058
181000        MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'              18100058
181100                                   TO PV-DB2-OPER-ATTEMPTED       18110058
181200        PERFORM Z999-SQL-ABEND                                    18120058
181300     END-IF.                                                      18130058
181400*                                                                 18140058
181500*                                                                 18150058
181600***************************************************************** 18160058
181700 F200-CREATE-EXTRACT-RECORD.                                      18170058
181800     MOVE HL3-BG-NUMBER    TO MR031-BUSINESS-GROUP.               18180058
181900     MOVE HL3-BG-DESC      TO MR031-BUSINESS-GROUP-DESC.          18190058
182000     MOVE PV-DEPT-NBR      TO MR031-DEPT-NBR.                     18200058
182100     MOVE PV-CLASS         TO MR031-CLASS-NBR.                    18210058
182200     MOVE PV-VENDOR-STYLE  TO MR031-VENDOR-STYLE.                 18220058
182300     MOVE PV-ITEM-DESC     TO MR031-SKU-DESC.                     18230058
182400     MOVE PV-COLOR-DESC    TO MR031-COLOR-DESC.                   18240058
182500     MOVE PV-SVC-LEVEL-PCT TO MR031-SERVICE-LEVEL-PCT.            18250058
182600     MOVE HL2-BYR-NMBR     TO MR031-BUYER-NBR.                    18260058
182700     MOVE HL2-BYR-NAME     TO MR031-BUYER-NAME.                   18270058
182800*                                                                 18280058
182900     PERFORM Z700-WRITE-EXTRACT-RECORD.                           18290058
183000*                                                                 18300058
183100***************************************************************** 18310058
183200*                                                                 18320058
183300*  OBTAIN THE TOTAL NUMBER OF ITEMS IN A STYLE/COLOR FOR A        18330058
183400*  PARTICULAR STORE (INFOREM ITEMS ONLY)                          18340058
183500*                                                                 18350058
183600***************************************************************** 18360058
183700 F300-GET-TOTAL-ITEMS.                                            18370058
183800*                                                                 18380058
183900     MOVE 'F300-GET-TOTAL-ITEMS'    TO PV-PARAGRAPH-NAME.         18390058
184000     MOVE 'SELECT FOR TOTAL ITEMS ' TO PV-DB2-OPER-ATTEMPTED.     18400058
184001                                                                          
184010     MOVE PV-DEPT-NBR             TO NI-DEPT-X-3.                         
184020     MOVE NI-DEPT-9-3             TO NI-DEPT-9-4.                         
184021                                                                          
184030     MOVE PV-CLASS                TO NI-SUB-CLASS-X-2.                    
184040     MOVE NI-SUB-CLASS-9-2        TO NI-SUB-CLASS-9-4.                    
184050                                                                          
184100     PERFORM                                                      18410058
184200         WITH TEST AFTER                                          18420058
184300         VARYING PV-SQL-SUB                                       18430058
184400         FROM 1 BY 1                                              18440058
184500         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        18450058
184600            OR SQLCODE = ZERO                                     18460058
184700            OR SQLCODE = +100                                     18470058
184800                                                                  18480058
184900         EXEC SQL                                                 18490058
185000           SELECT COUNT (*)                                       18500058
185100             INTO :PV-TOT-ITEMS-FOR-STORE                         18510058
185200             FROM TMRITST A,                                      18520058
185300                  TSK     B,                                      18530058
185400                  TMRITEM C,                                      18540058
185410                  TSKXREF D                                       18540058
185500            WHERE A.STR_NBR           = :MRITST-STR-NBR           18550058
185600              AND D.DEPT              = :NI-DEPT-9-4              18560058
185700              AND D.SUBCLASS          = :NI-SUB-CLASS-9-4               58
185800              AND B.LONG_VENDOR_STYLE = :PV-VENDOR-STYLE                58
185900              AND B.LONG_COLOR_DESC   = :PV-COLOR-DESC                  58
186000              AND A.ITEM_NBR  = B.ITEM_NMBR                       18600058
186100              AND B.ITEM_NMBR = C.ITEM_NBR                        18610058
186110              AND B.ITEM_NMBR = D.ITM_NBR                               58
186200              AND ((C.RT_NBR >= 4 AND C.RT_DAY_NBR > 0) OR        18620058
186300                   (C.RT_NBR = 4 AND C.RT_DAY_NBR = 0))           18630058
186400         END-EXEC                                                 18640058
186500         EVALUATE TRUE                                            18650058
186600             WHEN SQLCODE = ZERO                                  18660058
186700             WHEN SQLCODE = -904                                  18670058
186800             WHEN SQLCODE = -913                                  18680058
186900             WHEN SQLCODE = +100                                  18690058
187000                  CONTINUE                                        18700058
187100             WHEN SQLWARN0 NOT = SPACES                           18710058
187200             WHEN SQLCODE  NOT = ZERO                             18720058
187300                  PERFORM Z999-SQL-ABEND                          18730058
187400         END-EVALUATE                                             18740058
187500     END-PERFORM.                                                 18750058
187600*                                                                 18760058
187700     IF PV-SQL-SUB > PC-MAX-RETRIES                               18770058
187800        MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                    18780058
187900                                   TO PV-DB2-OPER-ATTEMPTED       18790058
188000        PERFORM Z999-SQL-ABEND                                    18800058
188100     END-IF.                                                      18810058
188200*                                                                 18820058
188300***************************************************************** 18830058
188400 T100-PRINT-SUBCLASS-TOTALS.                                      18840058
188500*                                                                 18850058
188600     IF NO-DETAIL-FOR-DEPT                                        18860058
188700        ADD PC-1 TO PV-LINE-CNT                                   18870058
188800     ELSE                                                         18880058
188900        ADD PC-5 TO PV-LINE-CNT                                   18890058
189000     END-IF                                                       18900058
189100*                                                                 18910058
189200     IF PV-LINE-CNT > PC-MAX-LINES                                18920058
189300        PERFORM Z400-PRINT-REPORT-HEADERS                         18930058
189400        IF NO-DETAIL-FOR-DEPT                                     18940058
189500           ADD PC-1 TO PV-LINE-CNT                                18950058
189600        ELSE                                                      18960058
189700           ADD PC-5 TO PV-LINE-CNT                                18970058
189800        END-IF                                                    18980058
189900     END-IF                                                       18990058
190000*                                                                 19000058
190100     IF PRINT-DETAIL-FOR-DEPT                                     19010058
190200        WRITE PRINT-LINE FROM DASHED-LINE                         19020058
190300            AFTER ADVANCING PC-1                                  19030058
190400     END-IF                                                       19040058
190500*                                                                 19050058
190600     WRITE PRINT-LINE FROM TOTAL-LINE-1                           19060058
190700         AFTER ADVANCING PC-1.                                    19070058
190800*                                                                 19080058
190900     IF PRINT-DETAIL-FOR-DEPT                                     19090058
191000        WRITE PRINT-LINE FROM DASHED-LINE                         19100058
191100            AFTER ADVANCING PC-1                                  19110058
191200        WRITE PRINT-LINE FROM DASHED-LINE                         19120058
191300            AFTER ADVANCING PC-1                                  19130058
191400        WRITE PRINT-LINE FROM BLANK-LINE                          19140058
191500            AFTER ADVANCING PC-1                                  19150058
191600     END-IF.                                                      19160058
191700*                                                                 19170058
191800***************************************************************** 19180058
191900 T200-PRINT-MAJOR-CLASS-TOTALS.                                   19190058
192000*                                                                 19200058
192100     ADD PC-5 TO PV-LINE-CNT.                                     19210058
192200     IF PV-LINE-CNT > PC-MAX-LINES                                19220058
192300        PERFORM Z400-PRINT-REPORT-HEADERS                         19230058
192400        ADD PC-5 TO PV-LINE-CNT                                   19240058
192500     END-IF                                                       19250058
192600*                                                                 19260058
192700     IF NO-DETAIL-FOR-DEPT                                        19270058
192800        WRITE PRINT-LINE FROM DASHED-LINE                         19280058
192900            AFTER ADVANCING PC-1                                  19290058
193000        ADD PC-1 TO PV-LINE-CNT                                   19300058
193100     END-IF.                                                      19310058
193200*                                                                 19320058
193300     WRITE PRINT-LINE FROM TOTAL-LINE-2                           19330058
193400         AFTER ADVANCING PC-1.                                    19340058
193500*                                                                 19350058
193600     WRITE PRINT-LINE FROM DASHED-LINE                            19360058
193700         AFTER ADVANCING PC-1.                                    19370058
193800     WRITE PRINT-LINE FROM DASHED-LINE                            19380058
193900         AFTER ADVANCING PC-1.                                    19390058
194000     WRITE PRINT-LINE FROM BLANK-LINE                             19400058
194100         AFTER ADVANCING PC-2.                                    19410058
194200*                                                                 19420058
194300***************************************************************** 19430058
194400 T300-PRINT-DEPT-TOTALS.                                          19440058
194500*                                                                 19450058
194600     IF PV-LINE-CNT > PC-MAX-LINES                                19460058
194700        PERFORM Z400-PRINT-REPORT-HEADERS                         19470058
194800     END-IF.                                                      19480058
194900*                                                                 19490058
195000     WRITE PRINT-LINE FROM TOTAL-LINE-2                           19500058
195100         AFTER ADVANCING PC-1.                                    19510058
195200     ADD PC-1 TO PV-LINE-CNT.                                     19520058
195300*                                                                 19530058
195400***************************************************************** 19540058
195500 T400-PRINT-BG-TOTALS.                                            19550058
195600*                                                                 19560058
195700     ADD PC-7 TO PV-LINE-CNT.                                     19570058
195800     IF PV-LINE-CNT > PC-MAX-LINES                                19580058
195900        PERFORM Z400-PRINT-REPORT-HEADERS                         19590058
196000     END-IF.                                                      19600058
196100*                                                                 19610058
196200     WRITE PRINT-LINE FROM DASHED-LINE                            19620058
196300         AFTER ADVANCING PC-1.                                    19630058
196400     WRITE PRINT-LINE FROM DASHED-LINE                            19640058
196500         AFTER ADVANCING PC-1.                                    19650058
196600     WRITE PRINT-LINE FROM BLANK-LINE                             19660058
196700         AFTER ADVANCING PC-3.                                    19670058
196800*                                                                 19680058
196900     WRITE PRINT-LINE FROM TOTAL-LINE-2                           19690058
197000         AFTER ADVANCING PC-2.                                    19700058
197100*                                                                 19710058
197200*    MOVE PC-100 TO PV-LINE-CNT.                                  19720058
197300*                                                                 19730058
197400***************************************************************** 19740058
197500 X100-OPEN-BG-DEPT-CURSOR.                                        19750058
197600     MOVE 'X100-OPEN-BG-DEPT-CURSOR' TO PV-PARAGRAPH-NAME.        19760058
197700     MOVE 'OPEN BG-DEPT CURSOR'      TO PV-DB2-OPER-ATTEMPTED.    19770058
197800                                                                  19780058
197900     EXEC SQL                                                     19790058
198000         OPEN BG_DEPT_CSR                                         19800058
198100     END-EXEC                                                     19810058
198200                                                                  19820058
198300     EVALUATE TRUE                                                19830058
198400         WHEN SQLCODE = ZERO                                      19840058
198500         WHEN SQLCODE = PC-ROW-NOT-FOUND                          19850058
198600             CONTINUE                                             19860058
198700         WHEN OTHER                                               19870058
198800             PERFORM Z999-SQL-ABEND                               19880058
198900       END-EVALUATE.                                              19890058
199000*                                                                 19900058
199100***************************************************************** 19910058
199200 X200-OPEN-ITEM-CURSOR.                                           19920058
199300     MOVE 'X200-OPEN-ITEM-CURSOR' TO PV-PARAGRAPH-NAME.           19930058
199400     MOVE 'OPEN ITEM CURSOR'      TO PV-DB2-OPER-ATTEMPTED.       19940058
199500*                                                                 19950058
199600     EXEC SQL                                                     19960058
199700         OPEN ITEM_CSR                                            19970058
199800     END-EXEC                                                     19980058
199900                                                                  19990058
200000     EVALUATE TRUE                                                20000058
200100         WHEN SQLCODE = ZERO                                      20010058
200200         WHEN SQLCODE = PC-ROW-NOT-FOUND                          20020058
200300             CONTINUE                                             20030058
200400         WHEN OTHER                                               20040058
200500             PERFORM Z999-SQL-ABEND                               20050058
200600       END-EVALUATE.                                              20060058
200700*                                                                 20070058
200800***************************************************************** 20080058
200900 X300-OPEN-STORE-CURSOR.                                          20090058
201000     MOVE 'X300-OPEN-STORE-CURSOR' TO PV-PARAGRAPH-NAME.          20100058
201100     MOVE 'OPEN STORE CURSOR'      TO PV-DB2-OPER-ATTEMPTED.      20110058
201200*                                                                 20120058
201300     EXEC SQL                                                     20130058
201400         OPEN STORE_CSR                                           20140058
201500     END-EXEC                                                     20150058
201600                                                                  20160058
201700     EVALUATE TRUE                                                20170058
201800         WHEN SQLCODE = ZERO                                      20180058
201900         WHEN SQLCODE = PC-ROW-NOT-FOUND                          20190058
202000             CONTINUE                                             20200058
202100         WHEN OTHER                                               20210058
202200             PERFORM Z999-SQL-ABEND                               20220058
202300       END-EVALUATE.                                              20230058
202400*                                                                 20240058
202500***************************************************************** 20250058
202600 X700-OPEN-FILES.                                                 20260058
202700*                                                                 20270058
202800     OPEN INPUT OUT-OF-INV-FILE.                                  20280058
202900*                                                                 20290058
203000     IF PV-VSAM-SUCCESSFUL                                        20300058
203100        CONTINUE                                                  20310058
203200     ELSE                                                         20320058
203300        DISPLAY '** ABEND **'                                     20330058
203400        DISPLAY '** PROGRAM    = MRKRP086'                        20340058
203500        DISPLAY '** PARAGRAPH  = X700-OPEN-FILES'                 20350058
203600        DISPLAY '** MESSAGE    = '                                20360058
203700                'BAD VSAM OPEN, STATUS = ' PV-VSAM-STATUS         20370058
203800        MOVE +4005           TO PV-ABEND-CODE                     20380058
203900        CALL 'ILBOABN0'      USING PV-ABEND-CODE                  20390058
204000     END-IF.                                                      20400058
204100*                                                                 20410058
204200     OPEN INPUT  CONTROL-FILE                                     20420058
204300          OUTPUT PRINT-REPORT                                     20430058
204400          OUTPUT EXTRACT-FILE.                                    20440058
204500*                                                                 20450058
204600***************************************************************** 20460058
204700 Y100-CLOSE-BG-DEPT-CURSOR.                                       20470058
204800     EXEC SQL                                                     20480058
204900         CLOSE BG_DEPT_CSR                                        20490058
205000     END-EXEC                                                     20500058
205100                                                                  20510058
205200     EVALUATE TRUE                                                20520058
205300         WHEN SQLCODE = ZERO                                      20530058
205400             CONTINUE                                             20540058
205500         WHEN OTHER                                               20550058
205600             DISPLAY 'Y100-CLOSE-BG-DEPT-CURSOR'                  20560058
205700             PERFORM Z999-SQL-ABEND                               20570058
205800       END-EVALUATE.                                              20580058
205900*                                                                 20590058
206000***************************************************************** 20600058
206100 Y200-CLOSE-ITEM-CURSOR.                                          20610058
206200*                                                                 20620058
206300     EXEC SQL                                                     20630058
206400         CLOSE ITEM_CSR                                           20640058
206500     END-EXEC                                                     20650058
206600                                                                  20660058
206700     EVALUATE TRUE                                                20670058
206800         WHEN SQLCODE = ZERO                                      20680058
206900             CONTINUE                                             20690058
207000         WHEN OTHER                                               20700058
207100             DISPLAY 'Y200-CLOSE-ITEM-CURSOR'                     20710058
207200             PERFORM Z999-SQL-ABEND                               20720058
207300       END-EVALUATE.                                              20730058
207400*                                                                 20740058
207500***************************************************************** 20750058
207600 Y300-CLOSE-STORE-CURSOR.                                         20760058
207700     EXEC SQL                                                     20770058
207800         CLOSE STORE_CSR                                          20780058
207900     END-EXEC                                                     20790058
208000                                                                  20800058
208100     EVALUATE TRUE                                                20810058
208200         WHEN SQLCODE = ZERO                                      20820058
208300             CONTINUE                                             20830058
208400         WHEN OTHER                                               20840058
208500             DISPLAY 'Y300-CLOSE-STORE-CURSOR'                    20850058
208600             PERFORM Z999-SQL-ABEND                               20860058
208700       END-EVALUATE.                                              20870058
208800*                                                                 20880058
208900***************************************************************** 20890058
209000 Y700-CLOSE-FILES.                                                20900058
209100*                                                                 20910058
209200     CLOSE OUT-OF-INV-FILE.                                       20920058
209300*                                                                 20930058
209400     IF PV-VSAM-SUCCESSFUL                                        20940058
209500        CONTINUE                                                  20950058
209600     ELSE                                                         20960058
209700        DISPLAY '** ABEND **'                                     20970058
209800        DISPLAY '** PROGRAM    = MRKRP086'                        20980058
209900        DISPLAY '** PARAGRAPH  = Y700-CLOSE-FILES'                20990058
210000        DISPLAY '** MESSAGE    = '                                21000058
210100                'BAD VSAM CLOSE, STATUS = ' PV-VSAM-STATUS        21010058
210200        MOVE +4005           TO PV-ABEND-CODE                     21020058
210300        CALL 'ILBOABN0'      USING PV-ABEND-CODE                  21030058
210400     END-IF.                                                      21040058
210500*                                                                 21050058
210600     CLOSE CONTROL-FILE                                           21060058
210700           PRINT-REPORT                                           21070058
210800           EXTRACT-FILE.                                          21080058
210900*                                                                 21090058
211000***************************************************************** 21100058
211100*                                                                 21110058
211200*  READ CONTROL CARDS--FIRST ONE IS SERVICE LEVEL LIMIT, REST     21120058
211300*  ARE DEPARTMENT NUMBERS AND ARE PUT INTO A TABLE.  THESE        21130058
211400*  DEPARTMENTS WILL ONLY SHOW DETAIL TO THE SUBCLASS LEVEL ON     21140058
211500*  THE REPORT.                                                    21150058
211600*                                                                 21160058
211700***************************************************************** 21170058
211800 Z100-READ-CONTROL-FILE.                                          21180058
211900*                                                                 21190058
212000     READ CONTROL-FILE INTO CONTROL-DATA-IN                       21200058
212100          AT END SET EOF-CONTROL-FILE TO TRUE.                    21210058
212200*                                                                 21220058
212300     IF NOT EOF-CONTROL-FILE                                      21230058
212400        IF PV-DP-SUB = 1                                          21240058
212500         MOVE CTL-SKU-SVC-LEVEL-PCT TO   PC-SKU-SVC-LEVEL-LIMIT   21250058
212600                                         HL5-SKU-LIMIT            21260058
212700         MOVE CTL-STORE-SVC-LEVEL-PCT TO PC-STORE-SVC-LEVEL-LIMIT 21270058
212800                                         HL5-STORE-LIMIT          21280058
212900* **       MOVE CTL-SVC-LEVEL-PCT TO PC-SVC-LEVEL-LIMIT           21290058
213000* **                                 HL5-SKU-LIMIT                21300058
213100* **                                 HL5-STORE-LIMIT              21310058
213200        ELSE                                                      21320058
213300           MOVE CTL-DEPT TO DP-DEPT-NBR (PV-DP-SUB - 1)           21330058
213400        END-IF                                                    21340058
213500     END-IF.                                                      21350058
213600*                                                                 21360058
213700***************************************************************** 21370058
213800 Z300-WRITE-DETAIL-LINE.                                          21380058
213900*                                                                 21390058
214000     IF PV-LINE-CNT > PC-MAX-LINES                                21400058
214100        PERFORM Z400-PRINT-REPORT-HEADERS                         21410058
214200     END-IF                                                       21420058
214300*                                                                 21430058
214400     WRITE PRINT-LINE FROM DETAIL-LINE-1                          21440058
214500         AFTER ADVANCING PC-1.                                    21450058
214600     ADD PC-1 TO PV-LINE-CNT.                                     21460058
214700*                                                                 21470058
214800***************************************************************** 21480058
214900 Z400-PRINT-REPORT-HEADERS.                                       21490058
215000*                                                                 21500058
215100     ADD PC-1 TO PV-PAGE-CNT.                                     21510058
215200     MOVE PV-PAGE-CNT TO DP132-PAGE-NUMBER.                       21520058
215300*                                                                 21530058
215400     WRITE PRINT-LINE FROM DP132-STANDRD-HEADER-132-COLS          21540058
215500         AFTER ADVANCING PAGE.                                    21550058
215600*                                                                 21560058
215700     WRITE PRINT-LINE FROM HEADING-LINE-2                         21570058
215800         AFTER ADVANCING PC-1.                                    21580058
215900*                                                                 21590058
216000     WRITE PRINT-LINE FROM HEADING-LINE-3                         21600058
216100         AFTER ADVANCING PC-2.                                    21610058
216110*                                                                 21611058
216120     WRITE PRINT-LINE FROM HEADING-LINE-3A                        21612058
216130         AFTER ADVANCING PC-1.                                    21613058
216200*                                                                 21614058
216300     WRITE PRINT-LINE FROM HEADING-LINE-4                         21615058
216400         AFTER ADVANCING PC-2.                                    21616058
216500*                                                                 21617058
216600     WRITE PRINT-LINE FROM HEADING-LINE-5                         21618058
216700         AFTER ADVANCING PC-1.                                    21619058
216800*                                                                 21620058
216900     WRITE PRINT-LINE FROM BLANK-LINE                             21630058
217000         AFTER ADVANCING PC-1.                                    21640058
217100*                                                                 21650058
217200     MOVE ZERO TO PV-LINE-CNT.                                    21660058
217300*                                                                 21670058
217400***************************************************************** 21680058
217500 Z500-START-BROWSE-OOI-FILE.                                      21690058
217600*                                                                 21700058
217700     MOVE SPACES TO PV-VSAM-STATUS.                               21710058
217800*                                                                 21720058
217900     START OUT-OF-INV-FILE                                        21730058
218000         KEY GREATER THAN OUT-OF-INV-KEY.                         21740058
218100*                                                                 21750058
218200     IF PV-VSAM-SUCCESSFUL OR PV-VSAM-NOT-FOUND                   21760058
218300        CONTINUE                                                  21770058
218400     ELSE                                                         21780058
218500        DISPLAY '** ABEND **'                                     21790058
218600        DISPLAY '** PROGRAM    = MRKRP086'                        21800058
218700        DISPLAY '** PARAGRAPH  = Z500-START-BROWSE-OOI-FILE'      21810058
218800        DISPLAY '** MESSAGE    = '                                21820058
218900                'BAD VSAM READ, STATUS = ' PV-VSAM-STATUS         21830058
219000        MOVE +4005           TO PV-ABEND-CODE                     21840058
219100        CALL 'ILBOABN0'      USING PV-ABEND-CODE                  21850058
219200     END-IF.                                                      21860058
219300*                                                                 21870058
219400***************************************************************** 21880058
219500 Z600-READ-NEXT-OOI-FILE.                                         21890058
219600*                                                                 21900058
219700     MOVE SPACES TO PV-VSAM-STATUS.                               21910058
219800*                                                                 21920058
219900     READ OUT-OF-INV-FILE NEXT RECORD                             21930058
220000        INTO MR030-OUT-OF-INV-RECORD.                             21940058
220100*                                                                 21950058
220200     IF PV-VSAM-SUCCESSFUL                                        21960058
220300        CONTINUE                                                  21970058
220400     ELSE                                                         21980058
220500        SET END-OF-ITEM-STORES TO TRUE                            21990058
220600     END-IF.                                                      22000058
220610                                                                          
220700*                                                                 22010058
220800***************************************************************** 22020058
220900 Z700-WRITE-EXTRACT-RECORD.                                       22030058
221000*                                                                 22040058
221100     WRITE EXTRACT-RECORD                                         22050058
221200        FROM MR031-SERVICE-LEVEL-EXT-RECORD.                      22060058
221300*                                                                 22070058
221400     IF NOT PV-EXT-SUCCESSFUL                                     22080058
221500        DISPLAY '** ABEND **'                                     22090058
221600        DISPLAY '** PROGRAM    = MRKRP086'                        22100058
221700        DISPLAY '** PARAGRAPH  = Z700-WRITE-EXTRACT-RECORD'       22110058
221800        DISPLAY '** MESSAGE    = '                                22120058
221900                'BAD EXTRACT FILE WRITE, STATUS = ' PV-EXT-STATUS 22130058
222000        MOVE +4005           TO PV-ABEND-CODE                     22140058
222100        CALL 'ILBOABN0'      USING PV-ABEND-CODE                  22150058
222200     END-IF.                                                      22160058
222300*                                                                 22170058
222400***************************************************************** 22180058
222500 Z999-SQL-ABEND.                                                  22190058
222600*                                                                 22200058
222700     SET ABEND-4013            TO TRUE.                           22210058
222800     DISPLAY '**  ABEND     **'.                                  22220058
222900     DISPLAY '**  PROGRAM   **  = MRKRP086'.                      22230058
223000     DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            22240058
223100     DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.        22250058
223200                                                                  22260058
223300*    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         22270058
223400*    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        22280058
223500                                                                  22290058
223600     COPY DPPD004.                                                22300058
223700                                                                  22310058
223800     CALL 'ILBOABN0'  USING ABEND-CODE.                           22320058
223900*                                                                 22330058
224000***************************************************************** 22340058
224100***********************END OF PROGRAM**************************** 22350058
