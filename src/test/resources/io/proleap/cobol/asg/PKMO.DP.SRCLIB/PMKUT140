      ******************************************************************00010000
       IDENTIFICATION DIVISION.                                         00020000
      ******************************************************************00030000
                                                                        00040000
       PROGRAM-ID.      PMKUT140.                                       00050000
       AUTHOR.          TOM BOYD.                                       00060000
       INSTALLATION.    KOHLS DEPARTMENT STORES.                        00070000
       DATE-WRITTEN.    11/15/2005.                                     00080000
       DATE-COMPILED.                                                   00090000
                                                                        00100000
      ******************************************************************00110000
      * PROMO EXCEPTION REPORTING - CREATE PROMOTION FILES FOR A       *00120000
      * SPECIFIC AD EVENT.                                             *00130000
      * NOTE: THIS PROGRAM WILL CREATE A FIXED NUMBER OF PROMO ID      *00140000
      *       FILES.  PROGRAM SUPPORT UP TO 10 PROMOTIONS PER AD EVENT *00150000
      ******************************************************************00160000
      **   CHANGE LOG:                                                 *00170000
      ******************************************************************00180000
      * DATE:         11/15/2005                                       *00190000
      * WR/IR#:       P000822731                                       *00200000
      * PROGRAMMER:   TOM BOYD                                         *00210000
      * DESCRIPTION:  INITIAL CREATION.  CREATED TO HELP ADDRESS       *00220014
      *               PERFORMANCE AND RESTART ISSUES.                  *00230014
      ******************************************************************00250000
      * DATE:         10/02/2008                                       *00252016
      * WR/IR#:       WR35420                                          *00253018
      * PROGRAMMER:   AMANDA JEFFORDS                                  *00254016
      * DESCRIPTION:  EXTEND THE PROMOTION LIMIT FROM 10 TO 21.        *00255016
      ******************************************************************00257016
      * DATE:         10/29/2008                                       *00258025
      * WR/IR#:       INC000000567913                                  *00259025
      * PROGRAMMER:   DARYL STEWART                                    *00259125
      * DESCRIPTION:  HARD CODING BYPASS FOR NOVEMBER 2008 "DEAL OF THE*00259225
      *               DAY" PROMOTIONS. THEY ARE WEB ONLY PROMOTIONS.   *00259325
      ******************************************************************00259429
      * DATE:         07/30/2018                                       *00259529
      * WR/IR#:       CHG0204126                                       *00259629
      * PROGRAMMER:   COGNIZANT                                        *00259729
      * DESCRIPTION:  ORACLE LOGON STANDARDS PROGRAM CHANGE            *00259829
      ******************************************************************00259929
                                                                        00261000
      ******************************************************************00270000
       ENVIRONMENT DIVISION.                                            00280000
      ******************************************************************00290000
                                                                        00300000
       CONFIGURATION SECTION.                                           00310000
                                                                        00320000
       SOURCE-COMPUTER. IBM-3090.                                       00330000
       OBJECT-COMPUTER. IBM-3090.                                       00340000
                                                                        00350000
       INPUT-OUTPUT SECTION.                                            00360000
                                                                        00370000
       FILE-CONTROL.                                                    00380000
                                                                        00390000
           SELECT AD-FILE                                               00400000
               ASSIGN                       TO INP01.                   00410000
                                                                        00410127
070941     SELECT ORACLE-LOGON-FILE                                     00411027
070941         ASSIGN                       TO ORALOGON.                00412028
                                                                        00420000
           SELECT PROMO-FILE-1                                          00430000
               ASSIGN                       TO OUT01.                   00440000
                                                                        00450000
           SELECT PROMO-FILE-2                                          00460000
               ASSIGN                       TO OUT02.                   00470000
                                                                        00480000
           SELECT PROMO-FILE-3                                          00490000
               ASSIGN                       TO OUT03.                   00500000
                                                                        00510000
           SELECT PROMO-FILE-4                                          00520000
               ASSIGN                       TO OUT04.                   00530000
                                                                        00540000
           SELECT PROMO-FILE-5                                          00550000
               ASSIGN                       TO OUT05.                   00560000
                                                                        00570000
           SELECT PROMO-FILE-6                                          00580000
               ASSIGN                       TO OUT06.                   00590000
                                                                        00600000
           SELECT PROMO-FILE-7                                          00610000
               ASSIGN                       TO OUT07.                   00620000
                                                                        00630000
           SELECT PROMO-FILE-8                                          00640000
               ASSIGN                       TO OUT08.                   00650000
                                                                        00660000
           SELECT PROMO-FILE-9                                          00670000
               ASSIGN                       TO OUT09.                   00680000
                                                                        00690000
           SELECT PROMO-FILE-10                                         00700000
               ASSIGN                       TO OUT10.                   00710000
                                                                        00710116
           SELECT PROMO-FILE-11                                         00711016
               ASSIGN                       TO OUT11.                   00712016
                                                                        00720000
           SELECT PROMO-FILE-12                                         00721016
               ASSIGN                       TO OUT12.                   00722016
                                                                        00723016
           SELECT PROMO-FILE-13                                         00724016
               ASSIGN                       TO OUT13.                   00725016
                                                                        00726016
           SELECT PROMO-FILE-14                                         00727016
               ASSIGN                       TO OUT14.                   00728016
                                                                        00729016
           SELECT PROMO-FILE-15                                         00729116
               ASSIGN                       TO OUT15.                   00729216
                                                                        00729316
           SELECT PROMO-FILE-16                                         00729416
               ASSIGN                       TO OUT16.                   00729516
                                                                        00729616
           SELECT PROMO-FILE-17                                         00729716
               ASSIGN                       TO OUT17.                   00729816
                                                                        00729916
           SELECT PROMO-FILE-18                                         00730016
               ASSIGN                       TO OUT18.                   00730116
                                                                        00730216
           SELECT PROMO-FILE-19                                         00730316
               ASSIGN                       TO OUT19.                   00730416
                                                                        00730516
           SELECT PROMO-FILE-20                                         00730616
               ASSIGN                       TO OUT20.                   00730716
                                                                        00730816
           SELECT PROMO-FILE-21                                         00730916
               ASSIGN                       TO OUT21.                   00731016
                                                                        00731116
      ******************************************************************00732000
       DATA DIVISION.                                                   00740000
      ******************************************************************00750000
                                                                        00760000
       FILE SECTION.                                                    00761000
                                                                        00762000
       FD  AD-FILE                                                      00763000
           RECORDING MODE F                                             00764000
           BLOCK CONTAINS 0 RECORDS                                     00765000
           LABEL RECORDS ARE STANDARD.                                  00766000
       01  AD-FILE-REC                   PIC X(80).                     00767000
                                                                        00767127
070941 FD  ORACLE-LOGON-FILE                                            00767227
070941     RECORDING MODE IS F                                          00767327
070941     LABEL RECORDS ARE STANDARD                                   00767427
070941     BLOCK CONTAINS 0 RECORDS                                     00767827
070941     RECORD CONTAINS 80 CHARACTERS                                00767927
070941     DATA RECORDS IS OL-ORACLE-LOGON-RECORD.                      00768027
070941 01  OL-ORACLE-LOGON-RECORD        PIC X(80).                     00768128
                                                                        00768200
       FD  PROMO-FILE-1                                                 00769000
           RECORDING MODE F                                             00769100
           BLOCK CONTAINS 0 RECORDS                                     00769200
           LABEL RECORDS ARE STANDARD.                                  00769300
       01  PROMO-FILE-1-REC              PIC X(80).                     00769400
                                                                        00769500
       FD  PROMO-FILE-2                                                 00769600
           RECORDING MODE F                                             00769700
           BLOCK CONTAINS 0 RECORDS                                     00769800
           LABEL RECORDS ARE STANDARD.                                  00769900
       01  PROMO-FILE-2-REC              PIC X(80).                     00770000
                                                                        00770100
       FD  PROMO-FILE-3                                                 00770200
           RECORDING MODE F                                             00770300
           BLOCK CONTAINS 0 RECORDS                                     00770400
           LABEL RECORDS ARE STANDARD.                                  00770500
       01  PROMO-FILE-3-REC              PIC X(80).                     00770600
                                                                        00770700
       FD  PROMO-FILE-4                                                 00770800
           RECORDING MODE F                                             00770900
           BLOCK CONTAINS 0 RECORDS                                     00771000
           LABEL RECORDS ARE STANDARD.                                  00771100
       01  PROMO-FILE-4-REC              PIC X(80).                     00771200
                                                                        00771300
       FD  PROMO-FILE-5                                                 00771400
           RECORDING MODE F                                             00771500
           BLOCK CONTAINS 0 RECORDS                                     00771600
           LABEL RECORDS ARE STANDARD.                                  00771700
       01  PROMO-FILE-5-REC              PIC X(80).                     00771800
                                                                        00771900
       FD  PROMO-FILE-6                                                 00772000
           RECORDING MODE F                                             00772100
           BLOCK CONTAINS 0 RECORDS                                     00772200
           LABEL RECORDS ARE STANDARD.                                  00772300
       01  PROMO-FILE-6-REC              PIC X(80).                     00772400
                                                                        00772500
       FD  PROMO-FILE-7                                                 00772600
           RECORDING MODE F                                             00772700
           BLOCK CONTAINS 0 RECORDS                                     00772800
           LABEL RECORDS ARE STANDARD.                                  00772900
       01  PROMO-FILE-7-REC              PIC X(80).                     00773000
                                                                        00773100
       FD  PROMO-FILE-8                                                 00773200
           RECORDING MODE F                                             00773300
           BLOCK CONTAINS 0 RECORDS                                     00773400
           LABEL RECORDS ARE STANDARD.                                  00773500
       01  PROMO-FILE-8-REC              PIC X(80).                     00773600
                                                                        00773700
       FD  PROMO-FILE-9                                                 00773800
           RECORDING MODE F                                             00773900
           BLOCK CONTAINS 0 RECORDS                                     00774000
           LABEL RECORDS ARE STANDARD.                                  00774100
       01  PROMO-FILE-9-REC              PIC X(80).                     00774200
                                                                        00774300
       FD  PROMO-FILE-10                                                00774400
           RECORDING MODE F                                             00774500
           BLOCK CONTAINS 0 RECORDS                                     00774600
           LABEL RECORDS ARE STANDARD.                                  00774700
       01  PROMO-FILE-10-REC             PIC X(80).                     00774800
                                                                        00774900
       FD  PROMO-FILE-11                                                00775016
           RECORDING MODE F                                             00775116
           BLOCK CONTAINS 0 RECORDS                                     00775216
           LABEL RECORDS ARE STANDARD.                                  00775316
       01  PROMO-FILE-11-REC             PIC X(80).                     00775416
                                                                        00775516
       FD  PROMO-FILE-12                                                00775616
           RECORDING MODE F                                             00775716
           BLOCK CONTAINS 0 RECORDS                                     00775816
           LABEL RECORDS ARE STANDARD.                                  00775916
       01  PROMO-FILE-12-REC             PIC X(80).                     00776016
                                                                        00776116
       FD  PROMO-FILE-13                                                00776216
           RECORDING MODE F                                             00776316
           BLOCK CONTAINS 0 RECORDS                                     00776416
           LABEL RECORDS ARE STANDARD.                                  00776516
       01  PROMO-FILE-13-REC             PIC X(80).                     00776616
                                                                        00776716
       FD  PROMO-FILE-14                                                00776816
           RECORDING MODE F                                             00776916
           BLOCK CONTAINS 0 RECORDS                                     00777016
           LABEL RECORDS ARE STANDARD.                                  00777116
       01  PROMO-FILE-14-REC             PIC X(80).                     00777216
                                                                        00777316
       FD  PROMO-FILE-15                                                00777416
           RECORDING MODE F                                             00777516
           BLOCK CONTAINS 0 RECORDS                                     00777616
           LABEL RECORDS ARE STANDARD.                                  00777716
       01  PROMO-FILE-15-REC             PIC X(80).                     00777816
                                                                        00777916
       FD  PROMO-FILE-16                                                00778016
           RECORDING MODE F                                             00778116
           BLOCK CONTAINS 0 RECORDS                                     00778216
           LABEL RECORDS ARE STANDARD.                                  00778316
       01  PROMO-FILE-16-REC             PIC X(80).                     00778416
                                                                        00778516
       FD  PROMO-FILE-17                                                00778616
           RECORDING MODE F                                             00778716
           BLOCK CONTAINS 0 RECORDS                                     00778816
           LABEL RECORDS ARE STANDARD.                                  00778916
       01  PROMO-FILE-17-REC             PIC X(80).                     00779016
                                                                        00779116
       FD  PROMO-FILE-18                                                00779216
           RECORDING MODE F                                             00779316
           BLOCK CONTAINS 0 RECORDS                                     00779416
           LABEL RECORDS ARE STANDARD.                                  00779516
       01  PROMO-FILE-18-REC             PIC X(80).                     00779616
                                                                        00779716
       FD  PROMO-FILE-19                                                00779816
           RECORDING MODE F                                             00779916
           BLOCK CONTAINS 0 RECORDS                                     00780016
           LABEL RECORDS ARE STANDARD.                                  00780116
       01  PROMO-FILE-19-REC             PIC X(80).                     00780216
                                                                        00780316
       FD  PROMO-FILE-20                                                00780416
           RECORDING MODE F                                             00780516
           BLOCK CONTAINS 0 RECORDS                                     00780616
           LABEL RECORDS ARE STANDARD.                                  00780716
       01  PROMO-FILE-20-REC             PIC X(80).                     00780816
                                                                        00780916
       FD  PROMO-FILE-21                                                00781016
           RECORDING MODE F                                             00781116
           BLOCK CONTAINS 0 RECORDS                                     00781216
           LABEL RECORDS ARE STANDARD.                                  00781316
       01  PROMO-FILE-21-REC             PIC X(80).                     00781416
                                                                        00781516
       WORKING-STORAGE SECTION.                                         00781600
                                                                        00781700
      ******************************************************************00781800
      * PC PROGRAM CONSTANTS                                            00781900
      ******************************************************************00782000
       01  PC-PROGRAM-CONSTANTS.                                        00782100
070941     05  PC-AUTO-LOGON                PIC X(1)       VALUE '/'.   00782227
           05  PC-PROGRAM-NAME              PIC X(08)      VALUE        00782300
                                                           'PMKUT140'.  00782400
      ******************************************************************00782500
      * PV PROGRAM VARIABLES                                            00782600
      ******************************************************************00782700
       01  PV-PROGRAM-VARIABLES.                                        00782800
070941     05  PV-ORACLE-USERID-LEN         PIC S9(4) VALUE ZEROS       00782928
070941                                                COMP SYNC.        00783028
070941     05  PV-ORACLE-PASSWORD-LEN       PIC S9(4) VALUE ZEROS       00783128
070941                                                COMP SYNC.        00783228
070941     05  PC-AUTO-LOGON                PIC X(01) VALUE '/'.        00783328
           05  PV-TABLE-NAME                PIC X(30) VALUE SPACES.     00783405
           05  PV-SQL-CODE                  PIC 9(09) VALUE 0.          00783506
           05  PV-PARAGRAPH-NAME            PIC X(40) VALUE SPACES.     00783600
           05  PV-OPERATION-MSG-1           PIC X(40) VALUE SPACES.     00783700
           05  PV-OPERATION-MSG-2           PIC X(40) VALUE SPACES.     00783800
           05  PV-RUN-TIME                  PIC X(26) VALUE SPACES.     00783900
           05  PV-CPU-TIME                  PIC 9(08) VALUE 0.          00784000
           05  PV-RUN-DATE                  PIC X(10) VALUE SPACES.     00784100
           05  PV-CURRENT-TIME              PIC X(08) VALUE SPACES.     00784201
           05  PV-AD-EVNT-ID                PIC S9(10) VALUE +0         00784309
                                            COMP-3.                     00784409
           05  PV-PROMO-ID                  PIC S9(10) VALUE +0         00784509
                                            COMP-3.                     00784609
       01  CC-AD-FILE-REC.                                              00784706
           05  CC-AD-ID                     PIC 9(10) VALUE 0.          00784800
           05  FILLER                       PIC X(70) VALUE SPACES.     00784900
                                                                        00785000
      ******************************************************************00785100
      * PS PROGRAM SWITCHES                                            *00785200
      ******************************************************************00785300
       01  PS-PROGRAM-SWITCHES.                                         00785400
070941     05  PS-END-OF-LOGON-FILE-SW         PIC X(01)     VALUE 'N'. 00785528
070941         88  PS-END-OF-LOGON-FILE                      VALUE 'Y'. 00785628
070941     05  PS-ORA-SRC-CTL-DONE-SW          PIC X(01)     VALUE 'N'. 00785728
070941         88  PS-ORA-SRC-EMPTY                          VALUE 'Y'. 00785828
           05  PS-END-OF-AD-FILE-SW            PIC X(01)     VALUE 'N'. 00785900
               88  PS-END-OF-AD-FILE                         VALUE 'Y'. 00786000
               88  PS-NOT-END-OF-AD-FILE                     VALUE 'N'. 00786100
           05  PS-END-OF-PM-CSR-SW             PIC X(01)     VALUE 'N'. 00786200
               88  PS-ENDOFPROMO-CSR                         VALUE 'Y'. 00786300
               88  PS-NOT-ENDOFPROMO-CSR                     VALUE 'N'. 00786400
                                                                        00786527
070941 01  CC-ORACLE-CONNECTION.                                        00786627
070941     05  CC-ORACLE-USERID            PIC X(40).                   00786727
070941         88 CC-AUTO-LOGON                        VALUE '/'.       00786827
070941     05  CC-ORACLE-PASSWORD          PIC X(40).                   00786927
                                                                        00787000
      ******************************************************************00787100
      * PA PROGRAM ACCUMULATORS                                        *00787200
      ******************************************************************00787300
       01  PA-PROGRAM-ACCUMULATORS.                                     00787400
           05  PA-RECS-WRITTEN               PIC S9(13) COMP-3 VALUE 0. 00787500
           05  PA-READ-COUNTER               PIC S9(11) COMP-3 VALUE 0. 00787600
           05  PA-PROMO-COUNTER              PIC 9(02)  VALUE 0.        00787700
                                                                        00787800
      ******************************************************************00787900
      * AC ABEND CODES                                                 *00788000
      ******************************************************************00790000
                                                                        00800000
       01  ABEND-CODE                       PIC S9(04)   COMP VALUE +0. 00810000
           88  ABEND-4001-WRITE-ERROR                    VALUE +4001.   00820000
           88  ABEND-4002-READ-ERROR                     VALUE +4002.   00830000
           88  ABEND-4003-CTRL-CARD-ERROR                VALUE +4003.   00840000
           88  ABEND-4004-TABLE-ERROR                    VALUE +4004.   00850000
           88  ABEND-4005-OPEN-ERROR                     VALUE +4005.   00860000
           88  ABEND-4006-CLOSE-ERROR                    VALUE +4006.   00870000
           88  ABEND-4007-SEQUENCE-ERROR                 VALUE +4007.   00880000
           88  ABEND-4008-DATA-ERROR                     VALUE +4008.   00890000
           88  ABEND-4009-KEY-DATA-ERROR                 VALUE +4009.   00900000
           88  ABEND-4013-DB2-ERROR                      VALUE +4013.   00910000
           88  ABEND-4014-ORACLE-LOGON-ERROR             VALUE +4014.   00920000
           88  ABEND-4019-DATE-ROUTINE-ERROR             VALUE +4019.   00930000
           88  ABEND-4444-FORCED-ABEND                   VALUE +4444.   00940000
                                                                        00950000
      *----------------------------------------------------------       00960000
      *                      O  R  A  C  L  E                           00970000
      *==========================================================       00980000
      *                                                                 00990000
      * ORACLE DECLARE SECTION                                          01000000
      * ORACLE USED AND RETURNED VARIABLES                              01010000
      *                                                                 01020000
      *----------------------------------------------------------       01030000
           EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     01040000
                                                                        01050000
      *----------------------------------------------------------       01060000
      * ORACLE LOGON WORKING STORAGE COPYBOOK                           01070000
      *----------------------------------------------------------       01080000
                                                                        01090000
       01  PC-ENT01-TYPE-CDE                PIC X(02)  VALUE '01'.      01100000
       01  PV-ORACLE-ID                     PIC X(1)   VALUE '/'.       01110000
                                                                        01120000
       01  USERNAME                         PIC X(10)  VARYING.         01130000
       01  PASSWD                           PIC X(10)  VARYING.         01140000
                                                                        01150000
       01  ORACLE-RETURN                    PIC X(200) VALUE SPACES.    01160000
                                                                        01170000
           EXEC SQL END DECLARE SECTION END-EXEC.                       01180000
           EXEC SQL INCLUDE SQLCACOB    END-EXEC.                       01190000
                                                                        01200000
       EJECT                                                            01210000
                                                                        01220000
       PROCEDURE DIVISION.                                              01230000
                                                                        01240000
      ******************************************************************01250000
      * MAIN PROCESSING                                                 01260000
      ******************************************************************01270000
       A100-PROGRAM-MAINLINE.                                           01280000
                                                                        01290000
           PERFORM B100-INITIALIZE.                                     01300000
                                                                        01310000
           PERFORM B200-READ-AD-FILE.                                   01320000
           PERFORM C100-PROCESS-AD-ID                                   01330000
             UNTIL PS-END-OF-AD-FILE.                                   01340000
                                                                        01350000
           PERFORM B900-EOJ-ROUTINE.                                    01400000
                                                                        01410000
           GOBACK.                                                      01420000
                                                                        01430000
      ******************************************************************01440000
      * OPEN FILE                                                       01450000
      ******************************************************************01460000
       B100-INITIALIZE.                                                 01470000
                                                                        01480000
070941     DISPLAY 'ORACLE FILE OPEN'.                                  01481027
070941     OPEN INPUT ORACLE-LOGON-FILE.                                01482027
070941                                                                  01483027
070941     DISPLAY 'ORACLE FILE READ'.                                  01484027
070941     PERFORM 7000-READ-ORACLE-LOGON.                              01485027
070941                                                                  01486027
070941     DISPLAY 'ORACLE FILE CLOSE'.                                 01487027
070941     CLOSE ORACLE-LOGON-FILE.                                     01488027
070941                                                                  01489027
070941     IF ((PS-END-OF-LOGON-FILE)                                   01489127
070941             OR (CC-ORACLE-CONNECTION = SPACES))                  01489227
070941         DISPLAY '** ABEND **'                                    01489327
070941         DISPLAY PC-PROGRAM-NAME ' - ORACLE LOGON CONTROL CARD '  01489427
070941                   'NOT PROVIDED'                                 01489527
070941         SET PS-ORA-SRC-EMPTY TO TRUE                             01489627
070941         CALL 'ILBOABN0' USING ABEND-CODE                         01489727
070941     END-IF.                                                      01489827
070941                                                                  01489927
070941     IF CC-AUTO-LOGON                                             01490027
070941         DISPLAY PC-PROGRAM-NAME ' - AUTO LOGON TO ORACLE'        01490127
070941         EXEC SQL                                                 01490227
070941              CONNECT :USERNAME                                   01490327
070941         END-EXEC                                                 01490427
070941     ELSE                                                         01490527
070941         INITIALIZE PV-ORACLE-USERID-LEN                          01490627
070941                    PV-ORACLE-PASSWORD-LEN                        01490727
070941         INSPECT CC-ORACLE-USERID                                 01490827
070941             TALLYING PV-ORACLE-USERID-LEN                        01490927
070941          FOR CHARACTERS BEFORE INITIAL SPACE                     01491027
070941      INSPECT CC-ORACLE-PASSWORD                                  01491127
070941          TALLYING PV-ORACLE-PASSWORD-LEN                         01491227
070941          FOR CHARACTERS BEFORE INITIAL SPACE                     01491327
070941      MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO           01491427
070941                USERNAME-ARR                                      01491527
070941      MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                   01491627
070941      MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO       01491727
070941                PASSWD-ARR                                        01491827
070941      MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                   01491927
070941      DISPLAY PC-PROGRAM-NAME ' - LOGON TO ORACLE AS USER '       01492027
070941                USERNAME-ARR                                      01492127
070941      EXEC SQL                                                    01492227
070941        CONNECT :USERNAME IDENTIFIED BY :PASSWD                   01492327
070941      END-EXEC                                                    01492427
070941      INITIALIZE CC-ORACLE-PASSWORD                               01492527
070941                 PASSWD                                           01492627
070941      END-IF.                                                     01492727
070941                                                                  01492827
070941     IF (SQLCODE NOT = 0)                                         01492927
070941         DISPLAY PV-PARAGRAPH-NAME                                01493027
070941         DISPLAY PC-PROGRAM-NAME ' - ERROR LOGGING ON TO ORACLE'  01493127
070941         PERFORM 9900-ORACLE-ABEND                                01493227
070941     END-IF.                                                      01493327
                                                                        01493427
           OPEN INPUT  AD-FILE.                                         01493500
           OPEN OUTPUT PROMO-FILE-1                                     01493600
                       PROMO-FILE-2                                     01493700
                       PROMO-FILE-3                                     01493800
                       PROMO-FILE-4                                     01494000
                       PROMO-FILE-5                                     01495000
                       PROMO-FILE-6                                     01496000
                       PROMO-FILE-7                                     01497000
                       PROMO-FILE-8                                     01498000
                       PROMO-FILE-9                                     01499000
                       PROMO-FILE-10                                    01499116
                       PROMO-FILE-11                                    01499216
                       PROMO-FILE-12                                    01499316
                       PROMO-FILE-13                                    01499416
                       PROMO-FILE-14                                    01499516
                       PROMO-FILE-15                                    01499616
                       PROMO-FILE-16                                    01499716
                       PROMO-FILE-17                                    01499816
                       PROMO-FILE-18                                    01499916
                       PROMO-FILE-19                                    01500016
                       PROMO-FILE-20                                    01500116
                       PROMO-FILE-21.                                   01500216
                                                                        01501000
070941*    PERFORM PM700-A000-ORACLE-SETUP.                             01510028
                                                                        01520000
      ******************************************************************01530000
      * B200-READ-AD-FILE.                                              01540000
      *     READS THE AD EVENT ID FILE FOR THE ID TO BE PROCESSED.      01550000
      ******************************************************************01560000
       B200-READ-AD-FILE.                                               01570000
                                                                        01580000
           READ AD-FILE INTO CC-AD-FILE-REC                             01590000
                AT END SET PS-END-OF-AD-FILE TO TRUE.                   01600000
                                                                        01610000
           MOVE CC-AD-ID TO PV-AD-EVNT-ID.                              01620000
                                                                        01630000
           IF PS-NOT-END-OF-AD-FILE                                     01640000
              PERFORM 8000-GET-CURRENT-TIME                             01651000
              DISPLAY '***************************************'         01660000
              DISPLAY 'PROCESSING AD EVENT ID: ' PV-AD-EVNT-ID          01661000
              DISPLAY '***************************************'         01662000
              PERFORM D100-DECLARE-PROMO-CSR                            01663000
              PERFORM D200-OPEN-PROMO-CSR                               01664000
           END-IF.                                                      01670000
                                                                        01680000
      *B200-EXIT.                                                       01690000
       EJECT.                                                           01700000
                                                                        01710000
      *--------------------------------------------------------------   01720000
      * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION THAT      01730000
      * LOGS ON TO ORACLE.                                              01740000
      *---------------------------------------------------------------  01750000
070941*    COPY PMPD700.                                                01760028
                                                                        01770000
      ******************************************************************01780000
      * NEEDS TO BE IN FOR NOW TIL KURT FIXES CURSOR SHARING BUG        01790000
      * OTHERWISE I GET A ORA-3113 ERROR                                01800000
      ******************************************************************01810000
           EXEC SQL                                                     01820000
            ALTER SESSION                                               01830000
                  SET CURSOR_SHARING = 'EXACT'                          01840000
            ALTER SESSION                                               01850000
                  SET OPTIMIZER_INDEX_COST_ADJ =  5                     01860000
           END-EXEC.                                                    01870000
                                                                        01880000
      ******************************************************************01890000
      * CLEAN UP                                                        01900000
      ******************************************************************01910000
       B900-EOJ-ROUTINE.                                                01920000
                                                                        01930000
           CLOSE AD-FILE                                                01940000
                 PROMO-FILE-1                                           01941000
                 PROMO-FILE-2                                           01942000
                 PROMO-FILE-3                                           01943000
                 PROMO-FILE-4                                           01944000
                 PROMO-FILE-5                                           01945000
                 PROMO-FILE-6                                           01946000
                 PROMO-FILE-7                                           01947000
                 PROMO-FILE-8                                           01948000
                 PROMO-FILE-9                                           01949000
                 PROMO-FILE-10                                          01949116
                 PROMO-FILE-11                                          01949216
                 PROMO-FILE-12                                          01949316
                 PROMO-FILE-13                                          01949416
                 PROMO-FILE-14                                          01949516
                 PROMO-FILE-15                                          01949616
                 PROMO-FILE-16                                          01949716
                 PROMO-FILE-17                                          01949816
                 PROMO-FILE-18                                          01949916
                 PROMO-FILE-19                                          01950016
                 PROMO-FILE-20                                          01950116
                 PROMO-FILE-21.                                         01950216
                                                                        01951000
              DISPLAY '***************************************'.        01952002
              DISPLAY 'PROCESSING COMPLETED'.                           01953002
              PERFORM 8000-GET-CURRENT-TIME.                            01955012
              DISPLAY '***************************************'.        01956012
                                                                        01960000
      ******************************************************************01970000
      * PROCESS THE AD ID AND CREATE THE PROMOTION FILES.               01980000
      ******************************************************************01990000
       C100-PROCESS-AD-ID.                                              02000000
                                                                        02010000
           PERFORM D300-FETCH-PROMO-CSR                                 02020000
              UNTIL PS-ENDOFPROMO-CSR.                                  02021000
                                                                        02022000
           PERFORM B200-READ-AD-FILE.                                   02030000
                                                                        02040000
      ******************************************************************02050000
      * DECLARE PROMOTION CURSOR                                        02060000
      ******************************************************************02070000
       D100-DECLARE-PROMO-CSR.                                          02080000
                                                                        02090000
           EXEC SQL                                                     02150000
                DECLARE PROMOCSR CURSOR FOR                             02151000
                SELECT DISTINCT(A.PROMO_ID)                             02152000
                FROM PMV_PROMO_DIM A                                    02154024
                WHERE A.AD_EVNT_ID = :PV-AD-EVNT-ID                     02155000
567913            AND A.PROMO_ABBR_NM <> 'DOD'                          02155126
                  AND A.PROMO_STAT_CDE = 'S'                            02156000
           END-EXEC.                                                    02167000
                                                                        02167100
      *D100 END                                                         02167200
                                                                        02167300
      ******************************************************************02167400
      * OPEN PROMOTION CURSOR                                           02167500
      ******************************************************************02167600
       D200-OPEN-PROMO-CSR.                                             02167700
                                                                        02167800
           EXEC SQL                                                     02167900
               OPEN PROMOCSR                                            02168000
           END-EXEC.                                                    02168100
                                                                        02168200
           EVALUATE TRUE                                                02169000
             WHEN SQLCODE = ZERO                                        02170000
             WHEN SQLCODE = +100                                        02171000
                 CONTINUE                                               02180000
             WHEN OTHER                                                 02190000
                 MOVE SQLCODE                    TO PV-SQL-CODE         02200000
                 MOVE 'PMV_PROMO_DIM'            TO PV-TABLE-NAME       02210000
                 MOVE 'D200-OPEN-PROMO-CSR'      TO PV-PARAGRAPH-NAME   02220000
                 PERFORM 9900-ORACLE-ABEND                              02230000
           END-EVALUATE.                                                02240000
                                                                        02250000
      *D200 END                                                         02260000
                                                                        02270000
      ***********************************************************       02271000
      * D300-FETCH-PROMO-CSR.                                           02272000
      ***********************************************************       02273000
       D300-FETCH-PROMO-CSR.                                            02274000
                                                                        02275000
           EXEC SQL                                                     02276000
               FETCH PROMOCSR                                           02277000
                 INTO :PV-PROMO-ID                                      02278000
           END-EXEC.                                                    02279000
                                                                        02279100
           EVALUATE TRUE                                                02279200
             WHEN SQLCODE = ZERO                                        02279300
                 SET PS-NOT-ENDOFPROMO-CSR       TO TRUE                02279400
                 ADD 1 TO PA-PROMO-COUNTER                              02279500
                 PERFORM W100-WRITE-PROMO-FILE                          02279600
             WHEN SQLCODE = 1403                                        02279708
             WHEN SQLCODE = +100                                        02279808
                 SET PS-ENDOFPROMO-CSR           TO TRUE                02279908
             WHEN OTHER                                                 02280008
                 SET PS-ENDOFPROMO-CSR           TO TRUE                02280108
                 MOVE SQLCODE                    TO PV-SQL-CODE         02280208
                 MOVE 'PMV_PROMO_DIM'            TO PV-TABLE-NAME       02280308
                 MOVE 'D300-FETCH-PROMO-CSR'     TO PV-PARAGRAPH-NAME   02280408
                 PERFORM 9900-ORACLE-ABEND                              02280508
           END-EVALUATE.                                                02280608
                                                                        02280708
      ******************************************************************02281000
       W100-WRITE-PROMO-FILE.                                           02290000
      ******************************************************************02300000
                                                                        02310000
           DISPLAY 'PROMO FILE: ' PA-PROMO-COUNTER ' ID: ' PV-PROMO-ID  02310211
                                                                        02310311
           EVALUATE PA-PROMO-COUNTER                                    02310411
              WHEN 1                                                    02310511
                WRITE PROMO-FILE-1-REC                                  02310611
                    FROM PV-PROMO-ID                                    02310711
              WHEN 2                                                    02310811
                WRITE PROMO-FILE-2-REC                                  02310911
                    FROM PV-PROMO-ID                                    02311011
              WHEN 3                                                    02311111
                WRITE PROMO-FILE-3-REC                                  02311211
                    FROM PV-PROMO-ID                                    02311311
              WHEN 4                                                    02311411
                WRITE PROMO-FILE-4-REC                                  02311511
                    FROM PV-PROMO-ID                                    02311611
              WHEN 5                                                    02311711
                WRITE PROMO-FILE-5-REC                                  02311811
                    FROM PV-PROMO-ID                                    02311911
              WHEN 6                                                    02312011
                WRITE PROMO-FILE-6-REC                                  02312111
                    FROM PV-PROMO-ID                                    02312211
              WHEN 7                                                    02312311
                WRITE PROMO-FILE-7-REC                                  02312411
                    FROM PV-PROMO-ID                                    02312511
              WHEN 8                                                    02312611
                WRITE PROMO-FILE-8-REC                                  02312711
                    FROM PV-PROMO-ID                                    02312811
              WHEN 9                                                    02312911
                WRITE PROMO-FILE-9-REC                                  02313011
                    FROM PV-PROMO-ID                                    02313111
              WHEN 10                                                   02313211
                WRITE PROMO-FILE-10-REC                                 02313311
                    FROM PV-PROMO-ID                                    02313411
              WHEN 11                                                   02313516
                WRITE PROMO-FILE-11-REC                                 02313616
                    FROM PV-PROMO-ID                                    02313716
              WHEN 12                                                   02313816
                WRITE PROMO-FILE-12-REC                                 02313916
                    FROM PV-PROMO-ID                                    02314016
              WHEN 13                                                   02314116
                WRITE PROMO-FILE-13-REC                                 02314216
                    FROM PV-PROMO-ID                                    02314316
              WHEN 14                                                   02314416
                WRITE PROMO-FILE-14-REC                                 02314516
                    FROM PV-PROMO-ID                                    02314616
              WHEN 15                                                   02314716
                WRITE PROMO-FILE-15-REC                                 02314816
                    FROM PV-PROMO-ID                                    02314916
              WHEN 16                                                   02315016
                WRITE PROMO-FILE-16-REC                                 02315116
                    FROM PV-PROMO-ID                                    02315216
              WHEN 17                                                   02315316
                WRITE PROMO-FILE-17-REC                                 02315416
                    FROM PV-PROMO-ID                                    02315516
              WHEN 18                                                   02315616
                WRITE PROMO-FILE-18-REC                                 02315716
                    FROM PV-PROMO-ID                                    02315816
              WHEN 19                                                   02315916
                WRITE PROMO-FILE-19-REC                                 02316016
                    FROM PV-PROMO-ID                                    02316116
              WHEN 20                                                   02316216
                WRITE PROMO-FILE-20-REC                                 02316316
                    FROM PV-PROMO-ID                                    02316416
              WHEN 21                                                   02316516
                WRITE PROMO-FILE-21-REC                                 02316616
                    FROM PV-PROMO-ID                                    02316716
              WHEN OTHER                                                02316811
                DISPLAY 'TO MANY PROMOTIONS FOUND!!'                    02316911
           END-EVALUATE.                                                02317011
                                                                        02317111
      *W100 END                                                         02317211
070941****************************************************************  02317327
070941** READ THE ORACLE LOGON CONTROL CARD.                        **  02317427
070941****************************************************************  02317527
070941 7000-READ-ORACLE-LOGON.                                          02317627
070941                                                                  02317727
070941     READ ORACLE-LOGON-FILE                                       02317827
070941         INTO CC-ORACLE-CONNECTION                                02317927
070941         AT END                                                   02318027
070941             SET PS-END-OF-LOGON-FILE TO TRUE                     02318127
070941     END-READ.                                                    02318227
                                                                        02318311
      ******************************************************************02318411
       8000-GET-CURRENT-TIME.                                           02318511
      ******************************************************************02318611
                                                                        02319000
            MOVE SPACES TO PV-CURRENT-TIME.                             02320000
                                                                        02330000
           EXEC SQL                                                     02340000
              SELECT                                                    02350000
                 TO_CHAR(SYSDATE,'HH24:MI:SS')                          02360000
              INTO :PV-CURRENT-TIME                                     02370000
              FROM DUAL                                                 02380000
            END-EXEC.                                                   02390000
                                                                        02400000
           EVALUATE TRUE                                                02410000
             WHEN SQLCODE = ZERO                                        02411000
                 DISPLAY 'CURRENT TIME: ' PV-CURRENT-TIME               02412000
             WHEN OTHER                                                 02413000
                 MOVE SQLCODE                    TO PV-SQL-CODE         02413100
                 MOVE 'DUAL'                      TO PV-TABLE-NAME      02413200
                 MOVE '8000-GET-CURRENT-TIME   ' TO PV-PARAGRAPH-NAME   02413300
                 PERFORM 9900-ORACLE-ABEND                              02413400
           END-EVALUATE.                                                02413500
                                                                        02413600
      *----------------------------------------------------------       02550000
      * 9900-ORACLE-ABEND.                                              02560000
      *     PERFORM AN ABEND THAT OCCURED RELATED TO ORACLE.            02570000
      *----------------------------------------------------------       02580000
       9900-ORACLE-ABEND.                                               02590000
                                                                        02600000
           DISPLAY '                       '.                           02610000
           DISPLAY '** ABEND **       ** =   SQLERROR'.                 02620028
           DISPLAY '** PROGRAM        ** = ' PC-PROGRAM-NAME.           02630003
           DISPLAY '** SQLCODE        ** = ' PV-SQL-CODE.               02640000
           DISPLAY '** ABEND CODE     ** = ' ABEND-CODE.                02650000
           DISPLAY '** SQLERRM        ** = ' SQLERRM.                   02660000
           DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  02670000
           DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                02680000
           DISPLAY '** PARAGRAPH      ** = ' PV-PARAGRAPH-NAME.         02690000
           DISPLAY '** TABLE          ** = ' PV-TABLE-NAME.             02700000
           DISPLAY '** OPERATION      ** = ' PV-OPERATION-MSG-1.        02710004
           DISPLAY '                       '.                           02720000
                                                                        02730000
           CALL 'ILBOABN0' USING ABEND-CODE.                            02740000
                                                                        02750000
      *9900-EXIT.                                                       02760000
