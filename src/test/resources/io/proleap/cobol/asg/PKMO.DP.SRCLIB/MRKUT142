      ******************************************************************00010045
       IDENTIFICATION DIVISION.                                         00020045
      ******************************************************************00030045
       PROGRAM-ID.      MRKUT142.                                       00040045
       AUTHOR.          VLADIMIR FILIPOVIC.                             00050045
       INSTALLATION.    KOHLS DEPARTMENT STORES.                        00060045
       DATE-WRITTEN.    01/20/06.                                       00070045
       DATE-COMPILED.                                                   00080045
      ******************************************************************00090045
      * THIS PROGRAM WILL CREATE TWO EXTRACT FILES.  ONE WITH THE       00100045
      * CURRENT WEEK FORECAST & DD AND ONE WITH THE 52-WEEK FUTURE      00110045
      * FORECASTS.                                                      00120045
      ******************************************************************00130045
      *  CHANGE MADE:  ADDED FUTURE FORECAST OUTPUT FILE                00140045
      *                                                                 00150045
      *  CHANGED 03/20/06 BY LINDA FRIESS               WR# 28981       00160045
      ***************************************************************** 00170045
      *  CHANGE MADE:  ADDED 8-WEEK FUTURE FORECAST OUTPUT FILE         00180046
      *                                                                 00190046
      *  CHANGED 05/24/06 BY LINDA FRIESS               WR# 28981       00200048
      ***************************************************************** 00210046
       ENVIRONMENT DIVISION.                                            00220045
      ******************************************************************00230045
      *                                                                 00240045
       CONFIGURATION SECTION.                                           00250045
       SOURCE-COMPUTER. IBM-3090.                                       00260045
       OBJECT-COMPUTER. IBM-3090.                                       00270045
      *                                                                 00280045
       INPUT-OUTPUT SECTION.                                            00290045
       FILE-CONTROL.                                                    00300045
                                                                        00310045
           SELECT ROD-FILE                                              00320045
                  ASSIGN TO ICROD                                       00330045
                  ORGANIZATION IS INDEXED                               00340045
                  ACCESS MODE  IS SEQUENTIAL                            00350045
                  RECORD KEY   IS D-LINE-ITEM-KEY                       00360045
                  FILE STATUS  IS SC-DETAIL-STATUS.                     00370045
                                                                        00380045
           SELECT OUTPUT-FILE                                           00390045
               ASSIGN                       TO OUT01.                   00400045
                                                                        00410045
           SELECT FUTURE-FCST-FILE                                      00420045
               ASSIGN                       TO OUT02.                   00430045
                                                                        00440045
           SELECT FUTURE-FCST-8WKS-FILE                                 00450046
               ASSIGN                       TO OUT03.                   00460046
                                                                        00470046
           EJECT                                                        00480045
      *                                                                 00490045
      ***************************************************************** 00500045
       DATA DIVISION.                                                   00510045
      ***************************************************************** 00520045
      *                                                                 00530045
       FILE SECTION.                                                    00540045
      *                                                                 00550045
       FD  ROD-FILE                                                     00560045
           DATA RECORD IS ROD-RECORD.                                   00570045
                                                                        00580045
       01  ROD-RECORD.                                                  00590045
           COPY ICI050C.                                                00600045
           COPY ICI030C.                                                00610045
           COPY ICI031C.                                                00620045
           COPY ICI095C.                                                00630045
                                                                        00640045
       FD  OUTPUT-FILE                                                  00650045
           LABEL RECORDS ARE OMITTED                                    00660045
           RECORDING MODE F                                             00670045
           RECORD CONTAINS 30 CHARACTERS                                00680045
           BLOCK CONTAINS 0 RECORDS                                     00690045
           DATA RECORD IS FCST-QTY-RECORD.                              00700045
                                                                        00710045
       01  FCST-QTY-RECORD             PIC X(30).                       00720045
                                                                        00730045
                                                                        00740045
       FD  FUTURE-FCST-FILE                                             00750045
           LABEL RECORDS ARE OMITTED                                    00760045
           RECORDING MODE F                                             00770045
           RECORD CONTAINS 43 CHARACTERS                                00780045
           BLOCK CONTAINS 0 RECORDS                                     00790045
           DATA RECORD IS FUTURE-FCST-RECORD.                           00800045
                                                                        00810045
       01  FUTURE-FCST-RECORD             PIC X(43).                    00820045
                                                                        00830045
                                                                        00840046
       FD  FUTURE-FCST-8WKS-FILE                                        00850046
           LABEL RECORDS ARE OMITTED                                    00860046
           RECORDING MODE F                                             00870046
           RECORD CONTAINS 43 CHARACTERS                                00880046
           BLOCK CONTAINS 0 RECORDS                                     00890046
           DATA RECORD IS FUTURE-FCST-8WKS-RECORD.                      00900046
                                                                        00910046
       01  FUTURE-FCST-8WKS-RECORD        PIC X(43).                    00920046
                                                                        00930046
                                                                        00940046
       WORKING-STORAGE SECTION.                                         00950045
      *-----------------------------------------------------------------00960045
      *    COPYBOOK FOR WEEKLY FORECAST OUTPUT FILE                     00970045
      *-----------------------------------------------------------------00980045
           COPY MRRD016.                                                00990045
      *                                                                 01000045
      *-----------------------------------------------------------------01010045
      *    COPYBOOK FOR FUTURE FORECAST OUTPUT FILE                     01020045
      *-----------------------------------------------------------------01030045
           COPY MRRD142.                                                01040045
      *                                                                 01050045
      *                                                                 01060045
       01  SC-STATUS-CODES.                                             01070045
           05  SC-DETAIL-STATUS        PIC XX    VALUE SPACES.          01080045
               88  SC-DETAIL-STATUS-OK           VALUE '00'.            01090045
               88  SC-DETAIL-STATUS-DUPLICATE    VALUE '22'.            01100045
               88  SC-DETAIL-STATUS-NOT-FOUND    VALUE '23'.            01110045
      *                                                                 01120045
       01  PV-PROGRAM-VARIABLES.                                        01130045
           05  PV-INAME.                                                01140045
               10  PV-INAME-SKU             PIC  9(08)    VALUE ZERO.   01150045
               10  FILLER                   PIC  X(02)    VALUE SPACES. 01160045
               10  FILLER                   PIC  X(05)                  01170045
                   VALUE ' STR:'.                                       01180045
               10  PV-INAME-STORE           PIC  X(05)    VALUE SPACES. 01190045
               10  FILLER                   PIC  X(01)    VALUE '/'.    01200045
               10  PV-INAME-SKU-DESC        PIC  X(25)    VALUE SPACES. 01210045
               10  FILLER                   PIC  X(04)    VALUE SPACES. 01220045
                                                                        01230045
           05  PV-RECORDS-WRITTEN           PIC  9(09)    VALUE 0.      01240045
           05  PV-FUTR-RECS-WRITTEN         PIC  9(11)    VALUE 0.      01250045
           05  PV-FUTR-8WK-RECS-WRITTEN     PIC  9(11)    VALUE 0.      01260046
           05  PV-RECORDS-READ              PIC  9(09)    VALUE 0.      01270045
           05  PV-WK-SUB                    PIC S9(04)    VALUE +0      01280045
                                                          COMP SYNC.    01290045
           05  PV-FCST-SUB                  PIC S9(04)    VALUE +0      01300045
                                                          COMP SYNC.    01310045
           05  PV-PARAGRAPH                 PIC  X(30)    VALUE SPACES. 01320045
           05  PV-CURR-DATE                 PIC  X(10)    VALUE SPACES. 01330045
                                                                        01340045
           05  PV-ORACLE-BOW-DATE.                                      01350045
               10  PV-BOW-DATE              PIC X(10).                  01360045
               10  FILLER                   PIC X(01) VALUE '-'.        01370045
               10  FILLER                   PIC X(08) VALUE '00.00.00'. 01380045
      *                                                                 01390045
       01  PC-CONSTANTS.                                                01400045
           05  PC-MAX-WEEKS                 PIC S9(03)    VALUE +52     01410045
                                                          COMP-3.       01420045
           05  PC-8WK-FCST-MAX              PIC S9(03)    VALUE +8      01430046
                                                          COMP-3.       01440046
      *                                                                 01450045
       01  PS-PROGRAM-SWITCHES.                                         01460045
           05  PS-END-OF-DETAIL-SWITCH      PIC X         VALUE 'N'.    01470045
               88  PS-NOT-END-OF-DETAIL                   VALUE 'N'.    01480045
               88  PS-END-OF-DETAIL                       VALUE 'Y'.    01490045
      *                                                                 01500045
       01  ABEND-CODE                       PIC S9(04)    VALUE +0      01510045
                                                          COMP SYNC.    01520045
      *                                                                 01530045
      ******************************************************************01540045
      * WORKING-STORAGE FOR CALENDAR ROUTINE                            01550045
      ******************************************************************01560045
           COPY DPWS500.                                                01570045
                                                                        01580045
      ******************************************************************01590045
      *  BOW DATE TABLE - 52 WEEKS                                      01600045
      ******************************************************************01610045
       01  BOW-DATE-TABLE.                                              01620045
           05  BOW-DATE-ENTRY         OCCURS 52 TIMES.                  01630045
               10  BOW-ORACLE-DATE       PIC X(19).                     01640045
      *                                                                 01650045
      *                                                                 01660045
      ****************************************************************  01670045
       PROCEDURE DIVISION.                                              01680045
      ****************************************************************  01690045
       0000-PROGRAM-MAINLINE.                                           01700045
                                                                        01710045
           PERFORM 1000-LOAD-DATE-TABLE.                                01720045
                                                                        01730045
           OPEN INPUT  ROD-FILE                                         01740045
                OUTPUT OUTPUT-FILE                                      01750045
                       FUTURE-FCST-FILE                                 01760047
                       FUTURE-FCST-8WKS-FILE.                           01770047
                                                                        01780045
           PERFORM 6000-READ-ROD-FILE.                                  01790045
                                                                        01800045
           PERFORM 2000-PROCESS-ROD-FILE                                01810045
                   UNTIL PS-END-OF-DETAIL.                              01820045
                                                                        01830045
           PERFORM 8000-END-ROUTINE.                                    01840045
           STOP RUN.                                                    01850045
                                                                        01860045
                                                                        01870045
      ***************************************************************** 01880045
      *    LOAD THE NEXT 52 BOW DATES INTO A TABLE                      01890045
      ***************************************************************** 01900045
       1000-LOAD-DATE-TABLE.                                            01910045
                                                                        01920045
           PERFORM 1200-GET-CURR-BOW-DATE.                              01930045
                                                                        01940045
           PERFORM 1400-GET-NEXT-DATE                                   01950045
               VARYING PV-WK-SUB FROM 2 BY 1                            01960045
               UNTIL PV-WK-SUB > PC-MAX-WEEKS.                          01970045
                                                                        01980045
                                                                        01990045
      ****************************************************************  02000045
      *    GET CURRENT BEGINNING OF WEEK DATE                           02010045
      ****************************************************************  02020045
       1200-GET-CURR-BOW-DATE.                                          02030045
                                                                        02040045
           MOVE '1200-GET-CURR-BOW-DATE' TO PV-PARAGRAPH.               02050045
                                                                        02060045
           ACCEPT PV-CURR-DATE FROM DATE YYYYMMDD.                      02070045
                                                                        02080045
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              02090045
           SET DPG51-FISCAL-JAN-DEC-F2                                  02100045
               DPG51-DO-NOT-INCR-DECR-DATE                              02110045
               DPG52-LK-DTE-ISO            TO TRUE.                     02120045
           MOVE PV-CURR-DATE TO DPG52-LK-DATE-INPUT.                    02130045
                                                                        02140045
           PERFORM 1800-CALENDAR-ROUTINE.                               02150045
      *                                                                 02160045
      ***  FORMAT FIRST BOW DATE & MOVE TO TABLE                        02170045
      *                                                                 02180045
           MOVE DPG55-1ST-WKDY-DB2ISO-FMT TO PV-BOW-DATE.               02190045
           MOVE PV-ORACLE-BOW-DATE        TO BOW-ORACLE-DATE(1).        02200045
                                                                        02210045
           DISPLAY SPACES.                                              02220045
           DISPLAY '** CURRENT BEGIN OF WEEK DATE: ' PV-BOW-DATE.       02230045
                                                                        02240045
                                                                        02250045
      ****************************************************************  02260045
      *    GET THE NEXT BOW DATE & MOVE TO TABLE                        02270045
      ****************************************************************  02280045
       1400-GET-NEXT-DATE.                                              02290045
                                                                        02300045
           MOVE '1400-GET-NEXT-DATE'  TO PV-PARAGRAPH.                  02310045
                                                                        02320045
           MOVE PV-BOW-DATE           TO DPG52-LK-DATE-INPUT.           02330045
           MOVE 7                     TO DPG51-INCR-DECR-DAYS-9.        02340045
           SET DPG51-FISCAL-454-CALENDAR                                02350045
               DPG51-INCREMENT-DATE                                     02360045
               DPG52-LK-DTE-ISO-FMT   TO TRUE.                          02370045
                                                                        02380045
           PERFORM 1800-CALENDAR-ROUTINE.                               02390045
                                                                        02400045
           MOVE DPG55-DB2-ISO-DATE-FMT TO PV-BOW-DATE.                  02410045
           MOVE PV-ORACLE-BOW-DATE     TO BOW-ORACLE-DATE(PV-WK-SUB).   02420045
                                                                        02430045
                                                                        02440045
      ***************************************************************** 02450045
      *    CALL THE CALENDAR ROUTINE                                    02460045
      ***************************************************************** 02470045
       1800-CALENDAR-ROUTINE.                                           02480045
                                                                        02490045
           CALL DP500-KOHLS-CALENDAR-ROUTINE                            02500045
               USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               02510045
                                                                        02520045
           IF DPG54-SEVERE-ERROR                                        02530045
               DISPLAY '** ABEND ** IN MRKUT142'                        02540045
               DISPLAY '** PARAGRAPH: ' PV-PARAGRAPH                    02550045
               DISPLAY '** CALENDAR ROUTINE ERROR MESSAGE = '           02560045
                           DPG54-ERROR-MESSAGE                          02570045
               DISPLAY '** DPG51 = ' DPG51                              02580045
               DISPLAY '** DPG52 = ' DPG52                              02590045
               DISPLAY '** DPG53 = ' DPG53                              02600045
               DISPLAY '** DPG54 = ' DPG54                              02610045
               DISPLAY '** DPG55 = ' DPG55                              02620045
               DISPLAY '** DPG56 = ' DPG56                              02630045
               MOVE +4003 TO ABEND-CODE                                 02640045
               CALL 'ILBOABN0' USING ABEND-CODE                         02650045
           ELSE                                                         02660045
               IF DPG54-WARNING-ERROR                                   02670045
                   DISPLAY '** WARNING RETURNED BY CALENDAR ROUTINE'    02680045
                   DISPLAY '** CALLED BY ' PV-PARAGRAPH                 02690045
                   DISPLAY '** WARNING MESSAGE = ' DPG54-ERROR-MESSAGE  02700045
               END-IF                                                   02710045
           END-IF.                                                      02720045
                                                                        02730045
                                                                        02740045
      ***************************************************************** 02750045
      * THIS PROCEDURE PROCESSES RECORDS FROM THE INPUT FILE.           02760045
      ***************************************************************** 02770045
       2000-PROCESS-ROD-FILE.                                           02780045
                                                                        02790045
           IF NOT PS-END-OF-DETAIL                                      02800045
               MOVE INAME TO PV-INAME                                   02810045
      *                                                                 02820045
      **  BYPASS CORPORATE STORES & STORES TURNED OFF OF INFOREM (FT=X) 02830045
      *                                                                 02840045
               IF (PV-INAME-STORE = ZEROES) OR                          02850045
                  (PV-INAME-STORE = SPACES) OR                          02860045
                  (FT = 'X')                                            02870045
                   CONTINUE                                             02880045
               ELSE                                                     02890045
                  MOVE PV-INAME-SKU    TO MR016-SKU                     02900045
                                          MR142-SKU                     02910045
                  MOVE PV-INAME-STORE  TO MR016-STORE-NBR               02920045
                                          MR142-STORE-NBR               02930045
                  MOVE DD              TO MR016-DD-FCTR                 02940045
                  MOVE WFCST(WN)       TO MR016-FCST-SALES-QTY          02950045
                                                                        02960045
                  PERFORM 7500-WRITE-FORECAST-RECORD                    02970045
      *                                                                 02980045
      ***         WRITE OUT FUTURE FORECASTS, STARTING WITH             02990046
      ***         CURRENT WEEK (BOTH 52-WK FILE & 8-WK FILE)            03000046
      *                                                                 03010045
                  MOVE WN TO PV-FCST-SUB                                03020045
                                                                        03030045
                  PERFORM 7600-WRITE-FUTURE-FCST                        03040045
                      VARYING PV-WK-SUB FROM 1 BY 1                     03050045
                      UNTIL PV-WK-SUB > PC-MAX-WEEKS                    03060045
               END-IF                                                   03070045
                                                                        03080045
               PERFORM 6000-READ-ROD-FILE                               03090045
           END-IF.                                                      03100045
                                                                        03110045
                                                                        03120045
      ****************************************************************  03130045
      * READ THE ROD FILE.                                              03140045
      ****************************************************************  03150045
       6000-READ-ROD-FILE.                                              03160045
                                                                        03170045
           READ ROD-FILE NEXT                                           03180045
                AT END  SET PS-END-OF-DETAIL TO TRUE.                   03190045
                                                                        03200045
           IF PS-NOT-END-OF-DETAIL                                      03210045
              ADD 1 TO PV-RECORDS-READ.                                 03220045
                                                                        03230045
                                                                        03240045
      ***************************************************************** 03250045
      * WRITE AN EXTRACT.                                               03260045
      ***************************************************************** 03270045
       7500-WRITE-FORECAST-RECORD.                                      03280045
      *                                                                 03290045
           WRITE FCST-QTY-RECORD                                        03300045
                FROM MR016-DD-FCST-EXTRACT-RECORD.                      03310045
                                                                        03320045
           ADD 1 TO PV-RECORDS-WRITTEN.                                 03330045
                                                                        03340045
                                                                        03350045
      ***************************************************************** 03360045
      *    WRITE FUTURE FORECASTS TO OUTPUT FILES--                     03370046
      *      ONE WITH 52 WEEKS & ONE WITH 8 WEEKS                       03380046
      ***************************************************************** 03390045
       7600-WRITE-FUTURE-FCST.                                          03400045
      *                                                                 03410045
           MOVE BOW-ORACLE-DATE(PV-WK-SUB) TO MR142-BOW-DATE.           03420045
           MOVE WFCST(PV-FCST-SUB)         TO MR142-FCST-SLS-QTY.       03430045
                                                                        03440045
           WRITE FUTURE-FCST-RECORD                                     03450045
               FROM MR142-FUTURE-FORECAST-RECORD.                       03460045
                                                                        03470045
           ADD 1 TO PV-FUTR-RECS-WRITTEN.                               03480046
                                                                        03490046
      *                                                                 03500046
      ***  WRITE FIRST 8 WEEKS OF FORECASTS TO SEPARATE FILE            03510046
      *                                                                 03520046
           IF PV-WK-SUB <= PC-8WK-FCST-MAX                              03530046
              WRITE FUTURE-FCST-8WKS-RECORD                             03540046
                  FROM MR142-FUTURE-FORECAST-RECORD                     03550046
              ADD 1 TO PV-FUTR-8WK-RECS-WRITTEN.                        03560046
                                                                        03570045
      *                                                                 03580046
      ***  INCREMENT FCST SUBSCRIPT; WHEN REACH 52, RESET TO 1          03590046
      *                                                                 03600046
           IF PV-FCST-SUB = PC-MAX-WEEKS                                03610045
              MOVE 1 TO PV-FCST-SUB                                     03620045
           ELSE                                                         03630045
              ADD 1 TO PV-FCST-SUB                                      03640045
           END-IF.                                                      03650045
                                                                        03660045
                                                                        03670045
      ***************************************************************** 03680045
      * CLOSE FILES AND DISPLAY RESULTS.                                03690045
      ***************************************************************** 03700045
       8000-END-ROUTINE.                                                03710045
                                                                        03720045
           CLOSE ROD-FILE                                               03730045
                 OUTPUT-FILE                                            03740045
                 FUTURE-FCST-FILE                                       03750047
                 FUTURE-FCST-8WKS-FILE.                                 03760047
                                                                        03770045
           DISPLAY SPACES.                                              03780045
           DISPLAY '** NUMBER OF RECORDS READ: ' PV-RECORDS-READ.       03790045
           DISPLAY '** NUMBER OF WKLY FCST RECS WRITTEN:   '            03800045
                                             PV-RECORDS-WRITTEN.        03810045
           DISPLAY '** NUMBER OF FUTR FCST RECS WRITTEN: '              03820045
                                             PV-FUTR-RECS-WRITTEN.      03830045
           DISPLAY '** NUMBER OF 8-WK FCST RECS WRITTEN: '              03840046
                                             PV-FUTR-8WK-RECS-WRITTEN.  03850046
                                                                        03860045
