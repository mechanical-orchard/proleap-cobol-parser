000100 IDENTIFICATION DIVISION.                                         00010099
000200 PROGRAM-ID.     APKUP032.                                        00020099
000300 AUTHOR.         PAM VOLK.                                        00030099
000400 DATE-WRITTEN.   11/12/1996.                                      00040099
000500 DATE-COMPILED.                                                   00050099
000600*************************************************************     00060099
000700*    COBOL 2 WITH SQL                                       *     00070099
000800*                                                           *     00080099
000900*    CREATE UNJOURNALIZED RECEIPT WRITE-OFF INVOICES        *     00090099
001000*                                                           *     00100099
001100*  --- PURPOSE IS TO:                                       *     00110099
001200*    CREATE UNJOURNALIZED RECEIPT WRITE-OFF INVOICES.       *     00120099
001300*    THIS PROGRAM IDENTIFIES THE RECEIVERS ELIGIBLE FOR A   *     00130099
001400*    WRITE OFF AND PROCEEDS TO CREATE THE 'WRITE-OFF'       *     00140099
001500*    INVOICE TO MATCH THE UNJOURNALIZED RECORD (RECEIVER).  *     00150099
001600*    IF THE WRITE-OFF COST IS $0, THEN UPDATE RECORDS ARE   *     00160099
001700*    CREATED TO LATER WRITE OFF THE RECEIVING SOURCES (IE,  *     00170099
001800*    TRECDIS/TRECEIV OR TNINREC).  THESE UPDATE RECORDS ARE *     00180099
001900*    INSERTED INTO THE TOUTAP3 TABLE USING THE APRD254 COPY-*     00190099
002000*    BOOK.                                                  *     00200099
002100*  --- DESCRIPTION OF FLOW:                                 *     00210099
002200*    THE UNJOURNALIZED RECEIPT FILE DRIVES THIS PROGRAM.    *     00220099
002300*    PROGRAM EXPECTS INPUT FILE TO BE SORTED ASCENDING      *     00230099
002400*    BY PO, ASCENDING BY STORE NUMBER AND DESCENDING BY     *     00240099
002500*    INT-RC2-MKDATE.                                        *     00250099
002600*   -BEFORE PROCESSING BEGINS WE NEED THE UNJOURNALIZED     *     00260099
002700*    WRITE OFF DAYS AND THE PROCESS DATE FROM TAPCNTL.      *     00270099
002800*    THESE DATES ARE USED TO CALCULATE THE WRITEOFF CUT-    *     00280099
002900*    OFF DATE, WHICH IS THEN USED TO DETERMINES IF THE      *     00290099
003000*    RECEIVER WILL GET WRITTEN OFF OR NOT.                  *     00300099
003100*   -THE UNJOURNALIZED RECEIVING IS PROCESSED BY PO/STOR    *     00310099
003200*    COMBINATION.  IF THE FIRST INT-RC2-MKDATE FOR THAT     *     00320099
003300*    PO/STOR IS LESS THAN OR EQUAL TO THE CUTOFF DATE THAN  *     00330099
003400*    ACCUM THE COST AND QUANTITY UNTIL NEW PO/STOR;  IF     *     00340099
003500*    NOT BYPASS ALL RECEIVERS FOR THAT PO/STOR.             *     00350099
003600*    IF ACCUM COSTS ARE GREATER THAN ZERO, PROCEED ON.  IF  *     00360099
003700*    ACCUM COSTS EQUALS ZERO, THEN CREATE UPDATE RECORDS    *     00370099
003800*    THAT WILL BE USED TO WRITE OFF THE RECEIVING SOURCE    *     00380099
003900*    (COMBINATION TRECDIS/TRECEIV OR TNINREC).  THESE WILL  *     00390099
004000*    BE FORMATTED IN THE APRD254 COPYBOOK.  THESE UPDATE    *     00400099
004100*    RECORDS WILL BE INSERTED INTO THE TOUTAP3 TABLE.       *     00410099
004200*   -BEFORE CREATING AN INVOICE, WE MUST VERIFY THAT THERE  *     00420099
004300*    ARE NO EXISTING INVOICES FOR THE PO/STOR OUT ON THE    *     00430099
004400*    TABLES.  IF THERE ARE DELETE THEM.                     *     00440099
004500*   -NOW WE CAN GO AHEAD AND CREATE THE INVOICE TO MATCH    *     00450099
004600*    ON THE GROSS COST AND QUANTITY THAT WE ACCUM AT THE    *     00460099
004700*    PO/STOR LEVEL.                                         *     00470099
004800*   -RECORD COUNTS ARE KEPT ON THE NUMBER OF UNJOURNALIZED  *     00480099
004900*    RECEIPT RECORDS READ, NUMBER OF RECORDS BYPASSED,      *     00490099
005000*    NUMBER OF INVOICES CREATED (INSERTS), NUMBER OF        *     00500099
005100*    INVOICES DELETED.  ALSO THE CALCULATED CUTOFF DATE     *     00510099
005200*    IS DISPLAYED.                                          *     00520099
005300*   -IF CHECKPOINT RESTART IS INVOKED THE COUNTS SHOULD     *     00530099
005400*    ACCURATELY REFLECT THE PROCESSING.                     *     00540099
005500*   -CHECKPOINT COMMITS ARE TAKEN AFTER INVOICES ARE        *     00550099
005600*    CREATED BY PO/STOR.  (COMMIT OCCURS AFTER C200 IS      *     00560099
005700*    PERFORMED FROM PARAGRAPH B200)                         *     00570099
005800*                                                           *     00580099
005900*    NOTE ON PARAGRAPH NAMES-                               *     00590099
006000*    ALL I/O PARAGRAPHS START WITH:                         *     00600099
006100*        I  FOR  INSERTS                                    *     00610099
006200*        R  FOR  READS / FETCHES                            *     00620099
006300*        U  FOR  UPDATES                                    *     00630099
006400*        Y  FOR  CURSOR OPENS/CLOSES.                       *     00640099
006500*    COMMIT AND ABEND PARAGRAPHS BEGIN WITH Z.              *     00650099
006600*                                                           *     00660099
006700* INPUT:                                                    *     00670099
006800*  1. UNJOURNALIZED-FILE               (APRD042)            *     00680099
006900*  2. AP CONTROL TABLE                 (TAPCNTL)            *     00690099
007000*                                                           *     00700099
007100* INPUT/OUTPUT:                                             *     00710099
007200*  1. AP PAYMENT REQUESTS              (TPAYREQ)            *     00720099
007300*  2. INVOICE TABLE                    (TINVOIC)            *     00730099
007400*  3. AP MERCHANDISE INVOICE           (TMDINVC)            *     00740099
007500*  4. AP INVOICE PAYMENT TERMS         (TINVCTM)            *     00750099
007600*  5. AUDIT TABLE                      (TAUDINC)            *     00760099
007700*  6. RECEIVER DISTRIBUTION TABLE      (TRECDIS)            *     00770099
007800*  7. AP OUTPUT NUMBER 3 TABLE         (TOUTAP3)            *     00780099
007900*  8. CHECKPOINT RESTART CONTROL       (TCKRSTCNTL)         *     00790099
008000*  9. CHECKPOINT RESTART INFORMATION   (TCKRSTINF)          *     00800099
008010* 10. LOCATION DATABASE                (XFT00017)           *     00810099
008100*                                                           *     00820099
008200*************************************************************     00830099
008300*-----------------------------------------------------------------00840099
008400* CHANGE LOG:                                                     00850099
008500*                                                                 00860099
008600* 11/12/96  INITIAL VERSION                                       00870099
008700*           BY:  PDVOLK                       WR/PIT 3803         00880099
008800*                                                                 00890099
008900* 04/26/97  CHANGED INSERT TO TPAYREQ TO SAVE THE SQLCODE FOR     00900099
009000*           RETRY CHECKING.  WHEN A DUPLICATE IS ENCOUNTERED AND  00910099
009100*           A NEW RANDOM NUMBER IS GENERATED, THE SQLCODE IS      00920099
009200*           UPDATED AND THIS CHANGES THE PERFORM UNTIL PATH,      00930099
009300*           WHICH PREVENTS THE TPAYREQ ROW FROM BEING INSERTED.   00940099
009400*           BY:  NANCY EILBES                 WR/PIT 78740        00950099
009500*                                                                 00960099
009600* 08/25/97  MODIFIED THE LOGIC WHICH INSERTS ROWS TO TINVOIC TO   00970099
009700*           PUT VALUES IN THE 2 NEW COLS AS FOLLOWS: INVOIC-PPD-  00980099
009800*           RVRSL-IND WILL BE SET TO "N" AND INVOIC-INVC-NET-COST-00990099
009900*           AMT WILL GET THE SAME VALUE AS THE INVOIC-GRO-COST-AMT01000099
010000*           MODIFIED THE LOGIC WHICH INSERTS ROWS TO TMDINVC TO   01010099
010100*           INITIALIZE THE NEW COL MDINVC-IMPRT-CHRG-PRC-CDE TO   01020099
010200*           SPACES.  ALSO RECODED THE LARGE NESTED IF STMT IN     01030099
010300*           B200-PROCESS-UNJOURNALIZED.  THIS WAS DONE TO ALLOW   01040099
010400*           FOR READABILITY AND TO CORRECTLY PROCESS UNJOURNALIZED01050099
010500*           WRITE-OFFS ON THE BASIS OF PO'S BEING BY STORE OR BULK01060099
010600*           ALSO ADDED AN ADDITIONAL WHERE CLAUSE TO THE INVOICE  01070099
010700*           CURSOR FOR INVC_TYP_CDE.                              01080099
010800*           BY:  MIKE BESKE                   WR/PIT 4164         01090099
010900*                                                                 01100099
011000* 10/28/97  CHANGED THE INITIAL VALUE OF PPD-RVRSL-IND TO SPACE   01110099
011100*           ON INSERTS TO TINVOIC.                                01120099
011200*           BY:  NANCY EILBES                 WR/PIT 4164         01130099
011300*                                                                 01140099
011400* 01/30/98  PER Y2K SPECS, UPDATED THE CALENDAR ROUTINE TO BE A   01150099
011500*           DYNAMIC CALL.                                         01160099
011600*           BY:  ROBIN BERNOSKI               WR/PIT 5703         01170099
011700*                                                                 01180099
011800* 02/02/98  ADDED A NEW CURSOR FOR BY STORE INVOICES AND CHANGED  01190099
011900*           THE EXISTING CURSOR FOR BULK INVOICES.  THIS WAS      01200099
012000*           DONE TO CORRECT THE PROBLEM OF NOT DELETING ALL       01210099
012100*           INVOICES IN THE SITUATION WHERE THERE ARE BY STORE    01220099
012200*           RECEIVERS AND BULK INVOICES.  CREATED NEW PARAS       01230099
012300*           R500-, Y300-, Y400-.  MODIFIED PARAS C200-, D300-,    01240099
012400*           R300-, Y100-, Y200-.                                  01250099
012500*           BY:  MIKE BESKE                   WR/PIT 157309       01260099
012600*                                                                 01270099
012700* 05/05/98  ADDED THE PROCESSING NECESSARY TO MAINTAIN AP         01280099
012800*           PROCESS CODE ON ALL INVOICES.  THIS CODE WAS          01290099
012900*           NEEDED BECAUSE THE STATUS CODE IS NO LONGER           01300099
013000*           SUFFICIENT TO INDICATE IF THE INVOICES FOR A PO       01310099
013100*           HAVE BEEN JOURNALIZED.  THE LOGIC HAS BEEN MODIFIED   01320099
013200*           TO INSERT ROWS INTO TINVOIC AND PLACE VALUES IN THE   01330099
013300*           TWO NEW COLUMNS:                                      01340099
013400*               - AP-PRC-CDE                                      01350099
013500*               - AP-PRC-DTE                                      01360099
013600*           BY:  ROBIN BERNOSKI               WR/PIT 4164         01370099
013700*                                                                 01380099
013800* 08/04/99 Y2K.  REPLACED THE INTRANEX COPYBOOK WITH THE          01390099
013900*          APRD042 COPYBOOK.                                      01400099
014000*           BY:  ROBIN BERNOSKI               WR/PIT 6041         01410099
014100*                                                                 01420099
014200* 12/08/1999 JILL JUEL                       WR/IR #: WR6041      01430099
014300*            - MODIFIED THE CHECK ON THE DATE ROUTINE TO          01440099
014400*              CONFORM WITH Y2K STANDARDS BY ADDING               01450099
014500*              DPG54-WARNING-ERROR.                               01460099
014600*                                                                 01470099
014700* 01/07/02 CHANGED THE ORDER THAT THE DATE MANIPULATION IS DONE   01480099
014800*          TO CALCULATE THE UNJOURNALIZED RECEIPT WRITEOFF CUTOFF 01490099
014900*          DATE.  THE APCNTL-UJ-W-O-DAY-QTY IS SUBTRACTED FROM    01500099
015000*          BATCH CONTROL DATE.  THIS RESULT IS USED TO FIND THE   01510099
015100*          LAST DAY OF THE FISCAL MONTH.  THIS WILL BE THE WO     01520099
015200*          CUTOFF DATE.                                           01530099
015300*           BY:  MIKE BESKE                   WR/PIT 23005        01540099
015400*                                                                 01550099
015500* 01/22/02 ADDED CODE THAT WILL CREATE UPDATE RECORDS TO WRITE OFF01560099
015600*          ZERO COST TRECDIS/TRECEIV AND TNINREC ROWS. NO WRITEOFF01570099
015700*          INVOICES WILL BE CREATED IN THIS SITUATION, ONLY THE   01580099
015800*          UPDATE RECORDS.  THESE WILL BE INSERTED INTO TOUTAP3   01590099
015900*          IN THE APRD254 LAYOUT.  THIS IS NEEDED BECAUSE OF THE  01600099
016000*          CHECKPOINT RESTART LOGIC.  THE NEW LOGIC WILL ONLY BE  01610099
016100*          PERFORMED WHEN THE PV-ACCUM-RCV-COST = $0 FOR A GIVEN  01620099
016200*          PO/STORE COMBINATION.                                  01630099
016300*           BY:  MIKE BESKE                   WR/PIT 23005        01640099
016400*                                                                 01650099
016500* 06/17/02 ARK PO PROJECT PHASE 1.  MAKING TABLE MODIFICATIONS TO 01660099
016600*          IMPROVE PERFORMANCE.  REMOVED TABLE TPAYREQ FROM       01670099
016700*          BULK_INVOICE_CSR AND BYSTR_INVOICE_CSR.  ADDED MOVES   01680099
016800*          TO POPULATE NEW COLUMNS ADDED TO TINVOIC AND TMDINVC.  01690099
016900*          CHANGED SEQUENCE ON TINVOIC AND TMDINVC TO REFLECT NEW 01700099
017000*          COLUMN SEQUENCE.  PARAGRAPHS CHANGED ARE C200, I200,   01710099
017100*          AND U100.                                              01720099
017200*           BY:  KEVIN CATLIN                 WR # 23500          01730099
017300*                                                                 01740099
017400* 06/20/02 ARK PO PROJECT PHASE 1.  WHEN CREATING WRITE OFF       01750099
017500*          INVOICE IDS, THE WHOLE PAYT-REQ-SEQ-NBR WILL BE        01760099
017600*          STRUNG TO THE 'WO' OR 'WONIR' PREFIX.  PARAGRAPH       01770099
017700*          MODIFIED IS C200.                                      01780099
017800*           BY:  KEVIN CATLIN                 WR # 23500          01790099
017900*                                                                 01800099
018000* 09/09/02 ARK PO PHASE 2.  MODIFIED PARAGRAPHS C200,D300,        01810099
018100*          I400 AND I500 TO USE THE NEW UNIQUE INDEX CONSISTING   01820099
018200*          OF THE PO NUMBER AND INVOICE ID INSTEAD OF             01830099
018300*          PAYT-REQ-SEQ-NBR.  ALSO, REMOVED A MOVE TO THE         01840099
018400*          PAYT-REQ-SEQ-NBR THAT WAS NO LONGER USED.              01850099
018500*          ALSO, ANY REFERENCES TO THE APWS900 COPY BOOK WAS      01860099
018600*          REMOVED BECAUSE IT IS NO LONGER SUPPORTED.             01870099
018700* BY: BRIAN HASSLINGER                         WR#: 23500         01880099
018800*                                                                 01890099
018900* 02/05/2003                                                      01900099
019000*    CHANGE MADE: ARKPO PHASE3 PROJECT.                           01910099
019100*    UPDATED THE PROGRAM TITLE TO MATCH THE SPEC TITLE.           01920099
019200*    UPDATED THE INPUT FILE NAME IN THE PROGRAM COMMENT BLOCK.    01930099
019300*    INCREASED THE LENGTH OF PV-PO-NBR FROM 7 TO 9 BYTES.         01940099
019400* MADE BY:  MIKE BESKE                          WR#: 23500        01950099
019500*                                                                 01960099
019600* 04/01/2004                                                      01970099
019700*    CHANGE MADE: INCREASED THE VARIOUS W/S STORE FIELDS FROM 3   01980099
019800*    TO 4 CHARACTERS.                                             01990099
019900* MADE BY:  MIKE BESKE                          WR#: 25805        02000099
019901*                                                                 02010099
019902* 02/26/2007                                                      02020099
019903*    CHANGE MADE: ADDED CODE THAT WILL LOOP THE CALCULATION OF    02030099
019904*    THE PAYT-REQ-SEQ-NBR SIMILAR TO WHAT IS FOUND IN APKUP202    02040099
019905*    AND APKUP225.  THIS IS BEING DONE TO REDUCE THE NUMBER OF    02050099
019906*    -803 SQL ERROR CONDITIONS THAT CAN ABEND IN THIS PROGRAM.    02060099
019907*    MODIFIED PARAGRAPHS R400-GET-CURRENT-TIMESTAMP AND           02070099
019908*    I200-INSERT-INVOIC ACCORDINGLY.  ALSO REMOVED ALL LOGIC FROM 02080099
019909*    THE PROGRAM RELATING TO THE TPAYREQ TABLE.                   02090099
019910* MADE BY: KRYSTEN LEARY                       WR#: P000986861    02100099
019911*                                                                 02110099
019912* 03/11/2007                                                      02120099
019920*    CHANGE MADE: MATCH BY DC PROJECT.                            02130099
019930*    REMOVED ALL REFERENCES OF TAUDINC AND REMOVED ALL LOGIC      02140099
019931*    WHICH INSERTS TO TAUDINC. ADDED MTCH_LVL_CDE AND DC_NBR      02150099
019932*    TO INSERT TO TINVOIC IN PARAGRAPHS I200- AND C200-.          02160099
019940* MADE BY:  ROLF NOHE                           WR#: 21578        02170099
019950*                                                                 02180099
019960* DATE  03/02/2016                                                02190099
019970*    CHANGE MADE: ADDED LOGIC TO LOAD AN ARRAY OF DC NUMBERS      02200099
019971*    FROM THE LOCATION DATABASE. WHEN WO INVOICE IS BEING CREATED,02210099
019972*    LOOKUP THE STORE NUMBER ON THIS ARRAY TO SEE IF IT IS FOR    02220099
019973*    A DC.  IF SO, CREATED THE WO INVOICE WITH MTCH_LVL_CDE = 'D' 02230099
019974*    THIS CHANGE WILL PREVENT MATCH EXCEPTIONS WHERE INVOICES FOR 02240099
019975*    THE SAME PO HAVE DIFFERENT MATCH LEVELS.                     02250099
019980*    MADE BY: NANCY EILBES            WR/IR #: CHG0135860         02260099
019950*                                                                 02261099
019960* DATE  09/01/2021                                                02262099
019970*    CHANGE MADE: RECOMPILE FOR UPDATED VERSION OF APRD042        02263099
019980*    MADE BY: JEAN KURK               WR/IR #: CHG0260549         02269099
020000*-----------------------------------------------------------------02270099
020100   EJECT                                                          02280099
020200 ENVIRONMENT DIVISION.                                            02290099
020300 CONFIGURATION SECTION.                                           02300099
020400 SOURCE-COMPUTER.    IBM-3090.                                    02310099
020500 OBJECT-COMPUTER.    IBM-3090.                                    02320099
020600                                                                  02330099
020700 INPUT-OUTPUT SECTION.                                            02340099
020800 FILE-CONTROL.                                                    02350099
020900     SELECT UNJOURNALIZED-FILE   ASSIGN TO UT-S-INP01.            02360099
021000 EJECT                                                            02370099
021100 DATA DIVISION.                                                   02380099
021200 FILE SECTION.                                                    02390099
021300                                                                  02400099
021400 FD  UNJOURNALIZED-FILE                                           02410099
021500     RECORDING MODE IS F                                          02420099
021600     LABEL RECORDS ARE STANDARD                                   02430099
021700     BLOCK CONTAINS 0 RECORDS                                     02440099
021800     DATA RECORD IS UNJOURNALIZED-REC.                            02450099
021900 01  UNJOURNALIZED-REC.                                           02460099
022000     05  FILLER                       PIC  X(120).                02470099
022100                                                                  02480099
022200 EJECT                                                            02490099
022300 WORKING-STORAGE SECTION.                                         02500099
022400                                                                  02510099
022500 01  PV-PROGRAM-VARIABLES.                                        02520099
022600     05  FILLER                         PIC  X(30)  VALUE         02530099
022700         '** BEGINING OF APKUP032 W/S **'.                        02540099
022800                                                                  02550099
022900     05  PV-8V99                        PIC Z(8).99.              02560099
023000     05  PV-8V99-X REDEFINES                                      02570099
023100         PV-8V99                        PIC X(11).                02580099
023200     05  PV-8V99-SIGN                   PIC -Z(8).99.             02590099
023300     05  PV-8V99-SIGN-X REDEFINES                                 02600099
023400         PV-8V99-SIGN                   PIC X(12).                02610099
023500     05  WS-MAX-RETRIES                 PIC S9(4) COMP VALUE +10. 02620099
023600     05  PV-BTCH-TMST                   PIC  X(26)  VALUE SPACES. 02630099
023700     05  PV-POSTR.                                                02640099
023800         10  PV-PO-NBR                  PIC  X(09)  VALUE SPACES. 02650099
023900         10  PV-STR-NBR                 PIC  X(04)  VALUE SPACES. 02660099
024000     05  PV-PROCESS-PO-NBR              PIC S9(09)  VALUE ZEROS   02670099
024100                                                    COMP.         02680099
024200     05  PV-PROCESS-STR-NBR             PIC S9(04)  VALUE ZEROS   02690099
024300                                                    COMP.         02700099
024400     05  PV-STR-NBR-LOW                 PIC S9(04)  VALUE +0      02710099
024500                                                    COMP SYNC.    02720099
024600     05  PV-STR-NBR-HIGH                PIC S9(04)  VALUE +0      02730099
024700                                                    COMP SYNC.    02740099
024710     05  PV-COMPARE-STR-NBR             PIC 9(05).                02750099
024800     05  PV-PAYT-REQ-SEQ-NBR            PIC S9(09)  VALUE ZEROS   02760099
024900                                                    COMP.         02770099
025000     05  PV-PO-LNE-NBR                  PIC S9(09)  VALUE ZEROS.  02780099
025100     05  PV-PO-LNE-NBR-9                PIC  9(09)  VALUE ZEROS.  02790099
025200     05  PV-REC-SEQ-NBR                 PIC S9(09)  VALUE ZEROS.  02800099
025300     05  PV-REC-SEQ-NBR-9               PIC  9(09)  VALUE ZEROS.  02810099
025400     05  PV-PAYT-REQ-SEQ-NBR9           PIC S9(09)  VALUE ZEROS.  02820099
025500     05  PV-GRO-COST-AMT                PIC S9(8)V9(2)            02830099
025600                                            VALUE ZEROS COMP-3.   02840099
025700     05  PV-INVC-ID                     PIC  X(22)  VALUE SPACES. 02850099
025800     05  PV-VND-NBR                     PIC  9(09).               02860099
025900     05  PV-ACCUM-RCV-COST              PIC S9(11)V99             02870099
026000                                            VALUE ZEROS COMP-3.   02880099
026100     05  PV-ACCUM-RCV-QTY               PIC S9(07)                02890099
026200                                            VALUE ZEROS COMP-3.   02900099
026300                                                                  02910099
026400     05  PV-WO-INV-ID.                                            02920099
026500         10  PV-INV-ID-WO        PIC  X(02)   VALUE 'WO'.         02930099
026600         10  PV-INV-ID9-WO       PIC  X(09)   VALUE SPACES.       02940099
026700     05  PV-WONIR-INV-ID.                                         02950099
026800         10  PV-INV-ID-WONIR     PIC  X(05)   VALUE 'WONIR'.      02960099
026900         10  PV-INV-ID9-WONIR    PIC  X(09)   VALUE SPACES.       02970099
027000                                                                  02980099
027100     05  PV-COMPARE-MKDATE       PIC  X(10) VALUE SPACES.         02990099
027200*        10  PV-CMPR-MKDT-CC     PIC  9(02).                      03000099
027300*        10  PV-CMPR-MKDT-YY     PIC  9(02).                      03010099
027400*        10  PV-CMPR-MKDT-MM     PIC  9(02).                      03020099
027500*        10  PV-CMPR-MKDT-DD     PIC  9(02).                      03030099
027600     05  PV-WO-CUTOFF-DATE       PIC  X(10) VALUE SPACES.         03040099
027700*        10  PV-CUTOFF-CC        PIC  9(02).                      03050099
027800*        10  PV-CUTOFF-YY        PIC  9(02).                      03060099
027900*        10  PV-CUTOFF-MM        PIC  9(02).                      03070099
028000*        10  PV-CUTOFF-DD        PIC  9(02).                      03080099
028100     05  PV-RESULT-DATE          PIC  X(10) VALUE SPACES.         03090099
028200                                                                  03100099
028300 01  PC-PROGRAM-CONSTANTS.                                        03110099
028400     05  PC-PROGRAM-NAME            PIC  X(08)  VALUE 'APKUP032'. 03120099
028500     05  PC-IN-PROCESS-CODE         PIC  X(01)  VALUE '9'.        03130099
028600     05  PC-RUN-COMPLETE-CODE       PIC  X(01)  VALUE '0'.        03140099
028700                                                                  03150099
028800 01  PROGRAM-SWITCHES.                                            03160099
028900                                                                  03170099
029000     05  PS-COMMITS-TAKEN-SW        PIC X(01) VALUE 'N'.          03180099
029100         88  COMMITS-TAKEN                    VALUE 'Y'.          03190099
029200         88  NO-COMMITS-TAKEN                 VALUE 'N'.          03200099
029300     05  PS-END-OF-RECEIPTS-SW      PIC X(01) VALUE 'N'.          03210099
029400         88  END-OF-RECEIPTS                  VALUE 'Y'.          03220099
029500         88  MORE-UNJOURNALIZED               VALUE 'N'.          03230099
029600     05  PS-OUT-OF-INVOICES-SW      PIC X(01) VALUE 'N'.          03240099
029700         88  OUT-OF-INVOICES                  VALUE 'Y'.          03250099
029800         88  MORE-INVOICES                    VALUE 'N'.          03260099
029810     05  WS-LOCATION-CSR-SW         PIC X(1)  VALUE 'N'.          03270099
029820         88  END-OF-LOC-CSR                   VALUE 'Y'.          03280099
029830         88  NOT-END-OF-LOC-CSR               VALUE 'N'.          03290099
029900     05  PS-NEW-POSTR-SW            PIC X(01) VALUE 'N'.          03300099
030000         88  NEW-POSTR                        VALUE 'Y'.          03310099
030100         88  SAME-POSTR                       VALUE 'N'.          03320099
030200     05  PS-PO-TYPE-SW              PIC X(01) VALUE 'N'.          03330099
030300         88  BULK-PO                          VALUE 'P'.          03340099
030400         88  STORE-PO                         VALUE 'S'.          03350099
030410         88  DC-PO                            VALUE 'D'.          03360099
030500     05  PS-DATE-SW                 PIC X(01) VALUE 'N'.          03370099
030600         88  VALID-DATE                       VALUE 'Y'.          03380099
030700         88  NOT-VALID-DATE                   VALUE 'N'.          03390099
030800     05  ORIG-RCVR-SW               PIC X(01) VALUE 'N'.          03400099
030900         88  ORIG-RCVR-FOUND                  VALUE 'Y'.          03410099
031000         88  ORIG-RCVR-NOT-FOUND              VALUE 'N'.          03420099
031100     05  END-OF-CURSOR-SW           PIC X(01) VALUE 'N'.          03430099
031200         88  END-OF-CURSOR                    VALUE 'Y'.          03440099
031300         88  NOT-END-OF-CURSOR                VALUE 'N'.          03450099
031400     05  RECEIVER-QUALIFIED-SW      PIC X(01) VALUE 'N'.          03460099
031500         88  ALL-RECEIVERS-QUALIFY            VALUE 'Y'.          03470099
031600         88  RCVR-NOT-QUALIFIED               VALUE 'N'.          03480099
031610     05  INSERT-SUCCESSFUL-SW       PIC X(01) VALUE 'N'.          03490099
031620         88  INSERT-SUCCESSFUL                VALUE 'Y'.          03500099
031630         88  INSERT-NOT-SUCCESSFUL            VALUE 'N'.          03510099
031700 EJECT                                                            03520099
031800 01  RECORD-COUNTS.                                               03530099
031900     05  READ-COUNT-DISP           PIC Z9(09)    VALUE ZEROS.     03540099
032000     05  BYPASS-COUNT-DISP         PIC Z9(09)    VALUE ZEROS.     03550099
032100     05  INVC-ADDED-COUNT-DISP     PIC Z9(09)    VALUE ZEROS.     03560099
032200     05  INVC-DELETED-COUNT-DISP   PIC Z9(09)    VALUE ZEROS.     03570099
032300     05  TOUTAP3-ROWS-COUNT-DISP   PIC Z9(09)    VALUE ZEROS.     03580099
032400     05  WS-INSERT-INVC-RETRY-COUNTER                             03590099
032410                                   PIC S9(04)    COMP VALUE ZEROS.03600099
032500     05  READ-COUNTER              PIC S9(09)    VALUE ZEROS.     03610099
032600     05  BYPASS-COUNTER            PIC S9(09)    VALUE ZEROS.     03620099
032700     05  INVOICE-ADD-COUNTER       PIC S9(09)    VALUE ZEROS.     03630099
032800     05  TOUTAP3-ROWS-COUNTER      PIC S9(09)    VALUE ZEROS.     03640099
032900     05  INVOICE-DELETE-COUNTER    PIC S9(09)    VALUE ZEROS.     03650099
033000     05  QUALIFIED-RCV-COUNTER     PIC S9(09)    VALUE ZEROS.     03660099
033100*    COUNTS SINCE THE LAST COMMIT                                 03670099
033200 01  RECORD-COUNTS-PER-COMMIT.                                    03680099
033300     05  READ-COUNTER-C            PIC S9(09)    VALUE ZEROS.     03690099
033400     05  BYPASS-COUNTER-C          PIC S9(09)    VALUE ZEROS.     03700099
033500     05  INVOICE-ADD-COUNTER-C     PIC S9(09)    VALUE ZEROS.     03710099
033600     05  INVOICE-DELETE-COUNTER-C  PIC S9(09)    VALUE ZEROS.     03720099
033700                                                                  03730099
034200 01  WS-SQLCODE                    PIC S9(9) COMP-4 VALUE ZERO.   03740099
034300 01  WS-SQLWARN0                   PIC X.                         03750099
034400 01  WS-RETRY-COUNTER              PIC S9(4) COMP VALUE ZERO.     03760099
034500 01  WS-DISPLAY-RETRY-COUNTER      PIC 9(9)  VALUE ZEROS.         03770099
034600 01  WS-STR-NBR                    PIC 9(4)  VALUE ZEROS.         03780099
034700                                                                  03790099
034800                                                                  03800099
034900 01  WS-TIMESTAMP            PIC X(26)     VALUE SPACES.          03810099
035000 01  FILLER REDEFINES WS-TIMESTAMP.                               03820099
035100     05  FILLER              PIC X(14).                           03830099
035200     05  WS-MINUTE           PIC X(02).                           03840099
035300     05  FILLER              PIC X(02).                           03850099
035400     05  WS-SECOND           PIC X(01).                           03860099
035500     05  FILLER              PIC X(01).                           03870099
035600     05  WS-NANOSEC-1-3      PIC X(03).                           03880099
035700     05  WS-NANOSEC-4-6      PIC X(03).                           03890099
035800                                                                  03900099
035900 01  WS-RANDOM-KEY           PIC 9(09)     VALUE 0.               03910099
036000 01  FILLER REDEFINES WS-RANDOM-KEY.                              03920099
036100     05  WS-RND-NANOSEC-4-6  PIC X(03).                           03930099
036200     05  WS-RND-NANOSEC-1-3  PIC X(03).                           03940099
036300     05  WS-RND-MINUTE       PIC X(02).                           03950099
036400     05  WS-RND-SECOND       PIC X(01).                           03960099
036500                                                                  03970099
036600 01  WS-RANDOM-KEY-COMP      PIC S9(09)    VALUE 0 COMP.          03980099
036700 01  CR-CHECKPOINT-RESTART-AREA.                                  03990099
036800     05  CR-CKPT-STAT-CODE        PIC  X(01)   VALUE SPACE.       04000099
036900         88  NORMAL-RUN                        VALUE '0'.         04010099
037000         88  RESTART-RUN                       VALUE '9'.         04020099
037100     05  CR-CKPT-RESTART-INFO.                                    04030099
037200         10  CR-PO-NBR            PIC  9(09)   VALUE ZEROS.       04040099
037300         10  CR-STR-NBR           PIC  9(04)   VALUE ZEROS.       04050099
037400         10  CR-READ-COUNTER      PIC  9(09)   VALUE ZEROS.       04060099
037500         10  CR-BYPASS-COUNTER    PIC  9(09)   VALUE ZEROS.       04070099
037600         10  CR-INSRT-INV-COUNT   PIC  9(09)   VALUE ZEROS.       04080099
037700         10  CR-DEL-INV-COUNT     PIC  9(09)   VALUE ZEROS.       04090099
037800     05  CKPT-RESTART-TMST.                                       04100099
037900         10  CR-NEXT-TMST         PIC  X(26)   VALUE SPACES.      04110099
038000         10  CR-CURR-TMST         PIC  X(26)   VALUE SPACES.      04120099
038100                                                                  04130099
CHG981 01  ZC-IDX-MAX                   PIC 9(5)  VALUE 99999.          04140099
038300 01  WS-TABLE-AREA.                                               04150099
038400     05  WS-ZERO-COST-INFO-AREA.                                  04160099
CHG981         10  WS-ZERO-COST-TBL    OCCURS 99999 TIMES               04170099
038600                                   INDEXED BY ZC-IDX.             04180099
038700             15  WS-ZC-PO-NBR               PIC S9(9) COMP.       04190099
038800             15  WS-ZC-STR-NBR              PIC S9(4) COMP.       04200099
038900             15  WS-ZC-PO-LNE-NBR           PIC S9(9) COMP.       04210099
039000             15  WS-ZC-RCV-TYP-CDE          PIC X(01).            04220099
039100             15  WS-ZC-REC-SEQ-NBR          PIC S9(9) COMP.       04230099
039200                                                                  04240099
039201 01  PC-LOC-TBL-MAX                PIC S9(09) COMP SYNC           04250099
039202                                              VALUE +50.          04260099
039203 01  PV-STORE-DIGITS               PIC X(5)   VALUE ZERO.         04270099
039210 01  WS-LOCATION-TABLE-AREA.                                      04280099
039220     05 WS-LOCATION-TABLE OCCURS 90 TIMES INDEXED BY LOC-INDX.    04290099
039230        10  WS-STORE-NBR           PIC 9(05).                     04300099
039300                                                                  04310099
039400 EJECT                                                            04320099
039500*---------------------------------------------------------------  04330099
039600*  UNJOURNALIZED RECEIPT EXTRACT RECORD - INTRANSIT               04340099
039700*---------------------------------------------------------------  04350099
039800     COPY APRD042.                                                04360099
039900*---------------------------------------------------------------  04370099
040000*  RECEIVING TABLES STATUS UPDATE RECORD LAYOUT                   04380099
040100*---------------------------------------------------------------  04390099
040200     COPY APRD254.                                                04400099
040300*---------------------------------------------------------------  04410099
040400*  AUDIT TABLE WORK AREA                                          04420099
040500*---------------------------------------------------------------  04430099
040600 EJECT                                                            04440099
040700*----------------------------------------------------------------*04450099
040800* WORKING STORAGE FOR DATE ROUTINE                                04460099
040900*----------------------------------------------------------------*04470099
041000     COPY DPWS500.                                                04480099
041100 EJECT                                                            04490099
041200*---------------------------------------------------------------  04500099
041300*  COMMUNICATIONS AREA2 FOR DB2                                   04510099
041400*---------------------------------------------------------------  04520099
041500     COPY SQLCA2.                                                 04530099
041600                                                                  04540099
041700     EXEC SQL                                                     04550099
041800          INCLUDE SQLCA                                           04560099
041900     END-EXEC.                                                    04570099
042000 EJECT                                                            04580099
042100*---------------------------------------------------------------  04590099
042200*  ACCOUNTS PAYABLE CONTROL TABLE                                 04600099
042300*---------------------------------------------------------------  04610099
042400     EXEC SQL                                                     04620099
042500          INCLUDE TAPCNTL                                         04630099
042600     END-EXEC.                                                    04640099
042700 EJECT                                                            04650099
043500*---------------------------------------------------------------  04660099
043600*  INVOICE TABLE                                                  04670099
043700*---------------------------------------------------------------  04680099
043800     EXEC SQL                                                     04690099
043900          INCLUDE TINVOIC                                         04700099
044000     END-EXEC.                                                    04710099
044100 EJECT                                                            04720099
044200*---------------------------------------------------------------  04730099
044300*  ACCOUNT PAYABLE MERCHANDISE INVOICES                           04740099
044400*---------------------------------------------------------------  04750099
044500     EXEC SQL                                                     04760099
044600          INCLUDE TMDINVC                                         04770099
044700     END-EXEC.                                                    04780099
044800 EJECT                                                            04790099
044900*---------------------------------------------------------------  04800099
045000*  ACCOUNT PAYABLE- INVOICE PAYMENT TERMS                         04810099
045100*---------------------------------------------------------------  04820099
045200     EXEC SQL                                                     04830099
045300          INCLUDE TINVCTM                                         04840099
045400     END-EXEC.                                                    04850099
045500 EJECT                                                            04860099
046300*---------------------------------------------------------------  04870099
046400*  RECEIVER DISTRIBUTION TABLE                                    04880099
046500*---------------------------------------------------------------  04890099
046600     EXEC SQL                                                     04900099
046700          INCLUDE TRECDIS                                         04910099
046800     END-EXEC.                                                    04920099
046900 EJECT                                                            04930099
047000*---------------------------------------------------------------  04940099
047100*  AP OUTPUT NUMBER 3 TABLE                                       04950099
047200*---------------------------------------------------------------  04960099
047300     EXEC SQL                                                     04970099
047400          INCLUDE TOUTAP3                                         04980099
047500     END-EXEC.                                                    04990099
047600 EJECT                                                            05000099
047700*---------------------------------------------------------------  05010099
047800*  CHECKPOINT/RESTART CONTROL TABLE                               05020099
047900*---------------------------------------------------------------  05030099
048000     EXEC SQL                                                     05040099
048100         INCLUDE TCKRSTCN                                         05050099
048200     END-EXEC.                                                    05060099
048300 EJECT                                                            05070099
048400*---------------------------------------------------------------  05080099
048500*  CHECKPOINT/RESTART DATA TABLE                                  05090099
048600*---------------------------------------------------------------  05100099
048700     EXEC SQL                                                     05110099
048800         INCLUDE TCKRSTIN                                         05120099
048900     END-EXEC.                                                    05130099
049000 EJECT                                                            05140099
049010*---------------------------------------------------------------  05150099
049020*  LOCATION DATABASE                                              05160099
049030*---------------------------------------------------------------  05170099
049040     EXEC SQL                                                     05180099
049050         INCLUDE XFT00017                                         05190099
049060     END-EXEC.                                                    05200099
049070 EJECT                                                            05210099
049100*----------------------------------------------------------------*05220099
049200* BULK INVOICE CURSOR                                             05230099
049300*     THIS CURSOR IS USED TO CHECK THE INVOICE TABLE TO SEE IF    05240099
049400*     THERE ARE UNPAID INVOICES FOR THE BULK PO BEING PROCESSED.  05250099
049500*----------------------------------------------------------------*05260099
049600     EXEC SQL                                                     05270099
049700         DECLARE BULK_INVOICE_CSR CURSOR FOR                      05280099
049800             SELECT  INVC_ID                                      05290099
049900                    ,PAYT_REQ_SEQ_NBR                             05300099
050000                    ,GRO_COST_AMT                                 05310099
050100                 FROM   TINVOIC                                   05320099
050200                 WHERE PO_NBR           = :PV-PROCESS-PO-NBR      05330099
050300                 AND   STR_NBR BETWEEN    :PV-STR-NBR-LOW         05340099
050400                                      AND :PV-STR-NBR-HIGH        05350099
050500                 AND   STATUS_CDE       IN ('EN','RC','OB','IB')  05360099
050600                 AND   INVC_TYP_CDE     IN ('MI','RI','WO')       05370099
050700     END-EXEC.                                                    05380099
050800 EJECT                                                            05390099
050900*----------------------------------------------------------------*05400099
051000* BY STORE INVOICE CURSOR                                         05410099
051100*     THIS CURSOR IS USED TO CHECK THE INVOICE TABLE TO SEE IF    05420099
051200*     THERE ARE UNPAID INVOICES FOR THE BY STORE PO BEING         05430099
051300*     PROCESSED.                                                  05440099
051400*----------------------------------------------------------------*05450099
051500     EXEC SQL                                                     05460099
051600         DECLARE BYSTR_INVOICE_CSR CURSOR FOR                     05470099
051700             SELECT  INVC_ID                                      05480099
051800                    ,PAYT_REQ_SEQ_NBR                             05490099
051900                    ,GRO_COST_AMT                                 05500099
052000                 FROM   TINVOIC                                   05510099
052100                 WHERE PO_NBR           = :PV-PROCESS-PO-NBR      05520099
052200                 AND   ((STR_NBR        = :PV-STR-NBR-HIGH)       05530099
052300                         OR (STR_NBR    = 0))                     05540099
052400                 AND   STATUS_CDE       IN ('EN','RC','OB','IB')  05550099
052500                 AND   INVC_TYP_CDE     IN ('MI','RI','WO')       05560099
052600     END-EXEC.                                                    05570099
052700 EJECT                                                            05580099
052701*--------------------------------------------------------------*  05590099
052702* LOCATION CURSOR: RETURNS THE LOCATION NUMBERS FOR ALL THAT   *  05600099
052703* HAVE TYPE DC.                                                *  05610099
052705*--------------------------------------------------------------*  05620099
052706     EXEC SQL                                                     05630099
052707          DECLARE LOCATION_CSR CURSOR FOR                         05640099
052708            SELECT DIGITS(LOC_NBR)                                05650099
052710              FROM XFT_LOC                                        05660099
052711             WHERE LOC_TYP_CDE IN ('DC')                          05670099
052712               AND CURRENT DATE <= FINCL_CLO_DTE                  05680099
052713     END-EXEC.                                                    05690099
052720 EJECT                                                            05700099
052800*---------------------------------------------------------------  05710099
052900*  ABEND DATA AREAS                                               05720099
053000*---------------------------------------------------------------  05730099
053100 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          05740099
053200                                             COMP SYNC.           05750099
053300     88  AC-TABLE-FULL                       VALUE +4004.         05760099
053400     88  AC-DB2-ERROR                        VALUE +4013.         05770099
053500     88  AC-DATE-ERROR                       VALUE +4019.         05780099
053600                                                                  05790099
053700 01  ABEND-AREAS.                                                 05800099
053800     05  AA-ABEND-LIT            PIC  X(40)  VALUE                05810099
053900             '*****       ABEND'.                                 05820099
054000     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                05830099
054100             '*****   PROGRAM: APKUP032'.                         05840099
054200     05  AA-PARAGRAPH-LIT.                                        05850099
054300         10  FILLER              PIC  X(17)  VALUE                05860099
054400             '***** PARAGRAPH: '.                                 05870099
054500         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        05880099
054600     05  AA-MESSAGE-LINE.                                         05890099
054700         10  FILLER              PIC  X(06)  VALUE '*****'.       05900099
054800         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        05910099
054900     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                05920099
055000             '*****    DB2 ERROR'.                                05930099
055100     05  AA-DB2-OPERATION-LIT.                                    05940099
055200         10  FILLER              PIC  X(17)  VALUE                05950099
055300             '***** OPERATION: '.                                 05960099
055400         10  AA-DB2-OPERATION.                                    05970099
055500             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        05980099
055600             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        05990099
055700     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        06000099
055800     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        06010099
055900     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        06020099
056000                                                                  06030099
056100     COPY DPWS004.                                                06040099
056200                                                                  06050099
056300 01  FILLER                      PIC  X(25)  VALUE                06060099
056400     '** END OF APKUP032 W/S **'.                                 06070099
056500 EJECT                                                            06080099
056600 PROCEDURE DIVISION.                                              06090099
056700 A100-MAIN.                                                       06100099
056800     PERFORM B100-INITIALIZE.                                     06110099
056900                                                                  06120099
057000     PERFORM B200-PROCESS-UNJOURNALIZED                           06130099
057100         UNTIL END-OF-RECEIPTS.                                   06140099
057200                                                                  06150099
057300     PERFORM B300-END-PROGRAM.                                    06160099
057400                                                                  06170099
057500     GOBACK.                                                      06180099
057600 EJECT                                                            06190099
057700*---------------------------------------------------------------  06200099
057800*    INITIALIZATION PROCESSING                                    06210099
057900*    -GETS THE UNJRNLZED WRITE-OFF CUTOFF DAYS                    06220099
058000*    -CALCULATES THE CUTOFF DATE                                  06230099
058100*    -SETS THE CURRENT TIMESTAMP                                  06240099
058200*    -SETUP FOR CHECKPOINT RESTART                                06250099
058300*    -INITIAL READ                                                06260099
058400*---------------------------------------------------------------  06270099
058500 B100-INITIALIZE.                                                 06280099
058600                                                                  06290099
058700     OPEN INPUT  UNJOURNALIZED-FILE.                              06300099
058800                                                                  06310099
058900     PERFORM H100-INIT-ZERO-COST-INFO-TABLE.                      06320099
059000                                                                  06330099
059100     INITIALIZE DCLTAPCNTL                                        06340099
059300                DCLTINVOIC                                        06350099
059400                DCLTMDINVC                                        06360099
059500                DCLTINVCTM                                        06370099
059700                DCLTRECDIS                                        06380099
059800                DCLTOUTAP3                                        06390099
059900                DCLTCKRSTCNTL                                     06400099
060000                DCLTCKRSTINF.                                     06410099
060100                                                                  06420099
060200     PERFORM R100-SELECT-CONTROL-DATA.                            06430099
060300                                                                  06440099
060311     PERFORM VARYING LOC-INDX FROM 1 BY 1                         06450099
060312       UNTIL LOC-INDX > PC-LOC-TBL-MAX                            06460099
060313           MOVE ZEROES TO WS-STORE-NBR(LOC-INDX)                  06470099
060315     END-PERFORM.                                                 06480099
060316                                                                  06490099
060317     PERFORM X100-OPEN-LOCATION-CSR.                              06500099
060318                                                                  06510099
060320     PERFORM X200-LOAD-LOCATION-TBL                               06520099
060321     VARYING LOC-INDX FROM 1 BY 1                                 06530099
060322       UNTIL LOC-INDX > PC-LOC-TBL-MAX                            06540099
060323          OR END-OF-LOC-CSR.                                      06550099
060324                                                                  06560099
060325     IF LOC-INDX > PC-LOC-TBL-MAX                                 06570099
060326        MOVE 'B100-INITIALIZE'        TO AA-PARAGRAPH-NAME        06580099
060328        MOVE 'LOCATION TABLE IS FULL' TO AA-MESSAGE               06590099
060330        SET AC-TABLE-FULL             TO TRUE                     06600099
060331        PERFORM Z999-ABEND                                        06610099
060332     END-IF.                                                      06620099
060333                                                                  06630099
060334     PERFORM X300-CLOSE-LOCATION-CSR.                             06640099
060340                                                                  06650099
060400     PERFORM C400-CALC-WO-CUTOFF-DATE.                            06660099
060500                                                                  06670099
060600     PERFORM R600-SET-CURRENT-TMST.                               06680099
060700                                                                  06690099
060800     PERFORM R800-SELECT-CHECKPOINT-CNTL.                         06700099
060900     IF RESTART-RUN                                               06710099
061000         PERFORM R900-SELECT-CHECKPOINT-INFO                      06720099
061100         MOVE TCKRSTINF-WORK-STRG-DESC-TEXT                       06730099
061200                                    TO CR-CKPT-RESTART-INFO       06740099
061300                                                                  06750099
061400         DISPLAY '** APKUP032 CHECKPOINT RESTART **'              06760099
061500         DISPLAY '** PO NUMBER ON RESTART = '  CR-PO-NBR          06770099
061600         DISPLAY '** STR NUMBER ON RESTART= '  CR-STR-NBR         06780099
061700         DISPLAY '***********************************************'06790099
061800                                                                  06800099
061900         PERFORM R200-READ-UNJOURNALIZED                          06810099
062000             UNTIL END-OF-RECEIPTS                                06820099
062100                OR (AP042-PO-NBR   >  CR-PO-NBR)                  06830099
062200                OR (AP042-PO-NBR   =  CR-PO-NBR                   06840099
062300               AND AP042-STR-NBR   >  CR-STR-NBR)                 06850099
062400                                                                  06860099
062500                                                                  06870099
062600         MOVE ZERO                  TO READ-COUNTER-C             06880099
062700                                       BYPASS-COUNTER-C           06890099
062800                                       INVOICE-ADD-COUNTER-C      06900099
062900                                       INVOICE-DELETE-COUNTER-C   06910099
063000                                                                  06920099
063100         MOVE CR-READ-COUNTER       TO READ-COUNTER               06930099
063200         MOVE CR-BYPASS-COUNTER     TO BYPASS-COUNTER             06940099
063300         MOVE CR-INSRT-INV-COUNT    TO INVOICE-ADD-COUNTER        06950099
063400         MOVE CR-DEL-INV-COUNT      TO INVOICE-DELETE-COUNTER     06960099
063500                                                                  06970099
063600     ELSE                                                         06980099
063700                                                                  06990099
063800*---------------------------------------------------------------  07000099
063900* THE FIRST READ SHOULD ALWAYS RETURN A RECORD.  IT WOULD HAVE    07010099
064000* TO BE AN EXCEPTIONAL SITUATION IF THERE WERE NO PO'S UNJRNLZD   07020099
064100*---------------------------------------------------------------  07030099
064200                                                                  07040099
064300         PERFORM R200-READ-UNJOURNALIZED                          07050099
064400                                                                  07060099
064500         IF END-OF-RECEIPTS                                       07070099
064600             DISPLAY '*****************************************'  07080099
064700             DISPLAY 'B100-INITIALIZE'                            07090099
064800             DISPLAY 'EMPTY UNJOURNALIZED FILE'                   07100099
064900             DISPLAY 'EMPTY UNJOURNALIZED FILE'                   07110099
065000             DISPLAY 'EMPTY UNJOURNALIZED FILE'                   07120099
065100         END-IF                                                   07130099
065200                                                                  07140099
065300     END-IF.                                                      07150099
065400                                                                  07160099
065500     MOVE ZERO            TO  PV-ACCUM-RCV-COST.                  07170099
065600     MOVE ZERO            TO  PV-ACCUM-RCV-QTY.                   07180099
065700     MOVE AP042-PO-NBR    TO  PV-PO-NBR.                          07190099
065800     MOVE AP042-STR-NBR   TO  PV-STR-NBR.                         07200099
065900                                                                  07210099
066000 EJECT                                                            07220099
066100                                                                  07230099
066200*---------------------------------------------------------------  07240099
066300*    CONTROLS THE PROCESSING OF EACH PO/STORE COMBINATION.        07250099
066400*   -REFORMAT THE DATE.                                           07260099
066500*   -CHECK STORE NO TO DETERMINE IF PO IS BY-STORE OR BULK.       07270099
066600*   -CREATE AN INVOICE FOR EACH ELIGIBLE PO/STORE IF THE ACCUM    07280099
066700*    GRO COST IS > ZERO.                                          07290099
066800*   -CREATE UPDATE RECS FOR EACH ELIGIBLE PO/STORE IF THE ACCUM   07300099
066900*    GRO COST IS = ZERO.                                          07310099
067000*   -EXECUTION OF THIS PARAGRAPH BEGINS WHEN THERE IS A NEW PO    07320099
067100*    STORE, THEREFORE RESET THE RECEIVERS QUALIFIED SW UPON       07330099
067200*    ENTERING.                                                    07340099
067300*---------------------------------------------------------------  07350099
067400 B200-PROCESS-UNJOURNALIZED.                                      07360099
067500                                                                  07370099
067600     SET ORIG-RCVR-NOT-FOUND   TO TRUE.                           07380099
067700     SET ALL-RECEIVERS-QUALIFY TO TRUE.                           07390099
067800     SET ZC-IDX                TO 1.                              07400099
067900     MOVE ZERO            TO PV-ACCUM-RCV-COST.                   07410099
068000     MOVE ZERO            TO PV-ACCUM-RCV-QTY.                    07420099
068100     MOVE ZERO            TO QUALIFIED-RCV-COUNTER.               07430099
068200     MOVE AP042-PO-NBR    TO PV-PO-NBR.                           07440099
068300     MOVE AP042-STR-NBR   TO PV-STR-NBR.                          07450099
068400     MOVE AP042-VRFD-DTE  TO PV-COMPARE-MKDATE.                   07460099
068500                                                                  07470099
068560                                                                  07480099
068600     IF PV-STR-NBR = ZEROES                                       07490099
068700        SET BULK-PO       TO TRUE                                 07500099
068800     ELSE                                                         07510099
068802         MOVE PV-STR-NBR TO PV-COMPARE-STR-NBR                    07520099
068810         PERFORM VARYING LOC-INDX FROM 1 BY 1                     07530099
068820           UNTIL WS-STORE-NBR(LOC-INDX) = PV-COMPARE-STR-NBR      07540099
068830              OR WS-STORE-NBR(LOC-INDX) = ZEROES                  07550099
068840              OR LOC-INDX > 50                                    07560099
068850         END-PERFORM                                              07570099
068860         IF WS-STORE-NBR(LOC-INDX) = PV-COMPARE-STR-NBR           07580099
068870            SET DC-PO     TO TRUE                                 07590099
068880         ELSE                                                     07600099
068900            SET STORE-PO  TO TRUE                                 07610099
069000     END-IF.                                                      07620099
069100                                                                  07630099
069200     IF BULK-PO                                                   07640099
069300        PERFORM C100-CHECK-FOR-WRITEOFF                           07650099
069400                UNTIL AP042-PO-NBR > PV-PO-NBR                    07660099
069500                   OR END-OF-RECEIPTS                             07670099
069600     ELSE                                                         07680099
069700        PERFORM C100-CHECK-FOR-WRITEOFF                           07690099
069800                UNTIL (AP042-PO-NBR = PV-PO-NBR                   07700099
069900                       AND AP042-STR-NBR > PV-STR-NBR)            07710099
070000                   OR AP042-PO-NBR > PV-PO-NBR                    07720099
070100                   OR END-OF-RECEIPTS                             07730099
070200     END-IF.                                                      07740099
070300                                                                  07750099
070400     IF ALL-RECEIVERS-QUALIFY                                     07760099
070500        IF PV-ACCUM-RCV-COST = ZERO                               07770099
070600           PERFORM F200-PROCESS-ZERO-CST-INFO-TBL                 07780099
070700                   VARYING ZC-IDX FROM 1 BY 1                     07790099
070800                   UNTIL ZC-IDX > ZC-IDX-MAX OR                   07800099
070900                         WS-ZC-PO-NBR(ZC-IDX) = ZEROS             07810099
071000           PERFORM C300-CHECKPOINT                                07820099
071100        ELSE                                                      07830099
071200           IF PV-ACCUM-RCV-COST > ZERO                            07840099
071300              PERFORM C200-CREATE-INVOICE                         07850099
071400              PERFORM C300-CHECKPOINT                             07860099
071500           ELSE                                                   07870099
071600              ADD QUALIFIED-RCV-COUNTER TO BYPASS-COUNTER-C       07880099
071700           END-IF                                                 07890099
071800        END-IF                                                    07900099
071900     ELSE                                                         07910099
072000        ADD QUALIFIED-RCV-COUNTER TO BYPASS-COUNTER-C             07920099
072100     END-IF.                                                      07930099
072200                                                                  07940099
072300     PERFORM H100-INIT-ZERO-COST-INFO-TABLE.                      07950099
072400                                                                  07960099
072500 EJECT                                                            07970099
072600                                                                  07980099
072700*---------------------------------------------------------------  07990099
072800*    ENDING PROCESSING: DISPLAYS COUNT OF POS AND CLOSES FILES.   08000099
072900*---------------------------------------------------------------  08010099
073000 B300-END-PROGRAM.                                                08020099
073100                                                                  08030099
073200     CLOSE  UNJOURNALIZED-FILE.                                   08040099
073300                                                                  08050099
073400     MOVE PC-RUN-COMPLETE-CODE TO CR-CKPT-STAT-CODE.              08060099
073500     MOVE ZERO                 TO CR-CKPT-RESTART-INFO.           08070099
073600     PERFORM U300-UPDATE-CHECKPOINT-CNTL.                         08080099
073700     PERFORM D400-CHECKPOINT-COMMIT.                              08090099
073800                                                                  08100099
073900     MOVE READ-COUNTER TO READ-COUNT-DISP.                        08110099
074000     MOVE BYPASS-COUNTER TO BYPASS-COUNT-DISP.                    08120099
074100     MOVE INVOICE-ADD-COUNTER    TO INVC-ADDED-COUNT-DISP.        08130099
074200     MOVE TOUTAP3-ROWS-COUNTER   TO TOUTAP3-ROWS-COUNT-DISP.      08140099
074300     MOVE INVOICE-DELETE-COUNTER TO INVC-DELETED-COUNT-DISP.      08150099
074400                                                                  08160099
074500     DISPLAY '*****   RECORD COUNTS FROM APKUP032    ******'.     08170099
074600     DISPLAY '---------------------------------------------'.     08180099
074700     DISPLAY 'CALCULATED CUTOFF DATE ' PV-WO-CUTOFF-DATE.         08190099
074800     DISPLAY '---------------------------------------------'.     08200099
074900     DISPLAY 'UNJOURNALIZED READ         = ' READ-COUNT-DISP.     08210099
075000     DISPLAY '                                             '.     08220099
075100     DISPLAY 'UNJOURNALIZED BYPASSED     = ' BYPASS-COUNT-DISP.   08230099
075200     DISPLAY 'TOUTAP3 ROWS INSERTED = ' TOUTAP3-ROWS-COUNT-DISP.  08240099
075300     DISPLAY 'INVOICES INSERTS      = ' INVC-ADDED-COUNT-DISP.    08250099
075400     DISPLAY '                                             '.     08260099
075500     DISPLAY 'INVOICES DELETED      = ' INVC-DELETED-COUNT-DISP.  08270099
075600     DISPLAY '---------------------------------------------'.     08280099
075700                                                                  08290099
075800 EJECT                                                            08300099
075900                                                                  08310099
076000*---------------------------------------------------------------  08320099
076100*   -COMPARE DATES TO SEE IF ELIGIBLE FOR WRITE0FF                08330099
076200*   -IF YES, ACCUM GRO COST AND QTY FOR THAT PO/STORE             08340099
076300*   -IF NO, BYPASS RECORD.                                        08350099
076400*---------------------------------------------------------------  08360099
076500 C100-CHECK-FOR-WRITEOFF.                                         08370099
076600                                                                  08380099
076700     IF PV-COMPARE-MKDATE <= PV-WO-CUTOFF-DATE                    08390099
076800       AND ALL-RECEIVERS-QUALIFY                                  08400099
076900        ADD  AP042-CALCD-VRFD-COST-AMT  TO PV-ACCUM-RCV-COST      08410099
077000        ADD  AP042-PO-VRFD-QTY          TO PV-ACCUM-RCV-QTY       08420099
077100        MOVE AP042-VND-NBR              TO PV-VND-NBR             08430099
077200        PERFORM F100-FILL-ZERO-COST-INFO-TABLE                    08440099
077300        IF ZC-IDX > ZC-IDX-MAX                                    08450099
077400           MOVE 'F100-FILL-ZERO-COST-INFO-TABLE'                  08460099
077500                                      TO AA-PARAGRAPH-NAME        08470099
077600           MOVE 'ZERO COST INFO TABLE IS FULL'                    08480099
077700                                      TO AA-MESSAGE               08490099
077800           SET AC-TABLE-FULL          TO TRUE                     08500099
077900           PERFORM Z999-ABEND                                     08510099
078000        END-IF                                                    08520099
078100        ADD 1 TO QUALIFIED-RCV-COUNTER                            08530099
078200        IF AP042-ORIG-RCVR                                        08540099
078300           SET ORIG-RCVR-FOUND TO TRUE                            08550099
078400        END-IF                                                    08560099
078500     ELSE                                                         08570099
078600        SET RCVR-NOT-QUALIFIED TO TRUE                            08580099
078700        ADD 1 TO BYPASS-COUNTER-C                                 08590099
078800     END-IF.                                                      08600099
078900                                                                  08610099
079000     PERFORM R200-READ-UNJOURNALIZED.                             08620099
079100                                                                  08630099
079200     MOVE AP042-VRFD-DTE  TO PV-COMPARE-MKDATE.                   08640099
079300                                                                  08650099
079400*---------------------------------------------------------------  08660099
079500*    CREATE WRITE-OFF INVOICE TO MATCH THE ACCUM COST AND QTY     08670099
079600*     FOR THAT PO/STORE COMBINATION.                              08680099
079700*   -THE PO BEING PROCESSED IS THE SAVED PO AND STORE.            08690099
079800*   -BEFORE ADDING AN INVOICE, CHECK FOR EXISTING UNPAID INVOICES 08700099
079900*    ON THE PO/STORE COMBINATION BEING PROCESSED AND DELETE THEM. 08710099
080000*   -THE INVOICE CURSOR WILL BE OPENED AND CLOSED FOR EVERY       08720099
080100*    PO STORE COMBINATION.  CLEANUP UNTIL OUT OF INVOICES FOR     08730099
080200*    THAT PO STORE COMBINATION.                                   08740099
080300*   -AFTER THE INVOICES ARE CLEANED UP FILL THE FIELDS.           08750099
080400*   -THEN PERFORM THE INSERTS.                                    08760099
080500*---------------------------------------------------------------  08770099
080600 C200-CREATE-INVOICE.                                             08780099
080700                                                                  08790099
080800     ADD  1                 TO INVOICE-ADD-COUNTER-C.             08800099
080900     MOVE PV-PO-NBR         TO PV-PROCESS-PO-NBR.                 08810099
081000     MOVE PV-STR-NBR        TO PV-PROCESS-STR-NBR.                08820099
081100                                                                  08830099
081200     IF BULK-PO                                                   08840099
081300        MOVE 0                  TO PV-STR-NBR-LOW                 08850099
081400        MOVE +9999              TO PV-STR-NBR-HIGH                08860099
081500        PERFORM Y100-OPEN-BULK-INVOICE-CSR                        08870099
081600        PERFORM R300-FETCH-BULK-INVOICE-CSR                       08880099
081700     ELSE                                                         08890099
081800        MOVE PV-PROCESS-STR-NBR TO PV-STR-NBR-HIGH                08900099
081900        PERFORM Y300-OPEN-BYSTR-INVOICE-CSR                       08910099
082000        PERFORM R500-FETCH-BYSTR-INVOICE-CSR                      08920099
082100     END-IF.                                                      08930099
082200                                                                  08940099
082300     IF NOT OUT-OF-INVOICES                                       08950099
082400         PERFORM D300-CLEANUP-EXISTING-INVCS                      08960099
082500             UNTIL OUT-OF-INVOICES                                08970099
082600     END-IF.                                                      08980099
082700                                                                  08990099
082800     IF BULK-PO                                                   09000099
082900        PERFORM Y200-CLOSE-BULK-INVOICE-CSR                       09010099
083000     ELSE                                                         09020099
083100        PERFORM Y400-CLOSE-BYSTR-INVOICE-CSR                      09030099
083200     END-IF.                                                      09040099
083300                                                                  09050099
083400     SET MORE-INVOICES TO TRUE.                                   09060099
083500                                                                  09070099
083600     PERFORM R400-GET-CURRENT-TIMESTAMP.                          09080099
083700                                                                  09090099
085300*--------------------------------------------------------*        09100099
085400*    MOVE THE DATA TO FILL THE INVOIC ROW                         09110099
085500*    INVOIC-PAYT-REQ-SEQ-NBR POPULATED IN PARA R400               09120099
085600*--------------------------------------------------------*        09130099
085700     MOVE PV-PROCESS-PO-NBR        TO INVOIC-PO-NBR.              09140099
085800     MOVE INVOIC-PAYT-REQ-SEQ-NBR  TO PV-PAYT-REQ-SEQ-NBR9.       09150099
085900                                                                  09160099
086000     IF ORIG-RCVR-FOUND                                           09170099
086100         MOVE PV-PAYT-REQ-SEQ-NBR9   TO PV-INV-ID9-WO             09180099
086200         MOVE PV-WO-INV-ID           TO INVOIC-INVC-ID            09190099
086300     ELSE                                                         09200099
086400         MOVE PV-PAYT-REQ-SEQ-NBR9   TO PV-INV-ID9-WONIR          09210099
086500         MOVE PV-WONIR-INV-ID        TO INVOIC-INVC-ID            09220099
086600     END-IF.                                                      09230099
086700                                                                  09240099
086800     MOVE 'WO'                    TO INVOIC-INVC-TYP-CDE.         09250099
086900     MOVE 'MN'                    TO INVOIC-ENTR-MTHD-CDE.        09260099
087000     MOVE PC-PROGRAM-NAME         TO INVOIC-CRE-BY-USR-ID.        09270099
087100     MOVE SPACES                  TO INVOIC-BAR-CDE.              09280099
087200     MOVE 'N'                     TO INVOIC-SPLIT-TERMS-IND.      09290099
087300     MOVE 'N'                     TO INVOIC-DTL-ENTR-IND.         09300099
087400     MOVE ZERO                    TO INVOIC-INVC-CART-CT.         09310099
087500     MOVE APCNTL-BTCH-PRC-DTE     TO INVOIC-CRE-DTE.              09320099
087600     MOVE SPACE                   TO INVOIC-PPD-RVRSL-IND.        09330099
087700     MOVE APCNTL-BTCH-PRC-DTE     TO INVOIC-INVC-DTE.             09340099
087800     MOVE PV-ACCUM-RCV-COST       TO INVOIC-GRO-COST-AMT          09350099
087900                                     INVOIC-INVC-NET-COST-AMT.    09360099
088000     MOVE PV-VND-NBR              TO INVOIC-RMIT-VND-ID.          09370099
088100     MOVE PV-PROCESS-STR-NBR      TO INVOIC-STR-NBR.              09380099
088200     MOVE 'N'                     TO INVOIC-HOLD-IND.             09390099
088300     MOVE SPACE                   TO INVOIC-DUE-DTE-SRC-CDE.      09400099
088400     MOVE '0001-01-01'            TO INVOIC-CALC-DUE-DTE.         09410099
088500     MOVE '9999-09-09'            TO INVOIC-PAYT-DTE.             09420099
088600     MOVE '9999-09-09'            TO INVOIC-AP-PRC-DTE.           09430099
088700     MOVE SPACE                   TO INVOIC-AP-PRC-CDE.           09440099
088800     MOVE '9999-09-09-09.09.09.999999'                            09450099
088900                                  TO INVOIC-PAYT-RLSE-TMST.       09460099
089000     MOVE 'EN'                    TO INVOIC-STATUS-CDE.           09470099
089100     MOVE WS-TIMESTAMP            TO INVOIC-STATUS-CHG-TMST.      09480099
089200                                                                  09490099
089210     IF BULK-PO                                                   09500099
089211        MOVE 'P'                  TO INVOIC-MTCH-LVL-CDE          09510099
089212        MOVE ZERO                 TO INVOIC-DC-NBR                09520099
089220     ELSE                                                         09530099
089221        IF DC-PO                                                  09540099
089230           MOVE 'D'                TO INVOIC-MTCH-LVL-CDE         09550099
089240           MOVE PV-PROCESS-STR-NBR TO INVOIC-DC-NBR               09560099
089241        ELSE                                                      09570099
089242           MOVE 'S'                TO INVOIC-MTCH-LVL-CDE         09580099
089243           MOVE ZERO               TO INVOIC-DC-NBR               09590099
089244        END-IF                                                    09600099
089245     END-IF.                                                      09610099
089250                                                                  09620099
089300     PERFORM I200-INSERT-INVOIC.                                  09630099
089400*--------------------------------------------------------*        09640099
089500*    MOVE THE DATA TO FILL THE MDINVC ROW                         09650099
089600*    MDINVC-PAYT-REQ-SEQ-NBR POPULATED IN PARA R400               09660099
089700*--------------------------------------------------------*        09670099
089800     MOVE PV-PROCESS-PO-NBR        TO MDINVC-PO-NBR.              09680099
089900     MOVE INVOIC-INVC-ID           TO MDINVC-INVC-ID.             09690099
090000     MOVE +1                       TO MDINVC-VEND-FRGT-PCT.       09700099
090100     MOVE 'I'                      TO MDINVC-TERM-SEL-CDE.        09710099
090200     MOVE PV-ACCUM-RCV-QTY         TO MDINVC-TOT-INVC-PC-QTY.     09720099
090300     MOVE SPACES                   TO MDINVC-IMPRT-CHRG-PRC-CDE.  09730099
090400                                                                  09740099
090500     PERFORM I300-INSERT-MDINVC.                                  09750099
090600                                                                  09760099
090700*--------------------------------------------------------*        09770099
090800*    MOVE THE DATA TO FILL THE INVCTM ROW                         09780099
090900*    INVCTM-PAYT-REQ-SEQ-NBR POPULATED IN PARA R400               09790099
091000*--------------------------------------------------------*        09800099
091100     MOVE 1                        TO INVCTM-TERM-SEQ-NBR.        09810099
091200     MOVE '01'                     TO INVCTM-TERM-TYP-CDE.        09820099
091300     MOVE '03'                     TO INVCTM-TERM-BASIS-DTE-CDE.  09830099
091400     MOVE '9999-09-09'             TO INVCTM-EFF-DTE.             09840099
091500     MOVE ZERO                     TO INVCTM-DISC-PCT.            09850099
091600     MOVE ZERO                     TO INVCTM-DISC-AMT.            09860099
091700     MOVE '9999-09-09'             TO INVCTM-DISC-DUE-DTE.        09870099
091800     MOVE ZERO                     TO INVCTM-DISC-DUE-DAY-QTY.    09880099
091900     MOVE '9999-09-09'             TO INVCTM-NET-DUE-DTE.         09890099
092000     MOVE ZERO                     TO INVCTM-NET-DUE-DAY-QTY.     09900099
092100     MOVE ZERO                     TO INVCTM-EXTD-DAYS-QTY.       09910099
092200     MOVE PV-PROCESS-PO-NBR        TO INVCTM-PO-NBR.              09920099
092300     MOVE INVOIC-INVC-ID           TO INVCTM-INVC-ID.             09930099
092400                                                                  09940099
092500     PERFORM I400-INSERT-INVCTM.                                  09950099
092600                                                                  09960099
094800                                                                  09970099
094900*---------------------------------------------------------------  09980099
095000*    CHECKPOINT RESTART LOGICAL TO BE INVOKED AT THE END OF       09990099
095100*    A LOGICAL UNIT OF WORK.                                      10000099
095200*---------------------------------------------------------------  10010099
095300 C300-CHECKPOINT.                                                 10020099
095400                                                                  10030099
095500     PERFORM R600-SET-CURRENT-TMST.                               10040099
095600     IF CR-CURR-TMST > CR-NEXT-TMST                               10050099
095700         IF NO-COMMITS-TAKEN                                      10060099
095800             MOVE PC-IN-PROCESS-CODE  TO CR-CKPT-STAT-CODE        10070099
095900             PERFORM U300-UPDATE-CHECKPOINT-CNTL                  10080099
096000             SET COMMITS-TAKEN        TO TRUE                     10090099
096100         END-IF                                                   10100099
096200         PERFORM D400-CHECKPOINT-COMMIT                           10110099
096300     END-IF.                                                      10120099
096400                                                                  10130099
096500*---------------------------------------------------------------- 10140099
096600* USE THE DATE ROUTINE TO SUBTRACT THE UNJOURNALIZED WRITEOFF     10150099
096700* QUANTITY FROM THE BATCH CONTROL DATE.  THE RESULT WILL BE USED  10160099
096800* TO FIND THE LAST DAY OF THE FISCAL MONTH WHICH WILL BE USED     10170099
096900* FOR THE WRITE-OFF CUTOFF DATE (D100-FIND-LAST-FISCAL-PER-DTE).  10180099
097000*---------------------------------------------------------------- 10190099
097100*                                                                 10200099
097200 C400-CALC-WO-CUTOFF-DATE.                                        10210099
097300                                                                  10220099
097400     SET NOT-VALID-DATE TO TRUE.                                  10230099
097500***  MOVE SPACES TO PS-DATE-SW.                                   10240099
097600                                                                  10250099
097700     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         10260099
097800                                                                  10270099
097900     SET DPG51-FISCAL-454-CALENDAR                                10280099
098000         DPG51-DECREMENT-DATE                                     10290099
098100         DPG52-LK-DTE-ISO-FMT       TO TRUE.                      10300099
098200                                                                  10310099
098300     MOVE APCNTL-UJ-W-O-DAY-QTY     TO DPG51-INCR-DECR-DAYS-9.    10320099
098400     MOVE APCNTL-BTCH-PRC-DTE       TO DPG52-LK-DATE-INPUT.       10330099
098500                                                                  10340099
098600     PERFORM D200-DATE-ROUTINE.                                   10350099
098700                                                                  10360099
098800     IF VALID-DATE                                                10370099
098900         MOVE DPG55-DB2-ISO-DATE-FMT TO PV-RESULT-DATE            10380099
099000     ELSE                                                         10390099
099100         MOVE 'C400-CALC-WO-CUTOFF' TO AA-PARAGRAPH-NAME          10400099
099200         MOVE 'BAD DATE CALULATION FOR RESULT DATE'               10410099
099300                                    TO AA-MESSAGE                 10420099
099400         SET AC-DATE-ERROR          TO TRUE                       10430099
099500         PERFORM Z999-ABEND                                       10440099
099600     END-IF.                                                      10450099
099700                                                                  10460099
099800     PERFORM D100-FIND-LAST-FISCAL-PER-DTE.                       10470099
099900                                                                  10480099
100000*---------------------------------------------------------------* 10490099
100100*  DETERMINES THE LAST FISCAL DAY OF THE MONTH IN WHICH THE     * 10500099
100200*  RESULT DATE (BATCH DATE MINUS UNJOURNALIZED WO DATE) FALLS.  * 10510099
100300*  THIS DATE WILL BE USED FOR THE WRITE-OFF CUTOFF DATE.        * 10520099
100400*---------------------------------------------------------------* 10530099
100500 D100-FIND-LAST-FISCAL-PER-DTE.                                   10540099
100600                                                                  10550099
100700     SET NOT-VALID-DATE TO TRUE.                                  10560099
100800**   MOVE SPACES                    TO PS-DATE-SW.                10570099
100900     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         10580099
101000                                                                  10590099
101100     SET DPG51-FISCAL-454-CALENDAR                                10600099
101200         DPG51-DO-NOT-INCR-DECR-DATE                              10610099
101300         DPG52-LK-DTE-ISO-FMT       TO TRUE.                      10620099
101400     MOVE PV-RESULT-DATE            TO DPG52-LK-DATE-INPUT.       10630099
101500                                                                  10640099
101600     PERFORM D200-DATE-ROUTINE.                                   10650099
101700                                                                  10660099
101800     IF VALID-DATE                                                10670099
101900         MOVE DPG56-LAST-FP-DB2-ISO-FMT TO PV-WO-CUTOFF-DATE      10680099
102000     ELSE                                                         10690099
102100         MOVE 'D100-FIND-LAST'     TO AA-PARAGRAPH-NAME           10700099
102200         MOVE 'BAD DATE CONVERSION FOR RESULT DATE'               10710099
102300                                    TO AA-MESSAGE                 10720099
102400         SET AC-DATE-ERROR          TO TRUE                       10730099
102500         PERFORM Z999-ABEND                                       10740099
102600     END-IF.                                                      10750099
102700                                                                  10760099
102800*----------------------------------------------------------------*10770099
102900*    CALLS THE DATE ROUTINE MODULE.                              *10780099
103000*----------------------------------------------------------------*10790099
103100 D200-DATE-ROUTINE.                                               10800099
103200                                                                  10810099
103300     CALL DP500-KOHLS-CALENDAR-ROUTINE                            10820099
103400         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               10830099
103500                                                                  10840099
103600     IF (DPG54-SEVERE-ERROR OR                                    10850099
103700         DPG54-WARNING-ERROR)                                     10860099
103800         SET NOT-VALID-DATE TO TRUE                               10870099
103900     ELSE                                                         10880099
104000         SET VALID-DATE TO TRUE                                   10890099
104100     END-IF.                                                      10900099
104200 EJECT                                                            10910099
104300                                                                  10920099
104400                                                                  10930099
104500*---------------------------------------------------------------  10940099
104600*    CHECK THE INVOICE TABLE FOR UNPAID INVOICES FOR THE PO-STOR  10950099
104700*    BEING-PROCESSED.  UPDATE THE STATUS TO DELETE ON TINVOIC     10960099
104800*    AND TPAYREQ AND CREATE AN AUDIT RECORD ON TAUDINC.  DON'T    10970099
104900*    WANT TO CREATE A WRITEOFF INVOICE IF AN INVOICE ALREADY EXIST10980099
105000*    FOR THAT PO/STOR COMBINATION. THEREFORE, THEY MUST BE DELETED10990099
105100*---------------------------------------------------------------  11000099
105200 D300-CLEANUP-EXISTING-INVCS.                                     11010099
105300                                                                  11020099
105400     PERFORM U100-UPDATE-EXISTING-INVOICES.                       11030099
105500                                                                  11040099
106900     ADD 1  TO INVOICE-DELETE-COUNTER-C.                          11050099
107000                                                                  11060099
107100     IF BULK-PO                                                   11070099
107200        PERFORM R300-FETCH-BULK-INVOICE-CSR                       11080099
107300     ELSE                                                         11090099
107400        PERFORM R500-FETCH-BYSTR-INVOICE-CSR                      11100099
107500     END-IF.                                                      11110099
107600                                                                  11120099
107700*---------------------------------------------------------------  11130099
107800*    UPDATE THE CHECKPOINT/RESTART TABLES AND THEN COMMIT         11140099
107900*---------------------------------------------------------------  11150099
108000 D400-CHECKPOINT-COMMIT.                                          11160099
108100                                                                  11170099
108200     MOVE PV-PO-NBR            TO CR-PO-NBR.                      11180099
108300     MOVE PV-STR-NBR           TO CR-STR-NBR.                     11190099
108400                                                                  11200099
108500     COMPUTE READ-COUNTER                                         11210099
108600          =  READ-COUNTER + READ-COUNTER-C.                       11220099
108700     COMPUTE BYPASS-COUNTER                                       11230099
108800          =  BYPASS-COUNTER + BYPASS-COUNTER-C.                   11240099
108900     COMPUTE INVOICE-ADD-COUNTER                                  11250099
109000          =  INVOICE-ADD-COUNTER  + INVOICE-ADD-COUNTER-C.        11260099
109100     COMPUTE INVOICE-DELETE-COUNTER                               11270099
109200          =  INVOICE-DELETE-COUNTER + INVOICE-DELETE-COUNTER-C.   11280099
109300     MOVE  READ-COUNTER           TO CR-READ-COUNTER.             11290099
109400     MOVE  BYPASS-COUNTER         TO CR-BYPASS-COUNTER.           11300099
109500     MOVE  INVOICE-ADD-COUNTER    TO CR-INSRT-INV-COUNT.          11310099
109600     MOVE  INVOICE-DELETE-COUNTER TO CR-DEL-INV-COUNT.            11320099
109700                                                                  11330099
109800     MOVE CR-CKPT-RESTART-INFO TO TCKRSTINF-WORK-STRG-DESC-TEXT.  11340099
109900     MOVE 4022                 TO TCKRSTINF-WORK-STRG-DESC-LEN.   11350099
110000     PERFORM U400-UPDATE-CHECKPOINT-INFO.                         11360099
110100                                                                  11370099
110200     PERFORM Z100-COMMIT.                                         11380099
110300                                                                  11390099
110400     PERFORM R700-SET-NEXT-CKPT-TMST.                             11400099
110500                                                                  11410099
110600     MOVE ZERO                  TO READ-COUNTER-C                 11420099
110700                                   BYPASS-COUNTER-C               11430099
110800                                   INVOICE-ADD-COUNTER-C          11440099
110900                                   INVOICE-DELETE-COUNTER-C.      11450099
111000                                                                  11460099
111100*---------------------------------------------------------------  11470099
111200*   FILL IN THE VARIOUS FIELDS OF THE ZERO COST INFO TABLE ARRAY. 11480099
111300*   THIS ARRAY WILL BE USED LATER IN THE PROCESSING TO BUILD      11490099
111400*   THE APRD254 RECORDS THAT WILL BE INSERTED INTO TOUTAP3        11500099
111500*   FOR ZERO COST WRITE-OFFS ONLY.                                11510099
111600*---------------------------------------------------------------  11520099
111700 F100-FILL-ZERO-COST-INFO-TABLE.                                  11530099
111800                                                                  11540099
111900     MOVE AP042-PO-NBR          TO WS-ZC-PO-NBR(ZC-IDX).          11550099
112000     MOVE AP042-STR-NBR         TO WS-STR-NBR.                    11560099
112100     MOVE WS-STR-NBR            TO WS-ZC-STR-NBR(ZC-IDX).         11570099
112200     MOVE AP042-PO-LNE-NBR      TO WS-ZC-PO-LNE-NBR(ZC-IDX).      11580099
112300     MOVE AP042-RCV-TYP-CDE     TO WS-ZC-RCV-TYP-CDE(ZC-IDX).     11590099
112400     MOVE AP042-REC-SEQ-NBR     TO WS-ZC-REC-SEQ-NBR(ZC-IDX).     11600099
112500     SET ZC-IDX UP BY 1.                                          11610099
112600                                                                  11620099
112700*---------------------------------------------------------------  11630099
112800*   PROCESS ALL OF THE ZERO COST INFO COLLECTED ON THE TABLE.     11640099
112900*   IF A ROW ON THIS TABLE HAS A RCV-TYP-CDE = 'R', THEN THE      11650099
113000*   TRECDIS TABLE WILL BE ACCESSED.  ADDITIONAL DATA IS NEEDED    11660099
113100*   TO BUILD THE AP254-RECORD-KEY FOR A TRECDIS UPDATE RECORD.    11670099
113200*   A TRECEIV UPDATE RECORD WILL ALSO BE CREATED FOR THIS SAME    11680099
113300*   DATA FROM THE ZERO COST INFO TABLE.  IF THE RCV-TYP-CDE = 'N' 11690099
113400*   A TNINREC UPDATE RECORD WILL BE CREATED.                      11700099
113500*---------------------------------------------------------------  11710099
113600 F200-PROCESS-ZERO-CST-INFO-TBL.                                  11720099
113700                                                                  11730099
113800     INITIALIZE AP254-RECORD.                                     11740099
113900     SET AP254-WRT-OFF TO TRUE.                                   11750099
114000     MOVE APCNTL-BTCH-PRC-DTE TO AP254-AP-PRC-DTE.                11760099
114100                                                                  11770099
114200     IF WS-ZC-STR-NBR(ZC-IDX) = ZEROS                             11780099
114300        SET AP254-BULK-PO  TO TRUE                                11790099
114400     ELSE                                                         11800099
114500        SET AP254-STORE-PO TO TRUE                                11810099
114600     END-IF.                                                      11820099
114700                                                                  11830099
114800     IF WS-ZC-RCV-TYP-CDE(ZC-IDX) = 'N'                           11840099
114900        PERFORM G100-BUILD-TNINREC-UPDATE-REC                     11850099
115000        PERFORM I600-INSERT-TOUTAP3                               11860099
115100     ELSE                                                         11870099
115200        PERFORM G200-BUILD-TRECDIS-UPDATE-REC                     11880099
115300        PERFORM I600-INSERT-TOUTAP3                               11890099
115400        PERFORM G300-BUILD-TRECEIV-UPDATE-REC                     11900099
115500        PERFORM I600-INSERT-TOUTAP3                               11910099
115600     END-IF.                                                      11920099
115700                                                                  11930099
115800*---------------------------------------------------------------  11940099
115900*   MOVE THE NEEDED DATA FROM THE ZERO COST INFO TABLE TO THE     11950099
116000*   AP254-RECORD TO BUILD A TNINREC UPDATE RECORD.                11960099
116100*---------------------------------------------------------------  11970099
116200 G100-BUILD-TNINREC-UPDATE-REC.                                   11980099
116300                                                                  11990099
116400     SET AP254-TNINREC-UPDATE       TO TRUE.                      12000099
116500     MOVE WS-ZC-PO-NBR(ZC-IDX)      TO AP254-NR-PURCHASE-ORDER.   12010099
116600     MOVE WS-ZC-PO-LNE-NBR(ZC-IDX)  TO AP254-NR-PO-LNE-NBR.       12020099
116700     MOVE WS-ZC-REC-SEQ-NBR(ZC-IDX) TO AP254-NR-NINVC-SEQ-NBR.    12030099
116800                                                                  12040099
116900*---------------------------------------------------------------  12050099
117000*   MOVE THE NEEDED DATA FROM THE ZERO COST INFO TABLE TO THE     12060099
117100*   AP254-RECORD TO BUILD A TRECDIS UPDATE RECORD.                12070099
117200*---------------------------------------------------------------  12080099
117300 G200-BUILD-TRECDIS-UPDATE-REC.                                   12090099
117400                                                                  12100099
117500     INITIALIZE AP254-TRECDIS-KEY.                                12110099
117600     SET AP254-TRECDIS-UPDATE       TO TRUE.                      12120099
117700     MOVE WS-ZC-PO-NBR(ZC-IDX)      TO AP254-RD-PURCHASE-ORDER.   12130099
117800     MOVE WS-ZC-PO-LNE-NBR(ZC-IDX)  TO AP254-RD-PO-LNE-NBR.       12140099
117900     MOVE WS-ZC-REC-SEQ-NBR(ZC-IDX) TO AP254-RD-REC-SEQ-NBR.      12150099
118000     MOVE WS-ZC-STR-NBR(ZC-IDX)     TO AP254-RD-STORE-NBR.        12160099
118100     MOVE SPACE                     TO AP254-RD-CRE-TMST.         12170099
118200                                                                  12180099
118300     PERFORM S100-SELECT-TRECDIS.                                 12190099
118400                                                                  12200099
118500*---------------------------------------------------------------  12210099
118600*   MOVE THE NEEDED DATA FROM THE ZERO COST INFO TABLE TO THE     12220099
118700*   AP254-RECORD TO BUILD A TRECEIV UPDATE RECORD.                12230099
118800*---------------------------------------------------------------  12240099
118900 G300-BUILD-TRECEIV-UPDATE-REC.                                   12250099
119000                                                                  12260099
119100     INITIALIZE AP254-TRECEIV-KEY.                                12270099
119200     SET AP254-TRECEIV-UPDATE       TO TRUE.                      12280099
119300     MOVE WS-ZC-PO-NBR(ZC-IDX)      TO AP254-RC-PURCHASE-ORDER.   12290099
119400     MOVE WS-ZC-REC-SEQ-NBR(ZC-IDX) TO AP254-RC-RECVR-SEQ-NBR.    12300099
119500     MOVE SPACE                     TO AP254-RC-CRE-TMST.         12310099
119600                                                                  12320099
119700*---------------------------------------------------------------  12330099
119800*   INITIALIZE THE ZERO-COST INFO TABLE.                          12340099
119900*---------------------------------------------------------------  12350099
120000 H100-INIT-ZERO-COST-INFO-TABLE.                                  12360099
120100                                                                  12370099
120200     PERFORM VARYING ZC-IDX FROM 1 BY 1                           12380099
120300        UNTIL ZC-IDX > ZC-IDX-MAX                                 12390099
120400        INITIALIZE WS-ZERO-COST-TBL(ZC-IDX)                       12400099
120500     END-PERFORM.                                                 12410099
120600                                                                  12420099
129300*--------------------------------------------------------------*  12430099
129400* INSERT THE TINVOIC ROW FOR THIS INVOICE NUMBER               *  12440099
129500*--------------------------------------------------------------*  12450099
129700 I200-INSERT-INVOIC.                                              12460099
129800                                                                  12470099
129810     SET INSERT-NOT-SUCCESSFUL TO TRUE.                           12480099
129820                                                                  12490099
129900     PERFORM WITH TEST AFTER                                      12500099
130000        VARYING WS-INSERT-INVC-RETRY-COUNTER FROM 1 BY 1          12510099
130100          UNTIL WS-INSERT-INVC-RETRY-COUNTER > 200                12520099
130200             OR INSERT-SUCCESSFUL                                 12530099
130300                                                                  12540099
130400             EXEC SQL                                             12550099
130500                 INSERT INTO TINVOIC                              12560099
130600                    ( PO_NBR                                      12570099
130700                     ,INVC_ID                                     12580099
130800                     ,PAYT_REQ_SEQ_NBR                            12590099
130900                     ,INVC_TYP_CDE                                12600099
131000                     ,ENTR_MTHD_CDE                               12610099
131100                     ,CRE_BY_USR_ID                               12620099
131200                     ,BAR_CDE                                     12630099
131300                     ,SPLIT_TERMS_IND                             12640099
131400                     ,DTL_ENTR_IND                                12650099
131500                     ,INVC_CART_CT                                12660099
131600                     ,CRE_DTE                                     12670099
131700                     ,PPD_RVRSL_IND                               12680099
131800                     ,INVC_DTE                                    12690099
131900                     ,GRO_COST_AMT                                12700099
132000                     ,INVC_NET_COST_AMT                           12710099
132100                     ,RMIT_VND_ID                                 12720099
132200                     ,STR_NBR                                     12730099
132300                     ,HOLD_IND                                    12740099
132400                     ,DUE_DTE_SRC_CDE                             12750099
132500                     ,CALC_DUE_DTE                                12760099
132600                     ,PAYT_DTE                                    12770099
132700                     ,AP_PRC_DTE                                  12780099
132800                     ,AP_PRC_CDE                                  12790099
132900                     ,PAYT_RLSE_TMST                              12800099
133000                     ,STATUS_CDE                                  12810099
133100                     ,STATUS_CHG_TMST                             12820099
133110                     ,DC_NBR                                      12830099
133120                     ,MTCH_LVL_CDE )                              12840099
133200                 VALUES                                           12850099
133300                     (:INVOIC-PO-NBR                              12860099
133400                     ,:INVOIC-INVC-ID                             12870099
133500                     ,:INVOIC-PAYT-REQ-SEQ-NBR                    12880099
133600                     ,:INVOIC-INVC-TYP-CDE                        12890099
133700                     ,:INVOIC-ENTR-MTHD-CDE                       12900099
133800                     ,:INVOIC-CRE-BY-USR-ID                       12910099
133900                     ,:INVOIC-BAR-CDE                             12920099
134000                     ,:INVOIC-SPLIT-TERMS-IND                     12930099
134100                     ,:INVOIC-DTL-ENTR-IND                        12940099
134200                     ,:INVOIC-INVC-CART-CT                        12950099
134300                     ,:INVOIC-CRE-DTE                             12960099
134400                     ,:INVOIC-PPD-RVRSL-IND                       12970099
134500                     ,:INVOIC-INVC-DTE                            12980099
134600                     ,:INVOIC-GRO-COST-AMT                        12990099
134700                     ,:INVOIC-INVC-NET-COST-AMT                   13000099
134800                     ,:INVOIC-RMIT-VND-ID                         13010099
134900                     ,:INVOIC-STR-NBR                             13020099
135000                     ,:INVOIC-HOLD-IND                            13030099
135100                     ,:INVOIC-DUE-DTE-SRC-CDE                     13040099
135200                     ,:INVOIC-CALC-DUE-DTE                        13050099
135300                     ,:INVOIC-PAYT-DTE                            13060099
135400                     ,:INVOIC-AP-PRC-DTE                          13070099
135500                     ,:INVOIC-AP-PRC-CDE                          13080099
135600                     ,:INVOIC-PAYT-RLSE-TMST                      13090099
135700                     ,:INVOIC-STATUS-CDE                          13100099
135800                     , CURRENT TIMESTAMP                          13110099
135810                     ,:INVOIC-DC-NBR                              13120099
135820                     ,:INVOIC-MTCH-LVL-CDE)                       13130099
135900             END-EXEC                                             13140099
136000                                                                  13150099
136100             EVALUATE TRUE                                        13160099
136200               WHEN SQLCODE = ZERO                                13170099
136210                 SET INSERT-SUCCESSFUL TO TRUE                    13180099
136300               WHEN SQLCODE = -904                                13190099
136400               WHEN SQLCODE = -913                                13200099
136500                 CONTINUE                                         13210099
136600               WHEN SQLCODE = -803                                13220099
136601                 MOVE WS-INSERT-INVC-RETRY-COUNTER                13230099
136602                   TO WS-DISPLAY-RETRY-COUNTER                    13240099
136603                 DISPLAY 'DUPLICATE INVOICE:'                     13250099
136604                         'PO:      ' INVOIC-PO-NBR                13260099
136605                         'INVC ID: ' INVOIC-INVC-ID               13270099
136606                         'PAYREQ:  ' INVOIC-PAYT-REQ-SEQ-NBR      13280099
136607                         'RETRY #: ' WS-DISPLAY-RETRY-COUNTER     13290099
136608                 PERFORM R400-GET-CURRENT-TIMESTAMP               13300099
136700               WHEN SQLWARN0 NOT = SPACES                         13310099
136800               WHEN SQLCODE  NOT = ZERO                           13320099
136900                 MOVE 'I200-INSERT-INVOIC' TO AA-PARAGRAPH-NAME   13330099
137100                 MOVE 'UNSUCCESSFUL INSERT TINVOIC ROW'           13340099
137200                                           TO AA-DB2-OPERATION    13350099
137300                 MOVE 'TINVOIC'            TO AA-DB2-TABLE-1      13360099
137400                 MOVE SPACES               TO AA-DB2-TABLE-2      13370099
137500                                              AA-DB2-TABLE-3      13380099
137600                 PERFORM Z998-DB2-ABEND                           13390099
137700             END-EVALUATE                                         13400099
137800     END-PERFORM.                                                 13410099
137900                                                                  13420099
138000     IF WS-INSERT-INVC-RETRY-COUNTER > 200                        13430099
138100        MOVE 'I200-INSERT-TINVOIC' TO AA-PARAGRAPH-NAME           13440099
138300        MOVE 'MAX RETRIES EXCEEDED ON INSERT TINVOIC ROW'         13450099
138400                                   TO AA-DB2-OPERATION            13460099
138500        MOVE 'TINVOIC'             TO AA-DB2-TABLE-1              13470099
138600        MOVE SPACES                TO AA-DB2-TABLE-2              13480099
138700                                      AA-DB2-TABLE-3              13490099
138800        PERFORM Z998-DB2-ABEND                                    13500099
138900     END-IF.                                                      13510099
139000                                                                  13520099
139100     EVALUATE TRUE                                                13530099
139200       WHEN SQLCODE = ZEROS                                       13540099
139300         CONTINUE                                                 13550099
139400       WHEN OTHER                                                 13560099
139500         MOVE 'I200-INSERT-TINVOIC' TO AA-PARAGRAPH-NAME          13570099
139700         MOVE 'UNSUCCESSFUL INSERT TINVOIC ROW'                   13580099
139800                                    TO AA-DB2-OPERATION           13590099
139900         MOVE 'TINVOIC'             TO AA-DB2-TABLE-1             13600099
140000         MOVE SPACES                TO AA-DB2-TABLE-2             13610099
140100                                       AA-DB2-TABLE-3             13620099
140200         PERFORM Z998-DB2-ABEND                                   13630099
140300     END-EVALUATE.                                                13640099
140400                                                                  13650099
140600***************************************************************** 13660099
140700*     INSERT THE MDVINC ROW FOR THIS INVOICE NUMBER               13670099
140800***************************************************************** 13680099
140900*                                                                 13690099
141000 I300-INSERT-MDINVC.                                              13700099
141100                                                                  13710099
141200     PERFORM WITH TEST AFTER                                      13720099
141300             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 13730099
141400             UNTIL   WS-RETRY-COUNTER > WS-MAX-RETRIES OR         13740099
141500                     SQLCODE = ZERO                               13750099
141600                                                                  13760099
141700             EXEC SQL                                             13770099
141800                 INSERT INTO TMDINVC                              13780099
141900                    ( PO_NBR                                      13790099
142000                     ,INVC_ID                                     13800099
142100                     ,BOL_ID                                      13810099
142200                     ,VEND_FRGT_PCT                               13820099
142300                     ,KOHLS_FRGT_PCT                              13830099
142400                     ,TERM_SEL_CDE                                13840099
142500                     ,TOT_INVC_PC_QTY                             13850099
142600                     ,IMPRT_CHRG_PRC_CDE                          13860099
142700                     ,PAYT_REQ_SEQ_NBR )                          13870099
142800                 VALUES                                           13880099
142900                     (:MDINVC-PO-NBR                              13890099
143000                     ,:MDINVC-INVC-ID                             13900099
143100                     ,:MDINVC-BOL-ID                              13910099
143200                     ,:MDINVC-VEND-FRGT-PCT                       13920099
143300                     ,:MDINVC-KOHLS-FRGT-PCT                      13930099
143400                     ,:MDINVC-TERM-SEL-CDE                        13940099
143500                     ,:MDINVC-TOT-INVC-PC-QTY                     13950099
143600                     ,:MDINVC-IMPRT-CHRG-PRC-CDE                  13960099
143700                     ,:MDINVC-PAYT-REQ-SEQ-NBR)                   13970099
143800             END-EXEC                                             13980099
143900                                                                  13990099
144000             EVALUATE TRUE                                        14000099
144100                 WHEN SQLCODE = ZERO                              14010099
144200                 WHEN SQLCODE = -904                              14020099
144300                 WHEN SQLCODE = -913                              14030099
144400                      CONTINUE                                    14040099
144500                                                                  14050099
144600                 WHEN SQLWARN0 NOT = SPACES                       14060099
144700                 WHEN SQLCODE  NOT = ZERO                         14070099
144800                      MOVE 'I300-INSERT-TMDINVC '                 14080099
144900                                      TO AA-PARAGRAPH-NAME        14090099
145000                      MOVE 'UNSUCCESSFUL INSERT MDVINC  ROW'      14100099
145100                                      TO AA-DB2-OPERATION         14110099
145200                      MOVE 'TMDINVC ' TO AA-DB2-TABLE-1           14120099
145300                      MOVE SPACES     TO AA-DB2-TABLE-2           14130099
145400                                         AA-DB2-TABLE-3           14140099
145500                      PERFORM Z998-DB2-ABEND                      14150099
145600             END-EVALUATE                                         14160099
145700     END-PERFORM.                                                 14170099
145800                                                                  14180099
145900     IF WS-RETRY-COUNTER > WS-MAX-RETRIES                         14190099
146000         MOVE 'I300-INSERT-TMDINVC '                              14200099
146100                         TO AA-PARAGRAPH-NAME                     14210099
146200         MOVE 'MAX RETRIES EXCEEDED ON INSERT  MDVINC ROW'        14220099
146300                         TO AA-DB2-OPERATION                      14230099
146400         MOVE 'TMDINVC ' TO AA-DB2-TABLE-1                        14240099
146500         MOVE SPACES     TO AA-DB2-TABLE-2                        14250099
146600                            AA-DB2-TABLE-3                        14260099
146700         PERFORM Z998-DB2-ABEND                                   14270099
146800     END-IF.                                                      14280099
146900                                                                  14290099
147000     EVALUATE TRUE                                                14300099
147100        WHEN SQLCODE = ZEROS                                      14310099
147200             CONTINUE                                             14320099
147300        WHEN OTHER                                                14330099
147400             MOVE 'I300-INSERT-TMDINVC           ' TO             14340099
147500                                       AA-PARAGRAPH-NAME          14350099
147600             MOVE 'UNSUCCESSFUL INSERT TMDVINC ROW'               14360099
147700                             TO AA-DB2-OPERATION                  14370099
147800             MOVE 'TMDINVC ' TO AA-DB2-TABLE-1                    14380099
147900             MOVE SPACES     TO AA-DB2-TABLE-2                    14390099
148000                                AA-DB2-TABLE-3                    14400099
148100             PERFORM Z998-DB2-ABEND                               14410099
148200     END-EVALUATE.                                                14420099
148300                                                                  14430099
148400*                                                                 14440099
148500***************************************************************** 14450099
148600*     INSERT THE INVCTM ROW FOR THIS INVOICE NUMBER               14460099
148700***************************************************************** 14470099
148800*                                                                 14480099
148900 I400-INSERT-INVCTM.                                              14490099
149000                                                                  14500099
149100     PERFORM WITH TEST AFTER                                      14510099
149200             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 14520099
149300             UNTIL   WS-RETRY-COUNTER > WS-MAX-RETRIES OR         14530099
149400                     SQLCODE = ZERO                               14540099
149500                                                                  14550099
149600             EXEC SQL                                             14560099
149700                 INSERT INTO TINVCTM                              14570099
149800                    ( PO_NBR                                      14580099
149900                     ,INVC_ID                                     14590099
150000                     ,TERM_SEQ_NBR                                14600099
150100                     ,TERM_TYP_CDE                                14610099
150200                     ,TERM_BASIS_DTE_CDE                          14620099
150300                     ,EFF_DTE                                     14630099
150400                     ,DISC_PCT                                    14640099
150500                     ,DISC_AMT                                    14650099
150600                     ,DISC_DUE_DTE                                14660099
150700                     ,DISC_DUE_DAY_QTY                            14670099
150800                     ,NET_DUE_DTE                                 14680099
150900                     ,NET_DUE_DAY_QTY                             14690099
151000                     ,EXTD_DAYS_QTY)                              14700099
151100                 VALUES                                           14710099
151200                     (:INVCTM-PO-NBR                              14720099
151300                     ,:INVCTM-INVC-ID                             14730099
151400                     ,:INVCTM-TERM-SEQ-NBR                        14740099
151500                     ,:INVCTM-TERM-TYP-CDE                        14750099
151600                     ,:INVCTM-TERM-BASIS-DTE-CDE                  14760099
151700                     ,:INVCTM-EFF-DTE                             14770099
151800                     ,:INVCTM-DISC-PCT                            14780099
151900                     ,:INVCTM-DISC-AMT                            14790099
152000                     ,:INVCTM-DISC-DUE-DTE                        14800099
152100                     ,:INVCTM-DISC-DUE-DAY-QTY                    14810099
152200                     ,:INVCTM-NET-DUE-DTE                         14820099
152300                     ,:INVCTM-NET-DUE-DAY-QTY                     14830099
152400                     ,:INVCTM-EXTD-DAYS-QTY)                      14840099
152500             END-EXEC                                             14850099
152600                                                                  14860099
152700             EVALUATE TRUE                                        14870099
152800                 WHEN SQLCODE = ZERO                              14880099
152900                 WHEN SQLCODE = -904                              14890099
153000                 WHEN SQLCODE = -913                              14900099
153100                      CONTINUE                                    14910099
153200                                                                  14920099
153300                 WHEN SQLWARN0 NOT = SPACES                       14930099
153400                 WHEN SQLCODE  NOT = ZERO                         14940099
153500                      MOVE 'I400-INSERT-TINVCTM '                 14950099
153600                                      TO AA-PARAGRAPH-NAME        14960099
153700                      MOVE 'UNSUCCESSFUL INSERT INVCTM  ROW'      14970099
153800                                      TO AA-DB2-OPERATION         14980099
153900                      MOVE 'TINVCTM ' TO AA-DB2-TABLE-1           14990099
154000                      MOVE SPACES     TO AA-DB2-TABLE-2           15000099
154100                                         AA-DB2-TABLE-3           15010099
154200                      PERFORM Z998-DB2-ABEND                      15020099
154300             END-EVALUATE                                         15030099
154400     END-PERFORM.                                                 15040099
154500                                                                  15050099
154600     IF WS-RETRY-COUNTER > WS-MAX-RETRIES                         15060099
154700         MOVE 'I400-INSERT-TINVCTM '                              15070099
154800                         TO AA-PARAGRAPH-NAME                     15080099
154900         MOVE 'MAX RETRIES EXCEEDED ON INSERT  INVCTM ROW'        15090099
155000                         TO AA-DB2-OPERATION                      15100099
155100         MOVE 'TINVCTM ' TO AA-DB2-TABLE-1                        15110099
155200         MOVE SPACES     TO AA-DB2-TABLE-2                        15120099
155300                            AA-DB2-TABLE-3                        15130099
155400         PERFORM Z998-DB2-ABEND                                   15140099
155500     END-IF.                                                      15150099
155600                                                                  15160099
155700     EVALUATE TRUE                                                15170099
155800        WHEN SQLCODE = ZEROS                                      15180099
155900             CONTINUE                                             15190099
156000        WHEN OTHER                                                15200099
156100             MOVE 'I400-INSERT-TINVCTM           ' TO             15210099
156200                                       AA-PARAGRAPH-NAME          15220099
156300             MOVE 'UNSUCCESSFUL INSERT  INVCTM ROW'               15230099
156400                             TO AA-DB2-OPERATION                  15240099
156500             MOVE 'TINVCTM ' TO AA-DB2-TABLE-1                    15250099
156600             MOVE SPACES     TO AA-DB2-TABLE-2                    15260099
156700                                AA-DB2-TABLE-3                    15270099
156800             PERFORM Z998-DB2-ABEND                               15280099
156900     END-EVALUATE.                                                15290099
157000                                                                  15300099
162200                                                                  15310099
162300*-----------------------------------------------------------------15320099
162400*   INSERT THE AP254-RECORD TO THE AP OUTPUT NUMBER 3 TABLE.      15330099
162500*-----------------------------------------------------------------15340099
162600 I600-INSERT-TOUTAP3.                                             15350099
162700                                                                  15360099
162800     INITIALIZE DCLTOUTAP3.                                       15370099
162900                                                                  15380099
163000     MOVE AP254-RECORD TO OUTAP3-RCVR-UPD-ODR.                    15390099
163100                                                                  15400099
163200     PERFORM WITH TEST AFTER                                      15410099
163300             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 15420099
163400             UNTIL   WS-RETRY-COUNTER > WS-MAX-RETRIES OR         15430099
163500                     SQLCODE = ZERO                               15440099
163600                                                                  15450099
163700             EXEC SQL                                             15460099
163800                 INSERT INTO TOUTAP3                              15470099
163900                         (RCVR_UPD_ODR)                           15480099
164000                 VALUES  (:OUTAP3-RCVR-UPD-ODR)                   15490099
164100             END-EXEC                                             15500099
164200                                                                  15510099
164300             EVALUATE TRUE                                        15520099
164400                 WHEN SQLCODE = ZERO                              15530099
164500                 WHEN SQLCODE = -904                              15540099
164600                 WHEN SQLCODE = -913                              15550099
164700                      CONTINUE                                    15560099
164800                                                                  15570099
164900                 WHEN SQLWARN0 NOT = SPACES                       15580099
165000                 WHEN SQLCODE  NOT = ZERO                         15590099
165100                      MOVE 'I600-INSERT-TOUTAP3 '                 15600099
165200                                      TO AA-PARAGRAPH-NAME        15610099
165300                      MOVE 'UNSUCCESSFUL INSERT TOUTAP3 ROW'      15620099
165400                                      TO AA-DB2-OPERATION         15630099
165500                      MOVE 'TOUTAP3 ' TO AA-DB2-TABLE-1           15640099
165600                      MOVE SPACES     TO AA-DB2-TABLE-2           15650099
165700                                         AA-DB2-TABLE-3           15660099
165800                      PERFORM Z998-DB2-ABEND                      15670099
165900             END-EVALUATE                                         15680099
166000     END-PERFORM.                                                 15690099
166100                                                                  15700099
166200     IF WS-RETRY-COUNTER > WS-MAX-RETRIES                         15710099
166300         MOVE 'I600-INSERT-TOUTAP3 '                              15720099
166400                         TO AA-PARAGRAPH-NAME                     15730099
166500         MOVE 'MAX RETRIES EXCEEDED ON INSERT TOUTAP3 ROW'        15740099
166600                         TO AA-DB2-OPERATION                      15750099
166700         MOVE 'TOUTAP3 ' TO AA-DB2-TABLE-1                        15760099
166800         MOVE SPACES     TO AA-DB2-TABLE-2                        15770099
166900                            AA-DB2-TABLE-3                        15780099
167000         PERFORM Z998-DB2-ABEND                                   15790099
167100     END-IF.                                                      15800099
167200                                                                  15810099
167300     EVALUATE TRUE                                                15820099
167400        WHEN SQLCODE = ZEROS                                      15830099
167500             ADD 1 TO TOUTAP3-ROWS-COUNTER                        15840099
167600        WHEN OTHER                                                15850099
167700             MOVE 'I600-INSERT-TOUTAP3           ' TO             15860099
167800                                       AA-PARAGRAPH-NAME          15870099
167900             MOVE 'UNSUCCESSFUL INSERT TOUTAP3 ROW'               15880099
168000                             TO AA-DB2-OPERATION                  15890099
168100             MOVE 'TOUTAP3 ' TO AA-DB2-TABLE-1                    15900099
168200             MOVE SPACES     TO AA-DB2-TABLE-2                    15910099
168300                                AA-DB2-TABLE-3                    15920099
168400             PERFORM Z998-DB2-ABEND                               15930099
168500     END-EVALUATE.                                                15940099
168600                                                                  15950099
168700*---------------------------------------------------------------  15960099
168800*    RETRIEVES THE UNJOURNALIZED WRITE-OFF DAYS AND THE           15970099
168900*    BATCH PROCESS DATE FROM THE AP PAYMENT CONTROL TABLE.        15980099
169000*    NOTE:  A NOT FOUND CONDITION IN THIS INSTANCE PREVENTS THE   15990099
169100*           THE CALCULATION OF THE CUT-OFF DAYS SO PROCESSING     16000099
169200*           CANNOT PROCEED AND THE PROGRAM MUST ABEND.            16010099
169300*---------------------------------------------------------------  16020099
169400 R100-SELECT-CONTROL-DATA.                                        16030099
169500                                                                  16040099
169600     EXEC SQL                                                     16050099
169700         SELECT                                                   16060099
169800             UJ_W_O_DAY_QTY                                       16070099
169900            ,BTCH_PRC_DTE                                         16080099
170000         INTO                                                     16090099
170100             :APCNTL-UJ-W-O-DAY-QTY                               16100099
170200            ,:APCNTL-BTCH-PRC-DTE                                 16110099
170300         FROM TAPCNTL                                             16120099
170400     END-EXEC.                                                    16130099
170500                                                                  16140099
170600     EVALUATE TRUE                                                16150099
170700         WHEN SQLCODE = ZEROS                                     16160099
170800              CONTINUE                                            16170099
170900         WHEN OTHER                                               16180099
171000             MOVE 'R100-SELECT-CONTROL-DATA'                      16190099
171100                                 TO AA-PARAGRAPH-NAME             16200099
171200             MOVE 'UNSUCCESSFUL SELECT'                           16210099
171300                                 TO AA-DB2-OPERATION              16220099
171400             MOVE 'TAPCNTL'      TO AA-DB2-TABLE-1                16230099
171500             MOVE SPACES         TO AA-DB2-TABLE-2                16240099
171600                                    AA-DB2-TABLE-3                16250099
171700             PERFORM Z998-DB2-ABEND                               16260099
171800     END-EVALUATE.                                                16270099
171900 EJECT                                                            16280099
172000*---------------------------------------------------------------  16290099
172100*    READS THE UNJOURNALIZED FILE (RECEIVERS)                     16300099
172200*---------------------------------------------------------------  16310099
172300 R200-READ-UNJOURNALIZED.                                         16320099
172400                                                                  16330099
172500     READ UNJOURNALIZED-FILE                                      16340099
172600         INTO AP042-EXTRACT-FILE                                  16350099
172700         AT END SET END-OF-RECEIPTS TO TRUE.                      16360099
172800                                                                  16370099
172900     IF MORE-UNJOURNALIZED                                        16380099
173000         ADD 1 TO READ-COUNTER-C                                  16390099
173100     END-IF.                                                      16400099
173200                                                                  16410099
173300*---------------------------------------------------------------  16420099
173400*    FETCHES THE BULK INVOICES                                    16430099
173500*---------------------------------------------------------------  16440099
173600 R300-FETCH-BULK-INVOICE-CSR.                                     16450099
173700                                                                  16460099
173800     EXEC SQL                                                     16470099
173900         FETCH BULK_INVOICE_CSR                                   16480099
174000         INTO :INVOIC-INVC-ID                                     16490099
174100             ,:INVOIC-PAYT-REQ-SEQ-NBR                            16500099
174200             ,:INVOIC-GRO-COST-AMT                                16510099
174300     END-EXEC.                                                    16520099
174400                                                                  16530099
174500     EVALUATE TRUE                                                16540099
174600         WHEN SQLCODE = ZERO                                      16550099
174700             MOVE INVOIC-PAYT-REQ-SEQ-NBR  TO PV-PAYT-REQ-SEQ-NBR 16560099
174800             MOVE INVOIC-INVC-ID           TO PV-INVC-ID          16570099
174900             MOVE INVOIC-GRO-COST-AMT      TO PV-GRO-COST-AMT     16580099
175000                                                                  16590099
175100         WHEN SQLCODE = +100                                      16600099
175200              SET OUT-OF-INVOICES TO TRUE                         16610099
175300                                                                  16620099
175400         WHEN SQLWARN0 NOT = SPACES                               16630099
175500         WHEN SQLCODE  NOT = ZERO                                 16640099
175600             MOVE 'R300-FETCH-BULK-INVOICE-CSR'                   16650099
175700                                 TO AA-PARAGRAPH-NAME             16660099
175800             MOVE                                                 16670099
175900               'UNSUCCESSFUL FETCH WITH BULK_INVOICE_CSR'         16680099
176000                                 TO AA-DB2-OPERATION              16690099
176100             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                16700099
176200             MOVE SPACES         TO AA-DB2-TABLE-2                16710099
176300                                    AA-DB2-TABLE-3                16720099
176400             PERFORM Z998-DB2-ABEND                               16730099
176500     END-EVALUATE.                                                16740099
176600                                                                  16750099
176700*--------------------------------------------------------------*  16760099
176800* GET THE CURRENT DATE/TIME.                                   *  16770099
176900*--------------------------------------------------------------*  16780099
177000 R400-GET-CURRENT-TIMESTAMP.                                      16790099
177100                                                                  16800099
177110     PERFORM WITH TEST AFTER                                      16810099
177120        VARYING WS-RETRY-COUNTER FROM 1 BY 1                      16820099
177130          UNTIL WS-RETRY-COUNTER > WS-MAX-RETRIES OR              16830099
177140                SQLCODE = ZERO                                    16840099
177150                                                                  16850099
177200          EXEC SQL                                                16860099
177300            SET  :WS-TIMESTAMP = CURRENT TIMESTAMP                16870099
177400          END-EXEC                                                16880099
177500                                                                  16890099
177600         EVALUATE TRUE                                            16900099
177700           WHEN SQLCODE = ZERO                                    16910099
177800           WHEN SQLCODE = -904                                    16920099
177900           WHEN SQLCODE = -913                                    16930099
178000             CONTINUE                                             16940099
178200           WHEN SQLWARN0 NOT = SPACES                             16950099
178300           WHEN SQLCODE  NOT = ZERO                               16960099
178400             MOVE 'R400-GET-RANDOM-PAYREQ-NBR'                    16970099
178500               TO AA-PARAGRAPH-NAME                               16980099
178600             MOVE 'UNSUCCESSFUL SET TIMESTAMP'                    16990099
178700               TO AA-DB2-OPERATION                                17000099
178800             MOVE SPACES     TO AA-DB2-TABLE-1                    17010099
178900                                AA-DB2-TABLE-2                    17020099
179000                                AA-DB2-TABLE-3                    17030099
179100            PERFORM Z998-DB2-ABEND                                17040099
179200         END-EVALUATE                                             17050099
179300     END-PERFORM.                                                 17060099
179301                                                                  17070099
179302     IF WS-RETRY-COUNTER > WS-MAX-RETRIES                         17080099
179303        MOVE 'R400-GET-CURRENT-TIMESTAMP' TO AA-PARAGRAPH-NAME    17090099
179304        MOVE 'MAX RETRIES EXCEEDED ON SET TIMESTAMP'              17100099
179305          TO AA-DB2-OPERATION                                     17110099
179306        PERFORM Z998-DB2-ABEND                                    17120099
179307     END-IF.                                                      17130099
179310                                                                  17140099
179400     EVALUATE TRUE                                                17150099
179500       WHEN SQLCODE = ZEROS                                       17160099
179600         MOVE WS-MINUTE      TO WS-RND-MINUTE                     17170099
179700         MOVE WS-SECOND      TO WS-RND-SECOND                     17180099
179800         MOVE WS-NANOSEC-1-3 TO WS-RND-NANOSEC-1-3                17190099
179900         MOVE WS-NANOSEC-4-6 TO WS-RND-NANOSEC-4-6                17200099
180000         MOVE WS-RANDOM-KEY  TO WS-RANDOM-KEY-COMP                17210099
180100         MOVE WS-RANDOM-KEY-COMP TO INVOIC-PAYT-REQ-SEQ-NBR       17220099
180300                                    MDINVC-PAYT-REQ-SEQ-NBR       17230099
180500       WHEN SQLCODE NOT = ZEROS                                   17240099
180600         MOVE 'R400-GET-RANDOM-PAYREQ-NBR' TO AA-PARAGRAPH-NAME   17250099
180800         MOVE 'UNSUCCESSFUL SET TIMESTAMP' TO AA-DB2-OPERATION    17260099
181000         MOVE SPACES                       TO AA-DB2-TABLE-1      17270099
181100                                              AA-DB2-TABLE-2      17280099
181200                                              AA-DB2-TABLE-3      17290099
181300        PERFORM Z998-DB2-ABEND                                    17300099
181400     END-EVALUATE.                                                17310099
181500                                                                  17320099
181600*---------------------------------------------------------------  17330099
181700*    FETCHES THE BY STORE INVOICES                                17340099
181800*---------------------------------------------------------------  17350099
181900 R500-FETCH-BYSTR-INVOICE-CSR.                                    17360099
182000                                                                  17370099
182100     EXEC SQL                                                     17380099
182200         FETCH BYSTR_INVOICE_CSR                                  17390099
182300         INTO :INVOIC-INVC-ID                                     17400099
182400             ,:INVOIC-PAYT-REQ-SEQ-NBR                            17410099
182500             ,:INVOIC-GRO-COST-AMT                                17420099
182600     END-EXEC.                                                    17430099
182700                                                                  17440099
182800     EVALUATE TRUE                                                17450099
182900         WHEN SQLCODE = ZERO                                      17460099
183000             MOVE INVOIC-PAYT-REQ-SEQ-NBR  TO PV-PAYT-REQ-SEQ-NBR 17470099
183100             MOVE INVOIC-INVC-ID           TO PV-INVC-ID          17480099
183200             MOVE INVOIC-GRO-COST-AMT      TO PV-GRO-COST-AMT     17490099
183300                                                                  17500099
183400         WHEN SQLCODE = +100                                      17510099
183500              SET OUT-OF-INVOICES TO TRUE                         17520099
183600                                                                  17530099
183700         WHEN SQLWARN0 NOT = SPACES                               17540099
183800         WHEN SQLCODE  NOT = ZERO                                 17550099
183900             MOVE 'R500-FETCH-BYSTR-INVOICE-CSR'                  17560099
184000                                 TO AA-PARAGRAPH-NAME             17570099
184100             MOVE                                                 17580099
184200               'UNSUCCESSFUL FETCH WITH BYSTR_INVOICE_CSR'        17590099
184300                                 TO AA-DB2-OPERATION              17600099
184400             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                17610099
184500             MOVE SPACES         TO AA-DB2-TABLE-2                17620099
184600                                    AA-DB2-TABLE-3                17630099
184700             PERFORM Z998-DB2-ABEND                               17640099
184800     END-EVALUATE.                                                17650099
184900 EJECT                                                            17660099
185000*---------------------------------------------------------------  17670099
185100*    GETS THE CURRENT TIMESTAMP FROM DB2.                         17680099
185200*---------------------------------------------------------------  17690099
185300 R600-SET-CURRENT-TMST.                                           17700099
185400                                                                  17710099
185500     EXEC SQL                                                     17720099
185600       SET :CR-CURR-TMST = CURRENT TIMESTAMP                      17730099
185700     END-EXEC.                                                    17740099
185800                                                                  17750099
185900     EVALUATE TRUE                                                17760099
186000         WHEN SQLCODE = ZERO                                      17770099
186100              CONTINUE                                            17780099
186200                                                                  17790099
186300         WHEN SQLWARN0 NOT = SPACES                               17800099
186400         WHEN SQLCODE  NOT = ZERO                                 17810099
186500             MOVE 'R600-SET-CURRENT-TMST'                         17820099
186600                                     TO AA-PARAGRAPH-NAME         17830099
186700             MOVE 'UNSUCCESSFUL SET TMST'                         17840099
186800                                     TO AA-DB2-OPERATION          17850099
186900             MOVE SPACES             TO AA-DB2-TABLE-1            17860099
187000                                        AA-DB2-TABLE-2            17870099
187100                                        AA-DB2-TABLE-3            17880099
187200             PERFORM Z998-DB2-ABEND                               17890099
187300     END-EVALUATE.                                                17900099
187400 EJECT                                                            17910099
187500*---------------------------------------------------------------  17920099
187600*    SETS THE TIME THE NEXT CHECKPOINT NEEDS TO BE TAKEN.         17930099
187700*---------------------------------------------------------------  17940099
187800 R700-SET-NEXT-CKPT-TMST.                                         17950099
187900                                                                  17960099
188000     EXEC SQL                                                     17970099
188100      SELECT (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)        17980099
188200       INTO :CR-NEXT-TMST                                         17990099
188300       FROM TCKRSTCNTL                                            18000099
188400       WHERE PLAN_NAME = :PC-PROGRAM-NAME                         18010099
188500     END-EXEC.                                                    18020099
188600                                                                  18030099
188700     EVALUATE TRUE                                                18040099
188800         WHEN SQLCODE = ZERO                                      18050099
188900              CONTINUE                                            18060099
189000                                                                  18070099
189100         WHEN SQLWARN0 NOT = SPACES                               18080099
189200         WHEN SQLCODE  NOT = ZERO                                 18090099
189300             MOVE 'R700-SET-NEXT-CKPT-TMST'                       18100099
189400                                     TO AA-PARAGRAPH-NAME         18110099
189500             MOVE 'UNSUCCESSFUL SELECT NEXT TMST'                 18120099
189600                                     TO AA-DB2-OPERATION          18130099
189700             MOVE 'TCKRSTCNTL'       TO AA-DB2-TABLE-1            18140099
189800             MOVE SPACES             TO AA-DB2-TABLE-2            18150099
189900                                        AA-DB2-TABLE-3            18160099
190000             PERFORM Z998-DB2-ABEND                               18170099
190100     END-EVALUATE.                                                18180099
190200 EJECT                                                            18190099
190300*---------------------------------------------------------------  18200099
190400*    GETS THE RESTART STATUS CODE FROM THE CHECKPOINT/RESTART     18210099
190500*    CONTROL TABLE.                                               18220099
190600*---------------------------------------------------------------  18230099
190700 R800-SELECT-CHECKPOINT-CNTL.                                     18240099
190800                                                                  18250099
190900     EXEC SQL                                                     18260099
191000      SELECT CKPT_STAT_CODE                                       18270099
191100       INTO :CR-CKPT-STAT-CODE                                    18280099
191200       FROM TCKRSTCNTL                                            18290099
191300       WHERE PLAN_NAME = :PC-PROGRAM-NAME                         18300099
191400     END-EXEC.                                                    18310099
191500                                                                  18320099
191600     EVALUATE TRUE                                                18330099
191700         WHEN SQLCODE = ZERO                                      18340099
191800              CONTINUE                                            18350099
191900                                                                  18360099
192000         WHEN SQLWARN0 NOT = SPACES                               18370099
192100         WHEN SQLCODE  NOT = ZERO                                 18380099
192200             MOVE 'R800-SELECT-CHECKPOINT-CNTL'                   18390099
192300                                     TO AA-PARAGRAPH-NAME         18400099
192400             MOVE 'UNSUCCESSFUL SELECT TCKRSTCNTL'                18410099
192500                                     TO AA-DB2-OPERATION          18420099
192600             MOVE 'TCKRSTCNTL'       TO AA-DB2-TABLE-1            18430099
192700             MOVE SPACES             TO AA-DB2-TABLE-2            18440099
192800                                        AA-DB2-TABLE-3            18450099
192900             PERFORM Z998-DB2-ABEND                               18460099
193000     END-EVALUATE.                                                18470099
193100 EJECT                                                            18480099
193200*---------------------------------------------------------------  18490099
193300*    GETS THE WS DESCRIPTION INFO FROM THE CHECKPOINT/RESTART     18500099
193400*    INFORMATION TABLE.                                           18510099
193500*---------------------------------------------------------------  18520099
193600 R900-SELECT-CHECKPOINT-INFO.                                     18530099
193700                                                                  18540099
193800     EXEC SQL                                                     18550099
193900      SELECT WORK_STRG_DESC                                       18560099
194000       INTO :TCKRSTINF-WORK-STRG-DESC                             18570099
194100       FROM TCKRSTINF                                             18580099
194200       WHERE PLAN_NAME = :PC-PROGRAM-NAME                         18590099
194300     END-EXEC.                                                    18600099
194400                                                                  18610099
194500     EVALUATE TRUE                                                18620099
194600         WHEN SQLCODE = ZERO                                      18630099
194700              CONTINUE                                            18640099
194800                                                                  18650099
194900         WHEN SQLWARN0 NOT = SPACES                               18660099
195000         WHEN SQLCODE  NOT = ZERO                                 18670099
195100             MOVE 'R900-SELECT-CHECKPOINT-INFO'                   18680099
195200                                     TO AA-PARAGRAPH-NAME         18690099
195300             MOVE 'UNSUCCESSFUL SELECT TCKRSTINF'                 18700099
195400                                     TO AA-DB2-OPERATION          18710099
195500             MOVE 'TCKRSTINF'        TO AA-DB2-TABLE-1            18720099
195600             MOVE SPACES             TO AA-DB2-TABLE-2            18730099
195700                                        AA-DB2-TABLE-3            18740099
195800             PERFORM Z998-DB2-ABEND                               18750099
195900     END-EVALUATE.                                                18760099
196000                                                                  18770099
196100*---------------------------------------------------------------  18780099
196200*    SELECT ADDITIONAL INFO FROM TRECDIS NEEDED TO BUILD A        18790099
196300*    TRECDIS UPDATE RECORD.                                       18800099
196400*---------------------------------------------------------------  18810099
196500 S100-SELECT-TRECDIS.                                             18820099
196600                                                                  18830099
196700     EXEC SQL                                                     18840099
196800         SELECT OPER_UNT_ID                                       18850099
196900               ,FCLTY_ID                                          18860099
197000               ,STR_FCLTY_ID                                      18870099
197100          INTO :RECDIS-OPER-UNT-ID                                18880099
197200              ,:RECDIS-FCLTY-ID                                   18890099
197300              ,:RECDIS-STR-FCLTY-ID                               18900099
197400         FROM TRECDIS                                             18910099
197500         WHERE ORD_NBR     = :AP254-RD-PURCHASE-ORDER             18920099
197600           AND ORD_LNE_NBR = :AP254-RD-PO-LNE-NBR                 18930099
197700           AND REC_SEQ_NBR = :AP254-RD-REC-SEQ-NBR                18940099
197800           AND STR_NBR     = :AP254-RD-STORE-NBR                  18950099
197900     END-EXEC.                                                    18960099
198000                                                                  18970099
198100     EVALUATE TRUE                                                18980099
198200         WHEN SQLCODE = ZERO                                      18990099
198300             MOVE RECDIS-OPER-UNT-ID  TO AP254-RD-OPER-UNIT-ID    19000099
198400             MOVE RECDIS-FCLTY-ID     TO AP254-RD-FACILITY-ID     19010099
198500             MOVE RECDIS-STR-FCLTY-ID TO AP254-RD-STORE-FCLTY-ID  19020099
198600                                                                  19030099
198700         WHEN SQLCODE = +100                                      19040099
198800         WHEN SQLWARN0 NOT = SPACES                               19050099
198900         WHEN SQLCODE  NOT = ZERO                                 19060099
199000             MOVE AP254-RD-PO-LNE-NBR TO PV-PO-LNE-NBR            19070099
199100             MOVE PV-PO-LNE-NBR       TO PV-PO-LNE-NBR-9          19080099
199200             DISPLAY 'PO LINE NUMBER : ' PV-PO-LNE-NBR-9          19090099
199300             MOVE AP254-RD-REC-SEQ-NBR TO PV-REC-SEQ-NBR          19100099
199400             MOVE PV-REC-SEQ-NBR       TO PV-REC-SEQ-NBR-9        19110099
199500             DISPLAY 'REC SEQ NUMBER : ' PV-REC-SEQ-NBR-9         19120099
199600             MOVE 'S100-SELECT-TRECDIS'                           19130099
199700                                 TO AA-PARAGRAPH-NAME             19140099
199800             MOVE                                                 19150099
199900               'UNSUCCESSFUL SELECT OF TRECDIS'                   19160099
200000                                 TO AA-DB2-OPERATION              19170099
200100             MOVE 'TRECDIS'      TO AA-DB2-TABLE-1                19180099
200200             MOVE SPACES         TO AA-DB2-TABLE-2                19190099
200300                                    AA-DB2-TABLE-3                19200099
200400             PERFORM Z998-DB2-ABEND                               19210099
200500     END-EVALUATE.                                                19220099
200600                                                                  19230099
200700*---------------------------------------------------------------  19240099
200800*    UPDATES THE UNPAID INVOICES FOR THE PO STORE BEING PROCESSED 19250099
200900*---------------------------------------------------------------  19260099
201000 U100-UPDATE-EXISTING-INVOICES.                                   19270099
201100     EXEC SQL                                                     19280099
201200         UPDATE TINVOIC                                           19290099
201300         SET STATUS_CDE       = 'DE'                              19300099
201400           , STATUS_CHG_TMST  = CURRENT TIMESTAMP                 19310099
201500           , CRE_BY_USR_ID    = 'WRITEOFF'                        19320099
201600         WHERE PO_NBR         = :PV-PROCESS-PO-NBR                19330099
201700           AND INVC_ID        = :PV-INVC-ID                       19340099
201800     END-EXEC.                                                    19350099
201900                                                                  19360099
202000     EVALUATE TRUE                                                19370099
202100         WHEN SQLCODE = ZEROS                                     19380099
202200             CONTINUE                                             19390099
202300         WHEN OTHER                                               19400099
202400             MOVE 'U100-UPDATE-EXISTING-INVOICES'                 19410099
202500                                 TO AA-PARAGRAPH-NAME             19420099
202600             MOVE 'UNSUCCESSFUL UPDATE'                           19430099
202700                                 TO AA-DB2-OPERATION              19440099
202800             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                19450099
202900             MOVE SPACES         TO AA-DB2-TABLE-2                19460099
203000                                    AA-DB2-TABLE-3                19470099
203100             PERFORM Z998-DB2-ABEND                               19480099
203200     END-EVALUATE.                                                19490099
203300                                                                  19500099
205700*---------------------------------------------------------------  19510099
205800*    UPDATES THE CHECKPOINT RESTART CONTROL TABLE.  THE STATUS    19520099
205900*    CODE IS SET TO '9' (RUN IN PROGRESS) OR '0' (RUN COMPLETE).  19530099
206000*---------------------------------------------------------------  19540099
206100 U300-UPDATE-CHECKPOINT-CNTL.                                     19550099
206200                                                                  19560099
206300     EXEC SQL                                                     19570099
206400         UPDATE TCKRSTCNTL                                        19580099
206500         SET CKPT_STAT_CODE = :CR-CKPT-STAT-CODE                  19590099
206600         WHERE PLAN_NAME    = :PC-PROGRAM-NAME                    19600099
206700     END-EXEC.                                                    19610099
206800                                                                  19620099
206900     EVALUATE TRUE                                                19630099
207000         WHEN SQLCODE = ZEROS                                     19640099
207100              CONTINUE                                            19650099
207200                                                                  19660099
207300         WHEN OTHER                                               19670099
207400             MOVE 'U300-UPDATE-CHECKPOINT-CNTL'                   19680099
207500                                 TO AA-PARAGRAPH-NAME             19690099
207600             MOVE 'UNSUCCESSFUL UPDATE'                           19700099
207700                                 TO AA-DB2-OPERATION              19710099
207800             MOVE 'TCKRSTCNTL'   TO AA-DB2-TABLE-1                19720099
207900             MOVE SPACES         TO AA-DB2-TABLE-2                19730099
208000                                    AA-DB2-TABLE-3                19740099
208100             PERFORM Z998-DB2-ABEND                               19750099
208200     END-EVALUATE.                                                19760099
208300 EJECT                                                            19770099
208400*---------------------------------------------------------------  19780099
208500*    UPDATES THE CHECKPOINT RESTART INFO TABLE.  THE WORKING      19790099
208600*    STORAGE DESCRIPTION FIELD IS UPDATED WITH THE LAST COMMITED  19800099
208700*    PO STORE NUMBER COMBINATION.                                 19810099
208800*---------------------------------------------------------------  19820099
208900 U400-UPDATE-CHECKPOINT-INFO.                                     19830099
209000                                                                  19840099
209100     EXEC SQL                                                     19850099
209200         UPDATE TCKRSTINF                                         19860099
209300         SET WORK_STRG_DESC   = :TCKRSTINF-WORK-STRG-DESC         19870099
209400         WHERE PLAN_NAME      = :PC-PROGRAM-NAME                  19880099
209500     END-EXEC.                                                    19890099
209600                                                                  19900099
209700     EVALUATE TRUE                                                19910099
209800         WHEN SQLCODE = ZEROS                                     19920099
209900              CONTINUE                                            19930099
210000                                                                  19940099
210100         WHEN OTHER                                               19950099
210200             MOVE 'U400-UPDATE-CHECKPOINT-INFO'                   19960099
210300                                 TO AA-PARAGRAPH-NAME             19970099
210400             MOVE 'UNSUCCESSFUL UPDATE'                           19980099
210500                                 TO AA-DB2-OPERATION              19990099
210600             MOVE 'TCKRSTINF'    TO AA-DB2-TABLE-1                20000099
210700             MOVE SPACES         TO AA-DB2-TABLE-2                20010099
210800                                    AA-DB2-TABLE-3                20020099
210900             PERFORM Z998-DB2-ABEND                               20030099
211000     END-EVALUATE.                                                20040099
211100 EJECT                                                            20050099
211110*--------------------------------------------------------------*  20060099
211120* OPEN LOCATION CURSOR                                         *  20070099
211130*--------------------------------------------------------------*  20080099
211140 X100-OPEN-LOCATION-CSR.                                          20090099
211150                                                                  20100099
211160     EXEC SQL                                                     20110099
211170        OPEN LOCATION_CSR                                         20120099
211180     END-EXEC.                                                    20130099
211190                                                                  20140099
211191     EVALUATE TRUE                                                20150099
211192         WHEN SQLCODE = ZERO                                      20160099
211193              CONTINUE                                            20170099
211194         WHEN SQLWARN0 NOT = SPACES                               20180099
211195         WHEN SQLCODE  NOT = ZERO                                 20190099
211196             MOVE 'X100-OPEN-LOCATION-CSR' TO AA-PARAGRAPH-NAME   20200099
211197             MOVE 'UNSUCCESSFUL OPEN '     TO AA-DB2-OPERATION    20210099
211198             MOVE 'XFT00017'               TO AA-DB2-TABLE-1      20220099
211199             MOVE SPACES                   TO AA-DB2-TABLE-2      20230099
211200             PERFORM Z998-DB2-ABEND                               20240099
211208     END-EVALUATE.                                                20250099
211209                                                                  20260099
211210*--------------------------------------------------------------*  20270099
211211* FETCH ROWS FROM LOCATION CURSOR AND LOAD INTO LOCATION TABLE *  20280099
211212* FOR STORE NUMBER VALIDATION.                                 *  20290099
211213*--------------------------------------------------------------*  20300099
211214 X200-LOAD-LOCATION-TBL.                                          20310099
211215                                                                  20320099
211220     EXEC SQL                                                     20330099
211221          FETCH LOCATION_CSR                                      20340099
211222          INTO :PV-STORE-DIGITS                                   20350099
211224     END-EXEC.                                                    20360099
211225                                                                  20370099
211226     EVALUATE TRUE                                                20380099
211227       WHEN SQLCODE = +100                                        20390099
211228            SET END-OF-LOC-CSR TO TRUE                            20400099
211229       WHEN SQLCODE = ZERO                                        20410099
211230            MOVE PV-STORE-DIGITS TO WS-STORE-NBR(LOC-INDX)        20420099
211231            DISPLAY 'LOCATION LOADED = ' PV-STORE-DIGITS          20430099
211233       WHEN SQLWARN0 NOT = SPACES                                 20440099
211234       WHEN SQLCODE  NOT = ZERO                                   20450099
211235            MOVE 'X200-LOAD-LOCATION-TBL' TO AA-PARAGRAPH-NAME    20460099
211236            MOVE 'UNSUCCESSFUL FETCH'     TO AA-DB2-OPERATION     20470099
211237            MOVE 'XFT00017'               TO AA-DB2-TABLE-1       20480099
211238            MOVE SPACES                   TO AA-DB2-TABLE-2       20490099
211239            PERFORM Z998-DB2-ABEND                                20500099
211242     END-EVALUATE.                                                20510099
211244                                                                  20520099
211245*--------------------------------------------------------------*  20530099
211246* CLOSE LOCATION CURSOR                                        *  20540099
211247*--------------------------------------------------------------*  20550099
211248 X300-CLOSE-LOCATION-CSR.                                         20560099
211249                                                                  20570099
211250     EXEC SQL                                                     20580099
211251        CLOSE LOCATION_CSR                                        20590099
211252     END-EXEC.                                                    20600099
211253                                                                  20610099
211254     EVALUATE TRUE                                                20620099
211255         WHEN SQLCODE = ZERO                                      20630099
211256              CONTINUE                                            20640099
211257         WHEN SQLWARN0 NOT = SPACES                               20650099
211258         WHEN SQLCODE  NOT = ZERO                                 20660099
211259             MOVE 'X300-CLOSE-LOCATION-CSR' TO AA-PARAGRAPH-NAME  20670099
211261             MOVE 'UNSUCCESSFUL CLOSE'      TO AA-DB2-OPERATION   20680099
211263             MOVE 'XFT00017'                TO AA-DB2-TABLE-1     20690099
211264             MOVE SPACES                    TO AA-DB2-TABLE-2     20700099
211266             PERFORM Z998-DB2-ABEND                               20710099
211276     END-EVALUATE.                                                20720099
211277                                                                  20730099
211280*---------------------------------------------------------------  20740099
211300*    OPENS THE BULK INVOICE CURSOR.                               20750099
211400*---------------------------------------------------------------  20760099
211500 Y100-OPEN-BULK-INVOICE-CSR.                                      20770099
211600                                                                  20780099
211700     EXEC SQL                                                     20790099
211800         OPEN BULK_INVOICE_CSR                                    20800099
211900     END-EXEC.                                                    20810099
212000                                                                  20820099
212100     EVALUATE TRUE                                                20830099
212200         WHEN SQLCODE = ZERO                                      20840099
212300              CONTINUE                                            20850099
212400                                                                  20860099
212500         WHEN SQLWARN0 NOT = SPACES                               20870099
212600         WHEN SQLCODE  NOT = ZERO                                 20880099
212700             MOVE 'Y100-OPEN-BULK-INVOICE-CSR'                    20890099
212800                                 TO AA-PARAGRAPH-NAME             20900099
212900             MOVE 'UNSUCCESSFUL OPEN ON BULK_INVOICE_CSR'         20910099
213000                                 TO AA-DB2-OPERATION              20920099
213100             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                20930099
213200             MOVE SPACES         TO AA-DB2-TABLE-2                20940099
213300                                    AA-DB2-TABLE-3                20950099
213400             PERFORM Z998-DB2-ABEND                               20960099
213500     END-EVALUATE.                                                20970099
213600                                                                  20980099
213700                                                                  20990099
213800*---------------------------------------------------------------  21000099
213900*    CLOSES THE BULK INVOICE CURSOR.                              21010099
214000*---------------------------------------------------------------  21020099
214100 Y200-CLOSE-BULK-INVOICE-CSR.                                     21030099
214200                                                                  21040099
214300     EXEC SQL                                                     21050099
214400         CLOSE BULK_INVOICE_CSR                                   21060099
214500     END-EXEC.                                                    21070099
214600                                                                  21080099
214700     EVALUATE TRUE                                                21090099
214800         WHEN SQLCODE = ZERO                                      21100099
214900              CONTINUE                                            21110099
215000                                                                  21120099
215100         WHEN SQLWARN0 NOT = SPACES                               21130099
215200         WHEN SQLCODE  NOT = ZERO                                 21140099
215300             MOVE 'Y200-CLOSE-BULK-INVOICE-CSR'                   21150099
215400                                 TO AA-PARAGRAPH-NAME             21160099
215500             MOVE 'UNSUCCESSFUL CLOSE ON BULK_INVOICE_CSR'        21170099
215600                                 TO AA-DB2-OPERATION              21180099
215700             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                21190099
215800             MOVE SPACES         TO AA-DB2-TABLE-2                21200099
215900                                    AA-DB2-TABLE-3                21210099
216000             PERFORM Z998-DB2-ABEND                               21220099
216100     END-EVALUATE.                                                21230099
216200 EJECT                                                            21240099
216300*---------------------------------------------------------------  21250099
216400*    OPENS THE BY STORE INVOICE CURSOR.                           21260099
216500*---------------------------------------------------------------  21270099
216600 Y300-OPEN-BYSTR-INVOICE-CSR.                                     21280099
216700                                                                  21290099
216800     EXEC SQL                                                     21300099
216900         OPEN BYSTR_INVOICE_CSR                                   21310099
217000     END-EXEC.                                                    21320099
217100                                                                  21330099
217200     EVALUATE TRUE                                                21340099
217300         WHEN SQLCODE = ZERO                                      21350099
217400              CONTINUE                                            21360099
217500                                                                  21370099
217600         WHEN SQLWARN0 NOT = SPACES                               21380099
217700         WHEN SQLCODE  NOT = ZERO                                 21390099
217800             MOVE 'Y300-OPEN-BYSTR-INVOICE-CSR'                   21400099
217900                                 TO AA-PARAGRAPH-NAME             21410099
218000             MOVE 'UNSUCCESSFUL OPEN ON BYSTR_INVOICE_CSR'        21420099
218100                                 TO AA-DB2-OPERATION              21430099
218200             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                21440099
218300             MOVE SPACES         TO AA-DB2-TABLE-2                21450099
218400                                    AA-DB2-TABLE-3                21460099
218500             PERFORM Z998-DB2-ABEND                               21470099
218600     END-EVALUATE.                                                21480099
218700                                                                  21490099
218800                                                                  21500099
218900*---------------------------------------------------------------  21510099
219000*    CLOSES THE BY STORE INVOICE CURSOR.                          21520099
219100*---------------------------------------------------------------  21530099
219200 Y400-CLOSE-BYSTR-INVOICE-CSR.                                    21540099
219300                                                                  21550099
219400     EXEC SQL                                                     21560099
219500         CLOSE BYSTR_INVOICE_CSR                                  21570099
219600     END-EXEC.                                                    21580099
219700                                                                  21590099
219800     EVALUATE TRUE                                                21600099
219900         WHEN SQLCODE = ZERO                                      21610099
220000              CONTINUE                                            21620099
220100                                                                  21630099
220200         WHEN SQLWARN0 NOT = SPACES                               21640099
220300         WHEN SQLCODE  NOT = ZERO                                 21650099
220400             MOVE 'Y400-CLOSE-BYSTR-INVOICE-CSR'                  21660099
220500                                 TO AA-PARAGRAPH-NAME             21670099
220600             MOVE 'UNSUCCESSFUL CLOSE ON BYSTR_INVOICE_CSR'       21680099
220700                                 TO AA-DB2-OPERATION              21690099
220800             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                21700099
220900             MOVE SPACES         TO AA-DB2-TABLE-2                21710099
221000                                    AA-DB2-TABLE-3                21720099
221100             PERFORM Z998-DB2-ABEND                               21730099
221200     END-EVALUATE.                                                21740099
221300 EJECT                                                            21750099
221440*---------------------------------------------------------------  21760099
221500*    COMMITS ALL DB2 UPDATES PERFORMED.                           21770099
221600*---------------------------------------------------------------  21780099
221700 Z100-COMMIT.                                                     21790099
221800                                                                  21800099
221900     EXEC SQL                                                     21810099
222000         COMMIT                                                   21820099
222100     END-EXEC.                                                    21830099
222200                                                                  21840099
222300     EVALUATE TRUE                                                21850099
222400         WHEN SQLCODE = ZERO                                      21860099
222500              CONTINUE                                            21870099
222600                                                                  21880099
222700         WHEN SQLWARN0 NOT = SPACES                               21890099
222800         WHEN SQLCODE  NOT = ZERO                                 21900099
222900             MOVE 'Z100-COMMIT'  TO AA-PARAGRAPH-NAME             21910099
223000             MOVE 'UNSUCCESSFUL COMMIT'                           21920099
223100                                 TO AA-DB2-OPERATION              21930099
223200             MOVE SPACES         TO AA-DB2-TABLE-1                21940099
223300                                    AA-DB2-TABLE-2                21950099
223400                                    AA-DB2-TABLE-3                21960099
223500             PERFORM Z998-DB2-ABEND                               21970099
223600     END-EVALUATE.                                                21980099
223700 EJECT                                                            21990099
223800 Z998-DB2-ABEND.                                                  22000099
223900                                                                  22010099
224000     CLOSE  UNJOURNALIZED-FILE.                                   22020099
224100                                                                  22030099
224200     DISPLAY 'SAVED PO NUMBER: ' PV-PO-NBR.                       22040099
224300     DISPLAY 'SAVED STORE NBR: ' PV-STR-NBR.                      22050099
224400     DISPLAY AA-ABEND-LIT.                                        22060099
224500     DISPLAY AA-DB2-ERROR-LIT.                                    22070099
224600     DISPLAY AA-PROGRAM-LIT.                                      22080099
224700     DISPLAY AA-PARAGRAPH-LIT.                                    22090099
224800     DISPLAY AA-DB2-OPERATION-LIT.                                22100099
224900     DISPLAY AA-DB2-TABLE-1.                                      22110099
225000     DISPLAY AA-DB2-TABLE-2.                                      22120099
225100     DISPLAY AA-DB2-TABLE-3.                                      22130099
225200     SET AC-DB2-ERROR TO TRUE.                                    22140099
225300                                                                  22150099
225400     COPY DPPD004.                                                22160099
225500                                                                  22170099
225600     CALL 'ILBOABN0' USING ABEND-CODE.                            22180099
225700 EJECT                                                            22190099
225800*---------------------------------------------------------------  22200099
225900*    ABEND ROUTINE                                                22210099
226000*---------------------------------------------------------------  22220099
226100 Z999-ABEND.                                                      22230099
226200                                                                  22240099
226300     CLOSE  UNJOURNALIZED-FILE.                                   22250099
226400                                                                  22260099
226500     DISPLAY AA-ABEND-LIT.                                        22270099
226600     DISPLAY AA-PROGRAM-LIT.                                      22280099
226700     DISPLAY AA-PARAGRAPH-LIT.                                    22290099
226800     DISPLAY AA-MESSAGE-LINE.                                     22300099
226900     CALL 'ILBOABN0' USING ABEND-CODE.                            22310099
