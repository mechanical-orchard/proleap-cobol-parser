000100*-----------------------*                                         00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300*-----------------------*                                         00030001
000400 PROGRAM-ID.    RCKCS251.                                         00040001
000500 AUTHOR.        ANNE RECKNAGEL.                                   00050001
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060001
000700 DATE-WRITTEN.  05-04-94.                                         00070001
000800 DATE-COMPILED.                                                   00080001
000900*----------------------------------------------------------------*00090001
001000*    E251 - PO LINE SELECTION CRITERIA FOR "MATCH TO PO"         *00100001
001100*                                                                *00110001
001200*    THIS PROGRAM ALLOWS THE USER ENTER DATA TO BE USED BY       *00120001
001300*    SUBSEQUENT PROGRAMS TO CREATE A LIST OR TO BRING UP A       *00130001
001400*    DETAIL SCREEN.  THE OPERATING UNIT ID, FACILITY ID, AND     *00140001
001500*    PURCHASE ORDER NUMBER ARE REQUIRED.                         *00150001
001600*----------------------------------------------------------------*00160001
001700                                                                  00170001
001800                                                                  00180001
001900                                                                  00190001
002000 ENVIRONMENT DIVISION.                                            00200001
002100                                                                  00210001
002200                                                                  00220001
002300                                                                  00230001
002400 DATA DIVISION.                                                   00240001
002500                                                                  00250001
002600                                                                  00260001
002700 WORKING-STORAGE SECTION.                                         00270001
002800                                                                  00280001
002900 01  DK-DB2-KEYS.                                                 00290001
003000     05  DK-OPER-UNT-ID            PIC S9(04)  VALUE +0           00300001
003100                                               COMP.              00310001
003200     05  DK-FCLTY-ID               PIC S9(04)  VALUE +0           00320001
003300                                               COMP.              00330001
003400     05  DK-PO-NBR                 PIC S9(09)  VALUE +0           00340001
003500                                               COMP.              00350001
003600                                                                  00360001
003700 01  PC-PROGRAM-CONSTANTS.                                        00370001
003800     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'RC251A  '. 00380001
003900     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'RCKM251 '. 00390001
004000     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'RCKCS251'. 00400001
004100     05  PC-LIST-QUEUE-SEQ         PIC  9      VALUE 1.           00410001
004200     05  PC-SEL-QUEUE-SEQ          PIC  9      VALUE 2.           00420001
004300     05  PC-INTER-APPL-PKSLIP-ADD3 PIC  X(01)  VALUE '3'.         00430001
004400     05  PC-INTER-APPL-PKSLIP-ADD4 PIC  X(01)  VALUE '4'.         00440001
004500                                                                  00450001
004600                                                                  00460001
004700*----------------------------------------------------------------*00470001
004800*    MAP LAYOUT                                                  *00480001
004900*----------------------------------------------------------------*00490001
005000                                                                  00500001
005100     COPY RCKM251.                                                00510001
005200     EJECT                                                        00520001
005300*----------------------------------------------------------------*00530001
005400*    ATTRIBUTE SETTINGS COPYBOOK.                                *00540001
005500*----------------------------------------------------------------*00550001
005600                                                                  00560001
005700     COPY DPWS015.                                                00570001
005800                                                                  00580001
005900*----------------------------------------------------------------*00590001
006000*    FUNCTION KEYS COPYBOOK                                      *00600001
006100*----------------------------------------------------------------*00610001
006200                                                                  00620001
006300     COPY DPWS016.                                                00630001
006400 EJECT                                                            00640001
006500******************************************************************00650001
006600** THE CALLING PARAMETER LIST (DPWS030/DPWS930) FOR THE CICS    **00660002
006700** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **00670001
006800******************************************************************00680001
006900     COPY DPWS030.                                                00690001
006910     COPY DPWS930.                                                00691002
007000 EJECT                                                            00700001
007100***************************************************************** 00710001
007200*    STANDARD COMMAREA.                                           00720001
007300***************************************************************** 00730001
007400                                                                  00740001
007500     COPY DPWS020.                                                00750001
007600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                00760001
007700                                                                  00770001
007800***************************************************************** 00780001
007900*    INTER-APPLICATION COMMAREA.                                  00790001
008000***************************************************************** 00800001
008100                                                                  00810001
008200         10  INTER-APPL-COMM-AREA PIC X(200).                     00820001
008300     COPY RCWS015.                                                00830001
008400     COPY RCWS012.                                                00840001
008500***************************************************************** 00850001
008600*    SPECIFIC COMMMAREA FOR RCKCS251.                             00860001
008700***************************************************************** 00870001
008800         10  ASC-SPECIFIC-COMMAREA.                               00880001
008900             15  ASC-KEY-PO-NBR-N            PIC S9(09) COMP.     00890001
009000             15  ASC-KEY-PKSL-NBR            PIC  X(10).          00900001
009100             15  ASC-KEY-SEQ-NBR             PIC S9(04) COMP.     00910001
009200             15  ASC-KEY-OPER-UNT-ID         PIC S9(04) COMP.     00920001
009300             15  ASC-KEY-FCLTY-ID            PIC S9(04) COMP.     00930001
009400             15  ASC-KEY-STR-NBR             PIC S9(04) COMP.     00940001
009500             15  ASC-KEY-REC-SEQ-NBR         PIC S9(09) COMP.     00950001
009600             15  ASC-LIST-QUEUE-NAME.                             00960001
009700                 20  ASC-LIST-TERM-ID        PIC  X(04).          00970001
009800                 20  ASC-LIST-TASK-NUMBER    PIC S9(05) COMP-3.   00980001
009900                 20  ASC-LIST-SEQ            PIC  9.              00990001
010000             15  ASC-SEL-QUEUE-NAME.                              01000001
010100                 20  ASC-SEL-TERM-ID         PIC  X(04).          01010001
010200                 20  ASC-SEL-TASK-NUMBER     PIC S9(05) COMP-3.   01020001
010300                 20  ASC-SEL-SEQ             PIC  9.              01030001
010400     EJECT                                                        01040001
010500*----------------------------------------------------------------*01050001
010600*    ABEND PROCESSING COPYBOOK.                                  *01060001
010700*----------------------------------------------------------------*01070001
010800                                                                  01080001
010900     COPY DPWS013.                                                01090001
011000                                                                  01100001
011100                                                                  01110001
011200 EJECT                                                            01120001
011300 LINKAGE SECTION.                                                 01130001
011400                                                                  01140001
011500 01  DFHCOMMAREA.                                                 01150001
011600     05  FILLER                         OCCURS  1 TO 4072 TIMES   01160001
011700                                        DEPENDING ON EIBCALEN.    01170001
011800         10  FILLER                     PIC X.                    01180001
011900                                                                  01190001
012000                                                                  01200001
012100 PROCEDURE DIVISION.                                              01210001
012200***************************************************************** 01220001
012300** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 01230001
012400** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 01240001
012500** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 01250001
012600**                                                             ** 01260001
012700** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 01270001
012800** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 01280001
012900***************************************************************** 01290001
013000 0000-MAIN-MODULE.                                                01300001
013100                                                                  01310001
013200     INITIALIZE DP030-CICS-API-FIELDS.                            01320001
013300                                                                  01330001
013400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       01340001
013500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          01350001
013600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         01360001
013700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       01370001
013800     MOVE LENGTH OF RC251AI        TO DP030-MAP-LENGTH (1).       01380001
013900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     01390001
014000     PERFORM 0001-CALL-CICS-ARCH-API.                             01400001
014100                                                                  01410001
014200     PERFORM 1000-CONTROL-PROCESSING                              01420001
014300                                                                  01430001
014400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     01440001
014500     PERFORM 0001-CALL-CICS-ARCH-API.                             01450001
014600                                                                  01460001
014700 0001-CALL-CICS-ARCH-API.                                         01470001
014800                                                                  01480001
014910     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      01491002
015000                                    DFHCOMMAREA                   01500002
015100                                    DP030-CICS-API-FIELDS         01510002
015200                                    DP020-STANDARD-COMMAREA       01520002
015300                                    RC251AI.                      01530002
015400                                                                  01540001
015500     IF  DP030-RC-CALL-SUCCESSFUL                                 01550001
015600         CONTINUE                                                 01560001
015700     ELSE                                                         01570001
015800         SET DP013-NO-ROLLBACK                                    01580001
015900             DP013-XCTL-DISPLAY-RESTART                           01590001
016000             DP013-CICS-ABEND      TO TRUE                        01600001
016100         MOVE 'BEFORE 0000-MAIN-MODULE'                           01610001
016200                                   TO DP013-PARAGRAPH             01620001
016300         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN CODE O01630003
016310-             'N NEXT LINE'                                       01631004
016400                                   TO DP013-MESSAGE-TEXT (2)      01640002
016500         MOVE DP030-RETURN-CODE                                   01650001
016600                                   TO DP013-MESSAGE-TEXT (3)      01660001
016700         PERFORM DP013-0000-PROCESS-ABEND                         01670001
016800     END-IF.                                                      01680001
016900 EJECT                                                            01690001
017000*----------------------------------------------------------------*01700001
017100*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *01710001
017200*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *01720001
017300*----------------------------------------------------------------*01730001
017400                                                                  01740001
017500 1000-CONTROL-PROCESSING.                                         01750001
017600                                                                  01760001
017700     EVALUATE TRUE                                                01770001
017800         WHEN DP020-NEXT-ACT-INITIAL                              01780001
017900             INITIALIZE ASC-SPECIFIC-COMMAREA                     01790001
018000             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            01800001
018100                                      ASC-SEL-TERM-ID             01810001
018200             MOVE DP020-SRC-TASK-NUMBER                           01820001
018300                                   TO ASC-LIST-TASK-NUMBER        01830001
018400                                      ASC-SEL-TASK-NUMBER         01840001
018500             MOVE PC-LIST-QUEUE-SEQ                               01850001
018600                                   TO ASC-LIST-SEQ                01860001
018700             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 01870001
018800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 01880001
018900             PERFORM 4000-BUILD-INITIAL-PANEL                     01890001
019000                                                                  01900001
019100         WHEN DP020-NEXT-ACT-READ-MAP                             01910001
019200             PERFORM 2000-FKEY-PROCESSING                         01920001
019300                                                                  01930001
019400         WHEN DP020-NEXT-ACT-RETURN                               01940001
019500             PERFORM 4000-BUILD-INITIAL-PANEL                     01950001
019600                                                                  01960001
019700         WHEN OTHER                                               01970001
019800             SET DP013-LOGIC-ABEND                                01980001
019900                 DP013-NO-ROLLBACK TO TRUE                        01990001
020000             MOVE '1000-CONTROL-PROCESSING'                       02000001
020100                                   TO  DP013-PARAGRAPH            02010001
020200             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   02020001
020300                                   TO  DP013-MESSAGE-TEXT(1)      02030001
020400             MOVE DP020-NEXT-APPL-ACTIVITY                        02040001
020500                                   TO DP013-MESSAGE-TEXT(2)       02050001
020600             PERFORM DP013-0000-PROCESS-ABEND                     02060001
020700     END-EVALUATE.                                                02070001
020800                                                                  02080001
020900 EJECT                                                            02090001
021000                                                                  02100001
021100 1100-PROCESS-INTER-APPL-COMM.                                    02110001
021200                                                                  02120001
021300     IF DP020-INT-APPL-FORMAT-IND = PC-INTER-APPL-PKSLIP-ADD3 OR  02130001
021400        DP020-INT-APPL-FORMAT-IND = PC-INTER-APPL-PKSLIP-ADD4     02140001
021500         MOVE RC012-PO-NBR           TO ASC-KEY-PO-NBR-N          02150001
021600         MOVE RC012-PKSL-NBR         TO ASC-KEY-PKSL-NBR          02160001
021700         MOVE RC012-SEQ-NBR          TO ASC-KEY-SEQ-NBR           02170001
021800         MOVE RC012-OPER-UNT-ID      TO ASC-KEY-OPER-UNT-ID       02180001
021900         MOVE RC012-FCLTY-ID         TO ASC-KEY-FCLTY-ID          02190001
022000         MOVE RC012-STR-NBR          TO ASC-KEY-STR-NBR           02200001
022100         MOVE RC012-REC-SEQ-NBR      TO ASC-KEY-REC-SEQ-NBR       02210001
022200     ELSE                                                         02220001
022300         MOVE RC015-PO-NBR           TO ASC-KEY-PO-NBR-N          02230001
022400         MOVE RC015-PKSL-NBR         TO ASC-KEY-PKSL-NBR          02240001
022500         MOVE RC015-SEQ-NBR          TO ASC-KEY-SEQ-NBR           02250001
022600         MOVE RC015-OPER-UNT-ID      TO ASC-KEY-OPER-UNT-ID       02260001
022700         MOVE RC015-FCLTY-ID         TO ASC-KEY-FCLTY-ID          02270001
022800         MOVE RC015-STR-NBR          TO ASC-KEY-STR-NBR           02280001
022900         MOVE RC015-REC-SEQ-NBR      TO ASC-KEY-REC-SEQ-NBR       02290001
023000     END-IF.                                                      02300001
023100                                                                  02310001
023200*----------------------------------------------------------------*02320001
023300* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*02330001
023400* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*02340001
023500* EDITS.                                                         *02350001
023600*----------------------------------------------------------------*02360001
023700                                                                  02370001
023800 2000-FKEY-PROCESSING.                                            02380001
023900                                                                  02390001
024000     EVALUATE TRUE                                                02400001
024100                                                                  02410001
024200         WHEN DP020-SRC-AID = DP016-CLEAR                         02420001
024300             PERFORM 4000-BUILD-INITIAL-PANEL                     02430001
024400                                                                  02440001
024500         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     02450001
024600             INITIALIZE ASC-SPECIFIC-COMMAREA                     02460001
024700             PERFORM 4000-BUILD-INITIAL-PANEL                     02470001
024800                                                                  02480001
024900         WHEN OTHER                                               02490001
025000             SET DP030-CONTINUE-GO TO TRUE                        02500001
025100             PERFORM 2100-CHECK-FUNCTION-KEY                      02510001
025200     END-EVALUATE.                                                02520001
025300                                                                  02530001
025400******************************************************************02540001
025500** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **02550001
025600** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **02560001
025700** FROM THE CICS ARCHITECTURE API.                              **02570001
025800******************************************************************02580001
025900 2100-CHECK-FUNCTION-KEY.                                         02590001
026000                                                                  02600001
026100     EVALUATE TRUE                                                02610001
026200         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 02620001
026300             PERFORM 2110-PREPARE-INTER-APPL-COMM                 02630001
026400                                                                  02640001
026500         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              02650001
026600             PERFORM 2110-PREPARE-INTER-APPL-COMM                 02660001
026700                                                                  02670001
026800         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              02680001
026900             PERFORM 2110-PREPARE-INTER-APPL-COMM                 02690001
027000                                                                  02700001
027100         WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)              02710001
027200             PERFORM 2110-PREPARE-INTER-APPL-COMM                 02720001
027300                                                                  02730001
027400         WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)              02740001
027500             PERFORM 2110-PREPARE-INTER-APPL-COMM                 02750001
027600                                                                  02760001
027700         WHEN DP020-FK-LOCAL-FUNC-07 (DP020-SRC-AID)              02770001
027800             PERFORM 2110-PREPARE-INTER-APPL-COMM                 02780001
027900                                                                  02790001
028000         WHEN DP020-SRC-AID = DP016-ENTER                         02800001
028100             CONTINUE                                             02810001
028200                                                                  02820001
028300         WHEN OTHER                                               02830001
028400             SET DP013-NO-ROLLBACK                                02840001
028500                 DP013-XCTL-DISPLAY-RESTART                       02850001
028600                 DP013-CICS-ABEND  TO TRUE                        02860001
028700             MOVE '2100-CHECK-FUNCTION-KEY'                       02870001
028800                                   TO DP013-PARAGRAPH             02880001
028900             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      02890001
029000                                   TO DP013-MESSAGE-TEXT (1)      02900001
029100             PERFORM DP013-0000-PROCESS-ABEND                     02910001
029200     END-EVALUATE.                                                02920001
029300                                                                  02930001
029400******************************************************************02940001
029500** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **02950001
029600** INTER-APPLICATION COMMAREA.                                  **02960001
029700******************************************************************02970001
029800 2110-PREPARE-INTER-APPL-COMM.                                    02980001
029900                                                                  02990001
030000     MOVE ASC-KEY-PO-NBR-N         TO RC015-PO-NBR.               03000001
030100     MOVE ASC-KEY-PKSL-NBR         TO RC015-PKSL-NBR.             03010001
030200     MOVE ASC-KEY-REC-SEQ-NBR      TO RC015-REC-SEQ-NBR.          03020001
030300     MOVE ASC-KEY-SEQ-NBR          TO RC015-SEQ-NBR.              03030001
030400     MOVE ASC-KEY-OPER-UNT-ID      TO RC015-OPER-UNT-ID.          03040001
030500     MOVE ASC-KEY-FCLTY-ID         TO RC015-FCLTY-ID.             03050001
030600     MOVE ASC-KEY-STR-NBR          TO RC015-STR-NBR.              03060001
030700                                                                  03070001
030800 EJECT                                                            03080001
030900                                                                  03090001
031000*----------------------------------------------------------------*03100001
031100*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *03110001
031200*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *03120001
031300*  IT HERE.                                                      *03130001
031400*----------------------------------------------------------------*03140001
031500 4000-BUILD-INITIAL-PANEL.                                        03150001
031600                                                                  03160001
031700     SET DP030-SET-CURSOR-TRAILER  TO TRUE.                       03170001
031800                                                                  03180001
031900 EJECT                                                            03190001
032000*----------------------------------------------------------------*03200001
032100*    ABEND PROCESSOR MODULE                                      *03210001
032200*----------------------------------------------------------------*03220001
032300                                                                  03230001
032400     COPY DPPD013.                                                03240001
