      *-----------------------*                                         03/19/93
       IDENTIFICATION DIVISION.                                         TRKCS361
      *-----------------------*                                            LV067
       PROGRAM-ID.    TRKCS361.                                            CL**1
       AUTHOR.        DIANE DARR.                                          CL**1
       INSTALLATION.  KOHLS DEPARTMENT STORES.                             CL**1
       DATE-WRITTEN.  06-19-2001.                                          CL**1
       DATE-COMPILED.                                                      CL**1
                                                                           CL**1
      *---------------------------------------------------------------*    CL**1
      *    Y361 - MESSAGE DISPLAY PROGRAM.                            *    CL**1
      *                                                               *    CL**1
      *    THIS PROGRAM DISPLAYS THE MESSAGE TEXT FOR THE CODES       *    CL**1
      *    PASSED FROM POKCS061.                                      *    CL**1
      *---------------------------------------------------------------*    CL**1
CICS  * CHANGED  1/17/2023    BY JIM HUNTER      WR: CHG0278495                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
                                                                           CL**1
       ENVIRONMENT DIVISION.                                               CL**1
                                                                           CL**1
       DATA DIVISION.                                                      CL**1
                                                                           CL**1
       WORKING-STORAGE SECTION.                                            CL**1
                                                                           CL**1
       01  PC-PROGRAM-CONSTANTS.                                           CL**1
           05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE            CL**1
                                                          'TR361A  '.      CL**2
           05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE            CL**1
                                                          'TRKM361 '.      CL**2
           05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE            CL**1
                                                          'TRKCS361'.      CL**2
           05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.         CL**1
           05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.         CL**1
           05  PC-DTL-QUEUE-SEQ               PIC  9(01)  VALUE 3.         CL**2
           05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.       CL**1
           05  PC-LIST-FORMAT                 PIC  X(01)  VALUE '2'.       CL*41
           05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +15        CL**2
                                                          COMP SYNC.       CL**1
           05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +1         CL**1
                                                          COMP SYNC.       CL**1
           05  PC-MAX-ITEMS                   PIC S9(09)  VALUE            CL**1
                                                          +1000000         CL**1
                                                          COMP-3.          CL**1
           05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3         CL**1
                                                           COMP-3.         CL**1
           05  PC-UNKNOWN-MSG.                                                  
      ***      10  PC-UNKNOWN-MSG-TEXT1       PIC X(14)                         
      ***          VALUE '** WRONG CODE '.                                      
      ***      10  PC-UNKNOWN-MSG-CODE        PIC XX.                           
      ***      10  PC-UNKNOWN-MSG-TEXT2       PIC X(2)                          
      ***          VALUE '**'.                                                  
               10  PC-UNKNOWN-MSG-TEXT1       PIC X(7)                          
                   VALUE 'BAD CD '.                                             
               10  PC-UNKNOWN-MSG-CODE        PIC XX.                           
               10  PC-UNKNOWN-MSG-TEXT2       PIC X(9)                          
                   VALUE 'CALL PGMG'.                                           
                                                                           CL**8
       01  PC-TSYMSG-NUMBERS.                                              CL**1
           05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.     CL**1
           05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.     CL**1
           05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.     CL**1
           05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.     CL**1
           05  PC-TSYMSG-00101                PIC 9(5)    VALUE 00101.     CL**1
           05  PC-TSYMSG-00148                PIC 9(5)    VALUE 00148.     CL*41
           05  PC-TSYMSG-00279                PIC 9(5)    VALUE 00279.     CL*66
           05  PC-TSYMSG-00302                PIC 9(5)    VALUE 00302.     CL*41
                                                                           CL**8
       01  PS-PROGRAM-SUBSCRIPTS.                                          CL**1
           05  PS-SUB                         PIC S9(04)   VALUE +0        CL**1
                                                           COMP SYNC.      CL**1
                                                                           CL**1
       01  PS-PROGRAM-SWITCHES.                                            CL**1
           05  PS-ERROR-SW                    PIC X(01)    VALUE 'Y'.      CL**1
               88  PS-NO-ERROR                             VALUE 'Y'.      CL**1
               88  PS-ERROR                                VALUE 'N'.      CL**1
           05  PS-COMMAREA-SW                 PIC X(01)    VALUE 'N'.      CL**1
               88  PS-COMMAREA-VALID                       VALUE 'Y'.      CL**1
               88  PS-COMMAREA-NOT-VALID                   VALUE 'N'.      CL**1
           05  PS-LIST-END-SW                 PIC X(01)    VALUE 'N'.      CL*55
               88  PS-LIST-END                             VALUE 'Y'.      CL*55
               88  PS-NO-LIST-END                          VALUE 'N'.      CL*55
           EJECT                                                           CL**1
       01  PV-PROGRAM-VARIABLES.                                           CL**1
           05  PV-DEPT-NBR                    PIC  X(04).                       
           05  PV-DEPT-NBR-N REDEFINES                                          
               PV-DEPT-NBR                    PIC S9(04).                       
           05  PV-RETRY-COUNTER               PIC S9(04)   VALUE +0        CL**1
                                                           COMP SYNC.      CL**1
           05  PV-READ-COUNT                  PIC S9(09)   VALUE +0        CL**1
                                                           COMP-3.         CL**1
           05  PV-TOP-ITEM                    PIC S9(09)   VALUE +0        CL**1
                                                           COMP-3.         CL**1
           05  PV-BOTTOM-ITEM                 PIC S9(09)   VALUE +0        CL*58
                                                           COMP-3.         CL*58
           05  PV-BLOCK-NUMBER                PIC S9(04)   VALUE +0        CL**1
                                                           COMP SYNC.      CL**1
           05  PV-CICS-RESP                   PIC S9(04)   VALUE +0        CL**1
                                                           COMP SYNC.      CL**1
           05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)   VALUE +0        CL**1
                                                           COMP SYNC.      CL**1
           05  PV-LIST-ITEM-NUMBER            PIC S9(04)   VALUE +0        CL**1
                                                           COMP SYNC.      CL**1
           05  PV-SQL-SUB                     PIC S9(4)    COMP.           CL**1
                                                                           CL*42
       01  PV-DB2-CRITERIA-AREA.                                           CL**1
           15  PV-DB2-MESSAGE-NUMBER          PIC S9(05)  VALUE ZERO       CL**1
                                                          COMP-3.          CL**1
                                                                           CL**1
       EJECT                                                               CL**1
      *---------------------------------------------------------------*    CL**1
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          *    CL**1
      *---------------------------------------------------------------*    CL**1
                                                                           CL**1
           COPY DPWS030.                                                   CL*67
CICS       COPY DPWS930.                                                   CL*67
       EJECT                                                               CL**1
      *---------------------------------------------------------------*    CL**1
      *    STANDARD COMMAREA.                                         *    CL**1
      *---------------------------------------------------------------*    CL**1
                                                                           CL**1
           COPY DPWS020.                                                   CL**1
           05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                   CL**1
                                                                           CL**1
      *---------------------------------------------------------------*    CL**1
      *    INTER-APPLICATION COMMAREA.                                *    CL**1
      *---------------------------------------------------------------*    CL**1
                                                                           CL**1
               10  INTER-APPL-COMM-AREA       PIC X(200).                  CL**1
           COPY TRWS061.                                                        
      *---------------------------------------------------------------*    CL**1
      *    SPECIFIC COMMMAREA FOR TRKCS361.                           *    CL**2
      *---------------------------------------------------------------*    CL**1
               10  ASC-SPECIFIC-COMMAREA.                                  CL**1
                   15  ASC-LIST-KEYS.                                      CL**1
                       20  ASC-KEY-PO-NBR                  PIC S9(07)      CL**1
                                                           COMP.           CL**1
                       20  ASC-KEY-DEPT                    PIC  S9(04).    CL**1
                       20  ASC-KEY-VEND-NME                PIC  X(30).     CL*11
                   15  ASC-BLOCK-ENTRIES OCCURS 1 TIMES.                        
                       20  ASC-ITEM-ARRAY.                                 CL**1
                           25  ASC-ITEM-ENTRIES OCCURS 30 TIMES.           CL**2
                               30  ASC-LIST-MSG-ID         PIC X(02).      CL*11
                               30  ASC-TEXT                PIC X(18).      CL*18
                                                                           CL**1
                   15  ASC-BLK-SUB                         PIC S9(04)      CL**1
                                                               COMP        CL**1
                                                               SYNC.       CL**1
                   15  ASC-ITEM-SUB                        PIC S9(04)      CL**1
                                                               COMP        CL**1
                                                               SYNC.       CL**1
                   15  ASC-SEL-SUB                         PIC S9(04)      CL*41
                                                               COMP.       CL*41
                   15  ASC-SEL-ITEM                        PIC S9(04)      CL*41
                                                               COMP.       CL*41
                   15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)      CL**1
                                                               COMP-3.     CL**1
                   15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)      CL**1
                                                               COMP-3.     CL**1
                   15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)      CL*41
                                                               COMP-3.     CL*41
                   15  ASC-ITEMS-DISPLAYED                 PIC S9(03)      CL**1
                                                               COMP-3.     CL**1
                   15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)      CL**1
                                                               COMP-3.     CL**1
                   15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)      CL**1
                                                               COMP-3.     CL**1
                   15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)      CL**1
                                                               COMP        CL**1
                                                               SYNC.       CL**1
                   15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)      CL**1
                                                               COMP-3.     CL**1
                   15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)      CL**1
                                                               COMP-3.     CL**1
                   15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).     CL**1
                       88  ASC-ITEMS-LEFT-ON-DB              VALUE 'Y'.    CL**1
                       88  ASC-NO-ITEMS-LEFT-ON-DB           VALUE 'N'.    CL**1
                   15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).     CL*41
                       88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'.    CL*41
                   15  ASC-DESC-LINE-IND                   PIC  X(01).     CL*45
                       88  ASC-DESC-LINE-DONE                VALUE 'Y'.    CL*45
                   15  ASC-CORR-LINE-IND                   PIC  X(01).     CL*45
                       88  ASC-CORR-LINE-DONE                VALUE 'Y'.    CL*45
                   15  ASC-LIST-QUEUE-NAME.                                CL**1
                       20  ASC-LIST-TERM-ID                PIC  X(04).     CL**1
                       20  ASC-LIST-TASK-NUMBER            PIC S9(05)      CL**1
                                                               COMP-3.     CL**1
                       20  ASC-LIST-SEQ                    PIC  9(01).     CL**1
                   15  ASC-SEL-QUEUE-NAME.                                 CL**1
                       20  ASC-SEL-TERM-ID                 PIC  X(04).     CL**1
                       20  ASC-SEL-TASK-NUMBER             PIC S9(05)      CL**1
                                                                COMP-3.    CL**1
                       20  ASC-SEL-SEQ                     PIC  9(01).     CL**1
                   15  ASC-DTL-QUEUE-NAME.                                 CL**2
                       20  ASC-DTL-TERM-ID                 PIC  X(04).     CL**2
                       20  ASC-DTL-TASK-NUMBER             PIC S9(05)      CL**2
                                                               COMP-3.     CL**2
                       20  ASC-DTL-SEQ                     PIC  9(01).     CL**2
                                                                           CL**1
                   15  ASC-START-ITEM-REQUEST.                             CL**1
                       20  ASC-START-ITEM-REQUEST-N        PIC  9(05).     CL**1
                                                                                
                   15  ASC-MSG-AREA.                                            
                       20  ASC-MESSAGE-TEXT OCCURS 30 TIMES.                    
                           25  ASC-MSG-TXT                 PIC X(18).           
                                                                           CL**1
           EJECT                                                           CL**1
      *---------------------------------------------------------------*    CL**1
      *    ERROR MESSAGES TO DISPLAY                                  *    CL**1
      *---------------------------------------------------------------*    CL**1
                                                                           CL**1
           COPY TRWS062.                                                   CL**1
                                                                                
       01  WS-MESSAGE-TABLE REDEFINES EDIT-MESSAGES.                            
           05  WS-MSG-TABLE OCCURS 36 TIMES                                     
                            INDEXED BY MSG-INDX.                                
               10  WS-MSG-CDE            PIC X(02).                             
               10  WS-MSG-TXT            PIC X(18).                             
                                                                           CL**1
       01  WS-SUB                        PIC S9(2)   VALUE ZERO.                
                                                                           CL**1
           EJECT                                                           CL**1
      *---------------------------------------------------------------*    CL**1
      *    ABEND PROCESSING COPYBOOK.                                 *    CL**1
      *---------------------------------------------------------------*    CL**1
                                                                           CL**1
           COPY DPWS013.                                                   CL**1
                                                                           CL**1
           EJECT                                                           CL**1
      *---------------------------------------------------------------*    CL**1
      *    ATTRIBUTE SETTINGS COPYBOOK.                               *    CL**1
      *---------------------------------------------------------------*    CL**1
                                                                           CL**1
           COPY DPWS015.                                                   CL**1
                                                                           CL**1
      *---------------------------------------------------------------*    CL**1
      *    FUNCTION KEYS COPYBOOK.                                    *    CL**1
      *---------------------------------------------------------------*    CL**1
                                                                           CL**1
           COPY DPWS016.                                                   CL**1
                                                                           CL**1
      *---------------------------------------------------------------*    CL**1
      *    MAP LAYOUT                                                 *    CL**1
      *---------------------------------------------------------------*    CL**1
                                                                           CL**1
           COPY TRKM361.                                                   CL**1
                                                                           CL**8
       01  MR-OCCURS-LAYOUT          REDEFINES  TR361AO.                   CL**1
      ** CHG0094517  CHANGED FILLER FROM 135 TO 136                        CL**1
           05  FILLER                PIC X(136).                           CL**1
           05  MR-SCROLL-AREA OCCURS 15 TIMES.                             CL**1
               10  MR-TEXTL          PIC S9(04) COMP.                      CL**1
               10  MR-TEXTA          PIC  X(01).                           CL**1
               10  MR-TEXTC          PIC  X(01).                           CL**1
               10  MR-TEXTH          PIC  X(01).                           CL**1
               10  MR-TEXT           PIC  X(70).                           CL**1
                                                                           CL**1
       EJECT                                                               CL**1
      *---------------------------------------------------------------*    CL**1
      *    DB2 AREA FOR TPURCHS                                       *    CL**1
      *---------------------------------------------------------------*    CL**1
           EXEC SQL                                                        CL**1
                INCLUDE TPURCHS                                            CL**1
           END-EXEC.                                                       CL**1
      *---------------------------------------------------------------*    CL**1
      *    DB2 AREA FOR TENTNME                                       *    CL**1
      *---------------------------------------------------------------*    CL**1
           EXEC SQL                                                        CL**1
                INCLUDE TENTNME                                            CL**1
           END-EXEC.                                                       CL**1
      *---------------------------------------------------------------*    CL**1
      *    DB2 AREA FOR TMESSAGE                                      *    CL**1
      *---------------------------------------------------------------*    CL**1
           EXEC SQL                                                        CL**1
                INCLUDE TSYMSG                                             CL**1
           END-EXEC.                                                       CL**1
      *---------------------------------------------------------------*    CL**1
      *    DB2 AREA FOR MESSAGE TEXT AND CORRECTIVE ACTION            *    CL**1
      *---------------------------------------------------------------*    CL**1
           EXEC SQL                                                        CL**1
                INCLUDE TSYMSGT                                            CL**1
           END-EXEC.                                                       CL**1
      *---------------------------------------------------------------*    CL**1
      *    DB2 AREA FOR COMMUNICATIONS                                *    CL**1
      *---------------------------------------------------------------*    CL**1
           EXEC SQL                                                        CL**1
                INCLUDE SQLCA                                              CL**1
           END-EXEC.                                                       CL**1
                                                                           CL**1
       EJECT                                                               CL**1
       LINKAGE SECTION.                                                    CL**1
                                                                           CL**1
       01  DFHCOMMAREA.                                                    CL**1
           05  FILLER                         OCCURS  1 TO 4072 TIMES      CL**1
                                              DEPENDING ON EIBCALEN.       CL**1
               10  FILLER                     PIC X.                       CL**1
                                                                           CL**1
       EJECT                                                               CL**1
       PROCEDURE DIVISION.                                                 CL**1
                                                                           CL**1
       0000-MAIN-MODULE.                                                   CL**1
                                                                           CL**8
           INITIALIZE DP030-CICS-API-FIELDS.                               CL**1
           MOVE +1                      TO DP030-NUMBER-OF-MAPS.           CL**1
           MOVE PC-CURRENT-MAPSET-NAME  TO DP030-MAPSET-NAME.              CL**1
           MOVE PC-CURRENT-MAP-NAME     TO DP030-MAP-NAME (1).             CL**1
           SET DP030-RECEIVE-APPL-MAP   TO TRUE.                           CL**1
           MOVE LENGTH OF TR361AI       TO DP030-MAP-LENGTH (1).           CL**1
           MOVE 'PROGRAM ENTRY CALL'    TO DP013-MESSAGE-TEXT (1).         CL**1
           PERFORM 0001-CALL-CICS-ARCH-API.                                CL**1
                                                                           CL**8
           PERFORM 1000-CONTROL-PROCESSING.                                CL**1
                                                                           CL**8
           MOVE 'PROGRAM EXIT CALL'     TO DP013-MESSAGE-TEXT (1).         CL**1
           PERFORM 0001-CALL-CICS-ARCH-API.                                CL**1
                                                                           CL**1
      *----------------------------------------------------------------*   CL*63
      *   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *   CL*63
      *   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *   CL*63
      *----------------------------------------------------------------*   CL*63
                                                                           CL*63
       0001-CALL-CICS-ARCH-API.                                            CL**1
                                                                           CL**8
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                         CL**1
                                 DFHCOMMAREA                               CL**1
                                 DP030-CICS-API-FIELDS                     CL**1
                                 DP020-STANDARD-COMMAREA                   CL**1
                                 TR361AI.                                  CL**1
                                                                           CL**8
           IF  DP030-RC-CALL-SUCCESSFUL                                    CL**1
               CONTINUE                                                    CL**1
           ELSE                                                            CL**1
               SET DP013-NO-ROLLBACK TO TRUE                               CL**1
               SET DP013-XCTL-DISPLAY-RESTART TO TRUE                      CL**1
               SET DP013-CICS-ABEND TO TRUE                                CL**1
               MOVE 'BEFORE 0000-MAIN-MODULE' TO DP013-PARAGRAPH           CL**1
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O   CL**1
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)         CL**1
               MOVE DP030-RETURN-CODE                                      CL**1
                                     TO DP013-MESSAGE-TEXT (3)             CL**1
               PERFORM DP013-0000-PROCESS-ABEND                            CL**1
           END-IF.                                                         CL**1
                                                                           CL**8
      *----------------------------------------------------------------*   CL**1
      * PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *   CL**1
      * COURSE OF ACTION IS FOR THIS TRANSACTION.                      *   CL**1
      *                                                                *   CL**1
      * NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *   CL**1
      *  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *   CL**1
      *  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *   CL**1
      *  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       1000-CONTROL-PROCESSING.                                            CL**1
                                                                           CL**1
           EVALUATE TRUE                                                   CL**1
               WHEN DP020-NEXT-ACT-INITIAL                                 CL**1
      ***          MOVE EIBTRMID          TO ASC-DTL-TERM-ID               CL**2
      ***          MOVE DP020-SRC-TASK-NUMBER                              CL**1
      ***                                 TO ASC-DTL-TASK-NUMBER           CL**2
      ***          MOVE PC-DTL-QUEUE-SEQ  TO ASC-DTL-SEQ                   CL**2
                   PERFORM 1100-PROCESS-INTER-APPL-COMM                    CL**1
      ***-----$TEMPLATE NOTE$-------------------------------------------   CL**1
      *** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,   CL**1
      *** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO     CL**1
      *** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.   CL**1
      ***---------------------------------------------------------------   CL**1
                   IF  PS-COMMAREA-NOT-VALID                               CL**1
                       SET DP020-NEXT-ACT-APPL-ERROR                       CL**1
                                     TO  TRUE                              CL**1
                   ELSE                                                    CL**1
      ***              PERFORM 2050-DELETE-DETAIL-QUEUE                    CL*56
                       PERFORM 4000-BUILD-INITIAL-PANEL                    CL**1
                   END-IF                                                  CL**1
                                                                           CL**1
               WHEN DP020-NEXT-ACT-READ-MAP                                CL**1
      ***          MOVE ASC-ITEM-AT-TOP-OF-PANEL                           CL**1
      ***                            TO PV-TOP-ITEM                        CL**1
                   PERFORM 2000-PROCESS-PANEL                              CL**1
                                                                           CL**1
               WHEN DP020-NEXT-ACT-RETURN                                  CL**1
                   MOVE ASC-ITEM-AT-TOP-OF-PANEL                           CL**1
                                     TO PV-TOP-ITEM                        CL**1
                   MOVE ZERO         TO ASC-ITEM-AT-TOP-OF-PANEL           CL**1
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
                                                                           CL**1
               WHEN OTHER                                                  CL**1
                   SET DP013-LOGIC-ABEND TO TRUE                           CL**1
                   SET DP013-NO-ROLLBACK TO TRUE                           CL**1
                   MOVE '1000-CONTROL-PROCESSING'                          CL**1
                                     TO  DP013-PARAGRAPH                   CL**1
                   MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'       CL**1
                                     TO  DP013-MESSAGE-TEXT(1)             CL**1
                   PERFORM DP013-0000-PROCESS-ABEND                        CL**1
           END-EVALUATE.                                                   CL**1
                                                                           CL**1
       EJECT                                                               CL**1
      *----------------------------------------------------------------*   CL**1
      * DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA       *   CL**1
      *----------------------------------------------------------------*   CL**1
       1100-PROCESS-INTER-APPL-COMM.                                       CL**1
                                                                           CL**1
           SET PS-COMMAREA-VALID     TO TRUE.                              CL**1
           INITIALIZE ASC-SPECIFIC-COMMAREA.                               CL**1
                                                                           CL**1
           IF TR061-PO-NBR > 0                                                  
               MOVE TR061-PO-NBR TO ASC-KEY-PO-NBR                              
               PERFORM 1110-GET-DEPT-AND-VENDOR                                 
           ELSE                                                                 
      *** ASK ABOUT A MESSAGE NUMBER FOR THIS INCIDENT ** ? ? **                
               MOVE PC-TSYMSG-00050 TO DP020-MSG-NUMBER                         
               SET PS-COMMAREA-NOT-VALID                                        
                   DP020-MSG-FATAL       TO TRUE                                
           END-IF.                                                              
                                                                                
      *----------------------------------------------------------------*   CL*61
      *    GET DEPTARTMENT NUMBER AND VENDOR NAME TO DISPLAY ON SCREEN     CL*61
      *----------------------------------------------------------------*   CL*61
                                                                           CL*61
       1110-GET-DEPT-AND-VENDOR.                                                
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-RETRY-COUNTER                                         
               FROM 1 BY 1                                                      
               UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                       
                   OR (SQLCODE = +0)                                            
                   OR (SQLCODE = +100))                                         
                                                                                
              EXEC SQL                                                          
                SELECT A.DEPT_NBR                                               
                      ,B.ENT_NAME_DESC                                          
                  INTO :PURCHS-DEPT-NBR                                         
                      ,:ENTNME-ENT-NAME-DESC                                    
                  FROM TPURCHS A                                                
                      ,TENTNME B                                                
                 WHERE A.PO_NBR           = :ASC-KEY-PO-NBR                     
                   AND A.VER_STATUS_CDE   = 'A'                                 
                   AND A.ENT_ID           = B.ENT_ID                            
                   AND B.SEQ_NBR          = 1                                   
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +0                                            
                        MOVE PURCHS-DEPT-NBR TO PV-DEPT-NBR-N                   
                        MOVE PV-DEPT-NBR-N   TO ASC-KEY-DEPT                    
                        MOVE ENTNME-ENT-NAME-DESC                               
                                        TO ASC-KEY-VEND-NME                     
                                                                                
                   WHEN SQLCODE = +100                                          
                        MOVE ZEROS      TO ASC-KEY-DEPT                         
                        MOVE SPACES     TO ASC-KEY-VEND-NME                     
                                                                                
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -913                                          
                        CONTINUE                                                
                                                                                
                   WHEN SQLWARN0 NOT = SPACES                                   
                   WHEN SQLCODE < +0                                            
                   WHEN SQLCODE > +0                                            
                        MOVE '1110-GET-DEPT-AND-VENDOR'                         
                                        TO DP013-PARAGRAPH                      
                        MOVE 'UNSUCCESSFUL SELECT-DEPT AND VENDOR'              
                                        TO DP013-MESSAGE-TEXT (1)               
                        MOVE SQLCA      TO DP013-SQLCA                          
                        MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)             
                        MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (2)             
                        SET DP013-DB2-ABEND                                     
                            DP013-XCTL-DISPLAY-RESTART                          
                                        TO TRUE                                 
                        PERFORM DP013-0000-PROCESS-ABEND                        
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                                
               MOVE '1110-GET-DEPT-AND-VENDOR'                                  
                                        TO DP013-PARAGRAPH                      
               MOVE 'MAX RETRIES EXCEEDED ON SELECT DEPT & VENDOR'              
                                        TO DP013-MESSAGE-TEXT (1)               
               MOVE SQLCA               TO DP013-SQLCA                          
               MOVE 'TPURCHS '          TO DP013-DB2-TABLE-NAME (1)             
               MOVE 'TENTNME '          TO DP013-DB2-TABLE-NAME (2)             
               SET DP013-DB2-ABEND                                              
                   DP013-XCTL-DISPLAY-RESTART                                   
                                        TO TRUE                                 
               PERFORM DP013-0000-PROCESS-ABEND                                 
           END-IF.                                                              
                                                                                
                                                                                
      *----------------------------------------------------------------*   CL**1
      *    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED *   CL**1
      *    ON WHAT FUNCTION KEY WAS SELECTED.                          *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       2000-PROCESS-PANEL.                                                 CL**1
                                                                           CL**8
           EVALUATE TRUE                                                   CL**1
               WHEN DP020-SRC-AID = DP016-CLEAR                            CL**1
                   MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                   CL**1
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL**1
***********        PERFORM 3200-RESET-ATTRIBUTES                           CL*44
                                                                           CL**1
               WHEN DP020-FK-REFRESH (DP020-SRC-AID)                       CL**1
                   PERFORM 4000-BUILD-INITIAL-PANEL                        CL**1
***********        PERFORM 3200-RESET-ATTRIBUTES                           CL*44
                                                                           CL**1
               WHEN DP020-SRC-AID = DP016-ENTER                            CL*11
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                    CL*11
***********        PERFORM 3200-RESET-ATTRIBUTES                           CL*44
                                                                           CL*11
               WHEN OTHER                                                  CL*11
                   SET DP013-NO-ROLLBACK TO TRUE                           CL*11
                   SET DP013-XCTL-DISPLAY-RESTART TO TRUE                  CL*11
                   SET DP013-CICS-ABEND TO TRUE                            CL*11
                   MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH       CL*11
                   MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'         CL*11
                                         TO DP013-MESSAGE-TEXT (1)         CL*11
                   PERFORM DP013-0000-PROCESS-ABEND                        CL*11
                                                                           CL*11
           END-EVALUATE.                                                   CL*11
       EJECT                                                               CL**1
                                                                           CL**8
      *----------------------------------------------------------------*   CL**1
      *    RESET MESSAGE COLORS                                        *   CL**1
      *----------------------------------------------------------------*   CL**1
       3200-RESET-ATTRIBUTES.                                                   
           MOVE DP015-BLUE TO AMSG1C                                            
                              AMSG2C                                            
                              AMSG3C                                            
                              AMSG4C                                            
                              AMSG5C                                            
                              AMSG6C                                            
                              AMSG7C                                            
                              AMSG8C                                            
                              AMSG9C                                            
                              AMSG10C                                           
                              AMSG11C                                           
                              AMSG12C                                           
                              AMSG13C                                           
                              AMSG14C                                           
                              AMSG15C                                           
                              AMSG16C                                           
                              AMSG17C                                           
                              AMSG18C                                           
                              AMSG19C                                           
                              AMSG20C                                           
                              AMSG21C                                           
                              AMSG22C                                           
                              AMSG23C                                           
                              AMSG24C                                           
                              AMSG25C                                           
                              AMSG26C                                           
                              AMSG27C                                           
                              AMSG28C                                           
                              AMSG29C                                           
                              AMSG30C.                                          
      *----------------------------------------------------------------*   CL**1
      *    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *   CL**1
      *    INITIALIZE ALL COUNTERS AND FLAGS.                          *   CL**1
      *    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *   CL**1
      *    DISPLAY THE PANEL TO USER.                                  *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
       4000-BUILD-INITIAL-PANEL.                                           CL**1
                                                                           CL**1
           INITIALIZE                  ASC-BLOCK-ENTRIES(1).               CL**1
           MOVE +1                 TO  ASC-BLK-SUB.                        CL**1
           SET ASC-ITEMS-LEFT-ON-DB                                        CL**1
                                   TO  TRUE.                               CL**1
                                                                           CL**1
           MOVE +0                 TO  ASC-ITEM-SUB                        CL**1
                                       ASC-NUMBER-OF-ITEMS-READ            CL**1
                                       ASC-NUMBER-OF-SELECTED-ITEMS        CL**1
                                       ASC-HIGHEST-BLOCK-WRITTEN           CL**1
                                       ASC-START-OF-SELECTED-RANGE         CL**1
                                       ASC-END-OF-SELECTED-RANGE           CL**1
                                       ASC-ITEM-AT-TOP-OF-PANEL.           CL**1
                                                                           CL**1
           MOVE SPACE              TO  ASC-DESC-LINE-IND                   CL*52
                                       ASC-CORR-LINE-IND.                  CL*52
                                                                           CL*52
           MOVE +1                 TO  PV-TOP-ITEM.                        CL**1
                                                                                
           IF  TR061-NBR-EDIT-ERRORS < 1                                   CL**1
               SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                       CL**1
               SET DP020-MSG-FATAL   TO  TRUE                              CL**1
               MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER                  CL**1
           ELSE                                                            CL**1
               INITIALIZE ASC-MSG-AREA                                          
               PERFORM                                                          
                 VARYING WS-SUB FROM 1 BY 1                                     
                   UNTIL WS-SUB > TR061-NBR-EDIT-ERRORS                         
                       SEARCH WS-MSG-TABLE VARYING MSG-INDX                     
                          AT END                                                
                              MOVE TR061-ERROR-CDE(WS-SUB)                      
                                       TO PC-UNKNOWN-MSG-CODE                   
                              MOVE PC-UNKNOWN-MSG                               
                                       TO ASC-MSG-TXT(WS-SUB)                   
                                                                                
                          WHEN TR061-ERROR-CDE(WS-SUB)                          
                                             = WS-MSG-CDE(MSG-INDX)             
                              MOVE WS-MSG-TXT(MSG-INDX)                         
                                       TO ASC-MSG-TXT(WS-SUB)                   
                                                                                
                       END-SEARCH                                               
                     SET MSG-INDX TO 1                                          
               END-PERFORM                                                      
313200         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                             
           END-IF.                                                              
                                                                                
       EJECT                                                               CL**1
      *----------------------------------------------------------------*   CL**1
      * PROCESS THE MESSAGE CODES PASSED FROM POKCS061                 *   CL*12
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
      *----------------------------------------------------------------*   CL**1
      *    FORMAT THE MAP AND DETERMINE THE CURSOR POSITION.           *   CL**1
      *----------------------------------------------------------------*   CL**1
      *                                                                    CL**1
       4400-MOVE-COMMAREA-TO-SCREEN.                                       CL**1
      *                                                                    CL**8
           MOVE ASC-KEY-PO-NBR TO APONUMO.                                      
           MOVE ASC-KEY-DEPT TO ADEPTO.                                         
           MOVE ASC-KEY-VEND-NME TO AVENDNMO.                                   
           PERFORM 3200-RESET-ATTRIBUTES.                                       
           PERFORM VARYING WS-SUB                                               
            FROM 1 BY 1                                                         
             UNTIL WS-SUB > 30                                                  
               EVALUATE TRUE                                                    
                   WHEN WS-SUB = 1                                              
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG1O                         
00792******MOVE DP015-GREEN              TO ASTRTITC.                      CL**1
                     IF AMSG1O(1:7) = PC-UNKNOWN-MSG-TEXT1                      
                         MOVE DP015-RED TO AMSG1C                               
                     END-IF                                                     
                   WHEN WS-SUB = 2                                              
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG2O                         
                     IF AMSG2O(1:7) = PC-UNKNOWN-MSG-TEXT1                      
                         MOVE DP015-RED TO AMSG2C                               
                     END-IF                                                     
                   WHEN WS-SUB = 3                                              
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG3O                         
                     IF AMSG3O(1:7) = PC-UNKNOWN-MSG-TEXT1                      
                         MOVE DP015-RED TO AMSG3C                               
                     END-IF                                                     
                   WHEN WS-SUB = 4                                              
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG4O                         
                     IF AMSG4O(1:7) = PC-UNKNOWN-MSG-TEXT1                      
                         MOVE DP015-RED TO AMSG4C                               
                     END-IF                                                     
                   WHEN WS-SUB = 5                                              
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG5O                         
                     IF AMSG5O(1:7) = PC-UNKNOWN-MSG-TEXT1                      
                         MOVE DP015-RED TO AMSG5C                               
                     END-IF                                                     
                   WHEN WS-SUB = 6                                              
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG6O                         
                     IF AMSG6O(1:7) = PC-UNKNOWN-MSG-TEXT1                      
                         MOVE DP015-RED TO AMSG6C                               
                     END-IF                                                     
                   WHEN WS-SUB = 7                                              
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG7O                         
                     IF AMSG7O(1:7) = PC-UNKNOWN-MSG-TEXT1                      
                         MOVE DP015-RED TO AMSG7C                               
                     END-IF                                                     
                   WHEN WS-SUB = 8                                              
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG8O                         
                     IF AMSG8O(1:7) = PC-UNKNOWN-MSG-TEXT1                      
                         MOVE DP015-RED TO AMSG8C                               
                     END-IF                                                     
                   WHEN WS-SUB = 9                                              
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG9O                         
                     IF AMSG9O(1:7) = PC-UNKNOWN-MSG-TEXT1                      
                         MOVE DP015-RED TO AMSG9C                               
                     END-IF                                                     
                   WHEN WS-SUB = 10                                             
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG10O                        
                     IF AMSG10O(1:7) = PC-UNKNOWN-MSG-TEXT1                     
                         MOVE DP015-RED TO AMSG10C                              
                     END-IF                                                     
                   WHEN WS-SUB = 11                                             
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG11O                        
                     IF AMSG11O(1:7) = PC-UNKNOWN-MSG-TEXT1                     
                         MOVE DP015-RED TO AMSG11C                              
                     END-IF                                                     
                   WHEN WS-SUB = 12                                             
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG12O                        
                     IF AMSG12O(1:7) = PC-UNKNOWN-MSG-TEXT1                     
                         MOVE DP015-RED TO AMSG12C                              
                     END-IF                                                     
                   WHEN WS-SUB = 13                                             
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG13O                        
                     IF AMSG13O(1:7) = PC-UNKNOWN-MSG-TEXT1                     
                         MOVE DP015-RED TO AMSG13C                              
                     END-IF                                                     
                   WHEN WS-SUB = 14                                             
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG14O                        
                     IF AMSG14O(1:7) = PC-UNKNOWN-MSG-TEXT1                     
                         MOVE DP015-RED TO AMSG14C                              
                     END-IF                                                     
                   WHEN WS-SUB = 15                                             
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG15O                        
                     IF AMSG15O(1:7) = PC-UNKNOWN-MSG-TEXT1                     
                         MOVE DP015-RED TO AMSG15C                              
                     END-IF                                                     
                   WHEN WS-SUB = 16                                             
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG16O                        
                     IF AMSG16O(1:7) = PC-UNKNOWN-MSG-TEXT1                     
                         MOVE DP015-RED TO AMSG16C                              
                     END-IF                                                     
                   WHEN WS-SUB = 17                                             
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG17O                        
                     IF AMSG17O(1:7) = PC-UNKNOWN-MSG-TEXT1                     
                         MOVE DP015-RED TO AMSG17C                              
                     END-IF                                                     
                   WHEN WS-SUB = 18                                             
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG18O                        
                     IF AMSG18O(1:7) = PC-UNKNOWN-MSG-TEXT1                     
                         MOVE DP015-RED TO AMSG18C                              
                     END-IF                                                     
                   WHEN WS-SUB = 19                                             
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG19O                        
                     IF AMSG19O(1:7) = PC-UNKNOWN-MSG-TEXT1                     
                         MOVE DP015-RED TO AMSG19C                              
                     END-IF                                                     
                   WHEN WS-SUB = 20                                             
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG20O                        
                     IF AMSG20O(1:7) = PC-UNKNOWN-MSG-TEXT1                     
                         MOVE DP015-RED TO AMSG20C                              
                     END-IF                                                     
                   WHEN WS-SUB = 21                                             
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG21O                        
                     IF AMSG21O(1:7) = PC-UNKNOWN-MSG-TEXT1                     
                         MOVE DP015-RED TO AMSG21C                              
                     END-IF                                                     
                   WHEN WS-SUB = 22                                             
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG22O                        
                     IF AMSG22O(1:7) = PC-UNKNOWN-MSG-TEXT1                     
                         MOVE DP015-RED TO AMSG22C                              
                     END-IF                                                     
                   WHEN WS-SUB = 23                                             
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG23O                        
                     IF AMSG23O(1:7) = PC-UNKNOWN-MSG-TEXT1                     
                         MOVE DP015-RED TO AMSG23C                              
                     END-IF                                                     
                   WHEN WS-SUB = 24                                             
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG24O                        
                     IF AMSG24O(1:7) = PC-UNKNOWN-MSG-TEXT1                     
                         MOVE DP015-RED TO AMSG24C                              
                     END-IF                                                     
                   WHEN WS-SUB = 25                                             
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG25O                        
                     IF AMSG25O(1:7) = PC-UNKNOWN-MSG-TEXT1                     
                         MOVE DP015-RED TO AMSG25C                              
                     END-IF                                                     
                   WHEN WS-SUB = 26                                             
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG26O                        
                     IF AMSG26O(1:7) = PC-UNKNOWN-MSG-TEXT1                     
                         MOVE DP015-RED TO AMSG26C                              
                     END-IF                                                     
                   WHEN WS-SUB = 27                                             
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG27O                        
                     IF AMSG27O(1:7) = PC-UNKNOWN-MSG-TEXT1                     
                         MOVE DP015-RED TO AMSG27C                              
                     END-IF                                                     
                   WHEN WS-SUB = 28                                             
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG28O                        
                     IF AMSG28O(1:7) = PC-UNKNOWN-MSG-TEXT1                     
                         MOVE DP015-RED TO AMSG28C                              
                     END-IF                                                     
                   WHEN WS-SUB = 29                                             
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG29O                        
                     IF AMSG29O(1:7) = PC-UNKNOWN-MSG-TEXT1                     
                         MOVE DP015-RED TO AMSG29C                              
                     END-IF                                                     
                   WHEN WS-SUB = 30                                             
                     MOVE ASC-MSG-TXT(WS-SUB) TO AMSG30O                        
                     IF AMSG30O(1:7) = PC-UNKNOWN-MSG-TEXT1                     
                         MOVE DP015-RED TO AMSG30C                              
                     END-IF                                                     
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
      *    PERFORM 4420-FORMAT-LIST-LINES                                  CL**1
      *        VARYING PS-SUB                                              CL**1
      *        FROM PC-ITEMS-PER-PANEL BY -1                               CL**1
      *        UNTIL PS-SUB < +1.                                          CL**1
      *                                                                    CL**8
      *----------------------------------------------------------------*   CL**1
      *    ABEND PROCESSOR MODULE                                      *   CL**1
      *----------------------------------------------------------------*   CL**1
                                                                           CL**1
           COPY DPPD013.                                                   CL**1
