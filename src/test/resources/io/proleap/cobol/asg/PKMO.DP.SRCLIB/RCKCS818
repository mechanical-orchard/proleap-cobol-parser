000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    RCKCS818.                                         00040000
000500 AUTHOR.        LARRY SCHLEICHER                                  00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  04-16-2003.                                       00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    E818 - STORE VERIFY ADJUST BY PACK                         * 00110000
001200*                                                               * 00120000
001300*    THIS PROGRAM GENERATES A LIST OF ALL THE PACKS THAT ARE    * 00130000
001400*    ASSOCIATED TO A STORE.  BY SELECTING ANY OF THESE          * 00140000
001500*    PACKS, THEY CAN BE 'UPDATED'.                              * 00150000
001600*                                                               * 00160000
001700*---------------------------------------------------------------* 00170000
001710* CHANGED 11/11/2021    BY JIM HUNTER      WR: CHG0263784         00171007
001720* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00172008
001730* MAKING THE CALL DYNAMIC VS STATIC.                              00173008
001740*---------------------------------------------------------------* 00174008
001800 EJECT                                                            00180000
001900 ENVIRONMENT DIVISION.                                            00190000
002000                                                                  00200000
002100 DATA DIVISION.                                                   00210000
002200                                                                  00220000
002300 WORKING-STORAGE SECTION.                                         00230000
002400                                                                  00240000
002500 01  DK-DB2-KEYS.                                                 00250000
002600     05  DK-OPER-UNT-ID                  PIC S9(04)  COMP SYNC.   00260000
002700     05  DK-FCLTY-ID                     PIC S9(04)  COMP SYNC.   00270000
002800     05  DK-PO-NBR                       PIC S9(09)  COMP SYNC.   00280000
002900     05  DK-REC-SEQ-NBR                  PIC S9(09)  COMP SYNC.   00290000
003000     05  DK-PO-DRIVER-LNE                PIC S9(09)  COMP SYNC.   00300000
003100     05  DK-LNE-NBR                      PIC S9(09)  COMP SYNC.   00310000
003200     05  DK-HOLD-LNE-NBR                 PIC S9(09)  COMP SYNC.   00320000
003300     05  DK-DRIVER-LNE-NBR               PIC S9(09)  COMP SYNC.   00330000
003400     05  DK-PREPK-ID                     PIC S9(04)  COMP SYNC.   00340000
003500     05  DK-PKSL-LNE-NBR              PIC S9(9) COMP VALUE +0.    00350000
003600     05  DK-UPDATE-PACK-ID               PIC S9(04)  COMP SYNC.   00360000
003700     05  DK-STR-NBR                      PIC S9(04)  COMP SYNC.   00370000
003800     05  DK-STR-NBR-N                 PIC 9(4).                   00380000
004200     05  DK-STORE                     PIC S9(4) COMP VALUE +0.    00420000
004300                                                                  00430000
004400 01  PC-PROGRAM-CONSTANTS.                                        00440000
004500     05  PC-TMKCS520               PIC  X(08)  VALUE  'TMKCS520'. 00450000
004600     05  PC-LOCATION-MODULE        PIC  X(08)  VALUE  'XLKUT071'. 00460000
004700     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'RC818A  '. 00470000
004800     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'RCKM818 '. 00480000
004900     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'RCKCS818'. 00490000
005000     05  PC-POST-VERIFY-PGM-NAME   PIC  X(08)  VALUE  'RCKPV818'. 00500000
005100     05  PC-PCKCS756               PIC  X(08)  VALUE  'PCKCS756'. 00510000
005200     05  PC-CALENDAR-ROUTINE       PIC  X(08)  VALUE  'DPKUT500'. 00520000
005300     05  PC-AUDIT-RTN              PIC  X(08)  VALUE  'RCKCS290'. 00530000
005400     05  PC-AUDIT-RTN-LENGTH       PIC S9(04)  VALUE  +300        00540000
005500                                                      COMP SYNC.  00550000
005600                                                                  00560000
005700     05  PC-01-COMP                     PIC S9(4) COMP VALUE 1.   00570000
005800     05  PC-VRFY-ADJ-QUEUE-SEQ          PIC  9      VALUE 6.      00580000
005900     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00590000
006000     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00600000
006100     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00610000
006200     05  PC-INTER-APPL-LIST             PIC  X(01)  VALUE '2'.    00620000
006300     05  PC-POST-VERFY-INTER-LIST-FMT   PIC  X(01)  VALUE '3'.    00630000
006400     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +8      00640000
006500                                                    COMP SYNC.    00650000
006600     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00660000
006700                                                    COMP SYNC.    00670000
006800     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00680000
006900                                                    +1000000      00690000
007000                                                    COMP-3.       00700000
007100     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00710000
007200                                                    COMP SYNC.    00720000
007300     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00730000
007400                                                    COMP-3.       00740000
007500     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00750000
007600     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00760000
007700     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00770000
007800     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00780000
007900     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00790000
008000     05  PC-DB2-DEFAULT-TMST            PIC  X(26)  VALUE         00800000
008100         '9999-09-09-09.09.09.999999'.                            00810000
008200     05  PC-TRBL-ALREADY-EXISTS-MSG     PIC  X(56)  VALUE         00820000
008300       'NNNNN-I-REQUESTED TRBL ALREADY EXISTS FOR PO OR PO LINE'. 00830000
008400                                                                  00840000
008500     05  PC-AUTOVE-MODULE           PIC  X(08) VALUE 'RCKUT127'.  00850000
008600     05  PC-AUTOVE-MODULE-LENGTH    PIC S9(04) VALUE  +400        00860000
008700                                                    COMP SYNC.    00870000
008800*                                                                 00880000
008900     05  PC-TSYMSG-NUMBERS.                                       00890000
009000         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00900000
009100         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00910000
009200         10  PC-TSYMSG-00045            PIC  9(05)  VALUE 00045.  00920000
009300         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00930000
009400         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00940000
009500         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00950000
009600         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00960000
009700         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00970000
009800         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00980000
009900         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00990000
010000         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.  01000000
010100         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01010000
010200         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01020000
010300         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01030000
010400         10  PC-TSYMSG-00146            PIC  9(05)  VALUE 00146.  01040000
010500         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  01050000
010600         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01060000
010700         10  PC-TSYMSG-00984            PIC  9(05)  VALUE 00984.  01070000
010800         10  PC-TSYMSG-01817            PIC  9(05)  VALUE 01817.  01080000
010900* 01817 - F2 TO CONFIRM THE UPDATE OF A STORE WITH A SOURCE OTHER 01090000
011000         10  PC-TSYMSG-01962            PIC  9(05)  VALUE 01962.  01100000
011100         10  PC-TSYMSG-03082            PIC  9(05)  VALUE 03082.  01110000
011200         10  PC-TSYMSG-03138            PIC  9(05)  VALUE 03138.  01120000
011300         10  PC-TSYMSG-03180            PIC  9(05)  VALUE 03180.  01130000
011400         10  PC-TSYMSG-03233            PIC  9(05)  VALUE 03233.  01140000
011500         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  01150000
011600*                                                                 01160000
011700 01  PS-PROGRAM-SWITCHES.                                         01170000
011800     05  PS-CHECK-FOR-RMS-PO-SW       PIC X(01) VALUE 'N'.        01180000
011900         88  PS-CHECKED-FOR-RMS-PO              VALUE 'Y'.        01190000
012000     05  PS-RMS-PO-SW                 PIC X(01) VALUE 'N'.        01200000
012100         88  PS-RMS-PO                          VALUE 'Y'.        01210000
012200         88  PS-NO-RMS-PO                       VALUE 'N'.        01220000
012300     05  PS-TABLE-LOADED-SW           PIC X.                      01230000
012400         88  PS-TABLE-LOADED                    VALUE 'Y'.        01240000
012500         88  PS-TABLE-NOT-LOADED                VALUE 'N'.        01250000
012600     05  PS-EOT-TRB-SW                PIC X.                      01260000
012700         88  PS-EOT-TRB-TABLE                   VALUE 'Y'.        01270000
012800         88  PS-NOT-EOT-TRB-TABLE               VALUE 'N'.        01280000
012900     05  PS-ALL-LINES-PROTECTED-SW    PIC X(01) VALUE 'N'.        01290000
013000         88  PS-ALL-LINES-PROTECTED             VALUE 'Y'.        01300000
013100         88  PS-ALL-LINES-NOT-PROTECTED         VALUE 'N'.        01310000
013200     05  PS-WRITE-LIST-QUEUE-SW       PIC  X    VALUE 'N'.        01320000
013300         88  PS-DONT-WRITE-LIST-QUEUE           VALUE 'N'.        01330000
013400         88  PS-WRITE-LIST-QUEUE                VALUE 'Y'.        01340000
013500     05  PS-UNITS-WORKED-ERROR-SW     PIC X(01) VALUE 'N'.        01350000
013600         88  PS-UNITS-WORKED-ERROR              VALUE 'Y'.        01360000
013700         88  PS-NO-UNITS-WORKED-ERROR           VALUE 'N'.        01370000
013800     05  PS-TRECDIS-UPDATE-SW         PIC X(01) VALUE 'N'.        01380000
013900         88  PS-TRECDIS-UPDATE-DONE             VALUE 'Y'.        01390000
014000         88  PS-TRECDIS-UPDATE-NOT-DONE         VALUE 'N'.        01400000
014100     05  PS-EOC-PAC-CSR-SW              PIC  X(01)  VALUE 'N'.    01410000
014200         88  PS-EOC-PAC-CSR                         VALUE 'Y'.    01420000
014300         88  PS-NOT-EOC-PAC-CSR                     VALUE 'N'.    01430000
014400     05  PS-DRIVER-LINE-SW              PIC  X(01)  VALUE 'Y'.    01440000
014500         88  PS-NOT-DRIVER-LINE                     VALUE 'N'.    01450000
014600         88  PS-DRIVER-LINE                         VALUE 'Y'.    01460000
014700     05  PS-AMOUNT-ENTERED-SW           PIC  X(01)  VALUE 'N'.    01470000
014800         88  PS-AMOUNT-ENTERED                      VALUE 'Y'.    01480000
014900         88  PS-NO-AMOUNT-ENTERED                   VALUE 'N'.    01490000
015000     05  PS-UPDATE-SW                   PIC  X(01)  VALUE 'N'.    01500000
015100         88  PS-NO-UPDATES-DONE                     VALUE 'N'.    01510000
015200         88  PS-UPDATES-DONE                        VALUE 'Y'.    01520000
015300     05  PS-NO-TDISTHD-FOUND-SW         PIC  X(01)  VALUE 'Y'.    01530000
015400         88  PS-TDISTHD-FOUND                       VALUE 'Y'.    01540000
015500         88  PS-NO-TDISTHD-FOUND                    VALUE 'N'.    01550000
015600     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01560000
015700         88  PS-NO-ERROR                            VALUE 'Y'.    01570000
015800         88  PS-ERROR                               VALUE 'N'.    01580000
015900     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01590000
016000         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01600000
016100         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01610000
016200     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01620000
016300         88  PS-DONE                                VALUE 'Y'.    01630000
016400         88  PS-NOT-DONE                            VALUE 'N'.    01640000
016500     05  PS-UPDATE-MODE-SW              PIC  X(01)  VALUE 'N'.    01650000
016600         88  PS-UPDATE-MODE                         VALUE 'Y'.    01660000
016700         88  PS-NOT-UPDATE-MODE                     VALUE 'N'.    01670000
016800     05  PS-RECS-UPDATED-SW             PIC  X(01)  VALUE 'N'.    01680000
016900         88  PS-RECS-UPDATED                        VALUE 'Y'.    01690000
017000         88  PS-NO-RECS-UPDATED                     VALUE 'N'.    01700000
017100     05  PS-UPDATE-QUEUE-SW             PIC  X(01)  VALUE 'N'.    01710000
017200         88  PS-UPDATE-QUEUE                        VALUE 'Y'.    01720000
017300         88  PS-DONT-UPDATE-QUEUE                   VALUE 'N'.    01730000
017310     05  PS-DC-FLUSH-SW                 PIC  X(01)  VALUE  'Y'.   01731000
017320         88  PS-DC-FLUSH-YES                        VALUE  'Y'.   01732000
017330         88  PS-DC-FLUSH-NO                         VALUE  'N'.   01733000
017340     05  PS-RACF-OVERRIDE-SW            PIC  X(01)  VALUE  'N'.   01734003
017350         88  PS-RACF-OVERRIDE-YES                   VALUE  'Y'.   01735003
017360         88  PS-RACF-OVERRIDE-NO                    VALUE  'N'.   01736003
017370     05  PS-CURR-OPER-EFC-SW            PIC  X(01)  VALUE  'N'.   01737003
017380         88  PS-CURR-OPER-EFC-YES                   VALUE  'Y'.   01738003
017390         88  PS-CURR-OPER-EFC-NO                    VALUE  'N'.   01739003
017391     05  PS-HAS-WORK-ORDER-INST-SW PIC       X(01)  VALUE  'N'.   01739103
017392         88  PS-HAS-WORK-ORDER-INST                 VALUE  'Y'.   01739203
017393         88  PS-HAS-WORK-ORDER-INST-NO              VALUE  'N'.   01739303
017394     05  PS-TOSOPFA-CURSOR-SW           PIC  X(01)  VALUE  'N'.   01739403
017395         88  PS-EOF-TOSOPFA-CSR                     VALUE  'Y'.   01739503
017396     05  PS-INSTRUCTION-SW              PIC  X(01)  VALUE  'N'.   01739603
017397         88  PS-FIRST-INSTRUCTION                   VALUE  'Y'.   01739703
017400*                                                                 01740000
017500 01  PV-PROGRAM-VARIABLES.                                        01750000
017600     05  PV-PURCHS-STATUS-CDE         PIC X(02).                  01760000
017700     05  PV-PURITM-STATUS-CDE         PIC X(02).                  01770000
017800     05  PV-PURITM-UNT-QTY            PIC S9(9)  COMP.            01780000
017900     05  PV-DEPT-NBR-X.                                           01790000
018000         10  PV-DEPT-NBR              PIC  9(4).                  01800000
018100     05  PV-DEPT-NBR-KEY              PIC S9(4) VALUE +0          01810000
018200                                                COMP-3.           01820000
018300     05  PV-DB2-COUNT                 PIC S9(9) VALUE ZERO        01830000
018400                                                COMP-3.           01840000
018500     05  PV-RECDIS-AP-VERIFY-ITM-QTY  PIC S9(9) COMP SYNC.        01850000
018600     05  PV-REC-TYPE                  PIC  X(01).                 01860000
018700     05  PV-SAVE-DRIVER-LINE          PIC S9(09)  COMP SYNC.      01870000
018800     05  PV-NOTIF-NBR                 PIC S9(9) VALUE ZERO        01880000
018900                                                COMP SYNC.        01890000
019000     05  PV-CYC-ADJ-NBR               PIC S9(9) VALUE ZERO        01900000
019100                                                COMP SYNC.        01910000
019200     05  PV-NOTIF-BEF                 PIC S9(9) VALUE ZERO        01920000
019300                                                COMP SYNC.        01930000
019400     05  PV-CYC-ADJ-BEF               PIC S9(9) VALUE ZERO        01940000
019500                                                COMP SYNC.        01950000
019600     05  PV-CICS-MSG-AREA             PIC  X(100) VALUE SPACE.    01960000
019700     05  PV-CICS-MSG-AREA2            PIC  X(100) VALUE SPACE.    01970000
019800     05  PV-COMMAREA-LENGTH           PIC S9(04)  VALUE +0        01980000
019900                                                COMP SYNC.        01990000
020000     05  PV-SAVE-ITM-QTY                PIC S9(9) VALUE ZERO      02000000
020100                                                COMP.             02010000
020200     05  PV-SUM-ITM-QTY                 PIC S9(9) VALUE ZERO      02020000
020300                                                COMP.             02030000
020400     05  PV-VRFY-ITEM                 PIC S9(4) VALUE ZERO        02040000
020500                                                COMP SYNC.        02050000
020600     05  PV-NOT-SELECTED              PIC S9(09) VALUE +0.        02060000
020700     05  PV-DISPLAY-STORE               PIC  9(4).                02070000
020710     05  PV-DISPLAY-NO-ZERO             PIC  Z(5).                02071000
020800     05  PV-DISPLAY-ZERO                PIC  Z(4)9.               02080000
020900     05  PV-UPDATE-PACK-AMT             PIC  S9(05).              02090000
021000     05  PV-UPDATE-PACK                 PIC  S9(09) VALUE ZERO    02100000
021100                                                    COMP.         02110000
021200     05  PV-ORIG-PACK-ACT               PIC  S9(09) VALUE ZERO    02120000
021300                                                    COMP.         02130000
021400     05  PV-ORIG-PACK-VRF               PIC  S9(09) VALUE ZERO    02140000
021500                                                    COMP.         02150000
021600     05  PV-UPDATE-PACK-DIF             PIC  S9(09) VALUE ZERO    02160000
021700                                                    COMP.         02170000
021800     05  PV-SAVE-PACK-DIF               PIC  S9(09) VALUE ZERO    02180000
021900                                                    COMP.         02190000
022000     05  PV-UPDATE-PACK-TOTAL           PIC  S9(09) VALUE ZERO    02200000
022100                                                    COMP.         02210000
022200     05  PV-TOTAL-UPDATE-PACK-DIF       PIC  S9(09) VALUE ZERO    02220000
022300                                                    COMP.         02230000
022400     05  PV-LINE-QTY                    PIC  9(09).               02240000
022500     05  PV-NULL-IND                    PIC S9(04)  VALUE +0      02250000
022600                                                    COMP SYNC.    02260000
022700     05  PV-RECDVS-COUNT                PIC S9(09)  VALUE ZERO    02270000
022800                                                    COMP-3.       02280000
022900     05  PV-CASE-PKSLP                  PIC S9(09)  VALUE ZERO    02290000
023000                                                    COMP-3.       02300000
023100     05  PV-LNE-AP-VERIFY-ITM-QTY       PIC S9(09)  VALUE +0      02310000
023200                                                    COMP SYNC.    02320000
023300     05  PV-LNE-VERIFY-ITM-QTY          PIC S9(09)  VALUE +0      02330000
023400                                                    COMP SYNC.    02340000
023500     05  PV-LNE-EXPTED-ITM-QTY          PIC S9(09)  VALUE +0      02350000
023600                                                    COMP SYNC.    02360000
023700     05  PV-ODD-DC-VERIFY-ODU-PK-QTY    PIC S9(09)  VALUE +0      02370000
023800                                                    COMP SYNC.    02380000
023900     05  PV-ODD-AP-VERIFY-ODU-PK-QTY    PIC S9(09)  VALUE +0      02390000
024000                                                    COMP SYNC.    02400000
024100     05  PV-ODD-DC-VERIFY-ODU-QTY       PIC S9(09)  VALUE +0      02410000
024200                                                    COMP SYNC.    02420000
024300     05  PV-ODD-AP-VERIFY-ODU-QTY       PIC S9(09)  VALUE +0      02430000
024400                                                    COMP SYNC.    02440000
024500     05  PV-TOT-DC-VERIFY-ODU-QTY       PIC S9(09)  VALUE +0      02450000
024600                                                    COMP SYNC.    02460000
024700     05  PV-TOT-AP-VERIFY-ODU-QTY       PIC S9(09)  VALUE +0      02470000
024800                                                    COMP SYNC.    02480000
024900     05  PV-PKSLIP-PACKS                PIC  9(06).               02490000
025000     05  PV-ACTUAL-PACKS                PIC  9(06).               02500000
025100     05  PV-VERFYD-PACKS                PIC  9(06).               02510000
025200     05  PV-ODD-UNITS                   PIC  9(06).               02520000
025300     05  PV-DRIVER-RATIO                PIC  9(06).               02530000
025400     05  PV-DISP-PO-NBR                 PIC  9(09).               02540000
025500     05  PV-DISP-OPER-UNT-ID            PIC  9(04).               02550000
025600     05  PV-DISP-FCLTY-ID               PIC  9(04).               02560000
025700     05  PV-DISP-REC-SEQ-NBR            PIC  9(09).               02570000
025800     05  PV-DISP-PREPK-ID               PIC  9(04).               02580000
025900     05  PV-DISP-LNE-NBR                PIC  9(09).               02590000
026000     05  PV-DISP-STR-NBR                PIC  9(04).               02600000
026100     05  PV-DISP-SQL-CODE               PIC +9(04).               02610000
026200     05  PV-DISP-CICS-RESP              PIC +9(04).               02620000
026212     05  PV-DISP-WO-SEQ-NBR             PIC  9(04).               02621211
026220     05  PV-DISP-WO-INSTR-SEQ-NBR       PIC  9(04).               02622003
026240     05  PV-DISP-SQLCODE                PIC -9(05) VALUE ZEROES.  02624003
026250     05  PV-DISP-OPER-SET               PIC  9(04).               02625003
026260*                                                                 02626003
026300     05  PV-SUB                         PIC S9(04)  VALUE +0      02630000
026400                                                    COMP SYNC.    02640000
026500     05  PV-UPDATE-SUB                  PIC S9(04)  VALUE +0      02650000
026600                                                    COMP SYNC.    02660000
026700     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      02670000
026800                                                    COMP SYNC.    02680000
026900     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      02690000
027000                                                    COMP-3.       02700000
027100     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      02710000
027200                                                    COMP-3.       02720000
027300     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      02730000
027400                                                    COMP-3.       02740000
027500     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      02750000
027600                                                    COMP-3.       02760000
027700     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      02770000
027800                                                    COMP-3.       02780000
027900     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      02790000
028000                                                    COMP-3.       02800000
028100     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      02810000
028200                                                    COMP-3.       02820000
028300     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      02830000
028400                                                    COMP SYNC.    02840000
028500     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      02850000
028600                                                    COMP SYNC.    02860000
028700     05  PV-ITEM                        PIC S9(04)  VALUE +0      02870000
028800                                                    COMP SYNC.    02880000
028900     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      02890000
029000                                                    COMP SYNC.    02900000
029100     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      02910000
029200                                                    COMP SYNC.    02920000
029300     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      02930000
029400                                                    COMP SYNC.    02940000
029500     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      02950000
029600                                                    COMP SYNC.    02960000
029700     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      02970000
029800                                                    COMP SYNC.    02980000
029900     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02990000
030000                                                    COMP SYNC.    03000000
030100     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      03010000
030200                                                    COMP SYNC.    03020000
030300     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      03030000
030400                                                    COMP SYNC.    03040000
030500     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      03050000
030600                                                    COMP SYNC.    03060000
030700     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      03070000
030800                                                    COMP SYNC.    03080000
030900     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      03090000
031000                                                    COMP SYNC.    03100000
031100     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      03110000
031200                                                    COMP SYNC.    03120000
031300     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      03130000
031400                                                    COMP SYNC.    03140000
031500     05  PV-WORK-TIMESTAMP.                                       03150000
031600         10  PV-WORK-YEAR               PIC X(04).                03160000
031700         10  FILLER                     PIC X(01).                03170000
031800         10  PV-WORK-MONTH              PIC X(02).                03180000
031900         10  FILLER                     PIC X(01).                03190000
032000         10  PV-WORK-DAY                PIC X(02).                03200000
032100         10  FILLER                     PIC X(01).                03210000
032200         10  PV-WORK-HH                 PIC X(02).                03220000
032300         10  FILLER                     PIC X(01).                03230000
032400         10  PV-WORK-MIN                PIC X(02).                03240000
032500         10  FILLER                     PIC X(10).                03250000
032600     05  PV-DISPLAY-DATE.                                         03260000
032700         10  PV-DISPLAY-MONTH           PIC X(02).                03270000
032800         10  PV-SLASH-1                 PIC X(01).                03280000
032900         10  PV-DISPLAY-DAY             PIC X(02).                03290000
033000         10  PV-SLASH-2                 PIC X(01).                03300000
033100         10  PV-DISPLAY-YEAR            PIC X(04).                03310000
033200     05  PV-DISPLAY-TIME.                                         03320000
033300         10  PV-DISPLAY-HH              PIC X(02).                03330000
033400         10  PV-COLON-1                 PIC X(01).                03340000
033500         10  PV-DISPLAY-MM              PIC X(02).                03350000
033600     05  PV-RECEIV-VRFY-INFO.                                     03360000
033700         10  PV-LEFT-PAREN              PIC X(01).                03370000
033800         10  PV-VRFY-DATE               PIC X(10).                03380000
033900         10  FILLER                     PIC X(01).                03390000
034000         10  PV-VRFY-TIME               PIC X(05).                03400000
034100         10  PV-SEPARATOR               PIC X(03).                03410000
034200         10  PV-VRFY-USERID             PIC X(07).                03420000
034300         10  PV-RIGHT-PAREN             PIC X(01).                03430000
034400     05  PV-CURR-OPER-UNT-ID          PIC S9(4)  COMP             03440000
034500                                                 VALUE ZERO.      03450000
034600     05  PV-XLT00010-TYPE-CODE        PIC X(2)   VALUE SPACES.    03460000
034700         88  PV-XLT00010-TYPE-DC                 VALUE 'DC'.      03470000
034800     05  PV-TMST                      PIC X(26).                  03480000
034900     05  PV-DB2-INV-FORMAT            PIC X(10).                  03490000
035000     05  PV-ACTL-CTOFF-YYYYMMDD       PIC  X(08).                 03500000
035100     05  PV-VERIFY-DTE-YYYYMMDD       PIC  X(08).                 03510000
035200     05  PV-RECEIPT-DTE-YYYYMMDD      PIC  X(08).                 03520000
035300     05  PV-CURRENT-DTE-YYYYMMDD      PIC  X(08).                 03530000
035400     05  PV-WORK-TMST.                                            03540000
035500         10  PV-WORK-TMST-1.                                      03550000
035600             15  PV-WK-CCYY           PIC  X(04)  VALUE SPACE.    03560000
035700             15  FILLER                   PIC  X(01)  VALUE SPACE.03570000
035800             15  PV-WK-MO                 PIC  X(02)  VALUE SPACE.03580000
035900             15  FILLER                   PIC  X(01)  VALUE SPACE.03590000
036000             15  PV-WK-DA                 PIC  X(02)  VALUE SPACE.03600000
036100         10  PV-WORK-TMST-2.                                      03610000
036200             15  FILLER                   PIC  X(01)  VALUE SPACE.03620000
036300             15  PV-WK-HH                 PIC  X(02)  VALUE SPACE.03630000
036400             15  FILLER                   PIC  X(01)  VALUE SPACE.03640000
036500             15  PV-WK-MM                 PIC  X(02)  VALUE SPACE.03650000
036600             15  FILLER                   PIC  X(01)  VALUE SPACE.03660000
036700             15  PV-WK-SS                 PIC  X(02)  VALUE SPACE.03670000
036800             15  FILLER                   PIC  X(01)  VALUE SPACE.03680000
036900             15  FILLER                   PIC  X(06)  VALUE ZERO. 03690000
037000     05  PV-CURRENT-TIMESTAMP         PIC X(26) VALUE SPACE.      03700000
037001     05  PV-WORK-ORDER-INSTR-COUNT        PIC S9(09)  VALUE +0    03700102
037002                                                      COMP-3.     03700202
037003     05  PV-WO-INSTR-SEQ-NBR             PIC S9(04) VALUE +0      03700304
037004                                                    COMP.         03700404
037100                                                                  03710000
037200******************************************************************03720000
037300**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **03730000
037400**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **03740000
037500**  APPLICATION-SPECIFIC COMMAREA.                              **03750000
037600******************************************************************03760000
037700 01  LQW-LIST-QUEUE-WORK-AREA.                                    03770000
037800     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  03780000
037900     05  LQW-ITEM-ENTRIES               OCCURS 8 TIMES            03790000
038000                                        INDEXED BY LQW-IDX.       03800000
038100         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       03810000
038200         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               03820000
038300         10  LQW-SELECTED-SW            PIC  X(01).               03830000
038400             88  LQW-SELECT                         VALUE 'S'.    03840000
038500             88  LQW-DESELECT                       VALUE ' '.    03850000
038600         10  LQW-ACTION                 PIC  X(03).               03860000
038700         10  LQW-UPDATE-PACKS           PIC  X(05).               03870000
038800         10  LQW-UPDATE-PACKS-N                                   03880000
038900                        REDEFINES LQW-UPDATE-PACKS                03890000
039000                                        PIC  9(05).               03900000
039100         10  LQW-STORE-NBR              PIC  9(04).               03910000
039200         10  LQW-PACKSLIP-PACKS         PIC  9(05).               03920000
039300         10  LQW-ACTUAL-PACKS           PIC  9(05).               03930000
039400         10  LQW-VRFYD-PACKS            PIC  9(05).               03940000
039500         10  LQW-ODD-UNITS              PIC  9(05).               03950000
039600         10  LQW-SOURCE                 PIC  X(08).               03960000
039700         10  LQW-P2L-PKSLIP             PIC  9(05).               03970000
039800         10  LQW-P2L-ACTUAL             PIC  9(05).               03980000
039900         10  LQW-CASE-PKSLIP            PIC  9(05).               03990000
040000         10  LQW-CASE-ACTUAL            PIC  9(05).               04000000
040100         10  LQW-STAT-CDE               PIC  X(02).               04010000
040200         10  LQW-SEL-ZERO-SW            PIC  X(01).               04020000
040300         10  LQW-UPDATE-STORE-SW        PIC X(01).                04030000
040400         10  LQW-CAN-UPDATE-SW          PIC X(01).                04040000
040500         10  LQW-TOTAL-ACTL-ITM-QTY     PIC  9(09).               04050000
040600         10  LQW-VERIFY-ITM-QTY         PIC  9(09).               04060000
040700                                                                  04070000
040800     EJECT                                                        04080000
040900*---------------------------------------------------------------* 04090000
041000*    MAP LAYOUT                                                 * 04100000
041100*---------------------------------------------------------------* 04110000
041200                                                                  04120000
041300     COPY RCKM818.                                                04130000
041400*                                                                 04140000
041500 01  MR-OCCURS-LAYOUT                   REDEFINES  RC818AO.       04150000
041600     05  FILLER                         PIC X(299).               04160000
041700     05  MR-SCROLL-AREA                 OCCURS  8 TIMES.          04170000
041800         10  MR-SELECTL                 PIC S9(04) COMP.          04180000
041900         10  MR-SELECTA                 PIC  X(01).               04190000
042000         10  MR-SELECTC                 PIC  X(01).               04200000
042100         10  MR-SELECTH                 PIC  X(01).               04210000
042200         10  MR-SELECTI                 PIC  X(01).               04220000
042300                                                                  04230000
042400         10  MR-ACTIONL                 PIC S9(04) COMP.          04240000
042500         10  MR-ACTIONA                 PIC  X(01).               04250000
042600         10  MR-ACTIONC                 PIC  X(01).               04260000
042700         10  MR-ACTIONH                 PIC  X(01).               04270000
042800         10  MR-ACTION                  PIC  X(03).               04280000
042900                                                                  04290000
043000         10  MR-UPDATE-PACKSL           PIC S9(04) COMP.          04300000
043100         10  MR-UPDATE-PACKSA           PIC  X(01).               04310000
043200         10  MR-UPDATE-PACKSC           PIC  X(01).               04320000
043300         10  MR-UPDATE-PACKSH           PIC  X(01).               04330000
043400         10  MR-UPDATE-PACKS-X.                                   04340000
043500             15  MR-UPDATE-PACKS            PIC  9(05).           04350000
043600                                                                  04360000
043700         10  MR-STORE-NBRL              PIC S9(04) COMP.          04370000
043800         10  MR-STORE-NBRA              PIC  X(01).               04380000
043900         10  MR-STORE-NBRC              PIC  X(01).               04390000
044000         10  MR-STORE-NBRH              PIC  X(01).               04400000
044100         10  MR-STORE-NBR-X.                                      04410000
044200             15  MR-STORE-NBR           PIC  9(04).               04420000
044300                                                                  04430000
044400         10  MR-PACKSLIP-PACKSL         PIC S9(04) COMP.          04440000
044500         10  MR-PACKSLIP-PACKSA         PIC  X(01).               04450000
044600         10  MR-PACKSLIP-PACKSC         PIC  X(01).               04460000
044700         10  MR-PACKSLIP-PACKSH         PIC  X(01).               04470000
044800         10  MR-PACKSLIP-PACKS-X.                                 04480000
044900             15  MR-PACKSLIP-PACKS      PIC  ZZZZ9.               04490000
045000                                                                  04500000
045100         10  MR-ACTUAL-PACKSL           PIC S9(04) COMP.          04510000
045200         10  MR-ACTUAL-PACKSA           PIC  X(01).               04520000
045300         10  MR-ACTUAL-PACKSC           PIC  X(01).               04530000
045400         10  MR-ACTUAL-PACKSH           PIC  X(01).               04540000
045500         10  MR-ACTUAL-PACKS-X.                                   04550000
045600             15  MR-ACTUAL-PACKS        PIC  ZZZZ9.               04560000
045700                                                                  04570000
045800         10  MR-VRFYD-PACKSL            PIC S9(04) COMP.          04580000
045900         10  MR-VRFYD-PACKSA            PIC  X(01).               04590000
046000         10  MR-VRFYD-PACKSC            PIC  X(01).               04600000
046100         10  MR-VRFYD-PACKSH            PIC  X(01).               04610000
046200         10  MR-VRFYD-PACKS-X.                                    04620000
046300             15  MR-VRFYD-PACKS         PIC  ZZZZ9.               04630000
046400                                                                  04640000
046500         10  MR-ODD-UNITSL              PIC S9(04) COMP.          04650000
046600         10  MR-ODD-UNITSA              PIC  X(01).               04660000
046700         10  MR-ODD-UNITSC              PIC  X(01).               04670000
046800         10  MR-ODD-UNITSH              PIC  X(01).               04680000
046900         10  MR-ODD-UNITS-X.                                      04690000
047000             15  MR-ODD-UNITS           PIC  ZZZZ9.               04700000
047100                                                                  04710000
047200         10  MR-SOURCEL                 PIC S9(04) COMP.          04720000
047300         10  MR-SOURCEA                 PIC  X(01).               04730000
047400         10  MR-SOURCEC                 PIC  X(01).               04740000
047500         10  MR-SOURCEH                 PIC  X(01).               04750000
047600         10  MR-SOURCE                  PIC  X(08).               04760000
047700                                                                  04770000
047800         10  MR-P2L-PKSLIPL             PIC S9(04) COMP.          04780000
047900         10  MR-P2L-PKSLIPA             PIC  X(01).               04790000
048000         10  MR-P2L-PKSLIPC             PIC  X(01).               04800000
048100         10  MR-P2L-PKSLIPH             PIC  X(01).               04810000
048200         10  MR-P2L-PKSLIP-X.                                     04820000
048300             15  MR-P2L-PKSLIP          PIC  ZZZZ9.               04830000
048400                                                                  04840000
048500         10  MR-P2L-ACTUALL             PIC S9(04) COMP.          04850000
048600         10  MR-P2L-ACTUALA             PIC  X(01).               04860000
048700         10  MR-P2L-ACTUALC             PIC  X(01).               04870000
048800         10  MR-P2L-ACTUALH             PIC  X(01).               04880000
048900         10  MR-P2L-ACTUAL-X.                                     04890000
049000             15  MR-P2L-ACTUAL          PIC  ZZZZ9.               04900000
049100                                                                  04910000
049200         10  MR-CASE-PKSLIPL            PIC S9(04) COMP.          04920000
049300         10  MR-CASE-PKSLIPA            PIC  X(01).               04930000
049400         10  MR-CASE-PKSLIPC            PIC  X(01).               04940000
049500         10  MR-CASE-PKSLIPH            PIC  X(01).               04950000
049600         10  MR-CASE-PKSLIP-X.                                    04960000
049700             15  MR-CASE-PKSLIP         PIC  ZZZZ9.               04970000
049800                                                                  04980000
049900         10  MR-CASE-ACTUALL            PIC S9(04) COMP.          04990000
050000         10  MR-CASE-ACTUALA            PIC  X(01).               05000000
050100         10  MR-CASE-ACTUALC            PIC  X(01).               05010000
050200         10  MR-CASE-ACTUALH            PIC  X(01).               05020000
050300         10  MR-CASE-ACTUAL-X.                                    05030000
050400             15  MR-CASE-ACTUAL         PIC  ZZZZ9.               05040000
050500                                                                  05050000
050600                                                                  05060000
050700***************************************************************** 05070000
050800*   XLWS071 - IS THE LAYOUT THAT IS USED TO PASS INFO TO THE    * 05080000
050900*             LOCATION MODULE (XLKUT071)                        * 05090000
051000***************************************************************** 05100000
051100     COPY XLWS071.                                                05110000
051200                                                                  05120000
051300*---------------------------------------------------------------* 05130000
051400*    RECORD LAYOUT FOR CALCULATING UNITS FOR AN ORDER.          * 05140000
051500*---------------------------------------------------------------* 05150000
051600     COPY RCWS074.                                                05160000
051700                                                                  05170000
051800*----------------------------------------------------------------*05180000
051900*    CURRENT DATE COPYBOOK.                                      *05190000
052000*----------------------------------------------------------------*05200000
052100                                                                  05210000
052200     COPY DPWS017.                                                05220000
052300                                                                  05230000
052310*----------------------------------------------------------------*05231005
052320**  SECURITY SUBROUTINE PARAMETERS                                05232005
052321* DMH - 11-26-14                                                  05232105
052330*----------------------------------------------------------------*05233005
052340     COPY DPWS008.                                                05234005
052350                                                                  05235005
052400                                                                  05240000
052500     COPY RCWS031.                                                05250000
052600                                                                  05260000
052700*---------------------------------------------------------------* 05270000
052800*    RECORD LAYOUT FOR THE SELECTION TEMP STORAGE QUEUE.        * 05280000
052900*---------------------------------------------------------------* 05290000
053000     COPY RCWS037.                                                05300000
053100                                                                  05310000
053200*---------------------------------------------------------------* 05320000
053300*  RECORD LAYOUT FOR THE PACKSLIP SELECTION TEMP STORAGE QUEUE. * 05330000
053400*---------------------------------------------------------------* 05340000
053500                                                                  05350000
053600     COPY RCWS801.                                                05360000
053700                                                                  05370000
053800*----------------------------------------------------------------*05380000
053900*    COPY BOOK FOR CALENDAR SUBROUTINE (DPKUT500)                 05390000
054000*----------------------------------------------------------------*05400000
054100                                                                  05410000
054200     COPY DPWS500.                                                05420000
054300******************************************************************05430000
054400*  COMMAREA LAYOUT FOR THE UNITS WORKED MODULE (PCKCS756)        *05440000
054500******************************************************************05450000
054600     COPY PCWS238.                                                05460000
054700                                                                  05470000
054800***************************************************************** 05480000
054900*   RCWS040 - IS THE LAYOUT THAT IS USED TO PASS INFO TO THE    * 05490000
055000*             AUTOVERIFY (AUTOVE) ELIGIBILITY MODULE (RCKUT127).* 05500000
055100***************************************************************** 05510000
055200     COPY RCWS040.                                                05520000
055300/                                                                 05530000
055400******************************************************************05540000
055500*  TEMPORARY STORAGE QUEUE - STORE UNIT ADJUSTMENTS TO BE SENT   *05550000
055600*  TO RMS PO BY PCKCS759.                                        *05560000
055700******************************************************************05570000
055800     COPY PCWS241.                                                05580000
055900                                                                  05590000
056000*---------------------------------------------------------------* 05600000
056100*    ATTRIBUTE SETTINGS COPYBOOK.                               * 05610000
056200*---------------------------------------------------------------* 05620000
056300                                                                  05630000
056400     COPY DPWS015.                                                05640000
056500                                                                  05650000
056600*---------------------------------------------------------------* 05660000
056700*    FUNCTION KEYS COPYBOOK.                                    * 05670000
056800*---------------------------------------------------------------* 05680000
056900                                                                  05690000
057000     COPY DPWS016.                                                05700000
057100                                                                  05710000
057200*---------------------------------------------------------------* 05720000
057300*    NUMERIC EDIT LAYOUT.                                       * 05730000
057400*---------------------------------------------------------------* 05740000
057500                                                                  05750000
057600     COPY DPWS010I.                                               05760000
057700 EJECT                                                            05770000
057800******************************************************************05780008
057900** THE CALLING PARAMETER LIST (DPWS030/DPWS930) FOR THE CICS    **05790008
057910** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **05791008
058000******************************************************************05800008
058100                                                                  05810000
058200     COPY DPWS030.                                                05820000
058210     COPY DPWS930.                                                05821008
058300                                                                  05830000
058400 EJECT                                                            05840000
058500*---------------------------------------------------------------* 05850000
058600*    STANDARD COMMAREA.                                         * 05860000
058700*---------------------------------------------------------------* 05870000
058800                                                                  05880000
058900     COPY DPWS020.                                                05890000
059000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                05900000
059100                                                                  05910000
059200*---------------------------------------------------------------* 05920000
059300* INTER-APPLICATION COMMAREA.                                   * 05930000
059400*   RCWS012 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 05940000
059500*             SPEC SCREEN.                                      * 05950000
059600*   RCWS036 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 05960000
059700*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 05970000
059800*---------------------------------------------------------------* 05980000
059900                                                                  05990000
060000         10  INTER-APPL-COMM-AREA       PIC X(200).               06000000
060100     COPY RCWS012.                                                06010000
060200     COPY RCWS800.                                                06020000
060300     COPY RCWS036.                                                06030000
060400     COPY RCWS015.                                                06040000
060500                                                                  06050000
060600*---------------------------------------------------------------* 06060000
060700*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 06070000
060800*---------------------------------------------------------------* 06080000
060900         10  ASC-SPECIFIC-COMMAREA.                               06090000
061000             15  ASC-LOCAL-GO-DESTINATION            PIC X(01).   06100000
061100                 88  ASC-RETURNING-FROM-RCVG         VALUE '1'.   06110000
061200                 88  ASC-RETURNING-FROM-DIST         VALUE '2'.   06120000
061300                 88  ASC-RETURNING-FROM-PACK-ITM     VALUE '3'.   06130000
061400             15  ASC-USE-SELECTION-QUEUE-IND                      06140000
061500                                           PIC X(01).             06150000
061600                 88  ASC-USE-SELECTION-QUEUE    VALUE 'Y'.        06160000
061700             15  ASC-SEL-QUEUE-NAME-IN     PIC X(08).             06170000
061800             15  ASC-TRB-QUEUE-NAME-IN               PIC X(8).    06180000
061900             15  ASC-VRFY-ADJ-QUEUE-NAME.                         06190000
062000                 20  ASC-VRFY-ADJ-TERM-ID            PIC X(4).    06200000
062100                 20  ASC-VRFY-ADJ-TASK-NUMBER        PIC S9(5)    06210000
062200                                                     COMP-3.      06220000
062300                 20  ASC-VRFY-ADJ-SEQ                PIC 9.       06230000
062400             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05) COMP-3.     06240000
062500             15  ASC-SEL-SUB               PIC S9(04) COMP.       06250000
062600             15  ASC-SEL-ITEM              PIC S9(04) COMP.       06260000
062700             15  ASC-LIST-KEYS.                                   06270000
062800                 20  ASC-OPER-UNT-ID                 PIC S9(04)   06280000
062900                                                     COMP.        06290000
063000                 20  ASC-FCLTY-ID                    PIC S9(04)   06300000
063100                                                     COMP.        06310000
063200                 20  ASC-FCLTY-NME                   PIC  X(25).  06320000
063300                 20  ASC-PACK-ID                     PIC  9(04).  06330000
063400                 20  ASC-RECEIV-VRFY-INFO            PIC  X(28).  06340000
063500                 20  ASC-PO-NBR                      PIC S9(09)   06350000
063600                                                     COMP.        06360000
063700                 20  ASC-PO-LNE-NBR                  PIC S9(09)   06370000
063800                                                     COMP.        06380000
063900                 20  ASC-REC-SEQ-NBR                 PIC S9(09)   06390000
064000                                                     COMP.        06400000
064100                 20  ASC-PO-DRIVER-LNE               PIC S9(09)   06410000
064200                                                     COMP.        06420000
064300                 20  ASC-TOT-PKSLIP-PACKS            PIC S9(07)   06430000
064400                                                     COMP.        06440000
064500                 20  ASC-TOT-ACTUAL-PACKS            PIC S9(07)   06450000
064600                                                     COMP.        06460000
064700                 20  ASC-TOT-VERFYD-PACKS            PIC S9(07)   06470000
064800                                                     COMP.        06480000
064900                 20  ASC-TOT-ODD-UNITS               PIC S9(07)   06490000
065000                                                     COMP.        06500000
065100                 20  ASC-HDR-TOT-ACT-UNTS            PIC S9(07)   06510000
065200                                                     COMP.        06520000
065300                 20  ASC-HDR-TOT-VERFYD-UNTS         PIC S9(07)   06530000
065400                                                     COMP.        06540000
065500                 20  ASC-DEPT-NBR                    PIC  9(04).  06550000
065600                 20  ASC-DRIVER-RATIO                PIC  9(06).  06560000
065700                 20  ASC-SOURCE-TYPE                 PIC  X(08).  06570000
065800                 20  ASC-KEY-VFY-SRC                 PIC X(08).   06580000
065900                                                                  06590000
066000             15 ASC-TRBL-FOUND-SW                    PIC  X.      06600000
066100                 88 ASC-TRBL-EXISTS             VALUE 'Y'.        06610000
066200                 88 ASC-NO-TRBL-EXISTS          VALUE 'N'.        06620000
066300             15  ASC-TRBL-LVL-IND                PIC X(01).       06630000
066400                 88  ASC-PO-LEVEL-TRBL           VALUE 'P'.       06640000
066500                 88  ASC-LINE-LEVEL-TRBL         VALUE 'L'        06650000
066600                                                       'S'        06660000
066700                                                       'X'        06670000
066800                                                       'M'.       06680000
066900             15  ASC-RECEIV-STATUS-CDE               PIC  X(02).  06690000
067000             15  ASC-RECITM-STATUS-CDE               PIC  X(02).  06700000
067100             15  ASC-RECEIV-ML-POST-TMST             PIC  X(26).  06710000
067200             15  ASC-PACK-BY-ST-SW                   PIC X(01).   06720000
067300                 88  ASC-PACK-BY-STORE        VALUE 'Y'.          06730000
067400                 88  ASC-NOT-PACK-BY-STORE    VALUE 'N'.          06740000
067500             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                06750000
067600                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  06760000
067700                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   06770000
067800                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   06780000
067900                                                                  06790000
068000                 20  ASC-ITEM-ARRAY.                              06800000
068100                     25  ASC-ITEM-ENTRIES OCCURS  8 TIMES.        06810000
068200                         30  ASC-LIST-ITEM-NUMBER                 06820000
068300                                                     PIC S9(09)   06830000
068400                                                     COMP-3.      06840000
068500                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  06850000
068600                             88  ASC-VALID-SELECT    VALUE ' '    06860000
068700                                                           'S'    06870000
068800                                                           'B'    06880000
068900                                                           'E'.   06890000
069000                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   06900000
069100                             88  ASC-TEMP-SELECT     VALUE 'S'.   06910000
069200                             88  ASC-TEMP-BEGIN      VALUE 'B'.   06920000
069300                             88  ASC-TEMP-END        VALUE 'E'.   06930000
069400                         30  ASC-SELECTED-SW         PIC  X(01).  06940000
069500                             88  ASC-NO-SELECT       VALUE ' '.   06950000
069600                             88  ASC-SELECT          VALUE 'S'.   06960000
069700                             88  ASC-BEGIN           VALUE 'B'.   06970000
069800                             88  ASC-END             VALUE 'E'.   06980000
069900                         30  ASC-ACTION              PIC  X(03).  06990000
070000                         30  ASC-UPDATE-PACKS        PIC  X(05).  07000000
070100                         30  ASC-UPDATE-PACKS-N                   07010000
070200                                     REDEFINES ASC-UPDATE-PACKS   07020000
070300                                                 PIC 9(05).       07030000
070400                         30  ASC-STORE-NBR           PIC  9(04).  07040000
070500                         30  ASC-PACKSLIP-PACKS      PIC  9(05).  07050000
070600                         30  ASC-ACTUAL-PACKS        PIC  9(05).  07060000
070700                         30  ASC-VRFYD-PACKS         PIC  9(05).  07070000
070800                         30  ASC-ODD-UNITS           PIC  9(05).  07080000
070900                         30  ASC-SOURCE              PIC  X(08).  07090000
071000                         30  ASC-P2L-PKSLIP          PIC  9(05).  07100000
071100                         30  ASC-P2L-ACTUAL          PIC  9(05).  07110000
071200                         30  ASC-CASE-PKSLIP         PIC  9(05).  07120000
071300                         30  ASC-CASE-ACTUAL         PIC  9(05).  07130000
071400                         30  ASC-STAT-CDE            PIC  X(02).  07140000
071500                         30  ASC-SEL-ZERO-SW         PIC X(01).   07150000
071600                             88  ASC-SEL-ZERO-YES    VALUE 'Y'.   07160000
071700                             88  ASC-SEL-ZERO-NO     VALUE 'N'.   07170000
071800                         30  ASC-UPDATE-STORE-SW     PIC X(01).   07180000
071900                             88  ASC-UPDATE-YES      VALUE 'Y'.   07190000
072000                             88  ASC-UPDATE-NO       VALUE 'N'.   07200000
072100                         30  ASC-CAN-UPDATE-SW       PIC X(01).   07210000
072200                             88  ASC-CAN-UPDATE      VALUE 'Y'.   07220000
072300                             88  ASC-CANNOT-UPDATE   VALUE 'N'.   07230000
072400                         30  ASC-TOTAL-ACTL-ITM-QTY  PIC  9(09).  07240000
072500                         30  ASC-VERIFY-ITM-QTY      PIC  9(09).  07250000
072600                                                                  07260000
072700             15  ASC-BLK-SUB                         PIC S9(04)   07270000
072800                                                          COMP    07280000
072900                                                          SYNC.   07290000
073000             15  ASC-ITEM-SUB                        PIC S9(04)   07300000
073100                                                          COMP    07310000
073200                                                          SYNC.   07320000
073300             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   07330000
073400                                                          COMP-3. 07340000
073500             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   07350000
073600                                                          COMP-3. 07360000
073700             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   07370000
073800                                                          COMP-3. 07380000
073900             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   07390000
074000                                                          COMP-3. 07400000
074100             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   07410000
074200                                                          COMP-3. 07420000
074300             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   07430000
074400                                                          COMP    07440000
074500                                                          SYNC.   07450000
074600             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   07460000
074700                                                          COMP-3. 07470000
074800             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   07480000
074900                                                          COMP-3. 07490000
075000             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  07500000
075100                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   07510000
075200                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   07520000
075300             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  07530000
075400                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   07540000
075500                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   07550000
075600             15  ASC-LIST-QUEUE-NAME.                             07560000
075700                 20  ASC-LIST-TERM-ID                PIC  X(04).  07570000
075800                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   07580000
075900                                                          COMP-3. 07590000
076000                 20  ASC-LIST-SEQ                    PIC  9(01).  07600000
076100             15  ASC-SEL-QUEUE-NAME-OUT.                          07610000
076200                 20  ASC-SEL-TERM-ID                 PIC  X(04).  07620000
076300                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   07630000
076400                                                          COMP-3. 07640000
076500                 20  ASC-SEL-SEQ                     PIC  9(01).  07650000
076600                                                                  07660000
076700             15  ASC-START-ITEM-REQUEST.                          07670000
076800                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  07680000
076900                                                                  07690000
077000             15  ASC-VERIFY-SW                       PIC  X(01).  07700000
077100                 88  ASC-CAN-VERIFY                  VALUE 'Y'.   07710000
077200                 88  ASC-CANT-VERIFY                 VALUE 'N'.   07720000
077300             15  ASC-UNVERIFY-SW                     PIC  X(01).  07730000
077400                 88  ASC-CAN-UNVERIFY                VALUE 'Y'.   07740000
077500                 88  ASC-CANT-UNVERIFY-FS            VALUE 'F'.   07750000
077600                 88  ASC-CANT-UNVERIFY-ST            VALUE 'S'.   07760000
077700                 88  ASC-CANT-UNVERIFY               VALUE 'N'.   07770000
077800                                                                  07780000
077900             15  ASC-CONFIRM-SWITCH                  PIC X.       07790000
078000                 88  ASC-CONFIRM                     VALUE 'Y'.   07800000
078100                 88  ASC-NOT-CONFIRM                 VALUE 'N'.   07810000
078200                                                                  07820000
078300             15  ASC-CONFIRM-ZERO-SW                 PIC X.       07830000
078400                 88  ASC-CONFIRM-ZERO                VALUE 'Y'.   07840000
078500                 88  ASC-NOT-CONFIRM-ZERO            VALUE 'N'.   07850000
078600                                                                  07860000
078700             15  ASC-CONFIRM-VERIFY-SW               PIC X.       07870000
078800                 88  ASC-CONFIRM-VERIFY              VALUE 'V'.   07880000
078900                 88  ASC-CONFIRM-UNVERIFY            VALUE 'U'.   07890000
079000                 88  ASC-STOP-VERIFY                 VALUE 'S'.   07900000
079100                                                                  07910000
079200             15  ASC-RECDVS-SW                       PIC X.       07920000
079300                 88  ASC-MORE-RECDVS                 VALUE 'Y'.   07930000
079400                 88  ASC-NO-MORE-RECDVS              VALUE 'N'.   07940000
079500             15  ASC-ACTL-CONFIRMED-SW               PIC X.       07950000
079600                 88  ASC-ACTL-CONFIRMED              VALUE 'Y'.   07960000
079700                 88  ASC-ACTL-NOT-CONFIRMED          VALUE 'N'.   07970000
079800             15  ASC-RANGE-CHECK-SW          PIC X.               07980000
079900                 88  ASC-RANGE-ON                    VALUE 'Y'.   07990000
080000                 88  ASC-RANGE-OFF                   VALUE 'N'.   08000000
080100             15  ASC-POST-VERIFIED-RECEIPT-SW        PIC  X(01).  08010000
080200                 88  ASC-POST-VERIFIED-RECEIPT       VALUE 'Y'.   08020000
080300                 88  ASC-NOT-POST-VERIFIED-RECEIPT   VALUE 'N'.   08030000
080400             15  ASC-STORE-TYPE-SW                   PIC  X(01).  08040000
080500                 88  ASC-NOT-DC-STORE-TYPE           VALUE 'N'.   08050000
080600                 88  ASC-DC-STORE-TYPE               VALUE 'D'.   08060000
080700             15  ASC-HOLD-INTER-APPL                 PIC X(200).  08070000
080800             15  ASC-CONFIRM-UPDATE-SW       PIC X.               08080000
080900                 88  ASC-CONFIRM-UPDATE              VALUE 'Y'.   08090000
081000                 88  ASC-DONT-CONFIRM-UPDATE         VALUE 'N'.   08100000
081100             15  ASC-CONFIRM-SWITCH                  PIC X.       08110000
081200                 88  ASC-CONFIRMED                   VALUE 'Y'.   08120000
081300                 88  ASC-NOT-CONFIRMED               VALUE 'N'.   08130000
081400             15  ASC-AUTO-VE-SW              PIC X(01).           08140000
081500                 88  ASC-AUTO-VE-YES                 VALUE 'Y'.   08150000
081600                 88  ASC-AUTO-VE-NO                  VALUE 'N'.   08160000
081700             15  ASC-FILLER                          PIC X(956).  08170000
081800                                                                  08180000
081900                                                                  08190000
082000     EJECT                                                        08200000
082100*----------------------------------------------------------------*08210000
082200*    COMMAREA FOR TMKCS520.                                      *08220000
082300*----------------------------------------------------------------*08230000
082400                                                                  08240000
082500     COPY TMWS500.                                                08250000
082600******************************************************************08260000
082700*    HELD TROUBLE SCREEN                                          08270000
082800******************************************************************08280000
082900     COPY TMWS003.                                                08290000
083000*---------------------------------------------------------------* 08300000
083100*    ABEND PROCESSING COPYBOOK.                                 * 08310000
083200*---------------------------------------------------------------* 08320000
083300                                                                  08330000
083400     COPY DPWS013.                                                08340000
083500                                                                  08350000
083600 EJECT                                                            08360000
083700***************************************************************** 08370000
083800*    DB2 AREA FOR THE PO/RMS ROLLOUT CONTROL TABLE              * 08380000
083900*    (POT_RMS_RLOUT_CTL)                                        * 08390000
084000***************************************************************** 08400000
084100     EXEC SQL                                                     08410000
084200          INCLUDE POT00006                                        08420000
084300     END-EXEC.                                                    08430000
084400*---------------------------------------------------------------* 08440000
084500*    DB2 AREA FOR PURCHASE ORDER TABLE                          * 08450000
084600*---------------------------------------------------------------* 08460000
084700     EXEC SQL                                                     08470000
084800          INCLUDE TPURCHS                                         08480000
084900     END-EXEC.                                                    08490000
085000*---------------------------------------------------------------* 08500000
085100*    DB2 AREA FOR PURCHASE ORDER ITEM TABLE                     * 08510000
085200*---------------------------------------------------------------* 08520000
085300     EXEC SQL                                                     08530000
085400          INCLUDE TPURITM                                         08540000
085500     END-EXEC.                                                    08550000
085600*---------------------------------------------------------------* 08560000
085700*    DB2 AREA FOR PURCHASE ORDER PRE PACK TABLE                 * 08570000
085800*---------------------------------------------------------------* 08580000
085900     EXEC SQL                                                     08590000
086000          INCLUDE TPOPRPK                                         08600000
086100     END-EXEC.                                                    08610000
086200/                                                                 08620000
086300*---------------------------------------------------------------* 08630000
086400*    DB2 AREA FOR RECEIPT HEADER TABLE                          * 08640000
086500*---------------------------------------------------------------* 08650000
086600     EXEC SQL                                                     08660000
086700          INCLUDE TRECEIV                                         08670000
086800     END-EXEC.                                                    08680000
086900*---------------------------------------------------------------* 08690000
087000*    DB2 AREA FOR RECEIPT ITEM TABLE                            * 08700000
087100*---------------------------------------------------------------* 08710000
087200     EXEC SQL                                                     08720000
087300          INCLUDE TRECITM                                         08730000
087400     END-EXEC.                                                    08740000
087500*---------------------------------------------------------------* 08750000
087600*    DB2 AREA FOR RECEIPT DISTRIBUTION TABLE                    * 08760000
087700*---------------------------------------------------------------* 08770000
087800     EXEC SQL                                                     08780000
087900          INCLUDE TRECDIS                                         08790000
088000     END-EXEC.                                                    08800000
088100*---------------------------------------------------------------* 08810000
088200*    DB2 AREA FOR RECEIPT VERIFIED ODD UNITS TABLE              * 08820000
088300*    (RCT_VRFD_ODD_UNT)                                         * 08830000
088400*---------------------------------------------------------------* 08840000
088500     EXEC SQL                                                     08850000
088600          INCLUDE RCT00009                                        08860000
088700     END-EXEC.                                                    08870000
088800*---------------------------------------------------------------* 08880000
088900*    DB2 AREA FOR DIST HEADER                                   * 08890000
089000*---------------------------------------------------------------* 08900000
089100     EXEC SQL                                                     08910000
089200          INCLUDE TDISTHD                                         08920000
089300     END-EXEC.                                                    08930000
089400*---------------------------------------------------------------* 08940000
089500*    DB2 AREA FOR DIST DETAIL                                   * 08950000
089600*---------------------------------------------------------------* 08960000
089700     EXEC SQL                                                     08970000
089800          INCLUDE TDISTDT                                         08980000
089900     END-EXEC.                                                    08990000
090000******************************************************************09000000
090100*    DB2 DCLGEN FOR TRECDVS TABLE                                 09010000
090200******************************************************************09020000
090300     EXEC SQL                                                     09030000
090400          INCLUDE TRECDVS                                         09040000
090500     END-EXEC.                                                    09050000
090600*----------------------------------------------------------------*09060000
090700*    DB2 DCLGEN FOR THE XLT_LOC DATABASE                          09070000
090800*----------------------------------------------------------------*09080000
090900     EXEC SQL                                                     09090000
091000          INCLUDE XLT00010                                        09100000
091100     END-EXEC.                                                    09110000
091200*----------------------------------------------------------------*09120000
091300*    INVENTORY PARAMETERS TABLE                                  *09130000
091400*----------------------------------------------------------------*09140000
091600     EXEC SQL                                                     09160000
091700          INCLUDE XLT00025                                        09170000
091800     END-EXEC.                                                    09180000
091810                                                                  09181000
091820*----------------------------------------------------------------*09182000
091830*    PARAMETER TABLE                                              09183000
091840*----------------------------------------------------------------*09184000
091850     EXEC SQL                                                     09185000
091860          INCLUDE TKRPRPM                                         09186000
091870     END-EXEC.                                                    09187000
091871                                                                  09187102
091872*----------------------------------------------------------------*09187202
091873*    TWRKORD - WORK ORDER                                         09187302
091874* DMH - 11-26-14                                                  09187402
091875*----------------------------------------------------------------*09187502
091876     EXEC SQL                                                     09187602
091877          INCLUDE TWRKORD                                         09187702
091878     END-EXEC.                                                    09187802
091879                                                                  09187902
091880*----------------------------------------------------------------*09188002
091881*    TWKORIN - WORK ORDER INSTRUCTION                             09188102
091882* DMH - 11-26-14                                                  09188202
091883*----------------------------------------------------------------*09188302
091884     EXEC SQL                                                     09188402
091885          INCLUDE TWKORIN                                         09188502
091886     END-EXEC.                                                    09188602
091887                                                                  09188702
091888*----------------------------------------------------------------*09188802
091889*    TCOCNTL - COMPANY CONTROL                                    09188902
091890* DMH - 11-26-14                                                  09189002
091891*----------------------------------------------------------------*09189102
091892     EXEC SQL                                                     09189202
091893          INCLUDE TCOCNTL                                         09189302
091894     END-EXEC.                                                    09189402
091895                                                                  09189502
091896*----------------------------------------------------------------*09189602
091897*    TOSOPFA                                                      09189702
091898* DMH - 11-26-14                                                  09189802
091899*----------------------------------------------------------------*09189902
091900     EXEC SQL                                                     09190002
091901          INCLUDE TOSOPFA                                         09190102
091902     END-EXEC.                                                    09190202
091903                                                                  09190300
091910*---------------------------------------------------------------* 09191000
092000*    DB2 AREA FOR COMMUNICATIONS                                * 09200000
092100*---------------------------------------------------------------* 09210000
092200     EXEC SQL                                                     09220000
092300          INCLUDE SQLCA                                           09230000
092400     END-EXEC.                                                    09240000
092500                                                                  09250000
092600*---------------------------------------------------------------* 09260000
092700                                                                  09270000
092800     EXEC SQL                                                     09280000
092900          DECLARE PACK-SLIP-CSR CURSOR                            09290000
093000          FOR SELECT DISTINCT                                     09300000
093100                A.VERFYD_TMST                                     09310000
093200              , A.REC_TMST                                        09320000
093300              , B.STATUS_CDE                                      09330000
093400              , B.VRFD_USR_ID                                     09340000
093500              , B.PREPK_ID                                        09350000
093600              , D.STR_NBR                                         09360000
093700              , D.AP_PRC_CDE                                      09370000
093800              , SUM(D.EXPTED_ITM_QTY)                             09380000
093900              , SUM(D.VERIFY_ITM_QTY)                             09390000
094000              , E.DEPT_NBR                                        09400000
094100          FROM    TRECEIV  A                                      09410000
094200              ,   TRECITM  B                                      09420000
094300              ,   TRECDIS  D                                      09430000
094400              ,   TPURCHS  E                                      09440000
094500          WHERE A.ORD_NBR          =  :DK-PO-NBR                  09450000
094600           AND  A.ORD_NBR          =  B.ORD_NBR                   09460000
094700           AND  A.ORD_NBR          =  D.ORD_NBR                   09470000
094800           AND  A.ORD_NBR          =  E.PO_NBR                    09480000
094900           AND  A.VER_STATUS_CDE   =  'A'                         09490000
095000           AND  B.VER_STATUS_CDE   =  'A'                         09500000
095100           AND  E.VER_STATUS_CDE   =  'A'                         09510000
095200           AND  A.OPER_UNT_ID      =  :DK-OPER-UNT-ID             09520000
095300           AND  A.OPER_UNT_ID      =  B.OPER_UNT_ID               09530000
095400           AND  A.OPER_UNT_ID      =  D.OPER_UNT_ID               09540000
095500           AND  A.FCLTY_ID         =  :DK-FCLTY-ID                09550000
095600           AND  A.FCLTY_ID         =  B.FCLTY_ID                  09560000
095700           AND  B.FCLTY_ID         =  D.FCLTY_ID                  09570000
095800           AND  A.REC_SEQ_NBR      =  :DK-REC-SEQ-NBR             09580000
095900           AND  A.REC_SEQ_NBR      =  B.REC_SEQ_NBR               09590000
096000           AND  A.REC_SEQ_NBR      =  D.REC_SEQ_NBR               09600000
096100           AND  B.ORD_LNE_NBR      =  D.ORD_LNE_NBR               09610000
096200           AND  B.PREPK_ID         =  :DK-PREPK-ID                09620000
096300          GROUP BY                                                09630000
096400                D.STR_NBR                                         09640000
096500              , E.DEPT_NBR                                        09650000
096600              , B.STATUS_CDE                                      09660000
096700              , B.VRFD_USR_ID                                     09670000
096800              , B.PREPK_ID                                        09680000
096900              , A.VERFYD_TMST                                     09690000
097000              , A.REC_TMST                                        09700000
097100              , D.AP_PRC_CDE                                      09710000
097200          ORDER BY                                                09720000
097300                D.STR_NBR                                         09730000
097400              , E.DEPT_NBR                                        09740000
097500              , B.STATUS_CDE                                      09750000
097600              , B.VRFD_USR_ID                                     09760000
097700              , B.PREPK_ID                                        09770000
097800              , A.VERFYD_TMST                                     09780000
097900              , A.REC_TMST                                        09790000
098000              , D.AP_PRC_CDE                                      09800000
098100     END-EXEC.                                                    09810000
098200                                                                  09820000
098300******************************************************************09830000
098400*    DB2 CURSOR DEFINITION FOR RETRIEVAL RECDVS ROWS              09840000
098500******************************************************************09850000
098600     EXEC SQL                                                     09860000
098700          DECLARE RECDVS-CURSOR CURSOR FOR                        09870000
098800          SELECT                                                  09880000
098900                  VRFY_SRC_CDE                                    09890000
099000                , EXPTED_ITM_QTY                                  09900000
099100                , VRFY_ITM_QTY                                    09910000
099200            FROM                                                  09920000
099300                  TRECDVS                                         09930000
099400            WHERE                                                 09940000
099500                  ORD_NBR          = :DK-PO-NBR                   09950000
099600              AND REC_SEQ_NBR      = :DK-REC-SEQ-NBR              09960000
099700              AND ORD_LNE_NBR      = :DK-PO-DRIVER-LNE            09970000
099800              AND STR_NBR          = :DK-STR-NBR                  09980000
099900              AND VER_STAT_CDE     = 'A'                          09990000
100000              AND VRFY_SRC_CDE     IN ('P2','CP')                 10000000
100100     END-EXEC.                                                    10010000
100200                                                                  10020000
100300     EXEC SQL                                                     10030000
100400          DECLARE PACK-CURSOR CURSOR WITH HOLD FOR                10040000
100500          SELECT                                                  10050000
100600                 'A'                                              10060000
100700              ,  A.ORD_LNE_NBR                                    10070000
100800              ,  A.VERIFY_ITM_QTY                                 10080000
100900              ,  A.AP_VERIFY_ITM_QTY                              10090000
101000              ,  B.PREPK_RATO_QTY                                 10100000
101100              ,  B.STATUS_CDE                                     10110000
101200              ,  B.PREPK_DRV_LNE_CDE                              10120000
101300          FROM                                                    10130000
101400                 TRECDIS A                                        10140000
101500              ,  TRECITM  B                                       10150000
101600          WHERE                                                   10160000
101700                A.ORD_NBR          =  :DK-PO-NBR                  10170000
101800           AND  A.ORD_NBR          =  B.ORD_NBR                   10180000
101900           AND  A.REC_SEQ_NBR      =  :DK-REC-SEQ-NBR             10190000
102000           AND  A.REC_SEQ_NBR      =  B.REC_SEQ_NBR               10200000
102100           AND  A.FCLTY_ID         =  :DK-FCLTY-ID                10210000
102200           AND  A.FCLTY_ID         =  B.FCLTY_ID                  10220000
102300           AND  A.OPER_UNT_ID      =  :DK-OPER-UNT-ID             10230000
102400           AND  A.OPER_UNT_ID      =  B.OPER_UNT_ID               10240000
102500           AND  A.ORD_LNE_NBR      =  B.ORD_LNE_NBR               10250000
102700           AND  A.STR_NBR          =  :DK-STR-NBR                 10270000
102800           AND  B.VER_STATUS_CDE   =  'A'                         10280000
102900           AND  B.PREPK_ID         = :DK-UPDATE-PACK-ID           10290000
103000        UNION                                                     10300000
103100          SELECT                                                  10310000
103200                 'B'                                              10320000
103300              ,  A.ORD_LNE_NBR                                    10330000
103400              ,  0                                                10340000
103500              ,  0                                                10350000
103600              ,  A.PREPK_RATO_QTY                                 10360000
103700              ,  A.STATUS_CDE                                     10370000
103800              ,  A.PREPK_DRV_LNE_CDE                              10380000
103900          FROM                                                    10390000
104000                 TRECITM A                                        10400000
104100          WHERE                                                   10410000
104200                A.ORD_NBR          =  :DK-PO-NBR                  10420000
104300           AND  A.REC_SEQ_NBR      =  :DK-REC-SEQ-NBR             10430000
104400           AND  A.FCLTY_ID         =  :DK-FCLTY-ID                10440000
104500           AND  A.OPER_UNT_ID      =  :DK-OPER-UNT-ID             10450000
104600           AND  A.PREPK_ID         =  :DK-UPDATE-PACK-ID          10460000
104700           AND  A.VER_STATUS_CDE   =  'A'                         10470000
104800           AND NOT EXISTS                                         10480000
104900               (SELECT *                                          10490000
105000                FROM TRECDIS B                                    10500000
105100         WHERE  A.ORD_NBR          =  B.ORD_NBR                   10510000
105200           AND  A.REC_SEQ_NBR      =  B.REC_SEQ_NBR               10520000
105300           AND  A.FCLTY_ID         =  B.FCLTY_ID                  10530000
105400           AND  A.OPER_UNT_ID      =  B.OPER_UNT_ID               10540000
105500           AND  A.ORD_LNE_NBR      =  B.ORD_LNE_NBR               10550000
105600           AND  B.STR_NBR          =  :DK-STR-NBR)                10560009
105800     END-EXEC.                                                    10580000
105900                                                                  10590000
106000     EXEC SQL                                                     10600000
106100          DECLARE TOTAL-PACK-CURSOR CURSOR FOR                    10610000
106200          SELECT                                                  10620000
106300                 A.ORD_LNE_NBR                                    10630000
106400              ,  A.PREPK_RATO_QTY                                 10640000
106500              ,  A.STATUS_CDE                                     10650000
106600              ,  A.PREPK_DRV_LNE_CDE                              10660000
106700          FROM                                                    10670000
106800                 TRECITM  A                                       10680000
106900          WHERE                                                   10690000
107000                A.ORD_NBR          =  :DK-PO-NBR                  10700000
107100           AND  A.REC_SEQ_NBR      =  :DK-REC-SEQ-NBR             10710000
107200           AND  A.FCLTY_ID         =  :DK-FCLTY-ID                10720000
107300           AND  A.OPER_UNT_ID      =  :DK-OPER-UNT-ID             10730000
107400           AND  A.VER_STATUS_CDE   =  'A'                         10740000
107500           AND  A.PREPK_ID         = :DK-UPDATE-PACK-ID           10750000
107600     END-EXEC.                                                    10760000
107700                                                                  10770000
107800 EJECT                                                            10780000
107900 LINKAGE SECTION.                                                 10790000
108000                                                                  10800000
108100 01  DFHCOMMAREA.                                                 10810000
108200     05  FILLER                         OCCURS  1 TO 4072 TIMES   10820000
108300                                        DEPENDING ON EIBCALEN.    10830000
108400         10  FILLER                     PIC X.                    10840000
108500                                                                  10850000
108600 EJECT                                                            10860000
108700 PROCEDURE DIVISION.                                              10870000
108800******************************************************************10880000
108900**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **10890000
109000**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **10900000
109100**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **10910000
109200******************************************************************10920000
109300 0000-MAIN-MODULE.                                                10930000
109400     INITIALIZE DP030-CICS-API-FIELDS.                            10940000
109500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       10950000
109600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          10960000
109700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         10970000
109800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       10980000
109900     MOVE LENGTH OF RC818AI        TO DP030-MAP-LENGTH (1).       10990000
110000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     11000000
110100     PERFORM 0001-CALL-CICS-ARCH-API.                             11010000
110200*                                                                 11020000
110300     PERFORM 1000-CONTROL-PROCESSING                              11030000
110400*                                                                 11040000
110500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     11050000
110600     PERFORM 0001-CALL-CICS-ARCH-API.                             11060000
110700                                                                  11070000
110800******************************************************************11080000
110900**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **11090000
111000**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **11100000
111100******************************************************************11110000
111200 0001-CALL-CICS-ARCH-API.                                         11120000
111310     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      11131008
111400                                    DFHCOMMAREA                   11140008
111500                                    DP030-CICS-API-FIELDS         11150008
111600                                    DP020-STANDARD-COMMAREA       11160008
111700                                    RC818AI.                      11170008
111800*                                                                 11180000
111900     IF  DP030-RC-CALL-SUCCESSFUL                                 11190000
112000         CONTINUE                                                 11200000
112100     ELSE                                                         11210000
112200         SET DP013-NO-ROLLBACK                                    11220000
112300             DP013-XCTL-DISPLAY-RESTART                           11230000
112400             DP013-CICS-ABEND      TO TRUE                        11240000
112500         MOVE '0001-CALL-CICS-ARCH-API'                           11250000
112600                                   TO DP013-PARAGRAPH             11260000
112620         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN CODE O11262008
112630-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      11263008
112900         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      11290000
113000         PERFORM DP013-0000-PROCESS-ABEND                         11300000
113100     END-IF.                                                      11310000
113200*----------------------------------------------------------------*11320000
113300* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *11330000
113400* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *11340000
113500*                                                                *11350000
113600* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *11360000
113700*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *11370000
113800*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *11380000
113900*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *11390000
114000*----------------------------------------------------------------*11400000
114100                                                                  11410000
114200 1000-CONTROL-PROCESSING.                                         11420000
114300                                                                  11430000
114400     EVALUATE TRUE                                                11440000
114500         WHEN DP020-NEXT-ACT-INITIAL                              11450000
114600             INITIALIZE ASC-SPECIFIC-COMMAREA                     11460000
114700             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            11470000
114800                                      ASC-SEL-TERM-ID             11480000
114900                                      ASC-VRFY-ADJ-TERM-ID        11490000
115000             MOVE DP020-SRC-TASK-NUMBER                           11500000
115100                                   TO ASC-LIST-TASK-NUMBER        11510000
115200                                      ASC-SEL-TASK-NUMBER         11520000
115300                                      ASC-VRFY-ADJ-TASK-NUMBER    11530000
115400             MOVE PC-LIST-QUEUE-SEQ                               11540000
115500                                   TO ASC-LIST-SEQ                11550000
115600             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 11560000
115700             MOVE PC-VRFY-ADJ-QUEUE-SEQ                           11570000
115800                                   TO ASC-VRFY-ADJ-SEQ            11580000
115900             PERFORM 1100-PROCESS-INTER-APPL-COMM                 11590000
116000***-----$TEMPLATE NOTE$-------------------------------------------11600000
116100*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,11610000
116200*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  11620000
116300*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.11630000
116400***---------------------------------------------------------------11640000
116500             IF PS-NO-ERROR                                       11650000
116600                 MOVE INTER-APPL-COMM-AREA                        11660000
116700                                TO ASC-HOLD-INTER-APPL            11670000
116800                 PERFORM 4000-BUILD-INITIAL-PANEL                 11680000
116900*                PERFORM 3200-RESET-ATTRIBUTES                    11690000
117000             END-IF                                               11700000
117100                                                                  11710000
117200         WHEN DP020-NEXT-ACT-READ-MAP                             11720000
117300             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        11730000
117400                                   TO PV-TOP-ITEM                 11740000
117500             PERFORM 2000-PROCESS-PANEL                           11750000
117600                                                                  11760000
117700         WHEN DP020-NEXT-ACT-RETURN                               11770000
117800             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        11780000
117900                                   TO PV-TOP-ITEM                 11790000
118000             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    11800000
118100             MOVE ASC-HOLD-INTER-APPL                             11810000
118200                                   TO INTER-APPL-COMM-AREA        11820000
118300             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 11830000
118400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11840000
118500*            PERFORM 3000-EDIT-DATA-IN-COMMAREA                   11850000
118600                                                                  11860000
118700                                                                  11870000
118800         WHEN OTHER                                               11880000
118900             SET DP013-LOGIC-ABEND TO TRUE                        11890000
119000             SET DP013-NO-ROLLBACK TO TRUE                        11900000
119100             MOVE '1000-CONTROL-PROCESSING'                       11910000
119200                                   TO DP013-PARAGRAPH             11920000
119300             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    11930000
119400                                   TO DP013-MESSAGE-TEXT(1)       11940000
119500             PERFORM DP013-0000-PROCESS-ABEND                     11950000
119600     END-EVALUATE.                                                11960000
119700                                                                  11970000
119800 EJECT                                                            11980000
119900*----------------------------------------------------------------*11990000
120000* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *12000000
120100* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *12010000
120200*----------------------------------------------------------------*12020000
120300                                                                  12030000
120400 1100-PROCESS-INTER-APPL-COMM.                                    12040000
120500                                                                  12050000
120600     SET PS-COMMAREA-VALID         TO TRUE.                       12060000
120700     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     12070000
120800                                                                  12080000
120900                                                                  12090000
121000     IF  DP020-INT-APPL-FORMAT-IND = PC-INTER-APPL-LIST OR        12100000
121100         DP020-INT-APPL-FORMAT-IND = PC-POST-VERFY-INTER-LIST-FMT 12110000
121200         IF  DP020-INT-APPL-FORMAT-IND = PC-INTER-APPL-LIST       12120000
121300             SET ASC-NOT-POST-VERIFIED-RECEIPT  TO TRUE           12130000
121400         ELSE                                                     12140000
121500             SET ASC-POST-VERIFIED-RECEIPT      TO TRUE           12150000
121600         END-IF                                                   12160000
121700         SET ASC-USE-SELECTION-QUEUE     TO TRUE                  12170000
121800*        MOVE RC036-NUMBER-OF-SELECTED-ITEMS                      12180000
121900*                    TO ASC-NUMBER-OF-SELECTED-ITEMS              12190000
122000         MOVE RC036-NUMBER-OF-TS-ITEMS                            12200000
122100                     TO ASC-NUMBER-OF-TS-ITEMS                    12210000
122200         MOVE RC036-SEL-QUEUE-NAME                                12220000
122300                     TO ASC-SEL-QUEUE-NAME-IN                     12230000
122400         MOVE RC036-TRB-QUEUE-NAME                                12240000
122500                     TO ASC-TRB-QUEUE-NAME-IN                     12250000
122600         MOVE RC036-OPER-UNT-ID       TO DK-OPER-UNT-ID           12260000
122700         MOVE RC036-FCLTY-ID          TO DK-FCLTY-ID              12270000
122800         MOVE RC036-FCLTY-NME         TO ASC-FCLTY-NME            12280000
122900         MOVE RC036-PO-NBR            TO DK-PO-NBR                12290000
123000         MOVE RC036-REC-SEQ-NBR       TO DK-REC-SEQ-NBR           12300000
123100         MOVE RC036-PO-PACK-ID        TO DK-PREPK-ID              12310000
123200                                         ASC-PACK-ID              12320000
123300         PERFORM 1120-PREPARE-LIST-ENTRY                          12330000
123400     END-IF.                                                      12340000
123500 EJECT                                                            12350000
123600*----------------------------------------------------------------*12360000
123700*    ENTRY IS FROM A LIST.  GET THE KEY INFORMATION FROM THE     *12370000
123800*    TEMP STORAGE QUEUE PASSED FROM THE LIST.                    *12380000
123900*----------------------------------------------------------------*12390000
124000 1120-PREPARE-LIST-ENTRY.                                         12400000
124100                                                                  12410000
124200     MOVE RC037-MAX-ITEMS          TO ASC-SEL-SUB.                12420000
124300     MOVE ZERO                     TO ASC-SEL-ITEM.               12430000
124400     PERFORM 1200-GET-NEXT-RECORD.                                12440000
124500                                                                  12450000
124600*----------------------------------------------------------------*12460000
124700*    GET THE DATA (KEY) OF THE NEXT SELECTED OBJECT              *12470000
124800*    FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.                *12480000
124900*----------------------------------------------------------------*12490000
125000 1200-GET-NEXT-RECORD.                                            12500000
125100                                                                  12510000
125200     ADD +1                        TO ASC-SEL-SUB.                12520000
125300     IF  ASC-SEL-SUB > RC037-MAX-ITEMS                            12530000
125400         ADD +1                    TO ASC-SEL-ITEM                12540000
125500         MOVE +1                   TO ASC-SEL-SUB                 12550000
125600     END-IF.                                                      12560000
125700                                                                  12570000
125800     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                12580000
125900         PERFORM 9100-READ-SEL-QUEUE                              12590000
126000         IF  RC037-ITEM (ASC-SEL-SUB) > ZERO                      12600000
126100             MOVE RC037-OPER-UNT-ID (ASC-SEL-SUB)                 12610000
126200                                   TO ASC-OPER-UNT-ID             12620000
126300             MOVE RC037-FCLTY-ID (ASC-SEL-SUB)                    12630000
126400                                   TO ASC-FCLTY-ID                12640000
126500             MOVE RC037-PO-NBR (ASC-SEL-SUB)                      12650000
126600                                   TO ASC-PO-NBR                  12660000
126700             MOVE RC037-REC-SEQ-NBR (ASC-SEL-SUB)                 12670000
126800                                   TO ASC-REC-SEQ-NBR             12680000
126900             MOVE RC037-PACK-ID (ASC-SEL-SUB)                     12690000
127000                                   TO ASC-PACK-ID                 12700000
127100             SET RC037-INQ (ASC-SEL-SUB)                          12710000
127200                                   TO TRUE                        12720000
127300             PERFORM 9200-REWRITE-SEL-QUEUE                       12730000
127400         ELSE                                                     12740000
127500             SUBTRACT +1 FROM ASC-SEL-SUB                         12750000
127600*            --- BOTTOM OF LIST ---                               12760000
127700             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            12770000
127800             SET DP020-MSG-INFORMATIONAL                          12780000
127900                                   TO TRUE                        12790000
128000         END-IF                                                   12800000
128100     ELSE                                                         12810000
128200         SUBTRACT +1 FROM ASC-SEL-ITEM                            12820000
128300         MOVE RC037-MAX-ITEMS      TO ASC-SEL-SUB                 12830000
128400         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            12840000
128500         SET DP020-MSG-INFORMATIONAL                              12850000
128600                                   TO TRUE                        12860000
128700     END-IF.                                                      12870000
128800                                                                  12880000
128900/                                                                 12890000
129000*----------------------------------------------------------------*12900000
129100*    GET THE DATA (KEY) OF THE PREVIOUS SELECTED OBJECT          *12910000
129200*    FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.                *12920000
129300*----------------------------------------------------------------*12930000
129400 1300-GET-PREV-RECORD.                                            12940000
129500                                                                  12950000
129600     SUBTRACT +1 FROM ASC-SEL-SUB.                                12960000
129700     IF  ASC-SEL-SUB < +1                                         12970000
129800         SUBTRACT +1 FROM ASC-SEL-ITEM                            12980000
129900         MOVE RC037-MAX-ITEMS      TO ASC-SEL-SUB                 12990000
130000     END-IF.                                                      13000000
130100                                                                  13010000
130200     IF  ASC-SEL-ITEM > ZERO                                      13020000
130300         PERFORM 9100-READ-SEL-QUEUE                              13030000
130400             MOVE RC037-OPER-UNT-ID (ASC-SEL-SUB)                 13040000
130500                                   TO ASC-OPER-UNT-ID             13050000
130600             MOVE RC037-FCLTY-ID (ASC-SEL-SUB)                    13060000
130700                                   TO ASC-FCLTY-ID                13070000
130800             MOVE RC037-PO-NBR (ASC-SEL-SUB)                      13080000
130900                                   TO ASC-PO-NBR                  13090000
131000             MOVE RC037-REC-SEQ-NBR (ASC-SEL-SUB)                 13100000
131100                                   TO ASC-REC-SEQ-NBR             13110000
131200             MOVE RC037-PACK-ID (ASC-SEL-SUB)                     13120000
131300                                   TO ASC-PACK-ID                 13130000
131400     ELSE                                                         13140000
131500         MOVE +1                   TO ASC-SEL-ITEM                13150000
131600                                      ASC-SEL-SUB                 13160000
131700*        --- TOP OF LIST ---                                      13170000
131800         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            13180000
131900         SET DP020-MSG-INFORMATIONAL                              13190000
132000                                   TO TRUE                        13200000
132100     END-IF.                                                      13210000
132200                                                                  13220000
132300*----------------------------------------------------------------*13230000
132400* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *13240000
132500* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *13250000
132600* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *13260000
132700* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *13270000
132800* FUNCTION KEYS CAN GET THIS FAR.                                *13280000
132900*----------------------------------------------------------------*13290000
133000                                                                  13300000
133100 2000-PROCESS-PANEL.                                              13310000
133200     EVALUATE TRUE                                                13320000
133300         WHEN DP020-SRC-AID = DP016-CLEAR                         13330000
133400             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    13340000
133500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   13350000
133600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13360000
133700                                                                  13370000
133800         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    13380000
133900             PERFORM 2050-DELETE-LIST-QUEUE                       13390000
134000             PERFORM 4000-BUILD-INITIAL-PANEL                     13400000
134100                                                                  13410000
134200         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    13420000
134300             PERFORM 2140-DESELECT-ALL-ITEMS                      13430000
134400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13440000
134500                                                                  13450000
134600         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  13460000
134700             PERFORM 2150-SELECT-ALL-ITEMS                        13470000
134800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13480000
134900                                                                  13490000
135000                                                                  13500000
135100         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             13510000
135200              IF ASC-USE-SELECTION-QUEUE                          13520000
135300                 PERFORM 1200-GET-NEXT-RECORD                     13530000
135400                 MOVE ASC-OPER-UNT-ID     TO DK-OPER-UNT-ID       13540000
135500                 MOVE ASC-FCLTY-ID        TO DK-FCLTY-ID          13550000
135600                 MOVE ASC-PO-NBR          TO DK-PO-NBR            13560000
135700                 MOVE ASC-REC-SEQ-NBR TO DK-REC-SEQ-NBR           13570000
135800                 IF  PS-ERROR                                     13580000
135900                     SET RC037-ERR (ASC-SEL-SUB)                  13590000
136000                                              TO TRUE             13600000
136100                     PERFORM 9200-REWRITE-SEL-QUEUE               13610000
136200                 ELSE                                             13620000
136300                     PERFORM 2050-DELETE-LIST-QUEUE               13630000
136400                     PERFORM 4000-BUILD-INITIAL-PANEL             13640000
136500                     PERFORM 3200-RESET-ATTRIBUTES                13650000
136600                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         13660000
136700                 END-IF                                           13670000
136800              ELSE                                                13680000
136900*                --- BOTTOM OF LIST ---                           13690000
137000                 MOVE PC-TSYMSG-00070                             13700000
137100                                   TO DP020-MSG-NUMBER            13710000
137200                 SET DP020-MSG-INFORMATIONAL                      13720000
137300                                   TO TRUE                        13730000
137400              END-IF                                              13740000
137500                                                                  13750000
137600         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             13760000
137700              IF ASC-USE-SELECTION-QUEUE                          13770000
137800                 PERFORM 1300-GET-PREV-RECORD                     13780000
137900                 MOVE ASC-OPER-UNT-ID     TO DK-OPER-UNT-ID       13790000
138000                 MOVE ASC-FCLTY-ID        TO DK-FCLTY-ID          13800000
138100                 MOVE ASC-PO-NBR          TO DK-PO-NBR            13810000
138200                 MOVE ASC-REC-SEQ-NBR TO DK-REC-SEQ-NBR           13820000
138300                 IF  PS-ERROR                                     13830000
138400                     SET RC037-ERR (ASC-SEL-SUB)                  13840000
138500                                              TO TRUE             13850000
138600                     PERFORM 9200-REWRITE-SEL-QUEUE               13860000
138700                 ELSE                                             13870000
138800                     PERFORM 2050-DELETE-LIST-QUEUE               13880000
138900                     PERFORM 4000-BUILD-INITIAL-PANEL             13890000
139000                     PERFORM 3200-RESET-ATTRIBUTES                13900000
139100                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         13910000
139200                 END-IF                                           13920000
139300              ELSE                                                13930000
139400*                --- TOP OF LIST ---                              13940000
139500                 MOVE PC-TSYMSG-00069                             13950000
139600                                   TO DP020-MSG-NUMBER            13960000
139700                 SET DP020-MSG-INFORMATIONAL                      13970000
139800                                   TO TRUE                        13980000
139900              END-IF                                              13990000
140000                                                                  14000000
140100         WHEN OTHER                                               14010000
140200             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 14020000
140300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   14030000
140400             IF  PS-NO-ERROR                                      14040000
140500                 SET DP030-CONTINUE-GO                            14050000
140600                                 TO TRUE                          14060000
140700                 PERFORM 2100-CHECK-FUNCTION-KEY                  14070000
140800             ELSE                                                 14080000
140900                 SET DP030-OVERRIDE-GO                            14090000
141000                                 TO TRUE                          14100000
141100             END-IF                                               14110000
141200     END-EVALUATE.                                                14120000
141300 EJECT                                                            14130000
141400*----------------------------------------------------------------*14140000
141500*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *14150000
141600*----------------------------------------------------------------*14160000
141700 2050-DELETE-LIST-QUEUE.                                          14170000
141800                                                                  14180000
141900     EXEC CICS                                                    14190000
142000         DELETEQ TS                                               14200000
142100             QUEUE (ASC-LIST-QUEUE-NAME)                          14210000
142200             RESP  (PV-CICS-RESP)                                 14220000
142300     END-EXEC.                                                    14230000
142400                                                                  14240000
142500     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       14250000
142600        (PV-CICS-RESP = DFHRESP(QIDERR))                          14260000
142700         CONTINUE                                                 14270000
142800     ELSE                                                         14280000
142900         SET DP013-CICS-ABEND      TO TRUE                        14290000
143000         SET DP013-NO-ROLLBACK     TO TRUE                        14300000
143100                                                                  14310000
143200         MOVE '2050-DELETE-LIST-QUEUE'                            14320000
143300                                   TO DP013-PARAGRAPH             14330000
143400         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    14340000
143500                                   TO DP013-MESSAGE-TEXT (1)      14350000
143600         PERFORM DP013-0000-PROCESS-ABEND                         14360000
143700     END-IF.                                                      14370000
143800                                                                  14380000
143900     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  14390000
144000 EJECT                                                            14400000
144100*----------------------------------------------------------------*14410000
144200* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*14420000
144300* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *14430000
144400* CICS ARCHITECTURE API.                                         *14440000
144500*----------------------------------------------------------------*14450000
144600 2100-CHECK-FUNCTION-KEY.                                         14460000
144700     EVALUATE TRUE                                                14470000
144800****    PF14  GO TO RECEIVER PACK LIST                            14480000
144900         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              14490000
145000                                                                  14500000
145100             INITIALIZE RC800-INTER-APPL-COMMAREA                 14510000
145200             SET ASC-RETURNING-FROM-RCVG TO TRUE                  14520000
145300             MOVE 1              TO RC800-NUMBER-OF-SELECTED-ITEMS14530000
145400             MOVE ASC-PO-NBR     TO RC800-REC-NBR-N               14540000
145500             MOVE ASC-REC-SEQ-NBR                                 14550000
145600                                 TO RC800-REC-SEQ-NBR-N           14560000
145700             MOVE ASC-OPER-UNT-ID                                 14570000
145800                                 TO RC800-OPER-UNIT-ID            14580000
145900             MOVE ASC-FCLTY-ID   TO RC800-FACILITY-ID             14590000
146000             MOVE ASC-SEL-QUEUE-NAME-OUT TO RC800-SEL-QUEUE-NAME  14600000
146100             SET ASC-UPDATE-TSQ        TO  TRUE                   14610000
146200                                                                  14620000
146300             SET RC801-IDX             TO  1                      14630000
146400             MOVE 1                    TO RC800-NUMBER-OF-TS-ITEMS14640000
146500             INITIALIZE RC801-SELECTED-ITEM-ARRAY                 14650000
146600             MOVE ASC-PACK-ID      TO RC801-PACK-ID  (RC801-IDX)  14660000
146700                                                                  14670000
146800             PERFORM 5215-WRITE-SEL-QUEUE2                        14680000
146900                                                                  14690000
147000                                                                  14700000
147100****    PF15  UPDATE                                              14710000
147200         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              14720000
147300             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              14730000
147400                 IF ASC-RECEIV-STATUS-CDE = 'VE' AND              14740000
147500                    ASC-RECEIV-ML-POST-TMST                       14750000
147600                                  NOT = PC-DB2-DEFAULT-TMST AND   14760000
147700                    ASC-NOT-POST-VERIFIED-RECEIPT                 14770000
147800                     SET DP030-OVERRIDE-GO                        14780000
147900                                       TO TRUE                    14790000
148000                     MOVE PC-TSYMSG-03082                         14800000
148100                                       TO DP020-MSG-NUMBER        14810000
148200                     SET DP020-MSG-WARNING                        14820000
148300                                       TO TRUE                    14830000
148400                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         14840000
148500                 ELSE                                             14850000
148600                     IF PS-NO-AMOUNT-ENTERED                      14860000
148700                         SET DP030-OVERRIDE-GO                    14870000
148800                                           TO TRUE                14880000
148900                         MOVE PC-TSYMSG-01962                     14890000
149000                                           TO DP020-MSG-NUMBER    14900000
149100                         SET DP020-MSG-WARNING                    14910000
149200                                           TO TRUE                14920000
149300                     ELSE                                         14930000
149400                         IF ASC-STOP-VERIFY                       14940000
149500                            MOVE PC-TSYMSG-03233                  14950000
149600                                    TO  DP020-MSG-NUMBER          14960000
149700                            SET PS-ERROR                          14970000
149800                                DP030-OVERRIDE-GO                 14980000
149900                                DP020-MSG-WARNING TO TRUE         14990000
150000                            PERFORM 4400-MOVE-COMMAREA-TO-SCREEN  15000000
150100                         ELSE                                     15010000
150200                             INITIALIZE RC036-INTER-APPL-COMMAREA 15020000
150300                             MOVE ASC-NUMBER-OF-SELECTED-ITEMS    15030000
150400                                TO RC036-NUMBER-OF-SELECTED-ITEMS 15040000
150500                             PERFORM 5000-PREPARE-SEL-QUEUE       15050000
150600                         END-IF                                   15060000
150700                     END-IF                                       15070000
150800                 END-IF                                           15080000
150900             ELSE                                                 15090000
151000                 SET DP030-OVERRIDE-GO                            15100000
151100                                   TO TRUE                        15110000
151200                 MOVE -1           TO MR-SELECTL (PV-SUB)         15120000
151300                 MOVE PC-TSYMSG-00057                             15130000
151400                                   TO DP020-MSG-NUMBER            15140000
151500                 SET DP020-MSG-WARNING                            15150000
151600                                   TO TRUE                        15160000
151700             END-IF                                               15170000
151800                                                                  15180000
151900****    PF22  GO TO STORE DISTRIBUTION ADD                        15190000
152000         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              15200000
152100*            IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              15210000
152200*                SET DP030-OVERRIDE-GO                            15220000
152300*                                  TO TRUE                        15230000
152400*                MOVE PC-TSYMSG-00146                             15240000
152500*                                  TO DP020-MSG-NUMBER            15250000
152600*                SET DP020-MSG-WARNING                            15260000
152700*                                  TO TRUE                        15270000
152800*            ELSE                                                 15280000
152900             INITIALIZE RC015-INTER-APPL-COMMAREA                 15290000
153000             SET ASC-RETURNING-FROM-DIST TO TRUE                  15300000
153100             MOVE ASC-OPER-UNT-ID      TO RC015-OPER-UNT-ID       15310000
153200             MOVE ASC-FCLTY-ID         TO RC015-FCLTY-ID          15320000
153300             MOVE ASC-PO-NBR           TO RC015-PO-NBR            15330000
153400             MOVE ASC-REC-SEQ-NBR      TO RC015-REC-SEQ-NBR       15340000
153500             MOVE ASC-PO-LNE-NBR       TO RC015-PKSL-LNE-NBR      15350000
153600             MOVE ASC-PACK-ID          TO RC015-PO-PACK-ID        15360000
153700             MOVE ASC-PO-DRIVER-LNE    TO RC015-PO-LNE-NBR        15370000
153800*            END-IF                                               15380000
153900                                                                  15390000
154000****    PF23  GO TO STORE DISTRIBUTION ADD                        15400000
154100         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              15410000
154200             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              15420000
154300                 INITIALIZE RC036-INTER-APPL-COMMAREA             15430000
154400                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                15440000
154500                                TO RC036-NUMBER-OF-SELECTED-ITEMS 15450000
154600                 SET ASC-RETURNING-FROM-PACK-ITM TO TRUE          15460000
154700                 PERFORM 5000-PREPARE-SEL-QUEUE                   15470000
154800             ELSE                                                 15480000
154900                 SET DP030-OVERRIDE-GO                            15490000
155000                                   TO TRUE                        15500000
155100                 MOVE PC-TSYMSG-00057                             15510000
155200                                   TO DP020-MSG-NUMBER            15520000
155300                 MOVE -1           TO MR-SELECTL (PV-SUB)         15530000
155400                 SET DP020-MSG-WARNING                            15540000
155500                                   TO TRUE                        15550000
155600             END-IF                                               15560000
155700                                                                  15570000
155800****    PF24 SELECT ALL 0                                         15580000
155900         WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)              15590000
156000                                                                  15600000
156100**           IF  ASC-RECEIV-STATUS-CDE = 'VE'                     15610000
156200**               PERFORM 3200-RESET-ATTRIBUTES                    15620000
156300**               MOVE PC-TSYMSG-00045 TO DP020-MSG-NUMBER         15630000
156400**               SET DP020-MSG-FATAL  TO TRUE                     15640000
156500**           ELSE                                                 15650000
156600                 PERFORM 2150-SELECT-ALL-ITEMS                    15660000
156700                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             15670000
156800**           END-IF                                               15680000
156900                                                                  15690000
157000****    PF2  CONFIRM UPDATE                                       15700000
157100         WHEN  DP020-FK-CONFIRM(DP020-SRC-AID)                    15710000
157200             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              15720000
157300                 IF PS-NO-AMOUNT-ENTERED                          15730000
157400                     SET DP030-OVERRIDE-GO                        15740000
157500                                       TO TRUE                    15750000
157600                     MOVE PC-TSYMSG-01962                         15760000
157700                                       TO DP020-MSG-NUMBER        15770000
157800                     SET DP020-MSG-WARNING                        15780000
157900                                       TO TRUE                    15790000
158000                 ELSE                                             15800000
158100                     IF ASC-CONFIRMED                             15810000
158200                         SET ASC-DONT-CONFIRM-UPDATE TO TRUE      15820000
158300                         INITIALIZE RC036-INTER-APPL-COMMAREA     15830000
158400                         MOVE ASC-NUMBER-OF-SELECTED-ITEMS        15840000
158500                            TO RC036-NUMBER-OF-SELECTED-ITEMS     15850000
158600                         PERFORM 5000-PREPARE-SEL-QUEUE           15860000
158700                     ELSE                                         15870000
158800                         SET DP030-OVERRIDE-GO                    15880000
158900                             DP020-MSG-WARNING                    15890000
159000                             TO TRUE                              15900000
159100                         MOVE PC-TSYMSG-00045                     15910000
159200                             TO DP020-MSG-NUMBER                  15920000
159300                     END-IF                                       15930000
159400                 END-IF                                           15940000
159500             ELSE                                                 15950000
159600                 SET DP030-OVERRIDE-GO                            15960000
159700                                   TO TRUE                        15970000
159800                 MOVE PC-TSYMSG-00057                             15980000
159900                                   TO DP020-MSG-NUMBER            15990000
160000                 MOVE -1           TO MR-SELECTL (PV-SUB)         16000000
160100                 SET DP020-MSG-WARNING                            16010000
160200                                   TO TRUE                        16020000
160300             END-IF                                               16030000
160400                                                                  16040000
160500                                                                  16050000
160600                                                                  16060000
160700         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  16070000
160800             MOVE +1               TO PV-TOP-ITEM                 16080000
160900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 16090000
161000                                                                  16100000
161100         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   16110000
161200             PERFORM 2110-BROWSE-BACKWARD                         16120000
161300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 16130000
161400                                                                  16140000
161500         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   16150000
161600             PERFORM 2120-BROWSE-FORWARD                          16160000
161700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 16170000
161800                                                                  16180000
161900         WHEN DP020-SRC-AID = DP016-ENTER                         16190000
162000             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   16200000
162100             IF  PS-ERROR                                         16210000
162200                 CONTINUE                                         16220000
162300             ELSE                                                 16230000
162400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             16240000
162500             END-IF                                               16250000
162600                                                                  16260000
162700********   RESET SWITCHES AFTER UPDATE IS SUCCESSFUL (UNVERIFY)   16270000
162800********         IF  NOT PS-ERROR                                 16280000
162900********             MOVE PC-TSYMSG-00059                         16290000
163000********                           TO  DP020-MSG-NUMBER           16300000
163100********             SET DP020-MSG-INFORMATIONAL                  16310000
163200********                           TO  TRUE                       16320000
163300********             SET ASC-CANT-UNVERIFY                        16330000
163400********                 ASC-NOT-CONFIRM                          16340000
163500********                 ASC-NOT-CONFIRM-ZERO TO TRUE             16350000
163600********         END-IF                                           16360000
163700********                                                          16370000
163800         WHEN OTHER                                               16380000
163900             SET DP013-NO-ROLLBACK                                16390000
164000                 DP013-XCTL-DISPLAY-RESTART                       16400000
164100                 DP013-CICS-ABEND  TO TRUE                        16410000
164200             MOVE '2100-CHECK-FUNCTION-KEY'                       16420000
164300                                   TO DP013-PARAGRAPH             16430000
164400             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      16440000
164500                                   TO DP013-MESSAGE-TEXT (1)      16450000
164600             PERFORM DP013-0000-PROCESS-ABEND                     16460000
164700     END-EVALUATE.                                                16470000
164800*                                                                 16480000
164900*----------------------------------------------------------------*16490000
165000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *16500000
165100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *16510000
165200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *16520000
165300*    MESSAGE.                                                    *16530000
165400*----------------------------------------------------------------*16540000
165500                                                                  16550000
165600 2110-BROWSE-BACKWARD.                                            16560000
165700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    16570000
165800         GIVING PV-TOP-ITEM.                                      16580000
165900*                                                                 16590000
166000     IF  ((PV-TOP-ITEM < +1)                                      16600000
166100       OR (PV-TOP-ITEM = +1))                                     16610000
166200         MOVE +1                   TO PV-TOP-ITEM                 16620000
166300*        -- TOP OF LIST --                                        16630000
166400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            16640000
166500         SET DP020-MSG-INFORMATIONAL TO TRUE                      16650000
166600     END-IF.                                                      16660000
166700                                                                  16670000
166800 EJECT                                                            16680000
166900*----------------------------------------------------------------*16690000
167000*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *16700000
167100*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *16710000
167200*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *16720000
167300*----------------------------------------------------------------*16730000
167400                                                                  16740000
167500 2120-BROWSE-FORWARD.                                             16750000
167600                                                                  16760000
167700     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              16770000
167800         GIVING PV-TOP-ITEM.                                      16780000
167900     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   16790000
168000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            16800000
168100                                   TO PV-TOP-ITEM                 16810000
168200*        -- BOTTOM OF LIST --                                     16820000
168300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            16830000
168400         SET DP020-MSG-INFORMATIONAL                              16840000
168500                                   TO TRUE                        16850000
168600     ELSE                                                         16860000
168700         COMPUTE PV-BOTTOM-ITEM =                                 16870000
168800             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 16880000
168900         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            16890000
169000*            -- BOTTOM OF LIST --                                 16900000
169100             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            16910000
169200             SET DP020-MSG-INFORMATIONAL                          16920000
169300                                   TO TRUE                        16930000
169400         END-IF                                                   16940000
169500     END-IF.                                                      16950000
169600 EJECT                                                            16960000
169700*----------------------------------------------------------------*16970000
169800*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *16980000
169900*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *16990000
170000*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *17000000
170100*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *17010000
170200*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *17020000
170300*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *17030000
170400*----------------------------------------------------------------*17040000
170500                                                                  17050000
170600 2130-CHECK-FOR-JUMP-BROWSE.                                      17060000
170700     SET PS-NO-ERROR               TO TRUE.                       17070000
170800     IF (ASC-START-ITEM-REQUEST = SPACE)                          17080000
170900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            17090000
171000                                   TO PV-TOP-ITEM                 17100000
171100     ELSE                                                         17110000
171200         MOVE ASC-START-ITEM-REQUEST                              17120000
171300                                   TO DP010I-UNEDITED-FIELD       17130000
171400         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       17140000
171500         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     17150000
171600         SET DP010I-NEGATIVE-NOT-ALLOWED                          17160000
171700                                   TO TRUE                        17170000
171800         CALL DP010I-NUMERIC-EDIT-ROUTINE                         17180008
171810              USING DP010I-NUMERIC-EDIT-AREA                      17181008
171900                                                                  17190000
172000         IF  NOT DP010I-ERROR-DETECTED                            17200000
172100             MOVE DP010I-NUMERIC-FIELD                            17210000
172200                                   TO  ASC-START-ITEM-REQUEST-N   17220000
172300             IF  ASC-START-ITEM-REQUEST-N > ZERO                  17230000
172400                 IF  ASC-START-ITEM-REQUEST-N >                   17240000
172500                                          ASC-NUMBER-OF-ITEMS-READ17250000
172600                     MOVE SPACE TO ASC-START-ITEM-REQUEST         17260000
172700                     COMPUTE PV-TOP-ITEM =                        17270000
172800                             ASC-NUMBER-OF-ITEMS-READ             17280000
172900                             - PC-ITEMS-PER-PANEL + 1             17290000
173000                     IF  PV-TOP-ITEM < +1                         17300000
173100                         MOVE +1   TO PV-TOP-ITEM                 17310000
173200                         MOVE PC-TSYMSG-00070                     17320000
173300                                   TO DP020-MSG-NUMBER            17330000
173400                         SET DP020-MSG-INFORMATIONAL              17340000
173500                                   TO TRUE                        17350000
173600                     END-IF                                       17360000
173700                 ELSE                                             17370000
173800                     MOVE ASC-START-ITEM-REQUEST-N                17380000
173900                                   TO PV-TOP-ITEM                 17390000
174000                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      17400000
174100                     COMPUTE PV-BOTTOM-ITEM =                     17410000
174200                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     17420000
174300                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ17430000
174400*                        -- BOTTOM OF LIST --                     17440000
174500                         MOVE PC-TSYMSG-00070                     17450000
174600                                   TO DP020-MSG-NUMBER            17460000
174700                         SET DP020-MSG-INFORMATIONAL              17470000
174800                                   TO TRUE                        17480000
174900                     END-IF                                       17490000
175000                 END-IF                                           17500000
175100             ELSE                                                 17510000
175200*                --- VALUE OUT OF RANGE ----                      17520000
175300                 MOVE PC-TSYMSG-00101                             17530000
175400                                   TO DP020-MSG-NUMBER            17540000
175500                 MOVE -1           TO ASTRTITL                    17550000
175600                 SET DP030-SET-CURSOR-APPL-1                      17560000
175700                                   TO TRUE                        17570000
175800                 MOVE DP015-REVERSE                               17580000
175900                                   TO ASTRTITH                    17590000
176000                 MOVE DP015-RED    TO ASTRTITC                    17600000
176100                 MOVE DP015-UNP-NUM-BRT-MDT                       17610000
176200                                   TO ASTRTITA                    17620000
176300                 SET DP020-MSG-FATAL                              17630000
176400                                   TO TRUE                        17640000
176500                 SET PS-ERROR      TO TRUE                        17650000
176600             END-IF                                               17660000
176700                                                                  17670000
176800         ELSE                                                     17680000
176900             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            17690000
177000             MOVE -1               TO ASTRTITL                    17700000
177100             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  17710000
177200             MOVE DP015-REVERSE    TO ASTRTITH                    17720000
177300             MOVE DP015-RED        TO ASTRTITC                    17730000
177400             MOVE DP015-UNP-NUM-BRT-MDT                           17740000
177500                                   TO ASTRTITA                    17750000
177600             SET DP020-MSG-FATAL   TO TRUE                        17760000
177700             SET PS-ERROR          TO TRUE                        17770000
177800         END-IF                                                   17780000
177900     END-IF.                                                      17790000
178000 EJECT                                                            17800000
178100*----------------------------------------------------------------*17810000
178200*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *17820000
178300*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *17830000
178400*----------------------------------------------------------------*17840000
178500 2140-DESELECT-ALL-ITEMS.                                         17850000
178600     MOVE +1                       TO ASC-BLK-SUB.                17860000
178700                                                                  17870000
178800     PERFORM 2141-CLEAR-SELECTED-INDS                             17880000
178900         VARYING ASC-ITEM-SUB                                     17890000
179000         FROM 1 BY 1                                              17900000
179100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17910000
179200                                                                  17920000
179300     ADD +1                        TO ASC-BLK-SUB.                17930000
179400                                                                  17940000
179500     PERFORM 2141-CLEAR-SELECTED-INDS                             17950000
179600         VARYING ASC-ITEM-SUB                                     17960000
179700         FROM 1 BY 1                                              17970000
179800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17980000
179900                                                                  17990000
180000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               18000000
180100                                   TO PV-LIST-ITEM-NUMBER.        18010000
180200                                                                  18020000
180300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            18030000
180400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    18040000
180500                                                                  18050000
180600     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     18060000
180700        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      18070000
180800         MOVE +1                   TO ASC-BLK-SUB                 18080000
180900                                                                  18090000
181000         PERFORM 5100-WRITE-TEMP-STORAGE                          18100000
181100                                                                  18110000
181200         MOVE +1                   TO PV-BLOCK-NUMBER             18120000
181300                                                                  18130000
181400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         18140000
181500             PV-FIRST-BLOCK-IN-ARRAY - 1                          18150000
181600                                                                  18160000
181700         PERFORM                                                  18170000
181800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       18180000
181900                                                                  18190000
182000             PERFORM 4410-READ-TEMP-STORAGE                       18200000
182100                                                                  18210000
182200             PERFORM 2141-CLEAR-SELECTED-INDS                     18220000
182300                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 18230000
182400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18240000
182500                                                                  18250000
182600             PERFORM 5100-WRITE-TEMP-STORAGE                      18260000
182700                                                                  18270000
182800             ADD +1                TO PV-BLOCK-NUMBER             18280000
182900                                                                  18290000
183000         END-PERFORM                                              18300000
183100                                                                  18310000
183200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         18320000
183300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     18330000
183400                                                                  18340000
183500         PERFORM                                                  18350000
183600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       18360000
183700                   ASC-HIGHEST-BLOCK-WRITTEN                      18370000
183800                                                                  18380000
183900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          18390000
184000                                   TO PV-BLOCK-NUMBER             18400000
184100                                                                  18410000
184200             PERFORM 4410-READ-TEMP-STORAGE                       18420000
184300                                                                  18430000
184400             PERFORM 2141-CLEAR-SELECTED-INDS                     18440000
184500                 VARYING ASC-ITEM-SUB                             18450000
184600                 FROM 1 BY 1                                      18460000
184700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18470000
184800                                                                  18480000
184900             PERFORM 5100-WRITE-TEMP-STORAGE                      18490000
185000                                                                  18500000
185100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      18510000
185200                                                                  18520000
185300         END-PERFORM                                              18530000
185400                                                                  18540000
185500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             18550000
185600                                   TO PV-BLOCK-NUMBER             18560000
185700                                                                  18570000
185800         PERFORM 4410-READ-TEMP-STORAGE                           18580000
185900     END-IF.                                                      18590000
186000                                                                  18600000
186100                                                                  18610000
186200     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 18620000
186300     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.18630000
186400     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  18640000
186500                                                                  18650000
186600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        18660000
186700                                                                  18670000
186800 EJECT                                                            18680000
186900*----------------------------------------------------------------*18690000
187000*    MARK EACH ITEM AS BEING NOT SELECTED.                       *18700000
187100*----------------------------------------------------------------*18710000
187200                                                                  18720000
187300 2141-CLEAR-SELECTED-INDS.                                        18730000
187400                                                                  18740000
187500     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           18750000
187600             NOT EQUAL ZERO                                       18760000
187700         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          18770000
187800             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          18780000
187900                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    18790000
188000                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  18800000
188100                                   TO TRUE                        18810000
188200         END-IF                                                   18820000
188300     END-IF.                                                      18830000
188400                                                                  18840000
188500 EJECT                                                            18850000
188600*----------------------------------------------------------------*18860000
188700*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *18870000
188800*  FOR ALL ITEMS.                                                *18880000
188900*----------------------------------------------------------------*18890000
189000                                                                  18900000
189100 2150-SELECT-ALL-ITEMS.                                           18910000
189200                                                                  18920000
189300     MOVE +1                       TO ASC-BLK-SUB.                18930000
189400                                                                  18940000
189500     PERFORM 2151-SET-SELECTED-INDS                               18950000
189600         VARYING ASC-ITEM-SUB                                     18960000
189700         FROM 1 BY 1                                              18970000
189800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 18980000
189900                                                                  18990000
190000     ADD +1                        TO ASC-BLK-SUB.                19000000
190100                                                                  19010000
190200     PERFORM 2151-SET-SELECTED-INDS                               19020000
190300         VARYING ASC-ITEM-SUB                                     19030000
190400         FROM 1 BY 1                                              19040000
190500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19050000
190600                                                                  19060000
190700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               19070000
190800                                   TO PV-LIST-ITEM-NUMBER.        19080000
190900                                                                  19090000
191000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            19100000
191100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    19110000
191200                                                                  19120000
191300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     19130000
191400        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    19140000
191500         MOVE +1                   TO ASC-BLK-SUB                 19150000
191600                                                                  19160000
191700         PERFORM 5100-WRITE-TEMP-STORAGE                          19170000
191800                                                                  19180000
191900         MOVE +1                   TO PV-BLOCK-NUMBER             19190000
192000                                                                  19200000
192100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         19210000
192200             PV-FIRST-BLOCK-IN-ARRAY - 1                          19220000
192300                                                                  19230000
192400         PERFORM                                                  19240000
192500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       19250000
192600                                                                  19260000
192700             PERFORM 4410-READ-TEMP-STORAGE                       19270000
192800                                                                  19280000
192900             PERFORM 2151-SET-SELECTED-INDS                       19290000
193000                 VARYING ASC-ITEM-SUB                             19300000
193100                 FROM 1 BY 1                                      19310000
193200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19320000
193300                                                                  19330000
193400             PERFORM 5100-WRITE-TEMP-STORAGE                      19340000
193500                                                                  19350000
193600             ADD +1                TO PV-BLOCK-NUMBER             19360000
193700                                                                  19370000
193800         END-PERFORM                                              19380000
193900                                                                  19390000
194000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         19400000
194100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     19410000
194200                                                                  19420000
194300         PERFORM                                                  19430000
194400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       19440000
194500                   ASC-HIGHEST-BLOCK-WRITTEN                      19450000
194600                                                                  19460000
194700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          19470000
194800                                   TO PV-BLOCK-NUMBER             19480000
194900                                                                  19490000
195000             PERFORM 4410-READ-TEMP-STORAGE                       19500000
195100                                                                  19510000
195200             PERFORM 2151-SET-SELECTED-INDS                       19520000
195300                 VARYING ASC-ITEM-SUB                             19530000
195400                 FROM 1 BY 1                                      19540000
195500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19550000
195600                                                                  19560000
195700             PERFORM 5100-WRITE-TEMP-STORAGE                      19570000
195800                                                                  19580000
195900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      19590000
196000                                                                  19600000
196100         END-PERFORM                                              19610000
196200                                                                  19620000
196300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             19630000
196400                                   TO PV-BLOCK-NUMBER             19640000
196500                                                                  19650000
196600         PERFORM 4410-READ-TEMP-STORAGE                           19660000
196700     END-IF.                                                      19670000
196800                                                                  19680000
196900                                                                  19690000
197000     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             19700000
197100                       ASC-NUMBER-OF-SELECTED-ITEMS.              19710000
197200     SUBTRACT PV-NOT-SELECTED  FROM                               19720000
197300                       ASC-NUMBER-OF-SELECTED-ITEMS.              19730000
197400                                                                  19740000
197500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        19750000
197600                                                                  19760000
197700 EJECT                                                            19770000
197800*----------------------------------------------------------------*19780000
197900*    MARK EACH ITEM AS BEING SELECTED.                           *19790000
198000*----------------------------------------------------------------*19800000
198100                                                                  19810000
198200 2151-SET-SELECTED-INDS.                                          19820000
198300                                                                  19830000
198400     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           19840000
198500             NOT EQUAL ZERO                                       19850000
198600         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             19860000
198700             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             19870000
198800                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        19880000
198900                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  19890000
199000                               TO  TRUE                           19900000
199100         END-IF                                                   19910000
199200         IF   DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)              19920000
199300             IF  ASC-UPDATE-NO (ASC-BLK-SUB ASC-ITEM-SUB)         19930000
199400                 SET ASC-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)     19940000
199500                     ASC-TEMP-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB) 19950000
199600                     ASC-SEL-ZERO-NO (ASC-BLK-SUB ASC-ITEM-SUB)   19960000
199700                     ASC-BLOCK-MODIFIED (ASC-BLK-SUB)             19970000
199800                                 TO TRUE                          19980000
199900                  ADD  1  TO  PV-NOT-SELECTED                     19990000
200000             ELSE                                                 20000000
200100                 MOVE  ZEROES TO ASC-UPDATE-PACKS-N               20010000
200200                                 (ASC-BLK-SUB ASC-ITEM-SUB)       20020000
200300                 SET  ASC-SEL-ZERO-YES (ASC-BLK-SUB ASC-ITEM-SUB) 20030000
200400                              TO  TRUE                            20040000
200500             END-IF                                               20050000
200600         END-IF                                                   20060000
200700     END-IF.                                                      20070000
200800******************************************************************20080000
200900** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **20090000
201000** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **20100000
201100******************************************************************20110000
201200 2200-MOVE-SCREEN-TO-COMMAREA.                                    20120000
201300                                                                  20130000
201400     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             20140000
201500     MOVE +1                       TO PV-SUB.                     20150000
201600*                                                                 20160000
201700     PERFORM 3100-SET-SUBSCRIPTS.                                 20170000
201800     IF  ASTRTITL > ZERO                                          20180000
201900         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          20190000
202000     ELSE                                                         20200000
202100         IF  ASTRTITF = DP015-ERASE-EOF                           20210000
202200             INITIALIZE ASC-START-ITEM-REQUEST                    20220000
202300         END-IF                                                   20230000
202400     END-IF.                                                      20240000
202500     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          20250000
202600         VARYING PV-SUB                                           20260000
202700         FROM 1 BY 1                                              20270000
202800         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      20280000
202900******************************************************************20290000
203000** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**20300000
203100******************************************************************20310000
203200 2210-MOVE-LINES-TO-COMMAREA.                                     20320000
203300     IF  MR-SELECTL (PV-SUB) > ZERO                               20330000
203400         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             20340000
203500         MOVE MR-SELECTI (PV-SUB)                                 20350000
203600                                   TO ASC-TEMP-SELECTED-SW        20360000
203700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      20370000
203800     ELSE                                                         20380000
203900         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                20390000
204000                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     20400000
204100                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        20410000
204200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      20420000
204300         END-IF                                                   20430000
204400     END-IF.                                                      20440000
204500                                                                  20450000
204600     IF MR-UPDATE-PACKSL (PV-SUB) > ZERO                          20460000
204700         MOVE MR-UPDATE-PACKS (PV-SUB)                            20470000
204800                                 TO ASC-UPDATE-PACKS              20480000
204900                                   (ASC-BLK-SUB ASC-ITEM-SUB)     20490000
205000         IF MR-UPDATE-PACKS (PV-SUB) = 0                          20500000
205100             SET  ASC-SEL-ZERO-YES (ASC-BLK-SUB ASC-ITEM-SUB)     20510000
205200                          TO  TRUE                                20520000
205300         END-IF                                                   20530000
205400     ELSE                                                         20540000
205500         IF MR-UPDATE-PACKSA (PV-SUB) = DP015-ERASE-EOF           20550000
205600             MOVE SPACES         TO ASC-UPDATE-PACKS              20560000
205700                                   (ASC-BLK-SUB ASC-ITEM-SUB)     20570000
205800         END-IF                                                   20580000
205900     END-IF.                                                      20590000
206000                                                                  20600000
206100     ADD +1                        TO ASC-ITEM-SUB.               20610000
206200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        20620000
206300         ADD +1                    TO ASC-BLK-SUB                 20630000
206400         MOVE +1                   TO ASC-ITEM-SUB                20640000
206500     END-IF.                                                      20650000
206600******************************************************************20660000
206700** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **20670000
206800** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **20680000
206900******************************************************************20690000
207000 3000-EDIT-DATA-IN-COMMAREA.                                      20700000
207100     SET PS-NO-ERROR               TO TRUE.                       20710000
207200     IF ASC-AUTO-VE-YES                                           20720000
207300        CONTINUE                                                  20730000
207400     ELSE                                                         20740000
207500        PERFORM 3200-RESET-ATTRIBUTES                             20750000
207600     END-IF.                                                      20760000
207700     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     20770000
207800**                                                                20780000
207900* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              20790000
208000* EDITTING IS DONE FROM THE BOTTOM UP.                            20800000
208100**                                                                20810000
208200     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       20820000
208300         ASC-ITEMS-DISPLAYED - 1.                                 20830000
208400     PERFORM 3100-SET-SUBSCRIPTS.                                 20840000
208500     PERFORM 3300-EDIT-SELECTIONS                                 20850000
208600         VARYING PV-SUB                                           20860000
208700         FROM PV-SUB BY -1                                        20870000
208800         UNTIL PV-SUB < +1                                        20880000
208900*                                                                 20890000
209000     IF  PS-NO-ERROR                                              20900000
209100         PERFORM 3400-CHECK-RANGE-SEQUENCE                        20910000
209200     END-IF.                                                      20920000
209300*                                                                 20930000
209400     IF  ((PS-NO-ERROR)                                           20940000
209500       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   20950000
209600       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    20960000
209700             PERFORM 3500-MARK-RANGE-AS-SELECTED                  20970000
209800     END-IF.                                                      20980000
209900 EJECT                                                            20990000
210000*----------------------------------------------------------------*21000000
210100*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *21010000
210200*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*21020000
210300*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *21030000
210400*                                                                *21040000
210500*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *21050000
210600*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *21060000
210700*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *21070000
210800*    US IN THE 2ND BLOCK OF THE ARRAY.                           *21080000
210900*----------------------------------------------------------------*21090000
211000                                                                  21100000
211100 3100-SET-SUBSCRIPTS.                                             21110000
211200                                                                  21120000
211300     COMPUTE ASC-ITEM-SUB =                                       21130000
211400         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        21140000
211500                                                                  21150000
211600     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         21160000
211700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            21170000
211800                                                                  21180000
211900         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               21190000
212000     ELSE                                                         21200000
212100         MOVE +1                     TO ASC-BLK-SUB               21210000
212200     END-IF.                                                      21220000
212300******************************************************************21230000
212400** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **21240000
212500******************************************************************21250000
212600                                                                  21260000
212700 3200-RESET-ATTRIBUTES.                                           21270000
212800     SET PS-ALL-LINES-PROTECTED    TO TRUE.                       21280000
212900     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   21290000
213000     MOVE DP015-GREEN              TO ASTRTITC.                   21300000
213100     MOVE DP015-UNDERLINE          TO ASTRTITH.                   21310000
213200*                                                                 21320000
213300     PERFORM                                                      21330000
213400         VARYING PV-SUB                                           21340000
213500         FROM 1 BY 1                                              21350000
213600         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        21360000
213700         MOVE DP015-UNP-ALP-NOR-OFF                               21370000
213800                                   TO MR-SELECTA (PV-SUB)         21380000
213900                                      MR-UPDATE-PACKSA (PV-SUB)   21390000
214000         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         21400000
214100                                      MR-UPDATE-PACKSC (PV-SUB)   21410000
214200         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         21420000
214300                                      MR-UPDATE-PACKSH (PV-SUB)   21430000
214400     END-PERFORM.                                                 21440000
214500     IF ASC-RECEIV-STATUS-CDE = 'VE' AND                          21450000
214600        ASC-RECEIV-ML-POST-TMST NOT = PC-DB2-DEFAULT-TMST AND     21460000
214700        ASC-NOT-POST-VERIFIED-RECEIPT                             21470000
214800         PERFORM                                                  21480000
214900             VARYING PV-SUB                                       21490000
215000             FROM 1 BY 1                                          21500000
215100             UNTIL PV-SUB > PC-ITEMS-PER-PANEL                    21510000
215200             MOVE DP015-ASK-DRK-OFF                               21520000
215300                                   TO MR-UPDATE-PACKSA (PV-SUB)   21530000
215400             MOVE DP015-HL-OFF     TO MR-UPDATE-PACKSH (PV-SUB)   21540000
215500         END-PERFORM                                              21550000
215600     END-IF.                                                      21560000
215700******************************************************************21570000
215800** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **21580000
215900** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **21590000
216000** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **21600000
216100** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **21610000
216200******************************************************************21620000
216300 3300-EDIT-SELECTIONS.                                            21630000
216400     EVALUATE TRUE                                                21640000
216500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     21650000
216600             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         21660000
216700              IF ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)       21670000
216800                 NOT = SPACES                                     21680000
216900                 IF DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)         21690000
217000                     IF ASC-CANNOT-UPDATE                         21700000
217100                                   (ASC-BLK-SUB ASC-ITEM-SUB)     21710000
217200                        SET ASC-STOP-VERIFY   TO TRUE             21720000
217300                     END-IF                                       21730000
217400                 END-IF                                           21740000
217500                 IF (DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID) OR     21750000
217600                    DP020-FK-LOCAL-FUNC-05(DP020-SRC-AID)) AND    21760000
217700                      ASC-AUTO-VE-YES                             21770000
217800                        SET PS-ERROR           TO TRUE            21780000
217900                        MOVE PC-TSYMSG-03180                      21790000
218000                                TO DP020-MSG-NUMBER               21800000
218100                        SET PS-ERROR                              21810000
218200                            DP020-MSG-FATAL                       21820000
218300                            DP030-SET-CURSOR-APPL-1               21830000
218400                                            TO TRUE               21840000
218500                        MOVE -1            TO MR-SELECTL (PV-SUB) 21850000
218600                        MOVE DP015-RED     TO MR-SELECTC (PV-SUB) 21860000
218700                        MOVE DP015-REVERSE TO MR-SELECTH (PV-SUB) 21870000
218800                 END-IF                                           21880000
218900              END-IF                                              21890000
219000         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         21900000
219100             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        21910000
219200                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   21920000
219300                 MOVE ASC-TEMP-SELECTED-SW                        21930000
219400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  21940000
219500                                TO ASC-SELECTED-SW                21950000
219600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  21960000
219700                 IF DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)         21970000
219800                     IF ASC-CANNOT-UPDATE                         21980000
219900                                   (ASC-BLK-SUB ASC-ITEM-SUB)     21990000
220000                        SET ASC-STOP-VERIFY   TO TRUE             22000000
220100                     END-IF                                       22010000
220200                 END-IF                                           22020000
220300                 IF (DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID) OR     22030000
220400                    DP020-FK-LOCAL-FUNC-05(DP020-SRC-AID)) AND    22040000
220500                       ASC-AUTO-VE-YES                            22050000
220600                        SET PS-ERROR           TO TRUE            22060000
220700                        MOVE PC-TSYMSG-03180                      22070000
220800                                TO DP020-MSG-NUMBER               22080000
220900                        SET PS-ERROR                              22090000
221000                            DP020-MSG-FATAL                       22100000
221100                            DP030-SET-CURSOR-APPL-1               22110000
221200                                            TO TRUE               22120000
221300                        MOVE -1            TO MR-SELECTL (PV-SUB) 22130000
221400                        MOVE DP015-RED     TO MR-SELECTC (PV-SUB) 22140000
221500                        MOVE DP015-REVERSE TO MR-SELECTH (PV-SUB) 22150000
221600                 END-IF                                           22160000
221700             END-IF                                               22170000
221800         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     22180000
221900                 = SPACE                                          22190000
222000             EVALUATE TRUE                                        22200000
222100                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       22210000
222200                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS22220000
222300                     MOVE SPACE TO ASC-SELECTED-SW                22230000
222400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22240000
222500                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        22250000
222600                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    22260000
222700                     MOVE SPACE TO ASC-SELECTED-SW                22270000
222800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22280000
222900                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          22290000
223000                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      22300000
223100                     MOVE SPACE TO ASC-SELECTED-SW                22310000
223200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22320000
223300             END-EVALUATE                                         22330000
223400         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           22340000
223500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            22350000
223600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    22360000
223700             END-IF                                               22370000
223800              IF DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)            22380000
223900                  IF ASC-CANNOT-UPDATE                            22390000
224000                                (ASC-BLK-SUB ASC-ITEM-SUB)        22400000
224100                     SET ASC-STOP-VERIFY   TO TRUE                22410000
224200                  END-IF                                          22420000
224300              END-IF                                              22430000
224400             PERFORM 3310-EDIT-RANGE                              22440000
224500         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             22450000
224600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            22460000
224700                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    22470000
224800             END-IF                                               22480000
224900             IF DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)             22490000
225000                 IF ASC-CANNOT-UPDATE                             22500000
225100                               (ASC-BLK-SUB ASC-ITEM-SUB)         22510000
225200                    SET ASC-STOP-VERIFY   TO TRUE                 22520000
225300                 END-IF                                           22530000
225400             END-IF                                               22540000
225500             PERFORM 3310-EDIT-RANGE                              22550000
225600         WHEN OTHER                                               22560000
225700             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           22570000
225800             SET DP020-MSG-FATAL    TO TRUE                       22580000
225900             MOVE -1                TO MR-SELECTL (PV-SUB)        22590000
226000             SET DP030-SET-CURSOR-APPL-1                          22600000
226100                                    TO TRUE                       22610000
226200             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        22620000
226300             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        22630000
226400             SET PS-ERROR TO TRUE                                 22640000
226500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            22650000
226600                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     22660000
226700                 MOVE SPACE         TO ASC-SELECTED-SW            22670000
226800                                        (ASC-BLK-SUB ASC-ITEM-SUB)22680000
226900             END-IF                                               22690000
227000     END-EVALUATE.                                                22700000
227100                                                                  22710000
227200                                                                  22720000
227300     IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                     22730000
227400        OR ASC-RANGE-ON                                           22740000
227500        OR ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                   22750000
227600         IF ASC-UPDATE-PACKS (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES  22760000
227700             MOVE ASC-UPDATE-PACKS (ASC-BLK-SUB ASC-ITEM-SUB)     22770000
227800                                 TO DP010I-UNEDITED-FIELD         22780000
227900             MOVE LENGTH OF ASC-UPDATE-PACKS                      22790000
228000                                   (ASC-BLK-SUB ASC-ITEM-SUB)     22800000
228100                                 TO DP010I-MAXIMUM-DIGITS         22810000
228200             MOVE ZERO           TO DP010I-MAXIMUM-DECIMALS       22820000
228300             SET DP010I-NEGATIVE-NOT-ALLOWED                      22830000
228400                                 TO TRUE                          22840000
228500             CALL DP010I-NUMERIC-EDIT-ROUTINE                     22850008
228510                  USING DP010I-NUMERIC-EDIT-AREA                  22851008
228600                                                                  22860000
228700             IF  DP010I-ERROR-DETECTED                            22870000
228800                 SET PS-ERROR                                     22880000
228900                     DP020-MSG-FATAL                              22890000
229000                     DP030-SET-CURSOR-APPL-1                      22900000
229100                                 TO TRUE                          22910000
229200                 MOVE PC-TSYMSG-00005                             22920000
229300                                 TO DP020-MSG-NUMBER              22930000
229400                 MOVE DP015-UNP-NUM-BRT-OFF                       22940000
229500                                 TO MR-UPDATE-PACKSA (PV-SUB)     22950000
229600                 MOVE -1         TO MR-UPDATE-PACKSL (PV-SUB)     22960000
229700                 MOVE DP015-RED  TO MR-UPDATE-PACKSC (PV-SUB)     22970000
229800                 MOVE DP015-REVERSE                               22980000
229900                                 TO MR-UPDATE-PACKSH (PV-SUB)     22990000
230000                 SET DP030-SET-CURSOR-APPL-1                      23000000
230100                                 TO TRUE                          23010000
230200                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     23020000
230300             ELSE                                                 23030000
230400                 MOVE DP010I-NUMERIC-FIELD                        23040000
230500                                 TO ASC-UPDATE-PACKS-N            23050000
230600                                    (ASC-BLK-SUB ASC-ITEM-SUB)    23060000
230700                 MOVE ASC-UPDATE-PACKS (ASC-BLK-SUB ASC-ITEM-SUB) 23070000
230800                                 TO MR-UPDATE-PACKS (PV-SUB)      23080000
230900                 SET PS-AMOUNT-ENTERED  TO TRUE                   23090000
231000             END-IF                                               23100000
231100         END-IF                                                   23110000
231200     END-IF.                                                      23120000
231300                                                                  23130000
231400     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 23140000
231500     SUBTRACT +1 FROM ASC-ITEM-SUB.                               23150000
231600     IF  ASC-ITEM-SUB < 1                                         23160000
231700         SUBTRACT +1 FROM ASC-BLK-SUB                             23170000
231800         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                23180000
231900     END-IF.                                                      23190000
232000******************************************************************23200000
232100** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **23210000
232200** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **23220000
232300** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**23230000
232400** THE ENDING.                                                  **23240000
232500******************************************************************23250000
232600 3310-EDIT-RANGE.                                                 23260000
232700     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                23270000
232800         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   23280000
232900             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)23290000
233000                                   TO ASC-SELECTED-SW             23300000
233100                                        (ASC-BLK-SUB ASC-ITEM-SUB)23310000
233200             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 23320000
233300         ELSE                                                     23330000
233400             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     23340000
233500                 CONTINUE                                         23350000
233600             ELSE                                                 23360000
233700*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        23370000
233800                 MOVE PC-TSYMSG-00054                             23380000
233900                                   TO DP020-MSG-NUMBER            23390000
234000                 SET DP020-MSG-FATAL                              23400000
234100                                   TO TRUE                        23410000
234200                 MOVE -1           TO MR-SELECTL (PV-SUB)         23420000
234300                 SET DP030-SET-CURSOR-APPL-1                      23430000
234400                                   TO TRUE                        23440000
234500                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         23450000
234600                 MOVE DP015-UNDERLINE                             23460000
234700                                   TO MR-SELECTH (PV-SUB)         23470000
234800                 SET PS-ERROR      TO TRUE                        23480000
234900             END-IF                                               23490000
235000         END-IF                                                   23500000
235100     ELSE                                                         23510000
235200         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     23520000
235300             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 23530000
235400                                   TO ASC-SELECTED-SW             23540000
235500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   23550000
235600             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   23560000
235700         ELSE                                                     23570000
235800             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       23580000
235900                 CONTINUE                                         23590000
236000             ELSE                                                 23600000
236100*                -- ONLY ONE END-OF-RANGE ALLOWED --              23610000
236200                 MOVE PC-TSYMSG-00055                             23620000
236300                                   TO DP020-MSG-NUMBER            23630000
236400                 SET DP020-MSG-FATAL                              23640000
236500                                   TO TRUE                        23650000
236600                 MOVE -1           TO MR-SELECTL (PV-SUB)         23660000
236700                 SET DP030-SET-CURSOR-APPL-1                      23670000
236800                                   TO TRUE                        23680000
236900                 SET PS-ERROR      TO TRUE                        23690000
237000             END-IF                                               23700000
237100         END-IF                                                   23710000
237200     END-IF.                                                      23720000
237300*                                                                 23730000
237400******************************************************************23740000
237500** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **23750000
237600** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **23760000
237700******************************************************************23770000
237800 3400-CHECK-RANGE-SEQUENCE.                                       23780000
237900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       23790000
238000       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      23800000
238100       AND  ASC-START-OF-SELECTED-RANGE >                         23810000
238200                                         ASC-END-OF-SELECTED-RANGE23820000
238300*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                23830000
238400         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 23840000
238500         SET DP020-MSG-FATAL TO TRUE                              23850000
238600         SET PS-ERROR TO TRUE                                     23860000
238700         PERFORM 3410-POSITION-AT-ERROR                           23870000
238800     END-IF.                                                      23880000
238900******************************************************************23890000
239000** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **23900000
239100** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **23910000
239200** SHOULD BE POSITIONED ON A RANGE ERROR.                       **23920000
239300******************************************************************23930000
239400 3410-POSITION-AT-ERROR.                                          23940000
239500     SET DP030-SET-CURSOR-APPL-1                                  23950000
239600                                   TO TRUE.                       23960000
239700     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 23970000
239800                    - PV-TOP-ITEM + 1.                            23980000
239900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23990000
240000         CONTINUE                                                 24000000
240100     ELSE                                                         24010000
240200         MOVE -1                   TO MR-SELECTL (PV-SUB)         24020000
240300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24030000
240400         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         24040000
240500     END-IF.                                                      24050000
240600*                                                                 24060000
240700     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   24070000
240800                    - PV-TOP-ITEM + 1.                            24080000
240900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24090000
241000         CONTINUE                                                 24100000
241100     ELSE                                                         24110000
241200         MOVE -1                   TO MR-SELECTL (PV-SUB)         24120000
241300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24130000
241400         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         24140000
241500     END-IF.                                                      24150000
241600 EJECT                                                            24160000
241700*----------------------------------------------------------------*24170000
241800*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *24180000
241900*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *24190000
242000*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *24200000
242100*----------------------------------------------------------------*24210000
242200                                                                  24220000
242300 3500-MARK-RANGE-AS-SELECTED.                                     24230000
242400     MOVE +1                       TO  ASC-BLK-SUB.               24240000
242500     PERFORM 3510-MARK-SELECTED-INDS                              24250000
242600         VARYING ASC-ITEM-SUB                                     24260000
242700         FROM 1 BY 1                                              24270000
242800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 24280000
242900                                                                  24290000
243000     ADD +1                        TO ASC-BLK-SUB.                24300000
243100     PERFORM 3510-MARK-SELECTED-INDS                              24310000
243200         VARYING ASC-ITEM-SUB                                     24320000
243300         FROM 1 BY 1                                              24330000
243400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 24340000
243500                                                                  24350000
243600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               24360000
243700                                   TO  PV-LIST-ITEM-NUMBER.       24370000
243800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            24380000
243900         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         24390000
244000               PC-ITEMS-PER-PANEL).                               24400000
244100                                                                  24410000
244200     MOVE ASC-START-OF-SELECTED-RANGE                             24420000
244300                                   TO PV-START-OF-SELECTED-RANGE. 24430000
244400     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            24440000
244500         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  24450000
244600               PC-ITEMS-PER-PANEL).                               24460000
244700                                                                  24470000
244800     MOVE ASC-END-OF-SELECTED-RANGE                               24480000
244900                                   TO  PV-END-OF-SELECTED-RANGE.  24490000
245000     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             24500000
245100         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    24510000
245200               PC-ITEMS-PER-PANEL).                               24520000
245300     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             24530000
245400         PV-FIRST-BLOCK-IN-ARRAY + 1.                             24540000
245500                                                                  24550000
245600     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    24560000
245700        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        24570000
245800         MOVE +1                   TO ASC-BLK-SUB                 24580000
245900         PERFORM 5100-WRITE-TEMP-STORAGE                          24590000
246000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         24600000
246100             PV-FIRST-BLOCK-IN-ARRAY - 1                          24610000
246200                                                                  24620000
246300         PERFORM                                                  24630000
246400             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      24640000
246500                   PV-PREV-BLOCK-IN-ARRAY                         24650000
246600             MOVE PV-FIRST-BLOCK-IN-RANGE                         24660000
246700                                   TO PV-BLOCK-NUMBER             24670000
246800             PERFORM 4410-READ-TEMP-STORAGE                       24680000
246900             PERFORM 3510-MARK-SELECTED-INDS                      24690000
247000                 VARYING ASC-ITEM-SUB                             24700000
247100                 FROM 1 BY 1                                      24710000
247200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          24720000
247300             PERFORM 5100-WRITE-TEMP-STORAGE                      24730000
247400             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     24740000
247500         END-PERFORM                                              24750000
247600                                                                  24760000
247700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         24770000
247800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     24780000
247900         PERFORM                                                  24790000
248000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       24800000
248100                   PV-LAST-BLOCK-IN-RANGE                         24810000
248200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          24820000
248300                                   TO PV-BLOCK-NUMBER             24830000
248400             PERFORM 4410-READ-TEMP-STORAGE                       24840000
248500             PERFORM 3510-MARK-SELECTED-INDS                      24850000
248600                 VARYING ASC-ITEM-SUB                             24860000
248700                 FROM 1 BY 1                                      24870000
248800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          24880000
248900             PERFORM 5100-WRITE-TEMP-STORAGE                      24890000
249000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      24900000
249100         END-PERFORM                                              24910000
249200                                                                  24920000
249300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             24930000
249400                                   TO PV-BLOCK-NUMBER             24940000
249500         PERFORM 4410-READ-TEMP-STORAGE                           24950000
249600     END-IF.                                                      24960000
249700                                                                  24970000
249800     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 24980000
249900                                      ASC-END-OF-SELECTED-RANGE.  24990000
250000                                                                  25000000
250100 EJECT                                                            25010000
250200*----------------------------------------------------------------*25020000
250300* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *25030000
250400*----------------------------------------------------------------*25040000
250500                                                                  25050000
250600 3510-MARK-SELECTED-INDS.                                         25060000
250700                                                                  25070000
250800     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         25080000
250900                                ASC-ITEM-SUB) >                   25090000
251000         ASC-START-OF-SELECTED-RANGE)                             25100000
251100     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         25110000
251200                                ASC-ITEM-SUB) =                   25120000
251300         ASC-START-OF-SELECTED-RANGE)                             25130000
251400                                                                  25140000
251500         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     25150000
251600                                    ASC-ITEM-SUB) <               25160000
251700             ASC-END-OF-SELECTED-RANGE)                           25170000
251800         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     25180000
251900                                    ASC-ITEM-SUB) =               25190000
252000             ASC-END-OF-SELECTED-RANGE)                           25200000
252100                                                                  25210000
252200             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          25220000
252300                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   25230000
252400                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   25240000
252500                               TO TRUE                            25250000
252600                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              25260000
252700                               TO TRUE                            25270000
252800                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    25280000
252900             END-IF                                               25290000
253000         END-IF                                                   25300000
253100     END-IF.                                                      25310000
253200                                                                  25320000
253300 EJECT                                                            25330000
253400*----------------------------------------------------------------*25340000
253500*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *25350000
253600*    INITIALIZE ALL COUNTERS AND FLAGS.                          *25360000
253700*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *25370000
253800*    DISPLAY THE PANEL TO USER.                                  *25380000
253900*----------------------------------------------------------------*25390000
254000                                                                  25400000
254100 4000-BUILD-INITIAL-PANEL.                                        25410000
254200                                                                  25420000
254300     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            25430000
254400                                 ASC-BLOCK-ENTRIES (2).           25440000
254500     MOVE +1                 TO ASC-BLK-SUB.                      25450000
254600     SET ASC-ITEMS-LEFT-ON-DB                                     25460000
254700         ASC-CAN-VERIFY                                           25470000
254800         ASC-CAN-UNVERIFY    TO TRUE.                             25480000
254900                                                                  25490000
255000     MOVE +0                 TO ASC-ITEM-SUB                      25500000
255100                                ASC-NUMBER-OF-ITEMS-READ          25510000
255200                                ASC-NUMBER-OF-SELECTED-ITEMS      25520000
255300                                ASC-HIGHEST-BLOCK-WRITTEN         25530000
255400                                ASC-START-OF-SELECTED-RANGE       25540000
255500                                ASC-END-OF-SELECTED-RANGE         25550000
255600                                ASC-ITEM-AT-TOP-OF-PANEL          25560000
255700                                ASC-TOT-PKSLIP-PACKS              25570000
255800                                ASC-TOT-ACTUAL-PACKS              25580000
255900                                ASC-TOT-VERFYD-PACKS              25590000
256000                                ASC-TOT-ODD-UNITS.                25600000
256100     PERFORM 4100-PREPARE-CURSOR.                                 25610000
256200                                                                  25620000
256300     PERFORM 5300-GET-TRECEIV-STATUS.                             25630000
256400                                                                  25640000
256500     PERFORM 4150-CALL-AUTOVE-MODULE.                             25650000
256600     IF RC040-AUTO-VE-YES                                         25660000
256601*                                                                 25660101
256610* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 25661001
256620* ISSUE AT EFC'S OVER VERIFYING WMOS-IF EFC ORDER ALLOW SELECT  * 25662001
256630* ASSOCIATES TO CREATE POST VERIFICATION ADJUSTMENTS            * 25663001
256640* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 25664001
256650* DMH - 11-26-14 - BEGIN                                          25665001
256651*                                                                 25665101
256660             PERFORM 4500-RACF-OVERRIDE                           25666001
256670             SET  PS-HAS-WORK-ORDER-INST-NO TO TRUE               25667001
256680             IF  PS-RACF-OVERRIDE-YES                             25668001
256690                 PERFORM 4505-CHECK-EFC-CURR-OPER                 25669004
256691             END-IF                                               25669101
256692             IF  PS-RACF-OVERRIDE-YES  AND                        25669201
256693                 PS-CURR-OPER-EFC-YES                             25669301
256694                 IF  PS-HAS-WORK-ORDER-INST                       25669401
256695                     CONTINUE                                     25669501
256696                     SET ASC-AUTO-VE-NO  TO TRUE                  25669601
256697                 ELSE                                             25669701
256698                     SET ASC-AUTO-VE-YES TO TRUE                  25669801
256700                 END-IF                                           25670001
256701             ELSE                                                 25670101
256702                 SET ASC-AUTO-VE-YES     TO TRUE                  25670204
256703             END-IF                                               25670304
256720* DMH - 11-26-14 - END                                            25672001
256730*                                                                 25673001
256800     ELSE                                                         25680000
256900        SET ASC-AUTO-VE-NO         TO TRUE                        25690000
257000     END-IF.                                                      25700000
257100                                                                  25710000
257200     MOVE 0                        TO ASC-HDR-TOT-ACT-UNTS        25720000
257300                                      ASC-HDR-TOT-VERFYD-UNTS.    25730000
257400                                                                  25740000
257500     PERFORM 4010-OPEN-CURSOR.                                    25750000
257600                                                                  25760000
257700     PERFORM 4300-READ-ITEMS-FROM-DB.                             25770000
257800                                                                  25780000
257900     PERFORM 4020-CLOSE-CURSOR.                                   25790000
258000                                                                  25800000
258100     PERFORM 7055-GET-TDISTHD.                                    25810000
258200**   PERFORM 4320-SUM-TRECDIS.                                    25820000
258300**   MOVE RECDIS-VERIFY-ITM-QTY    TO ASC-HDR-TOT-ACT-UNTS.       25830000
258400**   MOVE RECDIS-AP-VERIFY-ITM-QTY TO ASC-HDR-TOT-VERFYD-UNTS.    25840000
258500                                                                  25850000
258600     IF RECITM-STATUS-CDE = 'VE'                                  25860000
258700        MOVE '  ACTUAL'  TO ASC-SOURCE-TYPE                       25870000
258800     ELSE                                                         25880000
258900        MOVE 'EXPECTED'  TO ASC-SOURCE-TYPE                       25890000
259000     END-IF.                                                      25900000
259100                                                                  25910000
259200     MOVE +1                   TO  PV-TOP-ITEM.                   25920000
259300     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          25930000
259400         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    25940000
259500         SET DP020-MSG-FATAL   TO  TRUE                           25950000
259600         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               25960000
259700     ELSE                                                         25970000
259800         MOVE -1               TO MR-SELECTL (1)                  25980000
259900         SET DP030-SET-CURSOR-APPL-1                              25990000
260000                               TO TRUE                            26000000
260100         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     26010000
260200     END-IF.                                                      26020000
260300 EJECT                                                            26030000
260400                                                                  26040000
260401                                                                  26040101
260500 4010-OPEN-CURSOR.                                                26050000
260600     PERFORM                                                      26060000
260700         WITH TEST AFTER                                          26070000
260800         VARYING PV-RETRY-COUNTER                                 26080000
260900         FROM 1 BY 1                                              26090000
261000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               26100000
261100                   OR (SQLCODE = ZERO))                           26110000
261200                                                                  26120000
261300             EXEC SQL                                             26130000
261400                  OPEN PACK-SLIP-CSR                              26140000
261500             END-EXEC                                             26150000
261600                                                                  26160000
261700         EVALUATE TRUE                                            26170000
261800             WHEN SQLCODE = ZERO                                  26180000
261900             WHEN SQLCODE = -904                                  26190000
262000             WHEN SQLCODE = -913                                  26200000
262100                 CONTINUE                                         26210000
262200             WHEN SQLWARN0 NOT = SPACES                           26220000
262300             WHEN SQLCODE < ZERO                                  26230000
262400             WHEN SQLCODE > ZERO                                  26240000
262500                 MOVE '4010-OPEN-CURSOR'                          26250000
262600                                   TO DP013-PARAGRAPH             26260000
262700                 MOVE 'OPEN PACK SLIP CURSOR - '                  26270000
262800                                   TO DP013-MESSAGE-TEXT (1)      26280000
262900                 MOVE DK-PO-NBR        TO PV-DISP-PO-NBR          26290000
263000                 MOVE DK-OPER-UNT-ID   TO PV-DISP-OPER-UNT-ID     26300000
263100                 MOVE DK-FCLTY-ID      TO PV-DISP-FCLTY-ID        26310000
263200                 MOVE DK-REC-SEQ-NBR   TO PV-DISP-REC-SEQ-NBR     26320000
263300                 MOVE DK-PREPK-ID      TO PV-DISP-PREPK-ID        26330000
263400                 STRING ' PO = '                                  26340000
263500                        PV-DISP-PO-NBR                            26350000
263600                        ' RECV ='                                 26360000
263700                        PV-DISP-REC-SEQ-NBR                       26370000
263800                        ' OPER = '                                26380000
263900                        PV-DISP-OPER-UNT-ID                       26390000
264000                        ' FCLTY = '                               26400000
264100                        PV-DISP-FCLTY-ID                          26410000
264200                        ' PACK ='                                 26420000
264300                        PV-DISP-PREPK-ID    DELIMITED BY SIZE     26430000
264400                                 INTO DP013-MESSAGE-TEXT (2)      26440000
264500                 MOVE SQLCA        TO DP013-SQLCA                 26450000
264600                 MOVE 'TRECEIV '   TO DP013-DB2-TABLE-NAME (1)    26460000
264700                 MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (2)    26470000
264800                 MOVE 'TPURITM '   TO DP013-DB2-TABLE-NAME (3)    26480000
264900                 MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (4)    26490000
265000                 SET DP013-DB2-ABEND                              26500000
265100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           26510000
265200                 PERFORM DP013-0000-PROCESS-ABEND                 26520000
265300         END-EVALUATE                                             26530000
265400     END-PERFORM.                                                 26540000
265500*                                                                 26550000
265600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        26560000
265700         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             26570000
265800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   26580000
265900                                   TO DP013-MESSAGE-TEXT (1)      26590000
266000         MOVE ASC-PO-NBR           TO PV-DISP-PO-NBR              26600000
266100         MOVE ASC-OPER-UNT-ID      TO PV-DISP-OPER-UNT-ID         26610000
266200         MOVE ASC-FCLTY-ID         TO PV-DISP-FCLTY-ID            26620000
266300         MOVE ASC-REC-SEQ-NBR      TO PV-DISP-REC-SEQ-NBR         26630000
266400         STRING ' PO = '                                          26640000
266500                PV-DISP-PO-NBR                                    26650000
266600                ' OPER = '                                        26660000
266700                PV-DISP-OPER-UNT-ID                               26670000
266800                ' FCLTY = '                                       26680000
266900                PV-DISP-FCLTY-ID                                  26690000
267000                ' RECV ='                                         26700000
267100                PV-DISP-REC-SEQ-NBR DELIMITED BY SIZE             26710000
267200                         INTO DP013-MESSAGE-TEXT (2)              26720000
267300         MOVE SQLCA                TO DP013-SQLCA                 26730000
267400         MOVE 'TRECEIV '           TO DP013-DB2-TABLE-NAME (1)    26740000
267500         MOVE 'TRECITM '           TO DP013-DB2-TABLE-NAME (2)    26750000
267600         MOVE 'TPURITM '           TO DP013-DB2-TABLE-NAME (3)    26760000
267700         SET DP013-DB2-ABEND                                      26770000
267800             DP013-XCTL-DISPLAY-RESTART                           26780000
267900                                   TO TRUE                        26790000
268000         PERFORM DP013-0000-PROCESS-ABEND                         26800000
268100     END-IF.                                                      26810000
268200                                                                  26820000
268300 EJECT                                                            26830000
268400                                                                  26840000
268500 4020-CLOSE-CURSOR.                                               26850000
268600     EXEC SQL                                                     26860000
268700         CLOSE PACK-SLIP-CSR                                      26870000
268800     END-EXEC.                                                    26880000
268900*                                                                 26890000
269000     EVALUATE TRUE                                                26900000
269100         WHEN SQLCODE = ZERO                                      26910000
269200             CONTINUE                                             26920000
269300         WHEN SQLWARN0 NOT = SPACES                               26930000
269400         WHEN SQLCODE < ZERO                                      26940000
269500         WHEN SQLCODE > ZERO                                      26950000
269600             MOVE '4020-CLOSE-CURSOR'                             26960000
269700                               TO DP013-PARAGRAPH                 26970000
269800             MOVE 'CLOSE PACK SLIP CURSOR '                       26980000
269900                               TO DP013-MESSAGE-TEXT (1)          26990000
270000             MOVE SQLCA        TO DP013-SQLCA                     27000000
270100             MOVE DK-PO-NBR        TO PV-DISP-PO-NBR              27010000
270200             MOVE DK-OPER-UNT-ID   TO PV-DISP-OPER-UNT-ID         27020000
270300             MOVE DK-FCLTY-ID      TO PV-DISP-FCLTY-ID            27030000
270400             MOVE DK-REC-SEQ-NBR   TO PV-DISP-REC-SEQ-NBR         27040000
270500             MOVE DK-PREPK-ID      TO PV-DISP-PREPK-ID            27050000
270600             STRING ' PO = '                                      27060000
270700                    PV-DISP-PO-NBR                                27070000
270800                    ' RECV ='                                     27080000
270900                    PV-DISP-REC-SEQ-NBR                           27090000
271000                    ' OPER = '                                    27100000
271100                    PV-DISP-OPER-UNT-ID                           27110000
271200                    ' FCLTY = '                                   27120000
271300                    PV-DISP-FCLTY-ID                              27130000
271400                    ' PACK ='                                     27140000
271500                    PV-DISP-PREPK-ID    DELIMITED BY SIZE         27150000
271600                             INTO DP013-MESSAGE-TEXT (2)          27160000
271700             MOVE SQLCA        TO DP013-SQLCA                     27170000
271800             MOVE 'TRECEIV '   TO DP013-DB2-TABLE-NAME (1)        27180000
271900             MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (2)        27190000
272000             MOVE 'TPURITM '   TO DP013-DB2-TABLE-NAME (3)        27200000
272100             MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (4)        27210000
272200             SET DP013-DB2-ABEND                                  27220000
272300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               27230000
272400             PERFORM DP013-0000-PROCESS-ABEND                     27240000
272500     END-EVALUATE.                                                27250000
272600                                                                  27260000
272700 EJECT                                                            27270000
272800*----------------------------------------------------------------*27280000
272900*    SET UP THE HOST VARIABLES.                                  *27290000
273000*----------------------------------------------------------------*27300000
273100                                                                  27310000
273200 4100-PREPARE-CURSOR.                                             27320000
273300                                                                  27330000
273400     MOVE ASC-OPER-UNT-ID      TO DK-OPER-UNT-ID.                 27340000
273500     MOVE ASC-FCLTY-ID         TO DK-FCLTY-ID.                    27350000
273600     MOVE ASC-PO-NBR           TO DK-PO-NBR.                      27360000
273700     MOVE ASC-REC-SEQ-NBR      TO DK-REC-SEQ-NBR.                 27370000
273800     MOVE ASC-PACK-ID          TO DK-PREPK-ID.                    27380000
273900                                                                  27390000
274000                                                                  27400000
274100 EJECT                                                            27410000
274200*----------------------------------------------------------------*27420000
274300*    CALL TO (AUTOVE) AUTOVERIFICATION MODULE (RCKUT127)          27430000
274400*----------------------------------------------------------------*27440000
274500 4150-CALL-AUTOVE-MODULE.                                         27450000
274600                                                                  27460000
274700     INITIALIZE RC040-FIELDS.                                     27470000
274800     MOVE DK-OPER-UNT-ID      TO RC040-SIGNON-LOCATION.           27480000
274900     MOVE DK-PO-NBR           TO RC040-PO-NBR                     27490000
275000     MOVE DK-REC-SEQ-NBR      TO RC040-PO-RCVR                    27500000
275100     MOVE DP020-USERID        TO RC040-USER-ID.                   27510000
275200     MOVE 'RCKCS280'          TO RC040-CALLING-PROGRAM.           27520000
275300                                                                  27530000
275400     CALL RC040-AUTOVE-CHECK-PGM USING  DFHEIBLK                  27540000
275500                                        RC040-COMMAREA            27550000
275600                                        RC040-FIELDS.             27560000
275700                                                                  27570000
275800     EVALUATE TRUE                                                27580000
275900         WHEN RC040-SUCCESSFUL                                    27590000
276000              CONTINUE                                            27600000
276100         WHEN RC040-DATABASE-BUSY OR                              27610000
276200              RC040-INVALID-SQL                                   27620000
276300                  MOVE PC-TSYMSG-00984  TO DP020-MSG-NUMBER       27630000
276400                  SET DP020-MSG-WARNING TO TRUE                   27640000
276500                  SET DP030-OVERRIDE-GO TO TRUE                   27650000
276600                  SET PS-ERROR          TO TRUE                   27660000
276700         WHEN RC040-NOT-SUCCESSFUL                                27670000
276800                  MOVE PC-TSYMSG-03138  TO DP020-MSG-NUMBER       27680000
276900                  SET DP020-MSG-WARNING TO TRUE                   27690000
277000                  SET DP030-OVERRIDE-GO TO TRUE                   27700000
277100                  SET PS-ERROR          TO TRUE                   27710000
277200         WHEN OTHER                                               27720000
277300             MOVE '4150-CHECK-AUTOVE ' TO DP013-PARAGRAPH         27730000
277400             MOVE 'UNSUCCESSFUL CALL TO AUTO VE MOD'              27740000
277500                                         TO DP013-MESSAGE-TEXT (1)27750000
277600             MOVE RC040-SUCCESS-IND      TO DP013-MESSAGE-TEXT (2)27760000
277700             MOVE RC040-SQLCA            TO DP013-SQLCA           27770000
277800             SET DP013-DB2-ABEND                                  27780000
277900                 DP013-XCTL-DISPLAY-RESTART  TO TRUE              27790000
278000             SET PS-ERROR                    TO TRUE              27800000
278100             PERFORM DP013-0000-PROCESS-ABEND                     27810000
278200     END-EVALUATE.                                                27820000
278300                                                                  27830000
278400*----------------------------------------------------------------*27840000
278500*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *27850000
278600*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *27860000
278700*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *27870000
278800*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *27880000
278900*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *27890000
279000*                                                                *27900000
279100*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *27910000
279200*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *27920000
279300*    UPON INITIALIZATION.                                        *27930000
279400*----------------------------------------------------------------*27940000
279500                                                                  27950000
279600 4300-READ-ITEMS-FROM-DB.                                         27960000
279700                                                                  27970000
279800     PERFORM                                                      27980000
279900         VARYING PV-READ-COUNT                                    27990000
280000         FROM 1 BY 1                                              28000000
280100         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    28010000
280200            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         28020000
280300                                                                  28030000
280400         PERFORM 4310-FETCH                                       28040000
280500                                                                  28050000
280600         IF  ASC-ITEMS-LEFT-ON-DB                                 28060000
280700             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                28070000
280800                 ADD +1            TO ASC-ITEM-SUB                28080000
280900             ELSE                                                 28090000
281000                 ADD +1            TO ASC-BLK-SUB                 28100000
281100                 MOVE +1           TO ASC-ITEM-SUB                28110000
281200                                                                  28120000
281300                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         28130000
281400                     MOVE +1       TO ASC-BLK-SUB                 28140000
281500                     SET ASC-BLOCK-MODIFIED (1)                   28150000
281600                                   TO TRUE                        28160000
281700                     PERFORM 5100-WRITE-TEMP-STORAGE              28170000
281800                     MOVE ASC-BLOCK-ENTRIES                       28180000
281900                               (PC-MAX-BLOCKS-IN-ARRAY)           28190000
282000                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 28200000
282100                     ADD +1        TO ASC-BLK-SUB                 28210000
282200                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   28220000
282300                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      28230000
282400                                   TO TRUE                        28240000
282500                 END-IF                                           28250000
282600             END-IF                                               28260000
282700             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    28270000
282800             MOVE ASC-NUMBER-OF-ITEMS-READ                        28280000
282900                                   TO ASC-LIST-ITEM-NUMBER        28290000
283000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  28300000
283100                                                                  28310000
283200             SET PS-NOT-UPDATE-MODE TO TRUE                       28320000
283300             MOVE RECDIS-STR-NBR        TO DK-STR-NBR             28330000
283400             MOVE RECITM-STATUS-CDE     TO ASC-RECITM-STATUS-CDE  28340000
283500             PERFORM 4395-PROCESS-LINE-DATA                       28350000
283600                                                                  28360000
283700         END-IF                                                   28370000
283800     END-PERFORM.                                                 28380000
283900                                                                  28390000
284000     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          28400000
284100         MOVE +1               TO ASC-BLK-SUB                     28410000
284200         PERFORM 5100-WRITE-TEMP-STORAGE                          28420000
284300         ADD +1                TO ASC-BLK-SUB                     28430000
284400         PERFORM 5100-WRITE-TEMP-STORAGE                          28440000
284500                                                                  28450000
284600         MOVE 1                TO ASC-BLK-SUB                     28460000
284700                                  PV-BLOCK-NUMBER                 28470000
284800         PERFORM 4410-READ-TEMP-STORAGE                           28480000
284900         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             28490000
285000             MOVE 2            TO ASC-BLK-SUB                     28500000
285100                                  PV-BLOCK-NUMBER                 28510000
285200             PERFORM 4410-READ-TEMP-STORAGE                       28520000
285300         END-IF                                                   28530000
285400     END-IF.                                                      28540000
285500 EJECT                                                            28550000
285600                                                                  28560000
285700 4310-FETCH.                                                      28570000
285800                                                                  28580000
285900     EXEC SQL                                                     28590000
286000          FETCH PACK-SLIP-CSR                                     28600000
286100          INTO  :RECEIV-VERFYD-TMST                               28610000
286200              , :RECEIV-REC-TMST                                  28620000
286300              , :RECITM-STATUS-CDE                                28630000
286400              , :RECITM-VRFD-USR-ID                               28640000
286500              , :RECITM-PREPK-ID                                  28650000
286600              , :RECDIS-STR-NBR                                   28660000
286700              , :RECDIS-AP-PRC-CDE                                28670000
286800              , :RECDIS-EXPTED-ITM-QTY                            28680000
286900              , :RECDIS-VERIFY-ITM-QTY                            28690000
287000              , :PURCHS-DEPT-NBR                                  28700000
287100                                                                  28710000
287200     END-EXEC.                                                    28720000
287300                                                                  28730000
287400     EVALUATE TRUE                                                28740000
287500         WHEN SQLCODE = ZERO                                      28750000
287600         WHEN SQLCODE = +100                                      28760000
287700              CONTINUE                                            28770000
287800         WHEN SQLWARN0 NOT = SPACE                                28780000
287900         WHEN SQLCODE NOT = ZERO                                  28790000
288000              MOVE '4310-FETCH-CURSOR'                            28800000
288100                               TO DP013-PARAGRAPH                 28810000
288200              MOVE 'FETCH PACK SLIP CURSOR'                       28820000
288300                               TO DP013-MESSAGE-TEXT (1)          28830000
288400              MOVE SQLCA       TO DP013-SQLCA                     28840000
288500              MOVE DK-PO-NBR        TO PV-DISP-PO-NBR             28850000
288600              MOVE DK-OPER-UNT-ID   TO PV-DISP-OPER-UNT-ID        28860000
288700              MOVE DK-FCLTY-ID      TO PV-DISP-FCLTY-ID           28870000
288800              MOVE DK-REC-SEQ-NBR   TO PV-DISP-REC-SEQ-NBR        28880000
288900              MOVE DK-PREPK-ID      TO PV-DISP-PREPK-ID           28890000
289000              STRING ' PO = '                                     28900000
289100                     PV-DISP-PO-NBR                               28910000
289200                     ' RECV ='                                    28920000
289300                     PV-DISP-REC-SEQ-NBR                          28930000
289400                     ' OPER = '                                   28940000
289500                     PV-DISP-OPER-UNT-ID                          28950000
289600                     ' FCLTY = '                                  28960000
289700                     PV-DISP-FCLTY-ID                             28970000
289800                     ' PACK ='                                    28980000
289900                     PV-DISP-PREPK-ID    DELIMITED BY SIZE        28990000
290000                              INTO DP013-MESSAGE-TEXT (2)         29000000
290100              MOVE SQLCA        TO DP013-SQLCA                    29010000
290200              MOVE 'TRECEIV '   TO DP013-DB2-TABLE-NAME (1)       29020000
290300              MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (2)       29030000
290400              MOVE 'TPURITM '   TO DP013-DB2-TABLE-NAME (3)       29040000
290500              MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (4)       29050000
290600              SET DP013-DB2-ABEND                                 29060000
290700                               TO TRUE                            29070000
290800              PERFORM DP013-0000-PROCESS-ABEND                    29080000
290900     END-EVALUATE.                                                29090000
291000                                                                  29100000
291100     IF  SQLCODE EQUAL +100                                       29110000
291200         SET ASC-NO-ITEMS-LEFT-ON-DB                              29120000
291300                                   TO TRUE                        29130000
291400     END-IF.                                                      29140000
291500                                                                  29150000
291600 4320-SUM-TRECDIS.                                                29160000
291700                                                                  29170000
291800     MOVE ZERO                 TO RECDIS-AP-VERIFY-ITM-QTY.       29180000
291900     MOVE ZERO                 TO RECDIS-VERIFY-ITM-QTY.          29190000
292000                                                                  29200000
292100     EXEC SQL                                                     29210000
292200          SELECT                                                  29220000
292300                 SUM(A.AP_VERIFY_ITM_QTY)                         29230000
292400                ,SUM(A.VERIFY_ITM_QTY)                            29240000
292500          INTO                                                    29250000
292600                :RECDIS-AP-VERIFY-ITM-QTY :PV-NULL-IND            29260000
292700               ,:RECDIS-VERIFY-ITM-QTY :PV-NULL-IND               29270000
292800          FROM                                                    29280000
292900                 TRECDIS A                                        29290000
293000              ,  TRECITM  B                                       29300000
293100          WHERE                                                   29310000
293200                A.ORD_NBR          =  :DK-PO-NBR                  29320000
293300           AND  A.ORD_NBR          =  B.ORD_NBR                   29330000
293400           AND  A.REC_SEQ_NBR      =  :DK-REC-SEQ-NBR             29340000
293500           AND  A.REC_SEQ_NBR      =  B.REC_SEQ_NBR               29350000
293600           AND  A.FCLTY_ID         =  :DK-FCLTY-ID                29360000
293700           AND  A.FCLTY_ID         =  B.FCLTY_ID                  29370000
293800           AND  A.OPER_UNT_ID      =  :DK-OPER-UNT-ID             29380000
293900           AND  A.OPER_UNT_ID      =  B.OPER_UNT_ID               29390000
294000           AND  A.ORD_LNE_NBR      =  B.ORD_LNE_NBR               29400000
294200           AND  B.VER_STATUS_CDE   =  'A'                         29420000
294300           AND  B.PREPK_ID         = :DK-PREPK-ID                 29430000
294400     END-EXEC.                                                    29440000
294500                                                                  29450000
294600     EVALUATE TRUE                                                29460000
294700         WHEN SQLCODE = ZERO                                      29470000
294800         WHEN SQLCODE = +100                                      29480000
294900              CONTINUE                                            29490000
295000         WHEN SQLCODE = -904                                      29500000
295100         WHEN SQLCODE = -911                                      29510000
295200         WHEN SQLCODE = -913                                      29520000
295300             PERFORM 9900-SOFT-ABORT                              29530000
295400         WHEN SQLCODE = -305                                      29540000
295500              CONTINUE                                            29550000
295600         WHEN SQLWARN0 NOT = SPACE                                29560000
295700         WHEN SQLCODE NOT = ZERO                                  29570000
295800              MOVE '4320-SUM-TRECDIS'                             29580000
295900                               TO DP013-PARAGRAPH                 29590000
296000              MOVE 'SUMMARIZE AP VERIFIED COUNT'                  29600000
296100                               TO DP013-MESSAGE-TEXT (1)          29610000
296200              MOVE SQLCA       TO DP013-SQLCA                     29620000
296300              MOVE DK-PO-NBR        TO PV-DISP-PO-NBR             29630000
296400              MOVE DK-OPER-UNT-ID   TO PV-DISP-OPER-UNT-ID        29640000
296500              MOVE DK-FCLTY-ID      TO PV-DISP-FCLTY-ID           29650000
296600              MOVE DK-REC-SEQ-NBR   TO PV-DISP-REC-SEQ-NBR        29660000
296700              MOVE DK-PREPK-ID      TO PV-DISP-PREPK-ID           29670000
296800              STRING ' PO = '                                     29680000
296900                     PV-DISP-PO-NBR                               29690000
297000                     ' RECV ='                                    29700000
297100                     PV-DISP-REC-SEQ-NBR                          29710000
297200                     ' OPER = '                                   29720000
297300                     PV-DISP-OPER-UNT-ID                          29730000
297400                     ' FCLTY = '                                  29740000
297500                     PV-DISP-FCLTY-ID                             29750000
297600                     ' PACK ='                                    29760000
297700                     PV-DISP-PREPK-ID    DELIMITED BY SIZE        29770000
297800                              INTO DP013-MESSAGE-TEXT (2)         29780000
297900              MOVE SQLCA        TO DP013-SQLCA                    29790000
298000              MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (1)       29800000
298100              MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (2)       29810000
298200              SET DP013-DB2-ABEND                                 29820000
298300                               TO TRUE                            29830000
298400              PERFORM DP013-0000-PROCESS-ABEND                    29840000
298500     END-EVALUATE.                                                29850000
298600/                                                                 29860000
298700 4330-SUM-TRECDIS-DRIVER.                                         29870010
298800                                                                  29880000
298900     MOVE ZERO                 TO  PV-LNE-AP-VERIFY-ITM-QTY.      29890000
299000     MOVE ZERO                 TO  PV-LNE-VERIFY-ITM-QTY.         29900000
299100     MOVE ZERO                 TO  PV-LNE-EXPTED-ITM-QTY.         29910000
299200                                                                  29920000
299300     EXEC SQL                                                     29930000
299400          SELECT                                                  29940000
299500                 SUM(AP_VERIFY_ITM_QTY)                           29950000
299600                ,SUM(VERIFY_ITM_QTY)                              29960000
299700                ,SUM(EXPTED_ITM_QTY)                              29970000
299800          INTO                                                    29980000
299900                :PV-LNE-AP-VERIFY-ITM-QTY :PV-NULL-IND            29990000
300000               ,:PV-LNE-VERIFY-ITM-QTY :PV-NULL-IND               30000000
300100               ,:PV-LNE-EXPTED-ITM-QTY :PV-NULL-IND               30010000
300200          FROM                                                    30020000
300300                 TRECDIS                                          30030000
300400          WHERE                                                   30040000
300500                ORD_NBR          =  :DK-PO-NBR                    30050000
300600           AND  ORD_LNE_NBR      =  :DK-PO-DRIVER-LNE             30060000
300700           AND  REC_SEQ_NBR      =  :DK-REC-SEQ-NBR               30070000
300800           AND  FCLTY_ID         =  :DK-FCLTY-ID                  30080000
300900           AND  OPER_UNT_ID      =  :DK-OPER-UNT-ID               30090000
301100           AND  STR_NBR          =  :DK-STR-NBR                   30110000
301200     END-EXEC.                                                    30120000
301300                                                                  30130000
301400     EVALUATE TRUE                                                30140000
301500         WHEN SQLCODE = ZERO                                      30150000
301600         WHEN SQLCODE = +100                                      30160000
301700              CONTINUE                                            30170000
301800         WHEN SQLCODE = -904                                      30180000
301900         WHEN SQLCODE = -911                                      30190000
302000         WHEN SQLCODE = -913                                      30200000
302100             PERFORM 9900-SOFT-ABORT                              30210000
302200         WHEN SQLCODE = -305                                      30220000
302300              CONTINUE                                            30230000
302400         WHEN SQLWARN0 NOT = SPACE                                30240000
302500         WHEN SQLCODE NOT = ZERO                                  30250000
302600              MOVE '4330-SUM-TRECDIS'                             30260000
302700                               TO DP013-PARAGRAPH                 30270000
302800              MOVE 'SUMMARIZE AP VERIFIED COUNT'                  30280000
302900                               TO DP013-MESSAGE-TEXT (1)          30290000
303000              MOVE SQLCA       TO DP013-SQLCA                     30300000
303100                                                                  30310000
303200              MOVE DK-PO-NBR        TO PV-DISP-PO-NBR             30320000
303300              MOVE DK-OPER-UNT-ID   TO PV-DISP-OPER-UNT-ID        30330000
303400              MOVE DK-FCLTY-ID      TO PV-DISP-FCLTY-ID           30340000
303500              MOVE DK-REC-SEQ-NBR   TO PV-DISP-REC-SEQ-NBR        30350000
303600              MOVE DK-PO-DRIVER-LNE TO PV-DISP-LNE-NBR            30360000
303700              STRING ' PO = '                                     30370000
303800                     PV-DISP-PO-NBR                               30380000
303900                     ' RECV ='                                    30390000
304000                     PV-DISP-REC-SEQ-NBR                          30400000
304100                     ' OPER = '                                   30410000
304200                     PV-DISP-OPER-UNT-ID                          30420000
304300                     ' FCLTY = '                                  30430000
304400                     PV-DISP-FCLTY-ID                             30440000
304500                     ' LINE ='                                    30450000
304600                     PV-DISP-LNE-NBR     DELIMITED BY SIZE        30460000
304700                              INTO DP013-MESSAGE-TEXT (2)         30470000
304800              MOVE SQLCA        TO DP013-SQLCA                    30480000
304900              MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (1)       30490000
305000              SET DP013-DB2-ABEND                                 30500000
305100                               TO TRUE                            30510000
305200              PERFORM DP013-0000-PROCESS-ABEND                    30520000
305300     END-EVALUATE.                                                30530000
305400/                                                                 30540000
305500 4340-SELECT-DRIVER-RATIO.                                        30550000
305600                                                                  30560000
305700     EXEC SQL                                                     30570000
305800          SELECT                                                  30580000
305900                B.ORD_LNE_NBR                                     30590000
306000             ,  B.PREPK_RATO_QTY                                  30600000
306100             ,  B.VERFYD_TMST                                     30610000
306200             ,  B.VRFD_USR_ID                                     30620000
306300             ,  D.PK_SKU_NBR                                      30630000
306400          INTO                                                    30640000
306500                :RECITM-ORD-LNE-NBR                               30650000
306600             ,  :RECITM-PREPK-RATO-QTY                            30660000
306700             ,  :RECITM-VERFYD-TMST                               30670000
306800             ,  :RECITM-VRFD-USR-ID                               30680000
306900             ,  :POPRPK-PK-SKU-NBR                                30690000
307000          FROM    TRECEIV  A                                      30700000
307100              ,   TRECITM  B                                      30710000
307200              ,   TPURITM  C                                      30720000
307300              ,   TPOPRPK  D                                      30730000
307400          WHERE A.ORD_NBR          =  :DK-PO-NBR                  30740000
307500           AND  A.ORD_NBR          =  B.ORD_NBR                   30750000
307600           AND  A.ORD_NBR          =  C.PO_NBR                    30760000
307700           AND  A.ORD_NBR          =  D.PO_NBR                    30770000
307800           AND  A.VER_STATUS_CDE   =  'A'                         30780000
307900           AND  B.VER_STATUS_CDE   =  'A'                         30790000
308000           AND  A.OPER_UNT_ID      =  :DK-OPER-UNT-ID             30800000
308100           AND  A.OPER_UNT_ID      =  B.OPER_UNT_ID               30810000
308200           AND  A.FCLTY_ID         =  :DK-FCLTY-ID                30820000
308300           AND  A.FCLTY_ID         =  B.FCLTY_ID                  30830000
308400           AND  A.REC_SEQ_NBR      =  :DK-REC-SEQ-NBR             30840000
308500           AND  A.REC_SEQ_NBR      =  B.REC_SEQ_NBR               30850000
308600           AND  B.ORD_LNE_NBR      =  C.APP_PO_LNE_NBR            30860000
308700           AND  B.PO_VER_NBR       =  C.VER_NBR                   30870000
308800           AND  B.PREPK_DRV_LNE_CDE = 'A'                         30880000
308900           AND  B.PREPK_ID         = :DK-PREPK-ID                 30890000
309000           AND  B.PREPK_ID         =  D.PO_PREPK_ID               30900000
309100     END-EXEC.                                                    30910000
309200                                                                  30920000
309300     EVALUATE TRUE                                                30930000
309410         WHEN SQLCODE = ZERO                                      30941006
309500         WHEN SQLCODE = -904                                      30950000
309600         WHEN SQLCODE = -913                                      30960000
309700             CONTINUE                                             30970000
309701                                                                  30970106
309702* DMH 10/27/17 - BEGIN                                            30970206
309710         WHEN SQLCODE = +100                                      30971006
309720              PERFORM 4345-SELECT-DRIVER-RATIO                    30972006
309730* DMH 10/27/17 - END                                              30973006
309740                                                                  30974006
309800         WHEN SQLWARN0 NOT = SPACES                               30980000
309900         WHEN SQLCODE < ZERO                                      30990000
310000         WHEN SQLCODE > ZERO                                      31000000
310100             MOVE '4340-SELECT-DRIVER-RATIO'                      31010000
310200                               TO DP013-PARAGRAPH                 31020000
310300             MOVE 'SELECT DRIVER RATIO '                          31030000
310400                               TO DP013-MESSAGE-TEXT (1)          31040000
310500             MOVE DK-PO-NBR        TO PV-DISP-PO-NBR              31050000
310600             MOVE DK-OPER-UNT-ID   TO PV-DISP-OPER-UNT-ID         31060000
310700             MOVE DK-FCLTY-ID      TO PV-DISP-FCLTY-ID            31070000
310800             MOVE DK-REC-SEQ-NBR   TO PV-DISP-REC-SEQ-NBR         31080000
310900             MOVE DK-PREPK-ID      TO PV-DISP-PREPK-ID            31090000
311000             MOVE DK-STR-NBR       TO PV-DISP-STR-NBR             31100000
311100             STRING ' PO = '                                      31110000
311200                    PV-DISP-PO-NBR                                31120000
311300                    ' RECV ='                                     31130000
311400                    PV-DISP-REC-SEQ-NBR                           31140000
311500                    ' OPER = '                                    31150000
311600                    PV-DISP-OPER-UNT-ID                           31160000
311700                    ' FCLTY = '                                   31170000
311800                    PV-DISP-FCLTY-ID    DELIMITED BY SIZE         31180000
311900                             INTO DP013-MESSAGE-TEXT (2)          31190000
312000             STRING ' STR ='                                      31200000
312100                    PV-DISP-STR-NBR                               31210000
312200                    ' PACK ='                                     31220000
312300                    PV-DISP-PREPK-ID    DELIMITED BY SIZE         31230000
312400                             INTO DP013-MESSAGE-TEXT (3)          31240000
312500             MOVE SQLCA        TO DP013-SQLCA                     31250000
312600             MOVE 'TRECEIV '   TO DP013-DB2-TABLE-NAME (1)        31260000
312700             MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (2)        31270000
312800             MOVE 'TPURITM '   TO DP013-DB2-TABLE-NAME (3)        31280000
312900             MOVE 'TPOPRPK '   TO DP013-DB2-TABLE-NAME (4)        31290000
313000             SET DP013-DB2-ABEND                                  31300000
313100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               31310000
313200             PERFORM DP013-0000-PROCESS-ABEND                     31320000
313300     END-EVALUATE.                                                31330000
313400*                                                                 31340000
313500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        31350000
313600         MOVE '4340-SELECT-DRIVER-RATIO' TO DP013-PARAGRAPH       31360000
313700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING ON SELECT'     31370000
313800                                   TO DP013-MESSAGE-TEXT (1)      31380000
313900         MOVE ASC-PO-NBR           TO PV-DISP-PO-NBR              31390000
314000         MOVE ASC-REC-SEQ-NBR      TO PV-DISP-REC-SEQ-NBR         31400000
314100         MOVE DK-PREPK-ID          TO PV-DISP-PREPK-ID            31410000
314200         STRING ' PO = '                                          31420000
314300                PV-DISP-PO-NBR                                    31430000
314400                ' OPER = '                                        31440000
314500                PV-DISP-OPER-UNT-ID                               31450000
314600                ' FCLTY = '                                       31460000
314700                PV-DISP-FCLTY-ID                                  31470000
314800                ' RECV ='                                         31480000
314900                PV-DISP-REC-SEQ-NBR                               31490000
315000                ' PACK ='                                         31500000
315100                PV-DISP-PREPK-ID    DELIMITED BY SIZE             31510000
315200                         INTO DP013-MESSAGE-TEXT (2)              31520000
315300         MOVE SQLCA                TO DP013-SQLCA                 31530000
315400         MOVE 'TRECEIV '           TO DP013-DB2-TABLE-NAME (1)    31540000
315500         MOVE 'TRECITM '           TO DP013-DB2-TABLE-NAME (2)    31550000
315600         MOVE 'TPURITM '           TO DP013-DB2-TABLE-NAME (3)    31560000
315700         SET DP013-DB2-ABEND                                      31570000
315800             DP013-XCTL-DISPLAY-RESTART                           31580000
315900                                   TO TRUE                        31590000
316000         PERFORM DP013-0000-PROCESS-ABEND                         31600000
316100     END-IF.                                                      31610000
316200                                                                  31620000
316300                                                                  31630000
316301****************************************************************  31630106
316302* BRING BACK MIN LINE NUMBER FOR PREPACK WHEN DRIVER LINE IS      31630206
316303* NOT DEFINED                                                     31630306
316304* DMH 10/27/17                                                    31630406
316305****************************************************************  31630506
316310 4345-SELECT-DRIVER-RATIO.                                        31631006
316320                                                                  31632006
316330     EXEC SQL                                                     31633006
316340          SELECT                                                  31634006
316350                B.ORD_LNE_NBR                                     31635006
316360             ,  B.PREPK_RATO_QTY                                  31636006
316370             ,  B.VERFYD_TMST                                     31637006
316380             ,  B.VRFD_USR_ID                                     31638006
316390             ,  D.PK_SKU_NBR                                      31639006
316391          INTO                                                    31639106
316392                :RECITM-ORD-LNE-NBR                               31639206
316393             ,  :RECITM-PREPK-RATO-QTY                            31639306
316394             ,  :RECITM-VERFYD-TMST                               31639406
316395             ,  :RECITM-VRFD-USR-ID                               31639506
316396             ,  :POPRPK-PK-SKU-NBR                                31639606
316397          FROM    TRECEIV  A                                      31639706
316398              ,   TRECITM  B                                      31639806
316399              ,   TPURITM  C                                      31639906
316400              ,   TPOPRPK  D                                      31640006
316401          WHERE A.ORD_NBR          =  :DK-PO-NBR                  31640106
316402           AND  A.ORD_NBR          =  B.ORD_NBR                   31640206
316403           AND  A.ORD_NBR          =  C.PO_NBR                    31640306
316404           AND  A.ORD_NBR          =  D.PO_NBR                    31640406
316405           AND  A.VER_STATUS_CDE   =  'A'                         31640506
316406           AND  B.VER_STATUS_CDE   =  'A'                         31640606
316407           AND  A.OPER_UNT_ID      =  :DK-OPER-UNT-ID             31640706
316408           AND  A.OPER_UNT_ID      =  B.OPER_UNT_ID               31640806
316409           AND  A.FCLTY_ID         =  :DK-FCLTY-ID                31640906
316410           AND  A.FCLTY_ID         =  B.FCLTY_ID                  31641006
316411           AND  A.REC_SEQ_NBR      =  :DK-REC-SEQ-NBR             31641106
316412           AND  A.REC_SEQ_NBR      =  B.REC_SEQ_NBR               31641206
316413           AND  B.ORD_LNE_NBR      =  C.APP_PO_LNE_NBR            31641306
316414           AND  B.PO_VER_NBR       =  C.VER_NBR                   31641406
316416           AND  B.PREPK_ID         = :DK-PREPK-ID                 31641606
316417           AND  B.PREPK_ID         =  D.PO_PREPK_ID               31641706
316418           AND  B.ORD_LNE_NBR  IN                                 31641806
316419                (SELECT MIN(BB.ORD_LNE_NBR)                       31641906
316420                   FROM TRECITM BB                                31642006
316421                  WHERE B.ORD_NBR         =  BB.ORD_NBR           31642106
316422                    AND B.REC_SEQ_NBR     =  BB.REC_SEQ_NBR       31642206
316423                    AND BB.VER_STATUS_CDE =  'A'                  31642306
316424                    AND B.PREPK_ID        =  BB.PREPK_ID)         31642406
316426     END-EXEC.                                                    31642606
316427                                                                  31642706
316428     EVALUATE TRUE                                                31642806
316429         WHEN SQLCODE = ZERO                                      31642906
316430         WHEN SQLCODE = -904                                      31643006
316431         WHEN SQLCODE = -913                                      31643106
316432             CONTINUE                                             31643206
316433         WHEN SQLWARN0 NOT = SPACES                               31643306
316434         WHEN SQLCODE < ZERO                                      31643406
316435         WHEN SQLCODE > ZERO                                      31643506
316436             MOVE '4345-SELECT-DRIVER-RATIO'                      31643606
316437                               TO DP013-PARAGRAPH                 31643706
316438             MOVE 'SELECT MIN LINE RATIO '                        31643806
316439                               TO DP013-MESSAGE-TEXT (1)          31643906
316440             MOVE DK-PO-NBR        TO PV-DISP-PO-NBR              31644006
316441             MOVE DK-OPER-UNT-ID   TO PV-DISP-OPER-UNT-ID         31644106
316442             MOVE DK-FCLTY-ID      TO PV-DISP-FCLTY-ID            31644206
316443             MOVE DK-REC-SEQ-NBR   TO PV-DISP-REC-SEQ-NBR         31644306
316444             MOVE DK-PREPK-ID      TO PV-DISP-PREPK-ID            31644406
316445             MOVE DK-STR-NBR       TO PV-DISP-STR-NBR             31644506
316446             STRING ' PO = '                                      31644606
316447                    PV-DISP-PO-NBR                                31644706
316448                    ' RECV ='                                     31644806
316449                    PV-DISP-REC-SEQ-NBR                           31644906
316450                    ' OPER = '                                    31645006
316451                    PV-DISP-OPER-UNT-ID                           31645106
316452                    ' FCLTY = '                                   31645206
316453                    PV-DISP-FCLTY-ID    DELIMITED BY SIZE         31645306
316454                             INTO DP013-MESSAGE-TEXT (2)          31645406
316455             STRING ' STR ='                                      31645506
316456                    PV-DISP-STR-NBR                               31645606
316457                    ' PACK ='                                     31645706
316458                    PV-DISP-PREPK-ID    DELIMITED BY SIZE         31645806
316459                             INTO DP013-MESSAGE-TEXT (3)          31645906
316460             MOVE SQLCA        TO DP013-SQLCA                     31646006
316461             MOVE 'TRECEIV '   TO DP013-DB2-TABLE-NAME (1)        31646106
316462             MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (2)        31646206
316463             MOVE 'TPURITM '   TO DP013-DB2-TABLE-NAME (3)        31646306
316464             MOVE 'TPOPRPK '   TO DP013-DB2-TABLE-NAME (4)        31646406
316465             SET DP013-DB2-ABEND                                  31646506
316466                 DP013-XCTL-DISPLAY-RESTART TO TRUE               31646606
316467             PERFORM DP013-0000-PROCESS-ABEND                     31646706
316468     END-EVALUATE.                                                31646806
316469*                                                                 31646906
316470     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        31647006
316471         MOVE '4345-SELECT-DRIVER-RATIO' TO DP013-PARAGRAPH       31647106
316472         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING ON SELECT'     31647206
316473                                   TO DP013-MESSAGE-TEXT (1)      31647306
316474         MOVE ASC-PO-NBR           TO PV-DISP-PO-NBR              31647406
316475         MOVE ASC-REC-SEQ-NBR      TO PV-DISP-REC-SEQ-NBR         31647506
316476         MOVE DK-PREPK-ID          TO PV-DISP-PREPK-ID            31647606
316477         STRING ' PO = '                                          31647706
316478                PV-DISP-PO-NBR                                    31647806
316479                ' OPER = '                                        31647906
316480                PV-DISP-OPER-UNT-ID                               31648006
316481                ' FCLTY = '                                       31648106
316482                PV-DISP-FCLTY-ID                                  31648206
316483                ' RECV ='                                         31648306
316484                PV-DISP-REC-SEQ-NBR                               31648406
316485                ' PACK ='                                         31648506
316486                PV-DISP-PREPK-ID    DELIMITED BY SIZE             31648606
316487                         INTO DP013-MESSAGE-TEXT (2)              31648706
316488         MOVE SQLCA                TO DP013-SQLCA                 31648806
316489         MOVE 'TRECEIV '           TO DP013-DB2-TABLE-NAME (1)    31648906
316490         MOVE 'TRECITM '           TO DP013-DB2-TABLE-NAME (2)    31649006
316491         MOVE 'TPURITM '           TO DP013-DB2-TABLE-NAME (3)    31649106
316492         SET DP013-DB2-ABEND                                      31649206
316493             DP013-XCTL-DISPLAY-RESTART                           31649306
316494                                   TO TRUE                        31649406
316495         PERFORM DP013-0000-PROCESS-ABEND                         31649506
316496     END-IF.                                                      31649606
316497                                                                  31649706
316498                                                                  31649806
316499 4350-SELECT-ODD-UNITS.                                           31649900
316500                                                                  31650000
316600     MOVE 0               TO PV-ODD-DC-VERIFY-ODU-QTY             31660000
316700                             PV-ODD-AP-VERIFY-ODU-QTY.            31670000
316800     EXEC SQL                                                     31680000
316900          SELECT                                                  31690000
317000                 SUM(A.DC_VRFY_ODU_QTY)                           31700000
317100             ,   SUM(A.AP_VRFY_ODU_QTY)                           31710000
317200          INTO                                                    31720000
317300                :PV-ODD-DC-VERIFY-ODU-QTY :PV-NULL-IND            31730000
317400             ,  :PV-ODD-AP-VERIFY-ODU-QTY :PV-NULL-IND            31740000
317500          FROM                                                    31750000
317600                 RCT_VRFD_ODD_UNT A                               31760000
317700              ,  TRECITM  B                                       31770000
317800          WHERE                                                   31780000
317900                PO_NBR           =  :DK-PO-NBR                    31790000
318000*          AND  PO_LNE_NBR       =  :DK-PO-DRIVER-LNE             31800000
318100           AND  A.PO_LNE_NBR     =  B.ORD_LNE_NBR                 31810000
318200           AND  RCVR_SEQ_NBR     =  :DK-REC-SEQ-NBR               31820000
318300           AND  STR_NBR          =  :DK-STR-NBR                   31830000
318400           AND  A.PO_NBR         =  B.ORD_NBR                     31840000
318500           AND  B.VER_STATUS_CDE =  'A'                           31850000
318600           AND  A.RCVR_SEQ_NBR   =  B.REC_SEQ_NBR                 31860000
318700           AND  B.PREPK_ID       = :DK-PREPK-ID                   31870000
318800     END-EXEC.                                                    31880000
318900                                                                  31890000
319000     EVALUATE TRUE                                                31900000
319100         WHEN SQLCODE = ZERO                                      31910000
319200         WHEN SQLCODE = +100                                      31920000
319300              CONTINUE                                            31930000
319400         WHEN SQLCODE = -904                                      31940000
319500         WHEN SQLCODE = -911                                      31950000
319600         WHEN SQLCODE = -913                                      31960000
319700             PERFORM 9900-SOFT-ABORT                              31970000
319800         WHEN SQLCODE = -305                                      31980000
319900              CONTINUE                                            31990000
320000         WHEN SQLWARN0 NOT = SPACE                                32000000
320100         WHEN SQLCODE NOT = ZERO                                  32010000
320200              MOVE '4350-SELECT-ODD-UNITS'                        32020000
320300                               TO DP013-PARAGRAPH                 32030000
320400              MOVE 'SUMMARIZE AP VERIFIED COUNT'                  32040000
320500                               TO DP013-MESSAGE-TEXT (1)          32050000
320600              MOVE SQLCA       TO DP013-SQLCA                     32060000
320700              MOVE DK-PO-NBR        TO PV-DISP-PO-NBR             32070000
320800              MOVE DK-REC-SEQ-NBR   TO PV-DISP-REC-SEQ-NBR        32080000
320900              MOVE DK-STR-NBR       TO PV-DISP-STR-NBR            32090000
321000              MOVE DK-PREPK-ID      TO PV-DISP-PREPK-ID           32100000
321100              STRING ' PO = '                                     32110000
321200                     PV-DISP-PO-NBR                               32120000
321300                     ' RECV ='                                    32130000
321400                     PV-DISP-REC-SEQ-NBR                          32140000
321500                     ' STORE ='                                   32150000
321600                     PV-DISP-STR-NBR                              32160000
321700                     ' PACK ='                                    32170000
321800                     PV-DISP-PREPK-ID    DELIMITED BY SIZE        32180000
321900                              INTO DP013-MESSAGE-TEXT (2)         32190000
322000              MOVE SQLCA        TO DP013-SQLCA                    32200000
322100              MOVE 'RCT00009'   TO DP013-DB2-TABLE-NAME (1)       32210000
322200              MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (2)       32220000
322300              SET DP013-DB2-ABEND                                 32230000
322400                               TO TRUE                            32240000
322500              PERFORM DP013-0000-PROCESS-ABEND                    32250000
322600     END-EVALUATE.                                                32260000
322700                                                                  32270000
322800 4355-SELECT-ODD-UNITS-DRIVER.                                    32280000
322900                                                                  32290000
323000     MOVE 0               TO PV-ODD-DC-VERIFY-ODU-PK-QTY          32300000
323100                             PV-ODD-AP-VERIFY-ODU-PK-QTY.         32310000
323200     EXEC SQL                                                     32320000
323300          SELECT                                                  32330000
323400                 SUM(A.DC_VRFY_ODU_QTY)                           32340000
323500             ,   SUM(A.AP_VRFY_ODU_QTY)                           32350000
323600          INTO                                                    32360000
323700                :PV-ODD-DC-VERIFY-ODU-PK-QTY :PV-NULL-IND         32370000
323800             ,  :PV-ODD-AP-VERIFY-ODU-PK-QTY :PV-NULL-IND         32380000
323900          FROM                                                    32390000
324000                 RCT_VRFD_ODD_UNT A                               32400000
324100              ,  TRECITM  B                                       32410000
324200          WHERE                                                   32420000
324300                PO_NBR           =  :DK-PO-NBR                    32430000
324400           AND  PO_LNE_NBR       =  :DK-PO-DRIVER-LNE             32440000
324500           AND  A.PO_LNE_NBR     =  B.ORD_LNE_NBR                 32450000
324600           AND  RCVR_SEQ_NBR     =  :DK-REC-SEQ-NBR               32460000
324700           AND  STR_NBR          =  :DK-STR-NBR                   32470000
324800           AND  A.PO_NBR         =  B.ORD_NBR                     32480000
324900           AND  B.VER_STATUS_CDE =  'A'                           32490000
325000           AND  A.RCVR_SEQ_NBR   =  B.REC_SEQ_NBR                 32500000
325100           AND  B.PREPK_ID       = :DK-PREPK-ID                   32510000
325200     END-EXEC.                                                    32520000
325300                                                                  32530000
325400     EVALUATE TRUE                                                32540000
325500         WHEN SQLCODE = ZERO                                      32550000
325600         WHEN SQLCODE = +100                                      32560000
325700              CONTINUE                                            32570000
325800         WHEN SQLCODE = -904                                      32580000
325900         WHEN SQLCODE = -911                                      32590000
326000         WHEN SQLCODE = -913                                      32600000
326100             PERFORM 9900-SOFT-ABORT                              32610000
326200         WHEN SQLCODE = -305                                      32620000
326300              CONTINUE                                            32630000
326400         WHEN SQLWARN0 NOT = SPACE                                32640000
326500         WHEN SQLCODE NOT = ZERO                                  32650000
326600              MOVE '4355-SELECT-ODD-UNITS-DRIVER'                 32660000
326700                               TO DP013-PARAGRAPH                 32670000
326800              MOVE 'SUMMARIZE AP VERIFIED COUNT'                  32680000
326900                               TO DP013-MESSAGE-TEXT (1)          32690000
327000              MOVE SQLCA       TO DP013-SQLCA                     32700000
327100              MOVE DK-PO-NBR        TO PV-DISP-PO-NBR             32710000
327200              MOVE DK-REC-SEQ-NBR   TO PV-DISP-REC-SEQ-NBR        32720000
327300              MOVE DK-STR-NBR       TO PV-DISP-STR-NBR            32730000
327400              MOVE DK-PREPK-ID      TO PV-DISP-PREPK-ID           32740000
327500              STRING ' PO = '                                     32750000
327600                     PV-DISP-PO-NBR                               32760000
327700                     ' RECV ='                                    32770000
327800                     PV-DISP-REC-SEQ-NBR                          32780000
327900                     ' STORE ='                                   32790000
328000                     PV-DISP-STR-NBR                              32800000
328100                     ' PACK ='                                    32810000
328200                     PV-DISP-PREPK-ID    DELIMITED BY SIZE        32820000
328300                              INTO DP013-MESSAGE-TEXT (2)         32830000
328400              MOVE SQLCA        TO DP013-SQLCA                    32840000
328500              MOVE 'RCT00009'   TO DP013-DB2-TABLE-NAME (1)       32850000
328600              MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (2)       32860000
328700              SET DP013-DB2-ABEND                                 32870000
328800                               TO TRUE                            32880000
328900              PERFORM DP013-0000-PROCESS-ABEND                    32890000
329000     END-EVALUATE.                                                32900000
329100                                                                  32910000
329110******************************************************************32911000
329120*  CHECK TKRPRPM TO SEE IF THE DC'S NEED TO BE FLUSHED.           32912000
329130******************************************************************32913000
329140 4360A-CHECK4-DC-FLUSH.                                           32914000
329150                                                                  32915000
329160     EXEC SQL                                                     32916000
329170          SELECT  FUNC_TXT                                        32917000
329180          INTO   :KRPRPM-FUNC-TXT                                 32918000
329190          FROM  TKRPRPM                                           32919000
329191          WHERE LOC_ID            =  90                           32919100
329192            AND SYS_PRC_FUNC_CDE  =  'FLUSH'                      32919200
329193            AND FUNC_PRC_STAT_CDE =  'AC'                         32919300
329194     END-EXEC.                                                    32919400
329195                                                                  32919500
329196     EVALUATE TRUE                                                32919600
329197         WHEN SQLCODE = +0                                        32919700
329198            IF KRPRPM-FUNC-TXT = 'N'                              32919800
329199                SET PS-DC-FLUSH-NO  TO TRUE                       32919900
329200            ELSE                                                  32920000
329201                SET PS-DC-FLUSH-YES TO TRUE                       32920100
329202            END-IF                                                32920200
329203         WHEN OTHER                                               32920300
329204                SET PS-DC-FLUSH-NO  TO TRUE                       32920400
329205     END-EVALUATE.                                                32920500
329206                                                                  32920600
329210 4360-CHECK-INVENTORY-DATE.                                       32921000
329300                                                                  32930000
329400     SET ASC-UPDATE-YES (ASC-BLK-SUB ASC-ITEM-SUB)                32940000
329500                                TO TRUE.                          32950000
329600     PERFORM 4365-GET-STORE-TYPE.                                 32960000
329700     PERFORM 4370-READ-INV-PARM.                                  32970000
329800     IF PV-NULL-IND = 0                                           32980000
329900         PERFORM 4375-FMT-CUTOFF-DTS-FOR-CMPARE                   32990000
330000         PERFORM 4380-CHCK-INV-DATE-FOR-UPDATE                    33000000
330100     ELSE                                                         33010000
330200         CONTINUE                                                 33020000
330300     END-IF.                                                      33030000
330400                                                                  33040000
330500 4365-GET-STORE-TYPE.                                             33050000
330600                                                                  33060000
330700                                                                  33070000
331000                                                                  33100000
331100     INITIALIZE XL071-COMMAREA-REC.                               33110000
331200     MOVE DK-OPER-UNT-ID          TO  XL071-LOCATION-NUMBER.      33120000
331300                                                                  33130000
331400     CALL PC-LOCATION-MODULE  USING                               33140000
331500                                    DFHEIBLK                      33150000
331600                                    XL071-COMMAREA                33160000
331700                                    XL071-COMMAREA-REC.           33170000
331800                                                                  33180000
331900     EVALUATE TRUE                                                33190000
332000         WHEN XL071-NO-ERRORS                                     33200000
332100         WHEN XL071-DC-ASGMT-NOT-FND                              33210000
332200                                                                  33220000
332300              MOVE RECDIS-STR-NBR    TO DK-STORE                  33230000
332500                                                                  33250000
332600              IF  XL071-LOC-TYP-CDE  = 'DC'                       33260000
332700                  SET ASC-DC-STORE-TYPE      TO  TRUE             33270000
332800              ELSE                                                33280000
332900                  SET ASC-NOT-DC-STORE-TYPE  TO  TRUE             33290000
333000              END-IF                                              33300000
333100                                                                  33310000
333200         WHEN OTHER                                               33320000
333300              INITIALIZE PV-CICS-MSG-AREA                         33330000
333400              STRING ' RCKCS818 - CALL XLTUT071 -'                33340000
333500                     ' SQLCODE=' XL071-SQLCODE                    33350000
333600                     ' TABLE='   XL071-DB2-TABLE                  33360000
333700                                              DELIMITED BY SIZE   33370000
333800                                         INTO PV-CICS-MSG-AREA    33380000
333900              MOVE LENGTH OF PV-CICS-MSG-AREA                     33390000
334000                                        TO PV-COMMAREA-LENGTH     33400000
334100              EXEC CICS                                           33410000
334200                   WRITEQ TD                                      33420000
334300                    QUEUE  ('CSSL')                               33430000
334400                     FROM  (PV-CICS-MSG-AREA)                     33440000
334500                   LENGTH  (PV-COMMAREA-LENGTH)                   33450000
334600                     RESP  (PV-CICS-RESP)                         33460000
334700              END-EXEC                                            33470000
334800                                                                  33480000
334900             MOVE '4365-GET-STORE-TYPE'                           33490000
335000                               TO DP013-PARAGRAPH                 33500000
335100             MOVE 'GET STORE TYPE'                                33510000
335200                               TO DP013-MESSAGE-TEXT (1)          33520000
335300             MOVE XL071-SQLCA  TO SQLCA                           33530000
335400             MOVE SQLCA        TO DP013-SQLCA                     33540000
335500             MOVE DK-OPER-UNT-ID   TO PV-DISP-OPER-UNT-ID         33550000
335600             STRING ' OPER = '                                    33560000
335700                    PV-DISP-OPER-UNT-ID                           33570000
335800                                        DELIMITED BY SIZE         33580000
335900                             INTO DP013-MESSAGE-TEXT (2)          33590000
336000             MOVE 'XLT00010 '   TO DP013-DB2-TABLE-NAME (1)       33600000
336100             SET DP013-DB2-ABEND                                  33610000
336200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               33620000
336300             PERFORM DP013-0000-PROCESS-ABEND                     33630000
336400     END-EVALUATE.                                                33640000
336500                                                                  33650000
336600*----------------------------------------------------------------*33660000
336700*     GET THE ACTUAL DATE .                                      *33670000
336800*----------------------------------------------------------------*33680000
336900                                                                  33690000
337000 4370-READ-INV-PARM.                                              33700000
337100                                                                  33710000
337200         EXEC SQL                                                 33720000
337300             SELECT                                               33730000
337400                    MAX (INV_DTE)                                 33740000
337500             INTO                                                 33750000
337600                    :XLT00025-INV-DTE :PV-NULL-IND                33760000
337700             FROM                                                 33770000
337800                    XLT_MDSE_INV_PARM                             33780000
337900             WHERE                                                33790000
338000                    LOC_NBR           =  :DK-STORE                33800000
338010               AND  ACTV_IND          =  'Y'                      33801000
338020               AND  LOC_INV_STAT_CDE  =  'IN'                     33802000
338100         END-EXEC.                                                33810000
338200                                                                  33820000
338300         EVALUATE TRUE                                            33830000
338400             WHEN SQLCODE = ZERO                                  33840000
338500                  IF PV-NULL-IND = 0                              33850000
338600                      MOVE XLT00025-INV-DTE                       33860000
338700                         TO PV-DB2-INV-FORMAT                     33870000
338800                  END-IF                                          33880000
338900             WHEN SQLCODE = +100                                  33890000
339000                  SET PS-ERROR    TO  TRUE                        33900000
339100             WHEN SQLCODE = -904                                  33910000
339200             WHEN SQLCODE = -913                                  33920000
339300                  PERFORM 9900-SOFT-ABORT                         33930000
339400             WHEN SQLWARN0 NOT = SPACES                           33940000
339500             WHEN SQLCODE NOT EQUAL ZERO                          33950000
339510                 MOVE DK-STORE TO PV-DISPLAY-STORE                33951000
339600                 MOVE '4370-READ-INV-PARM - 1'                    33960000
339700                                   TO DP013-PARAGRAPH             33970000
339800                 MOVE 'SELECT STORE NAME'                         33980000
339900                                   TO DP013-MESSAGE-TEXT (1)      33990000
340000                 STRING ' STORE = '                               34000000
340100                        PV-DISPLAY-STORE  DELIMITED BY SIZE       34010000
340200                             INTO DP013-MESSAGE-TEXT (2)          34020000
340300                 MOVE SQLCA        TO DP013-SQLCA                 34030000
340400                 MOVE 'XLT_MDSE_INV_PARM'                         34040000
340410                                   TO DP013-DB2-TABLE-NAME (1)    34041000
340500                 SET DP013-DB2-ABEND                              34050000
340600                     DP013-XCTL-DISPLAY-RESTART                   34060000
340700                                   TO TRUE                        34070000
340800                 PERFORM DP013-0000-PROCESS-ABEND                 34080000
340900         END-EVALUATE.                                            34090000
341000                                                                  34100000
341100     IF  SQLCODE EQUAL ZERO AND                                   34110000
341200         PV-NULL-IND = 0                                          34120000
341300                                                                  34130000
341400         EXEC SQL                                                 34140000
341500             SELECT                                               34150000
341600                    DC_CTOFF_DTE                                  34160000
341700             INTO                                                 34170000
341800                    :XLT00025-DC-CTOFF-DTE                        34180000
341900             FROM                                                 34190000
342000                    XLT_MDSE_INV_PARM                             34200000
342100             WHERE                                                34210000
342200                    LOC_NBR           =  :DK-STORE                34220000
342400               AND  INV_DTE           =  :PV-DB2-INV-FORMAT       34240000
342410               AND  ACTV_IND          =  'Y'                      34241000
342420               AND  LOC_INV_STAT_CDE  =  'IN'                     34242000
342500         END-EXEC                                                 34250000
342600                                                                  34260000
342700         EVALUATE TRUE                                            34270000
342800             WHEN SQLCODE = ZERO                                  34280000
342900             WHEN SQLCODE = +100                                  34290000
343000                 CONTINUE                                         34300000
343100             WHEN SQLCODE = -904                                  34310000
343200             WHEN SQLCODE = -913                                  34320000
343300                  PERFORM 9900-SOFT-ABORT                         34330000
343400             WHEN SQLWARN0 NOT = SPACES                           34340000
343500                 MOVE DK-STORE  TO  PV-DISPLAY-STORE              34350000
343600                 MOVE '4370-READ-INV-PARM - 2'                    34360000
343700                                   TO DP013-PARAGRAPH             34370000
343800                 MOVE 'SELECT STORE NAME'                         34380000
343900                                   TO DP013-MESSAGE-TEXT (1)      34390000
344000                 MOVE SQLCA        TO DP013-SQLCA                 34400000
344100                 STRING ' STORE = '                               34410000
344200                        PV-DISPLAY-STORE DELIMITED BY SIZE        34420000
344300                             INTO DP013-MESSAGE-TEXT (2)          34430000
344400                 MOVE 'XLT_MDSE_INV_PARM'                         34440000
344410                                   TO DP013-DB2-TABLE-NAME (1)    34441000
344500                 SET DP013-DB2-ABEND                              34450000
344600                     DP013-XCTL-DISPLAY-RESTART                   34460000
344700                                   TO TRUE                        34470000
344800                 PERFORM DP013-0000-PROCESS-ABEND                 34480000
344900         END-EVALUATE                                             34490000
345000     END-IF.                                                      34500000
345100                                                                  34510000
345200*----------------------------------------------------------------*34520000
345300*    FORMAT THE CUTOFF DATES.                                    *34530000
345400*----------------------------------------------------------------*34540000
345500                                                                  34550000
345600 4375-FMT-CUTOFF-DTS-FOR-CMPARE.                                  34560000
345700     PERFORM DP017-0000-GET-CURR-DATE-TIME.                       34570000
345800     MOVE DP017-CURRENT-DATE-YMD      TO DPG51-SYSTEM-DATE.       34580000
345900     SET  DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                    34590000
346000     SET  DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                    34600000
346100     MOVE ZERO                      TO DPG51-INCR-DECR-DAYS-9     34610000
346200                                       DPG51-INCR-DECR-BUS-DAYS-9.34620000
346300     SET  DPG52-LK-DTE-ISO-FMT        TO TRUE.                    34630000
346400                                                                  34640000
346500*    *------------------------------------------------------------34650000
346600*    * FORMAT THE CUTOFF DATE DATE FROM XLT_MDSE_INV_PARM         34660000
346700*    *------------------------------------------------------------34670000
346800     MOVE XLT00025-DC-CTOFF-DTE TO DPG52-LK-DATE-INPUT.           34680000
346900                                                                  34690000
347000     IF  XLT00025-DC-CTOFF-DTE EQUAL '9999-09-09'                 34700000
347100         MOVE XLT00025-DC-CTOFF-DTE                               34710000
347200           TO PV-ACTL-CTOFF-YYYYMMDD                              34720000
347300     ELSE                                                         34730000
347400         PERFORM 4385-CALL-CALENDAR-ROUTINE                       34740000
347500         MOVE DPG55-DB2-ISO-DATE TO PV-ACTL-CTOFF-YYYYMMDD        34750000
347600     END-IF.                                                      34760000
347700                                                                  34770000
347800*    *------------------------------------------------------------34780000
347900*    * FORMAT THE VERIFY DATE FORM TRECEIV.                       34790000
348000*    *------------------------------------------------------------34800000
348100     MOVE RECEIV-VERFYD-TMST  TO      PV-WORK-TMST.               34810000
348200     MOVE PV-WORK-TMST-1      TO      DPG52-LK-DATE-INPUT.        34820000
348300                                                                  34830000
348400     PERFORM 4385-CALL-CALENDAR-ROUTINE.                          34840000
348500     MOVE DPG55-DB2-ISO-DATE TO PV-VERIFY-DTE-YYYYMMDD.           34850000
348600                                                                  34860000
348700*    *------------------------------------------------------------34870000
348800*    * FORMAT THE RECEIPT DATE FORM TRECEIV.                      34880000
348900*    *------------------------------------------------------------34890000
349000     MOVE RECEIV-REC-TMST     TO      PV-WORK-TMST.               34900000
349100     MOVE PV-WORK-TMST-1      TO      DPG52-LK-DATE-INPUT.        34910000
349200                                                                  34920000
349300     PERFORM 4385-CALL-CALENDAR-ROUTINE.                          34930000
349400     MOVE DPG55-DB2-ISO-DATE TO PV-RECEIPT-DTE-YYYYMMDD.          34940000
349500                                                                  34950000
349600*    *------------------------------------------------------------34960000
349700*    * FORMAT THE CURRENT SYSTEM DATE.                            34970000
349800*    *------------------------------------------------------------34980000
349900     MOVE DP017-EDITED-DATE-YYYYMMDD TO DPG52-LK-DATE-INPUT.      34990000
350000                                                                  35000000
350100     PERFORM 4385-CALL-CALENDAR-ROUTINE.                          35010000
350200     MOVE DPG55-DB2-ISO-DATE TO PV-CURRENT-DTE-YYYYMMDD.          35020000
350300                                                                  35030000
350400 4380-CHCK-INV-DATE-FOR-UPDATE.                                   35040000
350500                                                                  35050000
350600**   MOVE SPACES TO                                               35060000
350700**       ASC-MESSAGE (ASC-BLK-SUB ASC-ITEM-SUB).                  35070000
350800**   IF  ASC-INTER-APPL-VERIFY                                    35080000
350900**        SET PS-CAN-UPDATE        TO TRUE                        35090000
351000**   END-IF.                                                      35100000
351100     IF ASC-DC-STORE-TYPE                                         35110000
351200          IF ((PV-VERIFY-DTE-YYYYMMDD < PV-ACTL-CTOFF-YYYYMMDD    35120000
351300          OR  PV-VERIFY-DTE-YYYYMMDD = PV-ACTL-CTOFF-YYYYMMDD)    35130000
351400          AND PV-CURRENT-DTE-YYYYMMDD > PV-ACTL-CTOFF-YYYYMMDD)   35140000
351500              SET ASC-UPDATE-NO (ASC-BLK-SUB ASC-ITEM-SUB)        35150000
351600                                TO TRUE                           35160000
351700**            MOVE 'DC CUTOFF PHY INV' TO                         35170000
351800**                ASC-MESSAGE (ASC-BLK-SUB ASC-ITEM-SUB)          35180000
351900              PERFORM 5510-ADD-TRIGGER-AUDIT-BEFORE               35190000
352000          END-IF                                                  35200000
352100      END-IF.                                                     35210000
352200     IF ASC-NOT-DC-STORE-TYPE                                     35220000
352300         IF ((PV-RECEIPT-DTE-YYYYMMDD < PV-ACTL-CTOFF-YYYYMMDD    35230000
352400         OR  PV-RECEIPT-DTE-YYYYMMDD  =   PV-ACTL-CTOFF-YYYYMMDD) 35240000
352500         AND PV-CURRENT-DTE-YYYYMMDD > PV-ACTL-CTOFF-YYYYMMDD)    35250000
352600              SET ASC-UPDATE-NO (ASC-BLK-SUB ASC-ITEM-SUB)        35260000
352700                                TO TRUE                           35270000
352800**            MOVE 'DC CUTOFF PHY INV' TO                         35280000
352900**                ASC-MESSAGE (ASC-BLK-SUB ASC-ITEM-SUB)          35290000
353000              PERFORM 5510-ADD-TRIGGER-AUDIT-BEFORE               35300000
353100          END-IF                                                  35310000
353200      END-IF.                                                     35320000
353300                                                                  35330000
353400 4385-CALL-CALENDAR-ROUTINE.                                      35340000
353500     CALL PC-CALENDAR-ROUTINE USING DPG51                         35350000
353600                                    DPG52                         35360000
353700                                    DPG53                         35370000
353800                                    DPG54                         35380000
353900                                    DPG55                         35390000
354000                                    DPG56.                        35400000
354100     EVALUATE TRUE                                                35410000
354200         WHEN DPG54-SEVERE-ERROR                                  35420000
354300         WHEN DPG54-DATE-INVALID                                  35430000
354400             MOVE '4385-CALL-CALENDAR-ROUTINE'                    35440000
354500                                   TO  DP013-PARAGRAPH            35450000
354600             MOVE 'ERROR DETECTED BY CALENDAR ROUTINE:'           35460000
354700                                   TO  DP013-MESSAGE-TEXT (1)     35470000
354800             MOVE DPG54-ERROR-MESSAGE                             35480000
354900                                   TO  DP013-MESSAGE-TEXT (2)     35490000
355000             MOVE DPG52-LK-DATE-INPUT                             35500000
355100                                   TO  DP013-MESSAGE-TEXT (3)     35510000
355200             SET DP013-LOGIC-ABEND TO  TRUE                       35520000
355300             PERFORM DP013-0000-PROCESS-ABEND                     35530000
355400     END-EVALUATE.                                                35540000
355500                                                                  35550000
355600 4390-CHECK-AP-CODE.                                              35560000
355700     IF RECDIS-AP-PRC-CDE = 'W' OR 'J' OR 'M'                     35570000
355800         SET ASC-UPDATE-NO (ASC-BLK-SUB ASC-ITEM-SUB)             35580000
355900                                TO TRUE                           35590000
356000     END-IF.                                                      35600000
356100                                                                  35610000
356200 4395-PROCESS-LINE-DATA.                                          35620000
356300     MOVE RECEIV-STATUS-CDE TO ASC-RECEIV-STATUS-CDE.             35630000
356400     MOVE RECEIV-ML-POST-TMST                                     35640000
356500                            TO ASC-RECEIV-ML-POST-TMST.           35650000
356600     IF PS-NOT-UPDATE-MODE                                        35660000
356700         MOVE DK-STR-NBR       TO ASC-STORE-NBR                   35670000
356800                               (ASC-BLK-SUB ASC-ITEM-SUB)         35680000
356900         MOVE RECITM-STATUS-CDE                                   35690000
357000                           TO ASC-STAT-CDE                        35700000
357100                              (ASC-BLK-SUB ASC-ITEM-SUB)          35710000
357200     END-IF.                                                      35720000
357300     IF  RECEIV-FS-POST-TMST NOT EQUAL TO                         35730000
357400         PC-DB2-DEFAULT-TMST                                      35740000
357500            SET ASC-CANT-UNVERIFY-FS                              35750000
357600                       TO  TRUE                                   35760000
357700     END-IF                                                       35770000
357800     IF  RECITM-STATUS-CDE NOT EQUAL 'VE'                         35780000
357900         SET ASC-CANT-UNVERIFY-ST                                 35790000
358000                       TO  TRUE                                   35800000
358100     END-IF                                                       35810000
358200     PERFORM 4340-SELECT-DRIVER-RATIO.                            35820000
358300     IF RECITM-STATUS-CDE = 'VE'                                  35830000
358400        MOVE  RECITM-VERFYD-TMST TO PV-WORK-TIMESTAMP             35840000
358500        MOVE  PV-WORK-YEAR       TO PV-DISPLAY-YEAR               35850000
358600        MOVE  PV-WORK-MONTH      TO PV-DISPLAY-MONTH              35860000
358700        MOVE  PV-WORK-DAY        TO PV-DISPLAY-DAY                35870000
358800        MOVE  '/'                TO PV-SLASH-1                    35880000
358900        MOVE  '/'                TO PV-SLASH-2                    35890000
359000        MOVE  PV-WORK-HH         TO PV-DISPLAY-HH                 35900000
359100        MOVE  PV-WORK-MIN        TO PV-DISPLAY-MM                 35910000
359200        MOVE  ':'                TO PV-COLON-1                    35920000
359300        MOVE  '('                TO PV-LEFT-PAREN                 35930000
359400        MOVE  PV-DISPLAY-DATE    TO PV-VRFY-DATE                  35940000
359500        MOVE  PV-DISPLAY-TIME    TO PV-VRFY-TIME                  35950000
359600        MOVE  ' - '              TO PV-SEPARATOR                  35960000
359700        MOVE  RECITM-VRFD-USR-ID TO PV-VRFY-USERID                35970000
359800        MOVE  ')'                TO PV-RIGHT-PAREN                35980000
359900        MOVE  PV-RECEIV-VRFY-INFO                                 35990000
360000                                 TO ASC-RECEIV-VRFY-INFO          36000000
360100     ELSE                                                         36010000
360200           MOVE SPACES       TO ASC-RECEIV-VRFY-INFO              36020000
360300     END-IF                                                       36030000
360400     MOVE RECITM-PREPK-RATO-QTY TO PV-DRIVER-RATIO                36040000
360500                                   ASC-DRIVER-RATIO.              36050000
360600     MOVE RECITM-ORD-LNE-NBR    TO DK-PO-DRIVER-LNE               36060000
360700                                   ASC-PO-DRIVER-LNE              36070000
360800                                   DK-PKSL-LNE-NBR.               36080000
360900     IF PS-NOT-UPDATE-MODE                                        36090000
361000         IF ASC-POST-VERIFIED-RECEIPT                             36100000
361010*            PERFORM 4360A-CHECK4-DC-FLUSH                        36101000
361020*            IF PS-DC-FLUSH-YES                                   36102000
361100                 PERFORM 4360-CHECK-INVENTORY-DATE                36110000
361200                 IF ASC-UPDATE-YES                                36120000
361300                                   (ASC-BLK-SUB ASC-ITEM-SUB)     36130000
361400                     PERFORM 4390-CHECK-AP-CODE                   36140000
361500                 END-IF                                           36150000
361510*            END-IF                                               36151000
361600         END-IF                                                   36160000
361700                                                                  36170000
361800         SET ASC-CAN-UPDATE (ASC-BLK-SUB ASC-ITEM-SUB)            36180000
361900                              TO TRUE                             36190000
362000         IF RECITM-STATUS-CDE = 'VE'                              36200000
362100             IF RECITM-VRFD-USR-ID (1:2) = 'TK'                   36210000
362200              OR RECITM-VRFD-USR-ID (1:2) = 'TC'                  36220000
362201              OR RECITM-VRFD-USR-ID (1:2) = 'TV'                  36220100
362202              OR SPACES                                           36220200
362300                 MOVE 'MANUAL' TO ASC-SOURCE                      36230000
362400                                  (ASC-BLK-SUB ASC-ITEM-SUB)      36240000
362500                                       ASC-KEY-VFY-SRC            36250000
362600             ELSE                                                 36260000
362700                 MOVE RECITM-VRFD-USR-ID TO ASC-SOURCE            36270000
362800                                  (ASC-BLK-SUB ASC-ITEM-SUB)      36280000
362900                                       ASC-KEY-VFY-SRC            36290000
363000              END-IF                                              36300000
363100         ELSE                                                     36310000
363200             MOVE DK-PO-DRIVER-LNE  TO DK-HOLD-LNE-NBR            36320000
363300             PERFORM 5460-SELECT-TDISTHD                          36330000
363400             IF PS-NO-TDISTHD-FOUND                               36340000
363500                 MOVE 'MANUAL' TO ASC-SOURCE                      36350000
363600                                  (ASC-BLK-SUB ASC-ITEM-SUB)      36360000
363700                 MOVE 'MANUAL' TO ASC-KEY-VFY-SRC                 36370000
363800             ELSE                                                 36380000
363900                 IF DISTHD-VRFD-TMST = PC-DB2-DEFAULT-TMST AND    36390000
364000                    DISTHD-TOT-CART-CNT > 0                       36400000
364100                     SET ASC-CANNOT-UPDATE                        36410000
364200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36420000
364300                              TO TRUE                             36430000
364400                 END-IF                                           36440000
364500                 IF DISTHD-TOT-CART-CNT = 0                       36450000
364600                     MOVE 'MANUAL' TO ASC-SOURCE                  36460000
364700                                 (ASC-BLK-SUB ASC-ITEM-SUB)       36470000
364800                     MOVE 'MANUAL' TO ASC-KEY-VFY-SRC             36480000
364900                 ELSE                                             36490000
365000                     IF (DISTHD-P2L-CART-CNT = 0                  36500000
365100                        AND (DISTHD-FCSE-CART-CNT > 0             36510000
365200                        OR DISTHD-INPK-CART-CNT > 0))             36520000
365300                          MOVE 'CASE' TO ASC-SOURCE               36530000
365400                               (ASC-BLK-SUB ASC-ITEM-SUB)         36540000
365500                          MOVE 'CASE' TO ASC-KEY-VFY-SRC          36550000
365600                     ELSE                                         36560000
365700                       IF (DISTHD-P2L-CART-CNT > 0                36570000
365800                         AND (DISTHD-FCSE-CART-CNT > 0            36580000
365900                           OR DISTHD-INPK-CART-CNT > 0))          36590000
366000                           MOVE 'P2L/CASE'                        36600000
366100                                         TO ASC-SOURCE            36610000
366200                                (ASC-BLK-SUB ASC-ITEM-SUB)        36620000
366300                           MOVE 'P2L/CASE' TO ASC-KEY-VFY-SRC     36630000
366400                       ELSE                                       36640000
366500                       IF (DISTHD-P2L-CART-CNT > 0                36650000
366600                          AND (DISTHD-FCSE-CART-CNT = 0           36660000
366700                          AND DISTHD-INPK-CART-CNT = 0))          36670000
366800                          MOVE 'P2L'  TO ASC-SOURCE               36680000
366900                                 (ASC-BLK-SUB ASC-ITEM-SUB)       36690000
367000                           MOVE 'P2L' TO ASC-KEY-VFY-SRC          36700000
367100                       ELSE                                       36710000
367200                           MOVE 'MANUAL' TO  ASC-SOURCE           36720000
367300                                 (ASC-BLK-SUB ASC-ITEM-SUB)       36730000
367400                           MOVE 'MANUAL' TO ASC-KEY-VFY-SRC       36740000
367500                       END-IF                                     36750000
367600                       END-IF                                     36760000
367700                     END-IF                                       36770000
367800                 END-IF                                           36780000
367900             END-IF                                               36790000
368000         END-IF                                                   36800000
368100     END-IF.                                                      36810000
368200                                                                  36820000
368300     PERFORM 4396-CALL-RCKUT128                                   36830000
368400*                                                                 36840000
370800     IF PS-UPDATE-MODE                                            37080000
370900         SUBTRACT LQW-PACKSLIP-PACKS (PV-UPDATE-SUB)              37090000
371000                         FROM  ASC-TOT-PKSLIP-PACKS               37100000
371100     END-IF.                                                      37110000
371200     IF PS-NOT-UPDATE-MODE                                        37120000
371300         MOVE RC074-TOTAL-INVC-PACK-QTY                           37130000
371400                               TO  ASC-PACKSLIP-PACKS             37140000
371500                                   (ASC-BLK-SUB ASC-ITEM-SUB)     37150000
371600         MOVE RC074-P2L-INVC-PACK-QTY                             37160000
371700                               TO  ASC-P2L-PKSLIP                 37170000
371800                                   (ASC-BLK-SUB ASC-ITEM-SUB)     37180000
371900         MOVE RC074-FCSE-INVC-PACK-QTY                            37190000
372000                               TO  ASC-CASE-PKSLIP                37200000
372100                                   (ASC-BLK-SUB ASC-ITEM-SUB)     37210000
372200     ELSE                                                         37220000
372300         MOVE RC074-TOTAL-INVC-PACK-QTY                           37230000
372400                               TO  LQW-PACKSLIP-PACKS             37240000
372500                                                (PV-UPDATE-SUB)   37250000
372600         MOVE RC074-P2L-INVC-PACK-QTY                             37260000
372700                               TO  LQW-P2L-PKSLIP (PV-UPDATE-SUB) 37270000
372800         MOVE RC074-FCSE-INVC-PACK-QTY                            37280000
372900                               TO  LQW-CASE-PKSLIP (PV-UPDATE-SUB)37290000
373000     END-IF.                                                      37300000
373100     ADD RC074-TOTAL-INVC-PACK-QTY                                37310000
373200                               TO  ASC-TOT-PKSLIP-PACKS.          37320000
373300     IF PS-UPDATE-MODE                                            37330000
373400         SUBTRACT LQW-ACTUAL-PACKS (PV-UPDATE-SUB)                37340000
373500                         FROM  ASC-TOT-ACTUAL-PACKS               37350000
373600     END-IF.                                                      37360000
373700     IF PS-NOT-UPDATE-MODE                                        37370000
373800         MOVE RC074-TOTAL-ACTL-PACK-QTY TO ASC-ACTUAL-PACKS       37380000
373900                                   (ASC-BLK-SUB ASC-ITEM-SUB)     37390000
374000         MOVE RC074-P2L-ACTL-PACK-QTY TO ASC-P2L-ACTUAL           37400000
374100                                   (ASC-BLK-SUB ASC-ITEM-SUB)     37410000
374200         MOVE RC074-FCSE-ACTL-PACK-QTY TO ASC-CASE-ACTUAL         37420000
374300                                   (ASC-BLK-SUB ASC-ITEM-SUB)     37430000
374400     ELSE                                                         37440000
374500         MOVE RC074-TOTAL-ACTL-PACK-QTY TO LQW-ACTUAL-PACKS       37450000
374600                                                  (PV-UPDATE-SUB) 37460000
374700         MOVE RC074-P2L-ACTL-PACK-QTY                             37470000
374800                                TO LQW-P2L-ACTUAL (PV-UPDATE-SUB) 37480000
374900         MOVE RC074-FCSE-ACTL-PACK-QTY                            37490000
375000                                TO LQW-CASE-ACTUAL (PV-UPDATE-SUB)37500000
375100     END-IF.                                                      37510000
375200     ADD RC074-TOTAL-ACTL-PACK-QTY TO ASC-TOT-ACTUAL-PACKS.       37520000
375300     IF PS-UPDATE-MODE                                            37530000
375400         SUBTRACT LQW-VRFYD-PACKS  (PV-UPDATE-SUB)                37540000
375500                         FROM  ASC-TOT-VERFYD-PACKS               37550000
375600     END-IF.                                                      37560000
375700     IF PS-NOT-UPDATE-MODE                                        37570000
375800         MOVE RC074-VERIFY-PACK-QTY TO ASC-VRFYD-PACKS            37580000
375900                                   (ASC-BLK-SUB ASC-ITEM-SUB)     37590000
376000     ELSE                                                         37600000
376100         MOVE RC074-VERIFY-PACK-QTY                               37610000
376200                               TO  LQW-VRFYD-PACKS (PV-UPDATE-SUB)37620000
376300     END-IF.                                                      37630000
376400     ADD RC074-VERIFY-PACK-QTY TO ASC-TOT-VERFYD-PACKS.           37640000
376500     IF  RECITM-STATUS-CDE EQUAL 'VE'                             37650000
376600         MOVE RC074-VERIFY-ODD-QTY TO PV-ODD-UNITS                37660000
376700     ELSE                                                         37670000
376800         MOVE RC074-ACTUAL-ODD-QTY TO PV-ODD-UNITS                37680000
376900     END-IF.                                                      37690000
377000     IF PS-UPDATE-MODE                                            37700000
377100         SUBTRACT LQW-ODD-UNITS (PV-UPDATE-SUB)                   37710000
377200                         FROM  ASC-TOT-ODD-UNITS                  37720000
377300     END-IF.                                                      37730000
377400     IF PS-NOT-UPDATE-MODE                                        37740000
377500         MOVE PV-ODD-UNITS     TO  ASC-ODD-UNITS                  37750000
377600                                   (ASC-BLK-SUB ASC-ITEM-SUB)     37760000
377700     ELSE                                                         37770000
377800         MOVE PV-ODD-UNITS     TO  LQW-ODD-UNITS (PV-UPDATE-SUB)  37780000
377900     END-IF.                                                      37790000
378000     ADD PV-ODD-UNITS      TO  ASC-TOT-ODD-UNITS.                 37800000
378100     MOVE PURCHS-DEPT-NBR  TO  ASC-DEPT-NBR.                      37810000
378200     IF PS-NOT-UPDATE-MODE                                        37820000
378300         MOVE RC074-TOTAL-ACTL-ITM-QTY  TO ASC-TOTAL-ACTL-ITM-QTY 37830000
378400                                   (ASC-BLK-SUB ASC-ITEM-SUB)     37840000
378500         MOVE RC074-VERIFY-ITM-QTY      TO ASC-VERIFY-ITM-QTY     37850000
378600                                   (ASC-BLK-SUB ASC-ITEM-SUB)     37860000
378700     ELSE                                                         37870000
378800         SUBTRACT LQW-TOTAL-ACTL-ITM-QTY (PV-UPDATE-SUB)          37880000
378900                                 FROM ASC-HDR-TOT-ACT-UNTS        37890000
379000         SUBTRACT LQW-VERIFY-ITM-QTY (PV-UPDATE-SUB)              37900000
379100                                 FROM ASC-HDR-TOT-VERFYD-UNTS     37910000
379200         MOVE RC074-TOTAL-ACTL-ITM-QTY  TO LQW-TOTAL-ACTL-ITM-QTY 37920000
379300                                     (PV-UPDATE-SUB)              37930000
379400         MOVE RC074-VERIFY-ITM-QTY      TO LQW-VERIFY-ITM-QTY     37940000
379500                                     (PV-UPDATE-SUB)              37950000
379600     END-IF.                                                      37960000
379700     ADD RC074-TOTAL-ACTL-ITM-QTY  TO ASC-HDR-TOT-ACT-UNTS.       37970000
379800     ADD RC074-VERIFY-ITM-QTY      TO ASC-HDR-TOT-VERFYD-UNTS.    37980000
379900                                                                  37990000
380000 4396-CALL-RCKUT128.                                              38000000
380100     INITIALIZE RC074-FIELDS.                                     38010000
380200     MOVE ASC-OPER-UNT-ID     TO RC074-OPER-UNT-ID.               38020000
380300     MOVE ASC-FCLTY-ID        TO RC074-FCLTY-ID.                  38030000
380400     MOVE ASC-PO-NBR          TO RC074-PO-NBR.                    38040000
380500     MOVE ASC-REC-SEQ-NBR     TO RC074-RCVR-SEQ-NBR.              38050000
380600     MOVE ASC-PACK-ID         TO RC074-PACK-ID.                   38060000
380700     MOVE DK-STR-NBR          TO RC074-STR-NBR.                   38070000
380800     MOVE ASC-AUTO-VE-SW      TO RC074-AUTO-VE-SW.                38080000
380900     SET RC074-PACK-QTY-YES   TO TRUE.                            38090000
381000                                                                  38100000
381100     CALL RC074-UNIT-CRTN-CNT-PGM USING  DFHEIBLK                 38110000
381200                                         RC074-COMMAREA           38120000
381300                                         RC074-FIELDS.            38130000
381400                                                                  38140000
381500     EVALUATE TRUE                                                38150000
381600         WHEN RC074-SUCCESSFUL                                    38160000
381700             CONTINUE                                             38170000
381800         WHEN OTHER                                               38180000
381810              MOVE SPACES TO PV-CICS-MSG-AREA                     38181000
381820              STRING ' RCKCS818 - '      DELIMITED BY SIZE        38182000
381830                     ' 4396-CALL-RCKUT128 '                       38183000
381840                                         DELIMITED BY SIZE        38184000
381850                     ' KEY INFO - '      DELIMITED BY SIZE        38185000
381860                     RC074-DISPLAY-PO    DELIMITED BY SIZE        38186000
381870                     ' - '               DELIMITED BY SIZE        38187000
381880                     RC074-DISPLAY-RCVR  DELIMITED BY SIZE        38188000
381890                     ' - '               DELIMITED BY SIZE        38189000
381891                     RC074-DISPLAY-PACK  DELIMITED BY SIZE        38189100
381892                     ' - '               DELIMITED BY SIZE        38189200
381893                     RC074-DISPLAY-STR   DELIMITED BY SIZE        38189300
381894                     ' - '               DELIMITED BY SIZE        38189400
381895                     RC074-DISPLAY-OPER  DELIMITED BY SIZE        38189500
381896                                  INTO PV-CICS-MSG-AREA           38189600
381897              MOVE LENGTH OF PV-CICS-MSG-AREA                     38189700
381898                                    TO PV-COMMAREA-LENGTH         38189800
381899              PERFORM 9700-WRITE-TO-CICS-LOG                      38189900
381900             MOVE '4396-CALL-RCKUT128'                            38190000
382000                                 TO DP013-PARAGRAPH               38200000
382100             STRING                                               38210000
382200                  'UNSUCCESSFUL CALL TO RCKUT128 '                38220000
382300                  'SUCCESS-IND = '                                38230000
382400                  RC074-SUCCESS-IND                               38240000
382500                               DELIMITED BY SIZE                  38250000
382600                               INTO DP013-MESSAGE-TEXT (1)        38260000
382700             MOVE RC074-CRA-RET-MSG                               38270000
382800                                 TO DP013-MESSAGE-TEXT (2)        38280000
382900             MOVE RC074-SQLCA    TO DP013-SQLCA                   38290000
383000             SET DP013-DB2-ABEND                                  38300000
383100                 DP013-XCTL-DISPLAY-RESTART                       38310000
383200                                 TO TRUE                          38320000
383300             PERFORM DP013-0000-PROCESS-ABEND                     38330000
383400     END-EVALUATE.                                                38340000
383500                                                                  38350000
383600/                                                                 38360000
383700*----------------------------------------------------------------*38370000
383800* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *38380000
383900*----------------------------------------------------------------*38390000
384000                                                                  38400000
384100 4400-MOVE-COMMAREA-TO-SCREEN.                                    38410000
384200     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             38420000
384300         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          38430000
384400         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          38440000
384500             MOVE +1    TO ASC-BLK-SUB                            38450000
384600             PERFORM 5100-WRITE-TEMP-STORAGE                      38460000
384700             ADD +1     TO ASC-BLK-SUB                            38470000
384800             PERFORM 5100-WRITE-TEMP-STORAGE                      38480000
384900             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             38490000
385000                 GIVING PV-BLOCK-NUMBER                           38500000
385100                 REMAINDER PV-REMAINDER                           38510000
385200             IF  PV-REMAINDER > ZERO                              38520000
385300                 ADD +1 TO PV-BLOCK-NUMBER                        38530000
385400             END-IF                                               38540000
385500             MOVE +1    TO ASC-BLK-SUB                            38550000
385600             PERFORM 4410-READ-TEMP-STORAGE                       38560000
385700             ADD +1     TO ASC-BLK-SUB                            38570000
385800                           PV-BLOCK-NUMBER                        38580000
385900             PERFORM 4410-READ-TEMP-STORAGE                       38590000
386000     END-IF.                                                      38600000
386100     MOVE +1            TO ASC-BLK-SUB.                           38610000
386200     COMPUTE ASC-ITEM-SUB =                                       38620000
386300         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              38630000
386400         + PC-ITEMS-PER-PANEL).                                   38640000
386500*                                                                 38650000
386600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        38660000
386700         ADD +1         TO ASC-BLK-SUB                            38670000
386800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            38680000
386900     END-IF.                                                      38690000
387000*                                                                 38700000
387100     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           38710000
387200         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                38720000
387300     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        38730000
387400     SET PS-ALL-LINES-PROTECTED TO TRUE.                          38740000
387500     PERFORM 4420-FORMAT-LIST-LINES                               38750000
387600         VARYING PV-SUB                                           38760000
387700         FROM PC-ITEMS-PER-PANEL BY -1                            38770000
387800         UNTIL PV-SUB < +1.                                       38780000
387900                                                                  38790000
388000     IF PS-ALL-LINES-PROTECTED                                    38800000
388100         MOVE -1                   TO ASTRTITL                    38810000
388200     END-IF.                                                      38820000
388300                                                                  38830000
388400*                                                                 38840000
388500     COMPUTE ASC-ITEMS-DISPLAYED =                                38850000
388600         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          38860000
388700     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    38870000
388800                                      ASTRTITO.                   38880000
388900     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    38890000
389000     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    38900000
389100     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            38910000
389200                                   TO ASELITO.                    38920000
389300*                                                                 38930000
389400     IF  DP020-MSG-NUMBER-X = SPACE                               38940000
389500         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  38950000
389600*            --- MORE ITEMS TO DISPLAY ----                       38960000
389700             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            38970000
389800             SET DP020-MSG-INFORMATIONAL TO TRUE                  38980000
389900         END-IF                                                   38990000
390000     END-IF.                                                      39000000
390100                                                                  39010000
390200     IF ASC-KEY-VFY-SRC = 'MANUAL'                                39020000
390300         MOVE 'MANUAL'           TO ATYPE1O                       39030000
390400         MOVE SPACES             TO ATYPE2O                       39040000
390500         MOVE 'CURR'             TO ATYPE3O                       39050000
390600         MOVE 'CURR'             TO ATYPE4O                       39060000
390700     ELSE                                                         39070000
390800         IF ASC-KEY-VFY-SRC = 'P2L'                               39080000
390900             MOVE '  P2L   '     TO ATYPE1O                       39090000
391000             MOVE SPACES         TO ATYPE2O                       39100000
391100             MOVE 'ACTL'         TO ATYPE3O                       39110000
391200             MOVE 'CURR'         TO ATYPE4O                       39120000
391300         ELSE                                                     39130000
391400            IF ASC-KEY-VFY-SRC = 'CASE'                           39140000
391500                MOVE '  CASE  '   TO ATYPE1O                      39150000
391600                MOVE SPACES       TO ATYPE2O                      39160000
391700                MOVE 'CURR'       TO ATYPE3O                      39170000
391800                MOVE 'CURR'       TO ATYPE4O                      39180000
391900            ELSE                                                  39190000
392000               IF ASC-KEY-VFY-SRC = 'P2L/CASE'                    39200000
392100                   MOVE '  P2L   '    TO ATYPE1O                  39210000
392200                   MOVE '  CASE  '    TO ATYPE2O                  39220000
392300                   MOVE 'ACTL'        TO ATYPE3O                  39230000
392400                   MOVE 'CURR'        TO ATYPE4O                  39240000
392500               END-IF                                             39250000
392600            END-IF                                                39260000
392700         END-IF                                                   39270000
392800      END-IF.                                                     39280000
392900                                                                  39290000
393000     MOVE ASC-SOURCE-TYPE          TO ASRCTYPO.                   39300000
393100     MOVE ASC-PO-NBR               TO APOO.                       39310000
393200     MOVE ASC-REC-SEQ-NBR          TO ARCVRO.                     39320000
393300     MOVE ASC-OPER-UNT-ID          TO AOPERO.                     39330000
393400     MOVE ASC-FCLTY-ID             TO AFCLTYO.                    39340000
393500     MOVE ASC-FCLTY-NME            TO ANAMEO.                     39350000
393600     MOVE ASC-PACK-ID              TO APACKO.                     39360000
393700     MOVE ASC-RECITM-STATUS-CDE    TO ASTATO.                     39370000
393800     MOVE ASC-RECEIV-VRFY-INFO     TO ADTETKO.                    39380000
393900     MOVE ASC-TOT-PKSLIP-PACKS     TO APCKSLPO.                   39390000
394000     MOVE ASC-TOT-ODD-UNITS        TO AODDO.                      39400000
394100     MOVE ASC-TOT-ACTUAL-PACKS     TO AACTUALO.                   39410000
394200     MOVE ASC-HDR-TOT-ACT-UNTS     TO ATACTUALO.                  39420000
394300     MOVE ASC-TOT-VERFYD-PACKS     TO AVERFYDO.                   39430000
394400     MOVE ASC-HDR-TOT-VERFYD-UNTS  TO ATVERFYDO.                  39440000
394500*----------------------------------------------------------------*39450000
394600*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *39460000
394700*----------------------------------------------------------------*39470000
394800                                                                  39480000
394900 4410-READ-TEMP-STORAGE.                                          39490000
395000                                                                  39500000
395100     EXEC CICS                                                    39510000
395200         READQ TS                                                 39520000
395300             QUEUE (ASC-LIST-QUEUE-NAME)                          39530000
395400             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               39540000
395500             ITEM  (PV-BLOCK-NUMBER)                              39550000
395600             RESP  (PV-CICS-RESP)                                 39560000
395700     END-EXEC.                                                    39570000
395800                                                                  39580000
395900     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       39590000
396000       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     39600000
396100         CONTINUE                                                 39610000
396200     ELSE                                                         39620000
396300         SET DP013-CICS-ABEND     TO TRUE                         39630000
396400         SET DP013-NO-ROLLBACK    TO TRUE                         39640000
396500         MOVE '4410-READ-TEMP-STORAGE'                            39650000
396600                                  TO DP013-PARAGRAPH              39660000
396700         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      39670000
396800                                  TO DP013-MESSAGE-TEXT(1)        39680000
396900         PERFORM DP013-0000-PROCESS-ABEND                         39690000
397000     END-IF.                                                      39700000
397100                                                                  39710000
397200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             39720000
397300*                                                                 39730000
397400     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         39740000
397500         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               39750000
397600     END-IF.                                                      39760000
397700 EJECT                                                            39770000
397800*----------------------------------------------------------------*39780000
397900*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *39790000
398000*----------------------------------------------------------------*39800000
398100                                                                  39810000
398200 4420-FORMAT-LIST-LINES.                                          39820000
398300     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      39830000
398400         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                39840000
398500         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           39850000
398600                                    MR-UPDATE-PACKSA (PV-SUB)     39860000
398700         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           39870000
398800                                    MR-UPDATE-PACKSH (PV-SUB)     39880000
398900         MOVE SPACE              TO MR-SELECTI (PV-SUB)           39890000
399000                                    MR-ACTION (PV-SUB)            39900000
399100                                    MR-UPDATE-PACKS-X (PV-SUB)    39910000
399200                                    MR-STORE-NBR-X (PV-SUB)       39920000
399300                                    MR-PACKSLIP-PACKS-X (PV-SUB)  39930000
399400                                    MR-ACTUAL-PACKS-X (PV-SUB)    39940000
399500                                    MR-VRFYD-PACKS-X (PV-SUB)     39950000
399600                                    MR-ODD-UNITS-X (PV-SUB)       39960000
399700                                    MR-SOURCE (PV-SUB)            39970000
399800                                    MR-P2L-PKSLIP-X (PV-SUB)      39980000
399900                                    MR-P2L-ACTUAL-X (PV-SUB)      39990000
400000                                    MR-CASE-PKSLIP-X (PV-SUB)     40000000
400100                                    MR-CASE-ACTUAL-X (PV-SUB)     40010000
400200     ELSE                                                         40020000
400300                                                                  40030000
400400         IF ASC-UPDATE-NO (ASC-BLK-SUB ASC-ITEM-SUB)              40040000
400500             MOVE DP015-ASK-DRK-OFF TO MR-SELECTA (PV-SUB)        40050000
400600                                       MR-UPDATE-PACKSA (PV-SUB)  40060000
400700             MOVE DP015-BLUE                                      40070000
400800                                    TO MR-UPDATE-PACKSC (PV-SUB)  40080000
400900                                       MR-SELECTC   (PV-SUB)      40090000
401000         ELSE                                                     40100000
401100             MOVE DP015-UNP-ALP-NOR-OFF                           40110000
401200                                     TO MR-SELECTA (PV-SUB)       40120000
401300                                        MR-UPDATE-PACKSA (PV-SUB) 40130000
401400             MOVE DP015-UNDERLINE    TO MR-SELECTH (PV-SUB)       40140000
401500                                        MR-UPDATE-PACKSH (PV-SUB) 40150000
401600             MOVE -1                TO MR-SELECTL (PV-SUB)        40160000
401700             MOVE DP015-GREEN                                     40170000
401800                                    TO MR-UPDATE-PACKSC (PV-SUB)  40180000
401900                                       MR-SELECTC   (PV-SUB)      40190000
402000             SET PS-ALL-LINES-NOT-PROTECTED TO TRUE               40200000
402100         END-IF                                                   40210000
402200                                                                  40220000
402300         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      40230000
402400                                                   > SPACE        40240000
402500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 40250000
402600                                 TO MR-SELECTI (PV-SUB)           40260000
402700         ELSE                                                     40270000
402800             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      40280000
402900                                 TO MR-SELECTI (PV-SUB)           40290000
403000         END-IF                                                   40300000
403100*                                                                 40310000
403200         IF  DP030-SET-CURSOR-TRAILER                             40320000
403300             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)40330000
403400                 > SPACE)                                         40340000
403500               OR (PV-SUB = 1))                                   40350000
403600                SET DP030-SET-CURSOR-APPL-1 TO TRUE               40360000
403700                MOVE -1          TO MR-SELECTL (PV-SUB)           40370000
403800             END-IF                                               40380000
403900         END-IF                                                   40390000
404000*                                                                 40400000
404100         IF  ASC-UPDATE-NO    (ASC-BLK-SUB ASC-ITEM-SUB)          40410000
404200             CONTINUE                                             40420000
404300         ELSE                                                     40430000
404400         IF  ASC-SEL-ZERO-YES (ASC-BLK-SUB ASC-ITEM-SUB)          40440000
404500             MOVE ASC-UPDATE-PACKS-N (ASC-BLK-SUB ASC-ITEM-SUB)   40450000
404600                                   TO PV-DISPLAY-ZERO             40460000
404700             MOVE PV-DISPLAY-ZERO  TO MR-UPDATE-PACKS-X (PV-SUB)  40470000
404800             MOVE DP015-UNP-ALP-NOR-MDT                           40480000
404900                                   TO MR-UPDATE-PACKSA (PV-SUB)   40490000
405000         ELSE                                                     40500000
405100             MOVE ASC-UPDATE-PACKS-N (ASC-BLK-SUB ASC-ITEM-SUB)   40510000
405200                                   TO PV-DISPLAY-NO-ZERO          40520000
405300             MOVE PV-DISPLAY-NO-ZERO                              40530000
405400                                   TO MR-UPDATE-PACKS-X (PV-SUB)  40540000
405500         END-IF                                                   40550000
405600         END-IF                                                   40560000
405700                                                                  40570000
405900             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           40590000
406000                                 TO MR-ACTION (PV-SUB)            40600000
406100                                                                  40610000
406200             IF ASC-RECEIV-STATUS-CDE = 'VE' AND                  40620000
406300                ASC-RECEIV-ML-POST-TMST NOT = PC-DB2-DEFAULT-TMST 40630000
406400                AND ASC-NOT-POST-VERIFIED-RECEIPT                 40640000
406500                 MOVE DP015-ASK-DRK-OFF                           40650000
406600                                 TO MR-UPDATE-PACKSA (PV-SUB)     40660000
406700                 MOVE DP015-HL-OFF                                40670000
406800                                 TO MR-UPDATE-PACKSH (PV-SUB)     40680000
406900             END-IF                                               40690000
407000             MOVE ASC-STORE-NBR (ASC-BLK-SUB ASC-ITEM-SUB)        40700000
407100                                 TO MR-STORE-NBR (PV-SUB)         40710000
407200                                    DK-STR-NBR                    40720000
407300             MOVE ASC-PACKSLIP-PACKS (ASC-BLK-SUB ASC-ITEM-SUB)   40730000
407400                                 TO MR-PACKSLIP-PACKS (PV-SUB)    40740000
407500             MOVE ASC-ACTUAL-PACKS (ASC-BLK-SUB ASC-ITEM-SUB)     40750000
407600                                 TO MR-ACTUAL-PACKS (PV-SUB)      40760000
407700             IF ASC-RECITM-STATUS-CDE = 'VE'                      40770000
407800                 MOVE ASC-VRFYD-PACKS (ASC-BLK-SUB ASC-ITEM-SUB)  40780000
407900                                 TO MR-VRFYD-PACKS (PV-SUB)       40790000
408000             ELSE                                                 40800000
408100                 MOVE SPACES     TO MR-VRFYD-PACKS-X (PV-SUB)     40810000
408200             END-IF                                               40820000
408300             MOVE ASC-ODD-UNITS (ASC-BLK-SUB ASC-ITEM-SUB)        40830000
408400                                 TO MR-ODD-UNITS (PV-SUB)         40840000
408500             MOVE ASC-SOURCE (ASC-BLK-SUB ASC-ITEM-SUB)           40850000
408600                                 TO MR-SOURCE (PV-SUB)            40860000
408700             IF ASC-RECITM-STATUS-CDE NOT = 'VE'                  40870000
408800                 MOVE DP015-YELLOW   TO MR-SOURCEC (PV-SUB)       40880000
408900             ELSE                                                 40890000
409000                 MOVE DP015-BLUE     TO MR-SOURCEC (PV-SUB)       40900000
409100             END-IF                                               40910000
409200                                                                  40920000
409300             IF ASC-P2L-PKSLIP (ASC-BLK-SUB ASC-ITEM-SUB) > 0     40930000
409400                 MOVE ASC-P2L-PKSLIP (ASC-BLK-SUB ASC-ITEM-SUB)   40940000
409500                       TO MR-P2L-PKSLIP (PV-SUB)                  40950000
409600                 MOVE ASC-P2L-ACTUAL (ASC-BLK-SUB ASC-ITEM-SUB)   40960000
409700                       TO MR-P2L-ACTUAL (PV-SUB)                  40970000
409800                 IF ASC-CASE-PKSLIP (ASC-BLK-SUB ASC-ITEM-SUB)    40980000
409900                               > 0                                40990000
410000                     MOVE ASC-CASE-PKSLIP                         41000000
410100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  41010000
410200                       TO MR-CASE-PKSLIP (PV-SUB)                 41020000
410300                     MOVE ASC-CASE-ACTUAL                         41030000
410400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  41040000
410500                       TO MR-CASE-ACTUAL (PV-SUB)                 41050000
410600                 ELSE                                             41060000
410700                     MOVE SPACES TO MR-CASE-PKSLIP-X (PV-SUB)     41070000
410800                                    MR-CASE-ACTUAL-X (PV-SUB)     41080000
410900                 END-IF                                           41090000
411000             ELSE                                                 41100000
411100                 MOVE ASC-CASE-PKSLIP (ASC-BLK-SUB ASC-ITEM-SUB)  41110000
411200                       TO MR-CASE-PKSLIP  (PV-SUB)                41120000
411300                 MOVE ASC-CASE-ACTUAL (ASC-BLK-SUB ASC-ITEM-SUB)  41130000
411400                       TO MR-CASE-ACTUAL  (PV-SUB)                41140000
411500                 MOVE SPACES TO MR-P2L-PKSLIP-X (PV-SUB)          41150000
411600                                MR-P2L-ACTUAL-X (PV-SUB)          41160000
411700             END-IF                                               41170000
411710                                                                  41171000
411810                                                                  41181000
411900         MOVE ASC-STORE-NBR (ASC-BLK-SUB ASC-ITEM-SUB)            41190000
412000                             TO DK-STR-NBR                        41200000
412100         PERFORM 7060-GET-TDISTDT                                 41210000
412200         IF SQLCODE = +0                                          41220000
412300             EVALUATE TRUE                                        41230000
412400             WHEN DISTDT-P2L-SPLT-UNT-QTY > 0 AND                 41240000
412500                 (DISTDT-FCSE-SPLT-UNT-QTY > 0 OR                 41250000
412600                  DISTDT-INPK-SPLT-UNT-QTY > 0)                   41260000
412700                 MOVE 'P2L/CASE' TO MR-SOURCE (PV-SUB)            41270000
412800                            ASC-SOURCE (ASC-BLK-SUB ASC-ITEM-SUB) 41280000
412900             WHEN DISTDT-P2L-SPLT-UNT-QTY > 0 AND                 41290000
413000                  DISTDT-FCSE-SPLT-UNT-QTY = 0 AND                41300000
413100                  DISTDT-INPK-SPLT-UNT-QTY = 0                    41310000
413200                 MOVE 'P2L'      TO MR-SOURCE (PV-SUB)            41320000
413300                            ASC-SOURCE (ASC-BLK-SUB ASC-ITEM-SUB) 41330000
413400             WHEN DISTDT-P2L-SPLT-UNT-QTY = 0 AND                 41340000
413500                 (DISTDT-FCSE-SPLT-UNT-QTY > 0 OR                 41350000
413600                  DISTDT-INPK-SPLT-UNT-QTY > 0)                   41360000
413700                 MOVE 'CASE'     TO MR-SOURCE (PV-SUB)            41370000
413800                            ASC-SOURCE (ASC-BLK-SUB ASC-ITEM-SUB) 41380000
413900                                                                  41390000
414200                                                                  41420000
414300             WHEN DISTDT-P2L-SPLT-UNT-QTY = 0 AND                 41430000
414400                  DISTDT-FCSE-SPLT-UNT-QTY = 0 AND                41440000
414500                  DISTDT-INPK-SPLT-UNT-QTY = 0                    41450000
414600                 MOVE 'MANUAL'   TO MR-SOURCE (PV-SUB)            41460000
414700                            ASC-SOURCE (ASC-BLK-SUB ASC-ITEM-SUB) 41470000
414800             END-EVALUATE                                         41480000
414900         ELSE                                                     41490000
415000             MOVE 'MANUAL'   TO MR-SOURCE (PV-SUB)                41500000
415100                            ASC-SOURCE (ASC-BLK-SUB ASC-ITEM-SUB) 41510000
415200         END-IF                                                   41520000
439000     END-IF.                                                      43900000
439010                                                                  43901000
439100     SUBTRACT +1 FROM ASC-ITEM-SUB                                43910000
439200     IF  ASC-ITEM-SUB < + 1                                       43920000
439300         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  43930000
439400         MOVE +1                 TO ASC-BLK-SUB                   43940000
439500     END-IF.                                                      43950000
439600                                                                  43960000
439700 4425-PROCESS-TRECDVS.                                            43970000
439800                                                                  43980000
439900         PERFORM 7075-FETCH-RECDVS.                               43990000
440000                                                                  44000000
440100         IF ASC-NO-MORE-RECDVS                                    44010000
440200             IF PV-RECDVS-COUNT = 0                               44020000
440300                MOVE 'MANUAL' TO MR-SOURCE (PV-SUB)               44030000
440400                             ASC-SOURCE (ASC-BLK-SUB ASC-ITEM-SUB)44040000
440500                MOVE ASC-P2L-PKSLIP                               44050000
440600                                 (ASC-BLK-SUB ASC-ITEM-SUB)       44060000
440700                               TO MR-P2L-PKSLIP (PV-SUB)          44070000
440800                MOVE ASC-P2L-ACTUAL (ASC-BLK-SUB ASC-ITEM-SUB)    44080000
440900                               TO MR-P2L-ACTUAL (PV-SUB)          44090000
441000             END-IF                                               44100000
441100         ELSE                                                     44110000
441200            MOVE 'P2L/CASE' TO MR-SOURCE (PV-SUB)                 44120000
441300            IF RECDVS-VRFY-SRC-CDE = 'CP'                         44130000
441400                IF ASC-DRIVER-RATIO > 0                           44140000
441500                    COMPUTE PV-PKSLIP-PACKS =                     44150000
441600                         RECDVS-EXPTED-ITM-QTY / ASC-DRIVER-RATIO 44160000
441700                ELSE                                              44170000
441800                    MOVE 0      TO PV-PKSLIP-PACKS                44180000
441900                END-IF                                            44190000
442000                MOVE PV-PKSLIP-PACKS                              44200000
442100                  TO MR-CASE-PKSLIP (PV-SUB)                      44210000
442200                IF ASC-ACTL-CONFIRMED                             44220000
442300                    IF ASC-DRIVER-RATIO > 0                       44230000
442400                       COMPUTE PV-ACTUAL-PACKS =                  44240000
442500                         RECDVS-VRFY-ITM-QTY / ASC-DRIVER-RATIO   44250000
442600                    ELSE                                          44260000
442700                        MOVE 0      TO PV-ACTUAL-PACKS            44270000
442800                    END-IF                                        44280000
442900                    MOVE PV-ACTUAL-PACKS                          44290000
443000                     TO MR-CASE-ACTUAL (PV-SUB)                   44300000
443100                ELSE                                              44310000
443200                   MOVE 0 TO MR-CASE-ACTUAL (PV-SUB)              44320000
443300                END-IF                                            44330000
443400            ELSE                                                  44340000
443500                IF ASC-DRIVER-RATIO > 0                           44350000
443600                    COMPUTE PV-PKSLIP-PACKS =                     44360000
443700                     RECDVS-EXPTED-ITM-QTY / ASC-DRIVER-RATIO     44370000
443800                ELSE                                              44380000
443900                    MOVE 0          TO PV-PKSLIP-PACKS            44390000
444000                END-IF                                            44400000
444100                MOVE PV-PKSLIP-PACKS                              44410000
444200                  TO MR-P2L-PKSLIP (PV-SUB)                       44420000
444300                IF ASC-ACTL-CONFIRMED                             44430000
444400                   MOVE RECDVS-VRFY-ITM-QTY                       44440000
444500                   TO MR-P2L-ACTUAL (PV-SUB)                      44450000
444600                ELSE                                              44460000
444700                   MOVE 0 TO MR-P2L-ACTUAL (PV-SUB)               44470000
444800                END-IF                                            44480000
444900            END-IF                                                44490000
445000         END-IF.                                                  44500000
445100                                                                  44510000
445200******************************************************************44520000
445300** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **44530000
445400** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **44540000
445500** ISSUE A WARNING.                                             **44550000
445600******************************************************************44560000
445700 4430-CHECK-FOR-BEGIN-AND-END.                                    44570000
445800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       44580000
445900         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     44590000
446000*            -- NO END-OF-RANGE SPECFIED ---                      44600000
446100             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            44610000
446200             SET DP020-MSG-WARNING TO TRUE                        44620000
446300             PERFORM 4431-POSITION-AT-WARNING                     44630000
446400         END-IF                                                   44640000
446500     ELSE                                                         44650000
446600         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     44660000
446700*            -- NO BEGINNING-OF-RANGE SPECFIED ---                44670000
446800             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            44680000
446900             SET DP020-MSG-WARNING TO TRUE                        44690000
447000             PERFORM 4431-POSITION-AT-WARNING                     44700000
447100         END-IF                                                   44710000
447200     END-IF.                                                      44720000
447210                                                                  44721001
447220                                                                  44722001
447540                                                                  44754001
447553******************************************************************44755300
447554** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **44755400
447560** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **44756000
447600** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **44760000
447700** POSITION THE CURSOR THERE.                                   **44770000
447800******************************************************************44780000
447900 4431-POSITION-AT-WARNING.                                        44790000
448000     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 44800000
448100                    - PV-TOP-ITEM + 1.                            44810000
448200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      44820000
448300         CONTINUE                                                 44830000
448400     ELSE                                                         44840000
448500         SET DP030-SET-CURSOR-APPL-1                              44850000
448600                                   TO TRUE                        44860000
448700         MOVE -1                   TO MR-SELECTL (PV-SUB)         44870000
448800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         44880000
448900         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         44890000
449000     END-IF.                                                      44900000
449100*                                                                 44910000
449200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   44920000
449300                    - PV-TOP-ITEM + 1.                            44930000
449400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      44940000
449500         CONTINUE                                                 44950000
449600     ELSE                                                         44960000
449700         SET DP030-SET-CURSOR-APPL-1                              44970000
449800                                   TO TRUE                        44980000
449900         MOVE -1                   TO MR-SELECTL (PV-SUB)         44990000
450000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         45000000
450100         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         45010000
450200     END-IF.                                                      45020000
450300                                                                  45030000
450310                                                                  45031001
450320*                                                                 45032001
450330*** DMH - 11-26-14 BEGIN                                          45033001
450340*                                                                 45034001
450350*----------------------------------------------------------------*45035001
450360* CHECK TO SEE IF USER HAS RACF AUTHORIZATION FOR EFC POST VE    *45036001
450361*** DMH - 11-26-14                                                45036101
450370*----------------------------------------------------------------*45037001
450380 4500-RACF-OVERRIDE.                                              45038001
450390                                                                  45039001
450391      SET DP008-RSRC-TYPE-FUNC           TO TRUE                  45039101
450392      MOVE 'EFCVEADJ'                    TO DP008-FUNCTION-NAME   45039201
450393      SET DP008-ACCESS-TYPE-USE          TO TRUE                  45039301
450394                                                                  45039401
450395      EXEC CICS                                                   45039501
450396         LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                 45039601
450397              COMMAREA (DP008-SECURITY-COMMAREA)                  45039701
450398              LENGTH (DP008-SECURITY-COMMAREA-LENGTH)             45039801
450399      END-EXEC                                                    45039901
450400                                                                  45040001
450401      IF DP008-CALL-SUCCESSFUL                                    45040101
450402         IF DP008-ACCESS-ALLOWED                                  45040201
450403             SET PS-RACF-OVERRIDE-YES  TO  TRUE                   45040301
450404         ELSE                                                     45040401
450405             SET PS-RACF-OVERRIDE-NO   TO TRUE                    45040501
450406         END-IF                                                   45040601
450407     ELSE                                                         45040701
450408             SET PS-RACF-OVERRIDE-NO   TO TRUE                    45040801
450409      END-IF.                                                     45040901
450410                                                                  45041001
450411                                                                  45041101
450412*----------------------------------------------------------------*45041201
450413* CHECK TO SEE CURR OPER ON RECEIVER IS FOR EFC                  *45041301
450414*** DMH - 11-26-14                                                45041401
450415*----------------------------------------------------------------*45041501
450416 4505-CHECK-EFC-CURR-OPER.                                        45041601
450417                                                                  45041701
450418         EXEC SQL                                                 45041801
450419              SELECT  B.E_BUS_IND                                 45041901
450420                    , A.CURR_OPER_UNT_ID                          45042001
450421                INTO :XLT00010-E-BUS-IND                          45042101
450422                    ,:RECEIV-CURR-OPER-UNT-ID                     45042201
450423                FROM  TRECEIV A                                   45042301
450424                    , XLT_LOC B                                   45042401
450425               WHERE  A.ORD_NBR           =  :DK-PO-NBR           45042501
450426                 AND  A.REC_SEQ_NBR       =  :DK-REC-SEQ-NBR      45042602
450427                 AND  A.VER_STATUS_CDE    =  'A'                  45042701
450428                 AND  A.CURR_OPER_UNT_ID  =   B.LOC_NBR           45042801
450429                 AND  B.LOC_TYP_CDE       =  'DC'                 45042901
450430                 AND  B.E_BUS_IND         =  'Y'                  45043001
450431         END-EXEC.                                                45043101
450432                                                                  45043201
450433         EVALUATE TRUE                                            45043301
450434             WHEN SQLCODE = +0                                    45043401
450435                  SET  PS-CURR-OPER-EFC-YES  TO  TRUE             45043501
450436                  PERFORM 4510-CHECK-WORK-ORDER-INST              45043601
450437             WHEN SQLCODE = +100                                  45043701
450438                  SET  PS-CURR-OPER-EFC-NO   TO  TRUE             45043801
450439             WHEN SQLCODE = -904                                  45043901
450440             WHEN SQLCODE = -911                                  45044001
450441             WHEN SQLCODE = -913                                  45044101
450442                  PERFORM 9900-SOFT-ABORT                         45044201
450443                                                                  45044301
450444             WHEN SQLWARN0 NOT = SPACES                           45044401
450445             WHEN SQLCODE < +0                                    45044501
450446             WHEN SQLCODE > +0                                    45044601
450447                  MOVE '4505-CHECK-EFC-CURR-OPER'                 45044701
450448                                  TO DP013-PARAGRAPH              45044801
450449                  MOVE 'CHECK CURR OPER FOR E-BUS-IND   '         45044901
450450                                  TO DP013-MESSAGE-TEXT (1)       45045001
450451                  MOVE SQLCA      TO DP013-SQLCA                  45045101
450452                  MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)     45045201
450453                  MOVE 'XLT00010' TO DP013-DB2-TABLE-NAME (2)     45045301
450454                  SET DP013-DB2-ABEND                             45045401
450455                      DP013-XCTL-DISPLAY-RESTART                  45045501
450456                                  TO TRUE                         45045601
450457                  PERFORM DP013-0000-PROCESS-ABEND                45045701
450458         END-EVALUATE.                                            45045801
450459                                                                  45045901
450460                                                                  45046001
450461*----------------------------------------------------------------*45046101
450462* CHECK TO SEE IF THERE ARE WORK ORDER INSTRUCTIONS              *45046201
450463*** DMH - 11-26-14                                                45046301
450464*----------------------------------------------------------------*45046401
450465 4510-CHECK-WORK-ORDER-INST.                                      45046501
450466                                                                  45046601
450467         EXEC SQL                                                 45046701
450468              SELECT  COUNT(*)                                    45046801
450469                INTO :PV-WORK-ORDER-INSTR-COUNT                   45046901
450470                FROM  TWKORIN                                     45047001
450471               WHERE  ORD_NBR         = :DK-PO-NBR                45047101
450472                 AND  RCVR_SEQ_NBR    = :DK-REC-SEQ-NBR           45047202
450473                 AND  VER_STATUS_CDE  =  'A'                      45047301
450474                                                                  45047401
450475         END-EXEC.                                                45047501
450476                                                                  45047601
450477         EVALUATE TRUE                                            45047701
450478             WHEN SQLCODE = +0                                    45047801
450479                  IF  PV-WORK-ORDER-INSTR-COUNT  > 0              45047901
450480                      SET  PS-HAS-WORK-ORDER-INST TO  TRUE        45048001
450481                  ELSE                                            45048101
450482                      PERFORM 4515-CHECK-WORK-ORDER               45048201
450483                  END-IF                                          45048301
450484                                                                  45048401
450485             WHEN SQLCODE = +100                                  45048501
450486                  PERFORM 4515-CHECK-WORK-ORDER                   45048601
450487                                                                  45048701
450488             WHEN SQLCODE = -904                                  45048801
450489             WHEN SQLCODE = -911                                  45048901
450490             WHEN SQLCODE = -913                                  45049001
450491                  PERFORM 9900-SOFT-ABORT                         45049101
450492                                                                  45049201
450493             WHEN SQLWARN0 NOT = SPACES                           45049301
450494             WHEN SQLCODE < +0                                    45049401
450495             WHEN SQLCODE > +0                                    45049501
450496                  MOVE '4510-CHECK-WORK-ORDER-INST'               45049601
450497                                  TO DP013-PARAGRAPH              45049701
450498                  MOVE 'CHECK FOR WORK ORDER INSTRUCTION'         45049801
450499                                  TO DP013-MESSAGE-TEXT (1)       45049901
450500                  MOVE SQLCA      TO DP013-SQLCA                  45050001
450501                  MOVE 'TWKORIN ' TO DP013-DB2-TABLE-NAME (1)     45050101
450502                  SET DP013-DB2-ABEND                             45050201
450503                      DP013-XCTL-DISPLAY-RESTART                  45050301
450504                                  TO TRUE                         45050401
450505                  PERFORM DP013-0000-PROCESS-ABEND                45050501
450506         END-EVALUATE.                                            45050601
450507                                                                  45050701
450508                                                                  45050801
450509*----------------------------------------------------------------*45050901
450510* CHECK TO SEE IF THERE IS A WORK ORDER                          *45051001
450511*** DMH - 11-26-14                                                45051101
450512*----------------------------------------------------------------*45051201
450513 4515-CHECK-WORK-ORDER.                                           45051301
450514                                                                  45051401
450515         EXEC SQL                                                 45051501
450516              SELECT  A.OPER_SET_ID                               45051601
450517                    , DFLT_OPER_SET_ID                            45051701
450518                INTO :WRKORD-OPER-SET-ID                          45051801
450519                    ,:COCNTL-DFLT-OPER-SET-ID                     45051901
450520                FROM  TWRKORD A                                   45052001
450521                    , TCOCNTL B                                   45052101
450522               WHERE  A.ORD_NBR        = :DK-PO-NBR               45052201
450523                 AND  A.RCVR_SEQ_NBR   = :DK-REC-SEQ-NBR          45052302
450524                 AND  A.VER_STATUS_CDE =  'A'                     45052401
450525                 AND  B.OPER_UNT_ID    = :RECEIV-CURR-OPER-UNT-ID 45052501
450526                                                                  45052601
450527         END-EXEC.                                                45052701
450528                                                                  45052801
450529         EVALUATE TRUE                                            45052901
450530             WHEN SQLCODE = +0                                    45053001
450531                  IF  WRKORD-OPER-SET-ID  >  0                    45053101
450532                      PERFORM 4535-INSERT-WORK-ORD-INST           45053201
450533                  ELSE                                            45053301
450534                      PERFORM 4525-INACTIVATE-0-WRKORD            45053401
450535                      PERFORM 4530-INSERT-TWRKORD                 45053501
450536                      PERFORM 4535-INSERT-WORK-ORD-INST           45053601
450537                  END-IF                                          45053701
450538                                                                  45053801
450539             WHEN SQLCODE = +100                                  45053901
450540                      PERFORM 4520-GET-DEFAULT-OP-SET             45054001
450541                      PERFORM 4530-INSERT-TWRKORD                 45054101
450542                      PERFORM 4535-INSERT-WORK-ORD-INST           45054201
450543                                                                  45054301
450544             WHEN SQLCODE = -904                                  45054401
450545             WHEN SQLCODE = -911                                  45054501
450546             WHEN SQLCODE = -913                                  45054601
450547                  PERFORM 9900-SOFT-ABORT                         45054701
450548                                                                  45054801
450549             WHEN SQLWARN0 NOT = SPACES                           45054901
450550             WHEN SQLCODE < +0                                    45055001
450551             WHEN SQLCODE > +0                                    45055101
450552                  MOVE '4515-CHECK-WORK-ORDER'                    45055201
450553                                  TO DP013-PARAGRAPH              45055301
450554                  MOVE 'CHECK FOR WORK ORDER '                    45055401
450555                                  TO DP013-MESSAGE-TEXT (1)       45055501
450556                  MOVE SQLCA      TO DP013-SQLCA                  45055601
450557                  MOVE 'TWRKORD ' TO DP013-DB2-TABLE-NAME (1)     45055701
450558                  SET DP013-DB2-ABEND                             45055801
450559                      DP013-XCTL-DISPLAY-RESTART                  45055901
450560                                  TO TRUE                         45056001
450561                  PERFORM DP013-0000-PROCESS-ABEND                45056101
450562         END-EVALUATE.                                            45056201
450563                                                                  45056301
450564                                                                  45056401
450565*----------------------------------------------------------------*45056501
450566* GET THE DEFAULT OP SET FROM TCOCNTL FOR WORK ORDER             *45056601
450567*** DMH - 11-26-14                                                45056701
450568*----------------------------------------------------------------*45056801
450569 4520-GET-DEFAULT-OP-SET.                                         45056901
450570                                                                  45057001
450571         EXEC SQL                                                 45057101
450572              SELECT                                              45057201
450573                      DFLT_OPER_SET_ID                            45057301
450574                INTO                                              45057401
450575                     :COCNTL-DFLT-OPER-SET-ID                     45057501
450576                FROM                                              45057601
450577                      TCOCNTL B                                   45057701
450578               WHERE                                              45057801
450579                      B.OPER_UNT_ID    = :RECEIV-CURR-OPER-UNT-ID 45057901
450580         END-EXEC.                                                45058001
450581                                                                  45058101
450582         EVALUATE TRUE                                            45058201
450583             WHEN SQLCODE = +0                                    45058301
450584                  CONTINUE                                        45058401
450585                                                                  45058501
450586             WHEN SQLCODE = -904                                  45058601
450587             WHEN SQLCODE = -911                                  45058701
450588             WHEN SQLCODE = -913                                  45058801
450589                  PERFORM 9900-SOFT-ABORT                         45058901
450590                                                                  45059001
450591             WHEN SQLWARN0 NOT = SPACES                           45059101
450592             WHEN SQLCODE < +0                                    45059201
450593             WHEN SQLCODE > +0                                    45059301
450594                  MOVE '4520-GET-DEFAULT-OP-SET'                  45059401
450595                                  TO DP013-PARAGRAPH              45059501
450596                  MOVE 'DEFAULT OP SET FROM TCOCNTL'              45059601
450597                                  TO DP013-MESSAGE-TEXT (1)       45059701
450598                  MOVE SQLCA      TO DP013-SQLCA                  45059801
450599                  MOVE 'TCOCNTL ' TO DP013-DB2-TABLE-NAME (1)     45059901
450600                  SET DP013-DB2-ABEND                             45060001
450601                      DP013-XCTL-DISPLAY-RESTART                  45060101
450602                                  TO TRUE                         45060201
450603                  PERFORM DP013-0000-PROCESS-ABEND                45060301
450604         END-EVALUATE.                                            45060401
450605                                                                  45060501
450606                                                                  45060601
450607*----------------------------------------------------------------*45060701
450608* INACTIVATE 0 OPER SET ID WORK ORDER                            *45060801
450609*** DMH - 11-26-14                                                45060901
450610*----------------------------------------------------------------*45061001
450611 4525-INACTIVATE-0-WRKORD.                                        45061101
450612                                                                  45061201
450613         EXEC SQL                                                 45061301
450614              UPDATE  TWRKORD                                     45061401
450615                 SET  VER_STATUS_CDE  =  'I'                      45061501
450616               WHERE  ORD_NBR         = :DK-PO-NBR                45061601
450617                 AND  RCVR_SEQ_NBR    = :DK-REC-SEQ-NBR           45061702
450618                 AND  OPER_SET_ID     = :WRKORD-OPER-SET-ID       45061801
450619                 AND  OPER_UNT_ID     = :RECEIV-CURR-OPER-UNT-ID  45061901
450620                 AND  FCLTY_ID        =  1                        45062001
450621         END-EXEC.                                                45062101
450622                                                                  45062201
450623         EVALUATE TRUE                                            45062301
450624             WHEN SQLCODE = +0                                    45062401
450625             WHEN SQLCODE = +100                                  45062501
450626                  CONTINUE                                        45062601
450627                                                                  45062701
450628             WHEN SQLCODE = -904                                  45062801
450629             WHEN SQLCODE = -911                                  45062901
450630             WHEN SQLCODE = -913                                  45063001
450631                  PERFORM 9900-SOFT-ABORT                         45063101
450632                                                                  45063201
450633             WHEN SQLWARN0 NOT = SPACES                           45063301
450634             WHEN SQLCODE < +0                                    45063401
450635             WHEN SQLCODE > +0                                    45063501
450636                  MOVE '4525-INACTIVATE-0-WRKORD'                 45063601
450637                                  TO DP013-PARAGRAPH              45063701
450638                  MOVE 'INACTIVATE - WORKORDER'                   45063801
450639                                  TO DP013-MESSAGE-TEXT (1)       45063901
450640                  MOVE SQLCA      TO DP013-SQLCA                  45064001
450641                  MOVE 'TWRKORD ' TO DP013-DB2-TABLE-NAME (1)     45064101
450642                  SET DP013-DB2-ABEND                             45064201
450643                      DP013-XCTL-DISPLAY-RESTART                  45064301
450644                                  TO TRUE                         45064401
450645                  PERFORM DP013-0000-PROCESS-ABEND                45064501
450646         END-EVALUATE.                                            45064601
450647                                                                  45064701
450648                                                                  45064801
450649*** DMH - 11-26-14                                                45064901
450650 4530-INSERT-TWRKORD.                                             45065001
450651                                                                  45065101
450652     INITIALIZE DCLTWRKORD.                                       45065201
450653                                                                  45065301
450654     MOVE RECEIV-CURR-OPER-UNT-ID  TO WRKORD-OPER-UNT-ID.         45065401
450655     MOVE COCNTL-DFLT-OPER-SET-ID  TO WRKORD-OPER-SET-ID.         45065501
450656                                                                  45065601
450657     MOVE DK-PO-NBR              TO WRKORD-ORD-NBR.               45065701
450658     MOVE DK-REC-SEQ-NBR         TO WRKORD-RCVR-SEQ-NBR.          45065802
450659                                                                  45065901
450660     MOVE 1                      TO WRKORD-FCLTY-ID.              45066001
450661     MOVE +1                     TO WRKORD-WORK-ORD-SEQ-NBR.      45066101
450662     MOVE ZERO                   TO WRKORD-ACTL-CART-CNT.         45066201
450663     MOVE +1                     TO WRKORD-EXPTED-CART-CNT.       45066301
450664     MOVE 'A'                    TO WRKORD-VER-STATUS-CDE.        45066401
450665     MOVE 'IP'                   TO WRKORD-STAT-CDE.              45066501
450666     MOVE 'N'                    TO WRKORD-WORK-ORD-DISTR-IND.    45066601
450667                                                                  45066701
450668     PERFORM 4600-INSERT-TWRKORD.                                 45066801
450669                                                                  45066901
450670                                                                  45067001
450671*----------------------------------------------------------------*45067101
450672* INSERT WORK ORDER INSTRUCTION                                  *45067201
450673*** DMH - 11-26-14                                                45067301
450674*----------------------------------------------------------------*45067401
450675 4535-INSERT-WORK-ORD-INST.                                       45067501
450676                                                                  45067601
450677     MOVE +0                     TO PV-WO-INSTR-SEQ-NBR.          45067701
450678     MOVE 'N'                    TO PS-TOSOPFA-CURSOR-SW.         45067801
450679     MOVE 'Y'                    TO PS-INSTRUCTION-SW.            45067901
450680                                                                  45068001
450681     PERFORM 4605-OPEN-TOSOPFA-CSR.                               45068101
450682     PERFORM 4610-FETCH-TOSOPFA-CSR.                              45068201
450683                                                                  45068301
450684     PERFORM UNTIL PS-EOF-TOSOPFA-CSR                             45068401
450685        PERFORM 4620-BUILD-WORK-ORDER-INSTR                       45068501
450686        PERFORM 4610-FETCH-TOSOPFA-CSR                            45068601
450687     END-PERFORM.                                                 45068701
450688                                                                  45068801
450689     PERFORM 4615-CLOSE-TOSOPFA-CSR.                              45068901
450690                                                                  45069001
450691                                                                  45069101
450692*----------------------------------------------------------------*45069201
450693* INSERT WORK ORDER                                              *45069301
450694*** DMH - 11-26-14                                                45069401
450695*----------------------------------------------------------------*45069501
450696 4600-INSERT-TWRKORD.                                             45069601
450697                                                                  45069701
450698     PERFORM                                                      45069801
450699         WITH TEST AFTER                                          45069901
450700         VARYING PV-RETRY-COUNTER                                 45070001
450701         FROM 1 BY 1                                              45070101
450702         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               45070201
450703             OR (SQLCODE = +0))                                   45070301
450704                                                                  45070401
450705         EXEC SQL                                                 45070501
450706              INSERT INTO TWRKORD                                 45070601
450707                     ( ORD_NBR                                    45070701
450708                      ,RCVR_SEQ_NBR                               45070801
450709                      ,ORD_LNE_NBR                                45070901
450710                      ,WORK_ORD_SEQ_NBR                           45071001
450711                      ,OPER_UNT_ID                                45071101
450712                      ,FCLTY_ID                                   45071201
450713                      ,CRE_TMST                                   45071301
450714                      ,VER_STATUS_CDE                             45071401
450715                      ,CRE_UID_ID                                 45071501
450716                      ,EXPTED_CART_CNT                            45071601
450717                      ,ACTL_CART_CNT                              45071701
450718                      ,EXPTED_ITM_CNT                             45071801
450719                      ,ACTL_ITM_CNT                               45071901
450720                      ,STAT_CDE                                   45072001
450721                      ,WORK_ORD_DISTR_IND                         45072101
450722                      ,OPER_SET_ID )                              45072201
450723              VALUES ( :WRKORD-ORD-NBR                            45072301
450724                      ,:WRKORD-RCVR-SEQ-NBR                       45072401
450725                      ,:WRKORD-ORD-LNE-NBR                        45072501
450726                      ,:WRKORD-WORK-ORD-SEQ-NBR                   45072601
450727                      ,:WRKORD-OPER-UNT-ID                        45072701
450728                      ,:WRKORD-FCLTY-ID                           45072801
450729                      ,CURRENT TIMESTAMP                          45072901
450730                      ,:WRKORD-VER-STATUS-CDE                     45073001
450731                      ,:DP020-USERID                              45073101
450732                      ,:WRKORD-EXPTED-CART-CNT                    45073201
450733                      ,:WRKORD-ACTL-CART-CNT                      45073301
450734                      ,:WRKORD-EXPTED-ITM-CNT                     45073401
450735                      ,:WRKORD-ACTL-ITM-CNT                       45073501
450736                      ,:WRKORD-STAT-CDE                           45073601
450737                      ,:WRKORD-WORK-ORD-DISTR-IND                 45073701
450738                      ,:WRKORD-OPER-SET-ID )                      45073801
450739         END-EXEC                                                 45073901
450740                                                                  45074001
450741         EVALUATE TRUE                                            45074101
450742             WHEN SQLCODE = +0                                    45074201
450743             WHEN SQLCODE = -904                                  45074301
450744             WHEN SQLCODE = -913                                  45074401
450745                 CONTINUE                                         45074501
450746                                                                  45074601
450747             WHEN SQLWARN0 NOT = SPACE                            45074701
450748             WHEN SQLCODE < +0                                    45074801
450749             WHEN SQLCODE > +0                                    45074901
450750                 MOVE WRKORD-ORD-NBR  TO PV-DISP-PO-NBR           45075001
450751                 MOVE WRKORD-RCVR-SEQ-NBR                         45075101
450752                                      TO PV-DISP-REC-SEQ-NBR      45075201
450753                 MOVE WRKORD-ORD-LNE-NBR                          45075301
450754                                      TO PV-DISP-LNE-NBR          45075401
450755                 MOVE WRKORD-OPER-UNT-ID                          45075501
450756                                      TO PV-DISP-OPER-UNT-ID      45075601
450757                 MOVE WRKORD-FCLTY-ID TO PV-DISP-FCLTY-ID         45075701
450758                 MOVE SQLCODE TO PV-DISP-SQLCODE                  45075801
450759                 STRING                                           45075901
450760                      ' 4600- SQL = '                             45076001
450761                      PV-DISP-SQLCODE                             45076101
450762                      ' PO= '                                     45076201
450763                      PV-DISP-PO-NBR                              45076301
450764                      ' SEQ= '                                    45076401
450765                      PV-DISP-REC-SEQ-NBR                         45076501
450766                      ' LINE= '                                   45076601
450767                      PV-DISP-LNE-NBR                             45076701
450768                      ' OPER= '                                   45076801
450769                      PV-DISP-OPER-UNT-ID                         45076901
450770                      ' FCLTY= '                                  45077001
450771                      PV-DISP-FCLTY-ID                            45077101
450772                                 DELIMITED BY SIZE                45077201
450773                               INTO DP013-MESSAGE-TEXT (1)        45077301
450774                 MOVE ' 4600-INSERT-TWRKORD  '                    45077401
450775                                  TO DP013-PARAGRAPH              45077501
450776                 MOVE SQLCA       TO DP013-SQLCA                  45077601
450777                 SET DP013-DB2-ABEND                              45077701
450778                     DP013-XCTL-DISPLAY-RESTART                   45077801
450779                                  TO TRUE                         45077901
450780                 PERFORM DP013-0000-PROCESS-ABEND                 45078001
450781         END-EVALUATE                                             45078101
450782     END-PERFORM.                                                 45078201
450783                                                                  45078301
450784     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        45078401
450785             AND (SQLCODE NOT = +0)                               45078501
450786         MOVE WRKORD-ORD-NBR  TO PV-DISP-PO-NBR                   45078601
450787         MOVE WRKORD-RCVR-SEQ-NBR                                 45078701
450788                              TO PV-DISP-REC-SEQ-NBR              45078801
450789         MOVE WRKORD-ORD-LNE-NBR                                  45078901
450790                              TO PV-DISP-LNE-NBR                  45079001
450791         MOVE WRKORD-OPER-UNT-ID                                  45079101
450792                              TO PV-DISP-OPER-UNT-ID              45079201
450793         MOVE WRKORD-FCLTY-ID TO PV-DISP-FCLTY-ID                 45079301
450794         MOVE SQLCODE TO PV-DISP-SQLCODE                          45079401
450795         STRING                                                   45079501
450796              ' 4600- SQL = '                                     45079601
450797              PV-DISP-SQLCODE                                     45079701
450798              ' PO= '                                             45079801
450799              PV-DISP-PO-NBR                                      45079901
450800              ' SEQ= '                                            45080001
450801              PV-DISP-REC-SEQ-NBR                                 45080101
450802              ' LINE= '                                           45080201
450803              PV-DISP-LNE-NBR                                     45080301
450804              ' OPER= '                                           45080401
450805              PV-DISP-OPER-UNT-ID                                 45080501
450806              ' FCLTY= '                                          45080601
450807              PV-DISP-FCLTY-ID                                    45080701
450808                         DELIMITED BY SIZE                        45080801
450809                               INTO DP013-MESSAGE-TEXT (1)        45080901
450810                 MOVE ' 4600-INSERT-TWRKORD  '                    45081001
450811                                  TO DP013-PARAGRAPH              45081101
450812                 MOVE SQLCA       TO DP013-SQLCA                  45081201
450813                 SET DP013-DB2-ABEND                              45081301
450814                     DP013-XCTL-DISPLAY-RESTART                   45081401
450815                                  TO TRUE                         45081501
450816                 PERFORM DP013-0000-PROCESS-ABEND                 45081601
450817     END-IF.                                                      45081701
450818                                                                  45081801
450819                                                                  45081901
450820*----------------------------------------------------------------*45082001
450821* OPEN THE TOSOPFA CURSOR                                        *45082101
450822*** DMH - 11-26-14                                                45082201
450823*----------------------------------------------------------------*45082301
450824                                                                  45082401
450825 4605-OPEN-TOSOPFA-CSR.                                           45082501
450826                                                                  45082601
450827     EXEC SQL                                                     45082701
450828          DECLARE TOSOPFA-CSR CURSOR FOR                          45082801
450829           SELECT OPER_SET_ID                                     45082901
450830                 ,OPER_ID                                         45083001
450831                 ,OPER_UNT_ID                                     45083101
450832                 ,FCLTY_ID                                        45083201
450833                 ,FCLTY_AREA_ID                                   45083301
450834                 ,PRC_FCLTY_AREA_ID                               45083401
450835                 ,SCRN_SEQ_NBR                                    45083501
450836           FROM   TOSOPFA                                         45083601
450837           WHERE  OPER_SET_ID    = :WRKORD-OPER-SET-ID            45083701
450838             AND  OPER_UNT_ID    = :RECEIV-CURR-OPER-UNT-ID       45083801
450839             AND  FCLTY_ID       =  1                             45083901
450840             AND  VER_STATUS_CDE = 'A'                            45084001
450841           ORDER BY SCRN_SEQ_NBR                                  45084101
450842     END-EXEC.                                                    45084201
450843                                                                  45084301
450844     PERFORM                                                      45084401
450845         WITH TEST AFTER                                          45084501
450846         VARYING PV-RETRY-COUNTER                                 45084601
450847         FROM 1 BY 1                                              45084701
450848         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               45084801
450849            OR (SQLCODE = +0))                                    45084901
450850                                                                  45085001
450851         EXEC SQL                                                 45085101
450852              OPEN TOSOPFA-CSR                                    45085201
450853         END-EXEC                                                 45085301
450854                                                                  45085401
450855         EVALUATE TRUE                                            45085501
450856             WHEN SQLCODE = +0                                    45085601
450857                  CONTINUE                                        45085701
450858             WHEN SQLCODE = -904                                  45085801
450859             WHEN SQLCODE = -913                                  45085901
450860                  CONTINUE                                        45086001
450861             WHEN SQLWARN0 NOT = SPACE                            45086101
450862             WHEN SQLCODE  NOT = +0                               45086201
450863                 MOVE WRKORD-OPER-SET-ID TO PV-DISP-OPER-SET      45086301
450864                 MOVE SQLCODE TO PV-DISP-SQLCODE                  45086401
450865                 STRING                                           45086501
450866                      ' 4605- SQL = '                             45086601
450867                      PV-DISP-SQLCODE                             45086701
450868                      ' OPER SET = '                              45086801
450869                      PV-DISP-OPER-SET                            45086901
450870                                 DELIMITED BY SIZE                45087001
450871                               INTO DP013-MESSAGE-TEXT (1)        45087101
450872                 MOVE ' 4605-OPEN-TOSOPFA-CSR'                    45087201
450873                                  TO DP013-PARAGRAPH              45087301
450874                 MOVE SQLCA       TO DP013-SQLCA                  45087401
450875                 SET DP013-DB2-ABEND                              45087501
450876                     DP013-XCTL-DISPLAY-RESTART                   45087601
450877                                  TO TRUE                         45087701
450878                 PERFORM DP013-0000-PROCESS-ABEND                 45087801
450879         END-EVALUATE                                             45087901
450880     END-PERFORM.                                                 45088001
450881                                                                  45088101
450882     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        45088201
450883             AND (SQLCODE NOT = +0)                               45088301
450884         MOVE WRKORD-OPER-SET-ID TO PV-DISP-OPER-SET              45088401
450885         MOVE SQLCODE TO PV-DISP-SQLCODE                          45088501
450886         STRING                                                   45088601
450887              ' 4605- SQL = '                                     45088701
450888              PV-DISP-SQLCODE                                     45088801
450889              ' OPER SET = '                                      45088901
450890              PV-DISP-OPER-SET                                    45089001
450891                         DELIMITED BY SIZE                        45089101
450892                               INTO DP013-MESSAGE-TEXT (1)        45089201
450893                 MOVE ' 4605-OPEN-TOSOPFA-CSR'                    45089301
450894                                  TO DP013-PARAGRAPH              45089401
450895                 MOVE SQLCA       TO DP013-SQLCA                  45089501
450896                 SET DP013-DB2-ABEND                              45089601
450897                     DP013-XCTL-DISPLAY-RESTART                   45089701
450898                                  TO TRUE                         45089801
450899                 PERFORM DP013-0000-PROCESS-ABEND                 45089901
450900     END-IF.                                                      45090001
450901                                                                  45090101
450902/                                                                 45090201
450903*----------------------------------------------------------------*45090301
450904*    FETCH A TOSOPFA ROW                                         *45090401
450905*** DMH - 11-26-14                                                45090501
450906*----------------------------------------------------------------*45090601
450907                                                                  45090701
450908 4610-FETCH-TOSOPFA-CSR.                                          45090801
450909                                                                  45090901
450910     EXEC SQL                                                     45091001
450911          FETCH TOSOPFA-CSR                                       45091101
450912          INTO :OSOPFA-OPER-SET-ID                                45091201
450913              ,:OSOPFA-OPER-ID                                    45091301
450914              ,:OSOPFA-OPER-UNT-ID                                45091401
450915              ,:OSOPFA-FCLTY-ID                                   45091501
450916              ,:OSOPFA-FCLTY-AREA-ID                              45091601
450917              ,:OSOPFA-PRC-FCLTY-AREA-ID                          45091701
450918              ,:OSOPFA-SCRN-SEQ-NBR                               45091801
450919     END-EXEC                                                     45091901
450920                                                                  45092001
450921     EVALUATE TRUE                                                45092101
450922         WHEN SQLCODE = +0                                        45092201
450923              CONTINUE                                            45092301
450924                                                                  45092401
450925         WHEN SQLCODE = +100                                      45092501
450926              SET PS-EOF-TOSOPFA-CSR TO TRUE                      45092601
450927                                                                  45092701
450928         WHEN SQLWARN0 NOT = SPACE                                45092801
450929         WHEN SQLCODE < +0                                        45092901
450930         WHEN SQLCODE > +0                                        45093001
450931             MOVE WRKORD-OPER-SET-ID TO PV-DISP-OPER-SET          45093101
450932             MOVE SQLCODE TO PV-DISP-SQLCODE                      45093201
450933             STRING                                               45093301
450934                  ' 4610- SQL = '                                 45093401
450935                  PV-DISP-SQLCODE                                 45093501
450936                  ' OPER SET = '                                  45093601
450937                  PV-DISP-OPER-SET                                45093701
450938                             DELIMITED BY SIZE                    45093801
450939                               INTO DP013-MESSAGE-TEXT (1)        45093901
450940                 MOVE ' 4610-FETCH-TOSOPFA-CSR'                   45094001
450941                                  TO DP013-PARAGRAPH              45094101
450942                 MOVE SQLCA       TO DP013-SQLCA                  45094201
450943                 SET DP013-DB2-ABEND                              45094301
450944                     DP013-XCTL-DISPLAY-RESTART                   45094401
450945                                  TO TRUE                         45094501
450946                 PERFORM DP013-0000-PROCESS-ABEND                 45094601
450947     END-EVALUATE.                                                45094701
450948                                                                  45094801
450949/                                                                 45094901
450950*----------------------------------------------------------------*45095001
450951* CLOSE THE TOSOPFA CURSOR                                       *45095101
450952*** DMH - 11-26-14                                                45095201
450953*----------------------------------------------------------------*45095301
450954                                                                  45095401
450955 4615-CLOSE-TOSOPFA-CSR.                                          45095501
450956                                                                  45095601
450957     EXEC SQL                                                     45095701
450958          CLOSE TOSOPFA-CSR                                       45095801
450959     END-EXEC                                                     45095901
450960                                                                  45096001
450961     EVALUATE TRUE                                                45096101
450962         WHEN SQLCODE = +0                                        45096201
450963              CONTINUE                                            45096301
450964         WHEN SQLWARN0 NOT = SPACE                                45096401
450965         WHEN SQLCODE  NOT = +0                                   45096501
450966             MOVE WRKORD-OPER-SET-ID  TO PV-DISP-OPER-SET         45096601
450967             MOVE SQLCODE TO PV-DISP-SQLCODE                      45096701
450968             STRING                                               45096801
450969                  ' 4615- SQL = '                                 45096901
450970                  PV-DISP-SQLCODE                                 45097001
450971                  ' OPER SET = '                                  45097101
450972                  PV-DISP-OPER-SET                                45097201
450973                             DELIMITED BY SIZE                    45097301
450974                               INTO DP013-MESSAGE-TEXT (1)        45097401
450975                 MOVE ' 4615-CLOSE-TOSOPFA-CSR'                   45097501
450976                                  TO DP013-PARAGRAPH              45097601
450977                 MOVE SQLCA       TO DP013-SQLCA                  45097701
450978                 SET DP013-DB2-ABEND                              45097801
450979                     DP013-XCTL-DISPLAY-RESTART                   45097901
450980                                  TO TRUE                         45098001
450981                 PERFORM DP013-0000-PROCESS-ABEND                 45098101
450982     END-EVALUATE.                                                45098201
450983                                                                  45098301
450984                                                                  45098401
450985*** DMH - 11-26-14                                                45098501
450986 4620-BUILD-WORK-ORDER-INSTR.                                     45098601
450987                                                                  45098701
450988     INITIALIZE DCLTWKORIN.                                       45098801
450989                                                                  45098901
450990     MOVE DK-PO-NBR              TO WKORIN-ORD-NBR.               45099001
450991     MOVE DK-REC-SEQ-NBR         TO WKORIN-RCVR-SEQ-NBR.          45099102
450992     MOVE +1                     TO WKORIN-WORK-ORD-SEQ-NBR.      45099201
450993     ADD +1                      TO PV-WO-INSTR-SEQ-NBR.          45099301
450994     MOVE PV-WO-INSTR-SEQ-NBR    TO WKORIN-WO-INSTR-SEQ-NBR.      45099401
450995     MOVE 'A'                    TO WKORIN-VER-STATUS-CDE.        45099501
450996     MOVE WRKORD-OPER-UNT-ID     TO WKORIN-OPER-UNT-ID.           45099601
450997     MOVE 1                      TO WKORIN-FCLTY-ID.              45099701
450998     MOVE OSOPFA-OPER-ID         TO WKORIN-OPER-ID.               45099801
450999     MOVE OSOPFA-FCLTY-AREA-ID   TO WKORIN-FCLTY-AREA-ID.         45099901
451000     MOVE OSOPFA-PRC-FCLTY-AREA-ID                                45100001
451001                                 TO WKORIN-PRC-FCLTY-AREA-ID.     45100101
451002     MOVE OSOPFA-SCRN-SEQ-NBR    TO WKORIN-SCREEN-SEQ-NBR.        45100201
451003     MOVE 'N'                    TO PS-INSTRUCTION-SW.            45100301
451004     MOVE 1                      TO WKORIN-EXPTED-CART-CNT.       45100401
451005     MOVE ZERO                   TO WKORIN-ACTL-CART-CNT.         45100501
451006     MOVE 'N'                    TO WKORIN-ALLOC-IND              45100601
451007                                    WKORIN-REPACK-IND.            45100701
451008     MOVE '9999-09-09-09.09.09.000000'                            45100801
451009                                 TO WKORIN-STRT-TMST              45100901
451010                                    WKORIN-STOP-TMST.             45101001
451011                                                                  45101101
451012     PERFORM 4630-INSERT-TWKORIN.                                 45101204
451013                                                                  45101301
451014                                                                  45101401
451015*** DMH - 11-26-14                                                45101501
451016 4630-INSERT-TWKORIN.                                             45101601
451017                                                                  45101701
451018     PERFORM                                                      45101801
451019         WITH TEST AFTER                                          45101901
451020         VARYING PV-RETRY-COUNTER                                 45102001
451021         FROM 1 BY 1                                              45102101
451022         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               45102201
451023             OR (SQLCODE = +0))                                   45102301
451024                                                                  45102401
451025         EXEC SQL                                                 45102501
451026              INSERT INTO TWKORIN                                 45102601
451027                     ( ORD_NBR                                    45102701
451028                      ,RCVR_SEQ_NBR                               45102801
451029                      ,ORD_LNE_NBR                                45102901
451030                      ,WORK_ORD_SEQ_NBR                           45103001
451031                      ,OPER_UNT_ID                                45103101
451032                      ,FCLTY_ID                                   45103201
451033                      ,WO_INSTR_SEQ_NBR                           45103301
451034                      ,CRE_TMST                                   45103401
451035                      ,VER_STATUS_CDE                             45103501
451036                      ,CRE_UID_ID                                 45103601
451037                      ,OPER_ID                                    45103701
451038                      ,FCLTY_AREA_ID                              45103801
451039                      ,PRC_FCLTY_AREA_ID                          45103901
451040                      ,EXPTED_CART_CNT                            45104001
451041                      ,ACTL_CART_CNT                              45104101
451042                      ,ALLOC_IND                                  45104201
451043                      ,REPACK_IND                                 45104301
451044                      ,STRT_TMST                                  45104401
451045                      ,STOP_TMST                                  45104501
451046                      ,SCREEN_SEQ_NBR                             45104601
451047                      ,LNE_LOC_CDE                                45104701
451048                      ,REC_SEL_IND )                              45104801
451049              VALUES ( :WKORIN-ORD-NBR                            45104901
451050                      ,:WKORIN-RCVR-SEQ-NBR                       45105001
451051                      ,:WKORIN-ORD-LNE-NBR                        45105101
451052                      ,:WKORIN-WORK-ORD-SEQ-NBR                   45105201
451053                      ,:WKORIN-OPER-UNT-ID                        45105301
451054                      ,:WKORIN-FCLTY-ID                           45105401
451055                      ,:WKORIN-WO-INSTR-SEQ-NBR                   45105501
451056                      ,CURRENT TIMESTAMP                          45105601
451057                      ,:WKORIN-VER-STATUS-CDE                     45105701
451058                      ,:DP020-USERID                              45105801
451059                      ,:WKORIN-OPER-ID                            45105901
451060                      ,:WKORIN-FCLTY-AREA-ID                      45106001
451061                      ,:WKORIN-PRC-FCLTY-AREA-ID                  45106101
451062                      ,:WKORIN-EXPTED-CART-CNT                    45106201
451063                      ,:WKORIN-ACTL-CART-CNT                      45106301
451064                      ,:WKORIN-ALLOC-IND                          45106401
451065                      ,:WKORIN-REPACK-IND                         45106501
451066                      ,:WKORIN-STRT-TMST                          45106601
451067                      ,:WKORIN-STOP-TMST                          45106701
451068                      ,:WKORIN-SCREEN-SEQ-NBR                     45106801
451069                      ,:WKORIN-LNE-LOC-CDE                        45106901
451070                      ,:WKORIN-REC-SEL-IND )                      45107001
451071         END-EXEC                                                 45107101
451072                                                                  45107201
451073         EVALUATE TRUE                                            45107301
451074             WHEN SQLCODE = +0                                    45107401
451075                  SET  PS-HAS-WORK-ORDER-INST TO  TRUE            45107501
451076                                                                  45107601
451077             WHEN SQLCODE = -904                                  45107701
451078             WHEN SQLCODE = -913                                  45107801
451079                 CONTINUE                                         45107901
451080                                                                  45108001
451081             WHEN SQLWARN0 NOT = SPACE                            45108101
451082             WHEN SQLCODE < +0                                    45108201
451083             WHEN SQLCODE > +0                                    45108301
451084                 MOVE WKORIN-ORD-NBR      TO PV-DISP-PO-NBR       45108401
451085                 MOVE WKORIN-RCVR-SEQ-NBR TO PV-DISP-REC-SEQ-NBR  45108501
451086                 MOVE WKORIN-ORD-LNE-NBR  TO PV-DISP-LNE-NBR      45108601
451087                 MOVE WKORIN-WORK-ORD-SEQ-NBR                     45108701
451088                                      TO PV-DISP-WO-SEQ-NBR       45108801
451089                 MOVE WKORIN-WO-INSTR-SEQ-NBR                     45108901
451090                                      TO PV-DISP-WO-INSTR-SEQ-NBR 45109001
451091                 MOVE SQLCODE TO PV-DISP-SQLCODE                  45109101
451092                 STRING                                           45109201
451093                      ' 4630- SQL = '                             45109301
451094                      PV-DISP-SQLCODE                             45109401
451095                      ' PO= '                                     45109501
451096                      PV-DISP-PO-NBR                              45109601
451097                      ' '                                         45109701
451098                      PV-DISP-REC-SEQ-NBR                         45109801
451099                      ' '                                         45109901
451100                      PV-DISP-LNE-NBR                             45110001
451101                      ' '                                         45110101
451102                      PV-DISP-WO-SEQ-NBR                          45110201
451103                      ' '                                         45110301
451104                      PV-DISP-WO-INSTR-SEQ-NBR                    45110401
451105                                 DELIMITED BY SIZE                45110501
451106                               INTO DP013-MESSAGE-TEXT (1)        45110601
451107                 MOVE ' 4630-INSERT-TWKORIN'                      45110701
451108                                  TO DP013-PARAGRAPH              45110801
451109                 MOVE SQLCA       TO DP013-SQLCA                  45110901
451110                 SET DP013-DB2-ABEND                              45111001
451111                     DP013-XCTL-DISPLAY-RESTART                   45111101
451112                                  TO TRUE                         45111201
451113                 PERFORM DP013-0000-PROCESS-ABEND                 45111301
451114         END-EVALUATE                                             45111401
451115     END-PERFORM.                                                 45111501
451116                                                                  45111601
451117     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        45111701
451118             AND (SQLCODE NOT = +0)                               45111801
451119         STRING                                                   45111901
451120              '4630-INSERT-TWKORIN '                              45112001
451121              'MAX RETRIES EXCEEDED ON INSERT ON TWKORIN'         45112101
451122                                 DELIMITED BY SIZE                45112201
451123                               INTO DP013-MESSAGE-TEXT (1)        45112301
451124                 MOVE ' 4630-INSERT-TWKORIN'                      45112401
451125                                  TO DP013-PARAGRAPH              45112501
451126                 MOVE SQLCA       TO DP013-SQLCA                  45112601
451127                 SET DP013-DB2-ABEND                              45112701
451128                     DP013-XCTL-DISPLAY-RESTART                   45112801
451129                                  TO TRUE                         45112901
451130                 PERFORM DP013-0000-PROCESS-ABEND                 45113001
451131     END-IF.                                                      45113101
451132                                                                  45113201
451133                                                                  45113301
451134*                                                                 45113401
451135*** DMH - 11-26-14 END                                            45113501
451136*                                                                 45113601
451137                                                                  45113701
451138                                                                  45113801
451139*----------------------------------------------------------------*45113901
451140* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *45114001
451141* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *45114100
451142* FOR THE SELECTED ITEMS QUEUE.                                  *45114200
451143*                                                                *45114300
451144* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *45114400
451150* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *45115000
451200* THE ARRAY IS FULL.                                             *45120000
451300*----------------------------------------------------------------*45130000
451400                                                                  45140000
451500 5000-PREPARE-SEL-QUEUE.                                          45150000
451600                                                                  45160000
451700     MOVE +1                   TO  ASC-BLK-SUB.                   45170000
451800     PERFORM 5100-WRITE-TEMP-STORAGE.                             45180000
451900     ADD +1                    TO  ASC-BLK-SUB.                   45190000
452000     PERFORM 5100-WRITE-TEMP-STORAGE.                             45200000
452100                                                                  45210000
452200     PERFORM 6010-DELETE-SEL-QUEUE.                               45220000
452300                                                                  45230000
452400                                                                  45240000
452500     EVALUATE TRUE                                                45250000
452600****    F15 - UPDATE                                              45260000
452700         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              45270000
452800****    F2  - CONFIRM                                             45280000
452900         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    45290000
453000             MOVE ZERO                 TO PV-SAVE-ITEM            45300000
453100                                                                  45310000
453200             PERFORM 5230-PROCESS-UPDATES                         45320000
453300                     VARYING PV-ITEM                              45330000
453400                     FROM 1 BY 1                                  45340000
453500                  UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN 45350000
453600                                                                  45360000
453700             IF  PS-TRECDIS-UPDATE-DONE                           45370000
453800             AND RECITM-STATUS-CDE = 'VE'                         45380000
453900                 PERFORM 8500-PROCESS-UNITS-WORK                  45390000
454000             END-IF                                               45400000
454100                                                                  45410000
454200             IF PS-RECS-UPDATED                                   45420000
454300                 MOVE PC-TSYMSG-00059                             45430000
454400                                 TO DP020-MSG-NUMBER              45440000
454500                 SET DP020-MSG-INFORMATIONAL                      45450000
454600                                 TO TRUE                          45460000
454700             END-IF                                               45470000
454800                                                                  45480000
455400             PERFORM 9000-UPDATE-SELECTION-QUEUE                  45540000
455500             INITIALIZE ASC-BLOCK-ENTRIES (1)                     45550000
455600                        ASC-BLOCK-ENTRIES (2)                     45560000
455700             MOVE +1             TO ASC-BLK-SUB                   45570000
455800                                                                  45580000
455900             MOVE ZERO           TO ASC-ITEM-SUB                  45590000
456000                                    ASC-NUMBER-OF-SELECTED-ITEMS  45600000
456100                                    ASC-START-OF-SELECTED-RANGE   45610000
456200                                    ASC-END-OF-SELECTED-RANGE     45620000
456300                                    ASC-ITEM-AT-TOP-OF-PANEL      45630000
456400                                                                  45640000
456500*            PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 45650000
456600             PERFORM 4410-READ-TEMP-STORAGE                       45660000
456700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 45670000
456800*            PERFORM 3200-RESET-ATTRIBUTES                        45680000
456900                                                                  45690000
457000                                                                  45700000
457100                                                                  45710000
457200****    F23 - TO STORE PACK ITEM LIST                             45720000
457300         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              45730000
457400             MOVE ASC-SEL-QUEUE-NAME-OUT TO RC036-SEL-QUEUE-NAME  45740000
457500             MOVE ASC-TRB-QUEUE-NAME-IN  TO RC036-TRB-QUEUE-NAME  45750000
457600             MOVE ASC-OPER-UNT-ID      TO RC036-OPER-UNT-ID       45760000
457700             MOVE ASC-FCLTY-ID         TO RC036-FCLTY-ID          45770000
457800             MOVE ASC-FCLTY-NME        TO RC036-FCLTY-NME         45780000
457900             MOVE ASC-PO-NBR           TO RC036-PO-NBR            45790000
458000             MOVE ASC-REC-SEQ-NBR      TO RC036-REC-SEQ-NBR       45800000
458100             SET ASC-UPDATE-TSQ        TO  TRUE                   45810000
458200                                                                  45820000
458300             SET RC037-IDX             TO  1                      45830000
458400             MOVE ZERO                 TO RC036-NUMBER-OF-TS-ITEMS45840000
458500             INITIALIZE RC037-SELECTED-ITEM-ARRAY                 45850000
458600                                                                  45860000
458700             PERFORM 5200-FILL-SEL-QUEUE-RECORD                   45870000
458800                     VARYING PV-ITEM                              45880000
458900                     FROM 1 BY 1                                  45890000
459000                  UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN 45900000
459100                                                                  45910000
459200             IF  RC037-IDX > 1                                    45920000
459300                 PERFORM 5205-WRITE-SEL-QUEUE                     45930000
459400                 ADD +1                TO RC036-NUMBER-OF-TS-ITEMS45940000
459500             END-IF                                               45950000
459600                                                                  45960000
459700     END-EVALUATE.                                                45970000
459800 EJECT                                                            45980000
459900*----------------------------------------------------------------*45990000
460000*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *46000000
460100*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *46010000
460200*----------------------------------------------------------------*46020000
460300                                                                  46030000
460400 5100-WRITE-TEMP-STORAGE.                                         46040000
460500     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     46050000
460600                                   TO PV-LIST-ITEM-NUMBER.        46060000
460700     COMPUTE PV-BLOCK-NUMBER =                                    46070000
460800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    46080000
460900                                                                  46090000
461000     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             46100000
461100     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             46110000
461200         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      46120000
461300             PERFORM 5105-REWRITE-ASC-LISTQ                       46130000
461400         END-IF                                                   46140000
461500     ELSE                                                         46150000
461600         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       46160000
461700         ASC-HIGHEST-BLOCK-WRITTEN + 1                            46170000
461800         PERFORM 5110-WRITE-ASC-LISTQ                             46180000
461900         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   46190000
462000     END-IF.                                                      46200000
462100                                                                  46210000
462200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             46220000
462300******************************************************************46230000
462400** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **46240000
462500** SPECIFIC COMMAREA.                                           **46250000
462600******************************************************************46260000
462700 5105-REWRITE-ASC-LISTQ.                                          46270000
462800     EXEC CICS                                                    46280000
462900         WRITEQ TS                                                46290000
463000             QUEUE (ASC-LIST-QUEUE-NAME)                          46300000
463100             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               46310000
463200             ITEM  (PV-BLOCK-NUMBER)                              46320000
463300             REWRITE                                              46330000
463400             RESP  (PV-CICS-RESP)                                 46340000
463500     END-EXEC.                                                    46350000
463600                                                                  46360000
463700     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           46370000
463800         CONTINUE                                                 46380000
463900     ELSE                                                         46390000
464000         SET DP013-CICS-ABEND            TO TRUE                  46400000
464100         SET DP013-NO-ROLLBACK           TO TRUE                  46410000
464200         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       46420000
464300         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     46430000
464400                                         TO DP013-MESSAGE-TEXT(1) 46440000
464500         PERFORM DP013-0000-PROCESS-ABEND                         46450000
464600     END-IF.                                                      46460000
464700                                                                  46470000
464800******************************************************************46480000
464900** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **46490000
465000** SPECIFIC COMMAREA.                                           **46500000
465100******************************************************************46510000
465200 5110-WRITE-ASC-LISTQ.                                            46520000
465300     EXEC CICS                                                    46530000
465400         WRITEQ TS                                                46540000
465500             QUEUE (ASC-LIST-QUEUE-NAME)                          46550000
465600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               46560000
465700             ITEM  (PV-BLOCK-NUMBER)                              46570000
465800             RESP  (PV-CICS-RESP)                                 46580000
465900     END-EXEC.                                                    46590000
466000     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      46600000
466100         SET DP013-CICS-ABEND      TO TRUE                        46610000
466200         SET DP013-NO-ROLLBACK     TO TRUE                        46620000
466300         MOVE '5110-WRITE-ASC-LISTQ'                              46630000
466400                                   TO DP013-PARAGRAPH             46640000
466500         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           46650000
466600                                   TO DP013-MESSAGE-TEXT(1)       46660000
466700         PERFORM DP013-0000-PROCESS-ABEND                         46670000
466800     END-IF.                                                      46680000
466900 EJECT                                                            46690000
467000*----------------------------------------------------------------*46700000
467100* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *46710000
467200* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *46720000
467300*----------------------------------------------------------------*46730000
467400                                                                  46740000
467500 5200-FILL-SEL-QUEUE-RECORD.                                      46750000
467600                                                                  46760000
467700     PERFORM 6112-READ-LIST-QUEUE.                                46770000
467800                                                                  46780000
467900     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       46790000
468000         PERFORM                                                  46800000
468100         VARYING LQW-IDX                                          46810000
468200         FROM 1 BY 1                                              46820000
468300         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            46830000
468400           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          46840000
468500                                                                  46850000
468600             IF  LQW-SELECT (LQW-IDX)                             46860000
468700                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              46870000
468800                                   TO RC037-ITEM (RC037-IDX)      46880000
468900                 MOVE ASC-OPER-UNT-ID                             46890000
469000                                 TO RC037-OPER-UNT-ID (RC037-IDX) 46900000
469100                 MOVE ASC-FCLTY-ID                                46910000
469200                                 TO RC037-FCLTY-ID (RC037-IDX)    46920000
469300                 MOVE ASC-PO-NBR                                  46930000
469400                                 TO RC037-PO-NBR (RC037-IDX)      46940000
469500                 MOVE ASC-REC-SEQ-NBR                             46950000
469600                                 TO RC037-REC-SEQ-NBR (RC037-IDX) 46960000
469700                 MOVE ASC-PACK-ID  TO RC037-PACK-ID (RC037-IDX)   46970000
469800                 MOVE LQW-STORE-NBR (LQW-IDX)                     46980000
469900                                   TO RC037-STR-NBR (RC037-IDX)   46990000
470000                 MOVE LQW-SOURCE (LQW-IDX)                        47000000
470100                                   TO RC037-SOURCE (RC037-IDX)    47010000
470200                 MOVE SPACE        TO RC037-ACTION-SW (RC037-IDX) 47020000
470300                 SET RC037-IDX UP BY 1                            47030000
470400                 IF  RC037-IDX > RC037-MAX-ITEMS                  47040000
470500                     PERFORM 5205-WRITE-SEL-QUEUE                 47050000
470600                     ADD +1        TO RC036-NUMBER-OF-TS-ITEMS    47060000
470700                     INITIALIZE RC037-SELECTED-ITEM-ARRAY         47070000
470800                     SET RC037-IDX TO  1                          47080000
470900                 END-IF                                           47090000
471000             END-IF                                               47100000
471100         END-PERFORM                                              47110000
471200     END-IF.                                                      47120000
471300                                                                  47130000
471400*----------------------------------------------------------------*47140000
471500*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *47150000
471600*----------------------------------------------------------------*47160000
471700                                                                  47170000
471800 5205-WRITE-SEL-QUEUE.                                            47180000
471900                                                                  47190000
472000     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            47200000
472100                                   TO RC037-SELECTED-ITEMS.       47210000
472200                                                                  47220000
472300     EXEC CICS                                                    47230000
472400          WRITEQ TS                                               47240000
472500              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      47250000
472600              FROM  (RC037-DC-SELECT-RECORD)                      47260000
472700              ITEM  (PV-SEL-QUEUE-ITEM)                           47270000
472800              RESP  (PV-CICS-RESP)                                47280000
472900     END-EXEC.                                                    47290000
473000                                                                  47300000
473100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          47310000
473200         CONTINUE                                                 47320000
473300     ELSE                                                         47330000
473400         SET DP013-CICS-ABEND      TO TRUE                        47340000
473500         SET DP013-NO-ROLLBACK     TO TRUE                        47350000
473600         MOVE '5205-WRITE-SEL-QUEUE'                              47360000
473700                                   TO DP013-PARAGRAPH             47370000
473800         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          47380000
473900                                   TO DP013-MESSAGE-TEXT(1)       47390000
474000         PERFORM DP013-0000-PROCESS-ABEND                         47400000
474100     END-IF.                                                      47410000
474200                                                                  47420000
474300                                                                  47430000
474400*----------------------------------------------------------------*47440000
474500*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *47450000
474600*----------------------------------------------------------------*47460000
474700                                                                  47470000
474800 5215-WRITE-SEL-QUEUE2.                                           47480000
474900                                                                  47490000
475000     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            47500000
475100                                   TO RC801-SELECTED-ITEMS.       47510000
475200                                                                  47520000
475300     EXEC CICS                                                    47530000
475400          WRITEQ TS                                               47540000
475500              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      47550000
475600              FROM  (RC801-PREPACK-SELECT-RECORD)                 47560000
475700              ITEM  (PV-SEL-QUEUE-ITEM)                           47570000
475800              RESP  (PV-CICS-RESP)                                47580000
475900     END-EXEC.                                                    47590000
476000                                                                  47600000
476100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          47610000
476200         CONTINUE                                                 47620000
476300     ELSE                                                         47630000
476400         SET DP013-CICS-ABEND      TO TRUE                        47640000
476500         SET DP013-NO-ROLLBACK     TO TRUE                        47650000
476600         MOVE '5215-WRITE-SEL-QUEUE2'                             47660000
476700                                   TO DP013-PARAGRAPH             47670000
476800         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          47680000
476900                                   TO DP013-MESSAGE-TEXT(1)       47690000
477000         PERFORM DP013-0000-PROCESS-ABEND                         47700000
477100     END-IF.                                                      47710000
477200                                                                  47720000
477300 5230-PROCESS-UPDATES.                                            47730000
477400                                                                  47740000
477500     PERFORM 6112-READ-LIST-QUEUE.                                47750000
477600     SET PS-DONT-UPDATE-QUEUE TO TRUE.                            47760000
477700                                                                  47770000
477800     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       47780000
477900         PERFORM                                                  47790000
478000         VARYING LQW-IDX                                          47800000
478100         FROM 1 BY 1                                              47810000
478200         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            47820000
478300           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          47830000
478400                                                                  47840000
478500             IF  LQW-SELECT (LQW-IDX)                             47850000
478600                 IF LQW-UPDATE-PACKS-N (LQW-IDX) > 0 OR           47860000
478700                    LQW-SEL-ZERO-SW (LQW-IDX)                     47870000
478800                     MOVE LQW-UPDATE-PACKS-N (LQW-IDX) TO         47880000
478900                                         PV-UPDATE-PACK-AMT       47890000
479000                                         PV-UPDATE-PACK           47900000
479100                     MOVE LQW-ACTUAL-PACKS (LQW-IDX) TO           47910000
479200                                         PV-ORIG-PACK-ACT         47920000
479300                     MOVE LQW-VRFYD-PACKS (LQW-IDX) TO            47930000
479400                                         PV-ORIG-PACK-VRF         47940000
479500                     MOVE LQW-STORE-NBR (LQW-IDX)                 47950000
479600                                      TO DK-STR-NBR               47960000
479700                     MOVE ASC-PACK-ID                             47970000
479800                                      TO DK-PREPK-ID              47980000
479900                     SET PS-RECS-UPDATED  TO TRUE                 47990000
480000                     SET PS-UPDATE-QUEUE  TO TRUE                 48000000
480100                     PERFORM 5240-UPDATE-PACK                     48010000
480200                     SET PS-UPDATE-MODE TO TRUE                   48020000
480300                     MOVE LQW-STORE-NBR (LQW-IDX)                 48030000
480400                                          TO DK-STR-NBR           48040000
480500                     PERFORM 5310-SELECT-STR-DATA                 48050000
480600                     SET PV-UPDATE-SUB   TO LQW-IDX               48060000
480700                     SET LQW-DESELECT (LQW-IDX) TO   TRUE         48070000
480800                     MOVE PC-UPD      TO LQW-ACTION (LQW-IDX)     48080000
480900                     MOVE LQW-SELECTED-SW (LQW-IDX)               48090000
481000                               TO LQW-TEMP-SELECTED-SW (LQW-IDX)  48100000
481100                     MOVE SPACES    TO LQW-UPDATE-PACKS (LQW-IDX) 48110000
481200                     PERFORM 4395-PROCESS-LINE-DATA               48120000
481300                 END-IF                                           48130000
481400             END-IF                                               48140000
481500         END-PERFORM                                              48150000
481600     END-IF.                                                      48160000
481700                                                                  48170000
481800     IF PS-UPDATE-QUEUE                                           48180000
481900         MOVE PV-ITEM          TO PV-SAVE-ITEM                    48190000
482000         PERFORM 6111-WRITE-LIST-QUEUE                            48200000
482100     END-IF.                                                      48210000
482200                                                                  48220000
482300 5240-UPDATE-PACK.                                                48230000
482400     MOVE ASC-OPER-UNT-ID      TO DK-OPER-UNT-ID.                 48240000
482500     MOVE ASC-FCLTY-ID         TO DK-FCLTY-ID.                    48250000
482600     MOVE ASC-PO-NBR           TO DK-PO-NBR.                      48260000
482700     MOVE ASC-REC-SEQ-NBR      TO DK-REC-SEQ-NBR.                 48270000
482800     MOVE ASC-PACK-ID          TO DK-UPDATE-PACK-ID.              48280000
482900     PERFORM 5250-OPEN-CURSOR.                                    48290000
483000     PERFORM 5260-FETCH-CURSOR UNTIL PS-EOC-PAC-CSR.              48300000
483100     PERFORM 5270-CLOSE-CURSOR.                                   48310000
483200     IF  PS-TRECDIS-UPDATE-DONE                                   48320000
483300     AND RECITM-STATUS-CDE = 'VE'                                 48330000
483400         MOVE  ASC-PO-NBR              TO PC241-PO-NBR            48340000
483500         MOVE  DK-DRIVER-LNE-NBR       TO PC241-PO-LNE-NBR        48350000
483600         MOVE  ASC-REC-SEQ-NBR         TO PC241-REC-SEQ-NBR       48360000
483700         MOVE  ASC-OPER-UNT-ID         TO PC241-OPER-UNT-ID       48370000
483800         MOVE  ASC-FCLTY-ID            TO PC241-FCLTY-ID          48380000
483900         MOVE  DK-STR-NBR              TO PC241-STR-NBR           48390000
484000*        MOVE  PV-SAVE-ITM-QTY         TO PC241-STR-ADJ-QTY       48400000
484100         MOVE  PV-UPDATE-PACK-DIF      TO PC241-STR-ADJ-QTY       48410000
484200         ADD   1                       TO PV-VRFY-ITEM            48420000
484300         PERFORM 6150-WRITE-VRFY-ADJ-QUEUE                        48430000
484400     END-IF.                                                      48440000
484500                                                                  48450000
484600 5250-OPEN-CURSOR.                                                48460000
484700                                                                  48470000
484800     EXEC SQL                                                     48480000
484900          OPEN PACK-CURSOR                                        48490000
485000     END-EXEC.                                                    48500000
485100                                                                  48510000
485200     EVALUATE TRUE                                                48520000
485300         WHEN SQLCODE = ZERO                                      48530000
485400             SET PS-NOT-EOC-PAC-CSR TO TRUE                       48540000
485500         WHEN SQLWARN0 NOT = SPACES                               48550000
485600         WHEN SQLCODE < ZERO                                      48560000
485700         WHEN SQLCODE > ZERO                                      48570000
485800             MOVE '5250-OPEN-CURSOR'                              48580000
485900                               TO DP013-PARAGRAPH                 48590000
486000             MOVE 'OPEN PACK CURSOR - '                           48600000
486100                               TO DP013-MESSAGE-TEXT (1)          48610000
486200             MOVE DK-PO-NBR        TO PV-DISP-PO-NBR              48620000
486300             MOVE DK-OPER-UNT-ID   TO PV-DISP-OPER-UNT-ID         48630000
486400             MOVE DK-FCLTY-ID      TO PV-DISP-FCLTY-ID            48640000
486500             MOVE DK-REC-SEQ-NBR   TO PV-DISP-REC-SEQ-NBR         48650000
486600             MOVE DK-UPDATE-PACK-ID TO PV-DISP-PREPK-ID           48660000
486700             STRING ' PO = '                                      48670000
486800                    PV-DISP-PO-NBR                                48680000
486900                    ' RECV ='                                     48690000
487000                    PV-DISP-REC-SEQ-NBR                           48700000
487100                    ' OPER = '                                    48710000
487200                    PV-DISP-OPER-UNT-ID                           48720000
487300                    ' FCLTY = '                                   48730000
487400                    PV-DISP-FCLTY-ID                              48740000
487500                    ' PACK ='                                     48750000
487600                    PV-DISP-PREPK-ID    DELIMITED BY SIZE         48760000
487700                             INTO DP013-MESSAGE-TEXT (2)          48770000
487800             MOVE SQLCA        TO DP013-SQLCA                     48780000
487900             MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (1)        48790000
488000             MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (2)        48800000
488100             SET DP013-DB2-ABEND                                  48810000
488200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               48820000
488300             PERFORM DP013-0000-PROCESS-ABEND                     48830000
488400     END-EVALUATE.                                                48840000
488500                                                                  48850000
488600 5260-FETCH-CURSOR.                                               48860000
488700                                                                  48870000
488800     EXEC SQL                                                     48880000
488900          FETCH PACK-CURSOR                                       48890000
489000          INTO  :PV-REC-TYPE                                      48900000
489100              , :RECDIS-ORD-LNE-NBR                               48910000
489200              , :RECDIS-VERIFY-ITM-QTY                            48920000
489300              , :RECDIS-AP-VERIFY-ITM-QTY                         48930000
489400              , :RECITM-PREPK-RATO-QTY                            48940000
489500              , :RECITM-STATUS-CDE                                48950000
489600              , :RECITM-PREPK-DRV-LNE-CDE                         48960000
489700     END-EXEC.                                                    48970000
489800                                                                  48980000
489900     EVALUATE TRUE                                                48990000
490000         WHEN SQLCODE = ZERO                                      49000000
490100             PERFORM 5280-UPDATE-RECDIS                           49010000
490200             IF RECITM-PREPK-DRV-LNE-CDE = 'A'                    49020000
490300                 MOVE RECDIS-ORD-LNE-NBR TO DK-DRIVER-LNE-NBR     49030000
490400             END-IF                                               49040000
490500             MOVE RECDIS-ORD-LNE-NBR       TO DK-LNE-NBR          49050000
490600             PERFORM 7020-SELECT-PURITM-DATA                      49060000
490700             IF PV-PURITM-UNT-QTY GREATER THAN ZERO               49070000
490800                 IF RECITM-STATUS-CDE = 'VE'                      49080000
490900                     PERFORM 5800-CHECK-PO-STATUS                 49090000
491000                 END-IF                                           49100000
491100             END-IF                                               49110000
491200                                                                  49120000
491310         WHEN SQLCODE = +100                                      49131000
491400             SET PS-EOC-PAC-CSR TO TRUE                           49140000
491500         WHEN SQLWARN0 NOT = SPACES                               49150000
491600         WHEN SQLCODE < ZERO                                      49160000
491700         WHEN SQLCODE > ZERO                                      49170000
491800             MOVE '5260-FETCH-CURSOR'                             49180000
491900                               TO DP013-PARAGRAPH                 49190000
492000             MOVE 'FETCH PACK CURSOR - '                          49200000
492100                               TO DP013-MESSAGE-TEXT (1)          49210000
492200             MOVE DK-PO-NBR        TO PV-DISP-PO-NBR              49220000
492300             MOVE DK-OPER-UNT-ID   TO PV-DISP-OPER-UNT-ID         49230000
492400             MOVE DK-FCLTY-ID      TO PV-DISP-FCLTY-ID            49240000
492500             MOVE DK-REC-SEQ-NBR   TO PV-DISP-REC-SEQ-NBR         49250000
492600             MOVE DK-UPDATE-PACK-ID TO PV-DISP-PREPK-ID           49260000
492700             STRING ' PO = '                                      49270000
492800                    PV-DISP-PO-NBR                                49280000
492900                    ' RECV ='                                     49290000
493000                    PV-DISP-REC-SEQ-NBR                           49300000
493100                    ' OPER = '                                    49310000
493200                    PV-DISP-OPER-UNT-ID                           49320000
493300                    ' FCLTY = '                                   49330000
493400                    PV-DISP-FCLTY-ID                              49340000
493500                    ' PACK ='                                     49350000
493600                    PV-DISP-PREPK-ID    DELIMITED BY SIZE         49360000
493700                             INTO DP013-MESSAGE-TEXT (2)          49370000
493800             MOVE SQLCA        TO DP013-SQLCA                     49380000
493900             MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (1)        49390000
494000             MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (2)        49400000
494100             SET DP013-DB2-ABEND                                  49410000
494200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               49420000
494300             PERFORM DP013-0000-PROCESS-ABEND                     49430000
494400     END-EVALUATE.                                                49440000
494500                                                                  49450000
494600 5270-CLOSE-CURSOR.                                               49460000
494700                                                                  49470000
494800     EXEC SQL                                                     49480000
494900          CLOSE PACK-CURSOR                                       49490000
495000     END-EXEC.                                                    49500000
495100                                                                  49510000
495200     EVALUATE TRUE                                                49520000
495300         WHEN SQLCODE = ZERO                                      49530000
495400             CONTINUE                                             49540000
495500         WHEN SQLWARN0 NOT = SPACES                               49550000
495600         WHEN SQLCODE < ZERO                                      49560000
495700         WHEN SQLCODE > ZERO                                      49570000
495800             MOVE '5270-CLOSE-CURSOR'                             49580000
495900                               TO DP013-PARAGRAPH                 49590000
496000             MOVE 'CLOSE PACK CURSOR - '                          49600000
496100                               TO DP013-MESSAGE-TEXT (1)          49610000
496200             MOVE DK-PO-NBR        TO PV-DISP-PO-NBR              49620000
496300             MOVE DK-OPER-UNT-ID   TO PV-DISP-OPER-UNT-ID         49630000
496400             MOVE DK-FCLTY-ID      TO PV-DISP-FCLTY-ID            49640000
496500             MOVE DK-REC-SEQ-NBR   TO PV-DISP-REC-SEQ-NBR         49650000
496600             MOVE DK-UPDATE-PACK-ID TO PV-DISP-PREPK-ID           49660000
496700             STRING ' PO = '                                      49670000
496800                    PV-DISP-PO-NBR                                49680000
496900                    ' RECV ='                                     49690000
497000                    PV-DISP-REC-SEQ-NBR                           49700000
497100                    ' OPER = '                                    49710000
497200                    PV-DISP-OPER-UNT-ID                           49720000
497300                    ' FCLTY = '                                   49730000
497400                    PV-DISP-FCLTY-ID                              49740000
497500                    ' PACK ='                                     49750000
497600                    PV-DISP-PREPK-ID    DELIMITED BY SIZE         49760000
497700                             INTO DP013-MESSAGE-TEXT (2)          49770000
497800             MOVE SQLCA        TO DP013-SQLCA                     49780000
497900             MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (1)        49790000
498000             MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (2)        49800000
498100             SET DP013-DB2-ABEND                                  49810000
498200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               49820000
498300             PERFORM DP013-0000-PROCESS-ABEND                     49830000
498400     END-EVALUATE.                                                49840000
498500                                                                  49850000
498600 5280-UPDATE-RECDIS.                                              49860000
498700                                                                  49870000
498800     MOVE RECDIS-ORD-LNE-NBR       TO DK-PO-DRIVER-LNE.           49880000
498900     IF ASC-POST-VERIFIED-RECEIPT                                 49890000
499000         PERFORM 5350-PROCESS-TROUBLE                             49900000
499100     END-IF.                                                      49910000
499200     PERFORM 4355-SELECT-ODD-UNITS-DRIVER.                        49920000
499300     IF  RECITM-STATUS-CDE = 'VE'                                 49930000
499400         COMPUTE PV-LINE-QTY =                                    49940000
499500            (RECITM-PREPK-RATO-QTY * PV-UPDATE-PACK-AMT)          49950000
499600                             + PV-ODD-AP-VERIFY-ODU-PK-QTY        49960000
499700     ELSE                                                         49970000
499800         COMPUTE PV-LINE-QTY =                                    49980000
499900            (RECITM-PREPK-RATO-QTY * PV-UPDATE-PACK-AMT)          49990000
500000                             + PV-ODD-DC-VERIFY-ODU-PK-QTY        50000000
500100     END-IF.                                                      50010000
500200     IF RECITM-PREPK-DRV-LNE-CDE = 'A'                            50020000
500300         COMPUTE PV-SAVE-ITM-QTY =                                50030000
500400                 PV-LINE-QTY - RECDIS-VERIFY-ITM-QTY              50040000
500500         IF  RECITM-STATUS-CDE = 'VE'                             50050000
500600             COMPUTE PV-UPDATE-PACK-DIF =                         50060000
500700                     PV-UPDATE-PACK - PV-ORIG-PACK-VRF            50070000
500800         ELSE                                                     50080000
500900             COMPUTE PV-UPDATE-PACK-DIF =                         50090000
501000                     PV-UPDATE-PACK - PV-ORIG-PACK-ACT            50100000
501100         END-IF                                                   50110000
501200         MOVE PV-UPDATE-PACK-DIF  TO PV-SAVE-PACK-DIF             50120000
501300         COMPUTE PV-SUM-ITM-QTY =                                 50130000
501400                 RECITM-PREPK-RATO-QTY * PV-SAVE-PACK-DIF         50140000
501500         COMPUTE PV-UPDATE-PACK-TOTAL =                           50150000
501600              RECITM-PREPK-RATO-QTY * PV-UPDATE-PACK-DIF          50160000
501700         ADD PV-UPDATE-PACK-TOTAL                                 50170000
501800              TO PV-TOTAL-UPDATE-PACK-DIF                         50180000
501900     END-IF.                                                      50190000
502000                                                                  50200000
502100     IF ASC-POST-VERIFIED-RECEIPT                                 50210000
502200         CONTINUE                                                 50220000
502300     ELSE                                                         50230000
502400         MOVE PV-LINE-QTY          TO  RECDIS-VERIFY-ITM-QTY      50240000
502500     END-IF.                                                      50250000
502600     IF RECITM-STATUS-CDE = 'VE'                                  50260000
502700         MOVE PV-LINE-QTY          TO  RECDIS-AP-VERIFY-ITM-QTY   50270000
502800     END-IF.                                                      50280000
502900                                                                  50290000
503000     IF PV-REC-TYPE = 'B'                                         50300000
503100         PERFORM 5285-INSERT-TRECDIS                              50310000
503200     END-IF.                                                      50320000
503300                                                                  50330000
503400     PERFORM 5290-UPD-RECDIS-AUDIT-BEFORE.                        50340000
503500                                                                  50350000
503600     EXEC SQL                                                     50360000
503700          UPDATE TRECDIS                                          50370000
503800          SET    VERIFY_ITM_QTY      =  :RECDIS-VERIFY-ITM-QTY    50380000
503900             ,   AP_VERIFY_ITM_QTY   =  :RECDIS-AP-VERIFY-ITM-QTY 50390000
504000          WHERE                                                   50400000
504100                 ORD_NBR          =  :DK-PO-NBR                   50410000
504200          AND    ORD_LNE_NBR      =  :RECDIS-ORD-LNE-NBR          50420000
504300          AND    REC_SEQ_NBR      =  :DK-REC-SEQ-NBR              50430000
504400          AND    OPER_UNT_ID      =  :DK-OPER-UNT-ID              50440000
504500          AND    FCLTY_ID         =  :DK-FCLTY-ID                 50450000
504600          AND    STR_NBR          =  :DK-STR-NBR                  50460000
504700     END-EXEC.                                                    50470000
504800                                                                  50480000
504900     EVALUATE TRUE                                                50490000
505000         WHEN SQLCODE = ZERO                                      50500000
505100             SET PS-TRECDIS-UPDATE-DONE TO TRUE                   50510000
505200         WHEN SQLCODE = +100                                      50520000
505300              CONTINUE                                            50530000
505400         WHEN SQLCODE = -904                                      50540000
505500         WHEN SQLCODE = -911                                      50550000
505600         WHEN SQLCODE = -913                                      50560000
505700              SET PS-UPDATES-DONE TO TRUE                         50570000
505800              PERFORM 9900-SOFT-ABORT                             50580000
505900         WHEN SQLWARN0 NOT = SPACE                                50590000
506000         WHEN SQLCODE NOT = ZERO                                  50600000
506100              MOVE '5280-UPDATE-RECDIS'                           50610000
506200                               TO DP013-PARAGRAPH                 50620000
506300              MOVE 'UPDATE RECEIPT DISTRIBUTION TABLE'            50630000
506400                               TO DP013-MESSAGE-TEXT (1)          50640000
506500              MOVE DK-PO-NBR        TO PV-DISP-PO-NBR             50650000
506600              MOVE DK-OPER-UNT-ID   TO PV-DISP-OPER-UNT-ID        50660000
506700              MOVE DK-FCLTY-ID      TO PV-DISP-FCLTY-ID           50670000
506800              MOVE DK-REC-SEQ-NBR   TO PV-DISP-REC-SEQ-NBR        50680000
506900              MOVE RECDIS-ORD-LNE-NBR                             50690000
507000                                    TO PV-DISP-LNE-NBR            50700000
507100              STRING ' PO = '                                     50710000
507200                     PV-DISP-PO-NBR                               50720000
507300                     ' RECV ='                                    50730000
507400                     PV-DISP-REC-SEQ-NBR                          50740000
507500                     ' OPER = '                                   50750000
507600                     PV-DISP-OPER-UNT-ID                          50760000
507700                     ' FCLTY = '                                  50770000
507800                     PV-DISP-FCLTY-ID                             50780000
507900                     ' LINE = '                                   50790000
508000                     PV-DISP-LNE-NBR                              50800000
508100                                         DELIMITED BY SIZE        50810000
508200                              INTO DP013-MESSAGE-TEXT (2)         50820000
508300              MOVE 'TRECDIS '  TO DP013-DB2-TABLE-NAME (1)        50830000
508400              MOVE SQLCA       TO DP013-SQLCA                     50840000
508500              SET DP013-DB2-ABEND                                 50850000
508600                               TO TRUE                            50860000
508700              PERFORM DP013-0000-PROCESS-ABEND                    50870000
508800     END-EVALUATE.                                                50880000
508900                                                                  50890000
509000     IF ASC-POST-VERIFIED-RECEIPT AND                             50900000
509100        PS-TRECDIS-UPDATE-DONE                                    50910000
509200         PERFORM 5515-ADD-TO-RECD-AUDIT-AFTER                     50920000
509300     END-IF.                                                      50930000
509400                                                                  50940000
509500 5285-INSERT-TRECDIS.                                             50950000
509600     EXEC SQL INSERT                                              50960000
509700          INTO TRECDIS                                            50970000
509800                (ORD_NBR                                          50980000
509900            ,    ORD_LNE_NBR                                      50990000
510000            ,    REC_SEQ_NBR                                      51000000
510100            ,    OPER_UNT_ID                                      51010000
510200            ,    FCLTY_ID                                         51020000
510300            ,    CRE_TMST                                         51030000
510400            ,    CRE_UID                                          51040000
510500            ,    VER_STATUS_CDE                                   51050000
510600            ,    EXPTED_ITM_QTY                                   51060000
510700            ,    VERIFY_ITM_QTY                                   51070000
510800            ,    AP_VERIFY_ITM_QTY                                51080000
510900            ,    PLAN_ITM_QTY                                     51090000
511000            ,    AP_PRC_DTE                                       51100000
511100            ,    STR_NBR                                          51110000
511200            ,    STR_FCLTY_ID)                                    51120000
511300          VALUES                                                  51130000
511400                (:DK-PO-NBR                                       51140000
511500            ,    :RECDIS-ORD-LNE-NBR                              51150000
511600            ,    :DK-REC-SEQ-NBR                                  51160000
511700            ,    :DK-OPER-UNT-ID                                  51170000
511800            ,    :DK-FCLTY-ID                                     51180000
511900            ,    CURRENT TIMESTAMP                                51190000
512000            ,    'RCKCS818'                                       51200000
512100            ,    'A'                                              51210000
512200            ,    0                                                51220000
512300            ,    0                                                51230000
512400            ,    0                                                51240000
512500            ,    0                                                51250000
512600            ,    '9999-09-09'                                     51260000
512700            ,    :DK-STR-NBR                                      51270000
512800            ,    1  )                                             51280000
512900     END-EXEC.                                                    51290000
513000                                                                  51300000
513100     EVALUATE TRUE                                                51310000
513200         WHEN SQLCODE = ZERO                                      51320000
513300             CONTINUE                                             51330000
513400         WHEN SQLCODE = +100                                      51340000
513500              CONTINUE                                            51350000
513600         WHEN SQLCODE = -904                                      51360000
513700         WHEN SQLCODE = -911                                      51370000
513800         WHEN SQLCODE = -913                                      51380000
513900              SET PS-UPDATES-DONE TO TRUE                         51390000
514000              PERFORM 9900-SOFT-ABORT                             51400000
514100         WHEN SQLWARN0 NOT = SPACE                                51410000
514200         WHEN SQLCODE NOT = ZERO                                  51420000
514300              MOVE '5285-INSERT-TRECDIS'                          51430000
514400                               TO DP013-PARAGRAPH                 51440000
514500              MOVE 'INSERT RECEIPT DISTRIBUTION TABLE'            51450000
514600                               TO DP013-MESSAGE-TEXT (1)          51460000
514700              MOVE DK-PO-NBR        TO PV-DISP-PO-NBR             51470000
514800              MOVE DK-OPER-UNT-ID   TO PV-DISP-OPER-UNT-ID        51480000
514900              MOVE DK-FCLTY-ID      TO PV-DISP-FCLTY-ID           51490000
515000              MOVE DK-REC-SEQ-NBR   TO PV-DISP-REC-SEQ-NBR        51500000
515100              MOVE RECDIS-ORD-LNE-NBR                             51510000
515200                                    TO PV-DISP-LNE-NBR            51520000
515300              STRING ' PO = '                                     51530000
515400                     PV-DISP-PO-NBR                               51540000
515500                     ' RECV ='                                    51550000
515600                     PV-DISP-REC-SEQ-NBR                          51560000
515700                     ' OPER = '                                   51570000
515800                     PV-DISP-OPER-UNT-ID                          51580000
515900                     ' FCLTY = '                                  51590000
516000                     PV-DISP-FCLTY-ID                             51600000
516100                     ' LINE = '                                   51610000
516200                     PV-DISP-LNE-NBR                              51620000
516300                                         DELIMITED BY SIZE        51630000
516400                              INTO DP013-MESSAGE-TEXT (2)         51640000
516500              MOVE 'TRECDIS '  TO DP013-DB2-TABLE-NAME (1)        51650000
516600              MOVE SQLCA       TO DP013-SQLCA                     51660000
516700              SET DP013-DB2-ABEND                                 51670000
516800                               TO TRUE                            51680000
516900              PERFORM DP013-0000-PROCESS-ABEND                    51690000
517000     END-EVALUATE.                                                51700000
517100                                                                  51710000
517200 5290-UPD-RECDIS-AUDIT-BEFORE.                                    51720000
517300                                                                  51730000
517400     EXEC SQL                                                     51740000
517500          SET :PV-CURRENT-TIMESTAMP = CURRENT TIMESTAMP           51750000
517600     END-EXEC.                                                    51760000
517700     MOVE 'D'                      TO RC031-TABLE-TO-AUDIT.       51770000
517800     MOVE 'B'                      TO RC031-AUD-TYP-CDE.          51780000
517900     MOVE 'U'                      TO RC031-AUD-FUNC-CDE.         51790000
518000     MOVE DK-PO-NBR                TO RC031-PO-NBR.               51800000
518100     MOVE RECDIS-ORD-LNE-NBR                                      51810000
518200                                   TO RC031-PO-LNE-NBR.           51820000
518300     MOVE DK-REC-SEQ-NBR                                          51830000
518400                                   TO RC031-REC-SEQ-NBR.          51840000
518500     MOVE DK-OPER-UNT-ID           TO RC031-OPER-UNT-ID.          51850000
518600     MOVE DK-FCLTY-ID              TO RC031-FCLTY-ID.             51860000
518700     MOVE DK-STR-NBR               TO RC031-STR-NBR.              51870000
518800     MOVE DP020-USERID             TO RC031-UPD-UID.              51880000
518900     IF ASC-POST-VERIFIED-RECEIPT                                 51890000
519000         MOVE PC-POST-VERIFY-PGM-NAME  TO RC031-UPD-PGM-ID        51900000
519100     ELSE                                                         51910000
519200         MOVE PC-CURRENT-PROGRAM-NAME  TO RC031-UPD-PGM-ID        51920000
519300     END-IF.                                                      51930000
519400     MOVE PV-CURRENT-TIMESTAMP     TO RC031-UPD-TMST.             51940000
519500     MOVE PV-NOTIF-NBR             TO RC031-NOTIF-NBR.            51950000
519600     MOVE PV-CYC-ADJ-NBR           TO RC031-ADJ-CYC-NBR.          51960000
519700     EXEC CICS                                                    51970000
519800         LINK PROGRAM  (PC-AUDIT-RTN)                             51980000
519900              COMMAREA (RC031-FIELDS)                             51990000
520000              LENGTH   (PC-AUDIT-RTN-LENGTH)                      52000000
520100     END-EXEC.                                                    52010000
520200     EVALUATE TRUE                                                52020000
520300         WHEN RC031-CALL-SUCCESSFUL                               52030000
520400             CONTINUE                                             52040000
520500                                                                  52050000
520600         WHEN OTHER                                               52060000
520700              MOVE '5290-UPD-RECDIS-AUDIT-BEFORE'                 52070000
520800                                    TO DP013-PARAGRAPH            52080000
520900              MOVE 'UNSUCCESSFUL CALL TO AUDIT RTN'               52090000
521000                                TO DP013-MESSAGE-TEXT (1)         52100000
521100              MOVE RC031-RETURN-DESC                              52110000
521200                                TO DP013-MESSAGE-TEXT (2)         52120000
521300              MOVE RC031-SQLCA      TO DP013-SQLCA                52130000
521400              SET DP013-DB2-ABEND                                 52140000
521500                  DP013-XCTL-DISPLAY-RESTART                      52150000
521600                                    TO TRUE                       52160000
521700              PERFORM DP013-0000-PROCESS-ABEND                    52170000
521800     END-EVALUATE.                                                52180000
521900                                                                  52190000
522000 5300-GET-TRECEIV-STATUS.                                         52200000
522100                                                                  52210000
522200     EXEC SQL                                                     52220000
522300          SELECT                                                  52230000
522400             ML_POST_TMST                                         52240000
522500           , FS_POST_TMST                                         52250000
522600           , STATUS_CDE                                           52260000
522700           , VERFYD_TMST                                          52270000
522800           , VRFD_USR_ID                                          52280000
522900        INTO                                                      52290000
523000             :RECEIV-ML-POST-TMST                                 52300000
523100           , :RECEIV-FS-POST-TMST                                 52310000
523200           , :RECEIV-STATUS-CDE                                   52320000
523300           , :RECEIV-VERFYD-TMST                                  52330000
523400           , :RECEIV-VRFD-USR-ID                                  52340000
523500          FROM  TRECEIV                                           52350000
523600          WHERE                                                   52360000
523700                 ORD_NBR          =  :DK-PO-NBR                   52370000
523800          AND    REC_SEQ_NBR      =  :DK-REC-SEQ-NBR              52380000
523900          AND    OPER_UNT_ID      =  :DK-OPER-UNT-ID              52390000
524000          AND    FCLTY_ID         =  :DK-FCLTY-ID                 52400000
524100          AND    VER_STATUS_CDE   =  'A'                          52410000
524200     END-EXEC.                                                    52420000
524300                                                                  52430000
524400     EVALUATE TRUE                                                52440000
524500         WHEN SQLCODE = ZERO                                      52450000
524600             CONTINUE                                             52460000
524700         WHEN SQLCODE = -904                                      52470000
524800         WHEN SQLCODE = -911                                      52480000
524900         WHEN SQLCODE = -913                                      52490000
525000              PERFORM 9900-SOFT-ABORT                             52500000
525100         WHEN SQLWARN0 NOT = SPACE                                52510000
525200         WHEN SQLCODE NOT = ZERO                                  52520000
525300              MOVE '5300-GET-TRECEIV-STATUS'                      52530000
525400                               TO DP013-PARAGRAPH                 52540000
525500              MOVE 'SELECT TRECEIV'                               52550000
525600                               TO DP013-MESSAGE-TEXT (1)          52560000
525700              MOVE DK-PO-NBR        TO PV-DISP-PO-NBR             52570000
525800              MOVE DK-REC-SEQ-NBR   TO PV-DISP-REC-SEQ-NBR        52580000
525900              MOVE ASC-OPER-UNT-ID  TO PV-DISP-OPER-UNT-ID        52590000
526000              MOVE ASC-FCLTY-ID     TO PV-DISP-FCLTY-ID           52600000
526100              STRING ' PO = '                                     52610000
526200                     PV-DISP-PO-NBR                               52620000
526300                     ' RECV ='                                    52630000
526400                     PV-DISP-REC-SEQ-NBR                          52640000
526500                     ' OPER ='                                    52650000
526600                     PV-DISP-OPER-UNT-ID                          52660000
526700                     ' FCLTY ='                                   52670000
526800                     PV-DISP-FCLTY-ID                             52680000
526900                                         DELIMITED BY SIZE        52690000
527000                              INTO DP013-MESSAGE-TEXT (2)         52700000
527100              MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (1)        52710000
527200              MOVE SQLCA       TO DP013-SQLCA                     52720000
527300              SET DP013-DB2-ABEND                                 52730000
527400                               TO TRUE                            52740000
527500              PERFORM DP013-0000-PROCESS-ABEND                    52750000
527600     END-EVALUATE.                                                52760000
527700                                                                  52770000
527800 5310-SELECT-STR-DATA.                                            52780000
527900     MOVE ASC-OPER-UNT-ID      TO DK-OPER-UNT-ID.                 52790000
528000     MOVE ASC-FCLTY-ID         TO DK-FCLTY-ID.                    52800000
528100     MOVE ASC-PO-NBR           TO DK-PO-NBR.                      52810000
528200     MOVE ASC-REC-SEQ-NBR      TO DK-REC-SEQ-NBR.                 52820000
528300     MOVE ASC-PACK-ID          TO DK-PREPK-ID.                    52830000
528400                                                                  52840000
528500     EXEC SQL                                                     52850000
528600          SELECT DISTINCT                                         52860000
528700                A.VERFYD_TMST                                     52870000
528800              , B.STATUS_CDE                                      52880000
528900              , B.VRFD_USR_ID                                     52890000
529000              , D.AP_PRC_CDE                                      52900000
529100              , SUM(D.EXPTED_ITM_QTY)                             52910000
529200              , SUM(D.VERIFY_ITM_QTY)                             52920000
529300              , E.DEPT_NBR                                        52930000
529400          INTO  :RECEIV-VERFYD-TMST                               52940000
529500              , :RECITM-STATUS-CDE                                52950000
529600              , :RECITM-VRFD-USR-ID                               52960000
529700              , :RECDIS-AP-PRC-CDE                                52970000
529800              , :RECDIS-EXPTED-ITM-QTY                            52980000
529900              , :RECDIS-VERIFY-ITM-QTY                            52990000
530000              , :PURCHS-DEPT-NBR                                  53000000
530100          FROM    TRECEIV  A                                      53010000
530200              ,   TRECITM  B                                      53020000
530300              ,   TPURITM  C                                      53030000
530400              ,   TRECDIS  D                                      53040000
530500              ,   TPURCHS  E                                      53050000
530600          WHERE A.ORD_NBR          =  :DK-PO-NBR                  53060000
530700           AND  A.ORD_NBR          =  B.ORD_NBR                   53070000
530800           AND  A.ORD_NBR          =  D.ORD_NBR                   53080000
530900           AND  A.ORD_NBR          =  C.PO_NBR                    53090000
531000           AND  A.ORD_NBR          =  E.PO_NBR                    53100000
531100           AND  A.VER_STATUS_CDE   =  'A'                         53110000
531200           AND  B.VER_STATUS_CDE   =  'A'                         53120000
531300           AND  E.VER_STATUS_CDE   =  'A'                         53130000
531400           AND  A.OPER_UNT_ID      =  :DK-OPER-UNT-ID             53140000
531500           AND  A.OPER_UNT_ID      =  B.OPER_UNT_ID               53150000
531600           AND  A.OPER_UNT_ID      =  D.OPER_UNT_ID               53160000
531700           AND  A.FCLTY_ID         =  :DK-FCLTY-ID                53170000
531800           AND  A.FCLTY_ID         =  B.FCLTY_ID                  53180000
531900           AND  B.FCLTY_ID         =  D.FCLTY_ID                  53190000
532000           AND  A.REC_SEQ_NBR      =  :DK-REC-SEQ-NBR             53200000
532100           AND  A.REC_SEQ_NBR      =  B.REC_SEQ_NBR               53210000
532200           AND  A.REC_SEQ_NBR      =  D.REC_SEQ_NBR               53220000
532300           AND  B.ORD_LNE_NBR      =  C.APP_PO_LNE_NBR            53230000
532400           AND  B.ORD_LNE_NBR      =  D.ORD_LNE_NBR               53240000
532500           AND  B.PO_VER_NBR       =  C.VER_NBR                   53250000
532600           AND  B.PREPK_ID         =  :DK-PREPK-ID                53260000
532700           AND  D.STR_NBR          =  :DK-STR-NBR                 53270000
532800          GROUP BY                                                53280000
532900                E.DEPT_NBR                                        53290000
533000              , B.STATUS_CDE                                      53300000
533100              , B.VRFD_USR_ID                                     53310000
533200              , C.CL_NBR                                          53320000
533300              , A.VERFYD_TMST                                     53330000
533400              , D.AP_PRC_CDE                                      53340000
533500     END-EXEC.                                                    53350000
533600                                                                  53360000
533700                                                                  53370000
533800 5350-PROCESS-TROUBLE.                                            53380000
533900     PERFORM 5360-LOOK-FOR-TROUBLE.                               53390000
534000     IF ASC-NO-TRBL-EXISTS                                        53400000
534100          PERFORM 5380-CREATE-TROUBLE-ROW                         53410000
534200          PERFORM 5390-UPDATE-TRB-QUEUE                           53420000
534300     END-IF.                                                      53430000
534400     PERFORM 9600-WRITE-TRB-QUEUE.                                53440000
534500     SET ASC-NO-TSQ-UPDATE                                        53450000
534600         TO TRUE.                                                 53460000
534700                                                                  53470000
534800                                                                  53480000
534900 5360-LOOK-FOR-TROUBLE.                                           53490000
535000      PERFORM 9500-READ-TRB-QUEUE.                                53500000
535100      IF TM003-CYC-ADJ-NBR = 0                                    53510000
535200           SET ASC-NO-TRBL-EXISTS TO TRUE                         53520000
535300      ELSE                                                        53530000
535400          SET LINE-INDEX TO 1                                     53540000
535500          SET PS-NOT-EOT-TRB-TABLE TO TRUE                        53550000
535600          PERFORM 5370-SEARCH-TRB-TABLE                           53560000
535700             UNTIL PS-EOT-TRB-TABLE                               53570000
535800      END-IF.                                                     53580000
535900                                                                  53590000
536000                                                                  53600000
536100 5370-SEARCH-TRB-TABLE.                                           53610000
536200      IF TM003-TBL-LNE-NBR (LINE-INDEX) = DK-PO-DRIVER-LNE        53620000
536300           AND TM003-TBL-LNE-UPDATED (LINE-INDEX)                 53630000
536400                 SET ASC-TRBL-EXISTS TO TRUE                      53640000
536500                 MOVE TM003-CYC-ADJ-NBR TO PV-CYC-ADJ-NBR         53650000
536600                                           PV-CYC-ADJ-BEF         53660000
536700                 MOVE TM003-TBL-NOTIF-NBR (LINE-INDEX) TO         53670000
536800                                     PV-NOTIF-NBR                 53680000
536900                                     PV-NOTIF-BEF                 53690000
537000                 SET PS-EOT-TRB-TABLE TO TRUE                     53700000
537100       ELSE                                                       53710000
537200           IF TM003-TBL-LNE-NBR (LINE-INDEX) = 0                  53720000
537300               SET ASC-NO-TRBL-EXISTS TO TRUE                     53730000
537400               SET PS-EOT-TRB-TABLE TO TRUE                       53740000
537500     END-IF.                                                      53750000
537600     SET LINE-INDEX UP BY 1.                                      53760000
537700                                                                  53770000
537800                                                                  53780000
537900                                                                  53790000
538000 5380-CREATE-TROUBLE-ROW.                                         53800000
538100     INITIALIZE TM500-FIELDS.                                     53810000
538200     SET TM500-ADD-DETAILS                                        53820000
538300         TM500-CREATE-MANUAL       TO  TRUE.                      53830000
538400                                                                  53840000
538500     MOVE 0                        TO  TM500-NOTIF-NBR.           53850000
538600     MOVE ASC-OPER-UNT-ID          TO  TM500-OPER-UNT-ID.         53860000
538700     MOVE ASC-FCLTY-ID             TO  TM500-FCLTY-ID.            53870000
538800                                                                  53880000
538900     MOVE ASC-PO-NBR               TO  TM500-PO-NBR.              53890000
539000                                                                  53900000
539100     SET TM500-LINE-LEVEL          TO  TRUE.                      53910000
539200     MOVE DK-PO-DRIVER-LNE         TO  TM500-PO-LNE-NBR.          53920000
539300                                                                  53930000
539400     MOVE ASC-REC-SEQ-NBR          TO  TM500-REC-SEQ-NBR.         53940000
539500     MOVE TM003-TRBL-RSN-CDE       TO  TM500-TRBL-RSN-CDE.        53950000
539600                                                                  53960000
539700     MOVE DP020-USERID             TO  TM500-CRE-UID              53970000
539800                                       TM500-NOTIF-UID.           53980000
539900                                                                  53990000
540000     IF  TM003-FREEFORM-TEXT = SPACES                             54000000
540100         MOVE '.' TO TM500-FREEFORM-TEXT                          54010000
540200     ELSE                                                         54020000
540300         MOVE TM003-FREEFORM-TEXT  TO  TM500-FREEFORM-TEXT.       54030000
540400                                                                  54040000
540500     PERFORM 5410-LINK-TO-UPDATE.                                 54050000
540600     IF TM500-CALL-SUCCESSFUL         OR                          54060000
540700         TM500-TPURCHS-SELECT-NOT-FND OR                          54070000
540800         TM500-TTRBNTF-UPDATE-NOT-FND OR                          54080000
540900         TM500-DIDNT-ALLOC-DUE-TO-TRBL                            54090000
541000             CONTINUE                                             54100000
541100     ELSE                                                         54110000
541200         IF  TM500-DUPLICATE-TROUBLE                              54120000
541300             SET DP020-MSG-FATAL                                  54130000
541400                 PS-ERROR          TO  TRUE                       54140000
541500             MOVE PC-TRBL-ALREADY-EXISTS-MSG                      54150000
541600                                   TO  DP020-MSG-MESSAGE          54160000
541700         ELSE                                                     54170000
541800             SET PS-ERROR                                         54180000
541900                 DP020-MSG-FATAL           TO  TRUE               54190000
542000             STRING 'NNNNN-E-'                                    54200000
542100                    TM500-RETURN-MSG                              54210000
542200                    '-'                                           54220000
542300                    TM500-RETURN-CODE                             54230000
542400                    ', SQLCODE='                                  54240000
542500                    TM500-SQLCODE DELIMITED BY SIZE               54250000
542600                                 INTO  DP020-MSG-MESSAGE          54260000
542700         END-IF                                                   54270000
542800     END-IF.                                                      54280000
542900                                                                  54290000
543000 5390-UPDATE-TRB-QUEUE.                                           54300000
543100     SET TM003-UPDATE TO TRUE.                                    54310000
543200     IF TM003-CYC-ADJ-NBR = 0                                     54320000
543300         MOVE TM500-NOTIF-NBR TO TM003-CYC-ADJ-NBR                54330000
543400                                     PV-CYC-ADJ-NBR               54340000
543500         MOVE  0                 TO PV-CYC-ADJ-BEF                54350000
543600         MOVE  0                 TO PV-NOTIF-BEF                  54360000
543700     ELSE                                                         54370000
543800         MOVE TM003-CYC-ADJ-NBR TO                                54380000
543900                                     PV-CYC-ADJ-NBR               54390000
544000     END-IF.                                                      54400000
544100     SET LINE-INDEX TO 1.                                         54410000
544200     SET PS-TABLE-NOT-LOADED TO TRUE.                             54420000
544300     PERFORM 5400-LOAD-QUEUE-TBL                                  54430000
544400        UNTIL PS-TABLE-LOADED.                                    54440000
544500                                                                  54450000
544600 5400-LOAD-QUEUE-TBL.                                             54460000
544700     IF TM003-TBL-LNE-NBR (LINE-INDEX) = 0                        54470000
544800        MOVE TM500-PO-LNE-NBR TO TM003-TBL-LNE-NBR (LINE-INDEX)   54480000
544900        MOVE TM500-NOTIF-NBR TO TM003-TBL-NOTIF-NBR (LINE-INDEX)  54490000
545000                                PV-NOTIF-NBR                      54500000
545100        SET TM003-TBL-LNE-UPDATED (LINE-INDEX) TO TRUE            54510000
545200        SET PS-TABLE-LOADED TO TRUE                               54520000
545300     ELSE                                                         54530000
545400        SET LINE-INDEX UP BY 1                                    54540000
545500     END-IF.                                                      54550000
545600                                                                  54560000
545700 5410-LINK-TO-UPDATE.                                             54570000
545800                                                                  54580000
545900     EXEC CICS LINK                                               54590000
546000          PROGRAM (PC-TMKCS520)                                   54600000
546100          COMMAREA(TM500-FIELDS)                                  54610000
546200          RESP    (PV-CICS-RESP)                                  54620000
546300     END-EXEC.                                                    54630000
546400                                                                  54640000
546500     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   54650000
546600         SET DP013-LOGIC-ABEND                                    54660000
546700             DP013-NO-ROLLBACK     TO TRUE                        54670000
546800         MOVE '5410-LINK-TO-UPDATE'                               54680000
546900                                   TO DP013-PARAGRAPH             54690000
547000         MOVE 'ATTEMPTING TO LINK TO CENTRAL PROCESSING'          54700000
547100                                   TO DP013-MESSAGE-TEXT (1)      54710000
547200         PERFORM DP013-0000-PROCESS-ABEND                         54720000
547300     END-IF.                                                      54730000
547400                                                                  54740000
547500 5460-SELECT-TDISTHD.                                             54750000
547600                                                                  54760000
547700     EXEC SQL                                                     54770000
547800          SELECT                                                  54780000
547900                TOT_CART_CNT,                                     54790000
548000                FCSE_CART_CNT,                                    54800000
548100                P2L_CART_CNT,                                     54810000
548200                INPK_CART_CNT,                                    54820000
548300                VRFD_TMST                                         54830000
548400          INTO                                                    54840000
548500                :DISTHD-TOT-CART-CNT,                             54850000
548600                :DISTHD-FCSE-CART-CNT,                            54860000
548700                :DISTHD-P2L-CART-CNT,                             54870000
548800                :DISTHD-INPK-CART-CNT,                            54880000
548900                :DISTHD-VRFD-TMST                                 54890000
549000          FROM                                                    54900000
549100                TDISTHD                                           54910000
549200          WHERE                                                   54920000
549300                ORD_NBR          =  :DK-PO-NBR                    54930000
549400          AND   ORD_LNE_NBR      =  :DK-HOLD-LNE-NBR              54940000
549500          AND   RCVR_SEQ_NBR     =  :DK-REC-SEQ-NBR               54950000
549600     END-EXEC.                                                    54960000
549700                                                                  54970000
549800     EVALUATE TRUE                                                54980000
549900         WHEN SQLCODE = ZERO                                      54990000
550000              SET PS-TDISTHD-FOUND TO TRUE                        55000000
550100         WHEN SQLCODE = +100                                      55010000
550200              SET PS-NO-TDISTHD-FOUND TO TRUE                     55020000
550300         WHEN SQLCODE = -904                                      55030000
550400         WHEN SQLCODE = -911                                      55040000
550500         WHEN SQLCODE = -913                                      55050000
550600             PERFORM 9900-SOFT-ABORT                              55060000
550700         WHEN SQLWARN0 NOT = SPACE                                55070000
550800         WHEN SQLCODE NOT = ZERO                                  55080000
550900              MOVE '5460-SELECT-TDISTHD'                          55090000
551000                               TO DP013-PARAGRAPH                 55100000
551100              MOVE 'GET TDISTHD ROW'                              55110000
551200                               TO DP013-MESSAGE-TEXT (1)          55120000
551300              MOVE DK-PO-NBR        TO PV-DISP-PO-NBR             55130000
551400              MOVE DK-REC-SEQ-NBR   TO PV-DISP-REC-SEQ-NBR        55140000
551500              MOVE DK-HOLD-LNE-NBR  TO PV-DISP-LNE-NBR            55150000
551600              STRING ' PO = '                                     55160000
551700                     PV-DISP-PO-NBR                               55170000
551800                     ' RECV ='                                    55180000
551900                     PV-DISP-REC-SEQ-NBR                          55190000
552000                     ' LINE ='                                    55200000
552100                     PV-DISP-LNE-NBR                              55210000
552200                                         DELIMITED BY SIZE        55220000
552300                              INTO DP013-MESSAGE-TEXT (2)         55230000
552400              MOVE SQLCA        TO DP013-SQLCA                    55240000
552500              MOVE 'TDISTHD '   TO DP013-DB2-TABLE-NAME (1)       55250000
552600              MOVE SQLCA       TO DP013-SQLCA                     55260000
552700              SET DP013-DB2-ABEND                                 55270000
552800                               TO TRUE                            55280000
552900              PERFORM DP013-0000-PROCESS-ABEND                    55290000
553000     END-EVALUATE.                                                55300000
553100 EJECT                                                            55310000
553200                                                                  55320000
553300 5510-ADD-TRIGGER-AUDIT-BEFORE.                                   55330000
553400                                                                  55340000
553500     EXEC SQL                                                     55350000
553600          SET :PV-CURRENT-TIMESTAMP = CURRENT TIMESTAMP           55360000
553700     END-EXEC.                                                    55370000
553800     MOVE 'D'                      TO RC031-TABLE-TO-AUDIT.       55380000
553900     MOVE 'B'                      TO RC031-AUD-TYP-CDE.          55390000
554000     MOVE 'T'                      TO RC031-AUD-FUNC-CDE.         55400000
554100     MOVE DK-PO-NBR                TO RC031-PO-NBR.               55410000
554200     MOVE DK-PKSL-LNE-NBR                                         55420000
554300                                   TO RC031-PO-LNE-NBR.           55430000
554400     MOVE DK-REC-SEQ-NBR                                          55440000
554500                                   TO RC031-REC-SEQ-NBR.          55450000
554600     MOVE ASC-OPER-UNT-ID          TO RC031-OPER-UNT-ID.          55460000
554700     MOVE ASC-FCLTY-ID             TO RC031-FCLTY-ID.             55470000
554800     MOVE RECDIS-STR-NBR           TO RC031-STR-NBR.              55480000
554900     MOVE DP020-USERID             TO RC031-UPD-UID.              55490000
555000     IF ASC-POST-VERIFIED-RECEIPT                                 55500000
555100         MOVE PC-POST-VERIFY-PGM-NAME  TO RC031-UPD-PGM-ID        55510000
555200     ELSE                                                         55520000
555300         MOVE PC-CURRENT-PROGRAM-NAME  TO RC031-UPD-PGM-ID        55530000
555400     END-IF.                                                      55540000
555500     MOVE PV-CURRENT-TIMESTAMP     TO RC031-UPD-TMST.             55550000
555600     MOVE PV-NOTIF-NBR             TO RC031-NOTIF-NBR.            55560000
555700     MOVE PV-CYC-ADJ-NBR           TO RC031-ADJ-CYC-NBR.          55570000
555800     EXEC CICS                                                    55580000
555900         LINK PROGRAM  (PC-AUDIT-RTN)                             55590000
556000              COMMAREA (RC031-FIELDS)                             55600000
556100              LENGTH   (PC-AUDIT-RTN-LENGTH)                      55610000
556200     END-EXEC.                                                    55620000
556300     EVALUATE TRUE                                                55630000
556400         WHEN RC031-CALL-SUCCESSFUL                               55640000
556500             CONTINUE                                             55650000
556600                                                                  55660000
556700         WHEN OTHER                                               55670000
556800              MOVE '5510-ADD-TRIGGER-AUDIT-BEFORE'                55680000
556900                                    TO DP013-PARAGRAPH            55690000
557000              MOVE 'UNSUCCESSFUL CALL TO AUDIT RTN'               55700000
557100                                TO DP013-MESSAGE-TEXT (1)         55710000
557200              MOVE RC031-RETURN-DESC                              55720000
557300                                TO DP013-MESSAGE-TEXT (2)         55730000
557400              MOVE RC031-SQLCA      TO DP013-SQLCA                55740000
557500              SET DP013-DB2-ABEND                                 55750000
557600                  DP013-XCTL-DISPLAY-RESTART                      55760000
557700                                    TO TRUE                       55770000
557800              PERFORM DP013-0000-PROCESS-ABEND                    55780000
557900     END-EVALUATE.                                                55790000
558000                                                                  55800000
558100 5515-ADD-TO-RECD-AUDIT-AFTER.                                    55810000
558200                                                                  55820000
558300     MOVE 'D'                      TO RC031-TABLE-TO-AUDIT.       55830000
558400     MOVE 'A'                      TO RC031-AUD-TYP-CDE.          55840000
558500     MOVE 'U'                      TO RC031-AUD-FUNC-CDE.         55850000
558600     MOVE DK-PO-NBR                TO RC031-PO-NBR.               55860000
558700     MOVE RECDIS-ORD-LNE-NBR       TO RC031-PO-LNE-NBR.           55870000
558800     MOVE DK-REC-SEQ-NBR           TO RC031-REC-SEQ-NBR.          55880000
558900     MOVE DK-OPER-UNT-ID           TO RC031-OPER-UNT-ID.          55890000
559000     MOVE DK-FCLTY-ID              TO RC031-FCLTY-ID.             55900000
559100     MOVE DK-STR-NBR               TO RC031-STR-NBR.              55910000
559200     MOVE DP020-USERID             TO RC031-UPD-UID.              55920000
559300     IF ASC-POST-VERIFIED-RECEIPT                                 55930000
559400         MOVE PC-POST-VERIFY-PGM-NAME  TO RC031-UPD-PGM-ID        55940000
559500     ELSE                                                         55950000
559600         MOVE PC-CURRENT-PROGRAM-NAME  TO RC031-UPD-PGM-ID        55960000
559700     END-IF.                                                      55970000
559800     MOVE PV-CURRENT-TIMESTAMP     TO RC031-UPD-TMST.             55980000
559900     MOVE PV-NOTIF-NBR             TO RC031-NOTIF-NBR.            55990000
560000     MOVE PV-CYC-ADJ-NBR           TO RC031-ADJ-CYC-NBR.          56000000
560100     EXEC CICS                                                    56010000
560200         LINK PROGRAM  (PC-AUDIT-RTN)                             56020000
560300              COMMAREA (RC031-FIELDS)                             56030000
560400              LENGTH   (PC-AUDIT-RTN-LENGTH)                      56040000
560500     END-EXEC.                                                    56050000
560600     EVALUATE TRUE                                                56060000
560700         WHEN RC031-CALL-SUCCESSFUL                               56070000
560800             CONTINUE                                             56080000
560900                                                                  56090000
561000         WHEN OTHER                                               56100000
561100              MOVE '5515-ADD-TO-RECD-AUDIT-AFTER'                 56110000
561200                                    TO DP013-PARAGRAPH            56120000
561300              MOVE 'UNSUCCESSFUL CALL TO AUDIT RTN'               56130000
561400                                TO DP013-MESSAGE-TEXT (1)         56140000
561500              MOVE RC031-RETURN-DESC                              56150000
561600                                TO DP013-MESSAGE-TEXT (2)         56160000
561700              MOVE RC031-SQLCA      TO DP013-SQLCA                56170000
561800              SET DP013-DB2-ABEND                                 56180000
561900                  DP013-XCTL-DISPLAY-RESTART                      56190000
562000                                    TO TRUE                       56200000
562100              PERFORM DP013-0000-PROCESS-ABEND                    56210000
562200     END-EVALUATE.                                                56220000
562300                                                                  56230000
562400*----------------------------------------------------------------*56240000
562500*    SINCE THE RECDIS VERIFY QUANTITY HAS CHANGED, WE MUST       *56250000
562600*    CHECK IF IT IS NOW LESS THAN PURITM.  IF SO, RESET THE      *56260000
562700*    STATUS CODE TO IP AND CHECK THE PURCHS ROW.                 *56270000
562800*----------------------------------------------------------------*56280000
562900                                                                  56290000
563000 5800-CHECK-PO-STATUS.                                            56300000
563100                                                                  56310000
563200     PERFORM 7000-GET-PO-INFO.                                    56320000
563300     PERFORM 7220-GET-RECDIS-QTY.                                 56330000
563400                                                                  56340000
563500     IF (PV-PURITM-UNT-QTY GREATER PV-RECDIS-AP-VERIFY-ITM-QTY    56350000
563600     AND PV-PURITM-STATUS-CDE EQUAL 'CM')                         56360000
563700         MOVE 'AC'                TO  PV-PURITM-STATUS-CDE        56370000
563800         PERFORM 5830-UPDATE-PURITM-STATUS                        56380000
563900         IF  PV-PURCHS-STATUS-CDE EQUAL 'CM'                      56390000
564000             MOVE 'AC'            TO  PV-PURCHS-STATUS-CDE        56400000
564100***          PERFORM 5850-UPDATE-PURCHS-STATUS                    56410000
564200         END-IF                                                   56420000
564300     ELSE                                                         56430000
564400         IF (PV-PURITM-UNT-QTY NOT > PV-RECDIS-AP-VERIFY-ITM-QTY  56440000
564500         AND PV-PURITM-STATUS-CDE NOT EQUAL 'CM')                 56450000
564600             MOVE 'CM'            TO  PV-PURITM-STATUS-CDE        56460000
564700             PERFORM 5830-UPDATE-PURITM-STATUS                    56470000
564800             IF  PV-PURCHS-STATUS-CDE NOT EQUAL 'CM'              56480000
564900                 MOVE 'CM'        TO  PV-PURCHS-STATUS-CDE        56490000
565000***              PERFORM 5850-UPDATE-PURCHS-STATUS                56500000
565100             END-IF                                               56510000
565200         END-IF                                                   56520000
565300     END-IF.                                                      56530000
565400                                                                  56540000
565500 5830-UPDATE-PURITM-STATUS.                                       56550000
565600                                                                  56560000
565700     PERFORM 7500-GET-PURITM.                                     56570000
565800     IF  SQLCODE EQUAL ZERO                                       56580000
565900     AND PURITM-STATUS-CDE NOT = 'RV'                             56590000
566000         IF PV-PURITM-STATUS-CDE = 'AC'                           56600000
566100             MOVE ASC-DEPT-NBR      TO PV-DEPT-NBR-X              56610000
566200             MOVE PV-DEPT-NBR       TO PV-DEPT-NBR-KEY            56620000
566300             SET PS-NO-RMS-PO       TO TRUE                       56630000
566400*** CHECK IF THIS IS AN RMS PO.  IF IT IS, WE DO NOT WANT TO      56640000
566500*** VERSION THE TPURITM ROWS; WE JUST WANT TO UPDATE THE ROW.     56650000
566600             PERFORM 7650-CHECK-FOR-RMS-PO                        56660000
566700             IF PV-DB2-COUNT > ZERO                               56670000
566800                 SET PS-RMS-PO      TO TRUE                       56680000
566900                 PERFORM 7530-ONLY-UPDATE-PURITM                  56690000
567000             ELSE                                                 56700000
567100                 PERFORM 7510-UPDATE-PURITM                       56710000
567200                 ADD 1              TO  PURITM-VER-NBR            56720000
567300                 PERFORM 7520-INSERT-PURITM                       56730000
567400             END-IF                                               56740000
567500          ELSE                                                    56750000
567600             PERFORM 7530-ONLY-UPDATE-PURITM                      56760000
567700          END-IF                                                  56770000
567800     END-IF.                                                      56780000
567900                                                                  56790000
568000 5850-UPDATE-PURCHS-STATUS.                                       56800000
568100                                                                  56810000
568200     IF  PV-PURCHS-STATUS-CDE EQUAL 'CM'                          56820000
568300         PERFORM 7600-COUNT-PO-LINE-ROWS                          56830000
568400         IF  PV-DB2-COUNT EQUAL ZERO                              56840000
568500             IF  PS-RMS-PO                                        56850000
568600                 CONTINUE                                         56860000
568700             ELSE                                                 56870000
568800                 IF  PS-CHECKED-FOR-RMS-PO                        56880000
568900                     PERFORM 7610-GET-TPURCHS-STATUS              56890000
569000                     PERFORM 7620-ONLY-UPDATE-PURCHS-STATUS       56900000
569100                 ELSE                                             56910000
569200                     MOVE ASC-DEPT-NBR TO PV-DEPT-NBR-X           56920000
569300                     MOVE PV-DEPT-NBR  TO PV-DEPT-NBR-KEY         56930000
569400                     SET PS-NO-RMS-PO  TO TRUE                    56940000
569500                     PERFORM 7650-CHECK-FOR-RMS-PO                56950000
569600                     IF  PV-DB2-COUNT = ZERO                      56960000
569700                         PERFORM 7610-GET-TPURCHS-STATUS          56970000
569800                         PERFORM 7620-ONLY-UPDATE-PURCHS-STATUS   56980000
569900                     END-IF                                       56990000
570000                 END-IF                                           57000000
570100             END-IF                                               57010000
570200         ELSE                                                     57020000
570300             IF  PS-RMS-PO                                        57030000
570400                 CONTINUE                                         57040000
570500             ELSE                                                 57050000
570600                 IF  PS-CHECKED-FOR-RMS-PO                        57060000
570700                     MOVE 'AC'         TO  PV-PURCHS-STATUS-CDE   57070000
570800                 ELSE                                             57080000
570900                     MOVE ASC-DEPT-NBR TO PV-DEPT-NBR-X           57090000
571000                     MOVE PV-DEPT-NBR  TO PV-DEPT-NBR-KEY         57100000
571100                     SET PS-NO-RMS-PO  TO TRUE                    57110000
571200                     PERFORM 7650-CHECK-FOR-RMS-PO                57120000
571300                     IF  PV-DB2-COUNT = ZERO                      57130000
571400                         MOVE 'AC'     TO  PV-PURCHS-STATUS-CDE   57140000
571500                     END-IF                                       57150000
571600                 END-IF                                           57160000
571700             END-IF                                               57170000
571800         END-IF                                                   57180000
571900     ELSE                                                         57190000
572000         IF  PS-RMS-PO                                            57200000
572100             CONTINUE                                             57210000
572200         ELSE                                                     57220000
572300             IF  PS-CHECKED-FOR-RMS-PO                            57230000
572400                 PERFORM 7610-GET-TPURCHS-STATUS                  57240000
572500                 PERFORM 7630-UPDATE-PURCHS-STATUS                57250000
572600                 ADD 1            TO  PURCHS-VER-NBR              57260000
572700                 PERFORM 7640-INSERT-PURCHS                       57270000
572800             ELSE                                                 57280000
572900                 MOVE ASC-DEPT-NBR TO PV-DEPT-NBR-X               57290000
573000                 MOVE PV-DEPT-NBR  TO PV-DEPT-NBR-KEY             57300000
573100                 SET PS-NO-RMS-PO  TO TRUE                        57310000
573200                 PERFORM 7650-CHECK-FOR-RMS-PO                    57320000
573300                 IF  PV-DB2-COUNT = ZERO                          57330000
573400                     PERFORM 7610-GET-TPURCHS-STATUS              57340000
573500                     PERFORM 7630-UPDATE-PURCHS-STATUS            57350000
573600                     ADD 1         TO  PURCHS-VER-NBR             57360000
573700                     PERFORM 7640-INSERT-PURCHS                   57370000
573800                 END-IF                                           57380000
573900             END-IF                                               57390000
574000         END-IF                                                   57400000
574100     END-IF.                                                      57410000
574200******************************************************************57420000
574300** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **57430000
574400** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **57440000
574500** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **57450000
574600** THE USER.                                                    **57460000
574700******************************************************************57470000
574800 6000-REFRESH-PANEL-FROM-TEMP.                                    57480000
574900     IF  ASC-UPDATE-TSQ                                           57490000
575000         SET ASC-NO-TSQ-UPDATE TO TRUE                            57500000
575100         MOVE ZERO                 TO PV-SAVE-ITEM                57510000
575200                                      PV-SEL-QUEUE-ITEM           57520000
575300         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        57530000
575400                                   TO PV-HOLD-SELECTED-ITEMS      57540000
575500         MOVE +1                   TO PV-ITEMS-PROCESSED          57550000
575600         PERFORM 6100-UPDATE-TSQ                                  57560000
575700             UNTIL PV-ITEMS-PROCESSED >                           57570000
575800                                     PV-HOLD-SELECTED-ITEMS       57580000
575900         PERFORM 6010-DELETE-SEL-QUEUE                            57590000
576000         INITIALIZE ASC-BLOCK-ENTRIES (1)                         57600000
576100                    ASC-BLOCK-ENTRIES (2)                         57610000
576200         MOVE ASC-OPER-UNT-ID     TO DK-OPER-UNT-ID               57620000
576300         MOVE ASC-FCLTY-ID        TO DK-FCLTY-ID                  57630000
576400         MOVE ASC-PO-NBR          TO DK-PO-NBR                    57640000
576500         MOVE ASC-REC-SEQ-NBR     TO DK-REC-SEQ-NBR               57650000
576600         MOVE ASC-PACK-ID         TO DK-PREPK-ID                  57660000
577200     END-IF.                                                      57720000
577300                                                                  57730000
577400*----------------------------------------------------------------*57740000
577500*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *57750000
577600*----------------------------------------------------------------*57760000
577700 6010-DELETE-SEL-QUEUE.                                           57770000
577800                                                                  57780000
577900     EXEC CICS                                                    57790000
578000         DELETEQ TS                                               57800000
578100             QUEUE (ASC-SEL-QUEUE-NAME-OUT)                       57810000
578200             RESP  (PV-CICS-RESP)                                 57820000
578300     END-EXEC.                                                    57830000
578400*                                                                 57840000
578500     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      57850000
578600        (PV-CICS-RESP = DFHRESP(QIDERR)))                         57860000
578700         CONTINUE                                                 57870000
578800     ELSE                                                         57880000
578900         SET DP013-CICS-ABEND TO TRUE                             57890000
579000         SET DP013-NO-ROLLBACK TO TRUE                            57900000
579100         MOVE '6010-DELETE-SEL-QUEUE'                             57910000
579200                        TO DP013-PARAGRAPH                        57920000
579300         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         57930000
579400                        TO DP013-MESSAGE-TEXT (1)                 57940000
579500         PERFORM DP013-0000-PROCESS-ABEND                         57950000
579600     END-IF.                                                      57960000
579700                                                                  57970000
579800*----------------------------------------------------------------*57980000
579900*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *57990000
580000*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *58000000
580100*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *58010000
580200*    THE TEMP QUEUE.                                             *58020000
580300*----------------------------------------------------------------*58030000
580400                                                                  58040000
580500 6100-UPDATE-TSQ.                                                 58050000
580600                                                                  58060000
580700     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             58070000
580800     PERFORM 6105-READ-SEL-QUEUE.                                 58080000
580900                                                                  58090000
581000     EVALUATE TRUE                                                58100000
581100         WHEN ASC-RETURNING-FROM-RCVG                             58110000
581200             PERFORM                                              58120000
581300                 VARYING RC801-IDX                                58130000
581400                 FROM 1 BY 1                                      58140000
581500                 UNTIL ((PV-ITEMS-PROCESSED >                     58150000
581600                                      PV-HOLD-SELECTED-ITEMS)     58160000
581700                 OR (RC801-IDX GREATER THAN RC801-MAX-ITEMS))     58170000
581800                 IF  RC801-ACTION-SW (RC801-IDX) > SPACE          58180000
581900                     PERFORM 6110-PROCESS-ITEMS                   58190000
582000                     SET PS-WRITE-LIST-QUEUE TO TRUE              58200000
582100                 END-IF                                           58210000
582200                 ADD +1                TO PV-ITEMS-PROCESSED      58220000
582300             END-PERFORM                                          58230000
582400         WHEN ASC-RETURNING-FROM-DIST                             58240000
582500         WHEN ASC-RETURNING-FROM-PACK-ITM                         58250000
582600             PERFORM                                              58260000
582700                 VARYING RC037-IDX                                58270000
582800                 FROM 1 BY 1                                      58280000
582900                 UNTIL ((PV-ITEMS-PROCESSED >                     58290000
583000                                      PV-HOLD-SELECTED-ITEMS)     58300000
583100                 OR (RC037-IDX GREATER THAN RC037-MAX-ITEMS))     58310000
583200                 IF  RC037-ACTION-SW (RC037-IDX) > SPACE          58320000
583300                     PERFORM 6110-PROCESS-ITEMS                   58330000
583400                     SET PS-WRITE-LIST-QUEUE TO TRUE              58340000
583500                 END-IF                                           58350000
583600                 ADD +1                TO PV-ITEMS-PROCESSED      58360000
583700             END-PERFORM                                          58370000
583800     END-EVALUATE.                                                58380000
583900                                                                  58390000
584000     IF PS-WRITE-LIST-QUEUE                                       58400000
584100         PERFORM 6111-WRITE-LIST-QUEUE                            58410000
584200     END-IF.                                                      58420000
584300*----------------------------------------------------------------*58430000
584400*    READ THE LIST QUEUE RECORD.                                 *58440000
584500*----------------------------------------------------------------*58450000
584600                                                                  58460000
584700 6105-READ-SEL-QUEUE.                                             58470000
584800                                                                  58480000
584900     EVALUATE TRUE                                                58490000
585000         WHEN ASC-RETURNING-FROM-RCVG                             58500000
585100             EXEC CICS                                            58510000
585200                  READQ TS                                        58520000
585300                      QUEUE (ASC-SEL-QUEUE-NAME-OUT)              58530000
585400                      INTO  (RC801-PREPACK-SELECT-RECORD)         58540000
585500                      ITEM  (PV-SEL-QUEUE-ITEM)                   58550000
585600                      RESP  (PV-CICS-RESP)                        58560000
585700             END-EXEC                                             58570000
585800         WHEN ASC-RETURNING-FROM-DIST                             58580000
585900         WHEN ASC-RETURNING-FROM-PACK-ITM                         58590000
586000             EXEC CICS                                            58600000
586100                  READQ TS                                        58610000
586200                      QUEUE (ASC-SEL-QUEUE-NAME-OUT)              58620000
586300                      INTO  (RC037-DC-SELECT-RECORD)              58630000
586400                      ITEM  (PV-SEL-QUEUE-ITEM)                   58640000
586500                      RESP  (PV-CICS-RESP)                        58650000
586600             END-EXEC                                             58660000
586700     END-EVALUATE.                                                58670000
586800*                                                                 58680000
586900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          58690000
587000         CONTINUE                                                 58700000
587100     ELSE                                                         58710000
587200         SET DP013-CICS-ABEND      TO  TRUE                       58720000
587300         SET DP013-NO-ROLLBACK     TO  TRUE                       58730000
587400         MOVE '6105-READ-SEL-QUEUE'                               58740000
587500                                   TO  DP013-PARAGRAPH            58750000
587600         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           58760000
587700                                   TO  DP013-MESSAGE-TEXT(1)      58770000
587800         PERFORM DP013-0000-PROCESS-ABEND                         58780000
587900     END-IF.                                                      58790000
588000 EJECT                                                            58800000
588100*----------------------------------------------------------------*58810000
588200*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*58820000
588300*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*58830000
588400*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *58840000
588500*----------------------------------------------------------------*58850000
588600                                                                  58860000
588700 6110-PROCESS-ITEMS.                                              58870000
588800                                                                  58880000
588900     EVALUATE TRUE                                                58890000
589000         WHEN ASC-RETURNING-FROM-RCVG                             58900000
589100             COMPUTE PV-ITEM = 1 + ((RC801-ITEM (RC801-IDX) - 1)  58910000
589200                             / PC-ITEMS-PER-PANEL)                58920000
589300         WHEN ASC-RETURNING-FROM-DIST                             58930000
589400         WHEN ASC-RETURNING-FROM-PACK-ITM                         58940000
589500             COMPUTE PV-ITEM = 1 + ((RC037-ITEM (RC037-IDX) - 1)  58950000
589600                             / PC-ITEMS-PER-PANEL)                58960000
589700     END-EVALUATE.                                                58970000
589800                                                                  58980000
589900     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           58990000
590000         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          59000000
590100             PERFORM 6111-WRITE-LIST-QUEUE                        59010000
590200         END-IF                                                   59020000
590300         MOVE PV-ITEM          TO PV-SAVE-ITEM                    59030000
590400                                                                  59040000
590500         PERFORM 6112-READ-LIST-QUEUE                             59050000
590600         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               59060000
590700             CONTINUE                                             59070000
590800         END-IF                                                   59080000
590900     END-IF.                                                      59090000
591000                                                                  59100000
591100     EVALUATE TRUE                                                59110000
591200         WHEN ASC-RETURNING-FROM-RCVG                             59120000
591300             COMPUTE PV-SUB = (RC801-ITEM (RC801-IDX)             59130000
591400                            - LQW-LIST-ITEM-NUMBER (1)) + 1       59140000
591500         WHEN ASC-RETURNING-FROM-DIST                             59150000
591600         WHEN ASC-RETURNING-FROM-PACK-ITM                         59160000
591700             COMPUTE PV-SUB = (RC037-ITEM (RC037-IDX)             59170000
591800                            - LQW-LIST-ITEM-NUMBER (1)) + 1       59180000
591900     END-EVALUATE.                                                59190000
592000     SET LQW-DESELECT (PV-SUB) TO    TRUE                         59200000
592100     MOVE LQW-SELECTED-SW (PV-SUB)                                59210000
592200                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  59220000
592300     EVALUATE TRUE                                                59230000
592400         WHEN ASC-RETURNING-FROM-RCVG                             59240000
592500             EVALUATE TRUE                                        59250000
592600                 WHEN RC801-INQ (RC801-IDX)                       59260000
592700                      MOVE PC-INQ      TO LQW-ACTION (PV-SUB)     59270000
592800                                                                  59280000
592900                 WHEN RC801-UPD (RC801-IDX)                       59290000
593000                      MOVE PC-UPD      TO LQW-ACTION (PV-SUB)     59300000
593100                                                                  59310000
593200                 WHEN RC801-DEL (RC801-IDX)                       59320000
593300                      MOVE PC-DEL      TO LQW-ACTION (PV-SUB)     59330000
593400                                                                  59340000
593500                 WHEN RC801-ERR (RC801-IDX)                       59350000
593600                      MOVE PC-ERR      TO LQW-ACTION (PV-SUB)     59360000
593700             END-EVALUATE                                         59370000
593800         WHEN ASC-RETURNING-FROM-DIST                             59380000
593900         WHEN ASC-RETURNING-FROM-PACK-ITM                         59390000
594000             EVALUATE TRUE                                        59400000
594100                 WHEN RC037-INQ (RC037-IDX)                       59410000
594200                      MOVE PC-INQ      TO LQW-ACTION (PV-SUB)     59420000
594300                                                                  59430000
594400                 WHEN RC037-UPD (RC037-IDX)                       59440000
594500                      MOVE PC-UPD      TO LQW-ACTION (PV-SUB)     59450000
594600                                                                  59460000
594700                 WHEN RC037-DEL (RC037-IDX)                       59470000
594800                      MOVE PC-DEL      TO LQW-ACTION (PV-SUB)     59480000
594900                                                                  59490000
595000                 WHEN RC037-ERR (RC037-IDX)                       59500000
595100                      MOVE PC-ERR      TO LQW-ACTION (PV-SUB)     59510000
595200             END-EVALUATE                                         59520000
595300     END-EVALUATE.                                                59530000
595400                                                                  59540000
595500     IF LQW-ACTION (PV-SUB) = PC-UPD                              59550000
595600         SET PS-UPDATE-MODE TO TRUE                               59560000
595700         MOVE LQW-STORE-NBR (PV-SUB)                              59570000
595800                              TO DK-STR-NBR                       59580000
595900         MOVE PV-SUB          TO PV-UPDATE-SUB                    59590000
596000         PERFORM 5310-SELECT-STR-DATA                             59600000
596100         PERFORM 4395-PROCESS-LINE-DATA                           59610000
596200     END-IF.                                                      59620000
596300     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                59630000
596400                                                                  59640000
596500*----------------------------------------------------------------*59650000
596600*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *59660000
596700*----------------------------------------------------------------*59670000
596800                                                                  59680000
596900 6111-WRITE-LIST-QUEUE.                                           59690000
597000                                                                  59700000
597100     EXEC CICS                                                    59710000
597200         WRITEQ TS                                                59720000
597300             QUEUE (ASC-LIST-QUEUE-NAME)                          59730000
597400             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     59740000
597500             ITEM  (PV-SAVE-ITEM)                                 59750000
597600             REWRITE                                              59760000
597700             RESP  (PV-CICS-RESP)                                 59770000
597800     END-EXEC.                                                    59780000
597900*                                                                 59790000
598000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          59800000
598100         CONTINUE                                                 59810000
598200     ELSE                                                         59820000
598300         SET DP013-CICS-ABEND  TO  TRUE                           59830000
598400         SET DP013-NO-ROLLBACK TO  TRUE                           59840000
598500         MOVE '6111-WRITE-LIST-QUEUE'                             59850000
598600                               TO  DP013-PARAGRAPH                59860000
598700         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  59870000
598800                               TO  DP013-MESSAGE-TEXT(1)          59880000
598900         PERFORM DP013-0000-PROCESS-ABEND                         59890000
599000     END-IF.                                                      59900000
599100                                                                  59910000
599200 EJECT                                                            59920000
599300*----------------------------------------------------------------*59930000
599400*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*59940000
599500*----------------------------------------------------------------*59950000
599600                                                                  59960000
599700 6112-READ-LIST-QUEUE.                                            59970000
599800                                                                  59980000
599900     EXEC CICS                                                    59990000
600000         READQ TS                                                 60000000
600100             QUEUE (ASC-LIST-QUEUE-NAME)                          60010000
600200             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     60020000
600300             ITEM  (PV-ITEM)                                      60030000
600400             RESP  (PV-CICS-RESP)                                 60040000
600500     END-EXEC.                                                    60050000
600600*                                                                 60060000
600700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          60070000
600800         CONTINUE                                                 60080000
600900     ELSE                                                         60090000
601000         SET DP013-CICS-ABEND        TO TRUE                      60100000
601100         SET DP013-NO-ROLLBACK       TO TRUE                      60110000
601200         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           60120000
601300         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    60130000
601400                                     TO DP013-MESSAGE-TEXT(1)     60140000
601500         PERFORM DP013-0000-PROCESS-ABEND                         60150000
601600     END-IF.                                                      60160000
601700                                                                  60170000
601800******************************************************************60180000
601900* WRITE ENTRIES TO VERIFY ADJUSTMENT QUEUE                       *60190000
602000******************************************************************60200000
602100 6150-WRITE-VRFY-ADJ-QUEUE.                                       60210000
602200                                                                  60220000
602300     EXEC CICS WRITEQ TS                                          60230000
602400               QUEUE (ASC-VRFY-ADJ-QUEUE-NAME)                    60240000
602500               FROM  (PC241-FIELDS)                               60250000
602600               ITEM  (PV-VRFY-ITEM)                               60260000
602700               RESP  (PV-CICS-RESP)                               60270000
602800     END-EXEC.                                                    60280000
602900                                                                  60290000
603000     IF PV-CICS-RESP NOT = DFHRESP (NORMAL)                       60300000
603100         SET DP013-CICS-ABEND                                     60310000
603200             DP013-NO-ROLLBACK   TO TRUE                          60320000
603300         MOVE '6150-WRITE-VRFY-ADJ-QUEUE'                         60330000
603400                                 TO DP013-PARAGRAPH               60340000
603500         MOVE 'UNSUCCESSFUL LIST ITEMS TEMP STORAGE QUEUE'        60350000
603600                                 TO DP013-MESSAGE-TEXT(1)         60360000
603700         PERFORM DP013-0000-PROCESS-ABEND                         60370000
603800     END-IF.                                                      60380000
603900                                                                  60390000
604000 7000-GET-PO-INFO.                                                60400000
604100                                                                  60410000
604200     EXEC SQL                                                     60420000
604300          SELECT A.DEPT_NBR                                       60430000
604400               , A.STATUS_CDE                                     60440000
604500            INTO :PURCHS-DEPT-NBR                                 60450000
604600               , :PV-PURCHS-STATUS-CDE                            60460000
604700            FROM TPURCHS A                                        60470000
604800           WHERE A.VER_STATUS_CDE     = 'A'                       60480000
604900             AND A.PO_NBR             = :DK-PO-NBR                60490000
605000     END-EXEC                                                     60500000
605100                                                                  60510000
605200     EVALUATE TRUE                                                60520000
605300         WHEN SQLCODE = ZERO                                      60530000
605400             CONTINUE                                             60540000
605500         WHEN SQLCODE = +100                                      60550000
605600            MOVE  SPACES TO PURCHS-DEPT-NBR                       60560000
605700                            PV-PURCHS-STATUS-CDE                  60570000
605800         WHEN SQLCODE = -904                                      60580000
605900         WHEN SQLCODE = -911                                      60590000
606000         WHEN SQLCODE = -913                                      60600000
606100             PERFORM 9900-SOFT-ABORT                              60610000
606200         WHEN SQLWARN0 NOT = SPACES                               60620000
606300         WHEN SQLCODE      NOT = ZERO                             60630000
606400             MOVE '7000-GET-PO-INFO'                              60640000
606500                             TO DP013-PARAGRAPH                   60650000
606600             MOVE 'UNSUCCESSFUL SELECT OF DEPT, STATUS'           60660000
606700                             TO DP013-MESSAGE-TEXT (1)            60670000
606800             MOVE SQLCA         TO DP013-SQLCA                    60680000
606900             MOVE 'TPURCHS' TO DP013-DB2-TABLE-NAME (1)           60690000
607000             MOVE DK-PO-NBR   TO PV-DISP-PO-NBR                   60700000
607100             MOVE SQLCA       TO DP013-SQLCA                      60710000
607200             STRING ' PO = '                                      60720000
607300                    PV-DISP-PO-NBR                                60730000
607400                                        DELIMITED BY SIZE         60740000
607500                             INTO DP013-MESSAGE-TEXT (2)          60750000
607600             SET DP013-DB2-ABEND                                  60760000
607700                  DP013-XCTL-DISPLAY-RESTART                      60770000
607800                             TO TRUE                              60780000
607900             PERFORM DP013-0000-PROCESS-ABEND                     60790000
608000     END-EVALUATE.                                                60800000
608100                                                                  60810000
608200                                                                  60820000
608300 7020-SELECT-PURITM-DATA.                                         60830000
608400                                                                  60840000
608500     EXEC SQL                                                     60850000
608600           SELECT PO_LNE_NBR                                      60860000
608700                , STATUS_CDE                                      60870000
608800                , UNT_QTY                                         60880000
608900             INTO :PURITM-PO-LNE-NBR                              60890000
609000                , :PV-PURITM-STATUS-CDE                           60900000
609100                , :PV-PURITM-UNT-QTY                              60910000
609200             FROM TPURITM                                         60920000
609300            WHERE PO_NBR         = :DK-PO-NBR                     60930000
609400              AND APP_PO_LNE_NBR = :DK-LNE-NBR                    60940000
609500              AND VER_STATUS_CDE = 'A'                            60950000
609600     END-EXEC.                                                    60960000
609700                                                                  60970000
609800     EVALUATE TRUE                                                60980000
609900         WHEN SQLCODE = ZERO                                      60990000
610000              CONTINUE                                            61000000
610100         WHEN SQLCODE = -904                                      61010000
610200         WHEN SQLCODE = -911                                      61020000
610300         WHEN SQLCODE = -913                                      61030000
610400             PERFORM 9900-SOFT-ABORT                              61040000
610500         WHEN SQLWARN0 NOT = SPACE                                61050000
610600         WHEN SQLCODE NOT = ZERO                                  61060000
610700              MOVE '7020-SELECT-PURITM-DATA'                      61070000
610800                               TO DP013-PARAGRAPH                 61080000
610900              MOVE 'SELECT TPURITM DATA'                          61090000
611000                               TO DP013-MESSAGE-TEXT (1)          61100000
611100              MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (1)        61110000
611200              MOVE DK-PO-NBR   TO PV-DISP-PO-NBR                  61120000
611300              MOVE DK-LNE-NBR  TO PV-DISP-LNE-NBR                 61130000
611400              MOVE SQLCA       TO DP013-SQLCA                     61140000
611500              STRING ' PO = '                                     61150000
611600                     PV-DISP-PO-NBR                               61160000
611700                     ' LINE ='                                    61170000
611800                     PV-DISP-LNE-NBR                              61180000
611900                                         DELIMITED BY SIZE        61190000
612000                              INTO DP013-MESSAGE-TEXT (2)         61200000
612100              SET DP013-DB2-ABEND                                 61210000
612200                               TO TRUE                            61220000
612300              PERFORM DP013-0000-PROCESS-ABEND                    61230000
612400     END-EVALUATE.                                                61240000
612500                                                                  61250000
612600 7220-GET-RECDIS-QTY.                                             61260000
612700                                                                  61270000
612800     EXEC SQL                                                     61280000
612900          SELECT                                                  61290000
613000                 SUM(C.AP_VERIFY_ITM_QTY)                         61300000
613100           INTO                                                   61310000
613200                 :PV-RECDIS-AP-VERIFY-ITM-QTY :PV-NULL-IND        61320000
613300           FROM                                                   61330000
613400                 TRECEIV A                                        61340000
613500               , TRECITM B                                        61350000
613600               , TRECDIS C                                        61360000
613700           WHERE                                                  61370000
613800                 A.ORD_NBR         =  :DK-PO-NBR                  61380000
613900            AND  A.ORD_NBR         =  B.ORD_NBR                   61390000
614000            AND  A.ORD_NBR         =  C.ORD_NBR                   61400000
614100            AND  B.ORD_LNE_NBR     =  :DK-LNE-NBR                 61410000
614200            AND  B.ORD_LNE_NBR     =  C.ORD_LNE_NBR               61420000
614300            AND  A.VER_STATUS_CDE  =  'A'                         61430000
614400            AND  B.VER_STATUS_CDE  =  'A'                         61440000
614600            AND  B.STATUS_CDE      =  'VE'                        61460000
614700            AND  A.REC_SEQ_NBR     =  B.REC_SEQ_NBR               61470000
614800            AND  A.REC_SEQ_NBR     =  C.REC_SEQ_NBR               61480000
614900     END-EXEC.                                                    61490000
615000                                                                  61500000
615100     EVALUATE TRUE                                                61510000
615200         WHEN SQLCODE = ZERO                                      61520000
615300         WHEN SQLCODE = +100                                      61530000
615400              CONTINUE                                            61540000
615510         WHEN SQLCODE = -904                                      61551000
615600         WHEN SQLCODE = -911                                      61560000
615700         WHEN SQLCODE = -913                                      61570000
615800             PERFORM 9900-SOFT-ABORT                              61580000
615900         WHEN SQLWARN0 NOT = SPACE                                61590000
616000         WHEN SQLCODE NOT = ZERO                                  61600000
616100              MOVE '7220-GET-RECDIS-QTY'                          61610000
616200                               TO DP013-PARAGRAPH                 61620000
616300              MOVE 'SUM RECDIS VERIFY QUANTITY'                   61630000
616400                               TO DP013-MESSAGE-TEXT (1)          61640000
616500              MOVE 'TRECDIS '  TO DP013-DB2-TABLE-NAME (1)        61650000
616600              MOVE DK-PO-NBR   TO PV-DISP-PO-NBR                  61660000
616700              MOVE DK-LNE-NBR  TO PV-DISP-LNE-NBR                 61670000
616800              MOVE SQLCA       TO DP013-SQLCA                     61680000
616900              STRING ' PO = '                                     61690000
617000                     PV-DISP-PO-NBR                               61700000
617100                     ' LINE ='                                    61710000
617200                     PV-DISP-LNE-NBR                              61720000
617300                                         DELIMITED BY SIZE        61730000
617400                              INTO DP013-MESSAGE-TEXT (2)         61740000
617500              SET DP013-DB2-ABEND                                 61750000
617600                               TO TRUE                            61760000
617700              PERFORM DP013-0000-PROCESS-ABEND                    61770000
617800     END-EVALUATE.                                                61780000
617900                                                                  61790000
618000 7055-GET-TDISTHD.                                                61800000
618100                                                                  61810000
618200     SET ASC-ACTL-NOT-CONFIRMED TO TRUE.                          61820000
618300                                                                  61830000
618400     MOVE ASC-PO-NBR                TO DK-PO-NBR.                 61840000
618500     MOVE ASC-REC-SEQ-NBR           TO DK-REC-SEQ-NBR.            61850000
618600     MOVE ASC-PO-DRIVER-LNE         TO DK-PO-DRIVER-LNE.          61860000
618700                                                                  61870000
618800     EXEC SQL                                                     61880000
618900          SELECT                                                  61890000
619000                   FCSE_CNFRMN_TMST                               61900000
619100            INTO                                                  61910000
619200                  :DISTHD-FCSE-CNFRMN-TMST                        61920000
619300            FROM                                                  61930000
619400                  TDISTHD                                         61940000
619500            WHERE                                                 61950000
619600                  ORD_NBR          = :DK-PO-NBR                   61960000
619700              AND RCVR_SEQ_NBR     = :DK-REC-SEQ-NBR              61970000
619800              AND ORD_LNE_NBR      = :DK-PO-DRIVER-LNE            61980000
619900     END-EXEC.                                                    61990000
620000                                                                  62000000
620100     EVALUATE TRUE                                                62010000
620200         WHEN SQLCODE = ZERO                                      62020000
620300              IF  DISTHD-FCSE-CNFRMN-TMST = PC-DB2-DEFAULT-TMST   62030000
620400                  CONTINUE                                        62040000
620500              ELSE                                                62050000
620600                  SET ASC-ACTL-CONFIRMED TO TRUE                  62060000
620700              END-IF                                              62070000
620800         WHEN SQLCODE = +100                                      62080000
620900              CONTINUE                                            62090000
621000         WHEN SQLCODE = -904                                      62100000
621100         WHEN SQLCODE = -911                                      62110000
621200         WHEN SQLCODE = -913                                      62120000
621300             PERFORM 9900-SOFT-ABORT                              62130000
621400         WHEN SQLWARN0 NOT = SPACES                               62140000
621500         WHEN SQLCODE  NOT = ZERO                                 62150000
621600             MOVE '7055-GET-TDISTHD'                              62160000
621700                                 TO DP013-PARAGRAPH               62170000
621800             MOVE 'UNSUCCESSFUL SELECT OF TDISTHD'                62180000
621900                                 TO DP013-MESSAGE-TEXT (1)        62190000
622000             MOVE SQLCA         TO DP013-SQLCA                    62200000
622100             MOVE DK-PO-NBR        TO PV-DISP-PO-NBR              62210000
622200             MOVE DK-REC-SEQ-NBR   TO PV-DISP-REC-SEQ-NBR         62220000
622300             MOVE DK-PO-DRIVER-LNE TO PV-DISP-LNE-NBR             62230000
622400             STRING ' PO = '                                      62240000
622500                    PV-DISP-PO-NBR                                62250000
622600                    ' RECV ='                                     62260000
622700                    PV-DISP-REC-SEQ-NBR                           62270000
622800                    ' LINE ='                                     62280000
622900                    PV-DISP-LNE-NBR                               62290000
623000                                        DELIMITED BY SIZE         62300000
623100                             INTO DP013-MESSAGE-TEXT (2)          62310000
623200             MOVE SQLCA        TO DP013-SQLCA                     62320000
623300             MOVE 'TDISTHD '   TO DP013-DB2-TABLE-NAME (1)        62330000
623400             SET DP013-DB2-ABEND                                  62340000
623500                 DP013-XCTL-DISPLAY-RESTART                       62350000
623600                                 TO TRUE                          62360000
623700                                                                  62370000
623800             PERFORM DP013-0000-PROCESS-ABEND                     62380000
623900     END-EVALUATE.                                                62390000
624000                                                                  62400000
624100 7060-GET-TDISTDT.                                                62410000
624200                                                                  62420000
624300                                                                  62430000
624400     MOVE ASC-PO-NBR             TO  DK-PO-NBR.                   62440000
624500     MOVE ASC-REC-SEQ-NBR        TO  DK-REC-SEQ-NBR.              62450000
624600     MOVE ASC-PO-DRIVER-LNE      TO  DK-PO-DRIVER-LNE.            62460000
624700                                                                  62470000
624800     EXEC SQL                                                     62480000
624900          SELECT                                                  62490000
625000                  ACTL_ALLOC_QTY                                  62500000
625100                , P2L_SPLT_UNT_QTY                                62510000
625200                , FCSE_SPLT_UNT_QTY                               62520000
625300                , INPK_SPLT_UNT_QTY                               62530000
625400                , FCSE_ACTL_UNT_QTY                               62540000
625500            INTO                                                  62550000
625600                  :DISTDT-ACTL-ALLOC-QTY                          62560000
625700                , :DISTDT-P2L-SPLT-UNT-QTY                        62570000
625800                , :DISTDT-FCSE-SPLT-UNT-QTY                       62580000
625900                , :DISTDT-INPK-SPLT-UNT-QTY                       62590000
626000                , :DISTDT-FCSE-ACTL-UNT-QTY                       62600000
626100            FROM                                                  62610000
626200                  TDISTDT                                         62620000
626300            WHERE                                                 62630000
626400                  ORD_NBR          = :DK-PO-NBR                   62640000
626500              AND RCVR_SEQ_NBR     = :DK-REC-SEQ-NBR              62650000
626600              AND ORD_LNE_NBR      = :DK-PO-DRIVER-LNE            62660000
626700              AND STR_NBR          = :DK-STR-NBR                  62670000
626800     END-EXEC.                                                    62680000
626900                                                                  62690000
627000     EVALUATE TRUE                                                62700000
627100         WHEN SQLCODE = ZERO                                      62710000
627200         WHEN SQLCODE = +100                                      62720000
627300              CONTINUE                                            62730000
627400         WHEN SQLCODE = -904                                      62740000
627500         WHEN SQLCODE = -911                                      62750000
627600         WHEN SQLCODE = -913                                      62760000
627700             PERFORM 9900-SOFT-ABORT                              62770000
627800         WHEN SQLWARN0 NOT = SPACES                               62780000
627900         WHEN SQLCODE  NOT = ZERO                                 62790000
628000             MOVE '7060-GET-TDISTDT'                              62800000
628100                                 TO DP013-PARAGRAPH               62810000
628200             MOVE 'UNSUCCESSFUL SELECT OF TDISTDT'                62820000
628300                                 TO DP013-MESSAGE-TEXT (1)        62830000
628400             MOVE SQLCA         TO DP013-SQLCA                    62840000
628500             MOVE DK-PO-NBR        TO PV-DISP-PO-NBR              62850000
628600             MOVE DK-REC-SEQ-NBR   TO PV-DISP-REC-SEQ-NBR         62860000
628700             MOVE DK-PO-DRIVER-LNE TO PV-DISP-LNE-NBR             62870000
628800             MOVE DK-STR-NBR       TO PV-DISP-STR-NBR             62880000
628900             STRING ' PO = '                                      62890000
629000                    PV-DISP-PO-NBR                                62900000
629100                    ' RECV ='                                     62910000
629200                    PV-DISP-REC-SEQ-NBR                           62920000
629300                    ' LINE ='                                     62930000
629400                    PV-DISP-LNE-NBR                               62940000
629500                    ' STORE ='                                    62950000
629600                    PV-DISP-STR-NBR                               62960000
629700                                        DELIMITED BY SIZE         62970000
629800                             INTO DP013-MESSAGE-TEXT (2)          62980000
629900             MOVE SQLCA        TO DP013-SQLCA                     62990000
630000             MOVE 'TDISTDT'     TO DP013-DB2-TABLE-NAME (1)       63000000
630100             SET DP013-DB2-ABEND                                  63010000
630200                 DP013-XCTL-DISPLAY-RESTART                       63020000
630300                                 TO TRUE                          63030000
630400                                                                  63040000
630500             PERFORM DP013-0000-PROCESS-ABEND                     63050000
630600     END-EVALUATE.                                                63060000
630700                                                                  63070000
630800 7070-OPEN-TRECDVS.                                               63080000
630900                                                                  63090000
631000     MOVE ASC-PO-NBR             TO  DK-PO-NBR.                   63100000
631100     MOVE ASC-REC-SEQ-NBR        TO  DK-REC-SEQ-NBR.              63110000
631200                                                                  63120000
631300     EXEC SQL                                                     63130000
631400          OPEN RECDVS-CURSOR                                      63140000
631500     END-EXEC                                                     63150000
631600                                                                  63160000
631700     EVALUATE TRUE                                                63170000
631800         WHEN SQLCODE = ZERO                                      63180000
631900              CONTINUE                                            63190000
632000         WHEN SQLCODE = -904                                      63200000
632100         WHEN SQLCODE = -911                                      63210000
632200         WHEN SQLCODE = -913                                      63220000
632300             PERFORM 9900-SOFT-ABORT                              63230000
632400         WHEN SQLWARN0 NOT = SPACES                               63240000
632500         WHEN SQLCODE      NOT = ZERO                             63250000
632600              MOVE '7070-OPEN-TRECDVS'                            63260000
632700                             TO DP013-PARAGRAPH                   63270000
632800              MOVE 'UNSUCCESSFUL RECDVS CURSOR OPEN'              63280000
632900                             TO DP013-MESSAGE-TEXT (1)            63290000
633000              MOVE SQLCA         TO DP013-SQLCA                   63300000
633100              MOVE DK-PO-NBR        TO PV-DISP-PO-NBR             63310000
633200              MOVE DK-REC-SEQ-NBR   TO PV-DISP-REC-SEQ-NBR        63320000
633300              MOVE DK-PO-DRIVER-LNE TO PV-DISP-LNE-NBR            63330000
633400              MOVE DK-STR-NBR       TO PV-DISP-STR-NBR            63340000
633500              STRING ' PO = '                                     63350000
633600                     PV-DISP-PO-NBR                               63360000
633700                     ' RECV ='                                    63370000
633800                     PV-DISP-REC-SEQ-NBR                          63380000
633900                     ' LINE ='                                    63390000
634000                     PV-DISP-LNE-NBR                              63400000
634100                     ' STORE ='                                   63410000
634200                     PV-DISP-STR-NBR                              63420000
634300                                         DELIMITED BY SIZE        63430000
634400                              INTO DP013-MESSAGE-TEXT (2)         63440000
634500              MOVE SQLCA        TO DP013-SQLCA                    63450000
634600              MOVE 'TRECDVS' TO DP013-DB2-TABLE-NAME (1)          63460000
634700              SET DP013-XCTL-DISPLAY-RESTART                      63470000
634800                  DP013-DB2-ABEND                                 63480000
634900                             TO TRUE                              63490000
635000                                                                  63500000
635100              PERFORM DP013-0000-PROCESS-ABEND                    63510000
635200     END-EVALUATE.                                                63520000
635300/                                                                 63530000
635400 7075-FETCH-RECDVS.                                               63540000
635500                                                                  63550000
635600     EXEC SQL                                                     63560000
635700           FETCH RECDVS-CURSOR                                    63570000
635800            INTO :RECDVS-VRFY-SRC-CDE                             63580000
635900                ,:RECDVS-EXPTED-ITM-QTY                           63590000
636000                ,:RECDVS-VRFY-ITM-QTY                             63600000
636100     END-EXEC.                                                    63610000
636200                                                                  63620000
636300     EVALUATE TRUE                                                63630000
636400         WHEN SQLCODE = ZERO                                      63640000
636500             ADD 1 TO PV-RECDVS-COUNT                             63650000
636600         WHEN SQLCODE = +100                                      63660000
636700             SET ASC-NO-MORE-RECDVS  TO TRUE                      63670000
636800         WHEN SQLCODE = -904                                      63680000
636900         WHEN SQLCODE = -911                                      63690000
637000         WHEN SQLCODE = -913                                      63700000
637100             PERFORM 9900-SOFT-ABORT                              63710000
637200         WHEN SQLWARN0 NOT = SPACES                               63720000
637300         WHEN SQLCODE  NOT = ZERO                                 63730000
637400              MOVE '7075-FETCH-RECDVS'                            63740000
637500                                 TO DP013-PARAGRAPH               63750000
637600              MOVE 'UNSUCCESSFUL FETCH OF RECDVS CURSOR'          63760000
637700                                 TO DP013-MESSAGE-TEXT (1)        63770000
637800              MOVE SQLCA         TO DP013-SQLCA                   63780000
637900              MOVE DK-PO-NBR        TO PV-DISP-PO-NBR             63790000
638000              MOVE DK-REC-SEQ-NBR   TO PV-DISP-REC-SEQ-NBR        63800000
638100              MOVE DK-PO-DRIVER-LNE TO PV-DISP-LNE-NBR            63810000
638200              MOVE DK-STR-NBR       TO PV-DISP-STR-NBR            63820000
638300              STRING ' PO = '                                     63830000
638400                     PV-DISP-PO-NBR                               63840000
638500                     ' RECV ='                                    63850000
638600                     PV-DISP-REC-SEQ-NBR                          63860000
638700                     ' LINE ='                                    63870000
638800                     PV-DISP-LNE-NBR                              63880000
638900                     ' STORE ='                                   63890000
639000                     PV-DISP-STR-NBR                              63900000
639100                                         DELIMITED BY SIZE        63910000
639200                              INTO DP013-MESSAGE-TEXT (2)         63920000
639300              MOVE SQLCA        TO DP013-SQLCA                    63930000
639400              MOVE 'TRECDVS'     TO DP013-DB2-TABLE-NAME (1)      63940000
639500              SET DP013-DB2-ABEND                                 63950000
639600                  DP013-XCTL-DISPLAY-RESTART                      63960000
639700                                 TO TRUE                          63970000
639800                                                                  63980000
639900              PERFORM DP013-0000-PROCESS-ABEND                    63990000
640000     END-EVALUATE.                                                64000000
640100/                                                                 64010000
640200 7080-CLOSE-TRECDVS.                                              64020000
640300                                                                  64030000
640400     EXEC SQL                                                     64040000
640500          CLOSE RECDVS-CURSOR                                     64050000
640600     END-EXEC.                                                    64060000
640700                                                                  64070000
640800     EVALUATE TRUE                                                64080000
640900         WHEN SQLCODE = ZERO                                      64090000
641000              CONTINUE                                            64100000
641100         WHEN SQLCODE = -904                                      64110000
641200         WHEN SQLCODE = -911                                      64120000
641300         WHEN SQLCODE = -913                                      64130000
641400             PERFORM 9900-SOFT-ABORT                              64140000
641500         WHEN SQLWARN0 NOT = SPACES                               64150000
641600         WHEN SQLCODE  NOT = ZERO                                 64160000
641700              MOVE '7080-CLOSE-TRECDVS'                           64170000
641800                                 TO DP013-PARAGRAPH               64180000
641900              MOVE 'UNSUCCESSFUL RECDVS CURSOR CLOSE'             64190000
642000                                 TO DP013-MESSAGE-TEXT (1)        64200000
642100              MOVE SQLCA         TO DP013-SQLCA                   64210000
642200              MOVE DK-PO-NBR        TO PV-DISP-PO-NBR             64220000
642300              MOVE DK-REC-SEQ-NBR   TO PV-DISP-REC-SEQ-NBR        64230000
642400              MOVE DK-PO-DRIVER-LNE TO PV-DISP-LNE-NBR            64240000
642500              MOVE DK-STR-NBR       TO PV-DISP-STR-NBR            64250000
642600              STRING ' PO = '                                     64260000
642700                     PV-DISP-PO-NBR                               64270000
642800                     ' RECV ='                                    64280000
642900                     PV-DISP-REC-SEQ-NBR                          64290000
643000                     ' LINE ='                                    64300000
643100                     PV-DISP-LNE-NBR                              64310000
643200                     ' STORE ='                                   64320000
643300                     PV-DISP-STR-NBR                              64330000
643400                                         DELIMITED BY SIZE        64340000
643500                              INTO DP013-MESSAGE-TEXT (2)         64350000
643600              MOVE SQLCA        TO DP013-SQLCA                    64360000
643700              MOVE 'TRECDVS'     TO DP013-DB2-TABLE-NAME (1)      64370000
643800              SET DP013-DB2-ABEND                                 64380000
643900                  DP013-XCTL-DISPLAY-RESTART                      64390000
644000                                 TO TRUE                          64400000
644100                                                                  64410000
644200              PERFORM DP013-0000-PROCESS-ABEND                    64420000
644300     END-EVALUATE.                                                64430000
644400                                                                  64440000
644500 7500-GET-PURITM.                                                 64450000
644600                                                                  64460000
644700     EXEC SQL                                                     64470000
644800          SELECT                                                  64480000
644900                  PO_NBR                                          64490000
645000                , VER_NBR                                         64500000
645100                , PO_LNE_NBR                                      64510000
645200                , VER_STATUS_CDE                                  64520000
645300                , SKU_SEQ_NBR                                     64530000
645400                , CL_NBR                                          64540000
645500                , VEND_STYL_NAME                                  64550000
645600                , COLOR_DESC                                      64560000
645700                , SIZE_DESC                                       64570000
645800                , UM_IND                                          64580000
645900                , UNT_QTY                                         64590000
646000                , UNT_RTL_PR_AMT                                  64600000
646100                , UNT_COST_AMT                                    64610000
646200                , TOT_VAL_COST_AMT                                64620000
646300                , TOT_VAL_RTL_AMT                                 64630000
646400                , MU_PCT                                          64640000
646500                , CRE_TMST                                        64650000
646600                , LAST_UPD_TMST                                   64660000
646700                , ITM_NBR                                         64670000
646800                , SKU_DESC                                        64680000
646900                , COLOR_CDE                                       64690000
647000                , SIZE_CDE                                        64700000
647100                , AD_EVNT_DTE                                     64710000
647200                , STATUS_CDE                                      64720000
647300                , CRE_BY_UID                                      64730000
647400                , LAST_UPD_BY_UID                                 64740000
647500                , GP_RTL_AMT                                      64750000
647600                , GP_QTY                                          64760000
647700                , APP_PO_LNE_NBR                                  64770000
647800                , PIC_ITM_IND                                     64780000
647900                , PIC_PG_NBR                                      64790000
648000                , PRD_1ST_COST_AMT                                64800000
648100                , PO_PREPK_ID                                     64810000
648200                , PREPK_RATO_QTY                                  64820000
648300                , SHIP_TO_TMP_DC_IND                              64830000
648400                , RMS_PO_SKU_NBR                                  64840000
648500                , CNCLD_UNT_QTY                                   64850000
648600           INTO                                                   64860000
648700                  :PURITM-PO-NBR                                  64870000
648800                , :PURITM-VER-NBR                                 64880000
648900                , :PURITM-PO-LNE-NBR                              64890000
649000                , :PURITM-VER-STATUS-CDE                          64900000
649100                , :PURITM-SKU-SEQ-NBR                             64910000
649200                , :PURITM-CL-NBR                                  64920000
649300                , :PURITM-VEND-STYL-NAME                          64930000
649400                , :PURITM-COLOR-DESC                              64940000
649500                , :PURITM-SIZE-DESC                               64950000
649600                , :PURITM-UM-IND                                  64960000
649700                , :PURITM-UNT-QTY                                 64970000
649800                , :PURITM-UNT-RTL-PR-AMT                          64980000
649900                , :PURITM-UNT-COST-AMT                            64990000
650000                , :PURITM-TOT-VAL-COST-AMT                        65000000
650100                , :PURITM-TOT-VAL-RTL-AMT                         65010000
650200                , :PURITM-MU-PCT                                  65020000
650300                , :PURITM-CRE-TMST                                65030000
650400                , :PURITM-LAST-UPD-TMST                           65040000
650500                , :PURITM-ITM-NBR                                 65050000
650600                , :PURITM-SKU-DESC                                65060000
650700                , :PURITM-COLOR-CDE                               65070000
650800                , :PURITM-SIZE-CDE                                65080000
650900                , :PURITM-AD-EVNT-DTE                             65090000
651000                , :PURITM-STATUS-CDE                              65100000
651100                , :PURITM-CRE-BY-UID                              65110000
651200                , :PURITM-LAST-UPD-BY-UID                         65120000
651300                , :PURITM-GP-RTL-AMT                              65130000
651400                , :PURITM-GP-QTY                                  65140000
651500                , :PURITM-APP-PO-LNE-NBR                          65150000
651600                , :PURITM-PIC-ITM-IND                             65160000
651700                , :PURITM-PIC-PG-NBR                              65170000
651800                , :PURITM-PRD-1ST-COST-AMT                        65180000
651900                , :PURITM-PO-PREPK-ID                             65190000
652000                , :PURITM-PREPK-RATO-QTY                          65200000
652100                , :PURITM-SHIP-TO-TMP-DC-IND                      65210000
652200                , :PURITM-RMS-PO-SKU-NBR                          65220000
652300                , :PURITM-CNCLD-UNT-QTY                           65230000
652400           FROM                                                   65240000
652500                  TPURITM                                         65250000
652600          WHERE                                                   65260000
652700                  PO_NBR             =  :DK-PO-NBR                65270000
652800           AND    APP_PO_LNE_NBR     =  :DK-LNE-NBR               65280000
652900           AND    VER_STATUS_CDE     =  'A'                       65290000
653000     END-EXEC.                                                    65300000
653100                                                                  65310000
653200     EVALUATE TRUE                                                65320000
653300         WHEN SQLCODE = ZERO                                      65330000
653400         WHEN SQLCODE = +100                                      65340000
653500              CONTINUE                                            65350000
653600         WHEN SQLCODE = -904                                      65360000
653700         WHEN SQLCODE = -911                                      65370000
653800         WHEN SQLCODE = -913                                      65380000
653900             PERFORM 9900-SOFT-ABORT                              65390000
654000         WHEN SQLWARN0 NOT = SPACE                                65400000
654100         WHEN SQLCODE NOT = ZERO                                  65410000
654200              MOVE '7500-GET-PURITM'                              65420000
654300                               TO DP013-PARAGRAPH                 65430000
654400              MOVE 'SUM RECDIS VERIFY QUANTITY'                   65440000
654500                               TO DP013-MESSAGE-TEXT (1)          65450000
654600              MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (1)        65460000
654700              MOVE DK-PO-NBR   TO PV-DISP-PO-NBR                  65470000
654800              MOVE DK-LNE-NBR  TO PV-DISP-LNE-NBR                 65480000
654900              STRING ' PO = '                                     65490000
655000                     PV-DISP-PO-NBR                               65500000
655100                     ' LINE ='                                    65510000
655200                     PV-DISP-LNE-NBR                              65520000
655300                                         DELIMITED BY SIZE        65530000
655400                              INTO DP013-MESSAGE-TEXT (2)         65540000
655500              MOVE SQLCA       TO DP013-SQLCA                     65550000
655600              SET DP013-DB2-ABEND                                 65560000
655700                               TO TRUE                            65570000
655800              PERFORM DP013-0000-PROCESS-ABEND                    65580000
655900     END-EVALUATE.                                                65590000
656000/                                                                 65600000
656100 7510-UPDATE-PURITM.                                              65610000
656200                                                                  65620000
656300     EXEC SQL                                                     65630000
656400          UPDATE                                                  65640000
656500                 TPURITM                                          65650000
656600          SET    VER_STATUS_CDE   =  'I'                          65660000
656700          WHERE                                                   65670000
656800                 PO_NBR           =  :DK-PO-NBR                   65680000
656900          AND    APP_PO_LNE_NBR   =  :DK-LNE-NBR                  65690000
657000          AND    VER_STATUS_CDE   =  'A'                          65700000
657100     END-EXEC.                                                    65710000
657200                                                                  65720000
657300     EVALUATE TRUE                                                65730000
657400         WHEN SQLCODE = ZERO                                      65740000
657500              CONTINUE                                            65750000
657600         WHEN SQLCODE = -904                                      65760000
657700         WHEN SQLCODE = -911                                      65770000
657800         WHEN SQLCODE = -913                                      65780000
657900             SET PS-UPDATES-DONE TO TRUE                          65790000
658000             PERFORM 9900-SOFT-ABORT                              65800000
658100         WHEN SQLWARN0 NOT = SPACE                                65810000
658200         WHEN SQLCODE NOT = ZERO                                  65820000
658300              MOVE '7510-UPDATE-PURITM'                           65830000
658400                               TO DP013-PARAGRAPH                 65840000
658500              MOVE 'SET CURRENT ROW TO INACTIVE'                  65850000
658600                               TO DP013-MESSAGE-TEXT (1)          65860000
658700              MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (1)        65870000
658800              MOVE SQLCA       TO DP013-SQLCA                     65880000
658900              MOVE DK-PO-NBR   TO PV-DISP-PO-NBR                  65890000
659000              MOVE DK-LNE-NBR  TO PV-DISP-LNE-NBR                 65900000
659100              STRING ' PO = '                                     65910000
659200                     PV-DISP-PO-NBR                               65920000
659300                     ' LINE ='                                    65930000
659400                     PV-DISP-LNE-NBR                              65940000
659500                                         DELIMITED BY SIZE        65950000
659600                              INTO DP013-MESSAGE-TEXT (2)         65960000
659700              SET DP013-DB2-ABEND                                 65970000
659800                               TO TRUE                            65980000
659900              PERFORM DP013-0000-PROCESS-ABEND                    65990000
660000     END-EVALUATE.                                                66000000
660100/                                                                 66010000
660200 7520-INSERT-PURITM.                                              66020000
660300                                                                  66030000
660400     EXEC SQL                                                     66040000
660500          INSERT                                                  66050000
660600           INTO   TPURITM                                         66060000
660700                 (PO_NBR                                          66070000
660800                , VER_NBR                                         66080000
660900                , PO_LNE_NBR                                      66090000
661000                , VER_STATUS_CDE                                  66100000
661100                , SKU_SEQ_NBR                                     66110000
661200                , CL_NBR                                          66120000
661300                , VEND_STYL_NAME                                  66130000
661400                , COLOR_DESC                                      66140000
661500                , SIZE_DESC                                       66150000
661600                , UM_IND                                          66160000
661700                , UNT_QTY                                         66170000
661800                , UNT_RTL_PR_AMT                                  66180000
661900                , UNT_COST_AMT                                    66190000
662000                , TOT_VAL_COST_AMT                                66200000
662100                , TOT_VAL_RTL_AMT                                 66210000
662200                , MU_PCT                                          66220000
662300                , CRE_TMST                                        66230000
662400                , LAST_UPD_TMST                                   66240000
662500                , ITM_NBR                                         66250000
662600                , SKU_DESC                                        66260000
662700                , COLOR_CDE                                       66270000
662800                , SIZE_CDE                                        66280000
662900                , AD_EVNT_DTE                                     66290000
663000                , STATUS_CDE                                      66300000
663100                , CRE_BY_UID                                      66310000
663200                , LAST_UPD_BY_UID                                 66320000
663300                , GP_RTL_AMT                                      66330000
663400                , GP_QTY                                          66340000
663500                , APP_PO_LNE_NBR                                  66350000
663600                , PIC_ITM_IND                                     66360000
663700                , PIC_PG_NBR                                      66370000
663800                , PRD_1ST_COST_AMT                                66380000
663900                , STAT_TMST                                       66390000
664000                , PO_PREPK_ID                                     66400000
664100                , PREPK_RATO_QTY                                  66410000
664200                , SHIP_TO_TMP_DC_IND                              66420000
664300                , RMS_PO_SKU_NBR                                  66430000
664400                , CNCLD_UNT_QTY                                   66440000
664500                  )                                               66450000
664600          VALUES                                                  66460000
664700                 (:PURITM-PO-NBR                                  66470000
664800                , :PURITM-VER-NBR                                 66480000
664900                , :PURITM-PO-LNE-NBR                              66490000
665000                , 'A'                                             66500000
665100                , :PURITM-SKU-SEQ-NBR                             66510000
665200                , :PURITM-CL-NBR                                  66520000
665300                , :PURITM-VEND-STYL-NAME                          66530000
665400                , :PURITM-COLOR-DESC                              66540000
665500                , :PURITM-SIZE-DESC                               66550000
665600                , :PURITM-UM-IND                                  66560000
665700                , :PURITM-UNT-QTY                                 66570000
665800                , :PURITM-UNT-RTL-PR-AMT                          66580000
665900                , :PURITM-UNT-COST-AMT                            66590000
666000                , :PURITM-TOT-VAL-COST-AMT                        66600000
666100                , :PURITM-TOT-VAL-RTL-AMT                         66610000
666200                , :PURITM-MU-PCT                                  66620000
666300                , :PURITM-CRE-TMST                                66630000
666400                ,  CURRENT TIMESTAMP                              66640000
666500                , :PURITM-ITM-NBR                                 66650000
666600                , :PURITM-SKU-DESC                                66660000
666700                , :PURITM-COLOR-CDE                               66670000
666800                , :PURITM-SIZE-CDE                                66680000
666900                , :PURITM-AD-EVNT-DTE                             66690000
667000                , :PV-PURITM-STATUS-CDE                           66700000
667100                , :PURITM-CRE-BY-UID                              66710000
667200                , :DP020-USERID                                   66720000
667300                , :PURITM-GP-RTL-AMT                              66730000
667400                , :PURITM-GP-QTY                                  66740000
667500                , :PURITM-APP-PO-LNE-NBR                          66750000
667600                , :PURITM-PIC-ITM-IND                             66760000
667700                , :PURITM-PIC-PG-NBR                              66770000
667800                , :PURITM-PRD-1ST-COST-AMT                        66780000
667900                , CURRENT TIMESTAMP                               66790000
668000                , :PURITM-PO-PREPK-ID                             66800000
668100                , :PURITM-PREPK-RATO-QTY                          66810000
668200                , :PURITM-SHIP-TO-TMP-DC-IND                      66820000
668300                , :PURITM-RMS-PO-SKU-NBR                          66830000
668400                , :PURITM-CNCLD-UNT-QTY                           66840000
668500                  )                                               66850000
668600     END-EXEC.                                                    66860000
668700                                                                  66870000
668800     EVALUATE TRUE                                                66880000
668900         WHEN SQLCODE = ZERO                                      66890000
669000              CONTINUE                                            66900000
669100         WHEN SQLCODE = -904                                      66910000
669200         WHEN SQLCODE = -911                                      66920000
669300         WHEN SQLCODE = -913                                      66930000
669400             SET PS-UPDATES-DONE TO TRUE                          66940000
669500             PERFORM 9900-SOFT-ABORT                              66950000
669600         WHEN SQLWARN0 NOT = SPACE                                66960000
669700         WHEN SQLCODE NOT = ZERO                                  66970000
669800              MOVE '7520-INSERT-PURITM'                           66980000
669900                               TO DP013-PARAGRAPH                 66990000
670000              MOVE 'INSERT NEW ROW IN TPURITM TABLE'              67000000
670100                               TO DP013-MESSAGE-TEXT (1)          67010000
670200              MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (1)        67020000
670300              MOVE SQLCA       TO DP013-SQLCA                     67030000
670400              MOVE PURITM-PO-NBR     TO PV-DISP-PO-NBR            67040000
670500              MOVE PURITM-PO-LNE-NBR TO PV-DISP-LNE-NBR           67050000
670600              STRING ' PO = '                                     67060000
670700                     PV-DISP-PO-NBR                               67070000
670800                     ' LINE ='                                    67080000
670900                     PV-DISP-LNE-NBR                              67090000
671000                                         DELIMITED BY SIZE        67100000
671100                              INTO DP013-MESSAGE-TEXT (2)         67110000
671200              SET DP013-DB2-ABEND                                 67120000
671300                               TO TRUE                            67130000
671400              PERFORM DP013-0000-PROCESS-ABEND                    67140000
671500     END-EVALUATE.                                                67150000
671600/                                                                 67160000
671700 7530-ONLY-UPDATE-PURITM.                                         67170000
671800                                                                  67180000
671900     EXEC SQL                                                     67190000
672000          UPDATE                                                  67200000
672100                 TPURITM                                          67210000
672200          SET    STATUS_CDE       =  :PV-PURITM-STATUS-CDE        67220000
672300               , STAT_TMST        =  CURRENT TIMESTAMP            67230000
672400          WHERE                                                   67240000
672500                 PO_NBR           =  :DK-PO-NBR                   67250000
672600          AND    APP_PO_LNE_NBR   =  :DK-LNE-NBR                  67260000
672700          AND    VER_STATUS_CDE   =  'A'                          67270000
672800     END-EXEC.                                                    67280000
672900                                                                  67290000
673000     EVALUATE TRUE                                                67300000
673100         WHEN SQLCODE = ZERO                                      67310000
673200              CONTINUE                                            67320000
673300         WHEN SQLCODE = -904                                      67330000
673400         WHEN SQLCODE = -911                                      67340000
673500         WHEN SQLCODE = -913                                      67350000
673600             SET PS-UPDATES-DONE TO TRUE                          67360000
673700             PERFORM 9900-SOFT-ABORT                              67370000
673800         WHEN SQLWARN0 NOT = SPACE                                67380000
673900         WHEN SQLCODE NOT = ZERO                                  67390000
674000              MOVE '7530-ONLY-UPDATE-PURITM'                      67400000
674100                               TO DP013-PARAGRAPH                 67410000
674200              MOVE 'SET CURRENT ROW TO INACTIVE'                  67420000
674300                               TO DP013-MESSAGE-TEXT (1)          67430000
674400              MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (1)        67440000
674500              MOVE SQLCA       TO DP013-SQLCA                     67450000
674600              MOVE DK-PO-NBR   TO PV-DISP-PO-NBR                  67460000
674700              MOVE DK-LNE-NBR  TO PV-DISP-LNE-NBR                 67470000
674800              STRING ' PO = '                                     67480000
674900                     PV-DISP-PO-NBR                               67490000
675000                     ' LINE ='                                    67500000
675100                     PV-DISP-LNE-NBR                              67510000
675200                                         DELIMITED BY SIZE        67520000
675300                              INTO DP013-MESSAGE-TEXT (2)         67530000
675400              SET DP013-DB2-ABEND                                 67540000
675500                               TO TRUE                            67550000
675600              PERFORM DP013-0000-PROCESS-ABEND                    67560000
675700     END-EVALUATE.                                                67570000
675800                                                                  67580000
675900 7600-COUNT-PO-LINE-ROWS.                                         67590000
676000                                                                  67600000
676100     MOVE ZERO            TO  PV-DB2-COUNT.                       67610000
676200     EXEC SQL                                                     67620000
676300          SELECT                                                  67630000
676400                COUNT(*)                                          67640000
676500          INTO                                                    67650000
676600                :PV-DB2-COUNT :PV-NULL-IND                        67660000
676700          FROM                                                    67670000
676800                TPURITM                                           67680000
676900          WHERE                                                   67690000
677000                PO_NBR             =  :DK-PO-NBR                  67700000
677100          AND   VER_STATUS_CDE     =  'A'                         67710000
677200          AND  (STATUS_CDE        ^=  'CM'                        67720000
677300           AND  STATUS_CDE        ^=  'CB'                        67730000
677400           AND  STATUS_CDE        ^=  'CA')                       67740000
677500     END-EXEC.                                                    67750000
677600                                                                  67760000
677700     EVALUATE TRUE                                                67770000
677800         WHEN SQLCODE = ZERO                                      67780000
677900         WHEN SQLCODE = +100                                      67790000
678000              CONTINUE                                            67800000
678100         WHEN SQLCODE = -904                                      67810000
678200         WHEN SQLCODE = -911                                      67820000
678300         WHEN SQLCODE = -913                                      67830000
678400             PERFORM 9900-SOFT-ABORT                              67840000
678500         WHEN SQLWARN0 NOT = SPACE                                67850000
678600         WHEN SQLCODE NOT = ZERO                                  67860000
678700              MOVE '7600-COUNT-PO-LINE-ROWS'                      67870000
678800                               TO DP013-PARAGRAPH                 67880000
678900              MOVE 'COUNT NUMBER OF "CM", "CB", "CA" STATUS ROWS' 67890000
679000                               TO DP013-MESSAGE-TEXT (1)          67900000
679100              MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (1)        67910000
679200              MOVE SQLCA       TO DP013-SQLCA                     67920000
679300              MOVE DK-PO-NBR   TO PV-DISP-PO-NBR                  67930000
679400              STRING ' PO = '                                     67940000
679500                     PV-DISP-PO-NBR                               67950000
679600                                         DELIMITED BY SIZE        67960000
679700                              INTO DP013-MESSAGE-TEXT (2)         67970000
679800              SET DP013-DB2-ABEND                                 67980000
679900                               TO TRUE                            67990000
680000              PERFORM DP013-0000-PROCESS-ABEND                    68000000
680100     END-EVALUATE.                                                68010000
680200/                                                                 68020000
680300 7610-GET-TPURCHS-STATUS.                                         68030000
680400                                                                  68040000
680500     EXEC SQL                                                     68050000
680600          SELECT                                                  68060000
680700                  PO_NBR                                          68070000
680800                , VER_NBR                                         68080000
680900                , VER_STATUS_CDE                                  68090000
681000                , PO_TYP_CDE                                      68100000
681100                , PO_CATEG_CDE                                    68110000
681200                , EDI_IND                                         68120000
681300                , TOT_UNT_QTY                                     68130000
681400                , TOT_VAL_COST_AMT                                68140000
681500                , TOT_VAL_RTL_AMT                                 68150000
681600                , TOT_MU_PCT                                      68160000
681700                , TOT_SKUS_QTY                                    68170000
681800                , IMPRT_AGNT_PO_NBR                               68180000
681900                , IMPRT_ORD_OFF_NAME                              68190000
682000                , IMPRT_VEND_NAME                                 68200000
682100                , IMPRT_FCTRY_NAME                                68210000
682200                , IMPRT_CNTRY_NAME                                68220000
682300                , VEND_CNTRY_NAME                                 68230000
682400                , NEW_STR_PO_IND                                  68240000
682500                , IMPRT_PO_IND                                    68250000
682600                , IMPRT_AGNT_PO_IND                               68260000
682700                , STATUS_TMST                                     68270000
682800                , LAST_UPD_TMST                                   68280000
682900                , EDI_REXMIT_IND                                  68290000
683000                , EDI_REXMIT_TMST                                 68300000
683100                , DIR_STR_IND                                     68310000
683200                , LAST_UPD_BY_UID                                 68320000
683300                , APP_BY_UID                                      68330000
683400                , OTB_PER_NBR                                     68340000
683500                , DEPT_NBR                                        68350000
683600                , ENT_ID                                          68360000
683700                , STATUS_CDE                                      68370000
683800                , CRE_BY_UID                                      68380000
683900                , REJ_CT                                          68390000
684000                , REJ_UID                                         68400000
684100                , ORD_DTE                                         68410000
684200                , REVISION_CT                                     68420000
684300                , ADR_SEQ_NBR                                     68430000
684400                , DEST_KNOWN_IND                                  68440000
684500                , RLSE_IND                                        68450000
684600                , RLSE_DTE                                        68460000
684700                , PLCMNT_CNTRY_CDE                                68470000
684800                , PROD_CNTRY_CDE                                  68480000
684900                , UNT_PER_CBMT_QTY                                68490000
685000                , CRE_TMST                                        68500000
685100                , PRG_LAST_ACTVY_DTE                              68510000
685200                , PKGNG_CDE                                       68520000
685300                , SEASET_YR                                       68530000
685400                , SEASET_SHRT_NM                                  68540000
685500                , QTA_CTG_CDE                                     68550000
685600                , PO_IN_RMS_IND                                   68560000
685700                , RMS_PO_UPD_TMST                                 68570000
685800                , DUP_SKU_IND                                     68580000
685900                , ORIG_PKGNG_CDE                                  68590000
686000           INTO                                                   68600000
686100                 :PURCHS-PO-NBR                                   68610000
686200                ,:PURCHS-VER-NBR                                  68620000
686300                ,:PURCHS-VER-STATUS-CDE                           68630000
686400                ,:PURCHS-PO-TYP-CDE                               68640000
686500                ,:PURCHS-PO-CATEG-CDE                             68650000
686600                ,:PURCHS-EDI-IND                                  68660000
686700                ,:PURCHS-TOT-UNT-QTY                              68670000
686800                ,:PURCHS-TOT-VAL-COST-AMT                         68680000
686900                ,:PURCHS-TOT-VAL-RTL-AMT                          68690000
687000                ,:PURCHS-TOT-MU-PCT                               68700000
687100                ,:PURCHS-TOT-SKUS-QTY                             68710000
687200                ,:PURCHS-IMPRT-AGNT-PO-NBR                        68720000
687300                ,:PURCHS-IMPRT-ORD-OFF-NAME                       68730000
687400                ,:PURCHS-IMPRT-VEND-NAME                          68740000
687500                ,:PURCHS-IMPRT-FCTRY-NAME                         68750000
687600                ,:PURCHS-IMPRT-CNTRY-NAME                         68760000
687700                ,:PURCHS-VEND-CNTRY-NAME                          68770000
687800                ,:PURCHS-NEW-STR-PO-IND                           68780000
687900                ,:PURCHS-IMPRT-PO-IND                             68790000
688000                ,:PURCHS-IMPRT-AGNT-PO-IND                        68800000
688100                ,:PURCHS-STATUS-TMST                              68810000
688200                ,:PURCHS-LAST-UPD-TMST                            68820000
688300                ,:PURCHS-EDI-REXMIT-IND                           68830000
688400                ,:PURCHS-EDI-REXMIT-TMST                          68840000
688500                ,:PURCHS-DIR-STR-IND                              68850000
688600                ,:PURCHS-LAST-UPD-BY-UID                          68860000
688700                ,:PURCHS-APP-BY-UID                               68870000
688800                ,:PURCHS-OTB-PER-NBR                              68880000
688900                ,:PURCHS-DEPT-NBR                                 68890000
689000                ,:PURCHS-ENT-ID                                   68900000
689100                ,:PURCHS-STATUS-CDE                               68910000
689200                ,:PURCHS-CRE-BY-UID                               68920000
689300                ,:PURCHS-REJ-CT                                   68930000
689400                ,:PURCHS-REJ-UID                                  68940000
689500                ,:PURCHS-ORD-DTE                                  68950000
689600                ,:PURCHS-REVISION-CT                              68960000
689700                ,:PURCHS-ADR-SEQ-NBR                              68970000
689800                ,:PURCHS-DEST-KNOWN-IND                           68980000
689900                ,:PURCHS-RLSE-IND                                 68990000
690000                ,:PURCHS-RLSE-DTE                                 69000000
690100                ,:PURCHS-PLCMNT-CNTRY-CDE                         69010000
690200                ,:PURCHS-PROD-CNTRY-CDE                           69020000
690300                ,:PURCHS-UNT-PER-CBMT-QTY                         69030000
690400                ,:PURCHS-CRE-TMST                                 69040000
690500                ,:PURCHS-PRG-LAST-ACTVY-DTE                       69050000
690600                ,:PURCHS-PKGNG-CDE                                69060000
690700                ,:PURCHS-SEASET-YR                                69070000
690800                ,:PURCHS-SEASET-SHRT-NM                           69080000
690900                ,:PURCHS-QTA-CTG-CDE                              69090000
691000                ,:PURCHS-PO-IN-RMS-IND                            69100000
691100                ,:PURCHS-RMS-PO-UPD-TMST                          69110000
691200                ,:PURCHS-DUP-SKU-IND                              69120000
691300                ,:PURCHS-ORIG-PKGNG-CDE                           69130000
691400          FROM                                                    69140000
691500                 TPURCHS                                          69150000
691600          WHERE                                                   69160000
691700                PO_NBR             =  :DK-PO-NBR                  69170000
691800          AND   VER_STATUS_CDE     =  'A'                         69180000
691900     END-EXEC.                                                    69190000
692000                                                                  69200000
692100     EVALUATE TRUE                                                69210000
692200         WHEN SQLCODE = ZERO                                      69220000
692300         WHEN SQLCODE = +100                                      69230000
692400              CONTINUE                                            69240000
692500         WHEN SQLCODE = -904                                      69250000
692600         WHEN SQLCODE = -911                                      69260000
692700         WHEN SQLCODE = -913                                      69270000
692800             PERFORM 9900-SOFT-ABORT                              69280000
692900         WHEN SQLWARN0 NOT = SPACE                                69290000
693000         WHEN SQLCODE NOT = ZERO                                  69300000
693100              MOVE '7610-GET-TPURCHS-STATUS'                      69310000
693200                               TO DP013-PARAGRAPH                 69320000
693300              MOVE 'GET THE PURCHASE HEADER'                      69330000
693400                               TO DP013-MESSAGE-TEXT (1)          69340000
693500              MOVE 'TPURCHS '  TO DP013-DB2-TABLE-NAME (1)        69350000
693600              MOVE SQLCA       TO DP013-SQLCA                     69360000
693700              MOVE DK-PO-NBR   TO PV-DISP-PO-NBR                  69370000
693800              STRING ' PO = '                                     69380000
693900                     PV-DISP-PO-NBR                               69390000
694000                                         DELIMITED BY SIZE        69400000
694100                              INTO DP013-MESSAGE-TEXT (2)         69410000
694200              SET DP013-DB2-ABEND                                 69420000
694300                               TO TRUE                            69430000
694400              PERFORM DP013-0000-PROCESS-ABEND                    69440000
694500     END-EVALUATE.                                                69450000
694600/                                                                 69460000
694700 7620-ONLY-UPDATE-PURCHS-STATUS.                                  69470000
694800                                                                  69480000
694900     EXEC SQL                                                     69490000
695000          UPDATE                                                  69500000
695100                TPURCHS                                           69510000
695200           SET                                                    69520000
695300                VER_STATUS_CDE     =  'A'                         69530000
695400              , STATUS_TMST        =  (CURRENT TIMESTAMP)         69540000
695500              , LAST_UPD_TMST      =  (CURRENT TIMESTAMP)         69550000
695600              , STATUS_CDE         =  :PV-PURCHS-STATUS-CDE       69560000
695700          WHERE                                                   69570000
695800                PO_NBR             =  :DK-PO-NBR                  69580000
695900          AND   VER_STATUS_CDE     =  'A'                         69590000
696000     END-EXEC.                                                    69600000
696100                                                                  69610000
696200     EVALUATE TRUE                                                69620000
696300         WHEN SQLCODE = ZERO                                      69630000
696400         WHEN SQLCODE = +100                                      69640000
696500              CONTINUE                                            69650000
696600         WHEN SQLCODE = -904                                      69660000
696700         WHEN SQLCODE = -911                                      69670000
696800         WHEN SQLCODE = -913                                      69680000
696900             SET PS-UPDATES-DONE TO TRUE                          69690000
697000             PERFORM 9900-SOFT-ABORT                              69700000
697100         WHEN SQLWARN0 NOT = SPACE                                69710000
697200         WHEN SQLCODE NOT = ZERO                                  69720000
697300              MOVE '7620-ONLY-UPDATE-PURCHS-STATUS'               69730000
697400                               TO DP013-PARAGRAPH                 69740000
697500              MOVE 'UPDATE THE PURCHASE HEADER'                   69750000
697600                               TO DP013-MESSAGE-TEXT (1)          69760000
697700              MOVE 'TPURCHS '  TO DP013-DB2-TABLE-NAME (1)        69770000
697800              MOVE SQLCA       TO DP013-SQLCA                     69780000
697900              MOVE DK-PO-NBR   TO PV-DISP-PO-NBR                  69790000
698000              STRING ' PO = '                                     69800000
698100                     PV-DISP-PO-NBR                               69810000
698200                                         DELIMITED BY SIZE        69820000
698300                              INTO DP013-MESSAGE-TEXT (2)         69830000
698400              SET DP013-DB2-ABEND                                 69840000
698500                               TO TRUE                            69850000
698600              PERFORM DP013-0000-PROCESS-ABEND                    69860000
698700     END-EVALUATE.                                                69870000
698800/                                                                 69880000
698900 7630-UPDATE-PURCHS-STATUS.                                       69890000
699000                                                                  69900000
699100     EXEC SQL                                                     69910000
699200          UPDATE                                                  69920000
699300                TPURCHS                                           69930000
699400           SET                                                    69940000
699500                VER_STATUS_CDE     =  'I'                         69950000
699600          WHERE                                                   69960000
699700                PO_NBR             =  :DK-PO-NBR                  69970000
699800          AND   VER_STATUS_CDE     =  'A'                         69980000
699900     END-EXEC.                                                    69990000
700000                                                                  70000000
700100     EVALUATE TRUE                                                70010000
700200         WHEN SQLCODE = ZERO                                      70020000
700300         WHEN SQLCODE = +100                                      70030000
700400              CONTINUE                                            70040000
700500         WHEN SQLCODE = -904                                      70050000
700600         WHEN SQLCODE = -911                                      70060000
700700         WHEN SQLCODE = -913                                      70070000
700800             SET PS-UPDATES-DONE TO TRUE                          70080000
700900             PERFORM 9900-SOFT-ABORT                              70090000
701000         WHEN SQLWARN0 NOT = SPACE                                70100000
701100         WHEN SQLCODE NOT = ZERO                                  70110000
701200              MOVE '7630-UPDATE-PURCHS-STATUS'                    70120000
701300                               TO DP013-PARAGRAPH                 70130000
701400              MOVE 'UPDATE PURCHS STATUS'                         70140000
701500                               TO DP013-MESSAGE-TEXT (1)          70150000
701600              MOVE 'TPURCHS '  TO DP013-DB2-TABLE-NAME (1)        70160000
701700              MOVE SQLCA       TO DP013-SQLCA                     70170000
701800              MOVE DK-PO-NBR   TO PV-DISP-PO-NBR                  70180000
701900              STRING ' PO = '                                     70190000
702000                     PV-DISP-PO-NBR                               70200000
702100                                         DELIMITED BY SIZE        70210000
702200                              INTO DP013-MESSAGE-TEXT (2)         70220000
702300              SET DP013-DB2-ABEND                                 70230000
702400                               TO TRUE                            70240000
702500              PERFORM DP013-0000-PROCESS-ABEND                    70250000
702600     END-EVALUATE.                                                70260000
702700/                                                                 70270000
702800 7640-INSERT-PURCHS.                                              70280000
702900                                                                  70290000
703000     EXEC SQL                                                     70300000
703100          INSERT                                                  70310000
703200           INTO   TPURCHS                                         70320000
703300                 (PO_NBR                                          70330000
703400                , VER_NBR                                         70340000
703500                , VER_STATUS_CDE                                  70350000
703600                , PO_TYP_CDE                                      70360000
703700                , PO_CATEG_CDE                                    70370000
703800                , EDI_IND                                         70380000
703900                , TOT_UNT_QTY                                     70390000
704000                , TOT_VAL_COST_AMT                                70400000
704100                , TOT_VAL_RTL_AMT                                 70410000
704200                , TOT_MU_PCT                                      70420000
704300                , TOT_SKUS_QTY                                    70430000
704400                , IMPRT_AGNT_PO_NBR                               70440000
704500                , IMPRT_ORD_OFF_NAME                              70450000
704600                , IMPRT_VEND_NAME                                 70460000
704700                , IMPRT_FCTRY_NAME                                70470000
704800                , IMPRT_CNTRY_NAME                                70480000
704900                , VEND_CNTRY_NAME                                 70490000
705000                , NEW_STR_PO_IND                                  70500000
705100                , IMPRT_PO_IND                                    70510000
705200                , IMPRT_AGNT_PO_IND                               70520000
705300                , STATUS_TMST                                     70530000
705400                , LAST_UPD_TMST                                   70540000
705500                , EDI_REXMIT_IND                                  70550000
705600                , EDI_REXMIT_TMST                                 70560000
705700                , DIR_STR_IND                                     70570000
705800                , LAST_UPD_BY_UID                                 70580000
705900                , APP_BY_UID                                      70590000
706000                , OTB_PER_NBR                                     70600000
706100                , DEPT_NBR                                        70610000
706200                , ENT_ID                                          70620000
706300                , STATUS_CDE                                      70630000
706400                , CRE_BY_UID                                      70640000
706500                , REJ_CT                                          70650000
706600                , REJ_UID                                         70660000
706700                , ORD_DTE                                         70670000
706800                , REVISION_CT                                     70680000
706900                , ADR_SEQ_NBR                                     70690000
707000                , DEST_KNOWN_IND                                  70700000
707100                , RLSE_IND                                        70710000
707200                , RLSE_DTE                                        70720000
707300                , PLCMNT_CNTRY_CDE                                70730000
707400                , PROD_CNTRY_CDE                                  70740000
707500                , UNT_PER_CBMT_QTY                                70750000
707600                , CRE_TMST                                        70760000
707700                , PRG_LAST_ACTVY_DTE                              70770000
707800                , PKGNG_CDE                                       70780000
707900                , SEASET_YR                                       70790000
708000                , SEASET_SHRT_NM                                  70800000
708100                , QTA_CTG_CDE                                     70810000
708200                , PO_IN_RMS_IND                                   70820000
708300                , RMS_PO_UPD_TMST                                 70830000
708400                , DUP_SKU_IND                                     70840000
708500                , ORIG_PKGNG_CDE                                  70850000
708600                 )                                                70860000
708700         VALUES                                                   70870000
708800                (:PURCHS-PO-NBR                                   70880000
708900                ,:PURCHS-VER-NBR                                  70890000
709000                ,'A'                                              70900000
709100                ,:PURCHS-PO-TYP-CDE                               70910000
709200                ,:PURCHS-PO-CATEG-CDE                             70920000
709300                ,:PURCHS-EDI-IND                                  70930000
709400                ,:PURCHS-TOT-UNT-QTY                              70940000
709500                ,:PURCHS-TOT-VAL-COST-AMT                         70950000
709600                ,:PURCHS-TOT-VAL-RTL-AMT                          70960000
709700                ,:PURCHS-TOT-MU-PCT                               70970000
709800                ,:PURCHS-TOT-SKUS-QTY                             70980000
709900                ,:PURCHS-IMPRT-AGNT-PO-NBR                        70990000
710000                ,:PURCHS-IMPRT-ORD-OFF-NAME                       71000000
710100                ,:PURCHS-IMPRT-VEND-NAME                          71010000
710200                ,:PURCHS-IMPRT-FCTRY-NAME                         71020000
710300                ,:PURCHS-IMPRT-CNTRY-NAME                         71030000
710400                ,:PURCHS-VEND-CNTRY-NAME                          71040000
710500                ,:PURCHS-NEW-STR-PO-IND                           71050000
710600                ,:PURCHS-IMPRT-PO-IND                             71060000
710700                ,:PURCHS-IMPRT-AGNT-PO-IND                        71070000
710800                , CURRENT TIMESTAMP                               71080000
710900                , CURRENT TIMESTAMP                               71090000
711000                ,:PURCHS-EDI-REXMIT-IND                           71100000
711100                ,:PURCHS-EDI-REXMIT-TMST                          71110000
711200                ,:PURCHS-DIR-STR-IND                              71120000
711300                ,:DP020-USERID                                    71130000
711400                ,:PURCHS-APP-BY-UID                               71140000
711500                ,:PURCHS-OTB-PER-NBR                              71150000
711600                ,:PURCHS-DEPT-NBR                                 71160000
711700                ,:PURCHS-ENT-ID                                   71170000
711800                ,:PV-PURCHS-STATUS-CDE                            71180000
711900                ,:PURCHS-CRE-BY-UID                               71190000
712000                ,:PURCHS-REJ-CT                                   71200000
712100                ,:PURCHS-REJ-UID                                  71210000
712200                ,:PURCHS-ORD-DTE                                  71220000
712300                ,:PURCHS-REVISION-CT                              71230000
712400                ,:PURCHS-ADR-SEQ-NBR                              71240000
712500                ,:PURCHS-DEST-KNOWN-IND                           71250000
712600                ,:PURCHS-RLSE-IND                                 71260000
712700                ,:PURCHS-RLSE-DTE                                 71270000
712800                ,:PURCHS-PLCMNT-CNTRY-CDE                         71280000
712900                ,:PURCHS-PROD-CNTRY-CDE                           71290000
713000                ,:PURCHS-UNT-PER-CBMT-QTY                         71300000
713100                ,:PURCHS-CRE-TMST                                 71310000
713200                ,:PURCHS-PRG-LAST-ACTVY-DTE                       71320000
713300                ,:PURCHS-PKGNG-CDE                                71330000
713400                ,:PURCHS-SEASET-YR                                71340000
713500                ,:PURCHS-SEASET-SHRT-NM                           71350000
713600                ,:PURCHS-QTA-CTG-CDE                              71360000
713700                ,:PURCHS-PO-IN-RMS-IND                            71370000
713800                ,:PURCHS-RMS-PO-UPD-TMST                          71380000
713900                ,:PURCHS-DUP-SKU-IND                              71390000
714000                ,:PURCHS-ORIG-PKGNG-CDE                           71400000
714100                 )                                                71410000
714200     END-EXEC.                                                    71420000
714300                                                                  71430000
714400     EVALUATE TRUE                                                71440000
714500         WHEN SQLCODE = ZERO                                      71450000
714600              CONTINUE                                            71460000
714700         WHEN SQLCODE = -904                                      71470000
714800         WHEN SQLCODE = -911                                      71480000
714900         WHEN SQLCODE = -913                                      71490000
715000             SET PS-UPDATES-DONE TO TRUE                          71500000
715100             PERFORM 9900-SOFT-ABORT                              71510000
715200         WHEN SQLWARN0 NOT = SPACE                                71520000
715300         WHEN SQLCODE NOT = ZERO                                  71530000
715400              MOVE '7640-INSERT-PURCHS'                           71540000
715500                               TO DP013-PARAGRAPH                 71550000
715600              MOVE 'INSERT PURCHASE HEADER'                       71560000
715700                               TO DP013-MESSAGE-TEXT (1)          71570000
715800              MOVE 'TPURCHS '  TO DP013-DB2-TABLE-NAME (1)        71580000
715900              MOVE SQLCA       TO DP013-SQLCA                     71590000
716000              MOVE DK-PO-NBR   TO PV-DISP-PO-NBR                  71600000
716100              STRING ' PO = '                                     71610000
716200                     PV-DISP-PO-NBR                               71620000
716300                                         DELIMITED BY SIZE        71630000
716400                              INTO DP013-MESSAGE-TEXT (2)         71640000
716500              SET DP013-DB2-ABEND                                 71650000
716600                               TO TRUE                            71660000
716700              PERFORM DP013-0000-PROCESS-ABEND                    71670000
716800     END-EVALUATE.                                                71680000
716900                                                                  71690000
717000*----------------------------------------------------------------*71700000
717100*    CHECK TO SEE IF THIS DEPARTMENT HAS BEEN CONVERTED TO RMS.  *71710000
717200*    IF IT HAS, THE COUNT RETURNED FROM THIS FUNCTION WILL BE    *71720000
717300*    GREATER THAN ZERO AND WE CAN UPDATE TPURITM AND TPURCHS     *71730000
717400*    CORRECTLY.                                                  *71740000
717500*----------------------------------------------------------------*71750000
717600 7650-CHECK-FOR-RMS-PO.                                           71760000
717700                                                                  71770000
717800     INITIALIZE PV-DB2-COUNT.                                     71780000
717900                                                                  71790000
718000     EXEC SQL                                                     71800000
718100          SELECT                                                  71810000
718200                  COUNT(*)                                        71820000
718300           INTO                                                   71830000
718400                  :PV-DB2-COUNT :PV-NULL-IND                      71840000
718500           FROM                                                   71850000
718600                  POT_RMS_RLOUT_CTL                               71860000
718700          WHERE                                                   71870000
718800                  DEPT_NBR            = :PV-DEPT-NBR-KEY          71880000
718900           AND    PO_ENTR_IN_RMS_DTE <=  CURRENT_DATE             71890000
719000     END-EXEC.                                                    71900000
719100                                                                  71910000
719200     EVALUATE TRUE                                                71920000
719300         WHEN SQLCODE = ZERO                                      71930000
719400         WHEN SQLCODE = +100                                      71940000
719500              SET PS-CHECKED-FOR-RMS-PO                           71950000
719600                               TO TRUE                            71960000
719700         WHEN SQLWARN0 NOT = SPACE                                71970000
719800         WHEN SQLCODE = -904                                      71980000
719900         WHEN SQLCODE = -911                                      71990000
720000         WHEN SQLCODE = -913                                      72000000
720100              PERFORM 9900-SOFT-ABORT                             72010000
720200         WHEN SQLCODE NOT = ZERO                                  72020000
720300              MOVE '7650-CHECK-FOR-RMS-PO'                        72030000
720400                               TO DP013-PARAGRAPH                 72040000
720500              MOVE 'CHECK IF DEPT NBR CONVERTED FOR RMS'          72050000
720600                               TO DP013-MESSAGE-TEXT (1)          72060000
720700              STRING 'DEPARTMENT NUMBER: ' DELIMITED BY SIZE      72070000
720800                     PV-DEPT-NBR-X         DELIMITED BY SIZE      72080000
720900                             INTO DP013-MESSAGE-TEXT (2)          72090000
721000              MOVE 'POT_RMS_RLOUT_CTL'                            72100000
721100                               TO DP013-DB2-TABLE-NAME (1)        72110000
721200              MOVE SQLCA       TO DP013-SQLCA                     72120000
721300              SET DP013-DB2-ABEND                                 72130000
721400                               TO TRUE                            72140000
721500              PERFORM DP013-0000-PROCESS-ABEND                    72150000
721600     END-EVALUATE.                                                72160000
721700******************************************************************72170000
721800* THIS PARAGRAPH WILL CONTROL THE PROCESSING ASSOCIATED TO THE   *72180000
721900* UNITS WORKED ROUTINE.                                           72190000
722000******************************************************************72200000
722100 8500-PROCESS-UNITS-WORK.                                         72210000
722200                                                                  72220000
722300     PERFORM 8600-RECEIV-PURITM-JOIN.                             72230000
722400                                                                  72240000
722500     SET PS-DRIVER-LINE TO TRUE.                                  72250000
722600     PERFORM 8800-UNITS-WORK-ROUTINE.                             72260000
722700                                                                  72270000
722800     IF PV-TOTAL-UPDATE-PACK-DIF NOT = 0                          72280000
722900         PERFORM 8700-PROCESS-OTHER-LINES                         72290000
723000     END-IF.                                                      72300000
723100                                                                  72310000
723200/                                                                 72320000
723300******************************************************************72330000
723400*  THIS PARAGRAPH WILL BE USED TO GET SOME FIELDS TO DETERMINE   *72340000
723500*  IF THE UNITS WORKED MODULE NEEDS TO BE CALLED (IF THE FULL-   *72350000
723600*  CASE TIMESTAMP IS A VALUE OTHER THAN 9'S, THEN THE LINE IS    *72360000
723700*  CONFIRMED AND THE UNITS WORKED MODULE WILL NEED TO BE CALLED  *72370000
723800*  FOR CONFIRMATION UNIT ADJUSTMENTS.  THE OTHER FIELDS ARE USED *72380000
723900*  BY THE MODULE TO DETERMINE THE RETAIL VALUE OF THE ADJUSTMENT *72390000
724000*  AND WHAT OPER UNIT AND PROCESS AREA THE ADJUSTMENT SHOULD BE  *72400000
724100*  POSTED TO WITHIN THE UNITS WORKED SYSTEM.                     *72410000
724200******************************************************************72420000
724300 8600-RECEIV-PURITM-JOIN.                                         72430000
724400                                                                  72440000
724500     EXEC SQL                                                     72450000
724600     SELECT A.CURR_OPER_UNT_ID,                                   72460000
724700            C.UNT_RTL_PR_AMT,                                     72470000
724800            D.LOC_TYP_CDE                                         72480000
724900         INTO :PV-CURR-OPER-UNT-ID                                72490000
725000         ,    :PURITM-UNT-RTL-PR-AMT                              72500000
725100         ,    :PV-XLT00010-TYPE-CODE                              72510000
725200         FROM                                                     72520000
725300             TRECEIV A                                            72530000
725400         ,   TRECITM B                                            72540000
725500         ,   TPURITM C                                            72550000
725600         ,   XLT_LOC D                                            72560000
725700         WHERE A.ORD_NBR          = :DK-PO-NBR                    72570000
725800           AND A.REC_SEQ_NBR      = :DK-REC-SEQ-NBR               72580000
725900           AND B.ORD_NBR          = A.ORD_NBR                     72590000
726000           AND B.REC_SEQ_NBR      = A.REC_SEQ_NBR                 72600000
726100           AND B.ORD_LNE_NBR      = :DK-DRIVER-LNE-NBR            72610000
726200           AND C.PO_NBR           = B.ORD_NBR                     72620000
726300           AND C.APP_PO_LNE_NBR   = B.ORD_LNE_NBR                 72630000
726400           AND C.VER_NBR          = B.PO_VER_NBR                  72640000
726500           AND D.LOC_NBR          = A.CURR_OPER_UNT_ID            72650000
726600     END-EXEC.                                                    72660000
726700*                                                                 72670000
726800     EVALUATE TRUE                                                72680000
726900         WHEN SQLCODE = ZERO                                      72690000
727000             CONTINUE                                             72700000
727100         WHEN SQLCODE = -904                                      72710000
727200         WHEN SQLCODE = -911                                      72720000
727300         WHEN SQLCODE = -913                                      72730000
727400             PERFORM 9900-SOFT-ABORT                              72740000
727500                                                                  72750000
727600         WHEN SQLWARN0 NOT = SPACES                               72760000
727700         WHEN SQLCODE < ZERO                                      72770000
727800         WHEN SQLCODE > ZERO                                      72780000
727900             MOVE '8600-RECEIV-PURITM-JOIN'                       72790000
728000                                  TO DP013-PARAGRAPH              72800000
728100             MOVE 'UNSUCCESSFUL JOIN OF 3 TABLES'                 72810000
728200                                  TO DP013-MESSAGE-TEXT (1)       72820000
728300             MOVE DK-PO-NBR              TO PV-DISP-PO-NBR        72830000
728400             MOVE DK-REC-SEQ-NBR         TO PV-DISP-REC-SEQ-NBR   72840000
728500             MOVE DK-DRIVER-LNE-NBR      TO PV-DISP-LNE-NBR       72850000
728600             STRING 'PO '                                         72860000
728700                    PV-DISP-PO-NBR                                72870000
728800                    ' REC '                                       72880000
728900                    PV-DISP-REC-SEQ-NBR                           72890000
729000                    ' LINE '                                      72900000
729100                    PV-DISP-LNE-NBR     DELIMITED BY SIZE         72910000
729200                             INTO DP013-MESSAGE-TEXT (2)          72920000
729300             MOVE SQLCA      TO DP013-SQLCA                       72930000
729400             MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)          72940000
729500             MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME (2)          72950000
729600             MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (3)          72960000
729700             SET DP013-DB2-ABEND                                  72970000
729800                 DP013-NO-ROLLBACK                                72980000
729900                                  TO TRUE                         72990000
730000             PERFORM DP013-0000-PROCESS-ABEND                     73000000
730100     END-EVALUATE.                                                73010000
730200                                                                  73020000
730300 8700-PROCESS-OTHER-LINES.                                        73030000
730400     MOVE DK-DRIVER-LNE-NBR    TO PV-SAVE-DRIVER-LINE.            73040000
730500     SET PS-NOT-EOC-PAC-CSR TO TRUE.                              73050000
730600     SET PS-NOT-DRIVER-LINE TO TRUE.                              73060000
730700     PERFORM 8720-OPEN-CURSOR.                                    73070000
730800     PERFORM 8740-PROCESS-CURSOR UNTIL PS-EOC-PAC-CSR.            73080000
730900     PERFORM 8770-CLOSE-CURSOR.                                   73090000
731000     MOVE PV-SAVE-DRIVER-LINE  TO DK-DRIVER-LNE-NBR.              73100000
731100                                                                  73110000
731200 8720-OPEN-CURSOR.                                                73120000
731300                                                                  73130000
731400     EXEC SQL                                                     73140000
731500          OPEN TOTAL-PACK-CURSOR                                  73150000
731600     END-EXEC.                                                    73160000
731700                                                                  73170000
731800     EVALUATE TRUE                                                73180000
731900         WHEN SQLCODE = ZERO                                      73190000
732000             SET PS-NOT-EOC-PAC-CSR TO TRUE                       73200000
732100         WHEN SQLWARN0 NOT = SPACES                               73210000
732200         WHEN SQLCODE < ZERO                                      73220000
732300         WHEN SQLCODE > ZERO                                      73230000
732400             MOVE '8720-OPEN-CURSOR'                              73240000
732500                               TO DP013-PARAGRAPH                 73250000
732600             MOVE 'OPEN PACK CURSOR - '                           73260000
732700                               TO DP013-MESSAGE-TEXT (1)          73270000
732800             MOVE DK-PO-NBR        TO PV-DISP-PO-NBR              73280000
732900             MOVE DK-OPER-UNT-ID   TO PV-DISP-OPER-UNT-ID         73290000
733000             MOVE DK-FCLTY-ID      TO PV-DISP-FCLTY-ID            73300000
733100             MOVE DK-REC-SEQ-NBR   TO PV-DISP-REC-SEQ-NBR         73310000
733200             MOVE DK-UPDATE-PACK-ID TO PV-DISP-PREPK-ID           73320000
733300             STRING ' PO = '                                      73330000
733400                    PV-DISP-PO-NBR                                73340000
733500                    ' RECV ='                                     73350000
733600                    PV-DISP-REC-SEQ-NBR                           73360000
733700                    ' OPER = '                                    73370000
733800                    PV-DISP-OPER-UNT-ID                           73380000
733900                    ' FCLTY = '                                   73390000
734000                    PV-DISP-FCLTY-ID                              73400000
734100                    ' PACK ='                                     73410000
734200                    PV-DISP-PREPK-ID    DELIMITED BY SIZE         73420000
734300                             INTO DP013-MESSAGE-TEXT (2)          73430000
734400             MOVE SQLCA        TO DP013-SQLCA                     73440000
734500             MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (1)        73450000
734600             SET DP013-DB2-ABEND                                  73460000
734700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               73470000
734800             PERFORM DP013-0000-PROCESS-ABEND                     73480000
734900     END-EVALUATE.                                                73490000
735000                                                                  73500000
735100 8740-PROCESS-CURSOR.                                             73510000
735200     PERFORM 8750-FETCH-CURSOR.                                   73520000
735300     IF SQLCODE = ZERO                                            73530000
735400         IF RECITM-PREPK-DRV-LNE-CDE NOT = 'A'                    73540000
735500             MOVE RECITM-ORD-LNE-NBR  TO DK-DRIVER-LNE-NBR        73550000
735600             COMPUTE PV-SUM-ITM-QTY =                             73560000
735700                 RECITM-PREPK-RATO-QTY * PV-SAVE-PACK-DIF         73570000
735800             PERFORM 8800-UNITS-WORK-ROUTINE                      73580000
735900         END-IF                                                   73590000
736000     END-IF.                                                      73600000
736100                                                                  73610000
736200 8750-FETCH-CURSOR.                                               73620000
736300                                                                  73630000
736400     EXEC SQL                                                     73640000
736500          FETCH TOTAL-PACK-CURSOR                                 73650000
736600          INTO  :RECITM-ORD-LNE-NBR                               73660000
736700              , :RECITM-PREPK-RATO-QTY                            73670000
736800              , :RECITM-STATUS-CDE                                73680000
736900              , :RECITM-PREPK-DRV-LNE-CDE                         73690000
737000     END-EXEC.                                                    73700000
737100                                                                  73710000
737200     EVALUATE TRUE                                                73720000
737300         WHEN SQLCODE = ZERO                                      73730000
737400             CONTINUE                                             73740000
737500         WHEN SQLCODE = +100                                      73750000
737600             SET PS-EOC-PAC-CSR TO TRUE                           73760000
737700         WHEN SQLWARN0 NOT = SPACES                               73770000
737800         WHEN SQLCODE < ZERO                                      73780000
737900         WHEN SQLCODE > ZERO                                      73790000
738000             MOVE '8750-FETCH-CURSOR'                             73800000
738100                               TO DP013-PARAGRAPH                 73810000
738200             MOVE 'FETCH PACK CURSOR - '                          73820000
738300                               TO DP013-MESSAGE-TEXT (1)          73830000
738400             MOVE DK-PO-NBR        TO PV-DISP-PO-NBR              73840000
738500             MOVE DK-OPER-UNT-ID   TO PV-DISP-OPER-UNT-ID         73850000
738600             MOVE DK-FCLTY-ID      TO PV-DISP-FCLTY-ID            73860000
738700             MOVE DK-REC-SEQ-NBR   TO PV-DISP-REC-SEQ-NBR         73870000
738800             MOVE DK-UPDATE-PACK-ID TO PV-DISP-PREPK-ID           73880000
738900             STRING ' PO = '                                      73890000
739000                    PV-DISP-PO-NBR                                73900000
739100                    ' RECV ='                                     73910000
739200                    PV-DISP-REC-SEQ-NBR                           73920000
739300                    ' OPER = '                                    73930000
739400                    PV-DISP-OPER-UNT-ID                           73940000
739500                    ' FCLTY = '                                   73950000
739600                    PV-DISP-FCLTY-ID                              73960000
739700                    ' PACK ='                                     73970000
739800                    PV-DISP-PREPK-ID    DELIMITED BY SIZE         73980000
739900                             INTO DP013-MESSAGE-TEXT (2)          73990000
740000             MOVE SQLCA        TO DP013-SQLCA                     74000000
740100             MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (1)        74010000
740200             SET DP013-DB2-ABEND                                  74020000
740300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               74030000
740400             PERFORM DP013-0000-PROCESS-ABEND                     74040000
740500     END-EVALUATE.                                                74050000
740600                                                                  74060000
740700                                                                  74070000
740800 8770-CLOSE-CURSOR.                                               74080000
740900                                                                  74090000
741000     EXEC SQL                                                     74100000
741100          CLOSE TOTAL-PACK-CURSOR                                 74110000
741200     END-EXEC.                                                    74120000
741300                                                                  74130000
741400     EVALUATE TRUE                                                74140000
741500         WHEN SQLCODE = ZERO                                      74150000
741600             CONTINUE                                             74160000
741700         WHEN SQLWARN0 NOT = SPACES                               74170000
741800         WHEN SQLCODE < ZERO                                      74180000
741900         WHEN SQLCODE > ZERO                                      74190000
742000             MOVE '8770-CLOSE-CURSOR'                             74200000
742100                               TO DP013-PARAGRAPH                 74210000
742200             MOVE 'CLOSE PACK CURSOR - '                          74220000
742300                               TO DP013-MESSAGE-TEXT (1)          74230000
742400             MOVE DK-PO-NBR        TO PV-DISP-PO-NBR              74240000
742500             MOVE DK-OPER-UNT-ID   TO PV-DISP-OPER-UNT-ID         74250000
742600             MOVE DK-FCLTY-ID      TO PV-DISP-FCLTY-ID            74260000
742700             MOVE DK-REC-SEQ-NBR   TO PV-DISP-REC-SEQ-NBR         74270000
742800             MOVE DK-UPDATE-PACK-ID TO PV-DISP-PREPK-ID           74280000
742900             STRING ' PO = '                                      74290000
743000                    PV-DISP-PO-NBR                                74300000
743100                    ' RECV ='                                     74310000
743200                    PV-DISP-REC-SEQ-NBR                           74320000
743300                    ' OPER = '                                    74330000
743400                    PV-DISP-OPER-UNT-ID                           74340000
743500                    ' FCLTY = '                                   74350000
743600                    PV-DISP-FCLTY-ID                              74360000
743700                    ' PACK ='                                     74370000
743800                    PV-DISP-PREPK-ID    DELIMITED BY SIZE         74380000
743900                             INTO DP013-MESSAGE-TEXT (2)          74390000
744000             MOVE SQLCA        TO DP013-SQLCA                     74400000
744100             MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (1)        74410000
744200             SET DP013-DB2-ABEND                                  74420000
744300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               74430000
744400             PERFORM DP013-0000-PROCESS-ABEND                     74440000
744500     END-EVALUATE.                                                74450000
744600                                                                  74460000
744700******************************************************************74470000
744800* THIS PARAGRAPH WILL FORMAT ALL OF THE DATA NEEDED FOR THE      *74480000
744900* UNITS WORKED ROUTINE AND WILL THEN CALL THE ROUTINE AND        *74490000
745000* THE RESULTS RETURNED FROM THE ROUTINE.                         *74500000
745100******************************************************************74510000
745200 8800-UNITS-WORK-ROUTINE.                                         74520000
745300                                                                  74530000
745400     INITIALIZE PC238-COMM-AREA.                                  74540000
745500                                                                  74550000
745600     EXEC SQL                                                     74560000
745700         SET :PV-TMST =  CURRENT_TIMESTAMP                        74570000
745800     END-EXEC                                                     74580000
745900                                                                  74590000
746000     MOVE PV-TMST                 TO PC238-WRKD-TMST.             74600000
746100                                                                  74610000
746200     IF PS-NOT-DRIVER-LINE                                        74620000
746300         CONTINUE                                                 74630000
746400     ELSE                                                         74640000
746500         SET  PC238-DRIVE-LINE        TO TRUE                     74650000
746600     END-IF.                                                      74660000
746700     MOVE PV-CURR-OPER-UNT-ID     TO PC238-WRKD-OPER-UNT-ID.      74670000
746800     MOVE DK-PO-NBR               TO PC238-PO-NBR.                74680000
746900     MOVE DK-REC-SEQ-NBR          TO PC238-RCVR-SEQ-NBR.          74690000
747000     MOVE DK-DRIVER-LNE-NBR       TO PC238-PO-LNE-NBR.            74700000
747100     IF ASC-POST-VERIFIED-RECEIPT                                 74710000
747200         SET  PC238-TRANS-POST-VRFY-ADJ TO TRUE                   74720000
747300     ELSE                                                         74730000
747400         SET  PC238-TRANS-VERIFY-ADJ  TO TRUE                     74740000
747500     END-IF.                                                      74750000
747600                                                                  74760000
747700     IF  PV-XLT00010-TYPE-DC                                      74770000
747800         SET PC238-DIRECT-STORE-NO TO TRUE                        74780000
747900     ELSE                                                         74790000
748000         SET PC238-DIRECT-STORE-YES TO TRUE                       74800000
748100     END-IF.                                                      74810000
748200                                                                  74820000
748300     MOVE PV-SUM-ITM-QTY          TO PC238-WRKD-UNT-QTY.          74830000
748400     MOVE PURITM-UNT-RTL-PR-AMT   TO PC238-UNT-RETAIL-PRC.        74840000
748500     SET  PC238-MANUAL-VERIFY     TO TRUE.                        74850000
748600     SET  PC238-ODD-UNIT-NO       TO TRUE.                        74860000
748700     MOVE ASC-VRFY-ADJ-QUEUE-NAME TO PC238-VRFY-ADJ-QUEUE-NAME.   74870000
748800     MOVE PV-VRFY-ITEM            TO PC238-TOT-QUEUE-ITEMS.       74880000
748900                                                                  74890000
749000************************************************                  74900000
749100*                                                                 74910000
749200*    MOVE PC238-PO-NBR       TO PV-DISP-PO-NBR.                   74920000
749300*    MOVE PC238-RCVR-SEQ-NBR TO PV-DISP-REC-SEQ-NBR.              74930000
749400*    MOVE PC238-PO-LNE-NBR   TO PV-DISP-LNE-NBR.                  74940000
749500*    MOVE PC238-WRKD-OPER-UNT-ID                                  74950000
749600*                            TO PV-DISP-OPER-UNT-ID.              74960000
749700*    STRING ' RCKCS820 - '      DELIMITED BY SIZE                 74970000
749800*           ' CALLING PCKCS756 WITH KEY INFO - '                  74980000
749900*                               DELIMITED BY SIZE                 74990000
750000*           PV-DISP-PO-NBR      DELIMITED BY SIZE                 75000000
750100*           ' - '               DELIMITED BY SIZE                 75010000
750200*           PV-DISP-REC-SEQ-NBR DELIMITED BY SIZE                 75020000
750300*           ' - '               DELIMITED BY SIZE                 75030000
750400*           PV-DISP-LNE-NBR     DELIMITED BY SIZE                 75040000
750500*           ' - '               DELIMITED BY SIZE                 75050000
750600*           PV-DISP-OPER-UNT-ID DELIMITED BY SIZE                 75060000
750700*                        INTO PV-CICS-MSG-AREA.                   75070000
750800*    MOVE LENGTH OF PV-CICS-MSG-AREA                              75080000
750900*                          TO PV-COMMAREA-LENGTH.                 75090000
751000*    PERFORM 9700-WRITE-TO-CICS-LOG.                              75100000
751100*                                                                 75110000
751200************************************************                  75120000
751300                                                                  75130000
751400     MOVE LENGTH OF PC238-COMM-AREA                               75140000
751500                                  TO PV-COMMAREA-LENGTH.          75150000
751600                                                                  75160000
751700     EXEC CICS                                                    75170000
751800         LINK PROGRAM  (PC-PCKCS756)                              75180000
751900              COMMAREA (PC238-COMM-AREA)                          75190000
752000              LENGTH   (PV-COMMAREA-LENGTH)                       75200000
752100              RESP     (PV-CICS-RESP)                             75210000
752200     END-EXEC.                                                    75220000
752300                                                                  75230000
752400************************************************                  75240000
752500*                                                                 75250000
752600*    MOVE PC238-PO-NBR       TO PV-DISP-PO-NBR.                   75260000
752700*    MOVE PC238-RCVR-SEQ-NBR TO PV-DISP-REC-SEQ-NBR.              75270000
752800*    MOVE PC238-PO-LNE-NBR   TO PV-DISP-LNE-NBR.                  75280000
752900*    MOVE PC238-WRKD-OPER-UNT-ID                                  75290000
753000*                            TO PV-DISP-OPER-UNT-ID.              75300000
753100*    STRING ' RCKCS820 - '      DELIMITED BY SIZE                 75310000
753200*           ' RETURN FROM PCKCS756 - '                            75320000
753300*                               DELIMITED BY SIZE                 75330000
753400*           PV-DISP-PO-NBR      DELIMITED BY SIZE                 75340000
753500*           ' - '               DELIMITED BY SIZE                 75350000
753600*           PV-DISP-REC-SEQ-NBR DELIMITED BY SIZE                 75360000
753700*           ' - '               DELIMITED BY SIZE                 75370000
753800*           PV-DISP-LNE-NBR     DELIMITED BY SIZE                 75380000
753900*           ' - '               DELIMITED BY SIZE                 75390000
754000*           PC238-MOD-SUCCESS-CDE                                 75400000
754100*                               DELIMITED BY SIZE                 75410000
754200*           ' - '               DELIMITED BY SIZE                 75420000
754300*           PC238-UNSUCCESSFUL-CDE                                75430000
754400*                               DELIMITED BY SIZE                 75440000
754500*                        INTO PV-CICS-MSG-AREA.                   75450000
754600*    MOVE LENGTH OF PV-CICS-MSG-AREA                              75460000
754700*                          TO PV-COMMAREA-LENGTH.                 75470000
754800*    PERFORM 9700-WRITE-TO-CICS-LOG.                              75480000
754900*                                                                 75490000
755000************************************************                  75500000
755100                                                                  75510000
755200     EVALUATE TRUE                                                75520000
755300         WHEN PV-CICS-RESP = DFHRESP (NORMAL)                     75530000
755400              IF  PC238-MOD-UNSUCCESSFUL                          75540000
755500                  PERFORM 8810-MOD-UNSUCCESSFUL                   75550000
755600              END-IF                                              75560000
755700         WHEN OTHER                                               75570000
755800              MOVE PC238-PO-NBR       TO PV-DISP-PO-NBR           75580000
755900              MOVE PC238-RCVR-SEQ-NBR TO PV-DISP-REC-SEQ-NBR      75590000
756000              MOVE PC238-PO-LNE-NBR   TO PV-DISP-LNE-NBR          75600000
756100              MOVE PC238-WRKD-OPER-UNT-ID                         75610000
756200                                      TO PV-DISP-OPER-UNT-ID      75620000
756300              MOVE PC238-BAD-SQL-CDE  TO PV-DISP-SQL-CODE         75630000
756400              MOVE PV-CICS-RESP       TO PV-DISP-CICS-RESP        75640000
756500              SET PS-UNITS-WORKED-ERROR  TO TRUE                  75650000
756600              STRING ' RCKCS820 - '      DELIMITED BY SIZE        75660000
756700                     ' 8800-UNITS-WORK-ROUTINE '                  75670000
756800                                         DELIMITED BY SIZE        75680000
756900                     ' BAD CALL TO UNITS WORKED MODULE '          75690000
757000                                         DELIMITED BY SIZE        75700000
757100                     ' - CICS RESP '                              75710000
757200                                         DELIMITED BY SIZE        75720000
757300                     PV-DISP-CICS-RESP                            75730000
757400                                         DELIMITED BY SIZE        75740000
757500                                      INTO PV-CICS-MSG-AREA       75750000
757600              MOVE LENGTH OF PV-CICS-MSG-AREA                     75760000
757700                                        TO PV-COMMAREA-LENGTH     75770000
757800              PERFORM 9700-WRITE-TO-CICS-LOG                      75780000
757900              MOVE SPACES TO PV-CICS-MSG-AREA                     75790000
758000              STRING ' RCKCS820 - '      DELIMITED BY SIZE        75800000
758100                     ' 8800-UNITS-WORK-ROUTINE '                  75810000
758200                                         DELIMITED BY SIZE        75820000
758300                     ' KEY INFO - '      DELIMITED BY SIZE        75830000
758400                     PV-DISP-PO-NBR      DELIMITED BY SIZE        75840000
758500                     ' - '               DELIMITED BY SIZE        75850000
758600                     PV-DISP-REC-SEQ-NBR DELIMITED BY SIZE        75860000
758700                     ' - '               DELIMITED BY SIZE        75870000
758800                     PV-DISP-LNE-NBR     DELIMITED BY SIZE        75880000
758900                                  INTO PV-CICS-MSG-AREA           75890000
759000              MOVE LENGTH OF PV-CICS-MSG-AREA                     75900000
759100                                    TO PV-COMMAREA-LENGTH         75910000
759200              PERFORM 9700-WRITE-TO-CICS-LOG                      75920000
759300              PERFORM 9900-SOFT-ABORT                             75930000
759400     END-EVALUATE.                                                75940000
759500                                                                  75950000
759600******************************************************************75960000
759700* THIS PARAGRAPH WILL MANAGE THE DISPLAY OF INFORMATION TO CSSL  *75970000
759800* FOR WHEN THE UNITS WORKED ROUTINE WAS UNSUCCESSFUL.  THIS      *75980000
759900* PARAGRAPH WILL FORMAT A MESSAGE AND GET IT WRITTEN TO THE      *75990000
760000* CICS LOG AND THEN SOFT ABORT THE PROGRAM.                      *76000000
760100******************************************************************76010000
760200 8810-MOD-UNSUCCESSFUL.                                           76020000
760300                                                                  76030000
760400     MOVE PC238-PO-NBR              TO PV-DISP-PO-NBR.            76040000
760500     MOVE PC238-RCVR-SEQ-NBR        TO PV-DISP-REC-SEQ-NBR.       76050000
760600     MOVE PC238-PO-LNE-NBR          TO PV-DISP-LNE-NBR.           76060000
760700     MOVE PC238-WRKD-OPER-UNT-ID    TO PV-DISP-OPER-UNT-ID.       76070000
760800     MOVE PC238-BAD-SQL-CDE         TO PV-DISP-SQL-CODE.          76080000
760900     SET  PS-UNITS-WORKED-ERROR     TO TRUE.                      76090000
761000     SET  PS-UPDATES-DONE           TO TRUE.                      76100000
761100                                                                  76110000
761200     IF  PC238-MOD-BAD-TMST                                       76120000
761300         STRING ' RCKCS820 - '      DELIMITED BY SIZE             76130000
761400                ' 8800-UNITS-WORK-ROUTINE '                       76140000
761500                                    DELIMITED BY SIZE             76150000
761600                ' BAD TIMESTAMP '   DELIMITED BY SIZE             76160000
761700                PC238-WRKD-TMST     DELIMITED BY SIZE             76170000
761800                             INTO PV-CICS-MSG-AREA                76180000
761900         MOVE LENGTH OF PV-CICS-MSG-AREA                          76190000
762000                               TO PV-COMMAREA-LENGTH              76200000
762100         PERFORM 9700-WRITE-TO-CICS-LOG                           76210000
762200         STRING ' RCKCS820 - '      DELIMITED BY SIZE             76220000
762300                ' 8800-UNITS-WORK-ROUTINE '                       76230000
762400                                    DELIMITED BY SIZE             76240000
762500                ' KEY INFO - '      DELIMITED BY SIZE             76250000
762600                PV-DISP-PO-NBR      DELIMITED BY SIZE             76260000
762700                ' - '               DELIMITED BY SIZE             76270000
762800                PV-DISP-REC-SEQ-NBR DELIMITED BY SIZE             76280000
762900                ' - '               DELIMITED BY SIZE             76290000
763000                PV-DISP-LNE-NBR     DELIMITED BY SIZE             76300000
763100                             INTO PV-CICS-MSG-AREA                76310000
763200         MOVE LENGTH OF PV-CICS-MSG-AREA                          76320000
763300                               TO PV-COMMAREA-LENGTH              76330000
763400         PERFORM 9700-WRITE-TO-CICS-LOG                           76340000
763500         PERFORM 9900-SOFT-ABORT                                  76350000
763600     ELSE                                                         76360000
763700     IF  PC238-MOD-BAD-OPER                                       76370000
763800         STRING ' RCKCS820 - '      DELIMITED BY SIZE             76380000
763900                ' 8800-UNITS-WORK-ROUTINE '                       76390000
764000                                    DELIMITED BY SIZE             76400000
764100                ' BAD OPER UNIT '   DELIMITED BY SIZE             76410000
764200                PV-DISP-OPER-UNT-ID DELIMITED BY SIZE             76420000
764300                             INTO PV-CICS-MSG-AREA                76430000
764400         MOVE LENGTH OF PV-CICS-MSG-AREA                          76440000
764500                               TO PV-COMMAREA-LENGTH              76450000
764600         PERFORM 9700-WRITE-TO-CICS-LOG                           76460000
764700         STRING ' RCKCS820 - '      DELIMITED BY SIZE             76470000
764800                ' 8800-UNITS-WORK-ROUTINE '                       76480000
764900                                    DELIMITED BY SIZE             76490000
765000                ' KEY INFO - '      DELIMITED BY SIZE             76500000
765100                PV-DISP-PO-NBR      DELIMITED BY SIZE             76510000
765200                ' - '               DELIMITED BY SIZE             76520000
765300                PV-DISP-REC-SEQ-NBR DELIMITED BY SIZE             76530000
765400                ' - '               DELIMITED BY SIZE             76540000
765500                PV-DISP-LNE-NBR     DELIMITED BY SIZE             76550000
765600                             INTO PV-CICS-MSG-AREA                76560000
765700         MOVE LENGTH OF PV-CICS-MSG-AREA                          76570000
765800                               TO PV-COMMAREA-LENGTH              76580000
765900         PERFORM 9700-WRITE-TO-CICS-LOG                           76590000
766000         PERFORM 9900-SOFT-ABORT                                  76600000
766100     ELSE                                                         76610000
766200     IF  PC238-MOD-BAD-TRANS-TYPE                                 76620000
766300         STRING ' RCKCS820 - '      DELIMITED BY SIZE             76630000
766400                ' 8800-UNITS-WORK-ROUTINE '                       76640000
766500                                    DELIMITED BY SIZE             76650000
766600                ' BAD TRAN TYPE '   DELIMITED BY SIZE             76660000
766700                PC238-TRANS-TYPE-CDE                              76670000
766800                                    DELIMITED BY SIZE             76680000
766900                             INTO PV-CICS-MSG-AREA                76690000
767000         MOVE LENGTH OF PV-CICS-MSG-AREA                          76700000
767100                               TO PV-COMMAREA-LENGTH              76710000
767200         PERFORM 9700-WRITE-TO-CICS-LOG                           76720000
767300         STRING ' RCKCS820 - '      DELIMITED BY SIZE             76730000
767400                ' 8800-UNITS-WORK-ROUTINE '                       76740000
767500                                    DELIMITED BY SIZE             76750000
767600                ' KEY INFO - '      DELIMITED BY SIZE             76760000
767700                PV-DISP-PO-NBR      DELIMITED BY SIZE             76770000
767800                ' - '               DELIMITED BY SIZE             76780000
767900                PV-DISP-REC-SEQ-NBR DELIMITED BY SIZE             76790000
768000                ' - '               DELIMITED BY SIZE             76800000
768100                PV-DISP-LNE-NBR     DELIMITED BY SIZE             76810000
768200                             INTO PV-CICS-MSG-AREA                76820000
768300         MOVE LENGTH OF PV-CICS-MSG-AREA                          76830000
768400                               TO PV-COMMAREA-LENGTH              76840000
768500         PERFORM 9700-WRITE-TO-CICS-LOG                           76850000
768600         PERFORM 9900-SOFT-ABORT                                  76860000
768700     ELSE                                                         76870000
768800     IF  PC238-MOD-BAD-PO                                         76880000
768900         STRING ' RCKCS820 - '      DELIMITED BY SIZE             76890000
769000                ' 8800-UNITS-WORK-ROUTINE '                       76900000
769100                                    DELIMITED BY SIZE             76910000
769200                ' BAD PO NUMBER '   DELIMITED BY SIZE             76920000
769300                PV-DISP-PO-NBR      DELIMITED BY SIZE             76930000
769400                             INTO PV-CICS-MSG-AREA                76940000
769500         MOVE LENGTH OF PV-CICS-MSG-AREA                          76950000
769600                               TO PV-COMMAREA-LENGTH              76960000
769700         PERFORM 9700-WRITE-TO-CICS-LOG                           76970000
769800         STRING ' RCKCS820 - '      DELIMITED BY SIZE             76980000
769900                ' 8800-UNITS-WORK-ROUTINE '                       76990000
770000                                    DELIMITED BY SIZE             77000000
770100                ' KEY INFO - '      DELIMITED BY SIZE             77010000
770200                PV-DISP-PO-NBR      DELIMITED BY SIZE             77020000
770300                ' - '               DELIMITED BY SIZE             77030000
770400                PV-DISP-REC-SEQ-NBR DELIMITED BY SIZE             77040000
770500                ' - '               DELIMITED BY SIZE             77050000
770600                PV-DISP-LNE-NBR     DELIMITED BY SIZE             77060000
770700                             INTO PV-CICS-MSG-AREA                77070000
770800         MOVE LENGTH OF PV-CICS-MSG-AREA                          77080000
770900                               TO PV-COMMAREA-LENGTH              77090000
771000         PERFORM 9700-WRITE-TO-CICS-LOG                           77100000
771100         PERFORM 9900-SOFT-ABORT                                  77110000
771200     ELSE                                                         77120000
771300     IF  PC238-MOD-BAD-RCVR                                       77130000
771400         STRING ' RCKCS820 - '      DELIMITED BY SIZE             77140000
771500                ' 8800-UNITS-WORK-ROUTINE '                       77150000
771600                                    DELIMITED BY SIZE             77160000
771700                ' BAD RCVR NBR  '   DELIMITED BY SIZE             77170000
771800                PV-DISP-REC-SEQ-NBR DELIMITED BY SIZE             77180000
771900                             INTO PV-CICS-MSG-AREA                77190000
772000         MOVE LENGTH OF PV-CICS-MSG-AREA                          77200000
772100                               TO PV-COMMAREA-LENGTH              77210000
772200         PERFORM 9700-WRITE-TO-CICS-LOG                           77220000
772300         STRING ' RCKCS820 - '      DELIMITED BY SIZE             77230000
772400                ' 8800-UNITS-WORK-ROUTINE '                       77240000
772500                                    DELIMITED BY SIZE             77250000
772600                ' KEY INFO - '      DELIMITED BY SIZE             77260000
772700                PV-DISP-PO-NBR      DELIMITED BY SIZE             77270000
772800                ' - '               DELIMITED BY SIZE             77280000
772900                PV-DISP-REC-SEQ-NBR DELIMITED BY SIZE             77290000
773000                ' - '               DELIMITED BY SIZE             77300000
773100                PV-DISP-LNE-NBR     DELIMITED BY SIZE             77310000
773200                             INTO PV-CICS-MSG-AREA                77320000
773300         MOVE LENGTH OF PV-CICS-MSG-AREA                          77330000
773400                               TO PV-COMMAREA-LENGTH              77340000
773500         PERFORM 9700-WRITE-TO-CICS-LOG                           77350000
773600         PERFORM 9900-SOFT-ABORT                                  77360000
773700     ELSE                                                         77370000
773800     IF  PC238-MOD-BAD-LINE                                       77380000
773900         STRING ' RCKCS820 - '      DELIMITED BY SIZE             77390000
774000                ' 8800-UNITS-WORK-ROUTINE '                       77400000
774100                                    DELIMITED BY SIZE             77410000
774200                ' BAD LINE NBR  '   DELIMITED BY SIZE             77420000
774300                PV-DISP-LNE-NBR     DELIMITED BY SIZE             77430000
774400                             INTO PV-CICS-MSG-AREA                77440000
774500         MOVE LENGTH OF PV-CICS-MSG-AREA                          77450000
774600                               TO PV-COMMAREA-LENGTH              77460000
774700         PERFORM 9700-WRITE-TO-CICS-LOG                           77470000
774800         STRING ' RCKCS820 - '      DELIMITED BY SIZE             77480000
774900                ' 8800-UNITS-WORK-ROUTINE '                       77490000
775000                                    DELIMITED BY SIZE             77500000
775100                ' KEY INFO - '      DELIMITED BY SIZE             77510000
775200                PV-DISP-PO-NBR      DELIMITED BY SIZE             77520000
775300                ' - '               DELIMITED BY SIZE             77530000
775400                PV-DISP-REC-SEQ-NBR DELIMITED BY SIZE             77540000
775500                ' - '               DELIMITED BY SIZE             77550000
775600                PV-DISP-LNE-NBR     DELIMITED BY SIZE             77560000
775700                             INTO PV-CICS-MSG-AREA                77570000
775800         MOVE LENGTH OF PV-CICS-MSG-AREA                          77580000
775900                               TO PV-COMMAREA-LENGTH              77590000
776000         PERFORM 9700-WRITE-TO-CICS-LOG                           77600000
776100         PERFORM 9900-SOFT-ABORT                                  77610000
776200     ELSE                                                         77620000
776300     IF  PC238-MOD-BAD-NO-SHIFT                                   77630000
776400         STRING ' RCKCS820 - '      DELIMITED BY SIZE             77640000
776500                ' 8800-UNITS-WORK-ROUTINE '                       77650000
776600                                    DELIMITED BY SIZE             77660000
776700                ' SHIFT NOT FOUND ' DELIMITED BY SIZE             77670000
776800                PC238-WRKD-TMST     DELIMITED BY SIZE             77680000
776900                ' FOR OPER '        DELIMITED BY SIZE             77690000
777000                PV-DISP-OPER-UNT-ID DELIMITED BY SIZE             77700000
777100                             INTO PV-CICS-MSG-AREA                77710000
777200         MOVE LENGTH OF PV-CICS-MSG-AREA                          77720000
777300                               TO PV-COMMAREA-LENGTH              77730000
777400         PERFORM 9700-WRITE-TO-CICS-LOG                           77740000
777500         STRING ' RCKCS820 - '      DELIMITED BY SIZE             77750000
777600                ' 8800-UNITS-WORK-ROUTINE '                       77760000
777700                                    DELIMITED BY SIZE             77770000
777800                ' KEY INFO - '      DELIMITED BY SIZE             77780000
777900                PV-DISP-PO-NBR      DELIMITED BY SIZE             77790000
778000                ' - '               DELIMITED BY SIZE             77800000
778100                PV-DISP-REC-SEQ-NBR DELIMITED BY SIZE             77810000
778200                ' - '               DELIMITED BY SIZE             77820000
778300                PV-DISP-LNE-NBR     DELIMITED BY SIZE             77830000
778400                             INTO PV-CICS-MSG-AREA                77840000
778500         MOVE LENGTH OF PV-CICS-MSG-AREA                          77850000
778600                               TO PV-COMMAREA-LENGTH              77860000
778700         PERFORM 9700-WRITE-TO-CICS-LOG                           77870000
778800         PERFORM 9900-SOFT-ABORT                                  77880000
778900     ELSE                                                         77890000
779000         STRING ' RCKCS820 - '      DELIMITED BY SIZE             77900000
779100                ' 8800-UNITS-WORK-ROUTINE '                       77910000
779200                                    DELIMITED BY SIZE             77920000
779300                ' DB ERROR - SQL CODE '                           77930000
779400                                    DELIMITED BY SIZE             77940000
779500                PV-DISP-SQL-CODE DELIMITED BY SIZE                77950000
779600                ' FUNC: '           DELIMITED BY SIZE             77960000
779700                PC238-BAD-TABLE-FUNCTION                          77970000
779800                                    DELIMITED BY SIZE             77980000
779900                ' TABLE: '          DELIMITED BY SIZE             77990000
780000                PC238-BAD-TABLE-NAME                              78000000
780100                                    DELIMITED BY SIZE             78010000
780200                             INTO PV-CICS-MSG-AREA                78020000
780300         MOVE LENGTH OF PV-CICS-MSG-AREA                          78030000
780400                               TO PV-COMMAREA-LENGTH              78040000
780500         PERFORM 9700-WRITE-TO-CICS-LOG                           78050000
780600         STRING ' RCKCS820 - '      DELIMITED BY SIZE             78060000
780700                ' 8800-UNITS-WORK-ROUTINE '                       78070000
780800                                    DELIMITED BY SIZE             78080000
780900                ' KEY INFO - '      DELIMITED BY SIZE             78090000
781000                PV-DISP-PO-NBR      DELIMITED BY SIZE             78100000
781100                ' - '               DELIMITED BY SIZE             78110000
781200                PV-DISP-REC-SEQ-NBR DELIMITED BY SIZE             78120000
781300                ' - '               DELIMITED BY SIZE             78130000
781400                PV-DISP-LNE-NBR     DELIMITED BY SIZE             78140000
781500                             INTO PV-CICS-MSG-AREA                78150000
781600         MOVE LENGTH OF PV-CICS-MSG-AREA                          78160000
781700                               TO PV-COMMAREA-LENGTH              78170000
781800         PERFORM 9700-WRITE-TO-CICS-LOG                           78180000
781900         PERFORM 9900-SOFT-ABORT                                  78190000
782000     END-IF                                                       78200000
782100     END-IF                                                       78210000
782200     END-IF                                                       78220000
782300     END-IF                                                       78230000
782400     END-IF                                                       78240000
782500     END-IF                                                       78250000
782600     END-IF.                                                      78260000
782700                                                                  78270000
782800******************************************************************78280000
782900* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *78290000
783000* OBJECT WAS UPDATED.                                            *78300000
783100******************************************************************78310000
783200 9000-UPDATE-SELECTION-QUEUE.                                     78320000
783300                                                                  78330000
783400     PERFORM 9100-READ-SEL-QUEUE                                  78340000
783500                                                                  78350000
783600     SET RC037-UPD (ASC-SEL-SUB) TO TRUE.                         78360000
783700     PERFORM 9200-REWRITE-SEL-QUEUE.                              78370000
783800                                                                  78380000
783900*----------------------------------------------------------------*78390000
784000* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *78400000
784100*----------------------------------------------------------------*78410000
784200 9100-READ-SEL-QUEUE.                                             78420000
784300     EXEC CICS                                                    78430000
784400         READQ TS                                                 78440000
784500             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        78450000
784600             INTO  (RC037-DC-SELECT-RECORD)                       78460000
784700             ITEM  (ASC-SEL-ITEM)                                 78470000
784800             RESP  (PV-CICS-RESP)                                 78480000
784900     END-EXEC.                                                    78490000
785000                                                                  78500000
785100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       78510000
785200         CONTINUE                                                 78520000
785300     ELSE                                                         78530000
785400         SET DP013-LOGIC-ABEND                                    78540000
785500             DP013-NO-ROLLBACK     TO TRUE                        78550000
785600         MOVE '9100-READ-SEL-QUEUE'                               78560000
785700                                   TO DP013-PARAGRAPH             78570000
785800         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   78580000
785900                                   TO DP013-MESSAGE-TEXT (1)      78590000
786000         PERFORM DP013-0000-PROCESS-ABEND                         78600000
786100     END-IF.                                                      78610000
786200                                                                  78620000
786300                                                                  78630000
786400*----------------------------------------------------------------*78640000
786500* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *78650000
786600*----------------------------------------------------------------*78660000
786700 9200-REWRITE-SEL-QUEUE.                                          78670000
786800     EXEC CICS                                                    78680000
786900          WRITEQ TS                                               78690000
787000              QUEUE  (ASC-SEL-QUEUE-NAME-IN)                      78700000
787100              FROM   (RC037-DC-SELECT-RECORD)                     78710000
787200              ITEM   (ASC-SEL-ITEM)                               78720000
787300              RESP   (PV-CICS-RESP)                               78730000
787400              REWRITE                                             78740000
787500     END-EXEC.                                                    78750000
787600                                                                  78760000
787700     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           78770000
787800         CONTINUE                                                 78780000
787900     ELSE                                                         78790000
788000         SET DP013-CICS-ABEND                                     78800000
788100             DP013-NO-ROLLBACK     TO TRUE                        78810000
788200         MOVE '9200-REWRITE-SEL-QUEUE'                            78820000
788300                                   TO DP013-PARAGRAPH             78830000
788400         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   78840000
788500                                   TO DP013-MESSAGE-TEXT (1)      78850000
788600         PERFORM DP013-0000-PROCESS-ABEND                         78860000
788700     END-IF.                                                      78870000
788800                                                                  78880000
788900******************************************************************78890000
789000* READ AN ITEM FROM THE INPUT TROUBLE RECORD                     *78900000
789100* TEMP STORAGE QUEUE.                                            *78910000
789200******************************************************************78920000
789300 9500-READ-TRB-QUEUE.                                             78930000
789400                                                                  78940000
789500     EXEC CICS                                                    78950000
789600         READQ TS                                                 78960000
789700             QUEUE (ASC-TRB-QUEUE-NAME-IN)                        78970000
789800             INTO  (TM003-TRB-QUEUE-WORK-AREA)                    78980000
789900             ITEM  (PC-01-COMP)                                   78990000
790000             RESP  (PV-CICS-RESP)                                 79000000
790100     END-EXEC.                                                    79010000
790200                                                                  79020000
790300     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        79030000
790400         CONTINUE                                                 79040000
790500     ELSE                                                         79050000
790600         SET DP013-LOGIC-ABEND                                    79060000
790700             DP013-NO-ROLLBACK   TO TRUE                          79070000
790800         MOVE '9500-READ-TRB-QUEUE'                               79080000
790900                                 TO DP013-PARAGRAPH               79090000
791000         MOVE 'ATTEMPTING TO READ TO LIST SELECTIONS TS QUEUE'    79100000
791100                                 TO DP013-MESSAGE-TEXT (1)        79110000
791200         MOVE ASC-TRB-QUEUE-NAME-IN                               79120000
791300                                 TO DP013-MESSAGE-TEXT (2)        79130000
791400         PERFORM DP013-0000-PROCESS-ABEND                         79140000
791500     END-IF.                                                      79150000
791600                                                                  79160000
791700 9600-WRITE-TRB-QUEUE.                                            79170000
791800                                                                  79180000
791900*  RCKCS277 WRITES ONLY 1 QUEUE RECORD SO THE ITEM NUMBER         79190000
792000*  WILL ALWAYS EQUAL 1.                                           79200000
792100     EXEC CICS WRITEQ TS                                          79210000
792200             QUEUE (ASC-TRB-QUEUE-NAME-IN)                        79220000
792300             FROM  (TM003-TRB-QUEUE-WORK-AREA)                    79230000
792400             ITEM  (PC-01-COMP)                                   79240000
792500             RESP  (PV-CICS-RESP)                                 79250000
792600             REWRITE                                              79260000
792700     END-EXEC.                                                    79270000
792800                                                                  79280000
792900     IF PV-CICS-RESP NOT = DFHRESP (NORMAL)                       79290000
793000         SET DP013-CICS-ABEND                                     79300000
793100             DP013-NO-ROLLBACK   TO TRUE                          79310000
793200         MOVE '9600-WRITE-TRB-QUEUE'                              79320000
793300                                 TO DP013-PARAGRAPH               79330000
793400         MOVE 'UNSUCCESSFUL LIST ITEMS TEMP STORAGE QUEUE REWRITE'79340000
793500                                 TO DP013-MESSAGE-TEXT(1)         79350000
793600         PERFORM DP013-0000-PROCESS-ABEND                         79360000
793700     END-IF.                                                      79370000
793800                                                                  79380000
793900 9700-WRITE-TO-CICS-LOG.                                          79390000
794000                                                                  79400000
794100     EXEC CICS                                                    79410000
794200          WRITEQ TD                                               79420000
794300          QUEUE  ('CSSL')                                         79430000
794400          FROM  (PV-CICS-MSG-AREA)                                79440000
794500          LENGTH  (PV-COMMAREA-LENGTH)                            79450000
794600          RESP  (PV-CICS-RESP)                                    79460000
794700     END-EXEC.                                                    79470000
794800                                                                  79480000
794900     MOVE SPACES TO PV-CICS-MSG-AREA.                             79490000
795000                                                                  79500000
795100******************************************************************79510000
795200*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *79520000
795300*    AND THE ERROR SWITCHES.                                     *79530000
795400******************************************************************79540000
795500 9900-SOFT-ABORT.                                                 79550000
795600     SET PS-ERROR         TO TRUE.                                79560000
795700     SET DP020-MSG-FATAL  TO TRUE.                                79570000
795800     IF SQLCODE = -913                                            79580000
795900         MOVE PC-TSYMSG-00551 TO DP020-MSG-NUMBER                 79590000
796000     END-IF.                                                      79600000
796100     IF PS-UPDATES-DONE                                           79610000
796200        PERFORM 9901-BACKUP                                       79620000
796300     END-IF.                                                      79630000
796400     MOVE 'PROGRAM EXIT CALL' TO DP013-MESSAGE-TEXT (1).          79640000
796500     PERFORM 0001-CALL-CICS-ARCH-API.                             79650000
796600                                                                  79660000
796700 9901-BACKUP.                                                     79670000
796800     EXEC CICS SYNCPOINT                                          79680000
796900          ROLLBACK                                                79690000
797000     END-EXEC.                                                    79700000
797100                                                                  79710000
797200*----------------------------------------------------------------*79720000
797300*    CURRENT SYSTEM DATE/TIME MODULE                              79730000
797400*----------------------------------------------------------------*79740000
797500                                                                  79750000
797600     COPY DPPD017.                                                79760000
797700                                                                  79770000
797800*----------------------------------------------------------------*79780000
797900*    ABEND PROCESSOR MODULE                                      *79790000
798000*----------------------------------------------------------------*79800000
798100                                                                  79810000
798200     COPY DPPD013.                                                79820000
