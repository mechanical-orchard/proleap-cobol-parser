000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.             SAKRP027.                                00050000
000600 AUTHOR.                 ANGIE COLE.                              00060000
000700 INSTALLATION.           KOHLS.                                   00070000
000800 DATE-WRITTEN            DECEMBER 1999.                           00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100***************************************************************** 00110000
001200*            SETTLEMENT VERFICATION REPORT BY STORE             * 00120000
001300***************************************************************** 00130000
001400* * * *>>>   THIS PROGRAM MUST BE COMPILED COBOL/390   <<<* * * * 00140000
001500***************************************************************** 00150000
001600*                                                                 00160000
001700*  THIS PROGRAM WILL CREATE A DAILY CORPORATE SETTLEMENTS REPORT. 00170000
001800*                                                                 00180000
001900*   INPUT: INP01 - CONTAINS POS DATE, WHICH IS USED AS THE        00190000
002000*                  PROCESS DATE TO CREATE THE REPORT.             00200000
002100*  OUTPUT: RPT01 - REPORT SHOWING CORPORATE SETTLEMENTS BY STORE. 00210000
002200*                                                                 00220000
002800*                                                                 00230000
002900*  THE PROGRAM READS A CONTROL CARD FILE TO GET THE POS DATE.     00240000
003000*                                                                 00250000
003100*  THIS DATE IS PASSED TO THE KOHLS CALENDAR ROUTINE.  THE DATE   00260000
003200*  IS VALIDATED AND RETURNED IN DB2 DATE FORMAT.  THE REFORMATTED 00270000
003300*  DATE (PROCESS DATE) IS USED TO SELECT THE ROW FROM DB2 TABLE   00280000
003400*  TEPPART, WHERE SLS_DTE IS EQUAL TO THE PROCESS DATE.           00290000
003500*                                                                 00300000
003600*  THE PARTN_NBR SELECTED IS USED IN A CURSOR TO SELECT           00310000
003700*  UNAUDITED REGISTER TOTALS FROM THE TSASUM TABLE.               00320000
003800*                                                                 00330000
003900*  THE PARTN_NBR IS ALSO USED IN A SELECT OF SALES CORRECTION     00340000
004000*  DATA FROM THE TEPDKEY, TEPTRN AND TEPTND TABLES. COLUMNS       00350000
004100*  ARE ALSO SELECTED FROM THE TEPITM TABLE.                       00360000
004200*                                                                 00370000
004300***************************************************************** 00380000
004400*  CHANGED BY: MATT STIFF              DATE: 02/01/2000           00390000
004500*                                                                 00400000
004600*  CHANGED REFERENCES OF ARKUT001 TO ARKUT059.  ARKUT059 IS       00410000
004700*  REPLACING ARKUT001 AS PART OF THE TAX PROJECT.                 00420000
004800*                                                                 00430000
004900***************************************************************** 00440000
005000*  CHANGED BY: LIHUA LIANG             DATE: 08/23/2000           00450000
005100*                                                                 00460000
005200*  CREATE A SETTLEMENT AMOUNT BY STORE FILE.   WR21315.           00470000
005300*                                                                 00480000
005400***************************************************************** 00490000
005500*  CHANGED BY: LIHUA LIANG             DATE: 08/24/2000           00500000
005600*                                                                 00510000
005700*  MODIFIED THE LOGIC SO THE LAST STORE WON'T PRINT TWICE.        00520000
005800***************************************************************** 00530000
005900*  CHANGED BY: JENNIFER ENDRIES        DATE: 07/30/2001           00540000
006000*                                                                 00550000
006100*  CHANGED REFERENCES OF ARKUP014-3 TO TCKRP014-3 REPORT.         00560000
006200*  DUE TO E-COMMERCE, THREE ADDITIONAL REPORTS NEEDED TO BE       00570000
006300*  REFERENCED.  TCKUP001-3 WAS ADDED FOR BANKCARD,                00580000
006400*  TCKUP000-3 WAS ADDED FOR DISCOVER AND TCKUP002-3 WAS ADDED     00590000
006500*  FOR AMEX.INITIALIZATION OF PV-SUM-CURSOR-CNT AND               00600048
006600*  PV-STTL-CURSOR CNT NEEDED TO BE PROCESSED IN                   00610000
006700*  1000-INITIALIZE-PROGRAM INSTEAD OF 2000-PROCESS.               00620000
006800*                                                                 00630000
006900***************************************************************** 00640000
007000*  CHANGED BY: THOMAS HANSON           DATE: 10/18/2004           00650000
007100*                                      WR:   WR27107              00660000
007200*  CHANGED DB2 TABLE REFERENCES FROM TSTR000 TO XST_LOC AND       00670000
007300*  XST_LOC_ATTR.  ELIMINATED ANY REFERENCE TO TSTR000 FIELDS.     00680000
007400*  PER XS DOMAIN & STORE CONSTRAINTS PROJECTS.                    00690000
007500*                                                                 00700000
007600***************************************************************** 00710000
007700*  CHANGED BY: CAROLE MCCAMMON         DATE: 09/13/2005           00720000
007800*                                      WR:   WR29309              00730000
007900*  MODIFY THE DAILY CORPORATE SETTLEMENT REPORT BY STORE TO       00740000
008000*  SHOW THE DAILY KOHL'S DEBIT CARD SETTLEMENT AMOUNT.            00750000
008100*                                                                 00760000
008200***************************************************************** 00770000
008300*  CHANGED BY: STEVEN NOWAK            DATE: 03/08/2006           00780000
008400*                                      WR/IR P000852075           00790000
008500*  ADD CURSOR/LOGIC TO PROCESS VOID LATE TRANSACTIONS             00800000
008600*                                                                 00810000
008700***************************************************************** 00820000
008800*  CHANGED BY: MIKE MATTER             DATE: 07/24/2006           00830000
008900*                                      WR/IR P000899714           00840000
009000*                                                                 00850000
009100*  MODIFIED THE LATE-CURSOR TO EXCLUDE VOIDED TENDERS AND ADDED   00860000
009200*  ERROR OUTPUT DISPLAYS IN 4050-CHECK-DEBIT-TYPE.                00870000
009300***************************************************************** 00880000
009400*  CHANGED BY: JIM HUNTER              DATE: 10/17/2006           00890000
009500*                                      WR/IR PM00888251           00900000
009600*                                                                 00910000
009700*  ADDED A CURSOR TO PICK UP REGISTER ZERO TRANSACTION TOTALS,    00920000
009800*  WHICH ARE NOT INCLUDED IN THE TSASUM SUMMARY CURSOR.           00930000
009900*  FIND JH1017 TO SEE CHANGES.                                    00940000
010000***************************************************************** 00950000
002300***************************************************************** 00960000
N2I201*  CHANGED 04/15/08 BY LYNN MCADAMS                               00970000
N2I201*  BLACK HAWK CHANGES (THIRD PARTY GIFT CARD) FOR NEXT GEN 2      00980000
P8612 ***************************************************************** 00981000
P8612 *  CHANGED 10/01/14 BY COGNIZANT          CHG0092405              00982000
P8612 *  ADDED WAYFAIR COMMISSION AND WAYFAID RETURN COMMISION RECORDS  00983000
P8612 *  TO THE REPORT.                                                 00984000
      ***************************************************************** 00985000
TPCDSC***************************************************************** 00986000
TPCDSC*  CHANGED 04/18/20 BY BARB SCHULTZ       CHG0242874              00987000
TPCDSC*  ADDED AND STR_GP_CDE   = 'A' TO TEPPART SQL.                   00988000
      ***************************************************************** 00989000
SEPHOR***************************************************************** 00990000
SEPHOR*  CHANGED 04/20/20 BY BARB SCHULTZ       CHG0255409              00991000
SEPHOR*  REMOVED WAYFAIR COMMISSION AND WAYFAIR RETURN COMMISSION CODE. 00992000
SEPHOR*  ADDED SEPHORA CHARGE SALES, SEPHORA CHARGE RETURNS, SEPHORA    00993000
SEPHOR*  GIFT CARD TENDERS, SEPHORA GIFT CARD SOLD TO THE REPORT AND    00994000
SEPHOR*  FILE. DELETED THE REG-ZERO CURSOR CODE. FIXED A BUG IN THE     00995000
SEPHOR*  PROGRAM FOR LATE VOID AFTERS.  THIS CURSOR WAS LOOKING AT THE  00995100
SEPHOR*  TOT-TRN-AMT AND SUBTRACTING IT FROM THE TOTAL AMOUNT FOR THAT  00995200
SEPHOR*  TENDER NOT ACCOUNTING FOR SPLIT TENDERS.  INSTEAD OF USING THE 00995300
SEPHOR*  TOT-TRN-AMT, THE TNDR-AMT IS USED AND IS SUBTRACTING IT FROM   00995400
SEPHOR*  THE APPROPRIATE TENDER TYPE'S UNALLOCATED TOTAL.               00995500
SEPHOR***************************************************************** 00996000
257408***************************************************************** 00996100
257408*  CHANGED 06/01/21 BY JIM HUNTER         CHG0257408              00996200
257408*  REPLACED XST_LOC_ATTR POS_CAP_LVL_ID CHECK IN TSASUM CURSOR    00996300
257408*  WITH CHECK FOR XST_LOC LOC_TYP_CDE = 'DS'.                     00996400
257408***************************************************************** 00996500
SEPH02*  CHANGED 04/20/22 BY BARB SCHULTZ         CHG0269192            00997007
SEPH02*  CHANGED THE SEPHORA GIFT CARD DEPT FROM '070' TO '712'.        00997102
SEPH02*  ADDED TNDR_ID_SRC_CDE TO KNOW IF THE GIFT CARD IS SEPHORA.     00997202
SEPH02*  COMMENTED OUT ALL SEPHORA CHARGE CARD SALES AND RETURNS SINCE  00997302
SEPH02*  THIS IS NOT IN SCOPE RIGHT NOW AND REMOVED IT FROM THE REPORT. 00997402
SEPH02*  THIS BROUGHT OUR OCCURANCES OF DATA ON THE REPORT TO 14 INSTEAD00997502
SEPH02*  OF 15.                                                         00997602
SEPH02***************************************************************** 00997702
SEPH03*  CHANGED 08/30/22 BY BARB SCHULTZ         CHG0273953            00997808
SEPH03*  COMMENTED OUT THE SUBTRACTION OF SEPHORA GIFT CARD TOTALS      00997908
SEPH03*  BECAUSE THEY ARE ALREADY SUBTRACTED UNDER GDS.                 00998008
SEPH03***************************************************************** 00998108
SEPH04*  CHANGED 12/06/22 BY BARB SCHULTZ         CHG0278871            00998215
SEPH04*  SUBTRACTED SGS FROM TPC AFTER SGS HAS BEEN ADDED.              00998314
SEPH04*  SUBTRACTED SGT FROM GDT AFTER SGT HAS BEEN ADDED.              00998414
SEPH04*  REMOVED WFS AND WRC FROM SUMMARY-CURSOR.                       00998510
SEPH04***************************************************************** 00998610
COBRND*  CHANGED 03/02/23 BY BARB SCHULTZ         CHG0285913            00998731
COBRND*  ADDED THE NEW COBRAND TENDER VALUE - CVN AND KCP TO THE CURSOR.00998816
COBRND*  ALSO ADDED THE COBRAND VISA AND COBRAND PAYMENT TO THE REPORT. 00998916
COBRND*  SUBTRACTED COBRAND VISA FROM BCN AND SUBTRACTED COBRAND PAYMENT00999016
COBRND*  FROM KCP. SELECTED THE COBRAND-IND FROM TEPPAY TO KNOW IF      00999116
COBRND*  THE PAYMENT SHOULD BE SUBTRACTED FROM KCP.                     00999216
COBRND***************************************************************** 00999416
PAYVEN*  CHANGED 04/24/23 BY BARB SCHULTZ         CHG0287669            00999535
PAYVEN*  ADDED THE NEW PAYPAL TENDER VALUE - PPS AND PPR TO THE CURSOR. 00999635
PAYVEN*  ADDED THE NEW VENMO TENDER VALUE - VMS AND VMR TO THE CURSOR.  00999735
PAYVEN*  ALSO ADDED PAYPAL AND VENMO TO THE REPORT.                    T00999835
PAYVEN***************************************************************** 01000135
COBRN1*  CHANGED 05/11/23 BY BARB SCHULTZ         CHG0288283            01000245
COBRN1*  REMOVED 'NET' FROM COBRAND VISA NET.                           01000345
COBRN1***************************************************************** 01000645
COBTRL*  CHANGED 10/30/23 BY JIM HUNTER           CHG0296519            01000849
COBTRL*  ADDING LOGIC TO ADJUST CATEGORIES FOR COBRAND TRAILING         01000946
COBTRL*  TRANSACTIONS.  THESE TRANSACTIONS ARE THOSE MADE AGAINST       01001046
COBTRL*  KOHL'S CHARGE ACCOUNTS FOR CUSTOMERS WHO NOW HAVE COBRAND      01001146
COBTRL*  ACCOUNTS INSTEAD.                                              01001246
COBTRL*  THEY WILL COME FROM THE TSASUM TABLE, REGISTER ZERO, CATEGORIES01001346
COBTRL*  TTN (COBRAND TRAILING NET) AND TTP (COBRAND TRAILING PAYMENTS).01001446
COBTRL*  TTN WILL BE SUBTRACTED FROM KCN BEFORE KCN IS REPORTED ON.     01001546
COBTRL*  TTN WILL BE ADDED TO CVN BEFORE CVN IS REPORTED ON.            01001646
COBTRL*  TTP WILL BE SUBTRACTED FROM KCP BEFORE KCP IS REPORTED ON.     01001746
COBTRL*  TTP WILL BE ADDED TO CVP BEFORE CVP IS REPORTED ON.            01001846
COBTRL***************************************************************** 01001946
010100                                                                  01002045
010200 ENVIRONMENT DIVISION.                                            01002145
010300 CONFIGURATION SECTION.                                           01002245
010400                                                                  01003035
010500 SOURCE-COMPUTER.        IBM-3090.                                01010000
010600 OBJECT-COMPUTER.        IBM-3090.                                01020000
010700                                                                  01030000
010800 INPUT-OUTPUT SECTION.                                            01040000
010900 FILE-CONTROL.                                                    01050000
011000                                                                  01060000
011100     SELECT POS-DATE-CARD-FILE                                    01070000
011200         ASSIGN TO INP01.                                         01080000
011300                                                                  01090000
011400     SELECT SETTLEMENT-REPORT-FILE                                01100000
011500         ASSIGN TO RPT01.                                         01110000
011600                                                                  01120000
011700     SELECT SETTLEMENT-FILE                                       01130000
011800         ASSIGN TO FIL01.                                         01140000
011900                                                                  01150000
012000 DATA DIVISION.                                                   01160000
012100 FILE SECTION.                                                    01170000
012200                                                                  01180000
012300 FD  POS-DATE-CARD-FILE                                           01190000
012400     RECORDING MODE IS F                                          01200000
012500     BLOCK CONTAINS 0 RECORDS                                     01210000
012600     LABEL RECORDS ARE STANDARD.                                  01220000
012700                                                                  01230000
012800 01  POS-DATE-CARD-RECORD            PIC X(80).                   01240000
012900                                                                  01250000
013000 FD  SETTLEMENT-REPORT-FILE                                       01260000
013100     RECORDING MODE IS F                                          01270000
013200     BLOCK CONTAINS 0  RECORDS.                                   01280000
013300                                                                  01290000
013400 01  SETTLEMENT-REPORT-RECORD        PIC  X(132).                 01300000
013500                                                                  01310000
013600 FD  SETTLEMENT-FILE                                              01320000
013700     RECORDING MODE IS F                                          01330000
013800     BLOCK CONTAINS 0  RECORDS.                                   01340000
013900                                                                  01350000
014000 01  SETTLEMENT-FILE-RECORD          PIC  X(33).                  01360000
014100                                                                  01370000
014200******************************************************************01380000
014300 WORKING-STORAGE SECTION.                                         01390000
014400******************************************************************01400000
014500 01  FILLER                            PIC X(50)  VALUE           01410000
014600     ' *** WORKING STORAGE STARTS HERE FOR SAKRP027 *** '.        01420000
014700                                                                  01430000
014800******************************************************************01440000
014900* RECORD LAYOUT FOR INPUT DATE CARD (POS DATE)                    01450000
015000******************************************************************01460000
015100 01  CC-CONTROL-CARD.                                             01470000
015200     05  CC-CONTROL-CARD-DISPLAY.                                 01480000
015300         10  CC-CONTROL-NAME     PIC X(14)    VALUE SPACE.        01490000
015400             88  CC-VALID-CONTROL-NAME        VALUE               01500000
015500                 'P.O.S. DATE = '.                                01510000
015600         10  CC-POS-DATE-MMDDYY  PIC 9(6)     VALUE ZERO.         01520000
015700         10  FILLER              PIC X(1)     VALUE SPACE.        01530000
015800         10  CC-RE-RING-IND      PIC X(1)     VALUE SPACE.        01540000
015900             88  CC-ALLOW-RE-RINGS            VALUE 'Y'.          01550000
016000             88  CC-DO-NOT-ALLOW-RE-RINGS     VALUE ' ',          01560000
016100                                                    LOW-VALUES.   01570000
016200     05  FILLER                  PIC X(58)    VALUE SPACE.        01580000
016300******************************************************************01590000
016400*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)             01600000
016500******************************************************************01610000
016600                                                                  01620000
016700     COPY DPWS500.                                                01630000
016800     COPY ARRD048.                                                01640000
016900                                                                  01650000
017000 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      01660000
017100                                                  COMP SYNC.      01670000
017200     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    01680000
017300     88  AC-DB2-ERROR                             VALUE +4013.    01690000
017400     88  AC-CALENDAR-ROUTINE-ERROR                VALUE +4019.    01700000
017500                                                                  01710000
017600 01  PS-PROGRAM-SWITCHES.                                         01720000
017700     05  PS-END-OF-SUM-CURSOR-SW       PIC X(01)  VALUE 'N'.      01730000
017800         88  PS-END-OF-SUM-CURSOR                 VALUE 'Y'.      01740000
018100     05  PS-END-OF-STTL-CURSOR-SW      PIC X(01)  VALUE 'N'.      01770000
018200         88  PS-END-OF-STTL-CURSOR                VALUE 'Y'.      01780000
018300     05  PS-END-OF-ITEM-CURSOR-SW      PIC X(01)  VALUE 'N'.      01790000
018400         88  PS-END-OF-ITEM-CURSOR                VALUE 'Y'.      01800000
018500     05  PS-END-OF-TENDER-CURSOR-SW    PIC X(01)  VALUE 'N'.      01810000
018600         88  PS-END-OF-TENDER-CURSOR              VALUE 'Y'.      01820000
018700     05  PS-END-OF-LATE-CURSOR-SW      PIC X(01)  VALUE 'N'.      01830000
018800         88  PS-END-OF-LATE-CURSOR                VALUE 'Y'.      01840000
018900                                                                  01850000
019000     05  PS-END-OF-CARD-FILE-SW        PIC X(01)  VALUE 'N'.      01860000
019100         88  PS-END-OF-CARD-FILE                  VALUE 'Y'.      01870000
019200                                                                  01880000
019300     05  PS-END-OF-STORES-SW           PIC X(01)  VALUE 'N'.      01890000
019400         88  PS-END-OF-STORES                     VALUE 'Y'.      01900000
019500         88  PS-NOT-END-OF-STORES                 VALUE 'N'.      01910000
019600                                                                  01920000
019700     05  PS-DEBIT-TYPE                 PIC  X(01) VALUE SPACE.    01930000
019800         88  PS-KOHLS-DEBIT                       VALUE 'K'.      01940000
019900     05  PS-NULL-IND1                  PIC S9(4)  VALUE ZERO COMP.01950000
020000                                                                  01960000
020100 01  PC-CONSTANTS.                                                01970000
SEPHOR     05  PC-LINE-LIMIT               PIC S9(04)    VALUE +65.     01980000
020300     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     01990000
020400                                                   COMP SYNC.     02000000
020500     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          02010000
020600                                                   'SAKRP027'.    02020000
020700     05  PC-REPORT-NBR-1             PIC  9(01)    VALUE 1.       02030000
020800                                                                  02040000
020900     05  PC-BANKCARD-STTL-FILE1      PIC  X(10)    VALUE          02050000
021000                                                   'TCKRP006-1'.  02060000
021100     05  PC-DISCOVER-STTL-FILE1      PIC  X(10)    VALUE          02070000
021200                                                   'ARKUP000-3'.  02080000
021300     05  PC-AMEX-STTL-FILE1          PIC  X(10)    VALUE          02090000
021400                                                   'TCKRP006-3'.  02100000
021500     05  PC-BANKCARD-STTL-FILE2      PIC  X(10)    VALUE          02110000
021600                                                   'TCKUP001-3'.  02120000
021700 01  PC-SETTLEMENT-LITERALS.                                      02130000
P8612      05  FILLER                      PIC X(19)     VALUE          02140000
P8612                                          'BANKCARD           '.   02150000
022000     05  FILLER                      PIC X(10)     VALUE          02160000
022100                                         'TCKRP006-1'.            02170000
022200     05  FILLER                      PIC X(12)     VALUE          02180000
022300                                         'CALL        '.          02190000
P8612      05  FILLER                      PIC X(19)     VALUE          02200000
P8612                                          'AMERICAN EXPRESS   '.   02210000
022600     05  FILLER                      PIC X(10)     VALUE          02220000
022700                                         'TCKRP006-3'.            02230000
022800     05  FILLER                      PIC X(12)     VALUE          02240000
022900                                         '            '.          02250000
P8612      05  FILLER                      PIC X(19)     VALUE          02260000
P8612                                          'DISCOVER           '.   02270000
N2I201     05  FILLER                      PIC X(10)     VALUE          02280000
N2I201                                         'TCKRP006-6'.            02290000
023400     05  FILLER                      PIC X(12)     VALUE          02300000
023500                                         '            '.          02310000
P8612      05  FILLER                      PIC X(19)     VALUE          02320000
P8612                                          'DEBIT              '.   02330000
023800     05  FILLER                      PIC X(10)     VALUE          02340000
023900                                         'TCKRP002-1'.            02350000
024000     05  FILLER                      PIC X(12)     VALUE          02360000
024100                                         '            '.          02361017
COBRND     05  FILLER                      PIC X(19)     VALUE          02370016
COBRN1                                         'COBRAND VISA       '.   02371045
COBRND     05  FILLER                      PIC X(10)     VALUE          02372016
COBRND                                         '          '.            02373020
COBRND     05  FILLER                      PIC X(12)     VALUE          02374016
COBRND                                         '            '.          02375016
PAYVEN     05  FILLER                      PIC X(19)     VALUE          02376035
PAYVEN                                         'PAYPAL             '.   02377035
PAYVEN     05  FILLER                      PIC X(10)     VALUE          02378035
PAYVEN                                         '          '.            02379035
PAYVEN     05  FILLER                      PIC X(12)     VALUE          02379135
PAYVEN                                         '            '.          02379235
PAYVEN     05  FILLER                      PIC X(19)     VALUE          02379335
PAYVEN                                         'VENMO              '.   02379435
PAYVEN     05  FILLER                      PIC X(10)     VALUE          02379535
PAYVEN                                         '          '.            02379635
PAYVEN     05  FILLER                      PIC X(12)     VALUE          02379735
PAYVEN                                         '            '.          02379835
N2I201     05  FILLER                      PIC X(06)     VALUE 'THIRD '.02380000
N2I201     05  FILLER                      PIC X(06)     VALUE 'PARTY '.02390000
N2I201     05  FILLER                      PIC X(06)     VALUE 'CARDS '.02400000
P8612      05  FILLER                      PIC X(01)     VALUE ' '.     02410000
N2I201     05  FILLER                      PIC X(10)     VALUE          02420000
N2I201                                         'AUKRP001-1'.            02430000
024700     05  FILLER                      PIC X(12)     VALUE          02440000
024800                                         '            '.          02450000
024900     05  FILLER                      PIC X(04)     VALUE 'KOHL'.  02460000
025000     05  FILLER                      PIC X(01)     VALUE QUOTE.   02470000
025100     05  FILLER                      PIC X(02)     VALUE 'S '.    02480000
025200     05  FILLER                      PIC X(06)     VALUE 'CHARGE'.02490000
P8612      05  FILLER                      PIC X(06)     VALUE SPACES.  02500000
025400     05  FILLER                      PIC X(10)     VALUE          02510000
025500                                         'ARKUT059-3'.            02520000
025600     05  FILLER                      PIC X(12)     VALUE          02530000
025700                                         '            '.          02540000
025800     05  FILLER                      PIC X(04)     VALUE 'KOHL'.  02550000
025900     05  FILLER                      PIC X(01)     VALUE QUOTE.   02560000
026000     05  FILLER                      PIC X(02)     VALUE 'S '.    02570000
026100     05  FILLER                      PIC X(08)     VALUE          02580000
026200                                         'PAYMENTS'.              02590000
P8612      05  FILLER                      PIC X(04)     VALUE SPACES.  02600000
026400     05  FILLER                      PIC X(10)     VALUE          02610000
026500                                         'ARKUT059-3'.            02620000
026600     05  FILLER                      PIC X(12)     VALUE          02630000
026700                                         '            '.          02640000
P8612      05  FILLER                      PIC X(19)     VALUE          02650000
P8612                                          'GIFT CARD SOLD     '.   02660000
N2I201     05  FILLER                      PIC X(10)     VALUE          02670000
N2I201                                         'SVKRP004-2'.            02680000
027200     05  FILLER                      PIC X(12)     VALUE          02690000
027300                                         '            '.          02700000
P8612      05  FILLER                      PIC X(19)     VALUE          02710000
P8612                                          'GIFT CARD TENDERED '.   02720000
N2I201     05  FILLER                      PIC X(10)     VALUE          02730000
N2I201                                         'SVKRP004-2'.            02740000
027800     05  FILLER                      PIC X(12)     VALUE          02750000
027900                                         '            '.          02760000
P8612      05  FILLER                      PIC X(19)     VALUE          02770000
P8612                                          'KMRC ISSUED        '.   02780000
028200     05  FILLER                      PIC X(10)     VALUE          02790000
028300                                         'SVKRP004-1'.            02800000
028400     05  FILLER                      PIC X(12)     VALUE          02810000
028500                                         '            '.          02820000
P8612      05  FILLER                      PIC X(19)     VALUE          02830000
P8612                                          'KMRC TENDERED      '.   02840000
N2I201     05  FILLER                      PIC X(10)     VALUE          02850000
N2I201                                         'SVKRP004-1'.            02860000
029000     05  FILLER                      PIC X(12)     VALUE          02870000
029100                                         '            '.          02880000
P8612      05  FILLER                      PIC X(19)     VALUE          02890000
P8612                                          'MDSE SALES         '.   02900000
N2I201     05  FILLER                      PIC X(10)     VALUE          02910000
N2I201                                         'FLASH     '.            02920000
029600     05  FILLER                      PIC X(12)     VALUE          02930000
029700                                         '            '.          02940000
SEPHOR     05  FILLER                      PIC X(19)     VALUE          02950000
SEPH02                                         'SEPHORA GF SOLD    '.   02960101
SEPHOR     05  FILLER                      PIC X(10)     VALUE          02961000
SEPHOR                                         '          '.            02962000
SEPHOR     05  FILLER                      PIC X(12)     VALUE          02963000
SEPHOR                                         '            '.          02964000
SEPHOR     05  FILLER                      PIC X(19)     VALUE          02965000
SEPH02                                         'SEPHORA GF TENDERED'.   02966001
SEPHOR     05  FILLER                      PIC X(10)     VALUE          02967000
SEPHOR                                         '          '.            02968000
SEPHOR     05  FILLER                      PIC X(12)     VALUE          02969000
SEPHOR                                         '            '.          02969100
COBRND     05  FILLER                      PIC X(19)     VALUE          02970016
COBRND                                         'COBRAND VISA PAYMNT'.   02970116
COBRND     05  FILLER                      PIC X(10)     VALUE          02970216
COBRND                                         '          '.            02970316
COBRND     05  FILLER                      PIC X(12)     VALUE          02970416
COBRND                                         '            '.          02970516
029800 01  FILLER REDEFINES PC-SETTLEMENT-LITERALS.                     02970716
PAYVEN     05  FILLER                      OCCURS 18 TIMES.             02970836
P8612          10  PC-STTL-TYPE            PIC X(19).                   02971000
030100         10  PC-STTL-FILE            PIC X(10).                   02980000
030200         10  PC-VERIF-FILE           PIC X(12).                   02990000
030300                                                                  03000000
030400 01  PV-MISC-COUNT-FIELDS            COMP-3.                      03010000
030500     05  PV-PAGE-CNT                 PIC S9(05)      VALUE ZERO.  03020048
030600     05  PV-LINE-CNT                 PIC S9(03)      VALUE ZERO.  03030048
030700     05  PV-LINE-CNT-AHEAD           PIC S9(03)      VALUE ZERO.  03040048
030800     05  PV-SUM-CURSOR-CNT           PIC S9(07)      VALUE ZERO.  03050048
031000     05  PV-STTL-CURSOR-CNT          PIC S9(07)      VALUE ZERO.  03070048
031100     05  PV-LATE-CURSOR-CNT          PIC S9(07)      VALUE ZERO.  03080048
COBTRL     05  PV-TTN-STORE                PIC S9(06)V99   VALUE ZERO.  03081048
COBTRL     05  PV-TTP-STORE                PIC S9(06)V99   VALUE ZERO.  03082048
COBTRL     05  PV-TTN-TOTAL                PIC S9(06)V99   VALUE ZERO.  03083048
COBTRL     05  PV-TTP-TOTAL                PIC S9(06)V99   VALUE ZERO.  03084048
031200                                                                  03090000
031300******************************************************************03100000
031400*  FIELDS TO HOLD TOTALS FOR PRINTING A REPORT TOTAL LINE.        03110000
031500******************************************************************03120000
031600 01  PV-SETTLEMENT-TABLE             COMP-3.                      03130000
PAYVEN     05  FILLER                      OCCURS 18 TIMES.             03141036
031800         10  PV-STTL-UNAUD-REG-TOT   PIC S9(09)V99.               03150000
031900         10  PV-STTL-AUD-SALES-CORR  PIC S9(09)V99.               03160000
032000         10  PV-PRO-STTL-FROM-POS    PIC S9(09)V99.               03170000
032100                                                                  03180000
032200 01  PV-MISC-FIELDS.                                              03190000
032300     05  PV-PRINT-RECORD             PIC X(200)    VALUE SPACE.   03200000
032400     05  PV-LINE-SPACING             PIC S9(04)    VALUE ZERO     03210000
032500                                                   COMP SYNC.     03220000
032600     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACE.   03230000
032700     05  PV-OPERATION-MSG-1          PIC  X(40)    VALUE SPACE.   03240000
032800     05  PV-OPERATION-MSG-2          PIC  X(40)    VALUE SPACE.   03250000
032900     05  PV-DB2-OPERATION            PIC  X(30)    VALUE SPACE.   03260000
033000     05  PV-DISPLAY-PARTN-NBR        PIC  9999     VALUE ZERO.    03270000
033100     05  PV-EDIT-MASK                PIC ZZZ,ZZZ,ZZ9 VALUE ZERO.  03280048
COBTRL     05  PV-EDIT-MASK-TT             PIC ZZZ,ZZZ.99- VALUE ZERO.  03281048
SEPHOR     05  PV-SEPHORA-GC               PIC  S9(7)V9(2) VALUE ZERO.  03290000
SEPHOR     05  PV-TNDR-AMT                 PIC  S9(7)V9(2) VALUE ZERO.  03301000
SEPHOR     05  PV-PARTN-NBR-D              PIC   9(4)      VALUE ZERO.  03310000
SEPHOR     05  PV-STR-NBR-D                PIC   9(4)      VALUE ZERO.  03311000
SEPHOR     05  PV-RGST-ID-D                PIC   9(4)      VALUE ZERO.  03311100
SEPHOR     05  PV-TRN-NBR-D                PIC   9(4)      VALUE ZERO.  03311200
SEPHOR     05  PV-TNDR-SEQ-NBR-D           PIC   9(4)      VALUE ZERO.  03311300
SEPHOR     05  PV-TRN-AMT-D                PIC  S9(7)V9(2) VALUE ZERO.  03311400
SEPHOR     05  PV-TNDR-TYP-CDE-D           PIC   X(02)     VALUE SPACES.03311500
033200     05  PV-GIFT-CARD                PIC  S9(7)V9(2) VALUE ZERO.  03312200
033300     05  PV-GIFT-CERT                PIC  S9(7)V9(2) VALUE ZERO.  03312300
033400     05  PV-MDSE-SALE                PIC  S9(7)V9(2) VALUE ZERO.  03312400
033500     05  PV-KCN-TOTAL                PIC  S9(9)V9(2) VALUE ZERO.  03312500
033600     05  PV-KCP-TOTAL                PIC  S9(9)V9(2) VALUE ZERO.  03312600
033700     05  PV-KOHLS-DEBIT-TRANS        PIC  S9(9)V9(2) COMP-3.      03312700
033800     05  PV-TRN-TOT-AMT              PIC  S9(7)V9(2) COMP-3.      03313000
N2I201     05  PV-THIRD-PARTY-CARD-SALES   PIC  S9(7)V9(2) VALUE ZERO.  03314000
034000                                                                  03315000
034100 01  PV-SUBSCRIPTS                   COMP.                        03316000
034200     05  PV-STTL-SUB                 PIC S9(4)     VALUE ZERO.    03317000
034300                                                                  03318000
034400 01  PV-DATE-AND-TIME-FIELDS.                                     03319000
034500     05  PV-POS-CCYY-MM-DD           PIC X(10)     VALUE SPACE.   03320000
034600     05  FILLER REDEFINES PV-POS-CCYY-MM-DD.                      03330000
034700         10  PV-POS-CCYY             PIC X(04).                   03340000
034800         10  FILLER                  PIC X(01).                   03350000
034900         10  PV-POS-MM               PIC X(02).                   03360000
035000         10  FILLER                  PIC X(01).                   03370000
035100         10  PV-POS-DD               PIC X(02).                   03380000
035200     05  PV-CURR-DATE-CCYYMMDD.                                   03390000
035300         10  PV-CURR-DATE-CCYY       PIC  9(04).                  03400000
035400         10  PV-CURR-DATE-MM         PIC  9(02).                  03410000
035500         10  PV-CURR-DATE-DD         PIC  9(02).                  03420000
035600     05  PV-CURR-TIME.                                            03430000
035700         10  PV-CURR-TIME-HH         PIC  9(02)    VALUE ZERO.    03440000
035800         10  PV-CURR-TIME-MM         PIC  9(02)    VALUE ZERO.    03450000
035900         10  PV-CURR-TIME-SSHH       PIC  9(04)    VALUE ZERO.    03460000
036000                                                                  03470000
036100******************************************************************03480000
036200*  TOP OF PAGE HEADING LINE FOR PRINTING A 132 CHARACTER REPORT.  03490000
036300******************************************************************03500000
036400     COPY DPWS132.                                                03510000
036500                                                                  03520000
036600******************************************************************03530000
036700*  HEADING LINES FOR THE CORPORATE SETTLEMENTS REPORT.            03540000
036800******************************************************************03550000
036900 01  H2-HEADING-LINE-2.                                           03560000
037000     05  FILLER                      PIC  X(26)    VALUE SPACE.   03570000
037100     05  FILLER                      PIC  X(11)    VALUE          03580000
037200                                          'SETTLEMENT '.          03590000
037300     05  FILLER                      PIC  X(13)    VALUE          03600000
037400                                          'VERIFICATION '.        03610000
037500     05  FILLER                      PIC  X(07)    VALUE          03620000
037600                                          'REPORT '.              03630000
037700     05  FILLER                      PIC  X(09)    VALUE          03640000
037800                                          'BY STORE '.            03650000
037900     05  FILLER                      PIC  X(04)    VALUE 'FOR '.  03660000
038000     05  FILLER                      PIC  X(11)    VALUE          03670000
038100                                          'PROCESSING '.          03680000
038200     05  FILLER                      PIC  X(06)    VALUE          03690000
038300                                          'DATE: '.               03700000
038400     05  H2-DATE.                                                 03710000
038500         10  H2-MM                   PIC  X(02)    VALUE SPACE.   03720000
038600         10  FILLER                  PIC  X(01)    VALUE '/'.     03730000
038700         10  H2-DD                   PIC  X(02)    VALUE SPACE.   03740000
038800         10  FILLER                  PIC  X(01)    VALUE '/'.     03750000
038900         10  H2-CCYY                 PIC  X(04)    VALUE SPACE.   03760000
039000     05  FILLER                      PIC  X(35)    VALUE SPACE.   03770000
039100                                                                  03780000
039200 01  H3-HEADING-LINE-3A.                                          03790000
039300     05  FILLER                  PIC X       VALUE SPACE.         03800000
039400     05  FILLER                  PIC X(5)    VALUE SPACES.        03810000
039500     05  HDR3A-PRINT-AREA.                                        03820000
039600         10  HDR3A-STORE-NBR     PIC 9(4)    VALUE ZERO.          03830000
039700         10  FILLER              PIC X       VALUE SPACE.         03840000
039800         10  FILLER              PIC X       VALUE '-'.           03850000
039900         10  FILLER              PIC X       VALUE SPACE.         03860000
040000         10  HDR3A-STORE-NAME    PIC X(20)   VALUE SPACES.        03870000
040100     05  FILLER                  PIC X(100)  VALUE SPACES.        03880000
040200                                                                  03890000
040300 01  H3-HEADING-LINE-3.                                           03900000
040400     05  FILLER                      PIC  X(61)    VALUE SPACE.   03910000
040500     05  FILLER                      PIC  X(08)    VALUE          03920000
040600                                          'PROPOSED'.             03930000
040700     05  FILLER                      PIC  X(63)    VALUE SPACES.  03940000
040800                                                                  03950000
040900 01  H4-HEADING-LINE-4.                                           03960000
041000     05  FILLER                      PIC  X(26)    VALUE SPACE.   03970000
041100     05  FILLER                      PIC  X(13)    VALUE          03980000
041200                                          'UNAUDITED    '.        03990000
041300     05  FILLER                      PIC  X(08)    VALUE          04000000
041400                                          'AUDITED '.             04010000
041500     05  FILLER                      PIC  X(05)    VALUE 'SALES'. 04020000
041600     05  FILLER                      PIC  X(07)    VALUE SPACES.  04030000
041700     05  FILLER                      PIC  X(10)    VALUE          04040000
041800                                          'SETTLEMENT'.           04050000
041900     05  FILLER                      PIC  X(63)    VALUE SPACES.  04060000
042000                                                                  04070000
042100 01  H5-HEADING-LINE-5.                                           04080000
042200     05  FILLER                      PIC  X(20)    VALUE SPACES.  04090000
042300     05  FILLER                      PIC  X(09)    VALUE          04100000
042400                                          'REGISTER '.            04110000
042500     05  FILLER                      PIC  X(06)    VALUE 'TOTALS'.04120000
042600     05  FILLER                      PIC  X(06)    VALUE SPACES.  04130000
042700     05  FILLER                      PIC  X(11)    VALUE          04140000
042800                                          'CORRECTIONS'.          04150000
042900     05  FILLER                      PIC  X(09)    VALUE SPACES.  04160000
043000     05  FILLER                      PIC  X(05)    VALUE 'FROM '. 04170000
043100     05  FILLER                      PIC  X(03)    VALUE 'POS'.   04180000
043200     05  FILLER                      PIC  X(09)    VALUE SPACES.  04190000
043300     05  FILLER                      PIC  X(11)    VALUE          04200000
043400                                          'SETTLEMENT '.          04210000
043500     05  FILLER                      PIC  X(04)    VALUE 'FILE'.  04220000
043600     05  FILLER                      PIC  X(39)    VALUE SPACES.  04230000
043700                                                                  04240000
043800 01  H6-HEADING-LINE-6.                                           04250000
043900     05  FILLER                      PIC  X(73)    VALUE SPACES.  04260000
044000     05  FILLER                      PIC  X(28)    VALUE ALL '_'. 04270000
044100     05  FILLER                      PIC  X(31)    VALUE SPACE.   04280000
044200                                                                  04290000
COBTRL 01  T1-TRAILER-NOTE-LINE-1.                                      04291048
COBTRL     05  FILLER                      PIC  X(47)    VALUE          04292048
COBTRL        'COBRAND VISA, KOHLS CHARGE, KOHLS PAYMENTS AND '.        04293048
COBTRL     05  FILLER                      PIC  X(54)    VALUE          04294048
COBTRL        'COBRAND VISA PAYMNT ARE ADJUSTED FOR COBRAND TRAILING '. 04295048
COBTRL     05  FILLER                      PIC  X(31)    VALUE          04296048
COBTRL        'TRANSACTIONS '.                                          04297048
COBTRL                                                                  04298048
COBTRL 01  T2-TRAILER-NOTE-LINE-2.                                      04299048
COBTRL     05  FILLER                      PIC X(40)       VALUE        04299148
COBTRL        'UNDER THE UNAUDITED REGISTER TOTALS.'.                   04299248
COBTRL     05  FILLER                      PIC X(11)       VALUE        04299348
COBTRL        '     TTN = '.                                            04299448
COBTRL     05  T2-DISPLAY-TTN              PIC ZZZ,ZZZ.99- VALUE ZERO.  04299548
COBTRL     05  FILLER                      PIC X(11)       VALUE        04299648
COBTRL        '     TTP = '.                                            04299748
COBTRL     05  T2-DISPLAY-TTP              PIC ZZZ,ZZZ.99- VALUE ZERO.  04299848
COBTRL     05  FILLER                      PIC X(48)       VALUE SPACE. 04299948
COBTRL                                                                  04300048
044300******************************************************************04301000
044400*  DETAIL LINE PRINTED FIRST ON THE CORPORATE SETTLEMENTS REPORT. 04310000
044500******************************************************************04320000
044600 01  D1-DETAIL-LINE-1.                                            04330000
044700     05  D1-SYSTEM-TYPE              PIC  X(9)     VALUE SPACES.  04340000
044800     05  FILLER                      PIC  X(07)    VALUE          04350000
044900                                          'SYSTEMS'.              04360000
045000     05  FILLER                      PIC  X(116)   VALUE SPACES.  04370000
045100                                                                  04380000
045200 01  D2-DETAIL-LINE-2.                                            04390000
P8612      05  D2-STTL-TYPE                PIC  X(19)    VALUE SPACE.   04400000
P8612      05  FILLER                      PIC  X(03)    VALUE SPACE.   04410000
045500     05  D2-UNAUD-REG-TOTALS         PIC  ZZ,ZZZ,ZZZ.99-          04420000
045600                                          VALUE ZERO.             04430000
045700     05  FILLER                      PIC  X(03)    VALUE SPACE.   04440000
045800     05  D2-AUD-SALES-CORR           PIC  ZZ,ZZZ,ZZZ.99-          04450000
045900                                          VALUE ZERO.             04460000
046000     05  FILLER                      PIC  X(03)    VALUE SPACE.   04470000
046100     05  D2-PRO-STTL-FROM-POS        PIC  ZZ,ZZZ,ZZZ.99-          04480000
046200                                          VALUE ZERO.             04490000
046300     05  FILLER                      PIC  X(03)    VALUE SPACE.   04500000
046400     05  D2-STTL-JOB                 PIC  X(10)    VALUE SPACE.   04510000
046500     05  FILLER                      PIC  X(03)    VALUE SPACE.   04520000
046600     05  FILLER                      PIC  X(15)    VALUE ALL '_'. 04530000
046700     05  FILLER                      PIC  X(01)    VALUE SPACE.   04540000
046800                                                                  04550000
046900 01  D3-DETAIL-LINE-3.                                            04560000
047000     05  FILLER                      PIC  X(132)   VALUE SPACES.  04570000
047100******************************************************************04580000
047200*  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            04590000
047300******************************************************************04600000
047400     COPY DPWS004.                                                04610000
047500                                                                  04620000
047600******************************************************************04630000
047700*  DB2 COMMUNICATION AREA.                                        04640000
047800******************************************************************04650000
047900     EXEC SQL                                                     04660000
048000          INCLUDE SQLCA                                           04670000
048100     END-EXEC.                                                    04680000
048200                                                                  04690000
048300******************************************************************04700000
048400*  DB2 TABLE DB2PDBA.EPT_DR_CRD_TNDR CREDIT CARD TENDER TABLE     04710000
048500******************************************************************04720000
048600     EXEC SQL                                                     04730000
048700          INCLUDE EPT00002                                        04740000
048800     END-EXEC.                                                    04750000
048900                                                                  04760000
049000******************************************************************04770000
049100* CARD TABLE                                                      04780000
049200******************************************************************04790000
049300     EXEC SQL                                                     04800000
049400          INCLUDE TEPCRD                                          04810000
049500     END-EXEC.                                                    04820000
049600                                                                  04830000
049700******************************************************************04840000
049800*    DB2 AREA FOR XST_LOC - STORE LOCATION TABLE                  04850000
049900******************************************************************04860000
050000     EXEC SQL                                                     04870000
050100          INCLUDE XST00001                                        04880000
050200     END-EXEC.                                                    04890000
050300                                                                  04900000
051100******************************************************************04980000
051200*  DB2 TABLE DB2PDBA.TSASUM - SUMMARY TOTALS TABLE                04990000
051300******************************************************************05000000
051400     EXEC SQL                                                     05010000
051500          INCLUDE TSASUM                                          05020000
051600     END-EXEC.                                                    05030000
051700                                                                  05040000
051800******************************************************************05050000
051900*  DB2 TABLE DB2PDBA.TEPPART - COSA-PARTITIONING TABLE            05060000
052000******************************************************************05070000
052100     EXEC SQL                                                     05080000
052200          INCLUDE TEPPART                                         05090000
052300     END-EXEC.                                                    05100000
052400                                                                  05110000
052500******************************************************************05120000
052600*  DB2 TABLE DB2PDBA.TEPDKEY - COSA-PROCESSING DAY KEY TABLE      05130000
052700******************************************************************05140000
052800     EXEC SQL                                                     05150000
052900          INCLUDE TEPDKEY                                         05160000
053000     END-EXEC.                                                    05170000
053100                                                                  05180000
053200******************************************************************05190000
053300*  DB2 TABLE DB2PDBA.TEPTRN - COSA-TRANSACTION TABLE              05200000
053400******************************************************************05210000
053500     EXEC SQL                                                     05220000
053600          INCLUDE TEPTRN                                          05230000
053700     END-EXEC.                                                    05240000
053800                                                                  05250000
053900******************************************************************05260000
054000*  DB2 TABLE DB2PDBA.TEPTND - COSA-TENDER TABLE                   05270000
054100******************************************************************05280000
054200     EXEC SQL                                                     05290000
054300          INCLUDE TEPTND                                          05300000
054400     END-EXEC.                                                    05310000
054500                                                                  05320000
054600******************************************************************05330000
054700*  DB2 TABLE DB2PDBA.TEPITM - COSA-ITEM TABLE                     05340000
054800******************************************************************05350000
054900     EXEC SQL                                                     05360000
055000          INCLUDE TEPITM                                          05370000
055100     END-EXEC.                                                    05380000
055200                                                                  05390000
COBRND******************************************************************05391017
COBRND*  DB2 TABLE DB2PDBA.TEPPAY - PAYMENT TABLE                       05391117
COBRND******************************************************************05391217
COBRND     EXEC SQL                                                     05392017
COBRND          INCLUDE TEPPAY                                          05393017
COBRND     END-EXEC.                                                    05394017
COBRND                                                                  05395017
055300******************************************************************05400000
055400*  DB2 TABLE DB2PDBA.TEPVDA - COSA-VOIDED TRANSACTIONS            05410000
055500******************************************************************05420000
055600     EXEC SQL                                                     05430000
055700          INCLUDE TEPVDA                                          05440000
055800     END-EXEC.                                                    05450000
055900                                                                  05460000
056000******************************************************************05470000
056100*    STORE CURSOR - FOR STORE TABLE                               05480000
056200*    READ ALL STORES WITH A CAPABILITY LEVEL > 6                  05490000
056300******************************************************************05500000
056400     EXEC SQL                                                     05510000
056500         DECLARE STORE-CSR CURSOR FOR                             05520000
056600             SELECT  LOC.LOC_NBR                                  05530000
056700                    ,LOC.LOC_NM                                   05540000
056800                                                                  05550000
056900               FROM  XST_LOC      LOC                             05560000
057100                                                                  05580000
257408              WHERE  LOC.LOC_TYP_CDE  = 'DS'                      05610000
057400                AND  LOC.OPN_DTE     <= :PV-POS-CCYY-MM-DD        05611000
057500                AND  LOC.CLO_DTE     >= :PV-POS-CCYY-MM-DD        05620000
057600                                                                  05630000
057700             ORDER BY LOC.LOC_NBR                                 05640000
057800             WITH UR                                              05650000
057900     END-EXEC.                                                    05660000
058000                                                                  05670000
058100******************************************************************05680000
058200*  CORPORATE SUMMARY CURSOR (FOR REGISTER TOTALS)                 05690000
058300******************************************************************05700000
058400     EXEC SQL                                                     05710000
058500       DECLARE SUMMARY-CURSOR CURSOR FOR                          05720000
058600            SELECT  PARTN_NBR                                     05730000
058700                   ,STR_NBR                                       05740000
058800                   ,RGST_ID                                       05750000
058900                   ,SUM_CTG_CDE                                   05760000
059000                   ,CTG_AMT                                       05770000
059100            FROM  TSASUM                                          05780000
059200            WHERE   PARTN_NBR      = :EPPART-PARTN-NBR            05790000
059300              AND   STR_NBR        = :SASUM-STR-NBR               05800000
COBTRL              AND ((SUM_TYP_CDE    = 'D'                          05810048
059500              AND   SUM_CTG_CDE IN ('BCS', 'BCR', 'AXS', 'AXR',   05820000
059600                                    'NCS', 'NCR', 'KCS', 'KCR',   05830000
059700                                    'KCP', 'GDS', 'GDT', 'KMI',   05840000
059800                                    'KMT', 'SAL', 'TAX', 'GTS',   05850000
N2I201                                    'RET', 'DBS', 'DBR', 'TPC',   05860000
SEPH04                                    'ATX',                        05870014
PAYVEN                                    'PPS', 'PPR', 'VMS', 'VMR',   05880036
COBRND                                    'SGS', 'SGT', 'CVN', 'CVP')   05880136
SEPH02*                                   'SCS', 'SCR','SGS', 'SGT')    05881001
COBTRL                AND RGST_ID       <> 0)                           05890048
COBTRL              OR   (SUM_TYP_CDE   IN ('D','S')                    05891048
COBTRL                AND SUM_CTG_CDE IN ('TTP', 'TTN')                 05892048
COBTRL                AND RGST_ID        = 0))                          05893048
060100              WITH UR                                             05900000
060200     END-EXEC.                                                    05910000
060300                                                                  05920000
063100******************************************************************06210000
063200*  SETTLEMENT CURSOR (FOR SALES CORRECTIONS)                      06220000
063300******************************************************************06230000
063400     EXEC SQL                                                     06240000
063500       DECLARE SETTLEMENT-CURSOR CURSOR FOR                       06250000
063600            SELECT  B.PARTN_NBR                                   06260000
063700                   ,A.STR_NBR                                     06270000
063800                   ,A.RGST_ID                                     06280000
063900                   ,A.TRN_NBR                                     06290000
064000                   ,A.STRT_TM                                     06300000
064100                   ,A.SLS_CORR_SEQ_NBR                            06310000
064200                   ,B.TRN_TYP_CDE                                 06320000
064300                   ,B.TRN_TOT_AMT                                 06330000
064400                   ,B.SLS_TX_AMT                                  06340000
064500            FROM  TEPDKEY A                                       06350000
064600                 ,TEPTRN B                                        06360000
064700                 ,TEPPART C                                       06370000
064800            WHERE   A.PRCG_DTE         = :EPDKEY-PRCG-DTE         06380000
064900              AND   A.SLS_DTE          = C.SLS_DTE                06390000
065000              AND   B.PARTN_NBR        = C.PARTN_NBR              06400000
065100              AND   A.STR_NBR          = :EPDKEY-STR-NBR          06410000
065200              AND   A.STR_NBR          = B.STR_NBR                06420000
065300              AND   A.RGST_ID          = B.RGST_ID                06430000
065400              AND   A.TRN_NBR          = B.TRN_NBR                06440000
065500              AND   A.STRT_TM          = B.STRT_TM                06450000
065600              AND   A.SLS_CORR_SEQ_NBR = B.SLS_CORR_SEQ_NBR       06460000
065700              AND   A.SLS_CORR_SEQ_NBR <> 0                       06470000
065800              AND   VOID_ABRT_CDE     = 'N'                       06480000
065900              AND   TRN_STAT_CDE IN ('V', 'R', 'Z', 'L')          06490000
066000              AND   TRN_TYP_CDE                                   06500000
066100              IN ('01', '02', '11', '12', '22', '23', '24', '30') 06510000
066200              WITH UR                                             06520000
066300     END-EXEC.                                                    06530000
066400                                                                  06540000
066500******************************************************************06550000
066600*  TENDER CURSOR (FOR SALES CORRECTIONS)                          06560000
066700******************************************************************06570000
066800     EXEC SQL                                                     06580000
066900       DECLARE TENDER-CURSOR CURSOR FOR                           06590000
067000            SELECT  TNDR_AMT                                      06600000
067100                   ,TNDR_TYP_CDE                                  06610000
067200                   ,TNDR_ID_LEN_NBR                               06620000
067300                   ,TNDR_SEQ_NBR                                  06630000
SEPH02                   ,TNDR_ID_SRC_CDE                               06631001
067400            FROM  TEPTND                                          06640000
067500            WHERE   PARTN_NBR        = :EPTRN-PARTN-NBR           06650000
067600              AND   STR_NBR          = :EPDKEY-STR-NBR            06660000
067700              AND   RGST_ID          = :EPDKEY-RGST-ID            06670000
067800              AND   TRN_NBR          = :EPDKEY-TRN-NBR            06680000
067900              AND   STRT_TM          = :EPDKEY-STRT-TM            06690000
068000              AND   SLS_CORR_SEQ_NBR = :EPDKEY-SLS-CORR-SEQ-NBR   06700000
068100              AND   TNDR_VOID_IND = 'N'                           06710000
068200              WITH UR                                             06720000
068300     END-EXEC.                                                    06730000
068400                                                                  06740000
068500******************************************************************06750000
068600*  ITEM CURSOR (CURSOR TO SELECT ITEM ROWS FOR DETERMINING        06760000
068700*  GIFT CARD PURCHASES                                            06770000
068800******************************************************************06780000
068900     EXEC SQL                                                     06790000
069000       DECLARE ITEM-CURSOR CURSOR FOR                             06800000
069100          SELECT DEPT_NBR                                         06810000
069200               , CUST_CHRGD_AMT                                   06820000
069300          FROM  TEPITM                                            06830000
069400          WHERE PARTN_NBR        = :EPTRN-PARTN-NBR               06840000
069500            AND STR_NBR          = :EPDKEY-STR-NBR                06850000
069600            AND RGST_ID          = :EPDKEY-RGST-ID                06860000
069700            AND TRN_NBR          = :EPDKEY-TRN-NBR                06870000
069800            AND STRT_TM          = :EPDKEY-STRT-TM                06880000
069900            AND SLS_CORR_SEQ_NBR = :EPDKEY-SLS-CORR-SEQ-NBR       06890000
N2I201            AND (DEPT_NBR        = '833' OR                       06900000
N2I201                 DEPT_NBR        = '834' OR                       06910000
070200                 DEPT_NBR        = '981' OR                       06920000
SEPH02                 DEPT_NBR        = '712' OR                       06940001
070300                 DEPT_NBR        = '983')                         06950000
070400              WITH UR                                             06960000
070500     END-EXEC.                                                    06970000
070600                                                                  06980000
070700******************************************************************06990000
070800*  LATE CURSOR (CURSOR TO SELECT VOID LATE TRANSACTIONS)          07000000
070900******************************************************************07010000
071000     EXEC SQL                                                     07020000
071100       DECLARE LATE-CURSOR CURSOR FOR                             07030000
071200          SELECT D.PARTN_NBR                                      07040000
071300                ,D.STR_NBR                                        07050000
071400                ,D.RGST_ID                                        07060000
071500                ,D.TRN_NBR                                        07070000
071600                ,D.STRT_TM                                        07080000
071700                ,D.SLS_CORR_SEQ_NBR                               07090000
SEPHOR                ,E.TNDR_SEQ_NBR                                   07091000
SEPHOR                ,E.TNDR_AMT                                       07092000
071900                ,E.TNDR_TYP_CDE                                   07110000
072000                ,E.TNDR_ID_LEN_NBR                                07120000
SEPH02                ,E.TNDR_ID_SRC_CDE                                07121001
072100                                                                  07130000
072200          FROM TEPDKEY A                                          07140000
072300              ,TEPPART B                                          07150000
072400              ,TEPVDA  C                                          07160000
072500              ,TEPTRN  D                                          07170000
072600              ,TEPTND  E                                          07180000
072700                                                                  07190000
072800          WHERE A.PRCG_DTE = :EPDKEY-PRCG-DTE                     07200000
072900            AND A.SLS_DTE   = B.SLS_DTE                           07210000
073000            AND B.PARTN_NBR = C.PARTN_NBR                         07220000
073100                                                                  07230000
073200            AND A.STR_NBR = :EPDKEY-STR-NBR                       07240000
073300            AND A.STR_NBR = C.STR_NBR                             07250000
073400            AND A.RGST_ID = C.RGST_ID                             07260000
073500            AND A.TRN_NBR = C.TRN_NBR                             07270000
SEPHOR            AND A.STRT_TM = C.STRT_TM                             07280000
073700            AND A.SLS_CORR_SEQ_NBR = C.SLS_CORR_SEQ_NBR           07290000
073800                                                                  07300000
073900            AND C.PARTN_NBR    = D.PARTN_NBR                      07310000
074000            AND C.STR_NBR      = D.STR_NBR                        07320000
074100            AND C.RGST_ID      = D.RGST_ID                        07330000
074200            AND C.VOID_TRN_NBR = D.TRN_NBR                        07340000
074300                                                                  07350000
074400            AND C.PARTN_NBR    = E.PARTN_NBR                      07360000
074500            AND C.STR_NBR      = E.STR_NBR                        07370000
074600            AND C.RGST_ID      = E.RGST_ID                        07380000
074700            AND C.VOID_TRN_NBR = E.TRN_NBR                        07390000
SEPHOR            AND C.STRT_TM      = E.STRT_TM                        07395000
074800                                                                  07400000
074900            AND D.TRN_STAT_CDE = 'Z'                              07410000
075000                                                                  07420000
075100            AND E.TNDR_VOID_IND = 'N'                             07430000
075200                                                                  07440000
075300        WITH UR                                                   07450000
075400     END-EXEC.                                                    07460000
075500                                                                  07470000
075600                                                                  07480000
075700***************************************************************** 07490000
075800* PROCEDURE DIVISION.                                           * 07500000
075900***************************************************************** 07510000
076000 PROCEDURE DIVISION.                                              07520000
076100                                                                  07530000
076200******************************************************************07540000
076300* 0000-MAINLINE-PARAGRAPH                                         07550000
076400*      PRODUCE CORPORATE SETTLEMENTS REPORT                       07560000
076500******************************************************************07570000
076600 0000-MAINLINE-PARAGRAPH.                                         07580000
076700                                                                  07590000
076800     PERFORM 1000-INITIALIZE-PROGRAM.                             07600000
076900                                                                  07610000
077000     PERFORM 2700-OPEN-STORE-CURSOR.                              07620000
077100                                                                  07630000
077200     PERFORM 2000-PROCESS                                         07640000
077300       UNTIL PS-END-OF-STORES.                                    07650000
077400                                                                  07660000
077500     MOVE 0                      TO AR048-SA-STR-NBR.             07670000
077600     MOVE 'KCN'                  TO AR048-SA-TRN-CTG-CDE.         07680000
077700     MOVE PV-KCN-TOTAL                                            07690000
077800                                 TO AR048-SA-STTLMNT-AMT.         07700000
077900     PERFORM 8300-WRITE-FILE-LINE.                                07710000
078000                                                                  07720000
078100     MOVE 'KCP'                  TO AR048-SA-TRN-CTG-CDE.         07730000
078200     MOVE PV-KCP-TOTAL                                            07740000
078300                                 TO AR048-SA-STTLMNT-AMT.         07750000
078400     PERFORM 8300-WRITE-FILE-LINE.                                07760000
078500                                                                  07770000
078600     PERFORM 2720-CLOSE-STORE-CURSOR.                             07780000
078700                                                                  07790000
078800     CLOSE SETTLEMENT-REPORT-FILE                                 07800000
078900           SETTLEMENT-FILE.                                       07810000
079000                                                                  07820000
079100     DISPLAY '                                          '         07830048
079200     DISPLAY '******************************************'         07840048
079300     DISPLAY '*************** SAKRP027 *****************'         07850048
079400     DISPLAY '******************************************'         07860048
079500     MOVE PV-SUM-CURSOR-CNT      TO PV-EDIT-MASK                  07870000
079600     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'          07880000
079700     DISPLAY 'SUMMARY ROWS FETCHED...........'                    07890000
079800         PV-EDIT-MASK                                             07900000
079900                                                                  07910000
080500     MOVE PV-STTL-CURSOR-CNT     TO PV-EDIT-MASK                  07970000
080600     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'          07980000
080700     DISPLAY 'SETTLEMENT ROWS FETCHED........'                    07990000
080800         PV-EDIT-MASK                                             08000000
080900                                                                  08010000
081000     MOVE PV-LATE-CURSOR-CNT     TO PV-EDIT-MASK                  08020000
081100     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'          08030000
081200     DISPLAY 'LATE VOID ROWS FETCHED.........'                    08040000
081300         PV-EDIT-MASK                                             08050000
081400                                                                  08060000
COBTRL     MOVE PV-TTN-TOTAL           TO PV-EDIT-MASK-TT               08060148
COBTRL     INSPECT PV-EDIT-MASK-TT REPLACING LEADING SPACE BY '.'       08060248
COBTRL     DISPLAY 'TTN TOTAL DOLLARS..............'                    08060348
COBTRL         PV-EDIT-MASK-TT                                          08060448
COBTRL                                                                  08060548
COBTRL     MOVE PV-TTP-TOTAL           TO PV-EDIT-MASK-TT               08060648
COBTRL     INSPECT PV-EDIT-MASK-TT REPLACING LEADING SPACE BY '.'       08060748
COBTRL     DISPLAY 'TTP TOTAL DOLLARS..............'                    08060848
COBTRL         PV-EDIT-MASK-TT                                          08060948
COBTRL                                                                  08061048
081400                                                                  08063048
081500     DISPLAY '******************************************'         08070048
081600     DISPLAY '******************************************'         08080048
081700     DISPLAY '******************************************'         08090048
081800                                                                  08100000
081900     STOP RUN.                                                    08110000
082000                                                                  08120000
082100                                                                  08130000
082200******************************************************************08140000
082300* 1000-INITIALIZE-PROGRAM                                         08150000
082400*     OPEN FILES, PROCESS CONTROL CARD, FORMAT REPORT HEADINGS,   08160000
082500*     SELECT PARTN-NBR FROM TEPPART (REQUIRED FOR                 08170000
082600*     SETTLEMENT-CURSOR), OPEN SETTLEMENT-CURSOR,                 08180000
082700*     ATTEMPT FIRST FETCH OF CURSOR.                              08190000
082800******************************************************************08200000
082900                                                                  08210000
083000 1000-INITIALIZE-PROGRAM.                                         08220000
083100                                                                  08230000
083200     INITIALIZE PV-SUM-CURSOR-CNT                                 08240000
083400                PV-STTL-CURSOR-CNT                                08260000
083500                PV-LATE-CURSOR-CNT.                               08270000
083600                                                                  08280000
083700     OPEN INPUT  POS-DATE-CARD-FILE                               08290000
083800          OUTPUT SETTLEMENT-REPORT-FILE                           08300000
083900                 SETTLEMENT-FILE.                                 08310000
084000                                                                  08320000
084100     PERFORM 1100-PROCESS-CONTROL-CARD.                           08330000
084200                                                                  08340000
084300     PERFORM 1200-FORMAT-HEADINGS.                                08350000
084400                                                                  08360000
084500     PERFORM 1300-INITIALIZE-TOTALS                               08370000
084600         VARYING PV-STTL-SUB FROM 1 BY 1                          08380000
PAYVEN             UNTIL PV-STTL-SUB GREATER THAN 18.                   08390036
084800                                                                  08400000
084900     PERFORM 1400-GET-DB2-PARTITION-NBR.                          08410000
085000                                                                  08420000
085100******************************************************************08430000
085200* 1100-PROCESS-CONTROL-CARD                                       08440000
085300*     READ CONTROL CARD TO GET POS DATE IN MMDDYY FORMAT.  CALL   08450000
085400*     DATE ROUTINE TO CONVERT DATE TO A CCYY-MM-DD PROCESS DATE.  08460000
085500******************************************************************08470000
085600                                                                  08480000
085700 1100-PROCESS-CONTROL-CARD.                                       08490000
085800                                                                  08500000
085900     PERFORM 1110-READ-POS-DATE-CARD-FILE.                        08510000
086000     CLOSE POS-DATE-CARD-FILE.                                    08520000
086100     IF PS-END-OF-CARD-FILE                                       08530000
086200         MOVE '1100-PROCESS-CONTROL-CARD'  TO PV-PARAGRAPH-NAME   08540000
086300         MOVE 'NO CONTROL CARD TO PROCESS' TO PV-OPERATION-MSG-1  08550000
086400         SET AC-CONTROL-CARD-ERROR TO TRUE                        08560000
086500         PERFORM 9999-ABEND                                       08570000
086600     END-IF.                                                      08580000
086700     DISPLAY PC-CURRENT-PROGRAM-NAME                              08590000
086800             ' - CONTROL CARD = (' CC-CONTROL-CARD-DISPLAY  ')'.  08600000
086900     PERFORM 1115-CONVERT-INPUT-DATE.                             08610000
087000                                                                  08620000
087100******************************************************************08630000
087200* 1110-READ-POS-DATE-CARD-FILE                                    08640000
087300*     READ DATE CONTROL CARD.                                     08650000
087400******************************************************************08660000
087500 1110-READ-POS-DATE-CARD-FILE.                                    08670000
087600     READ POS-DATE-CARD-FILE INTO CC-CONTROL-CARD                 08680000
087700        AT END                                                    08690000
087800           SET PS-END-OF-CARD-FILE TO TRUE.                       08700000
087900                                                                  08710000
088000******************************************************************08720000
088100* 1115-CONVERT-INPUT-DATE                                         08730000
088200*     CALL KOHLS CALENDAR ROUTINE:                                08740000
088300*         PASS: CONTROL CARD POS DATE (MMDDYY FORMAT).            08750000
088400*       RETURN: ACTUAL CALENDAR DB2 ISO DATE (CCYY-MM-DD FORMAT). 08760000
088500******************************************************************08770000
088600                                                                  08780000
088700 1115-CONVERT-INPUT-DATE.                                         08790000
088800                                                                  08800000
088900     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              08810000
089000                                                                  08820000
089100     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   08830000
089200     SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   08840000
089300     SET  DPG52-LK-DTE-GREG            TO TRUE.                   08850000
089400     MOVE CC-POS-DATE-MMDDYY           TO DPG52-LK-DATE-INPUT.    08860000
089500     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    08870000
089600                                             DPG54 DPG55 DPG56.   08880000
089700     EVALUATE TRUE                                                08890000
089800         WHEN DPG54-SEVERE-ERROR                                  08900000
089900         WHEN DPG54-DATE-INVALID                                  08910000
090000             MOVE '1115-CONVERT-INPUT-DATE'                       08920000
090100                                           TO PV-PARAGRAPH-NAME   08930000
090200             MOVE 'ERROR CONVERTING INPUT CARD DATE'              08940000
090300                                           TO PV-OPERATION-MSG-1  08950000
090400             SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                08960000
090500             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  08970000
090600             PERFORM 9999-ABEND                                   08980000
090700     END-EVALUATE.                                                08990000
090800                                                                  09000000
090900     MOVE DPG55-DB2-ISO-DATE-FMT       TO PV-POS-CCYY-MM-DD       09010000
091000                                          EPDKEY-PRCG-DTE.        09020000
091100                                                                  09030000
091200******************************************************************09040000
091300* 1200-FORMAT-HEADINGS                                            09050000
091400*     GET CURRENT DATE AND TIME FROM SYSTEM.                      09060000
091500*     FORMAT REPORT FIELDS IN THE TOP PAGE HEADING LINE.          09070000
091600*     FORMAT HEADING LINE 2 WITH CONVERTED POS DATE.              09080000
091700******************************************************************09090000
091800 1200-FORMAT-HEADINGS.                                            09100000
091900                                                                  09110000
092000     MOVE FUNCTION CURRENT-DATE (1:8) TO PV-CURR-DATE-CCYYMMDD.   09120000
092100     ACCEPT PV-CURR-TIME FROM TIME.                               09130000
092200                                                                  09140000
092300     MOVE PV-CURR-DATE-MM             TO DP132-RUN-MONTH.         09150000
092400     MOVE PV-CURR-DATE-DD             TO DP132-RUN-DAY.           09160000
092500     MOVE PV-CURR-DATE-CCYY           TO DP132-RUN-YEAR.          09170000
092600                                                                  09180000
092700     MOVE PV-CURR-TIME-HH             TO DP132-RUN-HOUR.          09190000
092800     MOVE PV-CURR-TIME-MM             TO DP132-RUN-MINUTE.        09200000
092900     MOVE PC-CURRENT-PROGRAM-NAME     TO DP132-PROGRAM-NAME.      09210000
093000     MOVE PC-REPORT-NBR-1             TO DP132-REPORT-NUMBER.     09220000
093100                                                                  09230000
093200     MOVE PV-POS-CCYY                 TO H2-CCYY.                 09240000
093300     MOVE PV-POS-MM                   TO H2-MM.                   09250000
093400     MOVE PV-POS-DD                   TO H2-DD.                   09260000
093500                                                                  09270000
093600******************************************************************09280000
093700* 1300-INITIALIZE-TOTALS                                          09290000
093800*     MOVE ZERO TO THE DOLLAR TOTALS                              09300000
093900*                                                                 09310000
094000******************************************************************09320000
094100 1300-INITIALIZE-TOTALS.                                          09330000
094200                                                                  09340000
094300     MOVE ZERO                   TO PV-STTL-UNAUD-REG-TOT         09350000
094400                                         (PV-STTL-SUB)            09360000
094500     MOVE ZERO                   TO PV-STTL-AUD-SALES-CORR        09370000
094600                                         (PV-STTL-SUB)            09380000
094700     MOVE ZERO                   TO PV-PRO-STTL-FROM-POS          09390000
094800                                         (PV-STTL-SUB).           09400000
094900                                                                  09410000
095000******************************************************************09420000
095100* 1400-GET-DB2-PARTITION-NBR                                      09430000
095200*     GET TODAY'S PARTITION NUMBER                                09440000
095300*                                                                 09450000
095400******************************************************************09460000
095500 1400-GET-DB2-PARTITION-NBR.                                      09470000
095600                                                                  09480000
095700     EXEC SQL                                                     09490000
095800         SELECT PARTN_NBR                                         09500000
095900           INTO :EPPART-PARTN-NBR                                 09510000
096000           FROM TEPPART                                           09520000
096100          WHERE SLS_DTE = :PV-POS-CCYY-MM-DD                      09530000
096200            AND DB_STRUC_CDE = 'O'                                09540000
TPCDSC            AND STR_GP_CDE   = 'A'                                09550000
096300                WITH UR                                           09560000
096400     END-EXEC.                                                    09570000
096500                                                                  09580000
096600     EVALUATE TRUE                                                09590000
096700         WHEN SQLCODE EQUAL ZERO                                  09600000
096800             CONTINUE                                             09610000
096900         WHEN SQLWARN0 NOT EQUAL SPACE                            09620000
097000         WHEN SQLCODE NOT EQUAL ZERO                              09630000
097100             MOVE '1400-GET-DB2-PARTITION-NBR'                    09640000
097200                                 TO PV-PARAGRAPH-NAME             09650000
097300             MOVE 'ERROR ON SELECT FROM TEPPART'                  09660000
097400                                 TO PV-DB2-OPERATION              09670000
097500             PERFORM 9100-SQL-ABEND                               09680000
097600     END-EVALUATE.                                                09690000
097700                                                                  09700000
097800******************************************************************09710000
097900* 2000-PROCESS                                                    09720000
098000*                                                                 09730000
098100******************************************************************09740000
098200 2000-PROCESS.                                                    09750000
098300                                                                  09760000
098400     INITIALIZE PV-SETTLEMENT-TABLE.                              09770000
098500     INITIALIZE PS-END-OF-SUM-CURSOR-SW                           09780000
098700                PS-END-OF-STTL-CURSOR-SW.                         09800000
098800                                                                  09810000
COBTRL     MOVE ZEROES TO PV-TTN-STORE                                  09811048
COBTRL                    PV-TTP-STORE.                                 09812048
098800                                                                  09813048
098900     PERFORM 2710-FETCH-STORE-CURSOR.                             09820000
099000                                                                  09830000
099100******************************************************************09840000
099200* 2100-FETCH-SUMMARY-DATA                                         09850000
099300*     PROCESS CURSOR DATA                                         09860000
099400******************************************************************09870000
099500 2100-FETCH-SUMMARY-DATA.                                         09880000
099600                                                                  09890000
099700     EVALUATE SASUM-SUM-CTG-CDE                                   09900000
099800         WHEN 'BCS'                                               09910000
099900             ADD SASUM-CTG-AMT   TO PV-STTL-UNAUD-REG-TOT (1)     09920000
100000         WHEN 'BCR'                                               09930000
100100             ADD SASUM-CTG-AMT   TO PV-STTL-UNAUD-REG-TOT (1)     09940000
100200         WHEN 'AXS'                                               09950000
100300             ADD SASUM-CTG-AMT   TO PV-STTL-UNAUD-REG-TOT (2)     09960000
100400         WHEN 'AXR'                                               09970000
100500             ADD SASUM-CTG-AMT   TO PV-STTL-UNAUD-REG-TOT (2)     09980000
100600         WHEN 'NCS'                                               09990000
100700             ADD SASUM-CTG-AMT   TO PV-STTL-UNAUD-REG-TOT (3)     10000000
100800         WHEN 'NCR'                                               10010000
100900             ADD SASUM-CTG-AMT   TO PV-STTL-UNAUD-REG-TOT (3)     10020000
101000         WHEN 'DBS'                                               10030000
101100             ADD SASUM-CTG-AMT   TO PV-STTL-UNAUD-REG-TOT (4)     10040000
101200         WHEN 'DBR'                                               10050000
101300             ADD SASUM-CTG-AMT   TO PV-STTL-UNAUD-REG-TOT (4)     10060000
101400         WHEN 'KCS'                                               10070000
PAYVEN             ADD SASUM-CTG-AMT   TO PV-STTL-UNAUD-REG-TOT (9)     10081036
101600         WHEN 'KCR'                                               10090000
PAYVEN             ADD SASUM-CTG-AMT   TO PV-STTL-UNAUD-REG-TOT (9)     10101036
101600         WHEN 'ATX'                                               10110000
PAYVEN          SUBTRACT SASUM-CTG-AMT FROM PV-STTL-UNAUD-REG-TOT (9)   10121036
101800         WHEN 'KCP'                                               10130000
PAYVEN             ADD SASUM-CTG-AMT   TO PV-STTL-UNAUD-REG-TOT (10)    10141036
102000         WHEN 'GDS'                                               10150000
PAYVEN             ADD SASUM-CTG-AMT   TO PV-STTL-UNAUD-REG-TOT (11)    10161036
102200             SUBTRACT SASUM-CTG-AMT                               10170000
PAYVEN                                 FROM PV-STTL-UNAUD-REG-TOT (15)  10181036
102400         WHEN 'GDT'                                               10190000
PAYVEN             ADD SASUM-CTG-AMT   TO PV-STTL-UNAUD-REG-TOT (12)    10201036
102600         WHEN 'KMI'                                               10210000
PAYVEN             ADD SASUM-CTG-AMT   TO PV-STTL-UNAUD-REG-TOT (13)    10221036
102800         WHEN 'KMT'                                               10230000
PAYVEN             ADD SASUM-CTG-AMT   TO PV-STTL-UNAUD-REG-TOT (14)    10241036
103000         WHEN 'SAL'                                               10250000
PAYVEN             ADD SASUM-CTG-AMT   TO PV-STTL-UNAUD-REG-TOT (15)    10261036
103200         WHEN 'TAX'                                               10270000
103300             SUBTRACT SASUM-CTG-AMT                               10280000
PAYVEN                                 FROM PV-STTL-UNAUD-REG-TOT (15)  10291041
103500         WHEN 'GTS'                                               10300000
103600             SUBTRACT SASUM-CTG-AMT                               10310000
PAYVEN                                 FROM PV-STTL-UNAUD-REG-TOT (15)  10321036
103800         WHEN 'RET'                                               10330000
PAYVEN             ADD SASUM-CTG-AMT   TO   PV-STTL-UNAUD-REG-TOT (15)  10341036
N2I201         WHEN 'TPC'                                               10350000
PAYVEN             ADD SASUM-CTG-AMT   TO PV-STTL-UNAUD-REG-TOT (8)     10361036
N2I201             SUBTRACT SASUM-CTG-AMT                               10370000
PAYVEN                                 FROM PV-STTL-UNAUD-REG-TOT (15)  10390036
SEPH02         WHEN 'SGS'                                               10421004
PAYVEN             ADD SASUM-CTG-AMT   TO PV-STTL-UNAUD-REG-TOT (16)    10421236
SEPH04             SUBTRACT SASUM-CTG-AMT                               10422010
PAYVEN                                 FROM PV-STTL-UNAUD-REG-TOT (8)   10422236
SEPH02         WHEN 'SGT'                                               10423004
PAYVEN             ADD SASUM-CTG-AMT   TO PV-STTL-UNAUD-REG-TOT (17)    10424136
SEPH04             SUBTRACT SASUM-CTG-AMT                               10424336
PAYVEN                                 FROM PV-STTL-UNAUD-REG-TOT (12)  10424436
COBRND         WHEN 'CVN'                                               10424636
COBRND             ADD SASUM-CTG-AMT   TO   PV-STTL-UNAUD-REG-TOT (5)   10424836
COBRND*          COBRAND NET NEEDS TO BE SUBTRACTED FROM BCN (BCS & BCR)10424936
COBRND             SUBTRACT SASUM-CTG-AMT                               10425036
COBRND                                 FROM PV-STTL-UNAUD-REG-TOT (1)   10425136
COBRND         WHEN 'CVP'                                               10425236
PAYVEN             ADD SASUM-CTG-AMT   TO   PV-STTL-UNAUD-REG-TOT (18)  10425336
COBRND*          COBRAND PAYMENTS NEEDS TO BE SUBTRACTED FROM KCP       10425536
COBRND             SUBTRACT SASUM-CTG-AMT                               10425636
PAYVEN                                 FROM PV-STTL-UNAUD-REG-TOT (10)  10425736
COBTRL         WHEN 'TTN'                                               10425848
COBTRL*          COBRAND TRAIL TENDER ADD TO CVN AND SUBTRACT FROM KCN  10425948
COBTRL             ADD SASUM-CTG-AMT   TO   PV-STTL-UNAUD-REG-TOT (5)   10426048
COBTRL                                      PV-TTN-STORE                10426148
COBTRL                                      PV-TTN-TOTAL                10426248
COBTRL             SUBTRACT SASUM-CTG-AMT                               10426348
COBTRL                                 FROM PV-STTL-UNAUD-REG-TOT (9)   10426448
COBTRL         WHEN 'TTP'                                               10426548
COBTRL*          COBRAND TRAIL PAYMENT ADD TO CVP AND SUBTRACT FROM KCP 10426648
COBTRL             ADD SASUM-CTG-AMT   TO   PV-STTL-UNAUD-REG-TOT (18)  10426748
COBTRL                                      PV-TTP-STORE                10426848
COBTRL                                      PV-TTP-TOTAL                10426948
COBTRL             SUBTRACT SASUM-CTG-AMT                               10427048
COBTRL                                 FROM PV-STTL-UNAUD-REG-TOT (10)  10427148
PAYVEN         WHEN 'PPS'                                               10427248
PAYVEN             ADD SASUM-CTG-AMT   TO PV-STTL-UNAUD-REG-TOT (6)     10427348
PAYVEN         WHEN 'PPR'                                               10427448
PAYVEN             ADD SASUM-CTG-AMT   TO PV-STTL-UNAUD-REG-TOT (6)     10427548
PAYVEN         WHEN 'VMS'                                               10427648
PAYVEN             ADD SASUM-CTG-AMT   TO PV-STTL-UNAUD-REG-TOT (7)     10427748
PAYVEN         WHEN 'VMR'                                               10427848
PAYVEN             ADD SASUM-CTG-AMT   TO PV-STTL-UNAUD-REG-TOT (7)     10427948
104400     END-EVALUATE.                                                10428048
104500                                                                  10428148
104600     PERFORM 2300-FETCH-SUMMARY-CURSOR.                           10428248
104700                                                                  10428348
104800******************************************************************10429000
104900* 2200-OPEN-SUMMARY-CURSOR.                                       10430000
105000*     OPEN SUMMARY CURSOR                                         10440000
105100******************************************************************10450000
105200 2200-OPEN-SUMMARY-CURSOR.                                        10460000
105300                                                                  10470000
105400     EXEC SQL                                                     10480000
105500          OPEN SUMMARY-CURSOR                                     10490000
105600     END-EXEC.                                                    10500000
105700                                                                  10510000
105800     EVALUATE TRUE                                                10520000
105900         WHEN SQLCODE = ZERO                                      10530000
106000              CONTINUE                                            10540000
106100         WHEN OTHER                                               10550000
106200             MOVE '7000-OPEN-SUMMARY-CURSOR'                      10560000
106300                                            TO PV-PARAGRAPH-NAME  10570000
106400             MOVE 'ERROR ON OPEN OF SUMMARY-CURSOR'               10580000
106500                                            TO PV-DB2-OPERATION   10590000
106600             PERFORM 9100-SQL-ABEND                               10600000
106700     END-EVALUATE.                                                10610000
106800                                                                  10620000
106900******************************************************************10630000
107000* 2300-FETCH-SUMMARY-CURSOR                                       10640000
107100******************************************************************10650000
107200 2300-FETCH-SUMMARY-CURSOR.                                       10660000
107300                                                                  10670000
107400     EXEC SQL                                                     10680000
107500          FETCH SUMMARY-CURSOR                                    10690000
107600           INTO :SASUM-PARTN-NBR                                  10700000
107700               ,:SASUM-STR-NBR                                    10710000
107800               ,:SASUM-RGST-ID                                    10720000
107900               ,:SASUM-SUM-CTG-CDE                                10730000
108000               ,:SASUM-CTG-AMT                                    10740000
108100     END-EXEC.                                                    10750000
108200                                                                  10760000
108300     EVALUATE TRUE                                                10770000
108400         WHEN SQLCODE = ZERO                                      10780000
108500             ADD 1 TO PV-SUM-CURSOR-CNT                           10790000
108700         WHEN SQLCODE = PC-ROW-NOT-FOUND                          10800000
108800             SET PS-END-OF-SUM-CURSOR TO TRUE                     10810000
109000         WHEN OTHER                                               10820000
109100             MOVE '2300-FETCH-SUMMARY-CURSOR'                     10830000
109200                                            TO PV-PARAGRAPH-NAME  10840000
109300             MOVE 'ERROR ON FETCH OF SUMMARY-CURSOR'              10850000
109400                                            TO PV-DB2-OPERATION   10860000
109500             PERFORM 9100-SQL-ABEND                               10870000
109600     END-EVALUATE.                                                10880000
109700                                                                  10890000
109800******************************************************************10900000
109900* 2400-CLOSE-SUMMARY-CURSOR                                       10910000
110000******************************************************************10920000
110100 2400-CLOSE-SUMMARY-CURSOR.                                       10930000
110200                                                                  10940000
110300     EXEC SQL                                                     10950000
110400          CLOSE SUMMARY-CURSOR                                    10960000
110500     END-EXEC.                                                    10970000
110600                                                                  10980000
110700     EVALUATE TRUE                                                10990000
110800         WHEN SQLCODE = ZERO                                      11000000
110900              CONTINUE                                            11010000
111000         WHEN OTHER                                               11020000
111100             MOVE '2400-CLOSE-SUMMARY-CURSOR'                     11030000
111200                                            TO PV-PARAGRAPH-NAME  11040000
111300             MOVE 'ERROR ON CLOSE OF SUMMARY-CURSOR'              11050000
111400                                            TO PV-DB2-OPERATION   11060000
111500             PERFORM 9100-SQL-ABEND                               11070000
111600     END-EVALUATE.                                                11080000
111700                                                                  11090000
134900*----------------------------------------------------------------*13400000
135000*    OPEN THE STORE CURSOR.                                       13410000
135100*----------------------------------------------------------------*13420000
135200 2700-OPEN-STORE-CURSOR.                                          13430000
135300                                                                  13440000
135400     EXEC SQL                                                     13450000
135500          OPEN STORE-CSR                                          13460000
135600     END-EXEC.                                                    13470000
135700     EVALUATE TRUE                                                13480000
135800         WHEN SQLCODE = ZERO                                      13490000
135900             CONTINUE                                             13500000
136000         WHEN OTHER                                               13510000
136100             MOVE '2700-OPEN-STORE-CURSOR'                        13520000
136200                              TO PV-PARAGRAPH-NAME                13530000
136300             MOVE 'OPEN CURSOR FOR TABLE XST_LOC'                 13540000
136400                              TO PV-DB2-OPERATION                 13550000
136500             PERFORM 9100-SQL-ABEND                               13560000
136600     END-EVALUATE.                                                13570000
136700                                                                  13580000
136800*----------------------------------------------------------------*13590000
136900*   FETCH THE STORE CURSOR.                                       13600000
137000*----------------------------------------------------------------*13610000
137100 2710-FETCH-STORE-CURSOR.                                         13620000
137200                                                                  13630000
137300     EXEC SQL                                                     13640000
137400         FETCH STORE-CSR                                          13650000
137500         INTO  :XST00001-LOC-NBR                                  13660000
137600              ,:XST00001-LOC-NM                                   13670000
137700     END-EXEC.                                                    13680000
137800     EVALUATE TRUE                                                13690000
137900         WHEN SQLCODE = ZERO                                      13700000
138000             PERFORM 2730-PROCESS-INFO                            13710000
138100         WHEN SQLCODE = +100                                      13720000
138200             SET PS-END-OF-STORES TO TRUE                         13730000
138300         WHEN OTHER                                               13740000
138400             MOVE '2710-FETCH-STORE-CURSOR'                       13750000
138500                              TO PV-PARAGRAPH-NAME                13760000
138600             MOVE 'FETCH CURSOR FOR TABLE XST_LOC'                13770000
138700                              TO PV-DB2-OPERATION                 13780000
138800             PERFORM 9100-SQL-ABEND                               13790000
138900     END-EVALUATE.                                                13800000
139000                                                                  13810000
139100*----------------------------------------------------------------*13820000
139200*   CLOSE THE STORE CURSOR.                                       13830000
139300*----------------------------------------------------------------*13840000
139400 2720-CLOSE-STORE-CURSOR.                                         13850000
139500     EXEC SQL                                                     13860000
139600          CLOSE STORE-CSR                                         13870000
139700     END-EXEC.                                                    13880000
139800     EVALUATE TRUE                                                13890000
139900         WHEN SQLCODE = ZERO                                      13900000
140000             CONTINUE                                             13910000
140100         WHEN OTHER                                               13920000
140200             MOVE '2720-CLOSE-STORE-CURSOR'                       13930000
140300                              TO PV-PARAGRAPH-NAME                13940000
140400             MOVE 'CLOSE CURSOR FOR TABLE XST_LOC'                13950000
140500                              TO PV-DB2-OPERATION                 13960000
140600             PERFORM 9100-SQL-ABEND                               13970000
140700     END-EVALUATE.                                                13980000
140800                                                                  13990000
140900******************************************************************14000000
141000 2730-PROCESS-INFO.                                               14010000
141100******************************************************************14020000
141200                                                                  14030000
141300     MOVE XST00001-LOC-NBR   TO HDR3A-STORE-NBR.                  14040000
141400     MOVE XST00001-LOC-NBR   TO AR048-SA-STR-NBR.                 14050000
141500     MOVE XST00001-LOC-NBR   TO SASUM-STR-NBR.                    14060000
141600     MOVE XST00001-LOC-NBR   TO EPDKEY-STR-NBR.                   14070000
141700     MOVE XST00001-LOC-NBR   TO EPTND-STR-NBR.                    14080000
141700                                                                  14090000
141800     MOVE XST00001-LOC-NM    TO HDR3A-STORE-NAME.                 14100000
141900     MOVE PV-POS-CCYY-MM-DD  TO AR048-SA-SELECT-SYSTEM-DTE.       14110000
142000                                                                  14120000
142100     PERFORM 2200-OPEN-SUMMARY-CURSOR.                            14130000
142200     PERFORM 2300-FETCH-SUMMARY-CURSOR.                           14140000
142300     PERFORM 2100-FETCH-SUMMARY-DATA                              14150000
142400       UNTIL PS-END-OF-SUM-CURSOR.                                14160000
142500     PERFORM 2400-CLOSE-SUMMARY-CURSOR.                           14170000
142600                                                                  14180000
143300     PERFORM 3100-OPEN-SETTLEMENT-CURSOR.                         14250000
143400     PERFORM 3200-FETCH-SETTLEMENT-CURSOR.                        14260000
143500     PERFORM 3000-FETCH-SETTLEMENT-DATA                           14270000
143600       UNTIL PS-END-OF-STTL-CURSOR.                               14280000
143700     PERFORM 3300-CLOSE-SETTLEMENT-CURSOR.                        14290000
143800                                                                  14300000
143900     PERFORM 4100-OPEN-LATE-CURSOR.                               14310000
SEPHOR     PERFORM 4200-FETCH-LATE-CURSOR                               14320000
SEPHOR       UNTIL PS-END-OF-LATE-CURSOR.                               14321000
144300     PERFORM 4300-CLOSE-LATE-CURSOR.                              14350000
144400                                                                  14360000
144500     PERFORM 5000-CALCULATE-SETTLEMENT                            14370000
144600         VARYING PV-STTL-SUB FROM 1 BY 1                          14380000
PAYVEN             UNTIL PV-STTL-SUB GREATER THAN 18.                   14390036
144800                                                                  14400000
144900     PERFORM 6000-PRINT-REPORT-TOTALS.                            14410000
145000                                                                  14420000
145100******************************************************************14430000
145200* 3000-FETCH-SETTLEMENT-DATA                                      14440000
145300*     PROCESS CURSOR DATA                                         14450000
145400******************************************************************14460000
145500 3000-FETCH-SETTLEMENT-DATA.                                      14470000
145600                                                                  14480000
145700     IF EPTRN-TRN-TYP-CDE = '30'                                  14490000
COBRND         PERFORM 3005-READ-TEPPAY                                 14500016
COBRND         IF EPPAY-COBRND-IND = 'N'                                14500116
PAYVEN            ADD EPTRN-TRN-TOT-AMT   TO PV-STTL-AUD-SALES-CORR (10)14500238
COBRND         ELSE                                                     14500443
PAYVEN            ADD EPTRN-TRN-TOT-AMT   TO PV-STTL-AUD-SALES-CORR (18)14500638
COBRND         END-IF                                                   14500838
145900     ELSE                                                         14510000
146000         PERFORM 3010-PROCESS-TRANSACTION                         14520000
146100         PERFORM 3020-PROCESS-TENDERS                             14530000
146200     END-IF.                                                      14540000
146300                                                                  14550000
146400     PERFORM 3200-FETCH-SETTLEMENT-CURSOR.                        14560000
COBRND                                                                  14570016
COBRND******************************************************************14570116
COBRND* 3005-READ-TEPPAY.                                               14571016
COBRND******************************************************************14571116
COBRND 3005-READ-TEPPAY.                                                14571216
COBRND                                                                  14571316
COBRND      EXEC SQL                                                    14571416
COBRND          SELECT  COBRND_IND                                      14571516
COBRND            INTO :EPPAY-COBRND-IND                                14571616
COBRND            FROM  TEPPAY                                          14571716
COBRND           WHERE  PARTN_NBR        = :EPTRN-PARTN-NBR             14571833
COBRND            AND   STR_NBR          = :EPDKEY-STR-NBR              14571916
COBRND            AND   RGST_ID          = :EPDKEY-RGST-ID              14572016
COBRND            AND   TRN_NBR          = :EPDKEY-TRN-NBR              14572116
COBRND            AND   STRT_TM          = :EPDKEY-STRT-TM              14573016
COBRND            AND   SLS_CORR_SEQ_NBR = :EPDKEY-SLS-CORR-SEQ-NBR     14574016
COBRND      END-EXEC.                                                   14575016
COBRND                                                                  14575116
COBRND      EVALUATE TRUE                                               14575216
COBRND          WHEN SQLCODE = ZERO                                     14575316
COBRND              CONTINUE                                            14575416
COBRND          WHEN SQLCODE = +100                                     14575532
COBRND              DISPLAY 'NO COBRAND-IND'                            14575632
COBRND              DISPLAY '+100 IN 3005-READ-TEPPAY'                  14575732
COBRND              DISPLAY 'PARTN_NBR ' EPPART-PARTN-NBR               14575832
COBRND              DISPLAY 'STR_NBR '   EPDKEY-STR-NBR                 14575932
COBRND              DISPLAY 'RGST_ID '   EPDKEY-RGST-ID                 14576032
COBRND              DISPLAY 'TRN_NBR '   EPDKEY-TRN-NBR                 14576132
COBRND              DISPLAY 'STRT_TM '   EPDKEY-STRT-TM                 14576232
COBRND              DISPLAY 'SLS_CORR_SEQ_NBR '  EPDKEY-SLS-CORR-SEQ-NBR14576332
COBRND          WHEN OTHER                                              14576432
COBRND              MOVE '3005-READ-TEPPAY'                             14576516
COBRND                                   TO PV-PARAGRAPH-NAME           14576616
COBRND              MOVE 'ERROR ON READ OF TEPPAY'                      14576716
COBRND                                   TO PV-DB2-OPERATION            14576816
COBRND              PERFORM 9100-SQL-ABEND                              14577216
COBRND      END-EVALUATE.                                               14577316
COBRND                                                                  14578016
146600******************************************************************14580000
146700* 3010-PROCESS-TRANSACTION.                                       14590000
146800******************************************************************14600000
146900 3010-PROCESS-TRANSACTION.                                        14610000
147000                                                                  14620000
147100     MOVE ZERO               TO PV-GIFT-CARD.                     14630000
147200     MOVE ZERO               TO PV-GIFT-CERT.                     14640000
147300     MOVE ZERO               TO PV-MDSE-SALE.                     14650000
147300     MOVE ZERO               TO PV-SEPHORA-GC.                    14651006
147400                                                                  14660000
147500     MOVE 'N'                TO PS-END-OF-ITEM-CURSOR-SW.         14670000
147600                                                                  14680000
147700     PERFORM 3070-OPEN-ITEM-CURSOR.                               14690000
147800                                                                  14700000
147900     PERFORM 3080-FETCH-ITEM-CURSOR                               14710000
148000         UNTIL PS-END-OF-ITEM-CURSOR.                             14720000
148100                                                                  14730000
148200     PERFORM 3090-CLOSE-ITEM-CURSOR.                              14740000
148300                                                                  14750000
PAYVEN     ADD PV-GIFT-CARD        TO PV-STTL-AUD-SALES-CORR (11).      14761036
PAYVEN     ADD PV-SEPHORA-GC       TO PV-STTL-AUD-SALES-CORR (16).      14771036
48500                                                                   14780000
148600     COMPUTE PV-MDSE-SALE =    EPTRN-TRN-TOT-AMT                  14790000
148700                             - EPTRN-SLS-TX-AMT                   14800000
148800                             - PV-GIFT-CARD                       14810000
148900                             - PV-GIFT-CERT                       14820000
SEPHOR                             - PV-SEPHORA-GC                      14840006
149000     END-COMPUTE.                                                 14850000
PAYVEN     ADD PV-MDSE-SALE        TO PV-STTL-AUD-SALES-CORR (15).      14861036
149200                                                                  14870000
149300******************************************************************14880000
149400* 3020-PROCESS-TENDERS.                                           14890000
149500*     PROCESS TENDERS FOR A TRANSACTION.  THERE COULD BE MORE     14900000
149600*     THAN ONE TENDER PER TRANSACTION.                            14910000
149700******************************************************************14920000
149800 3020-PROCESS-TENDERS.                                            14930000
149900                                                                  14940000
150000     MOVE 'N' TO PS-END-OF-TENDER-CURSOR-SW.                      14950000
150100     PERFORM 3030-OPEN-TENDER-CURSOR.                             14960000
150200                                                                  14970000
150300     PERFORM 3040-FETCH-TENDER-CURSOR                             14980000
150400         UNTIL PS-END-OF-TENDER-CURSOR.                           14990000
150500                                                                  15000000
150600     PERFORM 3050-CLOSE-TENDER-CURSOR.                            15010000
150700                                                                  15020000
150800                                                                  15030000
150900******************************************************************15040000
151000*     OPEN TENDER CURSOR.                                         15050000
151100******************************************************************15060000
151200 3030-OPEN-TENDER-CURSOR.                                         15070000
151300                                                                  15080000
151400     EXEC SQL                                                     15090000
151500          OPEN TENDER-CURSOR                                      15100000
151600     END-EXEC.                                                    15110000
151700                                                                  15120000
151800     EVALUATE TRUE                                                15130000
151900         WHEN SQLCODE = ZERO                                      15140000
152000              CONTINUE                                            15150000
152100         WHEN OTHER                                               15160000
152200             MOVE '3030-OPEN-TENDER-CURSOR' TO PV-PARAGRAPH-NAME  15170000
152300             MOVE 'ERROR ON OPEN OF TENDER-CURSOR'                15180000
152400                                            TO PV-DB2-OPERATION   15190000
152500             PERFORM 9100-SQL-ABEND                               15200000
152600     END-EVALUATE.                                                15210000
152700                                                                  15220000
152800******************************************************************15230000
152900* 3040-FETCH-TENDER-CURSOR.                                       15240000
153000******************************************************************15250000
153100 3040-FETCH-TENDER-CURSOR.                                        15260000
153200                                                                  15270000
153300     EXEC SQL                                                     15290000
153400          FETCH TENDER-CURSOR                                     15300000
153500          INTO  :EPTND-TNDR-AMT                                   15310000
153600               ,:EPTND-TNDR-TYP-CDE                               15320000
153700               ,:EPTND-TNDR-ID-LEN-NBR                            15330000
153800               ,:EPTND-TNDR-SEQ-NBR                               15340000
SEPH02               ,:EPTND-TNDR-ID-SRC-CDE                            15341006
153900     END-EXEC.                                                    15350000
154000                                                                  15360000
154100     EVALUATE TRUE                                                15370000
154200         WHEN SQLCODE = ZERO                                      15380000
154300             PERFORM 3045-PROCESS-TENDER                          15390000
154400         WHEN SQLCODE = +100                                      15410000
154500             MOVE 'Y'        TO PS-END-OF-TENDER-CURSOR-SW        15420000
154600         WHEN OTHER                                               15440000
154700             MOVE '3040-FETCH-TENDER-CURSOR'                      15450000
154800                                            TO PV-PARAGRAPH-NAME  15460000
154900             MOVE 'ERROR ON SELECT OF TEPTND'                     15470000
155000                                            TO PV-DB2-OPERATION   15480000
155100             PERFORM 9100-SQL-ABEND                               15490000
155200     END-EVALUATE.                                                15500000
155300                                                                  15510000
155400 3045-PROCESS-TENDER.                                             15520000
155500                                                                  15530000
155600     EVALUATE EPTND-TNDR-TYP-CDE                                  15550000
155700         WHEN '02'                                                15560000
155800*            (KMRC IS *ISSUED* ON A RETURN, OTHERWISE TENDERED)   15570000
155900             IF EPTND-TNDR-AMT < 0                                15580000
PAYVEN                ADD EPTND-TNDR-AMT  TO PV-STTL-AUD-SALES-CORR (13)15591036
156100             ELSE                                                 15592000
PAYVEN                ADD EPTND-TNDR-AMT  TO PV-STTL-AUD-SALES-CORR (14)15594036
156300             END-IF                                               15595000
156400         WHEN '04'                                                15596000
PAYVEN             ADD EPTND-TNDR-AMT  TO PV-STTL-AUD-SALES-CORR (9)    15598036
156600         WHEN '05'                                                15599000
156500             ADD EPTND-TNDR-AMT  TO PV-STTL-AUD-SALES-CORR (1)    15599100
156700         WHEN '06'                                                15610000
156800             ADD EPTND-TNDR-AMT  TO PV-STTL-AUD-SALES-CORR (1)    15620000
156900         WHEN '07'                                                15640000
157000             ADD EPTND-TNDR-AMT  TO PV-STTL-AUD-SALES-CORR (3)    15650000
157100         WHEN '08'                                                15670000
157200             ADD EPTND-TNDR-AMT  TO PV-STTL-AUD-SALES-CORR (2)    15680000
157300         WHEN '13'                                                15700000
157400*            (LENGTH = 5 IS GIFT CERTIFICATE, > 5 IS GIFT CARD)   15710000
157500             IF EPTND-TNDR-ID-LEN-NBR > 5                         15720000
SEPH02               IF EPTND-TNDR-ID-SRC-CDE = '14'                    15721002
SEPH02*  SALES CORRECTION WHEN USING A SEPHORA GIFT CARD AS TENDER      15722002
PAYVEN                ADD EPTND-TNDR-AMT  TO PV-STTL-AUD-SALES-CORR (17)15723136
SEPH02               ELSE                                               15724002
PAYVEN                 ADD EPTND-TNDR-AMT  TO PV-STTL-AUD-SALES-CORR(12)15731036
SEPH02               END-IF                                             15740002
157700             END-IF                                               15750000
PAYVEN         WHEN '16'                                                15760036
PAYVEN             ADD EPTND-TNDR-AMT  TO PV-STTL-AUD-SALES-CORR (6)    15770036
PAYVEN         WHEN '17'                                                15770136
PAYVEN             ADD EPTND-TNDR-AMT  TO PV-STTL-AUD-SALES-CORR (7)    15770236
157800         WHEN '19'                                                15771036
157900             ADD EPTND-TNDR-AMT  TO PV-STTL-AUD-SALES-CORR (4)    15772036
COBRND         WHEN '24'                                                15780016
COBRND             ADD EPTND-TNDR-AMT  TO PV-STTL-AUD-SALES-CORR (5)    15781328
SEPHOR*        WHEN '22'                                                15782223
SEPHOR*  SALES CORRECTION WHEN USING A SEPHORA CHARGE CARD              15782323
SEPHOR*            ADD EPTND-TNDR-AMT  TO PV-STTL-AUD-SALES-CORR (15)   15782423
158000     END-EVALUATE.                                                15782523
158100                                                                  15782623
158200******************************************************************15782723
158300* 3050-CLOSE-TENDER-CURSOR.                                       15783000
158400******************************************************************15784000
158500 3050-CLOSE-TENDER-CURSOR.                                        15785000
158600                                                                  15786000
158700     EXEC SQL                                                     15787000
158800          CLOSE TENDER-CURSOR                                     15788000
158900     END-EXEC.                                                    15789000
159000                                                                  15790000
159100     EVALUATE TRUE                                                15800000
159200         WHEN SQLCODE = ZERO                                      15810000
159300              CONTINUE                                            15820000
159400         WHEN OTHER                                               15830000
159500             MOVE '3050-CLOSE-TENDER-CURSOR' TO PV-PARAGRAPH-NAME 15840000
159600             MOVE 'ERROR ON CLOSE OF TENDER-CURSOR'               15850000
159700                                             TO PV-DB2-OPERATION  15860000
159800             PERFORM 9100-SQL-ABEND                               15870000
159900     END-EVALUATE.                                                15880000
160000                                                                  15890000
160100******************************************************************15900000
160200* 3070-OPEN-ITEM-CURSOR.                                          15910000
160300*     OPEN ITEM CURSOR                                            15920000
160400******************************************************************15930000
160500 3070-OPEN-ITEM-CURSOR.                                           15940000
160600                                                                  15950000
160700     EXEC SQL                                                     15960000
160800          OPEN ITEM-CURSOR                                        15970000
160900     END-EXEC.                                                    15980000
161000                                                                  15990000
161100     EVALUATE TRUE                                                16000000
161200         WHEN SQLCODE = ZERO                                      16010000
161300              CONTINUE                                            16020000
161400         WHEN OTHER                                               16030000
161500             MOVE '3070-OPEN-ITEM-CURSOR'   TO PV-PARAGRAPH-NAME  16040000
161600             MOVE 'ERROR ON OPEN OF ITEM-CURSOR'                  16050000
161700                                            TO PV-DB2-OPERATION   16060000
161800             PERFORM 9100-SQL-ABEND                               16070000
161900     END-EVALUATE.                                                16080000
162000                                                                  16090000
162100******************************************************************16100000
162200* 3080-FETCH-ITEM-CURSOR                                          16110000
162300*     PRINT REPORT TOTALS (IF DATA WAS PRESENT & REPORT CREATED), 16120000
162400*     CLOSE REPORT FILE.                                          16130000
162500******************************************************************16140000
162600 3080-FETCH-ITEM-CURSOR.                                          16150000
162700                                                                  16160000
162800     EXEC SQL                                                     16170000
162900          FETCH ITEM-CURSOR                                       16180000
163000          INTO  :EPITM-DEPT-NBR                                   16190000
163100               ,:EPITM-CUST-CHRGD-AMT                             16200000
163200     END-EXEC.                                                    16210000
163300                                                                  16220000
163400     EVALUATE TRUE                                                16230000
163500         WHEN SQLCODE = ZERO                                      16240000
163600             EVALUATE TRUE                                        16250000
N2I201                 WHEN EPITM-DEPT-NBR EQUAL 833 OR 834             16260000
N2I201                     ADD EPITM-CUST-CHRGD-AMT                     16270000
N2I201                            TO PV-THIRD-PARTY-CARD-SALES          16280000
164000                 WHEN EPITM-DEPT-NBR EQUAL 981                    16290000
164100                     ADD EPITM-CUST-CHRGD-AMT TO PV-GIFT-CERT     16300000
164200                 WHEN EPITM-DEPT-NBR EQUAL 983                    16310000
164300                     ADD EPITM-CUST-CHRGD-AMT TO PV-GIFT-CARD     16320000
SEPH02                 WHEN EPITM-DEPT-NBR EQUAL 712                    16340001
SEPH02                     ADD EPITM-CUST-CHRGD-AMT TO PV-SEPHORA-GC    16350001
164400             END-EVALUATE                                         16360000
164500         WHEN SQLCODE = +100                                      16370000
164600             MOVE 'Y'        TO PS-END-OF-ITEM-CURSOR-SW          16380000
164700         WHEN OTHER                                               16390000
164800             MOVE '3080-FETCH-ITEM-CURSOR'                        16400000
164900                                            TO PV-PARAGRAPH-NAME  16410000
165000             MOVE 'ERROR ON SELECT OF TEPITM'                     16420000
165100                                            TO PV-DB2-OPERATION   16430000
165200             PERFORM 9100-SQL-ABEND                               16440000
165300     END-EVALUATE.                                                16450000
165400                                                                  16460000
165500******************************************************************16470000
165600* 3090-CLOSE-ITEM-CURSOR                                          16480000
165700******************************************************************16490000
165800 3090-CLOSE-ITEM-CURSOR.                                          16500000
165900                                                                  16510000
166000     EXEC SQL                                                     16520000
166100          CLOSE ITEM-CURSOR                                       16530000
166200     END-EXEC.                                                    16540000
166300                                                                  16550000
166400     EVALUATE TRUE                                                16560000
166500         WHEN SQLCODE = ZERO                                      16570000
166600              CONTINUE                                            16580000
166700         WHEN OTHER                                               16590000
166800             MOVE '3090-CLOSE-ITEM-CURSOR'  TO PV-PARAGRAPH-NAME  16600000
166900             MOVE 'ERROR ON CLOSE OF ITEM-CURSOR'                 16610000
167000                                            TO PV-DB2-OPERATION   16620000
167100             PERFORM 9100-SQL-ABEND                               16630000
167200     END-EVALUATE.                                                16640000
167300                                                                  16650000
167400******************************************************************16660000
167500* 3100-OPEN-SETTLEMENT-CURSOR.                                    16670000
167600*     OPEN SETTLEMENT CURSOR                                      16680000
167700******************************************************************16690000
167800 3100-OPEN-SETTLEMENT-CURSOR.                                     16700000
167900                                                                  16710000
168000     EXEC SQL                                                     16720000
168100          OPEN SETTLEMENT-CURSOR                                  16730000
168200     END-EXEC.                                                    16740000
168300                                                                  16750000
168400     EVALUATE TRUE                                                16760000
168500         WHEN SQLCODE = ZERO                                      16770000
168600              CONTINUE                                            16780000
168700         WHEN OTHER                                               16790000
168800             MOVE '3100-OPEN-SETTLEMENT-CURSOR'                   16800000
168900                                            TO PV-PARAGRAPH-NAME  16810000
169000             MOVE 'ERROR ON OPEN OF SETTLEMENT-CURSOR'            16820000
169100                                            TO PV-DB2-OPERATION   16830000
169200             PERFORM 9100-SQL-ABEND                               16840000
169300     END-EVALUATE.                                                16850000
169400                                                                  16860000
169500******************************************************************16870000
169600* 3200-FETCH-SETTLEMENT-CURSOR                                    16880024
169700******************************************************************16890000
169800 3200-FETCH-SETTLEMENT-CURSOR.                                    16900000
169900                                                                  16910000
170000     EXEC SQL                                                     16920000
170100          FETCH SETTLEMENT-CURSOR                                 16930000
170200           INTO :EPTRN-PARTN-NBR                                  16940000
170300               ,:EPDKEY-STR-NBR                                   16950000
170400               ,:EPDKEY-RGST-ID                                   16960000
170500               ,:EPDKEY-TRN-NBR                                   16970000
170600               ,:EPDKEY-STRT-TM                                   16980000
170700               ,:EPDKEY-SLS-CORR-SEQ-NBR                          16990000
170800               ,:EPTRN-TRN-TYP-CDE                                17000000
170900               ,:EPTRN-TRN-TOT-AMT                                17010000
171000               ,:EPTRN-SLS-TX-AMT                                 17020000
171100     END-EXEC.                                                    17030000
171200                                                                  17040000
171300     EVALUATE TRUE                                                17050000
171400         WHEN SQLCODE = ZERO                                      17060000
171500             ADD 1 TO PV-STTL-CURSOR-CNT                          17070000
171700         WHEN SQLCODE = PC-ROW-NOT-FOUND                          17120000
171800             SET PS-END-OF-STTL-CURSOR TO TRUE                    17130000
171900                                                                  17150000
172000         WHEN OTHER                                               17160000
172100             MOVE '3200-FETCH-SETTLEMENT-CURSOR'                  17170000
172200                                            TO PV-PARAGRAPH-NAME  17180000
172300             MOVE 'ERROR ON FETCH OF SETTLEMENT-CURSOR'           17190000
172400                                            TO PV-DB2-OPERATION   17200000
172500             PERFORM 9100-SQL-ABEND                               17210000
172600     END-EVALUATE.                                                17220000
172700                                                                  17230000
172800******************************************************************17240000
172900* 3300-CLOSE-SETTLEMENT-CURSOR                                    17250000
173000******************************************************************17260000
173100 3300-CLOSE-SETTLEMENT-CURSOR.                                    17270000
173200                                                                  17280000
173300     EXEC SQL                                                     17290000
173400          CLOSE SETTLEMENT-CURSOR                                 17300000
173500     END-EXEC.                                                    17310000
173600                                                                  17320000
173700     EVALUATE TRUE                                                17330000
173800         WHEN SQLCODE = ZERO                                      17340000
173900              CONTINUE                                            17350000
174000         WHEN OTHER                                               17360000
174100             MOVE '3300-CLOSE-SETTLEMENT-CURSOR'                  17370000
174200                                            TO PV-PARAGRAPH-NAME  17380000
174300             MOVE 'ERROR ON CLOSE OF SETTLEMENT-CURSOR'           17390000
174400                                            TO PV-DB2-OPERATION   17400000
174500             PERFORM 9100-SQL-ABEND                               17410000
174600     END-EVALUATE.                                                17420000
174700                                                                  17430000
174800******************************************************************17440000
174900* PROCESS ANY VOID LATE TRANSACTIONS                              17450000
175000******************************************************************17460000
175100 4000-PROCESS-LATE-DATA.                                          17470000
175200                                                                  17480000
175300     MULTIPLY EPTND-TNDR-AMT BY -1                                17510000
175400          GIVING PV-TNDR-AMT.                                     17511000
175500                                                                  17512000
175600     EVALUATE EPTND-TNDR-TYP-CDE                                  17530000
175700       WHEN '02'                                                  17540000
SEPHOR*        KMRC ISSUED                                              17541000
175800         IF  PV-TNDR-AMT < 0                                      17551000
PAYVEN             ADD PV-TNDR-AMT TO PV-STTL-UNAUD-REG-TOT (13)        17571037
176000         ELSE                                                     17580000
PAYVEN             ADD PV-TNDR-AMT TO PV-STTL-UNAUD-REG-TOT (14)        17601037
176200         END-IF                                                   17610000
176300                                                                  17620000
176400       WHEN '04'                                                  17630000
PAYVEN         ADD PV-TNDR-AMT    TO PV-STTL-UNAUD-REG-TOT (9)          17641137
176600                                                                  17642000
176700       WHEN '05'                                                  17643000
SEPHOR         ADD PV-TNDR-AMT TO PV-STTL-UNAUD-REG-TOT (1)             17644200
176800       WHEN '06'                                                  17645000
SEPHOR         ADD PV-TNDR-AMT TO PV-STTL-UNAUD-REG-TOT (1)             17647000
177000                                                                  17648000
177100       WHEN '07'                                                  17649000
SEPHOR         ADD PV-TNDR-AMT TO PV-STTL-UNAUD-REG-TOT (3)             17660000
177300       WHEN '08'                                                  17670000
SEPHOR         ADD PV-TNDR-AMT TO PV-STTL-UNAUD-REG-TOT (2)             17690000
177500                                                                  17700000
177600       WHEN '13'                                                  17710000
177700         IF  EPTND-TNDR-ID-LEN-NBR > 5                            17721000
SEPH02            IF EPTND-TNDR-ID-SRC-CDE = '14'                       17722002
PAYVEN               ADD PV-TNDR-AMT TO PV-STTL-UNAUD-REG-TOT (17)      17722237
SEPH02            ELSE                                                  17723002
PAYVEN             ADD PV-TNDR-AMT TO PV-STTL-UNAUD-REG-TOT (12)        17740137
SEPH02            END-IF                                                17741002
177900         END-IF                                                   17750000
178000                                                                  17760000
PAYVEN       WHEN '16'                                                  17770037
PAYVEN         ADD PV-TNDR-AMT TO PV-STTL-UNAUD-REG-TOT (6)             17781037
PAYVEN       WHEN '17'                                                  17781137
PAYVEN         ADD PV-TNDR-AMT TO PV-STTL-UNAUD-REG-TOT (7)             17781237
178100       WHEN '19'                                                  17782037
SEPHOR         ADD PV-TNDR-AMT TO PV-STTL-UNAUD-REG-TOT (4)             17783037
COBRND       WHEN '24'                                                  17790016
COBRND         ADD PV-TNDR-AMT TO PV-STTL-UNAUD-REG-TOT (5)             17793029
SEPHOR*      SEPHORA CHARGE CARD                                        17800002
SEPHOR*      WHEN '22'                                                  17810002
SEPHOR*        ADD PV-TNDR-AMT TO PV-STTL-UNAUD-REG-TOT (15)            17811002
178300     END-EVALUATE.                                                17816000
178500                                                                  17818000
178900******************************************************************17840000
179000* OPEN LATE CURSOR                                                17850000
179100******************************************************************17860000
179200 4100-OPEN-LATE-CURSOR.                                           17870000
179300                                                                  17880000
179400     MOVE 'N' TO PS-END-OF-LATE-CURSOR-SW.                        17890000
179500                                                                  17900000
179600     EXEC SQL                                                     17910000
179700          OPEN LATE-CURSOR                                        17920000
179800     END-EXEC.                                                    17930000
179900                                                                  17940000
180000     EVALUATE TRUE                                                17950000
180100         WHEN SQLCODE = ZERO                                      17960000
180200              CONTINUE                                            17970000
180300                                                                  17980000
180400         WHEN OTHER                                               17990000
180500             MOVE '4100-OPEN-LATE-CURSOR'                         18000000
180600                                            TO PV-PARAGRAPH-NAME  18010000
180700             MOVE 'ERROR ON OPEN OF LATE-CURSOR'                  18020000
180800                                            TO PV-DB2-OPERATION   18030000
180900             PERFORM 9100-SQL-ABEND                               18040000
181000     END-EVALUATE.                                                18050000
181100                                                                  18060000
181200                                                                  18070000
181300******************************************************************18080000
181400* FETCH LATE CURSOR                                               18090000
181500******************************************************************18100000
181600 4200-FETCH-LATE-CURSOR.                                          18110000
181700                                                                  18120000
181800     EXEC SQL                                                     18130000
181900          FETCH LATE-CURSOR                                       18140000
182000           INTO :EPTRN-PARTN-NBR                                  18150000
182100               ,:EPTRN-STR-NBR                                    18160000
182200               ,:EPTRN-RGST-ID                                    18170000
182300               ,:EPTRN-TRN-NBR                                    18180000
182400               ,:EPTRN-STRT-TM                                    18190000
182500               ,:EPTRN-SLS-CORR-SEQ-NBR                           18200000
SEPHOR               ,:EPTND-TNDR-SEQ-NBR                               18201000
SEPHOR               ,:EPTND-TNDR-AMT                                   18211000
182700               ,:EPTND-TNDR-TYP-CDE                               18220000
182800               ,:EPTND-TNDR-ID-LEN-NBR                            18230000
SEPH02               ,:EPTND-TNDR-ID-SRC-CDE                            18231003
182900     END-EXEC.                                                    18240000
183000                                                                  18250000
183100     EVALUATE TRUE                                                18260000
183200         WHEN SQLCODE = ZERO                                      18270000
183300             ADD 1 TO PV-LATE-CURSOR-CNT                          18280000
183300                                                                  18290000
SEPHOR             MOVE EPTRN-PARTN-NBR TO PV-PARTN-NBR-D               18330200
SEPHOR             MOVE EPTRN-STR-NBR   TO PV-STR-NBR-D                 18330300
SEPHOR             MOVE EPTRN-RGST-ID   TO PV-RGST-ID-D                 18330400
SEPHOR             MOVE EPTRN-TRN-NBR   TO PV-TRN-NBR-D                 18330500
SEPHOR             MOVE EPTND-TNDR-SEQ-NBR TO PV-TNDR-SEQ-NBR-D         18330600
SEPHOR             MOVE EPTND-TNDR-TYP-CDE TO PV-TNDR-TYP-CDE-D         18330900
SEPHOR             MOVE EPTND-TNDR-AMT  TO PV-TNDR-AMT                  18331000
SEPHOR             DISPLAY '*****************'                          18331100
SEPHOR             DISPLAY 'FETCH LATE CURSOR'                          18331200
SEPHOR             DISPLAY 'PARTN ' PV-PARTN-NBR-D                      18331300
SEPHOR             DISPLAY 'STR   ' PV-STR-NBR-D                        18331400
SEPHOR             DISPLAY 'RGST  ' PV-RGST-ID-D                        18331500
SEPHOR             DISPLAY 'TRN   ' PV-TRN-NBR-D                        18331600
SEPHOR             DISPLAY 'TNDR-SEQ-NBR ' PV-TNDR-SEQ-NBR-D            18331700
SEPHOR             DISPLAY 'TNDR-TYP-CDE ' PV-TNDR-TYP-CDE-D            18331800
SEPHOR             DISPLAY 'TNDR-AMT ' PV-TNDR-AMT                      18331900
SEPHOR             DISPLAY '*****************'                          18332000
SEPHOR                                                                  18332100
144100             PERFORM 4000-PROCESS-LATE-DATA                       18332200
183400                                                                  18332300
183500         WHEN SQLCODE = PC-ROW-NOT-FOUND                          18332400
183600             SET PS-END-OF-LATE-CURSOR TO TRUE                    18332500
183700                                                                  18333000
183800         WHEN OTHER                                               18334000
183900             MOVE '4200-FETCH-LATE-CURSOR'                        18335000
184000                                            TO PV-PARAGRAPH-NAME  18336000
184100             MOVE 'ERROR ON FETCH OF LATE-CURSOR'                 18337000
184200                                            TO PV-DB2-OPERATION   18338000
184300             PERFORM 9100-SQL-ABEND                               18339000
184400     END-EVALUATE.                                                18340000
184500                                                                  18350000
184600                                                                  18360000
184700******************************************************************18370000
184800* CLOSE LATE CURSOR                                               18380000
184900******************************************************************18390000
185000 4300-CLOSE-LATE-CURSOR.                                          18400000
185100                                                                  18410000
185200     EXEC SQL                                                     18420000
185300          CLOSE LATE-CURSOR                                       18430000
185400     END-EXEC.                                                    18440000
185500                                                                  18450000
185600     EVALUATE TRUE                                                18460000
185700         WHEN SQLCODE = ZERO                                      18470000
185800              CONTINUE                                            18480000
185900                                                                  18490000
186000         WHEN OTHER                                               18500000
186100             MOVE '4300-CLOSE-LATE-CURSOR'                        18510000
186200                                            TO PV-PARAGRAPH-NAME  18520000
186300             MOVE 'ERROR ON CLOSE OF LATE-CURSOR'                 18530000
186400                                            TO PV-DB2-OPERATION   18540000
186500             PERFORM 9100-SQL-ABEND                               18550000
186600     END-EVALUATE.                                                18560000
186700                                                                  18570000
186800                                                                  18580000
186900******************************************************************18590000
187000* 5000-CALCULATE-SETTLEMENT                                       18600000
187100*     ADD UNAUDITED REGISTER TOTALS AND AUDITED SALES             18610000
187200*     CORRECTIONS TO GIVE PROPOSED SETTLEMENT                     18620000
187300*                                                                 18630000
187400******************************************************************18640000
187500 5000-CALCULATE-SETTLEMENT.                                       18650000
187600                                                                  18660000
187700     COMPUTE PV-PRO-STTL-FROM-POS (PV-STTL-SUB) =                 18670000
187800         PV-STTL-UNAUD-REG-TOT (PV-STTL-SUB) +                    18680000
187900         PV-STTL-AUD-SALES-CORR (PV-STTL-SUB).                    18690000
188000                                                                  18700000
188100******************************************************************18710000
188200* 6000-PRINT-REPORT-TOTALS                                        18720000
188300*     PRINT REPORT TOTALS (IF DATA WAS PRESENT & REPORT CREATED), 18730000
188400*     CLOSE REPORT FILE.                                          18740000
188500******************************************************************18750000
188600 6000-PRINT-REPORT-TOTALS.                                        18760000
188700                                                                  18770000
188800     PERFORM 8000-PRINT-HEADINGS.                                 18780000
188900                                                                  18790000
189000     MOVE 'EXTERNAL'             TO D1-SYSTEM-TYPE.               18800000
189100     MOVE D1-DETAIL-LINE-1       TO PV-PRINT-RECORD.              18810000
189200     MOVE +2                     TO PV-LINE-SPACING.              18820000
189300     PERFORM 8200-WRITE-REPORT-LINE.                              18830000
189400                                                                  18840000
189500     PERFORM 7000-PRINT-DETAIL-LINE                               18850000
189600         VARYING PV-STTL-SUB FROM 1 BY 1                          18860000
PAYVEN             UNTIL PV-STTL-SUB GREATER THAN 7                     18870037
189800                                                                  18880000
189900     MOVE 'INTERNAL'             TO D1-SYSTEM-TYPE.               18890000
190000     MOVE D1-DETAIL-LINE-1       TO PV-PRINT-RECORD.              18900000
190100     MOVE +2                     TO PV-LINE-SPACING.              18910000
190200     PERFORM 8200-WRITE-REPORT-LINE.                              18920000
190300                                                                  18930000
190400     PERFORM 7000-PRINT-DETAIL-LINE                               18940000
PAYVEN         VARYING PV-STTL-SUB FROM 8 BY 1                          18950037
PAYVEN             UNTIL PV-STTL-SUB GREATER THAN 18.                   18960037
190700                                                                  18970000
COBTRL**   PRINT TRAILING TRAN LINES FOR ONLY THE STORES THAT HAVE THEM 18970148
COBTRL     IF (PV-TTN-STORE = 0) AND (PV-TTP-STORE = 0)                 18970248
COBTRL         CONTINUE                                                 18970348
COBTRL     ELSE                                                         18970448
COBTRL         MOVE T1-TRAILER-NOTE-LINE-1 TO PV-PRINT-RECORD           18971048
COBTRL         MOVE +2                     TO PV-LINE-SPACING           18972048
COBTRL         PERFORM 8200-WRITE-REPORT-LINE                           18973048
COBTRL         MOVE PV-TTN-STORE           TO T2-DISPLAY-TTN            18975048
COBTRL         MOVE PV-TTP-STORE           TO T2-DISPLAY-TTP            18976048
COBTRL         MOVE T2-TRAILER-NOTE-LINE-2 TO PV-PRINT-RECORD           18977048
COBTRL         MOVE +1                     TO PV-LINE-SPACING           18978048
COBTRL         PERFORM 8200-WRITE-REPORT-LINE                           18979048
COBTRL     END-IF.                                                      18979148
COBTRL                                                                  18979248
190800     MOVE 'KCN'                  TO AR048-SA-TRN-CTG-CDE.         18980000
PAYVEN     MOVE PV-PRO-STTL-FROM-POS (9)                                18991037
191000                                 TO AR048-SA-STTLMNT-AMT.         19000000
PAYVEN     ADD  PV-PRO-STTL-FROM-POS (9)                                19011037
191200                                 TO PV-KCN-TOTAL.                 19020000
191300     PERFORM 8300-WRITE-FILE-LINE.                                19030000
191400                                                                  19040000
191500     MOVE 'KCP'                  TO AR048-SA-TRN-CTG-CDE.         19050000
PAYVEN     MOVE PV-PRO-STTL-FROM-POS (10)                               19061037
191700                                 TO AR048-SA-STTLMNT-AMT.         19070000
PAYVEN     ADD  PV-PRO-STTL-FROM-POS (10)                               19081037
191900                                 TO PV-KCP-TOTAL.                 19090000
192000     PERFORM 8300-WRITE-FILE-LINE.                                19100000
192100                                                                  19110000
192200******************************************************************19120000
192300* 7000-PRINT-DETAIL-LINE                                          19130000
192400*     FORMAT AND PRINT REPORT DETAIL LINE.                        19140000
192500******************************************************************19150000
192600 7000-PRINT-DETAIL-LINE.                                          19160000
192700                                                                  19170000
192800     MOVE PC-STTL-TYPE (PV-STTL-SUB)                              19180000
192900                                 TO D2-STTL-TYPE                  19190000
193000     MOVE PV-STTL-UNAUD-REG-TOT (PV-STTL-SUB)                     19200000
193100                                 TO D2-UNAUD-REG-TOTALS           19210000
193200     MOVE PV-STTL-AUD-SALES-CORR (PV-STTL-SUB)                    19220000
193300                                 TO D2-AUD-SALES-CORR             19230000
193400     MOVE PV-PRO-STTL-FROM-POS (PV-STTL-SUB)                      19240000
193500                                 TO D2-PRO-STTL-FROM-POS          19250000
193600     MOVE PC-STTL-FILE (PV-STTL-SUB)                              19260000
193700                                 TO D2-STTL-JOB                   19270000
193800                                                                  19280000
193900     MOVE D2-DETAIL-LINE-2       TO PV-PRINT-RECORD.              19290000
194000     MOVE +2                     TO PV-LINE-SPACING.              19300000
194100     PERFORM 8200-WRITE-REPORT-LINE.                              19310000
194200                                                                  19320000
194300******************************************************************19330000
194400* 8000-PRINT-HEADINGS                                             19340000
194500*     PRINT THE HEADINGS FOR THE REPORT.                          19350000
194600******************************************************************19360000
194700 8000-PRINT-HEADINGS.                                             19370000
194800                                                                  19380000
194900     ADD +1                      TO PV-PAGE-CNT.                  19390000
195000     MOVE PV-PAGE-CNT TO DP132-PAGE-NUMBER.                       19400000
195100     MOVE DP132-STANDRD-HEADER-132-COLS                           19410000
195200                                 TO PV-PRINT-RECORD.              19420000
195300     PERFORM 8100-WRITE-RPT-TOP-OF-PAGE.                          19430000
195400                                                                  19440000
195500     MOVE H2-HEADING-LINE-2      TO PV-PRINT-RECORD.              19450000
195600     MOVE +1                     TO PV-LINE-SPACING.              19460000
195700     PERFORM 8200-WRITE-REPORT-LINE.                              19470000
195800                                                                  19480000
195900     MOVE H3-HEADING-LINE-3A     TO PV-PRINT-RECORD.              19490000
196000     MOVE +1                     TO PV-LINE-SPACING.              19500000
196100     PERFORM 8200-WRITE-REPORT-LINE.                              19510000
196200                                                                  19520000
196300     MOVE H3-HEADING-LINE-3      TO PV-PRINT-RECORD.              19530000
196400     MOVE +3                     TO PV-LINE-SPACING.              19540000
196500     PERFORM 8200-WRITE-REPORT-LINE.                              19550000
196600                                                                  19560000
196700     MOVE H4-HEADING-LINE-4      TO PV-PRINT-RECORD.              19570000
196800     MOVE +1                     TO PV-LINE-SPACING.              19580000
196900     PERFORM 8200-WRITE-REPORT-LINE.                              19590000
197000                                                                  19600000
197100     MOVE H5-HEADING-LINE-5      TO PV-PRINT-RECORD.              19610000
197200     MOVE +1                     TO PV-LINE-SPACING.              19620000
197300     PERFORM 8200-WRITE-REPORT-LINE.                              19630000
197400                                                                  19640000
197500     MOVE H6-HEADING-LINE-6      TO PV-PRINT-RECORD.              19650000
197600     MOVE ZERO                   TO PV-LINE-SPACING.              19660000
197700     PERFORM 8200-WRITE-REPORT-LINE.                              19670000
197800                                                                  19680000
197900******************************************************************19690000
198000* 8100-WRITE-RPT-TOP-OF-PAGE                                      19700000
198100*     WRITE FIRST REPORT LINE AFTER PAGE BREAK.                   19710000
198200******************************************************************19720000
198300 8100-WRITE-RPT-TOP-OF-PAGE.                                      19730000
198400                                                                  19740000
198500     WRITE SETTLEMENT-REPORT-RECORD                               19750000
198600       FROM PV-PRINT-RECORD                                       19760000
198700         AFTER ADVANCING PAGE.                                    19770000
198800     MOVE +1             TO PV-LINE-CNT.                          19780000
198900                                                                  19790000
199000******************************************************************19800000
199100* 8200-WRITE-REPORT-LINE                                          19810000
199200*     WRITE REPORT LINE AFTER ADVANCING LINE SPACING.             19820000
199300******************************************************************19830000
199400 8200-WRITE-REPORT-LINE.                                          19840000
199500                                                                  19850000
199600     WRITE SETTLEMENT-REPORT-RECORD                               19860000
199700       FROM PV-PRINT-RECORD                                       19870000
199800         AFTER ADVANCING PV-LINE-SPACING.                         19880000
199900                                                                  19890000
200000     ADD PV-LINE-SPACING TO PV-LINE-CNT.                          19900000
200100                                                                  19910000
200200******************************************************************19920000
200300 8300-WRITE-FILE-LINE.                                            19930000
200400*     WRITE FILE LINE.                                            19940000
200500******************************************************************19950000
200600                                                                  19960000
200700     WRITE SETTLEMENT-FILE-RECORD                                 19970000
200800       FROM AR048-SALES-AUDIT-POSTING-REC.                        19980000
200900                                                                  19990000
201000******************************************************************20000000
201100* 9100-SQL-ABEND                                                  20010000
201200*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.20020000
201300******************************************************************20030000
201400 9100-SQL-ABEND.                                                  20040000
201500     DISPLAY '** ABEND     **'.                                   20050000
201600     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        20060000
201700     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              20070000
201800     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               20080000
201900                                                                  20090000
202000******************************************************************20100000
202100* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     20110000
202200* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      20120000
202300******************************************************************20130000
202400     COPY DPPD004.                                                20140000
202500                                                                  20150000
202600     SET AC-DB2-ERROR TO TRUE.                                    20160000
202700     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         20170000
202800                                                                  20180000
202900******************************************************************20190000
203000* 9999-ABEND                                                      20200000
203100*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  20210000
203200******************************************************************20220000
203300 9999-ABEND.                                                      20230000
203400     DISPLAY '** ABEND           **'.                             20240000
203500     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  20250000
203600     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        20260000
203700     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       20270000
203800     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       20280000
203900     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         20290000
