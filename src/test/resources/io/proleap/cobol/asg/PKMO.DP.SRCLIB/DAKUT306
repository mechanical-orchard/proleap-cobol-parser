       IDENTIFICATION DIVISION.                                         00010000
                                                                        00020000
       PROGRAM-ID.    DAKUT306.                                         00030000
       AUTHOR.        BOB MCASEY.                                       00040000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
       DATE-WRITTEN.  08-23-2000.                                       00060000
       DATE-COMPILED.                                                   00070000
                                                                        00080000
      ******************************************************************00090000
      * DAKUT306 - DESCRIPTION:                                        *00100000
      * CREATE OPEN FISCAL PERIODS CONTROL FOR DEBIT ALLOWANCE DAILY   *00110000
      * PROCESSING                                                     *00120000
      ******************************************************************00130000
      * CHANGED:                                                       *00131009
      * AML  03/09/01  ADDED FISCAL YEAR TO OUTPUT FILE.               *00131109
      *                                                                *00131209
      ******************************************************************00132009
                                                                        00140000
       ENVIRONMENT DIVISION.                                            00150000
                                                                        00160000
       CONFIGURATION SECTION.                                           00170000
       SOURCE-COMPUTER.        IBM-3090.                                00180000
       OBJECT-COMPUTER.        IBM-3090.                                00190000
                                                                        00200000
       INPUT-OUTPUT SECTION.                                            00210000
       FILE-CONTROL.                                                    00220000
                                                                        00230000
           SELECT CONTROL-CARD-FILE  ASSIGN TO INP01.                   00250005
                                                                        00260000
           SELECT FISCAL-WEEK-FILE   ASSIGN TO OUT01.                   00262005
                                                                        00263005
      ******************************************************************00270000
       DATA DIVISION.                                                   00280000
      ******************************************************************00290000
       FILE SECTION.                                                    00300000
                                                                        00310000
       FD  CONTROL-CARD-FILE                                            00311005
           RECORDING MODE IS F                                          00312005
           LABEL RECORDS ARE STANDARD                                   00313005
           BLOCK CONTAINS 0 RECORDS.                                    00314005
                                                                        00315005
       01  CONTROL-CARD-RECORD           PIC X(80).                     00316005
                                                                        00317005
       FD  FISCAL-WEEK-FILE                                             00320000
           LABEL RECORDS ARE STANDARD                                   00330000
           RECORDING MODE IS F                                          00340000
           BLOCK CONTAINS 0 RECORDS.                                    00350000
       01  FISCAL-WEEK-RECORD          PIC X(50).                       00360000
                                                                        00370000
       WORKING-STORAGE SECTION.                                         00380000
                                                                        00390000
       01  FILLER                      PIC X(40)                        00400000
            VALUE '***** WORKING STORAGE STARTS HERE ******'.           00410000
                                                                        00420000
       01  PROGRAM-VARIABLES.                                           00430000
           05  PV-CURRENT-DATE-TIME.                                    00440000
               10  PV-CURRENT-DATE-EXP.                                 00450000
                   15  PV-CURRENT-DATE-CCYY   PIC X(04).                00460000
                   15  FILLER                 PIC X(01)  VALUE '-'.     00470000
                   15  PV-CURRENT-DATE-MM     PIC X(02).                00480000
                   15  FILLER                 PIC X(01)  VALUE '-'.     00490000
                   15  PV-CURRENT-DATE-DD     PIC X(02).                00500000
               10  PV-CURRENT-TIME            PIC X(12).                00510000
           05  PV-CURRENT-DATE                PIC X(10).                00521000
       EJECT                                                            00530000
                                                                        00540000
      *-----------------------------------------------------------------00550000
      *  ABEND AREA                                                     00560000
      *-----------------------------------------------------------------00570000
       01 ABEND-AREAS.                                                  00580000
           05 ABEND-CODE               PIC S9(04)  VALUE ZERO           00590000
                                                   COMP SYNC.           00600000
               88  AC-BAD-DATA                     VALUE +4003.         00610000
               88  AC-DB2-ERROR                    VALUE +4013.         00620000
           05  AA-ABEND-LIT            PIC X(40)   VALUE                00630000
                 '*****       ABEND'.                                   00640000
           05  AA-PROGRAM-LIT          PIC X(40)   VALUE                00650000
                   '*****   PROGRAM: DAKUT306'.                         00660000
           05  AA-PARAGRAPH-LIT.                                        00670000
               10  FILLER              PIC X(17)   VALUE                00680000
                   '***** PARAGRAPH: '.                                 00690000
               10  AA-PARAGRAPH-NAME   PIC X(35)   VALUE SPACES.        00700000
           05  AA-MESSAGE-LINE.                                         00710000
               10  FILLER              PIC X(06)   VALUE '*****'.       00720000
               10  AA-MESSAGE          PIC X(127)  VALUE SPACES.        00730000
           05  AA-DB2-ERROR-LIT        PIC X(40)   VALUE                00740000
                   '*****    DB2 ERROR'.                                00750000
           05  AA-DB2-OPERATION-LIT.                                    00760000
               10  FILLER              PIC X(17)   VALUE                00770000
                   '***** OPERATION: '.                                 00780000
               10  AA-DB2-OPERATION.                                    00790000
                   15  AA-DB2-OP-1     PIC X(25)   VALUE SPACES.        00800000
                   15  AA-DB2-OP-2     PIC X(25)   VALUE SPACES.        00810000
           05  AA-DB2-TABLE-1          PIC X(08)   VALUE SPACES.        00820000
           05  AA-DB2-TABLE-2          PIC X(08)   VALUE SPACES.        00830000
           05  AA-DB2-TABLE-3          PIC X(08)   VALUE SPACES.        00840000
           05  AA-DB2-TABLE-4          PIC X(08)   VALUE SPACES.        00850000
                                                                        00860000
      ****************************************************************  00861005
      * RECORD LAYOUT FOR CONTROL CARD FILE.                            00862005
      ****************************************************************  00863005
       01  CC-CONTROL-CARD.                                             00864005
           05  CC-CTL-DTE                   PIC X(10).                  00865005
           05  CC-CTL-FILLER                PIC X(70).                  00866005
                                                                        00867005
      ******************************************************************00870000
      *  OUTPUT RECORD FORMAT                                           00880000
      ******************************************************************00890000
           COPY DARD104.                                                00900000
                                                                        00910000
      ******************************************************************00920000
      *  DB2 ERROR MESSAGES FORMAT AREA.                                00930000
      ******************************************************************00940000
           COPY DPWS004.                                                00950000
                                                                        00960000
      ******************************************************************00970000
      *  USED FOR DB2 ERRORS                                            00980000
      ******************************************************************00990000
           EXEC SQL                                                     01000000
               INCLUDE SQLCA                                            01010000
           END-EXEC.                                                    01020000
                                                                        01030000
      ******************************************************************01040000
      *  LAYOUT FOR DATE TABLE                                          01050000
      ******************************************************************01060000
           EXEC SQL                                                     01070000
               INCLUDE TDTATTR                                          01080000
           END-EXEC.                                                    01090000
                                                                        01100000
       01  FILLER                      PIC X(22)                        01180000
           VALUE 'END OF WORKING STORAGE'.                              01190000
                                                                        01200000
       EJECT                                                            01210000
                                                                        01220000
      ******************************************************************01230000
       PROCEDURE DIVISION.                                              01240000
      ******************************************************************01250000
                                                                        01260000
                                                                        01270000
       0000-DAKUT306.                                                   01280000
                                                                        01300000
           PERFORM 1000-INITIALIZATION.                                 01310000
                                                                        01320000
           PERFORM 2000-MAINLINE.                                       01330000
                                                                        01340000
           PERFORM 9000-EOJ-PROCESS.                                    01350005
                                                                        01360000
           STOP RUN.                                                    01370000
                                                                        01380000
       EJECT                                                            01390000
                                                                        01400000
      ******************************************************************01410000
       1000-INITIALIZATION.                                             01420000
      ******************************************************************01430000
                                                                        01440000
           OPEN INPUT CONTROL-CARD-FILE.                                01450005
           OPEN OUTPUT FISCAL-WEEK-FILE.                                01451005
                                                                        01460000
           PERFORM 8000-READ-CONTROL-CARD-FILE.                         01461005
       EJECT                                                            01470000
                                                                        01480000
      ******************************************************************01490000
       2000-MAINLINE.                                                   01500000
      ******************************************************************01510000
                                                                        01520000
                                                                        01530000
           DISPLAY ' '.                                                 01540000
           DISPLAY '*** CONTROL DATE '  CC-CTL-DTE.                     01590006
                                                                        01600000
           PERFORM 7000-SELECT-DATES.                                   01610005
                                                                        01620000
           PERFORM 4000-WRITE-OUTPUT-RECORD.                            01720000
                                                                        01730000
       EJECT                                                            01740000
                                                                        01750000
       4000-WRITE-OUTPUT-RECORD.                                        01760000
            DISPLAY 'CURRENT FISCAL DATA: ' DARD104-RECORD.             01761001
            WRITE FISCAL-WEEK-RECORD                                    01770000
                FROM DARD104-RECORD.                                    01780000
      ******************************************************************01790000
       7000-SELECT-DATES.                                               01800005
      ******************************************************************01810000
                                                                        01820000
           EXEC SQL                                                     01830000
               SELECT FSCL_MN_NBR                                       01840000
                    , FSCL_WK_NBR                                       01850000
                    , FSCL_MN_END_DTE                                   01860000
                    , FSCL_WK_END_DTE                                   01870000
                    , FSCL_YR_NBR                                       01871007
               INTO  :DA104-OPN-FSCL-MN-NBR                             01880000
                   , :DA104-OPN-FSCL-WK-NBR                             01890000
                   , :DA104-OPN-FSCL-MN-DTE                             01900000
                   , :DA104-OPN-FSCL-WK-DTE                             01901008
                   , :DA104-OPN-FSCL-YR-NBR                             01910007
               FROM TDTATTR                                             01920000
               WHERE (KY_DTE = :CC-CTL-DTE)                             01930005
           END-EXEC.                                                    01940000
                                                                        01950000
           EVALUATE TRUE                                                01960000
               WHEN SQLCODE = 100                                       01970000
                   MOVE '7000-SELECT-TDTATTR'                           01980000
                                       TO AA-PARAGRAPH-NAME             01990000
                   MOVE 'TDTATTR ROW NOT FOUND'                         02000000
                                       TO AA-MESSAGE                    02010000
                   MOVE 'SELECT'       TO AA-DB2-OPERATION              02020000
                   PERFORM 9998-DB2-ABEND                               02030000
               WHEN SQLCODE < 0                                         02040000
                   MOVE '7000-SELECT-TDTATTR'                           02050000
                                       TO AA-PARAGRAPH-NAME             02060000
                   MOVE 'TDTATTR TABLE ERROR'                           02070000
                                       TO AA-MESSAGE                    02080000
                   MOVE 'SELECT'       TO AA-DB2-OPERATION              02090000
                   PERFORM 9998-DB2-ABEND                               02100000
               WHEN SQLCODE > 0                                         02110000
               WHEN SQLWARN0 NOT = SPACES                               02120000
                   MOVE '7000-SELECT-TDTATTR'                           02130000
                                       TO AA-PARAGRAPH-NAME             02140000
                   MOVE 'TDTATTR TABLE WARNING'                         02150000
                                       TO AA-MESSAGE                    02160000
                   MOVE 'SELECT'       TO AA-DB2-OPERATION              02170000
                   PERFORM 9998-DB2-ABEND                               02180000
           END-EVALUATE.                                                02190000
                                                                        02200000
       EJECT                                                            02530000
                                                                        02540000
      *----------------------------------------------------------------*02541005
      *  READ CONTROL CARD FILE                                         02542005
      *----------------------------------------------------------------*02543005
       8000-READ-CONTROL-CARD-FILE.                                     02544005
                                                                        02545005
           READ CONTROL-CARD-FILE INTO CC-CONTROL-CARD.                 02546005
                                                                        02547005
      ******************************************************************02550000
       9000-EOJ-PROCESS.                                                02560005
      ******************************************************************02570000
                                                                        02580000
           CLOSE CONTROL-CARD-FILE                                      02590005
                 FISCAL-WEEK-FILE.                                      02591005
                                                                        02600000
      ******************************************************************02770000
       9998-DB2-ABEND.                                                  02780000
      ******************************************************************02790000
                                                                        02800000
           CLOSE FISCAL-WEEK-FILE.                                      02810000
                                                                        02820000
           DISPLAY AA-ABEND-LIT.                                        02830000
           DISPLAY AA-DB2-ERROR-LIT.                                    02840000
           DISPLAY AA-PROGRAM-LIT.                                      02850000
           DISPLAY AA-PARAGRAPH-LIT.                                    02860000
           DISPLAY AA-MESSAGE-LINE.                                     02870000
           DISPLAY AA-DB2-OPERATION-LIT.                                02880000
           SET AC-DB2-ERROR TO TRUE.                                    02890000
           MOVE +4013                  TO ABEND-CODE.                   02900000
                                                                        02910000
           COPY DPPD004.                                                02920000
           CALL 'ILBOABN0' USING ABEND-CODE.                            02930000
                                                                        02940000
