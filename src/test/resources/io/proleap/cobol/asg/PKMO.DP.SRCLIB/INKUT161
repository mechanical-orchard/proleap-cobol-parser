       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    INKUT161                                                  
       AUTHOR.        DORSEY JACKSON                                            
       INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
       DATE-WRITTEN.  07-02-2002.                                               
       DATE-COMPILED.                                                           
                                                                                
      ******************************************************************        
      * INKUT161 - CREATE PLAT UNLOAD CONTROL CARDS FOR STORES BEING            
      *            PROCESSED. STORES ARE IN CHARACTER FORMAT.                   
      ******************************************************************        
      ******************************************************************        
      *                        CHANGE LOG                              *        
      *  CHANGE ID  DATE    REASON FOR CHANGE                          *        
      *   W26600   7/27/04  THIS PROGRAM HAS BEEN RE-WRITTEN TO PROCESS*        
      *                     THE INPUT STORE FILE AND CREATE 1 SORT CARD*        
      *                     AND 6 OUTPUT FILES USED AS BMC UNLOADS     *        
      *                     CONTROL RECORDS                            *        
      *                     -SCOTT JACKSON                                      
      ******************************************************************        
                                                                                
       ENVIRONMENT DIVISION.                                                    
                                                                                
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER.    IBM-3090.                                            
       OBJECT-COMPUTER.    IBM-3090.                                            
                                                                                
       INPUT-OUTPUT SECTION.                                                    
                                                                                
       FILE-CONTROL.                                                            
           SELECT INPUT-FILE                                                    
               ASSIGN TO INP01.                                                 
                                                                                
           SELECT PROCESS-FILE-A                                                
               ASSIGN TO OUT01.                                                 
                                                                                
           SELECT PROCESS-FILE-B                                                
               ASSIGN TO OUT02.                                                 
                                                                                
           SELECT PROCESS-FILE-C                                                
               ASSIGN TO OUT03.                                                 
                                                                                
           SELECT PROCESS-FILE-D                                                
               ASSIGN TO OUT04.                                                 
                                                                                
           SELECT PROCESS-FILE-E                                                
               ASSIGN TO OUT05.                                                 
                                                                                
           SELECT PROCESS-FILE-F                                                
               ASSIGN TO OUT06.                                                 
                                                                                
           SELECT OUTPUT-SORT-FILE                                              
               ASSIGN TO OUT07.                                                 
                                                                                
                                                                                
       DATA DIVISION.                                                           
                                                                                
       FILE SECTION.                                                            
                                                                                
       FD  INPUT-FILE                                                           
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK  CONTAINS 0 RECORDS                                            
           RECORD CONTAINS 80 CHARACTERS                                        
           DATA RECORD IS INPUT-RECORD.                                         
                                                                                
       01  INPUT-RECORD                   PIC X(80).                            
                                                                                
       FD  PROCESS-FILE-A                                                       
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK  CONTAINS 0 RECORDS                                            
           RECORD CONTAINS 80 CHARACTERS                                        
           DATA RECORD IS OUTPUT-RECORD-A.                                      
                                                                                
       01  OUTPUT-RECORD-A                PIC X(80).                            
                                                                                
       FD  PROCESS-FILE-B                                                       
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK  CONTAINS 0 RECORDS                                            
           RECORD CONTAINS 80 CHARACTERS                                        
           DATA RECORD IS OUTPUT-RECORD-B.                                      
                                                                                
       01  OUTPUT-RECORD-B                PIC X(80).                            
                                                                                
       FD  PROCESS-FILE-C                                                       
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK  CONTAINS 0 RECORDS                                            
           RECORD CONTAINS 80 CHARACTERS                                        
           DATA RECORD IS OUTPUT-RECORD-C.                                      
                                                                                
       01  OUTPUT-RECORD-C                PIC X(80).                            
                                                                                
       FD  PROCESS-FILE-D                                                       
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK  CONTAINS 0 RECORDS                                            
           RECORD CONTAINS 80 CHARACTERS                                        
           DATA RECORD IS OUTPUT-RECORD-D.                                      
                                                                                
       01  OUTPUT-RECORD-D                PIC X(80).                            
                                                                                
       FD  PROCESS-FILE-E                                                       
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK  CONTAINS 0 RECORDS                                            
           RECORD CONTAINS 80 CHARACTERS                                        
           DATA RECORD IS OUTPUT-RECORD-E.                                      
                                                                                
       01  OUTPUT-RECORD-E                PIC X(80).                            
                                                                                
       FD  PROCESS-FILE-F                                                       
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK  CONTAINS 0 RECORDS                                            
           RECORD CONTAINS 80 CHARACTERS                                        
           DATA RECORD IS OUTPUT-RECORD-F.                                      
                                                                                
       01  OUTPUT-RECORD-F                PIC X(80).                            
                                                                                
       FD  OUTPUT-SORT-FILE                                                     
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK  CONTAINS 0 RECORDS                                            
           RECORD CONTAINS 80 CHARACTERS                                        
           DATA RECORD IS SORT-RECORD.                                          
                                                                                
       01  SORT-RECORD                    PIC X(80).                            
                                                                                
       EJECT                                                                    
                                                                                
       WORKING-STORAGE SECTION.                                                 
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** WORKING STORAGE AREA BEGIN ***'.                                
                                                                                
      *****************************************************************         
      ***************************************************************** 00120000
      *   INPUT RECORD                                                  00130000
      ***************************************************************** 00140000
                                                                                
       01  IR-INPUT-RECORD.                                                     
           05  INPUT-STORE                   PIC X(04)   VALUE SPACES.          
           05  FILLER                        PIC X(76)   VALUE SPACES.          
                                                                                
       01  BMC-STORE-NUMBERS.                                                   
           05  FILLER                        PIC X(04)   VALUE SPACES.          
           05  BMC-MORE-STORES               PIC X(01)   VALUE SPACES.          
           05  BMC-STORE-NUMBER              PIC X(04)   VALUE SPACES.          
           05  FILLER                        PIC X(71)   VALUE SPACES.          
                                                                                
       01  OR-OUTPUT-RECORD.                                                    
           05  OUTPUT-COMMA                  PIC X(01)   VALUE ','.             
           05  OUTPUT-STORE                  PIC X(04)   VALUE SPACES.          
           05  FILLER                        PIC X(75)   VALUE SPACES.          
                                                                                
       01  PV-PROGRAM-VARIABLES.                                                
 ******    05  PV-SUB                        PIC S9(04)  COMP SYNC.             
           05  PV-LOC-COUNT                  PIC  9(04)  VALUE ZEROES.          
           05  PV-LOC-PER-FILE               PIC  9(04)  VALUE ZEROES.          
           05  PV-LAST-FILE                  PIC  9(04)  VALUE ZEROES.          
           05  PV-REMAINDER                  PIC  9(04)  VALUE ZEROES.          
           05  PV-TEMP-COUNTER               PIC  9(04)  VALUE ZEROES.          
           05  PV-BMC-COUNTER                PIC  9(04)  VALUE ZEROES.          
                                                                                
       01  STORE-NUMBER-TABLE.                                                  
           05 STORE-TABLE-PROCESS            OCCURS     9999 TIMES              
                                             INDEXED BY PV-SUB.                 
               10  STP-LOC-NBR               PIC 9(04)   VALUE ZEROES.          
               10  FILLER                    PIC X(76)   VALUE SPACES.          
                                                                                
                                                                                
       01  SR-SORT-RECORD.                                                      
           05  FILLER                        PIC X(02)   VALUE SPACES.          
           05  FILLER                        PIC X(16)   VALUE                  
               'SORT FIELDS=COPY'.                                              
           05  FILLER                        PIC X(62)   VALUE SPACES.          
                                                                                
       01  SR-SORT-OUTFIL-RECORD.                                               
           05  FILLER                        PIC X(02)   VALUE SPACES.          
           05  FILLER                        PIC X(13)   VALUE                  
               'OUTFIL FILES='.                                                 
           05  SR-SORT-FILE-NUMBER           PIC 9(01)   VALUE ZEROES.          
           05  FILLER                        PIC X(01)   VALUE ','.             
           05  FILLER                        PIC X(63)   VALUE SPACES.          
                                                                                
       01  SR-SORT-INCLUDE.                                                     
           05  FILLER                        PIC X(04)   VALUE SPACES.          
           05  FILLER                        PIC X(22)   VALUE                  
               'INCLUDE=(01,04,CH,EQ,C'.                                        
           05  FILLER                        PIC X(01)   VALUE QUOTE.           
           05  FILLER                        PIC X(04)   VALUE                  
               '0000'.                                                          
           05  FILLER                        PIC X(01)   VALUE QUOTE.           
           05  FILLER                        PIC X(01)   VALUE ','.             
           05  FILLER                        PIC X(47)   VALUE SPACES.          
                                                                                
       01  SR-SORT-STORES.                                                      
           05  FILLER                        PIC X(10)   VALUE SPACES.          
           05  FILLER                        PIC X(16)   VALUE                  
               'OR,01,04,CH,EQ,C'.                                              
           05  FILLER                        PIC X(01)   VALUE QUOTE.           
           05  SR-SORT-LOC                   PIC 9(04)   VALUE ZEROES.          
           05  FILLER                        PIC X(01)   VALUE QUOTE.           
           05  SSS-MORE-STORES               PIC X(01)   VALUE SPACES.          
           05  FILLER                        PIC X(50)   VALUE SPACES.          
                                                                                
       01  PC-PROGRAM-CONSTANTS.                                                
           05  PC-PROGRAM-NAME               PIC X(08) VALUE 'INKUT161'.        
           05  PC-STORE-FILE-COUNT           PIC 9(02) VALUE 06.                
           05  PC-RIGHT-PAREN                PIC X(01) VALUE                    
               ')'.                                                             
           05  PC-COMMA                      PIC X(13) VALUE ','.               
           05  PC-OUTPUT                     PIC X(80) VALUE SPACES.            
                                                                                
       01  PS-PROGRAM-SWITCHES.                                                 
           05  PS-INPUT-EOF-SW               PIC X(1)     VALUE 'N'.            
               88  PS-INPUT-EOF                           VALUE 'Y'.            
           05  PS-FIRST-RECORD-SW            PIC X(1)     VALUE 'N'.            
               88  PS-FIRST-RECORD                        VALUE 'Y'.            
           05  PS-TABLE-LOADED-SW            PIC X(1)     VALUE 'N'.            
               88  PS-TABLE-LOADED                        VALUE 'Y'.            
           05  PS-EMPTY-FILE-SW              PIC X(1)     VALUE 'N'.            
               88  PS-EMPTY-FILE                          VALUE 'Y'.            
           05  PS-LAST-FILE-SW               PIC X(1)     VALUE 'N'.            
               88  PS-LAST-FILE                           VALUE 'Y'.            
                                                                                
      *                                                                         
      *                                                                         
       PROCEDURE DIVISION.                                                      
                                                                                
       0000-INKUT161.                                                           
                                                                                
      ****************************************************************          
      *    OPEN ALL FILES.                                                      
      *    PROCESS CONTROL RECORDS                                              
      *    CLOSE ALL FILES.                                                     
      ****************************************************************          
           OPEN INPUT  INPUT-FILE                                               
                OUTPUT PROCESS-FILE-A                                           
                       PROCESS-FILE-B                                           
                       PROCESS-FILE-C                                           
                       PROCESS-FILE-D                                           
                       PROCESS-FILE-E                                           
                       PROCESS-FILE-F                                           
                       OUTPUT-SORT-FILE.                                        
                                                                                
           PERFORM 1000-INITIALIZE.                                             
                                                                                
           IF NOT PS-EMPTY-FILE                                                 
               PERFORM 2000-PROCESS                                             
           END-IF.                                                              
                                                                                
           CLOSE INPUT-FILE                                                     
                 PROCESS-FILE-A                                                 
                 PROCESS-FILE-B                                                 
                 PROCESS-FILE-C                                                 
                 PROCESS-FILE-D                                                 
                 PROCESS-FILE-E                                                 
                 PROCESS-FILE-F                                                 
                 OUTPUT-SORT-FILE.                                              
                                                                                
           STOP RUN.                                                            
                                                                                
       1000-INITIALIZE.                                                         
      ****************************************************************          
      *    READ FIRST RECORD                                                    
      *    PERFORMED BY 0000-INKUT161.                                          
      ****************************************************************          
                                                                                
           INITIALIZE PS-PROGRAM-SWITCHES.                                      
                                                                                
           PERFORM 6000-READ-CNTL-FILE.                                         
                                                                                
           IF PS-INPUT-EOF                                                      
               PERFORM 7900-WRITE-EMPTY-FILES                                   
               SET PS-EMPTY-FILE TO TRUE                                        
           ELSE                                                                 
               PERFORM 4000-LOAD-STORE-TABLE                                    
                   UNTIL PS-TABLE-LOADED                                        
           END-IF.                                                              
                                                                                
                                                                                
      ****************************************************************          
      * 2000-PROCESS.                                                           
      * PROCESS THE INPUT STORE PROCESS FILE                                    
      ****************************************************************          
       2000-PROCESS.                                                            
                                                                                
           PERFORM 2100-CALC-FILE-LOCS.                                         
                                                                                
           PERFORM 7000-PREP-SORT-CARD.                                         
                                                                                
           PERFORM 2200-BUILD-FILES.                                            
                                                                                
      *    PERFORM 2400-BUILD-BMC-UNLOAD-CARD                                   
      *        VARYING PV-SUB FROM 1 BY 1                                       
      *            UNTIL PV-TEMP-COUNTER > PV-LOC-COUNT.                        
                                                                                
      ****************************************************************          
      * 2100-CALC-FILE-LOCS.                                                    
      * CALCULATE THE NUMBER OF STORE TO PLACE IN EACH SORT CARD                
      ****************************************************************          
       2100-CALC-FILE-LOCS.                                                     
                                                                                
           DIVIDE PV-LOC-COUNT BY PC-STORE-FILE-COUNT                           
               GIVING PV-LOC-PER-FILE                                           
                   REMAINDER PV-REMAINDER.                                      
                                                                                
      ****************************************************************          
      * 2200-BUILD-FILES.                                                       
      * BUILD OUTPUT FILES                                                      
      ****************************************************************          
       2200-BUILD-FILES.                                                        
                                                                                
      *    PERFORM 7000-PREP-SORT-CARD.                                         
                                                                                
           SET PV-SUB TO 1.                                                     
                                                                                
           IF PV-LOC-PER-FILE <  1                                              
                                                                                
               MOVE 1 TO PV-TEMP-COUNTER                                        
               PERFORM 7070-PREP-OUTFIL                                         
               PERFORM 2210-BUILD-FILE-1                                        
      *        PERFORM 7200-FINISH-SORT-CARD                                    
                                                                                
               MOVE 1 TO PV-TEMP-COUNTER                                        
               PERFORM 7070-PREP-OUTFIL                                         
               PERFORM 2220-BUILD-FILE-2                                        
      *        PERFORM 7200-FINISH-SORT-CARD                                    
                                                                                
               MOVE 1 TO PV-TEMP-COUNTER                                        
               PERFORM 7070-PREP-OUTFIL                                         
               PERFORM 2230-BUILD-FILE-3                                        
      *        PERFORM 7200-FINISH-SORT-CARD                                    
                                                                                
               MOVE 1 TO PV-TEMP-COUNTER                                        
               PERFORM 7070-PREP-OUTFIL                                         
               PERFORM 2240-BUILD-FILE-4                                        
      *        PERFORM 7200-FINISH-SORT-CARD                                    
                                                                                
               MOVE 1 TO PV-TEMP-COUNTER                                        
               PERFORM 7070-PREP-OUTFIL                                         
               PERFORM 2250-BUILD-FILE-5                                        
      *        PERFORM 7200-FINISH-SORT-CARD                                    
                                                                                
               MOVE 1 TO PV-TEMP-COUNTER                                        
               PERFORM 7070-PREP-OUTFIL                                         
               PERFORM 2260-BUILD-FILE-6                                        
      *        PERFORM 7200-FINISH-SORT-CARD                                    
                                                                                
           ELSE                                                                 
               PERFORM 2300-BUILD-FILES                                         
      *            UNTIL PV-TEMP-COUNTER > PV-LOC-PER-FILE                      
           END-IF.                                                              
                                                                                
      ****************************************************************          
      * 2210-BUILD-FILE-1                                                       
      * BUILD OUTPUT FILES                                                      
      ****************************************************************          
       2210-BUILD-FILE-1.                                                       
                                                                                
           MOVE 1 TO SR-SORT-FILE-NUMBER.                                       
           MOVE 0 TO PV-BMC-COUNTER.                                            
                                                                                
           MOVE STP-LOC-NBR(PV-SUB)                                             
               TO SR-SORT-LOC.                                                  
                                                                                
           PERFORM 2410-WRITE-BMC-FILE1.                                        
           PERFORM 7100-WRITE-STORES.                                           
                                                                                
           SET PV-SUB UP BY 1.                                                  
           ADD 1 TO PV-TEMP-COUNTER.                                            
                                                                                
      ****************************************************************          
      * 2220-BUILD-FILE-2                                                       
      * BUILD OUTPUT FILES                                                      
      ****************************************************************          
       2220-BUILD-FILE-2.                                                       
                                                                                
           MOVE 2 TO SR-SORT-FILE-NUMBER.                                       
           MOVE 0 TO PV-BMC-COUNTER.                                            
                                                                                
           MOVE STP-LOC-NBR(PV-SUB)                                             
               TO SR-SORT-LOC.                                                  
                                                                                
           PERFORM 2420-WRITE-BMC-FILE2.                                        
           PERFORM 7100-WRITE-STORES.                                           
                                                                                
           SET PV-SUB UP BY 1.                                                  
           ADD 1 TO PV-TEMP-COUNTER.                                            
                                                                                
      ****************************************************************          
      * 2230-BUILD-FILE-3                                                       
      * BUILD OUTPUT FILES                                                      
      ****************************************************************          
       2230-BUILD-FILE-3.                                                       
                                                                                
           MOVE 3 TO SR-SORT-FILE-NUMBER.                                       
           MOVE 0 TO PV-BMC-COUNTER.                                            
                                                                                
           MOVE STP-LOC-NBR(PV-SUB)                                             
               TO SR-SORT-LOC.                                                  
                                                                                
           PERFORM 2430-WRITE-BMC-FILE3.                                        
           PERFORM 7100-WRITE-STORES.                                           
                                                                                
           SET PV-SUB UP BY 1.                                                  
           ADD 1 TO PV-TEMP-COUNTER.                                            
                                                                                
      ****************************************************************          
      * 2240-BUILD-FILE-4                                                       
      * BUILD OUTPUT FILES                                                      
      ****************************************************************          
       2240-BUILD-FILE-4.                                                       
                                                                                
           MOVE 4 TO SR-SORT-FILE-NUMBER.                                       
           MOVE 0 TO PV-BMC-COUNTER.                                            
                                                                                
           MOVE STP-LOC-NBR(PV-SUB)                                             
               TO SR-SORT-LOC.                                                  
                                                                                
           PERFORM 2440-WRITE-BMC-FILE4.                                        
           PERFORM 7100-WRITE-STORES.                                           
                                                                                
           SET PV-SUB UP BY 1.                                                  
           ADD 1 TO PV-TEMP-COUNTER.                                            
                                                                                
      ****************************************************************          
      * 2250-BUILD-FILE-5                                                       
      * BUILD OUTPUT FILES                                                      
      ****************************************************************          
       2250-BUILD-FILE-5.                                                       
                                                                                
           MOVE 5 TO SR-SORT-FILE-NUMBER.                                       
           MOVE 0 TO PV-BMC-COUNTER.                                            
                                                                                
           MOVE STP-LOC-NBR(PV-SUB)                                             
               TO SR-SORT-LOC.                                                  
                                                                                
           PERFORM 2450-WRITE-BMC-FILE5.                                        
           PERFORM 7100-WRITE-STORES.                                           
                                                                                
           SET PV-SUB UP BY 1.                                                  
           ADD 1 TO PV-TEMP-COUNTER.                                            
                                                                                
      ****************************************************************          
      * 2260-BUILD-FILE-6                                                       
      * BUILD OUTPUT FILES                                                      
      ****************************************************************          
       2260-BUILD-FILE-6.                                                       
                                                                                
           MOVE 6 TO SR-SORT-FILE-NUMBER.                                       
           MOVE 0 TO PV-BMC-COUNTER.                                            
                                                                                
           MOVE STP-LOC-NBR(PV-SUB)                                             
               TO SR-SORT-LOC.                                                  
                                                                                
           PERFORM 2460-WRITE-BMC-FILE6.                                        
           PERFORM 7100-WRITE-STORES.                                           
                                                                                
           SET PV-SUB UP BY 1.                                                  
           ADD 1 TO PV-TEMP-COUNTER.                                            
                                                                                
      ****************************************************************          
      * 2300-BUILD-FILES                                                        
      * BUILD OUTPUT FILES                                                      
      ****************************************************************          
       2300-BUILD-FILES.                                                        
                                                                                
            MOVE 1 TO PV-TEMP-COUNTER                                           
            PERFORM 7070-PREP-OUTFIL                                            
            PERFORM 2210-BUILD-FILE-1                                           
                PV-LOC-PER-FILE TIMES.                                          
      *     PERFORM 7200-FINISH-SORT-CARD                                       
                                                                                
            MOVE 1 TO PV-TEMP-COUNTER                                           
            PERFORM 7070-PREP-OUTFIL                                            
            PERFORM 2220-BUILD-FILE-2                                           
                PV-LOC-PER-FILE TIMES.                                          
      *     PERFORM 7200-FINISH-SORT-CARD                                       
                                                                                
            MOVE 1 TO PV-TEMP-COUNTER                                           
            PERFORM 7070-PREP-OUTFIL                                            
            PERFORM 2230-BUILD-FILE-3                                           
                PV-LOC-PER-FILE TIMES.                                          
      *     PERFORM 7200-FINISH-SORT-CARD                                       
                                                                                
            MOVE 1 TO PV-TEMP-COUNTER                                           
            PERFORM 7070-PREP-OUTFIL                                            
            PERFORM 2240-BUILD-FILE-4                                           
                PV-LOC-PER-FILE TIMES.                                          
      *     PERFORM 7200-FINISH-SORT-CARD                                       
                                                                                
            MOVE 1 TO PV-TEMP-COUNTER                                           
            PERFORM 7070-PREP-OUTFIL                                            
            PERFORM 2250-BUILD-FILE-5                                           
                PV-LOC-PER-FILE TIMES.                                          
      *     PERFORM 7200-FINISH-SORT-CARD                                       
                                                                                
            SET     PS-LAST-FILE TO TRUE                                        
            COMPUTE PV-LAST-FILE = PV-LOC-PER-FILE + PV-REMAINDER               
                                                                                
            MOVE 1 TO PV-TEMP-COUNTER                                           
            PERFORM 7070-PREP-OUTFIL                                            
            PERFORM 2260-BUILD-FILE-6                                           
                PV-LAST-FILE TIMES.                                             
      *     PERFORM 7200-FINISH-SORT-CARD.                                      
                                                                                
      ****************************************************************          
      * 2410-WRITE-BMC-FILE1.                                                   
      *    CREATE THE UL CARD THAT BMC WILL USE TO EXTRACT STORE DATA           
      ****************************************************************          
       2410-WRITE-BMC-FILE1.                                                    
            DISPLAY 'SORT STORE.... ', STP-LOC-NBR(PV-SUB).                     
            ADD 1 TO PV-BMC-COUNTER.                                            
                                                                                
            IF PV-TEMP-COUNTER = 1                                              
                MOVE SPACES              TO BMC-MORE-STORES                     
                MOVE STP-LOC-NBR(PV-SUB) TO BMC-STORE-NUMBER                    
            ELSE                                                                
                MOVE ','                 TO BMC-MORE-STORES                     
                MOVE STP-LOC-NBR(PV-SUB) TO BMC-STORE-NUMBER                    
            END-IF.                                                             
                                                                                
            PERFORM 8010-WRITE-BMC-UNLOAD-CARD.                                 
                                                                                
                                                                                
      ****************************************************************          
      * 2420-WRITE-BMC-FILE2.                                                   
      *    CREATE THE UL CARD THAT BMC WILL USE TO EXTRACT STORE DATA           
      ****************************************************************          
       2420-WRITE-BMC-FILE2.                                                    
            DISPLAY 'SORT STORE.... ', STP-LOC-NBR(PV-SUB).                     
            ADD 1 TO PV-BMC-COUNTER.                                            
                                                                                
            IF PV-TEMP-COUNTER = 1                                              
                MOVE SPACES              TO BMC-MORE-STORES                     
                MOVE STP-LOC-NBR(PV-SUB) TO BMC-STORE-NUMBER                    
            ELSE                                                                
                MOVE ','                 TO BMC-MORE-STORES                     
                MOVE STP-LOC-NBR(PV-SUB) TO BMC-STORE-NUMBER                    
            END-IF.                                                             
                                                                                
            PERFORM 8020-WRITE-BMC-UNLOAD-CARD.                                 
                                                                                
                                                                                
      ****************************************************************          
      * 2430-WRITE-BMC-FILE3.                                                   
      *    CREATE THE UL CARD THAT BMC WILL USE TO EXTRACT STORE DATA           
      ****************************************************************          
       2430-WRITE-BMC-FILE3.                                                    
            DISPLAY 'SORT STORE.... ', STP-LOC-NBR(PV-SUB).                     
            ADD 1 TO PV-BMC-COUNTER.                                            
                                                                                
            IF PV-TEMP-COUNTER = 1                                              
                MOVE SPACES              TO BMC-MORE-STORES                     
                MOVE STP-LOC-NBR(PV-SUB) TO BMC-STORE-NUMBER                    
            ELSE                                                                
                MOVE ','                 TO BMC-MORE-STORES                     
                MOVE STP-LOC-NBR(PV-SUB) TO BMC-STORE-NUMBER                    
            END-IF.                                                             
                                                                                
            PERFORM 8030-WRITE-BMC-UNLOAD-CARD.                                 
                                                                                
                                                                                
      ****************************************************************          
      * 2440-WRITE-BMC-FILE4.                                                   
      *    CREATE THE UL CARD THAT BMC WILL USE TO EXTRACT STORE DATA           
      ****************************************************************          
       2440-WRITE-BMC-FILE4.                                                    
            DISPLAY 'SORT STORE.... ', STP-LOC-NBR(PV-SUB).                     
            ADD 1 TO PV-BMC-COUNTER.                                            
                                                                                
            IF PV-TEMP-COUNTER = 1                                              
                MOVE SPACES              TO BMC-MORE-STORES                     
                MOVE STP-LOC-NBR(PV-SUB) TO BMC-STORE-NUMBER                    
            ELSE                                                                
                MOVE ','                 TO BMC-MORE-STORES                     
                MOVE STP-LOC-NBR(PV-SUB) TO BMC-STORE-NUMBER                    
            END-IF.                                                             
                                                                                
            PERFORM 8040-WRITE-BMC-UNLOAD-CARD.                                 
                                                                                
                                                                                
      ****************************************************************          
      * 2450-WRITE-BMC-FILE5.                                                   
      *    CREATE THE UL CARD THAT BMC WILL USE TO EXTRACT STORE DATA           
      ****************************************************************          
       2450-WRITE-BMC-FILE5.                                                    
            DISPLAY 'SORT STORE.... ', STP-LOC-NBR(PV-SUB).                     
            ADD 1 TO PV-BMC-COUNTER.                                            
                                                                                
            IF PV-TEMP-COUNTER = 1                                              
                MOVE SPACES              TO BMC-MORE-STORES                     
                MOVE STP-LOC-NBR(PV-SUB) TO BMC-STORE-NUMBER                    
            ELSE                                                                
                MOVE ','                 TO BMC-MORE-STORES                     
                MOVE STP-LOC-NBR(PV-SUB) TO BMC-STORE-NUMBER                    
            END-IF.                                                             
                                                                                
            PERFORM 8050-WRITE-BMC-UNLOAD-CARD.                                 
                                                                                
                                                                                
      ****************************************************************          
      * 2460-WRITE-BMC-FILE6.                                                   
      *    CREATE THE UL CARD THAT BMC WILL USE TO EXTRACT STORE DATA           
      ****************************************************************          
       2460-WRITE-BMC-FILE6.                                                    
            DISPLAY 'SORT STORE.... ', STP-LOC-NBR(PV-SUB).                     
            ADD 1 TO PV-BMC-COUNTER.                                            
                                                                                
            IF PV-TEMP-COUNTER = 1                                              
                MOVE SPACES              TO BMC-MORE-STORES                     
                MOVE STP-LOC-NBR(PV-SUB) TO BMC-STORE-NUMBER                    
            ELSE                                                                
                MOVE ','                 TO BMC-MORE-STORES                     
                MOVE STP-LOC-NBR(PV-SUB) TO BMC-STORE-NUMBER                    
            END-IF.                                                             
                                                                                
            PERFORM 8060-WRITE-BMC-UNLOAD-CARD.                                 
                                                                                
                                                                                
      ****************************************************************          
      * 4000-LOAD-STORE-TABLE                                                   
      *    READ THROUGH THE INPUT STORE FILE LOADING EACH TO THE                
      *    STORE TABLE                                                          
      ****************************************************************          
       4000-LOAD-STORE-TABLE.                                                   
                                                                                
           MOVE INPUT-STORE TO STP-LOC-NBR(PV-SUB).                             
                                                                                
           SET PV-SUB UP BY 1.                                                  
           ADD +1 TO PV-LOC-COUNT.                                              
                                                                                
           PERFORM 6000-READ-CNTL-FILE.                                         
                                                                                
           IF PS-INPUT-EOF                                                      
               SET PS-TABLE-LOADED TO TRUE                                      
           END-IF.                                                              
                                                                                
                                                                                
       6000-READ-CNTL-FILE.                                                     
      ****************************************************************          
      *    READ CONTROL FILE ONE                                                
      *                                                                         
      *    PERFORMED BY 1000-INITIALIZE.                                        
      ****************************************************************          
           READ INPUT-FILE INTO IR-INPUT-RECORD                                 
               AT END                                                           
                   SET PS-INPUT-EOF TO TRUE.                                    
                                                                                
       7000-PREP-SORT-CARD.                                                     
      ****************************************************************          
      *                                                                         
      * WRITE THE COMMON PORTIONS OF THE SORT CARD                              
      *                                                                         
      ****************************************************************          
                                                                                
      * 'SORT FIELDS=COPY'                                                      
           MOVE SR-SORT-RECORD          TO   PC-OUTPUT                          
           WRITE SORT-RECORD            FROM PC-OUTPUT.                         
                                                                                
       7070-PREP-OUTFIL.                                                        
      ****************************************************************          
      *                                                                         
      * WRITE THE OUTFIL RECORD # OF THE SORT CARD                              
      *                                                                         
      ****************************************************************          
                                                                                
      * 'OUTFIL FILES= #'.                                                      
           ADD 1 TO SR-SORT-FILE-NUMBER.                                        
           MOVE SR-SORT-OUTFIL-RECORD   TO   PC-OUTPUT                          
           WRITE SORT-RECORD            FROM PC-OUTPUT.                         
                                                                                
      * 'INCLUDE=(01,04,EQ,C'0000','  (DEFAULT IS STORE '0000')                 
           MOVE SR-SORT-INCLUDE         TO   PC-OUTPUT                          
           WRITE SORT-RECORD            FROM PC-OUTPUT.                         
                                                                                
                                                                                
       7100-WRITE-STORES.                                                       
      ****************************************************************          
      *                                                                         
      * WRITE THE LOCATION NUMBER TO THE INCLUDE FILE                           
      *                                                                         
      ****************************************************************          
                                                                                
      * 'INCLUDE=(01,04,EQ,C'1234','                                            
            MOVE STP-LOC-NBR(PV-SUB)     TO   SR-SORT-LOC.                      
                                                                                
            IF NOT PS-LAST-FILE                                                 
                IF PV-TEMP-COUNTER < PV-LOC-PER-FILE                            
                    MOVE PC-COMMA        TO SSS-MORE-STORES                     
                ELSE                                                            
                    MOVE PC-RIGHT-PAREN  TO SSS-MORE-STORES                     
            ELSE                                                                
                IF PV-TEMP-COUNTER < PV-LAST-FILE                               
                    MOVE PC-COMMA     TO SSS-MORE-STORES                        
                ELSE                                                            
                    MOVE PC-RIGHT-PAREN  TO SSS-MORE-STORES                     
            END-IF.                                                             
                                                                                
            MOVE SR-SORT-STORES          TO   PC-OUTPUT                         
            WRITE SORT-RECORD            FROM PC-OUTPUT.                        
                                                                                
                                                                                
      *7200-FINISH-SORT-CARD.                                                   
      ****************************************************************          
      *                                                                         
      * WRITE THE LOCATION NUMBER TO THE INCLUDE FILE                           
      *                                                                         
      ****************************************************************          
      *                                                                         
      *    MOVE PC-RIGHT-PAREN          TO   PC-OUTPUT                          
      *    WRITE SORT-RECORD            FROM PC-OUTPUT.                         
      *                                                                         
      ****************************************************************          
      * 7900-WRITE-EMPTY-FILES.                                                 
      *    CREATE SORT CARDS AND 6 FILES WITH DEFAULT STORE '0000'              
      *    DUE TO NO EXCEPTION REPORTING STORES ON INPUT CARD                   
      ****************************************************************          
       7900-WRITE-EMPTY-FILES.                                                  
                                                                                
           PERFORM 7000-PREP-SORT-CARD.                                         
                                                                                
           MOVE SPACES                  TO   PC-OUTPUT                          
           WRITE OUTPUT-RECORD-A        FROM PC-OUTPUT.                         
           WRITE OUTPUT-RECORD-B        FROM PC-OUTPUT.                         
           WRITE OUTPUT-RECORD-C        FROM PC-OUTPUT.                         
           WRITE OUTPUT-RECORD-D        FROM PC-OUTPUT.                         
           WRITE OUTPUT-RECORD-E        FROM PC-OUTPUT.                         
           WRITE OUTPUT-RECORD-F        FROM PC-OUTPUT.                         
                                                                                
                                                                                
      ****************************************************************          
      * 8010-WRITE-BMC-UNLOAD-CARD.                                             
      *    CREATE LISTING FOR STORE NUMBERS TO BE USED AS INPUT                 
      *    FILE #1 TO THE BMC UNLOAD PROCESSING                                 
      ****************************************************************          
       8010-WRITE-BMC-UNLOAD-CARD.                                              
                                                                                
           WRITE OUTPUT-RECORD-A FROM BMC-STORE-NUMBERS.                        
                                                                                
      ****************************************************************          
      * 8020-WRITE-BMC-UNLOAD-CARD.                                             
      *    CREATE LISTING FOR STORE NUMBERS TO BE USED AS INPUT                 
      *    FILE #2 TO THE BMC UNLOAD PROCESSING                                 
      ****************************************************************          
       8020-WRITE-BMC-UNLOAD-CARD.                                              
                                                                                
           WRITE OUTPUT-RECORD-B FROM BMC-STORE-NUMBERS.                        
                                                                                
      ****************************************************************          
      * 8030-WRITE-BMC-UNLOAD-CARD.                                             
      *    CREATE LISTING FOR STORE NUMBERS TO BE USED AS INPUT                 
      *    FILE #1 TO THE BMC UNLOAD PROCESSING                                 
      ****************************************************************          
       8030-WRITE-BMC-UNLOAD-CARD.                                              
                                                                                
           WRITE OUTPUT-RECORD-C FROM BMC-STORE-NUMBERS.                        
                                                                                
      ****************************************************************          
      * 8040-WRITE-BMC-UNLOAD-CARD.                                             
      *    CREATE LISTING FOR STORE NUMBERS TO BE USED AS INPUT                 
      *    FILE #1 TO THE BMC UNLOAD PROCESSING                                 
      ****************************************************************          
       8040-WRITE-BMC-UNLOAD-CARD.                                              
                                                                                
           WRITE OUTPUT-RECORD-D FROM BMC-STORE-NUMBERS.                        
                                                                                
      ****************************************************************          
      * 8050-WRITE-BMC-UNLOAD-CARD.                                             
      *    CREATE LISTING FOR STORE NUMBERS TO BE USED AS INPUT                 
      *    FILE #1 TO THE BMC UNLOAD PROCESSING                                 
      ****************************************************************          
       8050-WRITE-BMC-UNLOAD-CARD.                                              
                                                                                
           WRITE OUTPUT-RECORD-E FROM BMC-STORE-NUMBERS.                        
                                                                                
      ****************************************************************          
      * 8060-WRITE-BMC-UNLOAD-CARD.                                             
      *    CREATE LISTING FOR STORE NUMBERS TO BE USED AS INPUT                 
      *    FILE #1 TO THE BMC UNLOAD PROCESSING                                 
      ****************************************************************          
       8060-WRITE-BMC-UNLOAD-CARD.                                              
                                                                                
           WRITE OUTPUT-RECORD-F FROM BMC-STORE-NUMBERS.                        
                                                                                
