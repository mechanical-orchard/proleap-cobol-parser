       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.              INKUT109.                               00020000
       AUTHOR.                  ABRAHAM JACOB - IBM GLOBAL SERVICES.    00030000
       INSTALLATION.            KOHLS DEPARTMENT STORES.                00040000
       DATE-WRITTEN.            01/15/2003.                             00050000
       DATE-COMPILED.                                                   00060000
      ******************************************************************00070000
      *                                                                *00080000
      *    CREATES ADJUSTED PHYSICAL INVENTORY FILE WHICH IS USED BY   *00090000
      *    INKRP102, INKRP109 AND INKRP111 TO GENERATE REPORTS.        *00100000
      *                                                                *00110000
      ******************** HISTORY OF CHANGES **************************00120000
      * CHG ID/                                                         00130000
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES                     00140000
      * -------  ----------  ----------------------------------------   00150000
R03073* R03073   03/07/2003  MODIFY PROGRAM TO PERFORM A DISPLAY        00160000
R03073*                      THE ATTRIBUTES WHEN A SKU IS NOT FOUND     00170000
21732 * 21732    04/28/2003  ROD JANSSEN                                00180000
21732 *                      DAILY DETAIL STOCKROOM WITHDRAWAL & STORE  00190000
21732 *                      CORRECTIONS REPORT CREATION.               00200000
26600 * 26600    04/27/2004  PAUL KEBER                                 00210000
26600 *                      STORE NUMBER EXPANSION PROJECT CHANGES TO  00220000
26600 *                      REPLACE TSTR000 WITH XMT_LOC.              00230000
W27710* W27710   01/28/2005  ROD JANSSEN                                00240000
W27710*                      REMOVE CONTENTION WITH OTHER INVENTORY PGM 00250000
28545 *                                                                 00260000
28545 * W28545   08/10/2006  B. GRAHAM - STRATAGEM                      00270000
28545 *                      DEPARTMENT LEVEL INVENTORY PROJECT         00280000
28545 *                      JOIN TINVPAR TO TINCNTL                    00290000
28545 *                      REPLACE TSKXREF LOOKUP WITH PRICING MODULE 00300000
W33304* W33304   03/28/2008  CHUCK EBERT - STRATAGEM                    00310012
W33304*                      HOLDING INVENTORY LEDGER OPEN ACROSS       00320012
W33304*                      PERIODS INVENTORY SHORTAGE REPORTING       00330012
      ******************************************************************00340000
                                                                        00350000
       ENVIRONMENT DIVISION.                                            00360000
       CONFIGURATION SECTION.                                           00370000
       INPUT-OUTPUT SECTION.                                            00380000
       FILE-CONTROL.                                                    00390000
           SELECT ADJ-PHY-INV-FILE                                      00400000
                  ASSIGN TO OUT01.                                      00410000
                                                                        00420000
       DATA DIVISION.                                                   00430000
       FILE SECTION.                                                    00440000
       FD  ADJ-PHY-INV-FILE                                             00450000
           LABEL RECORDS ARE OMITTED                                    00460000
           RECORDING MODE IS F                                          00470000
           BLOCK CONTAINS 0 RECORDS.                                    00480000
21732  01  ADJ-PHY-INV-SUMMARY-REC      PIC  X(100).                    00490010
                                                                        00500000
       EJECT                                                            00510000
                                                                        00520000
       WORKING-STORAGE SECTION.                                         00530000
                                                                        00540000
       01  ABEND-CODE                   PIC S9(04) VALUE 0 COMP SYNC.   00550000
                                                                        00560000
       01  PV-PROGRAM-VARIABLES.                                        00570000
           05  PV-PARA                  PIC  X(30) VALUE SPACES.        00580000
           05  PV-SKU                   PIC  9(08) VALUE ZERO.          00590000
           05  PV-SKU-R  REDEFINES PV-SKU.                              00600000
               10  PV-SKU-DEPT          PIC  9(03).                     00610000
               10  PV-SKU-CLASS         PIC  9(02).                     00620000
               10  PV-SKU-SEQ           PIC  9(03).                     00630000
           05  PV-PREV-SKU              PIC  9(08) VALUE ZERO.          00640000
           05  PV-DEPT                  PIC  9(04) VALUE ZERO.          00650000
           05  PV-PREV-DEPT             PIC  9(04) VALUE ZERO.          00660000
           05  PV-DEFAULT-DATE          PIC  X(10) VALUE '9999-09-09'.  00670000
           05  PV-DB2-OPER-ATTEMPTED    PIC  X(30) VALUE SPACES.        00680000
26600      05  PV-DB2-STORE             PIC S9(4) COMP VALUE ZEROS.     00690000
26600      05  PV-DB2-STORE-ZONED-NUM   PIC  9(05) VALUE ZERO.          00700000
21732      05  PV-DB2-AREA-NBR          PIC S9(9) COMP VALUE ZEROS.     00710000
21732      05  PV-DB2-SHEET-NBR         PIC S9(9) COMP VALUE ZEROS.     00720000
           05  PV-DB2-SKU               PIC S9(08)V COMP-3.             00730000
           05  PV-DB2-DEPT              PIC S9(04)V COMP-3.             00740000
           05  PV-DB2-STORE-TYPE        PIC X(02).                      00750000
           05  PV-DB2-ADJUST-TYPE       PIC X(02).                      00760000
           05  PV-DB2-INV-AMT           PIC S9(15) COMP-3.              00770000
           05  PV-DB2-EXTD-AMT          PIC S9(15)V99 COMP-3.           00780000
           05  PV-DB2-UNIT-PR-AMT       PIC S9(05)V99 COMP-3.           00790000
21732      05  PV-DB2-CRE-TMST-DATE     PIC X(10) VALUE SPACES.         00800000
           05  PV-DB2-TABLE-NAME        PIC X(06).                      00810000
W33304     05  PV-NULL                  PIC S9(04)  VALUE +0            00811017
W33304                                              COMP SYNC.          00812017
                                                                        00820000
       01  SWITCHES.                                                    00830000
           05  DRIVER-CURSOR-IND        PIC  X(01)  VALUE 'N'.          00840000
               88  END-OF-DRIVER-CURSOR             VALUE 'Y'.          00850000
           05  DETAIL-CURSOR-IND        PIC  X(01)  VALUE 'N'.          00860000
               88  BEG-OF-DETAIL-CURSOR             VALUE 'N'.          00870000
               88  END-OF-DETAIL-CURSOR             VALUE 'Y'.          00880000
                                                                        00890000
R03073 01  DISPLAY-FIELDS.                                              00900000
R03073     05  DF-QTY                   PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9-.       00910000
R03073     05  DF-EXT-AMT               PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.99-.    00920000
21732      05  DF-AREA-NBR              PIC ZZZZZ9-.                    00930000
R03073     05  PF-UNIT-PR-AMT           PIC ZZ,ZZ9.99-.                 00940000
R03073                                                                  00950000
                                                                        00960000
      ** WORKING STORAGE COPYBOOK FOR PHYSICAL INVENTORY SUMMARY FILE.  00970000
      ***************************************************************** 00980000
                                                                        00990000
21732      COPY INRD109.                                                01000000
                                                                        01010000
28545 ***************************************************************** 01020000
28545 * COMMON PRICING WORKING STORAGE COPYBOOK                       * 01030000
28545 ***************************************************************** 01040000
28545                                                                   01050000
28545      COPY INWS400.                                                01060000
28545                                                                   01070000
                                                                        01080000
      ***************************************************************** 01090000
      * SQL ABEND ROUTINE WORKING STORAGE AND SQLCA                   * 01100000
      ***************************************************************** 01110000
                                                                        01120000
           COPY DPWS004.                                                01130000
           EXEC SQL                                                     01140000
                INCLUDE SQLCA                                           01150000
           END-EXEC.                                                    01160000
                                                                        01170000
           COPY SQLCA2.                                                 01180000
                                                                        01190000
      ***************************************************************** 01260000
      * DB2 DATE ATTRIBUTES TABLE DCLGEN                              * 01270000
      ***************************************************************** 01280000
           EXEC SQL                                                     01290000
                INCLUDE TDTATTR                                         01300000
           END-EXEC.                                                    01310000
      ***************************************************************** 01320000
26600 * DB2 XMT LOCATION TABLE DCLGEN                                 * 01330000
      ***************************************************************** 01340000
           EXEC SQL                                                     01350000
26600           INCLUDE XMT00001                                        01360000
           END-EXEC.                                                    01370000
28545 *                                                                 01380000
28545 ******************************************************************01390000
28545 *  DCLGEN FOR THE INVENTORY CONTROL TABLE.                        01400000
28545 ******************************************************************01410000
28545      EXEC SQL                                                     01420000
28545          INCLUDE TINCNTL                                          01430016
28545      END-EXEC.                                                    01440000
28545 *                                                                 01450000
      ***************************************************************** 01463000
      * DB2 INVENTORY PARAMETER TABLE DCLGEN                          * 01470000
      ***************************************************************** 01480000
           EXEC SQL                                                     01490000
                INCLUDE TINVPAR                                         01500000
           END-EXEC.                                                    01510000
      ***************************************************************** 01520000
      * DB2 SUMMARY INVENTORY TABLE DCLGEN                            * 01530000
      ***************************************************************** 01540000
           EXEC SQL                                                     01550000
                INCLUDE TSUMINV                                         01560000
           END-EXEC.                                                    01570000
      ***************************************************************** 01580000
      * DB2 STOCKROOM ADJUSTMENTS TABLE DCLGEN                        * 01590000
      ***************************************************************** 01600000
           EXEC SQL                                                     01610000
                INCLUDE TSTKRMW                                         01620000
           END-EXEC.                                                    01630000
      ***************************************************************** 01640000
      * DB2 AJUSTMENT DETAIL TABLE DCLGEN                             * 01650000
      ***************************************************************** 01660000
           EXEC SQL                                                     01670000
                INCLUDE TADJDTL                                         01680000
           END-EXEC.                                                    01690000
      ***************************************************************** 01700000
      * DB2 AJUSTMENT ADD TABLE DCLGEN                                * 01710000
      ***************************************************************** 01720000
           EXEC SQL                                                     01730000
                INCLUDE TADJADD                                         01740000
           END-EXEC.                                                    01750000
                                                                        01760000
      ** DRIVER CURSOR                                                  01770000
      ***************************************************************** 01780000
                                                                        01790000
           EXEC SQL                                                     01800000
                DECLARE  DRIVER_CURSOR CURSOR FOR                       01810000
26600            SELECT  A.LOC_NBR                                      01820000
26600                   ,A.LOC_TYP_CDE                                  01830000
28545                   ,B.PLND_INV_DTE                                 01840000
W33304                  ,C.PLND_FIN_BKG_DTE                             01850001
W33304                  ,C.INV_ID                                       01860000
W33304                  ,B.FINCL_INV_STAT_CDE                           01870000
26600              FROM  XMT_LOC A                                      01880000
                        ,TINVPAR B                                      01890000
28545                   ,TINCNTL C                                      01900016
26600             WHERE  A.LOC_NBR        = B.LOC_NBR                   01910000
26600               AND  A.LOC_TYP_CDE   IN ('DC','DS','RV','CS','DA')  01920000
W33304              AND  B.LOC_INV_STAT_CDE = 'IN'                      01930000
26600               AND  B.ACTL_FIN_BK_DTE  = '9999-09-09'              01940000
W33304              AND  B.PLND_INV_DTE <= :DTATTR-FSCL-MN-END-DTE      01980000
28545               AND B.INV_ID = C.INV_ID                             01990000
28545               AND C.ACTV_IND = 'Y'                                02000000
W33304              AND B.FINCL_INV_STAT_CDE IN ('BK','BD')             02010000
W27710            FOR FETCH ONLY                                        02020000
W27710            WITH UR                                               02030000
           END-EXEC.                                                    02040000
                                                                        02050000
      ** DETAIL CURSOR                                                  02060000
      ***************************************************************** 02070000
                                                                        02080000
           EXEC SQL                                                     02090000
                DECLARE  DETAIL_CURSOR CURSOR FOR                       02100000
26600            SELECT  LOC_NBR                                        02110000
21732                   ,AREA_NBR                                       02120000
21732                   ,+0                                             02130000
                        ,SKU_NBR                                        02140000
                        ,DEPT_NBR                                       02150000
                        ,' '                                            02160000
                        ,INV_QTY                                        02170000
                        ,EXTD_AMT                                       02180000
                        ,INV_UNIT_PR_AMT                                02190000
21732                   ,DATE(CHG_TMST)                                 02200000
                        ,'SUMINV'                                       02210000
                   FROM  TSUMINV                                        02220000
26600             WHERE  LOC_NBR = :SUMINV-LOC-NBR                      02230000
                                                                        02240000
                  UNION  ALL                                            02250000
                                                                        02260000
26600            SELECT  LOC_NBR                                        02270000
21732                   ,+0                                             02280000
21732                   ,SHEET_NBR                                      02290000
                        ,SKU_NBR                                        02300000
                        ,+0                                             02310000
                        ,' '                                            02320000
                        ,INV_QTY                                        02330000
                        ,ITM_EXTD_AMT                                   02340000
                        ,ITM_UNIT_PR_AMT                                02350000
21732                   ,DATE(CHG_TMST)                                 02360000
                        ,'STKRMW'                                       02370000
                   FROM  TSTKRMW                                        02380000
26600             WHERE  LOC_NBR = :STKRMW-LOC-NBR                      02390000
                                                                        02400000
                  UNION  ALL                                            02410000
                                                                        02420000
26600            SELECT  LOC_NBR                                        02430000
21732                   ,AREA_NBR                                       02440000
21732                   ,+0                                             02450000
                        ,SKU_NBR                                        02460000
                        ,+0                                             02470000
                        ,ADJ_TYPE_CDE                                   02480000
                        ,ADJ_QTY                                        02490000
                        ,ADJ_EXTD_AMT                                   02500000
                        ,+0                                             02510000
21732                   ,DATE(CRE_TMST)                                 02520000
                        ,'ADJDTL'                                       02530000
                   FROM  TADJDTL                                        02540000
26600             WHERE  LOC_NBR = :ADJDTL-LOC-NBR                      02550000
                                                                        02560000
                  UNION  ALL                                            02570000
                                                                        02580000
26600            SELECT  LOC_NBR                                        02590000
21732                   ,AREA_NBR                                       02600000
21732                   ,+0                                             02610000
                        ,SKU_NBR                                        02620000
                        ,+0                                             02630000
                        ,' '                                            02640000
                        ,ADJ_QTY                                        02650000
                        ,ADJ_EXTD_AMT                                   02660000
                        ,+0                                             02670000
21732                   ,DATE(CHG_TMST)                                 02680000
                        ,'ADJADD'                                       02690000
                   FROM  TADJADD                                        02700000
26600             WHERE  LOC_NBR = :ADJADD-LOC-NBR                      02710000
                                                                        02720000
                  ORDER  BY LOC_NBR                                     02730000
                                                                        02740000
W27710         FOR FETCH ONLY                                           02750000
W27710         WITH UR                                                  02760000
W27710                                                                  02770000
           END-EXEC.                                                    02780000
                                                                        02790000
       LINKAGE SECTION.                                                 02800000
                                                                        02810000
       EJECT                                                            02820000
                                                                        02830000
       PROCEDURE DIVISION.                                              02840000
                                                                        02850000
      ******************************************************************02860000
      *                                                                *02870000
      *                  ***   MAIN PROCESSING   ***                   *02880000
      *                                                                *02890000
      *  PROGRAM LOGIC :                                               *02900000
      *                                                                *02910000
      *    - GET OPEN FICSAL MONTH DATE FROM TMLCNTL TABLE.            *02920000
      *    - GET FISCAL MONTH BEGIN DATE AND END DATE FROM TDTATTR     *02930000
      *      TABLE BY USING OPEN FISCAL MONTH DATE.                    *02940000
      *    - USING DRIVER CURSOR, GET ALL THE STORES WHOSE PLANNED     *02950000
      *      INVENTORY DATE IS BETWEEN FISCAL MONTH BEGIN DATE AND     *02960000
      *      FISCAL MONTH END DATE.                                    *02970000
      *    - USING DETAIL CURSOR, GET ALL THE SKU AND OTHER FIELDS FOR *02980000
      *      EACH STORE AND WRITE INTO THE FILE.  THE FIELDS ARE       *02990000
      *      RETRIEVED FROM TABLES TSUMINV, TSTKRMW, TADJDTL AND       *03000000
      *      TADJADD.                                                  *03010000
      *    - IF DEPARTMENT IS NOT PRESENT IN TABLE, THEN               *03020000
28545 *      COMMON PRICING ROUTINE (ATTRIBUTE LOOK UP) IS USED. IF    *03030000
      *      NOT FOUND, '????' IS MOVED INTO DEPARTMENT FIELD TO SHOW  *03040000
      *      THAT DEPARTMENT IS UNKNOWN.                               *03050000
      *                                                                *03060000
      ******************************************************************03070000
       A100-MAIN-MODULE.                                                03080000
                                                                        03090000
           PERFORM B100-HOUSEKEEPING.                                   03100000
                                                                        03110000
           PERFORM B200-GENERATE-TABLE                                  03120000
             UNTIL END-OF-DRIVER-CURSOR.                                03130000
                                                                        03140000
           PERFORM B400-EOJ.                                            03150000
                                                                        03160000
           STOP RUN.                                                    03170000
                                                                        03180000
      ******************************************************************03190000
      *  OPEN THE ADJ-PHY-INVFILE, GET FISCAL MONTH BEGIN DATE AND     *03200000
      *  FISCAL MONTH END DATE AND OPEN THE DRIVER CURSOR              *03210000
      ******************************************************************03220000
       B100-HOUSEKEEPING.                                               03230000
                                                                        03240000
           MOVE '*B100-HOUSEKEEPING           *' TO  PV-PARA.           03250000
                                                                        03260000
           OPEN OUTPUT ADJ-PHY-INV-FILE.                                03270000
                                                                        03280000
           PERFORM Z025-GET-OPEN-FSCL-MN.                               03290000
                                                                        03300000
           IF  NOT END-OF-DRIVER-CURSOR                                 03310000
               PERFORM Z050-GET-OPEN-DATE-ATTRIBUTES                    03320000
           END-IF.                                                      03330000
                                                                        03340000
           IF  NOT END-OF-DRIVER-CURSOR                                 03350000
               EXEC SQL                                                 03360000
                    OPEN DRIVER_CURSOR                                  03370000
               END-EXEC                                                 03380000
                                                                        03390000
               EVALUATE SQLCODE                                         03400000
                   WHEN +0                                              03410000
                        PERFORM Z100-FETCH-STORE                        03420000
                   WHEN +100                                            03430000
                        SET END-OF-DRIVER-CURSOR   TO TRUE              03440000
                   WHEN OTHER                                           03450000
                        MOVE 'B100-HOUSEKEEPING'   TO PV-PARA           03460000
                        MOVE 'OPEN DRIVER CURSOR'  TO                   03470000
                              PV-DB2-OPER-ATTEMPTED                     03480000
                        PERFORM Z900-SQL-ABEND                          03490000
               END-EVALUATE                                             03500000
           END-IF.                                                      03510000
                                                                        03520000
      ******************************************************************03530000
      *  OPEN AND CLOSE THE DETAIL CURSOR.  FETCH ALL THE ROWS FOR THE *03540000
      *  STORE.                                                        *03550000
      ******************************************************************03560000
       B200-GENERATE-TABLE.                                             03570000
                                                                        03580000
           MOVE '*B200-GENERATE-TABLE       *' TO PV-PARA.              03590000
           MOVE  PV-SKU                        TO PV-PREV-SKU.          03600000
                                                                        03610000
           EXEC SQL                                                     03620000
                OPEN DETAIL_CURSOR                                      03630000
           END-EXEC.                                                    03640000
                                                                        03650000
           EVALUATE SQLCODE                                             03660000
               WHEN +0                                                  03670000
                    SET BEG-OF-DETAIL-CURSOR   TO TRUE                  03680000
                    PERFORM Z200-FETCH-DETAIL                           03690000
                    UNTIL END-OF-DETAIL-CURSOR                          03700000
               WHEN OTHER                                               03710000
                    MOVE 'B200-GENERATE-TABLE' TO PV-PARA               03720000
                    MOVE 'OPEN DETAIL CURSOR'  TO                       03730000
                          PV-DB2-OPER-ATTEMPTED                         03740000
                    PERFORM Z900-SQL-ABEND                              03750000
           END-EVALUATE.                                                03760000
                                                                        03770000
           EXEC SQL                                                     03780000
                CLOSE DETAIL_CURSOR                                     03790000
           END-EXEC.                                                    03800000
                                                                        03810000
           EVALUATE SQLCODE                                             03820000
               WHEN +0                                                  03830000
                    SET END-OF-DETAIL-CURSOR   TO TRUE                  03840000
               WHEN OTHER                                               03850000
                    MOVE 'B200-GENERATE-TABLE' TO PV-PARA               03860000
                    MOVE 'CLOSE DETAIL CURSOR' TO                       03870000
                          PV-DB2-OPER-ATTEMPTED                         03880000
                    PERFORM Z900-SQL-ABEND                              03890000
           END-EVALUATE.                                                03900000
                                                                        03910000
           PERFORM Z100-FETCH-STORE.                                    03920000
                                                                        03930000
      ******************************************************************03940000
      *  WRITE THE RECORD INTO ADJ-PHY-INV-SUMMARY-REC FILE.           *03950000
      ******************************************************************03960000
       B300-WRITE-RECORDS.                                              03970000
                                                                        03980000
           MOVE '*B300-WRITE-RECORDS          *' TO PV-PARA             03990000
                                                                        04000000
26600      MOVE  PV-DB2-STORE-ZONED-NUM                                 04010000
26600                                 TO IN109-STORE-NBR.               04020000
21732      MOVE  PV-DB2-AREA-NBR      TO IN109-AREA-NBR.                04030000
21732      MOVE  PV-DB2-SHEET-NBR     TO IN109-SHEET-NBR.               04040000
           MOVE  PV-DB2-STORE-TYPE    TO IN109-STORE-TYPE.              04050000
           MOVE  PV-DB2-SKU           TO IN109-SKU.                     04060000
           MOVE  PV-DB2-ADJUST-TYPE   TO IN109-ADJUST-TYPE-CODE.        04070000
           MOVE  PV-DB2-INV-AMT       TO IN109-INV-QTY.                 04080000
           MOVE  PV-DB2-EXTD-AMT      TO IN109-EXTD-AMT.                04090000
           MOVE  PV-DB2-UNIT-PR-AMT   TO IN109-UNIT-PR-AMT.             04100000
21732      MOVE  PV-DB2-CRE-TMST-DATE TO IN109-CREATE-DATE.             04110000
           MOVE  PV-DB2-TABLE-NAME    TO IN109-TABLE-NAME.              04120000
                                                                        04130000
           IF  PV-DEPT = 0                                              04140000
               MOVE '????'            TO IN109-DEPT                     04141014
R03073         DISPLAY ' UNKNOWN DEPARTMENT FOR '                       04142014
26600          DISPLAY ' STORE      : ', PV-DB2-STORE-ZONED-NUM         04143014
21732                                                                   04144014
21732          MOVE  PV-DB2-AREA-NBR  TO DF-AREA-NBR                    04145014
21732          DISPLAY ' AREA NBR   : ', DF-AREA-NBR                    04146014
21732          MOVE  PV-DB2-SHEET-NBR TO DF-AREA-NBR                    04147014
21732          DISPLAY ' SHEET NBR  : ', DF-AREA-NBR                    04148014
21732                                                                   04149014
R03073         DISPLAY ' SKU        : ', PV-DB2-SKU                     04149114
R03073         MOVE  PV-DB2-INV-AMT   TO DF-QTY                         04149214
R03073         DISPLAY ' QTY        : ', DF-QTY                         04149314
R03073         MOVE  PV-DB2-EXTD-AMT  TO DF-EXT-AMT                     04149414
R03073         DISPLAY ' EXTD AMT   : ', DF-EXT-AMT                     04149514
R03073         MOVE  PV-DB2-UNIT-PR-AMT TO PF-UNIT-PR-AMT               04149614
R03073         DISPLAY ' UNIT PRICE : ', PF-UNIT-PR-AMT                 04149714
21732          DISPLAY ' CRE TMST   : ', PV-DB2-CRE-TMST-DATE           04149814
R03073         DISPLAY ' TABLE      : ', PV-DB2-TABLE-NAME              04149914
           ELSE                                                         04330000
               MOVE PV-DEPT           TO IN109-DEPT                     04340000
           END-IF.                                                      04350000
                                                                        04360000
           WRITE ADJ-PHY-INV-SUMMARY-REC                                04370000
            FROM IN109-PHY-IN-SUMMARY-RECORD.                           04380000
                                                                        04390000
      ******************************************************************04400000
      *  CLOSE DRIVER CURSOR AND ADJ-PHY-INV-FILE FILE.                *04410000
      ******************************************************************04420000
       B400-EOJ.                                                        04430000
                                                                        04440000
           EXEC SQL                                                     04450000
                CLOSE DRIVER_CURSOR                                     04460000
           END-EXEC.                                                    04470000
                                                                        04480000
           EVALUATE SQLCODE                                             04490000
               WHEN +0                                                  04500000
W33304         WHEN -501                                                04501018
                    CONTINUE                                            04510000
               WHEN OTHER                                               04520000
                    MOVE 'B400-EOJ           ' TO PV-PARA               04530000
                    MOVE 'CLOSE DRIVER CURSOR' TO                       04540000
                          PV-DB2-OPER-ATTEMPTED                         04550000
                    PERFORM Z900-SQL-ABEND                              04560000
           END-EVALUATE.                                                04570000
                                                                        04580000
           CLOSE ADJ-PHY-INV-FILE.                                      04590000
                                                                        04600000
      ******************************************************************04610000
      *  GET THE OPEN FISCAL MONTH AND THE OPEN FISCAL MONTH NUMBER    *04620000
      *  FROM TMLCNTL TABLE.                                           *04630000
      ******************************************************************04640000
       Z025-GET-OPEN-FSCL-MN.                                           04650000
                                                                        04660000
           MOVE '*Z025-GET-OPEN-FSCL-MN.      *' TO PV-PARA             04670000
                                                                        04680000
           EXEC SQL                                                     04690000
W33304          SELECT  MAX(OPN_FSCL_MN_DTE)                            04700000
W33304            INTO  :INCNTL-OPN-FSCL-MN-DTE :PV-NULL                04710017
W33304            FROM  TINCNTL                                         04720016
W33304           WHERE  ACTV_IND = 'Y'                                  04730000
W27710           WITH UR                                                04740000
           END-EXEC.                                                    04750000
                                                                        04760000
           EVALUATE SQLCODE                                             04770000
               WHEN +0                                                  04780000
W33304         DISPLAY 'INCNTL-OPN-FSCL-MN-DTE ', INCNTL-OPN-FSCL-MN-DTE04790013
W33304         IF PV-NULL = -1                                          04791017
W33304              SET END-OF-DRIVER-CURSOR   TO TRUE                  04792017
W33304         END-IF                                                   04793017
               WHEN +100                                                04800000
                    SET END-OF-DRIVER-CURSOR   TO TRUE                  04810000
               WHEN OTHER                                               04820000
                    MOVE 'Z025-GET-OPEN-FSCL-MN'                        04830000
                                               TO PV-PARA               04840000
W33304              MOVE 'SELECT ROW FROM TINCNTL'                      04850013
                                               TO PV-DB2-OPER-ATTEMPTED 04860000
                    PERFORM Z900-SQL-ABEND                              04870000
           END-EVALUATE.                                                04880000
                                                                        04890000
      ******************************************************************04900000
      *  GET THE FISCAL MONTH BEGIN DATE AND FISCAL MONTH END DATE     *04910000
      *  FROM TDTATTR TABLE.                                           *04920000
      ******************************************************************04930000
       Z050-GET-OPEN-DATE-ATTRIBUTES.                                   04940000
                                                                        04950000
           MOVE '*Z050-GET-OPEN-DATE-ATTRIBUTES.   *' TO PV-PARA        04960000
                                                                        04970000
           EXEC SQL                                                     04980000
W33304          SELECT FSCL_MN_END_DTE                                  04990000
W33304            INTO :DTATTR-FSCL-MN-END-DTE                          05000008
W33304            FROM  TDTATTR                                         05010000
W33304           WHERE  KY_DTE = :INCNTL-OPN-FSCL-MN-DTE                05020000
W27710           WITH UR                                                05030000
           END-EXEC                                                     05040000
                                                                        05050000
           EVALUATE SQLCODE                                             05060000
               WHEN +0                                                  05070000
                    DISPLAY 'DTATTR-FSCL-MN-END-DTE ',                  05100000
                             DTATTR-FSCL-MN-END-DTE                     05110000
               WHEN +100                                                05120000
                    SET END-OF-DRIVER-CURSOR   TO TRUE                  05130000
               WHEN OTHER                                               05140000
                    MOVE 'Z050-GET-OPEN-DATE-ATTRIBUTES'                05150000
                                               TO PV-PARA               05160000
                    MOVE 'SELECT ROW FROM TDTATTR'                      05170000
                                               TO PV-DB2-OPER-ATTEMPTED 05180000
                    PERFORM Z900-SQL-ABEND                              05190000
           END-EVALUATE.                                                05200000
                                                                        05210000
      ******************************************************************05220000
      *  FETCH THE STORE FOR WHOSE PLANNED INVENTORY DATE IS BETWEEN   *05230000
      *  FISCAL MONTH BEGIN DATE AND FISCAL MONTH END DATE.            *05240000
      ******************************************************************05250000
       Z100-FETCH-STORE.                                                05260000
                                                                        05270000
           MOVE  '*Z100-FETCH-STORE         *' TO PV-PARA.              05280000
                                                                        05290000
           EXEC SQL                                                     05300000
                FETCH  DRIVER_CURSOR                                    05310000
                 INTO  :PV-DB2-STORE                                    05320000
                      ,:PV-DB2-STORE-TYPE                               05330000
                      ,:INVPAR-PLND-INV-DTE                             05340000
W33304                ,:IN109-PLND-FIN-BK-DTE                           05350000
W33304                ,:IN109-INV-ID                                    05360000
W33304                ,:IN109-FINCL-INV-STAT-CDE                        05370000
           END-EXEC.                                                    05380000
                                                                        05390000
           EVALUATE SQLCODE                                             05400000
               WHEN +0                                                  05410000
26600               MOVE  PV-DB2-STORE         TO SUMINV-LOC-NBR        05420000
                                                  STKRMW-LOC-NBR        05430000
                                                  ADJDTL-LOC-NBR        05440000
                                                  ADJADD-LOC-NBR        05450000
26600                                             PV-DB2-STORE-ZONED-NUM05460000
26600               MOVE  PV-DB2-STORE-ZONED-NUM                        05470000
26600                                          TO IN109-STORE-NBR       05480000
                    MOVE  PV-DB2-STORE-TYPE    TO IN109-STORE-TYPE      05490000
               WHEN +100                                                05500000
                    SET END-OF-DRIVER-CURSOR   TO TRUE                  05510000
               WHEN OTHER                                               05520000
                    MOVE '*Z100-FETCH STORE *' TO PV-PARA               05530000
                    MOVE 'FETCH ROW FROM DRIVER CURSOR'                 05540000
                                               TO PV-DB2-OPER-ATTEMPTED 05550000
                    PERFORM Z900-SQL-ABEND                              05560000
           END-EVALUATE.                                                05570000
                                                                        05580000
      ******************************************************************05590000
      *  FETCH THE FIELDS FOR THE DETAIL CURSOR. IF DEPARTMENT IS ZERO *05600000
      *  TSKXREF OR TUPC/TMDARVS TABLES ARE SEARCHED TO GET DEPARTMENT.*05610000
      ******************************************************************05620000
       Z200-FETCH-DETAIL.                                               05630000
                                                                        05640000
           MOVE  '*Z200-FETCH-DETAIL           *' TO PV-PARA.           05650000
           MOVE  PV-SKU                           TO PV-PREV-SKU.       05660000
           MOVE  PV-DEPT                          TO PV-PREV-DEPT.      05670000
                                                                        05680000
           INITIALIZE PV-DB2-STORE,                                     05690000
21732                 PV-DB2-AREA-NBR,                                  05700000
21732                 PV-DB2-SHEET-NBR,                                 05710000
                      PV-DB2-SKU,                                       05720000
                      PV-DB2-DEPT,                                      05730000
                      PV-DB2-ADJUST-TYPE,                               05740000
                      PV-DB2-INV-AMT,                                   05750000
                      PV-DB2-EXTD-AMT,                                  05760000
21732                 PV-DB2-CRE-TMST-DATE,                             05770000
                      PV-DB2-TABLE-NAME.                                05780000
                                                                        05790000
           EXEC SQL                                                     05800000
                FETCH  DETAIL_CURSOR                                    05810000
                 INTO  :PV-DB2-STORE                                    05820000
21732                 ,:PV-DB2-AREA-NBR                                 05830000
21732                 ,:PV-DB2-SHEET-NBR                                05840000
                      ,:PV-DB2-SKU                                      05850000
                      ,:PV-DB2-DEPT                                     05860000
                      ,:PV-DB2-ADJUST-TYPE                              05870000
                      ,:PV-DB2-INV-AMT                                  05880000
                      ,:PV-DB2-EXTD-AMT                                 05890000
                      ,:PV-DB2-UNIT-PR-AMT                              05900000
21732                 ,:PV-DB2-CRE-TMST-DATE                            05910000
                      ,:PV-DB2-TABLE-NAME                               05920000
           END-EXEC.                                                    05930000
                                                                        05940000
           EVALUATE SQLCODE                                             05950000
               WHEN +0                                                  05960000
26600               MOVE PV-DB2-STORE          TO PV-DB2-STORE-ZONED-NUM05970000
                    MOVE PV-DB2-SKU            TO PV-SKU,               05980000
                                                  IN109-SKU             05990000
                    MOVE PV-DB2-DEPT           TO PV-DEPT               06000000
                    IF  PV-DEPT = 0                                     06010000
                        IF  PV-SKU NOT EQUAL       TO PV-PREV-SKU       06020000
                            IF  PV-SKU-SEQ = 000                        06030000
                            OR  PV-SKU-SEQ = 999                        06040000
                                MOVE  PV-SKU-DEPT  TO PV-DEPT           06050000
                            ELSE                                        06060000
                                PERFORM Z300-GET-DEPT                   06070000
                            END-IF                                      06080000
                        ELSE                                            06090000
                            MOVE  PV-PREV-DEPT     TO PV-DEPT           06100000
                        END-IF                                          06110000
                    END-IF                                              06120000
                    PERFORM B300-WRITE-RECORDS                          06130000
               WHEN +100                                                06140000
                    SET END-OF-DETAIL-CURSOR   TO TRUE                  06150000
               WHEN OTHER                                               06160000
                    MOVE '*Z200-FETCH-DETAIL*' TO PV-PARA               06170000
                    MOVE 'FETCH ROW FROM DETAIL CURSOR'                 06180000
                                               TO PV-DB2-OPER-ATTEMPTED 06190000
                    PERFORM Z900-SQL-ABEND                              06200000
           END-EVALUATE.                                                06210000
                                                                        06220000
      ******************************************************************06230000
      *  GET THE DEPARTMENT NUMBER FROM TSKXREF TABLE BY GIVING SKU.   *06240000
      *  IF  ROW DOES NOT EXIST IN TSKXREF, TUPC/TMDARVS TABLES ARE    *06250000
      *  SEARCHED TO GET DEPARTMENT.                                   *06260000
      ******************************************************************06270000
       Z300-GET-DEPT.                                                   06280000
P28545                                                                  06290000
P28545     INITIALIZE IN400-PV-INPUT-AREA.                              06300000
P28545                                                                  06310000
P28545     SET IN400-PV-SKU-ATTRIB-LOOK TO TRUE.                        06320000
P28545     MOVE PV-DB2-STORE        TO IN400-PV-LOC-IN.                 06330000
P28545     MOVE INVPAR-PLND-INV-DTE TO IN400-PV-EFF-DTE-IN.             06340000
P28545     MOVE PV-DB2-SKU          TO IN400-PV-SKU-IN.                 06350000
P28545                                                                  06360000
P28545     PERFORM IN400-LOOKUP-RETAIL.                                 06370000
P28545                                                                  06380000
P28545     IF IN400-PV-ATT-FOUND                                        06390000
P28545         MOVE IN400-ATT-DEPT-OUT TO PV-DEPT                       06400000
P28545                                    PV-DB2-DEPT                   06410000
P28545     ELSE                                                         06420000
P28545         MOVE 0                 TO PV-DEPT                        06430000
P28545     END-IF.                                                      06440000
                                                                        06450000
      ******************************************************************06460000
      *  STANDARD DB2 ERROR ABEND ROUTINE                              *06470000
      *  THIS ROUTINE FORCES AN ABEND DUE TO A DB2 PROBLEM.            *06480000
      ******************************************************************06490000
       Z900-SQL-ABEND.                                                  06500000
                                                                        06510000
           MOVE +4013                 TO ABEND-CODE.                    06520000
           DISPLAY '**  ABEND     **'.                                  06530000
           DISPLAY '**  PROGRAM   **  =  INKUT109'.                     06540000
           DISPLAY '**  PARAGRAPH **  = ' PV-PARA.                      06550000
           DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.        06560000
                                                                        06570000
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         06580000
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        06590000
                                                                        06600000
           COPY DPPD004.                                                06610000
                                                                        06620000
           CALL 'ILBOABN0'  USING ABEND-CODE.                           06630000
W28545/                                                                 06640000
W28545*----------------------------------------------------------------*06650000
W28545*    PRICE LOOK-UP PROCEDURE DIVISION COPYBOOK                    06660000
W28545*----------------------------------------------------------------*06670000
W28545                                                                  06680000
W28545     COPY INPD400.                                                06690000
