000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400                                                                  00040001
000500 PROGRAM-ID.    RVKUT006.                                         00050001
000600 AUTHOR.        MICHAEL WALTERS.                                  00060001
000700 INSTALLATION.  KOHLS.                                            00070001
000800 DATE-WRITTEN   AUGUST, 1997.                                     00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100******************************************************************00110001
001200*  THIS PROGRAM CREATES THE RETURN EXTRACT FILE FOR THE QUARTERLY 00120001
001300*  VENDOR RETURN AGREEMENT BY TYPE REPORT.                        00130001
001400******************************************************************00140001
001500                                                                  00150001
001600******************************************************************00160001
001700 ENVIRONMENT DIVISION.                                            00170001
001800******************************************************************00180001
001900                                                                  00190001
002000 CONFIGURATION SECTION.                                           00200001
002100                                                                  00210001
002200 SOURCE-COMPUTER.        IBM-3090.                                00220001
002300 OBJECT-COMPUTER.        IBM-3090.                                00230001
002400                                                                  00240001
002500 INPUT-OUTPUT SECTION.                                            00250001
002600                                                                  00260001
002700 FILE-CONTROL.                                                    00270001
002800                                                                  00280001
002900     SELECT RTV-REPORT-EXTRACT                                    00290001
003000         ASSIGN TO OUT01.                                         00300001
003100                                                                  00310001
003200******************************************************************00320001
003300 DATA DIVISION.                                                   00330001
003400******************************************************************00340001
003500                                                                  00350001
003600 FILE SECTION.                                                    00360001
003700                                                                  00370001
003800 FD  RTV-REPORT-EXTRACT                                           00380001
003900     RECORDING MODE IS F                                          00390001
004000     LABEL RECORDS ARE STANDARD                                   00400001
004100     BLOCK CONTAINS 0 RECORDS.                                    00410001
004200                                                                  00420001
004300 01  RTV-REPORT-EXTRACT-RECORD       PIC  X(300).                 00430001
004400                                                                  00440001
004500*                                                                 00450001
004600*                                                                 00460001
004700******************************************************************00470001
004800 WORKING-STORAGE SECTION.                                         00480001
004900******************************************************************00490001
005000*                                                                 00500001
005100*                                                                 00510001
005200******************************************************************00520001
005300*  DB2 FORMATTED MESSAGE AREA                                     00530001
005400******************************************************************00540001
005500     COPY DPWS004.                                                00550001
005600*                                                                 00560001
005700*                                                                 00570001
005800******************************************************************00580001
005900*  RTV REPORT EXTRACT RECORD LAYOUT                               00590001
006000******************************************************************00600001
006100     COPY RVRD003.                                                00610001
006200*                                                                 00620001
006300*                                                                 00630001
007000******************************************************************00640001
007100*  WORK AREA FOR MBS INFORMATION ROUTINE.                         00650001
007200******************************************************************00660001
007300     COPY DPWS003.                                                00670001
007400*                                                                 00680001
007500*                                                                 00690001
007600******************************************************************00700001
007700*  COMMUNICATIONS AREA FOR DB2                                    00710001
007800******************************************************************00720001
007900     EXEC SQL                                                     00730001
008000          INCLUDE SQLCA                                           00740001
008100     END-EXEC.                                                    00750001
008200*                                                                 00760001
008300*                                                                 00770001
008400******************************************************************00780001
008500*  DB2 TABLE DECLARATION - VENDOR AGREEMENT TABLE (TVNDAGR)       00790001
008600******************************************************************00800001
008700     EXEC SQL                                                     00810001
008800          INCLUDE TVNDAGR                                         00820001
008900     END-EXEC.                                                    00830001
009000                                                                  00840001
009100*                                                                 00850001
009200*                                                                 00860001
008400******************************************************************00870001
008500*  DB2 TABLE DECLARATION - VENDOR DEPARTMENT TABLE (TVNDDPT)      00880001
008600******************************************************************00890001
008700     EXEC SQL                                                     00900001
008800          INCLUDE TVNDDPT                                         00910001
008900     END-EXEC.                                                    00920001
009000                                                                  00921001
009100*                                                                 00922001
009200*                                                                 00923001
009300******************************************************************00924001
009400*  DB2 TABLE DECLARATION - LOGISTICS USER TABLE (XLT_USR)         00925001
009500******************************************************************00926001
009600     EXEC SQL                                                     00927001
009700          INCLUDE XLT00024                                        00928001
009800     END-EXEC.                                                    00929001
009900                                                                  00930001
010000*                                                                 00940001
010100******************************************************************00950001
010200*  DB2 TABLE DECLARATION - EXTERNAL ENTERPRISE TABLE (TEXTENT)    00960001
010300******************************************************************00970001
010400     EXEC SQL                                                     00980001
010500          INCLUDE TEXTENT                                         00990001
010600     END-EXEC.                                                    01000001
010700                                                                  01010001
010800*                                                                 01020001
010900*                                                                 01030001
011000******************************************************************01040001
011100*  DB2 TABLE DECLARATION - EXT ENTERPRISE NAME TABLE (TENTNME)    01050001
011200******************************************************************01060001
011300     EXEC SQL                                                     01070001
011400          INCLUDE TENTNME                                         01080001
011500     END-EXEC.                                                    01090001
011600                                                                  01100001
011700                                                                  01110001
011800 01  ABEND-CODE                      PIC S9(04)    VALUE +0       01120001
011900                                                   COMP SYNC.     01130001
012000*                                                                 01140001
012100                                                                  01150001
012200                                                                  01160001
012300 01  PS-PROGRAM-SWITCHES.                                         01170001
012400     05  PS-EOC-DRIVER-CURSOR-SW     PIC  X(01)    VALUE 'N'.     01180001
012500         88  PS-EOC-DRIVER-CURSOR                  VALUE 'Y'.     01190001
012600         88  PS-NOT-EOC-DRIVER-CURSOR              VALUE 'N'.     01200001
012700     05  PS-EOC-DC-CURSOR-SW         PIC  X(01)    VALUE 'N'.     01210001
012800         88  PS-EOC-DC-CURSOR                      VALUE 'Y'.     01220001
012900         88  PS-NOT-EOC-DC-CURSOR                  VALUE 'N'.     01230001
013000                                                                  01240001
013100 01  PC-PROGRAM-CONSTANTS.                                        01250001
013200     05  PC-SYSTEM-CD                PIC  X(02)    VALUE 'RV'.    01260001
013300     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          01270001
013400         'RVKUT006'.                                              01280001
013500     05  PC-PGM-DPKUT039             PIC  X(08)    VALUE          01290001
013600         'DPKUT039'.                                              01300001
013700     05  PC-MBS-PGM                  PIC  X(08)    VALUE          01310001
013800         'DPKUT039'.                                              01320001
014000     05  PC-NO-VNDR-NAME-FOUND       PIC  X(25)    VALUE          01330001
014100         '* NO VENDOR NAME FOUND * '.                             01340001
014200     05  PC-NO-BUYER-NAME-FOUND      PIC  X(32)    VALUE          01350001
014300         '** BUYER NAME NOT FOUND **      '.                      01360001
014400     05  PC-NOT-FOUND-MESSAGE        PIC  X(10)    VALUE          01370001
014500         'NOT FOUND'.                                             01380001
014600     05  PC-MAX-RETRIES              PIC S9(04)    VALUE +3       01390001
014700                                                   COMP SYNC.     01400001
014800*                                                                 01410001
014900*                                                                 01420001
015000 01  PV-PROGRAM-VARIABLES.                                        01430001
015100     05  PV-BEGIN-DATE                   PIC  X(10)  VALUE SPACE. 01440001
015200     05  PV-BEGIN-FISCAL-DATE.                                    01450001
015300         10  PV-BEGIN-FISCAL-YEAR        PIC  9(02)  VALUE 0.     01460001
015400         10  PV-BEGIN-FISCAL-MONTH       PIC  9(02)  VALUE 0.     01470001
015500     05  PV-END-DATE                     PIC  X(10)  VALUE SPACE. 01480001
015600     05  PV-END-FISCAL-DATE.                                      01490001
015700         10  PV-END-FISCAL-YEAR          PIC  9(02)  VALUE 0.     01500001
015800         10  PV-END-FISCAL-MONTH         PIC  9(02)  VALUE 0.     01510001
015900                                                                  01520001
016000     05  PV-CURRENT-DATE                 PIC  X(10).              01530001
016100     05  PV-CURRENT-DATE-RFMT REDEFINES PV-CURRENT-DATE.          01540001
016200         10 PV-CURRENT-DATE-CC           PIC  X(2).               01550001
016300         10 PV-CURRENT-DATE-YY           PIC  X(2).               01560001
016400         10 FILLER                       PIC  X.                  01570001
016500         10 PV-CURRENT-DATE-MM           PIC  X(2).               01580001
016600         10 FILLER                       PIC  X.                  01590001
016700         10 PV-CURRENT-DATE-DD           PIC  X(2).               01600001
016800     05  PV-WORK-DATE.                                            01610001
016900         10 PV-WORK-DATE-YY              PIC  X(2)  VALUE SPACES. 01620001
017000         10 PV-WORK-DATE-MM              PIC  X(2)  VALUE SPACES. 01630001
017100         10 PV-WORK-DATE-DD              PIC  X(2)  VALUE SPACES. 01640001
017200     05  PV-DB2-WORK-DATE.                                        01650001
017300         10 PV-DB2-CC                    PIC  9(2).               01660001
017400         10 PV-DB2-YY                    PIC  9(2).               01670001
017500         10 FILLER                       PIC  X.                  01680001
017600         10 PV-DB2-MM                    PIC  9(2).               01690001
017700         10 FILLER                       PIC  X.                  01700001
017800         10 PV-DB2-DD                    PIC  9(2).               01710001
017900     05  PV-HOLD-DPT-NBR                 PIC  X(03).              01720001
018000     05  PV-PREV-DAYS                    PIC  9(03).              01730001
018100     05  PV-SAVE-DPT-DESCRIPTION         PIC  X(25).              01740001
018200     05  PV-SAVE-DMM-NAME                PIC  X(32).              01750001
018300     05  PV-SAVE-DMM-NMBR                PIC  X(02).              01760001
018400     05  PV-SAVE-GMM-NAME                PIC  X(32).              01770001
018500     05  PV-SAVE-GMM-NMBR                PIC  X(02).              01780001
018600     05  PV-SAVE-BYR-NAME                PIC  X(32).              01790001
018700     05  PV-SAVE-BYR-NMBR                PIC  X(03).              01800001
018800     05  PV-MBS-DISPLAY.                                          01810001
018900         10 FILLER                       PIC  X(29)               01820001
019000             VALUE '** ERROR CALLING MBS ROUTINE '.               01830001
019100         10 PV-MBS-CALL                  PIC  X(20).              01840001
018800     05  PV-RECS-WRITTEN                 PIC S9(09) VALUE +0.     01850001
018800     05  PV-RECS-WRITTEN-DISPLAY         PIC ZZZZZZZZ9.           01860001
019200*                                                                 01870001
020300*                                                                 01880001
020400 01  CC-CONTROL-CARD.                                             01890001
020500     05  CC-BEGIN-DATE                   PIC  X(10)  VALUE SPACE. 01900001
020600         88  CC-DEFAULT-BEGIN-DATE       VALUE 'DEFAULT   '.      01910001
020700     05  CC-END-DATE                     PIC  X(10)  VALUE SPACE. 01920001
020800         88  CC-DEFAULT-END-DATE         VALUE 'DEFAULT   '.      01930001
020900     05  CC-RPT-TYPE                     PIC  X(01)  VALUE SPACE. 01940001
021000         88  CC-VALID-RPT-TYPE           VALUE 'Q', 'R'.          01950001
021100         88  CC-REQUEST-REPORT           VALUE 'R'.               01960001
021200         88  CC-QUARTERLY-REPLORT        VALUE 'Q'.               01970001
021300                                                                  01980001
021400***************************************************************** 01990001
021500*                                                               * 02000001
021600*  CURSOR DECLARATION TO GET ALL THE CURRENT RTV VENDOR         * 02010001
021700*  AGREEMENTS                                                   * 02020001
021800*                                                               * 02030001
021900***************************************************************** 02040001
022000                                                                  02050001
022100     EXEC SQL                                                     02060001
022200        DECLARE AGREE_CURSOR CURSOR FOR                           02070001
022300        SELECT                                                    02080001
022400               A.ENT_ID                                           02090001
022500              ,A.DEPT_NBR                                         02100001
022600              ,A.RTV_RA_REQD_IND                                  02110001
022700              ,A.RTV_NO_RA_REQD_IND                               02120001
022800              ,A.DEBIT_DESTROY_IND                                02130001
022900              ,A.MARKOUT_IND                                      02140001
023000              ,A.LAST_UPD_TMST                                    02150001
023100              ,A.LAST_UPD_ID                                      02160001
023101              ,E.VND_DEPT_STAT_CD                                 02170001
023200              ,B.CFY_SLSRNK_NBR                                   02180001
023300              ,C.ENT_NAME_DESC                                    02190001
023400              ,D.USR_LAST_NM                                      02200001
023500              ,D.USR_FRST_NM                                      02210001
023600         FROM TVNDAGR A                                           02220001
023700            , TEXTENT B                                           02230001
023800            , TENTNME C                                           02240001
023900            , XLT_USR D                                           02250001
023901            , TVNDDPT E                                           02260001
024000        WHERE                                                     02270001
024100              A.EFFECTIVE_DATE  <= CURRENT DATE                   02280001
024200          AND A.EXPIRATION_DATE >  CURRENT DATE                   02290001
024300          AND A.ENT_ID           = B.ENT_ID                       02300001
024400          AND A.ENT_ID           = C.ENT_ID                       02310001
024401          AND A.ENT_ID           = E.ENT_ID                       02320001
024401          AND A.DEPT_NBR         = E.DEPT_NBR                     02330001
024500          AND C.TYPE_CDE         = '01'                           02340001
024600          AND A.AGRMT_TYP_ID     = '3'                            02350001
024700          AND B.MDSE_VENDOR_IND  = 'Y'                            02360001
024800          AND B.STATUS_CDE = 'A'                                  02370001
024900          AND A.LAST_UPD_ID      = D.USR_ID                       02380001
024900          AND E.VND_DEPT_STAT_CD <> 'I'                           02390001
025000      ORDER BY A.DEPT_NBR                                         02400001
025100     END-EXEC.                                                    02410001
025200*                                                                 02420001
025300******************************************************************02430001
025400 LINKAGE SECTION.                                                 02440001
025500******************************************************************02450001
025600                                                                  02460001
025700******************************************************************02470001
025800 PROCEDURE DIVISION.                                              02480001
025900******************************************************************02490001
026000                                                                  02500001
026100******************************************************************02510001
026200*  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM    02520001
026300******************************************************************02530001
026400 0000-PROGRAM-MAINLINE.                                           02540001
026500                                                                  02550001
026600     PERFORM 1000-INITIALIZE.                                     02560001
026700                                                                  02570001
026800     PERFORM 2000-CREATE-EXTRACT-FILE                             02580001
026900         UNTIL PS-EOC-DRIVER-CURSOR                               02590001
027000                                                                  02600001
027100     PERFORM 9000-EOJ-ROUTINE.                                    02610001
027200     STOP RUN.                                                    02620001
027300*0000-EXIT.                                                       02630001
027400                                                                  02640001
027500******************************************************************02650001
027600*  1000-INITIALIZE -  OPENS ALL THE REPORT FILE, ACCEPTS, EDITS,  02660001
027700*  AND DISPLAYS CONTROL CARD INFORMATION, OPENS AND FETCHES FIRST 02670001
027800*  OCCURANCE OF DB2 CURSOR, PRINTS INITIAL PAGE HEADING TO REPORT 02680001
027900*  FILE.                                                          02690001
028000******************************************************************02700001
028100 1000-INITIALIZE.                                                 02710001
028200                                                                  02720001
028300                                                                  02730001
028400     INITIALIZE RV003-EXTRACT-RECORD.                             02740001
028500                                                                  02750001
028600     OPEN OUTPUT RTV-REPORT-EXTRACT.                              02760001
028700                                                                  02770001
028800*    ACCEPT CC-CONTROL-CARD FROM SYSIN.                           02780001
028900*    DISPLAY 'CONTROL CARD = ' CC-CONTROL-CARD.                   02790001
029000*                                                                 02800001
029100     EXEC SQL                                                     02810001
029200         SET :PV-CURRENT-DATE = CURRENT DATE                      02820001
029300     END-EXEC                                                     02830001
029400                                                                  02840001
029500     IF SQLCODE = 0                                               02850001
029600         CONTINUE                                                 02860001
029700     ELSE                                                         02870001
029800         DISPLAY '** ABEND **'                                    02880001
029900         DISPLAY '** PROGRAM = RVKUT006 **'                       02890001
030000         DISPLAY '** PARAGRAPH = 1000-INITIALIZE **'              02900001
030100         DISPLAY '** ERROR SETTING CURRENT DATE **'               02910001
030200         PERFORM 9100-SQL-ABEND                                   02920001
030300     END-IF.                                                      02930001
030400                                                                  02940001
030500     SET PS-NOT-EOC-DRIVER-CURSOR    TO TRUE.                     02950001
030600                                                                  02960001
030700     PERFORM 7000-OPEN-DRIVER-CURSOR.                             02970001
030800                                                                  02980001
030900     PERFORM 7200-FETCH-DRIVER-CURSOR.                            02990001
031000                                                                  03000001
031100                                                                  03010001
031200******************************************************************03020001
031300* 2000-CREATE-EXTRACT-FILE                                        03030001
031400* PROCESS:  THIS PARAGRAPH WILL SET UP AND WRITE EXTRACT RECORDS  03040001
031500******************************************************************03050001
031600 2000-CREATE-EXTRACT-FILE.                                        03060001
031700                                                                  03070001
031800     INITIALIZE RV003-EXTRACT-RECORD                              03080001
031900                                                                  03090001
032000*    FOR EACH DEPARTMENT, CALL THE MBS TABLES TO GET THE DEPT, BUY03100001
032100*    DMM AND GMM NAMES                                            03110001
032200     IF VNDAGR-DEPT-NBR = PV-HOLD-DPT-NBR                         03120001
032300         CONTINUE                                                 03130001
032400     ELSE                                                         03140001
032500         MOVE VNDAGR-DEPT-NBR TO PV-HOLD-DPT-NBR                  03150001
032600         PERFORM 2100-GET-MBS-INFORMATION                         03160001
032700     END-IF.                                                      03170001
032800                                                                  03180001
032900*    MOVE ALL DATA TO THE OUTPUT FIELDS                           03190001
033000     MOVE VNDAGR-ENT-ID              TO RV003-ENT-ID              03200001
033100     MOVE VNDAGR-DEPT-NBR            TO RV003-DEPT-NBR            03210001
033200     MOVE VNDAGR-RTV-RA-REQD-IND     TO RV003-DR-RA-IND           03220001
033300     MOVE VNDAGR-RTV-NO-RA-REQD-IND  TO RV003-DR-PERM-RA-IND      03230001
033400     MOVE VNDAGR-DEBIT-DESTROY-IND   TO RV003-DD-IND              03240001
033500     MOVE VNDAGR-MARKOUT-IND         TO RV003-MOS-IND             03250001
033600     MOVE VNDAGR-LAST-UPD-TMST       TO RV003-LAST-UPDT-TMST      03260001
033700     MOVE VNDAGR-LAST-UPD-ID         TO RV003-LAST-UPDT-ID        03270001
033800     MOVE EXTENT-CFY-SLSRNK-NBR      TO RV003-VND-RANK            03280001
033900     MOVE ENTNME-ENT-NAME-DESC       TO RV003-VND-NAME            03290001
034000     STRING XLT00024-USR-LAST-NM     DELIMITED BY '  '            03300001
034100            ', '                     DELIMITED BY SIZE            03310001
034200            XLT00024-USR-FRST-NM     DELIMITED BY '  '            03320001
034300                                   INTO RV003-LAST-UPDT-NAME      03330001
034400     MOVE PV-SAVE-DPT-DESCRIPTION    TO RV003-DEPT-DESC           03340001
034500     MOVE PV-SAVE-DMM-NAME           TO RV003-DMM-NAME            03350001
034600     MOVE PV-SAVE-DMM-NMBR           TO RV003-DMM-NBR             03360001
034700     MOVE PV-SAVE-GMM-NAME           TO RV003-GMM-NAME            03370001
034800     MOVE PV-SAVE-GMM-NMBR           TO RV003-GMM-NBR             03380001
034900     MOVE PV-SAVE-BYR-NAME           TO RV003-BUYER-NAME          03390001
035000     MOVE PV-SAVE-BYR-NMBR           TO RV003-BUYER-NBR           03400001
035100                                                                  03410001
035200     PERFORM 8000-WRITE-EXTRACT-RECORD.                           03420001
035300                                                                  03430001
035400     PERFORM 7200-FETCH-DRIVER-CURSOR.                            03440001
035500                                                                  03450001
035600                                                                  03460001
035700******************************************************************03470001
035800* 2100-CREATE-EXTRACT-FILE                                        03480001
035900* PROCESS:  THIS PARAGRAPH WILL SET UP AND WRITE EXTRACT RECORDS  03490001
036000******************************************************************03500001
036100 2100-GET-MBS-INFORMATION.                                        03510001
036200                                                                  03520001
036300*    CALL MBS TABLES TO GET DPT DESC                              03530001
036400     INITIALIZE DP003-MBS-SUBROUTINE-FIELDS.                      03540001
036500     SET DP003-DPT-LOOKUP TO TRUE.                                03550001
036600     PERFORM 2110-SETUP-COMMON-MBS-FIELDS.                        03560001
036700                                                                  03570001
036800     CALL PC-MBS-PGM USING DP003-MBS-SUBROUTINE-FIELDS.           03580001
036900                                                                  03590001
037000     EVALUATE TRUE                                                03600001
037100         WHEN DP003-SUCCESSFUL                                    03610001
037200             MOVE DP003-DPT-DESCRIPTION                           03620001
037300                                 TO PV-SAVE-DPT-DESCRIPTION       03630001
037400         WHEN DP003-DPT-NOT-FOUND                                 03640001
037500             MOVE '***  DEPARTMENT NOT FOUND ***'                 03650001
037600                                 TO PV-SAVE-DPT-DESCRIPTION       03660001
037700         WHEN OTHER                                               03670001
037800             MOVE 'DEPT LOOKUP'  TO PV-MBS-CALL                   03680001
037900             PERFORM 2120-MBS-ABEND                               03690001
038000     END-EVALUATE.                                                03700001
038100                                                                  03710001
038200*    CALL MBS TABLES TO GET BUYER NAME                            03720001
038300     INITIALIZE DP003-MBS-SUBROUTINE-FIELDS.                      03730001
038400     SET DP003-BYR-NAME-LAST-FIRST                                03740001
038500         DP003-BYR-LOOKUP-NAME  TO TRUE.                          03750001
038600     PERFORM 2110-SETUP-COMMON-MBS-FIELDS.                        03760001
038700                                                                  03770001
038800     CALL PC-MBS-PGM USING DP003-MBS-SUBROUTINE-FIELDS.           03780001
038900                                                                  03790001
039000     EVALUATE TRUE                                                03800001
039100         WHEN DP003-SUCCESSFUL                                    03810001
039200             MOVE DP003-BYR-NAME     TO PV-SAVE-BYR-NAME          03820001
039300             MOVE DP003-BYR-NMBR     TO PV-SAVE-BYR-NMBR          03830001
039400         WHEN DP003-BYR-NMBR-NOT-FOUND                            03840001
039500         WHEN DP003-BYR-NAME-NOT-FOUND                            03850001
039600             MOVE ' **  BUYER NOT FOUND      ***'                 03860001
039700                                     TO PV-SAVE-BYR-NAME          03870001
039800             MOVE HIGH-VALUES        TO PV-SAVE-BYR-NMBR          03880001
039900         WHEN OTHER                                               03890001
040000             MOVE 'BUYER LOOKUP' TO PV-MBS-CALL                   03900001
040100             PERFORM 2120-MBS-ABEND                               03910001
040200     END-EVALUATE.                                                03920001
040300                                                                  03930001
040400*    CALL MBS TABLES TO GET DMM NAME                              03940001
040500     INITIALIZE DP003-MBS-SUBROUTINE-FIELDS.                      03950001
040600     SET DP003-DMM-NAME-LAST-FIRST                                03960001
040700         DP003-DMM-LOOKUP-NAME  TO TRUE.                          03970001
040800     PERFORM 2110-SETUP-COMMON-MBS-FIELDS.                        03980001
040900                                                                  03990001
041000     CALL PC-MBS-PGM USING DP003-MBS-SUBROUTINE-FIELDS.           04000001
041100                                                                  04010001
041200     EVALUATE TRUE                                                04020001
041300         WHEN DP003-SUCCESSFUL                                    04030001
041400             MOVE DP003-DMM-NAME         TO PV-SAVE-DMM-NAME      04040001
041500             MOVE DP003-DMM-NMBR         TO PV-SAVE-DMM-NMBR      04050001
041600         WHEN DP003-DMM-NAME-NOT-FOUND                            04060001
041700         WHEN DP003-DMM-NMBR-NOT-FOUND                            04070001
041800             MOVE ' **  DMM NOT FOUND        ***'                 04080001
041900                                         TO PV-SAVE-DMM-NAME      04090001
042000             MOVE HIGH-VALUES            TO PV-SAVE-DMM-NMBR      04100001
042100         WHEN OTHER                                               04110001
042200             MOVE 'DMM LOOKUP'           TO PV-MBS-CALL           04120001
042300             PERFORM 2120-MBS-ABEND                               04130001
042400     END-EVALUATE.                                                04140001
042500                                                                  04150001
042600                                                                  04160001
042700*    CALL MBS TABLES TO GET GMM NAME                              04170001
042800     INITIALIZE DP003-MBS-SUBROUTINE-FIELDS.                      04180001
042900     SET DP003-GMM-NAME-LAST-FIRST                                04190001
043000         DP003-GMM-LOOKUP-NAME  TO TRUE.                          04200001
043100     PERFORM 2110-SETUP-COMMON-MBS-FIELDS.                        04210001
043200                                                                  04220001
043300     CALL PC-MBS-PGM USING DP003-MBS-SUBROUTINE-FIELDS.           04230001
043400                                                                  04240001
043500     EVALUATE TRUE                                                04250001
043600         WHEN DP003-SUCCESSFUL                                    04260001
043700             MOVE DP003-GMM-NAME         TO PV-SAVE-GMM-NAME      04270001
043800             MOVE DP003-GMM-NMBR         TO PV-SAVE-GMM-NMBR      04280001
043900         WHEN DP003-GMM-NAME-NOT-FOUND                            04290001
044000         WHEN DP003-GMM-NMBR-NOT-FOUND                            04300001
044100             MOVE ' **  GMM NOT FOUND        ***'                 04310001
044200                                         TO PV-SAVE-GMM-NAME      04320001
044300             MOVE HIGH-VALUES            TO PV-SAVE-GMM-NMBR      04330001
044400         WHEN OTHER                                               04340001
044500             MOVE 'GMM LOOKUP'           TO PV-MBS-CALL           04350001
044600             PERFORM 2120-MBS-ABEND                               04360001
044700     END-EVALUATE.                                                04370001
044800                                                                  04380001
044900                                                                  04390001
045000******************************************************************04400001
045100* 2110-SETUP-COMMON-MBS-FIELDS.                                  *04410001
045200******************************************************************04420001
045300 2110-SETUP-COMMON-MBS-FIELDS.                                    04430001
045400                                                                  04440001
045500     MOVE 'RV'                   TO DP003-SYSTEM-CODE.            04450001
045600     MOVE '03'                   TO DP003-OP-CO-NMBR.             04460001
045700                                                                  04470001
045800     MOVE PV-CURRENT-DATE-YY     TO PV-WORK-DATE-YY.              04480001
045900     MOVE PV-CURRENT-DATE-MM     TO PV-WORK-DATE-MM.              04490001
046000     MOVE PV-CURRENT-DATE-DD     TO PV-WORK-DATE-DD.              04500001
046100     MOVE PV-WORK-DATE           TO DP003-CURRENT-DATE            04510001
046200                                    DP003-EFF-DATE.               04520001
046300     MOVE PV-HOLD-DPT-NBR        TO DP003-DPT-INPUT.              04530001
046400                                                                  04540001
046500                                                                  04550001
046600******************************************************************04560001
046700* 2120-MBS-ABEND.                                                *04570001
046800******************************************************************04580001
046900 2120-MBS-ABEND.                                                  04590001
047000                                                                  04600001
047100     DISPLAY '** ABEND **'.                                       04610001
047200     DISPLAY '** PROGRAM = RVKUT006 **'.                          04620001
047300     DISPLAY '** PARAGRAPH = 2100-GET-MBS-INFORMATION**'.         04630001
047400     DISPLAY PV-MBS-DISPLAY.                                      04640001
047500     DISPLAY '** DP003-RETURN-DATA = ' DP003-RETURN-DATA.         04650001
047600     DISPLAY '**     DP003-SQLCODE = ' DP003-SQLCODE.             04660001
047700     IF DP003-SQLCODE = 0                                         04670001
047800         MOVE +4003 TO ABEND-CODE                                 04680001
047900         CALL 'ILBOABN0' USING ABEND-CODE                         04690001
048000     ELSE                                                         04700001
048100         MOVE DP003-SQLCA TO SQLCA                                04710001
048200         MOVE DP003-SQLCODE TO SQLCODE                            04720001
048300         PERFORM 9100-SQL-ABEND                                   04730001
048400     END-IF.                                                      04740001
048500                                                                  04750001
048600******************************************************************04760001
048700* 7000-OPEN-DRIVER-CURSOR.                                       *04770001
048800******************************************************************04780001
048900 7000-OPEN-DRIVER-CURSOR.                                         04790001
049000                                                                  04800001
049100     EXEC SQL                                                     04810001
049200          OPEN AGREE_CURSOR                                       04820001
049300     END-EXEC.                                                    04830001
049400                                                                  04840001
049500     EVALUATE TRUE                                                04850001
049600         WHEN SQLWARN0 NOT EQUAL SPACE                            04860001
049700         WHEN SQLCODE NOT EQUAL ZERO                              04870001
049800             DISPLAY '** ABEND **'                                04880001
049900             DISPLAY '** PROGRAM = RVKUT006 **'                   04890001
050000             DISPLAY '** PARAGRAPH = 7000-OPEN-DRIVER-CURSOR **'  04900001
050100             PERFORM 9100-SQL-ABEND                               04910001
050200     END-EVALUATE.                                                04920001
050300                                                                  04930001
050400*                                                                 04940001
050500******************************************************************04950001
050600* 7100-CLOSE-DRIVER-CURSOR.                                      *04960001
050700******************************************************************04970001
050800 7100-CLOSE-DRIVER-CURSOR.                                        04980001
050900                                                                  04990001
051000                                                                  05000001
051100     EXEC SQL                                                     05010001
051200         CLOSE AGREE_CURSOR                                       05020001
051300     END-EXEC.                                                    05030001
051400                                                                  05040001
051500     EVALUATE TRUE                                                05050001
051600         WHEN SQLWARN0 NOT EQUAL SPACE                            05060001
051700         WHEN SQLCODE NOT EQUAL ZERO                              05070001
051800             DISPLAY '** ABEND **'                                05080001
051900             DISPLAY '** PROGRAM = RVKUT006 **'                   05090001
052000             DISPLAY '** PARAGRAPH = 7100-CLOSE-DRIVER-CURSOR**'  05100001
052100             PERFORM 9100-SQL-ABEND                               05110001
052200     END-EVALUATE.                                                05120001
052300                                                                  05130001
052400*                                                                 05140001
052500******************************************************************05150001
052600* 7200-FETCH-DRIVER-CURSOR.                                      *05160001
052700******************************************************************05170001
052800 7200-FETCH-DRIVER-CURSOR.                                        05180001
052900                                                                  05190001
053000     EXEC SQL                                                     05200001
053100          FETCH AGREE_CURSOR                                      05210001
053200          INTO                                                    05220001
053300               :VNDAGR-ENT-ID                                     05230001
053400              ,:VNDAGR-DEPT-NBR                                   05240001
053500              ,:VNDAGR-RTV-RA-REQD-IND                            05250001
053600              ,:VNDAGR-RTV-NO-RA-REQD-IND                         05260001
053700              ,:VNDAGR-DEBIT-DESTROY-IND                          05270001
053800              ,:VNDAGR-MARKOUT-IND                                05280001
053900              ,:VNDAGR-LAST-UPD-TMST                              05290001
054000              ,:VNDAGR-LAST-UPD-ID                                05300001
054001              ,:VNDDPT-VND-DEPT-STAT-CD                           05310001
054100              ,:EXTENT-CFY-SLSRNK-NBR                             05320001
054200              ,:ENTNME-ENT-NAME-DESC                              05330001
054300              ,:XLT00024-USR-LAST-NM                              05340001
054400              ,:XLT00024-USR-FRST-NM                              05350001
054500     END-EXEC.                                                    05360001
054600                                                                  05370001
054700     EVALUATE TRUE                                                05380001
054800         WHEN SQLCODE = ZERO                                      05390001
054900              CONTINUE                                            05400001
055000                                                                  05410001
055100         WHEN SQLCODE = +100                                      05420001
055200              SET PS-EOC-DRIVER-CURSOR                            05430001
055300                               TO  TRUE                           05440001
055400                                                                  05450001
055500         WHEN SQLWARN0 NOT EQUAL SPACE                            05460001
055600         WHEN SQLCODE NOT EQUAL ZERO                              05470001
055700             DISPLAY '** ABEND **'                                05480001
055800             DISPLAY '** PROGRAM = RVKUT006 **'                   05490001
055900             DISPLAY '** PARAGRAPH = 7200-FETCH-DRIVER-CURSOR**'  05500001
056000             PERFORM 9100-SQL-ABEND                               05510001
056100     END-EVALUATE.                                                05520001
056200                                                                  05530001
056300 EJECT                                                            05540001
056400                                                                  05550001
056500*                                                                 05560001
056600***************************************************************** 05570001
056700*  WRITE THE STYLE SUMMARY EXTRACT RECORD TO AN OUTPUT FILE.    * 05580001
056800***************************************************************** 05590001
056900 8000-WRITE-EXTRACT-RECORD.                                       05600001
057000     WRITE RTV-REPORT-EXTRACT-RECORD                              05610001
057100       FROM RV003-EXTRACT-RECORD.                                 05620001
057200     ADD +1 TO PV-RECS-WRITTEN.                                   05630001
057200                                                                  05640001
057200                                                                  05650001
057300*8000-EXIT.                                                       05660001
057400                                                                  05670001
057500*                                                                 05680001
057600******************************************************************05690001
057700* 9000-EOJ-ROUTINE - PRINTS A GRAND TOTAL, AND CLOSES THE DRIVER  05700001
057800* CURSOR AND THE REPORT FILE.                                     05710001
057900******************************************************************05720001
058000 9000-EOJ-ROUTINE.                                                05730001
058100     PERFORM 7100-CLOSE-DRIVER-CURSOR.                            05740001
058200     CLOSE RTV-REPORT-EXTRACT.                                    05750001
058300     DISPLAY '************************************************'.  05760001
058300     DISPLAY '****  END OF RVKUT006  ****'                        05770001
058300     MOVE PV-RECS-WRITTEN TO PV-RECS-WRITTEN-DISPLAY.             05780001
058300     DISPLAY 'EXTRACT RECS WRITTEN ===>  '                        05790001
058300                                   PV-RECS-WRITTEN-DISPLAY.       05800001
058300     DISPLAY '************************************************'.  05810001
058300                                                                  05820001
058300                                                                  05830001
058300                                                                  05831001
058400******************************************************************05832001
058500* 9100-SQL-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      05833001
058600* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 05834001
058700******************************************************************05835001
058800 9100-SQL-ABEND.                                                  05836001
058900******************************************************************05837001
059000* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    05838001
059100* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         05839001
059200* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     05840001
059300* FORMAT.                                                         05850001
059400******************************************************************05860001
059500*    COPY DPPD004.                                                05870001
059600     COPY DPPD004.                                                05880001
059700                                                                  05890001
059800     MOVE +4013 TO ABEND-CODE.                                    05900001
059900     CALL 'ILBOABN0' USING ABEND-CODE.                            05910001
060000*9100-EXIT.                                                       05920001
