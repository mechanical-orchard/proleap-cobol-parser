000100 IDENTIFICATION DIVISION.                                         00010018
000200 TITLE 'CREATE CLEAN RECORDS FOR DATE RANGE OUT OF BALANCE'.      00020018
000300                                                                  00030018
000400 PROGRAM-ID.             PCKUT039.                                00040018
000500 AUTHOR.                 DENNIS STEFFEN.                          00050018
000600 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00060018
000700 DATE-WRITTEN            MAY 2005.                                00070018
000800 DATE-COMPILED.                                                   00080018
000900                                                                  00090018
001000 ENVIRONMENT DIVISION.                                            00100018
001100 CONFIGURATION SECTION.                                           00110018
001200                                                                  00120018
001300 SOURCE-COMPUTER.        IBM-3090.                                00130018
001400 OBJECT-COMPUTER.        IBM-3090.                                00140018
001500 INPUT-OUTPUT SECTION.                                            00150018
001600 FILE-CONTROL.                                                    00160018
001700                                                                  00170018
001800     SELECT UNBALANCED-DETAIL-FILE                                00180018
001900         ASSIGN TO INP01.                                         00190018
002000     SELECT PO-SUMMRY-FILE                                        00200018
002100         ASSIGN TO INP02.                                         00210018
002200     SELECT CLEAN-TRANSACTION-FILE                                00220018
002300         ASSIGN TO OUT01.                                         00230018
002400     SELECT UNCLEAN-TRANSACTION-FILE                              00240019
002500         ASSIGN TO OUT02.                                         00250018
002600                                                                  00260018
002700 DATA DIVISION.                                                   00270018
002800 FILE SECTION.                                                    00280018
002900                                                                  00290018
003000 FD  UNBALANCED-DETAIL-FILE                                       00300018
003100     RECORDING MODE IS F                                          00310018
003200     LABEL RECORDS ARE STANDARD                                   00320018
003300     BLOCK CONTAINS 0 RECORDS.                                    00330018
003400                                                                  00340018
003500 01  UNBALANCED-DETAIL-REC         PIC X(035).                    00350018
003600                                                                  00360018
003700 FD  PO-SUMMRY-FILE                                               00370018
003800     RECORDING MODE IS F                                          00380018
003900     LABEL RECORDS ARE STANDARD                                   00390018
004000     BLOCK CONTAINS 0 RECORDS.                                    00400018
004100                                                                  00410018
004200 01  PO-SUMMRY-REC                    PIC X(070).                 00420018
004300                                                                  00430018
004400 FD  CLEAN-TRANSACTION-FILE                                       00440018
004500     RECORDING MODE IS F                                          00450018
004600     LABEL RECORDS ARE STANDARD                                   00460018
004700     BLOCK CONTAINS 0 RECORDS.                                    00470018
004800                                                                  00480018
004900 01  CLEAN-TRANSACTION-REC            PIC X(035).                 00490018
005000                                                                  00500018
005100 FD  UNCLEAN-TRANSACTION-FILE                                     00510019
005200     RECORDING MODE IS F                                          00520018
005300     LABEL RECORDS ARE STANDARD                                   00530018
005400     BLOCK CONTAINS 0 RECORDS.                                    00540018
005500                                                                  00550018
005600 01  UNCLEAN-TRANSACTION-REC          PIC X(035).                 00560019
005700                                                                  00570018
005800 WORKING-STORAGE SECTION.                                         00580018
005900                                                                  00590018
006000 01  FILLER.                                                      00600018
006100     05  FILLER                      PIC  X(36)    VALUE          00610018
006200         ' ***** WORKING STORAGE PGM=PCKUT039 '.                  00620018
006300     05  PGM-COMPILED                PIC  X(20)    VALUE SPACE.   00630018
006400     05  FILLER                      PIC  X(10)    VALUE          00640018
006500         ' LOCATION='.                                            00650018
006600     05  PGM-LOCATION                PIC  X(04)    VALUE SPACE.   00660018
006700     05  FILLER                      PIC  X(06)    VALUE          00670018
006800         ' *****'.                                                00680018
006900                                                                  00690018
007000 01  PS-SWITCHES.                                                 00700018
007100     05  PS-EOF-DETAIL-SW             PIC X(01) VALUE 'N'.        00710041
007200         88  PS-EOF-DETAIL-YES                  VALUE 'Y'.        00720041
007300         88  PS-EOF-DETAIL-NO                   VALUE 'N'.        00730041
007400     05  PS-EOF-SUMMARY-SW            PIC X(01) VALUE 'N'.        00740041
007500         88  PS-EOF-SUMMARY-YES                 VALUE 'Y'.        00750041
007600         88  PS-EOF-SUMMARY-NO                  VALUE 'N'.        00760041
007700                                                                  00770018
007800 01  PV-DETAIL-KEY.                                               00780018
007900     05  PV-DETAIL-PO-NBR             PIC 9(10) VALUE ZERO.       00790018
008000     05  PV-DETAIL-RCVR-SEQ-NBR       PIC S9(10) VALUE ZERO.      00800018
008001                                                                  00800119
008010 01  PV-DETAIL-VALUES.                                            00801019
008020     05  PV-DETAIL-SEPHORA-IND        PIC X(01).                  00802019
008030         88  PV-DETAIL-SEPHORA                   VALUE 'S'.       00803019
008040     05  PV-DETAIL-SEPHORA-DC         PIC X(01).                  00804019
008050         88  PV-DETAIL-SEPH-SUPP-DC              VALUE 'S'.       00805019
008060         88  PV-DETAIL-SEPH-DIFF-DC              VALUE 'D'.       00806019
008070                                                                  00807019
008100 01  PV-SUMMRY-KEY.                                               00810018
008200     05  PV-SUMMRY-PO-NBR             PIC 9(10) VALUE ZERO.       00820018
008300     05  PV-SUMMRY-RCVR-SEQ-NBR       PIC S9(10) VALUE ZERO.      00830018
008400                                                                  00840018
008410 01  PV-SUMMRY-VALUES.                                            00841019
008420     05  PV-SUMMRY-SEPHORA-IND        PIC X(01).                  00842019
008430         88  PV-SUMMRY-SEPHORA                   VALUE 'S'.       00843019
008440     05  PV-SUMMRY-SEPHORA-DC         PIC X(01).                  00844019
008450         88  PV-SUMMRY-SEPH-SUPP-DC              VALUE 'S'.       00845019
008460         88  PV-SUMMRY-SEPH-DIFF-DC              VALUE 'D'.       00846019
008470                                                                  00847019
008500                                                                  00850018
008600 01  PV-COMPARE-QTYS.                                             00860018
008700     05  PV-AR-QTY                    PIC S9(9) COMP.             00870018
008800     05  PV-UN-QTY                    PIC S9(9) COMP.             00880018
008900     05  PV-ADJUST-QTY                PIC S9(9) COMP.             00890018
009000                                                                  00900018
009100*    THESE MUST HAVE SAME LENGTH AS PCRD037                       00910018
009200 01  PV-PREV-REC                      PIC X(67) VALUE SPACES.     00920018
009300 01  PV-SAVE-REC                      PIC X(67) VALUE SPACES.     00930018
009400                                                                  00940018
009500 01  PC-CONSTANTS.                                                00950018
009600     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00960018
009700                                                   'PCKUT039'.    00970018
009800     05  PC-ILBOABN0                 PIC  X(08)    VALUE          00980018
009900                                                   'ILBOABN0'.    00990018
010000     05  PC-MAX-RETRIES              PIC S9(04)    VALUE  +3      01000018
010100                                                   COMP.          01010018
010200                                                                  01020018
010300 01  PV-MISC-STUFF.                                               01030018
010400     05  DK-PERCENT                   PIC S9(03)V9999 COMP-3      01040018
010500                                                 VALUE ZERO.      01050018
010600     05  DK-BOSS-PERCENT              PIC S9(03)V9999 COMP-3      01060018
010700                                                 VALUE ZERO.      01070018
010701                                                                  01070119
010702* DMH - 5/4/21 BEGIN                                              01070219
010710     05  DK-SEPH-SUPP-DC-PERCENT      PIC S9(03)V9999 COMP-3      01071020
010720                                                 VALUE ZERO.      01072019
010730     05  DK-SEPH-DIFF-DC-PERCENT      PIC S9(03)V9999 COMP-3      01073020
010740                                                 VALUE ZERO.      01074019
010750* DMH - 5/4/21 END                                                01075019
010760                                                                  01076019
010800     05  PV-BOSS-PARM-RECV            PIC S9(09) COMP.            01080018
010900     05  PV-BOSS-PARM-DISP            PIC -9(04).                 01090018
011000     05  PV-COMP10                    PIC S9(10) COMP VALUE ZERO. 01100018
011100     05  PV-ABEND-PARAGRAPH           PIC  X(30) VALUE SPACES.    01110018
011200     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(60) VALUE SPACE.     01120018
011300     05  PV-SQL-CODE                  PIC  9(04) VALUE ZERO.      01130018
011400     05  PV-ABEND-CODE                PIC S9(04) VALUE ZERO       01140018
011500                                                   COMP SYNC.     01150018
011600     05  PV-RETRY-COUNTER             PIC S9(04) VALUE ZERO       01160018
011700                                                 COMP SYNC.       01170018
011800     05  PV-COMMIT-COUNTER            PIC S9(04) VALUE ZERO       01180018
011900                                                 COMP SYNC.       01190018
012000     05  PV-READ-COUNTER              PIC S9(09) COMP-3           01200018
012100                                              VALUE ZERO.         01210018
012110     05  PV-READ-BOSS                 PIC S9(09) COMP-3           01211046
012120                                              VALUE ZERO.         01212026
012121     05  PV-READ-SEPH-SUPP            PIC S9(09) COMP-3           01212146
012122                                              VALUE ZERO.         01212232
012123     05  PV-READ-SEPH-DIFF            PIC S9(09) COMP-3           01212346
012124                                              VALUE ZERO.         01212432
012130     05  PV-SUMRY-COUNTER             PIC S9(09) COMP-3           01213032
012140                                              VALUE ZERO.         01214032
012150     05  PV-SUMRY-COUNTERB            PIC S9(09) COMP-3           01215032
012160                                              VALUE ZERO.         01216032
012170***  OUT01 COUNTS - TO BE CLEANED                                 01217049
012200     05  PV-WRITE-1-COUNTER           PIC S9(09) COMP-3           01220018
012300                                              VALUE ZERO.         01230018
012310     05  PV-WRITE-1-BOSS              PIC S9(09) COMP-3           01231047
012320                                              VALUE ZERO.         01232027
012330     05  PV-WRITE-1-SEPH-SUPP         PIC S9(09) COMP-3           01233048
012340                                              VALUE ZERO.         01234027
012350     05  PV-WRITE-1-SEPH-DIFF         PIC S9(09) COMP-3           01235048
012360                                              VALUE ZERO.         01236027
012370***  OUT02 COUNTS - UNCLEAN - BYPASSED                            01237049
012400     05  PV-WRITE-2-COUNTER           PIC S9(09) COMP-3           01240018
012500                                              VALUE ZERO.         01250018
012510     05  PV-WRITE-2-BOSS              PIC S9(09) COMP-3           01251048
012520                                              VALUE ZERO.         01252048
012530     05  PV-WRITE-2-SEPH-SUPP         PIC S9(09) COMP-3           01253048
012540                                              VALUE ZERO.         01254029
012550     05  PV-WRITE-2-SEPH-DIFF         PIC S9(09) COMP-3           01255048
012560                                              VALUE ZERO.         01256029
012570***                                                               01257049
012710* DMH - 5/4/21 BEGIN                                              01271019
012721     05  PV-WRITE-REGULAR             PIC S9(09) COMP-3           01272143
012722                                              VALUE ZERO.         01272243
012723     05  PV-SKIP-BOSS                 PIC S9(09) COMP-3           01272343
012724                                              VALUE ZERO.         01272443
012725     05  PV-SKIP-SEPH-SUPP            PIC S9(09) COMP-3           01272543
012726                                              VALUE ZERO.         01272643
012727     05  PV-SKIP-SEPH-DIFF            PIC S9(09) COMP-3           01272743
012728                                              VALUE ZERO.         01272843
012729     05  PV-SKIP-REGULAR              PIC S9(09) COMP-3           01272943
012730                                              VALUE ZERO.         01273043
012737* DMH - 5/4/21 END                                                01273719
012740                                                                  01274019
012800     05  PV-SKIP-COUNT                PIC S9(09) COMP-3           01280018
012900                                              VALUE ZERO.         01290018
013000     05  PV-PERCENT                   PIC S9(05)V9(4) COMP-3      01300018
013100                                              VALUE ZERO.         01310018
013200     05  PV-PARM-PERCENT              PIC S9(9) COMP              01320018
013300                                              VALUE ZERO.         01330018
013400     05  PV-DISP-COUNT                PIC ZZZ,ZZZ,ZZ9.            01340044
013401     05  PV-DISP-NBR                  PIC ZZZ,ZZZ,ZZ9.            01340144
013410     05  PV-DISP-PO-A                 PIC 999999999.              01341039
013411     05  PV-DISP-RCVR-A               PIC 9999.                   01341139
013412     05  PV-DISP-RCVR-1               PIC 999999999-.             01341239
013420     05  PV-DISP-RCVR-2               PIC 999999999-.             01342024
013500     05  PV-DISP-PERCENT              PIC ZZ9.9999.               01350018
013510     05  PV-DISP-PERCENT1             PIC ZZ9.9999.               01351038
013520     05  PV-DISP-PERCENT2             PIC ZZ9.9999.               01352038
013600     05  PV-ABEND-OPERATION           PIC X(20) VALUE SPACES.     01360018
013700     05  PV-ABEND-STRUCTURE-1         PIC X(20) VALUE SPACES.     01370018
013800     05  PV-TMST                      PIC X(26) VALUE SPACES.     01380018
013900                                                                  01390018
014000 01  ABEND-CODE                       PIC S9(04)     VALUE +0     01400018
014100                                                     COMP SYNC.   01410018
014200     88  ABEND-4001-WRITE-ERROR                      VALUE +4001. 01420018
014300     88  ABEND-4002-READ-ERROR                       VALUE +4002. 01430018
014400     88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003. 01440018
014500     88  ABEND-4004-TABLE-ERROR                      VALUE +4004. 01450018
014600     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 01460018
014700     88  ABEND-4006-CLOSE-ERROR                      VALUE +4006. 01470018
014800     88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 01480018
014900     88  ABEND-4008-DATS-ERROR                       VALUE +4008. 01490018
015000     88  ABEND-4009-KEY-DATS-ERROR                   VALUE +4009. 01500018
015100     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 01510018
015200                                                                  01520018
015300 01  PV-COUNT-MSG-1.                                              01530018
015400     05  FILLER                       PIC X(37) VALUE             01540021
015500         'TOTAL CLEAN RECORDS TO OUT01       = '.                 01550051
015600     05  PV-MSG-1-COUNT               PIC ZZZ,ZZZ,ZZ9.            01560018
015700                                                                  01570018
015710 01  PV-COUNT-MSG-1-BOSS.                                         01571047
015720     05  FILLER                       PIC X(37) VALUE             01572028
015730         'CLEAN - BOSS RECORDS- TO OUT01     = '.                 01573028
015740     05  PV-MSG-1-BOSS                PIC ZZZ,ZZZ,ZZ9.            01574047
015750                                                                  01575027
015760 01  PV-COUNT-MSG-1-SEPH-SUPP.                                    01576047
015770     05  FILLER                       PIC X(37) VALUE             01577027
015780         'CLEAN SEPHORA-SUPPORT DC OUT01     = '.                 01578027
015790     05  PV-MSG-1-SEPH-SUPP           PIC ZZZ,ZZZ,ZZ9.            01579047
015791                                                                  01579127
015792 01  PV-COUNT-MSG-1-SEPH-DIFF.                                    01579247
015793     05  FILLER                       PIC X(37) VALUE             01579327
015794         'CLEAN SEPHORA-DIFFERENT DC OUT01   = '.                 01579427
015795     05  PV-MSG-1-SEPH-DIFF           PIC ZZZ,ZZZ,ZZ9.            01579547
015796                                                                  01579627
015800 01  PV-COUNT-MSG-2.                                              01580018
015900     05  FILLER                       PIC X(37) VALUE             01590021
016000         'UNCLEAN RECORDS WRITTEN TO OUT02   = '.                 01600019
016100     05  PV-MSG-2-COUNT               PIC ZZZ,ZZZ,ZZ9.            01610018
016200                                                                  01620018
016210 01  PV-COUNT-MSG-2-BOSS.                                         01621047
016220     05  FILLER                       PIC X(37) VALUE             01622029
016230         'UNCLEAN - BOSS RECORDS- TO OUT02   = '.                 01623029
016240     05  PV-MSG-2-WRITE-BOSS          PIC ZZZ,ZZZ,ZZ9.            01624047
016250                                                                  01625029
016260 01  PV-COUNT-MSG-2-SEPH-SUPP.                                    01626047
016270     05  FILLER                       PIC X(37) VALUE             01627029
016280         'UNCLEAN SEPHORA-SUPPORT DC OUT02   = '.                 01628029
016290     05  PV-MSG-2-WRITE-SEPH-SUPP     PIC ZZZ,ZZZ,ZZ9.            01629047
016291                                                                  01629129
016292 01  PV-COUNT-MSG-2-SEPH-DIFF.                                    01629247
016293     05  FILLER                       PIC X(37) VALUE             01629329
016294         'UNCLEAN SEPHORA-DIFFERENT DC OUT02 = '.                 01629429
016295     05  PV-MSG-2-WRITE-SEPH-DIFF     PIC ZZZ,ZZZ,ZZ9.            01629547
016296                                                                  01629629
016300 01  PV-COUNT-MSG-3.                                              01630018
016400     05  FILLER                       PIC X(37) VALUE             01640028
016500         'BOSS RECORDS PROCESSED:            '.                   01650031
016600     05  PV-MSG-3-COUNT               PIC ZZZ,ZZZ,ZZ9.            01660018
016700                                                                  01670018
016800 01  PV-COUNT-MSG-4.                                              01680018
016900     05  FILLER                       PIC X(37) VALUE             01690021
017000         'UNBALANCED DATE RANGE RECS READ  = '.                   01700018
017100     05  PV-MSG-READ-COUNT            PIC ZZZ,ZZZ,ZZ9.            01710018
017201                                                                  01720119
017202 01  PV-COUNT-MSG-4B.                                             01720226
017203     05  FILLER                       PIC X(37) VALUE             01720326
017204         'UNBALANCED BOSS READ:              '.                   01720426
017205     05  PV-MSG-READ-COUNTB           PIC ZZZ,ZZZ,ZZ9.            01720526
017206                                                                  01720626
017207 01  PV-COUNT-MSG-4C.                                             01720732
017208     05  FILLER                       PIC X(37) VALUE             01720832
017209         'UNBALANCED SEPHORA SUPPORT DC READ:'.                   01720932
017210     05  PV-MSG-READ-COUNTC           PIC ZZZ,ZZZ,ZZ9.            01721032
017211                                                                  01721132
017212 01  PV-COUNT-MSG-4D.                                             01721232
017213     05  FILLER                       PIC X(37) VALUE             01721332
017214         'UNBALANCED SEPHORA DIFFRNT DC READ:'.                   01721432
017215     05  PV-MSG-READ-COUNTD           PIC ZZZ,ZZZ,ZZ9.            01721532
017216                                                                  01721632
017217* DMH - 5/4/21 BEGIN                                              01721719
017218 01  PV-COUNT-MSG-5.                                              01721819
017220     05  FILLER                       PIC X(37) VALUE             01722021
017230         'SEPHORA-SUPPORT DC REC PROCESSED:  '.                   01723019
017240     05  PV-MSG-5-COUNT               PIC ZZZ,ZZZ,ZZ9.            01724019
017250                                                                  01725019
017260 01  PV-COUNT-MSG-6.                                              01726019
017270     05  FILLER                       PIC X(37) VALUE             01727021
017280         'SEPHORA-DIFFERENT DC REC PROCESSED:'.                   01728019
017290     05  PV-MSG-6-COUNT               PIC ZZZ,ZZZ,ZZ9.            01729019
017291                                                                  01729132
017292 01  PV-COUNT-MSG-7.                                              01729232
017293     05  FILLER                       PIC X(37) VALUE             01729332
017294         'SUMMARY RECORDS READ:              '.                   01729432
017295     05  PV-MSG-SUMRY-COUNT           PIC ZZZ,ZZZ,ZZ9.            01729532
017296                                                                  01729632
017297 01  PV-COUNT-MSG-7B.                                             01729732
017298     05  FILLER                       PIC X(37) VALUE             01729832
017299         'BOSS SUMMARY RECORDS READ:         '.                   01729934
017300     05  PV-MSG-SUMRY-COUNTB          PIC ZZZ,ZZZ,ZZ9.            01730032
017301                                                                  01730132
017302* DMH - 5/4/21 END                                                01730219
017303                                                                  01730319
017310*    CLEAN RECORDS                                                01731018
017400     COPY PCRD041.                                                01740018
017500                                                                  01750018
017600*    SUMMARY FILE                                                 01760042
017700     COPY PCRD042.                                                01770018
017800/                                                                 01780018
017900     EXEC SQL                                                     01790018
018000         INCLUDE TKRPRPM                                          01800018
018100     END-EXEC.                                                    01810018
018200                                                                  01820018
018300     EXEC SQL                                                     01830018
018400         INCLUDE SQLCA                                            01840018
018500     END-EXEC.                                                    01850018
018600                                                                  01860018
018700     COPY SQLCA2.                                                 01870018
018800                                                                  01880018
018900     COPY DPWS004.                                                01890018
019000/                                                                 01900018
019100 PROCEDURE DIVISION.                                              01910018
019200                                                                  01920018
019300     PERFORM 1000-INITIALIZATION.                                 01930018
019400                                                                  01940018
019500     PERFORM 2000-PROCESS UNTIL PS-EOF-DETAIL-YES                 01950041
019600                                                                  01960018
019700     PERFORM 9000-QUIT.                                           01970018
019800                                                                  01980018
019900     GOBACK.                                                      01990018
020000/                                                                 02000018
020100 1000-INITIALIZATION.                                             02010018
020200     MOVE '1000-INITIALIZATION         '  TO PV-ABEND-PARAGRAPH.  02020018
020300     DISPLAY ' START PCKUT039'                                    02030018
020400                                                                  02040018
020500*    OPEN THE EXTRACT FILE                                        02050018
020600     OPEN INPUT UNBALANCED-DETAIL-FILE                            02060018
020700                PO-SUMMRY-FILE                                    02070018
020800     OPEN OUTPUT CLEAN-TRANSACTION-FILE                           02080018
020900                 UNCLEAN-TRANSACTION-FILE                         02090019
021000                                                                  02100018
021020     PERFORM 6800-GET-BOSS-PARM-RCVR.                             02102036
021030     MOVE PV-BOSS-PARM-RECV           TO PV-BOSS-PARM-DISP.       02103036
021040     DISPLAY ' BOSS PARM RECEIVER:   '   PV-BOSS-PARM-DISP.       02104036
021050     DISPLAY ' '.                                                 02105036
021060                                                                  02106036
021100     INITIALIZE PV-DETAIL-KEY                                     02110018
021200                PV-SUMMRY-KEY                                     02120018
021300                                                                  02130018
021400     PERFORM 8000-READ-DETAIL.                                    02140039
021500                                                                  02150018
021600     IF PS-EOF-DETAIL-YES                                         02160041
021700         DISPLAY SPACES                                           02170018
021800         DISPLAY ALL '*'                                          02180018
021900         DISPLAY '  INP01 FILE IS EMPTY '                         02190018
022000         DISPLAY ALL '*'                                          02200018
022100         DISPLAY SPACES                                           02210018
022200     END-IF.                                                      02220018
022300                                                                  02230018
022400*    READ THE SUMMARY FILE                                        02240042
022500     IF NOT PS-EOF-DETAIL-YES                                     02250041
022600         PERFORM 8100-READ-SUMMRY                                 02260018
022700     END-IF.                                                      02270018
022800                                                                  02280018
022900     IF PS-EOF-SUMMARY-YES                                        02290041
023000         DISPLAY SPACES                                           02300018
023100         DISPLAY ALL '*'                                          02310018
023200         DISPLAY '  INP02 FILE IS EMPTY '                         02320018
023300         DISPLAY ALL '*'                                          02330018
023400         DISPLAY SPACES                                           02340018
023500     END-IF.                                                      02350018
023600                                                                  02360036
024100     PERFORM 7000-GET-PERCENT.                                    02410018
024200     MOVE DK-PERCENT                  TO PV-DISP-PERCENT          02420018
024300     DISPLAY ' PERCENT PARM IS:      '   PV-DISP-PERCENT          02430022
024310             '      CLEAN3'.                                      02431022
024400                                                                  02440018
024500     PERFORM 7200-GET-BOSS-PERCENT.                               02450018
024600     MOVE DK-BOSS-PERCENT             TO PV-DISP-PERCENT          02460018
024700     DISPLAY ' BOSS PERCENT PARM IS: '   PV-DISP-PERCENT          02470022
024701             '      CLEAN7'.                                      02470122
024702                                                                  02470219
024710* DMH - 5/4/21 - BEGIN                                            02471019
024720     PERFORM 7210-GET-SEPH-SUPP-PERCENT.                          02472019
024730     MOVE DK-SEPH-SUPP-DC-PERCENT     TO PV-DISP-PERCENT          02473020
024740     DISPLAY ' SEPHORA SUPPORT DC %  '   PV-DISP-PERCENT          02474022
024741             '      CLEANC'.                                      02474122
024750                                                                  02475019
024760     PERFORM 7220-GET-SEPH-DIFF-PERCENT.                          02476019
024770     MOVE DK-SEPH-DIFF-DC-PERCENT     TO PV-DISP-PERCENT          02477020
024780     DISPLAY ' SEPHORA DIFFRNT DC %  '   PV-DISP-PERCENT          02478022
024781             '      CLEANG'.                                      02478122
024782                                                                  02478222
024783     DISPLAY ' '.                                                 02478322
024790* DMH - 5/4/21 - END                                              02479019
024791                                                                  02479119
024800/                                                                 02480018
024900 2000-PROCESS.                                                    02490018
025000                                                                  02500018
025100     MOVE '2000-PROCESS'                  TO PV-ABEND-PARAGRAPH.  02510018
025250                                                                  02525023
025300     EVALUATE TRUE                                                02530018
025400         WHEN PV-DETAIL-KEY = PV-SUMMRY-KEY                       02540018
025500              MOVE PC042-PO-RCVR-END-DTE                          02550042
025600                                      TO PC041-INTRNST-TRN-DTE    02560018
025601*                                                                 02560142
025602*** BOSS RECEIVER PROCESS                                         02560242
025603*                                                                 02560342
025610             IF  PV-DETAIL-RCVR-SEQ-NBR = PV-BOSS-PARM-RECV       02561042
025620                 IF  PC042-PERCENTAGE >= DK-BOSS-PERCENT          02562042
025631                     PERFORM 8200-WRITE-CLEAN                     02563142
025640                 ELSE                                             02564042
025650                     ADD 1            TO PV-SKIP-BOSS             02565042
025660                 END-IF                                           02566042
025670             ELSE                                                 02567042
025710*                                                                 02571042
025720*** SEPHORA RECEIVER - SUPPORT DC PROCESS                         02572042
025730*                                                                 02573042
025731             IF  PC041-SEPHORA   AND  PC041-SEPHORA-SUPPORT-DC    02573142
025739                 IF  PC042-PERCENTAGE >= DK-SEPH-SUPP-DC-PERCENT  02573942
025740                     PERFORM 8200-WRITE-CLEAN                     02574042
025741                 ELSE                                             02574142
025742                     ADD 1            TO PV-SKIP-SEPH-SUPP        02574242
025743                 END-IF                                           02574342
025744             ELSE                                                 02574442
025750*                                                                 02575042
025760*** SEPHORA RECEIVER - DIFFERENT DC PROCESS                       02576042
025770*                                                                 02577042
025771             IF  PC041-SEPHORA   AND  PC041-SEPHORA-DIFFERENT-DC  02577142
025779                 IF  PC042-PERCENTAGE >= DK-SEPH-DIFF-DC-PERCENT  02577952
025780                     PERFORM 8200-WRITE-CLEAN                     02578042
025781                 ELSE                                             02578142
025782                     ADD 1            TO PV-SKIP-SEPH-DIFF        02578242
025783                 END-IF                                           02578342
025784             ELSE                                                 02578442
025790*                                                                 02579042
025791*** ALL OTHER RECEIVERS PROCESS                                   02579142
025792*                                                                 02579242
025793             IF  PC042-PERCENTAGE >= DK-PERCENT                   02579342
025801                 ADD 1            TO PV-WRITE-REGULAR             02580142
025802                 PERFORM 8200-WRITE-CLEAN                         02580242
025803             ELSE                                                 02580342
025804                 ADD 1            TO PV-SKIP-REGULAR              02580442
025805             END-IF                                               02580542
025806             END-IF                                               02580642
025807             END-IF                                               02580742
025808             END-IF                                               02580842
025809*                                                                 02580942
025810              PERFORM 8000-READ-DETAIL                            02581042
025900                                                                  02590018
026000         WHEN PV-DETAIL-KEY > PV-SUMMRY-KEY                       02600018
026001              PERFORM 8100-READ-SUMMRY                            02600142
026700                                                                  02670018
026800         WHEN PV-DETAIL-KEY < PV-SUMMRY-KEY                       02680018
026900             PERFORM 8300-WRITE-UNCLEAN                           02690019
027000             PERFORM 8000-READ-DETAIL                             02700039
027100                                                                  02710018
027200     END-EVALUATE.                                                02720018
027300/                                                                 02730018
030100******************************************************************03010018
030200*- READ TKRPRPM TO RETRIEVE THE BOSS RECEIVER PARM                03020018
030300******************************************************************03030018
030400 6800-GET-BOSS-PARM-RCVR.                                         03040018
030500                                                                  03050018
030600     MOVE '6800-GET-BOSS-PARM-RCVR'   TO PV-ABEND-PARAGRAPH.      03060018
030700                                                                  03070018
030800     PERFORM                                                      03080018
030900         WITH TEST AFTER                                          03090018
031000         VARYING PV-RETRY-COUNTER                                 03100018
031100         FROM 1 BY 1                                              03110018
031200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               03120018
031300            OR  (SQLCODE = +100)                                  03130018
031400            OR  (SQLCODE = +0))                                   03140018
031500                                                                  03150018
031600         EXEC SQL                                                 03160018
031700             SELECT FUNC_QTY                                      03170018
031800               INTO :PV-BOSS-PARM-RECV                            03180018
031900               FROM TKRPRPM                                       03190018
032000              WHERE LOC_ID            = 90                        03200018
032100                AND INTFC_SYS_CDE     = 'GIV'                     03210018
032200                AND SYS_PRC_FUNC_CDE  = 'BSSRCV'                  03220018
032300                AND FUNC_PRC_STAT_CDE = 'AC'                      03230018
032400             WITH UR                                              03240018
032500         END-EXEC                                                 03250018
032600                                                                  03260018
032700         EVALUATE TRUE                                            03270018
032800             WHEN SQLCODE = ZERO                                  03280018
032900                 CONTINUE                                         03290018
033000                                                                  03300018
033100             WHEN SQLCODE = -904                                  03310018
033200             WHEN SQLCODE = -911                                  03320018
033300             WHEN SQLCODE = -913                                  03330018
033400                  CONTINUE                                        03340018
033500                                                                  03350018
033600             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              03360018
033700                 DISPLAY '**************************************' 03370018
033800                 DISPLAY 'WARNING ISSUED '                        03380018
033900                 DISPLAY 'SELECT TKRPRPM - BOSS RECEIVER        ' 03390018
034000                 DISPLAY '**************************************' 03400018
034100                 PERFORM 9800-SQL-WARNING                         03410018
034200                                                                  03420018
034300             WHEN SQLCODE < ZERO                                  03430018
034400                 DISPLAY '**************************************' 03440018
034500                 DISPLAY 'ERROR ISSUED ON                       ' 03450018
034600                 DISPLAY 'SELECT TKRPRPM - BOSS RECEIVER        ' 03460018
034700                 DISPLAY '**************************************' 03470018
034800                 PERFORM 9900-SQL-ERROR                           03480018
034900                                                                  03490018
035000         END-EVALUATE                                             03500018
035100     END-PERFORM.                                                 03510018
035200                                                                  03520018
035300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    03530018
035400         SQLCODE NOT = ZERO                                       03540018
035500         DISPLAY '**************************************'         03550018
035600         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         03560018
035700         DISPLAY 'SELECT TKRPRPM - BOSS RECEIVER'                 03570018
035800         DISPLAY '**************************************'         03580018
035900         PERFORM 9900-SQL-ERROR                                   03590018
036000     END-IF.                                                      03600018
036100                                                                  03610018
036200 7000-GET-PERCENT.                                                03620018
036300                                                                  03630018
036400     MOVE '7000-GET-PERCENT '         TO PV-ABEND-PARAGRAPH.      03640018
036500                                                                  03650018
036600     PERFORM                                                      03660018
036700         WITH TEST AFTER                                          03670018
036800         VARYING PV-RETRY-COUNTER                                 03680018
036900         FROM 1 BY 1                                              03690018
037000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               03700018
037100            OR  (SQLCODE = +100)                                  03710018
037200            OR  (SQLCODE = +0))                                   03720018
037300                                                                  03730018
037400         EXEC SQL                                                 03740018
037500             SELECT FUNC_QTY                                      03750018
037600             INTO :DK-PERCENT                                     03760018
037700              FROM  TKRPRPM                                       03770018
037800             WHERE                                                03780018
037900                   LOC_ID            = 90                         03790018
038000               AND INTFC_SYS_CDE     = 'KHL'                      03800018
038100               AND SYS_PRC_FUNC_CDE  = 'CLEAN3'                   03810018
038200               AND FUNC_PRC_STAT_CDE = 'AC'                       03820018
038300         WITH UR                                                  03830018
038400         END-EXEC                                                 03840018
038500                                                                  03850018
038600         EVALUATE TRUE                                            03860018
038700             WHEN SQLCODE = ZERO                                  03870018
038800                 CONTINUE                                         03880018
038900             WHEN SQLCODE = -904                                  03890018
039000             WHEN SQLCODE = -911                                  03900018
039100             WHEN SQLCODE = -913                                  03910018
039200                  CONTINUE                                        03920018
039300                                                                  03930018
039400             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              03940018
039500                 DISPLAY '**************************************' 03950018
039600                 DISPLAY 'WARNING ISSUED '                        03960018
039700                 DISPLAY 'SELECT TKRPRPM                        ' 03970018
039800                 DISPLAY '**************************************' 03980018
039900                 PERFORM 9800-SQL-WARNING                         03990018
040000                                                                  04000018
040100             WHEN SQLCODE < ZERO                                  04010018
040200                 DISPLAY '**************************************' 04020018
040300                 DISPLAY 'ERROR ISSUED ON                       ' 04030018
040400                 DISPLAY 'SELECT TKRPRPM                        ' 04040018
040500                 DISPLAY '**************************************' 04050018
040600                 PERFORM 9900-SQL-ERROR                           04060018
040700                                                                  04070018
040800         END-EVALUATE                                             04080018
040900     END-PERFORM.                                                 04090018
041000                                                                  04100018
041100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    04110018
041200         SQLCODE NOT = ZERO                                       04120018
041300         DISPLAY '**************************************'         04130018
041400         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         04140018
041500         DISPLAY 'SELECT TKRPRPM         '                        04150018
041600         DISPLAY '**************************************'         04160018
041700         PERFORM 9900-SQL-ERROR                                   04170018
041800     END-IF.                                                      04180018
041900/                                                                 04190018
042000******************************************************************04200018
042100*- READ TKRPRPM TO RETRIEVE THE BOSS PERCENT                      04210018
042200******************************************************************04220018
042300 7200-GET-BOSS-PERCENT.                                           04230018
042400                                                                  04240018
042500     MOVE '7200-GET-BOSS-PERCENT'      TO PV-ABEND-PARAGRAPH.     04250018
042600                                                                  04260018
042700     PERFORM                                                      04270018
042800         WITH TEST AFTER                                          04280018
042900         VARYING PV-RETRY-COUNTER                                 04290018
043000         FROM 1 BY 1                                              04300018
043100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               04310018
043200            OR  (SQLCODE = +100)                                  04320018
043300            OR  (SQLCODE = +0))                                   04330018
043400                                                                  04340018
043500         EXEC SQL                                                 04350018
043600             SELECT FUNC_QTY                                      04360018
043700               INTO :DK-BOSS-PERCENT                              04370018
043800               FROM TKRPRPM                                       04380018
043900              WHERE LOC_ID            = 90                        04390018
044000                AND INTFC_SYS_CDE     = 'KHL'                     04400018
044100                AND SYS_PRC_FUNC_CDE  = 'CLEAN7'                  04410018
044200                AND FUNC_PRC_STAT_CDE = 'AC'                      04420018
044300              WITH UR                                             04430018
044400         END-EXEC                                                 04440018
044500                                                                  04450018
044600         EVALUATE TRUE                                            04460018
044700             WHEN SQLCODE = ZERO                                  04470018
044800                 CONTINUE                                         04480018
044900                                                                  04490018
045000             WHEN SQLCODE = -904                                  04500018
045100             WHEN SQLCODE = -911                                  04510018
045200             WHEN SQLCODE = -913                                  04520018
045300                  CONTINUE                                        04530018
045400                                                                  04540018
045500             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              04550018
045600                 DISPLAY '**************************************' 04560018
045700                 DISPLAY 'WARNING ISSUED '                        04570018
045800                 DISPLAY 'SELECT TKRPRPM - BOSS PERCENT         ' 04580018
045900                 DISPLAY '**************************************' 04590018
046000                 PERFORM 9800-SQL-WARNING                         04600018
046100                                                                  04610018
046200             WHEN SQLCODE < ZERO                                  04620018
046300                 DISPLAY '**************************************' 04630018
046400                 DISPLAY 'ERROR ISSUED ON                       ' 04640018
046500                 DISPLAY 'SELECT TKRPRPM - BOSS PERCENT         ' 04650018
046600                 DISPLAY '**************************************' 04660018
046700                 PERFORM 9900-SQL-ERROR                           04670018
046800                                                                  04680018
046900         END-EVALUATE                                             04690018
047000     END-PERFORM.                                                 04700018
047100                                                                  04710018
047200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    04720018
047300         SQLCODE NOT = ZERO                                       04730018
047400         DISPLAY '**************************************'         04740018
047500         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         04750018
047600         DISPLAY 'SELECT TKRPRPM - BOSS PERCENT'                  04760018
047700         DISPLAY '**************************************'         04770018
047800         PERFORM 9900-SQL-ERROR                                   04780018
047900     END-IF.                                                      04790018
048000                                                                  04800019
048001                                                                  04800119
048010******************************************************************04801019
048020*- SEPHORA - FROM SUPPORTING DC - PERCENT                         04802019
048021* DMH - 5/4/21 - BEGIN                                            04802119
048030******************************************************************04803019
048040 7210-GET-SEPH-SUPP-PERCENT.                                      04804019
048050                                                                  04805019
048060     MOVE '7210-GET-SEPH-SUPP-PERCENT' TO PV-ABEND-PARAGRAPH.     04806019
048070                                                                  04807019
048080     PERFORM                                                      04808019
048090         WITH TEST AFTER                                          04809019
048091         VARYING PV-RETRY-COUNTER                                 04809119
048092         FROM 1 BY 1                                              04809219
048093         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               04809319
048094            OR  (SQLCODE = +100)                                  04809419
048095            OR  (SQLCODE = +0))                                   04809519
048096                                                                  04809619
048097         EXEC SQL                                                 04809719
048098             SELECT FUNC_QTY                                      04809819
048099               INTO :DK-SEPH-SUPP-DC-PERCENT                      04809919
048100               FROM TKRPRPM                                       04810019
048101              WHERE LOC_ID            = 90                        04810119
048102                AND INTFC_SYS_CDE     = 'KHL'                     04810219
048103                AND SYS_PRC_FUNC_CDE  = 'CLEANC'                  04810319
048104                AND FUNC_PRC_STAT_CDE = 'AC'                      04810419
048105              WITH UR                                             04810519
048106         END-EXEC                                                 04810619
048107                                                                  04810719
048108         EVALUATE TRUE                                            04810819
048109             WHEN SQLCODE = ZERO                                  04810919
048110                 CONTINUE                                         04811019
048111                                                                  04811119
048112             WHEN SQLCODE = -904                                  04811219
048113             WHEN SQLCODE = -911                                  04811319
048114             WHEN SQLCODE = -913                                  04811419
048115                  CONTINUE                                        04811519
048116                                                                  04811619
048117             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              04811719
048118                 DISPLAY '**************************************' 04811819
048119                 DISPLAY 'WARNING ISSUED '                        04811919
048120                 DISPLAY 'TKRPRPM-CLEANC-SEPHORA SUPPORT %      ' 04812019
048121                 DISPLAY '**************************************' 04812119
048122                 PERFORM 9800-SQL-WARNING                         04812219
048123                                                                  04812319
048124             WHEN SQLCODE < ZERO                                  04812419
048125                 DISPLAY '**************************************' 04812519
048126                 DISPLAY 'ERROR ISSUED ON                       ' 04812619
048127                 DISPLAY 'TKRPRPM-CLEANC-SEPHORA SUPPORT %      ' 04812719
048128                 DISPLAY '**************************************' 04812819
048129                 PERFORM 9900-SQL-ERROR                           04812919
048130                                                                  04813019
048131         END-EVALUATE                                             04813119
048132     END-PERFORM.                                                 04813219
048133                                                                  04813319
048134     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    04813419
048135         SQLCODE NOT = ZERO                                       04813519
048136         DISPLAY '**************************************'         04813619
048137         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         04813719
048138         DISPLAY 'TKRPRPM-CLEANC-SEPHORA SUPPORT %      '         04813819
048139         DISPLAY '**************************************'         04813919
048140         PERFORM 9900-SQL-ERROR                                   04814019
048141     END-IF.                                                      04814119
048142                                                                  04814219
048143                                                                  04814319
048144******************************************************************04814419
048145*- SEPHORA - FROM DIFFERENT DC - PERCENT                          04814519
048146* DMH - 5/4/21 - BEGIN                                            04814619
048147******************************************************************04814719
048148 7220-GET-SEPH-DIFF-PERCENT.                                      04814819
048149                                                                  04814919
048150     MOVE '7220-GET-SEPH-DIFF-PERCENT' TO PV-ABEND-PARAGRAPH.     04815019
048151                                                                  04815119
048152     PERFORM                                                      04815219
048153         WITH TEST AFTER                                          04815319
048154         VARYING PV-RETRY-COUNTER                                 04815419
048155         FROM 1 BY 1                                              04815519
048156         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               04815619
048157            OR  (SQLCODE = +100)                                  04815719
048158            OR  (SQLCODE = +0))                                   04815819
048159                                                                  04815919
048160         EXEC SQL                                                 04816019
048161             SELECT FUNC_QTY                                      04816119
048162               INTO :DK-SEPH-DIFF-DC-PERCENT                      04816220
048163               FROM TKRPRPM                                       04816319
048164              WHERE LOC_ID            = 90                        04816419
048165                AND INTFC_SYS_CDE     = 'KHL'                     04816519
048166                AND SYS_PRC_FUNC_CDE  = 'CLEANG'                  04816619
048167                AND FUNC_PRC_STAT_CDE = 'AC'                      04816719
048168              WITH UR                                             04816819
048169         END-EXEC                                                 04816919
048170                                                                  04817019
048171         EVALUATE TRUE                                            04817119
048172             WHEN SQLCODE = ZERO                                  04817219
048173                 CONTINUE                                         04817319
048174                                                                  04817419
048175             WHEN SQLCODE = -904                                  04817519
048176             WHEN SQLCODE = -911                                  04817619
048177             WHEN SQLCODE = -913                                  04817719
048178                  CONTINUE                                        04817819
048179                                                                  04817919
048180             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              04818019
048181                 DISPLAY '**************************************' 04818119
048182                 DISPLAY 'WARNING ISSUED '                        04818219
048183                 DISPLAY 'TKRPRPM-CLEANG-SEPHORA DIFFERENT %    ' 04818319
048184                 DISPLAY '**************************************' 04818419
048185                 PERFORM 9800-SQL-WARNING                         04818519
048186                                                                  04818619
048187             WHEN SQLCODE < ZERO                                  04818719
048188                 DISPLAY '**************************************' 04818819
048189                 DISPLAY 'ERROR ISSUED ON                       ' 04818919
048190                 DISPLAY 'TKRPRPM-CLEANG-SEPHORA DIFFERENT %    ' 04819019
048191                 DISPLAY '**************************************' 04819119
048192                 PERFORM 9900-SQL-ERROR                           04819219
048193                                                                  04819319
048194         END-EVALUATE                                             04819419
048195     END-PERFORM.                                                 04819519
048196                                                                  04819619
048197     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    04819719
048198         SQLCODE NOT = ZERO                                       04819819
048199         DISPLAY '**************************************'         04819919
048200         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         04820019
048201         DISPLAY 'TKRPRPM-CLEANG-SEPHORA DIFFERENT %    '         04820120
048202         DISPLAY '**************************************'         04820219
048203         PERFORM 9900-SQL-ERROR                                   04820319
048204     END-IF.                                                      04820419
048205                                                                  04820519
048206                                                                  04820619
048207******************************************************************04820719
048208*                                                                 04820819
048210******************************************************************04821019
048211 8000-READ-DETAIL.                                                04821139
048220                                                                  04822018
048300     MOVE '8000-READ-DETAIL    '  TO PV-ABEND-PARAGRAPH.          04830039
048400*                                                                 04840018
048500                                                                  04850018
048600     READ UNBALANCED-DETAIL-FILE                                  04860018
048700         INTO                                                     04870018
048800             PC041-UNBAL-SUMMARY-REC                              04880018
048900         AT END                                                   04890018
049000             SET PS-EOF-DETAIL-YES    TO TRUE                     04900041
049100         NOT AT END                                               04910018
049200             ADD 1                    TO PV-READ-COUNTER          04920018
049300                                         PV-COMMIT-COUNTER        04930018
049400                                                                  04940018
049500             MOVE PC041-PO-NBR        TO PV-COMP10                04950018
049600             MOVE PV-COMP10           TO PV-DETAIL-PO-NBR         04960018
049700             MOVE PC041-RCVR-SEQ-NBR  TO PV-COMP10                04970018
049800             MOVE PV-COMP10           TO PV-DETAIL-RCVR-SEQ-NBR   04980018
049801             MOVE PC041-SEPHORA-IND   TO PV-DETAIL-SEPHORA-IND    04980119
049803             MOVE PC041-SEPHORA-DC    TO PV-DETAIL-SEPHORA-DC     04980319
049804                                                                  04980432
049805             IF  PC041-RCVR-SEQ-NBR   =  PV-BOSS-PARM-RECV        04980532
049806                 ADD 1           TO PV-READ-BOSS                  04980646
049827             ELSE                                                 04982735
049828                 IF  PC041-SEPHORA                                04982835
049829                     IF  PC041-SEPHORA-SUPPORT-DC                 04982935
049830                         ADD 1   TO PV-READ-SEPH-SUPP             04983046
049840                     ELSE                                         04984035
049841                         ADD 1   TO PV-READ-SEPH-DIFF             04984146
049851                     END-IF                                       04985135
049852                 END-IF                                           04985235
049853             END-IF                                               04985335
049860                                                                  04986019
049900     END-READ.                                                    04990018
050000                                                                  05000018
050100 8100-READ-SUMMRY.                                                05010018
050200     MOVE '8100-READ-SUMMRY   '   TO PV-ABEND-PARAGRAPH.          05020018
050300*                                                                 05030018
050400                                                                  05040018
050500     READ PO-SUMMRY-FILE                                          05050018
050600         INTO                                                     05060018
050700             PC042-PO-RCVR-SUMMARY-REC                            05070018
050800         AT END                                                   05080018
050900             SET PS-EOF-SUMMARY-YES   TO TRUE                     05090041
051000         NOT AT END                                               05100018
051100             ADD 1                    TO PV-SUMRY-COUNTER         05110034
051200                                                                  05120018
051300             MOVE PC042-PO-NBR        TO PV-COMP10                05130018
051400             MOVE PV-COMP10           TO PV-SUMMRY-PO-NBR         05140018
051500             MOVE PC042-RCVR-SEQ-NBR  TO PV-COMP10                05150018
051600             MOVE PV-COMP10           TO PV-SUMMRY-RCVR-SEQ-NBR   05160018
051630                                                                  05163031
051640             IF  PC042-RCVR-SEQ-NBR   =  PV-BOSS-PARM-RECV        05164032
051650                 ADD 1           TO PV-SUMRY-COUNTERB             05165032
051695            END-IF                                                05169531
051700     END-READ.                                                    05170018
051800                                                                  05180018
051900 8200-WRITE-CLEAN.                                                05190018
052000                                                                  05200018
052100     MOVE '8200-WRITE-CLEAN    '  TO PV-ABEND-PARAGRAPH.          05210018
052200     WRITE CLEAN-TRANSACTION-REC                                  05220018
052300         FROM PC041-UNBAL-SUMMARY-REC                             05230018
052400     END-WRITE.                                                   05240018
052500     ADD 1                            TO PV-WRITE-1-COUNTER.      05250018
052600                                                                  05260018
052610     IF  PC041-RCVR-SEQ-NBR   =  PV-BOSS-PARM-RECV                05261027
052611         ADD 1           TO PV-WRITE-1-BOSS                       05261147
052612*                                                                 05261236
052621     ELSE                                                         05262127
052622         IF  PC041-SEPHORA                                        05262227
052624             IF  PC041-SEPHORA-SUPPORT-DC                         05262427
052625                 ADD 1   TO PV-WRITE-1-SEPH-SUPP                  05262548
052635             ELSE                                                 05263527
052636                 ADD 1   TO PV-WRITE-1-SEPH-DIFF                  05263648
052646             END-IF                                               05264627
052647         END-IF                                                   05264727
052650     END-IF.                                                      05265027
052660                                                                  05266027
052670                                                                  05267027
052700 8300-WRITE-UNCLEAN.                                              05270019
052800                                                                  05280018
052900     MOVE '8300-WRITE-UNCLEAN    ' TO PV-ABEND-PARAGRAPH.         05290019
053000     WRITE UNCLEAN-TRANSACTION-REC                                05300019
053100         FROM PC041-UNBAL-SUMMARY-REC                             05310018
053200     END-WRITE.                                                   05320018
053300     ADD 1                            TO PV-WRITE-2-COUNTER.      05330018
053301                                                                  05330129
053310     IF  PC041-RCVR-SEQ-NBR   =  PV-BOSS-PARM-RECV                05331029
053320         ADD 1           TO PV-WRITE-2-BOSS                       05332048
053330     ELSE                                                         05333029
053340         IF  PC041-SEPHORA                                        05334029
053350             IF  PC041-SEPHORA-SUPPORT-DC                         05335029
053360                 ADD 1   TO PV-WRITE-2-SEPH-SUPP                  05336048
053370             ELSE                                                 05337029
053380                 ADD 1   TO PV-WRITE-2-SEPH-DIFF                  05338048
053391             END-IF                                               05339129
053392         END-IF                                                   05339229
053393     END-IF.                                                      05339329
053400/                                                                 05340018
053500 9000-QUIT.                                                       05350018
053600                                                                  05360018
053700     CLOSE UNBALANCED-DETAIL-FILE                                 05370018
053800           PO-SUMMRY-FILE                                         05380018
053900           CLEAN-TRANSACTION-FILE                                 05390018
054000           UNCLEAN-TRANSACTION-FILE                               05400019
054100                                                                  05410018
054110     DISPLAY SPACES.                                              05411028
054120     DISPLAY '   INP01 - UNBALANCED-DETAIL-FILE'                  05412028
054121                                                                  05412143
054130*** 'UNBALANCED DATE RANGE RECS READ  = '.                        05413043
054200     MOVE PV-READ-COUNTER             TO PV-MSG-READ-COUNT        05420018
054300     DISPLAY PV-COUNT-MSG-4.                                      05430018
054400                                                                  05440018
054401*** 'UNBALANCED BOSS READ:              '.                        05440143
054410     MOVE PV-READ-BOSS                TO PV-MSG-READ-COUNTB       05441046
054420     DISPLAY PV-COUNT-MSG-4B.                                     05442026
054430                                                                  05443026
054431*** 'UNBALANCED SEPHORA SUPPORT DC READ:'.                        05443143
054432     MOVE PV-READ-SEPH-SUPP           TO PV-MSG-READ-COUNTC       05443246
054433     DISPLAY PV-COUNT-MSG-4C.                                     05443332
054434                                                                  05443432
054435*** 'UNBALANCED SEPHORA DIFFRNT DC READ:'.                        05443543
054437     MOVE PV-READ-SEPH-DIFF           TO PV-MSG-READ-COUNTD       05443746
054438     DISPLAY PV-COUNT-MSG-4D.                                     05443833
054439                                                                  05443932
054440     DISPLAY SPACES.                                              05444032
054450     DISPLAY '   INP02 - PO-SUMMRY-FILE'                          05445032
054451*** 'SUMMARY RECORDS READ:              '.                        05445143
054460     MOVE PV-SUMRY-COUNTER            TO PV-MSG-SUMRY-COUNT       05446032
054470     DISPLAY PV-COUNT-MSG-7.                                      05447032
054480                                                                  05448032
054481*** 'BOSS SUMMARY RECORDS READ:         '.                        05448143
054490     MOVE PV-SUMRY-COUNTERB           TO PV-MSG-SUMRY-COUNTB      05449032
054491     DISPLAY PV-COUNT-MSG-7B.                                     05449132
054492                                                                  05449232
054493     DISPLAY SPACES.                                              05449326
054494     DISPLAY '   OUT01 - CLEAN-TRANSACTION-FILE - TO BE CLEANED'  05449430
054495                                                                  05449526
054496*** 'CLEAN RECORDS WRITTEN TO OUT01     = '.                      05449643
054500     MOVE PV-WRITE-1-COUNTER          TO PV-MSG-1-COUNT           05450018
054600     DISPLAY PV-COUNT-MSG-1.                                      05460018
054700                                                                  05470018
054701     MOVE PV-WRITE-REGULAR                 TO PV-DISP-COUNT.      05470151
054702     DISPLAY 'CLEAN - REGULAR RECORDS TO OUT01   = '              05470251
054703                                              PV-DISP-COUNT.      05470351
054704                                                                  05470451
054705*** 'CLEAN - BOSS RECORDS- TO OUT01     = '.                      05470551
054710     MOVE PV-WRITE-1-BOSS             TO PV-MSG-1-BOSS            05471047
054720     DISPLAY PV-COUNT-MSG-1-BOSS.                                 05472047
054730                                                                  05473027
054731*** 'CLEAN SEPHORA-SUPPORT DC OUT01     = '.                      05473143
054740     MOVE PV-WRITE-1-SEPH-SUPP        TO PV-MSG-1-SEPH-SUPP       05474048
054750     DISPLAY PV-COUNT-MSG-1-SEPH-SUPP.                            05475047
054760                                                                  05476027
054761*** 'CLEAN SEPHORA-DIFFERENT DC OUT01   = '.                      05476143
054770     MOVE PV-WRITE-1-SEPH-DIFF        TO PV-MSG-1-SEPH-DIFF       05477048
054780     DISPLAY PV-COUNT-MSG-1-SEPH-DIFF.                            05478047
054791                                                                  05479127
054792     DISPLAY ' '.                                                 05479227
054793     DISPLAY '   OUT02 - UNCLEAN-TRANSACTION-FILE - DUMMY FILE'.  05479330
054794                                                                  05479427
054795*** 'UNCLEAN RECORDS WRITTEN TO OUT02   = '.                      05479543
054800     MOVE PV-WRITE-2-COUNTER          TO PV-MSG-2-COUNT           05480018
054900     DISPLAY PV-COUNT-MSG-2.                                      05490018
054901                                                                  05490122
054902*** 'UNCLEAN - BOSS RECORDS- TO OUT02   = '.                      05490243
054903     MOVE PV-WRITE-2-BOSS             TO PV-MSG-2-WRITE-BOSS      05490349
054904     DISPLAY PV-COUNT-MSG-2-BOSS.                                 05490447
054905                                                                  05490529
054906*** 'UNCLEAN SEPHORA-SUPPORT DC OUT02   = '.                      05490643
054907     MOVE PV-WRITE-2-SEPH-SUPP        TO PV-MSG-2-WRITE-SEPH-SUPP 05490748
054908     DISPLAY PV-COUNT-MSG-2-SEPH-SUPP.                            05490847
054909                                                                  05490929
054910*** 'UNCLEAN SEPHORA-DIFFERENT DC OUT02 = '.                      05491043
054911     MOVE PV-WRITE-2-SEPH-DIFF        TO PV-MSG-2-WRITE-SEPH-DIFF 05491148
054912     DISPLAY PV-COUNT-MSG-2-SEPH-DIFF.                            05491247
054913                                                                  05491329
054920     DISPLAY ' '.                                                 05492022
055000                                                                  05500018
055381                                                                  05538143
055416                                                                  05541645
055417     DISPLAY ' '.                                                 05541745
055418     DISPLAY 'SKIP COUNTS'                                        05541845
055419     MOVE PV-SKIP-BOSS                     TO PV-DISP-COUNT.      05541943
055420     DISPLAY 'SKIP RECORDS-BOSS:            ' PV-DISP-COUNT.      05542043
055421                                                                  05542143
055422     MOVE PV-SKIP-SEPH-SUPP                TO PV-DISP-COUNT.      05542243
055423     DISPLAY 'SKIP RECORDS-SEPHORA SUPP DC: ' PV-DISP-COUNT.      05542343
055424                                                                  05542443
055425     MOVE PV-SKIP-SEPH-DIFF                TO PV-DISP-COUNT.      05542544
055426     DISPLAY 'SKIP RECORDS-SEPHORA DIFF DC: ' PV-DISP-COUNT.      05542643
055427                                                                  05542743
055428     MOVE PV-SKIP-REGULAR                  TO PV-DISP-COUNT.      05542844
055429     DISPLAY 'SKIP RECORDS-REGULAR:         ' PV-DISP-COUNT.      05542943
055430                                                                  05543043
055440/                                                                 05544018
055500 9100-SQL-ABEND.                                                  05550018
055600******************************************************************05560018
055700*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    05570018
055800*  ERROR OR WARNING CODE OCCURS.                                  05580018
055900******************************************************************05590018
056000     DISPLAY '9100-SQL-ABEND'.                                    05600018
056100     DISPLAY '** ABEND     **'.                                   05610018
056200     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        05620018
056300     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             05630018
056400     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     05640018
056500     DISPLAY '**              ** = '                              05650018
056600     MOVE SQLCODE TO PV-SQL-CODE.                                 05660018
056700     DISPLAY '** SQL CODE  ** = ' PV-SQL-CODE.                    05670018
056800     MOVE +4013 TO PV-ABEND-CODE.                                 05680018
056900     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         05690018
057000                                                                  05700018
057100******************************************************************05710018
057200*  THIS MODULE PERFORMS THE SQL WARNING.                         *05720018
057300******************************************************************05730018
057400                                                                  05740018
057500 9800-SQL-WARNING.                                                05750018
057600                                                                  05760018
057700     MOVE SQLCODE               TO SQLCODE2.                      05770018
057800     MOVE SQLERRD(3)            TO SQLERRD3.                      05780018
057900     DISPLAY '** ABEND **       ** = SQLWARNING'.                 05790018
058000     DISPLAY '** PROGRAM        ** = PCKUT039'.                   05800018
058100     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        05810018
058200     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  05820018
058300     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  05830018
058400                                                                  05840018
058500     COPY DPPD004.                                                05850018
058600     SET ABEND-4013-DB2-ERROR   TO TRUE                           05860018
058700     CALL 'ILBOABN0' USING ABEND-CODE.                            05870018
058800/                                                                 05880018
058900******************************************************************05890018
059000* THIS MODULE PERFORMS THE SQL ERROR.                            *05900018
059100******************************************************************05910018
059200                                                                  05920018
059300 9900-SQL-ERROR.                                                  05930018
059400                                                                  05940018
059500     MOVE SQLCODE               TO SQLCODE2.                      05950018
059600     MOVE SQLERRD(3)            TO SQLERRD3.                      05960018
059700     DISPLAY '** ABEND **       ** = SQLERROR'.                   05970018
059800     DISPLAY '** PROGRAM        ** = PCKUT039'.                   05980018
059900     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        05990018
060000     DISPLAY '** OPERATION      ** = ' PV-ABEND-OPERATION         06000018
060100     DISPLAY '** TABLE          ** = ' PV-ABEND-STRUCTURE-1       06010018
060200     DISPLAY SPACES                                               06020018
060300                                                                  06030018
060400     COPY DPPD004.                                                06040018
060500     SET ABEND-4013-DB2-ERROR   TO TRUE                           06050018
060600     CALL 'ILBOABN0' USING ABEND-CODE.                            06060018
