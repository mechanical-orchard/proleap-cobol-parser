000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    XSKUP004.                                         00020000
000300 AUTHOR.        BARB ERTL.                                        00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  10/15/2002.                                       00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800**       LOCATION MESSAGE TO POPULATE XST_REGN AND XST_REGN_TERR  00080001
000900******************************************************************00090000
001000**THIS IS A CALLED MODULE FOR LOCATION TABLES.  THIS PROGRAM      00100000
001100**     WILL PERFORM UPDATES/INSERTS/DELETES FOR THE XST_REGN AND  00110001
001200**     XST_REGN_TERR TABLES.  IT DOES THE FOLLOWING WITH THESE    00120001
001300**     RETURN CODES:                                              00130001
001400**     0000 - END PROGRAM                                         00140000
001500**    -0530 - END PROGRAM                                         00150000
001600**    -0803 - END PROGRAM                                         00160002
001700**    -0911 - RETRY INSERT UP TO 5 TIMES AND THEN END PROGRAM     00170000
001800******************************************************************00180000
001900 ENVIRONMENT DIVISION.                                            00190000
002000 CONFIGURATION SECTION.                                           00200000
002100 SOURCE-COMPUTER.  IBM-3090.                                      00210000
002200 OBJECT-COMPUTER.  IBM-3090.                                      00220000
002300 DATA DIVISION.                                                   00230000
002400                                                                  00240000
002500 WORKING-STORAGE SECTION.                                         00250000
002600******************************************************************00260000
002700**PROGRAM SWITCHES                                                00270000
002800******************************************************************00280000
002900 01  PS-PROGRAM-SWITCHES.                                         00290000
003000     05  PS-PROCESS-CONTINUE-SW      PIC X(01)  VALUE 'Y'.        00300000
003100         88  PS-PROCESS-CONTINUE                VALUE 'Y'.        00310000
003200         88  PS-PROCESS-COMPLETE                VALUE 'N'.        00320000
003300******************************************************************00330000
003400**PROGRAM CONSTANTS                                               00340001
003500******************************************************************00350000
003600 01  PC-PROGRAM-CONSTANTS.                                        00360001
003700     05  PC-PROGRAM-NAME             PIC X(08)  VALUE 'XSKUP004'. 00370015
003800     05  PC-RETRY-MAX                PIC 9(01)  VALUE 5.          00380000
003900******************************************************************00390000
004000**PROGRAM VARIABLES                                               00400000
004100******************************************************************00410000
004200 01  PV-PROGRAM-VARIABLES.                                        00420000
004300     05  PV-RETRY-COUNTER               PIC  9(01)  VALUE ZEROS.  00430001
004400     05  PV-4-COMP-3                    PIC S9(04) COMP-3 VALUE 0.00440001
004500     05  PV-REGN-TERR-IND               PIC  X(01)  VALUE SPACES. 00450001
004600     05  PV-BEG-DTE                     PIC  X(10)  VALUE SPACES. 00460009
004700******************************************************************00470000
004800**COPYBOOKS                                                       00480000
004900******************************************************************00490000
005000***DB2 MESSAGE AREA                                               00500000
005100*    COPY SQLCA2.                                                 00510019
005200***MESSAGE COPYBOOK                                               00520000
005300     COPY HORD100.                                                00530019
005400***KOHL'S CALENDAR ROUTINE COPYBOOK                               00540016
005500     COPY DPWS500.                                                00550019
005600******************************************************************00560000
005700**TABLE INCLUSIONS                                                00570000
005800******************************************************************00580000
005900***DB2 COMMUNICATIONS AREA                                        00590000
006000     EXEC SQL                                                     00600000
006100          INCLUDE SQLCA                                           00610000
006200     END-EXEC.                                                    00620000
006300* ------------------------------------------------------------- * 00630000
006400*  SQL AND COBOL DECLARATIONS FOR REGION TABLE (XST_REGN)         00640001
006500* ------------------------------------------------------------- * 00650000
006600     EXEC SQL                                                     00660000
006700         INCLUDE XST00005                                         00670001
006800     END-EXEC.                                                    00680000
006900                                                                  00690000
007000* ------------------------------------------------------------- * 00700001
007100*  SQL AND COBOL DECLARATIONS FOR REGION/TERR TABLE               00710001
007200*  (XST_REGN_TERR)                                                00720001
007300* ------------------------------------------------------------- * 00730001
007400     EXEC SQL                                                     00740001
007500         INCLUDE XST00006                                         00750001
007600     END-EXEC.                                                    00760001
007700                                                                  00770001
007800 LINKAGE SECTION.                                                 00780000
007900******************************************************************00790000
008000**LINKAGE VARIABLES                                               00800000
008100******************************************************************00810000
008200 01  LV-LINKAGE-VARIABLES.                                        00820006
008300     05  LV-HORD100-RECORD               PIC X(500).              00830006
008400     05  LV-RETURN-CODE                  PIC S9(04).              00840006
008500                                                                  00850000
008600 PROCEDURE DIVISION USING LV-LINKAGE-VARIABLES.                   00860006
008700******************************************************************00870000
008800 0000-MAINLINE.                                                   00880000
008900                                                                  00890000
009000      PERFORM 1000-INITIALIZATION.                                00900000
009100      IF PS-PROCESS-CONTINUE                                      00910017
009200          PERFORM 2000-PROCESS-MESSAGE                            00920017
009300      END-IF.                                                     00930017
009400      PERFORM 9999-WRAPUP.                                        00940000
009500                                                                  00950000
009600***************************************************************** 00960000
009700**INITIALIZATION AREA - ALL MOVES TO UPDATE/INSERT                00970000
009800***************************************************************** 00980000
009900 1000-INITIALIZATION.                                             00990000
010000                                                                  01000000
010100     INITIALIZE PV-RETRY-COUNTER.                                 01010001
010200     SET PS-PROCESS-CONTINUE TO TRUE.                             01020011
010300                                                                  01030000
010400     MOVE LV-HORD100-RECORD          TO HORD100-RECORD.           01040000
010500     MOVE HO100-REGION               TO  XST00005-REGN-NBR        01050001
010600                                         XST00006-REGN-NBR.       01060001
010700     MOVE HO100-REGION-AREA-NAME     TO  XST00005-REGN-NM.        01070001
010800     MOVE HO100-REGION-MGR-NAME      TO  XST00005-REGN-MGR-NM.    01080001
010900     MOVE HO100-REGION-AREA          TO  XST00006-TERR-NBR.       01090001
011000                                                                  01100000
011100     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              01110012
011200                                                                  01120012
011300     EXEC SQL                                                     01130009
011400         SET :DPG52-LK-DATE-INPUT = CURRENT DATE                  01140012
011500     END-EXEC.                                                    01150009
011600                                                                  01160012
011700     SET DPG51-FISCAL-454-CALENDAR                                01170012
011800         DPG52-LK-DTE-ISO-FMT TO TRUE.                            01180012
011900                                                                  01190012
012000     PERFORM 1500-CALL-CALENDAR-ROUTINE.                          01200012
012100                                                                  01210012
012200     MOVE DPG56-FIRST-FP-DB2-ISO-FMT TO XST00006-BEG-DTE.         01220012
012300                                                                  01230012
012400     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              01240012
012500                                                                  01250012
012600     MOVE XST00006-BEG-DTE TO DPG52-LK-DATE-INPUT.                01260012
012700                                                                  01270012
012800     SET DPG51-ACTUAL-CALENDAR-ONLY                               01280012
012900         DPG51-DECREMENT-DATE                                     01290012
013000         DPG52-LK-DTE-ISO-FMT TO TRUE.                            01300012
013100                                                                  01310012
013200     MOVE 1 TO DPG51-INCR-DECR-DAYS-9.                            01320012
013300                                                                  01330012
013400     PERFORM 1500-CALL-CALENDAR-ROUTINE.                          01340012
013500                                                                  01350012
013600     MOVE DPG55-DB2-ISO-DATE-FMT TO XST00006-END-DTE.             01360012
013700                                                                  01370012
013800***************************************************************** 01380012
013900**CALL CALENDAR ROUTINE FOR BEGINNING AND ENDING DATES.           01390012
014000***************************************************************** 01400012
014100 1500-CALL-CALENDAR-ROUTINE.                                      01410012
014200                                                                  01420012
014300     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                01430012
014400                                             DPG52                01440012
014500                                             DPG53                01450012
014600                                             DPG54                01460012
014700                                             DPG55                01470012
014800                                             DPG56.               01480012
014900                                                                  01490012
015000     EVALUATE TRUE                                                01500012
015100         WHEN DPG54-SEVERE-ERROR                                  01510012
015200         WHEN DPG54-WARNING-ERROR                                 01520012
015300             DISPLAY ' '                                          01530012
015400             DISPLAY '** ABEND     **'                            01540012
015500             DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME        01550012
015600             DISPLAY '** PARAGRAPH **  = '                        01560014
015700                                    '1500-CALL-CALENDAR-ROUTINE'  01570014
015800             DISPLAY '** BAD CALL TO CALENDAR MODULE '            01580012
015900                     DP500-KOHLS-CALENDAR-ROUTINE                 01590012
016000             DISPLAY '** DETERMINE VALID DATE **'                 01600012
016100             DISPLAY 'DATE = ' DPG52-LK-DATE-INPUT                01610012
016200             DISPLAY DPG54-ERROR-MESSAGE                          01620012
016300             DISPLAY ' '                                          01630012
016400             SET PS-PROCESS-COMPLETE TO TRUE                      01640015
016500             MOVE +4019 TO LV-RETURN-CODE                         01650015
016600     END-EVALUATE.                                                01660012
016700                                                                  01670012
016800***************************************************************** 01680000
016900**MAIN PROGRAM LOGIC - READS ACTION TYPE ON HORD100 RECORD        01690000
017000***************************************************************** 01700000
017100 2000-PROCESS-MESSAGE.                                            01710000
017200                                                                  01720000
017300     EVALUATE TRUE                                                01730000
017400        WHEN HO100-ACTN-TYP-INSERT                                01740000
017500             PERFORM 2100-INSERT-DATA                             01750000
017600             IF PS-PROCESS-CONTINUE                               01760001
017700                 IF HO100-REGION-AREA EQUAL SPACES                01770001
017800                     SET PS-PROCESS-COMPLETE TO TRUE              01780001
017900                 ELSE                                             01790001
018000                     PERFORM 3100-INSERT-REGN-TERR                01800001
018100                 END-IF                                           01810001
018200             END-IF                                               01820001
018300                                                                  01830001
018400        WHEN HO100-ACTN-TYP-UPDATE                                01840000
018500             PERFORM 2200-UPDATE-DATA                             01850000
018600             IF PS-PROCESS-CONTINUE                               01860001
018700                 IF HO100-REGION-AREA EQUAL SPACES                01870001
018800                     SET PS-PROCESS-COMPLETE TO TRUE              01880001
018900                 ELSE                                             01890001
019000                     MOVE 0      TO PV-4-COMP-3                   01900009
019100                     MOVE SPACES TO PV-BEG-DTE                    01910009
019200                     PERFORM 3200-SELECT-REGN-TERR-ROW            01920001
019300                     IF PV-4-COMP-3 = XST00006-TERR-NBR           01930001
019400                         SET PS-PROCESS-COMPLETE TO TRUE          01940002
019500                     ELSE                                         01950001
019600                         IF PV-4-COMP-3 = 0                       01960002
019700                             PERFORM 3100-INSERT-REGN-TERR        01970002
019800                         ELSE                                     01980002
019900                             IF PV-BEG-DTE < XST00006-BEG-DTE     01990018
020000                                 PERFORM 3300-UPDATE-REGN-TERR-ROW02000009
020100                             ELSE                                 02010009
020200                                 PERFORM 3400-DELETE-REGN-TERR-ROW02020009
020300                             END-IF                               02030009
020400                             IF PS-PROCESS-CONTINUE               02040002
020500                                 PERFORM 3100-INSERT-REGN-TERR    02050002
020600                             END-IF                               02060002
020700                         END-IF                                   02070002
020800                     END-IF                                       02080002
020900                 END-IF                                           02090001
021000             END-IF                                               02100001
021100                                                                  02110001
021200        WHEN HO100-ACTN-TYP-DELETE                                02120000
021300             PERFORM 2400-SELECT-REGN-TERR                        02130001
021400             IF PS-PROCESS-CONTINUE                               02140001
021500                 PERFORM 2300-DELETE-DATA                         02150001
021600             END-IF                                               02160001
021700     END-EVALUATE.                                                02170000
021800                                                                  02180000
021900***************************************************************** 02190000
022000**INSERT ACTION TYPE                                              02200000
022100***************************************************************** 02210000
022200 2100-INSERT-DATA.                                                02220000
022300                                                                  02230000
022400     PERFORM                                                      02240001
022500         WITH TEST AFTER                                          02250001
022600         VARYING PV-RETRY-COUNTER                                 02260001
022700         FROM 1 BY 1                                              02270001
022800         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    02280004
022900            OR SQLCODE = 0                                        02290001
023000            OR PS-PROCESS-COMPLETE                                02300001
023100                                                                  02310001
023200         EXEC SQL                                                 02320001
023300             INSERT INTO XST_REGN                                 02330001
023400                      (REGN_NBR                                   02340001
023500                     , REGN_NM                                    02350001
023600                     , REGN_MGR_NM)                               02360001
023700             VALUES (: XST00005-REGN-NBR                          02370001
023800                   , : XST00005-REGN-NM                           02380001
023900                   , : XST00005-REGN-MGR-NM)                      02390001
024000         END-EXEC                                                 02400001
024100                                                                  02410000
024200         EVALUATE TRUE                                            02420001
024300             WHEN SQLCODE = -911                                  02430001
024400             WHEN SQLCODE = -913                                  02440001
024500             WHEN SQLCODE = 0                                     02450001
024600                 CONTINUE                                         02460001
024700             WHEN SQLWARN0 NOT = SPACE                            02470001
024800             WHEN SQLCODE NOT =  ZERO                             02480001
024900                 SET PS-PROCESS-COMPLETE TO TRUE                  02490001
025000         END-EVALUATE                                             02500001
025100     END-PERFORM.                                                 02510001
025200                                                                  02520001
025300     EVALUATE TRUE                                                02530000
025400        WHEN SQLCODE = 0                                          02540001
025500            CONTINUE                                              02550001
025600        WHEN OTHER                                                02560000
025700             SET PS-PROCESS-COMPLETE     TO TRUE                  02570000
025800     END-EVALUATE.                                                02580000
025900                                                                  02590000
026000******************************************************************02600000
026100**UPDATE ACTION TYPE                                              02610000
026200******************************************************************02620000
026300 2200-UPDATE-DATA.                                                02630000
026400                                                                  02640000
026500     PERFORM                                                      02650001
026600         WITH TEST AFTER                                          02660001
026700         VARYING PV-RETRY-COUNTER                                 02670001
026800         FROM 1 BY 1                                              02680001
026900         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    02690004
027000            OR SQLCODE = 0                                        02700001
027100            OR PS-PROCESS-COMPLETE                                02710001
027200                                                                  02720001
027300         EXEC SQL                                                 02730001
027400             UPDATE XST_REGN                                      02740001
027500             SET REGN_NM       = : XST00005-REGN-NM               02750001
027600               , REGN_MGR_NM   = : XST00005-REGN-MGR-NM           02760001
027700             WHERE (REGN_NBR   = : XST00005-REGN-NBR)             02770001
027800         END-EXEC                                                 02780001
027900                                                                  02790001
028000         EVALUATE TRUE                                            02800001
028100             WHEN SQLCODE = -911                                  02810001
028200             WHEN SQLCODE = -913                                  02820001
028300             WHEN SQLCODE = 0                                     02830001
028400                 CONTINUE                                         02840001
028500             WHEN SQLWARN0 NOT = SPACE                            02850001
028600             WHEN SQLCODE NOT =  ZERO                             02860001
028700                 SET PS-PROCESS-COMPLETE TO TRUE                  02870001
028800         END-EVALUATE                                             02880001
028900     END-PERFORM.                                                 02890001
029000                                                                  02900001
029100     EVALUATE TRUE                                                02910000
029200        WHEN SQLCODE = 0                                          02920001
029300            CONTINUE                                              02930001
029400        WHEN OTHER                                                02940000
029500             SET PS-PROCESS-COMPLETE     TO TRUE                  02950000
029600     END-EVALUATE.                                                02960000
029700                                                                  02970000
029800******************************************************************02980000
029900**DELETE TYPE ACTION                                              02990000
030000******************************************************************03000000
030100 2300-DELETE-DATA.                                                03010000
030200                                                                  03020000
030300     PERFORM                                                      03030001
030400         WITH TEST AFTER                                          03040001
030500         VARYING PV-RETRY-COUNTER                                 03050001
030600         FROM 1 BY 1                                              03060001
030700         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    03070004
030800            OR SQLCODE = 0                                        03080001
030900            OR PS-PROCESS-COMPLETE                                03090001
031000                                                                  03100001
031100           EXEC SQL                                               03110003
031200               DELETE FROM XST_REGN                               03120003
031300               WHERE REGN_NBR   = : XST00005-REGN-NBR             03130003
031400           END-EXEC                                               03140003
031500                                                                  03150000
031600         EVALUATE TRUE                                            03160001
031700             WHEN SQLCODE = -911                                  03170001
031800             WHEN SQLCODE = -913                                  03180001
031900             WHEN SQLCODE = 0                                     03190001
032000                 CONTINUE                                         03200001
032100             WHEN SQLWARN0 NOT = SPACE                            03210001
032200             WHEN SQLCODE NOT =  ZERO                             03220001
032300                 SET PS-PROCESS-COMPLETE TO TRUE                  03230001
032400         END-EVALUATE                                             03240001
032500     END-PERFORM.                                                 03250001
032600                                                                  03260001
032700     SET PS-PROCESS-COMPLETE     TO TRUE.                         03270001
032800                                                                  03280000
032900******************************************************************03290001
033000**SELECT REGN_TERR ROW FOR DELETED REGION                         03300001
033100******************************************************************03310001
033200 2400-SELECT-REGN-TERR.                                           03320001
033300                                                                  03330001
033400     EXEC SQL                                                     03340001
033500         SELECT 'Y'                                               03350001
033600           INTO :PV-REGN-TERR-IND                                 03360001
033700           FROM XST_REGN_TERR                                     03370001
033800          WHERE  REGN_NBR = :XST00006-REGN-NBR                    03380001
033900     END-EXEC                                                     03390001
034000                                                                  03400001
034100     EVALUATE TRUE                                                03410001
034200        WHEN SQLCODE = 0                                          03420001
034300        WHEN SQLCODE = -811                                       03430001
034400            SET PS-PROCESS-COMPLETE     TO TRUE                   03440001
034500        WHEN OTHER                                                03450001
034600            CONTINUE                                              03460001
034700     END-EVALUATE.                                                03470001
034800                                                                  03480001
034900******************************************************************03490001
035000**INSERT REGN_TERR ROW                                            03500001
035100******************************************************************03510001
035200 3100-INSERT-REGN-TERR.                                           03520001
035300                                                                  03530001
035400     PERFORM                                                      03540001
035500         WITH TEST AFTER                                          03550001
035600         VARYING PV-RETRY-COUNTER                                 03560001
035700         FROM 1 BY 1                                              03570001
035800         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    03580004
035900            OR SQLCODE = 0                                        03590001
036000            OR PS-PROCESS-COMPLETE                                03600001
036100                                                                  03610001
036200         EXEC SQL                                                 03620001
036300             INSERT INTO XST_REGN_TERR                            03630001
036400                      (REGN_NBR                                   03640001
036500                     , TERR_NBR                                   03650001
036600                     , BEG_DTE)                                   03660001
036700             VALUES (: XST00006-REGN-NBR                          03670001
036800                   , : XST00006-TERR-NBR                          03680001
036900                   , : XST00006-BEG-DTE)                          03690009
037000         END-EXEC                                                 03700001
037100                                                                  03710001
037200         EVALUATE TRUE                                            03720001
037300             WHEN SQLCODE = -911                                  03730001
037400             WHEN SQLCODE = -913                                  03740001
037500             WHEN SQLCODE = 0                                     03750001
037600                 CONTINUE                                         03760001
037700             WHEN SQLWARN0 NOT = SPACE                            03770001
037800             WHEN SQLCODE NOT =  ZERO                             03780001
037900                 SET PS-PROCESS-COMPLETE TO TRUE                  03790001
038000         END-EVALUATE                                             03800001
038100     END-PERFORM.                                                 03810001
038200                                                                  03820001
038300     SET PS-PROCESS-COMPLETE TO TRUE.                             03830001
038400                                                                  03840001
038500******************************************************************03850001
038600**SELECT CURRENT REGN_TERR ROW                                    03860001
038700******************************************************************03870001
038800 3200-SELECT-REGN-TERR-ROW.                                       03880001
038900                                                                  03890001
039000     PERFORM                                                      03900001
039100         WITH TEST AFTER                                          03910001
039200         VARYING PV-RETRY-COUNTER                                 03920001
039300         FROM 1 BY 1                                              03930001
039400         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    03940004
039500            OR SQLCODE = 0                                        03950001
039600            OR SQLCODE = +100                                     03960001
039700            OR PS-PROCESS-COMPLETE                                03970001
039800                                                                  03980001
039900         EXEC SQL                                                 03990001
040000             SELECT TERR_NBR                                      04000001
040100                   ,BEG_DTE                                       04010009
040200               INTO :PV-4-COMP-3                                  04020001
040300                   ,:PV-BEG-DTE                                   04030009
040400               FROM XST_REGN_TERR                                 04040001
040500              WHERE  REGN_NBR = :XST00006-REGN-NBR                04050001
040600                AND  END_DTE IS NULL                              04060008
040700         END-EXEC                                                 04070001
040800                                                                  04080001
040900         EVALUATE TRUE                                            04090001
041000             WHEN SQLCODE = -911                                  04100001
041100             WHEN SQLCODE = -913                                  04110001
041200             WHEN SQLCODE = 0                                     04120001
041300             WHEN SQLCODE = +100                                  04130001
041400                 CONTINUE                                         04140001
041500             WHEN SQLWARN0 NOT = SPACE                            04150001
041600             WHEN SQLCODE NOT =  ZERO                             04160001
041700                 SET PS-PROCESS-COMPLETE TO TRUE                  04170001
041800         END-EVALUATE                                             04180001
041900     END-PERFORM.                                                 04190001
042000                                                                  04200001
042100     EVALUATE TRUE                                                04210001
042200        WHEN SQLCODE = 0                                          04220001
042300        WHEN SQLCODE = +100                                       04230001
042400            CONTINUE                                              04240001
042500        WHEN OTHER                                                04250001
042600             SET PS-PROCESS-COMPLETE     TO TRUE                  04260001
042700     END-EVALUATE.                                                04270001
042800                                                                  04280001
042900******************************************************************04290001
043000**UPDATE REGN_TERR                                                04300001
043100******************************************************************04310001
043200 3300-UPDATE-REGN-TERR-ROW.                                       04320001
043300                                                                  04330001
043400     PERFORM                                                      04340001
043500         WITH TEST AFTER                                          04350001
043600         VARYING PV-RETRY-COUNTER                                 04360001
043700         FROM 1 BY 1                                              04370001
043800         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    04380004
043900            OR SQLCODE = 0                                        04390001
044000            OR SQLCODE = +100                                     04400001
044100            OR PS-PROCESS-COMPLETE                                04410001
044200                                                                  04420001
044300         EXEC SQL                                                 04430001
044400           UPDATE XST_REGN_TERR                                   04440001
044500              SET END_DTE = :XST00006-END-DTE                     04450012
044600            WHERE  REGN_NBR = :XST00006-REGN-NBR                  04460001
044700              AND  TERR_NBR = :PV-4-COMP-3                        04470009
044800              AND  BEG_DTE  = :PV-BEG-DTE                         04480009
044900              AND END_DTE IS NULL                                 04490001
045000         END-EXEC                                                 04500001
045100                                                                  04510001
045200         EVALUATE TRUE                                            04520001
045300             WHEN SQLCODE = -911                                  04530001
045400             WHEN SQLCODE = -913                                  04540001
045500             WHEN SQLCODE = 0                                     04550001
045600             WHEN SQLCODE = +100                                  04560001
045700                  CONTINUE                                        04570001
045800             WHEN SQLWARN0 NOT = SPACE                            04580001
045900             WHEN SQLCODE NOT = ZERO                              04590001
046000                 SET PS-PROCESS-COMPLETE TO TRUE                  04600001
046100         END-EVALUATE                                             04610001
046200     END-PERFORM.                                                 04620001
046300                                                                  04630001
046400                                                                  04640001
046500     EVALUATE TRUE                                                04650001
046600        WHEN SQLCODE = 0                                          04660001
046700        WHEN SQLCODE = +100                                       04670001
046800            CONTINUE                                              04680001
046900        WHEN OTHER                                                04690001
047000             SET PS-PROCESS-COMPLETE     TO TRUE                  04700001
047100     END-EVALUATE.                                                04710001
047200                                                                  04720001
047300******************************************************************04730009
047400**DELETE REGN_TERR                                                04740009
047500******************************************************************04750009
047600 3400-DELETE-REGN-TERR-ROW.                                       04760009
047700                                                                  04770009
047800     PERFORM                                                      04780009
047900         WITH TEST AFTER                                          04790009
048000         VARYING PV-RETRY-COUNTER                                 04800009
048100         FROM 1 BY 1                                              04810009
048200         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    04820009
048300            OR SQLCODE = 0                                        04830009
048400            OR SQLCODE = +100                                     04840009
048500            OR PS-PROCESS-COMPLETE                                04850009
048600                                                                  04860009
048700         EXEC SQL                                                 04870009
048800           DELETE FROM XST_REGN_TERR                              04880009
048900            WHERE  REGN_NBR = :XST00006-REGN-NBR                  04890009
049000              AND  TERR_NBR = :PV-4-COMP-3                        04900009
049100              AND  BEG_DTE  = :PV-BEG-DTE                         04910009
049200              AND END_DTE IS NULL                                 04920009
049300         END-EXEC                                                 04930009
049400                                                                  04940009
049500         EVALUATE TRUE                                            04950009
049600             WHEN SQLCODE = -911                                  04960009
049700             WHEN SQLCODE = -913                                  04970009
049800             WHEN SQLCODE = 0                                     04980009
049900             WHEN SQLCODE = +100                                  04990009
050000                  CONTINUE                                        05000009
050100             WHEN SQLWARN0 NOT = SPACE                            05010009
050200             WHEN SQLCODE NOT = ZERO                              05020009
050300                 SET PS-PROCESS-COMPLETE TO TRUE                  05030009
050400         END-EVALUATE                                             05040009
050500     END-PERFORM.                                                 05050009
050600                                                                  05060009
050700                                                                  05070009
050800     EVALUATE TRUE                                                05080009
050900        WHEN SQLCODE = 0                                          05090009
051000        WHEN SQLCODE = +100                                       05100009
051100            CONTINUE                                              05110009
051200        WHEN OTHER                                                05120009
051300             SET PS-PROCESS-COMPLETE     TO TRUE                  05130009
051400     END-EVALUATE.                                                05140009
051500******************************************************************05150000
051600**PASS SQLCODE TO CALLING AND EXIT PROGRAM                        05160000
051700******************************************************************05170000
051800 9999-WRAPUP.                                                     05180000
051900                                                                  05190000
052000     IF LV-RETURN-CODE = 0                                        05200015
052100         MOVE SQLCODE       TO LV-RETURN-CODE                     05210015
052200     END-IF.                                                      05220015
052300                                                                  05230000
052400     EXIT PROGRAM.                                                05240000
