000100 IDENTIFICATION DIVISION.                                         00010003
000200 PROGRAM-ID.     APKUT072.                                        00020003
000300 AUTHOR.         ROBIN BERNOSKI.                                        03
000400 DATE-WRITTEN.   JULY 1998.                                       00040004
000500 DATE-COMPILED.                                                   00050003
000600***************************************************************** 00060016
000700*    COBOL 2 WITH SQL                                           * 00070016
000800*        - CALCULATE AGE OF IMPORT ACCOUNT BALANCES -           * 00080019
000900*                                                               * 00090016
001000*  THIS PROGRAM DETERMINES WHICH AGE CATEGORY EACH OPEN         * 00100016
001100*  IMPORT COST BELONGS IN.  TO DEFINE THE OPEN COSTS, A FILE    * 00110016
001200*  OF THE INVOICES EXTRACTED IN THE CURRENT DAYS PROCESSING     * 00120016
001300*  IS USED.  HOWEVER, SOME OF THESE INVOICES MAY HAVE BEEN      * 00120016
001400*  JOURNALIZED AT A LATER POINT IN THE PROCESS AND ARE NO       * 00120016
001500*  LONGER OPEN BALANCES, SO THEY NEED TO BE IDENTIFIED BY       * 00130016
001600*  LOOKING FOR THE PO ON THE TPOSTRR TABLE AND ELIMINATING      * 00130016
001700*  INVOICES FOR THOSE POS FOUND.                                * 00130016
001800*                                                               * 00130016
001900* INPUT:                                                        * 00140016
002000*  1. IMPORT INVOICE COSTS             (APRD063)                * 00150016
002100*  2. RELEASED PO/STORES               (TPOSTRR)                * 00180016
002200*  3. AP CONTROL TABLE                 (TAPCNTL)                * 00200016
002300*                                                               * 00210016
002400* OUTPUT:                                                       * 00220016
002500*  1. IMPORT COSTS IN AGE CATEGORIES   (APRD068)                * 00230016
002600*                                                               * 00240016
002700***************************************************************** 00250016
002800* CHANGE LOG:                                                   * 00260052
002900* 07/01/98   INITIAL VERSION.   WR4164                          * 00270057
002900* 03/11/07   GREG WISIALOWSKI   WR21578                         * 00270057
      *            MBDC PROJECT. RECOMPILE                                      
003000***************************************************************** 00280052
003100                                                                  00320003
003200 ENVIRONMENT DIVISION.                                            00330003
003300 CONFIGURATION SECTION.                                           00340003
003400 SOURCE-COMPUTER.    IBM-3090.                                    00350003
003500 OBJECT-COMPUTER.    IBM-3090.                                    00360003
003600                                                                  00370003
003700 INPUT-OUTPUT SECTION.                                            00380003
003800 FILE-CONTROL.                                                    00390003
003900     SELECT IMPORT-INV-COST-FILE  ASSIGN TO UT-S-INP01.                 20
004000     SELECT IMPORT-AGE-FILE       ASSIGN TO UT-S-OUT01.           00430008
004100                                                                  00440003
004200 DATA DIVISION.                                                   00450003
004300 FILE SECTION.                                                    00460003
004400                                                                  00470003
004500 FD  IMPORT-INV-COST-FILE                                               04
004600     RECORDING MODE IS F                                          00490003
004700     LABEL RECORDS ARE STANDARD                                   00500003
004800     DATA RECORD IS IMPORT-INV-COST-REC.                          00510004
004900 01  IMPORT-INV-COST-REC.                                         00520004
005000     05 FILLER                        PIC  X(120).                00530003
005100                                                                  00540003
005200 FD  IMPORT-AGE-FILE                                              00690008
005300     RECORDING MODE IS F                                          00700008
005400     LABEL RECORDS ARE STANDARD                                   00710008
005500     BLOCK CONTAINS 0 RECORDS                                     00720008
005600     DATA RECORD IS IMPORT-AGE-REC.                               00730008
005700 01  IMPORT-AGE-REC.                                              00740008
005800     05 FILLER                        PIC  X(100).                00750008
005900                                                                  00760003
006000 WORKING-STORAGE SECTION.                                         00770003
006100                                                                  00780003
006200 01  PC-PROGRAM-CONSTANTS.                                        00790003
006300     05  FILLER                        PIC  X(30)  VALUE          00800003
006400         '** BEGINING OF APKUT072 W/S **'.                        00810003
006500                                                                  00820004
006600     05  PC-PROGRAM-NAME             PIC X(08)  VALUE 'APKUT072'. 00830012
006700                                                                  00850004
006800 01  DATE-TIME-AGE-30.                                                  41
006900     05  DATE-AGE-30               PIC X(10)   VALUE SPACES.            41
007000     05  TIME-AGE-30               PIC X(16)   VALUE                    41
007100                                       '-00.00.00.000000'.                
007200 01  DT-AGE-30-RESULTS             PIC X(26) VALUE SPACES.              41
007300                                                                          
007400 01  DATE-TIME-AGE-60.                                                  41
007500     05  DATE-AGE-60               PIC X(10)   VALUE SPACES.            41
007600     05  TIME-AGE-60               PIC X(16)   VALUE                    41
007700                                       '-00.00.00.000000'.                
007800 01  DT-AGE-60-RESULTS             PIC X(26) VALUE SPACES.              41
007900                                                                          
008000 01  DATE-TIME-AGE-90.                                                  41
008100     05  DATE-AGE-90               PIC X(10)   VALUE SPACES.            41
008200     05  TIME-AGE-90               PIC X(16)   VALUE                    41
008300                                       '-00.00.00.000000'.                
008400 01  DT-AGE-90-RESULTS             PIC X(26) VALUE SPACES.              41
008500                                                                          
008600 01  DATE-TIME-AGE-120.                                                 41
008700     05  DATE-AGE-120              PIC X(10)   VALUE SPACES.            41
008800     05  TIME-AGE-120              PIC X(16)   VALUE                    41
008900                                       '-00.00.00.000000'.                
009000 01  DT-AGE-120-RESULTS            PIC X(26) VALUE SPACES.              41
009100                                                                          
009200 01  PV-PROGRAM-VARIABLES.                                        00860003
009300                                                                          
009400     05  PV-HOLD-PO-NBR                PIC 9(09)  VALUE ZEROS.          10
009500                                                                        04
009600     05  PV-PO-IN-PROCESS-9            PIC 9(09)   VALUE ZEROS.         54
009700     05  PV-DATE-TIME-FIELDS.                                     01000024
009800         10  PV-CURR-DB2-DATE.                                            
009900             15  PV-CURR-DB2-CENT      PIC  9(02)  VALUE 19.              
010000             15  PV-CURR-DB2-YEAR      PIC  9(02)  VALUE ZEROS.           
010100             15  FILLER                PIC  X(01)  VALUE '-'.             
010200             15  PV-CURR-DB2-MONTH     PIC  9(02)  VALUE ZEROS.           
010300             15  FILLER                PIC  X(02)  VALUE '-'.             
010400             15  PV-CURR-DB2-DAY       PIC  9(02)  VALUE ZEROS.           
010500         10  PV-CURR-JULIAN-DATE       PIC  9(05)  VALUE ZEROS.         24
010600                                                                  01190024
010700     05  PV-COUNTERS.                                                   41
010800         10  PV-COUNT-POCSR-READ       PIC  9(07).                      50
010900         10  PV-COUNT-PO-READ          PIC  9(07).                      41
011000         10  PV-COUNT-ENT-WROTE        PIC  9(07).                      41
011100                                                                          
011200 01  PS-PROGRAM-SWITCHES.                                         01270003
011300     05  PS-END-OF-POS-SW        PIC X(01)        VALUE 'N'.      01280041
011400         88  END-OF-POS                           VALUE 'Y'.      01290028
011500     05  PS-FOUND-PO-ROWS-SW     PIC X(01)        VALUE 'N'.      01300033
011600         88  NEW-PO-ROWS                          VALUE 'N'.      01310033
011700         88  FOUND-PO-ROWS                        VALUE 'Y'.      01320033
011800     05  PS-END-OF-PO-CSR-SW     PIC X(01)        VALUE 'N'.      01330004
011900         88  NEW-PO-CSR                           VALUE 'N'.      01340028
012000         88  END-OF-PO-CSR                        VALUE 'Y'.      01350004
012100     05  PS-END-OF-RCVR-FILE-SW   PIC X(01)       VALUE 'N'.      01360028
012200         88  END-OF-RCVR-FILE                     VALUE 'Y'.      01370028
012300     05  PS-END-OF-ELC-VAR-SW    PIC X(01)        VALUE 'N'.      01380028
012400         88  END-OF-ELC-VAR                       VALUE 'Y'.      01390028
012500     05  PS-ELC-COSTS-FOUND-SW   PIC X(01)        VALUE 'N'.      01391068
012600         88  ELC-COSTS-NOT-FOUND                  VALUE 'N'.      01392068
012700         88  ELC-COSTS-FOUND                      VALUE 'Y'.      01393068
012800                                                                  01400003
012900*----------------------------------------------------------------*01710003
013000* COMMUNICATIONS AREA2 FOR DB2                                   *01720004
013100*----------------------------------------------------------------*01760003
013200     COPY SQLCA2.                                                 01440003
013300                                                                  01450003
013400     EXEC SQL                                                     01460003
013500          INCLUDE SQLCA                                           01470003
013600     END-EXEC.                                                    01480003
013700                                                                          
013800*----------------------------------------------------------------*01710003
013900* RELEASED PO/STORES TABLE                                       *01720004
014000*----------------------------------------------------------------*01760003
014100     EXEC SQL                                                     01530004
014200          INCLUDE TPOSTRR                                         01540004
014300     END-EXEC.                                                    01550004
014400                                                                          
014500*----------------------------------------------------------------*01710003
014600* AP CONTROL TABLE                                               *01720004
014700*----------------------------------------------------------------*01660004
014800     EXEC SQL                                                     01670004
014900          INCLUDE TAPCNTL                                         01680004
015000     END-EXEC.                                                    01690004
015100                                                                  01700003
015200*----------------------------------------------------------------*01710003
015300*  PO_CSR WILL RETRIEVE THE PO NUMBER FROM TPOSTRR WHERE THE     *01720004
015400*  PO IS BATCH MATCHED AND PROCESSED.                            *01730004
015500*----------------------------------------------------------------*01760003
015600     EXEC SQL                                                     01770003
015700       DECLARE PO_CSR CURSOR FOR                                  01780004
015800         SELECT  PO_NBR                                           01790003
015900         FROM    TPOSTRR                                          01800004
016000         WHERE CRE_PRC_CDE         = 'B'                          01810004
016100           AND STATUS_CDE          = 'P'                          01820034
016200         ORDER BY PO_NBR                                          01830004
016300     END-EXEC.                                                    01840003
016400                                                                          
016500*----------------------------------------------------------------*01910004
016600*  IMPORT PO - INVOICE ACTUAL AND ESTIMATED LANDED COST COMPONENT 01920004
016700*----------------------------------------------------------------*01930004
016800     COPY APRD063.                                                01940004
016900                                                                  01950004
017000*----------------------------------------------------------------*02010004
017100*  IMPORT PO - IMPORT ACCOUNT ACTIVITY AND BALANCE REPORT FILE    02020004
017200*----------------------------------------------------------------*02030004
017300     COPY APRD068.                                                02040004
017400                                                                  02050004
017500*----------------------------------------------------------------*02060024
017600*  WORKING STORAGE AREA FOR DPKUT500, DATE MANIPULATION ROUTINE  *02070024
017700*----------------------------------------------------------------*02080024
017800     COPY DPWS500.                                                02090024
017900                                                                  02100024
018000*----------------------------------------------------------------*02110003
018100*  ABEND DATA AREAS                                              *02120003
018200*----------------------------------------------------------------*02130003
018300 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          02140003
018400                                             COMP SYNC.           02150003
018500     88  AC-BAD-DATA                         VALUE +4003.         02160003
018600     88  AC-DB2-ERROR                        VALUE +4013.         02170003
018700     88  AC-DATE-ERROR                       VALUE +4019.         02180003
018800                                                                  02190003
018900 01  ABEND-AREAS.                                                 02200003
019000     05  AA-ABEND-LIT            PIC  X(40)  VALUE                02210003
019100             '*****       ABEND'.                                 02220003
019200     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                02230003
019300             '*****   PROGRAM: APKUT072'.                         02240003
019400     05  AA-PARAGRAPH-LIT.                                        02250003
019500         10  FILLER              PIC  X(17)  VALUE                02260003
019600             '***** PARAGRAPH: '.                                 02270003
019700         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        02280003
019800     05  AA-MESSAGE-LINE.                                         02290003
019900         10  FILLER              PIC  X(06)  VALUE '*****'.       02300003
020000         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        02310003
020100     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                02320003
020200             '*****    DB2 ERROR'.                                02330003
020300     05  AA-DB2-OPERATION-LIT.                                    02340003
020400         10  FILLER              PIC  X(17)  VALUE                02350003
020500             '***** OPERATION: '.                                 02360003
020600         10  AA-DB2-OPERATION.                                    02370003
020700             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        02380003
020800             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        02390003
020900     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        02400003
021000     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        02410003
021100     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        02420003
021200     05  AA-DB2-TABLE-4          PIC  X(08)  VALUE SPACES.        02430003
021300                                                                          
021400     COPY DPWS004.                                                02450003
021500 01  FILLER                      PIC  X(25)  VALUE                02460003
021600     '** END OF APKUT072 W/S **'.                                 02470003
021700                                                                  02480003
021800 PROCEDURE DIVISION.                                              02490003
021900 A100-MAIN.                                                       02500003
022000                                                                  02510003
022100     PERFORM B100-INITIALIZATION.                                 02520004
022200                                                                  02530003
022300     PERFORM B200-PROCESS-POS                                     02540004
022400       UNTIL END-OF-POS                                           02550029
022500         AND END-OF-PO-CSR.                                       02560029
022600                                                                  02570003
022700     PERFORM B300-END-PROGRAM.                                    02580003
022800                                                                  02590003
022900     GOBACK.                                                      02600003
023000                                                                  02610003
023100                                                                  02620012
023200 B100-INITIALIZATION.                                             02630004
023300******************************************************************02640003
023400*    INITIALIZATION PROCESS AND INITIAL READS FOR THE INPUT.     *02650003
023500******************************************************************02660003
023600                                                                  02670003
023700     OPEN INPUT  IMPORT-INV-COST-FILE                                   04
023800          OUTPUT IMPORT-AGE-FILE.                                 02720007
023900                                                                  02740003
024000     INITIALIZE DCLTPOSTRR                                        02750003
024100                DCLTAPCNTL                                        02770003
024200                AP063-RECORD                                      02780040
024300                AP068-RECORD                                      0     40
024400                AA-DB2-TABLE-1                                    02820041
024500                AA-DB2-TABLE-2                                    02830041
024600                AA-DB2-TABLE-3                                    02840041
024700                AA-DB2-TABLE-4                                    02850041
024800                PV-COUNTERS.                                      02860041
024900                                                                  03150024
025000     PERFORM Y100-GET-CUT-OFF-DATE.                                       
025100                                                                          
025200     DISPLAY '30 DAYS = '   DATE-AGE-30                                   
025300     DISPLAY '60 DAYS = '   DATE-AGE-60                                   
025400     DISPLAY '90 DAYS = '   DATE-AGE-90                                   
025500     DISPLAY '120 DAYS = '  DATE-AGE-120                                  
025600                                                                          
025700     PERFORM X100-OPEN-PO-CSR.                                    03160037
025800                                                                  03170037
025900     PERFORM F100-FETCH-PO-CSR.                                   03180037
026000     IF END-OF-PO-CSR                                             03190037
026100         DISPLAY 'FIRST FETCH OF POSTRR CURSOR  '                 03200037
026200         DISPLAY ' '                                              03210037
026300         DISPLAY 'END OF PROCESSING             '                 03220037
026400     END-IF.                                                      03230037
026500                                                                  03240037
026600     PERFORM R100-READ-PURCHASE-ORDERS.                           03250004
026700     IF END-OF-POS                                                03260004
026800         DISPLAY 'END OF FILE CONDITION'                          03270054
026900         DISPLAY 'FIRST READ OF IMPORT INVOICE FILE'              03280004
027000         DISPLAY 'IMPRT INV RECS PROCESSED   = '                  03290015
027100                               PV-COUNT-PO-READ                   03300015
027200         DISPLAY ' '                                              03310004
027300         DISPLAY 'END OF PROCESSING             '                 03320004
027400     END-IF.                                                      03330004
027500                                                                          
027600     MOVE AP063-PO-NBR TO PV-HOLD-PO-NBR.                         03440012
027700                                                                        40
027800 B200-PROCESS-POS.                                                03450004
027900******************************************************************      03
028000*    CONTROLS THE PROCESSING OF EACH PO AS FOLLOWS:              *      12
028100*                                                                *      03
028200*    - BUMPS PO_CSR AGAINST AP063(IMPORT INVOICES COST FILE TO   *      09
028300*      FIND A MATCH ON A PO NUMBER.                              *      09
028400*    - WHEN A MATCH IS NOT FOUND:                                *      54
028500*      - PO NUMBER AND ACCOUNT NUMBER FROM INPUT RECORD ARE      *      54
028600*        MOVED TO THE OUTPUT RECORD.                             *      54
028700*      - THE PERIOD END DATE WILL BE THE CURR-WK-END-DTE FROM    *      54
028800*        TAPCNTL.                                                *      54
028900*    - WHEN A MATCH IS FOUND:                                    *      54
029000*      - PO NUMBER WILL BE BYPASSED                              *      12
029100*                                                                *      12
029200******************************************************************      03
029300                                                                        27
029400        IF POSTRR-PO-NBR > AP063-PO-NBR                                   
029500           MOVE AP063-PO-NBR           TO AP068-PO-NBR                    
029600           MOVE AP063-GL-ACCT-NBR      TO AP068-GL-ACCT-NBR               
029700           MOVE APCNTL-CURR-WK-END-DTE TO                                 
029800                                   AP068-PERIOD-END-DTE                   
029900           PERFORM D100-DETERMINE-AGE                                     
030000           PERFORM W100-WRITE-IMPORT-AGE-FILE                             
030100           PERFORM R100-READ-PURCHASE-ORDERS                              
030200           MOVE AP063-PO-NBR TO PV-HOLD-PO-NBR                            
030300        ELSE                                                              
030400           IF POSTRR-PO-NBR < AP063-PO-NBR                                
030500              PERFORM F100-FETCH-PO-CSR                                   
030600           ELSE                                                           
030700* JUST PROCESSED THE OPEN INVOICES, GET NEW INPUTS                      40
030800           PERFORM R100-READ-PURCHASE-ORDERS                            40
030900             UNTIL AP063-PO-NBR > PV-HOLD-PO-NBR                          
031000           MOVE AP063-PO-NBR TO PV-HOLD-PO-NBR                            
031100           PERFORM F100-FETCH-PO-CSR                                      
031200           END-IF                                                         
031300        END-IF.                                                           
031400                                                                        03
031500                                                                        04
031600 B300-END-PROGRAM.                                                04040004
031700******************************************************************04050003
031800*    ENDING PROCESSING: DISPLAYS COUNTS, AND CLOSES FILES.       *04060003
031900******************************************************************04070003
032000                                                                  04080003
032100     DISPLAY 'POSTRR ROWS FETCHED    = ' PV-COUNT-POCSR-READ.     04090050
032200                                                                  04140016
032300     DISPLAY 'TOTAL PO WRITTEN = ' PV-COUNT-ENT-WROTE.            04150041
032400                                                                  04160003
032500     PERFORM X110-CLOSE-PO-CSR.                                   04170003
032600                                                                  04180003
032700     CLOSE IMPORT-INV-COST-FILE                                         04
032800           IMPORT-AGE-FILE.                                             03
032900                                                                        66
033000                                                                          
033100 D100-DETERMINE-AGE.                                              04040004
033200******************************************************************04050003
033300*    DETERMINES WHICH AGE BUCKET TO THE RETRIEVED AMOUNT INTO.   *04060003
033400******************************************************************04070003
033500                                                                  06660041
033600     IF AP063-ENTR-DTE > DATE-AGE-30 THEN                                 
033700        MOVE AP063-INV-CHRG-AMT TO AP068-AGE-30-DAY-AMT                   
033800     ELSE                                                                 
033900        IF (AP063-ENTR-DTE > DATE-AGE-60) THEN                            
034000           MOVE AP063-INV-CHRG-AMT TO AP068-AGE-60-DAY-AMT                
034100        ELSE                                                              
034200           IF (AP063-ENTR-DTE > DATE-AGE-90) THEN                         
034300              MOVE AP063-INV-CHRG-AMT TO AP068-AGE-90-DAY-AMT             
034400           ELSE                                                           
034500              IF (AP063-ENTR-DTE > DATE-AGE-120) THEN                     
034600                 MOVE AP063-INV-CHRG-AMT TO AP068-AGE-120-DAY-AMT         
034700              ELSE                                                        
034800                 MOVE AP063-INV-CHRG-AMT TO AP068-AGE-OVER120-AMT         
034900              END-IF                                                      
035000           END-IF                                                         
035100        END-IF                                                            
035200     END-IF.                                                              
035300                                                                          
035400                                                                          
035500 F100-FETCH-PO-CSR.                                                     16
035600******************************************************************07050016
035700*  RETRIEVES THE ELC CURSOR DATA                                 *07060055
035800******************************************************************07070003
035900                                                                  07080004
036000     EXEC SQL                                                     07090003
036100         FETCH   PO_CSR                                           07100004
036200         INTO    :POSTRR-PO-NBR                                   07110004
036300     END-EXEC.                                                    07120003
036400                                                                  07130003
036500     EVALUATE TRUE                                                07140003
036600         WHEN SQLCODE = ZERO                                      07150003
036700             ADD 1 TO PV-COUNT-POCSR-READ                         07160050
036800             SET FOUND-PO-ROWS TO TRUE                            07170033
036900                                                                  07180003
037000         WHEN SQLCODE = +100                                      07190003
037100             MOVE ALL '9' TO POSTRR-PO-NBR                                
037200             SET END-OF-PO-CSR TO TRUE                            07200016
037300             IF NEW-PO-ROWS                                       07210033
037400                 DISPLAY '* * * * * * * * * * * * * * * * * * '   07220033
037500                 DISPLAY 'NO POSTRR DATA TO PROCESS '             07230033
037600                 DISPLAY '* * * * * * * * * * * * * * * * * * '   07240033
037700             END-IF                                               07250033
037800                                                                  07270003
037900         WHEN SQLWARN0 NOT = SPACES                               07280003
038000         WHEN SQLCODE  NOT = ZERO                                 07290003
038100             MOVE 'F100-FETCH-PO-CSR'                             07300004
038200                                 TO AA-PARAGRAPH-NAME             07310004
038300             MOVE 'UNSUCCESSFUL FETCH WITH PO_CSR'                07320004
038400                                 TO AA-DB2-OPERATION              07330004
038500             MOVE 'TPOSTRR'      TO AA-DB2-TABLE-1                07340004
038600             PERFORM Z998-DB2-ABEND                               07350003
038700     END-EVALUATE.                                                07360003
038800                                                                  07370003
038900                                                                  07690012
039000 R100-READ-PURCHASE-ORDERS.                                       07710004
039100****************************************************************  07720004
039200*     READ THE IMPORT PO INVOICE COST FILE                        07730004
039300****************************************************************  07740004
039400                                                                  07750004
039500     MOVE 'R100-READ-PURCHASE-ORDERS' TO AA-PARAGRAPH-NAME.       07760004
039600                                                                  07770004
039700        INITIALIZE AP068-RECORD.                                          
039800        READ IMPORT-INV-COST-FILE INTO AP063-RECORD                     04
039900          AT END                                                  07800004
040000               MOVE ALL '9' TO AP063-RECORD                               
040100               SET END-OF-POS TO TRUE.                                    
040200                                                                  07810004
040300     IF NOT END-OF-POS                                            07820004
040400        ADD 1 TO PV-COUNT-PO-READ.                                07830015
040500                                                                        04
040600 W100-WRITE-IMPORT-AGE-FILE.                                      08440022
040700******************************************************************08450022
040800*    WRITE THE OUTPUT FILE                                       *08460022
040900******************************************************************08470022
041000                                                                  08480022
041100     WRITE IMPORT-AGE-REC FROM AP068-RECORD.                            22
041200     ADD 1 TO PV-COUNT-ENT-WROTE.                                 08500041
041300                                                                  08510022
041400                                                                  08520022
041500 X100-OPEN-PO-CSR.                                                08530003
041600***************************************************************** 08540003
041700*    OPEN PO_CSR CURSOR.                                        * 08550005
041800***************************************************************** 08560003
041900                                                                  08570003
042000     EXEC SQL                                                     08580003
042100         OPEN PO_CSR                                              08590005
042200     END-EXEC.                                                    08600003
042300                                                                  08610003
042400     EVALUATE TRUE                                                08620003
042500         WHEN SQLCODE = ZERO                                      08630003
042600             SET NEW-PO-ROWS                                      08640033
042700                 NEW-PO-CSR      TO TRUE                          08650033
042800                                                                  08660004
042900         WHEN SQLWARN0 NOT = SPACES                               08670003
043000         WHEN SQLCODE  NOT = ZERO                                 08680003
043100             MOVE 'X100-OPEN-PO-CSR'                              08690003
043200                                 TO AA-PARAGRAPH-NAME             08700003
043300             MOVE 'UNSUCCESSFUL OPEN ON PO_CSR'                   08710005
043400                                 TO AA-DB2-OPERATION              08720003
043500             MOVE 'TPOSTRR'      TO AA-DB2-TABLE-1                08730005
043600             PERFORM Z998-DB2-ABEND                               08740003
043700     END-EVALUATE.                                                08750003
043800                                                                  08760003
043900 X110-CLOSE-PO-CSR.                                               08780003
044000***************************************************************** 08790003
044100*    CLOSE THE PO_CSR CURSOR.                                   * 08800005
044200***************************************************************** 08810003
044300                                                                  08820003
044400     EXEC SQL                                                     08830003
044500         CLOSE PO_CSR                                             08840005
044600     END-EXEC.                                                    08850003
044700                                                                  08860003
044800       EVALUATE TRUE                                              08870003
044900           WHEN SQLCODE = ZERO                                    08880003
045000                CONTINUE                                          08890003
045100                                                                  08900003
045200           WHEN SQLWARN0 NOT = SPACES                             08910003
045300           WHEN SQLCODE  NOT = ZERO                               08920003
045400               MOVE 'X110-CLOSE-PO-CSR'                           08930003
045500                                 TO AA-PARAGRAPH-NAME             08940041
045600               MOVE 'UNSUCCESSFUL CLOSE ON PO_CSR'                08950005
045700                                 TO AA-DB2-OPERATION              08960041
045800               MOVE 'TPOSTRR'    TO AA-DB2-TABLE-1                08970041
045900               PERFORM Z998-DB2-ABEND                             08980003
046000       END-EVALUATE.                                              08990003
046100                                                                  09000003
046200 Y100-GET-CUT-OFF-DATE.                                           90200 04
046300***************************************************************** 09030003
046400*    RETRIEVES THE NECESSARY DATES IN ORDER TO PROCESS THE AGE    09040014
046500*    OF OPEN DEBITS.                                              09050016
046600***************************************************************** 09060004
046700                                                                  09070004
046800     EXEC SQL                                                     09080004
046900         SELECT  CURR_WK_END_DTE                                  09090014
047000                ,(BTCH_PRC_DTE - 30 DAYS)                                 
047100                ,(BTCH_PRC_DTE - 60 DAYS)                                 
047200                ,(BTCH_PRC_DTE - 90 DAYS)                                 
047300                ,(BTCH_PRC_DTE - 120 DAYS)                                
047400         INTO    :APCNTL-CURR-WK-END-DTE                                14
047500                ,:DATE-AGE-30                                             
047600                ,:DATE-AGE-60                                             
047700                ,:DATE-AGE-90                                             
047800                ,:DATE-AGE-120                                            
047900         FROM TAPCNTL                                             09110004
048000     END-EXEC.                                                    09120004
048100                                                                  09130004
048200     EVALUATE TRUE                                                09140004
048300         WHEN SQLCODE = ZERO                                      09150004
048400              CONTINUE                                            09160004
048500                                                                  09170004
048600         WHEN SQLWARN0 NOT = SPACES                               09180004
048700         WHEN SQLCODE  NOT = ZERO                                 09190004
048800         MOVE 'UNSUCCESSFUL SELECT OF PAYMENT CONTROL TBL'        09200004
048900                                 TO AA-DB2-OPERATION              09210041
049000         MOVE 'TAPCNTL'          TO AA-DB2-TABLE-1                09220041
049100         PERFORM Z998-DB2-ABEND                                   09230004
049200     END-EVALUATE.                                                09240004
049300                                                                  09260012
049400 Z998-DB2-ABEND.                                                  09270003
049500******************************************************************09280003
049600*    ABEND ROUTINE FOR DB2 ERRORS                                *09290003
049700******************************************************************09300003
049800                                                                  09310003
049900     DISPLAY AA-ABEND-LIT.                                        09320003
050000     DISPLAY AA-DB2-ERROR-LIT.                                    09330003
050100     DISPLAY AA-PROGRAM-LIT.                                      09340003
050200     DISPLAY AA-PARAGRAPH-LIT.                                    09350003
050300     DISPLAY AA-DB2-OPERATION-LIT.                                09360003
050400     DISPLAY AA-DB2-TABLE-1.                                      09370003
050500     DISPLAY AA-DB2-TABLE-2.                                      09380003
050600     DISPLAY AA-DB2-TABLE-3.                                      09390003
050700     DISPLAY AA-DB2-TABLE-4.                                      09400003
050800     DISPLAY '*****                PO = ' PV-HOLD-PO-NBR.         09410011
050900     SET AC-DB2-ERROR TO TRUE.                                    09420003
051000                                                                  09430003
051100     COPY DPPD004.                                                09440003
051200                                                                  09450003
051300     CALL 'ILBOABN0' USING ABEND-CODE.                            09460003
051400                                                                  09470003
051500 Z999-ABEND.                                                      09490003
051600******************************************************************09500003
051700*    ABEND ROUTINE                                               *09510003
051800******************************************************************09520003
051900                                                                  09530003
052000     CLOSE IMPORT-INV-COST-FILE                                         07
052100           IMPORT-AGE-FILE.                                       09560007
052200                                                                        07
052300     DISPLAY AA-ABEND-LIT.                                        09590003
052400     DISPLAY AA-PROGRAM-LIT.                                      09600003
052500     DISPLAY AA-PARAGRAPH-LIT.                                    09610003
052600     DISPLAY AA-MESSAGE-LINE.                                     09620003
052700     DISPLAY '*****                PO = ' PV-HOLD-PO-NBR.         09630011
052800     CALL 'ILBOABN0' USING ABEND-CODE.                            09640003
052900                                                                  09650003
