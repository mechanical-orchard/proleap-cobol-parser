000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     APKUT067.                                        00020000
000300 AUTHOR.         MIKE BESKE.                                      00030000
000400 DATE-WRITTEN.   JULY 2003.                                       00040000
000500***************************************************************** 00050000
000600*    COBOL 2 WITH DB2 SQL                                       * 00060000
000700*                                                               * 00070000
000800*    EDI810 INVOICE COMPOUND PACK HEADER EDIT PROGRAM           * 00080000
000900*                                                               * 00090000
001000*   PROGRAM OVERVIEW: THIS PROGRAM READS THE EDI810 INVOICE FILE* 00100000
001100*   BEFORE BEING EDITTED BY THE EDI EDIT PROGRAMS.  IT READS    * 00110000
001200*   EACH RECORD.  IF THE RECORD IS TYPE 07 AND UNIT MEASURE     * 00120000
001300*   VALUE = 'AS' (COMPOUND PACK HEADER) THEN IT WILL BE PRO-    * 00130000
001400*   CESSED BY THIS PROGRAM ALONG WITH ANY SENT PACKITEM RECORDS * 00140000
001500*   (08 AND 09).  ANY OTHER RECORDS ARE JUST WRITTEN RIGHT OUT  * 00150000
001600*   TO THE OUTPUT FILE.  THIS PROGRAM CAN ALSO EXPLODE A PACK   * 00160000
001700*   HEADER UPC IF NO PACKITEM IS SENT.  THE PACKITEM RECORDS    * 00170000
001800*   (EDI SENT OR EXPLODED HEADER UPC) WILL BE FORMATTED INTO NEW* 00180000
001900*   07 RECORDS WITH A UNIT MEASURE VALUE = 'PI'.  THE ORIGINAL  * 00190000
002000*   07 'AS' RECORD IS ALSO WRITTEN OUT AHEAD OF THE 07 'PI' REC-* 00200000
002100*   ORDS WITH NO CHANGES EXCEPT FOR A SET OF VARIOUS WARN/ERROR * 00210000
002200*   INDICATORS AND THE SUMMED PACKITEM COST.  THESE WILL BE     * 00220000
002300*   PROCESSED LATER BY THE EDI EDIT PROGRAMS AND APPEAR ON THE  * 00230000
002400*   EDI ERROR REPORTS.  IF ANY WARNINGS ARE SET, IT DOES NOT    * 00240000
002500*   KEEP THE COMPOUND PACK INVOICES FROM BEING INSERTED ONTO THE* 00250000
002600*   INVOICE DATABASE.  THE WARNINGS ARE MEANT TO BE REPORTED ON * 00260000
002700*   THE EDI ERROR REPORTS ONLY.                                 * 00270000
002800*                                                               * 00280000
002900*    TPURCHS   - PURCHASE ORDER HEADER TABLE                    * 00290000
003000*    TPURITM   - PURCHASE ORDER ITEM TABLE                      * 00300000
003100*    TPOPRPK   - PURCHASE ORDER PREPACK TABLE                   * 00310000
003200*    TSKXREF   - SKU XREF TABLE                                 * 00320000
003300*    TUPC      - UPC TABLE                                      * 00330000
003400*    TUPCSKU   - UPC SKU TABLE                                  * 00340000
003500*                                                               * 00350000
003600* INPUT:                                                        * 00360000
003700* 1.  EDI XMIT FILE                                    (APRD050)* 00370000
003800*                                                               * 00380000
003900* OUTPUT:                                                       * 00390000
004000* 1.  EDI XMIT W/COMPOUND PACK EDITTING FILE           (APRD050)* 00400000
004100***************************************************************** 00410000
004200* CHANGE LOG:                                                   * 00420000
004300*                                                               * 00430000
004400* DATE  07/01/2003                                              * 00440000
004500*     CHANGE MADE: INITIAL VERSION.                             * 00450000
004600*     MADE BY: MIKE BESKE              WR/IR #: WR24658         * 00460000
004700*                                                               * 00470000
004800* DATE  08/18/2003                                              * 00480000
004900*     CHANGE MADE: CORRECTED THE PACK_ITEM_CSR TO FETCH THE     * 00490000
005000*     PREPK_RATO_QTY INSTEAD OF THE UNT_QTY ON TPURITM.  ADDED  * 00500000
005100*     CODE IN PARA G200-PROCESS-PACK-ITM-CSR TO COMPUTE THE     * 00510000
005200*     DETAIL PACKITEM QUANTITY BY USING THE FETCHED PREPK_RATO_ * 00520000
005300*     QTY AND THE PACK QUANTITY SENT ON THE PREPACK HEADER      * 00530000
005400*     RECORD (07'AS'). THIS IS IN PLACE OF THE PREVIOUS CODE    * 00540000
005500*     THAT USED THE UNT_QTY AS THE DETAIL PACKITEM QUANTITY.    * 00550000
005600*     THIS UNT_QTY IS ACTUALLY THE TOTAL QUANTITY FOR THE ENTIRE* 00560000
005700*     PO.                                                       * 00570000
005800*     MADE BY: MIKE BESKE              WR/IR #: WR24481         * 00580000
005900*                                                               * 00590000
006000* DATE  10/03/2003                                              * 00600000
006100*     CHANGE MADE: UPDATED COMMENTS THROUGHOUT THE PROGRAM THAT * 00610000
006200*     REFERS TO THE WARNING INDICATORS ON RECORD 07. THE FORMER * 00620000
006300*     WARNING INDICATOR FOR NOT BEING ABLE TO EXPLODE A PACK    * 00630000
006400*     HEADER UPC WILL BE CONSIDERED AN ERROR INDICATOR. WHEN    * 00640000
006500*     AP050-UPC-CANT-EXPLODE-IND IS CHECKED FOR Y IN APKED200   * 00650000
006600*     & APKED201 THE ENTIRE INVOICE WILL BE REJECTED FOR THIS.  * 00660000
006700*     MADE BY: MIKE BESKE              WR/IR #: WR25850         * 00670000
006800*                                                               * 00680000
006900* DATE  06/09/2004                                              * 00690000
007000*     CHANGED MADE: STORE CONSTRAINTS PROJECT                   * 00700000
007100*     RECOMPILED THIS PROGRAM TO PICK UP THE APRD050            * 00710000
007200*     COPYBOOK MODIFICATIONS.                                   * 00720000
007300*     MADE BY: MIKE BESKE              WR/IR #: WR25805         * 00730000
007400*                                                               * 00740000
007500* DATE  05/25/2006                                              * 00750000
007600*     CHANGED MADE: VENDOR ALLOWANCE PROJECT.  RECOMPILE FROM   * 00760000
007700*     PRODUCTION TO INCORPORATE COPYBOOK CHANGES.               * 00770000
007800*     MADE BY: MICHELE RINDFLEISCH     WR/IR #: WR30028         * 00780000
007900*                                                               * 00790000
008000* DATE  04/23/2007                                              * 00800000
008100*     CHANGED MADE: RECOMPILE FROM PRODUCTION TO PICK-UP THE    * 00810000
008200*     CHANGES TO COPYBOOK APWS050.                              * 00820000
008300*     MADE BY: KRYSTEN LEARY           WR/IR #: WR26018         * 00830000
008400*                                                               * 00840000
008500* DATE  05/16/2007                                              * 00850000
008600*     CHANGE MADE: RECOMPILED TO PICK UP APWS050 MODIFICATION.  * 00860000
008700*     MADE BY: MIKE BESKE              WR/IR #: P001021023      * 00870000
008800*                                                               * 00880000
008900* DATE  12/03/2007                                              * 00890000
009000*     CHANGE MADE: REMOVED COPYBOOK APWS050 BECAUSE IT IS NOT   * 00900000
009100*     USED IN THIS PROGRAM.                                     * 00910000
009200*     MADE BY: MIKE BESKE              WR/IR #: WR32664         * 00920000
009300*                                                               * 00930000
009400* DATE  02/04/2008                                              * 00940000
009500*     CHANGE MADE: FOR PRIVATE LABEL ACCOUNTING, POPULATETION.  * 00950000
009600*     WHOLESALE UNIT COST WITH FIRST COST NO MATTER THE TYPE CODE.00960000
009700*     MADE BY: CHRISTINE TWIEHAUS      WR/IR #: WR32664         * 00970000
009800*                                                               * 00980000
009900* DATE  06/09/2008                                              * 00990000
010000*     CHANGE MADE: COMMENTED OUT MOST OF 2 IF STATEMENTS IN     * 01000000
010100*     PARA F400-UPDATE-07-REC-IND. THIS WILL STOP WARNING MSG   * 01010000
010200*     NUMBER 08 AND 09 FROM APPEARING ON THE ERROR REPORTS      * 01020000
010300*     GENERATED IN APKRP204 AND APKRP206.  IF THE WARNING MSGS  * 01030000
010400*     NEED TO APPEAR ON THE REPORTS IN THE FUTURE, THEN THE CODE* 01040000
010500*     CAN BE UNCOMMENTED.                                       * 01050000
010600*     MADE BY: MIKE BESKE              WR/IR #: WR34285         * 01060000
010700*                                                               * 01070000
010800* DATE  10/28/2008                                              * 01080000
010900*     CHANGE MADE: ADDED 2 DISPLAYS FOR THE PO NBR AND INVOICE  * 01090000
011000*     ID IN PARA C100-.  THIS HELPS TO IDENTIFY WHERE IN THE    * 01100000
011100*     INPUT DATASET THE CAUSE OF THE ABEND HAPPENED.            * 01110000
011200*     MADE BY: MIKE BESKE              WR/IR #: INC000000575826 * 01120000
011300*                                                               * 01130000
011400* DATE  01/06/2009                                              * 01140000
011500*     CHANGE MADE: ADDED TABLE TUPCSKU AND PARAGRAPH S200 TO    * 01150000
011600*     JOIN TUPCSKU WITH TPURITM TO GET THE PO LINE NUMBER USING * 01160000
011700*     BOTH THE UPC AND PACK ID. ADDED LOGIC IN G100 AND G200    * 01170000
011800*     TO MAKE SURE THE PO LINE GOT POPULATED ON THE OUTPUT REC. * 01180000
011900*     CHANGED THE EXISTENCE CHECK IN S100 TO A SELECT OF THE    * 01190000
012000*     PACK ID, NEEDED FOR THE SQL IN S200. REMOVED SYSDUMMY1.   * 01200000
012100*     MADE BY: NANCY EILBES            WR/IR #: INC000000601329 * 01210000
012200*                                                               * 01220000
012300* DATE  01/08/2009                                              * 01230000
012400*     CHANGE MADE: ADDED CHECK FOR VALID PACK HEADER BEFORE     * 01240000
012500*     PERFORMING S200.  INVOICES WITH INVALID PACK HEADER UPC   * 01250000
012600*     WOULD ONLY GET TO THIS LOGIC IF THE DETAIL WAS ALSO SENT. * 01260000
012700*     IN THIS CASE, THE LINE NUMBER WILL NOT BE ASSIGNED HERE,  * 01270000
012800*     AND WILL FAIL BACK TO BEING ASSIGNED IN APKED201.         * 01280000
012900*     MADE BY: NANCY EILBES            WR/IR #: INC000000654601 * 01290000
013000*                                                               * 01300000
013100* DATE  01/09/2009                                              * 01310000
013200*     CHANGE MADE: ADDED CONDITION HANDLING FOR SQLCODE +100 IN * 01320000
013300*     S200 TO MOVE ZERO TO THE PRITM-PO-LNE-NBR.  THE CONDITION * 01330000
013400*     CAME IN WHERE THE VENDOR SENT THE PACK DETAIL, BUT ONE OF * 01340000
013500*     THE UPCS DID NOT MATCH THE UPCS ON THE PO.  THIS CHANGE   * 01350000
013600*     WILL PUSH PO LOOKUP HANDLING BACK TO APKED201 WHEN THIS   * 01360000
013700*     OCCURS, AND HOPEFULLY, WILL CATCH ANY OTHER EXCEPTIONS.   * 01370000
013800*     MADE BY: NANCY EILBES            WR/IR #: INC000000655891 * 01380000
013900*                                                               * 01390000
014000* DATE  08/01/2013                                              * 01400000
014100*     CHANGE MADE: ADDED CODE FOR CONVERTING LOWER CASE TO UPPER* 01410000
014200*     CASE IN THE INVOICE ID FIELD BEING READ IN PARA R100-.    * 01420000
014300*     MADE BY: MIKE BESKE              WR/IR #: CHG0059350      * 01430000
014301*                                                               * 01430100
014302* DATE  08/18/2014                                              * 01430200
014303*     CHANGE MADE: ADDED ONE MORE CONDITION WHILE SELECTING     * 01430300
014304*     PO_PREPK_ID FROM TABLE TPOPRPK & TPURITM TO SELECT THE    * 01430400
014305*     ACTIVE ROWS ONLY , IN PARA S100-VALID-PACK-HDR-UPC.       * 01430500
014306*     MADE BY: COGNIZANT (JAVED)       WR/IR #: CHG0089904      * 01430600
014307*                                                               * 01430700
014308* DATE  11/03/2014                                              * 01430800
014309*     CHANGE MADE: PO EXTENDED DIGIT CHANGES.                   * 01430900
014310*     EXTENDED PO# FROM 7 TO 9.                                 * 01431000
014311*     MADE BY: COGNIZANT               WR/IR #: CHG0094517      * 01431100
014312*                                                               * 01431201
014313* DATE  02/17/2021                                              * 01431301
014314*     CHANGE MADE: MODIFIED THE CRITERIA IN THE PACK_ITEM_CSR   * 01431401
014315*     TO ONLY INCLUDE PACK ITEMS WHERE THE UNIT QUANTITY ON     * 01431501
014316*     TPURITM IS GREATER THAN ZERO.  IT APPEARS THAT WHEN A     * 01431601
014317*     PACK IS CHANGED, THE ORIGINAL PACK IS NOT REMOVED FROM    * 01431701
014318*     THE PO, BUT THE QUANTITY ON THOSE LINES IS SET TO ZERO.   * 01431801
014319*     THIS CRITERIA PREVENTS THE 'OBSOLETE' PACK FROM BEING     * 01431901
014320*     INCLUDED WHEN THE PACK IS EXPLODED INTO THE COMPONENT     * 01432001
014321*     ITEMS.                                                    * 01432101
014322*     MADE BY: NANCY EILBES            WR/IR #: CHG0254023      * 01432201
014312*                                                               * 01432305
014313* DATE  06/09/2021                                              * 01432405
014314*     CHANGE MADE: CONVERTED THE LOWERCASE LETTERS IN THE INV   * 01432505
014315*     NBR IN THE '07' RECORDS CREATED. ADDED A NEW PARAGRAPH TO * 01432605
014315*     DO THIS -  F700-EDIT-INV-NBR-FOR-LOWCASE.                 * 01432705
014322*     MADE BY: BARB SCHULTZ            WR/IR #: CHG0257785      * 01432806
014323***************************************************************** 01432905
014324                                                                  01433005
014325 ENVIRONMENT DIVISION.                                            01433105
014326                                                                  01433205
014327 INPUT-OUTPUT SECTION.                                            01433305
014328                                                                  01433405
014329 FILE-CONTROL.                                                    01433505
014330                                                                  01433605
014331     SELECT EDIIN-FILE  ASSIGN TO INP01.                          01433705
014332     SELECT EDIOUT-FILE ASSIGN TO OUT01.                          01433805
014340                                                                  01434000
014350 DATA DIVISION.                                                   01435000
014360                                                                  01436000
014370 FILE SECTION.                                                    01437000
014380                                                                  01438000
014390 FD  EDIIN-FILE                                                   01439000
014400     LABEL RECORDS  ARE STANDARD                                  01440000
014500     RECORDING MODE IS  F                                         01450000
014600     DATA RECORD    IS  EDIIN-RECORD.                             01460000
014700*01  EDIIN-RECORD            PIC X(350).                          01470000
014800 01  EDIIN-RECORD.                                                01480000
014900     05  FILLER              PIC X(07).                           01490000
015000     05  EDIIN-INV-NBR       PIC X(22).                           01500000
015100     05  FILLER              PIC X(321).                          01510000
015200                                                                  01520000
015300 FD  EDIOUT-FILE                                                  01530000
015400     LABEL RECORDS  ARE STANDARD                                  01540000
015500     RECORDING MODE IS  F                                         01550000
015600     DATA RECORD    IS  EDIOUT-RECORD.                            01560000
015700 01  EDIOUT-RECORD           PIC X(350).                          01570004
015800                                                                  01580000
015900 WORKING-STORAGE SECTION.                                         01590000
016000                                                                  01600000
016100 01  FILLER                        PIC X(25) VALUE                01610000
016200                             'WS FOR APKUT067 BEGINS==>'.         01620000
016300 01  ABEND-CODE                    PIC S9(4) COMP SYNC            01630000
016400                                             VALUE ZEROS.         01640000
016500     88 INV-TABLE-FULL             VALUE +4004.                   01650000
016600     88 AP-EMPTY-FILE              VALUE +4005.                   01660000
016700     88 FMT-TABLE-FULL             VALUE +4006.                   01670000
016800     88 AP-DB2-ERROR               VALUE +4013.                   01680000
016900                                                                  01690000
017000 01  ALLW-INDX                     PIC S9(4) COMP VALUE ZERO.     01700000
017100                                                                  01710000
017200 01  WS-RETRY-COUNTER              PIC S9(4) COMP VALUE ZERO.     01720000
017300 01  WS-ABEND-FIELDS.                                             01730000
017400     05  WS-ABEND-PROGRAM             PIC X(8)  VALUE 'APKUT067'. 01740000
017500     05  WS-ABEND-PARAGRAPH           PIC X(50) VALUE SPACES.     01750000
017600     05  WS-ABEND-OPERATION           PIC X(50) VALUE SPACES.     01760000
017700     05  WS-ABEND-STRUCTURE-1         PIC X(8)  VALUE SPACES.     01770000
017800     05  WS-ABEND-STRUCTURE-2         PIC X(8)  VALUE SPACES.     01780000
017900     05  WS-ABEND-STRUCTURE-3         PIC X(8)  VALUE SPACES.     01790000
018000     05  WS-ABEND-STRUCTURE-4         PIC X(8)  VALUE SPACES.     01800000
018100     05  WS-ABEND-STRUCTURE-5         PIC X(8)  VALUE SPACES.     01810000
018200     05  WS-ABEND-STATUS              PIC XX    VALUE SPACES.     01820000
018300                                                                  01830000
018400     05  WS-EAN-UPC              PIC X(13)  VALUE SPACES.         01840000
018500     05  WS-EAN-UPC-EDITTED      PIC X(16)  VALUE SPACES.         01850000
018600     05  WS-SAVE-INVOICE-NBR     PIC X(22)  VALUE SPACES.         01860000
018700     05  WS-SAVE-EDI-SEQ-NBR     PIC X(05)  VALUE SPACES.         01870000
018800                                                                  01880000
018900     05  WS-SAVE-PO-NBR          PIC 9(09)  VALUE ZEROS.          01890000
019000     05  WS-SAVE-PO-NBR-X REDEFINES WS-SAVE-PO-NBR PIC X(09).     01900000
019100                                                                  01910000
019200     05  WS-SAVE-PO-NBR-COMP     PIC S9(9)  COMP                  01920000
019300                                            VALUE ZEROS.          01930000
019400     05  WS-QUANTITY-INVOICED    PIC S9(6)V VALUE ZEROS.          01940000
019500     05  WS-DETAIL-PKITEM-QTY    PIC S9(6)V VALUE ZEROS.          01950000
019600                                                                  01960000
019700     05  WS-SAVE-QUANTITY-INVOICED   PIC S9(6)V VALUE ZEROS.      01970000
019800     05  WS-PKHDR-GROSS-COST         PIC S9(07)V999 VALUE         01980000
019900                                                  ZEROS.          01990000
020000     05  WS-SAVE-PACK-COST           PIC S9(07)V999 VALUE         02000000
020100                                                  ZEROS.          02010000
020200     05  WS-PK-ITEM-SUMD-COST        PIC S9(07)V999 VALUE         02020000
020300                                                  ZEROS.          02030000
020400     05  WS-CALC-EXTEN-PKITEM-AMT    PIC S9(07)V999 VALUE         02040000
020500                                                  ZEROS.          02050000
020600                                                                  02060000
020700     05  WS-SAVE-PO-INV-NBR      PIC X(29)  VALUE SPACES.         02070000
020800                                                                  02080000
020900     05  WS-SAVE-GROSS-INVOICE-AMT   PIC S9(08)V99 VALUE          02090000
021000                                                  ZEROS.          02100000
021100     05  WS-DETAIL-GROSS-INVOICE-AMT PIC S9(09)V99 VALUE          02110000
021200                                                  ZEROS.          02120000
021300     05  WS-DIFFERENCE               PIC S9(08)V99 VALUE 0.       02130000
021400     05  WS-DETAIL-TOT-UNITS         PIC S9(08)V99 VALUE          02140000
021500                                                  ZEROS.          02150000
021600                                                                  02160000
021700     05  WS-CALC-EXTEN-INVOICE-AMT   PIC S9(08)V99 VALUE          02170000
021800                                                  ZEROS.          02180000
021900                                                                  02190000
022000     05  WS-LAST-REC-TYPE            PIC X(02)   VALUE SPACES.    02200000
022100                                                                  02210000
022200                                                                  02220000
022300     05  WS-UPC-CODE             PIC 9(13)  VALUE ZEROS.          02230000
022400     05  WS-UPC-CODE-X REDEFINES WS-UPC-CODE PIC X(13).           02240000
022500     05  WS-UPC-CODE-COMP3       PIC S9(15)  COMP-3               02250000
022600                                             VALUE ZEROS.         02260000
022700     05  WS-UPC-ITEM-COMP3       PIC S9(15)  COMP-3               02270000
022800                                             VALUE ZEROS.         02280000
022900                                                                  02290000
023000 01  WS-UPC-13-X                 PIC X(13).                       02300000
023100                                                                  02310000
023200 01  WS-UPC-13.                                                   02320000
023300     05  WS-UPC-ZERO             PIC 9(01)  VALUE ZEROS.          02330000
023400     05  WS-UPC-12               PIC X(12)  VALUE SPACES.         02340000
023500                                                                  02350000
023600     05  WS-PKITM-UPC-NBR        PIC 9(12)  VALUE ZEROS.          02360000
023700     05  WS-PKITM-UPC-NBR-UNPK   PIC S9(15) VALUE ZEROS.          02370000
023800     05  WS-PKITM-UPC-NBR-COMP3  PIC S9(15) COMP-3                02380000
023900                                            VALUE ZEROS.          02390000
024000                                                                  02400000
024100 01  WS-PROGRAM-Constants.                                        02410000
024200     05  PC-LOWER-CASE-LETTERS        PIC X(26)  VALUE            02420000
024300         'abcdefghijklmnopqrstuvwxyz'.                            02430000
024400     05  PC-UPPER-CASE-LETTERS        PIC X(26)  VALUE            02440000
024500         'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.                            02450000
024600                                                                  02460000
024700                                                                  02470000
024800 01  WS-PROGRAM-COUNTERS.                                         02480000
024900     05  WS-EDIIN-REC-CNT        PIC 9(9)  VALUE ZEROS.           02490000
025000     05  WS-EDIOUT-REC-CNT       PIC 9(9)  VALUE ZEROS.           02500000
025100     05  WS-COMPOUND-CNT         PIC 9(9)  VALUE ZEROS.           02510000
025200     05  WS-PREPACK-CNT          PIC 9(9)  VALUE ZEROS.           02520000
025300     05  WS-NO-DTL-CNT           PIC 9(9)  VALUE ZEROS.           02530000
025400     05  WS-EXPLODE-CNT          PIC 9(9)  VALUE ZEROS.           02540000
025500                                                                  02550000
025600 01  WS-INVOICE-COUNTERS.                                         02560000
025700     05  WS-REC-07-CNT           PIC 9(7)  VALUE ZEROS.           02570000
025800     05  WS-REC-08-CNT           PIC 9(7)  VALUE ZEROS.           02580000
025900     05  WS-REC-09-CNT           PIC 9(7)  VALUE ZEROS.           02590000
026000                                                                  02600000
026100 01  WS-SWITCHES.                                                 02610000
026200     05  WS-ERROR-SW             PIC X(01) VALUE 'N'.             02620000
026300         88  ERROR-EDI                     VALUE 'Y'.             02630000
026400         88  NO-EDI-ERROR                  VALUE 'N'.             02640000
026500     05  END-OF-EDIIN-SW         PIC X(01) VALUE 'N'.             02650000
026600         88  END-OF-EDIIN                  VALUE 'Y'.             02660000
026700     05  END-OF-PACK-SW          PIC X(01) VALUE 'N'.             02670000
026800         88  NOT-END-OF-PACK               VALUE 'N'.             02680000
026900         88  END-OF-PACK                   VALUE 'Y'.             02690000
027000     05  END-OF-PKITEM-TBL-SW    PIC X(01) VALUE 'N'.             02700000
027100         88  NOT-END-OF-PKITEM-TBL         VALUE 'N'.             02710000
027200         88  END-OF-PKITEM-TBL             VALUE 'Y'.             02720000
027300                                                                  02730000
027400     05  VALID-UPC-CODE-SW       PIC X(01) VALUE ' '.             02740000
027500         88  WS-VALID-UPC                  VALUE 'Y'.             02750000
027600         88  WS-NOT-VALID-UPC              VALUE 'N'.             02760000
027700                                                                  02770000
027800     05  VALID-PACK-HEADER-SW    PIC X(01) VALUE 'N'.             02780000
027900         88  WS-INVALID-PACK-HEADER        VALUE 'N'.             02790000
028000         88  WS-VALID-PACK-HEADER          VALUE 'Y'.             02800000
028100                                                                  02810000
028200     05  VALID-PKITM-UPC-SW      PIC X(01) VALUE 'N'.             02820000
028300         88  WS-INVALID-PKITM-UPC          VALUE 'N'.             02830000
028400         88  WS-VALID-PKITM-UPC            VALUE 'Y'.             02840000
028500                                                                  02850000
028600     05  REC-07-FORMAT-COMPLETED-SW                               02860000
028700                                 PIC X(01) VALUE 'N'.             02870000
028800         88  REC-07-FORMAT-NOT-COMPLETED   VALUE 'N'.             02880000
028900         88  REC-07-FORMAT-COMPLETED       VALUE 'Y'.             02890000
029000                                                                  02900000
029100     05  WS-OUT-OF-ITEMS-SW      PIC X(01) VALUE 'N'.             02910000
029200         88  MORE-ITEMS                    VALUE 'N'.             02920000
029300         88  OUT-OF-ITEMS                  VALUE 'Y'.             02930000
029400                                                                  02940000
029500 01 PV-ONE                       PIC X(01)  VALUE SPACES.         02950000
029600                                                                  02960000
029700 01  WS-TABLE-AREA.                                               02970000
029800     05  WS-INVOICE-TABLE        OCCURS 500 TIMES                 02980000
029900                                 INDEXED BY INV-INDX.             02990000
030000         10  WS-INV-REC.                                          03000000
030100             15  WS-AP050-KEY-AREA.                               03010000
030200                 20  WS-AP050-PO-NBR     PIC X(09).               03020000
030300                 20  WS-AP050-INV-NBR    PIC X(22).               03030000
030400                 20  WS-AP050-REC-TYPE   PIC X(02).               03040000
030500                 20  WS-AP050-FILLER     PIC X(17).               03050000
030600             15  WS-AP050-DATA-AREA      PIC X(300).              03060000
030700                                                                  03070000
030800 01  WS-FORMAT-AREA.                                              03080000
030900     05  WS-FORMAT-TABLE        OCCURS 500 TIMES                  03090000
031000                                 INDEXED BY FMT-INDX.             03100000
031100         10  WS-FMT-REC.                                          03110000
031200             15  WS-FORMAT-KEY-AREA.                              03120000
031300                 20  WS-FORMAT-PO-NBR    PIC X(09).               03130000
031400                 20  WS-FORMAT-INV-NBR   PIC X(22).               03140000
031500                 20  WS-FORMAT-REC-TYPE  PIC X(02).               03150000
031600                 20  WS-FORMAT-FILLER    PIC X(17).               03160000
031700             15  WS-FORMAT-DATA-AREA     PIC X(300).              03170000
031800                                                                  03180000
031900 01  RUN-TIME.                                                    03190000
032000     05  R-HR                    PIC 99.                          03200000
032100     05  R-MIN                   PIC 99.                          03210000
032200     05  R-SEC                   PIC 99.                          03220000
032300     05  R-TH                    PIC 99.                          03230000
032400                                                                  03240000
032500 01  DATE-IN.                                                     03250000
032600     05 DATE-IN-YY               PIC XX.                          03260000
032700     05 DATE-IN-MM               PIC XX.                          03270000
032800     05 DATE-IN-DD               PIC XX.                          03280000
032900                                                                  03290000
033000 01  FILLER                      PIC X(35)  VALUE                 03300000
033100     'BEGINNING OF AP050 INPUT FILE    **'.                       03310000
033200 01  AP050-EDI-IN-FILE.                                           03320000
033300     COPY APRD050.                                                03330000
033400                                                                  03340000
033500 01  FILLER                      PIC X(35)  VALUE                 03350000
033600     'BEGINNING OF WORK RECORD         **'.                       03360000
033700 01  WS050-WORK-REC.                                              03370000
033800     COPY  APRD050 REPLACING 'AP050-' BY 'WS050-'.                03380000
033900                                                                  03390000
034000 01  FILLER                      PIC X(35)  VALUE                 03400000
034100     'BEGINNING OF NEW RECORD          **'.                       03410000
034200 01  NW050-NEW-REC.                                               03420000
034300     COPY  APRD050 REPLACING 'AP050-' BY 'NW050-'.                03430000
034400                                                                  03440000
034500 01  FILLER                      PIC X(35)  VALUE                 03450000
034600     'END OF AP WORK RECORD AREA       **'.                       03460000
034700                                                                  03470000
034800                                                                  03480000
034900     COPY DPWS004.                                                03490000
035000                                                                  03500000
035100******************************************************************03510000
035200*  COMMUNICATIONS AREA2 FOR DB2                                   03520000
035300******************************************************************03530000
035400     COPY SQLCA2.                                                 03540000
035500                                                                  03550000
035600                                                                  03560000
035700     EXEC SQL                                                     03570000
035800          INCLUDE SQLCA                                           03580000
035900     END-EXEC.                                                    03590000
036000                                                                  03600000
036100                                                                  03610000
036200     EXEC SQL                                                     03620000
036300          INCLUDE TPURCHS                                         03630000
036400     END-EXEC.                                                    03640000
036500                                                                  03650000
036600                                                                  03660000
036700     EXEC SQL                                                     03670000
036800          INCLUDE TPURITM                                         03680000
036900     END-EXEC.                                                    03690000
037000                                                                  03700000
037100                                                                  03710000
037200     EXEC SQL                                                     03720000
037300          INCLUDE TSKXREF                                         03730000
037400     END-EXEC.                                                    03740000
037500                                                                  03750000
037600                                                                  03760000
037700     EXEC SQL                                                     03770000
037800          INCLUDE TUPC                                            03780000
037900     END-EXEC.                                                    03790000
038000                                                                  03800000
038100     EXEC SQL                                                     03810000
038200          INCLUDE TUPCSKU                                         03820000
038300     END-EXEC.                                                    03830000
038400                                                                  03840000
038500     EXEC SQL                                                     03850000
038600          INCLUDE TPOPRPK                                         03860000
038700     END-EXEC.                                                    03870000
038800                                                                  03880000
038900     EXEC SQL                                                     03890000
039000          DECLARE PACK_ITEM_CSR CURSOR FOR                        03900000
039100            SELECT B.PREPK_RATO_QTY                               03910000
039200                  ,B.PRD_1ST_COST_AMT                             03920000
039300                  ,B.VEND_STYL_NAME                               03930000
039400                  ,B.SKU_DESC                                     03940000
039500                  ,B.COLOR_CDE                                    03950000
039600                  ,B.COLOR_DESC                                   03960000
039700                  ,B.SIZE_CDE                                     03970000
039800                  ,B.SIZE_DESC                                    03980000
039900                  ,B.PO_LNE_NBR                                   03990000
040000                  ,D.UPC_NBR                                      04000000
040100                  ,E.PO_TYP_CDE                                   04010000
040200            FROM TPOPRPK A                                        04020000
040300                ,TPURITM B                                        04030000
040400                ,TSKXREF C                                        04040000
040500                ,TUPC    D                                        04050000
040600                ,TPURCHS E                                        04060000
040700            WHERE A.PO_NBR         = B.PO_NBR                     04070000
040800              AND A.PO_PREPK_ID    = B.PO_PREPK_ID                04080000
040900              AND B.ITM_NBR        = C.ITM_NBR                    04090000
041000              AND C.INTR_UPC_ID    = D.INTR_UPC_ID                04100000
041100              AND A.PO_NBR         = E.PO_NBR                     04110000
041200              AND A.PO_NBR         = :WS-SAVE-PO-NBR-COMP         04120000
041300              AND A.PREPK_UPC_NBR  = :WS-UPC-CODE-COMP3           04130000
041400              AND B.VER_STATUS_CDE = 'A'                          04140000
041410              AND B.UNT_QTY        > 0                            04141000
041500              AND C.SKU_STAT_CDE NOT IN ('00','98')               04150000
041600              AND D.UPC_TYP_CDE    = 'I'                          04160000
041700              AND D.EFF_END_DTE   IS NULL                         04170000
041800              AND E.VER_STATUS_CDE = 'A'                          04180000
041900     END-EXEC.                                                    04190000
042000                                                                  04200000
042100                                                                  04210000
042200 01  FILLER                        PIC X(25) VALUE                04220000
042300          '<====WS FOR APKUT067 ENDS'.                            04230000
042400                                                                  04240000
042500*LINKAGE SECTION.                                                 04250000
042600                                                                  04260000
042700 PROCEDURE DIVISION.                                              04270000
042800                                                                  04280000
042900 A100-MAINLINE.                                                   04290000
043000***************************************************************** 04300000
043100*    MAIN DRIVER PARAGRAPH.                                       04310000
043200***************************************************************** 04320000
043300     PERFORM B100-INITIALIZATION.                                 04330000
043400     PERFORM B200-PROCESSING UNTIL END-OF-EDIIN.                  04340000
043500     PERFORM B300-END-OF-JOB.                                     04350000
043600     GOBACK.                                                      04360000
043700                                                                  04370000
043800 B100-INITIALIZATION.                                             04380000
043900***************************************************************** 04390000
044000*    PERFORM DATE, INITIALIZATION AND FILE OPENING.               04400000
044100***************************************************************** 04410000
044200     ACCEPT RUN-TIME FROM TIME.                                   04420000
044300     ACCEPT DATE-IN  FROM DATE.                                   04430000
044400                                                                  04440000
044500     DISPLAY ' RUN-DATE = ' DATE-IN '   RUN-TIME = ' RUN-TIME.    04450000
044600                                                                  04460000
044700     OPEN INPUT  EDIIN-FILE                                       04470000
044800          OUTPUT EDIOUT-FILE.                                     04480000
044900                                                                  04490000
045000     INITIALIZE DCLTPURITM.                                       04500000
045100     INITIALIZE DCLTUPC.                                          04510000
045200     INITIALIZE DCLTSKXREF.                                       04520000
045300     INITIALIZE DCLTPOPRPK.                                       04530000
045400     INITIALIZE DCLTPURCHS.                                       04540000
045500     INITIALIZE DCLTUPCSKU.                                       04550000
045600     PERFORM I100-INITIALIZE-TABLE.                               04560000
045700     PERFORM I200-INITIALIZE-FMT-TABLE.                           04570000
045800                                                                  04580000
045900     PERFORM R100-READ-AP050.                                     04590000
046000     IF END-OF-EDIIN                                              04600000
046100        DISPLAY '**********************************'              04610000
046200        DISPLAY '*   EMPTY EDI INVOICE FILE       *'              04620000
046300        DISPLAY '*   PROGRAM ** = APKUT067        *'              04630000
046400        DISPLAY '**********************************'              04640000
046500     END-IF.                                                      04650000
046600                                                                  04660000
046700 B200-PROCESSING.                                                 04670000
046800***************************************************************** 04680000
046900*     CHECK FOR COMPOUND PREPACK HEADER RECORD.  WHEN THIS        04690000
047000*     RECORD IS ENCOUNTERED, MOVE IT AND ANY ASSOCIATED PACKITEM  04700000
047100*     RECORDS (REC TYPES 08 AND 09) TO THE W/S TABLE FOR LATER    04710000
047200*     PROCESSING.  ALL OTHER RECORD TYPES ARE WRITTEN TO THE      04720000
047300*     OUTPUT FILE.                                                04730000
047400***************************************************************** 04740000
047500     IF AP050-RECORD-TYPE-IND  = '07' AND                         04750000
047600        AP050-IT1-MSR-PK-HDR                                      04760000
047700        PERFORM C100-PROCESS-PREPACK-HEADER                       04770000
047800        ADD 1 TO WS-COMPOUND-CNT                                  04780000
047900     ELSE                                                         04790000
048000        PERFORM W100-WRITE-OUT-REC                                04800000
048100        PERFORM R100-READ-AP050                                   04810000
048200     END-IF.                                                      04820000
048300                                                                  04830000
048400 B300-END-OF-JOB.                                                 04840000
048500***************************************************************** 04850000
048600*     REPORT ON NECESSARY TOTALS AND CLOSE ALL FILES.             04860000
048700***************************************************************** 04870000
048800     CLOSE EDIIN-FILE                                             04880000
048900           EDIOUT-FILE.                                           04890000
049000                                                                  04900000
049100     DISPLAY '************************************************'.  04910000
049200     DISPLAY 'TOTAL INVOICE RECORDS READ    = ' WS-EDIIN-REC-CNT. 04920000
049300     DISPLAY 'TOTAL INVOICE RECORDS WRITTEN = ' WS-EDIOUT-REC-CNT.04930000
049400     DISPLAY 'TOTAL COMPOUND PREPACKS READ    = ' WS-COMPOUND-CNT.04940000
049500     DISPLAY 'TOT CREATED PREPACK DTL WRITTEN = ' WS-PREPACK-CNT. 04950000
049600     DISPLAY 'TOT CMPD PREPACKS W/NO DTL SENT = ' WS-NO-DTL-CNT.  04960000
049700     DISPLAY 'TOT PACK UPCS THAT WERE EXPLODED= ' WS-EXPLODE-CNT. 04970000
049800     DISPLAY '************************************************'.  04980000
049900                                                                  04990000
050000     IF END-OF-EDIIN                                              05000000
050100        DISPLAY ' PROGRAM APKUT067 ENDS NORMALLY '                05010000
050200     ELSE                                                         05020000
050300        DISPLAY ' PROGRAM APKUT067 ENDS ABNORMALLY '              05030000
050400     END-IF.                                                      05040000
050500                                                                  05050000
050600     ACCEPT RUN-TIME FROM TIME.                                   05060000
050700     ACCEPT DATE-IN  FROM DATE.                                   05070000
050800                                                                  05080000
050900     DISPLAY ' RUN-DATE = ' DATE-IN '   RUN-TIME = ' RUN-TIME.    05090000
051000     DISPLAY '************************************************'.  05100000
051100                                                                  05110000
051200 C100-PROCESS-PREPACK-HEADER.                                     05120000
051300***************************************************************** 05130000
051400*     THIS PARAGRAPH CONTAINS THE DRIVER CODE THAT LOADS THE      05140000
051500*     PREPACK HEADER RECORD AND ALL ASSOCIATED PACKITEM RECORDS   05150000
051600*     TO THE W/S TABLE.  AFTER THE TABLE IS LOADED THE PREPACK    05160000
051700*     RECORDS WILL BE EDITTED AND FORMATTED AND MOVED TO THE      05170000
051800*     FORMAT W/S TABLE.  THESE CAN THEN BE WRITTEN TO THE         05180000
051900*     OUTPUT FILE AS SPECIALLY CREATED PACKITEM RECORDS (RECORD   05190000
052000*     TYPE 07 AND AP050-IT1-UNIT-MEASURE = 'PI').                 05200000
052100***************************************************************** 05210000
052200     PERFORM D100-MOVE-PREPACK-TO-TABLE                           05220000
052300        VARYING INV-INDX FROM 1 BY 1                              05230000
052400        UNTIL INV-INDX > 500 OR                                   05240000
052500              END-OF-PACK    OR                                   05250000
052600              END-OF-EDIIN.                                       05260000
052700                                                                  05270000
052800     IF INV-INDX > 500                                            05280000
052900        DISPLAY '************** ABEND *************'              05290000
053000        DISPLAY '*   WS-INVOICE-TABLE IS FULL -   *'              05300000
053100        DISPLAY '*   MORE THAN 500 PACKITEM       *'              05310000
053200        DISPLAY '*   RECORDS HAVE                 *'              05320000
053300        DISPLAY '*   BEEN RECEIVED FOR A COMPOUND *'              05330000
053400        DISPLAY '*   PACK HEADER (07 AS) RECORD   *'              05340000
053500        DISPLAY '*   PROGRAM ** = APKUT067        *'              05350000
053600        DISPLAY '*   C100-PROCESS-PREPACK-HEADER  *'              05360000
053700        DISPLAY '*   WS-AP050-PO-NBR = ' WS-AP050-PO-NBR (1)      05370000
053800        DISPLAY '*   WS-AP050-INV-NBR= ' WS-AP050-INV-NBR(1)      05380000
053900        DISPLAY '**********************************'              05390000
054000        SET INV-TABLE-FULL TO TRUE                                05400000
054100        CALL 'ILBOABN0' USING ABEND-CODE                          05410000
054200     END-IF.                                                      05420000
054300                                                                  05430000
054400     PERFORM E100-PROCESS-TABLE.                                  05440000
054500                                                                  05450000
054600     SET NOT-END-OF-PACK TO TRUE.                                 05460000
054700     INITIALIZE WS-INVOICE-COUNTERS.                              05470000
054800     INITIALIZE WS-PKHDR-GROSS-COST.                              05480000
054900     PERFORM I100-INITIALIZE-TABLE.                               05490000
055000     PERFORM I200-INITIALIZE-FMT-TABLE.                           05500000
055100                                                                  05510000
055200 D100-MOVE-PREPACK-TO-TABLE.                                      05520000
055300***************************************************************** 05530000
055400*     MOVE THE PREPACK RECORD FROM THE INPUT FILE TO THE W/S      05540000
055500*     TABLE AND READ THE NEXT RECORD FROM THE INPUT FILE.         05550000
055600***************************************************************** 05560000
055700     MOVE AP050-EDI-IN-FILE TO WS-INV-REC(INV-INDX).              05570000
055800                                                                  05580000
055900     EVALUATE AP050-RECORD-TYPE-IND                               05590000
056000        WHEN '07'                                                 05600000
056100             ADD 1 TO WS-REC-07-CNT                               05610000
056200        WHEN '08'                                                 05620000
056300             ADD 1 TO WS-REC-08-CNT                               05630000
056400        WHEN '09'                                                 05640000
056500             ADD 1 TO WS-REC-09-CNT                               05650000
056600     END-EVALUATE.                                                05660000
056700                                                                  05670000
056800     PERFORM R100-READ-AP050.                                     05680000
056900                                                                  05690000
057000     IF AP050-INV-PACK-ITEMS  OR                                  05700000
057100        AP050-INV-PKITEM-DESC                                     05710000
057200        SET NOT-END-OF-PACK TO TRUE                               05720000
057300     ELSE                                                         05730000
057400        SET END-OF-PACK TO TRUE                                   05740000
057500     END-IF.                                                      05750000
057600                                                                  05760000
057700 E100-PROCESS-TABLE.                                              05770000
057800***************************************************************** 05780000
057900*     EDIT THE W/S TABLE, RECORD BY RECORD, VALIDATING, EDITTING  05790000
058000*     AND CREATING NEW PACKITEM RECORDS.  AFTER THIS IS COMPLETED 05800000
058100*     MOVE EACH NEW PACKITEM RECORD TO THE FORMAT W/S TABLE.      05810000
058200*     THEN UPDATE THE WARN/ERROR INDS ON THE ORIGINAL PREPACK     05820000
058300*     HEADER RECORD (07 'AS') THAT IS IN THE 1ST POS ON THE TABLE.05830000
058400*     NEXT PERFORM THE ROUTINE THAT WILL WRITE OUT THE PACKITEMS  05840000
058500*     (07 'PI') FROM THE FORMAT W/S TABLE TO THE OUTPUT FILE.     05850000
058600***************************************************************** 05860000
058700     SET FMT-INDX TO 1.                                           05870000
058800     SET REC-07-FORMAT-NOT-COMPLETED TO TRUE.                     05880000
058900     PERFORM E200-EDIT-PREPACK                                    05890000
059000        VARYING INV-INDX FROM 1 BY 1                              05900000
059100        UNTIL INV-INDX > 500 OR                                   05910000
059200              WS-AP050-KEY-AREA(INV-INDX) = HIGH-VALUES.          05920000
059300                                                                  05930000
059400     IF WS-REC-08-CNT > ZERO                                      05940000
059500        MOVE NW050-NEW-REC TO WS-FMT-REC(FMT-INDX)                05950000
059600     END-IF.                                                      05960000
059700                                                                  05970000
059800     SET FMT-INDX TO 1.                                           05980000
059900     PERFORM F400-UPDATE-07-REC-INDS.                             05990000
060000                                                                  06000000
060100     PERFORM W200-WRITE-OUT-PREPACK.                              06010000
060200                                                                  06020000
060300 E200-EDIT-PREPACK.                                               06030000
060400***************************************************************** 06040000
060500*     THIS PARAGRAPH DIRECTS, DEPENDING ON REC TYPE, EACH REC IN  06050000
060600*     THE W/S TABLE TO BE EDITTED INTO NEW PACKITEM (07 'PI')     06060000
060700*     FORMATTED RECS.  THESE WILL BE LOADED TO THE FORMAT W/S     06070000
060800*     TABLE.  THE ORIGINAL PACK HEADER (07 'AS') RECORD IS MOVED  06080000
060900*     TO THE FORMAT W/S TABLE AS THE FIRST ELEMENT.  THIS RECORD  06090000
061000*     WILL NOT BE CHANGED, BUT WILL HAVE A SERIES OF WARN/ERROR   06100000
061100*     INDS AND THE SUMMED PACKITEM COST UPDATED AFTER THE ENTIRE  06110000
061200*     W/S TBL HAS BEEN PROCESSED. AFTER THE RELATED 08 AND 09 RECS06120000
061300*     HAVE BEEN FORMATTED, THE FORMATTED 07 'PI' REC WILL BE      06130000
061400*     MOVED TO THE FORMAT W/S TABLE.                              06140000
061500***************************************************************** 06150000
061600     MOVE WS-INV-REC(INV-INDX) TO WS050-WORK-REC.                 06160000
061700                                                                  06170000
061800     IF WS050-RECORD-TYPE-IND = '07'                              06180000
061900        MOVE WS050-WORK-REC TO WS-FMT-REC(FMT-INDX)               06190000
062000        SET FMT-INDX UP BY 1                                      06200000
062100        PERFORM F100-EDIT-07-RECORD                               06210000
062200     END-IF.                                                      06220000
062300                                                                  06230000
062400     IF WS050-RECORD-TYPE-IND = '08'                              06240000
062500        IF REC-07-FORMAT-COMPLETED                                06250000
062600           MOVE NW050-NEW-REC TO WS-FMT-REC(FMT-INDX)             06260000
062700           SET FMT-INDX UP BY 1                                   06270000
062800           SET REC-07-FORMAT-NOT-COMPLETED TO TRUE                06280000
062900        END-IF                                                    06290000
063000        PERFORM F200-EDIT-08-RECORD                               06300000
063100        SET REC-07-FORMAT-COMPLETED TO TRUE                       06310000
063200     END-IF.                                                      06320000
063300                                                                  06330000
063400     IF WS050-RECORD-TYPE-IND = '09'                              06340000
063500        PERFORM F300-EDIT-09-RECORD                               06350000
063600     END-IF.                                                      06360000
063700                                                                  06370000
063800     IF FMT-INDX > 500                                            06380000
063900        DISPLAY '************** ABEND *************'              06390000
064000        DISPLAY '*   WS-FORMAT-TABLE  IS FULL -   *'              06400000
064100        DISPLAY '*   MORE THAN 500 PACKITEM       *'              06410000
064200        DISPLAY '*   RECORDS (07 PI)              *'              06420000
064300        DISPLAY '*   HAVE BEEN CREATED FOR A COM- *'              06430000
064400        DISPLAY '*   POUND PACK HEADER (07 AS) REC*'              06440000
064500        DISPLAY '*   PROGRAM ** = APKUT067        *'              06450000
064600        DISPLAY '*   E200-EDIT-PREPACK            *'              06460000
064700        DISPLAY '**********************************'              06470000
064800        SET FMT-TABLE-FULL TO TRUE                                06480000
064900        CALL 'ILBOABN0' USING ABEND-CODE                          06490000
065000     END-IF.                                                      06500000
065100                                                                  06510000
065200 F100-EDIT-07-RECORD.                                             06520000
065300***************************************************************** 06530000
065400*     THIS PARAGRAPH CONTAINS ALL OF THE VALIDATING APPLIED       06540000
065500*     TO THE PACK HEADER (07 'AS') RECORD.  THE UPC HEADER IS     06550000
065600*     VALIDATED TO MAKE SURE IT EXISTS ON TPOPRPK.  IF THE UPC    06560000
065700*     HEADER IS VALID AND NO DETAIL WAS SENT VIA EDI, THEN THE    06570000
065800*     UPC HEADER WILL BE EXPLODED TO GET THE DETAIL.              06580000
065900***************************************************************** 06590000
066000***************************************************************** 06600000
066100****** MOVE THE QUANTITY AND COST ON THE 07 RECORD TO SAVE FIELDS 06610000
066200****** TO BE USED WHEN PROCESSING 08 RECORD(S).                   06620000
066300***************************************************************** 06630000
066400     MOVE WS050-QUANTITY-INVOICED TO                              06640000
066500                         WS-SAVE-QUANTITY-INVOICED.               06650000
066600     MOVE WS050-WHOLSALE-UNIT-COST TO                             06660000
066700                         WS-SAVE-PACK-COST.                       06670000
066800                                                                  06680000
066900***************************************************************** 06690000
067000****** VALIDATE THE PREPACK HEADER EXISTS ON TPOPRPK FOR THE PO   06700000
067100****** IF NO DETAIL WAS SENT.                                     06710000
067200***************************************************************** 06720000
067300*    IF WS-REC-08-CNT = ZERO                                      06730000
067400        IF WS050-UPC                                              06740000
067500           MOVE WS050-UPC-CODE TO WS-UPC-12                       06750000
067600           MOVE ZERO           TO WS-UPC-ZERO                     06760000
067700           MOVE WS-UPC-13 TO WS-UPC-13-X                          06770000
067800           IF WS-UPC-13-X NUMERIC                                 06780000
067900              MOVE WS-UPC-13-X TO WS-UPC-CODE-X                   06790000
068000              MOVE WS-UPC-CODE TO WS-UPC-CODE-COMP3               06800000
068100              PERFORM S100-VALID-PACK-HDR-UPC                     06810000
068200           END-IF                                                 06820000
068300        ELSE                                                      06830000
068400           IF WS050-EAN                                           06840000
068500              IF WS050-EAN-UPC NUMERIC                            06850000
068600                 MOVE WS050-EAN-CODE TO WS-UPC-CODE-X             06860000
068700                 MOVE WS-UPC-CODE    TO WS-UPC-CODE-COMP3         06870000
068800                 PERFORM S100-VALID-PACK-HDR-UPC                  06880000
068900              END-IF                                              06890000
069000           ELSE                                                   06900000
069100              SET WS-INVALID-PACK-HEADER TO TRUE                  06910000
069200           END-IF                                                 06920000
069300*       END-IF                                                    06930000
069400*    ELSE                                                         06940000
069500*       SET WS-VALID-PACK-HEADER TO TRUE                          06950000
069600     END-IF.                                                      06960000
069700                                                                  06970000
069800***************************************************************** 06980000
069900****** EXPLODE THE PREPACK HEADER UPC IF NO DETAIL WAS SENT       06990000
070000***************************************************************** 07000000
070100     IF WS-VALID-PACK-HEADER AND                                  07010000
070200        WS-REC-08-CNT = ZERO                                      07020000
070300        ADD 1 TO WS-EXPLODE-CNT                                   07030000
070400        PERFORM F500-EXPLODE-HDR-UPC                              07040000
070500     END-IF.                                                      07050000
070600                                                                  07060000
070700 F200-EDIT-08-RECORD.                                             07070000
070800***************************************************************** 07080000
070900*     THIS PARAGRAPH CONTAINS ALL OF THE VALIDATING AND EDITTING  07090000
071000*     CODE APPLIED TO THE 08 RECORD.  THE DATA ON THE 08 WILL BE  07100000
071100*     FORMATTED TO A NEW 07 RECORD WITH A UNIT MEASURE VALUE =    07110000
071200*     'PI' (PACKITEM).  THE NEW 07 'PI' RECORD WILL ALSO USE      07120000
071300*     DATA FROM THE 09 RECORD(S) THAT ARE ASSOCIATED WITH THE 08  07130000
071400*     RECORD BEING PROCESSED.                                     07140000
071500***************************************************************** 07150000
071600***************************************************************** 07160000
071700****** COMPUTE THE DETAIL LINE LEVEL QUANTITY BY MULTIPLYING THE  07170000
071800****** SAVED QUANTITY FROM THE 07 RECORD AND THE PACK ITEM QUANT- 07180000
071900****** ITY.  ALSO, COMPUTE THE PACK ITEM SUMMED COST THAT WILL BE 07190000
072000****** USED TO COMPARE AGAINST THE SAVED PACK COST FROM THE 07    07200000
072100****** RECORD.                                                    07210000
072200***************************************************************** 07220000
072300     INITIALIZE WS-DETAIL-PKITEM-QTY                              07230000
072400                WS-CALC-EXTEN-PKITEM-AMT.                         07240000
072500     COMPUTE WS-DETAIL-PKITEM-QTY                                 07250000
072600        =    WS050-PKITEM-QTY * WS-SAVE-QUANTITY-INVOICED.        07260000
072700     COMPUTE WS-CALC-EXTEN-PKITEM-AMT ROUNDED                     07270000
072800        =    WS050-PKITEM-QTY * WS050-PKITEM-COST.                07280000
072900     COMPUTE WS-PKHDR-GROSS-COST                                  07290000
073000        =    WS-PKHDR-GROSS-COST + WS-CALC-EXTEN-PKITEM-AMT.      07300000
073100                                                                  07310000
073200     INITIALIZE NW050-DETAILS-AREA.                               07320000
073300     MOVE WS050-KEY            TO NW050-KEY.                      07330000
073400     SET NW050-INV-DETAILS                                        07340000
073500         NW050-IT1-MSR-PK-ITEM TO TRUE.                           07350000
073600                                                                  07360000
073700     MOVE WS-DETAIL-PKITEM-QTY TO NW050-QUANTITY-INVOICED.        07370000
073800     MOVE WS050-PKITEM-COST    TO NW050-WHOLSALE-UNIT-COST.       07380000
073900                                                                  07390000
074000     SET NOT-END-OF-PKITEM-TBL TO TRUE.                           07400000
074100     PERFORM G100-PROCESS-PKITEM-ID-TABLE                         07410000
074200        VARYING WS050-PKITEM-IDX FROM 1 BY 1                      07420000
074300          UNTIL WS050-PKITEM-IDX > 10 OR                          07430000
074400                END-OF-PKITEM-TBL.                                07440000
074500                                                                  07450000
074600 F300-EDIT-09-RECORD.                                             07460000
074700***************************************************************** 07470000
074800*     THIS PARAGRAPH CONTAINS ALL OF THE VALIDATING CODE APPLIED  07480000
074900*     TO THE 09 RECORD.  THIS DATA IS MOVED TO THE NEW 07 'PI'    07490000
075000*     RECORD ALONG WITH THE RELATED 08 RECORD DATA.               07500000
075100***************************************************************** 07510000
075200     IF WS050-PKITEM-VS-DESC                                      07520000
075300        MOVE WS050-PKITEM-DESC TO NW050-VENDOR-STYLE-DSCRPT       07530000
075400     END-IF.                                                      07540000
075500                                                                  07550000
075600     IF WS050-PKITEM-CL-DESC                                      07560000
075700        MOVE WS050-PKITEM-DESC TO NW050-VENDOR-COLOR-DSCRPT       07570000
075800     END-IF.                                                      07580000
075900                                                                  07590000
076000     IF WS050-PKITEM-SZ-DESC                                      07600000
076100        MOVE WS050-PKITEM-DESC TO NW050-VENDOR-SIZE-DSCRPT        07610000
076200     END-IF.                                                      07620000
076300                                                                  07630000
076400 F400-UPDATE-07-REC-INDS.                                         07640000
076500***************************************************************** 07650000
076600*     THIS PARAGRAPH UPDATES THE VARIOUS WARNING/ERROR INDS ON    07660000
076700*     THE ORIGINAL 07 RECORD THAT WAS RECEIVED VIA EDI.  IT WILL  07670000
076800*     ALSO MOVE THE SUMMED PACKITEM COST.  THESE FIELDS WILL BE   07680000
076900*     NEEDED IN THE EDI EDIT PROGRAMS TO REPORT ON ANY WARN/ERRORS07690000
077000*     SET IN THIS PROGRAM.  THESE WARN/ERRORS WILL BE REPORTED ON 07700000
077100*     THE EXISTING EDI ERROR REPORTS.                             07710000
077200***************************************************************** 07720000
077300     MOVE WS-FMT-REC(FMT-INDX) TO NW050-NEW-REC.                  07730000
077400     MOVE WS-PKHDR-GROSS-COST  TO NW050-PK-ITEM-SUMD-COST.        07740000
077500                                                                  07750000
077600***************************************************************** 07760000
077700****** WARNING IND FOR NO EDI DETAIL BEING SENT.                  07770000
077800***************************************************************** 07780000
077900*** WR34285 - COMMENTING OUT MOST OF THE IF STATEMENT BELOW WILL  07790000
078000*** KEEP WARNING MESSAGE NUMBER 08 FROM APPEARING ON THE          07800000
078100*** ERROR REPORTS GENERATE OUT OF APKRP204 AND APKRP206.          07810000
078200*** IF WARNING MESSAGE NUMBER 08 NEEDS TO BE REINSTATED TO        07820000
078300*** APPEAR ON THE ERROR REPORTS GENERATE OUT OF                   07830000
078400*** APKRP204 AND APKRP206, THEN THE CODE BELOW CAN BE UNCOMMENTED 07840000
078500***************************************************************** 07850000
078600*    IF WS-REC-08-CNT = 0                                         07860000
078700*       MOVE 'Y' TO NW050-NO-DTL-SENT-IND                         07870000
078800*       ADD 1 TO WS-NO-DTL-CNT                                    07880000
078900*    ELSE                                                         07890000
079000        MOVE 'N' TO NW050-NO-DTL-SENT-IND.                        07900000
079100*    END-IF.                                                      07910000
079200                                                                  07920000
079300***************************************************************** 07930000
079400****** ERROR IND FOR A PACK HEADER UPC THAT CAN'T EXPLODE WHEN    07940000
079500****** DETAIL ISN'T SENT.                                         07950000
079600***************************************************************** 07960000
079700     IF (WS-REC-08-CNT = 0) AND                                   07970000
079800        (WS-INVALID-PACK-HEADER)                                  07980000
079900        MOVE 'Y' TO NW050-UPC-CANT-EXPLODE-IND                    07990000
080000     ELSE                                                         08000000
080100        MOVE 'N' TO NW050-UPC-CANT-EXPLODE-IND                    08010000
080200     END-IF.                                                      08020000
080300                                                                  08030000
080400***************************************************************** 08040000
080500****** WARNING IND FOR THE DETAIL SUMMED PACKITEM COST (FROM 08   08050000
080600****** RECS) NOT = THE PACK HEADER COST ON THE 07 'AS' REC.       08060000
080700***************************************************************** 08070000
080800*** WR34285 - COMMENTING OUT MOST OF THE IF STATEMENT BELOW WILL  08080000
080900*** KEEP WARNING MESSAGE NUMBER 09 FROM APPEARING ON THE          08090000
081000*** ERROR REPORTS GENERATE OUT OF APKRP204 AND APKRP206.          08100000
081100*** IF WARNING MESSAGE NUMBER 09 NEEDS TO BE REINSTATED TO        08110000
081200*** APPEAR ON THE ERROR REPORTS GENERATE OUT OF                   08120000
081300*** APKRP204 AND APKRP206, THEN THE CODE BELOW CAN BE UNCOMMENTED 08130000
081400***************************************************************** 08140000
081500*    IF (WS-REC-08-CNT > 0) AND                                   08150000
081600*       (WS-PKHDR-GROSS-COST NOT = WS-SAVE-PACK-COST)             08160000
081700*       MOVE 'Y' TO NW050-DTL-SENT-NOT-BLNC-IND                   08170000
081800*    ELSE                                                         08180000
081900        MOVE 'N' TO NW050-DTL-SENT-NOT-BLNC-IND.                  08190000
082000*    END-IF.                                                      08200000
082100                                                                  08210000
082200     MOVE NW050-NEW-REC       TO WS-FMT-REC(FMT-INDX).            08220000
082300                                                                  08230000
082400 F500-EXPLODE-HDR-UPC.                                            08240000
082500***************************************************************** 08250000
082600*     THIS PARAGRAPH IS THE DRIVER FOR EXPLODING THE PACK         08260000
082700*     HEADER UPC INTO ITS PACK ITEM COMPONENTS TO CREATE FORMATTED08270000
082800*     07 RECS BECAUSE NO 08/09 RECORDS WERE RECEIVED VIA EDI.     08280000
082900***************************************************************** 08290000
083000     SET MORE-ITEMS TO TRUE.                                      08300000
083100     PERFORM Y100-OPEN-PACK-ITEM-CSR.                             08310000
083200     PERFORM R200-FETCH-PACK-ITEM-CSR UNTIL OUT-OF-ITEMS.         08320000
083300     PERFORM Y200-CLOSE-PACK-ITEM-CSR.                            08330000
083400                                                                  08340000
083500***************************************************************** 08350000
083600* CONVERT ANY loWERCASE LETTERS IN THE INVOICE ID INTO UPPER-     08360000
083700* CASE LETTERS                                                    08370000
083800***************************************************************** 08380000
083900 F600-EDIT-INV-NBR-FOR-LOWCASE.                                   08390000
084000                                                                  08400000
084100     INSPECT EDIIN-INV-NBR                                        08410000
084200        CONVERTING PC-LOWER-CASE-LETTERS                          08420000
084300                TO PC-UPPER-CASE-LETTERS.                         08430000
084400                                                                  08440000
083500***************************************************************** 08441003
083600* CONVERT ANY LOWERCASE LETTERS IN THE INVOICE ID INTO UPPER-     08442003
083700* CASE LETTERS                                                    08443003
083800***************************************************************** 08444003
083900 F700-EDIT-INV-NBR-FOR-LOWCASE.                                   08445003
084000                                                                  08446003
084100     INSPECT WS-FORMAT-INV-NBR(FMT-INDX)                          08447003
084200        CONVERTING PC-LOWER-CASE-LETTERS                          08448003
084300                TO PC-UPPER-CASE-LETTERS.                         08449003
084400                                                                  08449103
084500 G100-PROCESS-PKITEM-ID-TABLE.                                    08450000
084600***************************************************************** 08460000
084700*    PROCESS THE PACKITEM TABLE THAT IS PART OF THE 08 RECORD     08470000
084800*    LAYOUT.  THIS TABLE CONTAINS THE VARIOUS PIECES OF THE PACK- 08480000
084900*    ITEM (08) RECORD SENT VIA EDI.                               08490000
085000***************************************************************** 08500000
085100     IF WS050-PKITEM-ID-TYP-CDE(WS050-PKITEM-IDX) = SPACES        08510000
085200        SET END-OF-PKITEM-TBL TO TRUE                             08520000
085300     END-IF.                                                      08530000
085400                                                                  08540000
085500     IF WS050-PKITEM-UPC(WS050-PKITEM-IDX)                        08550000
085600        SET NW050-UPC TO TRUE                                     08560000
085700        MOVE WS050-PKITEM-UPC-NBR(WS050-PKITEM-IDX) TO            08570000
085800             NW050-UPC-CODE                                       08580000
085900             WS-UPC-12                                            08590000
086000        MOVE ZERO           TO WS-UPC-ZERO                        08600000
086100        MOVE WS-UPC-13 TO WS-UPC-13-X                             08610000
086200        IF WS-UPC-13-X NUMERIC                                    08620000
086300           MOVE WS-UPC-13-X TO WS-UPC-CODE-X                      08630000
086400           MOVE WS-UPC-CODE TO WS-UPC-ITEM-COMP3                  08640000
086500           IF WS-VALID-PACK-HEADER                                08650000
086600              PERFORM S200-GET-PO-LINE                            08660000
086700              MOVE PURITM-PO-LNE-NBR TO NW050-PO-LNE-NBR          08670000
086800           END-IF                                                 08680000
086900        END-IF                                                    08690000
087000     ELSE                                                         08700000
087100        IF WS050-PKITEM-EAN(WS050-PKITEM-IDX)                     08710000
087200           SET NW050-EAN TO TRUE                                  08720000
087300           MOVE WS050-PKITEM-EAN-NBR(WS050-PKITEM-IDX) TO         08730000
087400                NW050-EAN-CODE                                    08740000
087500           IF WS050-PKITEM-EAN-NBR(WS050-PKITEM-IDX) NUMERIC      08750000
087600              MOVE WS050-PKITEM-EAN-NBR(WS050-PKITEM-IDX)         08760000
087700                TO WS-UPC-CODE                                    08770000
087800              MOVE WS-UPC-CODE    TO WS-UPC-ITEM-COMP3            08780000
087900              IF WS-VALID-PACK-HEADER                             08790000
088000                 PERFORM S200-GET-PO-LINE                         08800000
088100                 MOVE PURITM-PO-LNE-NBR TO NW050-PO-LNE-NBR       08810000
088200              END-IF                                              08820000
088300           END-IF                                                 08830000
088400        END-IF                                                    08840000
088500     END-IF.                                                      08850000
088600                                                                  08860000
088700*    IF WS050-PKITEM-EAN(WS050-PKITEM-IDX)                        08870000
088800*       SET NW050-EAN TO TRUE                                     08880000
088900*       MOVE WS050-PKITEM-EAN-NBR(WS050-PKITEM-IDX) TO            08890000
089000*            NW050-EAN-CODE                                       08900000
089100*    END-IF.                                                      08910000
089200*                                                                 08920000
089300*    IF WS050-PKITEM-UPC(WS050-PKITEM-IDX)                        08930000
089400*       SET NW050-UPC TO TRUE                                     08940000
089500*       MOVE WS050-PKITEM-UPC-NBR(WS050-PKITEM-IDX) TO            08950000
089600*            NW050-UPC-CODE                                       08960000
089700*    END-IF.                                                      08970000
089800                                                                  08980000
089900     IF WS050-PKITEM-STYLE(WS050-PKITEM-IDX)                      08990000
090000        MOVE WS050-PKITEM-VND-STYLE(WS050-PKITEM-IDX) TO          09000000
090100             NW050-VENDOR-STYLE                                   09010000
090200     END-IF.                                                      09020000
090300                                                                  09030000
090400     IF WS050-PKITEM-SKU(WS050-PKITEM-IDX)                        09040000
090500        MOVE WS050-PKITEM-SKU-NBR(WS050-PKITEM-IDX) TO            09050000
090600             NW050-KOHLS-SKU                                      09060000
090700     END-IF.                                                      09070000
090800                                                                  09080000
090900     IF WS050-PKITEM-COLOR(WS050-PKITEM-IDX) OR                   09090000
091000        WS050-PKITEM-IMP-COLOR(WS050-PKITEM-IDX)                  09100000
091100        MOVE WS050-PKITEM-COLOR-CDE(WS050-PKITEM-IDX) TO          09110000
091200             NW050-NRMA-COLOR-CODE                                09120000
091300     END-IF.                                                      09130000
091400                                                                  09140000
091500     IF WS050-PKITEM-SIZE(WS050-PKITEM-IDX) OR                    09150000
091600        WS050-PKITEM-IMP-SIZE(WS050-PKITEM-IDX)                   09160000
091700        MOVE WS050-PKITEM-SIZE-CDE(WS050-PKITEM-IDX) TO           09170000
091800             NW050-NRMA-SIZE-CODE                                 09180000
091900     END-IF.                                                      09190000
092000                                                                  09200000
092100 G200-PROCESS-PACK-ITEM-CSR.                                      09210000
092200***************************************************************** 09220000
092300*     THIS PARAGRAPH PROCESSES THE FETCHED ROWS FROM THE PACK-    09230000
092400*     ITEM CURSOR WHEN A PACK HEADER UPC HAS BEEN EXPLODED.       09240000
092500***************************************************************** 09250000
092600     INITIALIZE NW050-DETAILS-AREA.                               09260000
092700     INITIALIZE WS-PKITM-UPC-NBR-UNPK                             09270000
092800                WS-PKITM-UPC-NBR.                                 09280000
092900     MOVE WS050-KEY                TO NW050-KEY.                  09290000
093000     SET NW050-INV-DETAILS                                        09300000
093100         NW050-IT1-MSR-PK-ITEM     TO TRUE.                       09310000
093200                                                                  09320000
093300     INITIALIZE WS-DETAIL-PKITEM-QTY.                             09330000
093400     COMPUTE WS-DETAIL-PKITEM-QTY                                 09340000
093500        = PURITM-PREPK-RATO-QTY * WS-SAVE-QUANTITY-INVOICED.      09350000
093600     MOVE WS-DETAIL-PKITEM-QTY     TO NW050-QUANTITY-INVOICED.    09360000
093700                                                                  09370000
093800***************************************************************** 09380000
093900****** FOR IMPORT AND DOMESTIC  TYPE PURCHASE ORDERS, USE         09390000
094000****** THE PURITM-PRD-1ST-COST-AMT FOR THE UNIT COST.             09400000
094100***************************************************************** 09410000
094200     MOVE PURITM-PRD-1ST-COST-AMT  TO NW050-WHOLSALE-UNIT-COST.   09420000
094300                                                                  09430000
094400*    INITIALIZE WS-CALC-EXTEN-PKITEM-AMT.                         09440000
094500*    COMPUTE WS-CALC-EXTEN-PKITEM-AMT ROUNDED                     09450000
094600*       =    NW050-QUANTITY-INVOICED * NW050-WHOLSALE-UNIT-COST.  09460000
094700*    COMPUTE WS-PKHDR-GROSS-COST                                  09470000
094800*       =    WS-PKHDR-GROSS-COST + WS-CALC-EXTEN-PKITEM-AMT.      09480000
094900                                                                  09490000
095000     SET NW050-UPC                 TO TRUE.                       09500000
095100     MOVE UPC-UPC-NBR              TO WS-PKITM-UPC-NBR-UNPK.      09510000
095200     MOVE WS-PKITM-UPC-NBR-UNPK    TO WS-PKITM-UPC-NBR.           09520000
095300     MOVE WS-PKITM-UPC-NBR         TO NW050-UPC-CODE.             09530000
095400                                                                  09540000
095500     MOVE PURITM-VEND-STYL-NAME    TO NW050-VENDOR-STYLE.         09550000
095600     MOVE PURITM-SKU-DESC          TO NW050-VENDOR-STYLE-DSCRPT.  09560000
095700                                                                  09570000
095800     MOVE PURITM-COLOR-CDE         TO NW050-NRMA-COLOR-CODE.      09580000
095900     MOVE PURITM-COLOR-DESC        TO NW050-VENDOR-COLOR-DSCRPT.  09590000
096000                                                                  09600000
096100     MOVE PURITM-SIZE-CDE          TO NW050-NRMA-SIZE-CODE.       09610000
096200     MOVE PURITM-SIZE-DESC         TO NW050-VENDOR-SIZE-DSCRPT.   09620000
096300     MOVE PURITM-PO-LNE-NBR        TO NW050-PO-LNE-NBR.           09630000
096400                                                                  09640000
096500     MOVE NW050-NEW-REC            TO WS-FMT-REC(FMT-INDX).       09650000
096600     SET FMT-INDX UP BY 1.                                        09660000
096700                                                                  09670000
096800 I100-INITIALIZE-TABLE.                                           09680000
096900***************************************************************** 09690000
097000*    THIS PARAGRAPH INITIALIZES THE W/S TABLE.                    09700000
097100*    PERFORM SETTING THE TABLE KEY AREA TO HIGH VALUES SO THAT    09710000
097200*    THE END-OF-INVOICE CAN BE DETERMINED.                        09720000
097300*    INITIALIZE THE REST OF THE TABLE PER DATA DEFINITION.        09730000
097400***************************************************************** 09740000
097500     PERFORM VARYING INV-INDX FROM 1 BY 1                         09750000
097600        UNTIL INV-INDX > 500                                      09760000
097700        MOVE HIGH-VALUES TO WS-AP050-KEY-AREA(INV-INDX)           09770000
097800        INITIALIZE WS-AP050-DATA-AREA(INV-INDX)                   09780000
097900     END-PERFORM.                                                 09790000
098000                                                                  09800000
098100     SET INV-INDX TO 1.                                           09810000
098200     SET INV-INDX DOWN BY 1.                                      09820000
098300                                                                  09830000
098400 I200-INITIALIZE-FMT-TABLE.                                       09840000
098500***************************************************************** 09850000
098600*    THIS PARAGRAPH INITIALIZES THE FORMAT W/S TABLE.             09860000
098700*    PERFORM SETTING THE TABLE KEY AREA TO HIGH VALUES SO THAT    09870000
098800*    THE END-OF-INVOICE CAN BE DETERMINED.                        09880000
098900*    INITIALIZE THE REST OF THE TABLE PER DATA DEFINITION.        09890000
099000***************************************************************** 09900000
099100     PERFORM VARYING FMT-INDX FROM 1 BY 1                         09910000
099200        UNTIL FMT-INDX > 500                                      09920000
099300        MOVE HIGH-VALUES TO WS-FORMAT-KEY-AREA(FMT-INDX)          09930000
099400        INITIALIZE WS-FORMAT-DATA-AREA(FMT-INDX)                  09940000
099500     END-PERFORM.                                                 09950000
099600                                                                  09960000
099700     SET FMT-INDX TO 1.                                           09970000
099800     SET FMT-INDX DOWN BY 1.                                      09980000
099900                                                                  09990000
100000 R100-READ-AP050.                                                 10000000
100100***************************************************************** 10010000
100200*    READ IN THE EDI TRANSMISSION FILE.                           10020000
100300***************************************************************** 10030000
100400     READ EDIIN-FILE INTO AP050-EDI-IN-FILE                       10040000
100500          AT END SET END-OF-EDIIN TO TRUE.                        10050000
100600                                                                  10060000
100700     IF NOT END-OF-EDIIN                                          10070000
100800        PERFORM F600-EDIT-INV-NBR-FOR-LOWCASE                     10080000
100900        ADD 1 TO WS-EDIIN-REC-CNT                                 10090000
101000     END-IF.                                                      10100000
101100                                                                  10110000
101200 R200-FETCH-PACK-ITEM-CSR.                                        10120000
101300***************************************************************** 10130000
101400*    FETCH THE PACK ITEM CURSOR.                                  10140000
101500***************************************************************** 10150000
101600     EXEC SQL                                                     10160000
101700        FETCH PACK_ITEM_CSR                                       10170000
101800        INTO :PURITM-PREPK-RATO-QTY                               10180000
101900            ,:PURITM-PRD-1ST-COST-AMT                             10190000
102000            ,:PURITM-VEND-STYL-NAME                               10200000
102100            ,:PURITM-SKU-DESC                                     10210000
102200            ,:PURITM-COLOR-CDE                                    10220000
102300            ,:PURITM-COLOR-DESC                                   10230000
102400            ,:PURITM-SIZE-CDE                                     10240000
102500            ,:PURITM-SIZE-DESC                                    10250000
102600            ,:PURITM-PO-LNE-NBR                                   10260000
102700            ,:UPC-UPC-NBR                                         10270000
102800            ,:PURCHS-PO-TYP-CDE                                   10280000
102900     END-EXEC.                                                    10290000
103000                                                                  10300000
103100     EVALUATE TRUE                                                10310000
103200         WHEN SQLCODE = ZERO                                      10320000
103300              PERFORM G200-PROCESS-PACK-ITEM-CSR                  10330000
103400                                                                  10340000
103500         WHEN SQLCODE = +100                                      10350000
103600              SET OUT-OF-ITEMS TO TRUE                            10360000
103700                                                                  10370000
103800         WHEN SQLWARN0 NOT = SPACES                               10380000
103900         WHEN SQLCODE  NOT = ZERO                                 10390000
104000              MOVE 'R200-FETCH-PACK-ITEM-CSR      '               10400000
104100                            TO WS-ABEND-PARAGRAPH                 10410000
104200              MOVE 'UNSUCCESSFUL FETCH OF CURSOR'                 10420000
104300                            TO WS-ABEND-OPERATION                 10430000
104400              MOVE 'TPOPRPK ' TO WS-ABEND-STRUCTURE-1             10440000
104500              MOVE 'TPURITM ' TO WS-ABEND-STRUCTURE-2             10450000
104600              MOVE 'TSKXREF ' TO WS-ABEND-STRUCTURE-3             10460000
104700              MOVE 'TUPC    ' TO WS-ABEND-STRUCTURE-4             10470000
104800              MOVE 'TPURCHS ' TO WS-ABEND-STRUCTURE-5             10480000
104900              PERFORM Z999-SQL-ERROR                              10490000
105000     END-EVALUATE.                                                10500000
105100                                                                  10510000
105200 S100-VALID-PACK-HDR-UPC.                                         10520000
105300***************************************************************** 10530000
105400*     CHECK FOR VALID PACK HEADER UPC.                            10540000
105500***************************************************************** 10550000
105600     INITIALIZE DCLTPOPRPK                                        10560000
105700                DCLTPURITM.                                       10570000
105800                                                                  10580000
105900     MOVE SPACE                 TO PV-ONE.                        10590000
106000     SET WS-INVALID-PACK-HEADER TO TRUE.                          10600000
106100     MOVE WS050-KOHLS-PO-NBR    TO WS-SAVE-PO-NBR-COMP.           10610000
106200                                                                  10620000
106300     EXEC SQL                                                     10630000
106400        SELECT DISTINCT A.PO_PREPK_ID                             10640000
106500          INTO :POPRPK-PO-PREPK-ID                                10650000
106600          FROM  TPOPRPK A                                         10660000
106700               ,TPURITM B                                         10670000
106800         WHERE A.PO_NBR         = B.PO_NBR                        10680000
106900           AND A.PO_PREPK_ID    = B.PO_PREPK_ID                   10690000
107000           AND A.PO_NBR         = :WS-SAVE-PO-NBR-COMP            10700000
107100           AND A.PREPK_UPC_NBR  = :WS-UPC-CODE-COMP3              10710000
107200           AND B.VER_STATUS_CDE = 'A'                             10720000
107300     END-EXEC.                                                    10730000
107400                                                                  10740000
107500     EVALUATE TRUE                                                10750000
107600         WHEN SQLCODE = ZERO                                      10760000
107700             SET WS-VALID-PACK-HEADER TO TRUE                     10770000
107800         WHEN SQLCODE = +100                                      10780000
107900             SET WS-INVALID-PACK-HEADER TO TRUE                   10790000
108000         WHEN SQLCODE = -811                                      10800000
108100             PERFORM S110-CHECK-PACKHEAD-STATUS                   10810000
108200         WHEN SQLWARN0 NOT = SPACES                               10820000
108300         WHEN SQLCODE  NOT = ZERO                                 10830000
108400              MOVE 'S100-VALID-PACK-HDR-UPC' TO WS-ABEND-PARAGRAPH10840000
108500              MOVE 'UNSUCCESSFUL VALIDATE OF PACK HDR'            10850000
108600                                           TO WS-ABEND-OPERATION  10860000
108700              MOVE 'TPOPRPK '              TO WS-ABEND-STRUCTURE-110870000
108800              MOVE 'TPURITM '              TO WS-ABEND-STRUCTURE-210880000
108900              PERFORM Z999-SQL-ERROR                              10890000
109000     END-EVALUATE.                                                10900000
109100                                                                  10910000
109200                                                                  10920000
109300***************************************************************** 10930000
109400*    CHECK FOR VALID PACK HEADER UPC EXCLUDING CANCELLED STATUS   10940000
109500***************************************************************** 10950000
109600 S110-CHECK-PACKHEAD-STATUS.                                      10960000
109700                                                                  10970000
109800     EXEC SQL                                                     10980000
109900        SELECT DISTINCT A.PO_PREPK_ID                             10990000
110000          INTO :POPRPK-PO-PREPK-ID                                11000000
110100          FROM  TPOPRPK A                                         11010000
110200               ,TPURITM B                                         11020000
110300         WHERE A.PO_NBR         = B.PO_NBR                        11030000
110400           AND A.PO_PREPK_ID    = B.PO_PREPK_ID                   11040000
110500           AND A.PO_NBR         = :WS-SAVE-PO-NBR-COMP            11050000
110600           AND A.PREPK_UPC_NBR  = :WS-UPC-CODE-COMP3              11060000
110700           AND B.VER_STATUS_CDE = 'A'                             11070000
110800           AND B.STATUS_CDE    <> 'CA'                            11080000
110900     END-EXEC.                                                    11090000
111000                                                                  11100000
111100     EVALUATE TRUE                                                11110000
111200         WHEN SQLCODE = ZERO                                      11120000
111300             SET WS-VALID-PACK-HEADER TO TRUE                     11130000
111400         WHEN SQLCODE = +100                                      11140000
111500             SET WS-INVALID-PACK-HEADER TO TRUE                   11150000
111600         WHEN SQLWARN0 NOT = SPACES                               11160000
111700         WHEN SQLCODE  NOT = ZERO                                 11170000
111800              MOVE 'S110-CHECK-PACKHEAD-STATUS'                   11180000
111900                                           TO WS-ABEND-PARAGRAPH  11190000
112000              MOVE 'UNSUCCESSFUL VALIDATE OF PACK HDR'            11200000
112100                                           TO WS-ABEND-OPERATION  11210000
112200              MOVE 'TPOPRPK '              TO WS-ABEND-STRUCTURE-111220000
112300              MOVE 'TPURITM '              TO WS-ABEND-STRUCTURE-211230000
112400              PERFORM Z999-SQL-ERROR                              11240000
112500     END-EVALUATE.                                                11250000
112600                                                                  11260000
112700 S200-GET-PO-LINE.                                                11270000
112800***************************************************************** 11280000
112900*     CHECK FOR VALID PACK HEADER UPC.                            11290000
113000***************************************************************** 11300000
113100                                                                  11310000
113200     MOVE WS050-KOHLS-PO-NBR    TO WS-SAVE-PO-NBR-COMP.           11320000
113300                                                                  11330000
113400     EXEC SQL                                                     11340000
113500       SELECT B.PO_LNE_NBR                                        11350000
113600         INTO :PURITM-PO-LNE-NBR                                  11360000
113700         FROM TPURITM B                                           11370000
113800            , TUPCSKU C                                           11380000
113900         WHERE B.PO_NBR         = :WS-SAVE-PO-NBR-COMP            11390000
114000           AND B.PO_PREPK_ID    = :POPRPK-PO-PREPK-ID             11400000
114100           AND B.ITM_NBR        = C.ITEM_NBR                      11410000
114200           AND C.UPC_NBR        = :WS-UPC-ITEM-COMP3              11420000
114300           AND B.VER_STATUS_CDE = 'A'                             11430000
114400     END-EXEC.                                                    11440000
114500                                                                  11450000
114600     EVALUATE TRUE                                                11460000
114700         WHEN SQLCODE = ZERO                                      11470000
114800            CONTINUE                                              11480000
114900         WHEN SQLCODE = +100                                      11490000
115000            MOVE ZERO TO PURITM-PO-LNE-NBR                        11500000
115100         WHEN SQLWARN0 NOT = SPACES                               11510000
115200         WHEN SQLCODE  NOT = ZERO                                 11520000
115300            MOVE 'S200-GET-PO-LINE' TO WS-ABEND-PARAGRAPH         11530000
115400            MOVE 'UNSUCCESSFUL SELECT' TO WS-ABEND-OPERATION      11540000
115500            MOVE 'TUPCSKU ' TO WS-ABEND-STRUCTURE-1               11550000
115600            MOVE 'TPURITM ' TO WS-ABEND-STRUCTURE-2               11560000
115700            PERFORM Z999-SQL-ERROR                                11570000
115800     END-EVALUATE.                                                11580000
115900                                                                  11590000
116000                                                                  11600000
116100 W100-WRITE-OUT-REC.                                              11610000
116200***************************************************************** 11620000
116300*     WRITE OUT THE EDI INVOICE TRANSMISSION RECORDS THAT ARE     11630000
116400*     NOT RELATED TO A PACK HEADER RECORD (07 'AS').              11640000
116500***************************************************************** 11650000
116600     WRITE EDIOUT-RECORD FROM EDIIN-RECORD.                       11660000
116700     ADD 1 TO WS-EDIOUT-REC-CNT.                                  11670000
116800                                                                  11680000
116900 W200-WRITE-OUT-PREPACK.                                          11690000
117000***************************************************************** 11700000
117100*     WRITE OUT EDI INVOICE PREPACK RECORDS FROM THE FORMAT TABLE.11710000
117200*     AFTER THIS IS DONE, THE FORMAT TABLE IS REINITIALIZE FOR THE11720000
117300*     NEXT PACKITEM RECORD (08 AND RELATED 09).                   11730000
117400***************************************************************** 11740000
117500     PERFORM VARYING FMT-INDX FROM 1 BY 1                         11750000
117600        UNTIL FMT-INDX > 500 OR                                   11760000
117700              WS-FORMAT-KEY-AREA(FMT-INDX) = HIGH-VALUES          11770000
083900        PERFORM F700-EDIT-INV-NBR-FOR-LOWCASE                     11771003
117800        WRITE EDIOUT-RECORD FROM WS-FMT-REC(FMT-INDX)             11780000
117900        ADD 1 TO WS-EDIOUT-REC-CNT                                11790000
118000                 WS-PREPACK-CNT                                   11800000
118100     END-PERFORM.                                                 11810000
118200                                                                  11820000
118300     PERFORM I200-INITIALIZE-FMT-TABLE.                           11830000
118400                                                                  11840000
118500 Y100-OPEN-PACK-ITEM-CSR.                                         11850000
118600***************************************************************** 11860000
118700*     OPEN THE PACK ITEM CURSOR.                                  11870000
118800***************************************************************** 11880000
118900     EXEC SQL                                                     11890000
119000        OPEN PACK_ITEM_CSR                                        11900000
119100     END-EXEC.                                                    11910000
119200                                                                  11920000
119300     EVALUATE TRUE                                                11930000
119400         WHEN SQLCODE = ZERO                                      11940000
119500              CONTINUE                                            11950000
119600                                                                  11960000
119700         WHEN SQLWARN0 NOT = SPACES                               11970000
119800         WHEN SQLCODE  NOT = ZERO                                 11980000
119900              MOVE 'Y100-OPEN-PACK-ITEM-CSR       '               11990000
120000                            TO WS-ABEND-PARAGRAPH                 12000000
120100              MOVE 'UNSUCCESSFUL OPEN CURSOR  '                   12010000
120200                            TO WS-ABEND-OPERATION                 12020000
120300              MOVE 'TPOPRPK ' TO WS-ABEND-STRUCTURE-1             12030000
120400              MOVE 'TPURITM ' TO WS-ABEND-STRUCTURE-2             12040000
120500              MOVE 'TSKXREF ' TO WS-ABEND-STRUCTURE-3             12050000
120600              MOVE 'TUPC    ' TO WS-ABEND-STRUCTURE-4             12060000
120700              MOVE 'TPURCHS ' TO WS-ABEND-STRUCTURE-5             12070000
120800              PERFORM Z999-SQL-ERROR                              12080000
120900     END-EVALUATE.                                                12090000
121000                                                                  12100000
121100 Y200-CLOSE-PACK-ITEM-CSR.                                        12110000
121200***************************************************************** 12120000
121300*     CLOSE THE PACK ITEM CURSOR.                                 12130000
121400***************************************************************** 12140000
121500     EXEC SQL                                                     12150000
121600        CLOSE PACK_ITEM_CSR                                       12160000
121700     END-EXEC.                                                    12170000
121800                                                                  12180000
121900     EVALUATE TRUE                                                12190000
122000         WHEN SQLCODE = ZERO                                      12200000
122100              CONTINUE                                            12210000
122200                                                                  12220000
122300         WHEN SQLWARN0 NOT = SPACES                               12230000
122400         WHEN SQLCODE  NOT = ZERO                                 12240000
122500              MOVE 'Y200-CLOSE-PACK-ITEM-CSR      '               12250000
122600                            TO WS-ABEND-PARAGRAPH                 12260000
122700              MOVE 'UNSUCCESSFUL CLOSE CURSOR '                   12270000
122800                            TO WS-ABEND-OPERATION                 12280000
122900              MOVE 'TPOPRPK ' TO WS-ABEND-STRUCTURE-1             12290000
123000              MOVE 'TPURITM ' TO WS-ABEND-STRUCTURE-2             12300000
123100              MOVE 'TSKXREF ' TO WS-ABEND-STRUCTURE-3             12310000
123200              MOVE 'TSKU    ' TO WS-ABEND-STRUCTURE-4             12320000
123300              MOVE 'TPURCHS ' TO WS-ABEND-STRUCTURE-5             12330000
123400              PERFORM Z999-SQL-ERROR                              12340000
123500     END-EVALUATE.                                                12350000
123600                                                                  12360000
123700 Z999-SQL-ERROR.                                                  12370000
123800***************************************************************** 12380000
123900*     PROCESS DB2 ABENDS.                                         12390000
124000***************************************************************** 12400000
124100     DISPLAY 'PO BEING PROCESSED = ' WS050-KOHLS-PO-NBR.          12410000
124200     DISPLAY '*** DB2 ERROR '.                                    12420000
124300     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 12430000
124400     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               12440000
124500     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               12450000
124600     DISPLAY '*** TABLE 1   = ' WS-ABEND-STRUCTURE-1.             12460000
124700     IF WS-ABEND-STRUCTURE-2 > SPACES                             12470000
124800         DISPLAY '*** TABLE 2   = ' WS-ABEND-STRUCTURE-2.         12480000
124900     IF WS-ABEND-STRUCTURE-3 > SPACES                             12490000
125000         DISPLAY '*** TABLE 3   = ' WS-ABEND-STRUCTURE-3.         12500000
125100     IF WS-ABEND-STRUCTURE-4 > SPACES                             12510000
125200         DISPLAY '*** TABLE 4   = ' WS-ABEND-STRUCTURE-4.         12520000
125300     IF WS-ABEND-STRUCTURE-5 > SPACES                             12530000
125400         DISPLAY '*** TABLE 5   = ' WS-ABEND-STRUCTURE-5.         12540000
125500                                                                  12550000
125600     MOVE +4013                    TO ABEND-CODE.                 12560000
125700                                                                  12570000
125800     COPY DPPD004.                                                12580000
125900     CALL 'ILBOABN0' USING ABEND-CODE.                            12590000
