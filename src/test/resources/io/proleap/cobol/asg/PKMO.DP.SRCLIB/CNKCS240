000100*-----------------------*                                         00010092
000200 IDENTIFICATION DIVISION.                                         00020092
000300*-----------------------*                                         00030092
000400 PROGRAM-ID.    CNKCS240.                                         00040092
000500 AUTHOR.        DENISE HAHN                                       00050092
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060092
000700 DATE-WRITTEN.  JUNE, 2012                                        00070092
000800 DATE-COMPILED.                                                   00080092
000900*---------------------------------------------------------------* 00090092
001000*    Y240 - CN - SEASONAL SET DIVERT CODE UPDATE                  00100092
001100*    THIS PROGRAM WILL PROCESS THE SEASONAL SET CODE UPDATE       00110092
001200*    WHEN THE ASSOCIATE SELECTS F15-UPDATE, FROM CRIT SPEC        00120092
001300*    SCREEN (CNKCS238). OR THEY CAN GO TO F23-LIST (CNKCS239)     00130092
001400*---------------------------------------------------------------* 00140092
263455* CHANGED 11/03/2021    BY JIM HUNTER      WR: CHG0263455         00141099
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00142099
263455* MAKING THE CALL DYNAMIC VS STATIC.                              00143099
263455*----------------------------------------------------------------*00144099
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961         00145099
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00146099
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00147099
CICS  *-----------------------------------------------------------------00148099
001500 ENVIRONMENT DIVISION.                                            00150092
001600 DATA DIVISION.                                                   00160092
001700                                                                  00170092
001800 WORKING-STORAGE SECTION.                                         00180092
001900                                                                  00190092
002700                                                                  00200092
002800 01  PC-PROGRAM-CONSTANTS.                                        00210092
002900     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'CNKCS240'.  00220092
003000     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'CNK240  '.  00230092
003100     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'CNKM240 '.  00240092
003400     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00250092
003500                                              COMP.               00260092
003600     05  PC-INTER-APPL-CODES.                                     00270092
003700         10  PC-INTER-APPL-CRIT-SPEC-UPD  PIC  X(01)  VALUE '1'.  00280092
004000         10  PC-INTER-APPL-LIST-UPDATE    PIC  X(01)  VALUE '2'.  00290092
005300     05  PC-U                             PIC  X(01)  VALUE 'U'.  00300092
005500                                                                  00310092
005600*----------------------------------------------------------------*00320092
005700*  SYSTEM MESSAGES                                                00330092
005800*----------------------------------------------------------------*00340092
005900* 00005 - INVALID VALUE                                           00350092
006000* 00007 - REQUIRED ENTRY                                          00360092
006100* 00008 - MUST BE NUMERIC                                         00370092
006300* 00045 - INVALID FUNCTION                                        00380092
006400* 00059 - UPDATE(S) SUCCESSFUL                                    00390092
006500* 00069 - TOP OF LIST                                             00400092
006600* 00070 - BOTTOM OF LIST                                          00410092
006700* 02612 - YOU DO NOT HAVE AUTHORITY TO UPDATE                     00420092
008300* 03711 - INVALID STORE RELEASE DATE                              00430092
008310* 03712 - UPDATE SEASET DIVERT - F2 TO CONFIRM                    00440092
008320* 03713 - INVALID DIVERT CODE - MUST BE 10,20,30,40 ...           00450092
008330* 03714 - STORE RELEASE DATE MUST BE > CURRENT DATE               00460092
008340* 03715 - STORE RELEASE DATE MUST MATCH IF SHARED BY MULTI SETS   00470092
008350* 03725 - RECEIVERS ALREADY DOWNLOADED CASEPACK SPLIT             00480092
008360* 03726 - CARTONS ALREADY CHECKED IN FOR THIS SET                 00490092
008600*----------------------------------------------------------------*00500092
008700*                                                                 00510092
008800     05  PC-TSYMSG-NUMBERS.                                       00520092
008900         10  PC-TSYMSG-00005      PIC  9(05)  VALUE  00005.       00530092
009000         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       00540092
009100         10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       00550092
009300         10  PC-TSYMSG-00045      PIC  9(05)  VALUE  00045.       00560092
009400         10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       00570092
009500         10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.       00580092
009510         10  PC-TSYMSG-02612      PIC  9(05)  VALUE  02612.       00590092
009600         10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.       00600092
011500         10  PC-TSYMSG-03711      PIC  9(05)  VALUE  03711.       00610092
011510         10  PC-TSYMSG-03712      PIC  9(05)  VALUE  03712.       00620092
011520         10  PC-TSYMSG-03713      PIC  9(05)  VALUE  03713.       00630092
011530         10  PC-TSYMSG-03714      PIC  9(05)  VALUE  03714.       00640092
011540         10  PC-TSYMSG-03715      PIC  9(05)  VALUE  03715.       00650092
011550         10  PC-TSYMSG-03725      PIC  9(05)  VALUE  03725.       00660092
011560         10  PC-TSYMSG-03726      PIC  9(05)  VALUE  03726.       00670092
011700*                                                                 00680092
011800 01  DK-DB2-KEYS.                                                 00690092
011900     05  DK-DIVERT-NBR            PIC S9(04) COMP.                00700092
012010*                                                                 00710092
012020 01  PS-PROGRAM-SWITCHES.                                         00720092
012030     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         00730092
012040         88  PS-ERROR                         VALUE  'Y'.         00740092
012100         88  PS-NO-ERROR                      VALUE  'N'.         00750092
012200     05  PS-COMMAREA-SW           PIC  X(01)  VALUE  'N'.         00760092
012300         88  PS-COMMAREA-VALID                VALUE  'Y'.         00770092
012400         88  PS-COMMAREA-NOT-VALID            VALUE  'N'.         00780092
012500     05  PS-LIST-END-SW           PIC  X(01)  VALUE  'N'.         00790092
012600         88  PS-LIST-END                      VALUE  'Y'.         00800092
012700         88  PS-NO-LIST-END                   VALUE  'N'.         00810092
014000     05  PS-DIVERT-CHANGED-SW      PIC X(01)  VALUE  'N'.         00820092
014100         88  PS-DIVERT-CHANGED-YES            VALUE  'Y'.         00830092
014200         88  PS-DIVERT-CHANGED-NO             VALUE  'N'.         00840092
014210     05  PS-UPDATE-ALLOWED-SW      PIC X(01)  VALUE  'N'.         00850092
014220         88  PS-UPDATE-ALLOWED                VALUE  'Y'.         00860092
014230         88  PS-UPDATE-NOT-ALLOWED            VALUE  'N'.         00870092
014240     05  PS-EOF-DWNLD-CSR-SW       PIC X(01)  VALUE  'N'.         00880092
014250         88  PS-EOF-DWNLD-CSR                 VALUE  'Y'.         00890092
014260         88  PS-EOF-DWNLD-CSR-NO              VALUE  'N'.         00900092
014261     05  PS-EOF-SET-RCVR-CSR-SW    PIC X(01)  VALUE  'N'.         00910092
014262         88  PS-EOF-SET-RCVR-CSR              VALUE  'Y'.         00920092
014263         88  PS-EOF-SET-RCVR-CSR-NO           VALUE  'N'.         00930092
014270     05  PS-CARTONS-CHECKED-IN-SW  PIC X(01)  VALUE  'N'.         00940092
014280         88  PS-CARTONS-CHECKED-IN-YES        VALUE  'Y'.         00950092
014290         88  PS-CARTONS-CHECKED-IN-NO         VALUE  'N'.         00960092
014300*                                                                 00970092
014400 01  PV-PROGRAM-VARIABLES.                                        00980092
014500     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            00990092
014600                                              COMP SYNC.          01000092
014700     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            01010092
014800                                              COMP SYNC.          01020092
014801     05  PV-SHARED-DIVERT         PIC S9(09)  COMP.               01030092
014810     05  PV-DEFAULT-DATE          PIC  X(10).                     01040092
014820         88 PV-NO-STR-RLSE-DTE                VALUE '9999-09-09'. 01050092
014830     05  PV-DIVERT-HOLD           PIC  X(02).                     01060092
014840         88 PV-VALID-DIVERT            VALUES '10',               01070092
014841                                              '20',               01080092
014842                                              '30',               01090092
014843                                              '40',               01100092
014844                                              '50',               01110092
014845                                              '60',               01120092
014846                                              '70',               01130092
014847                                              '80',               01140092
014848                                              '90',               01150092
014849                                              '00'.               01160092
014850     05  PV-CSEPK-COUNT           PIC S9(09)  COMP.               01170092
014851     05  PV-CHECK-IN-COUNT        PIC S9(09)  COMP.               01180092
014852     05  PV-REC-CHECK-IN-COUNT    PIC S9(09)  COMP.               01190092
014860     05  PV-DISP-CSEPK            PIC ZZZ,ZZZ.                    01200092
014870                                                                  01210092
014880     05  PV-DISP-ORDER            PIC X(17) VALUE SPACES.         01220092
014881     05  PV-DISP-ORDER-R REDEFINES PV-DISP-ORDER.                 01230092
014882         10  PV-MSG-DISP-OPER     PIC Z(03).                      01240092
014883         10  PV-MSG-DASH-1        PIC X(01).                      01250092
014884         10  PV-MSG-DISP-PO       PIC 9(08).                      01260092
014885         10  PV-MSG-DASH-2        PIC X(01).                      01270092
014886         10  PV-MSG-DISP-RCVR     PIC 9(04).                      01280092
014887                                                                  01290092
014888     05  PV-MSG-LINE-COUNT        PIC 9(04) VALUE ZEROES.         01300092
014889     05  PV-MSG-ELEMENT-COUNT     PIC 9(04) VALUE ZEROES.         01310092
014890                                                                  01320092
014891     05  PV-MESSAGE-2             PIC X(76) VALUE SPACES.         01330092
014892     05  PV-MESSAGE-2-R REDEFINES PV-MESSAGE-2.                   01340092
014900         10  PV-ORDER-2A          PIC X(17).                      01350092
015000         10  FILLER               PIC X(02).                      01360092
015100         10  PV-ORDER-2B          PIC X(17).                      01370092
015200         10  FILLER               PIC X(02).                      01380092
015300         10  PV-ORDER-2C          PIC X(17).                      01390092
015400         10  FILLER               PIC X(02).                      01400092
015500         10  PV-ORDER-2D          PIC X(17).                      01410092
015600         10  FILLER               PIC X(02).                      01420092
015710                                                                  01430092
015800     05  PV-MESSAGE-3             PIC X(76) VALUE SPACES.         01440092
015900     05  PV-MESSAGE-3-R REDEFINES PV-MESSAGE-3.                   01450092
016000         10  PV-ORDER-3A          PIC X(17).                      01460092
016100         10  FILLER               PIC X(02).                      01470092
016200         10  PV-ORDER-3B          PIC X(17).                      01480092
016300         10  FILLER               PIC X(02).                      01490092
016400         10  PV-ORDER-3C          PIC X(17).                      01500092
016500         10  FILLER               PIC X(02).                      01510092
016510         10  PV-ORDER-3D          PIC X(17).                      01520092
016520         10  FILLER               PIC X(02).                      01530092
016540                                                                  01540092
016550     05  PV-MESSAGE-4             PIC X(76) VALUE SPACES.         01550092
016560     05  PV-MESSAGE-4-R REDEFINES PV-MESSAGE-4.                   01560092
016570         10  PV-ORDER-4A          PIC X(17).                      01570092
016580         10  FILLER               PIC X(02).                      01580092
016590         10  PV-ORDER-4B          PIC X(17).                      01590092
016591         10  FILLER               PIC X(02).                      01600092
016592         10  PV-ORDER-4C          PIC X(17).                      01610092
016593         10  FILLER               PIC X(02).                      01620092
016594         10  PV-ORDER-4D          PIC X(17).                      01630092
016595         10  FILLER               PIC X(02).                      01640092
      ****PRB0049796 START                                              01650093
           05  PV-DIVERT-PREFIX-NBR     PIC 9(02) VALUE ZEROES.         01660093
           05  PV-TEMP-VAR              PIC 9(02) VALUE ZEROES.         01661099
      ****PRB0049796 END                                                01670093
016600******************************************************************01680092
016700*PV-INP VARIABLES HOLD COMMAREA VALUES                            01690092
016800*       ONLY PV-INP VARIABLES READ FROM AND WRITE TO ASC-'S       01700092
016900******************************************************************01710092
017000     05  PV-INP-DIVERT-NBR            PIC  X(02).                 01720092
018500                                                                  01730092
018600*---------------------------------------------------------------* 01740092
018700* SELECTON QUEUE LAYOUT                                         * 01750092
018800*---------------------------------------------------------------* 01760092
018900     COPY CNWS017.                                                01770092
019000                                                                  01780092
019100*----------------------------------------------------------------*01790092
019200*    MAP LAYOUT                                                  *01800092
019300*----------------------------------------------------------------*01810092
019400     COPY CNKM240.                                                01820092
019500                                                                  01830092
019510*----------------------------------------------------------------*01840092
019520*    SECURITY SUBROUTINE PARAMETERS                              *01850092
019530*----------------------------------------------------------------*01860092
019540     COPY DPWS008.                                                01870092
019550                                                                  01880092
019600*----------------------------------------------------------------*01890092
019700*    ATTRIBUTE SETTINGS COPYBOOK.                                *01900092
019800*----------------------------------------------------------------*01910092
019900     COPY DPWS015.                                                01920092
020000                                                                  01930092
020100*----------------------------------------------------------------*01940092
020200*    FUNCTION KEYS COPYBOOK                                      *01950092
020300*----------------------------------------------------------------*01960092
020400     COPY DPWS016.                                                01970092
020500                                                                  01980092
020600**--------------------------------------------------------------**01990092
020700** THE CVLLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **02000092
020800** SUB-ROUTINE (DPKUT100).                                      **02010092
020900**--------------------------------------------------------------**02020092
021000     COPY DPWS010I.                                               02030092
021100                                                                  02040092
021200**--------------------------------------------------------------**02050092
021300** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS ARCHITECTURE*02060092
021400** APPLICATION PROGRAMMING INTERFACE MODULE.                    **02070099
021500**--------------------------------------------------------------**02080092
021600     COPY DPWS030.                                                02090092
CICS       COPY DPWS930.                                                02091099
021700                                                                  02100092
021800**--------------------------------------------------------------**02110092
021900*    STANDARD COMMAREA.                                           02120092
022000**--------------------------------------------------------------**02130092
022100     COPY DPWS020.                                                02140092
022200     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02150092
022300                                                                  02160092
022400*---------------------------------------------------------------* 02170092
022500* INTER-APPLICATION COMMAREA.                                     02180092
022600*   CNWS015- IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    *  02190092
022700*             SPEC SCREEN.                                        02200092
022800*   CNWS016 - IS THE INPUT LAYOUT THAT WILL BE PASSED FROM        02210092
022900*             THE LIST SCREEN                                     02220092
023000*---------------------------------------------------------------* 02230092
023100                                                                  02240092
023200         10  INTER-APPL-COMM-AREA PIC X(200).                     02250092
023300     COPY CNWS015.                                                02260092
023400     COPY CNWS016.                                                02270092
023500***************************************************************** 02280092
023600*    SPECIFIC COMMMAREA FOR CNKCS240.                             02290092
023700***************************************************************** 02300092
023800*                                                                 02310092
023900         10  ASC-SPECIFIC-COMMAREA.                               02320092
024000             15  ASC-FUNCTION                   PIC  X(01).       02330092
024100             15  ASC-DIVERT-PREFIX-NBR          PIC  X(02).       02340092
024110             15  ASC-DIVERT-PREFIX-NBR-R                          02350092
024120                     REDEFINES ASC-DIVERT-PREFIX-NBR.             02360092
024130                 20  ASC-DIVERT-PREFIX-NBR-N    PIC  9(02).       02370092
024200             15  ASC-SET-YEAR                   PIC  9(04).       02380092
024300             15  ASC-SHORT-NAME                 PIC  X(05).       02390092
024400             15  ASC-SEASET-NAME                PIC  X(25).       02400092
024500             15  ASC-STATUS                     PIC  X(01).       02410092
024600             15  ASC-RLSE-DATE                  PIC  X(10).       02420092
024610             15  ASC-SET-TYPE                   PIC  X(03).       02430092
024620             15  ASC-CURRENT-TIMESTAMP          PIC  X(26).       02440092
024630             15  ASC-CURRENT-TIMESTAMP-R                          02450092
024700                     REDEFINES ASC-CURRENT-TIMESTAMP.             02460092
024710                 20  ASC-CURRENT-DATE           PIC  X(10).       02470092
024720                 20  FILLER                     PIC  X(16).       02480092
024800             15  ASC-INT-APPL-FORMAT-IND   PIC X(01).             02490092
024900*SWITCHES                                                         02500092
025000             15  ASC-ACTION-SW          PIC X(03).                02510092
025100                 88  ASC-ADD            VALUE 'ADD'.              02520092
025200                 88  ASC-DELETE         VALUE 'DEL'.              02530092
025300                 88  ASC-UPDATE         VALUE 'UPD'.              02540092
025400*            15  ASC-MSG-NUMBER.                                  02550092
025500*                20  ASC-MSG-NUMBER-N      PIC  9(05).            02560092
025600*            15  ASC-INT-APPL-FORMAT-SAVE  PIC  X(01).            02570092
025700             15  ASC-DOOR-TERM-ID          PIC  X(04).            02580092
025800*            15  ASC-SYSTEM-ID             PIC  X(02).            02590092
025900*            15  ASC-MSG-TEXT              PIC  X(70).            02600092
026000             15  ASC-USE-SELECTION-QUEUE-IND                      02610092
026100                                           PIC  X(01).            02620092
026200                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 02630092
026300             15  ASC-SEL-QUEUE-NAME        PIC  X(08).            02640092
026400             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05)  COMP-3.    02650092
026500             15  ASC-NUMBER-OF-SELECTED-ITEMS                     02660092
026600                                           PIC S9(09)  COMP-3.    02670092
026700             15  ASC-ITEM-SUB                 PIC S9(04)  COMP    02680092
026800                                                          SYNC.   02690092
026900             15  ASC-SEL-SUB               PIC S9(04)  COMP.      02700092
027000             15  ASC-SEL-ITEM              PIC S9(04)  COMP.      02710092
027100             15  ASC-TEMP-QUEUE-UPDATE-SW  PIC  X(01).            02720092
027200                 88  ASC-UPDATE-TSQ                   VALUE 'Y'.  02730092
027300                 88  ASC-NO-TSQ-UPDATE                VALUE ' '.  02740092
027400                                                                  02750092
027500             15  ASC-TSEASET-UPDATED-SW   PIC  X(01).             02760092
027600                 88  ASC-TSEASET-UPDATED              VALUE  'Y'. 02770092
027700                 88  ASC-TSEASET-NOT-UPDATED          VALUE  'N'. 02780092
027800*            15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         02790092
027900*                88  ASC-ITEMS-LEFT-ON-DB             VALUE 'Y'.  02800092
028000*                88  ASC-NO-ITEMS-LEFT-ON-DB          VALUE 'N'.  02810092
028100*            15  ASC-STORES-LEFT-INDICATOR    PIC  X(01).         02820092
028200*                88  ASC-STORES-LEFT-ON-DB            VALUE 'Y'.  02830092
028300*                88  ASC-NO-STORES-LEFT-ON-DB          VALUE 'N'. 02840092
028400             15  ASC-DVRT-PRFX-REQ-SW         PIC  X(01).         02850092
028500                 88  ASC-DVRT-PRFX-REQ-YES            VALUE 'Y'.  02860092
028600                 88  ASC-DVRT-PRFX-REQ-NO             VALUE 'N'.  02870092
028700             15  ASC-F2-CONFIRM-SW            PIC  X(01).         02880092
028800                 88  ASC-F2-CONFIRM-YES               VALUE 'Y'.  02890092
028900                 88  ASC-F2-CONFIRM-NO                VALUE 'N'.  02900092
                   15  ASC-TEMP-VAR                 PIC 9(01).          02901099
029000                                                                  02910092
029100*----------------------------------------------------------------*02920092
029200*    ABEND PROCESSING COPYBOOK.                                  *02930092
029300*----------------------------------------------------------------*02940092
029400     COPY DPWS013.                                                02950092
029500                                                                  02960092
029600*----------------------------------------------------------------*02970092
029700*    DB2 TABLE FOR CONTROL DISTRIBUTION CENTER DOORS              02980092
029800*----------------------------------------------------------------*02990092
029900     EXEC SQL                                                     03000092
030000          INCLUDE TSEASET                                         03010092
030100     END-EXEC.                                                    03020092
030200                                                                  03030092
030210*----------------------------------------------------------------*03040092
030220*    WST_INTGRTN_TYP                                              03050092
030230*----------------------------------------------------------------*03060092
030240     EXEC SQL                                                     03070092
030250          INCLUDE WST00008                                        03080092
030260     END-EXEC.                                                    03090092
030270                                                                  03100092
030280*----------------------------------------------------------------*03110092
030290*    WST_ATTR_DEFN                                                03120092
030291*----------------------------------------------------------------*03130092
030292     EXEC SQL                                                     03140092
030293          INCLUDE WST00009                                        03150092
030294     END-EXEC.                                                    03160092
030295                                                                  03170092
030296*----------------------------------------------------------------*03180092
030297*    WST_ATTR_ELEM                                                03190092
030298*----------------------------------------------------------------*03200092
030299     EXEC SQL                                                     03210092
030300          INCLUDE WST00010                                        03220092
030301     END-EXEC.                                                    03230092
030302                                                                  03240092
030303*----------------------------------------------------------------*03250092
030304*    TPURCHS                                                      03260092
030305*----------------------------------------------------------------*03270092
030306     EXEC SQL                                                     03280092
030307          INCLUDE TPURCHS                                         03290092
030308     END-EXEC.                                                    03300092
030309                                                                  03310092
030310*----------------------------------------------------------------*03320092
030311*    TDISTHD                                                      03330092
030312*----------------------------------------------------------------*03340092
030313     EXEC SQL                                                     03350092
030314          INCLUDE TDISTHD                                         03360092
030315     END-EXEC.                                                    03370092
030316                                                                  03380092
030317*----------------------------------------------------------------*03390092
030318*    SUT_OTBND_CART                                               03400092
030319*----------------------------------------------------------------*03410092
030320     EXEC SQL                                                     03420092
030321          INCLUDE SUT00024                                        03430092
030322     END-EXEC.                                                    03440092
030323                                                                  03450092
030324*----------------------------------------------------------------*03460092
030325*    SUT_OTBND_UPC                                                03470092
030326*----------------------------------------------------------------*03480092
030327     EXEC SQL                                                     03490092
030328          INCLUDE SUT00028                                        03500092
030329     END-EXEC.                                                    03510092
030330                                                                  03520092
030331*----------------------------------------------------------------*03530092
030332*    TRECEIV                                                      03540092
030333*----------------------------------------------------------------*03550092
030334     EXEC SQL                                                     03560092
030335          INCLUDE TRECEIV                                         03570092
030336     END-EXEC.                                                    03580092
030337                                                                  03590092
030340*----------------------------------------------------------------*03600092
030400*    COMMAREA USED TO CALL XLKUT071                               03610092
030500*----------------------------------------------------------------*03620092
030600     COPY XLWS071.                                                03630092
030700                                                                  03640092
030701*----------------------------------------------------------------*03650092
030702*    CURSOR FOR RECEIVERS THAT HAVE BEEN DOWNLOADED               03660092
030703*----------------------------------------------------------------*03670092
030704     EXEC SQL                                                     03680092
030705          DECLARE DWNLD_CSR CURSOR FOR                            03690092
030740           SELECT DISTINCT                                        03700092
030750                  C.OPER_UNT_ID                                   03710092
030751                 ,C.ORD_NBR                                       03720092
030760                 ,C.RCVR_SEQ_NBR                                  03730092
030770             FROM                                                 03740092
030780                  TPURCHS A                                       03750092
030790                 ,TDISTHD C                                       03760092
030791            WHERE                                                 03770092
030792                  A.SEASET_YR       = :PURCHS-SEASET-YR           03780092
030793              AND A.SEASET_SHRT_NM  = :PURCHS-SEASET-SHRT-NM      03790092
030794              AND A.VER_STATUS_CDE  = 'A'                         03800092
030795              AND A.PO_NBR          =  C.ORD_NBR                  03810092
030796              AND C.TOT_CART_CNT    >  0                          03820092
030797              AND C.CRE_USR_ID NOT IN ('TRLRUNLD','HOTCMPLT')     03830092
030801            ORDER BY                                              03840092
030802                  C.OPER_UNT_ID                                   03850092
030803                 ,C.ORD_NBR                                       03860092
030804                 ,C.RCVR_SEQ_NBR                                  03870092
030805             WITH UR                                              03880092
030806     END-EXEC.                                                    03890092
030807                                                                  03900092
030808                                                                  03910092
030809*----------------------------------------------------------------*03920092
030810*    CURSOR FOR RECEIVERS THAT HAVE BEEN CHECKED-IN               03930092
030811*----------------------------------------------------------------*03940092
030812     EXEC SQL                                                     03950092
030813          DECLARE SET_RCVR_CSR CURSOR FOR                         03960092
030814           SELECT                                                 03970092
030815                  B.CURR_OPER_UNT_ID                              03980092
030816                 ,B.ORD_NBR                                       03990092
030817                 ,B.REC_SEQ_NBR                                   04000092
030818             FROM                                                 04010092
030819                  TPURCHS A                                       04020092
030820                 ,TRECEIV B                                       04030092
030821            WHERE                                                 04040092
030822                  A.SEASET_YR       = :PURCHS-SEASET-YR           04050092
030823              AND A.SEASET_SHRT_NM  = :PURCHS-SEASET-SHRT-NM      04060092
030824              AND A.VER_STATUS_CDE  = 'A'                         04070092
030825              AND A.PO_NBR          =  B.ORD_NBR                  04080092
030828            ORDER BY                                              04090092
030829                  B.CURR_OPER_UNT_ID                              04100092
030830                 ,B.ORD_NBR                                       04110092
030831                 ,B.REC_SEQ_NBR                                   04120092
030832             WITH UR                                              04130092
030833     END-EXEC.                                                    04140092
030834                                                                  04150092
030835                                                                  04160092
030840*----------------------------------------------------------------*04170092
030900*    DB2 AREA FOR COMMUNICATIONS                                  04180092
031000*----------------------------------------------------------------*04190092
031100     EXEC SQL                                                     04200092
031200          INCLUDE SQLCA                                           04210092
031300     END-EXEC.                                                    04220092
031400                                                                  04230092
031500*----------------------------------------------------------------*04240092
031600 LINKAGE SECTION.                                                 04250092
031700                                                                  04260092
031800 01  DFHCOMMAREA.                                                 04270092
031900     05  FILLER                         OCCURS  1 TO 4072 TIMES   04280092
032000                                        DEPENDING ON EIBCALEN.    04290092
032100         10  FILLER                     PIC X.                    04300092
032200                                                                  04310092
032300 PROCEDURE DIVISION.                                              04320092
032400***************************************************************** 04330092
032500** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 04340092
032600** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 04350092
032700** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 04360092
032800**                                                             ** 04370092
032900** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 04380092
033000** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 04390092
033100***************************************************************** 04400092
033200 0000-MAIN-MODULE.                                                04410092
033300     INITIALIZE DP030-CICS-API-FIELDS.                            04420092
033400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04430092
033500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04440092
033600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04450092
033700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04460092
033800     MOVE LENGTH OF CNK240I        TO DP030-MAP-LENGTH (1).       04470092
033900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04480092
034000     PERFORM 0001-CALL-CICS-ARCH-API.                             04490092
034100                                                                  04500092
034200     PERFORM 1000-CONTROL-PROCESSING                              04510092
034300                                                                  04520092
034400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04530092
034500     PERFORM 0001-CALL-CICS-ARCH-API.                             04540092
034600                                                                  04550092
034700 0001-CALL-CICS-ARCH-API.                                         04560092
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04570099
034900                                    DFHCOMMAREA                   04580099
035000                                    DP030-CICS-API-FIELDS         04590099
035100                                    DP020-STANDARD-COMMAREA       04600099
035200                                    CNK240I.                      04610099
035300                                                                  04620092
035400     IF  DP030-RC-CALL-SUCCESSFUL                                 04630092
035500         CONTINUE                                                 04640092
035600     ELSE                                                         04650092
035700         SET DP013-NO-ROLLBACK                                    04660092
035800             DP013-XCTL-DISPLAY-RESTART                           04670092
035900             DP013-CICS-ABEND      TO TRUE                        04680092
036000         MOVE 'BEFORE 0000-MAIN-MODULE'                           04690092
036100                                   TO DP013-PARAGRAPH             04700092
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04701099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04702099
036400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04730092
036500         PERFORM DP013-0000-PROCESS-ABEND                         04740092
036600     END-IF.                                                      04750092
036700*                                                                 04760092
036800*----------------------------------------------------------------*04770092
036900*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *04780092
037000*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *04790092
037100*----------------------------------------------------------------*04800092
037200 1000-CONTROL-PROCESSING.                                         04810092
037300                                                                  04820092
037400     EVALUATE TRUE                                                04830092
037500         WHEN DP020-NEXT-ACT-INITIAL                              04840092
037600              INITIALIZE ASC-SPECIFIC-COMMAREA                    04850092
037700              MOVE EIBTRMID TO ASC-DOOR-TERM-ID                   04860092
037800              PERFORM 1100-PROCESS-INTER-APPL-COMM                04870092
037900                                                                  04880092
038000              IF  PS-COMMAREA-NOT-VALID                           04890092
038100                  SET DP020-NEXT-ACT-APPL-ERROR TO TRUE           04900092
038200              ELSE                                                04910092
038300                  PERFORM 4000-BUILD-INITIAL-PANEL                04920092
038400                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            04930092
038500                  PERFORM 3200-RESET-ATTRIBUTES                   04940092
038600              END-IF                                              04950092
038700                                                                  04960092
038800         WHEN DP020-NEXT-ACT-READ-MAP                             04970092
038900             PERFORM 2000-PROCESS-PANEL                           04980092
039000*F3-END                                                           04990092
039100         WHEN DP020-NEXT-ACT-RETURN                               05000092
039200             PERFORM 4000-BUILD-INITIAL-PANEL                     05010092
039300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05020092
039400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05030092
039500             MOVE -1                   TO ADIVERTL                05040092
039600                                                                  05050092
039700         WHEN OTHER                                               05060092
039800             SET DP013-LOGIC-ABEND TO TRUE                        05070092
039900             SET DP013-NO-ROLLBACK TO TRUE                        05080092
040000             MOVE '1000-CONTROL-PROCESSING'                       05090092
040100                                   TO DP013-PARAGRAPH             05100092
040200             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05110092
040300                                   TO DP013-MESSAGE-TEXT(1)       05120092
040400             MOVE DP020-NEXT-APPL-ACTIVITY                        05130092
040500                                   TO DP013-MESSAGE-TEXT(2)       05140092
040600             PERFORM DP013-0000-PROCESS-ABEND                     05150092
040700     END-EVALUATE.                                                05160092
040800*                                                                 05170092
040900******************************************************************05180092
041000** DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE   **05190092
041100** INTER-APPLICATION FORMAT CODE.                               **05200092
041200******************************************************************05210092
041300 1100-PROCESS-INTER-APPL-COMM.                                    05220092
041400     INITIALIZE ASC-SPECIFIC-COMMAREA.                            05230092
041500     MOVE DP020-INT-APPL-FORMAT-IND                               05240092
041600                                   TO ASC-INT-APPL-FORMAT-IND.    05250092
041700                                                                  05260092
041800     SET PS-COMMAREA-VALID                                        05270092
041900         ASC-F2-CONFIRM-NO         TO TRUE.                       05280092
042000                                                                  05290092
042100*WHEN COMING FROM CRIT SPEC (CNKCS238- F15=UPD SET)               05300092
042200                                                                  05310092
042300     EVALUATE ASC-INT-APPL-FORMAT-IND                             05320092
042400         WHEN PC-INTER-APPL-CRIT-SPEC-UPD                         05330092
042500            MOVE CN015-FUNCTION       TO  ASC-FUNCTION            05340092
042600            MOVE CN015-DIVERT-PREFIX-NBR                          05350092
042700                                      TO  ASC-DIVERT-PREFIX-NBR   05360092
      ****PRB0049796 START                                              05370093
                                                PV-DIVERT-PREFIX-NBR    05380093
      ****PRB0049796 END                                                05390093
042800            MOVE CN015-SET-YEAR       TO  ASC-SET-YEAR            05400092
042900            MOVE CN015-SHORT-NAME     TO  ASC-SHORT-NAME          05410092
043000            MOVE CN015-SEASET-NAME    TO  ASC-SEASET-NAME         05420092
043100            MOVE CN015-STATUS         TO  ASC-STATUS              05430092
043200            MOVE CN015-RLSE-DATE      TO  ASC-RLSE-DATE           05440092
043210            MOVE CN015-SEASET-TYPE    TO  ASC-SET-TYPE            05450092
043300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05460092
043400             PERFORM 4500-MOVE-COMMAREA-TO-TEMP                   05470092
043500                                                                  05480092
043600*WHEN COMING FROM SEASONAL SET LIST SCREEN (CNKCS239)             05490092
043700                                                                  05500092
043800         WHEN PC-INTER-APPL-LIST-UPDATE                           05510092
043900           IF CN016-NUMBER-OF-SELECTED-ITEMS > 0                  05520092
044000             SET ASC-USE-SELECTION-QUEUE TO TRUE                  05530092
044100             MOVE CN016-NUMBER-OF-SELECTED-ITEMS                  05540092
044200                                   TO ASC-NUMBER-OF-SELECTED-ITEMS05550092
044300             MOVE CN016-NUMBER-OF-TS-ITEMS                        05560092
044400                                   TO ASC-NUMBER-OF-TS-ITEMS      05570092
044500             MOVE CN016-SEL-QUEUE-NAME                            05580092
044600                                   TO ASC-SEL-QUEUE-NAME          05590092
044700             MOVE CN016-FUNCTION       TO  ASC-FUNCTION           05600092
044800             MOVE CN016-DIVERT-PREFIX-NBR                         05610092
044900                                       TO  ASC-DIVERT-PREFIX-NBR  05620092
      ****PRB0049796 START                                              05630093
                                                 PV-DIVERT-PREFIX-NBR   05640093
      ****PRB0049796 END                                                05650093
045000             MOVE CN016-SET-YEAR       TO  ASC-SET-YEAR           05660092
045100             MOVE CN016-SHORT-NAME     TO  ASC-SHORT-NAME         05670092
045200             MOVE CN016-SEASET-NAME    TO  ASC-SEASET-NAME        05680092
045300             MOVE CN016-STATUS         TO  ASC-STATUS             05690092
045400             MOVE CN016-RLSE-DATE      TO  ASC-RLSE-DATE          05700092
045410             MOVE CN016-SET-TYPE       TO  ASC-SET-TYPE           05710092
045500                                                                  05720092
045600             MOVE 'UPD' TO  ASC-ACTION-SW                         05730092
045700             PERFORM 1120-PREPARE-LIST-ENTRY                      05740092
045800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05750092
045900             PERFORM 4500-MOVE-COMMAREA-TO-TEMP                   05760092
046000         END-IF                                                   05770092
046100     END-EVALUATE.                                                05780092
046200                                                                  05790092
046300*----------------------------------------------------------------*05800092
046400* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *05810092
046500* STORAGE QUEUE PASSED FROM THE LIST.                            *05820092
046600*----------------------------------------------------------------*05830092
046700 1120-PREPARE-LIST-ENTRY.                                         05840092
046800     MOVE CN017-MAX-ITEMS          TO ASC-SEL-SUB.                05850092
046900     MOVE ZERO                     TO ASC-SEL-ITEM.               05860092
047000     PERFORM 1130-GET-NEXT-RECORD.                                05870092
047100                                                                  05880092
047200*---------------------------------------------------------------- 05890092
047300*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*05900092
047400*---------------------------------------------------------------- 05910092
047500 1130-GET-NEXT-RECORD.                                            05920092
047600     ADD +1                        TO ASC-SEL-SUB.                05930092
047700                                                                  05940092
047800     SET ASC-UPDATE-TSQ TO TRUE.                                  05950092
047900                                                                  05960092
048000     IF  ASC-SEL-SUB > CN017-MAX-ITEMS                            05970092
048100         ADD +1                    TO ASC-SEL-ITEM                05980092
048200         MOVE +1                   TO ASC-SEL-SUB                 05990092
048300     END-IF.                                                      06000092
048400                                                                  06010092
048500     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                06020092
048600         PERFORM 9100-READ-SEL-QUEUE                              06030092
048700         IF  CN017-ITEM (ASC-SEL-SUB) > ZERO                      06040092
049000             MOVE CN017-DIVERT-PREFIX (ASC-SEL-SUB)               06050092
049100                                       TO  ASC-DIVERT-PREFIX-NBR  06060092
049200             MOVE CN017-SEASET-YEAR (ASC-SEL-SUB)                 06070092
049300                                       TO  ASC-SET-YEAR           06080092
049400             MOVE CN017-SEASET-SHRTNM (ASC-SEL-SUB)               06090092
049500                                       TO  ASC-SHORT-NAME         06100092
049600             MOVE CN017-SEASET-NAME (ASC-SEL-SUB)                 06110092
049700                                       TO  ASC-SEASET-NAME        06120092
049800             MOVE CN017-STATUS      (ASC-SEL-SUB)                 06130092
049900                                       TO  ASC-STATUS             06140092
050000             MOVE CN017-RLSE-DATE   (ASC-SEL-SUB)                 06150092
050100                                       TO  ASC-RLSE-DATE          06160092
050110             MOVE CN017-SEASET-TYPE (ASC-SEL-SUB)                 06170092
050120                                       TO  ASC-SET-TYPE           06180092
050130             SET CN017-INQ (ASC-SEL-SUB)                          06190092
050140                                  TO TRUE                         06200092
050200             PERFORM 9200-REWRITE-SEL-QUEUE                       06210092
050300         ELSE                                                     06220092
050400             SUBTRACT +1 FROM ASC-SEL-SUB                         06230092
050500             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06240092
050600             SET DP020-MSG-INFORMATIONAL                          06250092
050700                 PS-LIST-END       TO TRUE                        06260092
050800         END-IF                                                   06270092
050900     ELSE                                                         06280092
051000         SUBTRACT +1 FROM ASC-SEL-ITEM                            06290092
051100         MOVE CN017-MAX-ITEMS      TO ASC-SEL-SUB                 06300092
051200         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06310092
051300         SET DP020-MSG-INFORMATIONAL                              06320092
051400                 PS-LIST-END       TO TRUE                        06330092
051500     END-IF.                                                      06340092
051600                                                                  06350092
051700******************************************************************06360092
051800*  GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING         06370092
051900*  PROCESSED.                                                     06380092
052000******************************************************************06390092
052100 1140-GET-PREV-RECORD.                                            06400092
052200     SUBTRACT +1 FROM ASC-SEL-SUB.                                06410092
052300                                                                  06420092
052400     IF  ASC-SEL-SUB < +1                                         06430092
052500         SUBTRACT +1 FROM ASC-SEL-ITEM                            06440092
052600         MOVE CN017-MAX-ITEMS      TO ASC-SEL-SUB                 06450092
052700     END-IF.                                                      06460092
052800                                                                  06470092
052900     IF  ASC-SEL-ITEM > ZERO                                      06480092
053000         PERFORM 9100-READ-SEL-QUEUE                              06490092
053100         IF  CN017-ITEM (ASC-SEL-SUB) > ZERO                      06500092
053400             MOVE CN017-DIVERT-PREFIX (ASC-SEL-SUB)               06510092
053500                                       TO  ASC-DIVERT-PREFIX-NBR  06520092
053600             MOVE CN017-SEASET-YEAR (ASC-SEL-SUB)                 06530092
053700                                       TO  ASC-SET-YEAR           06540092
053800             MOVE CN017-SEASET-SHRTNM (ASC-SEL-SUB)               06550092
053900                                       TO  ASC-SHORT-NAME         06560092
054000             MOVE CN017-SEASET-NAME (ASC-SEL-SUB)                 06570092
054100                                       TO  ASC-SEASET-NAME        06580092
054200             MOVE CN017-STATUS      (ASC-SEL-SUB)                 06590092
054300                                       TO  ASC-STATUS             06600092
054400             MOVE CN017-RLSE-DATE   (ASC-SEL-SUB)                 06610092
054500                                       TO  ASC-RLSE-DATE          06620092
054510             MOVE CN017-SEASET-TYPE (ASC-SEL-SUB)                 06630092
054520                                       TO  ASC-SET-TYPE           06640092
054600         END-IF                                                   06650092
054700                                                                  06660092
054800         SET CN017-INQ (ASC-SEL-SUB) TO TRUE                      06670092
054900         PERFORM 9200-REWRITE-SEL-QUEUE                           06680092
055000     ELSE                                                         06690092
055100         MOVE +1                   TO ASC-SEL-ITEM                06700092
055200                                      ASC-SEL-SUB                 06710092
055300         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06720092
055400         SET DP020-MSG-INFORMATIONAL                              06730092
055500             PS-LIST-END             TO TRUE                      06740092
055600     END-IF.                                                      06750092
055700                                                                  06760092
055800*----------------------------------------------------------------*06770092
055900* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06780092
056000* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06790092
056100* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06800092
056200* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06810092
056300* FUNCTION KEYS CAN GET THIS FAR.                                *06820092
056400*----------------------------------------------------------------*06830092
056500 2000-PROCESS-PANEL.                                              06840092
056600                                                                  06850092
056700     EVALUATE TRUE                                                06860092
056800                                                                  06870092
056900         WHEN DP020-SRC-AID = DP016-CLEAR                         06880092
057000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06890092
057100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06900092
057200                                                                  06910092
057300*F5 REFRESH -                                                     06920092
057400         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     06930092
057500              SET  ASC-DVRT-PRFX-REQ-NO                           06940092
057600                   ASC-F2-CONFIRM-NO     TO  TRUE                 06950092
057700              PERFORM 4010-SEASET-DETAILS                         06960099
057700              PERFORM 4000-BUILD-INITIAL-PANEL                    06970099
057800              PERFORM 4405-MOVE-COMMAREA-TO-SCREEN                06980099
057900              PERFORM 3200-RESET-ATTRIBUTES                       06990092
059100                                                                  07000092
059200*F20-NEXT SEL                                                     07010092
059300         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             07020092
059400             MOVE DP020-INT-APPL-FORMAT-IND                       07030092
059500                                      TO ASC-INT-APPL-FORMAT-IND  07040092
059600             IF ASC-INT-APPL-FORMAT-IND = '2'                     07050092
059700               IF  ASC-USE-SELECTION-QUEUE                        07060092
059800                   PERFORM 1130-GET-NEXT-RECORD                   07070092
059900                   PERFORM 3000-EDIT-DATA-IN-COMMAREA             07080092
060000                   IF PS-LIST-END                                 07090092
060100                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       07100092
060200                       SET PS-NO-LIST-END TO TRUE                 07110092
060300                   ELSE                                           07120092
060400                       PERFORM 4000-BUILD-INITIAL-PANEL           07130092
060500                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       07140092
060600                       PERFORM 3200-RESET-ATTRIBUTES              07150092
060700                   END-IF                                         07160092
060800               ELSE                                               07170092
060900*                --- BOTTOM OF LIST ---                           07180092
061000                   MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER       07190092
061100                   SET DP020-MSG-INFORMATIONAL TO TRUE            07200092
061200               END-IF                                             07210092
061300           ELSE                                                   07220092
061400               MOVE PC-TSYMSG-00045 TO DP020-MSG-NUMBER           07230092
061500               SET DP020-MSG-FATAL TO TRUE                        07240092
061600           END-IF                                                 07250092
061700                                                                  07260092
061800*F19-PREV SEL                                                     07270092
061900         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             07280092
062000             MOVE DP020-INT-APPL-FORMAT-IND                       07290092
062100                                      TO ASC-INT-APPL-FORMAT-IND  07300092
062200             IF ASC-INT-APPL-FORMAT-IND = '2'                     07310092
062300                IF  ASC-USE-SELECTION-QUEUE                       07320092
062400                   PERFORM 1140-GET-PREV-RECORD                   07330092
062500                   PERFORM 3000-EDIT-DATA-IN-COMMAREA             07340092
062600                   IF PS-LIST-END                                 07350092
062700                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       07360092
062800                       SET PS-NO-LIST-END TO TRUE                 07370092
062900                   ELSE                                           07380092
063000                       PERFORM 4000-BUILD-INITIAL-PANEL           07390092
063100                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN       07400092
063200                       PERFORM 3200-RESET-ATTRIBUTES              07410092
063300                   END-IF                                         07420092
063400               ELSE                                               07430092
063500                   MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER       07440092
063600                   SET DP020-MSG-INFORMATIONAL TO TRUE            07450092
063700               END-IF                                             07460092
063800           ELSE                                                   07470092
063900               MOVE PC-TSYMSG-00045 TO DP020-MSG-NUMBER           07480092
064000               SET DP020-MSG-FATAL TO TRUE                        07490092
064100           END-IF                                                 07500092
064200                                                                  07510092
064300         WHEN OTHER                                               07520092
064400             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07530092
064500             PERFORM 3200-RESET-ATTRIBUTES                        07540092
064600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07550092
064700             IF PS-NO-ERROR                                       07560092
064800                 PERFORM 4500-MOVE-COMMAREA-TO-TEMP               07570092
064900                 PERFORM 2100-CHECK-FUNCTION-KEY                  07580092
065000                 IF PS-NO-ERROR                                   07590092
065100                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07600092
065200                     SET DP030-CONTINUE-GO TO TRUE                07610092
065300                 ELSE                                             07620092
065400                     SET DP030-OVERRIDE-GO TO TRUE                07630092
065500                 END-IF                                           07640092
065600             ELSE                                                 07650092
065700                 SET DP030-OVERRIDE-GO TO TRUE                    07660092
065800             END-IF                                               07670092
065900     END-EVALUATE.                                                07680092
066000                                                                  07690092
066100*----------------------------------------------------------------*07700092
066200* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *07710092
066300* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *07720092
066400* FROM THE CICS ARCHITECTURE API.                                *07730092
066500*----------------------------------------------------------------*07740092
066600 2100-CHECK-FUNCTION-KEY.                                         07750092
066700     EVALUATE TRUE                                                07760092
066800         WHEN DP020-SRC-AID = DP016-ENTER                         07770092
066900                SET PS-NO-ERROR       TO TRUE                     07780092
067000                MOVE SPACES           TO DP020-MSG-SEVERITY-IND   07790092
067100                MOVE ZEROES           TO DP020-MSG-NUMBER         07800092
067200                MOVE DP015-UNP-ALP-NOR-OFF  TO ADIVERTA           07810092
067300                MOVE DP015-GREEN            TO ADIVERTC           07820092
067400                MOVE DP015-UNDERLINE        TO ADIVERTH           07830092
067500                MOVE -1                     TO ADIVERTL           07840092
067600                SET DP030-SET-CURSOR-APPL-1 TO TRUE               07850092
067700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07860092
067800                                                                  07870092
067900*-F02 = CONFIRM UPDATE                                            07880092
068000         WHEN DP020-FK-CONFIRM  (DP020-SRC-AID)                   07890092
068100              AND ASC-F2-CONFIRM-YES                              07900092
068200              IF ASC-ACTION-SW = 'UPD'                            07910092
068300                  PERFORM 9100-READ-SEL-QUEUE                     07920092
068400                  SET CN017-UPD (ASC-SEL-SUB) TO TRUE             07930092
068700                  MOVE ASC-DIVERT-PREFIX-NBR                      07940092
068800                       TO  CN017-DIVERT-PREFIX (ASC-SEL-SUB)      07950092
068900                  MOVE ASC-SET-YEAR                               07960092
069000                       TO CN017-SEASET-YEAR (ASC-SEL-SUB)         07970092
069100                  MOVE ASC-SHORT-NAME                             07980092
069200                       TO CN017-SEASET-SHRTNM (ASC-SEL-SUB)       07990092
069300                  MOVE ASC-SEASET-NAME                            08000092
069400                       TO CN017-SEASET-NAME (ASC-SEL-SUB)         08010092
069500                  MOVE ASC-STATUS                                 08020092
069600                       TO CN017-STATUS      (ASC-SEL-SUB)         08030092
069700                  MOVE ASC-RLSE-DATE                              08040092
069800                       TO CN017-RLSE-DATE   (ASC-SEL-SUB)         08050092
069810                  MOVE ASC-SET-TYPE                               08060092
069820                       TO CN017-SEASET-TYPE (ASC-SEL-SUB)         08070092
069900                  PERFORM 9200-REWRITE-SEL-QUEUE                  08080092
070000              END-IF                                              08090092
070100                                                                  08100092
070200              IF  ASC-DIVERT-PREFIX-NBR   =  ZEROES AND           08110099
      ****PRB0049796 START                                              08120099
                        ASC-TEMP-VAR            =  ZEROES               08121099
      ****PRB0049796 END                                                08122099
070300                  SET PS-ERROR                                    08130092
070400                      DP020-MSG-FATAL         TO TRUE             08140092
070500                  MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER 08150092
070600                  MOVE DP015-UNP-ALP-BRT-OFF  TO ADIVERTA         08160092
070700                  MOVE DP015-RED              TO ADIVERTC         08170092
070800                  MOVE DP015-REVERSE          TO ADIVERTH         08180092
070900                  MOVE -1                     TO ADIVERTL         08190092
071000                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             08200092
071100              END-IF                                              08210092
071200                                                                  08220092
071300              IF  PS-NO-ERROR                                     08230092
071400                  PERFORM 5100-PROCESS-UPDATE                     08240092
071500                  SET  ASC-DVRT-PRFX-REQ-NO  TO  TRUE             08250092
071600                  IF  PS-NO-ERROR                                 08260092
071700                      PERFORM 2110-PREPARE-INTER-APPL-COMM        08270092
071800                  END-IF                                          08280092
071900              END-IF                                              08290092
072000                                                                  08300092
072100                                                                  08310092
072200*-F15 = UPDATE SEASONAL SET                                       08320092
072300         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              08330092
072400              SET ASC-F2-CONFIRM-NO TO TRUE                       08340092
072500                                                                  08350092
072510              PERFORM 2105-RACF-ACCESS                            08360092
072520              IF  PS-UPDATE-ALLOWED                               08370092
072600                  IF  ASC-DIVERT-PREFIX-NBR  =  ZEROES            08380092
072700                      SET PS-ERROR                                08390092
072800                          DP020-MSG-FATAL     TO TRUE             08400092
072900                      MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER 08410092
073000                      MOVE DP015-UNP-ALP-BRT-OFF  TO ADIVERTA     08420092
073100                      MOVE DP015-RED              TO ADIVERTC     08430092
073200                      MOVE DP015-REVERSE          TO ADIVERTH     08440092
073300                      MOVE -1                     TO ADIVERTL     08450092
073400                      SET DP030-SET-CURSOR-APPL-1 TO TRUE         08460092
073500                  END-IF                                          08470092
075200                                                                  08480092
075300                  IF  PS-NO-ERROR                                 08490092
075400                      SET ASC-F2-CONFIRM-YES      TO TRUE         08500092
075500                      SET PS-ERROR                TO TRUE         08510092
075600                      SET DP020-MSG-FATAL         TO TRUE         08520092
075700                      MOVE PC-TSYMSG-03712    TO DP020-MSG-NUMBER 08530092
075800                      MOVE DP015-PRO-NOR-OFF      TO ADIVERTA     08540092
075900                      MOVE DP015-BLUE             TO ADIVERTC     08550092
076000                      MOVE -1                     TO ADIVERTL     08560092
076100                      SET DP030-SET-CURSOR-APPL-1 TO TRUE         08570092
076200                 END-IF                                           08580092
076210              ELSE                                                08590092
076220                  SET PS-ERROR  TO  TRUE                          08600092
076230                  MOVE PC-TSYMSG-02612 TO DP020-MSG-NUMBER        08610092
076240                  MOVE DP015-UNP-ALP-BRT-OFF   TO ADIVERTA        08620092
076250                  MOVE -1                      TO ADIVERTL        08630092
076260                  SET DP030-SET-CURSOR-APPL-1                     08640092
076270                      DP020-MSG-INFORMATIONAL  TO TRUE            08650092
076280              END-IF                                              08660092
076300                                                                  08670092
076400                                                                  08680092
076410*-F16 = UPDATE SEASONAL SET DIVERT TO 0                           08690092
076420         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              08700092
076440              SET ASC-F2-CONFIRM-NO TO TRUE                       08710092
      ****PRB0049796 START                                              08720099
                    INITIALIZE PV-TEMP-VAR                              08721099
      ****PRB0049796 END                                                08722099
076460              PERFORM 2105-RACF-ACCESS                            08730092
076470              IF  PS-UPDATE-ALLOWED                               08740092
076480                  MOVE ZEROES       TO  ASC-DIVERT-PREFIX-NBR     08750099
      ****PRB0049796 START                                              08760099
                        MOVE 1            TO  PV-TEMP-VAR               08760199
                        MOVE PV-TEMP-VAR  TO ASC-TEMP-VAR               08761099
      ****PRB0049796 END                                                08762099
076499                                                                  08770092
076500                  IF  PS-NO-ERROR                                 08780092
076501                      SET ASC-F2-CONFIRM-YES      TO TRUE         08790092
076502                      SET PS-ERROR                TO TRUE         08800092
076503                      SET DP020-MSG-FATAL         TO TRUE         08810092
076504                      MOVE PC-TSYMSG-03712    TO DP020-MSG-NUMBER 08820092
076505                      MOVE DP015-PRO-NOR-OFF      TO ADIVERTA     08830092
076506                      MOVE DP015-BLUE             TO ADIVERTC     08840092
076507                      MOVE -1                     TO ADIVERTL     08850092
076508                      SET DP030-SET-CURSOR-APPL-1 TO TRUE         08860092
076509                 END-IF                                           08870092
076510              ELSE                                                08880092
076511                  SET PS-ERROR  TO  TRUE                          08890092
076512                  MOVE PC-TSYMSG-02612 TO DP020-MSG-NUMBER        08900092
076513                  MOVE DP015-UNP-ALP-BRT-OFF   TO ADIVERTA        08910092
076514                  MOVE -1                      TO ADIVERTL        08920092
076515                  SET DP030-SET-CURSOR-APPL-1                     08930092
076516                      DP020-MSG-INFORMATIONAL  TO TRUE            08940092
076517              END-IF                                              08950092
076518                                                                  08960092
076519                                                                  08970092
076520     END-EVALUATE.                                                08980092
076600                                                                  08990092
076610*----------------------------------------------------------------*09000092
076620* CHECK TO SEE IF USER HAS RACF AUTHORIZATION FOR UPDATE FUNCTION*09010092
076630*----------------------------------------------------------------*09020092
076640 2105-RACF-ACCESS.                                                09030092
076650                                                                  09040092
076660      SET DP008-RSRC-TYPE-FUNC           TO TRUE                  09050092
076670      MOVE 'CNSEASET'                    TO DP008-FUNCTION-NAME   09060092
076680      SET DP008-ACCESS-TYPE-USE          TO TRUE                  09070092
076690                                                                  09080092
076691      EXEC CICS                                                   09090092
076692         LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                 09100092
076693              COMMAREA (DP008-SECURITY-COMMAREA)                  09110092
076694              LENGTH (DP008-SECURITY-COMMAREA-LENGTH)             09120092
076695      END-EXEC                                                    09130092
076696                                                                  09140092
076697      IF DP008-CALL-SUCCESSFUL                                    09150092
076698         IF DP008-ACCESS-ALLOWED                                  09160092
076699             SET PS-UPDATE-ALLOWED TO TRUE                        09170092
076700         ELSE                                                     09180092
076701             SET PS-UPDATE-NOT-ALLOWED TO TRUE                    09190092
076702         END-IF                                                   09200092
076703     ELSE                                                         09210092
076704         MOVE '2105-RACF-ACCESS'                                  09220092
076705                               TO DP013-PARAGRAPH                 09230092
076706          MOVE 'UNABLE TO ACCESS CICS'                            09240092
076707                               TO DP013-MESSAGE-TEXT (1)          09250092
076708          MOVE SQLCA                 TO DP013-SQLCA               09260092
076709          SET DP013-DB2-ABEND                                     09270092
076710              DP013-XCTL-DISPLAY-RESTART                          09280092
076711                               TO TRUE                            09290092
076712          PERFORM DP013-0000-PROCESS-ABEND                        09300092
076713      END-IF.                                                     09310092
076714                                                                  09320092
076715                                                                  09330092
076716                                                                  09340092
076720******************************************************************09350092
076800** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **09360092
076900** INTER-APPLICATION COMMAREA.                                  **09370092
077000******************************************************************09380092
077100 2110-PREPARE-INTER-APPL-COMM.                                    09390092
077200                                                                  09400092
077300     INITIALIZE CN015-INTER-APPL-COMMAREA.                        09410092
077400                                                                  09420092
077500     MOVE ASC-FUNCTION             TO CN015-FUNCTION.             09430092
078000     MOVE ASC-DIVERT-PREFIX-NBR    TO CN015-DIVERT-PREFIX-NBR.    09440092
078100     MOVE ASC-SET-YEAR             TO CN015-SET-YEAR.             09450092
078200     MOVE ASC-SHORT-NAME           TO CN015-SHORT-NAME.           09460092
078300     MOVE ASC-SEASET-NAME          TO CN015-SEASET-NAME.          09470092
078400     MOVE ASC-STATUS               TO CN015-STATUS.               09480092
078500     MOVE ASC-RLSE-DATE            TO CN015-RLSE-DATE.            09490092
078900                                                                  09500092
079000*----------------------------------------------------------------*09510092
079100* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS   *09520092
079200* IN THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN   *09530092
079300* THE APPLICATION-SPECIFIC COMMAERA, NOT ON THE SCREEN.          *09540092
079400* THIS PARAGRAPH DOES NOT USE TEMPORARY VARIABLES.               *09550092
079500*----------------------------------------------------------------*09560092
079600 2200-MOVE-SCREEN-TO-COMMAREA.                                    09570092
079700*DIVERT NUMBER                                                    09580092
079800     IF  ADIVERTL > ZERO                                          09590092
079900         MOVE ADIVERTI              TO ASC-DIVERT-PREFIX-NBR      09600092
080000         MOVE ASC-DIVERT-PREFIX-NBR TO PV-INP-DIVERT-NBR          09610092
080100     ELSE                                                         09620092
080200         IF  ADIVERTF = DP015-ERASE-EOF                           09630092
080300             MOVE ZEROES            TO ASC-DIVERT-PREFIX-NBR      09640092
080400         END-IF                                                   09650092
080500     END-IF.                                                      09660092
080600                                                                  09670092
085100                                                                  09680092
085200*----------------------------------------------------------------*09690092
085300* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *09700092
085400* IS FOUND, THE CURSOR IS POSITIONED AT THAT FIELD AND AN        *09710092
085500* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *09720092
085600*----------------------------------------------------------------*09730092
085700 3000-EDIT-DATA-IN-COMMAREA.                                      09740092
085800                                                                  09750092
085900     IF  PS-NO-ERROR                                              09760092
086000         IF  ASC-DIVERT-PREFIX-NBR  >  SPACES                     09770092
086200             MOVE ASC-DIVERT-PREFIX-NBR  TO DP010I-UNEDITED-FIELD 09780092
086300             MOVE LENGTH OF ASC-DIVERT-PREFIX-NBR                 09790092
086400                                       TO DP010I-MAXIMUM-DIGITS   09800092
086410             MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS 09810092
086420             SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE              09820092
263455             CALL DP010I-NUMERIC-EDIT-ROUTINE                     09831099
263455                  USING DP010I-NUMERIC-EDIT-AREA                  09832099
086440             IF  DP010I-ERROR-DETECTED                            09840092
086450                 SET PS-ERROR                                     09850092
086460                     DP020-MSG-FATAL         TO TRUE              09860092
086470                MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER   09870092
086480                MOVE DP015-UNP-ALP-BRT-OFF  TO ADIVERTA           09880092
086490                MOVE DP015-RED              TO ADIVERTC           09890092
086491                MOVE DP015-REVERSE          TO ADIVERTH           09900092
086492                MOVE -1                     TO ADIVERTL           09910092
086495                SET DP030-SET-CURSOR-APPL-1 TO TRUE               09920092
086496             ELSE                                                 09930092
086497                 MOVE DP010I-NUMERIC-FIELD                        09940092
086498                                      TO ASC-DIVERT-PREFIX-NBR-N  09950092
086499             END-IF                                               09960092
086500         END-IF                                                   09970092
086510     END-IF.                                                      09980092
086600                                                                  09990092
086700     IF  PS-NO-ERROR                                              10000092
086800         IF  ASC-DIVERT-PREFIX-NBR  >  ZEROES                     10010092
086900           IF  DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)             10020092
087000               SET PS-DIVERT-CHANGED-NO TO TRUE                   10030092
087100               PERFORM 4005-CK-DIVERT-CHANGED                     10040092
087200           END-IF                                                 10050092
087300     END-IF.                                                      10060092
087400                                                                  10070092
087410*                                                                 10080092
087500**** MUST BE VALID DIVERT NUMBER - 10,20,30,40,50,60,70,80,90     10090092
087600*                                                                 10100092
087900     IF  PS-NO-ERROR                                              10110092
088000         IF  ASC-DIVERT-PREFIX-NBR  >  ZEROES                     10120092
088100           IF  DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)             10130092
088200               MOVE ASC-DIVERT-PREFIX-NBR TO  PV-DIVERT-HOLD      10140092
088210               IF  PV-VALID-DIVERT                                10150092
088211                   CONTINUE                                       10160092
088212               ELSE                                               10170092
088220                   SET PS-ERROR                                   10180092
088230                       DP020-MSG-FATAL         TO TRUE            10190092
088240                  MOVE PC-TSYMSG-03713         TO DP020-MSG-NUMBER10200092
088250                  MOVE DP015-UNP-ALP-BRT-OFF  TO ADIVERTA         10210092
088260                  MOVE DP015-RED              TO ADIVERTC         10220092
088270                  MOVE DP015-REVERSE          TO ADIVERTH         10230092
088280                  MOVE -1                     TO ADIVERTL         10240092
088290                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             10250092
088400               END-IF                                             10260092
088401           END-IF                                                 10270092
088410       END-IF                                                     10280092
088500     END-IF.                                                      10290092
088600                                                                  10300092
088610*                                                                 10310092
088611**** STORE RELEASE DATE CAN NOT EQUAL  9999-09-09                 10320092
088612*                                                                 10330092
088613     IF  PS-NO-ERROR                                              10340092
088614         IF  DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)  OR           10350092
088615             DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)               10360092
088616              MOVE ASC-RLSE-DATE  TO  PV-DEFAULT-DATE             10370092
088617              IF  PV-NO-STR-RLSE-DTE                              10380092
088618                  SET PS-ERROR                                    10390092
088619                      DP020-MSG-FATAL         TO TRUE             10400092
088620                  MOVE PC-TSYMSG-03711        TO DP020-MSG-NUMBER 10410092
088621                  MOVE DP015-UNP-ALP-BRT-OFF  TO ADIVERTA         10420092
088622                  MOVE DP015-RED              TO ADIVERTC         10430092
088623                  MOVE DP015-REVERSE          TO ADIVERTH         10440092
088624                  MOVE -1                     TO ADIVERTL         10450092
088625                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             10460092
088626              END-IF                                              10470092
088628       END-IF                                                     10480092
088629     END-IF.                                                      10490092
088630*                                                                 10500092
088631**** SELECT SEASONAL SET INFORMATION                              10510092
088632*                                                                 10520092
088633     IF  PS-NO-ERROR                                              10530092
088634         IF  DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)  OR           10540092
088635             DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)               10550092
088637              PERFORM 3060-SELECT-TSEASET                         10560092
088638         END-IF                                                   10570092
088639     END-IF.                                                      10580092
088641*                                                                 10590092
088642**** STORE RELEASE DATE MUST BE GREATER THAN CURRENT DATE         10600092
088650*                                                                 10610092
089200     IF  PS-NO-ERROR                                              10620092
089400         IF  DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)  OR           10630092
089401             DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)               10640092
089402                                                                  10650092
089410             EXEC SQL                                             10660092
089420                  SET :ASC-CURRENT-TIMESTAMP = CURRENT TIMESTAMP  10670092
089421             END-EXEC                                             10680092
089430                                                                  10690092
089440             IF  ASC-RLSE-DATE  > ASC-CURRENT-DATE  OR            10700092
089450                 ASC-RLSE-DATE  = ASC-CURRENT-DATE                10710092
089700                   CONTINUE                                       10720092
089800               ELSE                                               10730092
089900                   SET PS-ERROR                                   10740092
090000                       DP020-MSG-FATAL        TO TRUE             10750092
090100                  MOVE PC-TSYMSG-03714        TO DP020-MSG-NUMBER 10760092
090200                  MOVE DP015-UNP-ALP-BRT-OFF  TO ADIVERTA         10770092
090300                  MOVE DP015-RED              TO ADIVERTC         10780092
090400                  MOVE DP015-REVERSE          TO ADIVERTH         10790092
090500                  MOVE -1                     TO ADIVERTL         10800092
090600                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             10810092
090800           END-IF                                                 10820092
090900       END-IF                                                     10830092
091000     END-IF.                                                      10840092
091500                                                                  10850092
091510*                                                                 10860092
091520**** IF DIVERT CODE WILL BE SHARED BY MULTIPLE SEASONAL SETS      10870092
091521**** THE STORE RELEASE END DATE MUST BE THE SAME THE SETS         10880092
091530*                                                                 10890092
091540     IF  PS-NO-ERROR                                              10900092
091541       IF  ASC-DIVERT-PREFIX-NBR  >  ZEROES                       10910092
091550         IF  DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)               10920092
091560                                                                  10930092
091570             PERFORM  3070-CHECK-IF-SHARED-DIVERT                 10940092
091591                                                                  10950092
091592             IF  PV-SHARED-DIVERT >  0                            10960092
091596                   SET PS-ERROR                                   10970092
091597                       DP020-MSG-FATAL        TO TRUE             10980092
091598                  MOVE PC-TSYMSG-03715        TO DP020-MSG-NUMBER 10990092
091599                  MOVE DP015-UNP-ALP-BRT-OFF  TO ADIVERTA         11000092
091600                  MOVE DP015-RED              TO ADIVERTC         11010092
091601                  MOVE DP015-REVERSE          TO ADIVERTH         11020092
091602                  MOVE -1                     TO ADIVERTL         11030092
091603                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             11040092
091604             END-IF                                               11050092
091605         END-IF                                                   11060092
091606       END-IF                                                     11070092
091607     END-IF.                                                      11080092
091608                                                                  11090092
091609*                                                                 11100092
091610**** CHECK IF CASEPACK HAS BEEN DOWNLOADED FOR THIS SEASONAL      11110092
091611**** SET - CANNOT CHANGE DIVERT IF CARTONS ALREADY DOWNLOADED     11120092
091612*                                                                 11130092
091613     IF  PS-NO-ERROR                                              11140092
      ****PRB0049796 START                                              11150093
             IF  (ASC-DIVERT-PREFIX-NBR  >  ZEROES) AND                 11160093
                 (PV-DIVERT-PREFIX-NBR   >  ZEROES)                     11170093
      ****PRB0049796 END                                                11180093
091615         IF  DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)               11190092
091617                                                                  11200092
091618             PERFORM  7000-CASEPACK-DOWNLOAD                      11210092
091619                                                                  11220092
091620             IF  PV-CSEPK-COUNT  >  0                             11230092
091621                   SET PS-ERROR                                   11240092
091622                       DP020-MSG-FATAL        TO TRUE             11250092
091623                  MOVE PC-TSYMSG-03725        TO DP020-MSG-NUMBER 11260092
091624                  MOVE DP015-UNP-ALP-BRT-OFF  TO ADIVERTA         11270092
091625                  MOVE DP015-RED              TO ADIVERTC         11280092
091626                  MOVE DP015-REVERSE          TO ADIVERTH         11290092
091627                  MOVE -1                     TO ADIVERTL         11300092
091628                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             11310092
091629             END-IF                                               11320092
091630         END-IF                                                   11330092
091631       END-IF                                                     11340092
091632     END-IF.                                                      11350092
091633                                                                  11360092
091634*                                                                 11370092
091635**** CHECK IF ANY CARTONS HAVE BEEN CHECKED IN FOR SEASONAL       11380092
091636**** SET - CANNOT CHANGE DIVERT IF CARTONS CHECKED IN             11390092
091637*                                                                 11400092
091638     IF  PS-NO-ERROR                                              11410092
      ****PRB0049796 START                                              11420093
             IF  (ASC-DIVERT-PREFIX-NBR  >  ZEROES) AND                 11430093
                 (PV-DIVERT-PREFIX-NBR   >  ZEROES)                     11440093
      ****PRB0049796 START                                              11450093
091640         IF  DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)               11460092
091641                                                                  11470092
091642             SET  PS-CARTONS-CHECKED-IN-NO  TO TRUE               11480092
091643                                                                  11490092
091644             PERFORM  7050-CHECK-FOR-CHECK-IN                     11500092
091645                                                                  11510092
091646             IF  PS-CARTONS-CHECKED-IN-YES                        11520092
091647                   SET PS-ERROR                                   11530092
091648                       DP020-MSG-FATAL        TO TRUE             11540092
091649                  MOVE PC-TSYMSG-03726        TO DP020-MSG-NUMBER 11550092
091650                  MOVE DP015-UNP-ALP-BRT-OFF  TO ADIVERTA         11560092
091651                  MOVE DP015-RED              TO ADIVERTC         11570092
091652                  MOVE DP015-REVERSE          TO ADIVERTH         11580092
091653                  MOVE -1                     TO ADIVERTL         11590092
091654                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             11600092
091655             END-IF                                               11610092
091656         END-IF                                                   11620092
091657       END-IF                                                     11630092
091658     END-IF.                                                      11640092
091659                                                                  11650092
091660******************************************************************11660092
091700*                                                                 11670092
091800*                                                                 11680092
091900*                                                                 11690092
092000******************************************************************11700092
092100                                                                  11710092
092200 3060-SELECT-TSEASET.                                             11720092
092300      MOVE ASC-SET-YEAR    TO  SEASET-SEASET-YR.                  11730092
092400      MOVE ASC-SHORT-NAME  TO  SEASET-SEASET-SHRT-NM.             11740092
092500                                                                  11750092
092600        EXEC SQL                                                  11760092
092700          SELECT  SEASET_YR                                       11770092
092800                 ,SEASET_SHRT_NM                                  11780092
092900                 ,SEASET_TYP_CDE                                  11790092
093000                 ,SEASET_NM                                       11800092
093100                 ,SEASET_STAT_CDE                                 11810092
093200                 ,STR_RLSE_END_DTE                                11820092
093300            INTO :SEASET-SEASET-YR                                11830092
093400                ,:SEASET-SEASET-SHRT-NM                           11840092
093500                ,:SEASET-SEASET-TYP-CDE                           11850092
093600                ,:SEASET-SEASET-NM                                11860092
093700                ,:SEASET-SEASET-STAT-CDE                          11870092
093800                ,:SEASET-STR-RLSE-END-DTE                         11880092
093900            FROM  TSEASET                                         11890092
094000           WHERE  SEASET_YR        = :SEASET-SEASET-YR            11900092
094100             AND  SEASET_SHRT_NM   = :SEASET-SEASET-SHRT-NM       11910092
094200        END-EXEC                                                  11920092
094300                                                                  11930092
094400        EVALUATE TRUE                                             11940092
094500            WHEN SQLCODE = +0                                     11950092
094600                 CONTINUE                                         11960092
094700            WHEN SQLCODE = +100                                   11970092
094800                 CONTINUE                                         11980092
094900            WHEN SQLWARN0 NOT = SPACES                            11990092
095000            WHEN SQLCODE < +0                                     12000092
095100            WHEN SQLCODE > +0                                     12010092
095200                MOVE '3060-SELECT-TSEASET'                        12020092
095300                                          TO DP013-PARAGRAPH      12030092
095400                MOVE 'PROBLEM WITH RETRIEVING ROW'                12040092
095500                                    TO DP013-MESSAGE-TEXT (1)     12050092
095600                MOVE SQLCA      TO DP013-SQLCA                    12060092
095700                MOVE 'TSEASET'  TO DP013-DB2-TABLE-NAME (1)       12070092
095800                SET DP013-DB2-ABEND                               12080092
095900                    DP013-XCTL-DISPLAY-RESTART TO TRUE            12090092
096000                PERFORM DP013-0000-PROCESS-ABEND                  12100092
096100        END-EVALUATE.                                             12110092
096200                                                                  12120092
096300                                                                  12130092
096310******************************************************************12140092
096320*                                                                 12150092
096330*                                                                 12160092
096340*                                                                 12170092
096350******************************************************************12180092
096360                                                                  12190092
096370 3070-CHECK-IF-SHARED-DIVERT.                                     12200092
096391                                                                  12210092
096392     MOVE  ASC-DIVERT-PREFIX-NBR-N  TO  DK-DIVERT-NBR.            12220092
096393     EXEC SQL                                                     12230092
096394          SELECT  COUNT(*)                                        12240092
096395            INTO :PV-SHARED-DIVERT                                12250092
096406            FROM                                                  12260092
096407                  WST_INTGRTN_TYP  A                              12270092
096408               ,  WST_ATTR_DEFN    B                              12280092
096409               ,  WST_ATTR_ELEM    C                              12290092
096410               ,  WST_ATTR_ELEM    D                              12300092
096411               ,  WST_ATTR_ELEM    E                              12310092
096412               ,  WST_ATTR_ELEM    F                              12320092
096413               ,  TSEASET          G                              12330092
096414          WHERE                                                   12340092
096415                A.INTGRTN_TYP_CDE      = 'EFCATRDC'               12350092
096416            AND A.INTGRTN_TYP_CDE      = B.INTGRTN_TYP_CDE        12360092
096417            AND B.ATTR_DEFN_SEQ_NBR    = 1                        12370092
096418            AND B.INTGRTN_TYP_CDE      = C.INTGRTN_TYP_CDE        12380092
096419            AND C.ATTR_DEFN_SEQ_NBR    = 1                        12390092
096420            AND B.INTGRTN_TYP_CDE      = D.INTGRTN_TYP_CDE        12400092
096421            AND D.ATTR_DEFN_SEQ_NBR    = 2                        12410092
096422            AND B.INTGRTN_TYP_CDE      = E.INTGRTN_TYP_CDE        12420092
096423            AND E.ATTR_DEFN_SEQ_NBR    = 3                        12430092
096424            AND B.INTGRTN_TYP_CDE      = F.INTGRTN_TYP_CDE        12440092
096425            AND F.ATTR_DEFN_SEQ_NBR    = 4                        12450092
096426            AND C.ATTR_ELEM_SEQ_NBR    = D.ATTR_ELEM_SEQ_NBR      12460092
096427            AND C.ATTR_ELEM_SEQ_NBR    = E.ATTR_ELEM_SEQ_NBR      12470092
096428            AND C.ATTR_ELEM_SEQ_NBR    = F.ATTR_ELEM_SEQ_NBR      12480092
096429            AND C.ATTR_ELEM_TXT       <> G.SEASET_TYP_CDE         12490092
096430            AND D.ATTR_ELEM_TXT       <= 'ACTIVE'                 12500092
096431            AND E.ATTR_ELEM_TMST      <= CURRENT TIMESTAMP        12510092
096432            AND F.ATTR_ELEM_TMST      >= CURRENT TIMESTAMP        12520092
096433            AND G.STR_RLSE_END_DTE    >=  CURRENT DATE            12530092
096434            AND G.DIVERT_PFX_NBR       = :DK-DIVERT-NBR           12540092
096435            AND NOT G.STR_RLSE_END_DTE = :SEASET-STR-RLSE-END-DTE 12550092
096436            AND NOT G.STR_RLSE_END_DTE = '9999-09-09'             12560092
096437            AND NOT (G.SEASET_YR       = :SEASET-SEASET-YR  AND   12570092
096438                     G.SEASET_SHRT_NM  = :SEASET-SEASET-SHRT-NM)  12580092
096439                                                                  12590092
096440     END-EXEC.                                                    12600092
096441                                                                  12610092
096442     EVALUATE TRUE                                                12620092
096443         WHEN SQLCODE = +0                                        12630092
096444              CONTINUE                                            12640092
096445         WHEN SQLCODE = +100                                      12650092
096446              CONTINUE                                            12660092
096447         WHEN SQLWARN0 NOT = SPACES                               12670092
096448            WHEN SQLCODE < +0                                     12680092
096449            WHEN SQLCODE > +0                                     12690092
096450                MOVE '3060-SELECT-TSEASET'                        12700092
096451                                          TO DP013-PARAGRAPH      12710092
096452                MOVE 'PROBLEM WITH RETRIEVING ROW'                12720092
096453                                    TO DP013-MESSAGE-TEXT (1)     12730092
096454                MOVE SQLCA      TO DP013-SQLCA                    12740092
096455                MOVE 'TSEASET'  TO DP013-DB2-TABLE-NAME (1)       12750092
096456                SET DP013-DB2-ABEND                               12760092
096457                    DP013-XCTL-DISPLAY-RESTART TO TRUE            12770092
096458                PERFORM DP013-0000-PROCESS-ABEND                  12780092
096459     END-EVALUATE.                                                12790092
096460                                                                  12800092
096461                                                                  12810092
096470*----------------------------------------------------------------*12820092
096500* MOVE THE DEFAULT ATTRIBUTE VALUES TO THE ENTERABLE FIELDS ON   *12830092
096600* MAP.                                                           *12840092
096700*----------------------------------------------------------------*12850092
096800 3200-RESET-ATTRIBUTES.                                           12860092
096900     IF PS-NO-ERROR                                               12870092
097000         IF ASC-FUNCTION = PC-U                                   12880092
097100             IF  ASC-DVRT-PRFX-REQ-YES                            12890092
097200                 MOVE DP015-UNP-ALP-NOR-OFF    TO ADIVERTA        12900092
097400                 MOVE DP015-GREEN              TO ADIVERTC        12910092
097600                 MOVE DP015-UNDERLINE          TO ADIVERTH        12920092
098500             END-IF                                               12930092
099100         ELSE                                                     12940092
099200             MOVE DP015-UNP-ALP-NOR-OFF    TO ADIVERTA            12950092
099500             MOVE DP015-GREEN              TO ADIVERTC            12960092
099800             MOVE DP015-UNDERLINE          TO ADIVERTH            12970092
100100             SET DP030-SET-CURSOR-APPL-1   TO TRUE                12980092
100200             MOVE -1                       TO ADIVERTL            12990092
100300         END-IF                                                   13000092
101300     END-IF.                                                      13010092
101400                                                                  13020092
101500*----------------------------------------------------------------*13030092
101600*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *13040092
101700*    ENTRY.                                                      *13050092
101800*----------------------------------------------------------------*13060092
101900 4000-BUILD-INITIAL-PANEL.                                        13070092
102000     IF ASC-FUNCTION = PC-U                                       13080092
102100         MOVE DP015-UNP-ALP-NOR-OFF   TO ADIVERTA                 13090092
102400         MOVE DP015-GREEN             TO ADIVERTC                 13100092
102700         MOVE DP015-UNDERLINE         TO ADIVERTH                 13110092
103000         MOVE -1                      TO ADIVERTL                 13120092
103100         SET DP030-SET-CURSOR-APPL-1  TO TRUE                     13130092
103200     ELSE                                                         13140092
103300         IF ASC-DIVERT-PREFIX-NBR  = ZEROES                       13150092
103400             SET DP030-SET-CURSOR-APPL-1  TO TRUE                 13160092
103500             MOVE -1                      TO ADIVERTL             13170092
104400         END-IF                                                   13180092
104500     END-IF.                                                      13190092
104600                                                                  13200092
104700                                                                  13210092
104800*----------------------------------------------------------------*13220092
104900* CHECK TO SEE IF DOOR TYPE CHANGED                               13230092
105000*----------------------------------------------------------------*13240092
105100 4005-CK-DIVERT-CHANGED.                                          13250092
105200     MOVE ASC-SET-YEAR    TO  SEASET-SEASET-YR.                   13260092
105300     MOVE ASC-SHORT-NAME  TO  SEASET-SEASET-SHRT-NM.              13270092
105400                                                                  13280092
105500                                                                  13290092
105600     EXEC SQL                                                     13300092
105700         SELECT DIVERT_PFX_NBR                                    13310092
105800          INTO :SEASET-DIVERT-PFX-NBR                             13320092
105900          FROM  TSEASET                                           13330092
106000         WHERE SEASET_YR      = :SEASET-SEASET-YR                 13340092
106100           AND SEASET_SHRT_NM = :SEASET-SEASET-SHRT-NM            13350092
106200     END-EXEC.                                                    13360092
106300                                                                  13370092
106400     EVALUATE TRUE                                                13380092
106500         WHEN SQLCODE = ZERO                                      13390092
106600              IF  SEASET-DIVERT-PFX-NBR = ASC-DIVERT-PREFIX-NBR-N 13400092
106700                  SET  PS-DIVERT-CHANGED-NO TO TRUE               13410092
106800              ELSE                                                13420092
106900                  SET  PS-DIVERT-CHANGED-YES TO TRUE              13430092
      ****PRB0049796 START                                              13440094
                        MOVE SEASET-DIVERT-PFX-NBR TO                   13450095
                                                 PV-DIVERT-PREFIX-NBR   13460094
      ****PRB0049796 END                                                13470094
107000               END-IF                                             13480092
107100                                                                  13490092
107200         WHEN SQLWARN0 NOT = SPACES                               13500092
107300         WHEN SQLCODE < +0                                        13510092
107400         WHEN SQLCODE > +0                                        13520092
107500             MOVE '4005-CK-TYPE-CHANGED      ' TO DP013-PARAGRAPH 13530092
107600             MOVE 'CHECK IF DOOR TYPE WAS CHANGED'                13540092
107700                                      TO DP013-MESSAGE-TEXT (1)   13550092
107800             MOVE SQLCA        TO DP013-SQLCA                     13560092
107900             MOVE 'TSEASET '   TO DP013-DB2-TABLE-NAME (1)        13570092
108000             SET DP013-DB2-ABEND                                  13580092
108100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               13590092
108200             PERFORM DP013-0000-PROCESS-ABEND                     13600092
108300         END-EVALUATE.                                            13610092
108400                                                                  13620092
108500                                                                  13630092
104800*----------------------------------------------------------------*13640099
104900* GET THE CURRENT DATABASE VALUES                                 13650099
105000*----------------------------------------------------------------*13660099
105100 4010-SEASET-DETAILS.                                             13670099
105200     MOVE ASC-SET-YEAR    TO  SEASET-SEASET-YR.                   13680099
105300     MOVE ASC-SHORT-NAME  TO  SEASET-SEASET-SHRT-NM.              13690099
105400                                                                  13700099
105500                                                                  13710099
105600     EXEC SQL                                                     13720099
105700         SELECT DIVERT_PFX_NBR                                    13730099
105800          INTO :SEASET-DIVERT-PFX-NBR                             13740099
105900          FROM  TSEASET                                           13750099
106000         WHERE SEASET_YR      = :SEASET-SEASET-YR                 13760099
106100           AND SEASET_SHRT_NM = :SEASET-SEASET-SHRT-NM            13770099
106200     END-EXEC.                                                    13780099
106300                                                                  13790099
106400     EVALUATE TRUE                                                13800099
106500         WHEN SQLCODE = ZERO                                      13810099
                        MOVE SEASET-DIVERT-PFX-NBR TO                   13820099
                                                 PV-DIVERT-PREFIX-NBR   13830099
107200         WHEN SQLWARN0 NOT = SPACES                               13840099
107300         WHEN SQLCODE < +0                                        13850099
107400         WHEN SQLCODE > +0                                        13860099
107500             MOVE '4010-SEASET-DETAILS       ' TO DP013-PARAGRAPH 13870099
107600             MOVE 'CHECK IF DOOR TYPE WAS CHANGED'                13880099
107700                                      TO DP013-MESSAGE-TEXT (1)   13890099
107800             MOVE SQLCA        TO DP013-SQLCA                     13900099
107900             MOVE 'TSEASET '   TO DP013-DB2-TABLE-NAME (1)        13910099
108000             SET DP013-DB2-ABEND                                  13920099
108100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               13930099
108200             PERFORM DP013-0000-PROCESS-ABEND                     13940099
108300         END-EVALUATE.                                            13950099
108400                                                                  13960099
108500                                                                  13970099
108600*----------------------------------------------------------------*13980099
108700*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *13990092
108800*----------------------------------------------------------------*14000092
108900 4400-MOVE-COMMAREA-TO-SCREEN.                                    14010092
109100     MOVE ASC-DIVERT-PREFIX-NBR    TO ADIVERTO.                   14020099
109200     MOVE ASC-SET-YEAR             TO AYEARO.                     14030092
109300     MOVE ASC-SHORT-NAME           TO ASHRTNMO.                   14040092
109400     MOVE ASC-SEASET-NAME          TO ANAMEO.                     14050092
109500     MOVE ASC-STATUS               TO ASTATUSO.                   14060092
109600     MOVE ASC-RLSE-DATE            TO ARLSEDTO.                   14070092
109700     MOVE ASC-SET-TYPE             TO ATYPEO.                     14080092
109800                                                                  14090092
109900     PERFORM 7000-CASEPACK-DOWNLOAD.                              14100092
109910                                                                  14110092
110000     IF  PV-CSEPK-COUNT  >  0                                     14120092
110001         CONTINUE                                                 14130092
110002     ELSE                                                         14140092
110010         PERFORM 7050-CHECK-FOR-CHECK-IN                          14150092
110020     END-IF.                                                      14160092
110030                                                                  14170092
110100                                                                  14180092
108600*----------------------------------------------------------------*14190099
108700*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *14200099
108800*----------------------------------------------------------------*14210099
108900 4405-MOVE-COMMAREA-TO-SCREEN.                                    14220099
109100     MOVE PV-DIVERT-PREFIX-NBR     TO ADIVERTO.                   14230099
109200     MOVE ASC-SET-YEAR             TO AYEARO.                     14240099
109300     MOVE ASC-SHORT-NAME           TO ASHRTNMO.                   14250099
109400     MOVE ASC-SEASET-NAME          TO ANAMEO.                     14260099
109500     MOVE ASC-STATUS               TO ASTATUSO.                   14270099
109600     MOVE ASC-RLSE-DATE            TO ARLSEDTO.                   14280099
109700     MOVE ASC-SET-TYPE             TO ATYPEO.                     14290099
110100                                                                  14300099
109900     PERFORM 7000-CASEPACK-DOWNLOAD.                              14310099
109910                                                                  14320099
110000     IF  PV-CSEPK-COUNT  >  0                                     14330099
110001         CONTINUE                                                 14340099
110002     ELSE                                                         14350099
110010         PERFORM 7050-CHECK-FOR-CHECK-IN                          14360099
110020     END-IF.                                                      14370099
110030                                                                  14380099
110100                                                                  14390099
110200*------------------------------------------------------------     14400099
110300*  MOVE COMMAREA TO TEMP AREA                                     14410092
110400*------------------------------------------------------------     14420092
110500 4500-MOVE-COMMAREA-TO-TEMP.                                      14430092
110600     MOVE ASC-DIVERT-PREFIX-NBR   TO PV-INP-DIVERT-NBR.           14440092
111800                                                                  14450092
111900                                                                  14460092
112000*----------------------------------------------------------------*14470092
112100* PROCESS TABLE UPDATES                                          *14480092
112200*----------------------------------------------------------------*14490092
112300 5100-PROCESS-UPDATE.                                             14500092
112400     PERFORM 7100-UPDATE-TSEASET                                  14510092
112500                                                                  14520092
112600     IF ASC-TSEASET-UPDATED                                       14530092
112700        SET ASC-F2-CONFIRM-NO       TO TRUE                       14540092
112800        MOVE PC-TSYMSG-00059 TO DP020-MSG-NUMBER                  14550092
112900        SET DP020-MSG-INFORMATIONAL TO TRUE                       14560092
113000        MOVE DP015-PRO-NOR-OFF       TO ADIVERTA                  14570092
113300        MOVE DP015-BLUE              TO ADIVERTC                  14580092
113600        MOVE DP015-HL-OFF            TO ADIVERTH                  14590092
113900        MOVE -1                      TO ADIVERTL                  14600092
114000        SET DP030-SET-CURSOR-APPL-1  TO TRUE                      14610092
114100     END-IF.                                                      14620092
114200                                                                  14630092
114210                                                                  14640092
114211******************************************************************14650092
114212** COUNT HOW MANY RECEIVERS HAVE BEEN DOWNLOADED                  14660092
114213******************************************************************14670092
114214 7000-CASEPACK-DOWNLOAD.                                          14680092
114215                                                                  14690092
114216     MOVE ASC-SET-YEAR         TO  PURCHS-SEASET-YR.              14700092
114217     MOVE ASC-SHORT-NAME       TO  PURCHS-SEASET-SHRT-NM.         14710092
114218                                                                  14720092
114219     PERFORM                                                      14730092
114220         WITH TEST AFTER                                          14740092
114221         VARYING PV-RETRY-COUNTER                                 14750092
114222         FROM 1 BY 1                                              14760092
114223         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14770092
114224         OR     (SQLCODE = ZERO)                                  14780092
114225         OR     (SQLCODE = +100))                                 14790092
114226                                                                  14800092
114227         EXEC SQL                                                 14810092
114228              SELECT COUNT(*)                                     14820092
114229                INTO :PV-CSEPK-COUNT                              14830092
114230                FROM                                              14840092
114231                (SELECT DISTINCT                                  14850092
114232                        C.ORD_NBR                                 14860092
114233                       ,C.RCVR_SEQ_NBR                            14870092
114234                   FROM                                           14880092
114235                        TPURCHS A                                 14890092
114236                       ,TDISTHD C                                 14900092
114237                  WHERE                                           14910092
114238                        A.SEASET_YR      = :PURCHS-SEASET-YR      14920092
114239                    AND A.SEASET_SHRT_NM = :PURCHS-SEASET-SHRT-NM 14930092
114242                    AND A.VER_STATUS_CDE = 'A'                    14940092
114243                    AND A.PO_NBR         = C.ORD_NBR              14950092
114244                    AND C.TOT_CART_CNT     > 0                    14960092
114245                    AND C.CRE_USR_ID NOT IN                       14970092
114246                        ('TRLRUNLD','HOTCMPLT')                   14980092
114247                ) AS T1                                           14990092
114248                WITH UR                                           15000092
114249         END-EXEC                                                 15010092
114250                                                                  15020092
114251         EVALUATE TRUE                                            15030092
114252             WHEN SQLCODE = +0                                    15040092
114253                  IF PV-CSEPK-COUNT  > 0                          15050092
114254                     MOVE PV-CSEPK-COUNT TO  PV-DISP-CSEPK        15060092
114255                     MOVE SPACES  TO  AMSG0O                      15070092
114256                     STRING PV-DISP-CSEPK                         15080092
114257                            ' RCVRS PREVIOUSLY DOWNLOADED'        15090092
114258                            ' - LABELS WILL NOT REFLECT'          15100092
114259                            ' DIVERT CHANGE'                      15110092
114260                            DELIMITED BY SIZE                     15120092
114261                       INTO AMSG0O                                15130092
114262                       PERFORM 7010-DISPLAY-RCVRS                 15140092
114263                       MOVE PV-MESSAGE-2   TO  AMSG1O             15150092
114264                       MOVE PV-MESSAGE-3   TO  AMSG2O             15160092
114265                       MOVE PV-MESSAGE-4   TO  AMSG3O             15170092
114266                  ELSE                                            15180092
114267                      MOVE SPACES  TO  AMSG0O                     15190092
114268                                       AMSG1O                     15200092
114269                                       AMSG2O                     15210092
114270                                       AMSG3O                     15220092
114271                  END-IF                                          15230092
114272             WHEN SQLWARN0 NOT = SPACES                           15240092
114273             WHEN SQLCODE < +0                                    15250092
114274             WHEN SQLCODE > +0                                    15260092
114275                 MOVE '7000-CASEPACK-DOWNLOAD' TO DP013-PARAGRAPH 15270092
114276                 MOVE 'ERROR COUNTING CASEPACK RECEIVERS DWNLD'   15280092
114277                                   TO DP013-MESSAGE-TEXT (1)      15290092
114278                 STRING 'YEAR:'  ASC-SET-YEAR                     15300092
114279                        '  SET:' ASC-SHORT-NAME                   15310092
114280                        '  :'    ASC-SEASET-NAME                  15320092
114281                                      DELIMITED BY SIZE           15330092
114282                                 INTO DP013-MESSAGE-TEXT (2)      15340092
114283                 MOVE SQLCA        TO DP013-SQLCA                 15350092
114284                 MOVE 'TPURCHS'    TO DP013-DB2-TABLE-NAME (1)    15360092
114285                 MOVE 'TDISTHD'    TO DP013-DB2-TABLE-NAME (2)    15370092
114286                 SET DP013-DB2-ABEND                              15380092
114287                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15390092
114288                 PERFORM DP013-0000-PROCESS-ABEND                 15400092
114289         END-EVALUATE                                             15410092
114290     END-PERFORM.                                                 15420092
114291                                                                  15430092
114292     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         15440092
114293         MOVE '7000-CASEPACK-DOWNLOAD' TO DP013-PARAGRAPH         15450092
114294         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     15460092
114295                                       TO DP013-MESSAGE-TEXT (1)  15470092
114296         MOVE SQLCA          TO DP013-SQLCA                       15480092
114297         MOVE 'TPURCHS'      TO DP013-DB2-TABLE-NAME (1)          15490092
114298         MOVE 'TDISTHD'      TO DP013-DB2-TABLE-NAME (2)          15500092
114299         SET DP013-DB2-ABEND                                      15510092
114300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   15520092
114301         PERFORM DP013-0000-PROCESS-ABEND                         15530092
114302     END-IF.                                                      15540092
114303     MOVE +0 TO PV-RETRY-COUNTER.                                 15550092
114304                                                                  15560092
114310                                                                  15570092
114311******************************************************************15580092
114312** IF THERE ARE RECEIVERS DOWNLOAD - DISPLAY THEM ON THE SCREEN   15590092
114313******************************************************************15600092
114320 7010-DISPLAY-RCVRS.                                              15610092
114324                                                                  15620092
114325     MOVE 1  TO  PV-MSG-LINE-COUNT                                15630092
114326                 PV-MSG-ELEMENT-COUNT.                            15640092
114327     SET  PS-EOF-DWNLD-CSR-NO  TO TRUE.                           15650092
114328                                                                  15660092
114329     PERFORM 7015-OPEN-DWNLD-CURSOR.                              15670092
114330     PERFORM 7020-FETCH-DWNLD-CURSOR                              15680092
114331       UNTIL PS-EOF-DWNLD-CSR                                     15690092
114332          OR PV-RETRY-COUNTER > PC-MAX-RETRIES                    15700092
114333     PERFORM 7030-CLOSE-DWNLD-CURSOR.                             15710092
114334                                                                  15720092
114335                                                                  15730092
114336 7015-OPEN-DWNLD-CURSOR.                                          15740092
114337                                                                  15750092
114338     PERFORM                                                      15760092
114339         WITH TEST AFTER                                          15770092
114340         VARYING PV-RETRY-COUNTER                                 15780092
114341         FROM 1 BY 1                                              15790092
114342         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15800092
114343         OR     (SQLCODE = ZERO)                                  15810092
114344         OR     (SQLCODE = +100))                                 15820092
114345                                                                  15830092
114346     EXEC SQL                                                     15840092
114347          OPEN DWNLD_CSR                                          15850092
114348     END-EXEC                                                     15860092
114365                                                                  15870092
114366         EVALUATE TRUE                                            15880092
114367             WHEN SQLCODE = +0                                    15890092
114368                  CONTINUE                                        15900092
114383             WHEN SQLWARN0 NOT = SPACES                           15910092
114384             WHEN SQLCODE < +0                                    15920092
114385             WHEN SQLCODE > +0                                    15930092
114386                 MOVE '7015-OPEN-DWNLD-CURSOR' TO DP013-PARAGRAPH 15940092
114387                 MOVE 'ERROR OPENING DOWNLOAD CURSOR          '   15950092
114388                                   TO DP013-MESSAGE-TEXT (1)      15960092
114389                 STRING 'YEAR:'  ASC-SET-YEAR                     15970092
114390                        '  SET:' ASC-SHORT-NAME                   15980092
114391                        '  :'    ASC-SEASET-NAME                  15990092
114392                                      DELIMITED BY SIZE           16000092
114393                                 INTO DP013-MESSAGE-TEXT (2)      16010092
114394                 MOVE SQLCA        TO DP013-SQLCA                 16020092
114395                 MOVE 'TPURCHS'    TO DP013-DB2-TABLE-NAME (1)    16030092
114396                 MOVE 'TDISTHD'    TO DP013-DB2-TABLE-NAME (2)    16040092
114397                 SET DP013-DB2-ABEND                              16050092
114398                     DP013-XCTL-DISPLAY-RESTART TO TRUE           16060092
114399                 PERFORM DP013-0000-PROCESS-ABEND                 16070092
114400         END-EVALUATE                                             16080092
114401     END-PERFORM.                                                 16090092
114402                                                                  16100092
114403     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         16110092
114404         MOVE '7015-OPEN-DWNLD-CURSOR' TO DP013-PARAGRAPH         16120092
114405         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN  '     16130092
114406                                       TO DP013-MESSAGE-TEXT (1)  16140092
114407         MOVE SQLCA          TO DP013-SQLCA                       16150092
114408         MOVE 'TPURCHS'      TO DP013-DB2-TABLE-NAME (1)          16160092
114409         MOVE 'TDISTHD'      TO DP013-DB2-TABLE-NAME (2)          16170092
114410         SET DP013-DB2-ABEND                                      16180092
114411             DP013-XCTL-DISPLAY-RESTART TO TRUE                   16190092
114412         PERFORM DP013-0000-PROCESS-ABEND                         16200092
114413     END-IF.                                                      16210092
114414     MOVE +0 TO PV-RETRY-COUNTER.                                 16220092
114415                                                                  16230092
114416                                                                  16240092
114417 7020-FETCH-DWNLD-CURSOR.                                         16250092
114418                                                                  16260092
114419     PERFORM                                                      16270092
114420         WITH TEST AFTER                                          16280092
114421         VARYING PV-RETRY-COUNTER                                 16290092
114422         FROM 1 BY 1                                              16300092
114423         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16310092
114424         OR     (SQLCODE = ZERO)                                  16320092
114425         OR     (SQLCODE = +100))                                 16330092
114426                                                                  16340092
114427      EXEC SQL                                                    16350092
114428         FETCH DWNLD_CSR                                          16360092
114429          INTO :DISTHD-OPER-UNT-ID                                16370092
114430             , :DISTHD-ORD-NBR                                    16380092
114431             , :DISTHD-RCVR-SEQ-NBR                               16390092
114440      END-EXEC                                                    16400092
114441                                                                  16410092
114442         EVALUATE TRUE                                            16420092
114443             WHEN SQLCODE = +0                                    16430092
114444                  PERFORM 7025-PROCESS-RECORD                     16440092
114445             WHEN SQLCODE = +100                                  16450092
114446                  SET  PS-EOF-DWNLD-CSR  TO TRUE                  16460092
114447             WHEN SQLWARN0 NOT = SPACES                           16470092
114448             WHEN SQLCODE < +0                                    16480092
114449             WHEN SQLCODE > +0                                    16490092
114450                 MOVE '7020-FETCH-DWNLD-CURSOR' TO DP013-PARAGRAPH16500092
114451                 MOVE 'ERROR TRYING TO FETCH CURSOR           '   16510092
114452                                   TO DP013-MESSAGE-TEXT (1)      16520092
114453                 STRING 'YEAR:'  ASC-SET-YEAR                     16530092
114454                        '  SET:' ASC-SHORT-NAME                   16540092
114455                        '  :'    ASC-SEASET-NAME                  16550092
114456                                      DELIMITED BY SIZE           16560092
114457                                 INTO DP013-MESSAGE-TEXT (2)      16570092
114458                 MOVE SQLCA        TO DP013-SQLCA                 16580092
114459                 MOVE 'TPURCHS'    TO DP013-DB2-TABLE-NAME (1)    16590092
114460                 MOVE 'TDISTHD'    TO DP013-DB2-TABLE-NAME (2)    16600092
114461                 SET DP013-DB2-ABEND                              16610092
114462                     DP013-XCTL-DISPLAY-RESTART TO TRUE           16620092
114463                 PERFORM DP013-0000-PROCESS-ABEND                 16630092
114464         END-EVALUATE                                             16640092
114465     END-PERFORM.                                                 16650092
114466                                                                  16660092
114467     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         16670092
114468         MOVE '7020-FETCH-DWNLD-CURSOR' TO DP013-PARAGRAPH        16680092
114469         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO FETCH '     16690092
114470                                       TO DP013-MESSAGE-TEXT (1)  16700092
114471         MOVE SQLCA          TO DP013-SQLCA                       16710092
114472         MOVE 'TPURCHS'      TO DP013-DB2-TABLE-NAME (1)          16720092
114473         MOVE 'TDISTHD'      TO DP013-DB2-TABLE-NAME (2)          16730092
114474         SET DP013-DB2-ABEND                                      16740092
114475             DP013-XCTL-DISPLAY-RESTART TO TRUE                   16750092
114476         PERFORM DP013-0000-PROCESS-ABEND                         16760092
114477     END-IF.                                                      16770092
114478     MOVE +0 TO PV-RETRY-COUNTER.                                 16780092
114479                                                                  16790092
114480                                                                  16800092
114481 7025-PROCESS-RECORD.                                             16810092
114482                                                                  16820092
114483     MOVE  DISTHD-OPER-UNT-ID    TO  PV-MSG-DISP-OPER.            16830092
114484     MOVE  '-'                   TO  PV-MSG-DASH-1.               16840092
114485     MOVE  DISTHD-ORD-NBR        TO  PV-MSG-DISP-PO.              16850092
114486     MOVE  '-'                   TO  PV-MSG-DASH-2.               16860092
114487     MOVE  DISTHD-RCVR-SEQ-NBR   TO  PV-MSG-DISP-RCVR.            16870092
114488                                                                  16880092
114489     EVALUATE TRUE                                                16890092
114490         WHEN PV-MSG-LINE-COUNT  =  1                             16900092
114491              IF  PV-MSG-ELEMENT-COUNT = 1                        16910092
114492                  MOVE  PV-DISP-ORDER  TO  PV-ORDER-2A            16920092
114493                  ADD  1  TO  PV-MSG-ELEMENT-COUNT                16930092
114494              ELSE                                                16940092
114495              IF  PV-MSG-ELEMENT-COUNT = 2                        16950092
114496                  MOVE  PV-DISP-ORDER  TO  PV-ORDER-2B            16960092
114497                  ADD  1  TO  PV-MSG-ELEMENT-COUNT                16970092
114498              ELSE                                                16980092
114499              IF  PV-MSG-ELEMENT-COUNT = 3                        16990092
114500                  MOVE  PV-DISP-ORDER  TO  PV-ORDER-2C            17000092
114501                  ADD  1  TO  PV-MSG-ELEMENT-COUNT                17010092
114502              ELSE                                                17020092
114503              IF  PV-MSG-ELEMENT-COUNT = 4                        17030092
114504                  MOVE  PV-DISP-ORDER  TO  PV-ORDER-2D            17040092
114505                  ADD  1  TO  PV-MSG-LINE-COUNT                   17050092
114506                  MOVE 1  TO  PV-MSG-ELEMENT-COUNT                17060092
114507              END-IF                                              17070092
114508              END-IF                                              17080092
114509              END-IF                                              17090092
114510              END-IF                                              17100092
114511         WHEN PV-MSG-LINE-COUNT  =  2                             17110092
114512              IF  PV-MSG-ELEMENT-COUNT = 1                        17120092
114513                  MOVE  PV-DISP-ORDER  TO  PV-ORDER-3A            17130092
114514                  ADD  1  TO  PV-MSG-ELEMENT-COUNT                17140092
114515              ELSE                                                17150092
114516              IF  PV-MSG-ELEMENT-COUNT = 2                        17160092
114517                  MOVE  PV-DISP-ORDER  TO  PV-ORDER-3B            17170092
114518                  ADD  1  TO  PV-MSG-ELEMENT-COUNT                17180092
114519              ELSE                                                17190092
114520              IF  PV-MSG-ELEMENT-COUNT = 3                        17200092
114521                  MOVE  PV-DISP-ORDER  TO  PV-ORDER-3C            17210092
114522                  ADD  1  TO  PV-MSG-ELEMENT-COUNT                17220092
114523              ELSE                                                17230092
114524              IF  PV-MSG-ELEMENT-COUNT = 4                        17240092
114525                  MOVE  PV-DISP-ORDER  TO  PV-ORDER-3D            17250092
114526                  ADD  1  TO  PV-MSG-LINE-COUNT                   17260092
114527                  MOVE 1  TO  PV-MSG-ELEMENT-COUNT                17270092
114528              END-IF                                              17280092
114529              END-IF                                              17290092
114530              END-IF                                              17300092
114531              END-IF                                              17310092
114532         WHEN PV-MSG-LINE-COUNT  =  3                             17320092
114533              IF  PV-MSG-ELEMENT-COUNT = 1                        17330092
114534                  MOVE  PV-DISP-ORDER  TO  PV-ORDER-4A            17340092
114535                  ADD  1  TO  PV-MSG-ELEMENT-COUNT                17350092
114536              ELSE                                                17360092
114537              IF  PV-MSG-ELEMENT-COUNT = 2                        17370092
114538                  MOVE  PV-DISP-ORDER  TO  PV-ORDER-4B            17380092
114539                  ADD  1  TO  PV-MSG-ELEMENT-COUNT                17390092
114540              ELSE                                                17400092
114541              IF  PV-MSG-ELEMENT-COUNT = 3                        17410092
114542                  MOVE  PV-DISP-ORDER  TO  PV-ORDER-4C            17420092
114543                  ADD  1  TO  PV-MSG-ELEMENT-COUNT                17430092
114544                  IF  PV-CSEPK-COUNT  >  12                       17440092
114545                      MOVE  'MORE'  TO  PV-ORDER-4D               17450092
114546                      MOVE 1  TO  PV-MSG-LINE-COUNT               17460092
114547                      MOVE 1  TO  PV-MSG-ELEMENT-COUNT            17470092
114548                      SET  PS-EOF-DWNLD-CSR  TO  TRUE             17480092
114549                  END-IF                                          17490092
114550              ELSE                                                17500092
114551              IF  PV-MSG-ELEMENT-COUNT = 4                        17510092
114552                  MOVE  PV-DISP-ORDER  TO  PV-ORDER-4D            17520092
114553                  MOVE 1  TO  PV-MSG-LINE-COUNT                   17530092
114554                  MOVE 1  TO  PV-MSG-ELEMENT-COUNT                17540092
114555                  SET  PS-EOF-DWNLD-CSR  TO  TRUE                 17550092
114556              END-IF                                              17560092
114557              END-IF                                              17570092
114558              END-IF                                              17580092
114559              END-IF                                              17590092
114560     END-EVALUATE.                                                17600092
114573                                                                  17610092
114574                                                                  17620092
114575 7030-CLOSE-DWNLD-CURSOR.                                         17630092
114576                                                                  17640092
114577     PERFORM                                                      17650092
114578         WITH TEST AFTER                                          17660092
114579         VARYING PV-RETRY-COUNTER                                 17670092
114580         FROM 1 BY 1                                              17680092
114581         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17690092
114582         OR     (SQLCODE = ZERO)                                  17700092
114583         OR     (SQLCODE = +100))                                 17710092
114584                                                                  17720092
114585     EXEC SQL                                                     17730092
114586          CLOSE DWNLD_CSR                                         17740092
114587     END-EXEC                                                     17750092
114588                                                                  17760092
114589         EVALUATE TRUE                                            17770092
114590             WHEN SQLCODE = +0                                    17780092
114591                  CONTINUE                                        17790092
114592             WHEN SQLWARN0 NOT = SPACES                           17800092
114593             WHEN SQLCODE < +0                                    17810092
114594             WHEN SQLCODE > +0                                    17820092
114595                 MOVE '7030-CLOSE-DWNLD-CURSOR' TO DP013-PARAGRAPH17830092
114596                 MOVE 'ERROR CLOSING DOWNLOAD CURSOR          '   17840092
114597                                   TO DP013-MESSAGE-TEXT (1)      17850092
114598                 STRING 'YEAR:'  ASC-SET-YEAR                     17860092
114599                        '  SET:' ASC-SHORT-NAME                   17870092
114600                        '  :'    ASC-SEASET-NAME                  17880092
114601                                      DELIMITED BY SIZE           17890092
114602                                 INTO DP013-MESSAGE-TEXT (2)      17900092
114603                 MOVE SQLCA        TO DP013-SQLCA                 17910092
114604                 MOVE 'TPURCHS'    TO DP013-DB2-TABLE-NAME (1)    17920092
114605                 MOVE 'TDISTHD'    TO DP013-DB2-TABLE-NAME (2)    17930092
114606                 SET DP013-DB2-ABEND                              17940092
114607                     DP013-XCTL-DISPLAY-RESTART TO TRUE           17950092
114608                 PERFORM DP013-0000-PROCESS-ABEND                 17960092
114609         END-EVALUATE                                             17970092
114610     END-PERFORM.                                                 17980092
114611                                                                  17990092
114612     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         18000092
114613         MOVE '7030-CLOSE-DWNLD-CURSOR' TO DP013-PARAGRAPH        18010092
114614         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO CLOSE '     18020092
114615                                       TO DP013-MESSAGE-TEXT (1)  18030092
114616         MOVE SQLCA          TO DP013-SQLCA                       18040092
114617         MOVE 'TPURCHS'      TO DP013-DB2-TABLE-NAME (1)          18050092
114618         MOVE 'TDISTHD'      TO DP013-DB2-TABLE-NAME (2)          18060092
114619         SET DP013-DB2-ABEND                                      18070092
114620             DP013-XCTL-DISPLAY-RESTART TO TRUE                   18080092
114621         PERFORM DP013-0000-PROCESS-ABEND                         18090092
114622     END-IF.                                                      18100092
114623     MOVE +0 TO PV-RETRY-COUNTER.                                 18110092
114624                                                                  18120092
114625                                                                  18130092
114626******************************************************************18140092
114627** CHECK IF ANY CARTONS HAVE BEEN CHECKED IN FOR SET              18150092
114628******************************************************************18160092
114629 7050-CHECK-FOR-CHECK-IN.                                         18170092
114630                                                                  18180092
114631     MOVE 0  TO  PV-REC-CHECK-IN-COUNT.                           18190092
114633     SET  PS-EOF-SET-RCVR-CSR-NO  TO TRUE.                        18200092
114634     MOVE 1  TO  PV-MSG-LINE-COUNT                                18210092
114635                 PV-MSG-ELEMENT-COUNT.                            18220092
114636                                                                  18230092
114637     PERFORM 7055-OPEN-SET-RCVR-CURSOR.                           18240092
114638     PERFORM 7060-FETCH-SET-RCVR-CURSOR                           18250092
114639       UNTIL PS-EOF-SET-RCVR-CSR                                  18260092
114640          OR PV-RETRY-COUNTER > PC-MAX-RETRIES                    18270092
114641     PERFORM 7070-CLOSE-SET-RCVR-CURSOR.                          18280092
114642                                                                  18290092
114643     IF  PV-REC-CHECK-IN-COUNT   >  0                             18300092
114644         SET  PS-CARTONS-CHECKED-IN-YES   TO  TRUE                18310092
114645         MOVE SPACES  TO  AMSG0O                                  18320092
114646         STRING                                                   18330092
114647                ' RCVRS HAVE CHECK-IN CARTONS'                    18340092
114648                ' - LABELS WILL NOT REFLECT'                      18350092
114649                ' DIVERT CHANGE'                                  18360092
114650                  DELIMITED BY SIZE                               18370092
114651             INTO AMSG0O                                          18380092
114652     END-IF.                                                      18390092
114653                                                                  18400092
114654     IF  PV-REC-CHECK-IN-COUNT >  12                              18410092
114655         MOVE  'MORE'  TO  PV-ORDER-4D                            18420092
114656         MOVE 1  TO  PV-MSG-LINE-COUNT                            18430092
114657         MOVE 1  TO  PV-MSG-ELEMENT-COUNT                         18440092
114658     END-IF.                                                      18450092
114659                                                                  18460092
114660     MOVE PV-MESSAGE-2   TO  AMSG1O.                              18470092
114661     MOVE PV-MESSAGE-3   TO  AMSG2O.                              18480092
114662     MOVE PV-MESSAGE-4   TO  AMSG3O.                              18490092
114663                                                                  18500092
114664                                                                  18510092
114665 7055-OPEN-SET-RCVR-CURSOR.                                       18520092
114666                                                                  18530092
114667     PERFORM                                                      18540092
114668         WITH TEST AFTER                                          18550092
114669         VARYING PV-RETRY-COUNTER                                 18560092
114670         FROM 1 BY 1                                              18570092
114671         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               18580092
114672         OR     (SQLCODE = ZERO)                                  18590092
114673         OR     (SQLCODE = +100))                                 18600092
114674                                                                  18610092
114675     EXEC SQL                                                     18620092
114676          OPEN SET_RCVR_CSR                                       18630092
114677     END-EXEC                                                     18640092
114678                                                                  18650092
114679         EVALUATE TRUE                                            18660092
114680             WHEN SQLCODE = +0                                    18670092
114681                  CONTINUE                                        18680092
114682             WHEN SQLWARN0 NOT = SPACES                           18690092
114683             WHEN SQLCODE < +0                                    18700092
114684             WHEN SQLCODE > +0                                    18710092
114685                 MOVE '7055-OPEN-SET-RCVR-CURSOR'                 18720092
114686                                               TO DP013-PARAGRAPH 18730092
114687                 MOVE 'ERROR OPENING SET RCVR CURSOR          '   18740092
114688                                   TO DP013-MESSAGE-TEXT (1)      18750092
114689                 STRING 'YEAR:'  ASC-SET-YEAR                     18760092
114690                        '  SET:' ASC-SHORT-NAME                   18770092
114691                        '  :'    ASC-SEASET-NAME                  18780092
114692                                      DELIMITED BY SIZE           18790092
114693                                 INTO DP013-MESSAGE-TEXT (2)      18800092
114694                 MOVE SQLCA        TO DP013-SQLCA                 18810092
114695                 MOVE 'TPURCHS'    TO DP013-DB2-TABLE-NAME (1)    18820092
114696                 MOVE 'TRECEIV'    TO DP013-DB2-TABLE-NAME (2)    18830092
114697                 SET DP013-DB2-ABEND                              18840092
114698                     DP013-XCTL-DISPLAY-RESTART TO TRUE           18850092
114699                 PERFORM DP013-0000-PROCESS-ABEND                 18860092
114700         END-EVALUATE                                             18870092
114701     END-PERFORM.                                                 18880092
114702                                                                  18890092
114703     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         18900092
114704         MOVE '7055-OPEN-SET-RCVR-CURSOR'                         18910092
114705                                       TO DP013-PARAGRAPH         18920092
114706         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN  '     18930092
114707                                       TO DP013-MESSAGE-TEXT (1)  18940092
114708         MOVE SQLCA          TO DP013-SQLCA                       18950092
114709         MOVE 'TPURCHS'      TO DP013-DB2-TABLE-NAME (1)          18960092
114710         MOVE 'TRECEIV'      TO DP013-DB2-TABLE-NAME (2)          18970092
114711         SET DP013-DB2-ABEND                                      18980092
114712             DP013-XCTL-DISPLAY-RESTART TO TRUE                   18990092
114713         PERFORM DP013-0000-PROCESS-ABEND                         19000092
114714     END-IF.                                                      19010092
114715     MOVE +0 TO PV-RETRY-COUNTER.                                 19020092
114716                                                                  19030092
114717                                                                  19040092
114718 7060-FETCH-SET-RCVR-CURSOR.                                      19050092
114719                                                                  19060092
114720     PERFORM                                                      19070092
114721         WITH TEST AFTER                                          19080092
114722         VARYING PV-RETRY-COUNTER                                 19090092
114723         FROM 1 BY 1                                              19100092
114724         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               19110092
114725         OR     (SQLCODE = ZERO)                                  19120092
114726         OR     (SQLCODE = +100))                                 19130092
114727                                                                  19140092
114728      EXEC SQL                                                    19150092
114729         FETCH SET_RCVR_CSR                                       19160092
114730          INTO :RECEIV-CURR-OPER-UNT-ID                           19170092
114731             , :RECEIV-ORD-NBR                                    19180092
114732             , :RECEIV-REC-SEQ-NBR                                19190092
114733      END-EXEC                                                    19200092
114734                                                                  19210092
114735         EVALUATE TRUE                                            19220092
114736             WHEN SQLCODE = +0                                    19230092
114737                  PERFORM 7065-PROCESS-RECORD                     19240092
114738                  IF  PV-REC-CHECK-IN-COUNT  > 12                 19250092
114739                      SET  PS-EOF-SET-RCVR-CSR TO  TRUE           19260092
114740                  END-IF                                          19270092
114741             WHEN SQLCODE = +100                                  19280092
114742                  SET  PS-EOF-SET-RCVR-CSR TO TRUE                19290092
114743             WHEN SQLWARN0 NOT = SPACES                           19300092
114744             WHEN SQLCODE < +0                                    19310092
114745             WHEN SQLCODE > +0                                    19320092
114746                 MOVE '7060-FETCH-SET-RCVR-CURSOR'                19330092
114747                                                TO DP013-PARAGRAPH19340092
114748                 MOVE 'ERROR TRYING TO FETCH CURSOR           '   19350092
114749                                   TO DP013-MESSAGE-TEXT (1)      19360092
114750                 STRING 'YEAR:'  ASC-SET-YEAR                     19370092
114751                        '  SET:' ASC-SHORT-NAME                   19380092
114752                        '  :'    ASC-SEASET-NAME                  19390092
114753                                      DELIMITED BY SIZE           19400092
114754                                 INTO DP013-MESSAGE-TEXT (2)      19410092
114755                 MOVE SQLCA        TO DP013-SQLCA                 19420092
114756                 MOVE 'TPURCHS'    TO DP013-DB2-TABLE-NAME (1)    19430092
114757                 MOVE 'TRECEIV'    TO DP013-DB2-TABLE-NAME (2)    19440092
114758                 SET DP013-DB2-ABEND                              19450092
114759                     DP013-XCTL-DISPLAY-RESTART TO TRUE           19460092
114760                 PERFORM DP013-0000-PROCESS-ABEND                 19470092
114761         END-EVALUATE                                             19480092
114762     END-PERFORM.                                                 19490092
114763                                                                  19500092
114764     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         19510092
114765         MOVE '7060-FETCH-SET-RCVR-CURSOR'                        19520092
114766                                        TO DP013-PARAGRAPH        19530092
114767         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO FETCH '     19540092
114768                                       TO DP013-MESSAGE-TEXT (1)  19550092
114769         MOVE SQLCA          TO DP013-SQLCA                       19560092
114770         MOVE 'TPURCHS'      TO DP013-DB2-TABLE-NAME (1)          19570092
114771         MOVE 'TRECEIV'      TO DP013-DB2-TABLE-NAME (2)          19580092
114772         SET DP013-DB2-ABEND                                      19590092
114773             DP013-XCTL-DISPLAY-RESTART TO TRUE                   19600092
114774         PERFORM DP013-0000-PROCESS-ABEND                         19610092
114775     END-IF.                                                      19620092
114776     MOVE +0 TO PV-RETRY-COUNTER.                                 19630092
114777                                                                  19640092
114778                                                                  19650092
114779 7065-PROCESS-RECORD.                                             19660092
114780                                                                  19670092
114781     PERFORM                                                      19680092
114782         WITH TEST AFTER                                          19690092
114783         VARYING PV-RETRY-COUNTER                                 19700092
114784         FROM 1 BY 1                                              19710092
114785         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               19720092
114786         OR     (SQLCODE = ZERO)                                  19730092
114787         OR     (SQLCODE = +100))                                 19740092
114788                                                                  19750092
114789         EXEC SQL                                                 19760092
114790              SELECT                                              19770092
114791                     C.ORGN_LOC_NBR                               19780092
114792                    ,B.TRN_NBR                                    19790092
114793                    ,B.RCVR_SEQ_NBR                               19800092
114794                INTO                                              19810092
114795                     :SUT00024-ORGN-LOC-NBR                       19820092
114796                   , :SUT00028-TRN-NBR                            19830092
114797                   , :SUT00028-RCVR-SEQ-NBR                       19840092
114798                FROM                                              19850092
114799                     SUT_OTBND_UPC B                              19860092
114800                    ,SUT_OTBND_CART C                             19870092
114801               WHERE                                              19880092
114802                     B.TRN_NBR        = :RECEIV-ORD-NBR           19890092
114803                 AND B.RCVR_SEQ_NBR   = :RECEIV-REC-SEQ-NBR       19900092
114804                 AND B.SHIPT_UNT_ID   = C.SHIPT_UNT_ID            19910092
114805                 AND C.ACTV_IND       = 'Y'                       19920092
114806                FETCH FIRST 1 ROW ONLY                            19930092
114807                WITH UR                                           19940092
114808         END-EXEC                                                 19950092
114809                                                                  19960092
114810         EVALUATE TRUE                                            19970092
114811             WHEN SQLCODE = +0                                    19980092
114812                  ADD  1  TO  PV-REC-CHECK-IN-COUNT               19990092
114813                  IF  PV-REC-CHECK-IN-COUNT  > 12                 20000092
114814                      CONTINUE                                    20010092
114815                  ELSE                                            20020092
114816                      PERFORM 7066-BUILD-CHECK-IN-DISPLAY         20030092
114817                  END-IF                                          20040092
114818                                                                  20050092
114819             WHEN SQLCODE = +100                                  20060092
114820                  SET PS-CARTONS-CHECKED-IN-NO  TO TRUE           20070092
114821             WHEN SQLWARN0 NOT = SPACES                           20080092
114822             WHEN SQLCODE < +0                                    20090092
114823             WHEN SQLCODE > +0                                    20100092
114824                 MOVE '7050-CHECK-FOR-CHECK-IN' TO DP013-PARAGRAPH20110092
114825                 MOVE 'ERROR CHECK TO SEE IF CARTON CHECKED-IN'   20120092
114826                                   TO DP013-MESSAGE-TEXT (1)      20130092
114827                 STRING 'YEAR:'  ASC-SET-YEAR                     20140092
114828                        '  SET:' ASC-SHORT-NAME                   20150092
114829                        '  :'    ASC-SEASET-NAME                  20160092
114830                                      DELIMITED BY SIZE           20170092
114831                                 INTO DP013-MESSAGE-TEXT (2)      20180092
114832                 MOVE SQLCA        TO DP013-SQLCA                 20190092
114833                 MOVE 'TPURCHS'    TO DP013-DB2-TABLE-NAME (1)    20200092
114834                 MOVE 'TDISTHD'    TO DP013-DB2-TABLE-NAME (2)    20210092
114835                 SET DP013-DB2-ABEND                              20220092
114836                     DP013-XCTL-DISPLAY-RESTART TO TRUE           20230092
114837                 PERFORM DP013-0000-PROCESS-ABEND                 20240092
114838         END-EVALUATE                                             20250092
114839     END-PERFORM.                                                 20260092
114840                                                                  20270092
114841     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         20280092
114842         MOVE '7050-CHECK-FOR-CHECK-IN' TO DP013-PARAGRAPH        20290092
114843         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     20300092
114844                                       TO DP013-MESSAGE-TEXT (1)  20310092
114845         MOVE SQLCA          TO DP013-SQLCA                       20320092
114846         MOVE 'TPURCHS'      TO DP013-DB2-TABLE-NAME (1)          20330092
114847         MOVE 'TDISTHD'      TO DP013-DB2-TABLE-NAME (2)          20340092
114848         SET DP013-DB2-ABEND                                      20350092
114849             DP013-XCTL-DISPLAY-RESTART TO TRUE                   20360092
114850         PERFORM DP013-0000-PROCESS-ABEND                         20370092
114851     END-IF.                                                      20380092
114852     MOVE +0 TO PV-RETRY-COUNTER.                                 20390092
114853                                                                  20400092
114854                                                                  20410092
114855 7066-BUILD-CHECK-IN-DISPLAY.                                     20420092
114860                                                                  20430092
114861     MOVE  RECEIV-CURR-OPER-UNT-ID TO  PV-MSG-DISP-OPER.          20440092
114862     MOVE  '-'                     TO  PV-MSG-DASH-1.             20450092
114863     MOVE  RECEIV-ORD-NBR          TO  PV-MSG-DISP-PO.            20460092
114864     MOVE  '-'                     TO  PV-MSG-DASH-2.             20470092
114865     MOVE  RECEIV-REC-SEQ-NBR      TO  PV-MSG-DISP-RCVR.          20480092
114866                                                                  20490092
114867     EVALUATE TRUE                                                20500092
114868         WHEN PV-MSG-LINE-COUNT  =  1                             20510092
114869              IF  PV-MSG-ELEMENT-COUNT = 1                        20520092
114870                  MOVE  PV-DISP-ORDER  TO  PV-ORDER-2A            20530092
114871                  ADD  1  TO  PV-MSG-ELEMENT-COUNT                20540092
114872              ELSE                                                20550092
114873              IF  PV-MSG-ELEMENT-COUNT = 2                        20560092
114874                  MOVE  PV-DISP-ORDER  TO  PV-ORDER-2B            20570092
114875                  ADD  1  TO  PV-MSG-ELEMENT-COUNT                20580092
114876              ELSE                                                20590092
114877              IF  PV-MSG-ELEMENT-COUNT = 3                        20600092
114878                  MOVE  PV-DISP-ORDER  TO  PV-ORDER-2C            20610092
114879                  ADD  1  TO  PV-MSG-ELEMENT-COUNT                20620092
114880              ELSE                                                20630092
114881              IF  PV-MSG-ELEMENT-COUNT = 4                        20640092
114882                  MOVE  PV-DISP-ORDER  TO  PV-ORDER-2D            20650092
114883                  ADD  1  TO  PV-MSG-LINE-COUNT                   20660092
114884                  MOVE 1  TO  PV-MSG-ELEMENT-COUNT                20670092
114885              END-IF                                              20680092
114886              END-IF                                              20690092
114887              END-IF                                              20700092
114888              END-IF                                              20710092
114889         WHEN PV-MSG-LINE-COUNT  =  2                             20720092
114890              IF  PV-MSG-ELEMENT-COUNT = 1                        20730092
114891                  MOVE  PV-DISP-ORDER  TO  PV-ORDER-3A            20740092
114892                  ADD  1  TO  PV-MSG-ELEMENT-COUNT                20750092
114893              ELSE                                                20760092
114894              IF  PV-MSG-ELEMENT-COUNT = 2                        20770092
114895                  MOVE  PV-DISP-ORDER  TO  PV-ORDER-3B            20780092
114896                  ADD  1  TO  PV-MSG-ELEMENT-COUNT                20790092
114897              ELSE                                                20800092
114898              IF  PV-MSG-ELEMENT-COUNT = 3                        20810092
114899                  MOVE  PV-DISP-ORDER  TO  PV-ORDER-3C            20820092
114900                  ADD  1  TO  PV-MSG-ELEMENT-COUNT                20830092
114901              ELSE                                                20840092
114902              IF  PV-MSG-ELEMENT-COUNT = 4                        20850092
114903                  MOVE  PV-DISP-ORDER  TO  PV-ORDER-3D            20860092
114904                  ADD  1  TO  PV-MSG-LINE-COUNT                   20870092
114905                  MOVE 1  TO  PV-MSG-ELEMENT-COUNT                20880092
114906              END-IF                                              20890092
114907              END-IF                                              20900092
114908              END-IF                                              20910092
114909              END-IF                                              20920092
114910         WHEN PV-MSG-LINE-COUNT  =  3                             20930092
114911              IF  PV-MSG-ELEMENT-COUNT = 1                        20940092
114912                  MOVE  PV-DISP-ORDER  TO  PV-ORDER-4A            20950092
114913                  ADD  1  TO  PV-MSG-ELEMENT-COUNT                20960092
114914              ELSE                                                20970092
114915              IF  PV-MSG-ELEMENT-COUNT = 2                        20980092
114916                  MOVE  PV-DISP-ORDER  TO  PV-ORDER-4B            20990092
114917                  ADD  1  TO  PV-MSG-ELEMENT-COUNT                21000092
114918              ELSE                                                21010092
114919              IF  PV-MSG-ELEMENT-COUNT = 3                        21020092
114920                  MOVE  PV-DISP-ORDER  TO  PV-ORDER-4C            21030092
114921                  ADD  1  TO  PV-MSG-ELEMENT-COUNT                21040092
114928              ELSE                                                21050092
114929              IF  PV-MSG-ELEMENT-COUNT = 4                        21060092
114930                  MOVE  PV-DISP-ORDER  TO  PV-ORDER-4D            21070092
114931                  MOVE 1  TO  PV-MSG-LINE-COUNT                   21080092
114932                  MOVE 1  TO  PV-MSG-ELEMENT-COUNT                21090092
114934              END-IF                                              21100092
114935              END-IF                                              21110092
114936              END-IF                                              21120092
114937              END-IF                                              21130092
114938     END-EVALUATE.                                                21140092
114939                                                                  21150092
114942                                                                  21160092
114943 7070-CLOSE-SET-RCVR-CURSOR.                                      21170092
114944                                                                  21180092
114945     PERFORM                                                      21190092
114946         WITH TEST AFTER                                          21200092
114947         VARYING PV-RETRY-COUNTER                                 21210092
114948         FROM 1 BY 1                                              21220092
114949         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21230092
114950         OR     (SQLCODE = ZERO)                                  21240092
114951         OR     (SQLCODE = +100))                                 21250092
114952                                                                  21260092
114953     EXEC SQL                                                     21270092
114954          CLOSE SET_RCVR_CSR                                      21280092
114955     END-EXEC                                                     21290092
114956                                                                  21300092
114957         EVALUATE TRUE                                            21310092
114958             WHEN SQLCODE = +0                                    21320092
114959                  CONTINUE                                        21330092
114960             WHEN SQLWARN0 NOT = SPACES                           21340092
114961             WHEN SQLCODE < +0                                    21350092
114962             WHEN SQLCODE > +0                                    21360092
114963                 MOVE '7070-CLOSE-SET-RCVR-CURSOR'                21370092
114964                                                TO DP013-PARAGRAPH21380092
114965                 MOVE 'ERROR CLOSING DOWNLOAD CURSOR          '   21390092
114966                                   TO DP013-MESSAGE-TEXT (1)      21400092
114967                 STRING 'YEAR:'  ASC-SET-YEAR                     21410092
114968                        '  SET:' ASC-SHORT-NAME                   21420092
114969                        '  :'    ASC-SEASET-NAME                  21430092
114970                                      DELIMITED BY SIZE           21440092
114971                                 INTO DP013-MESSAGE-TEXT (2)      21450092
114972                 MOVE SQLCA        TO DP013-SQLCA                 21460092
114973                 MOVE 'TPURCHS'    TO DP013-DB2-TABLE-NAME (1)    21470092
114974                 MOVE 'TRECEIV'    TO DP013-DB2-TABLE-NAME (2)    21480092
114975                 SET DP013-DB2-ABEND                              21490092
114976                     DP013-XCTL-DISPLAY-RESTART TO TRUE           21500092
114977                 PERFORM DP013-0000-PROCESS-ABEND                 21510092
114978         END-EVALUATE                                             21520092
114979     END-PERFORM.                                                 21530092
114980                                                                  21540092
114981     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         21550092
114982         MOVE '7070-CLOSE-SET-RCVR-CURSOR'                        21560092
114983                                        TO DP013-PARAGRAPH        21570092
114984         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO CLOSE '     21580092
114985                                       TO DP013-MESSAGE-TEXT (1)  21590092
114986         MOVE SQLCA          TO DP013-SQLCA                       21600092
114987         MOVE 'TPURCHS'      TO DP013-DB2-TABLE-NAME (1)          21610092
114988         MOVE 'TRECEIV'      TO DP013-DB2-TABLE-NAME (2)          21620092
114989         SET DP013-DB2-ABEND                                      21630092
114990             DP013-XCTL-DISPLAY-RESTART TO TRUE                   21640092
114991         PERFORM DP013-0000-PROCESS-ABEND                         21650092
114992     END-IF.                                                      21660092
114993     MOVE +0 TO PV-RETRY-COUNTER.                                 21670092
114994                                                                  21680092
114995                                                                  21690092
115001******************************************************************21700092
115002** UPDATE A ROW ON THE CONTROL DC DOOR TABLE                      21710092
115003******************************************************************21720092
115004 7100-UPDATE-TSEASET.                                             21730092
115005     MOVE ASC-SET-YEAR            TO SEASET-SEASET-YR.            21740092
115006     MOVE ASC-SHORT-NAME          TO SEASET-SEASET-SHRT-NM.       21750092
115007     MOVE ASC-DIVERT-PREFIX-NBR-N TO SEASET-DIVERT-PFX-NBR.       21760092
115010                                                                  21770092
115100     PERFORM                                                      21780092
115200         WITH TEST AFTER                                          21790092
115300         VARYING PV-RETRY-COUNTER                                 21800092
115400         FROM 1 BY 1                                              21810092
115500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21820092
115600         OR     (SQLCODE = ZERO)                                  21830092
115700         OR     (SQLCODE = +100))                                 21840092
115800                                                                  21850092
115900         EXEC SQL                                                 21860092
116000              UPDATE TSEASET                                      21870092
116100                 SET                                              21880092
116200                     DIVERT_PFX_NBR   = :SEASET-DIVERT-PFX-NBR    21890092
116610               WHERE SEASET_YR        = :SEASET-SEASET-YR         21900092
116620                 AND SEASET_SHRT_NM   = :SEASET-SEASET-SHRT-NM    21910092
116900         END-EXEC                                                 21920092
117000                                                                  21930092
117100         EVALUATE TRUE                                            21940092
117200             WHEN SQLCODE = +0                                    21950092
117300                 SET ASC-TSEASET-UPDATED TO TRUE                  21960092
117400             WHEN SQLWARN0 NOT = SPACES                           21970092
117500             WHEN SQLCODE < +0                                    21980092
117600             WHEN SQLCODE > +0                                    21990092
117700                 MOVE '7100-UPDATE-TSEASET' TO DP013-PARAGRAPH    22000092
117800                 MOVE 'ERROR UPDATING SEASONAL SET TABLE'         22010092
117900                                   TO DP013-MESSAGE-TEXT (1)      22020092
117910                 STRING 'YEAR:'  ASC-SET-YEAR                     22030092
117920                        '  SET:' ASC-SHORT-NAME                   22040092
117921                        '  :'    ASC-SEASET-NAME                  22050092
117930                                      DELIMITED BY SIZE           22060092
117940                                 INTO DP013-MESSAGE-TEXT (2)      22070092
118000                 MOVE SQLCA        TO DP013-SQLCA                 22080092
118100                 MOVE 'TSEASET'    TO DP013-DB2-TABLE-NAME (1)    22090092
118200                 SET DP013-DB2-ABEND                              22100092
118300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           22110092
118400                 PERFORM DP013-0000-PROCESS-ABEND                 22120092
118500         END-EVALUATE                                             22130092
118600     END-PERFORM.                                                 22140092
118700                                                                  22150092
118800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         22160092
118900         MOVE '7100-UPDATE-TSEASET' TO DP013-PARAGRAPH            22170092
119000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     22180092
119100                                       TO DP013-MESSAGE-TEXT (1)  22190092
119200         MOVE SQLCA          TO DP013-SQLCA                       22200092
119300         MOVE 'TSEASET'      TO DP013-DB2-TABLE-NAME (1)          22210092
119400         SET DP013-DB2-ABEND                                      22220092
119500             DP013-XCTL-DISPLAY-RESTART TO TRUE                   22230092
119600         PERFORM DP013-0000-PROCESS-ABEND                         22240092
119700     END-IF.                                                      22250092
119800     MOVE +0 TO PV-RETRY-COUNTER.                                 22260092
119900                                                                  22270092
120000*----------------------------------------------------------------*22280092
120100* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *22290092
120200*----------------------------------------------------------------*22300092
120300 9100-READ-SEL-QUEUE.                                             22310092
120400     EXEC CICS                                                    22320092
120500         READQ TS                                                 22330092
120600             QUEUE (ASC-SEL-QUEUE-NAME)                           22340092
120700             INTO  (CN017-SELECT-RECORD)                          22350092
120800             ITEM  (ASC-SEL-ITEM)                                 22360092
120900             RESP  (PV-CICS-RESPONSE)                             22370092
121000     END-EXEC.                                                    22380092
121100                                                                  22390092
121200     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                       22400092
121300         CONTINUE                                                 22410092
121400     ELSE                                                         22420092
121500         SET DP013-LOGIC-ABEND                                    22430092
121600             DP013-NO-ROLLBACK     TO TRUE                        22440092
121700         MOVE '9100-READ-SEL-QUEUE' TO DP013-PARAGRAPH            22450092
121800         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   22460092
121900                                   TO DP013-MESSAGE-TEXT (1)      22470092
122000         PERFORM DP013-0000-PROCESS-ABEND                         22480092
122100     END-IF.                                                      22490092
122200                                                                  22500092
122300*----------------------------------------------------------------*22510092
122400* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *22520092
122500*----------------------------------------------------------------*22530092
122600 9200-REWRITE-SEL-QUEUE.                                          22540092
122700     EXEC CICS                                                    22550092
122800          WRITEQ TS                                               22560092
122900              QUEUE  (ASC-SEL-QUEUE-NAME)                         22570092
123000              FROM   (CN017-SELECT-RECORD)                        22580092
123100              ITEM   (ASC-SEL-ITEM)                               22590092
123200              RESP   (PV-CICS-RESPONSE)                           22600092
123300              REWRITE                                             22610092
123400     END-EXEC.                                                    22620092
123500                                                                  22630092
123600     IF  PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                   22640092
123700         SET DP013-CICS-ABEND                                     22650092
123800             DP013-NO-ROLLBACK     TO TRUE                        22660092
123900         MOVE '9200-REWRITE-SEL-QUEUE'  TO DP013-PARAGRAPH        22670092
124000         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   22680092
124100                                   TO DP013-MESSAGE-TEXT (1)      22690092
124200         PERFORM DP013-0000-PROCESS-ABEND                         22700092
124300     END-IF.                                                      22710092
124400                                                                  22720092
124500     COPY DPPD013.                                                22730092
124600*----------------------------------------------------------------*22740092
124700*    ABEND PROCESSOR MODULE                                      *22750092
124800*----------------------------------------------------------------*22760092
