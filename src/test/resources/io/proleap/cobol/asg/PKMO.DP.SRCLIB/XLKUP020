000010*TITLE 'WRITE MESSAGES TO XLT_PK_CPT_SKU (PACK COMPONENT SKU) FROM        
      *       PACK ITEM'.                                                       
000020 IDENTIFICATION DIVISION.                                         00030006
000030 PROGRAM-ID.    XLKUP020.                                         00040006
000040 AUTHOR.        DEANNA BRANTNER.                                  00050006
000050 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060006
000060 DATE-WRITTEN.  APRIL 2003.                                       00070006
000070 DATE-COMPILED.                                                   00080006
000100******************************************************************00090006
001000* THIS PGM IS PART OF THE INTERFACING BETWEEN RMS PO & LEGACY PO. 00100006
001100******************************************************************00110006
001200* THIS DB2 PROGRAM IS CALLED TO PROCESS CERTAIN TYPES OF PO DATA  00120006
001300* PASSED FROM RMS.  THE PROGRAM UPDATES, DELETES, AND INSERTS     00130006
001400* TO THE XL_PK_CPT_SKU TABLE.                                             
001500******************************************************************00160006
001600 ENVIRONMENT DIVISION.                                            00170006
001700 CONFIGURATION SECTION.                                           00180006
001800 SOURCE-COMPUTER.  IBM-3090.                                      00190006
001900 OBJECT-COMPUTER.  IBM-3090.                                      00200006
002000 DATA DIVISION.                                                   00210006
002100                                                                  00220006
002200 WORKING-STORAGE SECTION.                                         00230006
002300                                                                  00240006
002300 01  PS-PROGRAM-STUFF.                                            00250006
002400     05  PS-EXISTENCE-PO              PIC S9 COMP-3 VALUE ZERO.   00260006
002500         88  PS-SKU-EXISTS-YES                      VALUE 1.      00270006
002600         88  PS-SKU-EXISTS-NO                       VALUE ZERO.   00280006
022000     05  PS-NULL-IND                    PIC S9(04)  VALUE +0 COMP.00350006
002300                                                                  00360006
007100 01  PV-ABEND-FIELDS.                                                     
007200     05  PV-ABEND-CODE                PIC  S9(4) VALUE +0                 
007300                                                 COMP SYNC.               
006700     05  PV-SQLCODE                   PIC  S9(9) VALUE +0.                
006800     05  PV-DISP-SQLCODE              PIC ZZZZZZ9-.                       
007400     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'XLKUP020'.        
007500     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.            
007600     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.            
007700     05  PV-ABEND-TABLE               PIC  X(14) VALUE SPACES.            
007900     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.            
008000     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.            
002300                                                                  00360006
002400**** XLT_PK_CPT_SKU TABLE                                                 
002500     EXEC SQL                                                     00580006
002600         INCLUDE XLT00008                                         00590006
002700     END-EXEC.                                                    00600006
002800                                                                  00610006
008900***********************************************************               
009000*  USED FOR DB2 ERROR MESSAGE BUILDING                    *               
009100***********************************************************               
009200     COPY DPWS004.                                                        
009300                                                                          
002900     EXEC SQL                                                     00620006
003000          INCLUDE SQLCA                                           00630006
003100     END-EXEC.                                                    00640006
003200                                                                  00650006
003300     COPY SQLCA2.                                                 00660006
003400                                                                  00670006
003300     COPY IMRD075.                                                00680006
003400                                                                  00690006
007200 LINKAGE SECTION.                                                         
007300******************************************************************        
007400**LINKAGE VARIABLES                                                       
007500******************************************************************        
007600 01  LV-LINKAGE-VARIABLES.                                                
007700     05  LV-IMRD075-RECORD               PIC X(137).                      
007800     05  LV-RETURN-CODE                  PIC X(04).                       
007900                                                                          
008000 PROCEDURE DIVISION USING LV-LINKAGE-VARIABLES.                           
008100******************************************************************        
003900                                                                  00750006
004200     INITIALIZE DCLXLT00008.                                              
004200     INITIALIZE IMRD075-RECORD.                                           
004200     MOVE LV-IMRD075-RECORD  TO IMRD075-RECORD.                           
003900                                                                  00750006
004200     IF IM075-ACTION-UPDATE                                       00791006
004200         PERFORM 2000-UPDATE-XLTPKCPT                             00792006
004200     ELSE                                                         00792106
004200         IF IM075-ACTION-INSERT                                   00793006
004200             PERFORM 3000-INSERT-XLTPKCPT                         00794006
004200         ELSE                                                     00794106
004200             IF IM075-ACTION-DELETE                                       
004200                 PERFORM 4000-DELETE-XLTPKCPT                     00796006
004200             END-IF                                               00800006
004200         END-IF                                                   00801006
004200     END-IF.                                                      00802006
004300                                                                  00810006
004600     GOBACK.                                                      00840006
004700                                                                  00850006
      ******************************************************************01250006
       2000-UPDATE-XLTPKCPT.                                            01260006
                                                                        01270006
           MOVE IM075-PKSKU-PK-SKU-NBR      TO XLT00008-PK-SKU-NBR.     01290006
           MOVE IM075-PKSKU-CPT-SKU-NBR     TO XLT00008-CPT-SKU-NBR.    01291006
           MOVE IM075-PKSKU-PK-RATO-UNT-QTY TO                                  
                                             XLT00008-PK-RATIO-UNT-QTY.         
                                                                        01300006
           EXEC SQL                                                     01310006
               UPDATE XLT_PK_CPT_SKU                                    01320006
                 SET                                                    01330006
                    PK_RATIO_UNT_QTY = :XLT00008-PK-RATIO-UNT-QTY,              
                    LAST_UPD_TMST    = CURRENT TIMESTAMP                        
              WHERE PK_SKU_NBR       = :XLT00008-PK-SKU-NBR                     
                AND CPT_SKU_NBR      = :XLT00008-CPT-SKU-NBR                    
          END-EXEC                                                      01360006
                                                                        01370006
           EVALUATE TRUE                                                01390006
               WHEN SQLCODE = ZERO                                      01400006
               WHEN SQLCODE = +100                                      01410006
                   MOVE '0000'  TO LV-RETURN-CODE                               
               WHEN OTHER                                               01440006
                   MOVE '0017'  TO LV-RETURN-CODE                               
024600             MOVE '2000-UPDATE-XLTPKCPT'                                  
024700                                     TO PV-ABEND-PARAGRAPH                
024800             MOVE 'UPDATE XLT_PK_CPT_SKU'                                 
024810                                     TO PV-ABEND-OPERATION                
025500             STRING 'PK SKU NBR: '        DELIMITED BY SIZE               
025600                     IM075-PACK-PK-SKU-NBR DELIMITED BY SIZE              
026700                                   INTO PV-DB2-OPERATION-MESSAGE-1        
025500             STRING 'CPT SKU NBR: '       DELIMITED BY SIZE               
025600                     IM075-PKSKU-CPT-SKU-NBR DELIMITED BY SIZE            
026700                                   INTO PV-DB2-OPERATION-MESSAGE-2        
026800                                                                          
026900             MOVE 'XLT_PK_CPT_SKU'   TO PV-ABEND-TABLE                    
027000             PERFORM Z999-SQL-ABEND                                       
           END-EVALUATE.                                                01480006
                                                                        01490006
      ******************************************************************01491006
       3000-INSERT-XLTPKCPT.                                            01492006
                                                                        01493006
           MOVE IM075-PKSKU-PK-SKU-NBR      TO XLT00008-PK-SKU-NBR.     01290006
           MOVE IM075-PKSKU-CPT-SKU-NBR     TO XLT00008-CPT-SKU-NBR.    01291006
           MOVE IM075-PKSKU-PK-RATO-UNT-QTY TO                                  
                                             XLT00008-PK-RATIO-UNT-QTY.         
                                                                        01497006
           EXEC SQL                                                     01498006
               INSERT INTO XLT_PK_CPT_SKU                               01499006
                 (CPT_SKU_NBR                                           01499106
                 ,PK_RATIO_UNT_QTY                                              
                 ,PK_SKU_NBR                                            01499206
                 ,LAST_UPD_TMST)                                                
              VALUES (:XLT00008-CPT-SKU-NBR                                     
                     ,:XLT00008-PK-RATIO-UNT-QTY                                
                     ,:XLT00008-PK-SKU-NBR                                      
                     ,CURRENT TIMESTAMP)                                        
          END-EXEC                                                      01499506
                                                                        01499606
           EVALUATE TRUE                                                01499806
               WHEN SQLCODE = ZERO                                      01499906
               WHEN SQLCODE = -803                                      01500006
                   MOVE '0000'  TO LV-RETURN-CODE                               
               WHEN OTHER                                               01500206
                   MOVE '0015'  TO LV-RETURN-CODE                               
024600             MOVE '3000-INSERT-XLTPKCPT'                                  
024700                                     TO PV-ABEND-PARAGRAPH                
024800             MOVE 'INSERT XLT_PK_CPT_SKU'                                 
024810                                     TO PV-ABEND-OPERATION                
025500             STRING 'PK SKU NBR: '        DELIMITED BY SIZE               
025600                     IM075-PACK-PK-SKU-NBR DELIMITED BY SIZE              
026700                                   INTO PV-DB2-OPERATION-MESSAGE-1        
025500             STRING 'CPT SKU NBR: '       DELIMITED BY SIZE               
025600                     IM075-PKSKU-CPT-SKU-NBR DELIMITED BY SIZE            
026700                                   INTO PV-DB2-OPERATION-MESSAGE-2        
026800                                                                          
026900             MOVE 'XLT_PK_CPT_SKU'   TO PV-ABEND-TABLE                    
027000             PERFORM Z999-SQL-ABEND                                       
           END-EVALUATE.                                                01500606
                                                                        01500706
      ******************************************************************01500806
       4000-DELETE-XLTPKCPT.                                            01500906
                                                                        01501006
           MOVE IM075-PKSKU-PK-SKU-NBR      TO XLT00008-PK-SKU-NBR.     01290006
           MOVE IM075-PKSKU-CPT-SKU-NBR     TO XLT00008-CPT-SKU-NBR.    01291006
                                                                        01501406
           EXEC SQL                                                     01501506
               DELETE                                                   01501606
                 FROM XLT_PK_CPT_SKU                                    01501706
               WHERE PK_SKU_NBR  =  :XLT00008-PK-SKU-NBR                01501806
                AND CPT_SKU_NBR  =  :XLT00008-CPT-SKU-NBR                       
          END-EXEC                                                      01502106
                                                                        01502206
           EVALUATE TRUE                                                01502406
               WHEN SQLCODE = ZERO                                      01502506
               WHEN SQLCODE = +100                                      01502606
                   MOVE '0000'  TO LV-RETURN-CODE                               
               WHEN OTHER                                               01502806
                   MOVE '0016'  TO LV-RETURN-CODE                               
024600             MOVE '4000-DELETE-XLTPKCPT'                                  
024700                                     TO PV-ABEND-PARAGRAPH                
024800             MOVE 'DELETE XLT_PK_CPT_SKU'                                 
024810                                     TO PV-ABEND-OPERATION                
025500             STRING 'PK SKU NBR: '        DELIMITED BY SIZE               
025600                     IM075-PACK-PK-SKU-NBR DELIMITED BY SIZE              
026700                                   INTO PV-DB2-OPERATION-MESSAGE-1        
025500             STRING 'CPT SKU NBR: '       DELIMITED BY SIZE               
025600                     IM075-PKSKU-CPT-SKU-NBR DELIMITED BY SIZE            
026700                                   INTO PV-DB2-OPERATION-MESSAGE-2        
026800                                                                          
026900             MOVE 'XLT_PK_CPT_SKU'   TO PV-ABEND-TABLE                    
027000             PERFORM Z999-SQL-ABEND                                       
           END-EVALUATE.                                                01503206
                                                                        01503306
      ******************************************************************01491006
028700 Z999-SQL-ABEND.                                                          
028800                                                                          
028900     MOVE SQLCODE            TO PV-SQLCODE.                               
029000     MOVE PV-SQLCODE         TO PV-DISP-SQLCODE.                          
029100     DISPLAY '*** DB2 ERROR '.                                            
029200     DISPLAY '*** SQLCODE   = ' PV-DISP-SQLCODE.                          
029300     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                         
029400     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.                       
029500     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.                       
029600     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.               
029700     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.               
029900     DISPLAY '*** TABLE     = ' PV-ABEND-TABLE.                           
030000                                                                          
