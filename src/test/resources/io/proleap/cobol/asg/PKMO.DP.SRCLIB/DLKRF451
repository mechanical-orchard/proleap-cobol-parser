000100 TITLE 'LABOR SYSTEM - TEAM ASSOCIATE LIST'.                              
000200 IDENTIFICATION DIVISION.                                                 
000300                                                                          
000400 PROGRAM-ID.             DLKRF451.                                        
000500 AUTHOR.                 DENNIS STEFFEN.                                  
000600 INSTALLATION.           KOHLS.                                           
000700 DATE-WRITTEN.           JANUARY 2004.                                    
000800 DATE-COMPILED.                                                           
000900 ENVIRONMENT DIVISION.                                                    
001000 DATA DIVISION.                                                           
001100                                                                          
001200 WORKING-STORAGE SECTION.                                                 
001300*                                                                         
001400 01  PC-PROGRAM-CONSTANTS.                                                
001500     05  PC-TRANID                       PIC  X(04)  VALUE 'D451'.        
001600     05  PC-CURRENT-PROGRAM-NAME    PIC  X(08)  VALUE 'DLKRF451'.         
001700                                                                          
001800* ERROR MESSAGES                                                 *        
001900     05  PC-UNRECOGNIZED-PF-KEY-MSG PIC X(19) VALUE                       
002000                                           'UNRECOGNIZED PF KEY'.         
002100     05  PC-ENTER-THROUGH-MENU-MSG  PIC X(19) VALUE                       
002200                                           'ENTER THROUGH MENU '.         
002300     05  PC-TRANS-UNAVAILABLE-MSG   PIC X(19) VALUE                       
002400                                           'TRANS NOT AVAILABLE'.         
002500     05  PC-WRONG-FACILITY          PIC X(19) VALUE                       
002600                                           'WRG FCLTY - F2 CONF'.         
002700                                                                          
002800 01  PS-PROGRAM-SWITCHES.                                                 
002900     05  PS-ERROR-SW                  PIC  X(01)  VALUE 'N'.              
003000         88  PS-ERRORS-YES                        VALUE 'Y'.              
003100         88  PS-ERRORS-NO                         VALUE 'N'.              
003200     05  PS-NAME-CSR-SW               PIC X(01) VALUE 'N'.                
003300         88  PS-END-NAME-CSR-NO                 VALUE 'N'.                
003400         88  PS-END-NAME-CSR-YES                VALUE 'Y'.                
003500     05  PS-SCREEN-FULL-SW            PIC X(01) VALUE 'N'.                
003600         88  PS-SCREEN-FULL-YES                 VALUE 'Y'.                
003700         88  PS-SCREEN-FULL-NO                  VALUE 'N'.                
003800     05  PS-BROWSE-SW                 PIC X(01) VALUE 'F'.                
003900         88  PS-BROWSE-FWD                      VALUE 'F'.                
004000         88  PS-BROWSE-BKWD                     VALUE 'B'.                
004100/                                                                         
004200 01  DN-NULL-INDICATORS.                                                  
004300     05  DN-KOHLS-NULL-IND            PIC S9(04)  VALUE ZERO              
004400                                                     COMP SYNC.           
004500     05  DN-TEMP-NULL-IND             PIC S9(04)  VALUE ZERO              
004600                                                     COMP SYNC.           
004700*----------------------------------------------------------------*        
004800*  PROGRAM VARIABLES                                             *        
004900*----------------------------------------------------------------*        
005000 01  PV-PROGRAM-VARIABLES.                                                
005100                                                                          
005200     05  PV-NAME-SUB                  PIC S9(03) COMP-3                   
005300                                               VALUE ZERO.                
005400     05  PV-TEAM-COUNT                PIC S9(05) COMP-3                   
005500                                               VALUE ZERO.                
005600                                                                          
005700     05  PV-DISP-NBR                  PIC 9(09) VALUE ZERO.               
005800     05  PV-UNSTRING-COUNT            PIC S9(03) COMP-3.                  
005900     05  PV-POINTER                   PIC S9(03) COMP-3.                  
006000     05  PV-TALLY                     PIC S9(03) COMP-3.                  
006100     05  PV-TOT-QTY                   PIC S9(7) COMP-3.                   
006200                                                                          
006300     05  PV-COMMAREA-LENGTH           PIC S9(04)  VALUE +0                
006400                                                     COMP SYNC.           
006500     05  PV-MESSAGE-AREA              PIC  X(19)  VALUE SPACE.            
006600     05  PV-CICS-RESPONSE             PIC S9(09)  VALUE ZEROS             
006700                                                     COMP SYNC.           
006800     05  PV-TRANSFER-PROGRAM          PIC  X(08)  VALUE SPACE.            
006900     05  PV-USERID                    PIC X(08) VALUE SPACES.             
007000     05  PV-TMST                      PIC X(26) VALUE SPACES.             
007100                                                                          
007200 01  PV-LOG-MSG.                                                          
007300     05  FILLER                       PIC X(12) VALUE                     
007400         ' D451 ERROR '.                                                  
007500     05  FILLER                       PIC X(06) VALUE                     
007600         'USER= '.                                                        
007700     05  PV-LOG-USER-ID               PIC X(08) VALUE SPACES.             
007800     05  FILLER                       PIC X(10) VALUE                     
007900         ' SQLCODE= '.                                                    
008000     05  PV-SQLCODE                   PIC -9(03).                         
008100     05  FILLER                       PIC X(06) VALUE                     
008200         ' ERR= '.                                                        
008300     05  PV-ERROR-NBR                 PIC 9(03) VALUE ZERO.               
008400/                                                                         
008500* COMMAREA FOR DLKRF SCREENS                                              
008600     COPY DLWS010.                                                        
008700* FULL SCREEN MESSAGES                                                    
008800     COPY DLWS012.                                                        
008900/                                                                         
009000* COMMAREA FOR XLKUT067                                                   
009100     COPY XLWS067.                                                        
009200/                                                                         
009300* COMMAREA FOR PCKRF852 MESSAGE PROGRAM                                   
009400     COPY DLWS003.                                                        
009500/                                                                         
009600*  MAP LAYOUT                                                             
009700     COPY DLKM451.                                                        
009800 01  PV-NAMES-TABLE.                                                      
009900     05  PV-NAME OCCURS 3 TIMES      PIC X(019).                          
010000/                                                                         
010100* HELP SCREEN COMMAREA                                                    
010200     COPY PCWS192.                                                        
010300* HELP SCREEN WORK AREA                                                   
010400     COPY PCWS188.                                                        
010500/                                                                         
010600*  NUMERIC EDITS                                                          
010700     COPY DPWS010I.                                                       
010800*  KOHL'S STANDARD ATTRIBUTES                                             
010900     COPY DPWS015.                                                        
011000                                                                          
011100*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                              
011200     COPY DFHAID.                                                         
011300                                                                          
011400*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.                       
011500     COPY DPWS013.                                                        
011600/                                                                         
011700*    DLT_TEM_ASGMT                                                        
011800     EXEC SQL                                                             
011900         INCLUDE DLT00003                                                 
012000     END-EXEC                                                             
012100                                                                          
012200*    USED FOR INITIAL SCREEN AND SCROLLING FORWARDS                       
012300     EXEC SQL                                                             
012400         DECLARE NAME-CSR CURSOR FOR                                      
012500         SELECT                                                           
012600             TEM_ASGMT_SEQ_NBR                                            
012700         ,   KOHLS_USR_ID                                                 
012800         ,   TMP_USR_ID                                                   
012900         FROM                                                             
013000             DLT_TEM_ASGMT                                                
013100         WHERE                                                            
013200            ASGMT_STRT_DTE     = :DL010-ASGMT-STRT-DTE                    
013300            AND                                                           
013400            ASGMT_NBR_TXT      = :DL010-ASGMT-NBR-TXT                     
013500            AND                                                           
013600            ASGMT_NBR_SEQ_NBR  = :DL010-ASGMT-NBR-SEQ-NBR                 
013700            AND                                                           
013800            LVE_TMST           IS NULL                                    
013900         ORDER BY                                                         
014000             KOHLS_USR_ID                                                 
014100         ,   TMP_USR_ID                                                   
014200*            TEM_ASGMT_SEQ_NBR                                            
014300     END-EXEC                                                             
014400                                                                          
014500     EXEC SQL                                                             
014600         INCLUDE SQLCA                                                    
014700     END-EXEC.                                                            
014800                                                                          
014900 LINKAGE SECTION.                                                         
015000 01  DFHCOMMAREA.                                                         
015100     05  FILLER                         OCCURS  1 TO 4072 TIMES           
015200                                      DEPENDING ON EIBCALEN.              
015300         10  FILLER                   PIC X.                              
015400/                                                                         
015500 PROCEDURE DIVISION.                                                      
015600 0000-PROGRAM-MAINLINE.                                                   
015700                                                                          
015800     INITIALIZE DL010-COMMAREA                                            
015900     MOVE DFHCOMMAREA                 TO DL010-COMMAREA                   
016000                                                                          
016100     EVALUATE TRUE                                                        
016200         WHEN EIBCALEN = ZERO                                             
016300             MOVE PC-ENTER-THROUGH-MENU-MSG                               
016400                                      TO PV-MESSAGE-AREA                  
016500             PERFORM 8110-RETURN                                          
016600                                                                          
016700         WHEN EIBTRNID = 'Z278'                                           
016800             MOVE DFHCOMMAREA         TO PC192-COMMAREA                   
016900             MOVE PC192-HOST-SAVE-AREA                                    
017000                                      TO DL010-COMMAREA                   
017100             SET DL010-PROCESS-SCREEN TO TRUE                             
017200             MOVE PC192-HOST-SAVE-MAP TO DL451AO                          
017300             PERFORM 8000-SEND-MAP                                        
017400             PERFORM 8100-RETURN-TRANID                                   
017500                                                                          
017600         WHEN DL010-INITIALIZE-SCREEN                                     
017700         WHEN EIBAID = DFHCLEAR                                           
017800             SET DL010-PROCESS-SCREEN                                     
017900                 PS-BROWSE-FWD        TO TRUE                             
018000             PERFORM 1000-INITIALIZE                                      
018100                                                                          
018200             IF PS-ERRORS-NO                                              
018300                 MOVE 1               TO DL010-PAGE-SUB                   
018400                 PERFORM 3000-BUILD-SCREEN                                
018500                     VARYING DL010-LINE-SUB FROM 1 BY 1                   
018600                     UNTIL PS-SCREEN-FULL-YES                             
018700                        OR DL010-TEAM-USERID                              
018800                             (DL010-PAGE-SUB, DL010-LINE-SUB)             
018900                                     = SPACES                             
019000                 PERFORM 3200-MOVE-TBL-TO-MAP                             
019100             END-IF                                                       
019200                                                                          
019300             PERFORM 8000-SEND-MAP                                        
019400             PERFORM 8100-RETURN-TRANID                                   
019500                                                                          
019600         WHEN EIBAID = DFHPF3                                             
019700             MOVE DL010-LAST-PROGRAM  TO PV-TRANSFER-PROGRAM              
019800             PERFORM 8200-XCTL                                            
019900                                                                          
020000         WHEN EIBAID = DFHPF7                                             
020100*            SCROLL BACKWARD                                              
020200             SET PS-BROWSE-BKWD       TO TRUE                             
020300             MOVE 1                   TO PV-NAME-SUB                      
020400                                                                          
020500*            POSITION TO THE PREVIOUS PAGE                                
020600             SUBTRACT 1             FROM DL010-PAGE-SUB                   
020700             IF DL010-PAGE-SUB < 1                                        
020800                 MOVE 1               TO DL010-PAGE-SUB                   
020900             END-IF                                                       
021000                                                                          
021100             PERFORM 3000-BUILD-SCREEN                                    
021200                 VARYING DL010-LINE-SUB                                   
021300                 FROM 1 BY 1                                              
021400                 UNTIL PS-SCREEN-FULL-YES                                 
021500                    OR DL010-LINE-SUB > 3                                 
021600             PERFORM 3200-MOVE-TBL-TO-MAP                                 
021700                                                                          
021800             PERFORM 8000-SEND-MAP                                        
021900             PERFORM 8100-RETURN-TRANID                                   
022000                                                                          
022100         WHEN EIBAID = DFHPF8                                             
022200*            SCROLL FORWARD                                               
022300             SET PS-BROWSE-FWD        TO TRUE                             
022400             MOVE 1                   TO PV-NAME-SUB                      
022500                                                                          
022600*            POSITION TO THE NEXT PAGE                                    
022700             ADD 1                    TO DL010-PAGE-SUB                   
022800             IF DL010-PAGE-SUB > DL010-PAGE-COUNT                         
022900                 MOVE DL010-PAGE-COUNT TO DL010-PAGE-SUB                  
023000             END-IF                                                       
023100                                                                          
023200             PERFORM 3000-BUILD-SCREEN                                    
023300                 VARYING DL010-LINE-SUB                                   
023400                 FROM 1 BY 1                                              
023500                 UNTIL PS-SCREEN-FULL-YES                                 
023600                    OR DL010-TEAM-USERID                                  
023700                             (DL010-PAGE-SUB, DL010-LINE-SUB)             
023800                                 = SPACES                                 
023900             PERFORM 3200-MOVE-TBL-TO-MAP                                 
024000                                                                          
024100             PERFORM 8000-SEND-MAP                                        
024200             PERFORM 8100-RETURN-TRANID                                   
024300                                                                          
024400         WHEN EIBAID = DFHENTER                                           
024500*          DOES NOTHING                                                   
024600             PERFORM 8020-RECEIVE-MAP                                     
024700             PERFORM 8010-SEND-DATA-ONLY                                  
024800             PERFORM 8100-RETURN-TRANID                                   
024900                                                                          
025000         WHEN EIBAID = DFHPF1                                             
025100             PERFORM 8020-RECEIVE-MAP                                     
025200             MOVE DL451AO             TO PC192-HOST-SAVE-MAP              
025300             PERFORM 1200-HELP-SCREEN                                     
025400                                                                          
025500         WHEN OTHER                                                       
025600             PERFORM 8020-RECEIVE-MAP                                     
025700             MOVE PC-UNRECOGNIZED-PF-KEY-MSG                              
025800                                      TO AMSGLNO                          
025900             PERFORM 8000-SEND-MAP                                        
026000             PERFORM 8100-RETURN-TRANID                                   
026100     END-EVALUATE.                                                        
026200                                                                          
026300     GOBACK.                                                              
026400                                                                          
026500 1000-INITIALIZE.                                                         
026600                                                                          
026700     MOVE PC-TRANID                   TO DL010-TRAN-ID                    
026800     MOVE SPACES                      TO AWKTYPO                          
026900                                         AAREAO                           
027000                                         ANAME1O                          
027100                                         ANAME2O                          
027200                                         ANAME3O                          
027300     MOVE ZEROES                      TO ATMCNTO                          
027400                                         DL010-TEM-ASGMT-SEQ-NBR          
027500                                         DL010-TEAM-COUNT                 
027600     INITIALIZE DL010-SCROLL-TABLE                                        
027700     PERFORM 1100-SETUP-NAME-CURSOR.                                      
027800                                                                          
027900     IF PS-ERRORS-NO                                                      
028000         PERFORM 1300-BUILD-SCROLL-TABLE                                  
028100             VARYING DL010-PAGE-SUB                                       
028200                 FROM 1 BY 1                                              
028300                 UNTIL DL010-PAGE-SUB > 7                                 
028400             AFTER DL010-LINE-SUB                                         
028500                 FROM 1 BY 1                                              
028600                 UNTIL PS-END-NAME-CSR-YES                                
028700                 OR DL010-LINE-SUB > 3                                    
028800                                                                          
028900         PERFORM 7020-CLOSE-NAME-CSR                                      
029000     END-IF.                                                              
029100                                                                          
029200                                                                          
029300 1100-SETUP-NAME-CURSOR.                                                  
029400     INITIALIZE PV-NAMES-TABLE.                                           
029500     MOVE 1                           TO PV-NAME-SUB                      
029600                                                                          
029700     PERFORM 7000-OPEN-NAME-CSR                                           
029800     IF PS-ERRORS-YES                                                     
029900         MOVE 1                       TO PV-ERROR-NBR                     
030000                                         DL010-ERROR-NBR                  
030100         PERFORM 9903-WRITE-CICS-LOG                                      
030200         MOVE 6                       TO DL010-PGM-MSG-NBR                
030300         PERFORM 8210-XCTL-ERROR-SCREEN                                   
030400     END-IF.                                                              
030500                                                                          
030600     IF PS-ERRORS-NO                                                      
030700     PERFORM 7010-FETCH-NAME-CSR                                          
030800     IF PS-END-NAME-CSR-YES                                               
030900         MOVE 2                       TO PV-ERROR-NBR                     
031000                                         DL010-ERROR-NBR                  
031100         PERFORM 9903-WRITE-CICS-LOG                                      
031200         MOVE '100-SETUP-NAME-CURSOR'                                     
031300                                  TO DL010-PARAGRAPH                      
031400         MOVE 'DLKRF451 - CURSOR IS EMPTY'                                
031500                                  TO DL010-MESSAGE-TEXT(1)                
031600         MOVE SQLCA                   TO DL010-SQLCA                      
031700         MOVE 'DLT_TEM_ASGMT'         TO DL010-DB2-TABLE-NAME(1)          
031800         MOVE 6                       TO DL010-PGM-MSG-NBR                
031900         PERFORM 8210-XCTL-ERROR-SCREEN                                   
032000     END-IF                                                               
032100     END-IF.                                                              
032200                                                                          
032300 1200-HELP-SCREEN.                                                        
032400     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM              
032500     MOVE 'DLKRF451'                  TO PC192-PROGRAM-NAME               
032600     COPY PCPD188.                                                        
032700     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.              
032800     MOVE DL010-COMMAREA              TO PC192-HOST-SAVE-AREA             
032900     PERFORM 8220-XCTL-TO-HELP.                                           
033000/                                                                         
033100 1300-BUILD-SCROLL-TABLE.                                                 
033200     MOVE DL010-PAGE-SUB              TO DL010-PAGE-NBR                   
033300                                          (DL010-PAGE-SUB)                
033400                                                                          
033500     IF DN-KOHLS-NULL-IND = ZERO                                          
033600         MOVE DLT00003-KOHLS-USR-ID   TO DL010-TEAM-USERID                
033700                    (DL010-PAGE-SUB, DL010-LINE-SUB)                      
033800     ELSE                                                                 
033900         MOVE DLT00003-TMP-USR-ID     TO DL010-TEAM-USERID                
034000                    (DL010-PAGE-SUB, DL010-LINE-SUB)                      
034100     END-IF.                                                              
034200                                                                          
034300     IF DL010-LINE-SUB = 1                                                
034400         ADD 1                        TO DL010-PAGE-COUNT                 
034500     END-IF                                                               
034600                                                                          
034700     PERFORM 8600-CALL-XLKUT067                                           
034800     MOVE XL067-COMBINED-NAME-5       TO DL010-TEAM-LINE                  
034900                              (DL010-PAGE-SUB, DL010-LINE-SUB)            
035000                                                                          
035100     PERFORM 7010-FETCH-NAME-CSR.                                         
035200/                                                                         
035300 3000-BUILD-SCREEN.                                                       
035500         PERFORM 3150-BUILD-FROM-COMMAREA.                                
036200                                                                          
037400 3150-BUILD-FROM-COMMAREA.                                                
037500     MOVE DL010-TEAM-LINE (DL010-PAGE-SUB, DL010-LINE-SUB)                
037600                                      TO PV-NAME(PV-NAME-SUB).            
037700                                                                          
037800     ADD 1                            TO PV-NAME-SUB.                     
037900     IF PV-NAME-SUB > 3                                                   
038000         SET PS-SCREEN-FULL-YES       TO TRUE                             
038100     END-IF.                                                              
038200                                                                          
038300 3200-MOVE-TBL-TO-MAP.                                                    
038400     MOVE DL010-TEAM-COUNT            TO ATMCNTO                          
038500     MOVE DL010-WRK-TYP-DESC          TO AWKTYPO                          
038600     MOVE DL010-WRK-AREA-DESC         TO AAREAO                           
038700     MOVE PV-NAME (1)                 TO ANAME1O                          
038800     MOVE PV-NAME (2)                 TO ANAME2O                          
038900     MOVE PV-NAME (3)                 TO ANAME3O.                         
039000/                                                                         
039100                                                                          
039200 7000-OPEN-NAME-CSR.                                                      
039300                                                                          
039400     SET PS-SCREEN-FULL-NO            TO TRUE                             
039500     EXEC SQL                                                             
039600         OPEN NAME-CSR                                                    
039700     END-EXEC.                                                            
039800                                                                          
039900     EVALUATE TRUE                                                        
040000         WHEN SQLCODE = ZERO                                              
040100             CONTINUE                                                     
040200         WHEN SQLCODE = -180                                              
040300             SET PS-END-NAME-CSR-YES                                      
040400                 PS-ERRORS-YES        TO TRUE                             
040500         WHEN SQLCODE = -904                                              
040600         WHEN SQLCODE = -913                                              
040700         WHEN SQLCODE = -911                                              
040800             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID                   
040900             MOVE SQLCODE             TO PV-SQLCODE                       
041000             MOVE 3                   TO PV-ERROR-NBR                     
041100                                         DL010-ERROR-NBR                  
041200             PERFORM 9903-WRITE-CICS-LOG                                  
041300             PERFORM 9000-SOFT-ABORT                                      
041400             PERFORM 8210-XCTL-ERROR-SCREEN                               
041500         WHEN SQLWARN0 NOT = SPACES                                       
041600         WHEN SQLCODE NOT EQUAL ZERO                                      
041700             MOVE 4                   TO PV-ERROR-NBR                     
041800                                         DL010-ERROR-NBR                  
041900             PERFORM 9903-WRITE-CICS-LOG                                  
042000             MOVE '7000-OPEN-NAME-CSR'                                    
042100                                      TO DL010-PARAGRAPH                  
042200             MOVE 'DLKRF451 - OPEN NAME CURSOR'                           
042300                                      TO DL010-MESSAGE-TEXT(1)            
042400             MOVE SQLCA               TO DL010-SQLCA                      
042500             MOVE 'DLT_TEM_ASGMT'     TO DL010-DB2-TABLE-NAME(1)          
042600             SET DL010-ABEND          TO TRUE                             
042700             MOVE 3                   TO DL010-PGM-MSG-NBR                
042800             PERFORM 8210-XCTL-ERROR-SCREEN                               
042900                                                                          
043000     END-EVALUATE.                                                        
043100                                                                          
043200 7010-FETCH-NAME-CSR.                                                     
043300     EXEC SQL                                                             
043400         FETCH NAME-CSR                                                   
043500         INTO                                                             
043600             :DLT00003-TEM-ASGMT-SEQ-NBR                                  
043700         ,   :DLT00003-KOHLS-USR-ID:DN-KOHLS-NULL-IND                     
043800         ,   :DLT00003-TMP-USR-ID:DN-TEMP-NULL-IND                        
043900     END-EXEC.                                                            
044000                                                                          
044100     EVALUATE TRUE                                                        
044200         WHEN SQLCODE = ZERO                                              
044300             MOVE DLT00003-TEM-ASGMT-SEQ-NBR                              
044400                                      TO DL010-TEM-ASGMT-SEQ-NBR          
044500             ADD 1                    TO DL010-TEAM-COUNT                 
044600         WHEN SQLCODE = +100                                              
044700         WHEN SQLCODE = -180                                              
044800             SET PS-END-NAME-CSR-YES  TO TRUE                             
044900         WHEN SQLCODE = -904                                              
045000         WHEN SQLCODE = -913                                              
045100         WHEN SQLCODE = -911                                              
045200             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID                   
045300             MOVE SQLCODE             TO PV-SQLCODE                       
045400             MOVE 5                   TO PV-ERROR-NBR                     
045500                                         DL010-ERROR-NBR                  
045600             PERFORM 9903-WRITE-CICS-LOG                                  
045700             PERFORM 9000-SOFT-ABORT                                      
045800             PERFORM 8210-XCTL-ERROR-SCREEN                               
045900         WHEN SQLWARN0 NOT = SPACES                                       
046000         WHEN SQLCODE NOT EQUAL ZERO                                      
046100             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID                   
046200             MOVE 6                   TO PV-ERROR-NBR                     
046300                                         DL010-ERROR-NBR                  
046400             PERFORM 9903-WRITE-CICS-LOG                                  
046500             MOVE '7010-FETCH-NAME-CSR'                                   
046600                                      TO DL010-PARAGRAPH                  
046700             MOVE 'DLKRF451 - FETCH NAME CURSOR'                          
046800                                      TO DL010-MESSAGE-TEXT(1)            
046900             MOVE SQLCA               TO DL010-SQLCA                      
047000             MOVE 'DLT_TEM_ASGMT'     TO DL010-DB2-TABLE-NAME(1)          
047100             SET DL010-ABEND          TO TRUE                             
047200             MOVE 3                   TO DL010-PGM-MSG-NBR                
047300             PERFORM 8210-XCTL-ERROR-SCREEN                               
047400                                                                          
047500     END-EVALUATE.                                                        
047600                                                                          
047700 7020-CLOSE-NAME-CSR.                                                     
047800     EXEC SQL                                                             
047900         CLOSE NAME-CSR                                                   
048000     END-EXEC.                                                            
048100                                                                          
048200     EVALUATE TRUE                                                        
048300         WHEN SQLCODE = ZERO                                              
048400             CONTINUE                                                     
048500         WHEN SQLCODE = -904                                              
048600         WHEN SQLCODE = -913                                              
048700         WHEN SQLCODE = -911                                              
048800             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID                   
048900             MOVE SQLCODE             TO PV-SQLCODE                       
049000             MOVE 7                   TO PV-ERROR-NBR                     
049100                                         DL010-ERROR-NBR                  
049200             PERFORM 9903-WRITE-CICS-LOG                                  
049300             PERFORM 9000-SOFT-ABORT                                      
049400             PERFORM 8210-XCTL-ERROR-SCREEN                               
049500         WHEN SQLWARN0 NOT = SPACES                                       
049600         WHEN SQLCODE NOT EQUAL ZERO                                      
049700             MOVE DL010-KEYED-USERID  TO PV-LOG-USER-ID                   
049800             MOVE 8                   TO PV-ERROR-NBR                     
049900                                         DL010-ERROR-NBR                  
050000             PERFORM 9903-WRITE-CICS-LOG                                  
050100             MOVE '7020-CLOSE-NAME-CSR'                                   
050200                                      TO DL010-PARAGRAPH                  
050300             MOVE 'DLKRF451 - FETCH NAME CURSOR'                          
050400                                      TO DL010-MESSAGE-TEXT(1)            
050500             MOVE SQLCA               TO DL010-SQLCA                      
050600             MOVE 'DLT_TEM_ASGMT'     TO DL010-DB2-TABLE-NAME(1)          
050700             SET DL010-ABEND          TO TRUE                             
050800             MOVE 3                   TO DL010-PGM-MSG-NBR                
050900             PERFORM 8210-XCTL-ERROR-SCREEN                               
051000                                                                          
051100             CONTINUE                                                     
051200     END-EVALUATE.                                                        
051300/                                                                         
051400 8000-SEND-MAP.                                                           
051500                                                                          
051600     EXEC CICS                                                            
051700         SEND MAP       ('DL451A')                                        
051800              MAPSET    ('DLKM451')                                       
051900              ERASE                                                       
052000              RESP      (PV-CICS-RESPONSE)                                
052100     END-EXEC.                                                            
052200                                                                          
052300     EVALUATE TRUE                                                        
052400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                         
052500             CONTINUE                                                     
052600         WHEN OTHER                                                       
052700             MOVE '8000-SEND-MAP'     TO DP013-PARAGRAPH                  
052800             MOVE 'DLKRF451 - UNABLE TO SEND MAP'                         
052900                                      TO DP013-MESSAGE-TEXT (1)           
053000             SET DP013-CICS-ABEND                                         
053100                 DP013-ROLLBACK       TO TRUE                             
053200             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                       
053300     END-EVALUATE.                                                        
053400                                                                          
053500 8010-SEND-DATA-ONLY.                                                     
053600                                                                          
053700     EXEC CICS                                                            
053800         SEND MAP       ('DL451A')                                        
053900              MAPSET    ('DLKM451')                                       
054000              CURSOR                                                      
054100              DATAONLY                                                    
054200              RESP      (PV-CICS-RESPONSE)                                
054300     END-EXEC.                                                            
054400                                                                          
054500     EVALUATE TRUE                                                        
054600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                         
054700             CONTINUE                                                     
054800         WHEN OTHER                                                       
054900             MOVE '8010-SEND-DATA-ONLY'                                   
055000                                      TO DP013-PARAGRAPH                  
055100             MOVE 'DLKRF451 - UNABLE TO SEND DATA'                        
055200                                      TO DP013-MESSAGE-TEXT (1)           
055300             SET DP013-CICS-ABEND                                         
055400                 DP013-ROLLBACK       TO TRUE                             
055500             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                       
055600     END-EVALUATE.                                                        
055700                                                                          
055800 8020-RECEIVE-MAP.                                                        
055900                                                                          
056000     EXEC CICS                                                            
056100         RECEIVE MAP    ('DL451A')                                        
056200                 MAPSET ('DLKM451')                                       
056300                 RESP   (PV-CICS-RESPONSE)                                
056400     END-EXEC.                                                            
056500                                                                          
056600     EVALUATE TRUE                                                        
056700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                         
056800             CONTINUE                                                     
056900         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                        
057000             CONTINUE                                                     
057100         WHEN OTHER                                                       
057200            MOVE '8020-RECEIVE-MAP'      TO DP013-PARAGRAPH               
057300            MOVE 'DLKRF451 - UNABLE TO RECEIVE MAP'                       
057400                                         TO DP013-MESSAGE-TEXT (1)        
057500            SET DP013-LOGIC-ABEND        TO TRUE                          
057600            SET DP013-ROLLBACK           TO TRUE                          
057700            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                        
057800     END-EVALUATE.                                                        
057900                                                                          
058000 8100-RETURN-TRANID.                                                      
058100                                                                          
058200     MOVE LENGTH OF DL010-COMMAREA    TO PV-COMMAREA-LENGTH               
058300     EXEC CICS                                                            
058400         RETURN TRANSID  (PC-TRANID)                                      
058500                COMMAREA (DL010-COMMAREA)                                 
058600                LENGTH   (PV-COMMAREA-LENGTH)                             
058700                RESP     (PV-CICS-RESPONSE)                               
058800     END-EXEC.                                                            
058900                                                                          
059000     EVALUATE TRUE                                                        
059100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                         
059200             CONTINUE                                                     
059300         WHEN OTHER                                                       
059400             MOVE '8100-RETURN-TRANIND' TO DP013-PARAGRAPH                
059500             MOVE 'DLKRF451 - UNABLE TO RETURN TO TRANID'                 
059600                 TO DP013-MESSAGE-TEXT (1)                                
059700             SET DP013-CICS-ABEND       TO TRUE                           
059800             SET DP013-ROLLBACK         TO TRUE                           
059900             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                       
060000     END-EVALUATE.                                                        
060100                                                                          
060200 8110-RETURN.                                                             
060300                                                                          
060400     EXEC CICS                                                            
060500         SEND FROM (PV-MESSAGE-AREA)                                      
060600              LENGTH (19)                                                 
060700              ERASE                                                       
060800     END-EXEC.                                                            
060900                                                                          
061000     EXEC CICS                                                            
061100         RETURN                                                           
061200     END-EXEC.                                                            
061300                                                                          
061400 8200-XCTL.                                                               
061500     SET DL010-INITIALIZE-SCREEN      TO TRUE.                            
061600     MOVE PC-CURRENT-PROGRAM-NAME     TO DL010-LAST-PROGRAM               
061700*                                        DL010-MENU-PROGRAM               
061800     MOVE LENGTH OF DL010-COMMAREA    TO PV-COMMAREA-LENGTH               
061900                                                                          
062000     EXEC CICS                                                            
062100         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                            
062200               COMMAREA  (DL010-COMMAREA)                                 
062300               LENGTH    (PV-COMMAREA-LENGTH)                             
062400               RESP      (PV-CICS-RESPONSE)                               
062500     END-EXEC.                                                            
062600                                                                          
062700     EVALUATE TRUE                                                        
062800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                         
062900             CONTINUE                                                     
063000         WHEN OTHER                                                       
063100             MOVE '8200-XCTL'         TO DP013-PARAGRAPH                  
063200             MOVE 'DLKRF451 - UNABLE TO XCTL TO PROGRAM: '                
063300                                      TO DP013-MESSAGE-TEXT (1)           
063400             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)           
063500             SET DP013-CICS-ABEND                                         
063600                 DP013-ROLLBACK       TO TRUE                             
063700             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                       
063800             MOVE PC-TRANS-UNAVAILABLE-MSG                                
063900                                      TO AMSGLNO                          
064000             SET DL010-PROCESS-SCREEN TO TRUE                             
064100*            MOVE DL010-MENU-PROGRAM  TO DL010-LAST-PROGRAM               
064200             PERFORM 8000-SEND-MAP                                        
064300             PERFORM 8100-RETURN-TRANID                                   
064400     END-EVALUATE.                                                        
064500                                                                          
064600 8210-XCTL-ERROR-SCREEN.                                                  
064700                                                                          
064800     IF NOT DL010-ABEND                                                   
064900         SET DL010-INITIALIZE-SCREEN  TO TRUE                             
065000     END-IF                                                               
065100     MOVE DFHEIBLK                    TO DL010-DFHEIBLK.                  
065200     MOVE PC-CURRENT-PROGRAM-NAME     TO DL010-LAST-PROGRAM.              
065300     MOVE LENGTH OF DL010-COMMAREA    TO PV-COMMAREA-LENGTH               
065400     MOVE 'DLKRF456'                  TO PV-TRANSFER-PROGRAM              
065500     IF DL010-PGM-MSG-NBR = ZERO                                          
065600*        UNDEFINED ERROR                                                  
065700         MOVE 1                       TO DL010-PGM-MSG-NBR                
065800     END-IF                                                               
065900*                                                                         
066000     EXEC CICS                                                            
066100         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                            
066200               COMMAREA  (DL010-COMMAREA)                                 
066300               LENGTH    (PV-COMMAREA-LENGTH)                             
066400               RESP      (PV-CICS-RESPONSE)                               
066500     END-EXEC.                                                            
066600                                                                          
066700     EVALUATE TRUE                                                        
066800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                         
066900             CONTINUE                                                     
067000         WHEN OTHER                                                       
067100             MOVE '8200-XCTL'                                             
067200                                      TO DP013-PARAGRAPH                  
067300             MOVE 'DLKRF451 - UNABLE TO XCTL TO PROGRAM: '                
067400                                      TO DP013-MESSAGE-TEXT (1)           
067500             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)           
067600             SET DP013-CICS-ABEND                                         
067700                 DP013-ROLLBACK       TO TRUE                             
067800             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                       
067900             MOVE PC-TRANS-UNAVAILABLE-MSG                                
068000                                      TO AMSGLNO                          
068100             SET DL010-PROCESS-SCREEN TO TRUE                             
068200             PERFORM 8000-SEND-MAP                                        
068300             PERFORM 8100-RETURN-TRANID                                   
068400     END-EVALUATE.                                                        
068500/                                                                         
068600*                                                                         
068700 8220-XCTL-TO-HELP.                                                       
068800                                                                          
068900     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH               
069000                                                                          
069100     EXEC CICS                                                            
069200         XCTL                                                             
069300             PROGRAM   (PV-TRANSFER-PROGRAM)                              
069400             COMMAREA  (PC192-COMMAREA)                                   
069500             LENGTH    (PV-COMMAREA-LENGTH)                               
069600             RESP      (PV-CICS-RESPONSE)                                 
069700     END-EXEC.                                                            
069800                                                                          
069900     EVALUATE TRUE                                                        
070000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                         
070100              CONTINUE                                                    
070200         WHEN OTHER                                                       
070300             MOVE '8220-XCTL-TO-HELP' TO DP013-PARAGRAPH                  
070400             MOVE 'DLKRF451 - UNABLE TO XCTL TO PROGRAM: '                
070500                                      TO DP013-MESSAGE-TEXT (1)           
070600             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)           
070700             SET DP013-CICS-ABEND                                         
070800                 DP013-ROLLBACK       TO TRUE                             
070900             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                       
071000             MOVE PC-TRANS-UNAVAILABLE-MSG                                
071100                                      TO AMSGLNO                          
071200             SET DL010-PROCESS-SCREEN TO TRUE                             
071300             PERFORM 8000-SEND-MAP                                        
071400             PERFORM 8100-RETURN-TRANID                                   
071500     END-EVALUATE.                                                        
071600/                                                                         
071700 8600-CALL-XLKUT067.                                                      
071800                                                                          
071900     INITIALIZE XL067-USER-COMMAREA.                                      
072000     SET XL067-BY-USER-ID TO TRUE.                                        
072100     SET XL067-SELECT-BOTH-USERS TO TRUE.                                 
072200                                                                          
072300     MOVE DL010-TEAM-USERID (DL010-PAGE-SUB, DL010-LINE-SUB)              
072400                                      TO XL067-KEY-USER-ID                
072500     MOVE 'DLKRF451'              TO XL067-ORIG-CALLING-PGM-NM            
072600                                                                          
072700     CALL XL067-USER-PGM USING DFHEIBLK                                   
072800                               XL067-COMMAREA                             
072900                               XL067-USER-COMMAREA                        
073000                                                                          
073100     EVALUATE TRUE                                                        
073200         WHEN XL067-SUCCESSFUL                                            
073300             CONTINUE                                                     
073400         WHEN XL067-SQL-ERROR                                             
073500         WHEN XL067-INVALID-ACCESS                                        
073600             MOVE '8600-LINK-XLKUT067' TO DP013-PARAGRAPH                 
073700             MOVE 'DLKRF451 - DB2 ERROR IN PROGRAM: '                     
073800                                      TO DP013-MESSAGE-TEXT (1)           
073900             MOVE 'XLKUT067'          TO DP013-MESSAGE-TEXT (2)           
074000             SET DP013-CICS-ABEND                                         
074100                 DP013-ROLLBACK       TO TRUE                             
074200             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                       
074300             MOVE PC-TRANS-UNAVAILABLE-MSG                                
074400                                      TO AMSGLNO                          
074500             SET DL010-PROCESS-SCREEN TO TRUE                             
074600             PERFORM 8000-SEND-MAP                                        
074700             PERFORM 8100-RETURN-TRANID                                   
074800         WHEN OTHER                                                       
074900             MOVE '8600-LINK-XLKUT067' TO DP013-PARAGRAPH                 
075000             MOVE 'DLKRF451 - UNDETERMINED ERROR IN PGM: '                
075100                                      TO DP013-MESSAGE-TEXT (1)           
075200             MOVE 'XLKUT067'          TO DP013-MESSAGE-TEXT (2)           
075300             SET DP013-CICS-ABEND                                         
075400                 DP013-ROLLBACK       TO TRUE                             
075500             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                       
075600             MOVE PC-TRANS-UNAVAILABLE-MSG                                
075700                                      TO AMSGLNO                          
075800             SET DL010-PROCESS-SCREEN TO TRUE                             
075900             PERFORM 8000-SEND-MAP                                        
076000             PERFORM 8100-RETURN-TRANID                                   
076100     END-EVALUATE.                                                        
076200/                                                                         
076300 9000-SOFT-ABORT.                                                         
076400                                                                          
076500     EXEC CICS                                                            
076600         SYNCPOINT ROLLBACK                                               
076700     END-EXEC.                                                            
076800                                                                          
076900     MOVE 2                           TO DL010-PGM-MSG-NBR                
077000     MOVE SQLCODE                     TO DL010-SQLCODE                    
077100     MOVE SQLCA                       TO DL010-SQLCA                      
077200     MOVE 'D451'                      TO DL010-TRAN-ID                    
077300     PERFORM 8210-XCTL-ERROR-SCREEN.                                      
077400                                                                          
077500                                                                          
077600 9903-WRITE-CICS-LOG.                                                     
077700                                                                          
077800     MOVE SQLCODE                     TO PV-SQLCODE                       
077900                                                                          
078000     EXEC CICS                                                            
078100         WRITEQ TD                                                        
078200             QUEUE  ('CSSL')                                              
078300             FROM   (PV-LOG-MSG)                                          
078400             RESP   (PV-CICS-RESPONSE)                                    
078500     END-EXEC.                                                            
078600                                                                          
078700 9999-WRITE-MESSAGE-TO-CICS-LOG.                                          
078800                                                                          
078900     MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.                   
079000     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.                  
079100     INITIALIZE DP013-SRC-TASK-NUMBER                                     
079200                DP013-STACK.                                              
079300     SET DP013-LINK-RETURN            TO TRUE.                            
079400                                                                          
079500     EXEC CICS                                                            
079600         LINK                                                             
079700             PROGRAM   (DP013-NAME)                                       
079800             COMMAREA  (DP013-PARAMETERS)                                 
079900             LENGTH    (DP013-LENGTH)                                     
080000     END-EXEC.                                                            
080100                                                                          
080200*----------------------------------------------------------------*        
080300*    ABEND PROCESSOR MODULE                                      *        
080400*----------------------------------------------------------------*        
080500                                                                          
080600*    COPY DPPD014.                                                        
080700                                                                          
