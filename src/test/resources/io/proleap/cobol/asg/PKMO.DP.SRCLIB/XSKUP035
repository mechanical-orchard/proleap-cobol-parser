000100*----------------------------------------------------------       00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*----------------------------------------------------------       00030000
000400 PROGRAM-ID.    XSKUP035.                                         00040000
000500 AUTHOR.        ALEXIS KEIKER.                                    00050000
000600 DATE-WRITTEN.  OCTOBER 1, 2002.                                  00060000
000700                                                                  00070000
000800*----------------------------------------------------------       00080000
000900*              PRICING BUSINESS EVENT LOADER                      00090000
001000*----------------------------------------------------------       00100000
001010* THIS PROGRAM WILL PERFORM THE NECESSARY BUSINESS EVENT          00110000
001020* LOAD FOR THE PRICING BUSINESS EVENT.  THIS PROGRAM              00120000
001030* IS A MODULE AND WILL BE CALLED BY ANOTHER PROGRAM(XSKUT034).    00130000
001040* THERE ARE 5 PARAMETERS PASSED IN THIS PROGRAM.  ONE WILL        00140000
001050* BE THE ACTUAL PRICING BUSINESS EVENT RECORD, MAXIMUM            00150000
001060* FUTURE OFFSET DATE IN CCYYMMDD, A LOAD SQL RETURN CODE FIELD,   00160000
001070* A PROGRAM STATUS CODE, AND A LOAD SEVERITY LEVEL.  THIS PROGRAM 00170000
001080* WILL EITHER UPDATE OR INSERT A RECORD TO THE XST_MDSE_LNE_SELN  00180000
001090* (MERCHANDISE LINE TABLE).  IT WILL THEN UPDATE OR INSERT        00190000
001091* EITHER INTO THE XST_SMP_PRICG (SIMPLE PRICING TABLE), OR        00200000
001092* THE XST_TIER_PRICG (TIERED PRICING TABLE), OR THE               00210000
001093* XST_BWP_BUY_MDSE (BENEFIT WITH PURCHASE 'BUY' TABLE)            00220000
001094* DEPENDING ON THE PRICING TYPE CODE.  THIS PROGRAM WILL ALWAYS   00230000
001096* SEND BACK A LOAD SQL RETURN CODE, A PROGRAM STATUS CODE,        00240000
001097* AND A LOAD SEVERITY CODE.  IF THE PROGRAM DOES NOT UPDATE OR    00250000
001098* INSERT THE RECORD CORRECTLY IT WILL SELECT THE CORRECT          00260000
001099* ERROR CODES, FIND THE LOAD SEVERITY LEVEL, AND EXIT OUT OF      00270000
001100* THE PROGRAM.                                                    00280000
001101*                                                                 00290000
001102*          ERROR CODES - LOAD SQL RETURN CODE                     00300000
001103*             - THIS IS THE LAST SQL RETURN CODE RECEIVED         00310000
001104*               FROM A DATABASE ACTION.                           00320000
001105*                                                                 00330000
001106*          ERROR CODES - PROGRAM STATUS CODE                      00340000
001107*            THIS CODE IS FOUND BY TAKING THE MAXIMUM OFFSET      00350000
001108*            DATE AND COMPARING IT TO THE PROMOTION START         00360000
001109*            DATE.  IF THE MAXIMUM OFFSET DATE IS LESS THAN       00370000
001110*            THE PROMOTION START DATE THE LOAD IS NOT CRITICAL,   00380000
001111*            OTHERWISE IT IS CRITICAL TO THE SYSTEM.              00390000
001112*            THE PROMOTION START DATE IS FOUND BY SELECTING IT    00400000
001113*            FROM XST_PROMO (PROMOTION TABLE).                    00410000
001114*           - 00 - ALL DATABASE ACTION WAS SUCCESSFUL AND         00420000
001115*                  WORKED ACCORDING TO THE MESSAGE TYPE.          00430000
001116*           - 01 - AN 'ADD' RECORD WAS TURNED INTO AN             00440000
001117*                  UPDATE AND THE BUSINESS EVENT WAS FOUND        00450000
001118*                  TO BE THE ONE NEEDED ON THE DATABASE.          00460000
001119*           - 02 - AN 'ADD' RECORD WAS TURNED INTO AN UPDATE      00470000
001120*                  AND THE BUSINESS EVENT WAS FOUND TO BE         00480000
001121*                  THE ONE NOT NEEDED ON THE DATABASE.            00490000
001122*           - 03 - AN 'UPDATE' RECORD WAS TURNED INTO AN ADD.     00500000
001123*           - 04 - AN 'UPDATE' RECORD WAS BYPASSED BECAUSE THE    00510000
001124*                  RECORD CURRENTLY ON THE DATABASE WAS THE       00520000
001125*                  MOST RECENT DATA.                              00530000
001126*           - 05 - THE DATABASE ACTION WAS NOT SUCCESSFUL DUE     00540000
001127*                  TO THE RETURNED SQL CODE.                      00550000
001128*           - 06 - UNEXPECTED ACTION CODE RECEIVED.               00560000
001129*                                                                 00570000
001130*          ERROR CODES - LOAD SEVERITY LEVEL                      00580000
001131*           - 00 - THE LOAD OF THE DATA WAS SUCCESSFUL AND        00590000
001132*                  THEREFORE THE SEVERITY OF THE LOAD DID         00600000
001133*                  NOT NEED TO BE DETERMINED.                     00610000
001134*           - 01 - THE LOAD IS CRITICAL TO A SYSTEM AND           00620000
001135*                  THEREFORE MUST BE RESOLVED ASAP.               00630000
001136*           - 02 - THE LOAD IS NOT CRITICAL AND THEREFORE CAN     00640000
001137*                  WAIT UNTIL A LATER TIME TO BE RESOLVED.        00650000
001138*                                                                 00660000
001139*----------------------------------------------------------       00670000
001140* HISTORY LOG:                                                    00680000
001141*                                                                 00690000
001142*----------------------------------------------------------       00700000
001143* DATE: 08/27/2003                                                00710000
001144* WR/IR#: WR#25647                                                00720000
001145* PROGRAMMER: SCOTT BARTELT                                       00730000
001146* DESCRIPTION: ADDED LOGIC TO PROCESS ENHANCED BOGO TYPE          00740000
001147*              CODE OF 'GBL'.                                     00750000
001148*                                                                 00760000
001149* DATE: 09/10/2003                                                00770000
001150* WR/IR#: WR#25647                                                00780000
001151* PROGRAMMER: SCOTT BARTELT                                       00790000
001152* DESCRIPTION: ADDED LOGIC TO ALLOW FOR ZEROES IN THE GROUP       00800000
001153*              QUANTITY FIELD IF THE GIVEN PRICING TYPE USES      00810000
001154*              THIS FIELD.                                        00820000
001155*                                                                 00830000
W26114* DATE: 11/21/2003                                                00840000
W26114* WR/IR#: WR#26114                                                00850000
W26114* PROGRAMMER: NANCY MARTIN                                        00860000
W26114* DESCRIPTION: ADDED LOGIC FOR TWO NEW PROMOTIONS FOR "ENHANCED   00870000
W26114*              BOGO" WORK.  THE TWO NEW CODES ARE BUY ONE, GET    00880000
W26114*              EITHER SECOND FOR PARTICULAR PRICE (GBD) OR FOR    00890000
W26114*              A PERCENTAGE OFF (GBP).                            00900000
001155*                                                                 00910004
062110* DATE: 03/02/2010                                                00920006
062110* WR/IR#: WR#38172                                                00930006
062110* PROGRAMMER: CHERI PARMLEY                                       00940006
062110* DESCRIPTION: ADDED 'RBO' TO PV-SIMPLE-PRICE FOR REBATES.        00950006
001155*                                                                 00960005
C52736* DATE: 04/29/2013                                                00970007
C52736* WR/IR#: CHG0052736                                              00980007
C52736* PROGRAMMER: JOHN SELWITSCHKA                                    00990007
C52736* DESCRIPTION: MQPROMO PERFORMANCE IMPROVEMENT.                   01000007
001160*                                                                 01010005
001161*----------------------------------------------------------       01020005
001162 ENVIRONMENT DIVISION.                                            01030005
001163*----------------------------------------------------------       01040005
001164 CONFIGURATION SECTION.                                           01050005
001165 SOURCE-COMPUTER. IBM-3090.                                       01060005
001166 OBJECT-COMPUTER. IBM-3090.                                       01070005
001167                                                                  01080005
001168 INPUT-OUTPUT SECTION.                                            01090005
001169                                                                  01100005
001170 FILE-CONTROL.                                                    01110005
001180                                                                  01120005
001190*----------------------------------------------------------       01130000
001200 DATA DIVISION.                                                   01140000
001300*----------------------------------------------------------       01150000
001400 FILE SECTION.                                                    01160000
001500                                                                  01170000
001600                                                                  01180000
001700*---------------------------------------------------------        01190000
001800                                                                  01200000
001900 WORKING-STORAGE SECTION.                                         01210000
002000*---------------------------------------------------------        01220000
002100* PC- PROGRAM CONSTANTS                                           01230000
002200*----------------------------------------------------------       01240000
002300 01  PC-PROGRAM-CONSTANTS.                                        01250000
002400     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'XSKUP035'. 01260000
002500     05  PC-MAX-RETRIES               PIC S9(04) VALUE +5 COMP.   01270000
002600                                                                  01280000
002700*----------------------------------------------------------       01290000
002800* PS- PROGRAM SWITCHES                                            01300000
002900*----------------------------------------------------------       01310000
003000 01  PS-PROGRAM-SWITCHES.                                         01320000
003100     05  PS-PROCESS-CONTINUE-SW       PIC X(01)  VALUE 'Y'.       01330000
003200         88  PS-PROCESS-CONTINUE                 VALUE 'Y'.       01340000
003300         88  PS-PROCESS-COMPLETE                 VALUE 'N'.       01350000
003310     05  PS-PRICE-CONTINUE-SW         PIC X(01)  VALUE 'Y'.       01360000
003320         88  PS-PRICE-CONTINUE                   VALUE 'Y'.       01370000
003330         88  PS-PRICE-COMPLETE                   VALUE 'N'.       01380000
003340     05  PS-NOT-READY-TBL-SW          PIC X(01)  VALUE 'Y'.       01390000
003350         88  PS-NOT-READY-TBL                    VALUE 'Y'.       01400000
003360         88  PS-READY-FOR-TBL                    VALUE 'N'.       01410000
003400                                                                  01420000
003500*----------------------------------------------------------       01430000
003600* PV- PROGRAM VARIABLES                                           01440000
003700*----------------------------------------------------------       01450000
003800 01 PV-PROGRAM-VARIABLES.                                         01460000
003900    05  PV-SQL-SUB                    PIC S9(4)  VALUE +0 COMP.   01470000
004000    05  PV-MAX-OFFSET-DTE             PIC 9(08)  VALUE 0.         01480000
004010    05  PV-SQL-CODE                   PIC S9(4)  VALUE +0.        01490000
004020    05  PV-STRT-DTE                   PIC X(10)  VALUE SPACES.    01500000
004030    05  PV-LAST-UPD-TMST              PIC X(26)  VALUE SPACES.    01510000
004031    05  PV-ACT-STRT-TMST              PIC X(26)  VALUE SPACES.    01520000
004040    05  PV-DB2-PROMO-INTFC-ID         PIC S9(10)V VALUE +0 COMP-3.01530000
004041    05  PV-DB2-MDSE-LNE-ID            PIC S9(10)V VALUE +0 COMP-3.01540000
004042    05  PV-DB2-INTFC-SUB-ID           PIC S9(10)V VALUE +0 COMP-3.01550000
004043    05  PV-DISC-PRCG-AMT              PIC S9(07)V9(03) VALUE +0.  01560000
004044    05  PV-DB2-SUB-ID-TEST            PIC S9(10)V VALUE +0 COMP-3.01570000
004045    05  PV-ACTION-CODE                PIC X(01).                  01580000
004050        88  PV-INSERT-DATA                       VALUE 'I'.       01590000
004060        88  PV-UPDATE-DATA                       VALUE 'U'.       01600000
004061        88  PV-BYPASS-MERCH-TBL                  VALUE 'B'.       01610000
004070    05  PV-LD-STATUS-CDE              PIC X(02).                  01620000
004080        88  PV-NO-ERROR                          VALUE '00'.      01630000
004090        88  PV-CRITICAL-ERROR                    VALUE '01'.      01640000
004100        88  PV-NOT-CRITICAL-ERROR                VALUE '02'.      01650000
004200    05  PV-PGM-STATUS-CDE             PIC X(02).                  01660000
004210        88  PV-SUCCESS-CDE                       VALUE '00'.      01670000
004220        88  PV-UPDATE-NEED                       VALUE '01'.      01680000
004230        88  PV-UPDATE-NOT-NEED                   VALUE '02'.      01690000
004240        88  PV-ADD-CDE                           VALUE '03'.      01700000
004241        88  PV-UPDATE-BYPASS                     VALUE '04'.      01710000
004250        88  PV-NO-SUCCESS-CDE                    VALUE '05'.      01720000
004260        88  PV-UNEXPECT-CDE                      VALUE '06'.      01730000
004270                                                                  01740000
004271    05  PV-COMPARISONS.                                           01750000
004273        10  PV-CMP-THRS-AMT           PIC 9(07).9(02) VALUE ZERO. 01760000
004274        10  PV-CMP-DISC-AMT           PIC 9(07).9(02) VALUE ZERO. 01770000
004275        10  PV-CMP-DISC-PCT           PIC 9(03).9(03) VALUE ZERO. 01780000
004276                                                                  01790000
004277    05  PV-MERCH-NULLS-INDICATORS.                                01800000
004278        10  PV-ADV-CDE-IND            PIC S9(4) COMP VALUE +0.    01810000
004279        10  PV-PROMO-ITM-ID-IND       PIC S9(4) COMP VALUE +0.    01820000
004280        10  PV-DEPT-NBR-IND           PIC S9(4) COMP VALUE +0.    01830000
004281        10  PV-MAJ-CL-NBR-IND         PIC S9(4) COMP VALUE +0.    01840000
004282        10  PV-SUB-CL-NBR-IND         PIC S9(4) COMP VALUE +0.    01850000
004283        10  PV-STYL-ID-IND            PIC S9(4) COMP VALUE +0.    01860000
004284        10  PV-SKU-NBR-IND            PIC S9(4) COMP VALUE +0.    01870000
004285        10  PV-CLRNC-TYP-CDE-IND      PIC S9(4) COMP VALUE +0.    01880000
004286        10  PV-RCPT-CMMT-TXT-IND      PIC S9(4) COMP VALUE +0.    01890000
004287        10  PV-ESL-TOPR-IND           PIC S9(4) COMP VALUE +0.    01900000
004288                                                                  01910000
004289    05  PV-SMP-NULLS-INDICATORS.                                  01920000
004290        10  PV-ASSN-LVL-CDE-IND       PIC S9(4) COMP VALUE +0.    01930000
004291        10  PV-GP-QTY-IND             PIC S9(4) COMP VALUE +0.    01940000
004292                                                                  01950000
004293    05  PV-TIER-NULLS-INDICATORS.                                 01960000
004294        10  PV-THRS-QTY-IND           PIC S9(4) COMP VALUE +0.    01970000
004295        10  PV-THRS-AMT-IND           PIC S9(4) COMP VALUE +0.    01980000
004296        10  PV-DISC-AMT-IND           PIC S9(4) COMP VALUE +0.    01990000
004297        10  PV-DISC-PCT-IND           PIC S9(4) COMP VALUE +0.    02000000
004298                                                                  02010000
004299    05  PV-PRICG-TBL-NEEDED           PIC X(03).                  02020000
004300        88  PV-SIMPLE-PRICE                      VALUES 'SPO',    02030000
004301                                          'SRP', 'SPP', 'SAO',    02040000
004310                                          'CPO', 'CPP', 'CAO',    02050000
004320                                          'GAO', 'GPO', 'APO',    02060000
004321                                          'AAO', 'MPP', 'GBG',    02070000
W26114                                          'GBD', 'GBP',           02080000
062110                                          'GBL', 'RBO'.           02090006
004323        88  PV-BWP-BUY-PRICE                     VALUES 'GBQ',    02100002
004324                                          'GBA', 'PBQ', 'PBA'.    02110002
004325        88  PV-TIERED-PRICE                      VALUES 'TAP',    02120000
004326                                          'TAA', 'TQP', 'TQA'.    02130000
004327                                                                  02140000
004328    05  PV-STAT-CODE                  PIC X(01).                  02150000
004329        88  PV-SCHEDULED                         VALUE 'S'.       02160000
004330        88  PV-CANCELED                          VALUE 'C'.       02170000
004331        88  PV-DELETED                           VALUE 'D'.       02180000
004332                                                                  02190000
004333    05  PV-PROMO-STRT-DTE-TM.                                     02200000
004334        10  PV-PROMO-STRT-DTE.                                    02210000
004335            15  PV-PROMO-DTE-TM-CCYY      PIC X(04).              02220000
004336            15  FILLER                    PIC X(01).              02230000
004337            15  PV-PROMO-DTE-TM-MM        PIC X(02).              02240000
004338            15  FILLER                    PIC X(01).              02250000
004339            15  PV-PROMO-DTE-TM-DD        PIC X(02).              02260000
004340        10  PV-PROMO-STRT-TM              PIC X(16).              02270000
004341                                                                  02280000
004342    05  PV-PRICE-STRT-DTE-NBR.                                    02290000
004343        10  PV-PRICE-DTE-CCYY             PIC 9(04).              02300000
004344        10  PV-PRICE-DTE-MM               PIC 9(02).              02310000
004345        10  PV-PRICE-DTE-DD               PIC 9(02).              02320000
004346                                                                  02330000
004350    05  PV-PRICE-STRT-DTE.                                        02340000
004360        15  PV-PRICE-DTE-CH-CCYY          PIC X(04).              02350000
004370        15  FILLER                        PIC X(01).              02360000
004380        15  PV-PRICE-DTE-CH-MM            PIC X(02).              02370000
004390        15  FILLER                        PIC X(01).              02380000
004400        15  PV-PRICE-DTE-CH-DD            PIC X(02).              02390000
004500                                                                  02400000
004600*----------------------------------------------------------       02410000
004700* PRICING BUSINESS EVENT RECORD LAYOUT                            02420000
004800*----------------------------------------------------------       02430000
004900     COPY XSRD019.                                                02440000
005000                                                                  02450000
005600*----------------------------------------------------------       02460000
005700* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         02470000
005800*----------------------------------------------------------       02480000
005900     COPY DPWS004.                                                02490000
006000                                                                  02500000
006100*---------------------------------------------                    02510000
006200*  DB2 COMMUNICATION AREA.                                        02520000
006300*---------------------------------------------                    02530000
006400     EXEC SQL                                                     02540000
006500          INCLUDE SQLCA                                           02550000
006600     END-EXEC.                                                    02560000
006700                                                                  02570000
006800*---------------------------------------------                    02580000
006900*  DB2 TABLE XST00026(XST_PROMO) - PROMOTION TABLE                02590000
007000*---------------------------------------------                    02600000
007100     EXEC SQL                                                     02610000
007200          INCLUDE XST00026                                        02620000
007300     END-EXEC.                                                    02630000
007400                                                                  02640000
007500*---------------------------------------------                    02650000
007600*  DB2 TABLE XST00028(XST_MDSE_LNE_SELN) -                        02660000
007700*---------------------------------------------                    02670000
007800     EXEC SQL                                                     02680000
007900          INCLUDE XST00028                                        02690000
008000     END-EXEC.                                                    02700000
008100                                                                  02710000
008200*---------------------------------------------                    02720000
008300*  DB2 TABLE XST00030(XST_SMP_PRICG) - SIMPLE PRICING TABLE       02730000
008400*---------------------------------------------                    02740000
008500     EXEC SQL                                                     02750000
008600          INCLUDE XST00030                                        02760000
008700     END-EXEC.                                                    02770000
008800                                                                  02780000
008900*---------------------------------------------                    02790000
009000*  DB2 TABLE XST00035(XST_TIER_PRICG) - TIERED PRICING TABLE      02800000
009100*---------------------------------------------                    02810000
009110     EXEC SQL                                                     02820000
009120          INCLUDE XST00035                                        02830000
009130     END-EXEC.                                                    02840000
009140                                                                  02850000
009148*                                                                 02860005
009149*-----------------------------------------------------------      02870000
009150* TIERED-CURSOR WILL FIND ANY TIERED RECORDS OUT ON THE           02880000
009151* DATABASE THAT CORRESPOND TO A CERTAIN PROMO INTERFACE ID        02890000
009152* AND MERCHANDISE LINE ID.                                        02900000
009153*-----------------------------------------------------------      02910000
009154     EXEC SQL                                                     02920000
009155       DECLARE TIERED-CURSOR CURSOR FOR                           02930000
009156            SELECT  PROMO_INTFC_SUB_ID                            02940000
009160              FROM  XST_TIER_PRICG                                02950000
009161             WHERE  PROMO_INTFC_ID  = :PV-DB2-PROMO-INTFC-ID      02960000
009162               AND  MDSE_LNE_ID     = :PV-DB2-MDSE-LNE-ID         02970000
009163               AND  STAT_CDE        = 'S'                         02980000
009164               AND  PROMO_INTFC_SUB_ID                            02990000
009165                                   <> :PV-DB2-INTFC-SUB-ID        03000000
009166           WITH UR                                                03010000
009167     END-EXEC.                                                    03020000
009168                                                                  03030000
009169 LINKAGE SECTION.                                                 03040000
009170                                                                  03050000
009171*----------------------------------------------------------       03060000
009180* FILE INFORMATION BEING PASSED TO AND FROM THIS MODULE.          03070000
009190*----------------------------------------------------------       03080000
009200 01 LV-LINKAGE-VARIABLES.                                         03090000
009300    05  LV-PRICE-BUS-REC           PIC X(300).                    03100000
009400    05  LV-MAX-OFFSET-DTE          PIC X(08).                     03110000
009500    05  LV-LD-SQL-RETURN-CDE       PIC S9(4).                     03120000
009600    05  LV-PGM-STATUS-CDE          PIC X(02).                     03130000
009700    05  LV-LD-SEVERITY-LVL         PIC X(02).                     03140000
009800                                                                  03150000
009900                                                                  03160000
010000*----------------------------------------------------------       03170000
010100 PROCEDURE DIVISION USING LV-LINKAGE-VARIABLES.                   03180000
010200*----------------------------------------------------------       03190000
010300 0000-MAINLINE.                                                   03200000
010400                                                                  03210000
010500     PERFORM 1000-INITIALIZATION.                                 03220000
010600                                                                  03230000
010700     PERFORM 2000-PROCESS-MESSAGE                                 03240000
010800             UNTIL PS-PROCESS-COMPLETE.                           03250000
010900                                                                  03260000
011000     PERFORM 9999-WRAPUP.                                         03270000
011100                                                                  03280000
011200     EXIT PROGRAM.                                                03290000
011300                                                                  03300000
011400*0000-EXIT.                                                       03310000
011500 EJECT.                                                           03320000
011600                                                                  03330000
011700*----------------------------------------------------------       03340000
011800* 1000-INITIALIZATION.                                            03350000
011900*     INTIALIZES OR MOVES ANY VARIABLES BEFORE IT WILL            03360000
012000*     UPDATE OR INSERT A RECORD.                                  03370000
012100*----------------------------------------------------------       03380000
012200 1000-INITIALIZATION.                                             03390000
012300                                                                  03400000
012400     INITIALIZE DCLXST00028.                                      03410000
012500     INITIALIZE DCLXST00030.                                      03420000
 12600     INITIALIZE DCLXST00035.                                      03430006
012700     INITIALIZE PV-SQL-CODE                                       03440000
012710                PV-MERCH-NULLS-INDICATORS.                        03450000
012800     MOVE LV-PRICE-BUS-REC     TO XS019-PRICING-RECORD.           03460000
012900     MOVE XS019-ACTION-CDE     TO PV-ACTION-CODE.                 03470000
013000     MOVE XS019-PRICG-TYP-CDE  TO PV-PRICG-TBL-NEEDED.            03480000
013100     MOVE XS019-STAT-CDE       TO PV-STAT-CODE.                   03490000
013600     SET PV-NO-ERROR           TO TRUE.                           03500000
013700     SET PV-SUCCESS-CDE        TO TRUE.                           03510000
013800     SET PS-PROCESS-CONTINUE   TO TRUE.                           03520000
013810     SET PS-PRICE-CONTINUE     TO TRUE.                           03530000
013820     SET PS-NOT-READY-TBL      TO TRUE.                           03540000
013900                                                                  03550000
014000     IF LV-MAX-OFFSET-DTE = SPACES                                03560000
014100        INITIALIZE PV-MAX-OFFSET-DTE                              03570000
014200     ELSE                                                         03580000
014300        MOVE LV-MAX-OFFSET-DTE    TO PV-MAX-OFFSET-DTE            03590000
014400     END-IF.                                                      03600000
014500                                                                  03610000
014600     IF PV-SIMPLE-PRICE OR PV-BWP-BUY-PRICE OR PV-TIERED-PRICE    03620000
014610        IF PV-TIERED-PRICE AND (PV-CANCELED OR PV-DELETED)        03630000
014611           MOVE XS019-PROMO-INTFC-ID  TO PV-DB2-PROMO-INTFC-ID    03640003
014612           MOVE XS019-MDSE-LNE-ID     TO PV-DB2-MDSE-LNE-ID       03650003
014613           MOVE XS019-PROMO-INTFC-SUB-ID TO PV-DB2-INTFC-SUB-ID   03660003
014620           PERFORM 1100-OPEN-TIERED-CURSOR                        03670000
014630           PERFORM 1200-FETCH-TIERED-CURSOR                       03680000
014640           PERFORM 1300-CLOSE-TIERED-CURSOR                       03690000
014650        ELSE                                                      03700000
014700           PERFORM 1400-POPULATE-DCLGEN                           03710000
014701        END-IF                                                    03720000
014710     ELSE                                                         03730000
014720        SET PS-PROCESS-COMPLETE TO TRUE                           03740000
014730        SET PV-UNEXPECT-CDE     TO TRUE                           03750000
014740        PERFORM 9000-LOAD-SEVERITY-ERROR                          03760000
014750     END-IF.                                                      03770000
014760                                                                  03780000
015000*1000-EXIT.                                                       03790000
015100 EJECT.                                                           03800000
015200                                                                  03810000
016454*----------------------------------------------------------       03820000
016455* 1100-OPEN-TIERED-CURSOR.                                        03830000
016456*     OPEN THE TIERED SCHDULED RECORDS CURSOR.                    03840000
016457*----------------------------------------------------------       03850000
016458 1100-OPEN-TIERED-CURSOR.                                         03860000
016459                                                                  03870000
016460     PERFORM                                                      03880000
016461         WITH TEST AFTER                                          03890000
016462         VARYING PV-SQL-SUB                                       03900000
016463         FROM 1 BY 1                                              03910000
016464         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 03920000
016465                   OR  SQLCODE NOT = -904 AND -911 AND -913)      03930000
016466                                                                  03940000
016467           EXEC SQL                                               03950000
016468              OPEN TIERED-CURSOR                                  03960000
016469           END-EXEC                                               03970000
016470                                                                  03980000
016471         MOVE SQLCODE TO PV-SQL-CODE                              03990000
016472                                                                  04000000
016473         EVALUATE TRUE                                            04010000
016474             WHEN SQLCODE = -904                                  04020000
016475             WHEN SQLCODE = -911                                  04030000
016476             WHEN SQLCODE = -913                                  04040000
016477             WHEN SQLCODE = 0                                     04050000
016478                  CONTINUE                                        04060000
016479             WHEN SQLWARN0 NOT EQUAL SPACE                        04070000
016480             WHEN SQLCODE NOT EQUAL ZERO                          04080000
016483                  SET PS-PROCESS-COMPLETE TO TRUE                 04090000
016484                  SET PV-NO-SUCCESS-CDE TO TRUE                   04100000
016485                  PERFORM 9000-LOAD-SEVERITY-ERROR                04110000
016486         END-EVALUATE                                             04120000
016487     END-PERFORM.                                                 04130000
016488                                                                  04140000
016489     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         04150000
016493        SET PS-PROCESS-COMPLETE TO TRUE                           04160000
016494        SET PV-NO-SUCCESS-CDE TO TRUE                             04170000
016495        PERFORM 9000-LOAD-SEVERITY-ERROR                          04180000
016496     END-IF.                                                      04190000
016497                                                                  04200000
016498*1100-EXIT.                                                       04210000
016499 EJECT.                                                           04220000
016500                                                                  04230000
016501*----------------------------------------------------------       04240000
016502* 1200-FETCH-TIERED-CURSOR.                                       04250000
016503*     FETCH THE TIERED SCHDULED RECORDS CURSOR.                   04260000
016504*----------------------------------------------------------       04270000
016505 1200-FETCH-TIERED-CURSOR.                                        04280000
016506                                                                  04290000
016507     PERFORM                                                      04300000
016508         WITH TEST AFTER                                          04310000
016509         VARYING PV-SQL-SUB                                       04320000
016510         FROM 1 BY 1                                              04330000
016511         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 04340000
016512                   OR  SQLCODE NOT = -904 AND -911 AND -913)      04350000
016513                                                                  04360000
016514           EXEC SQL                                               04370000
016515              FETCH TIERED-CURSOR                                 04380000
016516              INTO  :PV-DB2-SUB-ID-TEST                           04390000
016517           END-EXEC                                               04400000
016518                                                                  04410000
016519          MOVE SQLCODE TO PV-SQL-CODE                             04420000
016520                                                                  04430000
016521          EVALUATE TRUE                                           04440000
016522             WHEN SQLCODE = -904                                  04450000
016523             WHEN SQLCODE = -911                                  04460000
016524             WHEN SQLCODE = -913                                  04470000
016525                  CONTINUE                                        04480000
016526             WHEN SQLCODE = ZERO                                  04490000
016527                  SET PV-BYPASS-MERCH-TBL TO TRUE                 04500000
016528             WHEN SQLCODE = +100                                  04510000
016529                  PERFORM 1400-POPULATE-DCLGEN                    04520000
016530             WHEN SQLWARN0 NOT EQUAL SPACE                        04530000
016531             WHEN SQLCODE NOT EQUAL ZERO                          04540000
016534                  SET PS-PROCESS-COMPLETE TO TRUE                 04550000
016535                  SET PV-NO-SUCCESS-CDE TO TRUE                   04560000
016536                  PERFORM 9000-LOAD-SEVERITY-ERROR                04570000
016537          END-EVALUATE                                            04580000
016538     END-PERFORM.                                                 04590000
016539                                                                  04600000
016540     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         04610000
016544        SET PS-PROCESS-COMPLETE TO TRUE                           04620000
016545        SET PV-NO-SUCCESS-CDE TO TRUE                             04630000
016546        PERFORM 9000-LOAD-SEVERITY-ERROR                          04640000
016547     END-IF.                                                      04650000
016548                                                                  04660000
016549*1200-EXIT.                                                       04670000
016550 EJECT.                                                           04680000
016551                                                                  04690000
016552*-----------------------------------------------------------      04700000
016553* 1300-CLOSE-TIERED-CURSOR.                                       04710000
016554*     CLOSE THE TIERED SCHDULED RECORDS CURSOR.                   04720000
016555*-----------------------------------------------------------      04730000
016556 1300-CLOSE-TIERED-CURSOR.                                        04740000
016557                                                                  04750000
016558     PERFORM                                                      04760000
016559         WITH TEST AFTER                                          04770000
016560         VARYING PV-SQL-SUB                                       04780000
016561         FROM 1 BY 1                                              04790000
016562         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 04800000
016563                   OR  SQLCODE NOT = -904 AND -911 AND -913)      04810000
016564                                                                  04820000
016565           EXEC SQL                                               04830000
016566              CLOSE TIERED-CURSOR                                 04840000
016567           END-EXEC                                               04850000
016568                                                                  04860000
016569          MOVE SQLCODE TO PV-SQL-CODE                             04870000
016570                                                                  04880000
016571          EVALUATE TRUE                                           04890000
016572             WHEN SQLCODE = -904                                  04900000
016573             WHEN SQLCODE = -911                                  04910000
016574             WHEN SQLCODE = -913                                  04920000
016575             WHEN SQLCODE = 0                                     04930000
016576                  CONTINUE                                        04940000
016577             WHEN SQLWARN0 NOT EQUAL SPACE                        04950000
016578             WHEN SQLCODE NOT EQUAL ZERO                          04960000
016581                  SET PS-PROCESS-COMPLETE TO TRUE                 04970000
016582                  SET PV-NO-SUCCESS-CDE TO TRUE                   04980000
016583                  PERFORM 9000-LOAD-SEVERITY-ERROR                04990000
016584          END-EVALUATE                                            05000000
016585     END-PERFORM.                                                 05010000
016586                                                                  05020000
016587     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         05030000
016591        SET PS-PROCESS-COMPLETE TO TRUE                           05040000
016592        SET PV-NO-SUCCESS-CDE TO TRUE                             05050000
016593        PERFORM 9000-LOAD-SEVERITY-ERROR                          05060000
016594     END-IF.                                                      05070000
016595                                                                  05080000
016596*1300-EXIT.                                                       05090000
016597 EJECT.                                                           05100000
016598                                                                  05110000
016599*----------------------------------------------------------       05120000
016600* 1400-POPULATE-DCLGEN.                                           05130000
016601*     POPULATES THE MERCHANDISE LINE TABLE VARIABLES.             05140000
016603*----------------------------------------------------------       05150000
016604 1400-POPULATE-DCLGEN.                                            05160000
016605                                                                  05170000
016606     MOVE XS019-PROMO-INTFC-ID   TO XST00028-PROMO-INTFC-ID.      05180000
016607     MOVE XS019-MDSE-LNE-ID      TO XST00028-MDSE-LNE-ID.         05190000
016608     MOVE XS019-PROMO-ID         TO XST00028-PROMO-ID.            05200000
016609     MOVE XS019-MDSE-HIER-CDE    TO XST00028-MDSE-HIER-CDE.       05210000
016610     MOVE XS019-STAT-CDE         TO XST00028-STAT-CDE.            05220000
016611     MOVE XS019-PRICG-TYP-CDE    TO XST00028-PRICG-TYP-CDE.       05230000
016612     MOVE XS019-LAST-UPD-TMST    TO XST00028-SOR-LAST-UPD-TMST.   05240000
016613                                                                  05250000
016614     IF XS019-ADV-IND = SPACES                                    05260000
016615        MOVE -1                  TO PV-ADV-CDE-IND                05270000
016616     ELSE                                                         05280000
016617        MOVE XS019-ADV-IND       TO XST00028-ADV-CDE              05290000
016618     END-IF.                                                      05300000
016619                                                                  05310000
016620     IF XS019-PROMO-ITM-ID = ZEROES                               05320000
016621        MOVE -1                  TO PV-PROMO-ITM-ID-IND           05330000
016622     ELSE                                                         05340000
016623        MOVE XS019-PROMO-ITM-ID  TO XST00028-PROMO-ITM-ID         05350000
016624     END-IF.                                                      05360000
016625                                                                  05370000
016626     IF XS019-DEPT-NBR = ZEROES                                   05380000
016627        MOVE -1                  TO PV-DEPT-NBR-IND               05390000
016628     ELSE                                                         05400000
016629        MOVE XS019-DEPT-NBR      TO XST00028-DEPT-NBR             05410000
016630     END-IF.                                                      05420000
016631                                                                  05430000
016632     IF XS019-MAJ-CL-NBR = ZEROES                                 05440000
016633        MOVE -1                  TO PV-MAJ-CL-NBR-IND             05450000
016634     ELSE                                                         05460000
016635        MOVE XS019-MAJ-CL-NBR    TO XST00028-MAJ-CL-NBR           05470000
016636     END-IF.                                                      05480000
016637                                                                  05490000
016638     IF XS019-SUB-CL-NBR = ZEROES                                 05500000
016639        MOVE -1                  TO PV-SUB-CL-NBR-IND             05510000
016640     ELSE                                                         05520000
016641        MOVE XS019-SUB-CL-NBR    TO XST00028-SUB-CL-NBR           05530000
016642     END-IF.                                                      05540000
016643                                                                  05550000
016644     IF XS019-STYLE-ID = ZEROES                                   05560000
016645        MOVE -1                  TO PV-STYL-ID-IND                05570000
016646     ELSE                                                         05580000
016647        MOVE XS019-STYLE-ID      TO XST00028-STYL-ID              05590000
016648     END-IF.                                                      05600000
016649                                                                  05610000
016650     IF XS019-SKU-NBR = ZEROES                                    05620000
016651        MOVE -1                  TO PV-SKU-NBR-IND                05630000
016652     ELSE                                                         05640000
016653        MOVE XS019-SKU-NBR       TO XST00028-SKU-NBR              05650000
016654     END-IF.                                                      05660000
016655                                                                  05670000
016656     IF XS019-CLRNC-TYP-CDE = SPACE                               05680000
016657        MOVE -1                  TO PV-CLRNC-TYP-CDE-IND          05690000
016658     ELSE                                                         05700000
016659        MOVE XS019-CLRNC-TYP-CDE TO XST00028-TKT-CLOR-CDE         05710000
016660     END-IF.                                                      05720000
016661                                                                  05730000
016662     IF XS019-RCPT-CMMT-TXT = SPACES                              05740000
016663        MOVE -1                  TO PV-RCPT-CMMT-TXT-IND          05750000
016664     ELSE                                                         05760000
016665        MOVE XS019-RCPT-CMMT-TXT TO XST00028-RCPT-CMMT-TXT        05770000
016666     END-IF.                                                      05780000
016667                                                                  05790000
016668     IF XS019-ESL-TOPR-TYP = SPACES                               05800000
016669        MOVE -1                  TO PV-ESL-TOPR-IND               05810000
016670     ELSE                                                         05820000
016671        MOVE XS019-ESL-TOPR-TYP  TO XST00028-ESL-TOPR-TYP-CDE     05830000
016672     END-IF.                                                      05840000
016673                                                                  05850000
016674*1400-EXIT.                                                       05860000
016675 EJECT.                                                           05870000
016676                                                                  05880000
016677*----------------------------------------------------------       05890000
016678* 2000-PROCESS-MESSAGE.                                           05900000
016679*     THIS CHECKS THE ACTION TO SEE WHETHER THE RECORD            05910000
016680*     SHOULD BE INSERTED INTO THE PRICING TABLE OR UPDATED.       05920000
016690*     IF SOMETHING IS WRONG WITH THE ACTION CODE IT WILL          05930000
016700*     PROCESS AN ERROR AND EXIT THE PROGRAM.                      05940000
016800*----------------------------------------------------------       05950000
016900 2000-PROCESS-MESSAGE.                                            05960000
017000                                                                  05970000
017100     EVALUATE TRUE                                                05980000
017200        WHEN PV-INSERT-DATA                                       05990000
017300             PERFORM 2100-INSERT-DATA                             06000000
017400             IF PS-READY-FOR-TBL                                  06010000
017500                PERFORM 2300-CHECK-TBL-TYP                        06020000
017600             END-IF                                               06030000
017700        WHEN PV-UPDATE-DATA                                       06040000
017800             PERFORM 2200-UPDATE-DATA                             06050000
017900             IF PS-READY-FOR-TBL                                  06060000
018000                PERFORM 2300-CHECK-TBL-TYP                        06070000
018100             END-IF                                               06080000
018110        WHEN PV-BYPASS-MERCH-TBL                                  06090000
018111             SET PS-PROCESS-COMPLETE TO TRUE                      06100000
018120             PERFORM 2300-CHECK-TBL-TYP                           06110000
018200        WHEN OTHER                                                06120000
018300             SET PS-PROCESS-COMPLETE TO TRUE                      06130000
018400             SET PV-UNEXPECT-CDE     TO TRUE                      06140000
018500             PERFORM 9000-LOAD-SEVERITY-ERROR                     06150000
018600     END-EVALUATE.                                                06160000
018700                                                                  06170000
018800*2000-EXIT.                                                       06180000
018900 EJECT.                                                           06190000
019000                                                                  06200000
019100*------------------------------------------------------           06210000
019200* 2100-INSERT-DATA.                                               06220000
019300*     INSERT THE PRICING RECORD.                                  06230000
019400*------------------------------------------------------           06240000
019500 2100-INSERT-DATA.                                                06250000
019600                                                                  06260000
019700     PERFORM                                                      06270000
019800         WITH TEST AFTER                                          06280000
019900         VARYING PV-SQL-SUB                                       06290000
020000         FROM 1 BY 1                                              06300000
020100         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 06310000
020300                   OR  SQLCODE NOT = -904 AND -911 AND -913)      06320000
020500                                                                  06330000
020600         EXEC SQL                                                 06340000
020700             INSERT INTO XST_MDSE_LNE_SELN                        06350000
020800                                      (PROMO_INTFC_ID             06360000
020900                                      ,MDSE_LNE_ID                06370000
021000                                      ,PROMO_ITM_ID               06380000
021100                                      ,PROMO_ID                   06390000
021120                                      ,DEPT_NBR                   06400000
021130                                      ,MAJ_CL_NBR                 06410000
021140                                      ,SUB_CL_NBR                 06420000
021150                                      ,STYL_ID                    06430000
021160                                      ,SKU_NBR                    06440000
021170                                      ,MDSE_HIER_CDE              06450000
021180                                      ,STAT_CDE                   06460000
021190                                      ,TKT_CLOR_CDE               06470000
021191                                      ,RCPT_CMMT_TXT              06480000
021192                                      ,PRICG_TYP_CDE              06490000
021193                                      ,ADV_CDE                    06500000
021194                                      ,ESL_TOPR_TYP_CDE           06510000
021195                                      ,LAST_UPD_TMST              06520000
021196                                      ,SOR_LAST_UPD_TMST)         06530000
021197             VALUES                                               06540000
021198                (:XST00028-PROMO-INTFC-ID                         06550000
021199                ,:XST00028-MDSE-LNE-ID                            06560000
021200                ,:XST00028-PROMO-ITM-ID :PV-PROMO-ITM-ID-IND      06570000
021201                ,:XST00028-PROMO-ID                               06580000
021210                ,:XST00028-DEPT-NBR :PV-DEPT-NBR-IND              06590000
021300                ,:XST00028-MAJ-CL-NBR :PV-MAJ-CL-NBR-IND          06600000
021400                ,:XST00028-SUB-CL-NBR :PV-SUB-CL-NBR-IND          06610000
021500                ,:XST00028-STYL-ID :PV-STYL-ID-IND                06620000
021600                ,:XST00028-SKU-NBR :PV-SKU-NBR-IND                06630000
021610                ,:XST00028-MDSE-HIER-CDE                          06640000
021620                ,:XST00028-STAT-CDE                               06650000
021630                ,:XST00028-TKT-CLOR-CDE :PV-CLRNC-TYP-CDE-IND     06660000
021640                ,:XST00028-RCPT-CMMT-TXT :PV-RCPT-CMMT-TXT-IND    06670000
021650                ,:XST00028-PRICG-TYP-CDE                          06680000
021651                ,:XST00028-ADV-CDE:PV-ADV-CDE-IND                 06690000
021652                ,:XST00028-ESL-TOPR-TYP-CDE :PV-ESL-TOPR-IND      06700000
021660                ,CURRENT TIMESTAMP                                06710000
021661                ,:XST00028-SOR-LAST-UPD-TMST)                     06720000
021670         END-EXEC                                                 06730000
021680                                                                  06740000
021681         MOVE SQLCODE TO PV-SQL-CODE                              06750000
021682                                                                  06760000
021690         EVALUATE TRUE                                            06770000
021700             WHEN SQLCODE = -904                                  06780000
021800             WHEN SQLCODE = -911                                  06790000
021900             WHEN SQLCODE = -913                                  06800000
022000                  CONTINUE                                        06810000
022100             WHEN SQLCODE = 0                                     06820000
022200                  SET PS-PROCESS-COMPLETE TO TRUE                 06830000
022300                  SET PS-READY-FOR-TBL TO TRUE                    06840000
022400             WHEN SQLCODE = -803                                  06850000
022500                  PERFORM 2250-SELECT-DATA                        06860000
022510                  MOVE -803 TO SQLCODE                            06870000
022600             WHEN OTHER                                           06880000
022700                  SET PS-PROCESS-COMPLETE TO TRUE                 06890000
022800                  SET PV-NO-SUCCESS-CDE TO TRUE                   06900000
022900                  SET PS-NOT-READY-TBL TO TRUE                    06910000
023000                  PERFORM 9000-LOAD-SEVERITY-ERROR                06920000
023010                  MOVE +0 TO SQLCODE                              06930000
023100         END-EVALUATE                                             06940000
023200     END-PERFORM.                                                 06950000
023500                                                                  06960000
023600     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         06970000
023700        SET PS-PROCESS-COMPLETE TO TRUE                           06980000
023800        SET PV-NO-SUCCESS-CDE TO TRUE                             06990000
023900        SET PS-NOT-READY-TBL TO TRUE                              07000000
024000        PERFORM 9000-LOAD-SEVERITY-ERROR                          07010000
024100     END-IF.                                                      07020000
024200                                                                  07030000
024300*2100-EXIT.                                                       07040000
024400 EJECT.                                                           07050000
024500                                                                  07060000
030700*------------------------------------------------------           07070000
030800* 2200-UPDATE-DATA.                                               07080000
030900*     UPDATE THE PRICING RECORD.                                  07090000
C52736*                                                                 07100008
C52736*  -- REMOVED SETTING OF PRIMARY KEY FIELDS                       07110008
031000*------------------------------------------------------           07120000
031100 2200-UPDATE-DATA.                                                07130000
031200                                                                  07140000
031300     PERFORM                                                      07150000
031400         WITH TEST AFTER                                          07160000
031500         VARYING PV-SQL-SUB                                       07170000
031600         FROM 1 BY 1                                              07180000
031700         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 07190000
031710                   OR  SQLCODE NOT = -904 AND -911 AND -913)      07200000
032100                                                                  07210000
032200         EXEC SQL                                                 07220000
032300             UPDATE XST_MDSE_LNE_SELN                             07230000
C52736             SET  PROMO_ITM_ID     = :XST00028-PROMO-ITM-ID       07240007
032610                                       :PV-PROMO-ITM-ID-IND,      07250000
032700                  PROMO_ID         = :XST00028-PROMO-ID,          07260000
032900                  DEPT_NBR         = :XST00028-DEPT-NBR           07270000
032910                                       :PV-DEPT-NBR-IND,          07280000
033000                  MAJ_CL_NBR       = :XST00028-MAJ-CL-NBR         07290000
033010                                       :PV-MAJ-CL-NBR-IND,        07300000
033100                  SUB_CL_NBR       = :XST00028-SUB-CL-NBR         07310000
033110                                       :PV-SUB-CL-NBR-IND,        07320000
033200                  STYL_ID          = :XST00028-STYL-ID            07330000
033210                                       :PV-STYL-ID-IND,           07340000
033300                  SKU_NBR          = :XST00028-SKU-NBR            07350000
033301                                       :PV-SKU-NBR-IND,           07360000
033310                  MDSE_HIER_CDE    = :XST00028-MDSE-HIER-CDE,     07370000
033320                  STAT_CDE         = :XST00028-STAT-CDE,          07380000
033330                  TKT_CLOR_CDE     = :XST00028-TKT-CLOR-CDE       07390000
033331                                       :PV-CLRNC-TYP-CDE-IND,     07400000
033340                  RCPT_CMMT_TXT    = :XST00028-RCPT-CMMT-TXT      07410000
033341                                       :PV-RCPT-CMMT-TXT-IND,     07420000
033350                  PRICG_TYP_CDE    = :XST00028-PRICG-TYP-CDE,     07430000
033351                  ADV_CDE          = :XST00028-ADV-CDE            07440000
033352                                       :PV-ADV-CDE-IND,           07450000
033353                  ESL_TOPR_TYP_CDE = :XST00028-ESL-TOPR-TYP-CDE   07460000
033354                                       :PV-ESL-TOPR-IND,          07470000
033360                  LAST_UPD_TMST    = CURRENT TIMESTAMP,           07480000
033361                  SOR_LAST_UPD_TMST                               07490000
033362                                   = :XST00028-SOR-LAST-UPD-TMST  07500000
033370             WHERE PROMO_INTFC_ID  = :XST00028-PROMO-INTFC-ID     07510000
033380               AND MDSE_LNE_ID     = :XST00028-MDSE-LNE-ID        07520000
033381               AND SOR_LAST_UPD_TMST                              07530000
033382                                  <= :XST00028-SOR-LAST-UPD-TMST  07540000
033390         END-EXEC                                                 07550000
033400                                                                  07560000
033410         MOVE SQLCODE TO PV-SQL-CODE                              07570000
033420                                                                  07580000
033500         EVALUATE TRUE                                            07590000
033600             WHEN SQLCODE = -904                                  07600000
033700             WHEN SQLCODE = -911                                  07610000
033800             WHEN SQLCODE = -913                                  07620000
033900                  CONTINUE                                        07630000
034000             WHEN SQLCODE = 0                                     07640000
034100                  SET PS-PROCESS-COMPLETE TO TRUE                 07650000
034200                  SET PS-READY-FOR-TBL TO TRUE                    07660000
034300             WHEN SQLCODE = +100                                  07670000
034400                  PERFORM 2250-SELECT-DATA                        07680000
034500                  MOVE +100 TO SQLCODE                            07690000
034700             WHEN OTHER                                           07700000
034800                  SET PS-PROCESS-COMPLETE TO TRUE                 07710000
034900                  SET PV-NO-SUCCESS-CDE TO TRUE                   07720000
035000                  SET PS-NOT-READY-TBL TO TRUE                    07730000
035100                  PERFORM 9000-LOAD-SEVERITY-ERROR                07740000
035110                  MOVE +0 TO SQLCODE                              07750000
035200         END-EVALUATE                                             07760000
035300     END-PERFORM.                                                 07770000
035400                                                                  07780000
035700     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         07790000
035800        SET PS-PROCESS-COMPLETE TO TRUE                           07800000
035900        SET PV-NO-SUCCESS-CDE TO TRUE                             07810000
036000        SET PS-NOT-READY-TBL TO TRUE                              07820000
036100        PERFORM 9000-LOAD-SEVERITY-ERROR                          07830000
036200     END-IF.                                                      07840000
036300                                                                  07850000
036400*2200-EXIT.                                                       07860000
036500 EJECT.                                                           07870000
036600                                                                  07880000
036601*------------------------------------------------------           07890000
036602* 2250-SELECT-DATA.                                               07900000
036603*     SELECT THE TIMESTAMP IN THE PRICING RECORD.                 07910000
036604*------------------------------------------------------           07920000
036605 2250-SELECT-DATA.                                                07930000
036606                                                                  07940000
036607     PERFORM                                                      07950000
036608         WITH TEST AFTER                                          07960000
036609         VARYING PV-SQL-SUB                                       07970000
036610         FROM 1 BY 1                                              07980000
036611         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 07990000
036612                   OR  SQLCODE NOT = -904 AND -911 AND -913)      08000000
036613                                                                  08010000
036614         EXEC SQL                                                 08020000
036615             SELECT  SOR_LAST_UPD_TMST                            08030000
036616               INTO :PV-LAST-UPD-TMST                             08040000
036617               FROM  XST_MDSE_LNE_SELN                            08050000
036618              WHERE  PROMO_INTFC_ID = :XST00028-PROMO-INTFC-ID    08060000
036619                AND  MDSE_LNE_ID    = :XST00028-MDSE-LNE-ID       08070000
036620         END-EXEC                                                 08080000
036621                                                                  08090000
036622         MOVE SQLCODE TO PV-SQL-CODE                              08100000
036623                                                                  08110000
036624         EVALUATE TRUE                                            08120000
036625             WHEN SQLCODE = -904                                  08130000
036626             WHEN SQLCODE = -911                                  08140000
036627             WHEN SQLCODE = -913                                  08150000
036628                  CONTINUE                                        08160000
036629             WHEN SQLCODE = 0                                     08170000
036631                  IF PV-UPDATE-DATA                               08180000
036632                     SET PS-PROCESS-COMPLETE TO TRUE              08190000
036633                     SET PS-READY-FOR-TBL TO TRUE                 08200000
036634                  ELSE                                            08210000
036635                     PERFORM 2255-MERCH-TMST-COMPARE              08220000
036636                  END-IF                                          08230000
036637             WHEN SQLCODE = +100                                  08240000
036638                  SET PV-INSERT-DATA TO TRUE                      08250000
036639                  SET PS-NOT-READY-TBL TO TRUE                    08260000
036640             WHEN OTHER                                           08270000
036641                  SET PS-PROCESS-COMPLETE TO TRUE                 08280000
036642                  SET PV-NO-SUCCESS-CDE TO TRUE                   08290000
036643                  SET PS-NOT-READY-TBL TO TRUE                    08300000
036644                  PERFORM 9000-LOAD-SEVERITY-ERROR                08310000
036645                  MOVE +0 TO SQLCODE                              08320000
036646         END-EVALUATE                                             08330000
036647     END-PERFORM.                                                 08340000
036648                                                                  08350000
036649     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         08360000
036650        SET PS-PROCESS-COMPLETE TO TRUE                           08370000
036651        SET PV-NO-SUCCESS-CDE TO TRUE                             08380000
036652        SET PS-NOT-READY-TBL TO TRUE                              08390000
036653        PERFORM 9000-LOAD-SEVERITY-ERROR                          08400000
036654     END-IF.                                                      08410000
036655                                                                  08420000
036656*2250-EXIT.                                                       08430000
036657 EJECT.                                                           08440000
036658                                                                  08450000
036659*--------------------------------------------------------         08460000
036660* 2255-MERCH-TMST-COMPARE.                                        08470000
036661*     COMPARE TIMESTAMP OF EXISTING ROW TO MESSAGE RECORD         08480000
036662*     AND UPDATE IF MESSAGE HAS A NEWER TIMESTAMP.                08490000
036663*--------------------------------------------------------         08500000
036664 2255-MERCH-TMST-COMPARE.                                         08510000
036665                                                                  08520000
036666     IF XS019-LAST-UPD-TMST >= PV-LAST-UPD-TMST                   08530000
036667        SET PV-UPDATE-DATA      TO TRUE                           08540000
036668        SET PS-NOT-READY-TBL    TO TRUE                           08550000
036669     ELSE                                                         08560000
036670        SET PS-PROCESS-COMPLETE TO TRUE                           08570000
036671        SET PS-READY-FOR-TBL    TO TRUE                           08580000
036672     END-IF.                                                      08590000
036673                                                                  08600000
036674*2255-EXIT.                                                       08610000
036675 EJECT.                                                           08620000
036676                                                                  08630000
036677*----------------------------------------------------------       08640000
036678* 2300-CHECK-TBL-TYP.                                             08650000
036679*     THIS CHECKS THE PRICING TYPE CODE TO DECIDE WHETHER         08660000
036680*     WE ARE DEALING WITH A SIMPLE, BENEFIT WITH PURCHASE         08670000
036681*     'BUY', OR TIERED PRICING RECORD.                            08680000
036682*----------------------------------------------------------       08690000
036683 2300-CHECK-TBL-TYP.                                              08700000
036690                                                                  08710000
036692     MOVE XS019-ACTION-CDE   TO PV-ACTION-CODE.                   08720000
036693                                                                  08730000
036695     EVALUATE TRUE                                                08740000
036696        WHEN PV-SIMPLE-PRICE                                      08750000
036697             INITIALIZE PV-SMP-NULLS-INDICATORS                   08760000
036698             PERFORM 2310-POPULATE-SMPL-DCLGEN                    08770000
036699             PERFORM 2400-PROCESS-SMPL-PRICG                      08780000
036700                     UNTIL PS-PRICE-COMPLETE                      08790000
036712        WHEN PV-TIERED-PRICE                                      08800000
036713             INITIALIZE PV-TIER-NULLS-INDICATORS                  08810000
036714                        PV-COMPARISONS                            08820000
036715             PERFORM 2330-POPULATE-TIERED-DCLGEN                  08830000
036716             PERFORM 2600-PROCESS-TIERED-PRICG                    08840000
036717                     UNTIL PS-PRICE-COMPLETE                      08850000
036718*** BWP WILL BE CODED FOR PHASE 2                                 08860000
036719***     WHEN PV-BWP-BUY-PRICE                                     08870000
036720***          PERFORM 2320-POPULATE-BWP-BUY-DCLGEN                 08880000
036721***          PERFORM 2500-PROCESS-BWP-BUY-PRICG                   08890000
036722***                  UNTIL PS-PRICE-COMPLETE                      08900000
036723     END-EVALUATE.                                                08910000
036724                                                                  08920000
036725*2300-EXIT.                                                       08930000
036726 EJECT.                                                           08940000
036727                                                                  08950000
036728*----------------------------------------------------------       08960000
036729* 2310-POPULATE-SMPL-DCLGEN.                                      08970000
036730*     POPULATES THE SIMPLE PRICING TABLE VARIABLES.               08980000
036732*----------------------------------------------------------       08990000
036733 2310-POPULATE-SMPL-DCLGEN.                                       09000000
036734                                                                  09010000
036735     MOVE XS019-PROMO-INTFC-ID  TO XST00030-PROMO-INTFC-ID.       09020000
036736     MOVE XS019-MDSE-LNE-ID     TO XST00030-MDSE-LNE-ID.          09030000
036737     MOVE XS019-STAT-CDE        TO XST00030-STAT-CDE.             09040000
036738     MOVE XS019-LAST-UPD-TMST   TO XST00030-SOR-LAST-UPD-TMST.    09050000
036739                                                                  09060000
036740     IF XS019-ASSN-LVL-CDE = SPACE                                09070000
036741        MOVE -1                 TO PV-ASSN-LVL-CDE-IND            09080000
036742     ELSE                                                         09090000
036743        MOVE XS019-ASSN-LVL-CDE TO XST00030-ASSN-LVL-CDE          09100000
036744     END-IF.                                                      09110000
036745                                                                  09120000
036746     IF PV-PRICG-TBL-NEEDED = 'GAO' OR 'GPO' OR 'GBG' OR 'GBL'    09130000
W26114       OR 'GBD' OR 'GBP'                                          09140003
036747        MOVE XS019-GP-QTY       TO XST00030-DISC-GP-QTY           09150000
036748     ELSE                                                         09160000
036751        MOVE -1                 TO PV-GP-QTY-IND                  09170000
036755     END-IF.                                                      09180000
036756                                                                  09190000
036757     IF PV-PRICG-TBL-NEEDED = 'GAO' OR 'GPO' OR 'GBG' OR 'GBL'    09200000
W26114       OR 'GBD' OR 'GBP'                                          09210003
036758        MOVE XS019-GP-AMT     TO PV-DISC-PRCG-AMT                 09220000
036759        MOVE PV-DISC-PRCG-AMT TO XST00030-DISC-PRCG-AMT           09230000
036760     ELSE                                                         09240000
036761        MOVE XS019-PRICG-AMT  TO XST00030-DISC-PRCG-AMT           09250000
036762     END-IF.                                                      09260000
036763                                                                  09270000
036764*2310-EXIT.                                                       09280000
036765 EJECT.                                                           09290000
036766                                                                  09300000
036767*** BWP WILL BE CODED FOR PHASE 2                                 09310000
036768*----------------------------------------------------------       09320000
036769* 2320-POPULATE-BWP-BUY-DCLGEN.                                   09330000
036770*     POPULATES THE BWP 'BUY' TABLE VARIABLES.                    09340000
036771*----------------------------------------------------------       09350000
036772*2320-POPULATE-BWP-BUY-DCLGEN.                                    09360000
036773***                                                               09370000
036774***  MOVE XS019-PROMO-INTFC-ID   TO XST00039-PROMO-INTFC-ID.      09380000
036775***  MOVE XS019-MDSE-LNE-ID      TO XST00039-MDSE-LNE-ID.         09390000
036776***  MOVE XS019-PROMO-INTFC-SUB-ID                                09400000
036777***                              TO XST00039-PROMO-INTFC-SUB-ID.  09410000
036778***  MOVE XS019-PRICG-TYP-CDE    TO XST00039-BUY-PRICG-TYP-CDE.   09420000
036779***  MOVE XS019-MUST-BUY-ALL-IND TO XST00039-MUST-BUY-ALL-IND.    09430000
036780***  MOVE XS019-RPETG-BWP-IND    TO XST00039-RPETG-BWP-IND.       09440000
036781***  MOVE XS019-BUY-THRS-AMT     TO XST00039-BUY-THRS-AMT.        09450000
036782***  MOVE XS019-STAT-CDE         TO XST00039-STAT-CDE.            09460000
036783***  MOVE XS019-LAST-UPD-TMST    TO XST00039-SOR-LAST-UPD-TMST.   09470000
036784***                                                               09480000
036785*2320-EXIT.                                                       09490000
036786*EJECT.                                                           09500000
036787*                                                                 09510000
036788*----------------------------------------------------------       09520000
036789* 2330-POPULATE-TIERED-DCLGEN.                                    09530000
036790*     POPULATES THE TIERED TABLE VARIABLES.                       09540000
036791*----------------------------------------------------------       09550000
036792 2330-POPULATE-TIERED-DCLGEN.                                     09560000
036793                                                                  09570000
036794     MOVE XS019-PROMO-INTFC-ID TO XST00035-PROMO-INTFC-ID.        09580000
036795     MOVE XS019-MDSE-LNE-ID    TO XST00035-MDSE-LNE-ID.           09590000
036796     MOVE XS019-PROMO-INTFC-SUB-ID                                09600000
036797                               TO XST00035-PROMO-INTFC-SUB-ID.    09610000
036800     MOVE XS019-STAT-CDE       TO XST00035-STAT-CDE.              09620000
036801     MOVE XS019-LAST-UPD-TMST  TO XST00035-SOR-LAST-UPD-TMST.     09630000
036802                                                                  09640000
036803     IF XS019-THRS-QTY = ZEROES                                   09650000
036804        MOVE -1                TO PV-THRS-QTY-IND                 09660000
036805     ELSE                                                         09670000
036806        MOVE XS019-THRS-QTY    TO XST00035-THRS-QTY               09680000
036807     END-IF.                                                      09690000
036808                                                                  09700000
036809     IF XS019-THRS-AMT = PV-CMP-THRS-AMT                          09710000
036810        MOVE -1                TO PV-THRS-AMT-IND                 09720000
036811     ELSE                                                         09730000
036812        MOVE XS019-THRS-AMT    TO XST00035-THRS-AMT               09740000
036813     END-IF.                                                      09750000
036814                                                                  09760000
036815     IF XS019-DISC-AMT = PV-CMP-DISC-AMT                          09770000
036816        MOVE -1                TO PV-DISC-AMT-IND                 09780000
036817     ELSE                                                         09790000
036818        MOVE XS019-DISC-AMT    TO XST00035-DISC-AMT               09800000
036819     END-IF.                                                      09810000
036820                                                                  09820000
036821     IF XS019-DISC-PCT = PV-CMP-DISC-PCT                          09830000
036822        MOVE -1                TO PV-DISC-PCT-IND                 09840000
036823     ELSE                                                         09850000
036824        MOVE XS019-DISC-PCT    TO XST00035-DISC-PCT               09860000
036825     END-IF.                                                      09870000
036826                                                                  09880000
036829*2330-EXIT.                                                       09890000
036830 EJECT.                                                           09900000
036831                                                                  09910000
036832*----------------------------------------------------------       09920000
036833* 2400-PROCESS-SMPL-PRICG.                                        09930000
036834*     THIS PERFORMS ANY UPDATES OR INSERTIONS TO THE PROMO        09940000
036835*     SIMPLE PRICING TABLE THAT MAY BE NEEDED.                    09950000
036836*----------------------------------------------------------       09960000
036837 2400-PROCESS-SMPL-PRICG.                                         09970000
036838                                                                  09980000
036839     EVALUATE TRUE                                                09990000
036840        WHEN PV-INSERT-DATA                                       10000000
036841             PERFORM 2410-INSERT-SMPL-PRICG                       10010000
036842        WHEN PV-UPDATE-DATA                                       10020000
036843             PERFORM 2420-UPDATE-SMPL-PRICG                       10030000
036844     END-EVALUATE.                                                10040000
036845                                                                  10050000
036846*2400-EXIT.                                                       10060000
036847 EJECT.                                                           10070000
036848                                                                  10080000
036849*------------------------------------------------------           10090000
036850* 2410-INSERT-SMPL-PRICG.                                         10100000
036851*     INSERT THE SIMPLE PRICING RECORD.                           10110000
036852*------------------------------------------------------           10120000
036853 2410-INSERT-SMPL-PRICG.                                          10130000
036854                                                                  10140000
036855     PERFORM                                                      10150000
036856         WITH TEST AFTER                                          10160000
036857         VARYING PV-SQL-SUB                                       10170000
036858         FROM 1 BY 1                                              10180000
036859         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 10190000
036860                   OR  SQLCODE NOT = -904 AND -911 AND -913)      10200000
036861                                                                  10210000
036862         EXEC SQL                                                 10220000
036863             INSERT INTO XST_SMP_PRICG                            10230000
036864                                      (PROMO_INTFC_ID             10240000
036865                                      ,MDSE_LNE_ID                10250000
036866                                      ,ASSN_LVL_CDE               10260000
036867                                      ,STAT_CDE                   10270000
036868                                      ,DISC_GP_QTY                10280000
036869                                      ,DISC_PRCG_AMT              10290000
036870                                      ,LAST_UPD_TMST              10300000
036871                                      ,SOR_LAST_UPD_TMST)         10310000
036872             VALUES                                               10320000
036873                (:XST00030-PROMO-INTFC-ID                         10330000
036874                ,:XST00030-MDSE-LNE-ID                            10340000
036875                ,:XST00030-ASSN-LVL-CDE :PV-ASSN-LVL-CDE-IND      10350000
036876                ,:XST00030-STAT-CDE                               10360000
036877                ,:XST00030-DISC-GP-QTY :PV-GP-QTY-IND             10370000
036878                ,:XST00030-DISC-PRCG-AMT                          10380000
036879                ,CURRENT TIMESTAMP                                10390000
036880                ,:XST00030-SOR-LAST-UPD-TMST)                     10400000
036881         END-EXEC                                                 10410000
036882                                                                  10420000
036883         MOVE SQLCODE TO PV-SQL-CODE                              10430000
036884                                                                  10440000
036885         EVALUATE TRUE                                            10450000
036886             WHEN SQLCODE = -904                                  10460000
036887             WHEN SQLCODE = -911                                  10470000
036888             WHEN SQLCODE = -913                                  10480000
036889                  CONTINUE                                        10490000
036890             WHEN SQLCODE = 0                                     10500000
036891                  SET PS-PRICE-COMPLETE TO TRUE                   10510000
036892             WHEN SQLCODE = -803                                  10520000
036893                  PERFORM 2430-SELECT-SMPL-DATA                   10530000
036894                  MOVE -803 TO SQLCODE                            10540000
036895             WHEN OTHER                                           10550000
036896                  SET PS-PRICE-COMPLETE TO TRUE                   10560000
036897                  SET PV-NO-SUCCESS-CDE TO TRUE                   10570000
036898                  PERFORM 9000-LOAD-SEVERITY-ERROR                10580000
036899                  MOVE +0 TO SQLCODE                              10590000
036900         END-EVALUATE                                             10600000
036901     END-PERFORM.                                                 10610000
036902                                                                  10620000
036903     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         10630000
036904        SET PS-PRICE-COMPLETE TO TRUE                             10640000
036905        SET PV-NO-SUCCESS-CDE TO TRUE                             10650000
036906        PERFORM 9000-LOAD-SEVERITY-ERROR                          10660000
036907     END-IF.                                                      10670000
036908                                                                  10680000
036909*2410-EXIT.                                                       10690000
036910 EJECT.                                                           10700000
036920                                                                  10710000
036956*------------------------------------------------------           10720000
036957* 2420-UPDATE-SMPL-PRICG.                                         10730000
036958*     UPDATE THE SIMPLE PRICING RECORD.                           10740000
C52736*                                                                 10750008
C52736*  -- REMOVED SETTING OF PRIMARY KEY FIELDS                       10760008
036959*------------------------------------------------------           10770000
036960 2420-UPDATE-SMPL-PRICG.                                          10780000
036961                                                                  10790000
036962     PERFORM                                                      10800000
036963         WITH TEST AFTER                                          10810000
036964         VARYING PV-SQL-SUB                                       10820000
036965         FROM 1 BY 1                                              10830000
036966         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 10840000
036967                   OR  SQLCODE NOT = -904 AND -911 AND -913)      10850000
036968                                                                  10860000
036969         EXEC SQL                                                 10870000
036970             UPDATE XST_SMP_PRICG                                 10880000
C52736             SET  ASSN_LVL_CDE     = :XST00030-ASSN-LVL-CDE       10890007
036974                                       :PV-ASSN-LVL-CDE-IND,      10900000
036975                  STAT_CDE         = :XST00030-STAT-CDE,          10910000
036976                  DISC_GP_QTY      = :XST00030-DISC-GP-QTY        10920000
036977                                       :PV-GP-QTY-IND,            10930000
036978                  DISC_PRCG_AMT    = :XST00030-DISC-PRCG-AMT,     10940000
036979                  LAST_UPD_TMST    = CURRENT TIMESTAMP,           10950000
036980                  SOR_LAST_UPD_TMST                               10960000
036981                                   = :XST00030-SOR-LAST-UPD-TMST  10970000
036982             WHERE PROMO_INTFC_ID  = :XST00030-PROMO-INTFC-ID     10980000
036983               AND MDSE_LNE_ID     = :XST00030-MDSE-LNE-ID        10990000
036984               AND SOR_LAST_UPD_TMST                              11000000
036985                                  <= :XST00030-SOR-LAST-UPD-TMST  11010000
036986         END-EXEC                                                 11020000
036987                                                                  11030000
036988         MOVE SQLCODE TO PV-SQL-CODE                              11040000
036989                                                                  11050000
036990         EVALUATE TRUE                                            11060000
036991             WHEN SQLCODE = -904                                  11070000
036992             WHEN SQLCODE = -911                                  11080000
036993             WHEN SQLCODE = -913                                  11090000
036994                  CONTINUE                                        11100000
036995             WHEN SQLCODE = 0                                     11110000
036996                  SET PS-PRICE-COMPLETE TO TRUE                   11120000
036997             WHEN SQLCODE = +100                                  11130000
036998                  PERFORM 2430-SELECT-SMPL-DATA                   11140000
036999                  MOVE +100 TO SQLCODE                            11150000
037000             WHEN OTHER                                           11160000
037001                  SET PS-PRICE-COMPLETE TO TRUE                   11170000
037002                  SET PV-NO-SUCCESS-CDE TO TRUE                   11180000
037003                  PERFORM 9000-LOAD-SEVERITY-ERROR                11190000
037004                  MOVE +0 TO SQLCODE                              11200000
037005         END-EVALUATE                                             11210000
037006     END-PERFORM.                                                 11220000
037007                                                                  11230000
037008     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         11240000
037009        SET PS-PRICE-COMPLETE TO TRUE                             11250000
037010        SET PV-NO-SUCCESS-CDE TO TRUE                             11260000
037011        PERFORM 9000-LOAD-SEVERITY-ERROR                          11270000
037012     END-IF.                                                      11280000
037013                                                                  11290000
037014*2420-EXIT.                                                       11300000
037015 EJECT.                                                           11310000
037016                                                                  11320000
037017*------------------------------------------------------           11330000
037018* 2430-SELECT-SMPL-DATA.                                          11340000
037019*     SELECT THE TIMESTAMP IN THE SIMPLE PRICING RECORD.          11350000
037020*------------------------------------------------------           11360000
037021 2430-SELECT-SMPL-DATA.                                           11370000
037022                                                                  11380000
037023     PERFORM                                                      11390000
037024         WITH TEST AFTER                                          11400000
037025         VARYING PV-SQL-SUB                                       11410000
037026         FROM 1 BY 1                                              11420000
037027         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 11430000
037028                   OR  SQLCODE NOT = -904 AND -911 AND -913)      11440000
037029                                                                  11450000
037030         EXEC SQL                                                 11460000
037031             SELECT  SOR_LAST_UPD_TMST                            11470000
037032               INTO :PV-LAST-UPD-TMST                             11480000
037033               FROM  XST_SMP_PRICG                                11490000
037034              WHERE  PROMO_INTFC_ID = :XST00030-PROMO-INTFC-ID    11500000
037035                AND  MDSE_LNE_ID    = :XST00030-MDSE-LNE-ID       11510000
037036         END-EXEC                                                 11520000
037037                                                                  11530000
037038         MOVE SQLCODE TO PV-SQL-CODE                              11540000
037039                                                                  11550000
037040         EVALUATE TRUE                                            11560000
037041             WHEN SQLCODE = -904                                  11570000
037042             WHEN SQLCODE = -911                                  11580000
037043             WHEN SQLCODE = -913                                  11590000
037044                  CONTINUE                                        11600000
037045             WHEN SQLCODE = 0                                     11610000
037046                  IF PV-UPDATE-DATA                               11620000
037047                     SET PS-PRICE-COMPLETE TO TRUE                11630000
037048                     SET PV-UPDATE-BYPASS TO TRUE                 11640000
037049                  ELSE                                            11650000
037050                     PERFORM 2700-PRICG-TMST-COMPARE              11660000
037051                  END-IF                                          11670000
037052             WHEN SQLCODE = +100                                  11680000
037053                  SET PV-INSERT-DATA TO TRUE                      11690000
037054                  SET PV-ADD-CDE TO TRUE                          11700000
037055             WHEN OTHER                                           11710000
037056                  SET PS-PRICE-COMPLETE TO TRUE                   11720000
037057                  SET PV-NO-SUCCESS-CDE TO TRUE                   11730000
037058                  PERFORM 9000-LOAD-SEVERITY-ERROR                11740000
037059                  MOVE +0 TO SQLCODE                              11750000
037060         END-EVALUATE                                             11760000
037061     END-PERFORM.                                                 11770000
037062                                                                  11780000
037063     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         11790000
037064        SET PS-PRICE-COMPLETE TO TRUE                             11800000
037065        SET PV-NO-SUCCESS-CDE TO TRUE                             11810000
037066        PERFORM 9000-LOAD-SEVERITY-ERROR                          11820000
037067     END-IF.                                                      11830000
037068                                                                  11840000
037069*2430-EXIT.                                                       11850000
037070 EJECT.                                                           11860000
037071                                                                  11870000
037072*** BWP WILL BE CODED FOR PHASE 2                                 11880000
037073*----------------------------------------------------------       11890000
037074* 2500-PROCESS-BWP-BUY-PRICG.                                     11900000
037075*     THIS PERFORMS ANY UPDATES OR INSERTIONS TO THE PROMO        11910000
037076*     BENEFIT WITH PURCHASE 'BUY' TABLE THAT MAY BE NEEDED.       11920000
037077*----------------------------------------------------------       11930000
037078*2500-PROCESS-BWP-BUY-PRICG.                                      11940000
037079***                                                               11950000
037080***  EVALUATE TRUE                                                11960000
037081***     WHEN PV-INSERT-DATA                                       11970000
037082***          PERFORM 2510-INSERT-BWP-BUY-PRICG                    11980000
037083***     WHEN PV-UPDATE-DATA                                       11990000
037084***          PERFORM 2520-UPDATE-BWP-BUY-PRICG                    12000000
037085***  END-EVALUATE.                                                12010000
037086***                                                               12020000
037087*2500-EXIT.                                                       12030000
037088*EJECT.                                                           12040000
037089*                                                                 12050000
037090*------------------------------------------------------           12060000
037091* 2510-INSERT-BWP-BUY-PRICG.                                      12070000
037092*     INSERT THE BENEFIT WITH PURCHASE 'BUY' PRICING RECORD.      12080000
037093*------------------------------------------------------           12090000
037094*2510-INSERT-BWP-BUY-PRICG.                                       12100000
037095*                                                                 12110000
037096***  PERFORM                                                      12120000
037097***      WITH TEST AFTER                                          12130000
037098***      VARYING PV-SQL-SUB                                       12140000
037099***      FROM 1 BY 1                                              12150000
037100***      UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 12160000
037101***                OR  SQLCODE NOT = -904 AND -911 AND -913)      12170000
037102***                                                               12180000
037103***      EXEC SQL                                                 12190000
037104***          INSERT INTO XST_BWP_BUY_MDSE                         12200000
037105***                                   (PROMO_INTFC_ID             12210000
037106***                                   ,MDSE_LNE_ID                12220000
037107***                                   ,PROMO_INTFC_SUB_ID         12230000
037108***                                   ,BUY_PRICG_TYP_CDE          12240000
037109***                                   ,MUST_BUY_ALL_IND           12250000
037110***                                   ,RPETG_BWP_IND              12260000
037111***                                   ,BUY_THRS_AMT               12270000
037112***                                   ,STAT_CDE                   12280000
037113***                                   ,LAST_UPD_TMST              12290000
037114***                                   ,SOR_LAST_UPD_TMST)         12300000
037115***          VALUES                                               12310000
037116***             (:XST00039-PROMO-INTFC-ID                         12320000
037117***             ,:XST00039-MDSE-LNE-ID                            12330000
037118***             ,:XST00039-PROMO-INTFC-SUB-ID                     12340000
037119***             ,:XST00039-BUY-PRICG-TYP-CDE                      12350000
037120***             ,:XST00039-MUST-BUY-ALL-IND                       12360000
037121***             ,:XST00039-RPETG-BWP-IND                          12370000
037122***             ,:XST00039-BUY-THRS-AMT                           12380000
037123***             ,:XST00039-STAT-CDE                               12390000
037124***             ,CURRENT TIMESTAMP                                12400000
037125***             ,:XST00039-SOR-LAST-UPD-TMST)                     12410000
037126***      END-EXEC                                                 12420000
037127***                                                               12430000
037128***      MOVE SQLCODE TO PV-SQL-CODE                              12440000
037129***                                                               12450000
037130***      EVALUATE TRUE                                            12460000
037131***          WHEN SQLCODE = -904                                  12470000
037132***          WHEN SQLCODE = -911                                  12480000
037133***          WHEN SQLCODE = -913                                  12490000
037134***               CONTINUE                                        12500000
037135***          WHEN SQLCODE = 0                                     12510000
037136***               SET PS-PRICE-COMPLETE TO TRUE                   12520000
037137***          WHEN SQLCODE = -803                                  12530000
037138***               PERFORM 2530-SELECT-BWP-BUY-DATA                12540000
037139***               MOVE -803 TO SQLCODE                            12550000
037140***          WHEN OTHER                                           12560000
037141***               SET PS-PRICE-COMPLETE TO TRUE                   12570000
037142***               SET PV-NO-SUCCESS-CDE TO TRUE                   12580000
037143***               PERFORM 9000-LOAD-SEVERITY-ERROR                12590000
037144***               MOVE +0 TO SQLCODE                              12600000
037145***      END-EVALUATE                                             12610000
037146***  END-PERFORM.                                                 12620000
037147***                                                               12630000
037148***  IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         12640000
037149***     SET PS-PRICE-COMPLETE TO TRUE                             12650000
037150***     SET PV-NO-SUCCESS-CDE TO TRUE                             12660000
037151***     PERFORM 9000-LOAD-SEVERITY-ERROR                          12670000
037152***  END-IF.                                                      12680000
037153***                                                               12690000
037154*2510-EXIT.                                                       12700000
037155*EJECT.                                                           12710000
037156*                                                                 12720000
037201*------------------------------------------------------           12730000
037202* 2520-UPDATE-BWP-BUY-PRICG.                                      12740000
037203*     UPDATE THE BENEFIT WITH PURCHASE 'BUY' PRICING RECORD.      12750000
037204*------------------------------------------------------           12760000
037205*2520-UPDATE-BWP-BUY-PRICG.                                       12770000
037206***                                                               12780000
037207***  PERFORM                                                      12790000
037208***      WITH TEST AFTER                                          12800000
037209***      VARYING PV-SQL-SUB                                       12810000
037210***      FROM 1 BY 1                                              12820000
037211***      UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 12830000
037212***                OR  SQLCODE NOT = -904 AND -911 AND -913)      12840000
037213***                                                               12850000
037214***      EXEC SQL                                                 12860000
037215***          UPDATE XST_BWP_BUY_MDSE                              12870000
037216***          SET PROMO_INTFC_ID     = :XST00039-PROMO-INTFC-ID,   12880000
037217***              MDSE_LNE_ID        = :XST00039-MDSE-LNE-ID,      12890000
037218***              PROMO_INTFC_SUB_ID =                             12900000
037219***                                 :XST00039-PROMO-INTFC-SUB-ID, 12910000
037220***              BUY_PRICG_TYP_CDE  = :XST00039-BUY-PRICG-TYP-CDE,12920000
037221***              MUST_BUY_ALL_IND   = :XST00039-MUST-BUY-ALL-IND, 12930000
037222***              RPETG_BWP_IND      = :XST00039-RPETG-BWP-IND,    12940000
037223***              BUY_THRS_AMT       = :XST00039-BUY-THRS-AMT,     12950000
037224***              STAT_CDE           = :XST00039-STAT-CDE,         12960000
037225***              LAST_UPD_TMST      = CURRENT TIMESTAMP,          12970000
037226***              SOR_LAST_UPD_TMST  = :XST00039-SOR-LAST-UPD-TMST 12980000
037227***        WHERE PROMO_INTFC_ID     = :XST00039-PROMO-INTFC-ID    12990000
037228***          AND MDSE_LNE_ID        = :XST00039-MDSE-LNE-ID       13000000
037229***          AND SOR_LAST_UPD_TMST <= :XST00039-SOR-LAST-UPD-TMST 13010000
037230***      END-EXEC                                                 13020000
037231***                                                               13030000
037232***      MOVE SQLCODE TO PV-SQL-CODE                              13040000
037233***                                                               13050000
037234***      EVALUATE TRUE                                            13060000
037235***          WHEN SQLCODE = -904                                  13070000
037236***          WHEN SQLCODE = -911                                  13080000
037237***          WHEN SQLCODE = -913                                  13090000
037238***               CONTINUE                                        13100000
037239***          WHEN SQLCODE = 0                                     13110000
037240***               SET PS-PRICE-COMPLETE TO TRUE                   13120000
037241***          WHEN SQLCODE = +100                                  13130000
037242***               PERFORM 2530-SELECT-BWP-BUY-DATA                13140000
037243***               MOVE +100 TO SQLCODE                            13150000
037244***          WHEN OTHER                                           13160000
037245***               SET PS-PRICE-COMPLETE TO TRUE                   13170000
037246***               SET PV-NO-SUCCESS-CDE TO TRUE                   13180000
037247***               PERFORM 9000-LOAD-SEVERITY-ERROR                13190000
037248***               MOVE +0 TO SQLCODE                              13200000
037249***      END-EVALUATE                                             13210000
037250***  END-PERFORM.                                                 13220000
037251***                                                               13230000
037252***  IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         13240000
037253***     SET PS-PRICE-COMPLETE TO TRUE                             13250000
037254***     SET PV-NO-SUCCESS-CDE TO TRUE                             13260000
037255***     PERFORM 9000-LOAD-SEVERITY-ERROR                          13270000
037256***  END-IF.                                                      13280000
037257***                                                               13290000
037258*2520-EXIT.                                                       13300000
037259*EJECT.                                                           13310000
037260*                                                                 13320000
037261*------------------------------------------------------           13330000
037262* 2530-SELECT-BWP-BUY-DATA.                                       13340000
037263*     SELECT THE TIMESTAMP IN THE BENEFIT WITH PURCHASE           13350000
037264*     'BUY' PRICING RECORD.                                       13360000
037265*------------------------------------------------------           13370000
037266*2530-SELECT-BWP-BUY-DATA.                                        13380000
037267***                                                               13390000
037268***  PERFORM                                                      13400000
037269***      WITH TEST AFTER                                          13410000
037270***      VARYING PV-SQL-SUB                                       13420000
037271***      FROM 1 BY 1                                              13430000
037272***      UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 13440000
037273***                OR  SQLCODE NOT = -904 AND -911 AND -913)      13450000
037274***                                                               13460000
037275***      EXEC SQL                                                 13470000
037276***          SELECT  SOR_LAST_UPD_TMST                            13480000
037277***            INTO :PV-LAST-UPD-TMST                             13490000
037278***            FROM  XST_BWP_BUY_MDSE                             13500000
037279***           WHERE  PROMO_INTFC_ID = :XST00039-PROMO-INTFC-ID    13510000
037280***             AND  MDSE_LNE_ID    = :XST00039-MDSE-LNE-ID       13520000
037281***      END-EXEC                                                 13530000
037282***                                                               13540000
037283***      MOVE SQLCODE TO PV-SQL-CODE                              13550000
037284***                                                               13560000
037285***      EVALUATE TRUE                                            13570000
037286***          WHEN SQLCODE = -904                                  13580000
037287***          WHEN SQLCODE = -911                                  13590000
037288***          WHEN SQLCODE = -913                                  13600000
037289***               CONTINUE                                        13610000
037290***          WHEN SQLCODE = 0                                     13620000
037291***               IF PV-UPDATE-DATA                               13630000
037292***                  SET PS-PRICE-COMPLETE TO TRUE                13640000
037293***                  SET PV-UPDATE-BYPASS TO TRUE                 13650000
037294***               ELSE                                            13660000
037295***                  PERFORM 2700-PRICG-TMST-COMPARE              13670000
037296***               END-IF                                          13680000
037297***          WHEN SQLCODE = +100                                  13690000
037298***               SET PV-INSERT-DATA TO TRUE                      13700000
037299***               SET PV-ADD-CDE TO TRUE                          13710000
037300***          WHEN OTHER                                           13720000
037301***               SET PS-PRICE-COMPLETE TO TRUE                   13730000
037302***               SET PV-NO-SUCCESS-CDE TO TRUE                   13740000
037303***               PERFORM 9000-LOAD-SEVERITY-ERROR                13750000
037304***               MOVE +0 TO SQLCODE                              13760000
037305***      END-EVALUATE                                             13770000
037306***  END-PERFORM.                                                 13780000
037307***                                                               13790000
037308***  IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         13800000
037309***     SET PS-PRICE-COMPLETE TO TRUE                             13810000
037310***     SET PV-NO-SUCCESS-CDE TO TRUE                             13820000
037311***     PERFORM 9000-LOAD-SEVERITY-ERROR                          13830000
037312***  END-IF.                                                      13840000
037313***                                                               13850000
037314*2530-EXIT.                                                       13860000
037315*EJECT.                                                           13870000
037316*                                                                 13880000
037317*----------------------------------------------------------       13890000
037318* 2600-PROCESS-TIERED-PRICG.                                      13900000
037319*     THIS PERFORMS ANY UPDATES OR INSERTIONS TO THE PROMO        13910000
037320*     TIERED TABLE THAT MAY BE NEEDED.                            13920000
037321*----------------------------------------------------------       13930000
037322 2600-PROCESS-TIERED-PRICG.                                       13940000
037323                                                                  13950000
037324     EVALUATE TRUE                                                13960000
037325        WHEN PV-INSERT-DATA                                       13970000
037326             PERFORM 2610-INSERT-TIERED-PRICG                     13980000
037327        WHEN PV-UPDATE-DATA                                       13990000
037328             PERFORM 2620-UPDATE-TIERED-PRICG                     14000000
037329     END-EVALUATE.                                                14010000
037330                                                                  14020000
037331*2600-EXIT.                                                       14030000
037332 EJECT.                                                           14040000
037333                                                                  14050000
037334*------------------------------------------------------           14060000
037335* 2610-INSERT-TIERED-PRICG.                                       14070000
037336*     INSERT THE TIERED PRICING RECORD.                           14080000
037337*------------------------------------------------------           14090000
037338 2610-INSERT-TIERED-PRICG.                                        14100000
037339                                                                  14110000
037340     PERFORM                                                      14120000
037341         WITH TEST AFTER                                          14130000
037342         VARYING PV-SQL-SUB                                       14140000
037343         FROM 1 BY 1                                              14150000
037344         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 14160000
037345                   OR  SQLCODE NOT = -904 AND -911 AND -913)      14170000
037346                                                                  14180000
037347         EXEC SQL                                                 14190000
037348             INSERT INTO XST_TIER_PRICG                           14200000
037349                                      (PROMO_INTFC_ID             14210000
037350                                      ,MDSE_LNE_ID                14220000
037351                                      ,PROMO_INTFC_SUB_ID         14230000
037353                                      ,STAT_CDE                   14240000
037354                                      ,THRS_QTY                   14250000
037355                                      ,THRS_AMT                   14260000
037356                                      ,DISC_AMT                   14270000
037357                                      ,DISC_PCT                   14280000
037358                                      ,LAST_UPD_TMST              14290000
037359                                      ,SOR_LAST_UPD_TMST)         14300000
037360             VALUES                                               14310000
037361                (:XST00035-PROMO-INTFC-ID                         14320000
037362                ,:XST00035-MDSE-LNE-ID                            14330000
037363                ,:XST00035-PROMO-INTFC-SUB-ID                     14340000
037365                ,:XST00035-STAT-CDE                               14350000
037366                ,:XST00035-THRS-QTY :PV-THRS-QTY-IND              14360000
037367                ,:XST00035-THRS-AMT :PV-THRS-AMT-IND              14370000
037368                ,:XST00035-DISC-AMT :PV-DISC-AMT-IND              14380000
037369                ,:XST00035-DISC-PCT :PV-DISC-PCT-IND              14390000
037370                ,CURRENT TIMESTAMP                                14400000
037371                ,:XST00035-SOR-LAST-UPD-TMST)                     14410000
037372         END-EXEC                                                 14420000
037373                                                                  14430000
037374         MOVE SQLCODE TO PV-SQL-CODE                              14440000
037375                                                                  14450000
037376         EVALUATE TRUE                                            14460000
037377             WHEN SQLCODE = -904                                  14470000
037378             WHEN SQLCODE = -911                                  14480000
037379             WHEN SQLCODE = -913                                  14490000
037380                  CONTINUE                                        14500000
037381             WHEN SQLCODE = 0                                     14510000
037382                  SET PS-PRICE-COMPLETE TO TRUE                   14520000
037383             WHEN SQLCODE = -803                                  14530000
037384                  PERFORM 2630-SELECT-TIERED-DATA                 14540000
037385                  MOVE -803 TO SQLCODE                            14550000
037386             WHEN OTHER                                           14560000
037387                  SET PS-PRICE-COMPLETE TO TRUE                   14570000
037388                  SET PV-NO-SUCCESS-CDE TO TRUE                   14580000
037389                  PERFORM 9000-LOAD-SEVERITY-ERROR                14590000
037390                  MOVE +0 TO SQLCODE                              14600000
037391         END-EVALUATE                                             14610000
037392     END-PERFORM.                                                 14620000
037393                                                                  14630000
037394     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         14640000
037395        SET PS-PRICE-COMPLETE TO TRUE                             14650000
037396        SET PV-NO-SUCCESS-CDE TO TRUE                             14660000
037397        PERFORM 9000-LOAD-SEVERITY-ERROR                          14670000
037398     END-IF.                                                      14680000
037399                                                                  14690000
037400*2610-EXIT.                                                       14700000
037401 EJECT.                                                           14710000
037410                                                                  14720000
037449*------------------------------------------------------           14730000
037450* 2620-UPDATE-TIERED-PRICG.                                       14740000
037451*     UPDATE THE TIERED PRICING RECORD.                           14750000
C52736*                                                                 14760008
C52736*  -- REMOVED SETTING OF PRIMARY KEY FIELDS                       14770008
037452*------------------------------------------------------           14780000
037453 2620-UPDATE-TIERED-PRICG.                                        14790000
037454                                                                  14800000
037455     PERFORM                                                      14810000
037456         WITH TEST AFTER                                          14820000
037457         VARYING PV-SQL-SUB                                       14830000
037458         FROM 1 BY 1                                              14840000
037459         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 14850000
037460                   OR  SQLCODE NOT = -904 AND -911 AND -913)      14860000
037461                                                                  14870000
037462         EXEC SQL                                                 14880000
037463             UPDATE XST_TIER_PRICG                                14890000
C52736             SET  STAT_CDE         = :XST00035-STAT-CDE,          14900007
037470                  THRS_QTY         = :XST00035-THRS-QTY           14910000
037471                                       :PV-THRS-QTY-IND,          14920000
037472                  THRS_AMT         = :XST00035-THRS-AMT           14930000
037473                                       :PV-THRS-AMT-IND,          14940000
037474                  DISC_AMT         = :XST00035-DISC-AMT           14950000
037475                                       :PV-DISC-AMT-IND,          14960000
037476                  DISC_PCT         = :XST00035-DISC-PCT           14970000
037477                                       :PV-DISC-PCT-IND,          14980000
037478                  LAST_UPD_TMST    = CURRENT TIMESTAMP,           14990000
037479                  SOR_LAST_UPD_TMST                               15000000
037480                                   = :XST00035-SOR-LAST-UPD-TMST  15010000
037481             WHERE PROMO_INTFC_ID  = :XST00035-PROMO-INTFC-ID     15020000
037482               AND MDSE_LNE_ID     = :XST00035-MDSE-LNE-ID        15030000
037483               AND PROMO_INTFC_SUB_ID                             15040000
037484                                   = :XST00035-PROMO-INTFC-SUB-ID 15050000
037485               AND SOR_LAST_UPD_TMST                              15060000
037486                                  <= :XST00035-SOR-LAST-UPD-TMST  15070000
037487         END-EXEC                                                 15080000
037488                                                                  15090000
037489         MOVE SQLCODE TO PV-SQL-CODE                              15100000
037490                                                                  15110000
037491         EVALUATE TRUE                                            15120000
037492             WHEN SQLCODE = -904                                  15130000
037493             WHEN SQLCODE = -911                                  15140000
037494             WHEN SQLCODE = -913                                  15150000
037495                  CONTINUE                                        15160000
037496             WHEN SQLCODE = 0                                     15170000
037497                  SET PS-PRICE-COMPLETE TO TRUE                   15180000
037498             WHEN SQLCODE = +100                                  15190000
037499                  PERFORM 2630-SELECT-TIERED-DATA                 15200000
037500                  MOVE +100 TO SQLCODE                            15210000
037501             WHEN OTHER                                           15220000
037502                  SET PS-PRICE-COMPLETE TO TRUE                   15230000
037503                  SET PV-NO-SUCCESS-CDE TO TRUE                   15240000
037504                  PERFORM 9000-LOAD-SEVERITY-ERROR                15250000
037505                  MOVE +0 TO SQLCODE                              15260000
037506         END-EVALUATE                                             15270000
037507     END-PERFORM.                                                 15280000
037508                                                                  15290000
037509     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         15300000
037510        SET PS-PRICE-COMPLETE TO TRUE                             15310000
037511        SET PV-NO-SUCCESS-CDE TO TRUE                             15320000
037512        PERFORM 9000-LOAD-SEVERITY-ERROR                          15330000
037513     END-IF.                                                      15340000
037514                                                                  15350000
037515*2620-EXIT.                                                       15360000
037516 EJECT.                                                           15370000
037517                                                                  15380000
037518*------------------------------------------------------           15390000
037519* 2630-SELECT-TIERED-DATA.                                        15400000
037520*     SELECT THE TIMESTAMP IN THE PRICING RECORD.                 15410000
037521*------------------------------------------------------           15420000
037522 2630-SELECT-TIERED-DATA.                                         15430000
037523                                                                  15440000
037524     PERFORM                                                      15450000
037525         WITH TEST AFTER                                          15460000
037526         VARYING PV-SQL-SUB                                       15470000
037527         FROM 1 BY 1                                              15480000
037528         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 15490000
037529                   OR  SQLCODE NOT = -904 AND -911 AND -913)      15500000
037530                                                                  15510000
037531         EXEC SQL                                                 15520000
037532             SELECT  SOR_LAST_UPD_TMST                            15530000
037533               INTO :PV-LAST-UPD-TMST                             15540000
037534               FROM  XST_TIER_PRICG                               15550000
037535              WHERE  PROMO_INTFC_ID = :XST00035-PROMO-INTFC-ID    15560000
037536                AND  MDSE_LNE_ID    = :XST00035-MDSE-LNE-ID       15570000
037537                AND  PROMO_INTFC_SUB_ID                           15580000
037538                                    = :XST00035-PROMO-INTFC-SUB-ID15590000
037539         END-EXEC                                                 15600000
037540                                                                  15610000
037541         MOVE SQLCODE TO PV-SQL-CODE                              15620000
037542                                                                  15630000
037543         EVALUATE TRUE                                            15640000
037544             WHEN SQLCODE = -904                                  15650000
037545             WHEN SQLCODE = -911                                  15660000
037546             WHEN SQLCODE = -913                                  15670000
037547                  CONTINUE                                        15680000
037548             WHEN SQLCODE = 0                                     15690000
037549                  IF PV-UPDATE-DATA                               15700000
037550                     SET PS-PRICE-COMPLETE TO TRUE                15710000
037551                     SET PV-UPDATE-BYPASS TO TRUE                 15720000
037552                  ELSE                                            15730000
037553                     PERFORM 2700-PRICG-TMST-COMPARE              15740000
037554                  END-IF                                          15750000
037555             WHEN SQLCODE = +100                                  15760000
037556                  SET PV-INSERT-DATA TO TRUE                      15770000
037557                  SET PV-ADD-CDE TO TRUE                          15780000
037558             WHEN OTHER                                           15790000
037559                  SET PS-PRICE-COMPLETE TO TRUE                   15800000
037560                  SET PV-NO-SUCCESS-CDE TO TRUE                   15810000
037561                  PERFORM 9000-LOAD-SEVERITY-ERROR                15820000
037562                  MOVE +0 TO SQLCODE                              15830000
037563         END-EVALUATE                                             15840000
037564     END-PERFORM.                                                 15850000
037565                                                                  15860000
037566     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         15870000
037567        SET PS-PRICE-COMPLETE TO TRUE                             15880000
037568        SET PV-NO-SUCCESS-CDE TO TRUE                             15890000
037569        PERFORM 9000-LOAD-SEVERITY-ERROR                          15900000
037570     END-IF.                                                      15910000
037571                                                                  15920000
037572*2630-EXIT.                                                       15930000
037573 EJECT.                                                           15940000
037574                                                                  15950000
037575*--------------------------------------------------------         15960000
037576* 2700-PRICG-TMST-COMPARE.                                        15970000
037577*     COMPARE TIMESTAMP OF EXISTING ROW TO MESSAGE RECORD         15980000
037578*     AND UPDATE IF MESSAGE HAS A NEWER TIMESTAMP.                15990000
037579*--------------------------------------------------------         16000000
037580 2700-PRICG-TMST-COMPARE.                                         16010000
037581                                                                  16020000
037582     IF XS019-LAST-UPD-TMST >= PV-LAST-UPD-TMST                   16030000
037583        SET PV-UPDATE-DATA      TO TRUE                           16040000
037584        SET PV-UPDATE-NEED      TO TRUE                           16050000
037585     ELSE                                                         16060000
037586        SET PS-PRICE-COMPLETE TO TRUE                             16070000
037587        SET PV-UPDATE-NOT-NEED  TO TRUE                           16080000
037588     END-IF.                                                      16090000
037589                                                                  16100000
037590*2700-EXIT.                                                       16110000
037591 EJECT.                                                           16120000
037592                                                                  16130000
037593*----------------------------------------------------------       16140000
037594* 9000-LOAD-SEVERITY-ERROR.                                       16150000
037595*     THIS PROCEDURE IS CALLED IF THE RECORD WAS NOT UPDATED      16160000
037596*     OR INSERTED INTO THE PRICING TABLE.  COMPARES THE           16170000
037597*     MAXIMUM OFFSET DATE TO THE PRICING BUSINESS EVENT           16180000
037598*     START DATE.  IF THE MAXIMUM OFFSET DATE IS LESS THAN THE    16190000
037599*     PRICING START DATE THE ERROR IS UNCRITICAL,                 16200000
037600*     OTHERWISE IT IS CRITICAL.                                   16210000
037601*----------------------------------------------------------       16220000
037610 9000-LOAD-SEVERITY-ERROR.                                        16230000
037700                                                                  16240000
037800     INITIALIZE DCLXST00026.                                      16250000
037900                                                                  16260000
038000     MOVE XS019-PROMO-ID  TO XST00026-PROMO-ID.                   16270000
038020                                                                  16280000
038021     PERFORM 9010-SELECT-STRT-DATE.                               16290000
038022                                                                  16300000
038023     IF PV-PRICE-STRT-DTE = SPACES                                16310000
038024        MOVE ZEROES TO PV-PRICE-STRT-DTE-NBR                      16320000
038025     ELSE                                                         16330000
038026        PERFORM 9100-FORMAT-DATE-INFO                             16340000
038027     END-IF.                                                      16350000
038028                                                                  16360000
038029     IF (PV-MAX-OFFSET-DTE < PV-PRICE-STRT-DTE-NBR) AND           16370000
038030       (PV-MAX-OFFSET-DTE NOT = ZEROES) AND                       16380000
038040       (PV-PRICE-STRT-DTE-NBR NOT = ZEROES)                       16390000
038050        SET PV-NOT-CRITICAL-ERROR TO TRUE                         16400000
038060     ELSE                                                         16410000
038070        SET PV-CRITICAL-ERROR TO TRUE                             16420000
038080     END-IF.                                                      16430000
038090                                                                  16440000
038100*9000-EXIT.                                                       16450000
038200 EJECT.                                                           16460000
038300                                                                  16470000
038400*------------------------------------------------------           16480000
038500* 9010-SELECT-STRT-DATE.                                          16490000
038600*     SELECT THE STRT DATE OF THE PROMOTION.                      16500000
038700*------------------------------------------------------           16510000
038800 9010-SELECT-STRT-DATE.                                           16520000
038900                                                                  16530000
039000     PERFORM                                                      16540000
039100         WITH TEST AFTER                                          16550000
039200         VARYING PV-SQL-SUB                                       16560000
039300         FROM 1 BY 1                                              16570000
039400         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 16580000
039500                   OR  SQLCODE NOT = -904 AND -911 AND -913)      16590000
039710                                                                  16600000
039720         EXEC SQL                                                 16610000
039730             SELECT  ACTL_END_TMST                                16620000
039740               INTO :PV-ACT-STRT-TMST                             16630000
039750               FROM  XST_PROMO                                    16640000
039760              WHERE  PROMO_ID   = :XST00026-PROMO-ID              16650000
039780              WITH UR                                             16660000
039790         END-EXEC                                                 16670000
039800                                                                  16680000
039801         EVALUATE TRUE                                            16690000
039802             WHEN SQLCODE = -904                                  16700000
039803             WHEN SQLCODE = -911                                  16710000
039804             WHEN SQLCODE = -913                                  16720000
039805                  CONTINUE                                        16730000
039806             WHEN SQLCODE = 0                                     16740000
039807                  MOVE PV-ACT-STRT-TMST  TO PV-PROMO-STRT-DTE-TM  16750000
039808                  MOVE PV-PROMO-STRT-DTE TO PV-PRICE-STRT-DTE     16760000
039809             WHEN OTHER                                           16770000
039810                  MOVE SPACES TO PV-PRICE-STRT-DTE                16780000
039811         END-EVALUATE                                             16790000
039812     END-PERFORM.                                                 16800000
039813                                                                  16810000
039814     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         16820000
039815        MOVE SPACES TO PV-PRICE-STRT-DTE                          16830000
039816     END-IF.                                                      16840000
039817                                                                  16850000
039818     INITIALIZE PV-SQL-SUB.                                       16860000
039819                                                                  16870000
039820*9010-EXIT.                                                       16880000
039821 EJECT.                                                           16890000
039822                                                                  16900000
039823*----------------------------------------------------------       16910000
039830* 9100-FORMAT-DATE-INFO.                                          16920000
039840*     FORMATS THE DATE FOR COMPARING.                             16930000
039850*----------------------------------------------------------       16940000
039860 9100-FORMAT-DATE-INFO.                                           16950000
039870                                                                  16960000
039880     MOVE PV-PRICE-DTE-CH-CCYY   TO PV-PRICE-DTE-CCYY.            16970000
039890     MOVE PV-PRICE-DTE-CH-MM     TO PV-PRICE-DTE-MM.              16980000
039900     MOVE PV-PRICE-DTE-CH-DD     TO PV-PRICE-DTE-DD.              16990000
040000                                                                  17000000
040100*9100-EXIT.                                                       17010000
040200 EJECT.                                                           17020000
040300                                                                  17030000
040400*----------------------------------------------------------       17040000
040500* 9999-WRAPUP.                                                    17050000
040600*     MOVES ALL ERROR CODES TO THE LINKAGE VARIABLES TO           17060000
040700*     BE PASSED BACK TO THE CALLING PROGRAM.  EXITS THE           17070000
040800*     PROGRAM.                                                    17080000
040900*----------------------------------------------------------       17090000
041000 9999-WRAPUP.                                                     17100000
041100                                                                  17110000
041200     MOVE PV-PGM-STATUS-CDE TO LV-PGM-STATUS-CDE.                 17120000
041300     MOVE PV-SQL-CODE       TO LV-LD-SQL-RETURN-CDE.              17130000
041400     MOVE PV-LD-STATUS-CDE  TO LV-LD-SEVERITY-LVL.                17140000
041500                                                                  17150000
041600*9999-EXIT.                                                       17160000
041700 EJECT.                                                           17170000
041800                                                                  17180000
