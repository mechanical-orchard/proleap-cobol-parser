000100*----------------------------------------------------------       00010009
000200 IDENTIFICATION DIVISION.                                         00020009
000300*----------------------------------------------------------       00030009
000400 PROGRAM-ID.    EPKUP103.                                         00040009
000500 AUTHOR.        ALEXIS KEIKER.                                    00050009
000600 DATE-WRITTEN.  OCTOBER 1, 2002.                                  00060009
000700                                                                  00070009
000800*----------------------------------------------------------       00080009
000900*      UPDATE SKU ATTRIBUTE TABLE FOR OLD SKUS                    00090009
001000*----------------------------------------------------------       00100009
001100* THIS PROGRAM TAKES IN A CONTROL CARD WITH TODAYS DATE           00110074
001200* IT WILL THEN GO OUT TO THE TEPITM TABLE AND GET ALL             00120074
001300* THE SALES INFORMATION FOR THE LAST THREE MONTHS AND LOAD        00130074
001400* THEM TO INTERNAL TABLES. ONCE THIS IS FINISHED, IT WILL         00140074
001500* FETCH ANY RECORDS OUT ON THE SKU LOCATION TABLE THAT            00150074
001600* ARE CLEARANCE RECORDS AND HAVE A STATUS CHANGE OF OVER          00160074
001700* SEVEN MONTHS AGO.  IT WILL THEN GRAB THE SKU NUMBER             00170074
001800* AND CHECK THE INTERNAL TABLES TO SEE IF THERE WERE ANY          00180074
001900* RECENT SALES. IF IN THE LAST THREE MONTHS THERE WERE            00190074
002000* MORE THAN 5 ITEMS SOLD FOR AT LEAST ONE OF THE MONTHS           00200074
002100* THAN THE RECORD WILL NOT BE EXCLUDED.  IF ALL THREE             00210074
002200* MONTHS HAD LESS THAN 5 ITEMS SOLD, THE PROGRAM WILL             00220074
002300* UPDATE THE SKU ATTRIBUTE TABLE BY CHANGING THE                  00230074
002400* PLU DOWNLOAD EXCLUSION INDICATOR TO YES TO EXCLUDE              00240074
002500* THIS INTERNAL UPC ID. THE PROGRAM ALSO WILL NOT UPDATE          00250074
002600* A RECORD IF THERE ARE OTHER STORE RECORDS OUT THERE THAT        00260074
002700* DONT FIT THE CRITERIA EITHER.                                   00270074
002800*                                                                 00280074
002900*       BUSINESS RULES FOR EXCLUDING AN INTERNAL UPC ID           00290074
003000*             1. MUST BE A CLEARANCE STATUS CODE                  00300074
003100*             2. MUST HAVE A STATUS CODE CHANGE                   00310074
003200*                THAT HAPPENED OVER 24 MONTHS AGO                 00320099
003300*             3. SALES OF THIS ITEM MUST BE 5 OR LESS             00330079
003400*                FOR EACH OF THE LAST THREE MONTHS                00340074
003500*             4. IF THERE ARE ANY STORE RECORDS FOR               00350074
003600*                THE INTERNAL UPC ID, THEY ALL MUST               00360074
003700*                FIT THE CRITERIA ABOVE ALSO                      00370074
003800*                                                                 00380074
003900*----------------------------------------------------------       00390009
004000* HISTORY LOG:                                                    00400009
004100*                                                                 00410009
004200* DATE: 09/06/13                                                  00420099
004300* WR/IR#: CHG0062728 - FSH 2013                                   00430099
004400* PROGRAMMER: COGNIZANT                                           00440099
004500* DESCRIPTION: REMOVED LOGIC THAT REFERENCING THE FOLLOWING       00450099
004600*              HISTORY TABLES.                                    00460099
004700*              TEPITMH                                            00470099
004800*              TEPTRNH                                            00480099
004900*----------------------------------------------------------       00490009
005000* DATE: 08/02/21                                                  00500099
005100* WR/IR#:                                                         00510099
005200* PROGRAMMER: GERMAN BANDA                                        00520099
005300* DESCRIPTION:CHANGE TO BUSINESS RULE #2 FROM 7 MONTHS TO 24      00530099
005310*      2. MUST HAVE A STATUS CODE CHANGE                          00531099
005320*         THAT HAPPENED OVER *24* MONTHS AGO                      00532099
005330* CHANGE 1300-GET-FISCAL-INFO FROM 7 MONTHS TO 24 MONTHS          00533099
005400*----------------------------------------------------------       00540099
005410* DATE: MM/DD/YY                                                  00541099
005420* WR/IR#:                                                         00542099
005430* PROGRAMMER:                                                     00543099
005440* DESCRIPTION:                                                    00544099
005450*----------------------------------------------------------       00545099
005500 ENVIRONMENT DIVISION.                                            00550009
005600*----------------------------------------------------------       00560009
005700 CONFIGURATION SECTION.                                           00570009
005800 SOURCE-COMPUTER. IBM-3090.                                       00580009
005900 OBJECT-COMPUTER. IBM-3090.                                       00590009
006000                                                                  00600009
006100 INPUT-OUTPUT SECTION.                                            00610009
006200                                                                  00620009
006300 FILE-CONTROL.                                                    00630009
006400                                                                  00640009
006500     SELECT DATE-CONTROL-CARD                                     00650009
006600       ASSIGN TO INP01.                                           00660009
006700                                                                  00670083
006800     SELECT EXCL-SKU-EXTRACT-FILE                                 00680083
006900       ASSIGN TO OUT01.                                           00690083
007000                                                                  00700009
007100*----------------------------------------------------------       00710009
007200 DATA DIVISION.                                                   00720009
007300*----------------------------------------------------------       00730009
007400 FILE SECTION.                                                    00740009
007500                                                                  00750009
007600 FD  DATE-CONTROL-CARD                                            00760009
007700     RECORDING MODE IS F                                          00770009
007800     BLOCK CONTAINS 0 CHARACTERS                                  00780009
007900     LABEL RECORDS ARE STANDARD.                                  00790009
008000                                                                  00800009
008100 01  CONTROL-RECORD                PIC X(80).                     00810009
008200                                                                  00820083
008300 FD  EXCL-SKU-EXTRACT-FILE                                        00830083
008400     RECORDING MODE IS F                                          00840083
008500     BLOCK CONTAINS 0  RECORDS                                    00850083
008600     LABEL RECORDS ARE STANDARD                                   00860083
008700     RECORD CONTAINS 50 CHARACTERS                                00870083
008800     DATA RECORDS ARE EXCL-SKU-EXTRACT-REC.                       00880083
008900                                                                  00890083
009000 01  EXCL-SKU-EXTRACT-REC          PIC X(50).                     00900083
009100                                                                  00910009
009200 WORKING-STORAGE SECTION.                                         00920009
009300*----------------------------------------------------             00930009
009400 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      00940009
009500                                                  COMP SYNC.      00950009
009600     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    00960009
009700     88  AC-DB2-ERROR                             VALUE +4013.    00970009
009800     88  AC-CALENDAR-ROUTINE-ERROR                VALUE +4019.    00980009
009900                                                                  00990009
010000*---------------------------------------------                    01000074
010100* PC- PROGRAM CONSTANTS                                           01010009
010200*---------------------------------------------                    01020009
010300 01  PC-PROGRAM-CONSTANTS.                                        01030009
010400     05  PC-CURRENT-PROGRAM-NAME       PIC X(08)                  01040009
010500                                             VALUE 'EPKUP103'.    01050009
010600     05  PC-MAX-RETRIES                PIC S9(04) VALUE +5 COMP.  01060009
010700     05  PC-MAX-ITEMS-TABLE            PIC S9(11) VALUE 950000    01070089
010800                                              COMP.               01080009
010900     05  PC-MONTHS-BACK                PIC 9(02) VALUE 3.         01090059
011000     05  PC-MINIMUM-SALES              PIC 9(10) VALUE 5.         01100059
011100     05  PC-COMMIT-MAX                 PIC 9(04) VALUE 999.       01110066
011200                                                                  01120066
011300                                                                  01130009
011400*---------------------------------------------                    01140009
011500* PS- PROGRAM SWITCHES                                            01150009
011600*---------------------------------------------                    01160009
011700 01  PS-PROGRAM-SWITCHES.                                         01170009
011800     05  PS-END-OF-SKU-CURSOR-SW       PIC X(01)  VALUE 'N'.      01180009
011900         88  PS-END-OF-SKU-CURSOR                 VALUE 'Y'.      01190009
012000         88  PS-NOT-EOF-SKU-CURSOR                VALUE 'N'.      01200009
012100     05  PS-END-OF-D927-CURSOR-SW      PIC X(01)  VALUE 'N'.      01210099
012200         88  PS-END-OF-D927-CURSOR                VALUE 'Y'.      01220099
012300         88  PS-NOT-EOF-D927-CURSOR               VALUE 'N'.      01230099
012400     05  PS-END-OF-CARD-FILE-SW        PIC X(01)  VALUE 'N'.      01240009
012500         88  PS-END-OF-CARD-FILE                  VALUE 'Y'.      01250009
012600     05  PS-EXCLUDE-FLAG-SW            PIC  X(01) VALUE 'N'.      01260056
012700         88  PS-NOT-EXCLUDE-RECORD                VALUE 'N'.      01270056
012800         88  PS-EXCLUDE-RECORD                    VALUE 'Y'.      01280056
012900     05  PS-SEARCH-PROC-SW             PIC  X(01) VALUE 'N'.      01290056
013000         88  PS-END-OF-SEARCH                     VALUE 'Y'.      01300068
013100         88  PS-NOT-END-OF-SEARCH                 VALUE 'N'.      01310068
013200     05  PS-ITEM-FOUND-SW              PIC  X(01) VALUE 'N'.      01320056
013300         88  PS-ITEM-FOUND                        VALUE 'Y'.      01330068
013400         88  PS-ITEM-NOT-FOUND                    VALUE 'N'.      01340068
013500     05  PS-SKIP-PROC-SW               PIC  X(01) VALUE 'N'.      01350056
013600         88  PS-SKIP-RECORD                       VALUE 'Y'.      01360056
013700         88  PS-DONT-SKIP-RECORD                  VALUE 'N'.      01370056
013800                                                                  01380009
013900*---------------------------------------------                    01390009
014000* PV- PROGRAM WORKING VARIABLES                                   01400009
014100*---------------------------------------------                    01410009
014200 01  PV-PROGRAM-VARIABLES.                                        01420009
014300     05  PV-PARAGRAPH-NAME             PIC X(30) VALUE SPACE.     01430009
014400     05  PV-DB2-OPERATION              PIC X(30) VALUE SPACE.     01440009
014500     05  PV-SQL-SUB                    PIC S9(4) VALUE +0 COMP.   01450009
014600     05  PV-SUM-SLD-QTY                PIC S9(09) COMP-3.         01460074
014700     05  PV-TOTAL-SLD-QTY              PIC 9(10) VALUE 0.         01470059
014800     05  PV-SAVE-SLD-QTY               PIC S9(09) VALUE +0 COMP-3.01480056
014900     05  PV-OPERATION-MSG-1            PIC X(40)  VALUE SPACE.    01490031
015000     05  PV-OPERATION-MSG-2            PIC X(40)  VALUE SPACE.    01500031
015100     05  PV-INTR-UPC-ID                PIC S9(9)  VALUE +0 COMP.  01510038
015200     05  PV-INTR-UPC-ID-NUM            PIC 9(10)  VALUE 0 COMP.   01520083
015300     05  PV-SAVE-SKU-NBR               PIC S9(08) VALUE +0        01530014
015400                                                 COMP-3.          01540016
015500     05  PV-SRCH-SKU-NBR               PIC S9(08) VALUE ZERO      01550018
015600                                                 COMP-3.          01560016
015700     05  PV-SKU-MAX-SUB-M1             PIC S9(9) VALUE ZERO       01570016
015800                                                  COMP.           01580009
015900     05  PV-SKU-MAX-SUB-M2             PIC S9(9) VALUE ZERO       01590016
016000                                                  COMP.           01600009
016100     05  PV-SKU-MAX-SUB-M3             PIC S9(9) VALUE ZERO       01610016
016200                                                 COMP.            01620016
016300     05  PV-CHECK-COUNT                PIC 9(3)  VALUE 0.         01630031
016400     05  PV-MIN-1-MO-DTE               PIC X(10) VALUE SPACES.    01640016
016500     05  PV-MAX-1-MO-DTE               PIC X(10) VALUE SPACES.    01650016
016600     05  PV-MIN-2-MO-DTE               PIC X(10) VALUE SPACES.    01660016
016700     05  PV-MAX-2-MO-DTE               PIC X(10) VALUE SPACES.    01670016
016800     05  PV-MIN-3-MO-DTE               PIC X(10) VALUE SPACES.    01680016
016900     05  PV-MAX-3-MO-DTE               PIC X(10) VALUE SPACES.    01690016
017000     05  PV-STAT-CHG-DATE              PIC X(10) VALUE SPACES.    01700016
017100     05  PV-PARM-DATE                  PIC X(10) VALUE SPACES.    01710099
017200     05  PV-D927-CHG-DATE              PIC X(10) VALUE SPACES.    01720099
017300     05  PV-D927-CHG-DATE-R REDEFINES PV-D927-CHG-DATE.           01730099
017400         10  PV-D927-CHG-DATE-CC       PIC 9(02).                 01740099
017500         10  PV-D927-CHG-DATE-YR       PIC 9(02).                 01750099
017600         10  FILLER                    PIC X.                     01760099
017700         10  PV-D927-CHG-DATE-MM       PIC 9(02).                 01770099
017800         10  FILLER                    PIC X.                     01780099
017900         10  PV-D927-CHG-DATE-DD       PIC 9(02).                 01790099
018000     05  PV-D927-LAST-SALES-CHK-N      PIC 9(07).                 01800099
018100     05  PV-D927-LAST-SALES-CHK-R                                 01810099
018200                      REDEFINES PV-D927-LAST-SALES-CHK-N.         01820099
018300         10  PV-D927-LAST-SALES-CHK-FIL PIC 9.                    01830099
018400         10  PV-D927-LAST-SALES-CHK-YR PIC 99.                    01840099
018500         10  PV-D927-LAST-SALES-CHK-MM PIC 99.                    01850099
018600         10  PV-D927-LAST-SALES-CHK-DD PIC 99.                    01860099
018700     05  PV-D927-LAST-SALES-CHK        PIC S9(07) COMP-3.         01870099
018800     05  PV-MIN-REG-DTE                PIC X(10) VALUE SPACES.    01880016
018900     05  PV-DATE-MIN                   PIC X(10) VALUE SPACES.    01890016
019000     05  PV-DATE-MAX                   PIC X(10) VALUE SPACES.    01900016
019100                                                                  01910009
019200     05  PV-PRCS-DATE-CCYYMMDD.                                   01920014
019300         10 PV-PRCS-DATE-CCYY          PIC 9(04).                 01930014
019400         10 FILLER                     PIC X(01).                 01940014
019500         10 PV-PRCS-DATE-MM            PIC 9(02).                 01950014
019600         10 FILLER                     PIC X(01).                 01960014
019700         10 PV-PRCS-DATE-DD            PIC 9(02).                 01970014
019800                                                                  01980014
019900     05  PV-SAVE-DATE.                                            01990009
020000         10  PV-DTE-CC                 PIC X(02) VALUE SPACES.    02000044
020100         10  PV-DTE-YY                 PIC X(02) VALUE SPACES.    02010044
020200         10  FILLER                    PIC X(01) VALUE SPACES.    02020044
020300         10  PV-DTE-MM                 PIC X(02) VALUE SPACES.    02030044
020400         10  FILLER                    PIC X(01) VALUE SPACES.    02040044
020500         10  PV-DTE-DD                 PIC X(02) VALUE SPACES.    02050044
020600                                                                  02060009
020700     05  PV-SAVE-DTE-MMDDYY.                                      02070009
020800         10  PV-FORMAT-MM              PIC 9(02) VALUE 0.         02080009
020900         10  PV-FORMAT-DD              PIC 9(02) VALUE 0.         02090009
021000         10  PV-FORMAT-YY              PIC 9(02) VALUE 0.         02100009
021100                                                                  02110009
021200     05  PV-CURRENT-FISCAL-PRD-YYPP.                              02120009
021300         10  PV-CURRENT-FISCAL-PRD-YEAR         PIC  9(02).       02130009
021400         10  PV-CURRENT-FISCAL-PRD-NBR          PIC  9(02).       02140009
021500                                                                  02150009
021600*---------------------------------------------                    02160073
021700* PV- PROGRAM COUNTERS                                            02170083
021800*---------------------------------------------                    02180073
021900 01  PV-PROGRAM-COUNTERS.                                         02190083
022000     05  PV-COUNT-FETCH-RECS           PIC 9(09) VALUE 0.         02200083
022100     05  PV-COUNT-SKU-RECS             PIC 9(09) VALUE 0.         02210083
022200     05  PV-COUNT-EXCL-RECS            PIC 9(09) VALUE 0.         02220083
022300     05  PV-RECENT-SALES               PIC S9(9) VALUE ZERO       02230083
022400                                                 COMP-3.          02240083
022500     05  PV-COMMIT-COUNT               PIC 9(04) VALUE 0.         02250083
022600                                                                  02260073
022700*-------------------------------------------------                02270009
022800*  TABLES TO HOLD 3 MONTHS WORTH OF SALES DATA                    02280014
022900*-------------------------------------------------                02290009
023000 01  SKU-CLEARANCE-TABLE-1.                                       02300014
023100     05  TB1-SKU-TABLE-CLEAR        OCCURS 950000 TIMES           02310089
023200                                   INDEXED BY TB1-INDX.           02320009
023300         10  TB1-SKU-NBR-CLEAR      PIC S9(08) COMP-3.            02330009
023400         10  TB1-SLD-QTY            PIC S9(09) COMP-3.            02340009
023500                                                                  02350009
023600 01  SKU-CLEARANCE-TABLE-2.                                       02360014
023700     05  TB2-SKU-TABLE-CLEAR        OCCURS 950000 TIMES           02370089
023800                                   INDEXED BY TB2-INDX.           02380009
023900         10  TB2-SKU-NBR-CLEAR      PIC S9(08) COMP-3.            02390009
024000         10  TB2-SLD-QTY            PIC S9(09) COMP-3.            02400009
024100                                                                  02410009
024200 01  SKU-CLEARANCE-TABLE-3.                                       02420014
024300     05  TB3-SKU-TABLE-CLEAR        OCCURS 950000 TIMES           02430089
024400                                   INDEXED BY TB3-INDX.           02440014
024500         10  TB3-SKU-NBR-CLEAR      PIC S9(08) COMP-3.            02450014
024600         10  TB3-SLD-QTY            PIC S9(09) COMP-3.            02460014
024700                                                                  02470014
024800*---------------------------------------------                    02480044
024900* CONTROL CARD LAYOUT FOR TODAY'S DATE                            02490044
025000*---------------------------------------------                    02500044
025100     COPY EPWS140.                                                02510044
025200                                                                  02520084
025300*---------------------------------------------                    02530084
025400* OUTPUT FILE LAYOUT - INTERNAL UPC ID & SKU                      02540084
025500*---------------------------------------------                    02550084
025600     COPY EPRD132.                                                02560084
025700                                                                  02570044
025800*---------------------------------------------                    02580025
025900*  DATE ROUTINE WORK AREA.                                        02590025
026000*---------------------------------------------                    02600025
026100     COPY DPWS500.                                                02610043
026200                                                                  02620025
026300*---------------------------------------------                    02630009
026400*  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            02640009
026500*---------------------------------------------                    02650009
026600     COPY DPWS004.                                                02660009
026700                                                                  02670009
026800*---------------------------------------------                    02680009
026900*  DB2 COMMUNICATION AREA.                                        02690009
027000*---------------------------------------------                    02700009
027100     EXEC SQL                                                     02710009
027200          INCLUDE SQLCA                                           02720009
027300     END-EXEC.                                                    02730009
027400                                                                  02740009
027500*---------------------------------------------                    02750009
027600*  DB2 TABLE XST00008 - SKU LOCATION TABLE(XST_SKU_LOC)           02760009
027700*---------------------------------------------                    02770009
027800     EXEC SQL                                                     02780009
027900          INCLUDE XST00008                                        02790009
028000     END-EXEC.                                                    02800009
028100                                                                  02810009
028200*---------------------------------------------                    02820020
028300*  DB2 TABLE XST00010 - SKU TABLE(XST_SKU)                        02830020
028400*---------------------------------------------                    02840020
028500     EXEC SQL                                                     02850020
028600          INCLUDE XST00010                                        02860020
028700     END-EXEC.                                                    02870020
028800                                                                  02880020
028900*---------------------------------------------                    02890009
029000*  DB2 TABLE XST00011 - SKU ATTRIBUTE TABLE(XST_SKU_ATTR)         02900009
029100*---------------------------------------------                    02910009
029200     EXEC SQL                                                     02920009
029300          INCLUDE XST00011                                        02930009
029400     END-EXEC.                                                    02940009
029500                                                                  02950009
029600*---------------------------------------------                    02960099
029700*  DB2 TABLE XST00012 - UPC TABLE(XST_UPC)                        02970099
029800*---------------------------------------------                    02980099
029900     EXEC SQL                                                     02990099
030000          INCLUDE XST00012                                        03000099
030100     END-EXEC.                                                    03010099
030200                                                                  03020099
030300*---------------------------------------------                    03030099
030400*  DB2 TABLE XST00013 - SKU ATTRIBUTE TABLE(XST_VND_STYL)         03040099
030500*---------------------------------------------                    03050099
030600     EXEC SQL                                                     03060099
030700          INCLUDE XST00013                                        03070099
030800     END-EXEC.                                                    03080099
030900                                                                  03090099
031000*---------------------------------------------                    03100099
031100*  DB2 TABLE TSKST    - STORE/SKU TABLE                           03110099
031200*---------------------------------------------                    03120099
031300     EXEC SQL                                                     03130099
031400          INCLUDE TSKST                                           03140099
031500     END-EXEC.                                                    03150099
031600                                                                  03160099
031700*---------------------------------------------                    03170099
031800*  DB2 TABLE TUPCSKU  - UPC/SKU TABLE                             03180099
031900*---------------------------------------------                    03190099
032000     EXEC SQL                                                     03200099
032100          INCLUDE TUPCSKU                                         03210099
032200     END-EXEC.                                                    03220099
032300                                                                  03230099
032400*---------------------------------------------                    03240099
032500*  DB2 TABLE TEPPART - PARTITION TABLE                            03250009
032600*---------------------------------------------                    03260009
032700     EXEC SQL                                                     03270009
032800          INCLUDE TEPPART                                         03280009
032900     END-EXEC.                                                    03290009
033000                                                                  03300009
033100*---------------------------------------------                    03310009
033200*  DB2 TABLE TEPTRN - TRANSACTION TABLE                           03320009
033300*---------------------------------------------                    03330009
033400     EXEC SQL                                                     03340009
033500          INCLUDE TEPTRN                                          03350009
033600     END-EXEC.                                                    03360006
033700                                                                  03370006
033800*---------------------------------------------                    03380006
033900*  DB2 TABLE TEPITM - ITEM TABLE                                  03390006
034000*---------------------------------------------                    03400006
034100     EXEC SQL                                                     03410006
034200          INCLUDE TEPITM                                          03420006
034300     END-EXEC.                                                    03430006
034400                                                                  03440006
034500*---------------------------------------------                    03450099
034600*  DB2 TABLE TFV_CLBK_MDSE CALL BACK VIEW                         03460099
034700*---------------------------------------------                    03470099
034800     EXEC SQL                                                     03480099
034900          INCLUDE TFV00000                                        03490099
035000     END-EXEC.                                                    03500099
035100                                                                  03510099
035200*---------------------------------------------                    03520099
035300*  ATTR-SKU-CURSOR WILL FETCH ALL SKUS THAT ARE                   03530072
035400*  ON CLEARANCE AND HAVE NOT BEEN HAD A STATUS                    03540072
035500*  UPDATE FOR 24 MONTHS OR MORE.                                  03550099
035600*---------------------------------------------                    03560001
035700     EXEC SQL                                                     03570001
035800       DECLARE ATTR-SKU-CURSOR CURSOR WITH HOLD FOR               03580093
035900            SELECT LOC.INTR_UPC_ID                                03590099
036000                  ,SKU.SKU_NBR                                    03600099
036100                  ,SKU.REGN_PRIC_IND                              03610099
036200            FROM   XST_SKU_LOC  LOC                               03620099
036300                  ,XST_SKU SKU                                    03630099
036400                  ,XST_SKU_ATTR ATTR                              03640099
036500            WHERE  LOC.INTR_UPC_ID         = SKU.INTR_UPC_ID      03650099
036600              AND  SKU.INTR_UPC_ID         = ATTR.INTR_UPC_ID     03660099
036700              AND  LOC.INTR_UPC_ID         > :PV-INTR-UPC-ID      03670099
036800              AND  LOC.LOC_NBR             = 0                    03680099
036900              AND  LOC.LOC_SKU_STAT_CDE    = '30'                 03690099
037000              AND  LOC.ORIG_CLR_DTE        < :PV-STAT-CHG-DATE    03700099
037100              AND  LOC.END_TMST            IS NULL                03710099
037200              AND  ATTR.PLU_DWNLD_EXCL_IND = 'N'                  03720099
037300              AND NOT EXISTS (SELECT 1                            03730099
037400                   FROM TFV_CLBK_MDSE  CB_MDSE                    03740099
037500                   WHERE CB_MDSE.SKU_NBR   = SKU.SKU_NBR)         03750099
037600              AND NOT EXISTS (SELECT 1                            03760099
037700                   FROM XST_VND_STYL VND                          03770099
037800                   WHERE SKU.STYL_ID = VND.STYL_ID                03780099
037900                     AND VND.DEPT_NBR = 927                       03790099
038000                     AND VND.MAJ_CL_NBR = 90)                     03800099
038100           UNION                                                  03810099
038200            SELECT LOC1.INTR_UPC_ID                               03820099
038300                  ,SKU1.SKU_NBR                                   03830099
038400                  ,SKU1.REGN_PRIC_IND                             03840099
038500            FROM   XST_SKU_LOC  LOC1                              03850099
038600                  ,XST_SKU SKU1                                   03860099
038700                  ,XST_SKU_ATTR ATTR1                             03870099
038800                  ,TFV_CLBK_MDSE  CB_MDSE2                        03880099
038900            WHERE  LOC1.INTR_UPC_ID         = SKU1.INTR_UPC_ID    03890099
039000              AND  SKU1.INTR_UPC_ID         = ATTR1.INTR_UPC_ID   03900099
039100              AND  LOC1.INTR_UPC_ID         > :PV-INTR-UPC-ID     03910099
039200              AND  LOC1.LOC_NBR             = 0                   03920099
039300              AND  LOC1.LOC_SKU_STAT_CDE    = '30'                03930099
039400              AND  LOC1.ORIG_CLR_DTE        < :PV-STAT-CHG-DATE   03940099
039500              AND  LOC1.END_TMST            IS NULL               03950099
039600              AND  ATTR1.PLU_DWNLD_EXCL_IND = 'N'                 03960099
039700              AND CB_MDSE2.SKU_NBR         = SKU1.SKU_NBR         03970099
039800              AND (CB_MDSE2.EFF_BEG_DTE    > :PV-PARM-DATE        03980099
039900               OR  CB_MDSE2.EFF_END_DTE    < :PV-PARM-DATE)       03990099
040000              AND NOT EXISTS (SELECT 1                            04000099
040100                   FROM XST_VND_STYL VND                          04010099
040200                   WHERE SKU1.STYL_ID = VND.STYL_ID               04020099
040300                     AND VND.DEPT_NBR = 927                       04030099
040400                     AND VND.MAJ_CL_NBR = 90)                     04040099
040500            ORDER BY INTR_UPC_ID                                  04050099
040600              WITH UR                                             04060001
040700     END-EXEC.                                                    04070001
040800                                                                  04080001
040900*---------------------------------------------                    04090099
041000*  D927-SKU-CURSOR WILL FETCH ALL SKUS THAT ARE                   04100099
041100*  ON CLEARANCE AND HAVE NOT BEEN HAD A STATUS                    04110099
041200*  UPDATE FOR 12 MONTHS OR MORE FOR DEPT 927                      04120099
041300*  MAJ CLASS 90                                                   04130099
041400*---------------------------------------------                    04140099
041500     EXEC SQL                                                     04150099
041600       DECLARE D927-SKU-CURSOR CURSOR WITH HOLD FOR               04160099
041700            SELECT LOC.INTR_UPC_ID                                04170099
041800                  ,SKU.SKU_NBR                                    04180099
041900                  ,SKU.REGN_PRIC_IND                              04190099
042000            FROM   XST_SKU_LOC  LOC                               04200099
042100                  ,XST_SKU SKU                                    04210099
042200                  ,XST_SKU_ATTR ATTR                              04220099
042300                  ,XST_VND_STYL VND                               04230099
042400                  ,XST_UPC UPC                                    04240099
042500                  ,TUPCSKU TUPC                                   04250099
042600                  ,TSKST TSK                                      04260099
042700            WHERE  LOC.INTR_UPC_ID         = SKU.INTR_UPC_ID      04270099
042800              AND  SKU.INTR_UPC_ID         = ATTR.INTR_UPC_ID     04280099
042900              AND  SKU.STYL_ID             = VND.STYL_ID          04290099
043000              AND  SKU.INTR_UPC_ID         = UPC.INTR_UPC_ID      04300099
043100              AND  UPC.UPC_NBR             = TUPC.UPC_NBR         04310099
043200              AND  TUPC.ITEM_NBR           = TSK.ITEM_NMBR        04320099
043300              AND  LOC.INTR_UPC_ID         > :PV-INTR-UPC-ID      04330099
043400              AND  LOC.LOC_NBR             = 0                    04340099
043500              AND  TSK.LOC_NBR             = 0                    04350099
043600              AND  LOC.LOC_SKU_STAT_CDE    = '30'                 04360099
043700              AND  LOC.ORIG_CLR_DTE        < :PV-D927-CHG-DATE    04370099
043800              AND  TSK.LAST_SALE_DATE   < :PV-D927-LAST-SALES-CHK 04380099
043900              AND  LOC.END_TMST            IS NULL                04390099
044000              AND  ATTR.PLU_DWNLD_EXCL_IND = 'N'                  04400099
044100              AND  VND.DEPT_NBR = 927                             04410099
044200              AND  VND.MAJ_CL_NBR = 90                            04420099
044300              AND NOT EXISTS (SELECT 1                            04430099
044400                   FROM TFV_CLBK_MDSE  CB_MDSE                    04440099
044500                   WHERE CB_MDSE.SKU_NBR   = SKU.SKU_NBR)         04450099
044600           UNION                                                  04460099
044700            SELECT LOC1.INTR_UPC_ID                               04470099
044800                  ,SKU1.SKU_NBR                                   04480099
044900                  ,SKU1.REGN_PRIC_IND                             04490099
045000            FROM   XST_SKU_LOC  LOC1                              04500099
045100                  ,XST_SKU SKU1                                   04510099
045200                  ,XST_SKU_ATTR ATTR1                             04520099
045300                  ,TFV_CLBK_MDSE  CB_MDSE2                        04530099
045400                  ,XST_VND_STYL VND1                              04540099
045500                  ,XST_UPC UPC1                                   04550099
045600                  ,TUPCSKU TUPC1                                  04560099
045700                  ,TSKST TSK1                                     04570099
045800            WHERE  LOC1.INTR_UPC_ID         = SKU1.INTR_UPC_ID    04580099
045900              AND  SKU1.INTR_UPC_ID         = ATTR1.INTR_UPC_ID   04590099
046000              AND  SKU1.STYL_ID             = VND1.STYL_ID        04600099
046100              AND  SKU1.INTR_UPC_ID         = UPC1.INTR_UPC_ID    04610099
046200              AND  UPC1.UPC_NBR             = TUPC1.UPC_NBR       04620099
046300              AND  TUPC1.ITEM_NBR           = TSK1.ITEM_NMBR      04630099
046400              AND  LOC1.INTR_UPC_ID         > :PV-INTR-UPC-ID     04640099
046500              AND  LOC1.LOC_NBR             = 0                   04650099
046600              AND  TSK1.LOC_NBR             = 0                   04660099
046700              AND  LOC1.LOC_SKU_STAT_CDE    = '30'                04670099
046800              AND  LOC1.ORIG_CLR_DTE        < :PV-D927-CHG-DATE   04680099
046900              AND  LOC1.END_TMST            IS NULL               04690099
047000              AND  ATTR1.PLU_DWNLD_EXCL_IND = 'N'                 04700099
047100              AND CB_MDSE2.SKU_NBR         = SKU1.SKU_NBR         04710099
047200              AND (CB_MDSE2.EFF_BEG_DTE    > :PV-PARM-DATE        04720099
047300               OR  CB_MDSE2.EFF_END_DTE    < :PV-PARM-DATE)       04730099
047400              AND  TSK1.LAST_SALE_DATE   < :PV-D927-LAST-SALES-CHK04740099
047500              AND EXISTS (SELECT 1                                04750099
047600                   FROM XST_VND_STYL VND                          04760099
047700                   WHERE SKU1.STYL_ID = VND.STYL_ID               04770099
047800                     AND VND.DEPT_NBR = 927                       04780099
047900                     AND VND.MAJ_CL_NBR = 90)                     04790099
048000            ORDER BY INTR_UPC_ID                                  04800099
048100              WITH UR                                             04810099
048200     END-EXEC.                                                    04820099
048300                                                                  04830099
048400*---------------------------------------------                    04840099
048500*  STORE-SKU-CURSOR CHECKS TO SEE IF THERE ARE                    04850099
048600*  ARE ANY OTHER RECORDS THAT DON'T FALL UNDER                    04860099
048700*  THE BUSINESS RULE CRITERIAS.                                   04870099
048800*---------------------------------------------                    04880099
048900     EXEC SQL                                                     04890099
049000       DECLARE STORE-SKU-CURSOR CURSOR FOR                        04900099
049100            SELECT LOC.LOC_NBR                                    04910099
049200            FROM   XST_SKU_LOC  LOC                               04920099
049300                  ,XST_SKU SKU                                    04930099
049400            WHERE  LOC.INTR_UPC_ID         = SKU.INTR_UPC_ID      04940099
049500              AND  LOC.INTR_UPC_ID         = :PV-INTR-UPC-ID      04950099
049600              AND  LOC.LOC_NBR            <> 0                    04960099
049700              AND ((LOC.LOC_SKU_STAT_CDE   = '30'                 04970099
049800              AND  LOC.UPC_STAT_CHG_DTE   >= :PV-STAT-CHG-DATE)   04980099
049900               OR (LOC.LOC_SKU_STAT_CDE   <> '30'))               04990099
050000              AND  LOC.END_TMST            IS NULL                05000099
050100              AND NOT EXISTS (SELECT 1                            05010099
050200                   FROM XST_VND_STYL VND                          05020099
050300                   WHERE SKU.STYL_ID = VND.STYL_ID                05030099
050400                     AND VND.DEPT_NBR = 927                       05040099
050500                     AND VND.MAJ_CL_NBR = 90)                     05050099
050600              WITH UR                                             05060099
050700     END-EXEC.                                                    05070099
050800                                                                  05080099
050900*---------------------------------------------------------        05090099
051000* CL-ITEM-CURSOR GETS ALL SKU NUMBERS SOLD IN A MONTH.            05100099
051100*---------------------------------------------------------        05110099
051200     EXEC SQL                                                     05120099
051300         DECLARE CL-ITEM-CURSOR CURSOR FOR                        05130099
051400          SELECT ITM.SKU_NBR                                      05140099
051500                ,SUM(CASE WHEN ITM.SAL_RET_CDE = 'R'              05150099
051600                    THEN ITM.SLD_QTY * -1                         05160099
051700                    ELSE ITM.SLD_QTY                              05170005
051800                    END)                                          05180005
051900           FROM TEPITM ITM                                        05190019
052000               ,TEPPART PRT                                       05200019
052100            WHERE  PRT.SLS_DTE BETWEEN :PV-DATE-MIN               05210021
052200                                   AND :PV-DATE-MAX               05220021
052300              AND  PRT.PARTN_NBR         = ITM.PARTN_NBR          05230005
052400              AND  ITM.LIV_RSLU_CDE IN   ('+', '-')               05240005
052500              AND  ITM.ITM_STAT_CDE      = '30'                   05250005
052600              AND  ITM.SAL_RET_CDE       IN ('S', 'R')            05260041
052700              AND  PRT.STR_GP_CDE        = 'A'                    05270005
052800              AND  EXISTS (SELECT 1                               05280023
052900                   FROM TEPTRN TRN                                05290023
053000                   WHERE ITM.PARTN_NBR     = TRN.PARTN_NBR        05300023
053100                     AND ITM.STR_NBR       = TRN.STR_NBR          05310023
053200                     AND ITM.RGST_ID       = TRN.RGST_ID          05320023
053300                     AND ITM.TRN_NBR       = TRN.TRN_NBR          05330023
053400                     AND ITM.STRT_TM       = TRN.STRT_TM          05340023
053500                     AND ITM.SLS_CORR_SEQ_NBR                     05350023
053600                                           = TRN.SLS_CORR_SEQ_NBR 05360023
053700                     AND TRN.TRN_STAT_CDE IN ('V', 'Z', 'R', 'L') 05370023
053800                     AND TRN.TRN_TYP_CDE IN ('01','02','11','12', 05380023
053900                                      '21','22','23','24','25')   05390042
054000                     AND TRN.VOID_ABRT_CDE = 'N')                 05400023
054100              GROUP BY ITM.SKU_NBR                                05410005
054200                   WITH UR                                        05420005
054300     END-EXEC.                                                    05430005
054400                                                                  05440005
054500*----------------------------------------------------------       05450001
054600 PROCEDURE DIVISION.                                              05460001
054700*----------------------------------------------------------       05470001
054800 0000-MAINLINE.                                                   05480001
054900                                                                  05490001
055000     PERFORM 1000-INITIALIZATION.                                 05500009
055100                                                                  05510001
055200     PERFORM 2000-PROCESS-CURSOR                                  05520001
055300       UNTIL PS-END-OF-SKU-CURSOR.                                05530001
055400                                                                  05540001
055500     PERFORM 6200-CLOSE-ATTR-SKU-CURSOR.                          05550099
055600                                                                  05560099
055700     DISPLAY '>>> STARTING TO PROCESS ATTR SKU CURSOR'.           05570099
055800     PERFORM 6600-OPEN-D927-SKU-CURSOR.                           05580099
055900     PERFORM 6700-FETCH-D927-SKU-CURSOR.                          05590099
056000                                                                  05600099
056100     PERFORM 3000-PROCESS-D927-CURSOR                             05610099
056200         UNTIL PS-END-OF-D927-CURSOR.                             05620099
056300                                                                  05630099
056400     PERFORM 6800-CLOSE-D927-SKU-CURSOR.                          05640099
056500                                                                  05650099
056600     PERFORM 4000-END-OF-JOB-ROUTINE.                             05660099
056700                                                                  05670001
056800     GOBACK.                                                      05680001
056900                                                                  05690001
057000*0000-EXIT.                                                       05700001
057100                                                                  05710001
057200*----------------------------------------------------------       05720001
057300* 1000-INITIALIZATION.                                            05730009
057400*     OPENS UP THE INPUT FILE, PERFORMS THE FIRST OPEN AND        05740071
057500*     FETCH OF THE SKU ATTRIBUTE CURSOR.                          05750071
057600*----------------------------------------------------------       05760001
057700 1000-INITIALIZATION.                                             05770009
057800                                                                  05780001
057900     OPEN INPUT DATE-CONTROL-CARD.                                05790005
058000     OPEN OUTPUT EXCL-SKU-EXTRACT-FILE.                           05800083
058100                                                                  05810005
058200     INITIALIZE PV-COUNT-SKU-RECS                                 05820083
058300                PV-COUNT-FETCH-RECS                               05830083
058400                PV-COUNT-EXCL-RECS                                05840083
058500                PV-RECENT-SALES                                   05850083
058600                PV-INTR-UPC-ID                                    05860066
058700                PV-COMMIT-COUNT.                                  05870083
058800                                                                  05880063
058900     PERFORM 1100-READ-DATE-CARD-FILE.                            05890044
059000     IF CC-EPCC140-TODAY-DATE = SPACES                            05900044
059100        DISPLAY 'INVALID CONTROL CARD'                            05910044
059200        DISPLAY 'TODAYS DATE: ' CC-EPCC140-TODAY-DATE             05920044
059300        MOVE '1000-INITIALIZATION' TO PV-PARAGRAPH-NAME           05930044
059400        MOVE 'CONTROL CARD IS INVALID' TO PV-OPERATION-MSG-1      05940044
059500        SET AC-CONTROL-CARD-ERROR TO TRUE                         05950044
059600        PERFORM 9999-ABEND                                        05960044
059700     END-IF.                                                      05970044
059800                                                                  05980044
059900     MOVE CC-EPCC140-TODAY-DATE     TO PV-SAVE-DATE.              05990044
060000     MOVE CC-EPCC140-TODAY-DATE     TO PV-PARM-DATE.              06000099
060100     PERFORM 1200-FORMAT-DATE-INFO.                               06010005
060200     PERFORM 1300-GET-FISCAL-INFO.                                06020008
060300                                                                  06030008
060400     PERFORM 4100-SELECT-PART-TBL-MIN.                            06040016
060500                                                                  06050016
060600     DISPLAY '>>> STARTING 1400 LOAD ITEM TABLES CURRENT'.        06060086
060700     PERFORM 1400-LOAD-ITEM-TABLES-CURRENT.                       06070012
060800                                                                  06080012
060900     DISPLAY '>>> STARTING TO PROCESS ATTR SKU CURSOR'.           06090086
061000     PERFORM 6000-OPEN-ATTR-SKU-CURSOR.                           06100012
061100     PERFORM 6100-FETCH-ATTR-SKU-CURSOR.                          06110012
061200                                                                  06120001
061300*1000-EXIT.                                                       06130009
061400                                                                  06140009
061500*----------------------------------------------------------       06150005
061600* 1100-READ-DATE-CARD-FILE.                                       06160044
061700*     READS THE CONTROL CARD INFORMATION.                         06170005
061800*----------------------------------------------------------       06180005
061900 1100-READ-DATE-CARD-FILE.                                        06190044
062000                                                                  06200005
062100     READ DATE-CONTROL-CARD INTO CC-EPCC140-CONTROL-CARD.         06210044
062200                                                                  06220005
062300*1100-EXIT.                                                       06230044
062400                                                                  06240009
062500*----------------------------------------------------------       06250005
062600* 1200-FORMAT-DATE-INFO.                                          06260005
062700*     FORMATS DATE INFO FOR THE CALENDAR ROUTINE.                 06270018
062800*----------------------------------------------------------       06280005
062900 1200-FORMAT-DATE-INFO.                                           06290005
063000                                                                  06300005
063100     MOVE PV-DTE-YY             TO PV-FORMAT-YY.                  06310005
063200     MOVE PV-DTE-MM             TO PV-FORMAT-MM.                  06320005
063300     MOVE PV-DTE-DD             TO PV-FORMAT-DD.                  06330005
063400                                                                  06340005
063500*1200-EXIT.                                                       06350009
063600                                                                  06360009
063700*-------------------------------------------------------          06370005
063800* 1300-GET-FISCAL-INFO.                                           06380005
063900*     GETS CURRENT FISCAL DATE INFORMATION AND GETS ANY           06390018
064000*     PREVIOUS FISCAL INFORMATION NEEDED.                         06400018
064100*-------------------------------------------------------          06410005
064200 1300-GET-FISCAL-INFO.                                            06420005
064300                                                                  06430005
064400     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         06440005
064500                                                                  06450005
064600     SET DPG51-FISCAL-454-CALENDAR TO TRUE.                       06460005
064700     SET DPG52-LK-DTE-GREG         TO TRUE.                       06470005
064800                                                                  06480005
064900     MOVE PV-SAVE-DTE-MMDDYY TO DPG52-LK-DATE-INPUT.              06490005
065000                                                                  06500005
065100     CALL DP500-KOHLS-CALENDAR-ROUTINE                            06510005
065200       USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                 06520005
065300                                                                  06530005
065400     EVALUATE TRUE                                                06540005
065500         WHEN DPG54-SEVERE-ERROR                                  06550005
065600             DISPLAY ' '                                          06560005
065700             DISPLAY '** ABEND ** IN EPKUP103'                    06570005
065800             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'    06580005
065900             DISPLAY '** CALLED BY 1300-GET-FISCAL-INFO'          06590005
066000             DISPLAY '** ERROR MESSAGE = '                        06600005
066100                               DPG54-ERROR-MESSAGE                06610005
066200             DISPLAY '** DPG51 = ' DPG51                          06620005
066300             DISPLAY '** DPG52 = ' DPG52                          06630005
066400             DISPLAY '** DPG53 = ' DPG53                          06640005
066500             DISPLAY '** DPG54 = ' DPG54                          06650005
066600             DISPLAY '** DPG55 = ' DPG55                          06660005
066700             DISPLAY '** DPG56 = ' DPG56                          06670005
066800             MOVE '1300-GET-FISCAL-INFO'                          06680005
066900                                           TO PV-PARAGRAPH-NAME   06690005
067000             MOVE 'ERROR VALIDATING INPUT CARD DATE'              06700005
067100                                           TO PV-OPERATION-MSG-1  06710005
067200             SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                06720005
067300             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  06730005
067400             PERFORM 9999-ABEND                                   06740005
067500     END-EVALUATE.                                                06750005
067600                                                                  06760005
067700     MOVE DPG56-FISCAL-YEAR-NBR   TO PV-CURRENT-FISCAL-PRD-YEAR.  06770005
067800     MOVE DPG56-FISCAL-PERIOD-NBR TO PV-CURRENT-FISCAL-PRD-NBR.   06780005
067900                                                                  06790006
068000*** GET PRIOR MONTHS FISCAL DATE INFORMATION                      06800006
068100     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         06810006
068200                                                                  06820006
068300     SET DPG51-FISCAL-454-CALENDAR TO TRUE.                       06830006
068400     SET DPG51-DECREMENT-DATE      TO TRUE.                       06840006
068500     SET DPG52-LK-DTE-FISC-PRD     TO TRUE.                       06850006
068600                                                                  06860006
068700     MOVE 1 TO DPG51-INCR-DECR-FISCAL-PRD-9.                      06870006
068800                                                                  06880006
068900     MOVE PV-CURRENT-FISCAL-PRD-YYPP TO DPG52-LK-DATE-INPUT.      06890006
069000                                                                  06900006
069100     CALL DP500-KOHLS-CALENDAR-ROUTINE                            06910006
069200       USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                 06920006
069300                                                                  06930006
069400     EVALUATE TRUE                                                06940006
069500         WHEN DPG54-SEVERE-ERROR                                  06950006
069600             DISPLAY 'TODAYS DATE = ' CC-EPCC140-TODAY-DATE       06960080
069700             DISPLAY ' '                                          06970006
069800             DISPLAY '** ABEND ** IN EPKUP103'                    06980006
069900             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'    06990006
070000             DISPLAY '** CALLED BY 1300-GET-FISCAL-INFO'          07000006
070100             DISPLAY '** ERROR MESSAGE = '                        07010006
070200                               DPG54-ERROR-MESSAGE                07020006
070300             DISPLAY '** DPG51 = ' DPG51                          07030006
070400             DISPLAY '** DPG52 = ' DPG52                          07040006
070500             DISPLAY '** DPG53 = ' DPG53                          07050006
070600             DISPLAY '** DPG54 = ' DPG54                          07060006
070700             DISPLAY '** DPG55 = ' DPG55                          07070006
070800             DISPLAY '** DPG56 = ' DPG56                          07080006
070900             MOVE '1300-GET-FISCAL-INFO'                          07090006
071000                                           TO PV-PARAGRAPH-NAME   07100006
071100             MOVE 'ERROR VALIDATING INPUT CARD DATE'              07110006
071200                                           TO PV-OPERATION-MSG-1  07120006
071300             SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                07130006
071400             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  07140006
071500             PERFORM 9999-ABEND                                   07150006
071600     END-EVALUATE.                                                07160006
071700                                                                  07170006
071800     DISPLAY ' '.                                                 07180026
071900     DISPLAY 'PROGRAM USES 1 MONTH PREVIOUS FISCAL INFORMATION'.  07190014
072000     DISPLAY 'BASED OFF OF THE CONTROL CARD DATE.'.               07200006
072100     DISPLAY ' '.                                                 07210006
072200     DISPLAY 'PROGRAM PROCESSING DATES: '.                        07220006
072300     DISPLAY '  FISCAL BEGINNING DATE: '                          07230006
072400      DPG56-FIRST-FP-DB2-ISO-FMT.                                 07240006
072500     DISPLAY '  FISCAL ENDING DATE   : '                          07250006
072600      DPG56-LAST-FP-DB2-ISO-FMT.                                  07260006
072700                                                                  07270006
072800     MOVE DPG56-FIRST-FP-DB2-ISO-FMT TO PV-MIN-1-MO-DTE.          07280014
072900     MOVE DPG56-LAST-FP-DB2-ISO-FMT  TO PV-MAX-1-MO-DTE.          07290014
073000                                                                  07300006
073100*** GET 2 MONTHS AGO FISCAL DATE INFORMATION                      07310014
073200     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         07320014
073300                                                                  07330014
073400     SET DPG51-FISCAL-454-CALENDAR TO TRUE.                       07340014
073500     SET DPG51-DECREMENT-DATE      TO TRUE.                       07350014
073600     SET DPG52-LK-DTE-FISC-PRD     TO TRUE.                       07360014
073700                                                                  07370014
073800     MOVE 2 TO DPG51-INCR-DECR-FISCAL-PRD-9.                      07380014
073900                                                                  07390014
074000     MOVE PV-CURRENT-FISCAL-PRD-YYPP TO DPG52-LK-DATE-INPUT.      07400014
074100                                                                  07410014
074200     CALL DP500-KOHLS-CALENDAR-ROUTINE                            07420014
074300       USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                 07430014
074400                                                                  07440014
074500     EVALUATE TRUE                                                07450014
074600         WHEN DPG54-SEVERE-ERROR                                  07460014
074700             DISPLAY ' '                                          07470014
074800             DISPLAY '** ABEND ** IN EPKUP103'                    07480014
074900             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'    07490014
075000             DISPLAY '** CALLED BY 1300-GET-FISCAL-INFO'          07500014
075100             DISPLAY '** ERROR MESSAGE = '                        07510014
075200                               DPG54-ERROR-MESSAGE                07520014
075300             DISPLAY '** DPG51 = ' DPG51                          07530014
075400             DISPLAY '** DPG52 = ' DPG52                          07540014
075500             DISPLAY '** DPG53 = ' DPG53                          07550014
075600             DISPLAY '** DPG54 = ' DPG54                          07560014
075700             DISPLAY '** DPG55 = ' DPG55                          07570014
075800             DISPLAY '** DPG56 = ' DPG56                          07580014
075900             MOVE '1300-GET-FISCAL-INFO'                          07590014
076000                                           TO PV-PARAGRAPH-NAME   07600014
076100             MOVE 'ERROR VALIDATING INPUT CARD DATE'              07610014
076200                                           TO PV-OPERATION-MSG-1  07620014
076300             SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                07630014
076400             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  07640014
076500             PERFORM 9999-ABEND                                   07650014
076600     END-EVALUATE.                                                07660014
076700                                                                  07670014
076800     DISPLAY ' '.                                                 07680014
076900     DISPLAY 'PROGRAM USES 2 MONTHS PREVIOUS FISCAL INFORMATION'. 07690014
077000     DISPLAY 'BASED OFF OF THE CONTROL CARD DATE.'.               07700014
077100     DISPLAY ' '.                                                 07710014
077200     DISPLAY 'PROGRAM PROCESSING DATES: '.                        07720014
077300     DISPLAY '  FISCAL BEGINNING DATE: '                          07730014
077400      DPG56-FIRST-FP-DB2-ISO-FMT.                                 07740014
077500     DISPLAY '  FISCAL ENDING DATE   : '                          07750014
077600      DPG56-LAST-FP-DB2-ISO-FMT.                                  07760014
077700                                                                  07770014
077800     MOVE DPG56-FIRST-FP-DB2-ISO-FMT TO PV-MIN-2-MO-DTE.          07780014
077900     MOVE DPG56-LAST-FP-DB2-ISO-FMT  TO PV-MAX-2-MO-DTE.          07790014
078000                                                                  07800014
078100*** GET 3 MONTHS AGO FISCAL DATE INFORMATION                      07810007
078200     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         07820007
078300                                                                  07830007
078400     SET DPG51-FISCAL-454-CALENDAR TO TRUE.                       07840007
078500     SET DPG51-DECREMENT-DATE      TO TRUE.                       07850007
078600     SET DPG52-LK-DTE-FISC-PRD     TO TRUE.                       07860007
078700                                                                  07870007
078800     MOVE 3 TO DPG51-INCR-DECR-FISCAL-PRD-9.                      07880007
078900                                                                  07890007
079000     MOVE PV-CURRENT-FISCAL-PRD-YYPP TO DPG52-LK-DATE-INPUT.      07900007
079100                                                                  07910007
079200     CALL DP500-KOHLS-CALENDAR-ROUTINE                            07920007
079300       USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                 07930007
079400                                                                  07940007
079500     EVALUATE TRUE                                                07950007
079600         WHEN DPG54-SEVERE-ERROR                                  07960007
079700             DISPLAY ' '                                          07970007
079800             DISPLAY '** ABEND ** IN EPKUP103'                    07980007
079900             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'    07990007
080000             DISPLAY '** CALLED BY 1300-GET-FISCAL-INFO'          08000007
080100             DISPLAY '** ERROR MESSAGE = '                        08010007
080200                               DPG54-ERROR-MESSAGE                08020007
080300             DISPLAY '** DPG51 = ' DPG51                          08030007
080400             DISPLAY '** DPG52 = ' DPG52                          08040007
080500             DISPLAY '** DPG53 = ' DPG53                          08050007
080600             DISPLAY '** DPG54 = ' DPG54                          08060007
080700             DISPLAY '** DPG55 = ' DPG55                          08070007
080800             DISPLAY '** DPG56 = ' DPG56                          08080007
080900             MOVE '1300-GET-FISCAL-INFO'                          08090007
081000                                           TO PV-PARAGRAPH-NAME   08100007
081100             MOVE 'ERROR VALIDATING INPUT CARD DATE'              08110007
081200                                           TO PV-OPERATION-MSG-1  08120007
081300             SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                08130007
081400             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  08140007
081500             PERFORM 9999-ABEND                                   08150007
081600     END-EVALUATE.                                                08160007
081700                                                                  08170007
081800     DISPLAY ' '.                                                 08180007
081900     DISPLAY 'PROGRAM USES 3 MONTHS PREVIOUS FISCAL INFORMATION'. 08190014
082000     DISPLAY 'BASED OFF OF THE CONTROL CARD DATE.'.               08200007
082100     DISPLAY ' '.                                                 08210007
082200     DISPLAY 'PROGRAM PROCESSING DATES: '.                        08220007
082300     DISPLAY '  FISCAL BEGINNING DATE: '                          08230007
082400      DPG56-FIRST-FP-DB2-ISO-FMT.                                 08240007
082500     DISPLAY '  FISCAL ENDING DATE   : '                          08250007
082600      DPG56-LAST-FP-DB2-ISO-FMT.                                  08260007
082700                                                                  08270007
082800     MOVE DPG56-FIRST-FP-DB2-ISO-FMT TO PV-MIN-3-MO-DTE.          08280014
082900     MOVE DPG56-LAST-FP-DB2-ISO-FMT  TO PV-MAX-3-MO-DTE.          08290014
083000                                                                  08300005
083100*** GB 08/03/21 - CHANGE FROM 7 TO 24                             08310099
083110*** GET 24 MONTHS AGO FISCAL DATE INFORMATION                     08311099
083200     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         08320005
083300                                                                  08330005
083400     SET DPG51-FISCAL-454-CALENDAR TO TRUE.                       08340005
083500     SET DPG51-DECREMENT-DATE      TO TRUE.                       08350005
083600     SET DPG52-LK-DTE-FISC-PRD     TO TRUE.                       08360005
083700                                                                  08370005
083800     MOVE 24 TO DPG51-INCR-DECR-FISCAL-PRD-9.                     08380099
083900                                                                  08390005
084000     MOVE PV-CURRENT-FISCAL-PRD-YYPP TO DPG52-LK-DATE-INPUT.      08400005
084100                                                                  08410005
084200     CALL DP500-KOHLS-CALENDAR-ROUTINE                            08420005
084300       USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                 08430005
084400                                                                  08440005
084500     EVALUATE TRUE                                                08450005
084600         WHEN DPG54-SEVERE-ERROR                                  08460005
084700             DISPLAY ' '                                          08470005
084800             DISPLAY '** ABEND ** IN EPKUP103'                    08480005
084900             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'    08490005
085000             DISPLAY '** CALLED BY 1300-GET-FISCAL-INFO'          08500005
085100             DISPLAY '** ERROR MESSAGE = '                        08510005
085200                               DPG54-ERROR-MESSAGE                08520005
085300             DISPLAY '** DPG51 = ' DPG51                          08530005
085400             DISPLAY '** DPG52 = ' DPG52                          08540005
085500             DISPLAY '** DPG53 = ' DPG53                          08550005
085600             DISPLAY '** DPG54 = ' DPG54                          08560005
085700             DISPLAY '** DPG55 = ' DPG55                          08570005
085800             DISPLAY '** DPG56 = ' DPG56                          08580005
085900             MOVE '1300-GET-FISCAL-INFO'                          08590005
086000                                           TO PV-PARAGRAPH-NAME   08600005
086100             MOVE 'ERROR VALIDATING INPUT CARD DATE'              08610005
086200                                           TO PV-OPERATION-MSG-1  08620005
086300             SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                08630005
086400             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  08640005
086500             PERFORM 9999-ABEND                                   08650005
086600     END-EVALUATE.                                                08660005
086700                                                                  08670005
086800     DISPLAY ' '.                                                 08680026
086900     DISPLAY 'PROGRAM USES 24 MONTHS PREVIOUS FISCAL INFORMATION'.08690099
087000     DISPLAY 'BASED OFF OF THE CONTROL CARD DATE.'.               08700005
087100     DISPLAY ' '.                                                 08710005
087200     DISPLAY 'PROGRAM PROCESSING DATES: '.                        08720005
087300     DISPLAY '  FISCAL BEGINNING DATE: '                          08730005
087400      DPG56-FIRST-FP-DB2-ISO-FMT.                                 08740005
087500                                                                  08750005
087600     MOVE DPG56-FIRST-FP-DB2-ISO-FMT TO PV-STAT-CHG-DATE.         08760014
087700                                                                  08770099
087800*** GET 12 MONTHS AGO FISCAL DATE INFORMATION                     08780099
087900     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         08790099
088000                                                                  08800099
088100     SET DPG51-FISCAL-454-CALENDAR TO TRUE.                       08810099
088200     SET DPG51-DECREMENT-DATE      TO TRUE.                       08820099
088300     SET DPG52-LK-DTE-FISC-PRD     TO TRUE.                       08830099
088400                                                                  08840099
088500     MOVE 12 TO DPG51-INCR-DECR-FISCAL-PRD-9.                     08850099
088600                                                                  08860099
088700     MOVE PV-CURRENT-FISCAL-PRD-YYPP TO DPG52-LK-DATE-INPUT.      08870099
088800                                                                  08880099
088900     CALL DP500-KOHLS-CALENDAR-ROUTINE                            08890099
089000       USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                 08900099
089100                                                                  08910099
089200     EVALUATE TRUE                                                08920099
089300         WHEN DPG54-SEVERE-ERROR                                  08930099
089400             DISPLAY ' '                                          08940099
089500             DISPLAY '** ABEND ** IN EPKUP103'                    08950099
089600             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'    08960099
089700             DISPLAY '** CALLED BY 1300-GET-FISCAL-INFO'          08970099
089800             DISPLAY '** ERROR MESSAGE = '                        08980099
089900                               DPG54-ERROR-MESSAGE                08990099
090000             DISPLAY '** DPG51 = ' DPG51                          09000099
090100             DISPLAY '** DPG52 = ' DPG52                          09010099
090200             DISPLAY '** DPG53 = ' DPG53                          09020099
090300             DISPLAY '** DPG54 = ' DPG54                          09030099
090400             DISPLAY '** DPG55 = ' DPG55                          09040099
090500             DISPLAY '** DPG56 = ' DPG56                          09050099
090600             MOVE '1300-GET-FISCAL-INFO'                          09060099
090700                                           TO PV-PARAGRAPH-NAME   09070099
090800             MOVE 'ERROR VALIDATING INPUT CARD DATE'              09080099
090900                                           TO PV-OPERATION-MSG-1  09090099
091000             SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                09100099
091100             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  09110099
091200             PERFORM 9999-ABEND                                   09120099
091300     END-EVALUATE.                                                09130099
091400                                                                  09140099
091500     DISPLAY ' '.                                                 09150099
091600     DISPLAY 'PROGRAM USES 12 MONTHS PREVIOUS FISCAL INFORMATION'.09160099
091700     DISPLAY 'FOR DEPT 927/MAJ CL 90                            '.09170099
091800     DISPLAY 'BASED OFF OF THE CONTROL CARD DATE.'.               09180099
091900     DISPLAY ' '.                                                 09190099
092000     DISPLAY 'PROGRAM PROCESSING DATES: '.                        09200099
092100     DISPLAY '  FISCAL BEGINNING DATE: '                          09210099
092200      DPG56-FIRST-FP-DB2-ISO-FMT.                                 09220099
092300                                                                  09230099
092400     MOVE DPG56-LAST-FP-DB2-ISO-FMT  TO PV-D927-CHG-DATE.         09240099
092500     MOVE 0                          TO PV-D927-LAST-SALES-CHK-FIL09250099
092600     MOVE PV-D927-CHG-DATE-YR        TO PV-D927-LAST-SALES-CHK-YR.09260099
092700     MOVE PV-D927-CHG-DATE-MM        TO PV-D927-LAST-SALES-CHK-MM.09270099
092800     MOVE PV-D927-CHG-DATE-DD        TO PV-D927-LAST-SALES-CHK-DD.09280099
092900     MOVE PV-D927-LAST-SALES-CHK-N   TO PV-D927-LAST-SALES-CHK.   09290099
093000                                                                  09300099
093100*1300-EXIT.                                                       09310099
093200                                                                  09320099
093300*--------------------------------------------------------         09330099
093400* 1400-LOAD-ITEM-TABLES-CURRENT.                                  09340099
093500*     THIS ROUTINE LOADS 3 PREVIOUS MONTHS TO TABLES TO BE        09350099
093600*     SEARCHED ON FOR NUMBER OF SALES PER MONTH.                  09360099
093700*--------------------------------------------------------         09370099
093800 1400-LOAD-ITEM-TABLES-CURRENT.                                   09380099
093900                                                                  09390099
094000*** LOAD FROM 1ST MONTH                                           09400099
094100     DISPLAY '  >>> STARTING TO LOAD FIRST MONTH - CURRENT'.      09410099
094200     SET TB1-INDX TO +1.                                          09420099
094300     MOVE ZEROES TO TB1-SKU-NBR-CLEAR(TB1-INDX).                  09430099
094400     MOVE ZEROES TO TB1-SLD-QTY(TB1-INDX).                        09440099
094500                                                                  09450099
094600     MOVE ZEROES TO PV-SKU-MAX-SUB-M1.                            09460099
094700                                                                  09470099
094800     MOVE ZEROES TO PV-SUM-SLD-QTY.                               09480099
094900                                                                  09490099
095000     IF PV-MIN-REG-DTE <= PV-MIN-1-MO-DTE                         09500099
095100        MOVE PV-MIN-1-MO-DTE  TO PV-DATE-MIN                      09510099
095200     ELSE                                                         09520099
095300        MOVE PV-MIN-REG-DTE TO PV-DATE-MIN                        09530099
095400     END-IF.                                                      09540099
095500     MOVE PV-MAX-1-MO-DTE  TO PV-DATE-MAX.                        09550099
095600                                                                  09560099
095700     IF PV-MIN-REG-DTE <= PV-MAX-1-MO-DTE                         09570099
095800        PERFORM 6300-OPEN-ITEM-CURSOR                             09580099
095900        PERFORM 6400-LOAD-ITEM-CURSOR-TBL1                        09590099
096000        PERFORM 6500-CLOSE-ITEM-CURSOR                            09600099
096100     END-IF.                                                      09610099
096200     DISPLAY '     # LOADED TO TBL1 FOR CURRENT: '                09620099
096300             PV-SKU-MAX-SUB-M1.                                   09630099
096400                                                                  09640099
096500*  LOAD FROM 2ND MONTH                                            09650099
096600     DISPLAY '  >>> STARTING TO LOAD SECOND MONTH - CURRENT'.     09660099
096700     SET TB2-INDX TO +1.                                          09670099
096800     MOVE ZEROES TO TB2-SKU-NBR-CLEAR(TB2-INDX).                  09680099
096900     MOVE ZEROES TO TB2-SLD-QTY(TB2-INDX).                        09690099
097000                                                                  09700099
097100     MOVE ZEROES TO PV-SKU-MAX-SUB-M2.                            09710099
097200                                                                  09720099
097300     MOVE ZEROES TO PV-SUM-SLD-QTY.                               09730099
097400                                                                  09740099
097500     IF PV-MIN-REG-DTE <= PV-MIN-2-MO-DTE                         09750099
097600        MOVE PV-MIN-2-MO-DTE  TO PV-DATE-MIN                      09760099
097700     ELSE                                                         09770099
097800        MOVE PV-MIN-REG-DTE   TO PV-DATE-MIN                      09780099
097900     END-IF.                                                      09790099
098000     MOVE PV-MAX-2-MO-DTE  TO PV-DATE-MAX.                        09800099
098100                                                                  09810099
098200     IF PV-MIN-REG-DTE <= PV-MAX-2-MO-DTE                         09820099
098300        PERFORM 6300-OPEN-ITEM-CURSOR                             09830099
098400        PERFORM 6410-LOAD-ITEM-CURSOR-TBL2                        09840099
098500        PERFORM 6500-CLOSE-ITEM-CURSOR                            09850099
098600     END-IF.                                                      09860099
098700     DISPLAY '     # LOADED TO TBL2 FOR CURRENT: '                09870099
098800             PV-SKU-MAX-SUB-M2.                                   09880099
098900                                                                  09890099
099000*  LOAD FROM 3RD MONTH                                            09900099
099100     DISPLAY '  >>> STARTING TO LOAD THIRD MONTH - CURRENT'.      09910099
099200     SET TB3-INDX TO +1.                                          09920099
099300     MOVE ZEROES TO TB3-SKU-NBR-CLEAR(TB3-INDX).                  09930099
099400     MOVE ZEROES TO TB3-SLD-QTY(TB3-INDX).                        09940099
099500                                                                  09950099
099600     MOVE ZEROES TO PV-SKU-MAX-SUB-M3.                            09960099
099700                                                                  09970099
099800     MOVE ZEROES TO PV-SUM-SLD-QTY.                               09980099
099900                                                                  09990099
100000     IF PV-MIN-REG-DTE <= PV-MIN-3-MO-DTE                         10000099
100100        MOVE PV-MIN-3-MO-DTE  TO PV-DATE-MIN                      10010099
100200     ELSE                                                         10020099
100300        MOVE PV-MIN-REG-DTE   TO PV-DATE-MIN                      10030099
100400     END-IF.                                                      10040099
100500     MOVE PV-MAX-3-MO-DTE  TO PV-DATE-MAX.                        10050099
100600                                                                  10060099
100700     IF PV-MIN-REG-DTE <= PV-MAX-3-MO-DTE                         10070099
100800        PERFORM 6300-OPEN-ITEM-CURSOR                             10080099
100900        PERFORM 6420-LOAD-ITEM-CURSOR-TBL3                        10090099
101000        PERFORM 6500-CLOSE-ITEM-CURSOR                            10100099
101100     END-IF.                                                      10110099
101200     DISPLAY '     # LOADED TO TBL3 FOR CURRENT: '                10120099
101300             PV-SKU-MAX-SUB-M3.                                   10130099
101400                                                                  10140099
101500*1400-EXIT.                                                       10150099
101600                                                                  10160009
101700*----------------------------------------------------------       10170089
101800* 2000-PROCESS-CURSOR.                                            10180089
101900*     UPDATES THE PLU DOWNLOAD EXCLUSION INDICATOR AND WRITES THE 10190089
102000*     SKU TO AN EXTRACT FILE, IF APPROPRIATE, AND FETCHES THE NEXT10200089
102100*     RECORD.                                                     10210089
102200*----------------------------------------------------------       10220001
102300 2000-PROCESS-CURSOR.                                             10230001
102400                                                                  10240001
102500     SET PS-DONT-SKIP-RECORD TO TRUE.                             10250099
102600     SET PS-EXCLUDE-RECORD   TO TRUE.                             10260099
102700                                                                  10270099
102800     IF XST00010-REGN-PRIC-IND = 'Y'                              10280099
102900        PERFORM 2300-OPEN-STORE-SKU-CURSOR                        10290099
103000        PERFORM 2400-FETCH-STORE-SKU-CURSOR                       10300099
103100        PERFORM 2500-CLOSE-STORE-SKU-CURSOR                       10310099
103200     END-IF.                                                      10320099
103300                                                                  10330099
103400     IF PS-DONT-SKIP-RECORD                                       10340099
103500        MOVE XST00010-SKU-NBR TO PV-SAVE-SKU-NBR                  10350099
103600        PERFORM 5000-CHECK-SALES                                  10360099
103700     END-IF.                                                      10370099
103800                                                                  10380099
103900     IF PS-EXCLUDE-RECORD                                         10390099
104000        PERFORM 3100-UPDATE-DATA                                  10400099
104100                                                                  10410099
104200        INITIALIZE EP132-PLU-EXCL-REC                             10420099
104300        MOVE XST00011-INTR-UPC-ID TO PV-INTR-UPC-ID-NUM           10430099
104400        MOVE PV-INTR-UPC-ID-NUM   TO EP132-INTR-UPC-ID            10440099
104500        MOVE XST00010-SKU-NBR     TO EP132-SKU-NBR                10450099
104600        PERFORM 8000-WRITE-EXCL-SKU-REC                           10460099
104700     END-IF.                                                      10470099
104800                                                                  10480099
104900     PERFORM 6100-FETCH-ATTR-SKU-CURSOR.                          10490099
105000                                                                  10500099
105100*2000-EXIT.                                                       10510099
105200                                                                  10520009
105300*---------------------------------------------------------        10530037
105400* 2200-UPDATE-COMMIT.                                             10540037
105500*     THIS ROUTINE EXECUTES THE COMMIT EVERY 1000 UPDATES.        10550037
105600*---------------------------------------------------------        10560037
105700 2200-UPDATE-COMMIT.                                              10570037
105800                                                                  10580037
105900     PERFORM                                                      10590037
106000         WITH TEST AFTER                                          10600037
106100         VARYING PV-SQL-SUB                                       10610037
106200         FROM 1 BY 1                                              10620037
106300         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 10630037
106400                   OR  SQLCODE = 0)                               10640037
106500                                                                  10650080
106600         EXEC SQL                                                 10660037
106700             COMMIT                                               10670037
106800         END-EXEC                                                 10680037
106900                                                                  10690037
107000         EVALUATE TRUE                                            10700037
107100             WHEN SQLCODE = -904                                  10710037
107200             WHEN SQLCODE = -911                                  10720037
107300             WHEN SQLCODE = -913                                  10730037
107400             WHEN SQLCODE = 0                                     10740037
107500                 CONTINUE                                         10750037
107600             WHEN SQLWARN NOT EQUAL SPACES                        10760037
107700             WHEN SQLCODE NOT EQUAL ZERO                          10770037
107800                 MOVE '2200-UPDATE-COMMIT'                        10780037
107900                               TO  PV-PARAGRAPH-NAME              10790037
108000                 MOVE 'COMMIT XST_SKU_ATTR'                       10800037
108100                               TO  PV-DB2-OPERATION               10810037
108200                 PERFORM 9100-SQL-ABEND                           10820037
108300         END-EVALUATE                                             10830037
108400     END-PERFORM.                                                 10840037
108500                                                                  10850037
108600     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         10860037
108700        MOVE '2200-UPDATE-COMMIT'                                 10870037
108800                              TO  PV-PARAGRAPH-NAME               10880037
108900        MOVE 'COMMIT RETRIES EXCEEDED'                            10890037
109000                              TO  PV-DB2-OPERATION                10900037
109100        PERFORM 9100-SQL-ABEND                                    10910037
109200     END-IF.                                                      10920037
109300                                                                  10930091
109400     DISPLAY '     PLU EXCL UPDATE CNT AT COMMIT: '               10940091
109500             PV-COUNT-SKU-RECS.                                   10950091
109600                                                                  10960037
109700*2200-EXIT.                                                       10970037
109800                                                                  10980037
109900*----------------------------------------------------------       10990056
110000* 2300-OPEN-STORE-SKU-CURSOR.                                     11000056
110100*     OPEN THE STORE SKU CURSOR.                                  11010056
110200*----------------------------------------------------------       11020056
110300 2300-OPEN-STORE-SKU-CURSOR.                                      11030056
110400                                                                  11040056
110500     PERFORM                                                      11050056
110600         WITH TEST AFTER                                          11060056
110700         VARYING PV-SQL-SUB                                       11070056
110800         FROM 1 BY 1                                              11080056
110900         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 11090056
111000                   OR  SQLCODE = 0)                               11100056
111100                                                                  11110056
111200           EXEC SQL                                               11120056
111300              OPEN STORE-SKU-CURSOR                               11130056
111400           END-EXEC                                               11140056
111500                                                                  11150056
111600         EVALUATE TRUE                                            11160056
111700             WHEN SQLCODE = -904                                  11170056
111800             WHEN SQLCODE = -911                                  11180056
111900             WHEN SQLCODE = -913                                  11190056
112000             WHEN SQLCODE = 0                                     11200056
112100                 CONTINUE                                         11210056
112200             WHEN SQLWARN0 NOT EQUAL SPACE                        11220056
112300             WHEN SQLCODE NOT EQUAL ZERO                          11230056
112400                  MOVE '2300-OPEN-STORE-SKU-CURSOR'               11240056
112500                                     TO PV-PARAGRAPH-NAME         11250056
112600                  MOVE 'ERROR ON OPEN OF STORE SKU CURSOR'        11260056
112700                                     TO PV-DB2-OPERATION          11270056
112800                  PERFORM 9100-SQL-ABEND                          11280056
112900         END-EVALUATE                                             11290056
113000     END-PERFORM.                                                 11300056
113100                                                                  11310056
113200     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         11320056
113300        MOVE '2300-OPEN-STORE-SKU-CURSOR'                         11330056
113400                               TO  PV-PARAGRAPH-NAME              11340056
113500        MOVE 'OPEN RETRIES EXCEEDED'                              11350056
113600                               TO  PV-DB2-OPERATION               11360056
113700        PERFORM 9100-SQL-ABEND                                    11370056
113800     END-IF.                                                      11380056
113900                                                                  11390056
114000*2300-EXIT.                                                       11400056
114100                                                                  11410056
114200*----------------------------------------------------------       11420056
114300* 2400-FETCH-STORE-SKU-CURSOR.                                    11430056
114400*     FETCH THE STORE SKU CURSOR.                                 11440056
114500*----------------------------------------------------------       11450056
114600 2400-FETCH-STORE-SKU-CURSOR.                                     11460056
114700                                                                  11470056
114800     PERFORM                                                      11480056
114900         WITH TEST AFTER                                          11490056
115000         VARYING PV-SQL-SUB                                       11500056
115100         FROM 1 BY 1                                              11510056
115200         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 11520056
115300                   OR  SQLCODE = 0                                11530056
115400                   OR  SQLCODE = +100)                            11540056
115500                                                                  11550056
115600           EXEC SQL                                               11560056
115700              FETCH STORE-SKU-CURSOR                              11570056
115800              INTO  :XST00008-LOC-NBR                             11580056
115900           END-EXEC                                               11590056
116000                                                                  11600056
116100          EVALUATE TRUE                                           11610056
116200             WHEN SQLCODE = -904                                  11620056
116300             WHEN SQLCODE = -911                                  11630056
116400             WHEN SQLCODE = -913                                  11640056
116500                  CONTINUE                                        11650056
116600             WHEN SQLCODE = ZERO                                  11660056
116700                  SET PS-SKIP-RECORD TO TRUE                      11670056
116800                  SET PS-NOT-EXCLUDE-RECORD TO TRUE               11680058
116900                  ADD 1 TO PV-RECENT-SALES                        11690093
117000             WHEN SQLCODE = +100                                  11700056
117100                  SET PS-DONT-SKIP-RECORD TO TRUE                 11710056
117200             WHEN SQLWARN0 NOT EQUAL SPACE                        11720056
117300             WHEN SQLCODE NOT EQUAL ZERO                          11730056
117400                  MOVE '2400-FETCH-STORE-SKU-CURSOR'              11740056
117500                                     TO PV-PARAGRAPH-NAME         11750056
117600                  MOVE 'ERROR ON FETCHING STORE SKU CURSOR'       11760056
117700                                     TO PV-DB2-OPERATION          11770056
117800                  DISPLAY 'SQLCODE= ' SQLCODE                     11780056
117900                  PERFORM 9100-SQL-ABEND                          11790056
118000          END-EVALUATE                                            11800056
118100     END-PERFORM.                                                 11810056
118200                                                                  11820056
118300     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         11830056
118400        MOVE '2400-FETCH-STORE-SKU-CURSOR'                        11840056
118500                              TO  PV-PARAGRAPH-NAME               11850056
118600        MOVE 'FETCH RETRIES EXCEEDED'                             11860056
118700                              TO  PV-DB2-OPERATION                11870056
118800        PERFORM 9100-SQL-ABEND                                    11880056
118900     END-IF.                                                      11890056
119000                                                                  11900056
119100*2400-EXIT.                                                       11910056
119200                                                                  11920056
119300*-------------------------------------------------------------    11930056
119400* 2500-CLOSE-STORE-SKU-CURSOR.                                    11940056
119500*     CLOSE THE STORE SKU CURSOR.                                 11950056
119600*-------------------------------------------------------------    11960056
119700 2500-CLOSE-STORE-SKU-CURSOR.                                     11970057
119800                                                                  11980056
119900     PERFORM                                                      11990056
120000         WITH TEST AFTER                                          12000056
120100         VARYING PV-SQL-SUB                                       12010056
120200         FROM 1 BY 1                                              12020056
120300         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 12030056
120400                   OR  SQLCODE = 0)                               12040056
120500                                                                  12050056
120600           EXEC SQL                                               12060056
120700              CLOSE STORE-SKU-CURSOR                              12070056
120800           END-EXEC                                               12080056
120900                                                                  12090056
121000          EVALUATE TRUE                                           12100056
121100             WHEN SQLCODE = -904                                  12110056
121200             WHEN SQLCODE = -911                                  12120056
121300             WHEN SQLCODE = -913                                  12130056
121400             WHEN SQLCODE = 0                                     12140056
121500                  CONTINUE                                        12150056
121600             WHEN SQLWARN0 NOT EQUAL SPACE                        12160056
121700             WHEN SQLCODE NOT EQUAL ZERO                          12170056
121800                  MOVE '2500-CLOSE-STORE-SKU-CURSOR'              12180098
121900                                      TO PV-PARAGRAPH-NAME        12190056
122000                  MOVE 'ERROR ON CLOSE OF STORE SKU CURSOR'       12200056
122100                                      TO PV-DB2-OPERATION         12210056
122200                  PERFORM 9100-SQL-ABEND                          12220056
122300          END-EVALUATE                                            12230056
122400     END-PERFORM.                                                 12240056
122500                                                                  12250056
122600     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         12260056
122700        MOVE '2500-CLOSE-STORE-SKU-CURSOR'                        12270098
122800                              TO  PV-PARAGRAPH-NAME               12280056
122900        MOVE 'CLOSE RETRIES EXCEEDED'                             12290056
123000                              TO  PV-DB2-OPERATION                12300056
123100        PERFORM 9100-SQL-ABEND                                    12310056
123200     END-IF.                                                      12320056
123300                                                                  12330056
123400*2500-EXIT.                                                       12340056
123500                                                                  12350056
123600*----------------------------------------------------------       12360099
123700* 3000-PROCESS-D927-CURSOR.                                       12370099
123800*     UPDATES THE PLU DOWNLOAD EXCLUSION INDICATOR AND WRITES THE 12380099
123900*     SKU TO AN EXTRACT FILE, IF APPROPRIATE, AND FETCHES THE NEXT12390099
124000*     RECORD.                                                     12400099
124100*----------------------------------------------------------       12410099
124200 3000-PROCESS-D927-CURSOR.                                        12420099
124300                                                                  12430099
124400     PERFORM 3100-UPDATE-DATA                                     12440099
124500                                                                  12450099
124600     INITIALIZE EP132-PLU-EXCL-REC                                12460099
124700     MOVE XST00011-INTR-UPC-ID TO PV-INTR-UPC-ID-NUM              12470099
124800     MOVE PV-INTR-UPC-ID-NUM   TO EP132-INTR-UPC-ID               12480099
124900     MOVE XST00010-SKU-NBR     TO EP132-SKU-NBR                   12490099
125000     PERFORM 8000-WRITE-EXCL-SKU-REC                              12500099
125100                                                                  12510099
125200     PERFORM 6700-FETCH-D927-SKU-CURSOR.                          12520099
125300                                                                  12530099
125400*3000-EXIT.                                                       12540099
125500                                                                  12550099
125600*------------------------------------------------------           12560099
125700* 3100-UPDATE-DATA.                                               12570099
125800*     UPDATE THE PLU-DWNL-EXCL-IND FOR THIS ITEM.                 12580099
125900*------------------------------------------------------           12590099
126000 3100-UPDATE-DATA.                                                12600099
126100                                                                  12610099
126200     PERFORM                                                      12620099
126300         WITH TEST AFTER                                          12630099
126400         VARYING PV-SQL-SUB                                       12640099
126500         FROM 1 BY 1                                              12650099
126600         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 12660099
126700                   OR  SQLCODE = 0)                               12670099
126800                                                                  12680099
126900         EXEC SQL                                                 12690099
127000             UPDATE XST_SKU_ATTR                                  12700099
127100             SET  PLU_DWNLD_EXCL_IND  =  'Y'                      12710099
127200                 ,LAST_UPD_TMST       = CURRENT TIMESTAMP         12720099
127300             WHERE INTR_UPC_ID = :XST00011-INTR-UPC-ID            12730099
127400         END-EXEC                                                 12740099
127500                                                                  12750099
127600         EVALUATE TRUE                                            12760099
127700             WHEN SQLCODE = -904                                  12770099
127800             WHEN SQLCODE = -911                                  12780099
127900             WHEN SQLCODE = -913                                  12790099
128000                  CONTINUE                                        12800099
128100             WHEN SQLCODE = 0                                     12810099
128200                  ADD 1 TO PV-COUNT-SKU-RECS                      12820099
128300                  ADD 1 TO PV-COMMIT-COUNT                        12830099
128400                  IF PV-COMMIT-COUNT > PC-COMMIT-MAX              12840099
128500                     MOVE 0 TO PV-COMMIT-COUNT                    12850099
128600                     PERFORM 2200-UPDATE-COMMIT                   12860099
128700                  END-IF                                          12870099
128800             WHEN SQLWARN NOT EQUAL SPACES                        12880099
128900             WHEN SQLCODE NOT EQUAL ZERO                          12890099
129000                 MOVE '3100-UPDATE-DATA'                          12900099
129100                               TO  PV-PARAGRAPH-NAME              12910099
129200                 MOVE 'UPDATE PLU INDICATOR'                      12920099
129300                               TO  PV-DB2-OPERATION               12930099
129400                 PERFORM 9100-SQL-ABEND                           12940099
129500         END-EVALUATE                                             12950099
129600     END-PERFORM.                                                 12960099
129700                                                                  12970099
129800     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         12980099
129900        MOVE '3100-UPDATE-DATA'                                   12990099
130000                              TO  PV-PARAGRAPH-NAME               13000099
130100        MOVE 'UPDATE RETRIES EXCEEDED'                            13010099
130200                              TO  PV-DB2-OPERATION                13020099
130300        PERFORM 9100-SQL-ABEND                                    13030099
130400     END-IF.                                                      13040099
130500                                                                  13050099
130600*3100-EXIT.                                                       13060099
130700                                                                  13070099
130800*----------------------------------------------------------       13080001
130900* 4000-END-OF-JOB-ROUTINE.                                        13090099
131000*     CLOSES THE CURSOR AND DISPLAYS ALL PROGRAM COUNTS.          13100071
131100*----------------------------------------------------------       13110001
131200 4000-END-OF-JOB-ROUTINE.                                         13120099
131300                                                                  13130001
131400     CLOSE EXCL-SKU-EXTRACT-FILE.                                 13140083
131500                                                                  13150097
131600     DISPLAY '                                        '.          13160097
131700     DISPLAY '****************************************'.          13170097
131800     DISPLAY '*************** EPKUP103 ***************'.          13180004
131900     DISPLAY '****************************************'.          13190001
132000     DISPLAY 'LOOKING FOR STATUS CHANGED DATE LESS THAN: '        13200039
132100                             PV-STAT-CHG-DATE.                    13210039
132200     DISPLAY '# OF RECORDS FETCHED: ' PV-COUNT-FETCH-RECS.        13220083
132300     DISPLAY '# OF RECORDS THAT WERE CLEARANCE SKUS W SALES: '    13230039
132400                             PV-RECENT-SALES.                     13240083
132500     DISPLAY '# OF PLU EXCL IND UPDATED: ' PV-COUNT-SKU-RECS.     13250083
132600     DISPLAY '# OF SKU EXCL RECORDS OUT: ' PV-COUNT-EXCL-RECS.    13260083
132700     DISPLAY '****************************************'.          13270001
132800     DISPLAY '****************************************'.          13280001
132900                                                                  13290001
133000*4000-EXIT.                                                       13300099
133100                                                                  13310009
133200*----------------------------------------------------             13320008
133300* 4100-SELECT-PART-TBL-MIN.                                       13330008
133400*     GET THE SMALLEST OPERATIONAL PARTITION FROM TEPPART.        13340018
133500*----------------------------------------------------             13350008
133600 4100-SELECT-PART-TBL-MIN.                                        13360008
133700                                                                  13370008
133800     PERFORM                                                      13380008
133900         WITH TEST AFTER                                          13390008
134000         VARYING PV-SQL-SUB                                       13400008
134100         FROM 1 BY 1                                              13410008
134200         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 13420008
134300                   OR  SQLCODE = 0)                               13430008
134400                                                                  13440008
134500         EXEC SQL                                                 13450008
134600            SELECT A.SLS_DTE                                      13460018
134700              INTO :EPPART-SLS-DTE                                13470029
134800              FROM TEPPART A                                      13480008
134900              WHERE A.STR_GP_CDE   = 'A'                          13490099
135000                AND A.SLS_DTE      =                              13500008
135100                    (SELECT MIN(B.SLS_DTE)                        13510008
135200                       FROM TEPPART B                             13520008
135300                      WHERE B.STR_GP_CDE   = 'A')                 13530099
135400            WITH UR                                               13540027
135500         END-EXEC                                                 13550008
135600                                                                  13560008
135700         EVALUATE TRUE                                            13570008
135800             WHEN SQLCODE = -904                                  13580008
135900             WHEN SQLCODE = -911                                  13590008
136000             WHEN SQLCODE = -913                                  13600008
136100                  CONTINUE                                        13610015
136200             WHEN SQLCODE = 0                                     13620008
136300                  MOVE EPPART-SLS-DTE TO PV-MIN-REG-DTE           13630015
136400             WHEN SQLWARN NOT EQUAL SPACES                        13640008
136500             WHEN SQLCODE NOT EQUAL ZERO                          13650008
136600                                                                  13660008
136700                  MOVE '4100-SELECT-PART-TBL-MIN'                 13670008
136800                                TO  PV-PARAGRAPH-NAME             13680008
136900                  MOVE 'FETCH PARTITION'                          13690008
137000                                TO  PV-DB2-OPERATION              13700008
137100                  PERFORM 9100-SQL-ABEND                          13710013
137200         END-EVALUATE                                             13720008
137300     END-PERFORM.                                                 13730008
137400                                                                  13740008
137500     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         13750013
137600        MOVE '4100-SELECT-PART-TBL-MIN'                           13760013
137700                              TO  PV-PARAGRAPH-NAME               13770013
137800        MOVE 'SELECT RETRIES EXCEEDED'                            13780013
137900                              TO  PV-DB2-OPERATION                13790013
138000        PERFORM 9100-SQL-ABEND                                    13800013
138100     END-IF.                                                      13810008
138200                                                                  13820008
138300*4100-EXIT.                                                       13830009
138400                                                                  13840009
138500*-------------------------------------------------------          13850013
138600* 5000-CHECK-SALES.                                               13860013
138700*     THIS ROUTINE CHECKS THE NUMBER OF SALES FOR A CLEARANCE     13870018
138800*     ITEM, AND DETERMINES IF THE PLU DOWNLOAD EXCLUSION FLAG     13880018
138900*     CAN BE SET.                                                 13890018
139000*-------------------------------------------------------          13900013
139100 5000-CHECK-SALES.                                                13910013
139200                                                                  13920013
139300     MOVE 0 TO PV-CHECK-COUNT.                                    13930013
139400     INITIALIZE PV-TOTAL-SLD-QTY.                                 13940059
139500                                                                  13950013
139600***  SEARCH ALL MONTHLY TABLES                                    13960014
139700***  SEARCH 1ST MONTH TABLE                                       13970014
139800     IF PV-SKU-MAX-SUB-M1 > 0                                     13980031
139900        SET PS-NOT-END-OF-SEARCH TO TRUE                          13990068
140000        SET PS-ITEM-NOT-FOUND TO TRUE                             14000068
140100        SET TB1-INDX TO +1                                        14010013
140200                                                                  14020013
140300        PERFORM 7010-SEARCH-ITEM-TABLE1                           14030015
140400             UNTIL PS-END-OF-SEARCH OR                            14040068
140500                   TB1-INDX GREATER THAN PC-MAX-ITEMS-TABLE       14050013
140600                                                                  14060013
140700        IF (PS-ITEM-FOUND AND                                     14070068
140800           (PV-TOTAL-SLD-QTY <= PC-MINIMUM-SALES)) OR             14080056
140900           PS-ITEM-NOT-FOUND                                      14090068
141000              ADD +1 TO PV-CHECK-COUNT                            14100013
141100        END-IF                                                    14110013
141200     ELSE                                                         14120013
141300        ADD +1 TO PV-CHECK-COUNT                                  14130013
141400     END-IF.                                                      14140013
141500                                                                  14150056
141600     INITIALIZE PV-TOTAL-SLD-QTY.                                 14160059
141700                                                                  14170013
141800***  SEARCH 2ND MONTHLY TABLE                                     14180014
141900     IF PV-SKU-MAX-SUB-M2 > 0                                     14190031
142000        SET PS-NOT-END-OF-SEARCH TO TRUE                          14200068
142100        SET PS-ITEM-NOT-FOUND TO TRUE                             14210068
142200        SET TB2-INDX TO +1                                        14220013
142300                                                                  14230013
142400        PERFORM 7110-SEARCH-ITEM-TABLE2                           14240015
142500             UNTIL PS-END-OF-SEARCH OR                            14250068
142600                   TB2-INDX GREATER THAN PC-MAX-ITEMS-TABLE       14260013
142700                                                                  14270013
142800        IF (PS-ITEM-FOUND AND                                     14280068
142900           (PV-TOTAL-SLD-QTY <= PC-MINIMUM-SALES)) OR             14290056
143000           PS-ITEM-NOT-FOUND                                      14300068
143100              ADD +1 TO PV-CHECK-COUNT                            14310013
143200        END-IF                                                    14320013
143300     ELSE                                                         14330013
143400        ADD +1 TO PV-CHECK-COUNT                                  14340013
143500     END-IF.                                                      14350013
143600                                                                  14360056
143700     INITIALIZE PV-TOTAL-SLD-QTY.                                 14370059
143800                                                                  14380013
143900*** SEARCH 3RD MONTHLY TABLE                                      14390014
144000     IF PV-SKU-MAX-SUB-M3 > 0                                     14400031
144100        SET PS-NOT-END-OF-SEARCH TO TRUE                          14410068
144200        SET PS-ITEM-NOT-FOUND TO TRUE                             14420068
144300        SET TB3-INDX TO +1                                        14430014
144400                                                                  14440014
144500        PERFORM 7210-SEARCH-ITEM-TABLE3                           14450015
144600             UNTIL PS-END-OF-SEARCH OR                            14460068
144700                   TB3-INDX GREATER THAN PC-MAX-ITEMS-TABLE       14470014
144800                                                                  14480014
144900        IF (PS-ITEM-FOUND AND                                     14490068
145000           (PV-TOTAL-SLD-QTY <= PC-MINIMUM-SALES)) OR             14500056
145100           PS-ITEM-NOT-FOUND                                      14510068
145200              ADD +1 TO PV-CHECK-COUNT                            14520014
145300        END-IF                                                    14530014
145400     ELSE                                                         14540014
145500        ADD +1 TO PV-CHECK-COUNT                                  14550014
145600     END-IF.                                                      14560014
145700                                                                  14570014
145800     IF PV-CHECK-COUNT = PC-MONTHS-BACK                           14580014
145900         SET PS-EXCLUDE-RECORD TO TRUE                            14590056
146000     ELSE                                                         14600014
146100         ADD 1 TO PV-RECENT-SALES                                 14610083
146200         SET PS-NOT-EXCLUDE-RECORD TO TRUE                        14620056
146300     END-IF.                                                      14630014
146400                                                                  14640014
146500*5000-EXIT.                                                       14650013
146600                                                                  14660013
146700*----------------------------------------------------------       14670001
146800* 6000-OPEN-ATTR-SKU-CURSOR.                                      14680012
146900*     OPEN THE ATTRIBUTE SKU CURSOR.                              14690018
147000*----------------------------------------------------------       14700001
147100 6000-OPEN-ATTR-SKU-CURSOR.                                       14710012
147200                                                                  14720001
147300     PERFORM                                                      14730001
147400         WITH TEST AFTER                                          14740001
147500         VARYING PV-SQL-SUB                                       14750001
147600         FROM 1 BY 1                                              14760001
147700         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 14770001
147800                   OR  SQLCODE = 0)                               14780001
147900                                                                  14790001
148000           EXEC SQL                                               14800001
148100              OPEN ATTR-SKU-CURSOR                                14810012
148200           END-EXEC                                               14820001
148300                                                                  14830001
148400         EVALUATE TRUE                                            14840001
148500             WHEN SQLCODE = -904                                  14850001
148600             WHEN SQLCODE = -911                                  14860001
148700             WHEN SQLCODE = -913                                  14870001
148800             WHEN SQLCODE = 0                                     14880001
148900                 CONTINUE                                         14890001
149000             WHEN SQLWARN0 NOT EQUAL SPACE                        14900001
149100             WHEN SQLCODE NOT EQUAL ZERO                          14910001
149200                  MOVE '6000-OPEN-ATTR-SKU-CURSOR'                14920012
149300                                     TO PV-PARAGRAPH-NAME         14930001
149400                  MOVE 'ERROR ON OPEN OF REACT SKU CURSOR'        14940001
149500                                     TO PV-DB2-OPERATION          14950001
149600                  PERFORM 9100-SQL-ABEND                          14960001
149700         END-EVALUATE                                             14970001
149800     END-PERFORM.                                                 14980001
149900                                                                  14990001
150000     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         15000012
150100        MOVE '6000-OPEN-ATTR-SKU-CURSOR'                          15010012
150200                               TO  PV-PARAGRAPH-NAME              15020001
150300        MOVE 'OPEN RETRIES EXCEEDED'                              15030012
150400                               TO  PV-DB2-OPERATION               15040001
150500        PERFORM 9100-SQL-ABEND                                    15050012
150600     END-IF.                                                      15060001
150700                                                                  15070001
150800*6000-EXIT.                                                       15080009
150900                                                                  15090009
151000*----------------------------------------------------------       15100001
151100* 6100-FETCH-ATTR-SKU-CURSOR.                                     15110012
151200*     FETCH THE ATTRIBUTE SKU CURSOR.                             15120012
151300*----------------------------------------------------------       15130001
151400 6100-FETCH-ATTR-SKU-CURSOR.                                      15140012
151500                                                                  15150001
151600     PERFORM                                                      15160001
151700         WITH TEST AFTER                                          15170001
151800         VARYING PV-SQL-SUB                                       15180001
151900         FROM 1 BY 1                                              15190001
152000         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 15200001
152100                   OR  SQLCODE = 0                                15210001
152200                   OR  SQLCODE = +100)                            15220001
152300                                                                  15230001
152400           EXEC SQL                                               15240001
152500              FETCH ATTR-SKU-CURSOR                               15250012
152600              INTO  :XST00011-INTR-UPC-ID                         15260001
152700                   ,:XST00010-SKU-NBR                             15270012
152800                   ,:XST00010-REGN-PRIC-IND                       15280056
152900           END-EXEC                                               15290001
153000                                                                  15300001
153100          EVALUATE TRUE                                           15310001
153200             WHEN SQLCODE = -904                                  15320001
153300             WHEN SQLCODE = -911                                  15330001
153400             WHEN SQLCODE = -913                                  15340001
153500                  CONTINUE                                        15350001
153600             WHEN SQLCODE = ZERO                                  15360001
153700                  SET PS-NOT-EOF-SKU-CURSOR   TO TRUE             15370001
153800                  ADD 1 TO PV-COUNT-FETCH-RECS                    15380083
153900                  MOVE XST00011-INTR-UPC-ID TO PV-INTR-UPC-ID     15390038
154000             WHEN SQLCODE = +100                                  15400001
154100                  SET PS-END-OF-SKU-CURSOR    TO TRUE             15410001
154200             WHEN SQLWARN0 NOT EQUAL SPACE                        15420001
154300             WHEN SQLCODE NOT EQUAL ZERO                          15430001
154400                  MOVE '6100-FETCH-ATTR-SKU-CURSOR'               15440012
154500                                     TO PV-PARAGRAPH-NAME         15450001
154600                  MOVE 'ERROR ON FETCHING REACT SKU CURSOR'       15460001
154700                                     TO PV-DB2-OPERATION          15470001
154800                  DISPLAY 'SQLCODE= ' SQLCODE                     15480001
154900                  PERFORM 9100-SQL-ABEND                          15490001
155000          END-EVALUATE                                            15500001
155100     END-PERFORM.                                                 15510001
155200                                                                  15520001
155300     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         15530012
155400        MOVE '6100-FETCH-ATTR-SKU-CURSOR'                         15540012
155500                              TO  PV-PARAGRAPH-NAME               15550012
155600        MOVE 'FETCH RETRIES EXCEEDED'                             15560012
155700                              TO  PV-DB2-OPERATION                15570012
155800        PERFORM 9100-SQL-ABEND                                    15580012
155900     END-IF.                                                      15590001
156000                                                                  15600001
156100*6100-EXIT.                                                       15610009
156200                                                                  15620009
156300*-------------------------------------------------------------    15630001
156400* 6200-CLOSE-ATTR-SKU-CURSOR.                                     15640012
156500*     CLOSE THE ATTRIBUTE SKU CURSOR.                             15650012
156600*-------------------------------------------------------------    15660001
156700 6200-CLOSE-ATTR-SKU-CURSOR.                                      15670012
156800                                                                  15680001
156900     PERFORM                                                      15690001
157000         WITH TEST AFTER                                          15700001
157100         VARYING PV-SQL-SUB                                       15710001
157200         FROM 1 BY 1                                              15720001
157300         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 15730001
157400                   OR  SQLCODE = 0)                               15740001
157500                                                                  15750001
157600           EXEC SQL                                               15760001
157700              CLOSE ATTR-SKU-CURSOR                               15770012
157800           END-EXEC                                               15780001
157900                                                                  15790001
158000          EVALUATE TRUE                                           15800001
158100             WHEN SQLCODE = -904                                  15810001
158200             WHEN SQLCODE = -911                                  15820001
158300             WHEN SQLCODE = -913                                  15830001
158400             WHEN SQLCODE = 0                                     15840001
158500                  CONTINUE                                        15850001
158600             WHEN SQLWARN0 NOT EQUAL SPACE                        15860001
158700             WHEN SQLCODE NOT EQUAL ZERO                          15870001
158800                  MOVE '6200-CLOSE-ATTR-SKU-CURSOR'               15880012
158900                                      TO PV-PARAGRAPH-NAME        15890001
159000                  MOVE 'ERROR ON CLOSE OF REACT SKU CURSOR'       15900001
159100                                      TO PV-DB2-OPERATION         15910001
159200                  PERFORM 9100-SQL-ABEND                          15920001
159300          END-EVALUATE                                            15930001
159400     END-PERFORM.                                                 15940001
159500                                                                  15950001
159600     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         15960012
159700        MOVE '6200-CLOSE-ATTR-SKU-CURSOR'                         15970012
159800                              TO  PV-PARAGRAPH-NAME               15980012
159900        MOVE 'CLOSE RETRIES EXCEEDED'                             15990012
160000                              TO  PV-DB2-OPERATION                16000012
160100        PERFORM 9100-SQL-ABEND                                    16010012
160200     END-IF.                                                      16020001
160300                                                                  16030001
160400*6200-EXIT.                                                       16040009
160500                                                                  16050009
160600*----------------------------------------------------------       16060008
160700* 6300-OPEN-ITEM-CURSOR.                                          16070008
160800*     OPEN THE CLEARANCE ITEM CURSOR.                             16080008
160900*----------------------------------------------------------       16090008
161000 6300-OPEN-ITEM-CURSOR.                                           16100008
161100                                                                  16110008
161200     PERFORM                                                      16120008
161300         WITH TEST AFTER                                          16130008
161400         VARYING PV-SQL-SUB                                       16140008
161500         FROM 1 BY 1                                              16150008
161600         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 16160008
161700                   OR  SQLCODE = 0)                               16170008
161800                                                                  16180008
161900           EXEC SQL                                               16190008
162000              OPEN CL-ITEM-CURSOR                                 16200008
162100           END-EXEC                                               16210008
162200                                                                  16220008
162300           EVALUATE TRUE                                          16230008
162400             WHEN SQLCODE = -904                                  16240008
162500             WHEN SQLCODE = -911                                  16250008
162600             WHEN SQLCODE = -913                                  16260008
162700             WHEN SQLCODE = 0                                     16270008
162800                  CONTINUE                                        16280017
162900             WHEN SQLWARN0 NOT EQUAL SPACE                        16290012
163000             WHEN SQLCODE NOT EQUAL ZERO                          16300012
163100                  MOVE '6300-OPEN-ITEM-CURSOR'                    16310012
163200                                     TO PV-PARAGRAPH-NAME         16320008
163300                  MOVE 'ERROR ON OPEN OF ITEM CURSOR'             16330012
163400                                     TO PV-DB2-OPERATION          16340012
163500                  PERFORM 9100-SQL-ABEND                          16350012
163600           END-EVALUATE                                           16360008
163700     END-PERFORM.                                                 16370008
163800                                                                  16380008
163900     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         16390012
164000        MOVE '6300-OPEN-ITEM-CURSOR'                              16400012
164100                               TO  PV-PARAGRAPH-NAME              16410008
164200        MOVE 'CLOSE RETRIES EXCEEDED'                             16420012
164300                               TO  PV-DB2-OPERATION               16430008
164400        PERFORM 9100-SQL-ABEND                                    16440012
164500     END-IF.                                                      16450008
164600                                                                  16460008
164700*6300-EXIT.                                                       16470009
164800                                                                  16480009
164900*----------------------------------------------------------       16490008
165000* 6400-LOAD-ITEM-CURSOR-TBL1.                                     16500014
165100*     FETCH THE CLEARANCE ITEM CURSOR FOR A MONTH AGO AND         16510018
165200*     AND LOAD THE ITEMS INTO A TABLE.                            16520018
165300*----------------------------------------------------------       16530008
165400 6400-LOAD-ITEM-CURSOR-TBL1.                                      16540014
165500                                                                  16550012
165600     PERFORM                                                      16560012
165700         WITH TEST AFTER                                          16570012
165800         UNTIL SQLCODE = +100                                     16580012
165900                                                                  16590012
166000           EXEC SQL                                               16600008
166100              FETCH CL-ITEM-CURSOR                                16610008
166200              INTO  :EPITM-SKU-NBR                                16620008
166300                   ,:PV-SUM-SLD-QTY                               16630071
166400           END-EXEC                                               16640008
166500                                                                  16650008
166600           EVALUATE TRUE                                          16660012
166700             WHEN SQLCODE = 0                                     16670012
166800                  MOVE EPITM-SKU-NBR TO                           16680017
166900                            TB1-SKU-NBR-CLEAR(TB1-INDX)           16690017
167000                  MOVE PV-SUM-SLD-QTY TO TB1-SLD-QTY(TB1-INDX)    16700071
167100                  SET TB1-INDX UP BY +1                           16710012
167200                  ADD +1 TO PV-SKU-MAX-SUB-M1                     16720031
167300                  IF TB1-INDX > PC-MAX-ITEMS-TABLE                16730012
167400                     MOVE '6400-LOAD-ITEM-CURSOR-TBL1'            16740014
167500                                TO  PV-PARAGRAPH-NAME             16750031
167600                     MOVE 'ITEM TABLE OVERFLOW REG TBL1'          16760014
167700                                TO  PV-DB2-OPERATION              16770012
167800                     PERFORM 9100-SQL-ABEND                       16780031
167900                  ELSE                                            16790012
168000                     MOVE ZEROES TO TB1-SLD-QTY(TB1-INDX)         16800012
168100                     MOVE ZEROES TO TB1-SKU-NBR-CLEAR(TB1-INDX)   16810017
168200                  END-IF                                          16820012
168300                  MOVE ZEROES TO PV-SUM-SLD-QTY                   16830071
168400             WHEN SQLCODE = +100                                  16840012
168500                  CONTINUE                                        16850012
168600             WHEN SQLWARN0 NOT EQUAL SPACE                        16860012
168700             WHEN SQLCODE NOT EQUAL ZERO                          16870012
168800                  MOVE '6400-LOAD-ITEM-CURSOR-TBL1'               16880014
168900                                   TO PV-PARAGRAPH-NAME           16890008
169000                  MOVE 'ERROR ON FETCHING ITEM CURSOR'            16900012
169100                                   TO PV-DB2-OPERATION            16910008
169200                  DISPLAY 'SQLCODE= ' SQLCODE                     16920012
169300                  PERFORM 9100-SQL-ABEND                          16930012
169400           END-EVALUATE                                           16940012
169500     END-PERFORM.                                                 16950012
169600                                                                  16960008
169700*6400-EXIT.                                                       16970009
169800                                                                  16980009
169900*----------------------------------------------------------       16990014
170000* 6410-LOAD-ITEM-CURSOR-TBL2.                                     17000014
170100*     FETCH THE CLEARANCE ITEM CURSOR FOR 2 MONTHS AGO AND        17010018
170200*     AND LOAD THE ITEMS INTO A TABLE.                            17020018
170300*----------------------------------------------------------       17030014
170400 6410-LOAD-ITEM-CURSOR-TBL2.                                      17040014
170500                                                                  17050014
170600     PERFORM                                                      17060014
170700         WITH TEST AFTER                                          17070014
170800         UNTIL SQLCODE = +100                                     17080014
170900                                                                  17090014
171000           EXEC SQL                                               17100014
171100              FETCH CL-ITEM-CURSOR                                17110014
171200              INTO  :EPITM-SKU-NBR                                17120014
171300                   ,:PV-SUM-SLD-QTY                               17130071
171400           END-EXEC                                               17140014
171500                                                                  17150014
171600           EVALUATE TRUE                                          17160014
171700             WHEN SQLCODE = 0                                     17170014
171800                  MOVE EPITM-SKU-NBR TO                           17180017
171900                            TB2-SKU-NBR-CLEAR(TB2-INDX)           17190050
172000                  MOVE PV-SUM-SLD-QTY TO TB2-SLD-QTY(TB2-INDX)    17200071
172100                  SET TB2-INDX UP BY +1                           17210014
172200                  ADD +1 TO PV-SKU-MAX-SUB-M2                     17220031
172300                  IF TB2-INDX > PC-MAX-ITEMS-TABLE                17230014
172400                     MOVE '6410-LOAD-ITEM-CURSOR-TBL2'            17240014
172500                                TO  PV-PARAGRAPH-NAME             17250031
172600                     MOVE 'ITEM TABLE OVERFLOW REG TBL2'          17260014
172700                                TO  PV-DB2-OPERATION              17270014
172800                     PERFORM 9100-SQL-ABEND                       17280031
172900                  ELSE                                            17290014
173000                     MOVE ZEROES TO TB2-SLD-QTY(TB2-INDX)         17300014
173100                     MOVE ZEROES TO TB2-SKU-NBR-CLEAR(TB2-INDX)   17310017
173200                  END-IF                                          17320014
173300                  MOVE ZEROES TO PV-SUM-SLD-QTY                   17330071
173400             WHEN SQLCODE = +100                                  17340014
173500                  CONTINUE                                        17350014
173600             WHEN SQLWARN0 NOT EQUAL SPACE                        17360014
173700             WHEN SQLCODE NOT EQUAL ZERO                          17370014
173800                  MOVE '6410-LOAD-ITEM-CURSOR-TBL2'               17380014
173900                                   TO PV-PARAGRAPH-NAME           17390014
174000                  MOVE 'ERROR ON FETCHING ITEM CURSOR'            17400014
174100                                   TO PV-DB2-OPERATION            17410014
174200                  DISPLAY 'SQLCODE= ' SQLCODE                     17420014
174300                  PERFORM 9100-SQL-ABEND                          17430014
174400           END-EVALUATE                                           17440014
174500     END-PERFORM.                                                 17450014
174600                                                                  17460014
174700*6410-EXIT.                                                       17470014
174800                                                                  17480014
174900*----------------------------------------------------------       17490014
175000* 6420-LOAD-ITEM-CURSOR-TBL3.                                     17500014
175100*     FETCH THE CLEARANCE ITEM CURSOR FOR 3 MONTHS AGO AND        17510018
175200*     AND LOAD THE ITEMS INTO A TABLE.                            17520018
175300*----------------------------------------------------------       17530014
175400 6420-LOAD-ITEM-CURSOR-TBL3.                                      17540014
175500                                                                  17550014
175600     PERFORM                                                      17560014
175700         WITH TEST AFTER                                          17570014
175800         UNTIL SQLCODE = +100                                     17580014
175900                                                                  17590014
176000           EXEC SQL                                               17600014
176100              FETCH CL-ITEM-CURSOR                                17610014
176200              INTO  :EPITM-SKU-NBR                                17620014
176300                   ,:PV-SUM-SLD-QTY                               17630071
176400           END-EXEC                                               17640014
176500                                                                  17650014
176600           EVALUATE TRUE                                          17660014
176700             WHEN SQLCODE = 0                                     17670014
176800                  MOVE EPITM-SKU-NBR TO                           17680017
176900                            TB3-SKU-NBR-CLEAR(TB3-INDX)           17690017
177000                  MOVE PV-SUM-SLD-QTY TO TB3-SLD-QTY(TB3-INDX)    17700078
177100                  SET TB3-INDX UP BY +1                           17710014
177200                  ADD +1 TO PV-SKU-MAX-SUB-M3                     17720031
177300                  IF TB3-INDX > PC-MAX-ITEMS-TABLE                17730014
177400                     MOVE '6420-LOAD-ITEM-CURSOR-TBL3'            17740014
177500                                TO  PV-PARAGRAPH-NAME             17750031
177600                     MOVE 'ITEM TABLE OVERFLOW REG TBL3'          17760014
177700                                TO  PV-DB2-OPERATION              17770014
177800                     PERFORM 9100-SQL-ABEND                       17780031
177900                  ELSE                                            17790014
178000                     MOVE ZEROES TO TB3-SLD-QTY(TB3-INDX)         17800014
178100                     MOVE ZEROES TO TB3-SKU-NBR-CLEAR(TB3-INDX)   17810017
178200                  END-IF                                          17820014
178300                  MOVE ZEROES TO PV-SUM-SLD-QTY                   17830071
178400             WHEN SQLCODE = +100                                  17840014
178500                  CONTINUE                                        17850014
178600             WHEN SQLWARN0 NOT EQUAL SPACE                        17860014
178700             WHEN SQLCODE NOT EQUAL ZERO                          17870014
178800                  MOVE '6420-LOAD-ITEM-CURSOR-TBL3'               17880014
178900                                   TO PV-PARAGRAPH-NAME           17890014
179000                  MOVE 'ERROR ON FETCHING ITEM CURSOR'            17900014
179100                                   TO PV-DB2-OPERATION            17910014
179200                  DISPLAY 'SQLCODE= ' SQLCODE                     17920014
179300                  PERFORM 9100-SQL-ABEND                          17930014
179400           END-EVALUATE                                           17940014
179500     END-PERFORM.                                                 17950014
179600                                                                  17960014
179700*6420-EXIT.                                                       17970014
179800                                                                  17980014
179900*-------------------------------------------------------------    17990008
180000* 6500-CLOSE-ITEM-CURSOR.                                         18000008
180100*     CLOSE THE CLEARANCE ITEM CURSOR.                            18010008
180200*-------------------------------------------------------------    18020008
180300 6500-CLOSE-ITEM-CURSOR.                                          18030008
180400                                                                  18040008
180500     PERFORM                                                      18050012
180600         WITH TEST AFTER                                          18060012
180700         VARYING PV-SQL-SUB                                       18070012
180800         FROM 1 BY 1                                              18080012
180900         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 18090012
181000                   OR  SQLCODE = 0)                               18100012
181100                                                                  18110012
181200           EXEC SQL                                               18120008
181300              CLOSE CL-ITEM-CURSOR                                18130008
181400           END-EXEC                                               18140008
181500                                                                  18150008
181600           EVALUATE TRUE                                          18160012
181700             WHEN SQLCODE = -904                                  18170012
181800             WHEN SQLCODE = -911                                  18180012
181900             WHEN SQLCODE = -913                                  18190012
182000             WHEN SQLCODE = 0                                     18200012
182100                  CONTINUE                                        18210012
182200             WHEN SQLWARN0 NOT EQUAL SPACE                        18220012
182300             WHEN SQLCODE NOT EQUAL ZERO                          18230012
182400                  MOVE '6500-CLOSE-ITEM-CURSOR'                   18240012
182500                                   TO PV-PARAGRAPH-NAME           18250008
182600                  MOVE 'ERROR ON CLOSE OF ITEM CURSOR'            18260012
182700                                   TO PV-DB2-OPERATION            18270008
182800                  PERFORM 9100-SQL-ABEND                          18280012
182900           END-EVALUATE                                           18290012
183000     END-PERFORM.                                                 18300012
183100                                                                  18310008
183200     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         18320012
183300        MOVE '6500-CLOSE-ITEM-CURSOR'                             18330017
183400                               TO  PV-PARAGRAPH-NAME              18340012
183500        MOVE 'CLOSE RETRIES EXCEEDED'                             18350012
183600                               TO  PV-DB2-OPERATION               18360012
183700        PERFORM 9100-SQL-ABEND                                    18370012
183800     END-IF.                                                      18380012
183900                                                                  18390012
184000*6500-EXIT.                                                       18400009
184100                                                                  18410009
184200*----------------------------------------------------------       18420099
184300* 6600-OPEN-D927-SKU-CURSOR.                                      18430099
184400*     OPEN THE D927 SKU CURSOR.                                   18440099
184500*----------------------------------------------------------       18450099
184600 6600-OPEN-D927-SKU-CURSOR.                                       18460099
184700                                                                  18470099
184800     PERFORM                                                      18480099
184900         WITH TEST AFTER                                          18490099
185000         VARYING PV-SQL-SUB                                       18500099
185100         FROM 1 BY 1                                              18510099
185200         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 18520099
185300                   OR  SQLCODE = 0)                               18530099
185400                                                                  18540099
185500           EXEC SQL                                               18550099
185600              OPEN D927-SKU-CURSOR                                18560099
185700           END-EXEC                                               18570099
185800                                                                  18580099
185900         EVALUATE TRUE                                            18590099
186000             WHEN SQLCODE = -904                                  18600099
186100             WHEN SQLCODE = -911                                  18610099
186200             WHEN SQLCODE = -913                                  18620099
186300             WHEN SQLCODE = 0                                     18630099
186400                 CONTINUE                                         18640099
186500             WHEN SQLWARN0 NOT EQUAL SPACE                        18650099
186600             WHEN SQLCODE NOT EQUAL ZERO                          18660099
186700                  MOVE '6600-OPEN-D927-SKU-CURSOR'                18670099
186800                                     TO PV-PARAGRAPH-NAME         18680099
186900                  MOVE 'ERROR ON OPEN OF D927 SKU CURSOR'         18690099
187000                                     TO PV-DB2-OPERATION          18700099
187100                  PERFORM 9100-SQL-ABEND                          18710099
187200         END-EVALUATE                                             18720099
187300     END-PERFORM.                                                 18730099
187400                                                                  18740099
187500     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         18750099
187600        MOVE '6600-OPEN-D927-SKU-CURSOR'                          18760099
187700                               TO  PV-PARAGRAPH-NAME              18770099
187800        MOVE 'OPEN RETRIES EXCEEDED'                              18780099
187900                               TO  PV-DB2-OPERATION               18790099
188000        PERFORM 9100-SQL-ABEND                                    18800099
188100     END-IF.                                                      18810099
188200                                                                  18820099
188300*6600-EXIT.                                                       18830099
188400                                                                  18840099
188500*----------------------------------------------------------       18850099
188600* 6700-FETCH-D927-SKU-CURSOR.                                     18860099
188700*     FETCH THE D927 SKU CURSOR.                                  18870099
188800*----------------------------------------------------------       18880099
188900 6700-FETCH-D927-SKU-CURSOR.                                      18890099
189000                                                                  18900099
189100     PERFORM                                                      18910099
189200         WITH TEST AFTER                                          18920099
189300         VARYING PV-SQL-SUB                                       18930099
189400         FROM 1 BY 1                                              18940099
189500         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 18950099
189600                   OR  SQLCODE = 0                                18960099
189700                   OR  SQLCODE = +100)                            18970099
189800                                                                  18980099
189900           EXEC SQL                                               18990099
190000              FETCH D927-SKU-CURSOR                               19000099
190100              INTO  :XST00011-INTR-UPC-ID                         19010099
190200                   ,:XST00010-SKU-NBR                             19020099
190300                   ,:XST00010-REGN-PRIC-IND                       19030099
190400           END-EXEC                                               19040099
190500                                                                  19050099
190600          EVALUATE TRUE                                           19060099
190700             WHEN SQLCODE = -904                                  19070099
190800             WHEN SQLCODE = -911                                  19080099
190900             WHEN SQLCODE = -913                                  19090099
191000                  CONTINUE                                        19100099
191100             WHEN SQLCODE = ZERO                                  19110099
191200                  SET PS-NOT-EOF-D927-CURSOR   TO TRUE            19120099
191300                  ADD 1 TO PV-COUNT-FETCH-RECS                    19130099
191400                  MOVE XST00011-INTR-UPC-ID TO PV-INTR-UPC-ID     19140099
191500             WHEN SQLCODE = +100                                  19150099
191600                  SET PS-END-OF-D927-CURSOR    TO TRUE            19160099
191700             WHEN SQLWARN0 NOT EQUAL SPACE                        19170099
191800             WHEN SQLCODE NOT EQUAL ZERO                          19180099
191900                  MOVE '6700-FETCH-D927-SKU-CURSOR'               19190099
192000                                     TO PV-PARAGRAPH-NAME         19200099
192100                  MOVE 'ERROR ON FETCHING D927 SKU CURSOR'        19210099
192200                                     TO PV-DB2-OPERATION          19220099
192300                  DISPLAY 'SQLCODE= ' SQLCODE                     19230099
192400                  PERFORM 9100-SQL-ABEND                          19240099
192500          END-EVALUATE                                            19250099
192600     END-PERFORM.                                                 19260099
192700                                                                  19270099
192800     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         19280099
192900        MOVE '6700-FETCH-D927-SKU-CURSOR'                         19290099
193000                              TO  PV-PARAGRAPH-NAME               19300099
193100        MOVE 'FETCH RETRIES EXCEEDED'                             19310099
193200                              TO  PV-DB2-OPERATION                19320099
193300        PERFORM 9100-SQL-ABEND                                    19330099
193400     END-IF.                                                      19340099
193500                                                                  19350099
193600*6700-EXIT.                                                       19360099
193700                                                                  19370099
193800*-------------------------------------------------------------    19380099
193900* 6800-CLOSE-D927-SKU-CURSOR.                                     19390099
194000*     CLOSE THE D927 SKU CURSOR.                                  19400099
194100*-------------------------------------------------------------    19410099
194200 6800-CLOSE-D927-SKU-CURSOR.                                      19420099
194300                                                                  19430099
194400     PERFORM                                                      19440099
194500         WITH TEST AFTER                                          19450099
194600         VARYING PV-SQL-SUB                                       19460099
194700         FROM 1 BY 1                                              19470099
194800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 19480099
194900                   OR  SQLCODE = 0)                               19490099
195000                                                                  19500099
195100           EXEC SQL                                               19510099
195200              CLOSE D927-SKU-CURSOR                               19520099
195300           END-EXEC                                               19530099
195400                                                                  19540099
195500          EVALUATE TRUE                                           19550099
195600             WHEN SQLCODE = -904                                  19560099
195700             WHEN SQLCODE = -911                                  19570099
195800             WHEN SQLCODE = -913                                  19580099
195900             WHEN SQLCODE = 0                                     19590099
196000                  CONTINUE                                        19600099
196100             WHEN SQLWARN0 NOT EQUAL SPACE                        19610099
196200             WHEN SQLCODE NOT EQUAL ZERO                          19620099
196300                  MOVE '6800-CLOSE-D927-SKU-CURSOR'               19630099
196400                                      TO PV-PARAGRAPH-NAME        19640099
196500                  MOVE 'ERROR ON CLOSE OF D927 SKU CURSOR'        19650099
196600                                      TO PV-DB2-OPERATION         19660099
196700                  PERFORM 9100-SQL-ABEND                          19670099
196800          END-EVALUATE                                            19680099
196900     END-PERFORM.                                                 19690099
197000                                                                  19700099
197100     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         19710099
197200        MOVE '6800-CLOSE-D927-SKU-CURSOR'                         19720099
197300                              TO  PV-PARAGRAPH-NAME               19730099
197400        MOVE 'CLOSE RETRIES EXCEEDED'                             19740099
197500                              TO  PV-DB2-OPERATION                19750099
197600        PERFORM 9100-SQL-ABEND                                    19760099
197700     END-IF.                                                      19770099
197800                                                                  19780099
197900*6800-EXIT.                                                       19790099
198000                                                                  19800099
198100*----------------------------------------------------             19810015
198200* 7010-SEARCH-ITEM-TABLE1.                                        19820015
198300*     THIS ROUTINE RETURNS ITEM FROM ITEM TABLE IF MATCH WITH     19830015
198400*     CLEARANCE ITEM.                                             19840015
198500*----------------------------------------------------             19850015
198600 7010-SEARCH-ITEM-TABLE1.                                         19860015
198700                                                                  19870059
198800     IF TB1-SKU-NBR-CLEAR(TB1-INDX) EQUAL ZEROES AND              19880017
198900        TB1-SLD-QTY(TB1-INDX) EQUAL ZEROES                        19890015
199000         SET PS-END-OF-SEARCH TO TRUE                             19900068
199100     ELSE                                                         19910015
199200        IF PV-SAVE-SKU-NBR EQUAL TB1-SKU-NBR-CLEAR(TB1-INDX)      19920017
199300           SET PS-ITEM-FOUND TO TRUE                              19930068
199400           SET PS-END-OF-SEARCH TO TRUE                           19940068
199500           MOVE TB1-SLD-QTY(TB1-INDX) TO PV-TOTAL-SLD-QTY         19950059
199600        ELSE                                                      19960015
199700            SET TB1-INDX UP BY +1                                 19970015
199800        END-IF                                                    19980015
199900     END-IF.                                                      19990015
200000                                                                  20000015
200100*7010-EXIT.                                                       20010015
200200                                                                  20020015
200300*------------------------------------------------------           20030015
200400* 7110-SEARCH-ITEM-TABLE2.                                        20040015
200500*     THIS ROUTINE RETURNS ITEM FROM ITEM TABLE IF MATCH WITH     20050015
200600*     CLEARANCE ITEM.                                             20060015
200700*------------------------------------------------------           20070015
200800 7110-SEARCH-ITEM-TABLE2.                                         20080015
200900                                                                  20090015
201000     IF TB2-SKU-NBR-CLEAR(TB2-INDX) EQUAL ZEROES AND              20100017
201100        TB2-SLD-QTY(TB2-INDX) EQUAL ZEROES                        20110015
201200         SET PS-END-OF-SEARCH TO TRUE                             20120068
201300     ELSE                                                         20130015
201400        IF PV-SAVE-SKU-NBR EQUAL TB2-SKU-NBR-CLEAR(TB2-INDX)      20140017
201500           SET PS-ITEM-FOUND TO TRUE                              20150068
201600           SET PS-END-OF-SEARCH TO TRUE                           20160068
201700           MOVE TB2-SLD-QTY(TB2-INDX) TO PV-TOTAL-SLD-QTY         20170059
201800        ELSE                                                      20180015
201900           SET TB2-INDX UP BY +1                                  20190015
202000        END-IF                                                    20200015
202100     END-IF.                                                      20210015
202200                                                                  20220015
202300*7110-EXIT.                                                       20230015
202400                                                                  20240015
202500*------------------------------------------------------           20250015
202600* 7210-SEARCH-ITEM-TABLE3.                                        20260015
202700*     THIS ROUTINE RETURNS ITEM FROM ITEM TABLE IF MATCH WITH     20270015
202800*     CLEARANCE ITEM.                                             20280015
202900*------------------------------------------------------           20290015
203000 7210-SEARCH-ITEM-TABLE3.                                         20300015
203100                                                                  20310015
203200     IF TB3-SKU-NBR-CLEAR(TB3-INDX) EQUAL ZEROES AND              20320017
203300        TB3-SLD-QTY(TB3-INDX) EQUAL ZEROES                        20330015
203400         SET PS-END-OF-SEARCH TO TRUE                             20340068
203500     ELSE                                                         20350015
203600        IF PV-SAVE-SKU-NBR EQUAL TB3-SKU-NBR-CLEAR(TB3-INDX)      20360017
203700           SET PS-ITEM-FOUND TO TRUE                              20370068
203800           SET PS-END-OF-SEARCH TO TRUE                           20380068
203900           MOVE TB3-SLD-QTY(TB3-INDX) TO PV-TOTAL-SLD-QTY         20390059
204000        ELSE                                                      20400015
204100           SET TB3-INDX UP BY +1                                  20410015
204200        END-IF                                                    20420015
204300     END-IF.                                                      20430015
204400                                                                  20440015
204500*7210-EXIT.                                                       20450015
204600                                                                  20460083
204700*----------------------------------------------------------       20470083
204800* 8000-WRITE-EXCL-SKU-REC.                                        20480083
204900*  WRITES AN EXCLUDED SKU RECORD TO THE FILE.                     20490083
205000*----------------------------------------------------------       20500083
205100 8000-WRITE-EXCL-SKU-REC.                                         20510083
205200                                                                  20520083
205300     WRITE EXCL-SKU-EXTRACT-REC                                   20530083
205400         FROM EP132-PLU-EXCL-REC.                                 20540083
205500                                                                  20550083
205600     ADD 1 TO PV-COUNT-EXCL-RECS.                                 20560083
205700                                                                  20570083
205800*8000-EXIT.                                                       20580083
205900                                                                  20590015
206000*---------------------------------------------------------        20600001
206100* 9100-SQL-ABEND.                                                 20610001
206200*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING             20620018
206300*     CODE OCCURS.                                                20630018
206400*---------------------------------------------------------        20640001
206500 9100-SQL-ABEND.                                                  20650001
206600                                                                  20660068
206700     SET AC-DB2-ERROR TO TRUE.                                    20670068
206800     DISPLAY '** ABEND     **'.                                   20680001
206900     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        20690001
207000     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              20700001
207100     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               20710001
207200                                                                  20720001
207300     COPY DPPD004.                                                20730001
207400     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         20740001
207500                                                                  20750001
207600*9100-EXIT.                                                       20760009
207700                                                                  20770009
207800*---------------------------------------------------------        20780005
207900* 9999-ABEND.                                                     20790005
208000*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  20800005
208100*---------------------------------------------------------        20810005
208200 9999-ABEND.                                                      20820005
208300                                                                  20830080
208400     DISPLAY '** ABEND           **'.                             20840005
208500     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  20850005
208600     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        20860005
208700     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       20870005
208800     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       20880005
208900     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         20890005
209000                                                                  20900009
209100*9999-EXIT.                                                       20910009
209200                                                                  20920009
