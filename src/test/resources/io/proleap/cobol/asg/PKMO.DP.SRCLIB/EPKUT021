000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.      EPKUT021.                                       00030000
000400 AUTHOR.          STEVEN NOWAK.                                   00040000
000500 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00050000
000600 DATE-WRITTEN.    07/15/09.                                       00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900******************************************************************00090000
001000*       WRITE SKU ATTRIBUTE INFO FOR REACTIVATED SKUS             00100000
001100*=================================================================00110000
001200* MODULE TYPE: COBOL2 DB2 BATCH                                   00120001
001300*                                                                 00130000
001400* THIS PROGRAM IDENTIFIES SKUS THAT HAVE BEEN RE-ACTIVATED.       00140000
001500* IT WRITES OUT THOSE RECORDS WHICH WILL BE UPDATED IN EPKUP102   00150005
001600* TO CAUSE THEM TO BE INCLUDED IN NIGHTLY PLU AND XREF PROCESSING.00160000
001700*                                                                 00170000
001800* THIS PROGRAM USES A CURSOR THAT WILL JOIN THE XST_SKU_LOC       00180000
001900* TABLE AND THE XST_SKU_ATTR TABLE.  IT WILL SELECT ALL UPC'S     00190000
002000* THAT ARE CURRENTLY ACTIVE BUT HAVE A PLU DOWNLOAD EXCLUSION     00200000
002100* INDICATOR SET TO YES.  IT WILL THEN WRITE THIS RECORD TO BE     00210000
002200* PROCESSED IN ANOTHER PROGRAM TO UPDATE THIS ATTRIBUTE           00220000
002300* TO SAY NO INSTEAD SO IT CAN BE INCLUDED IN THE NIGHTLY PLU      00230000
002400* AND XREF PROCESSING.  IT WILL CHANGE THE PLU_DWNLD_EXCL_IND     00240000
002500* FIELD ON THE XST_SKU_ATTR TABLE TO A 'N' INSTEAD OF A 'Y'.      00250000
002600*                                                                 00260000
002700*========================== CHANGE LOG ===========================00270000
002800*  AUTH       BY          DATE                 DESCRIPTION        00280000
002900*=================================================================00290000
003000* WR36870   S. NOWAK    07-15-09   CREATE PROGRAM                 00300000
003100*                                                                 00310000
003200******************************************************************00320000
003300                                                                  00330000
003400 ENVIRONMENT DIVISION.                                            00340000
003500 CONFIGURATION SECTION.                                           00350000
003600                                                                  00360000
003700 SOURCE-COMPUTER. IBM-3090.                                       00370000
003800 OBJECT-COMPUTER. IBM-3090.                                       00380000
003900                                                                  00390000
004000 INPUT-OUTPUT SECTION.                                            00400000
004100 FILE-CONTROL.                                                    00410000
004200                                                                  00420000
004300     SELECT XST-FILE ASSIGN TO OUT01.                             00430000
004400     SELECT SKU-FILE ASSIGN TO OUT02.                             00440000
004500                                                                  00450000
004600 DATA DIVISION.                                                   00460000
004700 FILE SECTION.                                                    00470000
004800                                                                  00480000
004900 FD  XST-FILE                                                     00490000
005000     RECORDING MODE IS F                                          00500000
005100     BLOCK CONTAINS 0  RECORDS                                    00510000
005200     LABEL RECORDS ARE STANDARD                                   00520000
005300     RECORD CONTAINS 36 CHARACTERS                                00530000
005400     DATA RECORDS ARE XST-REC.                                    00540000
005500                                                                  00550000
005600 01  XST-REC                          PIC  X(36).                 00560000
005700                                                                  00570000
005800 FD  SKU-FILE                                                     00580000
005900     RECORDING MODE IS F                                          00590000
006000     BLOCK CONTAINS 0  RECORDS                                    00600000
006100     LABEL RECORDS ARE STANDARD                                   00610000
006200     RECORD CONTAINS 50 CHARACTERS                                00620000
006300     DATA RECORDS ARE SKU-REC.                                    00630000
006400                                                                  00640000
006500 01  SKU-REC                          PIC  X(50).                 00650000
006600                                                                  00660000
006700                                                                  00670000
006800***************************************************************** 00680000
006900*                       WORKING STORAGE                           00690000
007000***************************************************************** 00700000
007100 WORKING-STORAGE SECTION.                                         00710000
007200                                                                  00720000
007300 01  W-START                          PIC  X(50) VALUE            00730000
007400     ' *** WORKING STORAGE STARTS HERE FOR EPKUT021 *** '.        00740000
007500                                                                  00750000
007600***************************************************************** 00760000
007700*                         SWITCHES                                00770000
007800***************************************************************** 00780000
007900 01  PS-PROGRAM-SWITCHES.                                         00790000
008000     05  PS-END-OF-SKU-CURSOR-SW      PIC  X(01) VALUE 'N'.       00800000
008100         88  PS-END-OF-SKU-CURSOR                VALUE 'Y'.       00810000
008200         88  PS-NOT-EOF-SKU-CURSOR               VALUE 'N'.       00820000
008300                                                                  00830000
008400******************************************************************00840000
008500*                       ACCUMULATORS                              00850000
008600******************************************************************00860000
008700 01  PC-PROGRAM-COUNTERS.                                         00870000
008800     05  PC-RECS-FETCHED              PIC  9(09) VALUE ZEROS.     00880000
008900     05  PC-SKU-WRITTEN               PIC  9(09) VALUE ZEROS.     00890000
009000     05  PC-XST-WRITTEN               PIC  9(09) VALUE ZEROS.     00900000
009100                                                                  00910000
009200******************************************************************00920000
009300*                           CONSTANTS                             00930000
009400******************************************************************00940000
009500 01  PC-PROGRAM-CONSTANTS.                                        00950000
009600     05  PC-PGM-NAME                  PIC  X(08) VALUE            00960000
009700                                                 'EPKUT021'.      00970000
009800     05  PC-MAX-RETRIES               PIC S9(04) VALUE +5 COMP.   00980000
009900                                                                  00990000
010000******************************************************************01000000
010100*                          VARIABLES                              01010000
010200******************************************************************01020000
010300 01  PV-PROGRAM-VARIABLES.                                        01030000
010400     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACE.     01040000
010500     05  PV-DB2-OPERATION             PIC  X(30) VALUE SPACE.     01050000
010600     05  PV-SQL-SUB                   PIC S9(04) VALUE +0 COMP.   01060000
010700     05  PV-INTR-UPC-ID-NUM           PIC  9(10) VALUE  0 COMP.   01070000
010800                                                                  01080000
010900******************************************************************01090000
011000*               SYSTEM TIME AND DATE VARIABLES                    01100000
011100******************************************************************01110000
011200 01  SYS-DATE-TIME.                                               01120000
011300     05  SYS-DATE                     PIC  X(08) VALUE SPACES.    01130000
011400     05  SYS-TIME                     PIC  X(08) VALUE SPACES.    01140000
011500                                                                  01150000
011600 01  ST-BEG-TIME.                                                 01160000
011700     05  ST-BEG-HR                    PIC  9(02) VALUE ZEROS.     01170000
011800     05  FILLER                       PIC  X(01) VALUE ':'.       01180000
011900     05  ST-BEG-MN                    PIC  9(02) VALUE ZEROS.     01190000
012000                                                                  01200000
012100 01  ST-END-TIME.                                                 01210000
012200     05  ST-END-HR                    PIC  9(02) VALUE ZEROS.     01220000
012300     05  FILLER                       PIC  X(01) VALUE ':'.       01230000
012400     05  ST-END-MN                    PIC  9(02) VALUE ZEROS.     01240000
012500                                                                  01250000
012600 01  SD-EDIT-DATE.                                                01260000
012700     05  SD-MONTH                     PIC  9(02) VALUE ZEROS.     01270000
012800     05  FILLER                       PIC  X(01) VALUE '-'.       01280000
012900     05  SD-DAY                       PIC  9(02) VALUE ZEROS.     01290000
013000     05  FILLER                       PIC  X(01) VALUE '-'.       01300000
013100     05  SD-CENT                      PIC  9(02) VALUE ZEROS.     01310000
013200     05  SD-YEAR                      PIC  9(02) VALUE ZEROS.     01320000
013300                                                                  01330000
013400******************************************************************01340000
013500*                        ERROR HANDLING                           01350000
013600******************************************************************01360000
013700 01  ABEND-CODE                       PIC S9(04) VALUE ZEROS      01370000
013800                                                 COMP SYNC.       01380000
013900                                                                  01390000
014000     88  ABEND-4001-WRITE-ERROR                  VALUE +4001.     01400000
014100     88  ABEND-4002-READ-ERROR                   VALUE +4002.     01410000
014200     88  ABEND-4003-CTRL-CARD-ERROR              VALUE +4003.     01420000
014300     88  ABEND-4004-TABLE-ERROR                  VALUE +4004.     01430000
014400     88  ABEND-4005-OPEN-ERROR                   VALUE +4005.     01440000
014500     88  ABEND-4006-CLOSE-ERROR                  VALUE +4006.     01450000
014600     88  ABEND-4007-SEQUENCE-ERROR               VALUE +4007.     01460000
014700     88  ABEND-4008-DATA-ERROR                   VALUE +4008.     01470000
014800     88  ABEND-4009-KEY-DATA-ERROR               VALUE +4009.     01480000
014900     88  ABEND-4013-DB2-ERROR                    VALUE +4013.     01490000
015000     88  ABEND-4019-CAL-SUB-ERROR                VALUE +4019.     01500000
015100     88  ABEND-4020-MQ-ERROR                     VALUE +4020.     01510000
015200     88  ABEND-4444-FORCED-ABEND                 VALUE +4444.     01520000
015300                                                                  01530000
015400                                                                  01540000
015500******************************************************************01550000
015600* XST_SKU_ATTR REC LAYOUT                                         01560000
015700******************************************************************01570000
015800     COPY EPRD004.                                                01580000
015900                                                                  01590000
016000******************************************************************01600000
016100* INTERNAL UPC ID FILE LAYOUT                                     01610000
016200******************************************************************01620000
016300     COPY EPRD075.                                                01630000
016400                                                                  01640000
016500******************************************************************01650000
016600*  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            01660000
016700******************************************************************01670000
016800     COPY DPWS004.                                                01680000
016900                                                                  01690000
017000******************************************************************01700000
017100*  DB2 MESSAGE AREA                                               01710000
017200******************************************************************01720000
017300     COPY SQLCA2.                                                 01730000
017400                                                                  01740000
017500******************************************************************01750000
017600*  DB2 COMMUNICATION AREA.                                        01760000
017700******************************************************************01770000
017800     EXEC SQL                                                     01780000
017900          INCLUDE SQLCA                                           01790000
018000     END-EXEC.                                                    01800000
018100                                                                  01810000
018200******************************************************************01820000
018300*  DB2 TABLE XST00008 - SKU LOCATION TABLE(XST_SKU_LOC)           01830000
018400******************************************************************01840000
018500     EXEC SQL                                                     01850000
018600          INCLUDE XST00008                                        01860000
018700     END-EXEC.                                                    01870000
018800                                                                  01880000
018900******************************************************************01890000
019000*  DB2 TABLE XST00011 - SKU ATTRIBUTE TABLE(XST_SKU_ATTR)         01900000
019100******************************************************************01910000
019200     EXEC SQL                                                     01920000
019300          INCLUDE XST00011                                        01930000
019400     END-EXEC.                                                    01940000
019500                                                                  01950000
019600******************************************************************01960000
019700*  REACTIVATED SKU CURSOR WILL FETCH ALL SKUS THAT ARE ACTIVE     01970000
019800*  AND THAT HAVE A PLU DOWNLOAD EXCLUSION INDICATOR OF YES.       01980000
019900******************************************************************01990000
020000     EXEC SQL                                                     02000000
020100       DECLARE REACT-SKU-CURSOR CURSOR FOR                        02010000
020200            SELECT ATTR.INTR_UPC_ID                               02020000
020300            FROM   XST_SKU_LOC  LOC                               02030000
020400                  ,XST_SKU_ATTR ATTR                              02040000
020500            WHERE  LOC.INTR_UPC_ID         = ATTR.INTR_UPC_ID     02050000
020600              AND  LOC.LOC_SKU_STAT_CDE   <> '30'                 02060000
020700              AND  LOC.END_TMST            IS NULL                02070000
020800              AND  ATTR.PLU_DWNLD_EXCL_IND = 'Y'                  02080000
020900            ORDER BY INTR_UPC_ID                                  02090000
021000              WITH UR                                             02100000
021100     END-EXEC.                                                    02110000
021200                                                                  02120000
021300                                                                  02130000
021400                                                                  02140000
021500 PROCEDURE DIVISION.                                              02150000
021600******************************************************************02160000
021700* MAINLINE                                                        02170000
021800******************************************************************02180000
021900 0000-MAINLINE.                                                   02190000
022000                                                                  02200000
022100     PERFORM 1000-INITIALIZATION.                                 02210000
022200                                                                  02220000
022300     PERFORM 2000-PROCESS-CURSOR                                  02230000
022400       UNTIL PS-END-OF-SKU-CURSOR.                                02240000
022500                                                                  02250000
022600     PERFORM 6200-CLOSE-REACT-SKU-CURSOR.                         02260000
022700                                                                  02270000
022800     PERFORM 9900-END-OF-JOB-ROUTINE.                             02280000
022900                                                                  02290000
023000     GOBACK.                                                      02300000
023100                                                                  02310000
023200                                                                  02320000
023300******************************************************************02330000
023400* OPENS UP THE OUTPUT FILE, PERFORMS THE FIRST OPEN AND FETCH     02340000
023500* OF THE REACTICATION SKU CURSOR.                                 02350000
023600******************************************************************02360000
023700 1000-INITIALIZATION.                                             02370000
023800                                                                  02380000
023900     OPEN OUTPUT XST-FILE                                         02390000
024000                 SKU-FILE.                                        02400000
024100                                                                  02410000
024200     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 02420000
024300                                                                  02430000
024400     MOVE SYS-TIME (1:2) TO ST-BEG-HR.                            02440000
024500     MOVE SYS-TIME (3:2) TO ST-BEG-MN.                            02450000
024600                                                                  02460000
024700     MOVE SYS-DATE (1:2) TO SD-CENT.                              02470000
024800     MOVE SYS-DATE (3:2) TO SD-YEAR.                              02480000
024900     MOVE SYS-DATE (5:2) TO SD-MONTH.                             02490000
025000     MOVE SYS-DATE (7:2) TO SD-DAY.                               02500000
025100                                                                  02510000
025200     PERFORM 6000-OPEN-REACT-SKU-CURSOR.                          02520000
025300     PERFORM 6100-FETCH-REACT-SKU-CURSOR.                         02530000
025400                                                                  02540000
025500                                                                  02550000
025600******************************************************************02560000
025700* WRITES THE UPC NUMBER TO THE EXTRACT FILES AND FETCHES NEXT ROW 02570000
025800******************************************************************02580000
025900 2000-PROCESS-CURSOR.                                             02590000
026000                                                                  02600000
026100     PERFORM 2100-WRITE-XST-DATA.                                 02610000
026200                                                                  02620000
026300     PERFORM 2200-WRITE-SKU-DATA.                                 02630000
026400                                                                  02640000
026500     PERFORM 6100-FETCH-REACT-SKU-CURSOR.                         02650000
026600                                                                  02660000
026700                                                                  02670000
026800******************************************************************02680000
026900* WRITE THE UPC REC TO BE USED IN THE UPDATE OF THE               02690000
027000* PLU-DWNL-EXCL-IND FOR THIS ITEM                                 02700000
027100******************************************************************02710000
027200 2100-WRITE-XST-DATA.                                             02720000
027300                                                                  02730000
027400     MOVE XST00011-INTR-UPC-ID TO EP004-INTR-UPC-ID.              02740000
027500     MOVE SPACES               TO EP004-PLU-DWNLD-EXCL-IND.       02750000
027600     MOVE ZEROS                TO EP004-LAST-NCLR-RTL-AMT.        02760000
027700     MOVE SPACES               TO EP004-LAST-UPD-TMST.            02770000
027800                                                                  02780000
027900     WRITE XST-REC FROM EP004-XST-REC.                            02790000
028000                                                                  02800000
028100     ADD 1 TO PC-XST-WRITTEN.                                     02810000
028200                                                                  02820000
028300                                                                  02830000
028400******************************************************************02840000
028500* WRITES THE SKU ATTRIBUTE UPC RECORD TO THE FILE.                02850000
028600******************************************************************02860000
028700 2200-WRITE-SKU-DATA.                                             02870000
028800                                                                  02880000
028900     INITIALIZE EP075-XREF-SKU-CHG-REC.                           02890000
029000                                                                  02900000
029100     MOVE XST00011-INTR-UPC-ID TO PV-INTR-UPC-ID-NUM.             02910000
029200     MOVE PV-INTR-UPC-ID-NUM   TO EP075-INTERNAL-UPC-ID.          02920000
029300                                                                  02930000
029400     WRITE SKU-REC FROM EP075-XREF-SKU-CHG-REC.                   02940000
029500                                                                  02950000
029600     ADD 1 TO PC-SKU-WRITTEN.                                     02960000
029700                                                                  02970000
029800                                                                  02980000
029900******************************************************************02990000
030000* OPEN THE REACTIVATION SKU CURSOR.                               03000000
030100******************************************************************03010000
030200 6000-OPEN-REACT-SKU-CURSOR.                                      03020000
030300                                                                  03030000
030400     PERFORM                                                      03040000
030500         WITH TEST AFTER                                          03050000
030600         VARYING PV-SQL-SUB                                       03060000
030700         FROM 1 BY 1                                              03070000
030800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 03080000
035600                   OR  SQLCODE = -904                             03081002
035600                   OR  SQLCODE = -911                             03082002
035600                   OR  SQLCODE = -913                             03083002
030900                   OR  SQLCODE = 0)                               03090000
031000                                                                  03100000
031100           EXEC SQL                                               03110000
031200              OPEN REACT-SKU-CURSOR                               03120000
031300           END-EXEC                                               03130000
031400                                                                  03140000
031500         EVALUATE TRUE                                            03150000
031600             WHEN SQLCODE = -904                                  03160000
031700             WHEN SQLCODE = -911                                  03170000
031800             WHEN SQLCODE = -913                                  03180000
031900             WHEN SQLCODE = 0                                     03190000
032000                 CONTINUE                                         03200000
032100                                                                  03210000
032200             WHEN SQLWARN0 NOT EQUAL SPACE                        03220000
032300             WHEN SQLCODE NOT EQUAL ZERO                          03230000
032400                  MOVE '6000-OPEN-REACT-SKU-CURSOR'               03240000
032500                                     TO PV-PARAGRAPH-NAME         03250000
032600                  MOVE 'ERROR ON OPEN OF REACT SKU CURSOR'        03260000
032700                                     TO PV-DB2-OPERATION          03270000
032800                                                                  03280000
032900                  SET ABEND-4005-OPEN-ERROR TO TRUE               03290000
033000                  PERFORM 9100-SQL-ABEND                          03300000
033100                                                                  03310000
033200         END-EVALUATE                                             03320000
033300     END-PERFORM.                                                 03330000
033400                                                                  03340000
033500     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        03350000
033600         MOVE '6000-OPEN-REACT-SKU-CURSOR'                        03360000
033700                               TO  PV-PARAGRAPH-NAME              03370000
033800         MOVE 'OPEN RETRIES EXCEEDED'                             03380000
033900                               TO  PV-DB2-OPERATION               03390000
034000                                                                  03400000
034100         SET ABEND-4005-OPEN-ERROR TO TRUE                        03410000
034200         PERFORM 9100-SQL-ABEND                                   03420000
034300     END-IF.                                                      03430000
034400                                                                  03440000
034500                                                                  03450000
034600******************************************************************03460000
034700* FETCH THE REACTIVATION SKU CURSOR.                              03470000
034800******************************************************************03480000
034900 6100-FETCH-REACT-SKU-CURSOR.                                     03490000
035000                                                                  03500000
035100     PERFORM                                                      03510000
035200         WITH TEST AFTER                                          03520000
035300         VARYING PV-SQL-SUB                                       03530000
035400         FROM 1 BY 1                                              03540000
035500         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 03550000
035600                   OR  SQLCODE = 0                                03560000
035600                   OR  SQLCODE = -904                             03561002
035600                   OR  SQLCODE = -911                             03562002
035600                   OR  SQLCODE = -913                             03563002
035700                   OR  SQLCODE = +100)                            03570000
035800                                                                  03580000
035900           EXEC SQL                                               03590000
036000              FETCH REACT-SKU-CURSOR                              03600000
036100              INTO  :XST00011-INTR-UPC-ID                         03610000
036200           END-EXEC                                               03620000
036300                                                                  03630000
036400          EVALUATE TRUE                                           03640000
036500             WHEN SQLCODE = -904                                  03650000
036600             WHEN SQLCODE = -911                                  03660000
036700             WHEN SQLCODE = -913                                  03670000
036800                  CONTINUE                                        03680000
036900                                                                  03690000
037000             WHEN SQLCODE = ZERO                                  03700000
037100                  SET PS-NOT-EOF-SKU-CURSOR   TO TRUE             03710000
037200                  ADD 1 TO PC-RECS-FETCHED                        03720000
037300                                                                  03730000
037400             WHEN SQLCODE = +100                                  03740000
037500                  SET PS-END-OF-SKU-CURSOR    TO TRUE             03750000
037600                                                                  03760000
037700             WHEN SQLWARN0 NOT EQUAL SPACE                        03770000
037800             WHEN SQLCODE NOT EQUAL ZERO                          03780000
037900                  MOVE '6100-FETCH-REACT-SKU-CURSOR'              03790000
038000                                     TO PV-PARAGRAPH-NAME         03800000
038100                  MOVE 'ERROR ON FETCHING REACT SKU CURSOR'       03810000
038200                                     TO PV-DB2-OPERATION          03820000
038300                                                                  03830000
038400                  SET ABEND-4002-READ-ERROR TO TRUE               03840000
038500                  PERFORM 9100-SQL-ABEND                          03850000
038600                                                                  03860000
038700          END-EVALUATE                                            03870000
038800     END-PERFORM.                                                 03880000
038900                                                                  03890000
039000     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        03900000
039100         MOVE '6100-FETCH-REACT-SKU-CURSOR'                       03910000
039200                               TO  PV-PARAGRAPH-NAME              03920000
039300         MOVE 'FETCH RETRIES EXCEEDED'                            03930000
039400                               TO  PV-DB2-OPERATION               03940000
039500                                                                  03950000
039600         SET ABEND-4002-READ-ERROR TO TRUE                        03960000
039700         PERFORM 9100-SQL-ABEND                                   03970000
039800     END-IF.                                                      03980000
039900                                                                  03990000
040000                                                                  04000000
040100******************************************************************04010000
040200* CLOSE THE REACTIVATION SKU CURSOR.                              04020000
040300******************************************************************04030000
040400 6200-CLOSE-REACT-SKU-CURSOR.                                     04040000
040500                                                                  04050000
040600     PERFORM                                                      04060000
040700         WITH TEST AFTER                                          04070000
040800         VARYING PV-SQL-SUB                                       04080000
040900         FROM 1 BY 1                                              04090000
041000         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 04100000
035600                   OR  SQLCODE = -904                             04101003
035600                   OR  SQLCODE = -911                             04102003
035600                   OR  SQLCODE = -913                             04103003
041100                   OR  SQLCODE = 0)                               04110000
041200                                                                  04120000
041300           EXEC SQL                                               04130000
041400              CLOSE REACT-SKU-CURSOR                              04140000
041500           END-EXEC                                               04150000
041600                                                                  04160000
041700          EVALUATE TRUE                                           04170000
041800             WHEN SQLCODE = -904                                  04180000
041900             WHEN SQLCODE = -911                                  04190000
042000             WHEN SQLCODE = -913                                  04200000
042100             WHEN SQLCODE = 0                                     04210000
042200                  CONTINUE                                        04220000
042300                                                                  04230000
042400             WHEN SQLWARN0 NOT EQUAL SPACE                        04240000
042500             WHEN SQLCODE NOT EQUAL ZERO                          04250000
042600                  MOVE '6200-CLOSE-REACT-SKU-CURSOR'              04260000
042700                                      TO PV-PARAGRAPH-NAME        04270000
042800                  MOVE 'ERROR ON CLOSE OF REACT SKU CURSOR'       04280000
042900                                      TO PV-DB2-OPERATION         04290000
043000                                                                  04300000
043100                  SET ABEND-4006-CLOSE-ERROR TO TRUE              04310000
043200                  PERFORM 9100-SQL-ABEND                          04320000
043300                                                                  04330000
043400          END-EVALUATE                                            04340000
043500     END-PERFORM.                                                 04350000
043600                                                                  04360000
043700     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        04370000
043800         MOVE '6200-CLOSE-REACT-SKU-CURSOR'                       04380000
043900                               TO  PV-PARAGRAPH-NAME              04390000
044000         MOVE 'CLOSE RETRIES EXCEEDED'                            04400000
044100                               TO  PV-DB2-OPERATION               04410000
044200                                                                  04420000
044300         SET ABEND-4006-CLOSE-ERROR TO TRUE                       04430000
044400         PERFORM 9100-SQL-ABEND                                   04440000
044500     END-IF.                                                      04450000
044600                                                                  04460000
044700                                                                  04470000
044800******************************************************************04480000
044900* ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.    04490000
045000******************************************************************04500000
045100 9100-SQL-ABEND.                                                  04510000
045200                                                                  04520000
045300     PERFORM 9900-END-OF-JOB-ROUTINE.                             04530000
045400                                                                  04540000
045500     DISPLAY '** ABEND     **'.                                   04550000
045600     DISPLAY '** PROGRAM   ** = ' PC-PGM-NAME.                    04560000
045700     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              04570000
045800     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               04580000
045900     DISPLAY '** SQLCODE   ** = ' SQLCODE.                        04590000
046000                                                                  04600000
046100******************************************************************04610000
046200* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     04620000
046300* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      04630000
046400******************************************************************04640000
046500     COPY DPPD004.                                                04650000
046600                                                                  04660000
046700     CALL 'ILBOABN0' USING ABEND-CODE.                            04670000
046800                                                                  04680000
046900                                                                  04690000
047000******************************************************************04700000
047100* PREFORMS TASK TERMINATION PROCESSING                            04710000
047200******************************************************************04720000
047300 9900-END-OF-JOB-ROUTINE.                                         04730000
047400                                                                  04740000
047500     CLOSE XST-FILE                                               04750000
047600           SKU-FILE.                                              04760000
047700                                                                  04770000
047800     PERFORM 9999-CONTROLS.                                       04780000
047900                                                                  04790000
048000                                                                  04800000
048100******************************************************************04810000
048200* DISPLAY CONTROLS FROM THE PROGRAM                               04820000
048300******************************************************************04830000
048400 9999-CONTROLS.                                                   04840000
048500                                                                  04850000
048600     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 04860000
048700                                                                  04870000
048800     MOVE SYS-TIME (1:2) TO ST-END-HR.                            04880000
048900     MOVE SYS-TIME (3:2) TO ST-END-MN.                            04890000
049000                                                                  04900000
049100     DISPLAY '                    '.                              04910000
049200     DISPLAY '**********************'.                            04920000
049300     DISPLAY '   EPKUT021 CONTROLS  '.                            04930004
049400     DISPLAY '**********************'.                            04940000
049500     DISPLAY 'RUN DATE  = ' SD-EDIT-DATE.                         04950000
049600     DISPLAY 'BEG TIME  = ' ST-BEG-TIME.                          04960000
049700     DISPLAY 'END TIME  = ' ST-END-TIME.                          04970000
049800     DISPLAY '======================'.                            04980000
049900     DISPLAY 'RECS FETCHED = ' PC-RECS-FETCHED.                   04990000
050000     DISPLAY '                  '.                                05000000
050100     DISPLAY 'XST WRITTEN  = ' PC-XST-WRITTEN.                    05010000
050200     DISPLAY 'SKU WRITTEN  = ' PC-SKU-WRITTEN.                    05020000
050300     DISPLAY '                  '.                                05030000
050400                                                                  05040000
050500                                                                  05050000
