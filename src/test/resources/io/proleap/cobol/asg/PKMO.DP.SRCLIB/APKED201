000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     APKED201.                                        00020000
000300 AUTHOR.         M WILKINSON.                                     00030000
000400*DATE-WRITTEN.   JUNE 1, 1994.                                    00040000
000500*DATE-COMPILED.                                                   00050000
000600                                                                  00060000
000700******************************************************************00070000
000800* COBOL II WITH SQL                                              *00080000
000900*----------------------------------------------------------------*00090000
001000* PRODUCTION EDI INVOICE EDIT PROGRAM                            *00100000
001100*----------------------------------------------------------------*00110000
001200* INPUT:                                                         *00120000
001300*  1. AP CONTROL TABLE                           (TAPCNTL)       *00130000
001400*  2. EXTERNAL ENTERPRISE TABLE                  (TEXTENT)       *00140000
001500*  3. EXTERNAL ENTERPRISE NAME TABLE             (TENTNME)       *00150000
001600*  4. INVOICE TABLE                              (TINVOIC)       *00160000
001700*  5. PAYMENT TERM TYPE TABLE                    (TPAYTRM)       *00170000
001800*  6. PURCHASE ORDER PLANNED SHIPMENT TABLE      (TPLNSHP)       *00180000
001900*  7. PURCHASE ORDER PURCHASE AGREEMENT TABLE    (TPOAGMT)       *00190000
002000*  8. PURCHASE ORDER TABLE                       (TPURCHS)       *00200000
002100*  9. PURCHASE ORDER ITEM TABLE                  (TPURITM)       *00210000
002200* 10. PEOPLESOFT LOCATION TABLE                  (XFT00017)      *00220000
002300* 11. PEOPLESOFT LOCATION ASSIGNMENT TABLE       (XFT00018)      *00230000
002400* 12. TRADING PARTNER TABLE                      (TTRDPRT)       *00240000
002500* 13. UPC/SKU TABLE                              (TUPCSKU)       *00250000
002600* 14. TRADING PARTNER TRANSACTION TABLE          (TTRDTRN)       *00260000
002700* 15. TABLE USED FOR EXISTENCE CHECKING          (SYSDUMMY1)     *00270000
002800* 16. RECYCLED EDI TRANSMISSION RECORDS          (APRD056)       *00280000
002900* 17. EDI TRANSMISSION RECORDS                   (APRD050)       *00290000
003000*                                                                 00300000
003100* OUTPUT:                                                        *00310000
003200*  1. VALID EDI TRANSMISSION RECORDS             (APRD052)       *00320000
003300*  2. REJECTED EDI TRANSMISSION RECORDS          (APRD051)       *00330000
003400*  3. RECYCLED EDI TRANSMISSION RECORDS          (APRD056)       *00340000
003500*----------------------------------------------------------------*00350000
003600* CHANGE LOG:                                                    *00360000
003700*                                                                *00370000
003800* 06/01/94    INITIAL VERSION.                                   *00380000
003900*                                                                *00390000
004000* DELETED CHANGE LOG FROM 1/95 THRU 12/98                        *00400000
004100*                                                                *00410000
004200* 01/13/99    ROBIN BERNOSKI                WR#                  *00420000
004300*             CHANGED THE LOGIC TO ACCOUNT FOR INVALID UPC       *00430000
004400*             CODES.  IF THERE IS AN INVALID UPC THE PO          *00440000
004500*             LINE NBR WILL BE FOUND USING OTHER ITEMS LIKE      *00450000
004600*             DEPT AND CLASS NUMBER.                             *00460000
004700*                                                                *00470000
004800* 03/05/99    ROBIN BERNOSKI                WR#                  *00480000
004900*             CHANGED THE LOGIC FOR DETERMINING THE PO LINE      *00490000
005000*             NUMBER SO THAT WHEN THE INVOICE HAS A VALID        *00500000
005100*             SKU THE PO LINE NUMBER CAN STILL BE DETERMINED     *00510000
005200*             BASED ON THE DEPARTMENT AND CLASS AND SKU.         *00520000
005300*                                                                *00530000
005400* 03/18/99    MIKE BESKE                    IR# 290524           *00540000
005500*             MODIFIED THE WHERE CONDITIONS IN PARAS E555-       *00550000
005600*             AND E576- INVOLVING THE INVOICE ID WITH A          *00560000
005700*             SUFFIX.  IT WILL USE THE FIRST 10 CHARS OF THE     *00570000
005800*             INVOICE ID SO THAT IT CAN MATCH THE ID AS IT       *00580000
005900*             IS KEPT ON TINVOIC WHEN A SUFFIX HAS BEEN          *00590000
006000*             ADDED.                                             *00600000
006100*                                                                *00610000
006200* 07/28/99    ROBIN BERNOSKI                WR# 5998             *00620000
006300*             REMOVED IMS READS.                                 *00630000
006400*                                                                *00640000
006500* 10/28/99    MIKE BESKE                    WR# 5998             *00650000
006600*             INCREASED THE SIZE OF THE INVOICE TABLE FROM       *00660000
006700*             2500 TO 4000.  NOTE THAT THE PROCEDURE AREA        *00670000
006800*             HAS TO BE SEARCHED FOR THE VARIABLE 'INV-INDX'     *00680000
006900*             YOU WILL FIND THAT THERE ARE AREAS THAT THIS       *00690000
007000*             VARIABLE IS COMPARED TOP 3998 OR 4000.  THIS       *00700000
007100*             IS DUE TO HOW THE PROGRAM WAS WRITTEN USING        *00710000
007200*             THE TABLE.                                         *00720000
007300*                                                                *00730000
007400* 11/04/99    ROBIN BERNOSKI               PIT#                  *00740000
007500*             INCREASED THE SIZE OF THE PO AND DUN INV TABLE     *00750000
007600*             FROM 30000 TO 60000.  ALSO INCREASED THE           *00760000
007700*             SIZE OF PC-COMBIN-TBL-MAX.                         *00770000
007800*                                                                *00780000
007900* 11/23/99    MARK BURNSIDE                PIT# 330172           *00790000
008000*             INCREASED THE SIZE OF THE INTERNAL INVOICE         *00800000
008100*             TABLE WITH INV-INDX INDEX TO 9000 FOR              *00810000
008200*             TEMPORARY PROCESSING.                              *00820000
008300*                                                                *00830000
008400* 11/30/99    MIKE BESKE                   PIT# 331480           *00840000
008500*             INCREASED THE SIZE OF THE INTERNAL INVOICE         *00850000
008600*             TABLE WITH INV-INDX INDEX TO 11000 FOR             *00860000
008700*             TEMPORARY PROCESSING.                              *00870000
008800*                                                                *00880000
008900*                                                                *00890000
009000* 12/08/1999 JILL JUEL                     WR/IR #: WR6041       *00900000
009100*            - MODIFIED THE CHECK ON THE DATE ROUTINE TO         *00910000
009200*              CONFORM WITH Y2K STANDARDS BY ADDING              *00920000
009300*              DPG54-WARNING-ERROR.                              *00930000
009400*                                                                *00940000
009500* 01/13/2000 ROBIN BERNOSKI                WR/IR #: WR20721      *00950000
009600*            - MODIFIED PARAGRAPHS E200 AND E300.  IN E200       *00960000
009700*              THE ORIGNINAL COMPUTE STATEMENT FOR THE           *00970000
009800*              WS-DETAIL-ALLW-AMT WAS REPLACED WITH THE          *00980000
009900*              ADD STATEMENT ACCUMULATING THE ALLOWANCE/         *00990000
010000*              CHARGE.  THIS COMPUTE STATEMENT WAS THEN          *01000000
010100*              PLACED IN E300 USING THESE NEW ACCUMULATING       *01010000
010200*              FIELDS AND THE GROSS COST CALCULATED FROM         *01020000
010300*              THE DETAIL LINES.                                 *01030000
010400*                                                                *01040000
010500* 02/01/2000 JILL JUEL                     WR/IR #: 20724        *01050000
010600*            - ADDED THE INTERCHG-CNTL-NBR TO THE REJECT         *01060000
010700*              FILE IN THE AP051-ADDITIONAL-AREA, SO THAT        *01070000
010800*              IT CAN BE DISPLAYED ON THE EDI REJECTION          *01080000
010900*              REPORT. ADDED THE WORKING STORAGE FIELD           *01090000
011000*              WS-SAVE-INTERCHG-CNTL-NBR.                        *01100000
011100*                                                                *01110000
011200* 02/02/2000 JILL JUEL                      WR#: 20626           *01120000
011300*            - RECOMPILED PROGRAM. CHANGES WERE MADE TO          *01130000
011400*              APRD050, APRD051, APRD052, AND APRD056 BY         *01140000
011500*              THE EDI TEAM.                                     *01150000
011600*                                                                *01160000
011700* 03/17/2000  MIKE BESKE                   PIT# 347179           *01170000
011800*            INCREASED THE SIZE OF THE PO AND DUN INV TABLES     *01180000
011900*            FROM 30000 TO 40000.  ALSO INCREASED THE            *01190000
012000*            SIZE OF PC-COMBIN-TBL-MAX.                          *01200000
012100*                                                                *01210000
012200* 03/27/2000 JILL JUEL                   WR#: 20704              *01220000
012300*            INITIALIZE THE DCLPURITM IN E200-EDIT-ONE, SO       *01230000
012400*            THE PURITM-PO-LINE WILL GET FILLED FOR EACH 07      *01240000
012500*            RECORD.                                             *01250000
012600*                                                                *01260000
012700* 07/11/2000 JILL JUEL                      WR#: 21067           *01270000
012800*            CHANGED THE LOGIC WHEN THE EDI INVOICE              *01280000
012900*            HAS MULTIPLE LINE ITEMS (SQL CODE = -811)           *01290000
013000*            IT WILL MATCH TO ONE PO LINE INSTEAD OF             *01300000
013100*            UNMATCHED LINES.                                    *01310000
013200*                                                                *01320000
013300* 07/11/2000 JILL JUEL                      WR#: 20903           *01330000
013400*            REMOVED THE INVALID SKU CHECK. REMOVED ALL          *01340000
013500*            THE COMMENTED OUT LINES AND CODE FOR FILES          *01350000
013600*            NOT BEING USED.                                     *01360000
013700*                                                                *01370000
013800* 07/18/2000 MIKE BESKE                     WR#: 20704           *01380000
013900*            CHANGED THE VARIABLE WS-DASH-INVOICE-NBR-10X TO     *01390000
014000*            BE WS-DASH-INVOICE-NBR-16X.  THE NEW FIELD IS       *01400000
014100*            USED TO CHECK TINVOIC FOR DUPLICATE INVOICE IDS     *01410000
014200*            AND IF A MATCH IS FOUND IT WILL BE REJECTED.        *01420000
014300*            SINCE PEOPLESOFT IS BEING USED EXCLUSIVELY FOR      *01430000
014400*            THE ADJUSTMENT JOURNAL AND IT HAS AN INVOICE ID     *01440000
014500*            SIZE OF 16 CHARACTERS, THE PROGRAM CAN NOW USE      *01450000
014600*            THE BIGGER INVOICE FOR CHECKING FOR DUPLICATES.     *01460000
014700*            MODIFIED PARAS E555- AND E576-.  THE SIZE OF        *01470000
014800*            OF WS-DASH-PO-INV-TEMP WAS INCREASED FROM 10 TO     *01480000
014900*            16 CHARACTERS.                                      *01490000
015000*                                                                *01500000
015100* 07/19/2000 MIKE BESKE                     WR#: 20704           *01510000
015200*            CORRECTED THE IF STMT INVOLVING RECORD TYPE=05      *01520000
015300*            WHERE THE ALLOWANCE/CHARGE TYPE IS BEING            *01530000
015400*            CHECKED FOR THE ONLY VALID VALUES OF A, C OR N.     *01540000
015500*            IF IT IS BLANK AND ALLW/CHRG INFORMATION IS         *01550000
015600*            BEING SENT, THEN THIS IS AN ERROR CONDITION.        *01560000
015700*            THE INVOICE SHOULD BE REJECTED AS A RESULT. THE     *01570000
015800*            WAY THE IF STMT WAS PRIOR TO THE CORRECTION, IT     *01580000
015900*            DID NOT HAVE ENOUGH MATCHING END-IF STMTS AND       *01590000
016000*            IT WAS NOT LOGICALLY WRITTEN EITHER.  THE ERROR     *01600000
016100*            CONDITION COULD NEVER BE TRIGGERED AS IT WAS        *01610000
016200*            WRITTEN. MODIFIED PARA E200-.                       *01620000
016300*                                                                *01630000
016400* 09/06/2000 NANCY EILBES                   WR#: 20704           *01640000
016500*            REMOVED EXTRANEOUS DATABASE CALLS INCLUDING         *01650000
016600*            ALL REFERENCES TO TPOINST AND TINSTCD.              *01660000
016700*            REMOVED EXTRA CALLS TO TPURCHS AND TEXTENT.         *01670000
016800*            THIS REQUIRED MOVING THE EDIT OF PO NUMBER          *01680000
016900*            AND RETRIEVAL OF ENT ID/NAME FROM E500 TO E200.     *01690000
017000*            REMOVED EXTRA TABLES FROM THE SQL RETRIEVING        *01700000
017100*            FREIGHT BILL INFO FROM THE TPLNSHP TABLE.           *01710000
017200*            REMOVED ALL LOGIC DEALING WITH CONSOLIDATED         *01720000
017300*            INVOICES, INCLUDING OUT04 FILE.                     *01730000
017400*            REMOVED ALL EDITS ON '03' RECORDS. NEITHER          *01740000
017500*            '03'S NOR CONSOLIDATED ARE COMING INTO THIS         *01750000
017600*            PROGRAM ANY LONGER.  ADDED THE SELECT OF THE        *01760000
017700*            NEW STORE INDICATOR TO THE R600 TPURCHS SELECT      *01770000
017800*            TO AVOID ANOTHER DATABASE READ LATER. REMOVED       *01780000
017900*            LOGIC EDITING THE TRADING PARTNER, BUT LEFT         *01790000
018000*            THE CURSOR AND THE PARAGRAPH PROCESSING IT IN       *01800000
018100*            THE PROGRAM FOR A FUTURE ENHANCEMENT. DID MISC      *01810000
018200*            'CLEAN-UP' INCLUDING REALIGNING AND ADDING          *01820000
018300*            'END-IF'S WHERE NEEDED.  REMOVED UNREFERENCED       *01830000
018400*            WORKING STORAGE FIELDS. ADDED COMMENTS. TOOK        *01840000
018500*            OUT SOME OF THE UNNEEDED RETRY LOGIC (LIKE ON       *01850000
018600*            THE TAPCNTL TABLE).                                 *01860000
018700*                                                                *01870000
018800* 09/13/2000 JILL JUEL                       WR# 20704           *01880000
018900*            ADDED LOGIC TO CLEAR VENDOR NUMBER AND NAME         *01890000
019000*            FIELDS WHEN THE PO IS INVALID SO THE INFO           *01900000
019100*            ISN'T CARRIER OVER FROM THE PREVIOUS RECORD.        *01910000
019200*            ALSO ADDED THE MOVE FOR THE INTERCHG-CNTL-NBR       *01920000
019300*            AFTER R150-READ-AP050 SINCE THE WS-WORK-AREA        *01930000
019400*            WAS RE-INITIALIZED AFTER THE COMBIN-FILE WAS        *01940000
019500*            PROCESSED.                                          *01950000
019600*                                                                *01960000
019700* 11/10/2000 JILL JUEL                       WR# 20224           *01970000
019800*            MADE CHANGES TO E300-, R900-, S100-, S200-,         *01980000
019900*            S700-, W100-, AND W300- ROUTINES FOR THE            *01990000
020000*            MARK OUT OF STOCK PROJECT.                          *02000000
020100*                                                                *02010000
020200* 11/23/2000 JILL JUEL                      PITS# 381260         *02020000
020300*            INCREASED THE SIZE OF THE PO INV TABLE, DUN         *02030000
020400*            INV TABLE, AND PC-COMBIN-TBL-MAX FROM 40000         *02040000
020500*            TO 60000.                                           *02050000
020600*                                                                *02060000
020700* 12/22/2000 MIKE BESKE                     PITS# 384699         *02070000
020800*            ADDED WHERE VER_STATUS_CDE = 'A' TO SECOND          *02080000
020900*            SQL IN S700-SELECT-TPAYTRM.                         *02090000
021000*                                                                *02100000
021100* 02/15/2001 NANCY EILBES                     WR# 20704          *02110000
021200*            MODIFIED THE PV-ACCUM-ALLW, PV-ACCUM-CHRG,          *02120000
021300*            PV-ACCUM-ALLW-PCT AND PV-ACCUM-CHRG-PCT FIELDS      *02130000
021400*            TO ADD/INCREASE THE NUMBER OF DIGITS AFTER THE      *02140000
021500*            DECIMAL POINT SO THAT PERCENTS LESS THAN 1          *02150000
021600*            (LIKE 1/2) WOULD NOT BE TRUNCATED OFF.  THIS        *02160000
021700*            CAUSED A NUMBER OF INVOICES TO REJECT BECAUSE       *02170000
021800*            THE .5% WAS LOST AND SO THE TOTAL COST THE          *02180000
021900*            PROGRAM CALCULATED DID NOT MATCH THE TOTAL          *02190000
022000*            COST SENT BY THE VENDOR.                            *02200000
022100*                                                                *02210000
022200*            ALSO INCREASED THE SIZE OF THE WS-REC-07-CNT        *02220000
022300*            FIELD FROM 9(3) TO 9(7).  AN INVOICE THAT HAD       *02230000
022400*            EXACTLY 2000 DETAIL LINES WAS REJECTED BECAUSE      *02240000
022500*            BASED ON THIS COUNTER, THE PROGRAM PROCESSED        *02250000
022600*            IT AS IF IT HAD ZERO DETAIL LINES.                  *02260000
022700*                                                                *02270000
022800* 04/25/2001 NANCY EILBES                     WR# 20704          *02280000
022900*            ADDED A NEW WORK FIELD AND MODIFIED AN EXISTING     *02290000
023000*            WORK FIELD THAT ARE USED FOR TOTALLING THE          *02300000
023100*            EXTENDED ITEM COSTS TO ALLOW 3 DIGITS AFTER         *02310000
023200*            DECIMAL POINT TO MINIMIZE ROUNDING ERRORS.          *02320000
023300*            ADDED LOGIC IN E300 TO PUT AN ADDITIONAL EDIT       *02330000
023400*            FOR CERTAIN 'HIGH-LIMIT' VENDORS TO NOT REJECT      *02340000
023500*            INVOICES WHERE THE CALCULATED TOTAL DOES NOT        *02350000
023600*            BALANCE TO THE TRANSMITTED TOTAL WHEN THE           *02360000
023700*            DIFFERENCE IS LESS THAN $5.00.  THIS WILL           *02370000
023800*            MINIMIZE REJECTIONS FOR VENDORS LIKE HALLMARK.      *02380000
023900*                                                                *02390000
024000* 05/23/2001 NANCY EILBES                     WR# 20704          *02400000
024100*  ADDED 4 PV-ACCUM FIELDS TO INITIALIZE STATEMENTS IN A100      *02410000
024200*  &  H100, RIGHT AFTER PARAGRAPH H150 IS PERFORMED.  THESE      *02420000
024300*  NOT BEING INITIALIZED WAS CAUSING THE FIRST INVOICE ON TH     *02430000
024400*  AP050 FILE TO REJECT WITH AN OUT OF BALANCE CONDITION IF      *02440000
024500*  LAST RECORD ON THE AP056 FILE HAD ALLOWANCES OR CHARGES.      *02450000
024600*                                                                *02460000
024700* 06/28/2001 NANCY EILBES                     WR# 20704          *02470000
024800*  ADDED LOGIC IN PARAGRAPH W100-WRITE-EDI TO POPULATE THE       *02480000
024900*  NEW FIELD ON APRD052 WHEN AN 05 SEGMENT IS BEING CREATED      *02490000
025000*  FOR ALLOWANCES FOUND ON THE PO BUT NOT SENT ALONG ON THE      *02500000
025100*  INVOICE.  THIS CODE WILL BE USED IN COMBO EDIT PROGRAM        *02510000
025200*  TO REMOVE THESE ADDED RECORDS IF AN INVOICE IS GOING TO       *02520000
025300*  THE COMBO RECYCLE FILE.                                       *02530000
025400*                                                                *02540000
025500* 07/24/2001 KEVIN CATLIN                     WR# N/A            *02550000
025600*            ADDED ADDITIONAL 'HIGH LIMIT' VENDOR TO WS.         *02560000
025700*                                                                *02570000
025800* 09/07/2001 ALEXIS KEIKER                    WR# 20530          *02580000
025900*  MODIFIED THE PO_BULK_STORE_CSR TO EXCLUDE INVOICE TYPE        *02590000
026000*  OF 'EI' (EXPENSE INVOICE). EXPENSE INVOICES NEVER SHOULD      *02600000
026100*  BE INCLUDED IN THIS CURSOR.                                   *02610000
026200*                                                                *02620000
026300* 12/01/2001 NANCY EILBES                   PITS# 435344         *02630000
026400*  INCREASED THE OCCURENCES OF THE PO-INV TABLE AND THE          *02640000
026500*  DUN-INV TABLE FROM 60000 TO 75000 AND INCREASED THE           *02650000
026600*  LIMIT IN PC-COMBIN-TBL-MAX.                                   *02660000
026700*                                                                *02670000
026800* 05/08/2002 NANCY EILBES                     WR# 23691          *02680000
026900*  ADDED COLBY AS A HIGH-LIMIT VENDOR AND CHANGED THE EDIT       *02690000
027000*  FOR ITEM ID TO EXCLUDE SKU NUMBER.                            *02700000
027100*                                                                *02710000
027200* 06/16/2002                                                     *02720000
027300*    ARK PO PROJECT PHASE 1.  RECOMPILE FROM PRODUCTION.         *02730000
027400* MADE BY: KEVIN CATLIN                       WR# 23500          *02740000
027500*                                                                *02750000
027600* 06/18/2002                                                     *02760000
027700*    REMOVED TABLE TPAYREQ.                                      *02770000
027800* MADE BY: NANCY EILBES                       WR# 23500          *02780000
027900*                                                                *02790000
028000* 08/08/2002                                                     *02800000
028100*    COLBY HANGER EXPENSE PROCESSING.  MODIFIED PROGRAM TO       *02810000
028200*    PASS THE DISCOUNTED INVOICE AMOUNT ON GOOD INVOICES         *02820000
028300*    THAT ARE WRITTEN.  ALSO MODIFY HANDLING OF ALLOWANCE        *02830000
028400*    CHARGE SEGMENT BY PUTTING 'HGR' IN THE CHARGE CODE FOR      *02840000
028500*    HANGER CHARGES.  PARAGRAPHS MODIFIED ARE E200 AND W100.     *02850000
028600* MADE BY: KEVIN CATLIN                       WR# 23254          *02860000
028700*                                                                *02870000
028800* 08/08/2002                                                     *02880000
028900*    VALIDATE 810 TRANSMISSION COLBY INVOICES.  PARAGRAPH        *02890000
029000*    E200 MODIFIED TO CHECK IF THE PO NBR IS A COLBY PO.  IF     *02900000
029100*    IT IS, WHEN GETTING THE ENT-ID, COMPARE THE ENT-ID          *02910000
029200*    RETURNED FROM THE TRADING PARTNER WITH THE PURCHS-ENT-ID.   *02920000
029300*    IF THEY ARE NOT THE SAME, REJECT THE INVOICE.               *02930000
029400* MADE BY: KEVIN CATLIN                       WR# 23780          *02940000
029500*                                                                *02950000
029600* 09/26/2002                                                     *02960000
029700*    TO AVOID AP052-QUANTITY-INVOICED FROM NOT BEING A WHOLE     *02970000
029800*    NUMBER, IT WILL BE MOVED TO PV-QUANTITY-INVOICED (WHICH     *02980000
029900*    IS A WHOLE NUMBER FIELD) IN CALCULATING THE DIFFERENCE      *02990000
030000*    BETWEEN GROSS-INVOICE-AMT AND DETAIL-GROSS-INVOICE-AMT.     *03000000
030100*    THIS WILL CAUSE INVOICES SENT WITH NON-WHOLE NUMBERS IN     *03010000
030200*    THIS FIELD TO REJECT WITH ERROR CODE 36.                    *03020000
030300* MADE BY: KEVIN CATLIN                WR/IR #: P000496641       *03030000
030400*                                                                *03040000
030500* 10/16/2002                                                     *03050000
030600*    COLBY HANGER PROCESSING CHANGE.  REMOVED CODE IN PARA       *03060000
030700*    E200 SO IT WOULDN'T PROCESS HANGER CHARGES TWICE.           *03070000
030800* MADE BY: KEVIN CATLIN                WR/IR #: WR23750          *03080000
030900*                                                                *03090000
031000* 10/29/2002                                                     *03100000
031100*    CORRECTED LOGIC IN 3 PARAGRAPHS THAT ATTEMPT TO ASSIGN      *03110000
031200*    A PO LINE TO EACH INVOICE LINE.  THESE PARAGRAPHS ALL       *03120000
031300*    HAD LOGIC WHICH WOULD MOVE ZERO TO THE PO LINE IF A -811    *03130000
031400*    SQL CODE WAS FOUND.  THIS WAS MODIFIED TO LEAVE THE         *03140000
031500*    VALUE THAT WAS RETURNED IN THE PO LINE FIELD SO THAT THE    *03150000
031600*    LINE WOULD NOT BE LEFT AS UNMATCHED.                        *03160000
031700* MADE BY: NANCY EILBES                WR/IR #: WR22902          *03170000
031800*                                                                *03180000
031900* DATE  05/13/2003                                               *03190000
032000*     CHANGE MADE: NI-SKU PROJECT.                               *03200000
032100*     REMOVED THE FOLLOWING PARAGRAPHS:  R475- R500- R750-.      *03210000
032200*     MODIFIED CODE INVOLVING SKU: REMOVED SKU BREAKDOWN OF      *03220000
032300*     DEPT/CLASS/SEQ, REMOVED  VALIDATION CHECKS FROM E200-      *03230000
032400*     INVOLVING VALID SKU & FILLING INFO FOR MISSING SKU RELAT   *03240000
032500*     DATA FROM VENDOR DATA XMITTED VIA EDI, ONLY KEPT THE SEL   *03250000
032600*     ECTION OF PO LINE NBR IN PARAGRAPHS R450- & R485-.         *03260000
032700*     REMOVED TSK & TMDSEAR TABLES.  ADDED DEPT TO SELECT IN     *03270000
032800*     R600-. REPLACED THE THE SQL WITH STANDARD EXISTENCE        *03280000
032900*     CHECKING SQL IN PARAS E550- E555- E575- E576-.             *03290000
033000*     MADE BY: MIKE BESKE              WR/IR #: WR22557          *03300000
033100*                                                                *03310000
033200* DATE  08/02/2003                                               *03320000
033300*            INCREASED THE SIZE OF THE PO INV TABLE, DUN         *03330000
033400*            INV TABLE, AND PC-COMBIN-TBL-MAX FROM 75000         *03340000
033500*            TO 100,000.                                         *03350000
033600*     MADE BY: L SCHALLHORN            WR/IR #: WR24480          *03360000
033700*                                                                *03370000
033800* DATE  08/03/2003                                               *03380000
033900*     CHANGE MADE: COMPOUND PREPACK EDI PROJECT                  *03390000
034000*     ADDED CODE TO PROCESS COMPOUND PREPACK EDI RECORDS. THIS   *03400000
034100*     INCLUDES CREATING PARA E600-.  THIS PARAGRAPH CHECKS FOR   *03410000
034200*     ANY WARNING INDICATORS THAT WERE SET ON THE 07 REC WITH    *03420000
034300*     'AS' AS A UNIT MEASURE VALUE.  WHEN ANY OF THEM ARE SET    *03430000
034400*     THESE ARE TO BE WRITTEN TO THE ERROR REPORT FILE.  IF      *03440000
034500*     THESE WARNINGS ARE THE ONLY ERRORS FOR THE INVOICE BEING   *03450000
034600*     PROCESSED THEN THE INVOICES WILL BE WRITTEN TO THE AP052   *03460000
034700*     OUTPUT FILE.  THIS MEANS THAT THES COMPOUND PREPACK IN-    *03470000
034800*     VOICES WILL BE INSERTED ON THE INVOICE DATABASE.  MODI-    *03480000
034900*     FIED CODE THAT USES THE UPC OR VENDOR STYLE TO FIND THE    *03490000
035000*     PO LINE NUMBER ON TPURITM TO NOT PROCESS THE 07 'AS'       *03500000
035100*     THE UPC FOR THE COMPOUND PREPACK HEADER IS NOT FOUND       *03510000
035200*     ON THE TPURITM TABLE.  AS A RESULT IT IS NOT VALID TO      *03520000
035300*     PROCESS IT LIKE AN ITEM UPC.  THERE WERE 2 NEW IT1-UNIT-   *03530000
035400*     MEASURE VALUES OF 'AS' AND 'PI' CREATED.  'AS' IS SENT     *03540000
035500*     VIA EDI AND IS THE COMPOUND PREPACK HEADER RECORD.  'PI'   *03550000
035600*     IS THE PACK ITEM (DETAIL) RECORD THAT IS CREATED IN        *03560000
035700*     APKUT067.  'PI' RECS ARE WRITTEN TO THE AP052 OUTPUT       *03570000
035800*     FILE AND THE 'AS' RECORDS ARE NOT, EXCEPT FOR ONE CIR-     *03580000
035900*     CUMSTANCE. IF THE UPC-CANT-EXPLODE INDICATOR IS SET,       *03590000
036000*     THEN THE 'AS' RECORD WILL BE WRITTEN TO THE AP052 OUTPUT   *03600000
036100*     FILE AS THE ONLY DETAIL RECORD FOR THAT INVOICE PACK UPC   *03610000
036200*     IT'LL BE HANDLED LIKE A DETAIL WHERE NO MATCHING PO LINE   *03620000
036300*     NUMBER COULD BE FOUND.                                     *03630000
036400*     MADE BY: MIKE BESKE              WR/IR #: WR24685          *03640000
036500*                                                                *03650000
036600* DATE  08/19/2003                                               *03660000
036700*     CHANGE MADE: ADDED CODE TO PROCESS COLBY PREPACKS WITH     *03670000
036800*     HANGER CHARGES CORRECTLY.  THE HANGER CHARGE IS ALREADY    *03680000
036900*     IMBEDDED AS PART OF CALCULATED DETAIL AMOUNT.  THE NEW     *03690000
037000*     CODE WILL SAVE OFF THE HANGER CHARGE FOR ANY COLBY PRE-    *03700000
037100*     PACKS THAT ARE BEING PROCESSED.  IN PARA E300-EDIT-ALL,    *03710000
037200*     THE SAVED COLBY HANGER CHARGE WILL BE SUBTRACTED OUT OF    *03720000
037300*     THE TOTAL DETAIL CHARGE AMOUNT BEFORE IT IS USED TO        *03730000
037400*     COMPUTE THE CALCULATED DETAIL AMOUNT WHICH WILL THEN BE    *03740000
037500*     COMPARED TO THE SENT GROSS INVOICE AMOUNT IN THE 06 REC    *03750000
037600*     TYPE.                                                      *03760000
037700*     MADE BY: MIKE BESKE              WR/IR #: WR24481          *03770000
037800*                                                                *03780000
037900* DATE  09/11/2003                                               *03790000
038000*     CHANGE MADE: ADDED CODE TO PROCESS COLBY PREPACKS WITH     *03800000
038100*     HANGER CHARGES CORRECTLY IN W100-WRITE-EDI.  THIS WILL     *03810000
038200*     ALLOW THE GRO_COST_AMT ON TINVOIC TO BE LOADED WITHOUT     *03820000
038300*     THE HANGER CHARGES AND NOT CAUSE PROBLEMS WHEN THE         *03830000
038400*     COMMISSION IS CALCULATED.  IT WILL ALSO NOT CAUSE PROB-    *03840000
038500*     LEMS WHEN THE PO IS JOURNALIZED.                           *03850000
038600*     MADE BY: MIKE BESKE              WR/IR #: PM00584949       *03860000
038700*                                                                *03870000
038800* DATE  09/13/2003                                               *03880000
038900*     CHANGE MADE: MODIFIED CODE THAT WAS ADDING A LEADING       *03890000
039000*     ZERO TO THE 12-DIGIT UPC CODES AND SAVING IT IN THE        *03900000
039100*     AP052 FIELD TO MAKE THIS CHANGE TO A WORK FIELD RIGHT      *03910000
039200*     BEFORE THE DATABASE LOOKUP.  UPDATING THE FIELD WAS        *03920000
039300*     CAUSING RECORDS WRITTEN TO THE RECYCLE FILE TO HAVE THE    *03930000
039400*     UPC ALREADY SHIFTED, AND WHEN THE RECYCLE CAME BACK        *03940000
039500*     INTO THIS PROGRAM, IT WOULD GET SHIFTED OVER ANOTHER       *03950000
039600*     POSITION.  AS A RESULT, RECYCLES WERE ALWAYS ENDING UP     *03960000
039700*     WITH UNMATCHED LINES IF UPC WAS THE ONLY ITEM IDENTIFER    *03970000
039800*     THAT THE VENDOR SENT.                                      *03980000
039900*     MADE BY: NANCY EILBES            WR/IR #: PM00586320       *03990000
040000*                                                                *04000000
040100* DATE  09/18/2003                                               *04010000
040200*     CHANGE MADE: E300-EDIT-ALL - ADDED LOGIC AT THE VERY       *04020000
040300*     BEGINNING OF THE PARAGRAPH TO CHECK IF THE VENDOR IS       *04030000
040400*     COLBY AND WE HAD TO EXPLODE A PREPACK.  WHEN THIS IS       *04040000
040500*     TRUE, THE WS-COLBY-HANGER-AMT NEEDS TO BE DEDUCTED FROM    *04050000
040600*     WS-DETAIL-GROSS-INVOICE-AMT BECAUSE ANY HANGER AMOUNTS     *04060000
040700*     WOULD HAVE BEEN EMBEDDED IN THE UNIT COSTS THAT WERE       *04070000
040800*     RETRIEVED FROM THE PO WHEN THE PACK WAS EXPLODED. TOOK     *04080000
040900*     OUT THE LOGIC LATER IN THE PARAGRAPH THAT WAS ADJUSTING    *04090000
041000*     THE WS-DETAIL-CHRG-AMT TO REMOVE THE HANGER AMOUNT AND     *04100000
041100*     THE LOGIC IN W100-WRITE-EDI THAT WAS ADJUSTING THE         *04110000
041200*     GROSS AMOUNT.  BY BACKING THE HANGER AMOUNT OUT OF THE     *04120000
041300*     WS-DETAIL-GROSS-INVOICE-AMT EARLY IN THE EDIT-ALL          *04130000
041400*     PROCESS, BEFORE ANY OTHER LOGIC MADE USE OF THIS FIELD,    *04140000
041500*     ALL OTHER HANDLING OF THIS FIELD BECAME UNNECESSARY.       *04150000
041600*     MADE BY: NANCY EILBES            WR/IR #: P000587414       *04160000
041700*                                                                *04170000
041800* DATE  10/03/2003                                               *04180000
041900*     CHANGE MADE: COMMENTED OUT CODE REFERRING TO THE 88        *04190000
042000*     LEVELS OF WS-PI-WARNING3-WS. THIS VARIABLE IS ASSOCIATED   *04200000
042100*     WITH THE ERROR IND AP05#-UPC-CANT-EXPLODE-IND.             *04210000
042200*     WHEN THE VALUE ERROR IND = Y, THEN THE ENTIRE INVOICE      *04220000
042300*     WILL BE REJECTED.  THIS WILL STOP AN INVOICE FROM BEING    *04230000
042400*     LOADED TO THE AP INVOICE DATABASE WITH NO DETAIL.  WITH    *04240000
042500*     THIS CHANGE, THE ORIGINAL 07 'AS' RECORD WILL NEVER MAKE   *04250000
042600*     IT TO THE OUTPUT FILE THAT GETS LOADED TO THE INVOICE      *04260000
042700*     DATABASE OR TO THE RECYCLE FILE.                           *04270000
042800*     MADE BY: MIKE BESKE              WR/IR #: WR25850          *04280000
042900*                                                                *04290000
043000* DATE  10/22/2003                                               *04300000
043100*     CHANGE MADE: IN THE EDIT TO CHECK FOR VALID STORE ON       *04310000
043200*     RECORD TYPE '02' (PARAGRAPH E200), THE INITIALIZATION      *04320000
043300*     OF WORKING STORAGE FIELDS WAS CORRECTED AND THE LOGIC      *04330000
043400*     WAS CORRECTED.  CLEANED UP THE SQL STATEMENTS FOR          *04340000
043500*     RETRIEVING VALID STORES IN PARAGRAPHS R300 AND R350.       *04350000
043600*     MADE BY: KEVIN CATLIN            WR/IR #: PM00600647       *04360000
043700*                                                                *04370000
043800* DATE  01/23/2004                                               *04380000
043900*     CHANGE MADE: IN W100-WRITE-EDI, ADDED LOGIC TO BYPASS      *04390000
044000*     PROCESSING THE INCOMING ALLOWANCES FROM VENDOR NINE        *04400000
044100*     WEST SO THAT ONLY THE PO ALLOWANCES WILL BE LOADED.        *04410000
044200*     NINE WEST IS SENDING MOS AND ADV ROLLED TOGETHER IN ONE    *04420000
044300*     MOS ENTRY, AND THE LOGIC IN THIS PROGRAM IS TAKING THE     *04430000
044400*     ADV DEDUCTION AS WELL.                                     *04440000
044500*     MADE BY: NANCY EILBES            WR/IR #: P00627056        *04450000
044600*                                                                *04460000
044700* DATE  03/31/2004                                               *04470000
044800*     CHANGE MADE: REMOVED TSTR000 AND REPLACED WITH THE         *04480000
044900*     XFT00003 LOCATION TABLE.  INCREASED THE SIZE OF            *04490000
045000*     VARIOUS W/S STORE FIELDS FROM 3 TO 5 BYTES.  RECODED       *04500000
045100*     PARAS R300- AND R350- TO USE XFT00003.                     *04510000
045200*     MADE BY: MIKE BESKE              WR/IR #: WR25805          *04520000
045300*                                                                *04530000
045400* DATE  07/16/2004                                               *04540000
045500*     CHANGE MADE: IN W170-CHK-NONDEFERRED-DSCRPNCYS, MODIFIED   *04550000
045600*     THE LOGIC THAT DECIDES WHAT GOES IN WS-TERMS-DISC-DAYS-DUE *04560000
045700*     SO THAT THIS LOGIC WILL BE PERFORMED REGARDLESS OF THE     *04570000
045800*     VALUE IN AP052-DISC-PCT.  THIS LOGIC WAS ONLY BEING DONE   *04580000
045900*     WHEN THE INCOMING DISCOUNT PERCENT WAS > 0, BUT IF THE     *04590000
046000*     VENDOR SENT A DISCOUNT DAYS WITH NO DISCOUNT PERCENT, IT   *04600000
046100*     WAS CAUSING THE LOGIC TO FALL THROUGH SO THAT NOTHING WAS  *04610000
046200*     GETTING LOADED IN THE DISCOUNT DAYS EVEN IF THERE WERE     *04620000
046300*     DISCOUNT DAYS ON THE PO.                                   *04630000
046400*     MADE BY: NANCY EILBES            WR/IR #: P000672761       *04640000
046500*                                                                *04650000
046600*                                                                *04660000
046700* DATE  08/02/2004                                               *04670000
046800*     CHANGE MADE: INCREASED THE SIZE OF THE PO INV TABLE, DUN   *04680000
046900*     INV TABLE, AND PC-COMBIN-TBL-MAX FROM 100,000 TO 125,000.  *04690000
047000*     MADE BY: NANCY EILBES            WR/IR #: P000677102       *04700000
047100*                                                                *04710000
047200* DATE  08/23/2004                                               *04720000
047300* CHANGE MADE: REPLACED RECURSIVE READS OF THE LOCATION DATABASE *04730000
047400* WITH AN INTERNAL ARRAY WHICH IS LOADED FROM A CURSOR IN THE    *04740000
047500* PROGRAM INITIALIZATION.  THIS WILL SPEED THE VALIDATION OF     *04750000
047600* STORE NUMBERS AND ELIMINATE THE PROBLEM OF THE THREAD TO DB3P  *04760000
047700* BEING DROPPED WHEN THE SYSTEM IS SLOW.                         *04770000
047800* CORRECTED DUPLICATE CHECKING LOGIC.  ADDED NEW LOGIC FOR A     *04780000
047900* SMALL GROUP OF VENDORS TO ALWAYS ADD A SUFFIX TO THEIR INVOICE *04790000
048000* NUMBERS BEFORE THEY ARE LOADED.  THE DUPLICATE CHECKING WILL   *04800000
048100* WORK WITH THE INVOICE NUMBER WITH AND WITHOUT THE SUFFIX, BUT  *04810000
048200* FOR THESE VENDORS, THE INVOICE WILL BE LOADED WITH THE SUFFIX  *04820000
048300* EVEN IF IT IS FOUND TO NOT BE A DUPLICATE WITHOUT THE SUFFIX.  *04830000
048400* THIS CORRECTS A PROBLEM WHERE INVOICES WERE FALLING OUT AS     *04840000
048500* DUPLICATES FROM THE PEOPLESOFT INTERFACE BECAUSE THEY DID NOT  *04850000
048600* GET SUFFIXES DUE TO THE FACT THAT THE BASE INVOICE ID HAD BEEN *04860000
048700* ARCHIVED FROM LEGACY, BUT NOT FROM PEOPLESOFT.                 *04870000
048800* MADE BY: NANCY EILBES            WR/IR #: P000684884           *04880000
048900*                                                                *04890000
049000* DATE  08/25/2004                                               *04900000
049100*     CHANGE MADE: ADDED COMMIT STMT AFTER THE X300-CLOSE-       *04910000
049200*     LOCATION-CSR.  THIS WILL CLOSE THE DB3P THREAD W/O CAUSING *04920000
049300*     AN ABEND WHEN THE PROGRAM TRYS TO END NORMALLY.            *04930000
049400*     MADE BY: MIKE BESKE              WR/IR #: P000685408       *04940000
049500*                                                                *04950000
049600* DATE  09/15/2004                                               *04960000
049700*     CHANGE MADE: CORRECTED STORE VALIDATION IN PARAGRAPH E300. *04970000
049800*     IF FIRST STORE IS INVALID OR A VALID DC, THE VARIABLE      *04980000
049900*     WS-SAVE-STORE-NBR2 WAS NOT BEING POPULATED FOR THE STORE 2 *04990000
050000*     CHECK.  THIS CAUSED STORE 2 NOT TO BE FOUND.  STORE 00000  *05000000
050100*     WAS THEN DEFAULTED, CAUSING THESE INVOICES TO BE SWITCHED  *05010000
050200*     TO BULK.                                                   *05020000
050300*     MADE BY: KEVIN CATLIN            WR/IR #: P000692610       *05030000
050400*                                                                *05040000
050500* DATE  09/22/2004                                               *05050000
050600*     CHANGE MADE: ADDED NOTATIONS VENDOR TO THE LIST OF VENDORS *05060000
050700*     WHERE THE INVOICE ID WILL HAVE A SUFFIX ADDED.  NOTATIONS  *05070000
050800*     IS VENDOR ID 099081168.                                    *05080000
050900*     THE LIST OF VENDORS THAT HAVE THE SUFFIX ADDED IS NOW FOUR.*05090000
051000*     MADE BY: MARK BURNSIDE           WR/IR #: P000684884       *05100000
051100*                                                                *05110000
051200* DATE  10/02/2004                                               *05120000
051300*     CHANGE MADE: INCRESED INV-INDX LIMIT TO 25000.             *05130000
051400*     MADE BY: L SCHALLHORN            WR/IR #: P000698075       *05140000
051500*                                                                *05150000
051600* DATE  10/05/2004                                               *05160000
051700*     CHANGE MADE: REPLACED COMMIT SQL WITH X500-COMMIT PARAGRAPH*05170000
051800*     MADE BY: MIKE BESKE              WR/IR #: P000690867       *05180000
051900*                                                                *05190000
052000* DATE  10/26/2004                                               *05200000
052100*     CHANGE MADE: ADDED LOGIC TO INITIALIZE THE WORK FIELD      *05210000
052200*     WS-INVOICE-WITH-SUFFIX SO THAT THERE ARE NO LEFTOVER       *05220000
052300*     CHARACTERS IF A SHORTER INVOICE ID IS PROCESSED AFTER A    *05230000
052400*     LONGER INVOICE ID.  THIS CAUSED AN ISSUE FOR VANITY FAIR.  *05240000
052500*     MADE BY: NANCY EILBES            WR/IR #: P000684884       *05250000
052600*                                                                *05260000
052700* DATE  11/26/2004                                               *05270000
052800*     CHANGE MADE: MODIFIED W170-CHK-NONDEFERRED-DSCRPNCY TO     *05280000
052900*     HANDLE SITUATIONS WHERE THE INVOICE COMES IN WITH THE DAYS *05290000
053000*     NOT BEING FOUND IN THE EXPECTED FIELD, BASED ON WHETHER OR *05300000
053100*     NOT A DISCOUNT PERCENT WAS SENT.  CHANGES ENSURE THAT THE  *05310000
053200*     'DAYS' WILL END UP IN THE CORRECT FIELD TO BE LOADED INTO  *05320000
053300*     THE DATABASE, REGARDLESS OF THE SOURCE OF THE DAYS.        *05330000
053400*     ALSO ADDED AN 'ALWAYS USE SUFFIX' VENDOR - BALI INTIMATES. *05340000
053500*     MADE BY: NANCY EILBES            WR/IR #: P000684884       *05350000
053600*                                                                *05360000
053700* DATE  01/21/2005                                               *05370000
053800*     CHANGE MADE: MODIFIED STORE VALIDATION SO THAT 'DE' IS A   *05380000
053900*     VALID STORE TYPE - PARAGRAPHS R300 AND R350 AND LOCATION   *05390000
054000*     CURSOR.                                                    *05400000
054100*     MADE BY: NANCY EILBES            WR/IR #: WR28188          *05410000
054200*                                                                *05420000
054300* DATE  03/28/2005                                               *05430000
054400*     CHANGE MADE: ADDED LEE CO/WRANGLER TO THE LIST OF VENDORS  *05440000
054500*     WHERE THE INVOICE ID WILL HAVE A SUFFIX ADDED.  LEE CO/    *05450000
054600*     WRANGLER IS VENDOR ID 007131501.                           *05460000
054700*     MADE BY: MARK BURNSIDE           WR/IR #: P000684884       *05470000
054800*                                                                *05480000
054900* DATE  04/07/2005                                               *05490000
055000*     CHANGE MADE: ADDED MAIDENFORM INC TO THE LIST OF VENDORS   *05500000
055100*     WHERE THE INVOICE ID WILL HAVE A SUFFIX ADDED.  THE VENDOR *05510000
055200*     NUMBER IS 001467893.                                       *05520000
055300*     MADE BY: MIKE BESKE              WR/IR #: P000752710       *05530000
055400*                                                                *05540000
055500* DATE  05/03/2005                                               *05550000
055600*     CHANGE MADE: INCLUDED ALL NY JONES APPAREL DIVISION        *05560000
055700*     PURCHASE ORDER NUMBERS (WS-VENDOR-IS-NY-JONES) IN LOGIC    *05570000
055800*     THAT DETERMINES DISCOUNTS FROM JUST THE PO AND NOT FROM    *05580000
055900*     BOTH THE PO/INVOICE.                                       *05590000
056000*     MADE BY: KRYSTEN LEARY           WR/IR #: WR28651          *05600000
056100*                                                                *05610000
056200* DATE  06/24/2005                                               *05620000
056300*     CHANGE MADE: ADDED CAPELLI OF NEW YORK TO THE LIST OF      *05630000
056400*     VENDORS WHERE THE INVOICE ID WILL HAVE A SUFFIX.  CAPELLI  *05640000
056500*     OF NEW YORK IS VENDOR ID 557461522.                        *05650000
056600*     MADE BY: KRYSTEN LEARY           WR/IR #: P000684884       *05660000
056700*                                                                *05670000
056800* DATE  06/27/2005                                               *05680000
056900*     CHANGE MADE: INSTALLING ARCHIVED VERSION OF PROGRAM        *05690000
057000*     (G0095V00) BACK INTO PRODUCTION SINCE THE INCORRECT        *05700000
057100*     VERSION OF THE PROGRAM WAS PREVIOUSLY INSTALLED.           *05710000
057200*     MADE BY: KRYSTEN LEARY           WR/IR #: WR28461          *05720000
057300*                                                                *05730000
057400* DATE  06/30/2005                                               *05740000
057500*     CHANGE MADE: E-COMM DIRECT TO CONSUMER PROJECT             *05750000
057600*     ADDED WORKING STORAGE FIELDS FOR WS-CD-HANDLING-AMT AND    *05760000
057700*     WS-MAX-CD-HANDLING-AMT TO ACCEPT CONSUMER DIRECT CHARGES.  *05770000
057800*     EDITED PARAGRAPH E200-, IN THE SECTION PROCESSING RECORD   *05780000
057900*     TYPE '05' TO VALIDATE CHARGE CODES, TO CHECK FOR THE       *05790000
058000*     CHARGE TYPE AND PO TYPE.  THE PO TYPE MUST BE 'CD' FOR THE *05800000
058100*     GIFT WRAP ('CDG') AND HANDLING ('CDH') CHARGES OR THE      *05810000
058200*     INVOICE WILL BE REJECTED.  THE LOGIC FOR PROCESSING ALL    *05820000
058300*     OTHER VALID CHARGE CODES WAS NOT ALTERED.  ALSO EDITED     *05830000
058400*     PARAGRAPH E300- TO VERIFY THAT THE HANDLING CHARGES FOR    *05840000
058500*     THE INVOICE DO NOT EXCEED THE MAXIMUM LIMIT ALLOWED. THOSE *05850000
058600*     INVOICES WHERE THE HANDLING CHARGES DO EXCEED THE MAXIMUM  *05860000
058700*     LIMIT WILL BE PUT ON HOLD.  ADDED THE FIELD PO_TYP_CDE TO  *05870000
058800*     THE SELECT OF THE TPURCHS TABLE AND THE FIELDS             *05880000
058900*     CD_CHRG_LMT_AMT AND CD_CHRG_LMT_PCT TO THE SELECT OF THE   *05890000
059000*     TAPCNTL TABLE.  INCLUDED 'CDH' AND 'CHG' AS VALID CHARGE   *05900000
059100*     CODE VALUES IN COPYBOOKS APRD050, APRD051, APRD052, AND    *05910000
059200*     APRD056.                                                   *05920000
059300*     MADE BY: KRYSTEN LEARY           WR/IR #: WR28461          *05930000
059400*                                                                *05940000
059500* DATE  07/30/2005                                               *05950000
059600*     CHANGE MADE: ADDED 10 TO THE LIST OF TYP_CDE VALUES.       *05960000
059700*     ADDED LOGIC UNDER PARAGRAPH IN THE EVALUATE POAGMT-TYP-CDE *05970000
059800*     TO MOVE 'COP' TO THE TBL-ALLOCANCE-CDE WHEN THE VALUE IS 10*05980000
059900*     ADDED LOGIC UNDER PARAGRAPH S200- TO ENSURE THAT THE CODE  *05990000
060000*     'COP' WILL BE HANDLED JUST LIKE ONES WITH 'MOS'.           *06000000
060100*     INCLUDED 'COP' IN THE VALID ALLOWANCE CODES IN COPYBOOKS   *06010000
060200*     APRD050, APRD051, APRD052, AND APRD056.                    *06020000
060300*     ADDED GLORIA VENDERBUILT FOOTWEAR (VENDOR NUMBER 001003193 *06030000
060400*     TO THE JONES 88 LEVEL FOR PROCESS.                         *06040000
060500*     MADE BY: RACHEL GILBERTSON       WR/IR #: WR25651          *06050000
060600*                                                                *06060000
060700* DATE  09/09/2005                                               *06070000
060800*     CHANGE MADE: CORRECTED LOGIC IN THE HANDLING OF EAN VS UPC.*06080000
060900*     ADDED LOGIC TO MAKE SURE THAT A LEADING ZERO IS NOT ADDED  *06090000
061000*     TO THE WORKING STORAGE FIELD IF WE ARE PROCESSING AN EAN.  *06100000
061100*     MADE BY: L SCHALLHORN            WR/IR #: P000799531       *06110000
061200*                                                                *06120000
061300* DATE  12/16/2005                                               *06130000
061400*     CHANGE MADE: CORRECTED THE LOGIC IN PARA W100- THAT HANDLES*06140000
061500*     THE 05 RECORD TYPE.  THE ALLOW-INDX CAN OCCUR 10 TIMES BUT *06150000
061600*     THE PERFORM LOOP DID NOT CHECK FOR THE ALLOW-INDX > 10.    *06160000
061700*     THIS CHECK WAS ADDED TO THE PERFORM LOOP.                  *06170000
061800*     MADE BY: MIKE BESKE              WR/IR #: P000832118       *06180000
061900*                                                                *06190000
062000* DATE  04/11/2006                                               *06200000
062100*     CHANGE MADE: ADDED VENDOR MANUAL WOODWORKERS & WVRS,       *06210000
062200*     VENDOR # 066316522, TO VENDORS THAT REQUIRE THE ATTACHING  *06220000
062300*     OF A DATE SUFFIX TO THE INVOICE ID.  THIS WAS DONE BECAUSE *06230000
062400*     OF SEVERAL OCCURENCES OF DUPLICATE INVOICES FOR THE VENDOR.*06240000
062500*     MADE BY: ROLF NOHE               WR/IR #: WR30042          *06250000
062600*                                                                *06260000
062700* DATE  05/03/2006                                               *06270000
062800*     CHANGE MADE: ADDED VENDOR CAPELLI OF NEW YORK (557461522)  *06280000
062900*     TO VENDORS THAT REQUIRE THE ATTACHING OF A DATE SUFFIX TO  *06290000
063000*     THE INVOICE ID.  THIS WAS DONE BECAUSE OF SEVERAL OCCUR-   *06300000
063100*     ENCES OF DUPLICATE INVOICES.                               *06310000
063200*     MADE BY: MIKE BESKE              WR/IR #: P000876803       *06320000
063300*                                                                *06330000
063400* DATE  05/09/2006                                               *06340000
063500*     CHANGE MADE: ADDED VENDOR WONDERBRA/SARA LEE INTIMATES     *06350000
063600*     (045290087) TO VENDORS THAT REQUIRE THE ATTACHING OF A     *06360000
063700*     DATE SUFFIX TO THE INVOICE ID.  THIS WAS DONE BECAUSE OF   *06370000
063800*     SEVERAL OCCURENCES OF DUPLICATE INVOICES.                  *06380000
063900*     MADE BY: ROLF NOHE               WR/IR #: WR30042          *06390000
064000*                                                                *06400000
064100* DATE  05/25/2006                                               *06410000
064200*     CHANGE MADE: MODIFIED ALLOWANCE_CSR TO INCLUDE THE NEW     *06420000
064300*     TYPE CODE VALUE '11' FOR 'PROFIT ASSIST/AD COP-OP ALLOW'.  *06430000
064400*                                                                *06440000
064500*     MODIFIED THE LOADING OF THE DATA FROM THE ALLOWANCE_CSR    *06450000
064600*     INTO THE INTERAL ARRAY TO A) US THE TYPE CODE VALUE OF '1' *06460000
064700*     FOR 'NSD', NOT 'TRD' AND B) ADDED THE NEW TYPE CODE VALUE  *06470000
064800*     OF '11' FOR 'ALW'. REMOVED THE CODE FOLLOWING THIS LOAD    *06480000
064900*     PROCESS THAT WAS CHECKING ON NEW STORE DISCOUNTS. 'NSD' IS *06490000
065000*     NEVER FOUND IN THE PAYMENT TERMS SO THE LOGIC IS NOT       *06500000
065100*     NEEDED.                                                    *06510000
065200*                                                                *06520000
065300*     ADDED 'ALW' TO THE ALLOWANCE TABLE SEARCH FOR MATCHES      *06530000
065400*     BETWEEN THE AP052-ALLW-CHRG-CODE AND THE TBL-ALLOWANCE-CDE.*06540000
065500*     REMOVED LOGIC THAT WAS TREATING 'TRD' ON A PO AS MISC.     *06550000
065600*     ALLOW. WHEN MATCH WAS NOT FOUND. ONLY EXACT MATCHES ON THE *06560000
065700*     ALLOW. CODE CAN BE CONCIDERED MATCHES. ANY OTHER CODE      *06570000
065800*     VALUE ON THE INCOMING INVOICE SHOULD BE LOADED TO THE      *06580000
065900*     ARRAY.  CORRECTED THE LOGIC OF CREATING THE ADDITIONAL     *06590000
066000*     RECORD ON THE ARRAY.                                       *06600000
066100*                                                                *06610000
066200*     MODIFIED COPYBOOKS: APRD050 AND APRD052 TO INCLUDE THE     *06620000
066300*     'ALW' AS A VALID ALLOWANCE CODE. (APRD053 WAS MODIFIED VIA *06630000
066400*     MODIFICATIONS TO THE PROD CICS INVOICE ENTRY SCREEN).      *06640000
066500*     MADE BY: MICHELE RINDFLEISCH     WR/IR #: WR30028          *06650000
066600*                                                                *06660000
066700* DATE  06/02/2006                                               *06670000
066800*     CHANGE MADE: REMOVED LOGIC IN B300 WHICH CAUSED INVOICES   *06680000
066900*     THAT HAD SPACES IN THE INVOICE NUMBER TO BE PROCESSED WITH *06690000
067000*     THE PREVIOUS INVOICE.  THIS CAUSED A VALID INVOICE FOR A   *06700000
067100*     DIFFERENT VENDOR TO BE REJECTED, AND THE INVOICES WITH     *06710000
067200*     SPACES IN THE INVOICE NUMBER CAN BE PROCESSED ON THEIR     *06720000
067300*     OWN, AND THEY WILL CREATE APPROPRIATE REJECTION MESSAGES.  *06730000
067400*     ALSO REMOVED DISPLAYS IN W170.                             *06740000
067500*     MADE BY: NANCY EILBES            WR/IR #: P000886448       *06750000
067600*                                                                *06760000
067700* DATE  07/19/2006                                               *06770000
067800*     CHANGE MADE: ADDED VENDOR TRUEFORM INTIMATE APPAREL        *06780000
067900*     (058112491) TO VENDORS THAT REQUIRE THE ATTACHING OF A     *06790000
068000*     DATE SUFFIX TO THE INVOICE ID.  THIS WAS DONE BECAUSE OF   *06800000
068100*     SEVERAL OCCURENCES OF DUPLICATE INVOICES.                  *06810000
068200*     MADE BY: ROLF NOHE               WR/IR #: WR30042          *06820000
068300*                                                                *06830000
068400* DATE  07/20/2006                                               *06840000
068500*     CHANGE MADE: ADDED VENDOR CHARLESTON HOSIERY INC           *06850000
068600*     (003334893) TO VENDORS THAT REQUIRE THE ATTACHING OF A     *06860000
068700*     DATE SUFFIX TO THE INVOICE ID.  THIS WAS DONE BECAUSE OF   *06870000
068800*     SEVERAL OCCURENCES OF DUPLICATE INVOICES.                  *06880000
068900*     MADE BY: ROLF NOHE               WR/IR #: WR30042          *06890000
069000*                                                                *06900000
069100* DATE  08/21/2006                                               *06910000
069200*     CHANGE MADE: ADDED VENDOR HAGGAR CLOTHING CO. (007926645)  *06920000
069300*     TO VENDORS THAT REQUIRE THE ATTACHING OF A DATE SUFFIX TO  *06930000
069400*     THE INVOICE ID.  THIS WAS DONE BECAUSE OF SEVERAL OCCUR-   *06940000
069500*     ENCES OF DUPLICATE INVOICES.                               *06950000
069600*     MADE BY: MIKE BESKE              WR/IR #: P000914162       *06960000
069700*                                                                *06970000
069800* DATE  08/21/2006                                               *06980000
069900*     CHANGE MADE: RECOMPILED PROGRAM TO PICK CHANGE TO APWS009  *06990000
070000*     WHERE VENDOR # 049804594 (NIKE) WAS ADDED TO 88 LEVEL TO   *07000000
070100*     ALWAYS USE PO TERMS FOR INVOICE DUE DATE CALCULATION.      *07010000
070200*     MADE BY: MIKE BESKE              WR/IR #: P000914442       *07020000
070300*                                                                *07030000
070400* DATE  09/22/2006                                               *07040000
070500*     CHANGE MADE: MATCH BY DC -- INCLUDED 'NA' (CORPORATE NOT   *07050000
070600*     ALLOCATED) AS A VALID LOC_TYP_CDE TO THE LOCATION_CSR.     *07060000
070700*     ALSO ADDED 'NA' TO PARAGRAPHS R300-VALIDATE-STORE1 AND     *07070000
070800*     R350-VALIDATE-STORE2 TO VALIDATE THE STORE NUMBER AGAINST  *07080000
070900*     THE LOCATION TABLE.                                        *07090000
071000*     CHANGE MADE IN SAME VERSION BY NANCY EILBES TO REINSTATE   *07100000
071100*     LOGIC HANDLING NEW STORE DISCOUNT ON THE TPOAGMT TABLE     *07110000
071200*     THAT WAS ERRONEOUSLY REMOVED IN A PREVIOUS CHANGE. NEW     *07120000
071300*     LOGIC WAS LOOKING FOR NSD IN THE TPOAGMT ROW WITH          *07130000
071400*     AGRMT_TYP_ID = '5' AND TYP_CDE = 1.  THE NSD DISCOUNT      *07140000
071500*     IS ACTUALLY STORED ON THE SAME TPOAGMT ROW AS THE PAYMENT  *07150000
071600*     TERMS.                                                     *07160000
071700*     MADE BY: KRYSTEN LEARY           WR/IR #: WR21578          *07170000
071800*                                                                *07180000
071900* DATE  03/11/2007                                               *07190000
072000*     CHANGE MADE: MATCH BY DC -- REMOVED ALL REFERENCES OF      *07200000
072100*     COPYBOOK APRD055, BULK-SWITCH, AND BY-STORE-SWITCH.        *07210000
072200*     ADDED THE WORKING STORAGE FIELDS WS-MTCH-LVL AND           *07220000
072300*     WS-SAVE-STORE-NBR-FOR-DC.  REPLACED ALL INSTANCES OF       *07230000
072400*     WS-AP055-STORE WITH WS-MTCH-LVL.  RENAMED THE              *07240000
072500*     PO_BULK_STORE_CSR TO BE MTCH_LVL_CSR AND REPLACED THE      *07250000
072600*     STR_NBR IN THE SELECT STATEMENT WITH MTCH_LVL_CDE.  ALSO   *07260000
072700*     CHANGED THE FETCH STATMENT ACCORDINGLY.  INCLUDED THE      *07270000
072800*     DIR_STR_IND FIELD IN THE SELECT AND INTO STATEMENTS OF THE *07280000
072900*     R600-SELECT-TPURCHS PARAGRAPH.  IN PARARGRAPH,             *07290000
073000*     E200-EDIT-ONE, CHANGED THE SECTION THAT PERFORMS EDIT      *07300000
073100*     CHECKS ON BULK/BY-STORE COMBINATIONS TO NOW DETERMINE THE  *07310000
073200*     MATCH LEVEL, STORE NUMBER, AND DC NUMBER FOR EACH INVOICE. *07320000
073300*     THIS CHANGE INCLUDED ADDING THE FOLLOWING PARAGRAPHS TO    *07330000
073400*     THE PROGRAM:                                               *07340000
073500*       A) E205-STORE1-IS-VALID-STORE                            *07350000
073600*       B) E210-STORE1-IS-VALID-DC                               *07360000
073700*       C) E215-STORE1-IS-VALID-IMPORT                           *07370000
073800*       D) E220-STORE1-IS-INVALID-STORE                          *07380000
073900*       E) E230-GENERATE-WARNING4-MSG                            *07390000
074000*       F) E235-GENERATE-WARNING5-MSG                            *07400000
074100*       G) E240-GENERATE-WARNING6-MSG                            *07410000
074200*       H) R375-DETERMINE-DC-NBR                                 *07420000
074300*       I) R385-DETERMINE-DC-NBR                                 *07430000
074400*     ALTERED THE PARAGRAPH E300-EDIT-ALL TO CHECK IF THE        *07440000
074500*     WS-MTCH-LVL IS EQUAL TO THE INVOIC-MTCH-LVL-CDE.  IF THEY  *07450000
074600*     ARE EQUAL, NO ACTION NEEDS TO BE TAKEN.  IF THEY ARE NOT   *07460000
074700*     EQUAL, PARAGRAPH S600-COUNT-NON-RIS NEEDS TO BE EXECUTED.  *07470000
074800*     RENAMED ALL INSTANCES OF PARAGRAPH S400-PO-CURSOR TO BE    *07480000
074900*     S400-PROCESS-MTCH-LVL-CURSOR.  ADDED THE ERROR 20, 28, 29, *07490000
075000*     33, 38, AND 71 TO COPYBOOK APWS050.  LASTLY, CHANGED ALL   *07500000
075100*     REFERENCES OF COLBY TO BE LI FUNG.                         *07510000
075200*     MADE BY: KRYSTEN LEARY           WR/IR #: WR21578          *07520000
075300*                                                                *07530000
075400* DATE  03/27/2007                                               *07540000
075500*     CHANGE MADE: RECOMPILE FROM PRODUCTION TO INCORPORATE      *07550000
075600*     CHANGES TO PS_XFT_LOC TABLE FOR STORE DEMOGRAPHICS.        *07560000
075700*     MADE BY: KEVIN CATLIN            WR/IR #: WR31452          *07570000
075800*                                                                *07580000
075900* DATE  04/17/2006                                               *07590000
076000*     ADDED THE FIELD WS-STORE-TO-USE TO ALL PARAGRAPHS WHERE    *07600000
076100*     AP052-KOHLS-STORE-TO-USE IS BEING REFERENCED.  ALSO MOVED  *07610000
076200*     THE VALUE OF THE WS-STORE-TO-USE FIELD TO THE INTERNAL     *07620000
076300*     INTERNAL TABLE FIELD WS-AP052-SORT-LOC IN PARAGRAPH        *07630000
076400*     W600-WRITE-RECYCLE-COMBIN.  THIS CHANGE RESOLVED THE ISSUE *07640000
076500*     OF THE INCORRECT LOCATION BEING WRITTEN TO THE RECYCLE     *07650000
076600*     COMBINATION OUTPUT FILE.                                   *07660000
076700*     MADE BY: KRYSTEN LEARY           WR/IR #: P001008392       *07670000
076800*                                                                *07680000
076900* DATE  04/23/2006                                               *07690000
077000*     CHANGE MADE: IN PARAGRAPH E200-EDIT-ONE ADDED LOGIC TO THE *07700000
077100*     COMPOUND IF STATEMENT, IN THE IF                           *07710000
077200*     AP052-RECORD-TYPE-IND = '01' SECTION, TO CHECK THAT THE    *07720000
077300*     STATUS_CDE OF THE PURCHASE ORDER IS NOT CANCELED ('CA').   *07730000
077400*     AN ERROR IS GENERATED IF THE STATUS IS CANCELED.  ALSO     *07740000
077500*     INCLUDED THE STATUS_CDE IN THE SELECT STATEMENT OF         *07750000
077600*     PARAGRAPH R600-SELECT-TPURCHS.  LASTLY, ADDED ERROR CODE   *07760000
077700*     18 TO THE APWS050 COPYBOOK.                                *07770000
077800*     MADE BY: KRYSTEN LEARY           WR/IR #: WR26018          *07780000
077900*                                                                *07790000
078000* DATE  05/15/2007                                               *07800000
078100*     CHANGE MADE: FIXED MOVE FOR RECYCLED INVOICES SO THAT THE  *07810000
078200*     CORRECT ISA WAS POPULATED. EXCLUDED EXPENSE INVOICES FROM  *07820000
078300*     MATCH LEVEL VERIFICATION SO THEY WOULD NOT GO INTO RECYCLE *07830000
078400*     MADE BY: GREG WISIALOWSKI        WR/IR #: P001018998       *07840000
078500*                                                                *07850000
078600* DATE  05/16/2007                                               *07860000
078700*     CHANGE MADE: ADDED ADDITIONAL CONDITION TO THE SQL IN PARA *07870000
078800*     R375- TO HELP DETERMINE THE CORRECT DC NUMBER TO USE FROM  *07880000
078900*     FI_XFT_LOC_ASGMT.  RENAMED THE ERROR CONDITION CODE 71 IN  *07890000
079000*     APWS050 TO REFER TO DC NUMBER COULD NOT BE DETERMINED.     *07900000
079100*     MADE BY: MIKE BESKE              WR/IR #: P001021023       *07910000
079200*                                                                *07920000
079300* DATE  08/16/2007                                               *07930000
079400*     CHANGE MADE: REMOVED MANUAL HOLD FOR EXCESSIVE CONSUMER    *07940000
079500*     DIRECT CHARGES AND ALSO FOR OVER LIMIT CHARGES IN GENERAL  *07950000
079600*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR32604          *07960000
079700*                                                                *07970000
079800* DATE  01/08/2008                                               *07980000
079900*     CHANGE MADE: REMOVE HAGGAR, VENDOR NUMBER 007926645, FROM  *07990000
080000*     LIST OF VENDORS TO ALWAYS INCLUDE THE DATE SUFFIX TO THE   *08000000
080100*     INVOICE ID.                                                *08010000
080200*     MADE BY: ROLF NOHE               WR/IR #: WR31939          *08020000
080300*                                                                *08030000
080400* DATE  04/28/2008                                               *08040000
080500*     CHANGE MADE: REMOVE LEVI, VENDOR NUMBER 009109273, FROM    *08050000
080600*     LIST OF VENDORS TO ALWAYS INCLUDE THE DATE SUFFIX TO THE   *08060000
080700*     INVOICE ID.                                                *08070000
080800*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR34276          *08080000
080900*                                                                *08090000
081000* DATE  04/29/2008                                               *08100000
081100*     CHANGE MADE: MODIFIED CODE TO NO LONGER ABEND PROGRAM WHEN *08110000
081200*     THE WS-INVOICE-TABLE LIMIT (10998) IS PASSED. THIS IS NOW  *08120000
081300*     CONSIDERED AN ERROR CONDITION (ERROR CODE 75). THE         *08130000
081400*     WAY AN INVOICE THAT HAS TOO MANY LINES (> 10998) IS WRITTEN*08140000
081500*     TO THE REJECT FILE IS DIFFERENT FROM ALL OTHER ERRORS.     *08150000
081600*     BECAUSE OF THE EXCESSIVE AMOUNT OF INVOICE LINES FOR THIS  *08160000
081700*     SITUATION ONLY ONE DETAIL RECORD (REC TYPE 07) WILL BE     *08170000
081800*     WRITTEN TO THE REJECT FILE. ALSO THE NUMBER OF INVC        *08180000
081900*     LINES IS TOTALED AND MOVED TO A NEW FIELD ON THE APRD051   *08190000
082000*     COPYBOOK.  THIS TOTAL WILL BE DISPLAYED WITH THE ERROR MES-*08200000
082100*     SAGE LATER ON IN THE ERROR REPORT PROGAM.  ADDED MISSING   *08210000
082200*     END-IF STMTS AS THEY WERE ENCOUNTERED WHILE MODIFYING CODE *08220000
082300*     FOR ERROR CODE 75 IMPLEMENTATION. UPDATED VARIOUS COMMENTS *08230000
082400*     REFERRING TO THE VALUE OF INV-INDX THROUGHOUT THE PROGRAM  *08240000
082500*     TO MATCH AS 10998 OR 11000. THIS WILL MAKE ANY FUTURE      *08250000
082600*     CHANGES TO THE SIZE OF WS-INVOICE-TABLE EASIER AND UNIFORM.*08260000
082700*     MOD PARAS: A100- B200- B300- H200- R125- R150- W300- Z900- *08270000
082800*     MADE BY: MIKE BESKE              WR/IR #: WR31187          *08280000
082900*                                                                *08290000
083000* DATE  12/29/2008                                               *08300000
083100*     CHANGE MADE: PARAGRAPH S200 - CHANGED COMPARE OF INVOICE   *08310000
083200*     ALLOWANCE TO TABLE ALLOWANCE TO BE GREATER THAN OR EQUAL   *08320000
083300*     RATHER THAN JUST GREATER THAN.  THIS WILL MAKE IT MORE     *08330000
083400*     LIKELY FOR THE INVOICE ALLOWANCE TO LOAD IF THE VENDOR     *08340000
083500*     SENT IT CORRECTLY.  HELP ALLEVIATE RECYCLE ISSUES.         *08350000
083600*     MADE BY: NANCY EILBES            WR/IR #: INC000000644501  *08360000
083700*                                                                *08370000
083800* DATE  01/06/2009                                               *08380000
083900*     CHANGE MADE: PARAGRAPH E200-EDIT-ONE, IN THE SECTION THAT  *08390000
084000*     DOES UPC VALIDATION, ADDED LOGIC TO CHECK IF THE PO LINE   *08400000
084100*     NUMBER IS ALREADY FILLED IN ON THE RECORD (FILLED IN FROM  *08410000
084200*     THE PACK PROCESSING IN APKUT067).  IF IT IS ALREADY THERE, *08420000
084300*     BYPASS THE PROCESS TO LOOK UP THE LINE NUMBER.             *08430000
084400*     MADE BY: NANCY EILBES            WR/IR #: INC000000601329  *08440000
084500*                                                                *08450000
084600* DATE  01/14/2009                                               *08460000
084700*     CHANGE MADE: PARAGRAPH W100-WRITE-EDI - ADDED LOGIC TO SET *08470000
084800*     A NEW 88 LEVEL OF AP052-VENDOR-SENT FOR THE ALLOWANCE      *08480000
084900*     SOURCE CODE.  ALLOWANCES BEING LOADED FROM THE INVOICE     *08490000
085000*     WERE GETTING THE 'PO-ADD' VALUE LEFT OVER FROM THE PRIOR   *08500000
085100*     ALLOWANCE PROCESSED.  ADDED THE 88 LEVEL TO COPYBOOK.      *08510000
085200*     MADE BY: NANCY EILBES            WR/IR #: INC000000662753  *08520000
085300*                                                                *08530000
085400* DATE  01/23/2009                                               *08540000
085500*     CHANGE MADE: ADDED PERFORM X500-COMMIT AFTER EACH PERFORM  *08550000
085600*     OF R375- AND R385- TO CORRECT THE -918 ABEND THAT HAPPENED *08560000
085700*     IN PROD TWICE THIS WEEK.                                   *08570000
085800*     MADE BY: MIKE BESKE              WR/IR #: INC000000672866  *08580000
085900*                                                                *08590000
086000* DATE  05/15/2009                                               *08600000
086100*     CHANGE MADE: PARAGRAPH E500-CHECK-DUP-INV, ADDED LOGIC TO  *08610000
086200*     CHECK IF VENDOR ID + BASE INVOICE ID EXIST IN PS_VOUCHER   *08620000
086300*     TABLE, IF IT DOES NOT EXIST IN TINVOIC TABLE. ADDED A NEW  *08630000
086400*     PARAGRAPH E580-CHECK-DUP-VEN-INV-IN-PS TO DO EXISTENCE      08640000
086500*     CHECK IN PS_VOUCHER TABLE.                                  08650000
086600*     MADE BY: SABITHA RAJARAM         WR/IR #: WR32642          *08660000
086700*                                                                *08670000
086800* DATE  03/22/2010                                               *08680000
086900*     CHANGE MADE: MODIFIED PROGRAM TO NO LONGER HAVE SPECIFIC   *08690000
087000*     VENDORS THAT MUST ALWAYS USE A DATE SUFFIX.                *08700000
087100*     MADE BY: MICHELE RINDFLEISCH     WR/IR #: PKE000000002232  *08710000
087200*                                                                 08720000
087300* DATE  09/01/2011                                                08730000
087400*     CHANGE MADE: CHANGED FOR PEOPLESOFT FINANCIAL UPGRADE      *08740000
087500*     PROJECT. AS PART OF THE PROJECT THE PEOPLSOFT DATABASES    *08750000
087600*     WILL BE MIGRATED TO ORACLE. APKED201 WILL SPLIT IN TWO     *08760000
087700*     PARTS: 1) APKED201 - HANDLES LEGACY CALLS 2) APKUT272      *08770000
087800*     HANDLES PS CALLS. THE E580- PARA THAT WAS CALLING PS       *08780000
087900*     VOUCHER TABLE HAS BEEN MOVED TO APKUT272. GOOD OUT FILE    *08790000
088000*     WILL NOW CONTAIN ONE ADDITIONAL FIELD THAT WILL BE PASSED  *08800000
088100*     TO APKUT272: CHCK-PS-DUP                         *          08810000
088200*     MADE BY: MADHURA PETHE           WR/IR #: WR37038          *08820000
088210* DATE  10/29/2014                                                08821000
088220*     CHANGE MADE: PO EXTENDED DIGIT CHANGES.                    *08822000
088230*     EXTENDED PO# FROM 7 TO 9                                   *08823000
088240*     MADE BY: COGNIZANT               WR/IR #: CHG0094517       *08824000
088241* DATE  04/22/2015                                                08824115
088242*     CHANGE MADE: PRB0053093 - ENHANCE INVOICE EDIT TO LOOK UP  *08824215
088243*     PO LINES USING SKU. MODIFIED PO LINE LOOKUP LOGIC TO USE   *08824315
088244*     THE SKU NUMBER FOR THE LOOKUP IF THE PO TYPE IS CD. E-COM  *08824415
088245*     PROCESS IS SKU DRIVEN, SO THIS ITEM ID WILL BE MORE        *08824515
088246*     ACCURATE THAN UPC.                                         *08824615
088247*     MADE BY: NANCY EILBES            WR/IR #: CHG0109981       *08824715
088248* DATE  12/03/2016                                                08824822
088249*     CHANGE MADE: CHANGED PC-COMBIN-TBL-MAX AND RELATED INDEXES *08824922
088250*     TO +800,000.                                                08825022
088254*     MADE BY: COGNIZANT               WR/IR #: CHG0157988       *08825422
088248*                                                                 08825524
088248* DATE  01/15/2018                                                08825628
088249*     CHANGE MADE: ADDED NEW PO TYPE - 'LE' ECOMM LANDED.        *08825725
088254*     MADE BY: BARB SCHULTZ            WR/IR #: CHG0181356       *08825927
088248*                                                                 08826030
088248* DATE  03/16/2023                                                08826157
088249*     CHANGE MADE: ALLOW FOR INFOR NEXUS INVOICES                *08826230
088254*     MADE BY: JEAN KURK               WR/IR #: CHG0285404       *08826357
088255******************************************************************08826424
088260                                                                  08826524
088270 ENVIRONMENT DIVISION.                                            08827000
088280 INPUT-OUTPUT SECTION.                                            08828000
088290                                                                  08829000
088300 FILE-CONTROL.                                                    08830000
088400                                                                  08840000
088500     SELECT EDIIN-AP056-COMBIN-FILE                               08850000
088600         ASSIGN         TO UT-S-INP02.                            08860000
088700     SELECT EDIIN-AP050-FILE                                      08870000
088800         ASSIGN         TO UT-S-INP03.                            08880000
088900     SELECT EDIOUT-AP052-FILE                                     08890000
089000         ASSIGN         TO UT-S-OUT01.                            08900000
089100     SELECT REJOUT-AP051-FILE                                     08910000
089200         ASSIGN         TO UT-S-OUT02.                            08920000
089300     SELECT EDIOUT-AP056-COMBIN-FILE                              08930000
089400         ASSIGN         TO UT-S-OUT06.                            08940000
089500                                                                  08950000
089600 DATA DIVISION.                                                   08960000
089700                                                                  08970000
089800 FILE SECTION.                                                    08980000
089900                                                                  08990000
090000 FD  EDIIN-AP056-COMBIN-FILE                                      09000000
090100         LABEL RECORDS  ARE STANDARD                              09010000
090200         RECORDING MODE IS  F                                     09020000
090300         DATA RECORD    IS  EDIIN-AP056-COMBIN-REC.               09030000
090400 01  EDIIN-AP056-COMBIN-REC        PIC X(370).                    09040000
090500                                                                  09050000
090600 FD  EDIIN-AP050-FILE                                             09060000
090700         LABEL RECORDS  ARE STANDARD                              09070000
090800         RECORDING MODE IS  F                                     09080000
090900         DATA RECORD    IS  EDIIN-AP050-RECORD.                   09090000
091000 01  EDIIN-AP050-RECORD            PIC X(350).                    09100000
091100                                                                  09110000
091200 FD  EDIOUT-AP052-FILE                                            09120000
091300         LABEL RECORDS  ARE STANDARD                              09130000
091400         RECORDING MODE IS  F                                     09140000
091500         DATA RECORD    IS  EDIOUT-AP052-RECORD.                  09150000
091600 01  EDIOUT-AP052-RECORD           PIC X(350).                    09160000
091700                                                                  09170000
091800 FD  REJOUT-AP051-FILE                                            09180000
091900         LABEL RECORDS  ARE STANDARD                              09190000
092000         RECORDING MODE IS  F                                     09200000
092100         DATA RECORD    IS  REJOUT-AP051-RECORD.                  09210000
092200 01  REJOUT-AP051-RECORD           PIC X(500).                    09220000
092300                                                                  09230000
092400                                                                  09240000
092500 FD  EDIOUT-AP056-COMBIN-FILE                                     09250000
092600         LABEL RECORDS  ARE STANDARD                              09260000
092700         RECORDING MODE IS  F                                     09270000
092800         DATA RECORD    IS  EDIOUT-RECYCLE-COMBIN-REC.            09280000
092900 01  EDIOUT-RECYCLE-COMBIN-REC     PIC X(370).                    09290000
093000                                                                  09300000
093100**************************                                        09310000
093200 WORKING-STORAGE SECTION.                                         09320000
093300**************************                                        09330000
093400                                                                  09340000
093500 01  FILLER                        PIC X(25) VALUE                09350000
093600                             'WS FOR APKED201 BEGINS==>'.         09360000
093700 01  PC-COMBIN-TBL-MAX             PIC S9(09) COMP SYNC           09370000
093800                                              VALUE +800000.      09380021
093900 01  PC-LOC-TBL-MAX                PIC S9(09) COMP SYNC           09390000
094000                                              VALUE +1500.        09400000
094100 01  PC-ZERO-STR                   PIC X(05) VALUE ZEROS.         09410000
094200 01  WS-COUNT                      PIC S9(4) COMP SYNC            09420000
094300                                             VALUE ZEROS.         09430000
094400                                                                  09440000
094500 01  ABEND-CODE                    PIC S9(4) COMP SYNC            09450000
094600                                             VALUE ZEROS.         09460000
094700     88 AP-TABLE-FULL              VALUE +4004.                   09470000
094800     88 AP-EMPTY-FILE              VALUE +4005.                   09480000
094900     88 AP-DB2-ERROR               VALUE +4013.                   09490000
095000                                                                  09500000
095100 01  WS-RETRY-COUNTER                PIC S9(4) COMP VALUE ZERO.   09510000
095200 01  WS-ABEND-FIELDS.                                             09520000
095300     05  WS-ABEND-PROGRAM            PIC X(8)  VALUE 'APKED201'.  09530000
095400     05  WS-ABEND-PARAGRAPH          PIC X(50) VALUE SPACES.      09540000
095500     05  WS-ABEND-OPERATION          PIC X(50) VALUE SPACES.      09550000
095600     05  WS-ABEND-STRUCTURE-1        PIC X(8)  VALUE SPACES.      09560000
095700     05  WS-ABEND-STRUCTURE-2        PIC X(8)  VALUE SPACES.      09570000
095800     05  WS-ABEND-STATUS             PIC XX    VALUE SPACES.      09580000
095900                                                                  09590000
096000 01  WS-WORK-AREA.                                                09600000
096100     05  WS-BULK-STORE-STR           PIC S9(04)    VALUE 0 COMP.  09610000
096100     05  WS-VEND-INCHG-ID            PIC X(15)     VALUE SPACES.  09611056
096300         88 WS-INFOCHAIN                 VALUE 'INFOCHAIN'.       09612056
096200     05  WS-EXTENT-DUN-NBR           PIC X(09)     VALUE SPACES.  09620000
096300         88 WS-HIGH-LIMIT-VENDOR         VALUES '003949435'       09630000
096400                                              , '000570275'       09640000
096500                                              , '029216363'       09650000
096600                                              , '076735463'       09660000
096700                                              , '009206194'       09670000
096800                                              , '000570960'.      09680000
096900         88 WS-VENDOR-IS-LI-FUNG         VALUE  '009206194'.      09690000
097000**THESE ARE ALL NY JONES APPAREL DIVISIONS                        09700000
097100         88 WS-VENDOR-IS-NY-JONES        VALUE  '084795665'       09710000
097200                                                '000348946'       09720000
097300                                                '009013624'       09730000
097400                                                '001147982'       09740000
097500                                                '000767566'       09750000
097600                                                '000295055'       09760000
097700                                                '000767558'       09770000
097800                                                '009204066'       09780000
097900                                                '112454181'       09790000
098000                                                '001348168'       09800000
098100                                                '000809681'       09810000
098200                                                '043617455'       09820000
098300                                                '001003193'       09830000
098400                                                '847951063'.      09840000
098500* HIGH LIMIT VENDORS ARE THOSE THAT SEND UNIT COSTS WITH 3 OR 4   09850000
098600* DIGITS AFTER THE DECIMAL POINT.  OUR COPYBOOK ONLY HAS 3 DIGITS,09860000
098700* SO A HIGHER LIMIT IS NEEDED FOR THESE VENDORS TO ALLOW FOR THE  09870000
098800* DIFFERENCE DUE TO TRUNCATION. VENDORS: HALLMARK, RANDOM HOUSE,  09880000
098900* AT A GLANCE, CARLTON CARDS, LI FUNG INTERNATIONAL AND DORLING   09890000
099000* KIDERSLEY PUBLISHING.                                           09900000
099100*                                                                 09910000
099200     05  WS-SAVE-INVOICE-NBR         PIC X(22)     VALUE SPACES.  09920000
099300     05  WS-SAVE-EDI-SEQ-NBR         PIC X(05)     VALUE SPACES.  09930000
099400     05  WS-INVC-FOR-LIKE-COND       PIC X(22)     VALUE SPACES.  09940000
099500     05  WS-INVOICE-WITH-SUFFIX      PIC X(22)     VALUE SPACES.  09950000
099600***  05  WS-INVOICE-WITH-SUFFIX      PIC X(16)     VALUE SPACES.  09960000
099700                                                                  09970000
099800     05  WS-START-PTR                PIC S9(04)    VALUE +0 COMP. 09980000
099900     05  WS-PS-INVC-ID               PIC X(16)     VALUE SPACES.  09990000
100000                                                                  10000000
100100     05  WS-SAVE-GROSS-INVOICE-AMT   PIC S9(08)V99 VALUE ZEROS.   10010000
100200     05  WS-SAVE-DISC-INVC-AMT       PIC S9(08)V99 VALUE ZEROS.   10020000
100300     05  WS-SAVE-NET-COST            PIC S9(08)V99 VALUE ZEROS.   10030000
100400     05  WS-SAVE-INTERCHG-CNTL-NBR   PIC X(09)     VALUE SPACES.  10040000
100500     05  WS-DETAIL-GROSS-INVOICE-AMT PIC S9(08)V99 VALUE ZEROS.   10050000
100600     05  WS-DETAIL-ADJ-GROSS-INV-AMT PIC S9(08)V99 VALUE ZEROS.   10060000
100700     05  WS-DETAIL-ALLW-AMT-NEW      PIC S9(08)V99 VALUE ZEROS.   10070000
100800     05  WS-DETAIL-ALLW-AMT          PIC S9(08)V99 VALUE ZEROS.   10080000
100900     05  WS-DETAIL-CHRG-AMT          PIC S9(08)V99 VALUE ZEROS.   10090000
101000     05  WS-LI-FUNG-HANGER-AMT       PIC S9(08)V99 VALUE ZEROS.   10100000
101100     05  WS-CD-HANDLING-AMT          PIC S9(08)V99 VALUE ZEROS.   10110000
101200     05  WS-MAX-CD-HANDLING-AMT      PIC S9(08)V99 VALUE ZEROS.   10120000
101300     05  WS-TOTAL-QTY-INVOICED       PIC S9(08)V99 VALUE ZEROS.   10130000
101400     05  WS-CALC-EXTEN-INVOICE-AMT   PIC S9(08)V999 VALUE ZEROS.  10140000
101500     05  WS-TOT-EXTEN-INVOICE-AMT    PIC S9(08)V999 VALUE ZEROS.  10150000
101600     05  WS-LAST-REC-TYPE            PIC X(02)     VALUE SPACES.  10160000
101700     05  WS-SAVE-PO-NBR              PIC 9(09)     VALUE ZEROS.   10170000
101800     05  WS-SAVE-PO-NBR-X REDEFINES WS-SAVE-PO-NBR PIC X(09).     10180000
101900     05  WS-SAVE-PO-NBR-COMP         PIC S9(09) COMP VALUE ZEROS. 10190000
102000     05  WS-PREV-PO-NBR-COMP         PIC S9(09) COMP VALUE ZEROS. 10200000
102100     05  WS-SAVE-PO-INV-NBR          PIC X(31)     VALUE SPACES.  10210000
102200     05  WS-SAVE-DUN-INV-NBR         PIC X(31)     VALUE SPACES.  10220000
102300     05  WS-DASH-DUN-INV-NBR         PIC X(31)     VALUE SPACES.  10230000
102400*    05  WS-ENT-ID-COMP              PIC S9(09) COMP VALUE ZEROS. 10240031
102500     05  WS-DUN-NBR-9S               PIC  9(09)    VALUE ZEROS.   10250000
102600     05  WS-DUN-NBR-X  REDEFINES WS-DUN-NBR-9S PIC X(09).         10260000
102700     05  WS-TRDPRT-ENT-ID            PIC S9(09) COMP VALUE ZEROS. 10270000
102800     05  WS-TRDPRT-VEND-ID           PIC  X(15)      VALUE SPACE. 10280000
102900     05  WS-TRDPRT-VEND-ID-DESC      PIC  X(02)      VALUE SPACE. 10290000
103000     05  WS-SAVE-DC-NBR              PIC S9(05) COMP VALUE ZEROS. 10300000
103100                                                                  10310000
103200 01  WS-WORK-AREA2.                                               10320000
103300     05  WS-SAVE-NEW-STR-DISC-PCT    PIC S999V9999 VALUE ZERO.    10330000
103400     05  WS-DIFFERENCE               PIC S9(08)V99 VALUE 0.       10340000
103500     05  WS-DETAIL-TOT-UNITS         PIC S9(08)V99 VALUE 0.       10350000
103600     05  WS-STYLE.                                                10360000
103700         10  WS-STYLE-AREA           OCCURS 20 TIMES              10370000
103800                                     INDEXED BY STYLE-INDX.       10380000
103900             15  WS-STYLE-ONE        PIC X(1).                    10390000
104000     05  WS-STYLE2                   PIC X(20).                   10400000
104100     05  WS-STYLE2-RDF REDEFINES WS-STYLE2.                       10410000
104200         10  WS-STYLE2-AREA          OCCURS 20 TIMES              10420000
104300                                     INDEXED BY STYLE-INDX2.      10430000
104400             15  WS-STYLE2-ONE       PIC X(1).                    10440000
104500                                                                  10450000
104600     05  WS-EAN-UPC                  PIC X(13)     VALUE SPACES.  10460000
104700     05  WS-EAN-UPC-EDITTED          PIC X(16)     VALUE SPACES.  10470000
104800     05  WS-SAVE-STORE-NBR1          PIC X(05)     VALUE SPACES.  10480000
104900     05  WS-SAVE-STORE-NBR2          PIC X(05)     VALUE SPACES.  10490000
105000     05  WS-MTCH-LVL                 PIC X(01)     VALUE SPACE.   10500000
105100     05  WS-SAVE-STORE-NBR-FOR-DC    PIC 9(05)     VALUE ZERO.    10510000
105200     05  WS-STORE-TO-USE             PIC X(05)     VALUE SPACES.  10520000
105300                                                                  10530000
105400     05  WS-SAVE-INVOICE-DATE        PIC X(06)   VALUE '000000'.  10540000
105500     05  WS-SAVE-INV-DATE  REDEFINES WS-SAVE-INVOICE-DATE.        10550000
105600         10  WS-SAVE-INV-YY          PIC X(02).                   10560000
105700         10  WS-SAVE-INV-MM          PIC X(02).                   10570000
105800         10  WS-SAVE-INV-DD          PIC X(02).                   10580000
105900     05  WS-SAVE-SHIPPED-DATE        PIC X(06)   VALUE '000000'.  10590000
106000     05  WS-SAVE-SHIP-DATE REDEFINES WS-SAVE-SHIPPED-DATE.        10600000
106100         10  WS-SAVE-SHIP-YY         PIC X(02).                   10610000
106200         10  WS-SAVE-SHIP-MM         PIC X(02).                   10620000
106300         10  WS-SAVE-SHIP-DD         PIC X(02).                   10630000
106400     05  WS-SAVE-EFFECTIVE-DATE      PIC X(06)   VALUE '000000'.  10640000
106500     05  WS-SAVE-EFF-DATE REDEFINES WS-SAVE-EFFECTIVE-DATE.       10650000
106600         10  WS-SAVE-EFF-YY          PIC X(02).                   10660000
106700         10  WS-SAVE-EFF-MM          PIC X(02).                   10670000
106800         10  WS-SAVE-EFF-DD          PIC X(02).                   10680000
106900                                                                  10690000
107000     05  WS-CHECK-BASIS-DTE-CODE     PIC X(02)     VALUE SPACES.  10700000
107100     05  WS-COMPARE-JULIAN           PIC 9(07)     VALUE ZEROES.  10710000
107200                                                                  10720000
107300     05  WS-SAVE-RECYCLE-KEY.                                     10730000
107400         10  WS-SAVE-CR-DATE.                                     10740000
107500             15  WS-SAVE-CR-CC       PIC 9(02).                   10750000
107600             15  WS-SAVE-CR-JULIAN   PIC 9(05).                   10760000
107700***************************************************************** 10770000
107800*  Y2K. REDEFINED GROUP ITEM TO ALLOW IT TO BE USED IN AN       * 10780000
107900*  ARITHMETIC EXPRESSION (AND PREVENT COMPILE ERRORS).          * 10790000
108000***************************************************************** 10800000
108100         10  WS-SAVE-CR-JL-DT REDEFINES WS-SAVE-CR-DATE PIC 9(07).10810000
108200         10  WS-SAVE-RECYCLE-CNT     PIC 9(02).                   10820000
108300         10  WS-SAVE-FILLER          PIC X(11).                   10830000
108400     05  WS-DISC-DAYS-DUE            PIC S9(5)     VALUE ZERO.    10840000
108500     05  WS-DISC-PAY-DAY-QTY         PIC S9(4)     COMP VALUE 0.  10850000
108600     05  WS-CCYYMMDD.                                             10860000
108700         10  WS-CENTURY              PIC X(02)     VALUE '00'.    10870000
108800         10  WS-YYMMDD.                                           10880000
108900             15  WS-YY               PIC X(02)     VALUE '00'.    10890000
109000             15  WS-MM               PIC X(02)     VALUE '00'.    10900000
109100             15  WS-DD               PIC X(02)     VALUE '00'.    10910000
109200                                                                  10920000
109300     05  WS-UPC-CODE                 PIC 9(13)     VALUE ZEROS.   10930000
109400     05  WS-UPC-CODE-X REDEFINES WS-UPC-CODE PIC X(13).           10940000
109500     05  WS-UPC-CODE-COMP3           PIC S9(15)    COMP-3         10950000
109600                                                   VALUE ZEROS.   10960000
109700 01  WS-UPC-13.                                                   10970000
109800     05  WS-UPC-ZERO                 PIC 9(01)     VALUE ZEROS.   10980000
109900     05  WS-UPC-12                   PIC X(12)     VALUE SPACES.  10990000
110000                                                                  11000000
110100*--------------------------------------------------------------*  11010000
110200* GREGORIAN/JULIAN DATE CONVERSION                             *  11020000
110300*--------------------------------------------------------------*  11030000
110400     COPY DPWS500.                                                11040000
110500                                                                  11050000
110600 01  WS-PROGRAM-COUNTERS.                                         11060000
110700     05  WS-EDIIN-REC-CNT            PIC 9(9)      VALUE ZEROS.   11070000
110800     05  WS-EDIIN-REC-CNT-COMBIN     PIC 9(9)      VALUE ZEROS.   11080000
110900     05  WS-EDIOUT-REC-CNT           PIC 9(9)      VALUE ZEROS.   11090000
111000     05  WS-EDIOUT-COMP-REC-CNT      PIC 9(9)      VALUE ZEROS.   11100000
111100     05  WS-EDIOUT-TOTL-REC-CNT      PIC 9(9)      VALUE ZEROS.   11110000
111200     05  WS-SPECIALTY-CNT            PIC 9(9)      VALUE ZEROS.   11120000
111300     05  WS-REJOUT-REC-CNT           PIC 9(9)      VALUE ZEROS.   11130000
111400     05  WS-EDIOUT6-REC-CNT          PIC 9(9)      VALUE ZEROS.   11140000
111500     05  WS-TOT-INVC-LINES           PIC 9(8)      VALUE ZEROS.   11150000
111600                                                                  11160000
111700 01  WS-INVOICE-COUNTERS.                                         11170000
111800     05  WS-TOT-REC-CNT              PIC 9(03)     VALUE ZEROS.   11180000
111900     05  WS-REC-01-CNT               PIC 9(3)      VALUE ZEROS.   11190000
112000     05  WS-REC-02-CNT               PIC 9(3)      VALUE ZEROS.   11200000
112100     05  WS-REC-04-CNT               PIC 9(3)      VALUE ZEROS.   11210000
112200     05  WS-REC-05-CNT               PIC 9(3)      VALUE ZEROS.   11220000
112300     05  WS-REC-06-CNT               PIC 9(3)      VALUE ZEROS.   11230000
112400     05  WS-REC-07-CNT               PIC 9(7)      VALUE ZEROS.   11240000
112500     05  WS-REC-OTHER-CNT            PIC 9(3)      VALUE ZEROS.   11250000
112600                                                                  11260000
112700 01  WS-SWITCHES.                                                 11270000
112800*    05  WS-CHCK-PS-DUP              PIC X(1)      VALUE SPACE.   11280030
112900*        88 CHCK-PS-DUP-YES                        VALUE 'Y'.     11290030
113000*        88 CHCK-PS-DUP-NO                         VALUE 'N'.     11300030
113100     05  WS-WRITE-EDI-REC-SW         PIC X(1)      VALUE 'N'.     11310000
113200         88  WRITE-EDI-REC                         VALUE 'Y'.     11320000
113300         88  NO-WRITE-EDI-REC                      VALUE 'N'.     11330000
113400     05  WS-MTCH-LVL-CSR-SW          PIC X(1)      VALUE 'N'.     11340000
113500         88  END-MTCH-LVL-CSR                      VALUE 'Y'.     11350000
113600         88  NOT-END-MTCH-LVL-CSR                  VALUE 'N'.     11360000
113700     05  WS-LOCATION-CSR-SW          PIC X(1)      VALUE 'N'.     11370000
113800         88  END-OF-LOC-CSR                        VALUE 'Y'.     11380000
113900         88  NOT-END-OF-LOC-CSR                    VALUE 'N'.     11390000
114000     05  WS-ERROR-SW                 PIC X(1)      VALUE 'N'.     11400000
114100         88  ERROR-EDI                             VALUE 'Y'.     11410000
114200         88  NO-EDI-ERROR                          VALUE 'N'.     11420000
114300     05  WS-PI-WARNING1-WS           PIC X(1)      VALUE 'N'.     11430000
114400         88  NO-PI-WARNING1                        VALUE 'N'.     11440000
114500         88  PI-WARNING1-EXISTS                    VALUE 'Y'.     11450000
114600     05  WS-PI-WARNING2-WS           PIC X(1)      VALUE 'N'.     11460000
114700         88  NO-PI-WARNING2                        VALUE 'N'.     11470000
114800         88  PI-WARNING2-EXISTS                    VALUE 'Y'.     11480000
114900*    05  WS-PI-WARNING3-WS           PIC X(1)      VALUE 'N'.     11490000
115000*        88  NO-PI-WARNING3                        VALUE 'N'.     11500000
115100*        88  PI-WARNING3-EXISTS                    VALUE 'Y'.     11510000
115200     05  WS-PI-WARNING4-WS           PIC X(1)      VALUE 'N'.     11520000
115300         88  NO-PI-WARNING4                        VALUE 'N'.     11530000
115400         88  PI-WARNING4-EXISTS                    VALUE 'Y'.     11540000
115500     05  WS-PI-WARNING5-WS           PIC X(1)      VALUE 'N'.     11550000
115600         88  NO-PI-WARNING5                        VALUE 'N'.     11560000
115700         88  PI-WARNING5-EXISTS                    VALUE 'Y'.     11570000
115800     05  WS-PI-WARNING6-WS           PIC X(1)      VALUE 'N'.     11580000
115900         88  NO-PI-WARNING6                        VALUE 'N'.     11590000
116000         88  PI-WARNING6-EXISTS                    VALUE 'Y'.     11600000
116100     05  END-OF-EDIIN-SW             PIC X(1)      VALUE 'N'.     11610000
116200         88  END-OF-EDIIN                          VALUE 'Y'.     11620000
116300     05  END-OF-EDIIN-56-SW          PIC X(1)      VALUE 'N'.     11630000
116400         88  END-OF-EDIIN-56                       VALUE 'Y'.     11640000
116500     05  END-OF-EDIIN-56-COM-SW      PIC X(1)      VALUE 'N'.     11650000
116600         88  END-OF-EDIIN-56-COMBIN                VALUE 'Y'.     11660000
116700     05  PO-TABLE-FULL-SW            PIC X(1)      VALUE 'N'.     11670000
116800         88  PO-TABLE-FULL                         VALUE 'Y'.     11680000
116900     05  DUPLICATE-PO-INV-SW         PIC X(1)      VALUE 'N'.     11690000
117000         88  DUPLICATE-PO-INV                      VALUE 'Y'.     11700000
117100         88  NOT-DUPLICATE-PO-INV                  VALUE 'N'.     11710000
117200     05  DUPLICATE-VND-INV-SW        PIC X(1)      VALUE 'N'.     11720000
117300         88  DUPLICATE-VND-INV                     VALUE 'Y'.     11730000
117400         88  NOT-DUPLICATE-VND-INV                 VALUE 'N'.     11740000
117500     05  PS-DUPLICATE-VND-INV-SW     PIC X(1)      VALUE 'N'.     11750000
117600         88  PS-DUPLICATE-VND-INV                  VALUE 'Y'.     11760000
117700         88  PS-NOT-DUPLICATE-VND-INV              VALUE 'N'.     11770000
117800     05  INPUT-INVOICE-FOUND-SQ      PIC X(1)      VALUE 'N'.     11780000
117900         88  INPUT-INVOICE-FOUND                   VALUE 'Y'.     11790000
118000         88  INPUT-INVOICE-NOT-FOUND               VALUE 'N'.     11800000
118100     05  DO-NOT-USE-SUFFIX-SW        PIC X(1)      VALUE 'N'.     11810000
118200         88  USE-SUFFIX-INVC                       VALUE 'Y'.     11820000
118300         88  DO-NOT-USE-SUFFIX-INVC                VALUE 'N'.     11830000
118400     05  RECYCLE-COMBIN-SW           PIC X(1)      VALUE 'N'.     11840000
118500         88  RECYCLE-COMBIN                        VALUE 'Y'.     11850000
118600         88  NOT-RECYCLE-COMBIN                    VALUE 'N'.     11860000
118700     05  VALID-TRADE-PART-SW         PIC X(1)      VALUE ' '.     11870000
118800         88  VALID-TRADE-PART                      VALUE 'Y'.     11880000
118900         88  NOT-VALID-TRADE-PART                  VALUE 'N'.     11890000
119000     05  PO-ALLW-DATA-SW             PIC X(1)      VALUE ' '.     11900000
119100         88  PO-ALLW-DATA-EXISTS                   VALUE 'Y'.     11910000
119200         88  NO-PO-ALLW-DATA-EXISTS                VALUE 'N'.     11920000
119300     05  PO-PAYTRM-EXIST-SW          PIC X(1)      VALUE ' '.     11930000
119400         88  PO-PAYTRM-EXISTS                      VALUE 'Y'.     11940000
119500         88  PO-PAYTRM-NOT-EXIST                   VALUE 'N'.     11950000
119600     05  PO-DSCRPNCY-SW              PIC X(1)      VALUE 'N'.     11960000
119700         88  PO-DSCRPNCY                           VALUE 'Y'.     11970000
119800         88  NO-PO-DSCRPNCY                        VALUE 'N'.     11980000
119900     05  ERR-DETAIL-SUM-GROSS-SW     PIC X(1)      VALUE 'N'.     11990000
120000         88  ERR-DETAIL-GROSS-INVOICE              VALUE 'Y'.     12000000
120100         88  NO-ERR-DETAIL-GROSS-INVOICE           VALUE 'N'.     12010000
120200     05  VALID-DUNS-NUMBER-SW        PIC X(1)      VALUE ' '.     12020000
120300         88  WS-VALID-DUNS                         VALUE 'Y'.     12030000
120400         88  WS-NOT-VALID-DUNS                     VALUE 'N'.     12040000
120500     05  VALID-STORE1-NUMBER-SW      PIC X(1)      VALUE ' '.     12050000
120600         88  WS-VALID-STORE1-DS                    VALUE 'Y'.     12060000
120700         88  WS-VALID-STORE1-CS                    VALUE 'W'.     12070000
120800         88  WS-VALID-DC1                          VALUE 'X'.     12080000
120900         88  WS-VALID-PO1                          VALUE 'Z'.     12090000
121000         88  WS-NOT-VALID-STORE1                   VALUE 'N'.     12100000
121100     05  VALID-STORE2-NUMBER-SW      PIC X(1)      VALUE ' '.     12110000
121200         88  WS-VALID-STORE2-DS                    VALUE 'Y'.     12120000
121300         88  WS-VALID-STORE2-CS                    VALUE 'W'.     12130000
121400         88  WS-VALID-DC2                          VALUE 'X'.     12140000
121500         88  WS-VALID-PO2                          VALUE 'Z'.     12150000
121600         88  WS-NOT-VALID-STORE2                   VALUE 'N'.     12160000
121700     05  VALID-UPC-CODE-SW           PIC X(1)      VALUE ' '.     12170000
121800         88  WS-VALID-UPC                          VALUE 'Y'.     12180000
121900         88  WS-NOT-VALID-UPC                      VALUE 'N'.     12190000
122000     05  VALID-DC-NBR-SW             PIC X(1)      VALUE ' '.     12200000
122100         88  WS-VALID-DC                           VALUE 'Y'.     12210000
122200         88  WS-NOT-VALID-DC                       VALUE 'N'.     12220000
122300     05  WS-DATE-INVALID             PIC  X(1)     VALUE SPACE.   12230000
122400         88  WS-VALID-DATE                         VALUE 'Y'.     12240000
122500         88  WS-NOT-VALID-DATE                     VALUE 'N'.     12250000
122600     05  WS-PO-NBR-VALID             PIC  X(1)     VALUE SPACE.   12260000
122700         88  WS-VALID-PO-NBR                       VALUE 'Y'.     12270000
122800         88  WS-NOT-VALID-PO-NBR                   VALUE 'N'.     12280000
122900     05  WS-CHRG-OVER-LIMIT-SW       PIC X(1)      VALUE 'N'.     12290000
123000         88  CHRG-OVER-LIMIT                       VALUE 'Y'.     12300000
123100         88  NOT-CHRG-OVER-LIMIT                   VALUE 'N'.     12310000
123200     05  WS-USE-PO-TERMS-SW          PIC X(1)      VALUE 'N'.     12320000
123300         88  USE-PO-TERMS                          VALUE 'Y'.     12330000
123400         88  DONT-USE-PO-TERMS                     VALUE 'N'.     12340000
123500     05  WS-USE-INVC-TERMS-SW        PIC X(1)      VALUE 'N'.     12350000
123600         88  USE-INVC-TERMS                        VALUE 'Y'.     12360000
123700         88  DONT-USE-INVC-TERMS                   VALUE 'N'.     12370000
123800     05  WS-EOM-TERMS-FOUND-SW       PIC X(1)      VALUE 'N'.     12380000
123900         88  EOM-TERMS-FOUND                       VALUE 'Y'.     12390000
124000         88  NO-EOM-TERMS-FOUND                    VALUE 'N'.     12400000
124100     05  WS-ALLOWANCE-END-OF-CSR     PIC X(1)      VALUE 'N'.     12410000
124200         88  ALLOWANCE-EOC                         VALUE 'Y'.     12420000
124300         88  NOT-ALLOWANCE-EOC                     VALUE 'N'.     12430000
124400     05  WS-ALLOWANCE-CODE-SW        PIC X(1)      VALUE 'N'.     12440000
124500         88  ALLOW-CODE-FOUND                      VALUE 'Y'.     12450000
124600         88  ALLOW-CODE-NOT-FOUND                  VALUE 'N'.     12460000
124700     05  WS-LI-FUNG-PREPACK-SW       PIC X(1)      VALUE 'N'.     12470000
124800         88  LI-FUNG-PREPACK-FOUND                 VALUE 'Y'.     12480000
124900         88  LI-FUNG-PREPACK-NOT-FOUND             VALUE 'N'.     12490000
125000     05  WS-TOO-INVC-LINES-SW        PIC X(1)      VALUE 'N'.     12500000
125100         88  TOO-MANY-INVC-LINES                   VALUE 'Y'.     12510000
125200         88  NOT-TOO-MANY-INVC-LINES               VALUE 'N'.     12520000
125300     05  WS-FIRST-07-REC-WRITTEN-SW  PIC X(1)      VALUE 'N'.     12530000
125400         88  FIRST-07-REC-WRITTEN                  VALUE 'Y'.     12540000
125500         88  FIRST-07-REC-NOT-WRITTEN              VALUE 'N'.     12550000
125600                                                                  12560000
125700 01  TBL-ALLOWANCE-TABLE-AREA.                                    12570000
125800     05 TBL-ALLOWANCE-TABLE OCCURS 10 TIMES INDEXED BY ALLOW-INDX.12580000
125900         10  TBL-ALLOWANCE-NBR.                                   12590000
126000             15  TBL-ALLOWANCE-CDE   PIC X(03)    VALUE SPACES.   12600000
126100             15  TBL-ALLOWANCE-PCT   PIC S999V99  COMP-3 VALUE 0. 12610000
126200             15  TBL-ALLOWANCE-AMT   PIC S9(08)V9(02)    VALUE 0. 12620000
126300             15  TBL-ALLOW-SRC-IND   PIC X(1)     VALUE SPACES.   12630000
126400                                                                  12640000
126500*----------------------------------------------------------------*12650000
126600*  IMPORTANT NOTE:  THE NUMBER OF OCCURS ON THE PO-INV-TABLE     *12660000
126700*  AND THE DUN-INV-TABLE MUST BE KEPT THE SAME.  THE PROGRAM     *12670000
126800*  LOGIC USES THE SAME WORKING STORAGE FIELD FOR THE MAX NUMBER  *12680000
126900*  OF ENTRIES: PC-COMBIN-TBL-MAX.  THIS VALUE FOR THIS FIELD     *12690000
127000*  MUST ALSO BE KEPT IN SYNC.                                    *12700000
127100*----------------------------------------------------------------*12710000
127200 01  WS-PO-INV-TABLE-AREA.                                        12720000
127300     05  WS-PO-INV-TABLE OCCURS 800000 TIMES INDEXED BY PO-INDX.  12730021
127400         10  WS-PO-INV-NBR           PIC X(31).                   12740000
127500         10  WS-PO-INV-FLAG          PIC X(1).                    12750000
127600                                                                  12760000
127700 01  WS-DUN-INV-TABLE-AREA.                                       12770000
127800     05 WS-DUN-INV-TABLE OCCURS 800000 TIMES INDEXED BY DUN-INDX. 12780021
127900         10  WS-DUN-INV-NBR.                                      12790000
128000             15  WS-VENDOR-DUN-NBR   PIC X(09).                   12800000
128100             15  WS-VENDOR-INV-NBR   PIC X(22).                   12810000
128200                                                                  12820000
128300 01  WS-TABLE-AREA.                                               12830000
128400     05  WS-INVOICE-TABLE OCCURS 11000 TIMES INDEXED BY INV-INDX. 12840000
128500         10  WS-INV-REC.                                          12850000
128600             15  WS-AP052-KEY-AREA.                               12860000
128700                 20  WS-AP052-PO-NBR         PIC X(09).           12870000
128800                 20  WS-AP052-INV-NBR        PIC X(22).           12880000
128900                 20  WS-AP052-REC-TYPE       PIC X(02).           12890000
129000                 20  WS-AP052-FILLER1        PIC X(01).           12900000
129100                 20  WS-AP052-EDI-SEQ        PIC X(05).           12910000
129200                 20  WS-AP052-SORT-MTCH-LVL  PIC X(01).           12920000
129300                 20  WS-AP052-SORT-LOC       PIC X(05).           12930000
129400                 20  WS-AP052-FILLER2        PIC X(05).           12940000
129500             15  WS-AP052-DATA-AREA          PIC X(300).          12950000
129600         10  WS-INV-ERR-TBL-AREA.                                 12960000
129700             15  WS-INV-ERR-TBL  OCCURS 25 TIMES                  12970000
129800                                 INDEXED BY REJ-INDX.             12980000
129900                 20  WS-INV-ERR-CD       PIC 9(2).                12990000
130000                                                                  13000000
130100 01  WS-LOCATION-TABLE-AREA.                                      13010000
130200     05 WS-LOCATION-TABLE OCCURS 1500 TIMES INDEXED BY LOC-INDX.  13020000
130300        10  WS-STORE-NBR        PIC X(05).                        13030000
130400        10  WS-STORE-TYP-CDE    PIC X(2).                         13040000
130500                                                                  13050000
130600 01  WS-TERMS-REC.                                                13060000
130700     05  WS-TERMS-EXTD-DAYS-QTY          PIC S9(4) COMP           13070000
130800                                                    VALUE ZEROS.  13080000
130900     05  WS-TERMS-DISC-PCT               PIC S9(03)V9(02)         13090000
131000                                                    VALUE ZEROS.  13100000
131100     05  WS-TERMS-DISC-DAYS-DUE          PIC 9(03)  VALUE ZEROS.  13110000
131200     05  WS-TERMS-NET-DEFRD-DAYS-DUE     PIC 9(03)  VALUE ZEROS.  13120000
131300     05  WS-TERMS-PCT-PAYABLE            PIC S9(03)V9(02)         13130000
131400                                                    VALUE ZEROS.  13140000
131500 01  PV-ONE                              PIC X(1)   VALUE SPACES. 13150000
131600 01  PC-PERCENTS                         PIC X(22)  VALUE ALL '%'.13160000
131700 01  PV-TOTAL-DAYS-QTY                   PIC 9(04)  VALUE ZEROS.  13170000
131800 01  PV-COMPARE-DAYS-QTY                 PIC 9(04)  VALUE ZEROS.  13180000
131900 01  PV-QUANTITY-INVOICED                PIC S9(06)V VALUE ZEROS. 13190000
132000 01  PV-STORE-DIGITS                     PIC X(5)   VALUE ZERO.   13200000
132100 01  PV-CURRENT-DATE.                                             13210000
132200     05  PV-CURRENT-CENT                 PIC X(02)  VALUE SPACES. 13220000
132300     05  PV-CURRENT-YEAR                 PIC X(02)  VALUE SPACES. 13230000
132400     05  FILLER                          PIC X(1)   VALUE '-'.    13240000
132500     05  PV-CURRENT-MONTH                PIC X(02)  VALUE SPACES. 13250000
132600     05  FILLER                          PIC X(1)   VALUE '-'.    13260000
132700     05  PV-CURRENT-DAY                  PIC X(02)  VALUE SPACES. 13270000
132800                                                                  13280000
132900 01  PV-SUFFIX-DATE.                                              13290000
133000     05  PV-SUFFIX-MONTH                 PIC X(02)  VALUE SPACES. 13300000
133100     05  PV-SUFFIX-DAY                   PIC X(02)  VALUE SPACES. 13310000
133200     05  PV-SUFFIX-YEAR                  PIC X(02)  VALUE SPACES. 13320000
133300                                                                  13330000
133400 01 PV-ACCUMULATORS.                                              13340000
133500     05  PV-ACCUM-CHRG                PIC S999V99  VALUE ZERO.    13350000
133600     05  PV-ACCUM-ALLW                PIC S999V99  VALUE ZERO.    13360000
133700                                                                  13370000
133800 01 PV-ACCUMULATORS-PCT.                                          13380000
133900     05  PV-ACCUM-CHRG-PCT            PIC S99V9999  COMP-3.       13390000
134000     05  PV-ACCUM-ALLW-PCT            PIC S99V9999  COMP-3.       13400000
134100                                                                  13410000
134200 01 HOLD-FIELDS.                                                  13420000
134300     05  HOLD-ALLOWANCE-CDE           PIC X(03).                  13430000
134400     05  HOLD-ALLOW-INDX              PIC 9(02).                  13440000
134500     05  DISPLAY-INDX                 PIC 9(02).                  13450000
134600                                                                  13460000
134700*--------------------------------------------------------------*  13470000
134800* THIS COPYBOOK CONTAINS VENDORS FOR WHICH PO TERMS WILL       *  13480000
134900* ALWAYS BE TAKEN                                              *  13490000
135000*--------------------------------------------------------------*  13500000
135100     COPY APWS009.                                                13510000
135200                                                                  13520000
135300 01  RUN-TIME                            PIC 9(8).                13530000
135400 01  DATE-IN                             PIC X(6).                13540000
135500 01  WS-JULIAN-CYD.                                               13550000
135600     05 WS-JULIAN-CC                     PIC 9(02)  VALUE ZEROS.  13560000
135700     05 WS-JULIAN-YYDDD.                                          13570000
135800        10 WS-JULIAN-YY                  PIC 9(02)  VALUE ZEROS.  13580000
135900        10 WS-JULIAN-DDD                 PIC 9(03)  VALUE ZEROS.  13590000
136000 01  WS-JULIAN-CCYYDDD   REDEFINES WS-JULIAN-CYD PIC 9(07).       13600000
136100                                                                  13610000
136200*--------------------------------------------------------------*  13620000
136300* NEW EDI INVOICE INPUT LAYOUT                                 *  13630000
136400*--------------------------------------------------------------*  13640000
136500 01  FILLER                      PIC X(35)  VALUE                 13650000
136600     'BEGINNING OF AP050 INPUT FILE    **'.                       13660000
136700 01  AP050-EDI-IN-FILE.                                           13670000
136800     COPY APRD050.                                                13680000
136900                                                                  13690000
137000*--------------------------------------------------------------*  13700000
137100* RECYCLED EDI INVOICE INPUT LAYOUT                            *  13710000
137200*--------------------------------------------------------------*  13720000
137300 01  FILLER                      PIC X(35)  VALUE                 13730000
137400     'BEGINNING OF AP056 INPUT FILE    **'.                       13740000
137500 01  AP056-EDI-IN-FILE.                                           13750000
137600     COPY APRD056.                                                13760000
137700                                                                  13770000
137800*--------------------------------------------------------------*  13780000
137900* RECYCLED EDI INVOICE OUTPUT LAYOUT                           *  13790000
138000*--------------------------------------------------------------*  13800000
138100 01  AP056-EDI-OUT.                                               13810000
138200     COPY APRD056.                                                13820000
138300                                                                  13830000
138400*--------------------------------------------------------------*  13840000
138500* REJECTED EDI INVOICE OUTPUT LAYOUT                           *  13850000
138600*--------------------------------------------------------------*  13860000
138700 01  FILLER                      PIC X(35)  VALUE                 13870000
138800     'BEGINNING OF REJECT  RECORD AREA **'.                       13880000
138900 01  WS-REJCONS-REC.                                              13890000
139000     COPY APRD051.                                                13900000
139100                                                                  13910000
139200*--------------------------------------------------------------*  13920000
139300* EDITED AND VALIDATED EDI INVOICE OUTPUT LAYOUT               *  13930000
139400*--------------------------------------------------------------*  13940000
139500 01  FILLER                      PIC X(35)  VALUE                 13950000
139600     'BEGINNING OF AP WORK RECORD AREA **'.                       13960000
139700 01  WS-WORK-REC.                                                 13970000
139800     COPY APRD052.                                                13980000
139900                                                                  13990000
140000 01  FILLER                      PIC X(35)  VALUE                 14000000
140100     'END OF AP WORK RECORD AREA       **'.                       14010000
140200                                                                  14020000
140300*--------------------------------------------------------------*  14030000
140400* EDI INVOICE EDIT CODES AND MESSAGES                          *  14040000
140500*--------------------------------------------------------------*  14050000
140600 01  FILLER                      PIC X(35)  VALUE                 14060000
140700     'BEGIN OF APWS050 EDIT CODE FILE ***'.                       14070000
140800 01  WS-EDIT-CODES.                                               14080000
140900     COPY APWS050.                                                14090000
141000                                                                  14100000
141100*--------------------------------------------------------------*  14110000
141200* SQLCA FORMATTED MESSAGE AREA                                 *  14120000
141300*--------------------------------------------------------------*  14130000
141400     COPY DPWS004.                                                14140000
141500                                                                  14150000
141600*--------------------------------------------------------------*  14160000
141700* COMMUNICATIONS AREA2 FOR DB2                                 *  14170000
141800*--------------------------------------------------------------*  14180000
141900     COPY SQLCA2.                                                 14190000
142000                                                                  14200000
142100     EXEC SQL                                                     14210000
142200          INCLUDE SQLCA                                           14220000
142300     END-EXEC.                                                    14230000
142400                                                                  14240000
142500*--------------------------------------------------------------*  14250000
142600* AP CONTROL TABLE                                             *  14260000
142700*--------------------------------------------------------------*  14270000
142800     EXEC SQL                                                     14280000
142900          INCLUDE TAPCNTL                                         14290000
143000     END-EXEC.                                                    14300000
143100                                                                  14310000
143200*--------------------------------------------------------------*  14320000
143300* EXTERNAL ENTITY NAME TABLE                                   *  14330000
143400*--------------------------------------------------------------*  14340000
143500     EXEC SQL                                                     14350000
143600          INCLUDE TENTNME                                         14360000
143700     END-EXEC.                                                    14370000
143800                                                                  14380000
143900*--------------------------------------------------------------*  14390000
144000* EXTERNAL ENTITY TABLE                                        *  14400000
144100*--------------------------------------------------------------*  14410000
144200     EXEC SQL                                                     14420000
144300          INCLUDE TEXTENT                                         14430000
144400     END-EXEC.                                                    14440000
144500                                                                  14450000
144600*--------------------------------------------------------------*  14460000
144700* AP INVOICE TABLE                                             *  14470000
144800*--------------------------------------------------------------*  14480000
144900     EXEC SQL                                                     14490000
145000          INCLUDE TINVOIC                                         14500000
145100     END-EXEC.                                                    14510000
145200                                                                  14520000
145300*--------------------------------------------------------------*  14530000
145400* PAYMENT TERMS TABLE                                          *  14540000
145500*--------------------------------------------------------------*  14550000
145600     EXEC SQL                                                     14560000
145700          INCLUDE TPAYTRM                                         14570000
145800     END-EXEC.                                                    14580000
145900                                                                  14590000
146000*--------------------------------------------------------------*  14600000
146100* PO PLAN SHIPMENT TABLE                                       *  14610000
146200*--------------------------------------------------------------*  14620000
146300     EXEC SQL                                                     14630000
146400          INCLUDE TPLNSHP                                         14640000
146500     END-EXEC.                                                    14650000
146600                                                                  14660000
146700*--------------------------------------------------------------*  14670000
146800* PO AGREEMENT TABLE                                           *  14680000
146900*--------------------------------------------------------------*  14690000
147000     EXEC SQL                                                     14700000
147100          INCLUDE TPOAGMT                                         14710000
147200     END-EXEC.                                                    14720000
147300                                                                  14730000
147400*--------------------------------------------------------------*  14740000
147500* PURCHASE ORDER TABLE                                         *  14750000
147600*--------------------------------------------------------------*  14760000
147700     EXEC SQL                                                     14770000
147800          INCLUDE TPURCHS                                         14780000
147900     END-EXEC.                                                    14790000
148000                                                                  14800000
148100*--------------------------------------------------------------*  14810000
148200* PURCHASE ORDER ITEM TABLE                                    *  14820000
148300*--------------------------------------------------------------*  14830000
148400     EXEC SQL                                                     14840000
148500          INCLUDE TPURITM                                         14850000
148600     END-EXEC.                                                    14860000
148700                                                                  14870000
148800*--------------------------------------------------------------*  14880000
148900* LOCATION TABLE                                               *  14890000
149000*--------------------------------------------------------------*  14900000
149100     EXEC SQL                                                     14910000
149200          INCLUDE XFT00017                                        14920000
149300     END-EXEC.                                                    14930000
149400                                                                  14940000
149500*--------------------------------------------------------------*  14950000
149600* LOCATION ASSIGNMENT TABLE                                    *  14960000
149700*--------------------------------------------------------------*  14970000
149800     EXEC SQL                                                     14980000
149900          INCLUDE XFT00018                                        14990000
150000     END-EXEC.                                                    15000000
150100                                                                  15010000
150200*--------------------------------------------------------------*  15020000
150300* TRADING PARTNER TABLE                                        *  15030000
150400*--------------------------------------------------------------*  15040000
150500     EXEC SQL                                                     15050000
150600          INCLUDE TTRDPRT                                         15060000
150700     END-EXEC.                                                    15070000
150800                                                                  15080000
150900*--------------------------------------------------------------*  15090000
151000* TRADING PARTNER TRANSACTION TABLE                            *  15100000
151100*--------------------------------------------------------------*  15110000
151200     EXEC SQL                                                     15120000
151300          INCLUDE TTRDTRN                                         15130000
151400     END-EXEC.                                                    15140000
151500                                                                  15150000
151600*--------------------------------------------------------------*  15160000
151700* UPC/SKU RELATIONSHIP TABLE                                   *  15170000
151800*--------------------------------------------------------------*  15180000
151900     EXEC SQL                                                     15190000
152000          INCLUDE TUPCSKU                                         15200000
152100     END-EXEC.                                                    15210000
152200                                                                  15220000
152300*--------------------------------------------------------------*  15230000
152400* DB2 AREA FOR SYSDUMMY1                                       *  15240000
152500*--------------------------------------------------------------*  15250000
152600     EXEC SQL                                                     15260000
152700          INCLUDE SYSDUMMY                                        15270000
152800     END-EXEC.                                                    15280000
152900                                                                  15290000
153000*--------------------------------------------------------------*  15300000
153100* TRADING PARTNER CURSOR: RETURNS THE ACTIVE ENTITY ID FOR THE *  15310000
153200* TRADING PARTNER INTERCHANGE ID ON THE INCOMING INVOICES.     *  15320000
153300*--------------------------------------------------------------*  15330000
153400     EXEC SQL                                                     15340000
153500        DECLARE TRDPRT_CSR CURSOR FOR                             15350000
153600          SELECT C.PROD_TEST_IND                                  15360000
153700            FROM TTRDPRT A                                        15370000
153800               , TTRDPRT B                                        15380000
153900               , TTRDTRN C                                        15390000
154000           WHERE A.VEND_INCHG_ID = :TRDPRT-VEND-INCHG-ID          15400000
154100             AND A.VEND_INCHG_ID_DESC = :TRDPRT-VEND-INCHG-ID-DESC15410000
154200             AND A.ENT_ID       = B.ENT_ID                        15420000
154300             AND B.TP_DKEY      = C.TP_DKEY                       15430000
154400             AND A.ACTV_DTE    <= CURRENT DATE                    15440000
154500             AND A.INACTV_DTE   = '9999-09-09'                    15450000
154600             AND B.ACTV_DTE    <= CURRENT DATE                    15460000
154700             AND B.INACTV_DTE   = '9999-09-09'                    15470000
154800             AND C.ACTV_DTE    <= CURRENT DATE                    15480000
154900             AND C.INACTV_DTE   = '9999-09-09'                    15490000
155000             AND C.TRAN_SET_CDE = '824'                           15500000
155100           ORDER BY C.PROD_TEST_IND                               15510000
155200     END-EXEC.                                                    15520000
155300                                                                  15530000
155400*--------------------------------------------------------------*  15540000
155500* POAGMT CURSOR: RETURNS THE DISCOUNTS ASSOCIATED WITH A       *  15550000
155600* PURCHASE ORDER BASED ON AGREEMENT TYPE ID AND TYPE CODE.     *  15560000
155700*--------------------------------------------------------------*  15570000
155800     EXEC SQL                                                     15580000
155900          DECLARE ALLOWANCE_CSR CURSOR FOR                        15590000
156000            SELECT B.TYP_CDE                                      15600000
156100                 , B.DISC_PCT                                     15610000
156200            FROM TPOAGMT B                                        15620000
156300            WHERE B.PO_NBR         = :WS-SAVE-PO-NBR-COMP         15630000
156400              AND B.AGRMT_TYP_ID   = '5'                          15640000
156500              AND B.VER_STATUS_CDE = 'A'                          15650000
156600              AND B.DISC_PCT       > 0                            15660000
156700              AND B.TYP_CDE IN (1,7,8,9,10,11)                    15670000
156800     END-EXEC.                                                    15680000
156900                                                                  15690000
157000*-------------------------------------------------------------*   15700000
157100* MATCH LEVEL CURSOR: RETURNS THE MATCH LEVEL CODE FROM THE   *   15710000
157200* UNPROCESSED AND UN-DELETED INVOICES THAT ALREADY EXIST IN   *   15720000
157300* THE DATABASE FOR THIS PO TO DETERMINE WHETHER THERE IS A    *   15730000
157400* BULK/STORE/DC CONFLICT WITH THE INVOICE BEING EDITED.       *   15740000
157500*-------------------------------------------------------------*   15750000
157600     EXEC SQL                                                     15760000
157700          DECLARE MTCH_LVL_CSR CURSOR FOR                         15770000
157800            SELECT MTCH_LVL_CDE                                   15780000
157900            FROM TINVOIC                                          15790000
158000            WHERE PO_NBR       = :WS-SAVE-PO-NBR-COMP             15800000
158100              AND STATUS_CDE   NOT IN ('DE', 'PD', 'OP')          15810000
158200              AND INVC_TYP_CDE NOT IN ('EI')                      15820000
158300            FOR FETCH ONLY                                        15830000
158400     END-EXEC.                                                    15840000
158500                                                                  15850000
158600*--------------------------------------------------------------*  15860000
158700* LOCATION CURSOR: RETURNS THE LOCATION NUMBERS AND THEIR TYPE *  15870000
158800* CODES FROM THE DOMAIN LOCATION TABLES TO ALLOW VALIDATION OF *  15880000
158900* STORE NUMBERS ON THE INCOMING INVOICES.                      *  15890000
159000*--------------------------------------------------------------*  15900000
159100     EXEC SQL                                                     15910000
159200          DECLARE LOCATION_CSR CURSOR FOR                         15920000
159300            SELECT DIGITS(LOC_NBR)                                15930000
159400                 , LOC_TYP_CDE                                    15940000
159500              FROM XFT_LOC                                        15950000
159600             WHERE LOC_TYP_CDE IN ('CS','DS','DC','DE','NA')      15960000
159700               AND CURRENT DATE <= FINCL_CLO_DTE                  15970000
159800     END-EXEC.                                                    15980000
159900                                                                  15990000
160000 01  FILLER                        PIC X(25) VALUE                16000000
160100          '<====WS FOR APKED201 ENDS'.                            16010000
160200                                                                  16020000
160300                                                                  16030000
160400*-----------------------------*                                   16040000
160500 PROCEDURE DIVISION.                                              16050000
160600*-----------------------------*                                   16060000
160700 A100-MAINLINE.                                                   16070000
160800                                                                  16080000
160900     PERFORM H100-HOUSEKEEPING.                                   16090000
161000                                                                  16100000
161100     PERFORM R125-READ-AP056-COMBIN.                              16110000
161200     IF   END-OF-EDIIN-56-COMBIN                                  16120000
161300          CONTINUE                                                16130000
161400     ELSE                                                         16140000
161500        MOVE AP056-RECYCLE-KEY OF AP056-EDI-IN-FILE TO            16150000
161600                                         WS-SAVE-RECYCLE-KEY      16160000
161700        MOVE AP056-VENDOR-INVOICE-NBR OF AP056-EDI-IN-FILE TO     16170000
161800                                         WS-SAVE-INVOICE-NBR      16180000
161900        MOVE AP056-EDI-SEQ-NBR OF AP056-EDI-IN-FILE TO            16190000
162000                                         WS-SAVE-EDI-SEQ-NBR      16200000
162100        MOVE AP056-KOHLS-PO-NBR OF AP056-EDI-IN-FILE TO           16210000
162200                                         WS-SAVE-PO-NBR           16220000
162300                                         WS-SAVE-PO-NBR-COMP      16230000
162400                                                                  16240000
162500           IF AP056-RECORD-TYPE-IND OF AP056-EDI-IN-FILE = '01'   16250000
162600               MOVE AP056-INTRCHG-CNTL-NBR OF AP056-EDI-IN-FILE   16260000
162700                                TO WS-SAVE-INTERCHG-CNTL-NBR      16270000
162800           ELSE                                                   16280000
162900               MOVE 'NO TYPE 1' TO WS-SAVE-INTERCHG-CNTL-NBR      16290000
163000           END-IF                                                 16300000
163100                                                                  16310000
163200        PERFORM B200-PROCESSING UNTIL END-OF-EDIIN-56-COMBIN      16320000
163300        SET NO-EDI-ERROR                                          16330000
163400            NO-PI-WARNING1                                        16340000
163500            NO-PI-WARNING2                                        16350000
163600            NO-PI-WARNING4                                        16360000
163700            NO-PI-WARNING5                                        16370000
163800            NO-PI-WARNING6 TO TRUE                                16380000
163900        PERFORM E100-EDIT-CHECKS                                  16390000
164000        IF ERROR-EDI                                              16400000
164100           PERFORM W300-WRITE-REJECT                              16410000
164200        ELSE                                                      16420000
164300           IF PI-WARNING1-EXISTS OR                               16430000
164400              PI-WARNING2-EXISTS OR                               16440000
164500              PI-WARNING4-EXISTS OR                               16450000
164600              PI-WARNING5-EXISTS OR                               16460000
164700              PI-WARNING6-EXISTS                                  16470000
164800              PERFORM W300-WRITE-REJECT                           16480000
164900           END-IF                                                 16490000
165000           IF RECYCLE-COMBIN                                      16500000
165100              ADD 1 TO WS-SAVE-RECYCLE-CNT                        16510000
165200              MOVE WS-SAVE-RECYCLE-KEY TO                         16520000
165300                      AP056-RECYCLE-KEY OF AP056-EDI-OUT          16530000
165400              PERFORM W600-WRITE-RECYCLE-COMBIN                   16540000
165500           ELSE                                                   16550000
165600*             PERFORM S700-SELECT-TPAYTRM                         16560000
165700              PERFORM W100-WRITE-EDI                              16570000
165800           END-IF                                                 16580000
165900        END-IF                                                    16590000
166000     END-IF.                                                      16600000
166100                                                                  16610000
166200     INITIALIZE DCLTENTNME                                        16620000
166300                DCLTEXTENT                                        16630000
166400                DCLTINVOIC                                        16640000
166500                DCLTPAYTRM                                        16650000
166600                DCLTPLNSHP                                        16660000
166700                DCLTPOAGMT                                        16670000
166800                DCLTPURCHS                                        16680000
166900                DCLTPURITM                                        16690000
167000                DCLXFT00017                                       16700000
167100                DCLTUPCSKU                                        16710000
167200                DCLTTRDPRT.                                       16720000
167300                                                                  16730000
167400     INITIALIZE WS-WORK-AREA                                      16740000
167500                PV-ACCUM-CHRG                                     16750000
167600                PV-ACCUM-ALLW                                     16760000
167700                PV-ACCUM-CHRG-PCT                                 16770000
167800                PV-ACCUM-ALLW-PCT.                                16780000
167900     MOVE '000000' TO WS-SAVE-INVOICE-DATE                        16790000
168000                      WS-SAVE-SHIPPED-DATE                        16800000
168100                      WS-SAVE-EFFECTIVE-DATE.                     16810000
168200     INITIALIZE    WS-INVOICE-COUNTERS.                           16820000
168300     PERFORM H200-INITIALIZE.                                     16830000
168400                                                                  16840000
168500     PERFORM R150-READ-AP050.                                     16850000
168600     IF   END-OF-EDIIN                                            16860000
168700          DISPLAY '**********************************'            16870000
168800          DISPLAY '*   EMPTY EDI INVOICE FILE       *'            16880000
168900          DISPLAY '*   PROGRAM ** = APKED201        *'            16890000
169000          DISPLAY '**********************************'            16900000
169100     ELSE                                                         16910000
169200        MOVE AP050-KOHLS-PO-NBR       TO WS-SAVE-PO-NBR           16920000
169300                                         WS-SAVE-PO-NBR-COMP      16930000
169400        MOVE AP050-VENDOR-INVOICE-NBR TO WS-SAVE-INVOICE-NBR      16940000
169500        MOVE AP050-EDI-SEQ-NBR        TO WS-SAVE-EDI-SEQ-NBR      16950000
169600        IF AP050-RECORD-TYPE-IND OF AP050-EDI-IN-FILE = '01'      16960000
169700            MOVE AP050-INTRCHG-CNTL-NBR OF AP050-EDI-IN-FILE      16970000
169800                             TO WS-SAVE-INTERCHG-CNTL-NBR         16980000
169900        ELSE                                                      16990000
170000            MOVE 'NO TYPE 1' TO WS-SAVE-INTERCHG-CNTL-NBR         17000000
170100        END-IF                                                    17010000
170200        PERFORM B300-PROCESSING                                   17020000
170300                     UNTIL END-OF-EDIIN                           17030000
170400        SET NO-EDI-ERROR                                          17040000
170500            NO-PI-WARNING1                                        17050000
170600            NO-PI-WARNING2                                        17060000
170700            NO-PI-WARNING4                                        17070000
170800            NO-PI-WARNING5                                        17080000
170900            NO-PI-WARNING6 TO TRUE                                17090000
171000        IF NOT-TOO-MANY-INVC-LINES                                17100000
171100           PERFORM E100-EDIT-CHECKS                               17110000
171200        ELSE                                                      17120000
171300           SET ERROR-EDI TO TRUE                                  17130000
171400           IF (WS-AP052-PO-NBR(1) NOT = '000000000') AND          17140000
171500              (WS-AP052-PO-NBR(1) NOT = SPACES)                   17150000
171600              MOVE WS-AP052-PO-NBR(1) TO WS-SAVE-PO-NBR-COMP      17160000
171700              SET WS-NOT-VALID-PO-NBR TO TRUE                     17170000
171800              INITIALIZE DCLTPURCHS                               17180000
171900              PERFORM R600-SELECT-TPURCHS                         17190000
172000              PERFORM R950-SELECT-TENTNME                         17200000
172100           END-IF                                                 17210000
172200        END-IF                                                    17220000
172300        IF ERROR-EDI                                              17230000
172400           PERFORM W300-WRITE-REJECT                              17240000
172500        ELSE                                                      17250000
172600           IF PI-WARNING1-EXISTS OR                               17260000
172700              PI-WARNING2-EXISTS OR                               17270000
172800              PI-WARNING4-EXISTS OR                               17280000
172900              PI-WARNING5-EXISTS OR                               17290000
173000              PI-WARNING6-EXISTS                                  17300000
173100              PERFORM W300-WRITE-REJECT                           17310000
173200           END-IF                                                 17320000
173300           IF RECYCLE-COMBIN                                      17330000
173400              INITIALIZE AP056-RECYCLE-KEY OF AP056-EDI-OUT       17340000
173500              MOVE WS-JULIAN-CCYYDDD TO                           17350000
173600                   AP056-CR-DATE OF AP056-EDI-OUT                 17360000
173700              PERFORM W600-WRITE-RECYCLE-COMBIN                   17370000
173800           ELSE                                                   17380000
173900*             PERFORM S700-SELECT-TPAYTRM                         17390000
174000              PERFORM W100-WRITE-EDI                              17400000
174100           END-IF                                                 17410000
174200        END-IF                                                    17420000
174300     END-IF.                                                      17430000
174400                                                                  17440000
174500     PERFORM Z900-END-OF-JOB.                                     17450000
174600     GOBACK.                                                      17460000
174700                                                                  17470000
174800*--------------------------------------------------------------*  17480000
174900* PROCESS EDI INVOICES, BREAK ON CHANGE IN VENDOR NUMBER       *  17490000
175000* -- THE ENTIRE INVOICE IS LOADED INTO WORKING STORAGE BECAUSE *  17500000
175100*    THERE ARE ERROR CHECKS THAT MUST VALIDATE IF THERE IS ONE *  17510000
175200*    AND ONLY ONE OF THE 01,02,AND 06 RECORD TYPES.  THE       *  17520000
175300*    INVOICE GROUP OF RECORDS SHOULD BEGIN WITH AN 01 RECORD   *  17530000
175400*    AND END WITH AT LEAST ONE 07 RECORD.                      *  17540000
175500* -- AN INVOICE NUMBER OF SPACES WILL BE ASSUMED TO BELONG     *  17550000
175600*    WITH THE INVOICE NUMBERS CURRENTLY BEING PROCESSED - AS   *  17560000
175700*    A MISSING INVOICE NUMBER IS AN EDIT ERROR.                *  17570000
175800*--------------------------------------------------------------*  17580000
175900 B200-PROCESSING.                                                 17590000
176000                                                                  17600000
176100     IF (AP056-VENDOR-INVOICE-NBR OF AP056-EDI-IN-FILE            17610000
176200                                 NOT = WS-SAVE-INVOICE-NBR) OR    17620000
176300        (AP056-VENDOR-INVOICE-NBR OF AP056-EDI-IN-FILE            17630000
176400                                     = WS-SAVE-INVOICE-NBR AND    17640000
176500         AP056-EDI-SEQ-NBR OF AP056-EDI-IN-FILE NOT =             17650000
176600                                       WS-SAVE-EDI-SEQ-NBR)       17660000
176700        IF AP056-VENDOR-INVOICE-NBR OF AP056-EDI-IN-FILE          17670000
176800                                    = SPACES                      17680000
176900           NEXT SENTENCE                                          17690000
177000        ELSE                                                      17700000
177100           SET NO-EDI-ERROR                                       17710000
177200               NO-PI-WARNING1                                     17720000
177300               NO-PI-WARNING2                                     17730000
177400               NO-PI-WARNING4                                     17740000
177500               NO-PI-WARNING5                                     17750000
177600               NO-PI-WARNING6 TO TRUE                             17760000
177700           IF NOT-TOO-MANY-INVC-LINES                             17770000
177800              PERFORM E100-EDIT-CHECKS                            17780000
177900           ELSE                                                   17790000
178000              SET ERROR-EDI TO TRUE                               17800000
178100           END-IF                                                 17810000
178200           IF ERROR-EDI                                           17820000
178300              PERFORM W300-WRITE-REJECT                           17830000
178400           ELSE                                                   17840000
178500              IF PI-WARNING1-EXISTS OR                            17850000
178600                 PI-WARNING2-EXISTS OR                            17860000
178700                 PI-WARNING4-EXISTS OR                            17870000
178800                 PI-WARNING5-EXISTS OR                            17880000
178900                 PI-WARNING6-EXISTS                               17890000
179000                 PERFORM W300-WRITE-REJECT                        17900000
179100              END-IF                                              17910000
179200              IF RECYCLE-COMBIN                                   17920000
179300                 ADD 1 TO WS-SAVE-RECYCLE-CNT                     17930000
179400                 MOVE WS-SAVE-RECYCLE-KEY TO                      17940000
179500                         AP056-RECYCLE-KEY OF AP056-EDI-OUT       17950000
179600                 PERFORM W600-WRITE-RECYCLE-COMBIN                17960000
179700              ELSE                                                17970000
179800*                PERFORM S700-SELECT-TPAYTRM                      17980000
179900                 PERFORM W100-WRITE-EDI                           17990000
180000              END-IF                                              18000000
180100           END-IF                                                 18010000
180200        END-IF                                                    18020000
180300        MOVE AP056-RECYCLE-KEY OF AP056-EDI-IN-FILE TO            18030000
180400                                    WS-SAVE-RECYCLE-KEY           18040000
180500        MOVE AP056-VENDOR-INVOICE-NBR OF AP056-EDI-IN-FILE        18050000
180600                                 TO WS-SAVE-INVOICE-NBR           18060000
180700        MOVE AP056-EDI-SEQ-NBR OF AP056-EDI-IN-FILE               18070000
180800                                 TO WS-SAVE-EDI-SEQ-NBR           18080000
180900        MOVE AP056-KOHLS-PO-NBR OF AP056-EDI-IN-FILE TO           18090000
181000                                    WS-SAVE-PO-NBR                18100000
181100                                    WS-SAVE-PO-NBR-COMP           18110000
181200        IF AP056-RECORD-TYPE-IND OF AP056-EDI-IN-FILE = '01'      18120000
181300            MOVE AP056-INTRCHG-CNTL-NBR OF AP056-EDI-IN-FILE      18130000
181400                             TO WS-SAVE-INTERCHG-CNTL-NBR         18140000
181500        ELSE                                                      18150000
181600            MOVE 'NO TYPE 1' TO WS-SAVE-INTERCHG-CNTL-NBR         18160000
181700        END-IF                                                    18170000
181800        MOVE '000000' TO WS-SAVE-INVOICE-DATE                     18180000
181900                         WS-SAVE-SHIPPED-DATE                     18190000
182000                         WS-SAVE-EFFECTIVE-DATE                   18200000
182100        MOVE  0    TO WS-DETAIL-GROSS-INVOICE-AMT                 18210000
182200                      WS-TOT-EXTEN-INVOICE-AMT                    18220000
182300                      WS-DETAIL-ALLW-AMT-NEW                      18230000
182400                      WS-DETAIL-ALLW-AMT                          18240000
182500                      WS-DETAIL-CHRG-AMT                          18250000
182600                      WS-LI-FUNG-HANGER-AMT                       18260000
182700                      WS-CD-HANDLING-AMT                          18270000
182800                      WS-MAX-CD-HANDLING-AMT                      18280000
182900                      WS-TOTAL-QTY-INVOICED                       18290000
183000                      WS-SAVE-GROSS-INVOICE-AMT                   18300000
183100                      PV-ACCUM-CHRG                               18310000
183200                      PV-ACCUM-ALLW                               18320000
183300                      PV-ACCUM-CHRG-PCT                           18330000
183400                      PV-ACCUM-ALLW-PCT                           18340000
183500        INITIALIZE    WS-INVOICE-COUNTERS                         18350000
183600        PERFORM H200-INITIALIZE                                   18360000
183700     END-IF.                                                      18370000
183800                                                                  18380000
183900***************                                                   18390000
184000* LOOK FOR MAXIMUM NUMBER OF INVOICES.  THE TABLE WILL ONLY       18400000
184100* HOLD 10998- EVEN THOUGH IT IS SET UP AT 11000 BECAUSE ONE       18410000
184200* OCCURANCE HAS TO BE HELD FOR REPORTING ON ERRORS THAT ARE       18420000
184300* FOR THE INVOICE AS A WHOLE                                      18430000
184400***************                                                   18440000
184500                                                                  18450000
184600     IF INV-INDX >= 10998                                         18460000
184700        IF NOT-TOO-MANY-INVC-LINES                                18470000
184800           DISPLAY '**********************************'           18480000
184900           DISPLAY '*   TOO MANY INVOICE LINES SENT  *'           18490000
185000           DISPLAY '*   OVER 10998 RECORDS HAVE BEEN *'           18500000
185100           DISPLAY '*   FOUND FOR INVOICE ID         *'           18510000
185200           DISPLAY '* ' WS-SAVE-INVOICE-NBR '         *'          18520000
185300           DISPLAY '*   PARAGRAPH  = B200-PROCESSING *'           18530000
185400           DISPLAY '**********************************'           18540000
185500           SET TOO-MANY-INVC-LINES TO TRUE                        18550000
185600           SET INV-INDX UP BY 1                                   18560000
185700           MOVE WS-AP052-KEY-AREA(INV-INDX - 1) TO                18570000
185800                   WS-AP052-KEY-AREA(INV-INDX)                    18580000
185900           MOVE HIGH-VALUES TO WS-AP052-REC-TYPE(INV-INDX)        18590000
186000           SET REJ-INDX TO 1                                      18600000
186100           SET MAX-INVC-LINES-CD TO TRUE                          18610000
186200           MOVE EDI-ERROR-CD TO                                   18620000
186300                WS-INV-ERR-CD(INV-INDX, REJ-INDX)                 18630000
186400        END-IF                                                    18640000
186500     ELSE                                                         18650000
186600        IF AP056-RECORD-TYPE-IND OF AP056-EDI-IN-FILE = '05'      18660000
186700          AND AP056-ALLW-CHG-TYPE OF AP056-EDI-IN-FILE = 'N'      18670000
186800           NEXT SENTENCE                                          18680000
186900        ELSE                                                      18690000
187000           SET INV-INDX UP BY 1                                   18700000
187100           MOVE AP056-EDI-IN-FILE(21:350) TO                      18710000
187200                WS-INV-REC(INV-INDX)                              18720000
187300                                                                  18730000
187400           IF AP056-RECORD-TYPE-IND OF AP056-EDI-IN-FILE = '06'   18740000
187500              MOVE AP056-GROSS-INVOICE-AMT OF AP056-EDI-IN-FILE   18750000
187600                   TO WS-SAVE-GROSS-INVOICE-AMT                   18760000
187700           END-IF                                                 18770000
187800        END-IF                                                    18780000
187900     END-IF.                                                      18790000
188000                                                                  18800000
188100     MOVE AP056-RECORD-TYPE-IND OF AP056-EDI-IN-FILE              18810000
188200                                TO WS-LAST-REC-TYPE.              18820000
188300                                                                  18830000
188400     PERFORM R125-READ-AP056-COMBIN.                              18840000
188500                                                                  18850000
188600*--------------------------------------------------------------*  18860000
188700* PROCESS EDI INVOICES, BREAK ON CHANGE IN VENDOR NUMBER       *  18870000
188800* -- THE ENTIRE INVOICE IS LOADED INTO WORKING STORAGE BECAUSE *  18880000
188900*    THERE ARE ERROR CHECKS THAT MUST VALIDATE IF THERE IS ONE *  18890000
189000*    AND ONLY ONE OF THE 01,02,AND 06 RECORD TYPES.  THE       *  18900000
189100*    INVOICE GROUP OF RECORDS SHOULD BEGIN WITH AN 01 RECORD   *  18910000
189200*    AND END WITH AT LEAST ONE 07 RECORD.                      *  18920000
189300*--------------------------------------------------------------*  18930000
189400 B300-PROCESSING.                                                 18940000
189500                                                                  18950000
189600     IF (AP050-VENDOR-INVOICE-NBR NOT = WS-SAVE-INVOICE-NBR)      18960000
189700     OR (AP050-VENDOR-INVOICE-NBR  = WS-SAVE-INVOICE-NBR          18970000
189800           AND AP050-EDI-SEQ-NBR NOT = WS-SAVE-EDI-SEQ-NBR)       18980000
189900         SET NO-EDI-ERROR                                         18990000
190000             NO-PI-WARNING1                                       19000000
190100             NO-PI-WARNING2                                       19010000
190200             NO-PI-WARNING4                                       19020000
190300             NO-PI-WARNING5                                       19030000
190400             NO-PI-WARNING6 TO TRUE                               19040000
190500         IF NOT-TOO-MANY-INVC-LINES                               19050000
190600            PERFORM E100-EDIT-CHECKS                              19060000
190700         ELSE                                                     19070000
190800            SET ERROR-EDI TO TRUE                                 19080000
190900         END-IF                                                   19090000
191000         IF ERROR-EDI                                             19100000
191100            PERFORM W300-WRITE-REJECT                             19110000
191200         ELSE                                                     19120000
191300            IF PI-WARNING1-EXISTS OR                              19130000
191400               PI-WARNING2-EXISTS OR                              19140000
191500               PI-WARNING4-EXISTS OR                              19150000
191600               PI-WARNING5-EXISTS OR                              19160000
191700               PI-WARNING6-EXISTS                                 19170000
191800               PERFORM W300-WRITE-REJECT                          19180000
191900            END-IF                                                19190000
192000            IF RECYCLE-COMBIN                                     19200000
192100               INITIALIZE AP056-RECYCLE-KEY                       19210000
192200                                   OF AP056-EDI-OUT               19220000
192300               MOVE WS-JULIAN-CCYYDDD TO                          19230000
192400                 AP056-CR-DATE OF AP056-EDI-OUT                   19240000
192500               PERFORM W600-WRITE-RECYCLE-COMBIN                  19250000
192600            ELSE                                                  19260000
192700               PERFORM W100-WRITE-EDI                             19270000
192800            END-IF                                                19280000
192900         END-IF                                                   19290000
193000         MOVE AP050-KOHLS-PO-NBR TO  WS-SAVE-PO-NBR               19300000
193100                                     WS-SAVE-PO-NBR-COMP          19310000
193200         MOVE AP050-VENDOR-INVOICE-NBR TO WS-SAVE-INVOICE-NBR     19320000
193300         MOVE AP050-EDI-SEQ-NBR  TO WS-SAVE-EDI-SEQ-NBR           19330000
193400         IF AP050-RECORD-TYPE-IND OF AP050-EDI-IN-FILE = '01'     19340000
193500             MOVE AP050-INTRCHG-CNTL-NBR OF AP050-EDI-IN-FILE     19350000
193600                              TO WS-SAVE-INTERCHG-CNTL-NBR        19360000
193700         ELSE                                                     19370000
193800             MOVE 'NO TYPE 1' TO WS-SAVE-INTERCHG-CNTL-NBR        19380000
193900         END-IF                                                   19390000
194000         MOVE '000000' TO WS-SAVE-INVOICE-DATE                    19400000
194100                          WS-SAVE-SHIPPED-DATE                    19410000
194200                          WS-SAVE-EFFECTIVE-DATE                  19420000
194300                                                                  19430000
194400         MOVE  0    TO WS-DETAIL-GROSS-INVOICE-AMT                19440000
194500                       WS-TOT-EXTEN-INVOICE-AMT                   19450000
194600                       WS-DETAIL-ALLW-AMT-NEW                     19460000
194700                       WS-DETAIL-ALLW-AMT                         19470000
194800                       WS-DETAIL-CHRG-AMT                         19480000
194900                       WS-LI-FUNG-HANGER-AMT                      19490000
195000                       WS-CD-HANDLING-AMT                         19500000
195100                       WS-MAX-CD-HANDLING-AMT                     19510000
195200                       WS-TOTAL-QTY-INVOICED                      19520000
195300                       WS-SAVE-GROSS-INVOICE-AMT                  19530000
195400                       PV-ACCUM-CHRG                              19540000
195500                       PV-ACCUM-ALLW                              19550000
195600                       PV-ACCUM-CHRG-PCT                          19560000
195700                       PV-ACCUM-ALLW-PCT                          19570000
195800         INITIALIZE    WS-INVOICE-COUNTERS                        19580000
195900         PERFORM H200-INITIALIZE                                  19590000
196000     END-IF.                                                      19600000
196100                                                                  19610000
196200***************                                                   19620000
196300*   LOOK FOR MAXIMUM NUMBER OF INVOICES.  THE TABLE WILL ONLY     19630000
196400*   HOLD 10998- EVEN THOUGH IT IS SET UP AT 11000 BECAUSE ONE     19640000
196500*   OCCURANCE HAS TO BE HELD FOR REPORTING ON ERRORS THAT ARE     19650000
196600*   FOR THE INVOICE AS A WHOLE                                    19660000
196700***************                                                   19670000
196800                                                                  19680000
196900     IF INV-INDX >= 10998                                         19690000
197000        IF NOT-TOO-MANY-INVC-LINES                                19700000
197100           DISPLAY '**********************************'           19710000
197200           DISPLAY '*   TOO MANY INVOICE LINES SENT  *'           19720000
197300           DISPLAY '*   OVER 10998 RECORDS HAVE BEEN *'           19730000
197400           DISPLAY '*   FOUND FOR INVOICE ID         *'           19740000
197500           DISPLAY '* ' WS-SAVE-INVOICE-NBR '         *'          19750000
197600           DISPLAY '*   PARAGRAPH  = B300-PROCESSING *'           19760000
197700           DISPLAY '**********************************'           19770000
197800           SET TOO-MANY-INVC-LINES TO TRUE                        19780000
197900           SET INV-INDX UP BY 1                                   19790000
198000           MOVE WS-AP052-KEY-AREA(INV-INDX - 1) TO                19800000
198100                   WS-AP052-KEY-AREA(INV-INDX)                    19810000
198200           MOVE HIGH-VALUES TO WS-AP052-REC-TYPE(INV-INDX)        19820000
198300           SET REJ-INDX TO 1                                      19830000
198400           SET MAX-INVC-LINES-CD TO TRUE                          19840000
198500           MOVE EDI-ERROR-CD TO                                   19850000
198600                WS-INV-ERR-CD(INV-INDX, REJ-INDX)                 19860000
198700        END-IF                                                    19870000
198800     ELSE                                                         19880000
198900        IF AP050-RECORD-TYPE-IND = '05' AND                       19890000
199000           AP050-ALLW-CHG-TYPE = 'N'                              19900000
199100           NEXT SENTENCE                                          19910000
199200        ELSE                                                      19920000
199300           SET INV-INDX UP BY 1                                   19930000
199400           MOVE AP050-EDI-IN-FILE TO                              19940000
199500                WS-INV-REC(INV-INDX)                              19950000
199600           IF AP050-RECORD-TYPE-IND = '06'                        19961042
199700              ADD  AP050-GROSS-INVOICE-AMT TO                     19970000
199800                            WS-SAVE-GROSS-INVOICE-AMT             19980000
199900           END-IF                                                 19990000
200000        END-IF                                                    20000000
200100     END-IF.                                                      20010000
200200                                                                  20020000
200300     MOVE AP050-RECORD-TYPE-IND TO WS-LAST-REC-TYPE.              20030000
200400     PERFORM R150-READ-AP050.                                     20040000
200500                                                                  20050000
200600*--------------------------------------------------------------*  20060000
200700* PERFORM EDIT CHECKS PER SPECIFICATIONS                       *  20070000
200800* -- THE EDIT ONE CHECK ROUTINE WILL CHECK SPECIFIC ERRORS     *  20080000
200900*    PER RECORD TYPE AND WILL KEEP ANY SUMMARIZATION TOTALS    *  20090000
201000*    AND COUNTS THAT ARE NECESSARY FOR EDITTING AFTER THE      *  20100000
201100*    ENTIRE INVOICE IS LOADED                                  *  20110000
201200* -- THE EDIT ALL ROUTINE WILL CHECK MISSING RECORD TYPES,     *  20120000
201300*    DETAIL AND SUMMARY TOTAL DISCREPENCIES, ETC.              *  20130000
201400*--------------------------------------------------------------*  20140000
201500 E100-EDIT-CHECKS.                                                20150000
201600                                                                  20160000
201700     PERFORM E200-EDIT-ONE                                        20170000
201800        VARYING INV-INDX FROM 1 BY 1                              20180000
201900        UNTIL INV-INDX > 10998 OR                                 20190000
202000           WS-AP052-KEY-AREA(INV-INDX) = HIGH-VALUES.             20200000
202100                                                                  20210000
202200***************************************************************** 20220000
202300***** AT THIS POINT THE INV-INDX IS SET TO 10998 OR TO THE        20230000
202400***** NUMBER OF INVOICE RECORDS + 1                               20240000
202500***** THE REJ-INDX IS RESET IN ORDER TO SET UP A RECORD           20250000
202600***** FOR ERRORS THAT MAY BE DETECTED IN THE NEXT ROUTINE.        20260000
202700***************************************************************** 20270000
202800                                                                  20280000
202900     SET REJ-INDX TO 1.                                           20290000
203000     SET REJ-INDX DOWN BY 1.                                      20300000
203100     PERFORM E300-EDIT-ALL.                                       20310000
203200                                                                  20320000
203300*--------------------------------------------------------------*  20330000
203400* THIS PARAGRAPH PERFORMS THE FOLLOWING EDITS:                 *  20340000
203500*  -- VERIFIES THAT THERE IS ONLY ONE OF EACH SPECIFIC RECORD  *  20350000
203600*     TYPE                                                     *  20360000
203700*  -- VERIFIES THAT ALL NECESSARY FIELDS ARE POPULATED WITH    *  20370000
203800*     DATA                                                     *  20380000
203900*  -- VERIFIES THAT DATES ARE FORMATTED CORRECTLY              *  20390000
204000*  -- VERIFIES THAT NEGATIVE NUMERIC FIELDS DO NOT EXIST       *  20400000
204100*  -- DETERMINES THE MATCH LEVEL, STORE NUMBER, AND DC NUMBER  *  20410000
204200*     FOR EACH INVOICE                                         *  20420000
204300*  -- DETERMINES THE ITEM NUMBER IF THE UPC IS VALID           *  20430000
204400*  -- RETRIEVES THE PO_LNE_NBR AND STYLE CODE IF THE UPC/SKU   *  20440000
204500*     IS NOT FOUND OR INVALID                                  *  20450000
204600*  -- VERIFIES ANY ALLOWANCE AND/OR CHARGES                    *  20460000
204700*--------------------------------------------------------------*  20470000
204800 E200-EDIT-ONE.                                                   20480000
204900                                                                  20490000
205000     MOVE WS-INV-REC(INV-INDX) TO WS-WORK-REC.                    20500000
205100     SET REJ-INDX TO 1.                                           20510000
205200     SET REJ-INDX DOWN BY 1.                                      20520000
205300                                                                  20530000
205400     INITIALIZE DCLTPURITM.                                       20540000
205500                                                                  20550000
205600*---------------------------------------------------------------  20560000
205700* RECORD TYPE VALIDATION -- VERIFIES THAT THERE IS ONLY ONE       20570000
205800* OF EACH SPECIFIC RECORD TYPE                                    20580000
205900*---------------------------------------------------------------  20590000
206000                                                                  20600000
206100     EVALUATE AP052-RECORD-TYPE-IND                               20610000
206200        WHEN '01'                                                 20620000
206300             ADD 1 TO WS-REC-01-CNT                               20630000
206400             IF WS-REC-01-CNT > 1                                 20640000
206500                IF REJ-INDX NOT = 25                              20650000
206600                   SET REJ-INDX UP BY 1                           20660000
206700                END-IF                                            20670000
206800                SET ERROR-EDI TO TRUE                             20680000
206900                SET MULT-01-REC-CD TO TRUE                        20690000
207000                MOVE EDI-ERROR-CD TO                              20700000
207100                     WS-INV-ERR-CD(INV-INDX, REJ-INDX)            20710000
207200             END-IF                                               20720000
207300        WHEN '02'                                                 20730000
207400             ADD 1 TO WS-REC-02-CNT                               20740000
207500             IF WS-REC-02-CNT > 1                                 20750000
207600                IF REJ-INDX NOT = 25                              20760000
207700                   SET REJ-INDX UP BY 1                           20770000
207800                END-IF                                            20780000
207900                SET ERROR-EDI TO TRUE                             20790000
208000                SET MULT-02-REC-CD TO TRUE                        20800000
208100                MOVE EDI-ERROR-CD TO                              20810000
208200                     WS-INV-ERR-CD(INV-INDX, REJ-INDX)            20820000
208300             ELSE                                                 20830000
208400                MOVE AP052-INVOICE-DATE TO                        20840000
208500                                   WS-SAVE-INVOICE-DATE           20850000
208600                MOVE AP052-DATE-SHIPPED TO                        20860000
208700                                   WS-SAVE-SHIPPED-DATE           20870000
208800                MOVE AP052-EFFECTIVE-DATE TO                      20880000
208900                                   WS-SAVE-EFFECTIVE-DATE         20890000
209000             END-IF                                               20900000
209100        WHEN '04'                                                 20910000
209200             ADD 1 TO WS-REC-04-CNT                               20920000
209300             IF WS-REC-04-CNT > 1                                 20930000
209400                IF REJ-INDX NOT = 25                              20940000
209500                   SET REJ-INDX UP BY 1                           20950000
209600                END-IF                                            20960000
209700                SET ERROR-EDI TO TRUE                             20970000
209800                SET MULT-04-REC-CD TO TRUE                        20980000
209900                MOVE EDI-ERROR-CD   TO                            20990000
210000                     WS-INV-ERR-CD(INV-INDX, REJ-INDX)            21000000
210100             END-IF                                               21010000
210200        WHEN '05'                                                 21020000
210300             ADD 1 TO WS-REC-05-CNT                               21030000
210400             IF AP052-ALLOWANCE                                   21040000
210500                COMPUTE WS-DETAIL-ALLW-AMT                        21050000
210600                   =    WS-DETAIL-ALLW-AMT                        21060000
210700                   +    AP052-ALLW-CHRG-TOTAL                     21070000
210800                ADD AP052-ALLW-CHRG-PCT TO PV-ACCUM-ALLW          21080000
210900             ELSE                                                 21090000
211000                IF AP052-CHARGE                                   21100000
211100                   COMPUTE WS-DETAIL-CHRG-AMT                     21110000
211200                      =    WS-DETAIL-CHRG-AMT                     21120000
211300                      +    AP052-ALLW-CHRG-TOTAL                  21130000
211400                   ADD AP052-ALLW-CHRG-PCT TO PV-ACCUM-CHRG       21140000
211500                END-IF                                            21150000
211600             END-IF                                               21160000
211700        WHEN '06'                                                 21170000
211800             ADD 1 TO WS-REC-06-CNT                               21180000
211900             IF WS-REC-06-CNT > 1                                 21190000
212000                IF REJ-INDX NOT = 25                              21200000
212100                   SET REJ-INDX UP BY 1                           21210000
212200                END-IF                                            21220000
212300                SET ERROR-EDI TO TRUE                             21230000
212400                SET MULT-06-REC-CD TO TRUE                        21240000
212500                MOVE EDI-ERROR-CD   TO                            21250000
212600                     WS-INV-ERR-CD(INV-INDX, REJ-INDX)            21260000
212700             END-IF                                               21270000
212800        WHEN '07'                                                 21280000
212900* THIS WAS REMOVED TO PREVENT THE UPC ON THE RECYCLE FILE FROM    21290000
213000* BEING INVALID.  ADDING THE LEADING ZERO IS NOW DONE ON A WORK   21300000
213100* FIELD RIGHT BEFORE THE DATABASE LOOKUP IS PERFORMED LATER IN    21310000
213200* THIS PARAGRAPH.                                                 21320000
213300*            IF AP052-UPC                                         21330000
213400*               MOVE AP052-UPC-CODE TO WS-UPC-12                  21340000
213500*               MOVE ZERO           TO WS-UPC-ZERO                21350000
213600*               MOVE WS-UPC-13      TO AP052-EAN-UPC              21360000
213700*            END-IF                                               21370000
213800             ADD 1 TO WS-REC-07-CNT                               21380000
213900             IF (AP052-IT1-UNIT-MEASURE = 'AS') AND               21390000
214000                (AP052-UPC-CANT-EXPLODE-IND = 'N')                21400000
214100                CONTINUE                                          21410000
214200             ELSE                                                 21420000
214300                INITIALIZE PV-QUANTITY-INVOICED                   21430000
214400                MOVE AP052-QUANTITY-INVOICED TO                   21440000
214500                        PV-QUANTITY-INVOICED                      21450000
214600                COMPUTE WS-CALC-EXTEN-INVOICE-AMT ROUNDED         21460000
214700                   =    PV-QUANTITY-INVOICED                      21470000
214800                   *    AP052-WHOLSALE-UNIT-COST                  21480000
214900                COMPUTE WS-TOT-EXTEN-INVOICE-AMT                  21490000
215000                   =    WS-TOT-EXTEN-INVOICE-AMT                  21500000
215100                   +    WS-CALC-EXTEN-INVOICE-AMT                 21510000
215200                COMPUTE WS-TOTAL-QTY-INVOICED                     21520000
215300                   =    WS-TOTAL-QTY-INVOICED                     21530000
215400                   +    PV-QUANTITY-INVOICED                      21540000
215500             END-IF                                               21550000
215600             IF (AP052-IT1-UNIT-MEASURE = 'AS')                   21560000
215700                PERFORM E600-EDIT-PKITEM-WARN-INDS                21570000
215800             END-IF                                               21580000
215900        WHEN OTHER                                                21590000
216000             ADD 1 TO WS-REC-OTHER-CNT                            21600000
216100             IF REJ-INDX NOT = 25                                 21610000
216200                SET REJ-INDX UP BY 1                              21620000
216300             END-IF                                               21630000
216400             SET ERROR-EDI TO TRUE                                21640000
216500             SET INVALID-REC-TYPE-CD TO TRUE                      21650000
216600             MOVE EDI-ERROR-CD TO                                 21660000
216700                  WS-INV-ERR-CD(INV-INDX, REJ-INDX)               21670000
216800     END-EVALUATE.                                                21680000
216900                                                                  21690000
217000*---------------------------------------------------------------  21700000
217100* REQUIRED FIELD VALIDATION -- VERIFIES THAT ALL REQUIRED         21710000
217200* FIELDS AND 88 LEVEL ENTRIES ARE POPULATED WITH DATA             21720000
217300*---------------------------------------------------------------  21730000
217400     IF AP052-RECORD-TYPE-IND = '01'                              21740000
217500        IF AP052-VENDOR-INVOICE-NBR = SPACES                      21750000
217600           IF REJ-INDX NOT = 25                                   21760000
217700              SET REJ-INDX UP BY 1                                21770000
217800           END-IF                                                 21780000
217900           SET ERROR-EDI TO TRUE                                  21790000
218000           SET NO-INV-NBR-CD TO TRUE                              21800000
218100           MOVE EDI-ERROR-CD TO WS-INV-ERR-CD(INV-INDX, REJ-INDX) 21810000
218200        END-IF                                                    21820000
569100        MOVE AP052-EDI-SENDER-ID  TO WS-VEND-INCHG-ID             21821060
569100        IF WS-INFOCHAIN                                           21822060
569100            SET AP052-NEXUS-INVC-YES TO TRUE                      21823060
569100        ELSE                                                      21824060
569100            SET AP052-NEXUS-INVC-NO  TO TRUE                      21825060
569100        END-IF                                                    21826060
218300     END-IF.                                                      21830000
218400                                                                  21840000
218500     IF AP052-RECORD-TYPE-IND = '01'                              21850000
218600        IF AP052-KOHLS-PO-NBR NOT NUMERIC                         21860000
218700        OR AP052-KOHLS-PO-NBR = ZEROS                             21870000
218800           IF REJ-INDX NOT = 25                                   21880000
218900              SET REJ-INDX UP BY 1                                21890000
219000           END-IF                                                 21900000
219100           SET ERROR-EDI TO TRUE                                  21910000
219200           SET NO-PO-NBR-CD TO TRUE                               21920000
219300           MOVE EDI-ERROR-CD TO WS-INV-ERR-CD(INV-INDX, REJ-INDX) 21930000
219400           MOVE SPACES               TO AP052-ENT-ID-DESC         21940000
219500                                        ENTNME-ENT-NAME-DESC      21950000
219600           MOVE ZEROES               TO AP052-EXTENT-DUN-NBR      21960000
219700                                        WS-EXTENT-DUN-NBR         21970000
219800           MOVE WS-WORK-REC          TO WS-INV-REC(INV-INDX)      21980000
219900        ELSE                                                      21990000
220000           SET WS-NOT-VALID-PO-NBR TO TRUE                        22000000
220100           INITIALIZE DCLTPURCHS                                  22010000
220200           PERFORM R600-SELECT-TPURCHS                            22020000
220300           IF WS-NOT-VALID-PO-NBR                                 22030000
220400              IF REJ-INDX NOT = 25                                22040000
220500                 SET REJ-INDX UP BY 1                             22050000
220600              END-IF                                              22060000
220700********      MOVE WS-AP052-KEY-AREA(INV-INDX - 1) TO             22070000
220800********              WS-AP052-KEY-AREA(INV-INDX)                 22080000
220900********      MOVE HIGH-VALUES TO WS-AP052-REC-TYPE(INV-INDX)     22090000
221000                                                                  22100000
221100              MOVE AP052-EDI-SENDER-ID TO WS-TRDPRT-VEND-ID       22110000
221200              MOVE AP052-EDI-SENDER-ID-QUAL                       22120000
221300                                       TO WS-TRDPRT-VEND-ID-DESC  22130000
221400              PERFORM R800-SELECT-ENTID-TTRDPRT                   22140000
221500              IF VALID-TRADE-PART                                 22150000
221600                 MOVE WS-TRDPRT-ENT-ID TO PURCHS-ENT-ID           22160000
221700                                          AP052-VENDOR-ENT-ID     22170000
221800                 PERFORM R950-SELECT-TENTNME                      22180000
221900                 MOVE ENTNME-ENT-NAME-DESC TO AP052-ENT-ID-DESC   22190000
222000                 MOVE WS-EXTENT-DUN-NBR    TO WS-DUN-NBR-X        22200000
222100                 MOVE WS-DUN-NBR-9S        TO AP052-EXTENT-DUN-NBR22210000
222200              ELSE                                                22220000
222300                  MOVE SPACES             TO AP052-ENT-ID-DESC    22230000
222400                                             ENTNME-ENT-NAME-DESC 22240000
222500                  MOVE ZEROES             TO AP052-EXTENT-DUN-NBR 22250000
222600                                             WS-EXTENT-DUN-NBR    22260000
222700              END-IF                                              22270000
222800              MOVE WS-WORK-REC        TO WS-INV-REC(INV-INDX)     22280000
222900              SET ERROR-EDI TO TRUE                               22290000
223000              SET PO-NBR-NOT-VALID-CD TO TRUE                     22300000
223100              MOVE EDI-ERROR-CD TO                                22310000
223200                                WS-INV-ERR-CD(INV-INDX, REJ-INDX) 22320000
223300*          ELSE VALID PO                                          22330047
223300           ELSE                                                   22331047
223400*             MOVE WS-SAVE-PO-NBR-COMP  TO PURCHS-PO-NBR          22340000
223500              PERFORM R950-SELECT-TENTNME                         22350000
223600              MOVE PURCHS-ENT-ID        TO AP052-VENDOR-ENT-ID    22360000
223700              MOVE ENTNME-ENT-NAME-DESC TO AP052-ENT-ID-DESC      22370000
223800              MOVE WS-EXTENT-DUN-NBR    TO WS-DUN-NBR-X           22380000
223900              MOVE WS-DUN-NBR-9S        TO AP052-EXTENT-DUN-NBR   22390000
569100*     NEED TO IDENTIFY INVOICES FROM INFOR NEXUS                  22391047
569100*     IF INFOR NEXUS, THE INVOICE MUST BE IMPORT (IM,IE,IF)       22392047
569100              MOVE PURCHS-PO-TYP-CDE TO AP052-PO-TYP-CDE          22394047
569100              IF WS-INFOCHAIN                                     22396047
292500                  IF PURCHS-PO-TYP-CDE = 'IM' OR 'IE' OR 'IF'     22398047
292500                      CONTINUE                                    22399047
292500                  ELSE                                            22399147
217600                      IF REJ-INDX NOT = 25                        22399247
217700                          SET REJ-INDX UP BY 1                    22399347
217800                      END-IF                                      22399447
217900                      SET ERROR-EDI TO TRUE                       22399547
218000                      SET NEXUS-INVC-PO-NOT-IMPORT TO TRUE        22399647
218100                      MOVE EDI-ERROR-CD TO                        22399847
218100                          WS-INV-ERR-CD(INV-INDX, REJ-INDX)       22399947
292500                  END-IF                                          22400047
569200              END-IF                                              22400347
224000              MOVE WS-WORK-REC          TO WS-INV-REC(INV-INDX)   22401000
224100              IF WS-VENDOR-IS-LI-FUNG                             22410000
224200                 MOVE AP052-EDI-SENDER-ID TO WS-TRDPRT-VEND-ID    22420000
224300                 MOVE AP052-EDI-SENDER-ID-QUAL                    22430000
224400                                        TO WS-TRDPRT-VEND-ID-DESC 22440000
224500                 PERFORM R800-SELECT-ENTID-TTRDPRT                22450000
224600                 IF VALID-TRADE-PART AND                          22460000
224700                    (PURCHS-ENT-ID NOT EQUAL WS-TRDPRT-ENT-ID)    22470000
224800                       IF REJ-INDX NOT = 25                       22480000
224900                          SET REJ-INDX UP BY 1                    22490000
225000                       END-IF                                     22500000
225100                       MOVE WS-TRDPRT-ENT-ID TO PURCHS-ENT-ID     22510000
225200                                              AP052-VENDOR-ENT-ID 22520000
225300                       PERFORM R950-SELECT-TENTNME                22530000
225400                       MOVE ENTNME-ENT-NAME-DESC TO               22540000
225500                                           AP052-ENT-ID-DESC      22550000
225600                       MOVE WS-EXTENT-DUN-NBR TO WS-DUN-NBR-X     22560000
225700                       MOVE WS-DUN-NBR-9S TO AP052-EXTENT-DUN-NBR 22570000
225800                       MOVE WS-WORK-REC  TO WS-INV-REC(INV-INDX)  22580000
225900                       SET ERROR-EDI TO TRUE                      22590000
226000                       SET PO-NBR-NOT-VALID-CD TO TRUE            22600000
226100                       MOVE EDI-ERROR-CD TO                       22610000
226200                                WS-INV-ERR-CD(INV-INDX, REJ-INDX) 22620000
226300                 END-IF                                           22630000
226400                 IF PURCHS-STATUS-CDE = 'CA'                      22640000
226500                    IF REJ-INDX NOT = 25                          22650000
226600                       SET REJ-INDX UP BY 1                       22660000
226700                    END-IF                                        22670000
226800                    SET ERROR-EDI TO TRUE                         22680000
226900                    SET LI-FUNG-PO-CANCELED-CD TO TRUE            22690000
227000                    MOVE EDI-ERROR-CD                             22700000
227100                      TO WS-INV-ERR-CD(INV-INDX, REJ-INDX)        22710000
227200                 END-IF                                           22720000
227300              END-IF                                              22730000
227400           END-IF                                                 22740000
227500        END-IF                                                    22750000
227600     END-IF.                                                      22760000
227700                                                                  22770000
227800     SET WS-VALID-DATE TO TRUE.                                   22780000
227900     IF AP052-RECORD-TYPE-IND = '02'                              22790000
228000        IF AP052-INVOICE-DATE NOT NUMERIC                         22800000
228100        OR AP052-INVOICE-DATE = '000000'                          22810000
228200           IF REJ-INDX NOT = 25                                   22820000
228300              SET REJ-INDX UP BY 1                                22830000
228400           END-IF                                                 22840000
228500           SET ERROR-EDI TO TRUE                                  22850000
228600           SET NO-INV-DATE-CD TO TRUE                             22860000
228700           MOVE EDI-ERROR-CD TO                                   22870000
228800                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         22880000
228900        ELSE                                                      22890000
229000           MOVE AP052-INVOICE-DATE TO WS-YYMMDD                   22900000
229100           PERFORM E400-CHECK-DATE                                22910000
229200           IF WS-NOT-VALID-DATE                                   22920000
229300              IF REJ-INDX NOT = 25                                22930000
229400                 SET REJ-INDX UP BY 1                             22940000
229500              END-IF                                              22950000
229600              SET ERROR-EDI TO TRUE                               22960000
229700              SET INV-DATE-INVALID-CD TO TRUE                     22970000
229800              MOVE EDI-ERROR-CD TO                                22980000
229900                           WS-INV-ERR-CD(INV-INDX, REJ-INDX)      22990000
230000           END-IF                                                 23000000
230100        END-IF                                                    23010000
230200     END-IF.                                                      23020000
230300                                                                  23030000
230400     IF AP052-RECORD-TYPE-IND = '04'                              23040000
230500        IF AP052-VALID-TERMS-TYPE                                 23050000
230600           NEXT SENTENCE                                          23060000
230700        ELSE                                                      23070000
230800           IF REJ-INDX NOT = 25                                   23080000
230900              SET REJ-INDX UP BY 1                                23090000
231000           END-IF                                                 23100000
231100           SET ERROR-EDI TO TRUE                                  23110000
231200           SET INVALID-TERMS-TYPE-CD TO TRUE                      23120000
231300           MOVE EDI-ERROR-CD TO                                   23130000
231400                        WS-INV-ERR-CD(INV-INDX, REJ-INDX).        23140000
231500                                                                  23150000
231600     IF AP052-RECORD-TYPE-IND = '04'                              23160000
231700        MOVE AP052-TRMS-BASIS-DTE-CODE TO                         23170000
231800             WS-CHECK-BASIS-DTE-CODE                              23180000
231900        IF WS-CHECK-BASIS-DTE-CODE(1:1) NUMERIC AND               23190000
232000           WS-CHECK-BASIS-DTE-CODE(2:1) = SPACE                   23200000
232100           PERFORM E800-CONVERT-CODE                              23210000
232200        END-IF                                                    23220000
232300        IF AP052-SHIP-DATE    OR                                  23230000
232400           AP052-DELIV-DATE   OR                                  23240000
232500           AP052-INVC-DATE    OR                                  23250000
232600           AP052-EFFECT-DATE                                      23260000
232700           EVALUATE AP052-TRMS-BASIS-DTE-CODE                     23270000
232800              WHEN '01'                                           23280000
232900                 IF WS-SAVE-SHIPPED-DATE = SPACES OR '000000'     23290000
233000                    IF REJ-INDX NOT = 25                          23300000
233100                       SET REJ-INDX UP BY 1                       23310000
233200                    END-IF                                        23320000
233300                    SET ERROR-EDI TO TRUE                         23330000
233400                    SET TERM-01-NO-SHIP-DATE TO TRUE              23340000
233500                    MOVE EDI-ERROR-CD TO                          23350000
233600                           WS-INV-ERR-CD(INV-INDX, REJ-INDX)      23360000
233700                 END-IF                                           23370000
233800              WHEN '07'                                           23380000
233900                 IF WS-SAVE-EFFECTIVE-DATE = SPACES OR '000000'   23390000
234000                    IF REJ-INDX NOT = 25                          23400000
234100                       SET REJ-INDX UP BY 1                       23410000
234200                    END-IF                                        23420000
234300                    SET ERROR-EDI TO TRUE                         23430000
234400                    SET TERM-07-NO-EFFECT-DATE TO TRUE            23440000
234500                    MOVE EDI-ERROR-CD TO                          23450000
234600                           WS-INV-ERR-CD(INV-INDX, REJ-INDX)      23460000
234700                 END-IF                                           23470000
234800           END-EVALUATE                                           23480000
234900        ELSE                                                      23490000
235000           IF REJ-INDX NOT = 25                                   23500000
235100              SET REJ-INDX UP BY 1                                23510000
235200           END-IF                                                 23520000
235300           SET ERROR-EDI TO TRUE                                  23530000
235400           SET INVALID-BASIS-DATE-CD TO TRUE                      23540000
235500           MOVE EDI-ERROR-CD TO WS-INV-ERR-CD(INV-INDX, REJ-INDX) 23550000
235600        END-IF                                                    23560000
235700     END-IF.                                                      23570000
235800                                                                  23580000
235900     IF AP052-RECORD-TYPE-IND = '05'                              23590000
236000        IF AP052-SPEC-SRVC-CODE  = SPACES                         23600000
236100          OR                                                      23610000
236200          (AP052-FREE-GOODS OR                                    23620000
236300           AP052-TICKETING-SRVC OR                                23630000
236400           AP052-DELIVERY-SRVC  OR                                23640000
236500           AP052-MUTL-DEFN-SRVC OR                                23650000
236600           AP052-HANGER-CHRG )                                    23660000
236700             IF AP052-HANGER-CHRG                                 23670000
236800                SET AP052-CHARGE TO TRUE                          23680000
236900                MOVE 'HGR' TO AP052-ALLW-CHRG-CODE                23690000
237000                IF WS-VENDOR-IS-LI-FUNG                           23700000
237100                   MOVE AP052-ALLW-CHRG-TOTAL TO                  23710000
237200                        WS-LI-FUNG-HANGER-AMT                     23720000
237300                END-IF                                            23730000
237400             END-IF                                               23740000
237500        ELSE                                                      23750000
237600           IF REJ-INDX NOT = 25                                   23760000
237700              SET REJ-INDX UP BY 1                                23770000
237800           END-IF                                                 23780000
237900           SET ERROR-EDI TO TRUE                                  23790000
238000           SET INVALID-SPEC-SRV-CD TO TRUE                        23800000
238100           MOVE EDI-ERROR-CD TO                                   23810000
238200                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         23820000
238300        END-IF                                                    23830000
238400     END-IF.                                                      23840000
238500                                                                  23850000
238600     IF AP052-RECORD-TYPE-IND = '05'                              23860000
238700        IF AP052-ALLW-CHG-TYPE = 'A' OR 'C'                       23870000
238800           IF AP052-ALLOWANCE                                     23880000
238900              IF AP052-VALID-ALLW-CDES                            23890000
239000                 CONTINUE                                         23900000
239100              ELSE                                                23910000
239200                 IF REJ-INDX NOT = 25                             23920000
239300                    SET REJ-INDX UP BY 1                          23930000
239400                 END-IF                                           23940000
239500                 SET ERROR-EDI TO TRUE                            23950000
239600                 SET INVALID-ALLOW-CD TO TRUE                     23960000
239700                 MOVE EDI-ERROR-CD TO                             23970000
239800                              WS-INV-ERR-CD(INV-INDX, REJ-INDX)   23980000
239900              END-IF                                              23990000
240000           ELSE                                                   24000000
240100              IF AP052-CHARGE                                     24010000
240200                 IF AP052-VALID-CHRG-CDES                         24020000
240300** WR28461 -- ADDED ADDITIONAL IF LOGIC                           24030000
240400                    EVALUATE AP052-ALLW-CHRG-CODE                 24040000
240500                      WHEN 'CDH'                                  24050000
240600                         IF PURCHS-PO-TYP-CDE = 'CD'              24060000
240700*                           PERFORM E225-VERIFY-OVER-LIMIT        24070000
240800                            ADD AP052-ALLW-CHRG-TOTAL             24080000
240900                                TO WS-CD-HANDLING-AMT             24090000
241000                         ELSE                                     24100000
241100                            PERFORM E250-REJECT-INVOICE           24110000
241200                         END-IF                                   24120000
241300                      WHEN 'CDG'                                  24130000
241400                         IF PURCHS-PO-TYP-CDE = 'CD'              24140000
241500                            NEXT SENTENCE                         24150000
241600*                           PERFORM E225-VERIFY-OVER-LIMIT        24160000
241700                         ELSE                                     24170000
241800                            PERFORM E250-REJECT-INVOICE           24180000
241900                         END-IF                                   24190000
242000*                     WHEN OTHER                                  24200000
242100*                        PERFORM E225-VERIFY-OVER-LIMIT           24210000
242200                    END-EVALUATE                                  24220000
242300                 ELSE                                             24230000
242400                    PERFORM E250-REJECT-INVOICE                   24240000
242500                 END-IF                                           24250000
242600              END-IF                                              24260000
242700           END-IF                                                 24270000
242800        ELSE                                                      24280000
242900           IF AP052-NO-ALLW-CHGS                                  24290000
243000              IF AP052-ALLW-CHRG-CODE     = SPACES   AND          24300000
243100                 AP052-ALLW-CHRG-MTHD     = SPACES   AND          24310000
243200                 AP052-ALLW-CHRG-TOTAL    = ZEROS    AND          24320000
243300                 AP052-ALLW-CHRG-PCT      = ZEROS    AND          24330000
243400                 AP052-ALLW-CHRG-PCT-QUAL = SPACE                 24340000
243500                 NEXT SENTENCE                                    24350000
243600              ELSE                                                24360000
243700                 IF REJ-INDX NOT = 25                             24370000
243800                    SET REJ-INDX UP BY 1                          24380000
243900                 END-IF                                           24390000
244000                 SET ERROR-EDI TO TRUE                            24400000
244100                 SET CHRG-CD-N-DATA-PRESENT TO TRUE               24410000
244200                 MOVE EDI-ERROR-CD TO                             24420000
244300                           WS-INV-ERR-CD(INV-INDX, REJ-INDX)      24430000
244400              END-IF                                              24440000
244500           ELSE                                                   24450000
244600              IF AP052-ALLW-CHG-TYPE = SPACE                      24460000
244700                 IF AP052-ALLW-CHRG-CODE     = SPACES   AND       24470000
244800                    AP052-ALLW-CHRG-MTHD     = SPACES   AND       24480000
244900                    AP052-ALLW-CHRG-TOTAL    = ZEROS    AND       24490000
245000                    AP052-ALLW-CHRG-PCT      = ZEROS    AND       24500000
245100                    AP052-ALLW-CHRG-PCT-QUAL = SPACE              24510000
245200                    NEXT SENTENCE                                 24520000
245300                 ELSE                                             24530000
245400                    IF REJ-INDX NOT = 25                          24540000
245500                       SET REJ-INDX UP BY 1                       24550000
245600                    END-IF                                        24560000
245700                    SET ERROR-EDI TO TRUE                         24570000
245800                    SET CHRG-CD-BLNK-DATA-PRESENT TO TRUE         24580000
245900                    MOVE EDI-ERROR-CD TO                          24590000
246000                              WS-INV-ERR-CD(INV-INDX, REJ-INDX)   24600000
246100                 END-IF                                           24610000
246200              ELSE                                                24620000
246300                 IF REJ-INDX NOT = 25                             24630000
246400                    SET REJ-INDX UP BY 1                          24640000
246500                 END-IF                                           24650000
246600                 SET ERROR-EDI TO TRUE                            24660000
246700                 SET NOT-VALID-ALLW-CHG-TYPE-CD TO TRUE           24670000
246800                 MOVE EDI-ERROR-CD TO                             24680000
246900                           WS-INV-ERR-CD(INV-INDX, REJ-INDX)      24690000
247000              END-IF                                              24700000
247100           END-IF                                                 24710000
247200        END-IF                                                    24720000
247300     END-IF.                                                      24730000
247400                                                                  24740000
247500     IF AP052-RECORD-TYPE-IND = '05'                              24750000
247600        IF AP052-ALLW-CHRG-PCT-QUAL NOT = SPACES                  24760000
247700           IF AP052-DISCOUNT-GROSS                                24770000
247800               NEXT SENTENCE                                      24780000
247900           ELSE                                                   24790000
248000              IF REJ-INDX NOT = 25                                24800000
248100                 SET REJ-INDX UP BY 1                             24810000
248200              END-IF                                              24820000
248300              SET ERROR-EDI TO TRUE                               24830000
248400              SET INVALID-ALLW-CHRG-PCT-CD TO TRUE                24840000
248500              MOVE EDI-ERROR-CD TO                                24850000
248600                           WS-INV-ERR-CD(INV-INDX, REJ-INDX)      24860000
248700           END-IF                                                 24870000
248800        ELSE                                                      24880000
248900           SET AP052-DISCOUNT-GROSS TO TRUE                       24890000
249000           MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX)               24900000
249100        END-IF                                                    24910000
249200     END-IF.                                                      24920000
249300                                                                  24930000
249400     IF AP052-RECORD-TYPE-IND = '06'                              24940000
249500        IF AP052-GROSS-INVOICE-AMT = 0                            24950000
249600           IF REJ-INDX NOT = 25                                   24960000
249700              SET REJ-INDX UP BY 1                                24970000
249800           END-IF                                                 24980000
249900           SET ERROR-EDI TO TRUE                                  24990000
250000           SET NO-GROSS-INVC-CD TO TRUE                           25000000
250100           MOVE EDI-ERROR-CD TO                                   25010000
250200                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         25020000
250300        END-IF                                                    25030000
250400     END-IF.                                                      25040000
250500                                                                  25050000
250600     IF AP052-RECORD-TYPE-IND = '06'                              25060000
250700        IF AP052-DISCOUNTED-AMT-DUE > 0 AND                       25070000
250800           AP052-DISCOUNTED-AMT-DUE >                             25080000
250900           AP052-GROSS-INVOICE-AMT                                25090000
251000           IF REJ-INDX NOT = 25                                   25100000
251100              SET REJ-INDX UP BY 1                                25110000
251200           END-IF                                                 25120000
251300           SET ERROR-EDI TO TRUE                                  25130000
251400           SET DISC-AMT-GREATER-GROSS TO TRUE                     25140000
251500           MOVE EDI-ERROR-CD TO                                   25150000
251600                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         25160000
251700        END-IF                                                    25170000
251800     END-IF.                                                      25180000
251900                                                                  25190000
252000     IF AP052-RECORD-TYPE-IND = '07'                              25200000
252100        IF AP052-ID-QUALIFIER NOT = SPACES                        25210000
252200           IF NOT AP052-EAN                                       25220000
252300           AND NOT AP052-UPC                                      25230000
252400              IF REJ-INDX NOT = 25                                25240000
252500                 SET REJ-INDX UP BY 1                             25250000
252600              END-IF                                              25260000
252700              SET ERROR-EDI TO TRUE                               25270000
252800              SET INVALID-ID-QUAL-CD TO TRUE                      25280000
252900              MOVE EDI-ERROR-CD TO                                25290000
253000                              WS-INV-ERR-CD(INV-INDX, REJ-INDX)   25300000
253100            END-IF                                                25310000
253200        END-IF                                                    25320000
253300     END-IF.                                                      25330000
253400                                                                  25340000
253500     IF AP052-RECORD-TYPE-IND = '07'                              25350000
253600        IF (AP052-EAN OR AP052-UPC)                               25360000
253700        OR AP052-EAN-UPC NOT = SPACES                             25370000
253800        OR AP052-VENDOR-STYLE NOT = SPACES                        25380000
253900           NEXT SENTENCE                                          25390000
254000        ELSE                                                      25400000
254100           IF REJ-INDX NOT = 25                                   25410000
254200              SET REJ-INDX UP BY 1                                25420000
254300           END-IF                                                 25430000
254400           SET ERROR-EDI TO TRUE                                  25440000
254500           SET NO-ITEM-ID-CD TO TRUE                              25450000
254600           MOVE EDI-ERROR-CD TO                                   25460000
254700                WS-INV-ERR-CD(INV-INDX, REJ-INDX)                 25470000
254800        END-IF                                                    25480000
254900     END-IF.                                                      25490000
255000                                                                  25500000
255100     IF AP052-RECORD-TYPE-IND = '07'                              25510000
255200        IF AP052-QUANTITY-INVOICED  NOT NUMERIC                   25520000
255300           IF REJ-INDX NOT = 25                                   25530000
255400              SET REJ-INDX UP BY 1                                25540000
255500           END-IF                                                 25550000
255600           SET ERROR-EDI TO TRUE                                  25560000
255700           SET NO-QUANTITY-INVOICED-CD TO TRUE                    25570000
255800           MOVE EDI-ERROR-CD TO WS-INV-ERR-CD(INV-INDX, REJ-INDX) 25580000
255900        END-IF                                                    25590000
256000     END-IF.                                                      25600000
256100                                                                  25610000
256200     IF AP052-RECORD-TYPE-IND = '07'                              25620000
256300        IF NOT AP052-IT1-MSR-EACH    AND                          25630000
256400           NOT AP052-IT1-MSR-PACK    AND                          25640000
256500           NOT AP052-IT1-MSR-PAIR    AND                          25650000
256600           NOT AP052-IT1-MSR-SET     AND                          25660000
256700           NOT AP052-IT1-MSR-PK-HDR  AND                          25670000
256800           NOT AP052-IT1-MSR-PK-ITEM                              25680000
256900           IF REJ-INDX NOT = 25                                   25690000
257000              SET REJ-INDX UP BY 1                                25700000
257100           END-IF                                                 25710000
257200           SET ERROR-EDI TO TRUE                                  25720000
257300           SET INVALID-QTY-INVD-UOM-CD TO TRUE                    25730000
257400           MOVE EDI-ERROR-CD TO WS-INV-ERR-CD(INV-INDX, REJ-INDX) 25740000
257500        END-IF                                                    25750000
257600     END-IF.                                                      25760000
257700                                                                  25770000
257800     IF AP052-RECORD-TYPE-IND = '07'                              25780000
257900        IF AP052-IT1-MSR-PK-ITEM AND                              25790000
258000           WS-VENDOR-IS-LI-FUNG                                   25800000
258100           SET LI-FUNG-PREPACK-FOUND TO TRUE                      25810000
258200        END-IF                                                    25820000
258300     END-IF.                                                      25830000
258400                                                                  25840000
258500     IF AP052-RECORD-TYPE-IND = '07'                              25850000
258600        IF AP052-WHOLSALE-UNIT-COST NOT NUMERIC                   25860000
258700           IF REJ-INDX NOT = 25                                   25870000
258800              SET REJ-INDX UP BY 1                                25880000
258900           END-IF                                                 25890000
259000           SET ERROR-EDI TO TRUE                                  25900000
259100           SET NO-UNIT-COST-CD TO TRUE                            25910000
259200           MOVE EDI-ERROR-CD TO WS-INV-ERR-CD(INV-INDX, REJ-INDX) 25920000
259300        END-IF                                                    25930000
259400     END-IF.                                                      25940000
259500                                                                  25950000
259600*---------------------------------------------------------------  25960000
259700* DATE VALIDATION                                                 25970000
259800*---------------------------------------------------------------  25980000
259900                                                                  25990000
260000     SET WS-VALID-DATE TO TRUE.                                   26000000
260100     IF AP052-RECORD-TYPE-IND = '01'                              26010000
260200        IF AP052-INTRCHG-DATE  NOT NUMERIC                        26020000
260300           SET WS-NOT-VALID-DATE TO TRUE                          26030000
260400        ELSE                                                      26040000
260500           IF AP052-INTRCHG-DATE NOT = '000000'                   26050000
260600              MOVE AP052-INTRCHG-DATE TO WS-YYMMDD                26060000
260700              PERFORM E400-CHECK-DATE                             26070000
260800           END-IF                                                 26080000
260900        END-IF                                                    26090000
261000        IF WS-NOT-VALID-DATE                                      26100000
261100           IF REJ-INDX NOT = 25                                   26110000
261200              SET REJ-INDX UP BY 1                                26120000
261300           END-IF                                                 26130000
261400           SET ERROR-EDI TO TRUE                                  26140000
261500           SET INTERCHG-DATE-NOT-VALID-CD TO TRUE                 26150000
261600           MOVE EDI-ERROR-CD TO WS-INV-ERR-CD(INV-INDX, REJ-INDX) 26160000
261700        END-IF                                                    26170000
261800     END-IF.                                                      26180000
261900                                                                  26190000
262000     SET WS-VALID-DATE TO TRUE.                                   26200000
262100     IF AP052-RECORD-TYPE-IND = '02'                              26210000
262200        IF AP052-DATE-SHIPPED NOT NUMERIC                         26220000
262300           SET WS-NOT-VALID-DATE TO TRUE                          26230000
262400        ELSE                                                      26240000
262500           IF AP052-DATE-SHIPPED NOT = '000000'                   26250000
262600              MOVE AP052-DATE-SHIPPED TO  WS-YYMMDD               26260000
262700              PERFORM E400-CHECK-DATE                             26270000
262800           END-IF                                                 26280000
262900        END-IF                                                    26290000
263000        IF WS-NOT-VALID-DATE                                      26300000
263100           IF REJ-INDX NOT = 25                                   26310000
263200              SET REJ-INDX UP BY 1                                26320000
263300           END-IF                                                 26330000
263400           SET ERROR-EDI TO TRUE                                  26340000
263500           SET DATE-SHIPPED-NOT-VALID-CD TO TRUE                  26350000
263600           MOVE EDI-ERROR-CD TO                                   26360000
263700                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         26370000
263800        END-IF                                                    26380000
263900     END-IF.                                                      26390000
264000                                                                  26400000
264100     SET WS-VALID-DATE TO TRUE.                                   26410000
264200     IF AP052-RECORD-TYPE-IND = '02'                              26420000
264300        IF AP052-EFFECTIVE-DATE NUMERIC AND                       26430000
264400           AP052-EFFECTIVE-DATE NOT = '000000'                    26440000
264500           MOVE AP052-EFFECTIVE-DATE TO        WS-YYMMDD          26450000
264600           PERFORM E400-CHECK-DATE                                26460000
264700        ELSE                                                      26470000
264800           IF AP052-EFFECTIVE-DATE = SPACES OR '000000'           26480000
264900              CONTINUE                                            26490000
265000           ELSE                                                   26500000
265100              SET WS-NOT-VALID-DATE TO TRUE                       26510000
265200           END-IF                                                 26520000
265300        END-IF                                                    26530000
265400        IF WS-NOT-VALID-DATE                                      26540000
265500           IF REJ-INDX NOT = 25                                   26550000
265600              SET REJ-INDX UP BY 1                                26560000
265700           END-IF                                                 26570000
265800           SET ERROR-EDI TO TRUE                                  26580000
265900           SET EFFECT-DATE-NOT-VALID-CD TO TRUE                   26590000
266000           MOVE EDI-ERROR-CD TO                                   26600000
266100                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         26610000
266200        END-IF                                                    26620000
266300     END-IF.                                                      26630000
266400                                                                  26640000
266500     SET WS-VALID-DATE TO TRUE.                                   26650000
266600     IF AP052-RECORD-TYPE-IND = '04'                              26660000
266700        IF AP052-DISC-DUE-DATE NUMERIC AND                        26670000
266800           AP052-DISC-DUE-DATE NOT = '000000'                     26680000
266900           MOVE AP052-DISC-DUE-DATE  TO WS-YYMMDD                 26690000
267000           PERFORM E400-CHECK-DATE                                26700000
267100        ELSE                                                      26710000
267200           IF AP052-DISC-DUE-DATE = SPACES OR      '000000'       26720000
267300              CONTINUE                                            26730000
267400           ELSE                                                   26740000
267500              SET WS-NOT-VALID-DATE TO TRUE                       26750000
267600           END-IF                                                 26760000
267700        END-IF                                                    26770000
267800        IF WS-NOT-VALID-DATE                                      26780000
267900           IF REJ-INDX NOT = 25                                   26790000
268000              SET REJ-INDX UP BY 1                                26800000
268100           END-IF                                                 26810000
268200           SET ERROR-EDI TO TRUE                                  26820000
268300           SET DISC-DUE-DATE-NOT-VALID-CD TO TRUE                 26830000
268400           MOVE EDI-ERROR-CD TO                                   26840000
268500                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         26850000
268600        END-IF                                                    26860000
268700        SET WS-VALID-DATE TO TRUE                                 26870000
268800        IF AP052-NET-DUE-DATE NUMERIC AND                         26880000
268900           AP052-NET-DUE-DATE NOT = '000000'                      26890000
269000           MOVE AP052-NET-DUE-DATE TO WS-YYMMDD                   26900000
269100           PERFORM E400-CHECK-DATE                                26910000
269200        ELSE                                                      26920000
269300           IF AP052-NET-DUE-DATE = SPACES OR '000000'             26930000
269400              CONTINUE                                            26940000
269500           ELSE                                                   26950000
269600              SET WS-NOT-VALID-DATE TO TRUE                       26960000
269700           END-IF                                                 26970000
269800        END-IF                                                    26980000
269900        IF WS-NOT-VALID-DATE                                      26990000
270000           IF REJ-INDX NOT = 25                                   27000000
270100              SET REJ-INDX UP BY 1                                27010000
270200           END-IF                                                 27020000
270300           SET ERROR-EDI TO TRUE                                  27030000
270400           SET NET-DUE-DATE-NOT-VALID-CD TO TRUE                  27040000
270500           MOVE EDI-ERROR-CD TO                                   27050000
270600                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         27060000
270700        END-IF                                                    27070000
270800        SET WS-VALID-DATE TO TRUE                                 27080000
270900        IF AP052-DEFERRED-DUE-DATE NUMERIC AND                    27090000
271000           AP052-DEFERRED-DUE-DATE NOT = '000000'                 27100000
271100           MOVE AP052-DEFERRED-DUE-DATE TO    WS-YYMMDD           27110000
271200           PERFORM E400-CHECK-DATE                                27120000
271300        ELSE                                                      27130000
271400           IF AP052-DEFERRED-DUE-DATE = SPACES OR  '000000'       27140000
271500              CONTINUE                                            27150000
271600           ELSE                                                   27160000
271700              SET WS-NOT-VALID-DATE TO TRUE                       27170000
271800           END-IF                                                 27180000
271900        END-IF                                                    27190000
272000        IF WS-NOT-VALID-DATE                                      27200000
272100           IF REJ-INDX NOT = 25                                   27210000
272200              SET REJ-INDX UP BY 1                                27220000
272300           END-IF                                                 27230000
272400           SET ERROR-EDI TO TRUE                                  27240000
272500           SET DEFER-DUE-DATE-NOT-VALID-CD TO TRUE                27250000
272600           MOVE EDI-ERROR-CD TO                                   27260000
272700                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         27270000
272800        END-IF                                                    27280000
272900     END-IF.                                                      27290000
273000                                                                  27300000
273100*---------------------------------------------------------------  27310000
273200* NUMERIC VALIDATION -- CHECKS FOR NEGATIVE NUMERIC FIELDS        27320000
273300*---------------------------------------------------------------  27330000
273400                                                                  27340000
273500     IF AP052-RECORD-TYPE-IND = '04'                              27350000
273600        IF AP052-DISC-PCT < 0                                     27360000
273700           IF REJ-INDX NOT = 25                                   27370000
273800              SET REJ-INDX UP BY 1                                27380000
273900           END-IF                                                 27390000
274000           SET ERROR-EDI TO TRUE                                  27400000
274100           SET NEG-TERMS-DISC-PCT-CD TO TRUE                      27410000
274200           MOVE EDI-ERROR-CD TO                                   27420000
274300                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         27430000
274400        END-IF                                                    27440000
274500     END-IF.                                                      27450000
274600                                                                  27460000
274700     IF AP052-RECORD-TYPE-IND = '04'                              27470000
274800        IF AP052-DISC-AMT < 0                                     27480000
274900           IF REJ-INDX NOT = 25                                   27490000
275000              SET REJ-INDX UP BY 1                                27500000
275100           END-IF                                                 27510000
275200           SET ERROR-EDI TO TRUE                                  27520000
275300           SET NEG-TERMS-DISC-AMT-CD TO TRUE                      27530000
275400           MOVE EDI-ERROR-CD TO                                   27540000
275500                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         27550000
275600        END-IF                                                    27560000
275700     END-IF.                                                      27570000
275800                                                                  27580000
275900     IF AP052-RECORD-TYPE-IND = '04'                              27590000
276000        IF AP052-PCT-PAYABLE < 0                                  27600000
276100           IF REJ-INDX NOT = 25                                   27610000
276200              SET REJ-INDX UP BY 1                                27620000
276300           END-IF                                                 27630000
276400           SET ERROR-EDI TO TRUE                                  27640000
276500           SET NEG-PCT-PAYABLE-CD TO TRUE                         27650000
276600           MOVE EDI-ERROR-CD TO                                   27660000
276700                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         27670000
276800        END-IF                                                    27680000
276900     END-IF.                                                      27690000
277000                                                                  27700000
277100     IF AP052-RECORD-TYPE-IND = '04'                              27710000
277200        IF AP052-DEFERRED-AMT < 0                                 27720000
277300           IF REJ-INDX NOT = 25                                   27730000
277400              SET REJ-INDX UP BY 1                                27740000
277500           END-IF                                                 27750000
277600           SET ERROR-EDI TO TRUE                                  27760000
277700           SET NEG-DEFERRED-AMT-CD TO TRUE                        27770000
277800           MOVE EDI-ERROR-CD TO                                   27780000
277900                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         27790000
278000        END-IF                                                    27800000
278100     END-IF.                                                      27810000
278200                                                                  27820000
278300     IF AP052-RECORD-TYPE-IND = '05'                              27830000
278400        IF AP052-ALLW-CHRG-TOTAL < 0                              27840000
278500           IF REJ-INDX NOT = 25                                   27850000
278600              SET REJ-INDX UP BY 1                                27860000
278700           END-IF                                                 27870000
278800           SET ERROR-EDI TO TRUE                                  27880000
278900           SET NEG-ALLW-CHRG-TOT-CD TO TRUE                       27890000
279000           MOVE EDI-ERROR-CD TO                                   27900000
279100                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         27910000
279200        END-IF                                                    27920000
279300     END-IF.                                                      27930000
279400                                                                  27940000
279500     IF AP052-RECORD-TYPE-IND = '05'                              27950000
279600        IF AP052-ALLW-CHRG-PCT   < 0                              27960000
279700           IF REJ-INDX NOT = 25                                   27970000
279800              SET REJ-INDX UP BY 1                                27980000
279900           END-IF                                                 27990000
280000           SET ERROR-EDI TO TRUE                                  28000000
280100           SET NEG-ALLW-CHRG-PCT-CD TO TRUE                       28010000
280200           MOVE EDI-ERROR-CD TO                                   28020000
280300                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         28030000
280400        END-IF                                                    28040000
280500     END-IF.                                                      28050000
280600                                                                  28060000
280700     IF AP052-RECORD-TYPE-IND = '06'                              28070000
280800        IF AP052-GROSS-INVOICE-AMT < 0                            28080000
280900           IF REJ-INDX NOT = 25                                   28090000
281000              SET REJ-INDX UP BY 1                                28100000
281100           END-IF                                                 28110000
281200           SET ERROR-EDI TO TRUE                                  28120000
281300           SET NEG-GROSS-INV-AMT-CD TO TRUE                       28130000
281400           MOVE EDI-ERROR-CD TO                                   28140000
281500                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         28150000
281600        END-IF                                                    28160000
281700     END-IF.                                                      28170000
281800                                                                  28180000
281900     IF AP052-RECORD-TYPE-IND = '06'                              28190000
282000        IF AP052-AMT-SBJ-DISCOUNT  < 0                            28200000
282100           IF REJ-INDX NOT = 25                                   28210000
282200              SET REJ-INDX UP BY 1                                28220000
282300           END-IF                                                 28230000
282400           SET ERROR-EDI TO TRUE                                  28240000
282500           SET NEG-AMT-SBJ-DISC-CD  TO TRUE                       28250000
282600           MOVE EDI-ERROR-CD TO                                   28260000
282700                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         28270000
282800        END-IF                                                    28280000
282900     END-IF.                                                      28290000
283000                                                                  28300000
283100     IF AP052-RECORD-TYPE-IND = '06'                              28310000
283200        IF AP052-DISCOUNT-AMT < 0                                 28320000
283300           IF REJ-INDX NOT = 25                                   28330000
283400              SET REJ-INDX UP BY 1                                28340000
283500           END-IF                                                 28350000
283600           SET ERROR-EDI TO TRUE                                  28360000
283700           SET NEG-DISC-AMT-CD TO TRUE                            28370000
283800           MOVE EDI-ERROR-CD TO                                   28380000
283900                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         28390000
284000        END-IF                                                    28400000
284100     END-IF.                                                      28410000
284200                                                                  28420000
284300     IF AP052-RECORD-TYPE-IND = '06'                              28430000
284400        IF AP052-DISCOUNTED-AMT-DUE < 0                           28440000
284500           IF REJ-INDX NOT = 25                                   28450000
284600              SET REJ-INDX UP BY 1                                28460000
284700           END-IF                                                 28470000
284800           SET ERROR-EDI TO TRUE                                  28480000
284900           SET NEG-DISC-AMT-DUE-CD TO TRUE                        28490000
285000           MOVE EDI-ERROR-CD TO                                   28500000
285100                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         28510000
285200        END-IF                                                    28520000
285300     END-IF.                                                      28530000
285400                                                                  28540000
285500     IF AP052-RECORD-TYPE-IND = '07'                              28550000
285600        IF AP052-QUANTITY-INVOICED < 0                            28560000
285700           IF REJ-INDX NOT = 25                                   28570000
285800              SET REJ-INDX UP BY 1                                28580000
285900           END-IF                                                 28590000
286000           SET ERROR-EDI TO TRUE                                  28600000
286100           SET NEG-QTY-INV-CD TO TRUE                             28610000
286200           MOVE EDI-ERROR-CD TO                                   28620000
286300                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         28630000
286400        END-IF                                                    28640000
286500     END-IF.                                                      28650000
286600                                                                  28660000
286700     IF AP052-RECORD-TYPE-IND = '07'                              28670000
286800        IF AP052-WHOLSALE-UNIT-COST < 0                           28680000
286900           IF REJ-INDX NOT = 25                                   28690000
287000              SET REJ-INDX UP BY 1                                28700000
287100           END-IF                                                 28710000
287200           SET ERROR-EDI TO TRUE                                  28720000
287300           SET NEG-WHSL-UNT-CST-CD TO TRUE                        28730000
287400           MOVE EDI-ERROR-CD TO                                   28740000
287500                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         28750000
287600        END-IF                                                    28760000
287700     END-IF.                                                      28770000
287800                                                                  28780000
287900*---------------------------------------------------------------  28790000
288000* STORE/DC VALIDATION - DETERMINES THE MATCH LEVEL, THE STORE     28800000
288100* NUMBER AND THE DC NUMBER FOR EACH INVOICE.                      28810000
288200*---------------------------------------------------------------  28820000
288300                                                                  28830000
288400     IF AP052-RECORD-TYPE-IND = '02'                              28840000
288500        PERFORM R700-SELECT-FREIGHT                               28850000
288600        INITIALIZE VALID-STORE1-NUMBER-SW                         28860000
288700                   VALID-STORE2-NUMBER-SW                         28870000
288800                   WS-SAVE-STORE-NBR1                             28880000
288900                   WS-SAVE-STORE-NBR2                             28890000
289000                   WS-SAVE-STORE-NBR-FOR-DC                       28900000
289100                   WS-SAVE-DC-NBR                                 28910000
289200                   WS-MTCH-LVL                                    28920000
289300                   WS-STORE-TO-USE                                28930000
289400                                                                  28940000
289500        IF AP052-KOHLS-STORE-NBR1 = SPACES OR                     28950000
289600           AP052-KOHLS-STORE-NBR1 NOT NUMERIC                     28960000
289700           SET WS-NOT-VALID-STORE1  TO TRUE                       28970000
289800        END-IF                                                    28980000
289900        IF AP052-KOHLS-STORE-NBR2 = SPACES OR                     28990000
290000           AP052-KOHLS-STORE-NBR2 NOT NUMERIC                     29000000
290100           SET WS-NOT-VALID-STORE2  TO TRUE                       29010000
290200        END-IF                                                    29020000
290300                                                                  29030000
290400** REJECT THE INVOICE IF BOTH STORES ARE INVALID                  29040000
290500        IF WS-NOT-VALID-STORE1 AND WS-NOT-VALID-STORE2            29050000
290600           IF REJ-INDX NOT = 25                                   29060000
290700              SET REJ-INDX UP BY 1                                29070000
290800           END-IF                                                 29080000
290900           SET ERROR-EDI TO TRUE                                  29090000
291000           SET STORE-NBR-NOT-VALID TO TRUE                        29100000
291100           MOVE EDI-ERROR-CD                                      29110000
291200             TO WS-INV-ERR-CD(INV-INDX, REJ-INDX)                 29120000
291300           MOVE WS-WORK-REC     TO WS-INV-REC(INV-INDX)           29130000
291400        END-IF                                                    29140000
291500                                                                  29150000
291600        IF NO-EDI-ERROR                                           29160000
291700** IF THE PURCHASE ORDER IS AN IMPORT ('IM','IE','IF'), THE       29170000
291800** VALUES OF AP052-KOHLS-STORE-NBR1 AND AP052-KOHLS-STORE-NBR2    29180000
291900** SHOULD BOTH BE 899.  IF THE PURCHASE ORDER IS A LANDED 'LD' OR 29190024
292000** 'LE', THE VALUES OF AP052-KOHLS-STORE-NBR1 AND                 29200024
292100** AP052-KOHLS-STORE-NBR2 SHOULD BE EITHER 907 OR 899.            29210000
292200** IF ONE OF THE STORES IS NOT 899/907 OR BOTH OF THE             29220000
292300** STORES ARE NOT 899/907, A WARNING MESSAGE IS ISSUED.           29230000
292400                                                                  29240000
292500           IF PURCHS-PO-TYP-CDE = 'IM' OR 'IE' OR 'IF' OR         29250023
292500                                  'LD' OR 'LE'                    29251023
292600              MOVE AP052-KOHLS-STORE-NBR1 TO WS-SAVE-STORE-NBR1   29260000
292700              PERFORM R300-VALIDATE-STORE1                        29270000
292800              MOVE AP052-KOHLS-STORE-NBR2 TO WS-SAVE-STORE-NBR2   29280000
292900              PERFORM R350-VALIDATE-STORE2                        29290000
293000                                                                  29300000
293100              IF WS-VALID-PO1                                     29310000
293200                 IF WS-VALID-PO2                                  29320000
293300                    CONTINUE                                      29330000
293400                 ELSE                                             29340000
293500                    IF WS-NOT-VALID-STORE2                        29350000
293600                       IF AP052-KOHLS-STORE-NBR2 = PC-ZERO-STR    29360000
293700                          CONTINUE                                29370000
293800                       ELSE                                       29380000
293900                          PERFORM E240-GENERATE-WARNING6-MSG      29390000
294000                       END-IF                                     29400000
294100                    ELSE                                          29410000
294200                       PERFORM E230-GENERATE-WARNING4-MSG         29420000
294300                    END-IF                                        29430000
294400                 END-IF                                           29440000
294500              ELSE                                                29450000
294600                 PERFORM E230-GENERATE-WARNING4-MSG               29460000
294700              END-IF                                              29470000
294800** REGARDLESS IF A WARNING MESSAGE WAS ISSUED OR NOT, THE MATCH   29480000
294900** IS SET TO BULK ('P') WHILE BOTH THE STORE AND DC VALUES ARE SET29490000
295000** TO ZEROS.                                                      29500000
295100              MOVE ZEROS           TO AP052-KOHLS-STORE-TO-USE    29510000
295200                                      AP052-KOHLS-DC-TO-USE       29520000
295300                                      WS-STORE-TO-USE             29530000
295400              MOVE 'P'             TO AP052-SORT-MTCH-LVL         29540000
295500                                      AP052-KOHLS-MTCH-LVL-TO-USE 29550000
295600                                      WS-MTCH-LVL                 29560000
295700              MOVE WS-WORK-REC     TO WS-INV-REC(INV-INDX)        29570000
295800           ELSE                                                   29580000
295900** DETERMINE THE MATCH LEVEL, STORE AND DC VALUES IF THE          29590000
296000** PURCHASE ORDER IS NOT AN IMPORT OR LANDED                      29600000
296100              MOVE AP052-KOHLS-STORE-NBR1  TO WS-SAVE-STORE-NBR1  29610000
296200              PERFORM R300-VALIDATE-STORE1                        29620000
296300              IF WS-VALID-STORE1-DS OR WS-VALID-STORE1-CS         29630000
296400                 PERFORM E205-STORE1-IS-VALID-STORE               29640000
296500              ELSE                                                29650000
296600                 IF WS-VALID-DC1                                  29660000
296700                    PERFORM E210-STORE1-IS-VALID-DC               29670000
296800                 ELSE                                             29680000
296900                    IF WS-VALID-PO1                               29690000
297000                       PERFORM E215-STORE1-IS-VALID-IMPORT        29700000
297100                    ELSE                                          29710000
297200                       PERFORM E220-STORE1-IS-INVALID-STORE       29720000
297300                    END-IF                                        29730000
297400                 END-IF                                           29740000
297500              END-IF                                              29750000
297600           END-IF                                                 29760000
297700        END-IF                                                    29770000
297800     END-IF.                                                      29780000
297900                                                                  29790000
298000*---------------------------------------------------------------  29800000
298300* OBTAIN THE PO_LNE_NBR FROM THE TPURITM TABLE. LOOKUPS WILL BE   29830001
298400* DONE WITH VARIOUS ITEM IDS UNTIL THE LINE IS FOUND.  IF ALL     29840001
298401* OPTIONS ARE EXHAUSTED AND NO LINE IS FOUND, THE LINE WILL LOAD  29840101
298402* AS UNMATCHED.                                                   29840201
298410*---------------------------------------------------------------  29841001
299001                                                                  29900101
299002*---------------------------------------------------------------  29900201
299003* IF THE PO TYPE IS 'CD' (CONSUMER DIRECT) AND THE SKU IS         29900301
299004* PROVIDED, RETRIEVE THE PO_LNE_NBR FROM THE TPURITM TABLE        29900401
299005* WITH THE SKU.                                                   29900501
299006*---------------------------------------------------------------  29900601
299007                                                                  29900701
299011     IF  AP052-RECORD-TYPE-IND = '07'                             29901108
299012     AND PURCHS-PO-TYP-CDE = 'CD'                                 29901208
299016         IF  AP052-KOHLS-SKU NOT = SPACES                         29901612
299017         AND AP052-KOHLS-SKU NOT = ZEROES                         29901712
299019             MOVE AP052-KOHLS-SKU TO PURITM-RMS-PO-SKU-NBR        29901912
299021             PERFORM R490-SELECT-PO-LNE-NBR                       29902112
299022             MOVE PURITM-PO-LNE-NBR TO AP052-PO-LNE-NBR           29902212
299024             MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX)             29902412
299026         END-IF                                                   29902608
299027     END-IF.                                                      29902708
299028*---------------------------------------------------------------  29902808
299029* UPC VALIDATION - IF THE UPC NUMBER IS VALID, CHECK THE TUPCSKU  29902908
299030* TABLE TO OBTAIN THE ITEM NUMBER.  THE ITEM NUMBER IS USED TO    29903008
299031* OBTAIN THE PO_LNE_NBR FROM THE TPURITM TABLE.                   29903108
299032*                                                                 29903208
299033* IF THE RECORD IS A PACK ITEM AND THERE IS ALREADY A NON-ZERO    29903308
299034* VALUE IN THE PO LINE FIELD, THE LINE NUMBER WAS DETERMINED IN   29903408
299035* PROGRAM APKUT067 AND SHOULD NOT BE LOOKED UP AGAIN.             29903508
299036*                                                                 29903611
299037* IF THE PO IS TYPE CD AND THE PO LINE IS NOT ZERO, THE LINE      29903711
299038* WAS FOUND IN THE SKU CALL AND SHOULD NOT BE LOOKED UP AGAIN.    29903811
299040*---------------------------------------------------------------  29904001
299050                                                                  29905001
299100     IF AP052-RECORD-TYPE-IND = '07'                              29910000
299200        IF (AP052-IT1-MSR-PK-ITEM AND AP052-PO-LNE-NBR NOT = 0)   29920011
299210        OR (PURCHS-PO-TYP-CDE = 'CD' AND AP052-PO-LNE-NBR NOT = 0)29921011
299300           CONTINUE                                               29930000
299400        ELSE                                                      29940000
299500           MOVE ZEROS TO AP052-PO-LNE-NBR                         29950000
299600           MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX)               29960000
299700           IF AP052-UPC                                           29970000
299800* THE FOLLOWING WAS ADDED BECAUSE WE ARE NO LONGER ADDING THE     29980000
299900* LEADING ZERO TO THE UPC ON THE RECORD.  ADDING IT TO THE WORK   29990000
300000* FIELD ALLOWS THE CORRECT FORMAT FOR THE DATABASE LOOKUP WITHOUT 30000000
300100* CORRUPTING THE VALUE THE VENDOR SENT.                           30010000
300200              MOVE AP052-UPC-CODE TO WS-UPC-12                    30020000
300300              MOVE ZERO           TO WS-UPC-ZERO                  30030000
300400              MOVE WS-UPC-13      TO WS-UPC-CODE-X                30040000
300500              IF WS-UPC-CODE-X  NUMERIC                           30050000
300600                 MOVE WS-UPC-CODE TO WS-UPC-CODE-COMP3            30060000
300700                 IF WS-UPC-CODE-COMP3 NOT = TUPCSKU-UPC-NBR       30070000
300800                    PERFORM R400-SELECT-TUPCSKU                   30080000
300900                 END-IF                                           30090000
301000              ELSE                                                30100000
301100                 SET WS-NOT-VALID-UPC TO TRUE                     30110000
301200              END-IF                                              30120000
301300              IF WS-NOT-VALID-UPC                                 30130000
301400                 CONTINUE                                         30140000
301500              ELSE                                                30150000
301600                 PERFORM R450-SELECT-POLNE-BY-ITEM-NBR            30160000
301700                 MOVE PURITM-PO-LNE-NBR TO AP052-PO-LNE-NBR       30170000
301800                 MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX)         30180000
301900              END-IF                                              30190000
302000           ELSE                                                   30200000
302100              IF AP052-EAN                                        30210000
302200                 MOVE AP052-EAN-CODE TO WS-UPC-CODE-X             30220000
302300                 IF WS-UPC-CODE-X  NUMERIC                        30230000
302400                    MOVE WS-UPC-CODE TO WS-UPC-CODE-COMP3         30240000
302500                    IF WS-UPC-CODE-COMP3 NOT = TUPCSKU-UPC-NBR    30250000
302600                       PERFORM R400-SELECT-TUPCSKU                30260000
302700                    END-IF                                        30270000
302800                 ELSE                                             30280000
302900                    SET WS-NOT-VALID-UPC TO TRUE                  30290000
303000                 END-IF                                           30300000
303100                 IF WS-NOT-VALID-UPC                              30310000
303200                    CONTINUE                                      30320000
303300                 ELSE                                             30330000
303400                    PERFORM R450-SELECT-POLNE-BY-ITEM-NBR         30340000
303500                    MOVE PURITM-PO-LNE-NBR TO AP052-PO-LNE-NBR    30350000
303600                    MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX)      30360000
303700              END-IF                                              30370000
303800           END-IF                                                 30380000
303900        END-IF                                                    30390000
304000     END-IF.                                                      30400000
304100                                                                  30410000
304200*---------------------------------------------------------------  30420000
304300* IF THE UPC IS NOT SENT OR IS NOT VALID,                         30430000
304400* RETRIEVE THE PO_LNE_NBR FROM THE TPURITM TABLE                  30440000
304500* WITH THE STYLE CODE.                                            30450000
304600*---------------------------------------------------------------  30460000
304700                                                                  30470000
304800     IF AP052-RECORD-TYPE-IND = '07'                              30480000
304900        IF AP052-PO-LNE-NBR NOT = ZEROS                           30490000
305000           CONTINUE                                               30500000
305100        ELSE                                                      30510000
305200           IF AP052-VENDOR-STYLE NOT = SPACES                     30520000
305300              MOVE AP052-VENDOR-STYLE TO WS-STYLE                 30530000
305400              MOVE SPACES TO WS-STYLE2                            30540000
305500              INSPECT WS-STYLE REPLACING LEADING '0' BY ' '       30550000
305600              SET STYLE-INDX2 TO 1                                30560000
305700              PERFORM VARYING STYLE-INDX FROM 1 BY 1              30570000
305800                UNTIL STYLE-INDX > 20                             30580000
305900                IF WS-STYLE-ONE(STYLE-INDX) = ' ' OR '-' OR '/'   30590000
306000                   CONTINUE                                       30600000
306100                ELSE                                              30610000
306200                   MOVE WS-STYLE-ONE(STYLE-INDX) TO               30620000
306300                           WS-STYLE2-ONE(STYLE-INDX2)             30630000
306400                   SET STYLE-INDX2 UP BY 1                        30640000
306500                END-IF                                            30650000
306600              END-PERFORM                                         30660000
306700              PERFORM R485-SELECT-PO-LNE-NBR                      30670000
306800              MOVE PURITM-PO-LNE-NBR TO AP052-PO-LNE-NBR          30680000
306900                                                                  30690000
307000              MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX)            30700000
307100           END-IF                                                 30710000
307200        END-IF                                                    30720000
307300     END-IF.                                                      30730000
307400                                                                  30740000
307515                                                                  30751500
307520*---------------------------------------------------------------  30752000
307600* ALLOWANCE OR CHARGE VALIDATION                                  30760000
307700*---------------------------------------------------------------  30770000
307800                                                                  30780000
307900     IF AP052-RECORD-TYPE-IND = '05'                              30790000
308000        IF NOT AP052-NO-ALLW-CHGS                                 30800000
308100           IF AP052-ALLW-CHRG-TOTAL > 0                           30810000
308200             AND                                                  30820000
308300              AP052-ALLW-CHRG-PCT > 0                             30830000
308400              IF REJ-INDX NOT = 25                                30840000
308500                 SET REJ-INDX UP BY 1                             30850000
308600              END-IF                                              30860000
308700              SET ERROR-EDI TO TRUE                               30870000
308800              SET NOT-BOTH-ALLW-CHRG-CD TO TRUE                   30880000
308900              MOVE EDI-ERROR-CD TO                                30890000
309000                           WS-INV-ERR-CD(INV-INDX, REJ-INDX)      30900000
309100           ELSE                                                   30910000
309200              IF AP052-ALLW-CHRG-TOTAL = 0                        30920000
309300                AND                                               30930000
309400                 AP052-ALLW-CHRG-PCT   = 0                        30940000
309500                 IF REJ-INDX NOT = 25                             30950000
309600                    SET REJ-INDX UP BY 1                          30960000
309700                 END-IF                                           30970000
309800                 SET ERROR-EDI TO TRUE                            30980000
309900                 SET ONE-ALLW-CHRG-CD TO TRUE                     30990000
310000                 MOVE EDI-ERROR-CD TO                             31000000
310100                           WS-INV-ERR-CD(INV-INDX, REJ-INDX)      31010000
310200              END-IF                                              31020000
310300           END-IF                                                 31030000
310400        END-IF                                                    31040000
310500     END-IF.                                                      31050000
310600                                                                  31060000
310700*--------------------------------------------------------------*  31070000
310800* STORE1 IS DETERMINED TO BE A VALID STORE (WS-VALID-STORE1).  *  31080000
310900*                                                              *  31090000
311000* PERFORMS AN EQUALITY CHECK ON THE VALUES OF STORE1 AND STORE2*  31100000
311100* TO DETERMINE THE VALUES FOR THE AP052-KOHLS-STORE-TO-USE AND *  31110000
311200* AP052-KOHLS-DC-TO-USE OUTPUT FIELDS.  THE                    *  31120000
311300* AP052-KOHLS-MTCH-LVL-TO-USE FIELD IS SET TO STORE SINCE THE  *  31130000
311400* STORE1 VALUE WAS ALREADY DETERMINED TO BE VALID.             *  31140000
311500*                                                              *  31150000
311600* IF THE VALUES IN STORE1 AND STORE2 ARE EQUAL AND THE PO IS   *  31160000
311700* A DIRECT STORE PO (PURCHS-DIR-STR-IND = 'Y'), THE STORE1     *  31170000
311800* VALUE IS MOVED TO THE AP052-KOHLS-DC-TO-USE FIELD.  THIS IS  *  31180000
311900* DONE BECAUSE A DIRECT STORE PO IS SHIPPED DIRECTLY TO THE    *  31190000
312000* STORE; NO DC IS INVOLVED.  IF THE PO IS NOT A DIRECT STORE   *  31200000
312100* PO, THE DC NUMBER IS LOOKED UP BY EITHER ROUTINE             *  31210000
312200* R375-DETERMINE-DC-NBR OR R385-DETERMINE-DC-NBR DEPENDING ON  *  31220000
312300* THE STORE TYPE.  THE RETURNED VALUE IS MOVED TO THE          *  31230000
312400* AP052-KOHLS-DC-TO-USE-FIELD.                                 *  31240000
312500*                                                              *  31250000
312600* IF THE VALUES IN STORE1 AND STORE2 ARE NOT EQUAL, STORE2 IS  *  31260000
312700* VALIDATED BY ROUTINE R350-VALIDATE-STORE2.  IF STORE2 IS A   *  31270000
312800* VALID STORE, THE INVOICE WILL BE REJECTED SINCE THERE SHOULD *  31280000
312900* ONLY BE ONE VALID STORE NUMBER FOR A BY-STORE MATCH.  IF     *  31290000
313000* STORE2 IS A VALID DC AND THE PO IS A DIRECT STORE PO         *  31300000
313100* (PURCHS-DIR-STR-IND = 'Y'), THE VALUE OF STORE1 IS MOVED TO  *  31310000
313200* THE AP052-KOHLS-DC-TO-USE FIELD.  IF THE PO IS NOT A DIRECT  *  31320000
313300* STORE PO, THE VALUE OF STORE2 IS MOVED TO THE                *  31330000
313400* AP052-KOHLS-DC-TO-USE FIELD.                                 *  31340000
313500*                                                              *  31350000
313600* IF STORE2 IS A VALID IMPORT OR AN INVALID STORE NUMBER AND   *  31360000
313700* THE PO IS A DIRECT STORE PO (PURCHS-DIR-STR-IND = 'Y'), THE  *  31370000
313800* VALUE OF STORE1 IS MOVED TO THE AP052-KOHLS-DC-TO-USE FIELD. *  31380000
313900* IF THE PO IS NOT A DIRECT STORE PO, THE DC NUMBER IS LOOKED  *  31390000
314000* UP BY EITHER ROUTINE R375-DETERMINE-DC-NUMBER OR             *  31400000
314100* R385-DETERMINE-DC-NUMBER DEPENDING ON THE STORE TYPE.  THE   *  31410000
314200* RETURNED VALUE IS MOVED TO THE AP052-KOHLS-DC-TO-USE FIELD   *  31420000
314300* AND A WARNING MESSAGE IS GENERATED.                          *  31430000
314400*--------------------------------------------------------------*  31440000
314500 E205-STORE1-IS-VALID-STORE.                                      31450000
314600                                                                  31460000
314700     MOVE 'S'  TO AP052-SORT-MTCH-LVL                             31470000
314800                  AP052-KOHLS-MTCH-LVL-TO-USE                     31480000
314900                  WS-MTCH-LVL.                                    31490000
315000                                                                  31500000
315100     MOVE AP052-KOHLS-STORE-NBR1      TO AP052-KOHLS-STORE-TO-USE 31510000
315200                                         WS-STORE-TO-USE.         31520000
315300     IF AP052-KOHLS-STORE-NBR1 = AP052-KOHLS-STORE-NBR2           31530000
315400        IF PURCHS-DIR-STR-IND = 'Y'                               31540000
315500           MOVE AP052-KOHLS-STORE-NBR1 TO AP052-KOHLS-DC-TO-USE   31550000
315600        ELSE                                                      31560000
315700           PERFORM E255-GET-DC-NBR-FOR-STORE1                     31570000
315800        END-IF                                                    31580000
315900     ELSE                                                         31590000
316000        MOVE AP052-KOHLS-STORE-NBR2   TO WS-SAVE-STORE-NBR2       31600000
316100        PERFORM R350-VALIDATE-STORE2                              31610000
316200        IF WS-VALID-STORE2-DS OR WS-VALID-STORE2-CS               31620000
316300           IF REJ-INDX NOT = 25                                   31630000
316400              SET REJ-INDX UP BY 1                                31640000
316500           END-IF                                                 31650000
316600           SET ERROR-EDI              TO TRUE                     31660000
316700           SET STORE-NBRS-NOT-EQUAL   TO TRUE                     31670000
316800           MOVE EDI-ERROR-CD TO WS-INV-ERR-CD(INV-INDX, REJ-INDX) 31680000
316900        ELSE                                                      31690000
317000           IF WS-VALID-DC2                                        31700000
317100              IF PURCHS-DIR-STR-IND = 'Y'                         31710000
317200                 MOVE AP052-KOHLS-STORE-NBR1                      31720000
317300                   TO AP052-KOHLS-DC-TO-USE                       31730000
317400              ELSE                                                31740000
317500                 MOVE AP052-KOHLS-STORE-NBR2                      31750000
317600                   TO AP052-KOHLS-DC-TO-USE                       31760000
317700              END-IF                                              31770000
317800           ELSE                                                   31780000
317900              IF WS-VALID-PO2                                     31790000
318000                 IF PURCHS-DIR-STR-IND = 'Y'                      31800000
318100                    MOVE AP052-KOHLS-STORE-NBR1                   31810000
318200                      TO AP052-KOHLS-DC-TO-USE                    31820000
318300                 ELSE                                             31830000
318400                    PERFORM E255-GET-DC-NBR-FOR-STORE1            31840000
318500                 END-IF                                           31850000
318600                 PERFORM E235-GENERATE-WARNING5-MSG               31860000
318700              ELSE                                                31870000
318800                 IF PURCHS-DIR-STR-IND = 'Y'                      31880000
318900                    MOVE AP052-KOHLS-STORE-NBR1                   31890000
319000                      TO AP052-KOHLS-DC-TO-USE                    31900000
319100                 ELSE                                             31910000
319200                    PERFORM E255-GET-DC-NBR-FOR-STORE1            31920000
319300                 END-IF                                           31930000
319400                 IF AP052-KOHLS-STORE-NBR2 = PC-ZERO-STR          31940000
319500                    CONTINUE                                      31950000
319600                 ELSE                                             31960000
319700                    PERFORM E240-GENERATE-WARNING6-MSG            31970000
319800                 END-IF                                           31980000
319900              END-IF                                              31990000
320000           END-IF                                                 32000000
320100        END-IF                                                    32010000
320200     END-IF.                                                      32020000
320300                                                                  32030000
320400     MOVE WS-WORK-REC              TO WS-INV-REC(INV-INDX).       32040000
320500                                                                  32050000
320600*--------------------------------------------------------------*  32060000
320700* STORE1 IS DETERMINED TO BE A VALID DC (WS-VALID-DC1).        *  32070000
320800*                                                              *  32080000
320900* PERFORMS AN EQUALITY CHECK ON THE VALUES OF STORE1 AND STORE2*  32090000
321000* TO DETERMINE THE VALUES FOR THE AP052-KOHLS-MTCH-LVL-TO-USE, *  32100000
321100* AP052-KOHLS-STORE-TO-USE, AND AP052-KOHLS-DC-TO-USE FIELDS.  *  32110000
321200*                                                              *  32120000
321300* IF THE VALUES OF STORE1 AND STORE2 ARE EQUAL AND THE PO IS   *  32130000
321400* NOT A DIRECT STORE PO (PURCHS-DIR-STR-IND = 'N'), THE        *  32140000
321500* AP052-KOHLS-MTCH-LVL-TO-USE FIELD IS SET TO DC WHILE BOTH THE*  32150000
321600* AP052-KOHLS-STORE-TO-USE AND AP052-KOHLS-DC-TO-USE FIELDS ARE*  32160000
321700* SET TO THE STORE1 VALUE.  IF THE PO IS A DIRECT STORE PO, AN *  32170000
321800* ERROR MESSAGE IS GENERATED.  DIRECT STORE PURCHASE ORDERS    *  32180000
321900* SHOULD ONLY CONTAIN STORE VALUES SINCE THE INVOICE           *  32190000
322000* MERCHANDISE IS SHIPPED DIRECTLY TO THE STORE; NO DC IS       *  32200000
322100* INVOLVED.                                                    *  32210000
322200*                                                              *  32220000
322300* IF THE VALUES OF STORE1 AND STORE2 ARE NOT EQUAL, STORE 2 IS *  32230000
322400* VALIDATED BY ROUTINE R350-VALIDATE-STORE2.  IF STORE2 IS     *  32240000
322500* A VALID STORE AND THE PO IS NOT A DIRECT STORE PO            *  32250000
322600* (PURCHS-DIR-STR-IND = 'N'), THE AP052-KOHLS-MTCH-LVL-TO-USE  *  32260000
322700* FIELD IS SET TO STORE WHILE THE AP052-KOHLS-STORE-TO-USE     *  32270000
322800* FIELD IS SET TO THE VALUE OF STORE2 AND THE                  *  32280000
322900* AP052-KOHLS-DC-TO-USE FILED IS SET TO THE VALUE OF STORE1.   *  32290000
323000* IF THE PO IS A DIRECT STORE PO THE VALUE OF STORE2 IS MOVED  *  32300000
323100* TO BOTH THE AP052-KOHLS-STORE-TO-USE AND                     *  32310000
323200* AP052-KOHLS-DC-TO-USE FIELDS WHILE THE                       *  32320000
323300* AP052-KOHLS-MTCH-LVL-TO-USE IS SET TO STORE.                 *  32330000
323400*                                                              *  32340000
323500* IF STORE2 IS A VALID DC, THE INVOICE WILL BE REJECTED SINCE  *  32350000
323600* THERE SHOULD ONLY BE ONE VALID DC NUMBER FOR A BY-DC MATCH.  *  32360000
323700* IF STORE2 IS A VALID IMPORT OR AN INVALID STORE NUMBER AND   *  32370000
323800* THE PO IS NOT A DIRECT STORE PO (PURCHS-DIR-STR-IND = 'N'),  *  32380000
323900* THE VALUE OF STORE1 IS MOVED TO BOTH THE                     *  32390000
324000* AP052-KOHLS-STORE-TO-USE AND AP052-KOHLS-DC-TO-USE FIELDS    *  32400000
324100* WHILE THE AP052-KOHLS-MTCH-LVL-TO-USE IS SET TO DC.  A       *  32410000
324200* WARNING MESSAGE IS GENERATED IN EACH OF THESE INSTANCES.  IF *  32420000
324300* THE PO IS A DIRECT STORE PO, AN ERROR MESSAGE IS ISSUED.     *  32430000
324400*--------------------------------------------------------------*  32440000
324500 E210-STORE1-IS-VALID-DC.                                         32450000
324600                                                                  32460000
324700     IF AP052-KOHLS-STORE-NBR1 = AP052-KOHLS-STORE-NBR2           32470000
324800        IF PURCHS-DIR-STR-IND = 'N'                               32480000
324900           MOVE AP052-KOHLS-STORE-NBR1 TO AP052-KOHLS-STORE-TO-USE32490000
325000                                          AP052-KOHLS-DC-TO-USE   32500000
325100                                          WS-STORE-TO-USE         32510000
325200           MOVE 'D'               TO AP052-SORT-MTCH-LVL          32520000
325300                                     AP052-KOHLS-MTCH-LVL-TO-USE  32530000
325400                                     WS-MTCH-LVL                  32540000
325500        ELSE                                                      32550000
325600           PERFORM E245-GENERATE-DRCT-STR-ERR                     32560000
325700        END-IF                                                    32570000
325800     ELSE                                                         32580000
325900        MOVE AP052-KOHLS-STORE-NBR2 TO WS-SAVE-STORE-NBR2         32590000
326000        PERFORM R350-VALIDATE-STORE2                              32600000
326100        IF WS-VALID-STORE2-DS OR WS-VALID-STORE2-CS               32610000
326200           IF PURCHS-DIR-STR-IND = 'N'                            32620000
326300              MOVE AP052-KOHLS-STORE-NBR2                         32630000
326400                TO AP052-KOHLS-STORE-TO-USE                       32640000
326500                   WS-STORE-TO-USE                                32650000
326600              MOVE AP052-KOHLS-STORE-NBR1                         32660000
326700                TO AP052-KOHLS-DC-TO-USE                          32670000
326800           ELSE                                                   32680000
326900              MOVE AP052-KOHLS-STORE-NBR2                         32690000
327000                TO AP052-KOHLS-STORE-TO-USE                       32700000
327100                   AP052-KOHLS-DC-TO-USE                          32710000
327200                   WS-STORE-TO-USE                                32720000
327300           END-IF                                                 32730000
327400           MOVE 'S'                TO AP052-SORT-MTCH-LVL         32740000
327500                                      AP052-KOHLS-MTCH-LVL-TO-USE 32750000
327600                                      WS-MTCH-LVL                 32760000
327700        ELSE                                                      32770000
327800           IF WS-VALID-DC2                                        32780000
327900              IF REJ-INDX NOT = 25                                32790000
328000                 SET REJ-INDX UP BY 1                             32800000
328100              END-IF                                              32810000
328200              SET ERROR-EDI TO TRUE                               32820000
328300              SET DC-NBRS-NOT-EQUAL TO TRUE                       32830000
328400              MOVE EDI-ERROR-CD                                   32840000
328500                TO WS-INV-ERR-CD(INV-INDX, REJ-INDX)              32850000
328600           ELSE                                                   32860000
328700              IF WS-VALID-PO2                                     32870000
328800                 IF PURCHS-DIR-STR-IND = 'N'                      32880000
328900                    PERFORM E235-GENERATE-WARNING5-MSG            32890000
329000                    MOVE AP052-KOHLS-STORE-NBR1                   32900000
329100                      TO AP052-KOHLS-STORE-TO-USE                 32910000
329200                         AP052-KOHLS-DC-TO-USE                    32920000
329300                         WS-STORE-TO-USE                          32930000
329400                    MOVE 'D'       TO AP052-SORT-MTCH-LVL         32940000
329500                                      AP052-KOHLS-MTCH-LVL-TO-USE 32950000
329600                                      WS-MTCH-LVL                 32960000
329700                 ELSE                                             32970000
329800                    PERFORM E245-GENERATE-DRCT-STR-ERR            32980000
329900                 END-IF                                           32990000
330000              ELSE                                                33000000
330100                 IF PURCHS-DIR-STR-IND = 'N'                      33010000
330200                    IF AP052-KOHLS-STORE-NBR2 = PC-ZERO-STR       33020000
330300                       CONTINUE                                   33030000
330400                    ELSE                                          33040000
330500                       PERFORM E240-GENERATE-WARNING6-MSG         33050000
330600                    END-IF                                        33060000
330700                    MOVE AP052-KOHLS-STORE-NBR1                   33070000
330800                      TO AP052-KOHLS-STORE-TO-USE                 33080000
330900                         AP052-KOHLS-DC-TO-USE                    33090000
331000                         WS-STORE-TO-USE                          33100000
331100                    MOVE 'D'       TO AP052-SORT-MTCH-LVL         33110000
331200                                      AP052-KOHLS-MTCH-LVL-TO-USE 33120000
331300                                      WS-MTCH-LVL                 33130000
331400                 ELSE                                             33140000
331500                    PERFORM E245-GENERATE-DRCT-STR-ERR            33150000
331600                 END-IF                                           33160000
331700              END-IF                                              33170000
331800           END-IF                                                 33180000
331900        END-IF                                                    33190000
332000     END-IF.                                                      33200000
332100                                                                  33210000
332200     MOVE WS-WORK-REC        TO WS-INV-REC(INV-INDX).             33220000
332300                                                                  33230000
332400*--------------------------------------------------------------*  33240000
332500* STORE1 IS DETERMINED TO BE A VALID IMPORT (WS-VALID-PO1).    *  33250000
332600*                                                              *  33260000
332700* IF THE VALUES OF STORE1 AND STORE2 ARE EQUAL AND THE PO IS   *  33270000
332800* NOT A DIRECT STORE PO (PURCHS-DIR-STR-IND = 'N'), THE        *  33280000
332900* AP052-KOHLS-MTCH-LVL-TO-USE FIELD IS SET TO BULK WHILE THE   *  33290000
333000* AP052-KOHLS-STORE-TO-USE AND AP052-KOHLS-DC-TO-USE ARE SET   *  33300000
333100* TO ZERO.  IF THE PO IS A DIRECT STORE PO, AN ERROR MESSAGE   *  33310000
333200* IS GENERATED.  DIRECT STORE PURCHASE ORDERS SHOULD ONLY      *  33320000
333300* CONTAIN STORE VALUES SINCE THE INVOICE MERCHANDISE IS SHIPPED*  33330000
333400* DIRECTLY TO THE STORE; DCS AND COPORATE ARE NOT INVOLVED.    *  33340000
333500*                                                              *  33350000
333600* IF THE VALUES OF STORE1 AND STORE2 ARE NOT EQUAL, STORE2 IS  *  33360000
333700* VALIDATED BY ROUTINE R350-VALIDATE-STORE2.  IF STORE2 IS A   *  33370000
333800* VALID STORE AND THE PO IS NOT A DIRECT STORE PO              *  33380000
333900* (PURCHS-DIR-STR-IND = 'N'), THE AP052-KOHLS-MTCH-LVL-TO-USE  *  33390000
334000* FIELD IS SET TO STORE WHILE THE AP052-KOHLS-STORE-TO-USE     *  33400000
334100* FIELD IS SET TO THE VALUE OF STORE2.  THE DC NUMBER IS LOOKED*  33410000
334200* UP BY EITHER ROUTINE R375-DETERMINE-DC-NUMBER OR             *  33420000
334300* R385-DETERMINE-DC-NUMBER DEPENDING ON THE STORE TYPE.  THE   *  33430000
334400* RETURNED VALUE IS MOVED TO THE APK052-KOHLS-DC-TO-USE FIELD. *  33440000
334500*                                                              *  33450000
334600* IF STORE2 IS A VALID DC AND THE PO IS NOT A DIRECT STORE PO, *  33460000
334700* (PURCHS-DIR-STR-IND = 'N') THE AP052-KOHLS-MTCH-LVL-TO-USE   *  33470000
334800* FIELD IS SET TO DC WHILE THE AP052-KOHLS-STORE-TO-USE AND    *  33480000
334900* AP052-KOHLS-DC-TO-USE FIELDS ARE SET TO THE VALUE OF STORE2. *  33490000
335000* IF THE PO IS A DIRECT STORE PO, AN ERROR MESSAGE IS ISSUED.  *  33500000
335100*                                                              *  33510000
335200* IF STORE2 IS A VALID IMPORT OR AN INVALID STORE NUMBER AND   *  33520000
335300* THE PO IS NOT A DIRECT STORE PO (PURCHS-DIR-STR-IND = 'N'),  *  33530000
335400* THE AP052-KOHLS-MTCH-LVL-TO-USE FIELD IS SET TO BULK WHILE   *  33540000
335500* THE AP052-KOHLS-STORE-TO-USE AND AP052-KOHLS-DC-TO-USE FIELDS*  33550000
335600* ARE SET TO ZERO.  IF THE PO IS A DIRECT STORE PO, AN ERROR   *  33560000
335700* MESSAGE IS GENERATED.                                        *  33570000
335800*--------------------------------------------------------------*  33580000
335900 E215-STORE1-IS-VALID-IMPORT.                                     33590000
336000                                                                  33600000
336100     IF AP052-KOHLS-STORE-NBR1 = AP052-KOHLS-STORE-NBR2           33610000
336200        IF PURCHS-DIR-STR-IND = 'N'                               33620000
336300           MOVE ZERO           TO AP052-KOHLS-STORE-TO-USE        33630000
336400                                  AP052-KOHLS-DC-TO-USE           33640000
336500                                  WS-STORE-TO-USE                 33650000
336600           MOVE 'P'            TO AP052-SORT-MTCH-LVL             33660000
336700                                  AP052-KOHLS-MTCH-LVL-TO-USE     33670000
336800                                  WS-MTCH-LVL                     33680000
336900        ELSE                                                      33690000
337000           PERFORM E245-GENERATE-DRCT-STR-ERR                     33700000
337100        END-IF                                                    33710000
337200     ELSE                                                         33720000
337300        MOVE AP052-KOHLS-STORE-NBR2 TO WS-SAVE-STORE-NBR2         33730000
337400        PERFORM R350-VALIDATE-STORE2                              33740000
337500        IF WS-VALID-STORE2-DS OR WS-VALID-STORE2-CS               33750000
337600           IF PURCHS-DIR-STR-IND = 'N'                            33760000
337700              MOVE AP052-KOHLS-STORE-NBR2                         33770000
337800                TO AP052-KOHLS-STORE-TO-USE                       33780000
337900                   WS-STORE-TO-USE                                33790000
338000              PERFORM E260-GET-DC-NBR-FOR-STORE2                  33800000
338100           ELSE                                                   33810000
338200              MOVE AP052-KOHLS-STORE-NBR2                         33820000
338300                TO AP052-KOHLS-STORE-TO-USE                       33830000
338400                   AP052-KOHLS-DC-TO-USE                          33840000
338500                   WS-STORE-TO-USE                                33850000
338600           END-IF                                                 33860000
338700           MOVE 'S'              TO AP052-SORT-MTCH-LVL           33870000
338800                                    AP052-KOHLS-MTCH-LVL-TO-USE   33880000
338900                                    WS-MTCH-LVL                   33890000
339000        ELSE                                                      33900000
339100           IF WS-VALID-DC2                                        33910000
339200              IF PURCHS-DIR-STR-IND = 'N'                         33920000
339300                 MOVE 'D'          TO AP052-SORT-MTCH-LVL         33930000
339400                                      AP052-KOHLS-MTCH-LVL-TO-USE 33940000
339500                                      WS-MTCH-LVL                 33950000
339600                 MOVE AP052-KOHLS-STORE-NBR2                      33960000
339700                   TO AP052-KOHLS-STORE-TO-USE                    33970000
339800                      AP052-KOHLS-DC-TO-USE                       33980000
339900                      WS-STORE-TO-USE                             33990000
340000              ELSE                                                34000000
340100                 PERFORM E245-GENERATE-DRCT-STR-ERR               34010000
340200              END-IF                                              34020000
340300           ELSE                                                   34030000
340400              IF PURCHS-DIR-STR-IND = 'N'                         34040000
340500                 MOVE ZERO      TO AP052-KOHLS-STORE-TO-USE       34050000
340600                                   AP052-KOHLS-DC-TO-USE          34060000
340700                                   WS-STORE-TO-USE                34070000
340800                 MOVE 'P'       TO AP052-SORT-MTCH-LVL            34080000
340900                                   AP052-KOHLS-MTCH-LVL-TO-USE    34090000
341000                                   WS-MTCH-LVL                    34100000
341100              ELSE                                                34110000
341200                 PERFORM E245-GENERATE-DRCT-STR-ERR               34120000
341300              END-IF                                              34130000
341400           END-IF                                                 34140000
341500        END-IF                                                    34150000
341600     END-IF.                                                      34160000
341700                                                                  34170000
341800     MOVE WS-WORK-REC              TO WS-INV-REC(INV-INDX).       34180000
341900                                                                  34190000
342000*--------------------------------------------------------------*  34200000
342100* STORE1 IS DETERMINED TO BE AN INVALID STORE                  *  34210000
342200* (WS-NOT-VALID-STORE1).                                       *  34220000
342300*                                                              *  34230000
342400* PERFORMS AN EQUALITY CHECK ON THE VALUES OF STORE1 AND STORE2*  34240000
342500* TO DETERMINE THE VALUES FOR THE AP052-KOHLS-MTCH-LVL-TO-USE, *  34250000
342600* AP052-KOHLS-STORE-TO-USE, AND AP052-KOHLS-DC-TO-USE FIELDS.  *  34260000
342700*                                                              *  34270000
342800* IF THE VALUES OF STORE1 AND STORE2 ARE EQUAL, THE INVOICE IS *  34280000
342900* REJECTED SINCE BOTH STORES ARE INVALID.  IF THEY ARE NOT     *  34290000
343000* EQUAL, STORE2 IS VALIDATED BY ROUTINE R350-VALIDATE-STORE2.  *  34300000
343100* IF STORE2 IS A VALID STORE AND THE PO IS NOT A DIRECT STORE  *  34310000
343200* PO (PURCHS-DIR-STR-IND = 'N'), THE                           *  34320000
343300* AP052-KOHLS-MTCH-LVL-TO-USE FIELD IS SET TO STORE WHILE THE  *  34330000
343400* AP052-KOHLS-STORE-TO-USE FIELD IS SET TO THE VALUE OF STORE2.*  34340000
343500* THE DC NUMBER IS LOOKED UP BY EITHER ROUTINE                 *  34350000
343600* R375-DETERMINE-DC-NBR OR R385-DETERMINE-DC-NBR DEPENDING ON  *  34360000
343700* THE STORE TYPE.  THE RETURNED VALUE IS MOVED TO THE          *  34370000
343800* AP052-KOHLS-DC-TO-USE FIELD.  IF THE PO IS A DIRECT STORE PO *  34380000
343900* THE AP052-KOHLS-MTCH-LVL-TO-USE FIELD IS SET TO STORE WHILE  *  34390000
344000* THE AP052-KOHLS-STORE-TO-USE AND AP052-KOHLS-DC-TO-USE ARE   *  34400000
344100* BOTH SET TO THE VALUE OF STORE2.                             *  34410000
344200*                                                              *  34420000
344300* IF STORE2 IS A VALID DC AND THE PO IS NOT A DIRECT STORE PO  *  34430000
344400* (PURCHS-DIR-STR-IND = 'N'), THE AP052-KOHLS-DC-TO-USE FIELD  *  34440000
344500* IS SET TO DC WHILE THE AP052-KOHLS-STORE-TO-USE AND          *  34450000
344600* AP052-KOHLS-DC-TO-USE FIELDS ARE SET TO THE VALUE OF STORE2. *  34460000
344700* IF THE PO IS A DIRECT STORE PO, AN ERROR MESSAGE IS ISSUED.  *  34470000
344800* DIRECT STORE PURCHASE ORDERS SHOULD ONLY CONTAIN STORE VALUES*  34480000
344900* SINCE THE INVOICE MERCHANDISE IS SHIPPED DIRECTLY TO THE     *  34490000
345000* STORE; NO DC IS INVOLVED.                                    *  34500000
345100*                                                              *  34510000
345200* IF STORE2 IS AN IMPORT PO AND THE PO IS NOT A DIRECT STORE PO*  34520000
345300* (PURCHS-DIR-STR-IND = 'N'), THE AP052-KOHLS-MTCH-LVL-TO-USE  *  34530000
345400* FIELD IS SET TO BULK WHILE THE AP052-KOHLS-STORE-TO-USE AND  *  34540000
345500* AP052-KOHLS-DC-TO-USE FIELDS ARE SET TO ZEROS.  IF THE PO IS *  34550000
345600* A DIRECT STORE PO, AN ERROR MESSAGE IS GENERATED.  LASTLY, IF*  34560000
345700* STORE2 IS AN INVALID STORE NUMBER, THE INVOICE WILL BE       *  34570000
345800* REJECTED BECAUSE THE VALUES OF BOTH STORE1 AND STORE2 WERE   *  34580000
345900* INVALID.                                                     *  34590000
346000*--------------------------------------------------------------*  34600000
346100 E220-STORE1-IS-INVALID-STORE.                                    34610000
346200                                                                  34620000
346300     IF AP052-KOHLS-STORE-NBR1 = AP052-KOHLS-STORE-NBR2           34630000
346400        IF REJ-INDX NOT = 25                                      34640000
346500           SET REJ-INDX UP BY 1                                   34650000
346600        END-IF                                                    34660000
346700        SET ERROR-EDI TO TRUE                                     34670000
346800        SET STORE-NBR-NOT-VALID TO TRUE                           34680000
346900        MOVE EDI-ERROR-CD                                         34690000
347000          TO WS-INV-ERR-CD(INV-INDX, REJ-INDX)                    34700000
347100     ELSE                                                         34710000
347200        MOVE AP052-KOHLS-STORE-NBR2 TO WS-SAVE-STORE-NBR2         34720000
347300        PERFORM R350-VALIDATE-STORE2                              34730000
347400        IF WS-VALID-STORE2-DS OR WS-VALID-STORE2-CS               34740000
347500           IF PURCHS-DIR-STR-IND = 'N'                            34750000
347600              MOVE AP052-KOHLS-STORE-NBR2                         34760000
347700                TO AP052-KOHLS-STORE-TO-USE                       34770000
347800                   WS-STORE-TO-USE                                34780000
347900              PERFORM E260-GET-DC-NBR-FOR-STORE2                  34790000
348000           ELSE                                                   34800000
348100              MOVE AP052-KOHLS-STORE-NBR2                         34810000
348200                TO AP052-KOHLS-STORE-TO-USE                       34820000
348300                   AP052-KOHLS-DC-TO-USE                          34830000
348400                   WS-STORE-TO-USE                                34840000
348500           END-IF                                                 34850000
348600           MOVE 'S'            TO AP052-SORT-MTCH-LVL             34860000
348700                                  AP052-KOHLS-MTCH-LVL-TO-USE     34870000
348800                                  WS-MTCH-LVL                     34880000
348900        ELSE                                                      34890000
349000           IF WS-VALID-DC2                                        34900000
349100              IF PURCHS-DIR-STR-IND = 'N'                         34910000
349200                 MOVE 'D'          TO AP052-SORT-MTCH-LVL         34920000
349300                                      AP052-KOHLS-MTCH-LVL-TO-USE 34930000
349400                                      WS-MTCH-LVL                 34940000
349500                 MOVE AP052-KOHLS-STORE-NBR2                      34950000
349600                   TO AP052-KOHLS-STORE-TO-USE                    34960000
349700                      AP052-KOHLS-DC-TO-USE                       34970000
349800                      WS-STORE-TO-USE                             34980000
349900              ELSE                                                34990000
350000                 PERFORM E245-GENERATE-DRCT-STR-ERR               35000000
350100              END-IF                                              35010000
350200           ELSE                                                   35020000
350300              IF WS-VALID-PO2                                     35030000
350400                 IF PURCHS-DIR-STR-IND = 'N'                      35040000
350500                    MOVE ZERO    TO AP052-KOHLS-STORE-TO-USE      35050000
350600                                    AP052-KOHLS-DC-TO-USE         35060000
350700                                    WS-STORE-TO-USE               35070000
350800                    MOVE 'P'     TO AP052-SORT-MTCH-LVL           35080000
350900                                    AP052-KOHLS-MTCH-LVL-TO-USE   35090000
351000                                    WS-MTCH-LVL                   35100000
351100                 ELSE                                             35110000
351200                    PERFORM E245-GENERATE-DRCT-STR-ERR            35120000
351300                 END-IF                                           35130000
351400              ELSE                                                35140000
351500                 IF REJ-INDX NOT = 25                             35150000
351600                    SET REJ-INDX UP BY 1                          35160000
351700                 END-IF                                           35170000
351800                 SET ERROR-EDI TO TRUE                            35180000
351900                 SET STORE-NBR-NOT-VALID TO TRUE                  35190000
352000                 MOVE EDI-ERROR-CD                                35200000
352100                   TO WS-INV-ERR-CD(INV-INDX, REJ-INDX)           35210000
352200              END-IF                                              35220000
352300           END-IF                                                 35230000
352400        END-IF                                                    35240000
352500     END-IF.                                                      35250000
352600                                                                  35260000
352700     MOVE WS-WORK-REC               TO WS-INV-REC(INV-INDX).      35270000
352800                                                                  35280000
352900*--------------------------------------------------------------*  35290000
353000* CHECK TO SEE IF THE TOTAL ALLOWANCE CHARGE IS GREATER THAN   *  35300000
353100* THE CHARGE LIMIT AMOUNT.                                     *  35310000
353200*--------------------------------------------------------------*  35320000
353300*E225-VERIFY-OVER-LIMIT.                                          35330000
353400*                                                                 35340000
353500*    IF AP052-ALLW-CHRG-TOTAL > APCNTL-CHRG-LIMIT-AMT             35350000
353600*       OR ((AP052-ALLW-CHRG-PCT / 100)                           35360000
353700*            * WS-SAVE-GROSS-INVOICE-AMT) > APCNTL-CHRG-LIMIT-AMT 35370000
353800*                  SET CHRG-OVER-LIMIT TO TRUE                    35380000
353900*    END-IF.                                                      35390000
354000                                                                  35400000
354100*--------------------------------------------------------------*  35410000
354200* GENERATE THE WARNING4 MESSAGE (STORE NUMBER IS NOT 899 FOR   *  35420000
354300* AN IMPORT PO OR 907 FOR A LANDED PO).                        *  35430000
354400*--------------------------------------------------------------*  35440000
354500 E230-GENERATE-WARNING4-MSG.                                      35450000
354600                                                                  35460000
354700     IF REJ-INDX NOT = 25                                         35470000
354800        SET REJ-INDX UP BY 1                                      35480000
354900     END-IF.                                                      35490000
355000     SET PI-WARNING4-EXISTS          TO TRUE.                     35500000
355100     SET IMPORT-STORE-NBR-INVALID    TO TRUE.                     35510000
355200     MOVE EDI-ERROR-CD TO WS-INV-ERR-CD(INV-INDX, REJ-INDX).      35520000
355300                                                                  35530000
355400*--------------------------------------------------------------*  35540000
355500* GENERATE THE WARNING5 MESSAGE (STORE NUMBER IS 899 OR 907    *  35550000
355600* FOR A DOMESTIC PO).                                          *  35560000
355700*--------------------------------------------------------------*  35570000
355800 E235-GENERATE-WARNING5-MSG.                                      35580000
355900                                                                  35590000
356000     IF REJ-INDX NOT = 25                                         35600000
356100        SET REJ-INDX UP BY 1                                      35610000
356200     END-IF.                                                      35620000
356300     SET PI-WARNING5-EXISTS            TO TRUE.                   35630000
356400     SET INVALID-DOMESTIC-PO-STR-NBR   TO TRUE.                   35640000
356500     MOVE EDI-ERROR-CD TO WS-INV-ERR-CD(INV-INDX, REJ-INDX).      35650000
356600                                                                  35660000
356700*--------------------------------------------------------------*  35670000
356800* GENERATE THE WARNING6 MESSAGE (STORE NUMBER 2 IS INVALID).   *  35680000
356900*--------------------------------------------------------------*  35690000
357000 E240-GENERATE-WARNING6-MSG.                                      35700000
357100                                                                  35710000
357200     IF REJ-INDX NOT = 25                                         35720000
357300        SET REJ-INDX UP BY 1                                      35730000
357400     END-IF.                                                      35740000
357500     SET PI-WARNING6-EXISTS    TO TRUE.                           35750000
357600     SET STORE-NBR2-NOT-VALID  TO TRUE.                           35760000
357700     MOVE EDI-ERROR-CD TO WS-INV-ERR-CD(INV-INDX, REJ-INDX).      35770000
357800                                                                  35780000
357900*--------------------------------------------------------------*  35790000
358000* GENERATE AN ERROR MESSAGE WHEN A DC NUMBER OR BULK WAS SENT  *  35800000
358100* WHEN THE PURCHASE ORDER IS A DIRECT STORE PO.                *  35810000
358200*--------------------------------------------------------------*  35820000
358300 E245-GENERATE-DRCT-STR-ERR.                                      35830000
358400                                                                  35840000
358500     IF REJ-INDX NOT = 25                                         35850000
358600         SET REJ-INDX UP BY 1                                     35860000
358700     END-IF.                                                      35870000
358800     SET ERROR-EDI                       TO TRUE.                 35880000
358900     SET INVLD-DRCT-STR-PO-STR-NBR       TO TRUE.                 35890000
359000     MOVE EDI-ERROR-CD  TO WS-INV-ERR-CD(INV-INDX, REJ-INDX).     35900000
359100                                                                  35910000
359200*--------------------------------------------------------------*  35920000
359300* REJECT INVOICES THAT ARE:                                    *  35930000
359400*  A) NOT VALID CHARGE CODES                                   *  35940000
359500*  B) VALID GIFT WRAP OR HANDLING CHARGE CODES BUT DO NOT HAVE *  35950000
359600*     A PO TYPE CODE OF 'CD'.                                  *  35960000
359700*--------------------------------------------------------------*  35970000
359800 E250-REJECT-INVOICE.                                             35980000
359900                                                                  35990000
360000     IF REJ-INDX NOT = 25                                         36000000
360100        SET REJ-INDX UP BY 1                                      36010000
360200     END-IF.                                                      36020000
360300     SET ERROR-EDI       TO TRUE.                                 36030000
360400     SET INVALID-CHRG-CD TO TRUE.                                 36040000
360500     MOVE EDI-ERROR-CD   TO WS-INV-ERR-CD(INV-INDX, REJ-INDX).    36050000
360600                                                                  36060000
360700*--------------------------------------------------------------*  36070000
360800* GET THE DC NUMBER WHEN STORE NUMBER 1 IS VALID               *  36080000
360900*--------------------------------------------------------------*  36090000
361000 E255-GET-DC-NBR-FOR-STORE1.                                      36100000
361100                                                                  36110000
361200     MOVE AP052-KOHLS-STORE-NBR1   TO WS-SAVE-STORE-NBR-FOR-DC.   36120000
361300     MOVE WS-SAVE-STORE-NBR-FOR-DC TO WS-SAVE-DC-NBR.             36130000
361400     IF WS-VALID-STORE1-DS                                        36140000
361500        PERFORM R375-DETERMINE-DC-NBR                             36150000
361600        PERFORM X500-COMMIT                                       36160019
361700     ELSE                                                         36170000
361800        PERFORM R385-DETERMINE-DC-NBR                             36180000
361900        PERFORM X500-COMMIT                                       36190019
362000     END-IF.                                                      36200000
362100                                                                  36210000
362200*--------------------------------------------------------------*  36220000
362300* GET THE DC NUMBER WHEN STORE NUMBER 2 IS VALID               *  36230000
362400*--------------------------------------------------------------*  36240000
362500 E260-GET-DC-NBR-FOR-STORE2.                                      36250000
362600                                                                  36260000
362700     MOVE AP052-KOHLS-STORE-NBR2   TO WS-SAVE-STORE-NBR-FOR-DC.   36270000
362800     MOVE WS-SAVE-STORE-NBR-FOR-DC TO WS-SAVE-DC-NBR.             36280000
362900     IF WS-VALID-STORE2-DS                                        36290000
363000        PERFORM R375-DETERMINE-DC-NBR                             36300000
363100        PERFORM X500-COMMIT                                       36310019
363200     ELSE                                                         36320000
363300        PERFORM R385-DETERMINE-DC-NBR                             36330000
363400        PERFORM X500-COMMIT                                       36340019
363500     END-IF.                                                      36350000
363600                                                                  36360000
363700*--------------------------------------------------------------*  36370000
363800* CHECK TO SEE IF AN ALLOWANCE RECORD WILL NEED TO BE GENERATED*  36380000
363900* FOR THIS INVOICE FOR THE NEW STORE DISCOUNT OR THE TRADE     *  36390000
364000* DISCOUNT.                                                    *  36400000
364100*                                                              *  36410000
364200* EDITS TO VERIFY THAT THERE IS AT LEAST ONE OF EACH OF THE    *  36420000
364300* FOLLOWING RECORD TYPES: 01,02,06, AND 07.  THE SAVED INVOICE *  36430000
364400* NUMBER MUST BE MOVED TO THE OCCURANCE OF INV-INDX BECAUSE AT *  36440000
364500* THIS POINT THE INV-INDX IS AT 10998 OR AT THE NUMBER OF      *  36450000
364600* INVOICE RECORDS PLUS ONE AND THIS DOES NOT HAVE A TRANSMITTED*  36460000
364700* EDI INVOICE LOADED INTO IT.                                  *  36470000
364800*--------------------------------------------------------------*  36480000
364900 E300-EDIT-ALL.                                                   36490000
365000                                                                  36500000
365100* IF LI FUNG SENT PREPACKS WITH A HANGER CHARGE, THEN THE HANGER  36510000
365200* CHARGE MUST BE SUBTRACTED OUT OF WS-DETAIL-GROSS-INVOICE-AMT    36520000
365300* BECAUSE THE HANGER CHARGE IS ALREADY IMBEDDED IN THE EXTENDED   36530000
365400* GROSS BECAUSE IT IS IMBEDDED IN THE UNIT COSTS ON THE PO.       36540000
365500     IF  WS-VENDOR-IS-LI-FUNG                                     36550000
365600     AND LI-FUNG-PREPACK-FOUND                                    36560000
365700         COMPUTE WS-DETAIL-GROSS-INVOICE-AMT =                    36570000
365800                 WS-TOT-EXTEN-INVOICE-AMT - WS-LI-FUNG-HANGER-AMT 36580000
365900     ELSE                                                         36590000
366000         MOVE WS-TOT-EXTEN-INVOICE-AMT                            36600000
366100                                    TO WS-DETAIL-GROSS-INVOICE-AMT36610000
366200     END-IF.                                                      36620000
366300                                                                  36630000
366400     PERFORM S700-SELECT-TPAYTRM.                                 36640000
366500     PERFORM S100-SELECT-ALLW.                                    36650000
366600                                                                  36660000
366700*---------------------------------------------------------------  36670000
366800* EDIT TO VERIFY THAT THE FIRST RECORD TYPE WAS AN 01             36680000
366900*---------------------------------------------------------------  36690000
367000                                                                  36700000
367100     IF WS-AP052-REC-TYPE(1) NOT = '01'                           36710000
367200        MOVE WS-AP052-KEY-AREA(INV-INDX - 1) TO                   36720000
367300                WS-AP052-KEY-AREA(INV-INDX)                       36730000
367400        MOVE HIGH-VALUES TO WS-AP052-REC-TYPE(INV-INDX)           36740000
367500        IF REJ-INDX NOT = 25                                      36750000
367600           SET REJ-INDX UP BY 1                                   36760000
367700        END-IF                                                    36770000
367800        SET ERROR-EDI TO TRUE                                     36780000
367900        SET FIRST-REC-NOT-01 TO TRUE                              36790000
368000        MOVE EDI-ERROR-CD TO                                      36800000
368100             WS-INV-ERR-CD(INV-INDX, REJ-INDX)                    36810000
368200     END-IF.                                                      36820000
368300                                                                  36830000
368400     IF WS-REC-01-CNT = 0                                         36840000
368500        MOVE WS-AP052-KEY-AREA(INV-INDX - 1) TO                   36850000
368600                WS-AP052-KEY-AREA(INV-INDX)                       36860000
368700        MOVE HIGH-VALUES TO WS-AP052-REC-TYPE(INV-INDX)           36870000
368800        IF REJ-INDX NOT = 25                                      36880000
368900           SET REJ-INDX UP BY 1                                   36890000
369000        END-IF                                                    36900000
369100        SET ERROR-EDI TO TRUE                                     36910000
369200        SET NO-01-REC-CD TO TRUE                                  36920000
369300        MOVE EDI-ERROR-CD TO                                      36930000
369400                     WS-INV-ERR-CD(INV-INDX, REJ-INDX).           36940000
369500                                                                  36950000
369600     IF WS-REC-02-CNT = 0                                         36960000
369700        MOVE WS-AP052-KEY-AREA(INV-INDX - 1) TO                   36970000
369800                WS-AP052-KEY-AREA(INV-INDX)                       36980000
369900        MOVE HIGH-VALUES TO WS-AP052-REC-TYPE(INV-INDX)           36990000
370000        IF REJ-INDX NOT = 25                                      37000000
370100           SET REJ-INDX UP BY 1                                   37010000
370200        END-IF                                                    37020000
370300        SET ERROR-EDI TO TRUE                                     37030000
370400        SET NO-02-REC-CD TO TRUE                                  37040000
370500        MOVE EDI-ERROR-CD TO                                      37050000
370600                     WS-INV-ERR-CD(INV-INDX, REJ-INDX).           37060000
370700                                                                  37070000
370800     IF WS-REC-06-CNT = 0                                         37080000
370900        MOVE WS-AP052-KEY-AREA(INV-INDX - 1) TO                   37090000
371000                WS-AP052-KEY-AREA(INV-INDX)                       37100000
371100        MOVE HIGH-VALUES TO WS-AP052-REC-TYPE(INV-INDX)           37110000
371200        IF REJ-INDX NOT = 25                                      37120000
371300           SET REJ-INDX UP BY 1                                   37130000
371400        END-IF                                                    37140000
371500        SET ERROR-EDI TO TRUE                                     37150000
371600        SET NO-06-REC-CD TO TRUE                                  37160000
371700        MOVE EDI-ERROR-CD TO                                      37170000
371800                     WS-INV-ERR-CD(INV-INDX, REJ-INDX).           37180000
371900                                                                  37190000
372000     IF WS-REC-07-CNT = 0                                         37200000
372100        MOVE WS-AP052-KEY-AREA(INV-INDX - 1) TO                   37210000
372200                WS-AP052-KEY-AREA(INV-INDX)                       37220000
372300        MOVE HIGH-VALUES TO WS-AP052-REC-TYPE(INV-INDX)           37230000
372400        IF REJ-INDX NOT = 25                                      37240000
372500           SET REJ-INDX UP BY 1                                   37250000
372600        END-IF                                                    37260000
372700        SET ERROR-EDI TO TRUE                                     37270000
372800        SET NO-07-REC-CD TO TRUE                                  37280000
372900        MOVE EDI-ERROR-CD TO                                      37290000
373000                     WS-INV-ERR-CD(INV-INDX, REJ-INDX).           37300000
373100                                                                  37310000
373200*---------------------------------------------------------------  37320000
373300* EDIT TO VERIFY THAT THE LAST RECORD TYOE WAS AN 07              37330000
373400*---------------------------------------------------------------  37340000
373500                                                                  37350000
373600     IF WS-LAST-REC-TYPE NOT = '07'                               37360000
373700        MOVE WS-AP052-KEY-AREA(INV-INDX - 1) TO                   37370000
373800                WS-AP052-KEY-AREA(INV-INDX)                       37380000
373900        MOVE HIGH-VALUES TO WS-AP052-REC-TYPE(INV-INDX)           37390000
374000        IF REJ-INDX NOT = 25                                      37400000
374100           SET REJ-INDX UP BY 1                                   37410000
374200        END-IF                                                    37420000
374300        SET ERROR-EDI TO TRUE                                     37430000
374400        SET LAST-REC-NOT-07  TO TRUE                              37440000
374500        MOVE EDI-ERROR-CD TO                                      37450000
374600             WS-INV-ERR-CD(INV-INDX, REJ-INDX)                    37460000
374700     END-IF.                                                      37470000
374800                                                                  37480000
374900** WR28461                                                        37490000
375000*---------------------------------------------------------------  37500000
375100* EDIT TO VERIFY IF THE HANDLING CHARGES EXCEED THE MAXIMUM       37510000
375200* ALLOWED.                                                        37520000
375300*---------------------------------------------------------------  37530000
375400*    COMPUTE WS-MAX-CD-HANDLING-AMT                               37540000
375500*        = APCNTL-CD-CHRG-LMT-PCT * WS-DETAIL-GROSS-INVOICE-AMT.  37550000
375600*                                                                 37560000
375700*    IF WS-CD-HANDLING-AMT > WS-MAX-CD-HANDLING-AMT OR            37570000
375800*       WS-CD-HANDLING-AMT > APCNTL-CD-CHRG-LMT-AMT               37580000
375900*          SET CHRG-OVER-LIMIT TO TRUE                            37590000
376000*    END-IF.                                                      37600000
376100                                                                  37610000
376200*---------------------------------------------------------------  37620000
376300* EDITS FOR SUMMARIZATION OF EXTENDED AMOUNTS                     37630000
376400*---------------------------------------------------------------  37640000
376500                                                                  37650000
376600     DIVIDE PV-ACCUM-CHRG BY 100 GIVING PV-ACCUM-CHRG-PCT.        37660000
376700     COMPUTE WS-DETAIL-CHRG-AMT = WS-DETAIL-CHRG-AMT +            37670000
376800     ((PV-ACCUM-CHRG-PCT * WS-DETAIL-GROSS-INVOICE-AMT) + .005).  37680000
376900                                                                  37690000
377000                                                                  37700000
377100*    MOVE PV-ACCUM-ALLW TO PV-ACCUM-ALLW-PCT                      37710000
377200     DIVIDE PV-ACCUM-ALLW BY 100 GIVING PV-ACCUM-ALLW-PCT.        37720000
377300     COMPUTE WS-DETAIL-ALLW-AMT = WS-DETAIL-ALLW-AMT +            37730000
377400     ((PV-ACCUM-ALLW-PCT * WS-DETAIL-GROSS-INVOICE-AMT) + .005).  37740000
377500                                                                  37750000
377600     COMPUTE WS-DIFFERENCE                                        37760000
377700        =    WS-SAVE-GROSS-INVOICE-AMT                            37770000
377800        -   ((WS-DETAIL-GROSS-INVOICE-AMT +                       37780000
377900              WS-DETAIL-CHRG-AMT) - WS-DETAIL-ALLW-AMT).          37790000
378000                                                                  37800000
378100     IF WS-DIFFERENCE NOT = 0                                     37810000
378200        IF WS-DIFFERENCE < 0                                      37820000
378300           COMPUTE WS-DIFFERENCE                                  37830000
378400              =    WS-DIFFERENCE                                  37840000
378500              *    -1                                             37850000
378600        END-IF                                                    37860000
378700        IF WS-DIFFERENCE <= + 1.25                                37870000
378800        OR (WS-DIFFERENCE <= + 5.00 AND WS-HIGH-LIMIT-VENDOR)     37880000
378900           NEXT SENTENCE                                          37890000
379000        END-IF                                                    37900000
379100        MOVE WS-AP052-KEY-AREA(INV-INDX - 1) TO                   37910000
379200                WS-AP052-KEY-AREA(INV-INDX)                       37920000
379300        MOVE HIGH-VALUES TO WS-AP052-REC-TYPE(INV-INDX)           37930000
379400        SET ERR-DETAIL-GROSS-INVOICE TO TRUE                      37940000
379500        IF REJ-INDX NOT = 25                                      37950000
379600           SET REJ-INDX UP BY 1                                   37960000
379700        END-IF                                                    37970000
379800        SET ERROR-EDI TO TRUE                                     37980000
379900        SET SUM-EXTEN-NOT-EQ-GROSS-CD TO TRUE                     37990000
380000        MOVE EDI-ERROR-CD TO                                      38000000
380100                  WS-INV-ERR-CD(INV-INDX, REJ-INDX).              38010000
380200                                                                  38020000
380300*---------------------------------------------------------------  38030000
380400* EDIT TO VERIFY THAT THIS PURCHASE ORDER/INVOICE NUMBER          38040000
380500* COMBINATION HAS NOT BEEN PREVIOUSLY RECEIVED IN THIS            38050000
380600* PROCESSING.                                                     38060000
380700*---------------------------------------------------------------  38070000
380800                                                                  38080000
380900     MOVE WS-SAVE-PO-NBR-X    TO WS-SAVE-PO-INV-NBR(1:9)          38090000
381000     MOVE WS-SAVE-INVOICE-NBR TO WS-SAVE-PO-INV-NBR(10:22).       38100000
381100                                                                  38110000
381200     PERFORM VARYING PO-INDX FROM 1 BY 1                          38120000
381300        UNTIL PO-INDX > PC-COMBIN-TBL-MAX OR                      38130000
381400              WS-PO-INV-NBR(PO-INDX) = SPACES OR                  38140000
381500              WS-PO-INV-NBR(PO-INDX) = WS-SAVE-PO-INV-NBR         38150000
381600     END-PERFORM.                                                 38160000
381700                                                                  38170000
381800     IF PO-INDX > PC-COMBIN-TBL-MAX                               38180000
381900        DISPLAY '************** ABEND *************'              38190000
382000        DISPLAY '*   PO-INV  TABLE IS FULL -      *'              38200000
382100        DISPLAY '*   MAX   PO-INV COMBINATIONS    *'              38210000
382200        DISPLAY '*   HAVE BEEN RECEIVED           *'              38220000
382300        DISPLAY '*   PROGRAM ** = APKED201        *'              38230000
382400        DISPLAY '*   PARAGRAPH  = E300-EDIT-ALL   *'              38240000
382500        DISPLAY '**********************************'              38250000
382600        SET PO-TABLE-FULL TO TRUE                                 38260000
382700        CALL 'ILBOABN0' USING ABEND-CODE                          38270000
382800     ELSE                                                         38280000
382900        IF WS-PO-INV-NBR(PO-INDX) = SPACES                        38290000
383000           MOVE WS-SAVE-PO-INV-NBR TO WS-PO-INV-NBR(PO-INDX)      38300000
383100        ELSE                                                      38310000
383200           MOVE WS-AP052-KEY-AREA(INV-INDX - 1) TO                38320000
383300                   WS-AP052-KEY-AREA(INV-INDX)                    38330000
383400           MOVE HIGH-VALUES TO WS-AP052-REC-TYPE(INV-INDX)        38340000
383500           IF REJ-INDX NOT = 25                                   38350000
383600              SET REJ-INDX UP BY 1                                38360000
383700           END-IF                                                 38370000
383800           SET ERROR-EDI TO TRUE                                  38380000
383900           SET DUPL-PO-INV-COMBIN-CD TO TRUE                      38390000
384000           MOVE EDI-ERROR-CD TO                                   38400000
384100                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         38410000
384200        END-IF                                                    38420000
384300     END-IF.                                                      38430000
384400                                                                  38440000
384500*---------------------------------------------------------------  38450000
384600* IF THE VENDOR NUMBER IS VALID, PERFORM EDITS TO VERIFY THERE    38460000
384700* ARE NOT DUPLICATE INVOICE/PO OR INVOICE/VENDOR NUMBER           38470000
384800* COMBINATIONS WITHIN THE DB2 TABLE.                              38480000
384900*---------------------------------------------------------------  38490000
385000                                                                  38500000
385100     IF WS-NOT-VALID-DUNS                                         38510000
385200        IF REJ-INDX NOT = 25                                      38520000
385300           SET REJ-INDX UP BY 1                                   38530000
385400        END-IF                                                    38540000
385500        MOVE WS-AP052-KEY-AREA(INV-INDX - 1) TO                   38550000
385600                WS-AP052-KEY-AREA(INV-INDX)                       38560000
385700        MOVE HIGH-VALUES TO WS-AP052-REC-TYPE(INV-INDX)           38570000
385800        SET ERROR-EDI TO TRUE                                     38580000
385900        SET NO-JOIN-DUN-NBR TO TRUE                               38590000
386000        MOVE EDI-ERROR-CD TO                                      38600000
386100                     WS-INV-ERR-CD(INV-INDX, REJ-INDX)            38610000
386200     ELSE                                                         38620000
386300        PERFORM E500-CHECK-DUP-INVC                               38630000
386400     END-IF.                                                      38640000
386500                                                                  38650000
386600*---------------------------------------------------------------  38660000
386700* EDIT TO CHECK FOR BULK/STORE/DC COMBINATIONS AS THESE DO NOT    38670000
386800* PROCESS CORRECTLY                                               38680000
386900*---------------------------------------------------------------  38690000
387000                                                                  38700000
387100     IF NOT ERROR-EDI                                             38710000
387200        IF WS-SAVE-PO-NBR-COMP NOT = WS-PREV-PO-NBR-COMP          38720000
387300           PERFORM S400-PROCESS-MTCH-LVL-CURSOR                   38730000
387400           MOVE WS-SAVE-PO-NBR-COMP TO WS-PREV-PO-NBR-COMP        38740000
387500           SET NOT-RECYCLE-COMBIN TO TRUE                         38750000
387600           IF WS-MTCH-LVL = INVOIC-MTCH-LVL-CDE                   38760000
387700              CONTINUE                                            38770000
387800           ELSE                                                   38780000
387900              PERFORM S600-COUNT-NON-RIS                          38790000
388000              IF WS-COUNT > 0                                     38800000
388100                 SET RECYCLE-COMBIN TO TRUE                       38810000
388200              END-IF                                              38820000
388300           END-IF                                                 38830000
388400        END-IF                                                    38840000
388500     END-IF.                                                      38850000
388600                                                                  38860000
388700*--------------------------------------------------------------*  38870000
388800* CHECK THAT THE DATE ENTERED IS A VALID DATE                  *  38880000
388900*--------------------------------------------------------------*  38890000
389000 E400-CHECK-DATE.                                                 38900000
389100                                                                  38910000
389200     SET WS-NOT-VALID-DATE TO TRUE.                               38920000
389300                                                                  38930000
389400     IF  WS-YYMMDD    > '000000'                                  38940000
389500         IF WS-YY > 80                                            38950000
389600            MOVE '19' TO WS-CENTURY                               38960000
389700         ELSE                                                     38970000
389800            MOVE '20' TO WS-CENTURY                               38980000
389900         END-IF                                                   38990000
390000         SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE                   39000000
390100         SET DPG52-LK-DTE-ISO           TO TRUE                   39010000
390200         MOVE WS-CCYYMMDD       TO DPG52-LK-DATE-INPUT            39020000
390300         MOVE SPACES                    TO WS-DATE-INVALID        39030000
390400                                                                  39040000
390500         CALL  DP500-KOHLS-CALENDAR-ROUTINE USING                 39050000
390600                                           DPG51 DPG52 DPG53      39060000
390700                                           DPG54 DPG55 DPG56      39070000
390800                                                                  39080000
390900          IF (DPG54-SEVERE-ERROR                                  39090000
391000             OR                                                   39100000
391100              DPG54-WARNING-ERROR)                                39110000
391200              SET WS-NOT-VALID-DATE TO TRUE                       39120000
391300          ELSE                                                    39130000
391400             SET WS-VALID-DATE TO TRUE                            39140000
391500          END-IF                                                  39150000
391600     END-IF.                                                      39160000
391700                                                                  39170000
391800*--------------------------------------------------------------*  39180000
391900* CHECK THE DB2 TABLES FOR DUPLICATE PO/INVOICE COMBINATION AND*  39190000
392000* FOR DUPLICATE VENDOR/INVOICE COMBINATIONS.                   *  39200000
392100*--------------------------------------------------------------*  39210000
392200 E500-CHECK-DUP-INVC.                                             39220000
392300                                                                  39230000
392400     PERFORM E550-CHECK-DUP-PO-INV.                               39240000
392500                                                                  39250000
392600     IF  DUPLICATE-PO-INV                                         39260000
392700         CONTINUE                                                 39270000
392800     ELSE                                                         39280000
392900         STRING WS-SAVE-INVOICE-NBR DELIMITED BY SPACE            39290000
393000                '-'                 DELIMITED BY SIZE             39300000
393100                PC-PERCENTS         DELIMITED BY SIZE             39310000
393200                INTO WS-INVC-FOR-LIKE-COND                        39320000
393300         PERFORM E555-CHECK-DUP-PO-INV-SUFFIX                     39330000
393400     END-IF.                                                      39340000
393500                                                                  39350000
393600     IF DUPLICATE-PO-INV                                          39360000
393700        IF REJ-INDX NOT = 25                                      39370000
393800           SET REJ-INDX UP BY 1                                   39380000
393900        END-IF                                                    39390000
394000        MOVE WS-AP052-KEY-AREA(INV-INDX - 1) TO                   39400000
394100                WS-AP052-KEY-AREA(INV-INDX)                       39410000
394200        MOVE HIGH-VALUES TO WS-AP052-REC-TYPE(INV-INDX)           39420000
394300        SET ERROR-EDI TO TRUE                                     39430000
394400        SET DUPL-PO-INV-COMBIN-CD TO TRUE                         39440000
394500        MOVE EDI-ERROR-CD TO WS-INV-ERR-CD(INV-INDX, REJ-INDX)    39450000
394600     ELSE                                                         39460000
394700        MOVE SPACES TO WS-INVOICE-WITH-SUFFIX                     39470000
394800        STRING WS-SAVE-INVOICE-NBR DELIMITED BY SPACE             39480000
394900               '-'                 DELIMITED BY SIZE              39490000
395000               PV-SUFFIX-DATE      DELIMITED BY SIZE              39500000
395100               INTO WS-INVOICE-WITH-SUFFIX                        39510000
395200        PERFORM E575-CHECK-DUP-VND-INV                            39520000
395300        IF DUPLICATE-VND-INV                                      39530000
395400           PERFORM E576-CHECK-DUP-VND-INV-SUFFIX                  39540000
395500           IF NOT-DUPLICATE-VND-INV                               39550000
395600              SET USE-SUFFIX-INVC TO TRUE                         39560000
395700           END-IF                                                 39570000
395800*       ELSE                                                      39580032
395900* THE VOUCHER TABLE DUP CHECK IS MOVED TO APKUT272                39590000
396000* FLAG IS PASSED TO APKUT272 TO INDICATE WHETHER                  39600000
396100* OR NOT DUPLICATE CHECK NEED TO BE PERFORMED                     39610000
396200*         SET CHCK-PS-DUP-YES TO TRUE                             39620032
396300        END-IF                                                    39630000
396400        IF DUPLICATE-VND-INV                                      39640000
396500           IF REJ-INDX NOT = 25                                   39650000
396600              SET REJ-INDX UP BY 1                                39660000
396700           END-IF                                                 39670000
396800           MOVE WS-AP052-KEY-AREA(INV-INDX - 1) TO                39680000
396900                   WS-AP052-KEY-AREA(INV-INDX)                    39690000
397000           MOVE HIGH-VALUES TO WS-AP052-REC-TYPE(INV-INDX)        39700000
397100           SET ERROR-EDI TO TRUE                                  39710000
397200           SET DUPL-DUN-INV-COMBIN-CD TO TRUE                     39720000
397300           MOVE EDI-ERROR-CD TO                                   39730000
397400                        WS-INV-ERR-CD(INV-INDX, REJ-INDX)         39740000
397500         END-IF                                                   39750000
397600     END-IF.                                                      39760000
397700                                                                  39770000
397800     MOVE WS-DUN-NBR-X           TO WS-SAVE-DUN-INV-NBR(1:9)      39780000
397900                                    WS-DASH-DUN-INV-NBR(1:9).     39790000
398000     MOVE WS-SAVE-INVOICE-NBR    TO WS-SAVE-DUN-INV-NBR(10:22).   39800000
398100     MOVE WS-INVOICE-WITH-SUFFIX TO WS-DASH-DUN-INV-NBR(10:22).   39810000
398200                                                                  39820000
398300     IF USE-SUFFIX-INVC                                           39830000
398400        PERFORM VARYING DUN-INDX FROM 1 BY 1                      39840000
398500           UNTIL DUN-INDX > PC-COMBIN-TBL-MAX OR                  39850000
398600              WS-DUN-INV-NBR(DUN-INDX) = SPACES OR                39860000
398700              WS-DUN-INV-NBR(DUN-INDX) = WS-DASH-DUN-INV-NBR      39870000
398800        END-PERFORM                                               39880000
398900     ELSE                                                         39890000
399000        PERFORM VARYING DUN-INDX FROM 1 BY 1                      39900000
399100           UNTIL DUN-INDX > PC-COMBIN-TBL-MAX   OR                39910000
399200              WS-DUN-INV-NBR(DUN-INDX) = SPACES OR                39920000
399300              WS-DUN-INV-NBR(DUN-INDX) = WS-SAVE-DUN-INV-NBR      39930000
399400        END-PERFORM                                               39940000
399500     END-IF.                                                      39950000
399600                                                                  39960000
399700     IF DUN-INDX > PC-COMBIN-TBL-MAX                              39970000
399800        DISPLAY '************** ABEND *************'              39980000
399900        DISPLAY '*   DUN-INV TABLE IS FULL -      *'              39990000
400000        DISPLAY '*   MAX   DUN-INV COMBINATIONS   *'              40000000
400100        DISPLAY '*   HAVE BEEN RECEIVED           *'              40010000
400200        DISPLAY '*   PROGRAM ** = APKED201        *'              40020000
400300        DISPLAY '*   PARAGRAPH  = E300-EDIT-ALL   *'              40030000
400400        DISPLAY '**********************************'              40040000
400500        SET DUN-TABLE-FULL TO TRUE                                40050000
400600        CALL 'ILBOABN0' USING ABEND-CODE                          40060000
400700     ELSE                                                         40070000
400800        IF WS-DUN-INV-NBR(DUN-INDX) = SPACES                      40080000
400900           IF USE-SUFFIX-INVC                                     40090000
401000              MOVE WS-DASH-DUN-INV-NBR TO                         40100000
401100                               WS-DUN-INV-NBR(DUN-INDX)           40110000
401200           ELSE                                                   40120000
401300              MOVE WS-SAVE-DUN-INV-NBR TO                         40130000
401400                               WS-DUN-INV-NBR(DUN-INDX)           40140000
401500           END-IF                                                 40150000
401600        ELSE                                                      40160000
401700           MOVE WS-AP052-KEY-AREA(INV-INDX - 1) TO                40170000
401800                   WS-AP052-KEY-AREA(INV-INDX)                    40180000
401900           MOVE HIGH-VALUES TO WS-AP052-REC-TYPE(INV-INDX)        40190000
402000           IF REJ-INDX NOT = 25                                   40200000
402100              SET REJ-INDX UP BY 1                                40210000
402200           END-IF                                                 40220000
402300           SET ERROR-EDI TO TRUE                                  40230000
402400           SET DUPL-DUN-INV-TRANS-CD TO TRUE                      40240000
402500           MOVE EDI-ERROR-CD TO WS-INV-ERR-CD(INV-INDX, REJ-INDX) 40250000
402600        END-IF                                                    40260000
402700     END-IF.                                                      40270000
402800                                                                  40280000
402900*----------------------------------------------------------------*40290000
403000* CHECKS IF INVOICES ALREADY EXIST IN THE DATABASE WITH THE SAME *40300000
403100* PO AND INVOICE ID SENT BY THE VENDOR (BASE INVOICE) THIS IS    *40310000
403200* CONSIDERED A DUPLICATE PO/INVOICE, AND IT WILL BE REJECTED.    *40320000
403300*----------------------------------------------------------------*40330000
403400 E550-CHECK-DUP-PO-INV.                                           40340000
403500                                                                  40350000
403600     MOVE SPACE               TO PV-ONE.                          40360000
403700                                                                  40370000
403800     INITIALIZE DCLTINVOIC.                                       40380000
403900     PERFORM WITH TEST AFTER                                      40390000
404000          VARYING WS-RETRY-COUNTER FROM 1 BY 1                    40400000
404100          UNTIL   WS-RETRY-COUNTER >  3 OR                        40410000
404200                  SQLCODE = ZERO OR                               40420000
404300                  SQLCODE = +100                                  40430000
404400                                                                  40440000
404500          EXEC SQL                                                40450000
404600              SELECT '1'                                          40460000
404700               INTO  :PV-ONE                                      40470000
404800                FROM SYSIBM.SYSDUMMY1 X                           40480000
404900               WHERE EXISTS (SELECT 1                             40490000
405000                            FROM TINVOIC                          40500000
405100                            WHERE INVC_ID = :WS-SAVE-INVOICE-NBR  40510000
405200                            AND PO_NBR    = :WS-SAVE-PO-NBR-COMP  40520000
405300                            AND X.IBMREQD = X.IBMREQD)            40530000
405400          END-EXEC                                                40540000
405500                                                                  40550000
405600          EVALUATE TRUE                                           40560000
405700              WHEN SQLCODE = ZERO                                 40570000
405800              WHEN SQLCODE = +100                                 40580000
405900              WHEN SQLCODE = -904                                 40590000
406000              WHEN SQLCODE = -913                                 40600000
406100                   CONTINUE                                       40610000
406200                                                                  40620000
406300              WHEN SQLWARN0 NOT = SPACES                          40630000
406400              WHEN SQLCODE  NOT = ZERO                            40640000
406500                   MOVE 'E550-CHECK-DUP-PO-INV         '          40650000
406600                                 TO WS-ABEND-PARAGRAPH            40660000
406700                   MOVE 'UNSUCCESSFUL SELECT INVOIC'              40670000
406800                                 TO WS-ABEND-OPERATION            40680000
406900                   MOVE 'TINVOIC ' TO WS-ABEND-STRUCTURE-1        40690000
407000                   MOVE SPACES     TO WS-ABEND-STRUCTURE-2        40700000
407100                   PERFORM Z999-SQL-ERROR                         40710000
407200          END-EVALUATE                                            40720000
407300     END-PERFORM.                                                 40730000
407400                                                                  40740000
407500     IF WS-RETRY-COUNTER > 3                                      40750000
407600         MOVE 'E550-CHECK-DUP-PO-INV         '                    40760000
407700                       TO WS-ABEND-PARAGRAPH                      40770000
407800         MOVE 'MAX RETRIES EXCEEDED ON SELECT INVOIC'             40780000
407900                         TO WS-ABEND-OPERATION                    40790000
408000         PERFORM Z999-SQL-ERROR                                   40800000
408100     END-IF.                                                      40810000
408200                                                                  40820000
408300     EVALUATE TRUE                                                40830000
408400        WHEN SQLCODE = ZEROS                                      40840000
408500             SET DUPLICATE-PO-INV TO TRUE                         40850000
408600        WHEN SQLCODE = +100                                       40860000
408700             SET NOT-DUPLICATE-PO-INV TO TRUE                     40870000
408800        WHEN OTHER                                                40880000
408900             MOVE 'E550-CHECK-DUP-PO-INV         ' TO             40890000
409000                                       WS-ABEND-PARAGRAPH         40900000
409100             MOVE 'UNSUCCESSFUL SELECT INVOIC'                    40910000
409200                           TO WS-ABEND-OPERATION                  40920000
409300             MOVE 'TINVOIC ' TO WS-ABEND-STRUCTURE-1              40930000
409400             MOVE SPACES     TO WS-ABEND-STRUCTURE-2              40940000
409500             PERFORM Z999-SQL-ERROR                               40950000
409600     END-EVALUATE.                                                40960000
409700                                                                  40970000
409800*----------------------------------------------------------------*40980000
409900* CHECKS IF INVOICES ALREADY EXIST IN THE DATABASE WITH THE SAME *40990000
410000* PO AND INVOICE ID PLUS ANY SUFFIX.  THIS WILL BE CONSIDERED A  *41000000
410100* DUPLICATE PO/INVOICE, AND IT WILL BE REJECTED.                 *41010000
410200*----------------------------------------------------------------*41020000
410300 E555-CHECK-DUP-PO-INV-SUFFIX.                                    41030000
410400                                                                  41040000
410500     PERFORM WITH TEST AFTER                                      41050000
410600       VARYING WS-RETRY-COUNTER FROM 1 BY 1                       41060000
410700       UNTIL   WS-RETRY-COUNTER >  3 OR                           41070000
410800               SQLCODE = ZERO OR                                  41080000
410900               SQLCODE = +100 OR                                  41090000
411000               SQLCODE = -811                                     41100000
411100                                                                  41110000
411200       EXEC SQL                                                   41120000
411300           SELECT '1'                                             41130000
411400            INTO  :PV-ONE                                         41140000
411500             FROM SYSIBM.SYSDUMMY1 X                              41150000
411600            WHERE EXISTS                                          41160000
411700                 (SELECT 1                                        41170000
411800                    FROM TINVOIC                                  41180000
411900                   WHERE PO_NBR   = :WS-SAVE-PO-NBR-COMP          41190000
412000                     AND INVC_ID  LIKE (:WS-INVC-FOR-LIKE-COND)   41200000
412100                     AND X.IBMREQD = X.IBMREQD)                   41210000
412200       END-EXEC                                                   41220000
412300                                                                  41230000
412400       EVALUATE TRUE                                              41240000
412500           WHEN SQLCODE = ZERO                                    41250000
412600           WHEN SQLCODE = +100                                    41260000
412700           WHEN SQLCODE = -904                                    41270000
412800           WHEN SQLCODE = -913                                    41280000
412900                CONTINUE                                          41290000
413000                                                                  41300000
413100           WHEN SQLWARN0 NOT = SPACES                             41310000
413200           WHEN SQLCODE  NOT = ZERO                               41320000
413300                MOVE 'E555-CHECK-DUP-PO-INV-SUFFIX  '             41330000
413400                              TO WS-ABEND-PARAGRAPH               41340000
413500                MOVE 'UNSUCCESSFUL SELECT INVOIC'                 41350000
413600                              TO WS-ABEND-OPERATION               41360000
413700                MOVE 'TINVOIC ' TO WS-ABEND-STRUCTURE-1           41370000
413800                MOVE SPACES     TO WS-ABEND-STRUCTURE-2           41380000
413900                PERFORM Z999-SQL-ERROR                            41390000
414000       END-EVALUATE                                               41400000
414100     END-PERFORM.                                                 41410000
414200                                                                  41420000
414300     IF WS-RETRY-COUNTER > 3                                      41430000
414400         MOVE 'E555-CHECK-DUP-PO-INV-SUFFIX'                      41440000
414500                       TO WS-ABEND-PARAGRAPH                      41450000
414600         MOVE 'MAX RETRIES EXCEEDED ON SELECT INVOIC'             41460000
414700                         TO WS-ABEND-OPERATION                    41470000
414800         PERFORM Z999-SQL-ERROR                                   41480000
414900     END-IF.                                                      41490000
415000                                                                  41500000
415100     EVALUATE TRUE                                                41510000
415200        WHEN SQLCODE = ZEROS                                      41520000
415300             SET DUPLICATE-PO-INV TO TRUE                         41530000
415400        WHEN SQLCODE = +100                                       41540000
415500             SET NOT-DUPLICATE-PO-INV TO TRUE                     41550000
415600        WHEN OTHER                                                41560000
415700             MOVE 'E555-CHECK-DUP-PO-INV-SUFFIX' TO               41570000
415800                                       WS-ABEND-PARAGRAPH         41580000
415900             MOVE 'UNSUCCESSFUL SELECT INVOIC'                    41590000
416000                           TO WS-ABEND-OPERATION                  41600000
416100             MOVE 'TINVOIC ' TO WS-ABEND-STRUCTURE-1              41610000
416200             MOVE SPACES     TO WS-ABEND-STRUCTURE-2              41620000
416300             PERFORM Z999-SQL-ERROR                               41630000
416400     END-EVALUATE.                                                41640000
416500                                                                  41650000
416600*----------------------------------------------------------------*41660000
416700* CHECKS IF INVOICES ALREADY EXIST IN THE DATABASE WITH THE SAME *41670000
416800* VENDOR NUMBER AND BASE INVOICE ID.  THIS WILL TRIGGER THE      *41680000
416900* PROGRAM TO ADD A SUFFIX TO THE INVOICE ID BEFORE LOADING IT TO *41690000
417000* THE DATABASE.  THE SUFFIX WILL PREVENT IT FROM REJECTING WHEN  *41700000
417100* IT IS ULTIMATELY INTERFACED TO PEOPLESOFT.                     *41710000
417200*----------------------------------------------------------------*41720000
417300 E575-CHECK-DUP-VND-INV.                                          41730000
417400                                                                  41740000
417500     MOVE SPACE TO PV-ONE.                                        41750000
417600                                                                  41760000
417700     PERFORM WITH TEST AFTER                                      41770000
417800          VARYING WS-RETRY-COUNTER FROM 1 BY 1                    41780000
417900          UNTIL   WS-RETRY-COUNTER >  3 OR                        41790000
418000                  SQLCODE = ZERO OR                               41800000
418100                  SQLCODE = +100 OR                               41810000
418200                  SQLCODE = -811                                  41820000
418300                                                                  41830000
418400          EXEC SQL                                                41840000
418500              SELECT '1'                                          41850000
418600               INTO  :PV-ONE                                      41860000
418700                FROM SYSIBM.SYSDUMMY1 X                           41870000
418800               WHERE EXISTS (SELECT 1                             41880000
418900                            FROM TINVOIC                          41890000
419000                            WHERE INVC_ID = :WS-SAVE-INVOICE-NBR  41900000
419100                          AND RMIT_VND_ID = :WS-EXTENT-DUN-NBR    41910000
419200                            AND X.IBMREQD = X.IBMREQD)            41920000
419300          END-EXEC                                                41930000
419400                                                                  41940000
419500          EVALUATE TRUE                                           41950000
419600              WHEN SQLCODE = ZERO                                 41960000
419700              WHEN SQLCODE = +100                                 41970000
419800              WHEN SQLCODE = -904                                 41980000
419900              WHEN SQLCODE = -913                                 41990000
420000              WHEN SQLCODE = -811                                 42000000
420100                   CONTINUE                                       42010000
420200                                                                  42020000
420300              WHEN SQLWARN0 NOT = SPACES                          42030000
420400              WHEN SQLCODE  NOT = ZERO                            42040000
420500                   MOVE 'E575-CHECK-DUP-VND-INV      '            42050000
420600                                 TO WS-ABEND-PARAGRAPH            42060000
420700                   MOVE 'UNSUCCESSFUL SELECT INVOIC'              42070000
420800                                 TO WS-ABEND-OPERATION            42080000
420900                   MOVE 'TINVOIC ' TO WS-ABEND-STRUCTURE-1        42090000
421000                   MOVE SPACES     TO WS-ABEND-STRUCTURE-2        42100000
421100                   PERFORM Z999-SQL-ERROR                         42110000
421200          END-EVALUATE                                            42120000
421300     END-PERFORM.                                                 42130000
421400                                                                  42140000
421500     IF WS-RETRY-COUNTER > 3                                      42150000
421600         MOVE 'E575-CHECK-DUP-VND-INV      '                      42160000
421700                       TO WS-ABEND-PARAGRAPH                      42170000
421800         MOVE 'MAX RETRIES EXCEEDED ON SELECT INVOIC'             42180000
421900                         TO WS-ABEND-OPERATION                    42190000
422000         PERFORM Z999-SQL-ERROR                                   42200000
422100     END-IF.                                                      42210000
422200                                                                  42220000
422300     EVALUATE TRUE                                                42230000
422400        WHEN SQLCODE = ZEROS                                      42240000
422500        WHEN SQLCODE = -811                                       42250000
422600             SET DUPLICATE-VND-INV TO TRUE                        42260000
422700        WHEN SQLCODE = +100                                       42270000
422800             SET NOT-DUPLICATE-VND-INV TO TRUE                    42280000
422900        WHEN OTHER                                                42290000
423000             MOVE 'E575-CHECK-DUP-VND-INV      ' TO               42300000
423100                                       WS-ABEND-PARAGRAPH         42310000
423200             MOVE 'UNSUCCESSFUL SELECT INVOIC'                    42320000
423300                           TO WS-ABEND-OPERATION                  42330000
423400             MOVE 'TINVOIC ' TO WS-ABEND-STRUCTURE-1              42340000
423500             MOVE SPACES     TO WS-ABEND-STRUCTURE-2              42350000
423600             PERFORM Z999-SQL-ERROR                               42360000
423700     END-EVALUATE.                                                42370000
423800                                                                  42380000
423900*--------------------------------------------------------------*  42390000
424000* CHECKS IF INVOICE ALREADY EXISTS IN THE DATABASE WITH THE    *  42400000
424100* SAME VENDOR NUMBER AND SUFFIX.                               *  42410000
424200*--------------------------------------------------------------*  42420000
424300 E576-CHECK-DUP-VND-INV-SUFFIX.                                   42430000
424400                                                                  42440000
424500     MOVE SPACE TO PV-ONE.                                        42450000
424600                                                                  42460000
424700     PERFORM WITH TEST AFTER                                      42470000
424800       VARYING WS-RETRY-COUNTER FROM 1 BY 1                       42480000
424900       UNTIL   WS-RETRY-COUNTER >  3 OR                           42490000
425000               SQLCODE = ZERO OR                                  42500000
425100               SQLCODE = +100 OR                                  42510000
425200               SQLCODE = -811                                     42520000
425300                                                                  42530000
425400       EXEC SQL                                                   42540000
425500          SELECT '1'                                              42550000
425600            INTO  :PV-ONE                                         42560000
425700            FROM SYSIBM.SYSDUMMY1 X                               42570000
425800           WHERE EXISTS (SELECT 1                                 42580000
425900                         FROM TINVOIC                             42590000
426000                        WHERE INVC_ID = :WS-INVOICE-WITH-SUFFIX   42600000
426100                          AND RMIT_VND_ID  = :WS-EXTENT-DUN-NBR   42610000
426200                          AND X.IBMREQD = X.IBMREQD)              42620000
426300       END-EXEC                                                   42630000
426400                                                                  42640000
426500          EVALUATE TRUE                                           42650000
426600              WHEN SQLCODE = ZERO                                 42660000
426700              WHEN SQLCODE = +100                                 42670000
426800              WHEN SQLCODE = -904                                 42680000
426900              WHEN SQLCODE = -913                                 42690000
427000              WHEN SQLCODE = -811                                 42700000
427100                   CONTINUE                                       42710000
427200                                                                  42720000
427300              WHEN SQLWARN0 NOT = SPACES                          42730000
427400              WHEN SQLCODE  NOT = ZERO                            42740000
427500                   MOVE 'E576-CHECK-DUP-VND-INV-SUFFIX'           42750000
427600                                 TO WS-ABEND-PARAGRAPH            42760000
427700                   MOVE 'UNSUCCESSFUL SELECT INVOIC'              42770000
427800                                 TO WS-ABEND-OPERATION            42780000
427900                   MOVE 'TINVOIC ' TO WS-ABEND-STRUCTURE-1        42790000
428000                   MOVE SPACES     TO WS-ABEND-STRUCTURE-2        42800000
428100                   PERFORM Z999-SQL-ERROR                         42810000
428200          END-EVALUATE                                            42820000
428300     END-PERFORM.                                                 42830000
428400                                                                  42840000
428500     IF WS-RETRY-COUNTER > 3                                      42850000
428600         MOVE 'E576-CHECK-DUP-VND-INV-SUFFIX'                     42860000
428700                                            TO WS-ABEND-PARAGRAPH 42870000
428800         MOVE 'MAX RETRIES EXCEEDED ON SELECT INVOIC'             42880000
428900                                            TO WS-ABEND-OPERATION 42890000
429000         PERFORM Z999-SQL-ERROR                                   42900000
429100     END-IF.                                                      42910000
429200                                                                  42920000
429300     EVALUATE TRUE                                                42930000
429400        WHEN SQLCODE = ZEROS                                      42940000
429500             SET DUPLICATE-VND-INV TO TRUE                        42950000
429600        WHEN SQLCODE = +100                                       42960000
429700             SET NOT-DUPLICATE-VND-INV TO TRUE                    42970000
429800        WHEN OTHER                                                42980000
429900             MOVE 'E576-CHECK-DUP-VND-INV-SUFFIX'                 42990000
430000                                    TO WS-ABEND-PARAGRAPH         43000000
430100             MOVE 'UNSUCCESSFUL SELECT INVOIC'                    43010000
430200                                    TO WS-ABEND-OPERATION         43020000
430300             MOVE 'TINVOIC '        TO WS-ABEND-STRUCTURE-1       43030000
430400             MOVE SPACES            TO WS-ABEND-STRUCTURE-2       43040000
430500             PERFORM Z999-SQL-ERROR                               43050000
430600     END-EVALUATE.                                                43060000
430700                                                                  43070000
430800*--------------------------------------------------------------*  43080000
430900* FOR RECORD TYPE 07 AND UNIT MEASURE = AS RECORDS ONLY:       *  43090000
431000* CHECK THE PACKITEM WARNING INDICATORS FOR 'Y'.  IF THE       *  43100000
431100* INDICATORS ARE SET THEN SET THE APPROPRIATE WARNING MESSAGE  *  43110000
431200* FOR THE ERROR-CODE TABLE SO THAT THE WARNING WILL APPEAR ON  *  43120000
431300* ERROR REPORT OUTPUT FILE.                                    *  43130000
431400*--------------------------------------------------------------*  43140000
431500 E600-EDIT-PKITEM-WARN-INDS.                                      43150000
431600                                                                  43160000
431700     IF AP052-NO-DTL-SENT-IND = 'Y'                               43170000
431800        IF REJ-INDX NOT = 25                                      43180000
431900           SET REJ-INDX UP BY 1                                   43190000
432000        END-IF                                                    43200000
432100        SET PI-WARNING1-EXISTS TO TRUE                            43210000
432200        SET NO-PKITM-DTL-SENT-CD TO TRUE                          43220000
432300        MOVE EDI-ERROR-CD TO                                      43230000
432400                     WS-INV-ERR-CD(INV-INDX, REJ-INDX)            43240000
432500     END-IF.                                                      43250000
432600                                                                  43260000
432700     IF AP052-DTL-SENT-NOT-BLNC-IND = 'Y'                         43270000
432800        IF REJ-INDX NOT = 25                                      43280000
432900           SET REJ-INDX UP BY 1                                   43290000
433000        END-IF                                                    43300000
433100        SET PI-WARNING2-EXISTS TO TRUE                            43310000
433200        SET PK-CST-NT-EQ-SUMD-PI-CST-CD TO TRUE                   43320000
433300        MOVE EDI-ERROR-CD TO                                      43330000
433400                     WS-INV-ERR-CD(INV-INDX, REJ-INDX)            43340000
433500     END-IF.                                                      43350000
433600                                                                  43360000
433700     IF AP052-UPC-CANT-EXPLODE-IND = 'Y'                          43370000
433800        IF REJ-INDX NOT = 25                                      43380000
433900           SET REJ-INDX UP BY 1                                   43390000
434000        END-IF                                                    43400000
434100*       SET PI-WARNING3-EXISTS TO TRUE                            43410000
434200        SET ERROR-EDI TO TRUE                                     43420000
434300        SET PK-UPC-CANT-BE-EXPLODED-CD TO TRUE                    43430000
434400        MOVE EDI-ERROR-CD TO                                      43440000
434500                     WS-INV-ERR-CD(INV-INDX, REJ-INDX)            43450000
434600     END-IF.                                                      43460000
434700                                                                  43470000
434800*--------------------------------------------------------------*  43480000
434900* CONVERT A ONE DIGIT TERMS BASIS CODE TO A TWO DIGIT WITH A   *  43490000
435000* LEADING ZERO.                                                *  43500000
435100*--------------------------------------------------------------*  43510000
435200 E800-CONVERT-CODE.                                               43520000
435300                                                                  43530000
435400     MOVE WS-CHECK-BASIS-DTE-CODE(1:1) TO                         43540000
435500             WS-CHECK-BASIS-DTE-CODE(2:1).                        43550000
435600                                                                  43560000
435700     MOVE '0' TO WS-CHECK-BASIS-DTE-CODE(1:1).                    43570000
435800     MOVE WS-CHECK-BASIS-DTE-CODE TO                              43580000
435900          AP052-TRMS-BASIS-DTE-CODE.                              43590000
436000                                                                  43600000
436100     MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX).                    43610000
436200                                                                  43620000
436300*--------------------------------------------------------------*  43630000
436400* GET DATE AND TIME, OPEN FILES, SET UP CONTROLS, ETC          *  43640000
436500*--------------------------------------------------------------*  43650000
436600 H100-HOUSEKEEPING.                                               43660000
436700                                                                  43670000
436800     ACCEPT RUN-TIME FROM TIME.                                   43680000
436900     ACCEPT DATE-IN  FROM DATE.                                   43690000
437000     ACCEPT WS-JULIAN-YYDDD FROM DAY.                             43700000
437100     IF WS-JULIAN-YY > 80                                         43710000
437200        MOVE 19 TO WS-JULIAN-CC                                   43720000
437300     ELSE                                                         43730000
437400        MOVE 20 TO WS-JULIAN-CC.                                  43740000
437500                                                                  43750000
437600     DISPLAY '------------ START OF APKED201 ------------'.       43760000
437700     DISPLAY ' RUN-DATE = ' DATE-IN '   RUN-TIME = ' RUN-TIME.    43770000
437800                                                                  43780000
437900     OPEN  INPUT   EDIIN-AP050-FILE                               43790000
438000                   EDIIN-AP056-COMBIN-FILE                        43800000
438100     OPEN  OUTPUT  EDIOUT-AP052-FILE                              43810000
438200                   REJOUT-AP051-FILE                              43820000
438300                   EDIOUT-AP056-COMBIN-FILE.                      43830000
438400                                                                  43840000
438500     INITIALIZE WS-PO-INV-TABLE-AREA.                             43850000
438600     INITIALIZE WS-DUN-INV-TABLE-AREA.                            43860000
438700     INITIALIZE DCLTENTNME                                        43870000
438800                DCLTEXTENT                                        43880000
438900                DCLTINVOIC                                        43890000
439000                DCLTPAYTRM                                        43900000
439100                DCLTPLNSHP                                        43910000
439200                DCLTPOAGMT                                        43920000
439300                DCLTPURCHS                                        43930000
439400                DCLTPURITM                                        43940000
439500                DCLXFT00017                                       43950000
439600                DCLTUPCSKU                                        43960000
439700                DCLTTRDPRT.                                       43970000
439800                                                                  43980000
439900     INITIALIZE WS-WORK-AREA                                      43990000
440000                PV-ACCUM-CHRG                                     44000000
440100                PV-ACCUM-ALLW                                     44010000
440200                PV-ACCUM-CHRG-PCT                                 44020000
440300                PV-ACCUM-ALLW-PCT.                                44030000
440400     MOVE '000000' TO WS-SAVE-INVOICE-DATE                        44040000
440500                      WS-SAVE-SHIPPED-DATE                        44050000
440600                      WS-SAVE-EFFECTIVE-DATE.                     44060000
440700     INITIALIZE    WS-INVOICE-COUNTERS.                           44070000
440800     PERFORM H200-INITIALIZE.                                     44080000
440900                                                                  44090000
441000     PERFORM X400-SELECT-TAPCNTL.                                 44100000
441100                                                                  44110000
441200     MOVE APCNTL-BTCH-PRC-DTE TO PV-CURRENT-DATE.                 44120000
441300     MOVE PV-CURRENT-YEAR     TO PV-SUFFIX-YEAR.                  44130000
441400     MOVE PV-CURRENT-MONTH    TO PV-SUFFIX-MONTH.                 44140000
441500     MOVE PV-CURRENT-DAY      TO PV-SUFFIX-DAY.                   44150000
441600                                                                  44160000
441700     PERFORM X100-OPEN-LOCATION-CSR.                              44170000
441800     PERFORM X200-LOAD-LOCATION-TBL.                              44180000
441900     PERFORM X300-CLOSE-LOCATION-CSR.                             44190000
442000     PERFORM X500-COMMIT.                                         44200019
442100                                                                  44210000
442200*--------------------------------------------------------------*  44220000
442300* INITIALIZE THE TABLE THAT WILL HOLD THE ENTIRE INVOICE       *  44230000
442400*--------------------------------------------------------------*  44240000
442500 H200-INITIALIZE.                                                 44250000
442600                                                                  44260000
442700     PERFORM VARYING INV-INDX FROM 1 BY 1                         44270000
442800        UNTIL INV-INDX > 11000                                    44280000
442900        MOVE HIGH-VALUES TO WS-AP052-KEY-AREA(INV-INDX)           44290000
443000        MOVE SPACES TO WS-AP052-DATA-AREA(INV-INDX)               44300000
443100        INITIALIZE WS-AP052-DATA-AREA(INV-INDX)                   44310000
443200        INITIALIZE WS-INV-ERR-TBL-AREA(INV-INDX)                  44320000
443300     END-PERFORM.                                                 44330000
443400                                                                  44340000
443500*    MOVE SPACES                     TO WS-CHCK-PS-DUP            44350030
443600     SET DO-NOT-USE-SUFFIX-INVC      TO TRUE.                     44360000
443700     SET NOT-DUPLICATE-PO-INV        TO TRUE.                     44370000
443800     SET NOT-DUPLICATE-VND-INV       TO TRUE.                     44380000
443900     SET NO-ERR-DETAIL-GROSS-INVOICE TO TRUE.                     44390000
444000*    SET NOT-CHRG-OVER-LIMIT         TO TRUE.                     44400000
444100     SET LI-FUNG-PREPACK-NOT-FOUND   TO TRUE.                     44410000
444200                                                                  44420000
444300     MOVE ZERO TO WS-TOT-INVC-LINES.                              44430000
444400     SET NOT-TOO-MANY-INVC-LINES     TO TRUE.                     44440000
444500     SET FIRST-07-REC-NOT-WRITTEN    TO TRUE.                     44450000
444600                                                                  44460000
444700     SET INV-INDX TO 1.                                           44470000
444800     SET INV-INDX DOWN BY 1.                                      44480000
444900     SET REJ-INDX TO 1.                                           44490000
445000     SET REJ-INDX DOWN BY 1.                                      44500000
445100                                                                  44510000
445200*--------------------------------------------------------------*  44520000
445300* READ THE EDI PRODUCTION FILE INTO WORKING STORAGE COPYBOOK   *  44530000
445400*--------------------------------------------------------------*  44540000
445500 R125-READ-AP056-COMBIN.                                          44550000
445600                                                                  44560000
445700     READ EDIIN-AP056-COMBIN-FILE INTO AP056-EDI-IN-FILE          44570000
445800          AT END      SET END-OF-EDIIN-56-COMBIN TO TRUE.         44580000
445900                                                                  44590000
446000     IF NOT END-OF-EDIIN-56-COMBIN                                44600000
446100        ADD 1 TO WS-EDIIN-REC-CNT-COMBIN                          44610000
446200        ADD 1 TO WS-TOT-INVC-LINES                                44620000
446300     END-IF.                                                      44630000
446400                                                                  44640000
446500*--------------------------------------------------------------*  44650000
446600* READ THE EDI PRODUCTION FILE INTO WORKING STORAGE COPYBOOK   *  44660000
446700*--------------------------------------------------------------*  44670000
446800 R150-READ-AP050.                                                 44680000
446900                                                                  44690000
447000     READ EDIIN-AP050-FILE INTO AP050-EDI-IN-FILE                 44700000
447100          AT END      SET END-OF-EDIIN TO TRUE.                   44710000
447200                                                                  44720000
447300     IF NOT END-OF-EDIIN                                          44730000
447400        ADD 1 TO WS-EDIIN-REC-CNT                                 44740000
447500        ADD 1 TO WS-TOT-INVC-LINES                                44750000
447600     END-IF.                                                      44760000
447700                                                                  44770000
447800*--------------------------------------------------------------*  44780000
447900* VALIDATE STORE NUMBER 1 AGAINST THE LOCATION TABLE           *  44790000
448000*--------------------------------------------------------------*  44800000
448100 R300-VALIDATE-STORE1.                                            44810000
448200                                                                  44820000
448300     PERFORM VARYING LOC-INDX FROM 1 BY 1                         44830000
448400       UNTIL WS-STORE-NBR(LOC-INDX) = WS-SAVE-STORE-NBR1          44840000
448500          OR WS-STORE-NBR(LOC-INDX) = SPACES                      44850000
448600          OR LOC-INDX > 1500                                      44860000
448700     END-PERFORM.                                                 44870000
448800                                                                  44880000
448900     EVALUATE TRUE                                                44890000
449000       WHEN WS-STORE-NBR(LOC-INDX) = WS-SAVE-STORE-NBR1           44900000
449100         IF WS-STORE-TYP-CDE(LOC-INDX) = 'DS'                     44910000
449200            SET WS-VALID-STORE1-DS TO TRUE                        44920000
449300         ELSE                                                     44930000
449400            IF WS-STORE-TYP-CDE(LOC-INDX) = 'CS'                  44940000
449500               SET WS-VALID-STORE1-CS TO TRUE                     44950000
449600            ELSE                                                  44960000
449700               IF WS-STORE-TYP-CDE(LOC-INDX) = 'DC'               44970000
449800                  SET WS-VALID-DC1 TO TRUE                        44980000
449900               ELSE                                               44990000
450000                  IF WS-STORE-TYP-CDE(LOC-INDX) = 'DE' OR 'NA'    45000000
450100                     SET WS-VALID-PO1 TO TRUE                     45010000
450200                  ELSE                                            45020000
450300                     SET WS-NOT-VALID-STORE1 TO TRUE              45030000
450400                  END-IF                                          45040000
450500               END-IF                                             45050000
450600            END-IF                                                45060000
450700         END-IF                                                   45070000
450800       WHEN WS-STORE-NBR(LOC-INDX) = SPACES OR LOC-INDX > 1500    45080000
450900            SET WS-NOT-VALID-STORE1 TO TRUE                       45090000
451000     END-EVALUATE.                                                45100000
451100                                                                  45110000
451200*--------------------------------------------------------------*  45120000
451300* VALIDATE STORE NUMBER 2 AGAINST LOCATION TABLE.              *  45130000
451400*--------------------------------------------------------------*  45140000
451500 R350-VALIDATE-STORE2.                                            45150000
451600                                                                  45160000
451700     PERFORM VARYING LOC-INDX FROM 1 BY 1                         45170000
451800       UNTIL WS-STORE-NBR(LOC-INDX) = WS-SAVE-STORE-NBR2          45180000
451900          OR WS-STORE-NBR(LOC-INDX) = SPACES                      45190000
452000          OR LOC-INDX > 1500                                      45200000
452100     END-PERFORM.                                                 45210000
452200                                                                  45220000
452300     EVALUATE TRUE                                                45230000
452400       WHEN WS-STORE-NBR(LOC-INDX) = WS-SAVE-STORE-NBR2           45240000
452500         IF WS-STORE-TYP-CDE(LOC-INDX) = 'DS'                     45250000
452600            SET WS-VALID-STORE2-DS TO TRUE                        45260000
452700         ELSE                                                     45270000
452800            IF WS-STORE-TYP-CDE(LOC-INDX) = 'CS'                  45280000
452900               SET WS-VALID-STORE2-CS TO TRUE                     45290000
453000            ELSE                                                  45300000
453100               IF WS-STORE-TYP-CDE(LOC-INDX) = 'DC'               45310000
453200                  SET WS-VALID-DC2 TO TRUE                        45320000
453300               ELSE                                               45330000
453400                  IF WS-STORE-TYP-CDE(LOC-INDX) = 'DE' OR 'NA'    45340000
453500                     SET WS-VALID-PO2 TO TRUE                     45350000
453600                  ELSE                                            45360000
453700                     SET WS-NOT-VALID-STORE2 TO TRUE              45370000
453800                  END-IF                                          45380000
453900               END-IF                                             45390000
454000            END-IF                                                45400000
454100         END-IF                                                   45410000
454200       WHEN WS-STORE-NBR(LOC-INDX) = SPACES OR LOC-INDX > 1500    45420000
454300            SET WS-NOT-VALID-STORE2 TO TRUE                       45430000
454400     END-EVALUATE.                                                45440000
454500                                                                  45450000
454600*--------------------------------------------------------------*  45460000
454700* DETERMINE THE DC NUMBER FOR THE GIVEN STORE NUMBER WHEN THE  *  45470000
454800* TYPE IS 'DS'.                                                *  45480000
454900*--------------------------------------------------------------*  45490000
455000 R375-DETERMINE-DC-NBR.                                           45500000
455100                                                                  45510000
455200     INITIALIZE DCLXFT00018.                                      45520000
455300                                                                  45530000
455400     PERFORM WITH TEST AFTER                                      45540000
455500             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 45550000
455600             UNTIL   WS-RETRY-COUNTER > 3  OR                     45560000
455700                     SQLCODE = ZERO OR                            45570000
455800                     SQLCODE = +100                               45580000
455900                                                                  45590000
456000             EXEC SQL                                             45600000
456100                 SELECT A.DC_NBR                                  45610000
456200                   INTO :XFT00018-DC-NBR                          45620000
456300                   FROM XFT_LOC_ASGMT A                           45630000
456400                  WHERE A.LOC_NBR = :WS-SAVE-DC-NBR               45640000
456500                    AND CURRENT DATE >= PO_STRT_DTE               45650000
456600                    AND A.EFF_BEG_DTE =                           45660000
456700                        (SELECT MAX(A1.EFF_BEG_DTE)               45670000
456800                           FROM XFT_LOC_ASGMT A1                  45680000
456900                          WHERE A1.LOC_NBR = A.LOC_NBR            45690000
457000                            AND A1.EFF_BEG_DTE <= CURRENT DATE    45700000
457100                            AND A1.EFF_BEG_DTE <=                 45710000
457200                                :PLNSHP-CAN-IFNOT-SHIP-DTE)       45720000
457300             END-EXEC                                             45730000
457400                                                                  45740000
457500             EVALUATE TRUE                                        45750000
457600                 WHEN SQLCODE = ZERO                              45760000
457700                      MOVE XFT00018-DC-NBR                        45770000
457800                        TO AP052-KOHLS-DC-TO-USE                  45780000
457900                 WHEN SQLCODE = +100                              45790000
458000                      IF REJ-INDX NOT = 25                        45800000
458100                         SET REJ-INDX UP BY 1                     45810000
458200                      END-IF                                      45820000
458300                      SET ERROR-EDI                   TO TRUE     45830000
458400                      SET DC-NUMBER-NOT-FOUND-CD      TO TRUE     45840000
458500                      MOVE EDI-ERROR-CD                           45850000
458600                        TO WS-INV-ERR-CD(INV-INDX, REJ-INDX)      45860000
458700                 WHEN SQLCODE = -904                              45870000
458800                 WHEN SQLCODE = -913                              45880000
458900                      CONTINUE                                    45890000
459000                 WHEN SQLWARN0 NOT = SPACES                       45900000
459100                 WHEN SQLCODE  NOT = ZERO                         45910000
459110                 DISPLAY 'STORE BEING PROCESSED = ' WS-SAVE-DC-NBR45911002
459200                      MOVE 'R375-DETERMINE-DC-NBR       '         45920000
459300                                    TO WS-ABEND-PARAGRAPH         45930000
459400                      MOVE 'UNSUCCESSFUL SELECT XFT00018'         45940000
459500                                    TO WS-ABEND-OPERATION         45950000
459600                      MOVE 'XFT00018' TO WS-ABEND-STRUCTURE-1     45960000
459700                      MOVE SPACES     TO WS-ABEND-STRUCTURE-2     45970000
459800                      PERFORM Z999-SQL-ERROR                      45980000
459900             END-EVALUATE                                         45990000
460000     END-PERFORM.                                                 46000000
460100                                                                  46010000
460200     IF WS-RETRY-COUNTER > 3                                      46020000
460300         MOVE 'R375-DETERMINE-DC-NBR         '                    46030000
460400                       TO WS-ABEND-PARAGRAPH                      46040000
460500         MOVE 'MAX RETRIES EXCEEDED ON SELECT XFT00018'           46050000
460600                         TO WS-ABEND-OPERATION                    46060000
460700         PERFORM Z999-SQL-ERROR                                   46070000
460800     END-IF.                                                      46080000
460900                                                                  46090000
461000      EVALUATE TRUE                                               46100000
461100         WHEN SQLCODE = ZEROS                                     46110000
461200              SET WS-VALID-DC TO TRUE                             46120000
461300         WHEN SQLCODE = +100                                      46130000
461400              SET WS-NOT-VALID-DC TO TRUE                         46140000
461500         WHEN OTHER                                               46150000
461600              MOVE 'R375-DETERMINE-DC-NBR         ' TO            46160000
461700                                        WS-ABEND-PARAGRAPH        46170000
461800              MOVE 'UNSUCCESSFUL SELECT XFT00018'                 46180000
461900                            TO WS-ABEND-OPERATION                 46190000
462000              MOVE 'XFT00018' TO WS-ABEND-STRUCTURE-1             46200000
462100              MOVE SPACES     TO WS-ABEND-STRUCTURE-2             46210000
462200              PERFORM Z999-SQL-ERROR                              46220000
462300      END-EVALUATE.                                               46230000
462400                                                                  46240000
462500*--------------------------------------------------------------*  46250000
462600* DETERMINE THE DC NUMBER FOR THE GIVEN STORE NUMBER WHEN THE  *  46260000
462700* TYPE IS 'CS'.                                                *  46270000
462800*--------------------------------------------------------------*  46280000
462900 R385-DETERMINE-DC-NBR.                                           46290000
463000                                                                  46300000
463100     INITIALIZE DCLXFT00017.                                      46310000
463200                                                                  46320000
463300     PERFORM WITH TEST AFTER                                      46330000
463400             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 46340000
463500             UNTIL   WS-RETRY-COUNTER > 3  OR                     46350000
463600                     SQLCODE = ZERO OR                            46360000
463700                     SQLCODE = +100                               46370000
463800                                                                  46380000
463900             EXEC SQL                                             46390000
464000                 SELECT A.DIST_NBR                                46400000
464100                   INTO :XFT00017-DIST-NBR                        46410000
464200                   FROM XFT_LOC A                                 46420000
464300                  WHERE A.LOC_NBR = :WS-SAVE-DC-NBR               46430000
464400             END-EXEC                                             46440000
464500                                                                  46450000
464600             EVALUATE TRUE                                        46460000
464700                 WHEN SQLCODE = ZERO                              46470000
464800                      MOVE XFT00017-DIST-NBR                      46480000
464900                        TO AP052-KOHLS-DC-TO-USE                  46490000
465000                 WHEN SQLCODE = +100                              46500000
465100                 WHEN SQLCODE = -904                              46510000
465200                 WHEN SQLCODE = -913                              46520000
465300                      CONTINUE                                    46530000
465400                 WHEN SQLWARN0 NOT = SPACES                       46540000
465500                 WHEN SQLCODE  NOT = ZERO                         46550000
465600                      MOVE 'R385-DETERMINE-DC-NBR       '         46560000
465700                                    TO WS-ABEND-PARAGRAPH         46570000
465800                      MOVE 'UNSUCCESSFUL SELECT XFT00017'         46580000
465900                                    TO WS-ABEND-OPERATION         46590000
466000                      MOVE 'XFT00017' TO WS-ABEND-STRUCTURE-1     46600000
466100                      MOVE SPACES     TO WS-ABEND-STRUCTURE-2     46610000
466200                      PERFORM Z999-SQL-ERROR                      46620000
466300             END-EVALUATE                                         46630000
466400     END-PERFORM.                                                 46640000
466500                                                                  46650000
466600     IF WS-RETRY-COUNTER > 3                                      46660000
466700         MOVE 'R385-DETERMINE-DC-NBR         '                    46670000
466800                       TO WS-ABEND-PARAGRAPH                      46680000
466900         MOVE 'MAX RETRIES EXCEEDED ON SELECT XFT00017'           46690000
467000                         TO WS-ABEND-OPERATION                    46700000
467100         PERFORM Z999-SQL-ERROR                                   46710000
467200     END-IF.                                                      46720000
467300                                                                  46730000
467400      EVALUATE TRUE                                               46740000
467500         WHEN SQLCODE = ZEROS                                     46750000
467600              SET WS-VALID-DC TO TRUE                             46760000
467700         WHEN SQLCODE = +100                                      46770000
467800              SET WS-NOT-VALID-DC TO TRUE                         46780000
467900         WHEN OTHER                                               46790000
468000              MOVE 'R385-DETERMINE-DC-NBR         ' TO            46800000
468100                                        WS-ABEND-PARAGRAPH        46810000
468200              MOVE 'UNSUCCESSFUL SELECT XFT00017'                 46820000
468300                            TO WS-ABEND-OPERATION                 46830000
468400              MOVE 'XFT00017' TO WS-ABEND-STRUCTURE-1             46840000
468500              MOVE SPACES     TO WS-ABEND-STRUCTURE-2             46850000
468600              PERFORM Z999-SQL-ERROR                              46860000
468700      END-EVALUATE.                                               46870000
468800                                                                  46880000
468900*--------------------------------------------------------------*  46890000
469000* CHECK FOR VALID UPC CODE                                     *  46900000
469100*--------------------------------------------------------------*  46910000
469200 R400-SELECT-TUPCSKU.                                             46920000
469300                                                                  46930000
469400     INITIALIZE DCLTUPCSKU.                                       46940000
469500                                                                  46950000
469600     PERFORM WITH TEST AFTER                                      46960000
469700             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 46970000
469800             UNTIL   WS-RETRY-COUNTER > 3  OR                     46980000
469900                     SQLCODE = ZERO OR                            46990000
470000                     SQLCODE = +100                               47000000
470100                                                                  47010000
470200             EXEC SQL                                             47020000
470300                 SELECT UPC_NBR                                   47030000
470400                      , ITEM_NBR                                  47040000
470500                 INTO  :TUPCSKU-UPC-NBR                           47050000
470600                     , :TUPCSKU-ITEM-NBR                          47060000
470700                 FROM  TUPCSKU                                    47070000
470800                 WHERE UPC_NBR = :WS-UPC-CODE-COMP3               47080000
470900             END-EXEC                                             47090000
471000                                                                  47100000
471100             EVALUATE TRUE                                        47110000
471200                 WHEN SQLCODE = ZERO                              47120000
471300                 WHEN SQLCODE = +100                              47130000
471400                 WHEN SQLCODE = -904                              47140000
471500                 WHEN SQLCODE = -913                              47150000
471600                      CONTINUE                                    47160000
471700                                                                  47170000
471800                 WHEN SQLWARN0 NOT = SPACES                       47180000
471900                 WHEN SQLCODE  NOT = ZERO                         47190000
472000                      MOVE 'R400-SELECT-TUPCSKU           '       47200000
472100                                    TO WS-ABEND-PARAGRAPH         47210000
472200                      MOVE 'UNSUCCESSFUL SELECT UPCSKU'           47220000
472300                                    TO WS-ABEND-OPERATION         47230000
472400                      MOVE 'TUPCSKU ' TO WS-ABEND-STRUCTURE-1     47240000
472500                      MOVE SPACES     TO WS-ABEND-STRUCTURE-2     47250000
472600                      PERFORM Z999-SQL-ERROR                      47260000
472700             END-EVALUATE                                         47270000
472800     END-PERFORM.                                                 47280000
472900                                                                  47290000
473000     IF WS-RETRY-COUNTER > 3                                      47300000
473100         MOVE 'R400-SELECT-TUPCSKU           '                    47310000
473200                       TO WS-ABEND-PARAGRAPH                      47320000
473300         MOVE 'MAX RETRIES EXCEEDED ON SELECT UPCSKU'             47330000
473400                         TO WS-ABEND-OPERATION                    47340000
473500         PERFORM Z999-SQL-ERROR                                   47350000
473600     END-IF.                                                      47360000
473700                                                                  47370000
473800      EVALUATE TRUE                                               47380000
473900         WHEN SQLCODE = ZEROS                                     47390000
474000              SET WS-VALID-UPC TO TRUE                            47400000
474100         WHEN SQLCODE = +100                                      47410000
474200              SET WS-NOT-VALID-UPC TO TRUE                        47420000
474300         WHEN OTHER                                               47430000
474400              MOVE 'R400-SELECT-TUPCSKU           ' TO            47440000
474500                                        WS-ABEND-PARAGRAPH        47450000
474600              MOVE 'UNSUCCESSFUL SELECT UPCSKU'                   47460000
474700                            TO WS-ABEND-OPERATION                 47470000
474800              MOVE 'TUPCSKU ' TO WS-ABEND-STRUCTURE-1             47480000
474900              MOVE SPACES     TO WS-ABEND-STRUCTURE-2             47490000
475000              PERFORM Z999-SQL-ERROR                              47500000
475100      END-EVALUATE.                                               47510000
475200                                                                  47520000
475300*--------------------------------------------------------------*  47530000
475400* SELECT THE PO LINE NBR FOR THE ITEM NBR                      *  47540000
475500*--------------------------------------------------------------*  47550000
475600 R450-SELECT-POLNE-BY-ITEM-NBR.                                   47560000
475700                                                                  47570000
475800     INITIALIZE DCLTPURITM.                                       47580000
475900                                                                  47590000
476000     PERFORM WITH TEST AFTER                                      47600000
476100             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 47610000
476200             UNTIL   WS-RETRY-COUNTER > 3  OR                     47620000
476300                     SQLCODE = ZERO OR                            47630000
476400                     SQLCODE = +100 OR                            47640000
476500                     SQLCODE = -811                               47650000
476600                                                                  47660000
476700             EXEC SQL                                             47670000
476800                 SELECT C.PO_LNE_NBR                              47680000
476900                 INTO  :PURITM-PO-LNE-NBR                         47690000
477000                  FROM TPURITM  C                                 47700000
477100                 WHERE C.ITM_NBR       = :TUPCSKU-ITEM-NBR        47710000
477200                   AND C.PO_NBR         = :WS-SAVE-PO-NBR-COMP    47720000
477300                   AND C.VER_STATUS_CDE = 'A'                     47730000
477400                   AND C.PO_LNE_NBR =                             47740000
477500                       (SELECT MAX(F.PO_LNE_NBR)                  47750000
477600                          FROM  TPURITM  F                        47760000
477700                         WHERE F.ITM_NBR  = :TUPCSKU-ITEM-NBR     47770000
477800                           AND F.PO_NBR   = :WS-SAVE-PO-NBR-COMP  47780000
477900                           AND F.VER_STATUS_CDE = 'A')            47790000
478000             END-EXEC                                             47800000
478100                                                                  47810000
478200             EVALUATE TRUE                                        47820000
478300                 WHEN SQLCODE = ZERO                              47830000
478400                 WHEN SQLCODE = +100                              47840000
478500                 WHEN SQLCODE = -904                              47850000
478600                 WHEN SQLCODE = -913                              47860000
478700                 WHEN SQLCODE = -811                              47870000
478800                      CONTINUE                                    47880000
478900                                                                  47890000
479000                 WHEN SQLWARN0 NOT = SPACES                       47900000
479100                 WHEN SQLCODE  NOT = ZERO                         47910000
479200                      MOVE 'R450-SELECT-POLNE-BY-ITEM-NBR '       47920000
479300                                    TO WS-ABEND-PARAGRAPH         47930000
479400                      MOVE 'UNSUCCESSFUL SELECT UPCSKU'           47940000
479500                                    TO WS-ABEND-OPERATION         47950000
479600                      MOVE 'TUPCSKU ' TO WS-ABEND-STRUCTURE-1     47960000
479700                      MOVE SPACES     TO WS-ABEND-STRUCTURE-2     47970000
479800                      PERFORM Z999-SQL-ERROR                      47980000
479900             END-EVALUATE                                         47990000
480000     END-PERFORM.                                                 48000000
480100                                                                  48010000
480200     IF WS-RETRY-COUNTER > 3                                      48020000
480300         MOVE 'R450-SELECT-POLNE-BY-ITEM-NBR '                    48030000
480400                       TO WS-ABEND-PARAGRAPH                      48040000
480500         MOVE 'MAX RETRIES EXCEEDED ON SELECT UPCSKU'             48050000
480600                         TO WS-ABEND-OPERATION                    48060000
480700         PERFORM Z999-SQL-ERROR                                   48070000
480800     END-IF.                                                      48080000
480900                                                                  48090000
481000     EVALUATE TRUE                                                48100000
481100        WHEN SQLCODE = ZEROS                                      48110000
481200        WHEN SQLCODE = -811                                       48120000
481300             CONTINUE                                             48130000
481400        WHEN SQLCODE = +100                                       48140000
481500             MOVE ZEROS TO PURITM-PO-LNE-NBR                      48150000
481600        WHEN OTHER                                                48160000
481700             MOVE 'R450-SELECT-POLNE-BY-ITEM-NBR ' TO             48170000
481800                                       WS-ABEND-PARAGRAPH         48180000
481900             MOVE 'UNSUCCESSFUL SELECT UPCSKU'                    48190000
482000                           TO WS-ABEND-OPERATION                  48200000
482100             MOVE 'TUPCSKU ' TO WS-ABEND-STRUCTURE-1              48210000
482200             MOVE SPACES     TO WS-ABEND-STRUCTURE-2              48220000
482300             PERFORM Z999-SQL-ERROR                               48230000
482400     END-EVALUATE.                                                48240000
482500                                                                  48250000
482600*--------------------------------------------------------------*  48260000
482700* SELECT THE PO LINE NUMBER FROM THE PURCHASE ITEM TABLE WITH  *  48270000
482800* THE VENDOR STYLE CODE                                        *  48280000
482900*--------------------------------------------------------------*  48290000
483000 R485-SELECT-PO-LNE-NBR.                                          48300000
483100                                                                  48310000
483200     PERFORM WITH TEST AFTER                                      48320000
483300         VARYING WS-RETRY-COUNTER FROM 1 BY 1                     48330000
483400         UNTIL   WS-RETRY-COUNTER > 3  OR                         48340000
483500                 SQLCODE = ZERO OR                                48350000
483600                 SQLCODE = +100 OR                                48360000
483700                 SQLCODE = -811                                   48370000
483800                                                                  48380000
483900         EXEC SQL                                                 48390000
484000             SELECT PO_LNE_NBR                                    48400000
484100             INTO  :PURITM-PO-LNE-NBR                             48410000
484200             FROM  TPURITM                                        48420000
484300             WHERE PO_NBR         = :WS-SAVE-PO-NBR-COMP          48430000
484400               AND VER_STATUS_CDE = 'A'                           48440000
484500               AND VEND_STYL_NAME = :WS-STYLE2                    48450000
484600         END-EXEC                                                 48460000
484700                                                                  48470000
484800         EVALUATE TRUE                                            48480000
484900             WHEN SQLCODE = ZERO                                  48490000
485000             WHEN SQLCODE = +100                                  48500000
485100             WHEN SQLCODE = -904                                  48510000
485200             WHEN SQLCODE = -913                                  48520000
485300             WHEN SQLCODE = -811                                  48530000
485400                  CONTINUE                                        48540000
485500                                                                  48550000
485600             WHEN SQLWARN0 NOT = SPACES                           48560000
485700             WHEN SQLCODE  NOT = ZERO                             48570000
485800                  MOVE 'R485-SELECT-PO-LNE-NBR        '           48580000
485900                                TO WS-ABEND-PARAGRAPH             48590000
486000                  MOVE 'UNSUCCESSFUL SELECT PURITM'               48600000
486100                                TO WS-ABEND-OPERATION             48610000
486200                  MOVE 'TPURITM ' TO WS-ABEND-STRUCTURE-1         48620000
486300                  MOVE '        ' TO WS-ABEND-STRUCTURE-2         48630000
486400                  PERFORM Z999-SQL-ERROR                          48640000
486500         END-EVALUATE                                             48650000
486600     END-PERFORM.                                                 48660000
486700                                                                  48670000
486800     IF WS-RETRY-COUNTER > 3                                      48680000
486900         MOVE 'R485-SELECT-PO-LNE-NBR        '                    48690000
487000                       TO WS-ABEND-PARAGRAPH                      48700000
487100         MOVE 'MAX RETRIES EXCEEDED ON SELECT PURITM'             48710000
487200                         TO WS-ABEND-OPERATION                    48720000
487300         PERFORM Z999-SQL-ERROR                                   48730000
487400     END-IF.                                                      48740000
487500                                                                  48750000
487600     EVALUATE TRUE                                                48760000
487700         WHEN SQLCODE = ZEROS                                     48770000
487800         WHEN SQLCODE = -811                                      48780000
487900              CONTINUE                                            48790000
488000         WHEN SQLCODE = +100                                      48800000
488100              MOVE ZEROS TO PURITM-PO-LNE-NBR                     48810000
488200         WHEN OTHER                                               48820000
488300              MOVE 'R485-SELECT-PO-LNE-NBR        ' TO            48830000
488400                                        WS-ABEND-PARAGRAPH        48840000
488500              MOVE 'UNSUCCESSFUL SELECT PURITM'                   48850000
488600                            TO WS-ABEND-OPERATION                 48860000
488700              MOVE 'TPURITM ' TO WS-ABEND-STRUCTURE-1             48870000
488800              MOVE '        ' TO WS-ABEND-STRUCTURE-2             48880000
488900              PERFORM Z999-SQL-ERROR                              48890000
489000     END-EVALUATE.                                                48900000
489100                                                                  48910000
489110*--------------------------------------------------------------*  48911000
489120* SELECT THE PO LINE NUMBER FROM THE PURCHASE ITEM TABLE WITH  *  48912000
489130* THE SKU NUMBER                                               *  48913000
489140*--------------------------------------------------------------*  48914000
489150 R490-SELECT-PO-LNE-NBR.                                          48915000
489160                                                                  48916000
489195     EXEC SQL                                                     48919501
489196         SELECT PO_LNE_NBR                                        48919601
489197         INTO  :PURITM-PO-LNE-NBR                                 48919701
489198         FROM  TPURITM                                            48919801
489199         WHERE PO_NBR         = :WS-SAVE-PO-NBR-COMP              48919901
489200           AND VER_STATUS_CDE = 'A'                               48920001
489201           AND RMS_PO_SKU_NBR = :PURITM-RMS-PO-SKU-NBR            48920101
489202     END-EXEC.                                                    48920201
489203                                                                  48920300
489232     EVALUATE TRUE                                                48923200
489233         WHEN SQLCODE = ZEROS                                     48923300
489234         WHEN SQLCODE = -811                                      48923400
489235              CONTINUE                                            48923500
489236         WHEN SQLCODE = +100                                      48923600
489237              MOVE ZEROS TO PURITM-PO-LNE-NBR                     48923701
489238         WHEN OTHER                                               48923800
489239              MOVE 'R490-SELECT-PO-LNE-NBR        ' TO            48923900
489240                                        WS-ABEND-PARAGRAPH        48924000
489241              MOVE 'UNSUCCESSFUL SELECT PURITM'                   48924100
489242                            TO WS-ABEND-OPERATION                 48924200
489243              MOVE 'TPURITM ' TO WS-ABEND-STRUCTURE-1             48924300
489244              MOVE '        ' TO WS-ABEND-STRUCTURE-2             48924400
489245              PERFORM Z999-SQL-ERROR                              48924500
489246     END-EVALUATE.                                                48924600
489247                                                                  48924700
489250*--------------------------------------------------------------*  48925000
489300* CHECK FOR VALID PURCHASE ORDER NUMBER (THE STATUS OF THE PO  *  48930000
489400* BE ACTIVE AND THE PO TYPE MUST BE A VALID MERCHANDISE TYPE)  *  48940000
489500*--------------------------------------------------------------*  48950000
489600 R600-SELECT-TPURCHS.                                             48960000
489700                                                                  48970000
489800     PERFORM WITH TEST AFTER                                      48980000
489900             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 48990000
490000             UNTIL   WS-RETRY-COUNTER > 3  OR                     49000000
490100                     SQLCODE = ZERO OR                            49010000
490200                     SQLCODE = +100                               49020000
490300                                                                  49030000
490400             EXEC SQL                                             49040000
490500                 SELECT PO_NBR                                    49050000
490600                      , ENT_ID                                    49060000
490700                      , NEW_STR_PO_IND                            49070000
490800                      , DEPT_NBR                                  49080000
490900                      , PO_TYP_CDE                                49090000
491000                      , DIR_STR_IND                               49100000
491100                      , STATUS_CDE                                49110000
491200                 INTO  :PURCHS-PO-NBR                             49120000
491300                      ,:PURCHS-ENT-ID                             49130000
491400                      ,:PURCHS-NEW-STR-PO-IND                     49140000
491500                      ,:PURCHS-DEPT-NBR                           49150000
491600                      ,:PURCHS-PO-TYP-CDE                         49160000
491700                      ,:PURCHS-DIR-STR-IND                        49170000
491800                      ,:PURCHS-STATUS-CDE                         49180000
491900                 FROM  TPURCHS                                    49190000
492000                 WHERE PO_NBR         = :WS-SAVE-PO-NBR-COMP      49200000
492100                   AND VER_STATUS_CDE = 'A'                       49210000
492200                   AND PO_CATEG_CDE   = 'MR'                      49220000
492300             END-EXEC                                             49230000
492400                                                                  49240000
492500             EVALUATE TRUE                                        49250000
492600                 WHEN SQLCODE = ZERO                              49260000
492700                 WHEN SQLCODE = +100                              49270000
492800                 WHEN SQLCODE = -904                              49280000
492900                 WHEN SQLCODE = -913                              49290000
493000                      CONTINUE                                    49300000
493100                                                                  49310000
493200                 WHEN SQLWARN0 NOT = SPACES                       49320000
493300                 WHEN SQLCODE  NOT = ZERO                         49330000
493400                      MOVE 'R600-SELECT-TPURCHS           '       49340000
493500                                    TO WS-ABEND-PARAGRAPH         49350000
493600                      MOVE 'UNSUCCESSFUL SELECT PURCHS'           49360000
493700                                    TO WS-ABEND-OPERATION         49370000
493800                      MOVE 'TPURCHS ' TO WS-ABEND-STRUCTURE-1     49380000
493900                      MOVE SPACES     TO WS-ABEND-STRUCTURE-2     49390000
494000                      PERFORM Z999-SQL-ERROR                      49400000
494100             END-EVALUATE                                         49410000
494200     END-PERFORM.                                                 49420000
494300                                                                  49430000
494400     IF WS-RETRY-COUNTER > 3                                      49440000
494500         MOVE 'R600-SELECT-TPURCHS           '                    49450000
494600                       TO WS-ABEND-PARAGRAPH                      49460000
494700         MOVE 'MAX RETRIES EXCEEDED ON SELECT PURCHS'             49470000
494800                         TO WS-ABEND-OPERATION                    49480000
494900         PERFORM Z999-SQL-ERROR                                   49490000
495000     END-IF.                                                      49500000
495100                                                                  49510000
495200     EVALUATE TRUE                                                49520000
495300        WHEN SQLCODE = ZEROS                                      49530000
495400             SET WS-VALID-PO-NBR TO TRUE                          49540000
495500        WHEN SQLCODE = +100                                       49550000
495600             SET WS-NOT-VALID-PO-NBR TO TRUE                      49560000
495700        WHEN OTHER                                                49570000
495800             MOVE 'R600-SELECT-TPURCHS           ' TO             49580000
495900                                       WS-ABEND-PARAGRAPH         49590000
496000             MOVE 'UNSUCCESSFUL SELECT PURCHS'                    49600000
496100                           TO WS-ABEND-OPERATION                  49610000
496200             MOVE 'TPURCHS ' TO WS-ABEND-STRUCTURE-1              49620000
496300             MOVE SPACES     TO WS-ABEND-STRUCTURE-2              49630000
496400             PERFORM Z999-SQL-ERROR                               49640000
496500     END-EVALUATE.                                                49650000
496600                                                                  49660000
496700*--------------------------------------------------------------*  49670000
496800* DETERMINE THE FREIGHT CODE AND PERCENTAGE                    *  49680000
496900*--------------------------------------------------------------*  49690000
497000 R700-SELECT-FREIGHT.                                             49700000
497100                                                                  49710000
497200     MOVE 0.0000 TO AP052-VEND-FRGT-PCT                           49720000
497300                    AP052-KOHLS-FRGT-PCT.                         49730000
497400                                                                  49740000
497500     PERFORM WITH TEST AFTER                                      49750000
497600             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 49760000
497700             UNTIL   WS-RETRY-COUNTER > 3  OR                     49770000
497800                     SQLCODE = ZERO OR                            49780000
497900                     SQLCODE = +100                               49790000
498000                                                                  49800000
498100             EXEC SQL                                             49810000
498200                  SELECT FRGT_PAYT_CDE                            49820000
498300                        ,KOHLS_FRGT_PCT                           49830000
498400                        ,VEND_FRGT_PCT                            49840000
498500                        ,CAN_IFNOT_SHIP_DTE                       49850000
498600                    INTO :PLNSHP-FRGT-PAYT-CDE                    49860000
498700                        ,:PLNSHP-KOHLS-FRGT-PCT                   49870000
498800                        ,:PLNSHP-VEND-FRGT-PCT                    49880000
498900                        ,:PLNSHP-CAN-IFNOT-SHIP-DTE               49890000
499000                    FROM TPLNSHP                                  49900000
499100                   WHERE PO_NBR         = :PURCHS-PO-NBR          49910000
499200                     AND VER_STATUS_CDE = 'A'                     49920000
499300             END-EXEC                                             49930000
499400                                                                  49940000
499500             EVALUATE TRUE                                        49950000
499600                 WHEN SQLCODE = ZERO                              49960000
499700                 WHEN SQLCODE = +100                              49970000
499800                 WHEN SQLCODE = -904                              49980000
499900                 WHEN SQLCODE = -913                              49990000
500000                      CONTINUE                                    50000000
500100                                                                  50010000
500200                 WHEN SQLWARN0 NOT = SPACES                       50020000
500300                 WHEN SQLCODE  NOT = ZERO                         50030000
500400                      MOVE 'R700-SELECT-FREIGHT           '       50040000
500500                                    TO WS-ABEND-PARAGRAPH         50050000
500600                      MOVE 'UNSUCCESSFUL SELECT PLNSHP'           50060000
500700                                    TO WS-ABEND-OPERATION         50070000
500800                      MOVE 'TPLNSHP ' TO WS-ABEND-STRUCTURE-1     50080000
500900                      MOVE 'TPURCHS ' TO WS-ABEND-STRUCTURE-2     50090000
501000                      PERFORM Z999-SQL-ERROR                      50100000
501100             END-EVALUATE                                         50110000
501200     END-PERFORM.                                                 50120000
501300                                                                  50130000
501400     IF WS-RETRY-COUNTER > 3                                      50140000
501500         MOVE 'R700-SELECT-FREIGHT           '                    50150000
501600                       TO WS-ABEND-PARAGRAPH                      50160000
501700         MOVE 'MAX RETRIES EXCEEDED ON SELECT PLNSHP'             50170000
501800                         TO WS-ABEND-OPERATION                    50180000
501900         PERFORM Z999-SQL-ERROR                                   50190000
502000     END-IF.                                                      50200000
502100                                                                  50210000
502200     EVALUATE TRUE                                                50220000
502300        WHEN SQLCODE = ZEROS                                      50230000
502400             IF PLNSHP-FRGT-PAYT-CDE = 'V' OR ' '                 50240000
502500                MOVE 1.0000 TO AP052-VEND-FRGT-PCT                50250000
502600             ELSE                                                 50260000
502700                IF PLNSHP-FRGT-PAYT-CDE = 'K'                     50270000
502800                   MOVE 1.0000 TO AP052-KOHLS-FRGT-PCT            50280000
502900                ELSE                                              50290000
503000                   MOVE PLNSHP-VEND-FRGT-PCT TO                   50300000
503100                          AP052-VEND-FRGT-PCT                     50310000
503200                   MOVE PLNSHP-KOHLS-FRGT-PCT TO                  50320000
503300                          AP052-KOHLS-FRGT-PCT                    50330000
503400                END-IF                                            50340000
503500             END-IF                                               50350000
503600        WHEN SQLCODE = +100                                       50360000
503700             CONTINUE                                             50370000
503800        WHEN OTHER                                                50380000
503900             MOVE 'R700-SELECT-FREIGHT           ' TO             50390000
504000                                       WS-ABEND-PARAGRAPH         50400000
504100             MOVE 'UNSUCCESSFUL SELECT PLNSHP'                    50410000
504200                           TO WS-ABEND-OPERATION                  50420000
504300             MOVE 'TPLNSHP ' TO WS-ABEND-STRUCTURE-1              50430000
504400             MOVE 'TPURCHS ' TO WS-ABEND-STRUCTURE-2              50440000
504500             PERFORM Z999-SQL-ERROR                               50450000
504600     END-EVALUATE.                                                50460000
504700                                                                  50470000
504800*--------------------------------------------------------------*  50480000
504900* SELECT THE ENT-ID FROM THE TRADING PARTNER TABLE             *  50490000
505000*--------------------------------------------------------------*  50500000
505100 R800-SELECT-ENTID-TTRDPRT.                                       50510000
505200                                                                  50520000
505300     EXEC SQL                                                     50530000
505400          SELECT ENT_ID                                           50540000
505500            INTO :WS-TRDPRT-ENT-ID                                50550000
505600            FROM TTRDPRT                                          50560000
505700           WHERE VEND_INCHG_ID = :WS-TRDPRT-VEND-ID               50570000
505800             AND VEND_INCHG_ID_DESC = :WS-TRDPRT-VEND-ID-DESC     50580000
505900     END-EXEC.                                                    50590000
506000                                                                  50600000
506100     EVALUATE TRUE                                                50610000
506200         WHEN SQLCODE = ZERO                                      50620000
506300         WHEN SQLCODE = -811                                      50630000
506400              SET VALID-TRADE-PART TO TRUE                        50640000
506500         WHEN SQLCODE = +100                                      50650000
506600              SET NOT-VALID-TRADE-PART TO TRUE                    50660000
506700         WHEN SQLWARN0 NOT = SPACES                               50670000
506800         WHEN SQLCODE  NOT = ZERO                                 50680000
506900              MOVE 'R800-SELECT-ENTID-TTRDPRT  '                  50690000
507000                            TO WS-ABEND-PARAGRAPH                 50700000
507100              MOVE 'UNSUCCESSFUL SELECT'                          50710000
507200                            TO WS-ABEND-OPERATION                 50720000
507300              MOVE 'TTRDPRT ' TO WS-ABEND-STRUCTURE-1             50730000
507400              MOVE SPACES     TO WS-ABEND-STRUCTURE-2             50740000
507500              PERFORM Z999-SQL-ERROR                              50750000
507600     END-EVALUATE.                                                50760000
507700                                                                  50770000
507800*--------------------------------------------------------------*  50780000
507900* CHECK THE TRADING PARTNER TABLE TO OBTAIN THE 824 INDICATOR  *  50790000
508000*--------------------------------------------------------------*  50800000
508100 R900-SELECT-824-IND.                                             50810000
508200                                                                  50820000
508300     MOVE AP051-EDI-SENDER-ID      TO TRDPRT-VEND-INCHG-ID.       50830000
508400     MOVE AP051-EDI-SENDER-ID-QUAL TO TRDPRT-VEND-INCHG-ID-DESC.  50840000
508500                                                                  50850000
508600     EXEC SQL                                                     50860000
508700        OPEN TRDPRT_CSR                                           50870000
508800     END-EXEC.                                                    50880000
508900                                                                  50890000
509000     EVALUATE TRUE                                                50900000
509100         WHEN SQLCODE = ZERO                                      50910000
509200              CONTINUE                                            50920000
509300         WHEN SQLWARN0 NOT = SPACES                               50930000
509400         WHEN SQLCODE  NOT = ZERO                                 50940000
509500              MOVE 'R900-SELECT-824-IND' TO WS-ABEND-PARAGRAPH    50950000
509600              MOVE 'UNSUCCESSFUL OPEN'   TO WS-ABEND-OPERATION    50960000
509700              MOVE 'TTRDPRT  '           TO WS-ABEND-STRUCTURE-1  50970000
509800              MOVE 'TTRDTRN  '           TO WS-ABEND-STRUCTURE-2  50980000
509900              PERFORM Z999-SQL-ERROR                              50990000
510000     END-EVALUATE.                                                51000000
510100                                                                  51010000
510200     EXEC SQL                                                     51020000
510300         FETCH TRDPRT_CSR                                         51030000
510400         INTO :TRDTRN-PROD-TEST-IND                               51040000
510500     END-EXEC                                                     51050000
510600                                                                  51060000
510700     EVALUATE TRUE                                                51070000
510800         WHEN SQLCODE = ZERO                                      51080000
510900              CONTINUE                                            51090000
511000         WHEN SQLCODE = +100                                      51100000
511100              MOVE 'N' TO TRDTRN-PROD-TEST-IND                    51110000
511200         WHEN SQLWARN0 NOT = SPACES                               51120000
511300         WHEN SQLCODE  NOT = ZERO                                 51130000
511400              MOVE 'R900-SELECT-824-IND' TO WS-ABEND-PARAGRAPH    51140000
511500              MOVE 'UNSUCCESSFUL FETCH'  TO WS-ABEND-OPERATION    51150000
511600              MOVE 'TTRDPRT  '           TO WS-ABEND-STRUCTURE-1  51160000
511700              MOVE 'TTRDTRN  '           TO WS-ABEND-STRUCTURE-2  51170000
511800              PERFORM Z999-SQL-ERROR                              51180000
511900     END-EVALUATE.                                                51190000
512000                                                                  51200000
512100     EXEC SQL                                                     51210000
512200        CLOSE TRDPRT_CSR                                          51220000
512300     END-EXEC.                                                    51230000
512400                                                                  51240000
512500     EVALUATE TRUE                                                51250000
512600         WHEN SQLCODE = ZERO                                      51260000
512700              CONTINUE                                            51270000
512800         WHEN SQLWARN0 NOT = SPACES                               51280000
512900         WHEN SQLCODE  NOT = ZERO                                 51290000
513000              MOVE 'R900-SELECT-824-IND' TO WS-ABEND-PARAGRAPH    51300000
513100              MOVE 'UNSUCCESSFUL CLOSE'  TO WS-ABEND-OPERATION    51310000
513200              MOVE 'TTRDPRT  '           TO WS-ABEND-STRUCTURE-1  51320000
513300              MOVE 'TTRDTRN  '           TO WS-ABEND-STRUCTURE-2  51330000
513400              PERFORM Z999-SQL-ERROR                              51340000
513500     END-EVALUATE.                                                51350000
513600                                                                  51360000
513700*--------------------------------------------------------------*  51370000
513800* CHECK THE TENTNME TO OBTAIN THE VENDOR ENT ID DESCRIPTION    *  51380000
513900*--------------------------------------------------------------*  51390000
514000 R950-SELECT-TENTNME.                                             51400000
514100                                                                  51410000
514200     MOVE SPACES TO ENTNME-ENT-NAME-DESC                          51420000
514300                    WS-EXTENT-DUN-NBR.                            51430000
514400                                                                  51440000
514500     PERFORM WITH TEST AFTER                                      51450000
514600             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 51460000
514700             UNTIL   WS-RETRY-COUNTER > 3  OR                     51470000
514800                     SQLCODE = ZERO OR                            51480000
514900                     SQLCODE = +100                               51490000
515000                                                                  51500000
515100             EXEC SQL                                             51510000
515200                 SELECT A.ENT_NAME_DESC                           51520000
515300                      , B.DUN_NBR                                 51530000
515400                 INTO :ENTNME-ENT-NAME-DESC                       51540000
515500                    , :WS-EXTENT-DUN-NBR                          51550000
515600                 FROM TENTNME A                                   51560000
515700                    , TEXTENT B                                   51570000
515800                 WHERE A.ENT_ID         = :PURCHS-ENT-ID          51580000
515900                   AND B.ENT_ID         = A.ENT_ID                51590000
516000                   AND B.STATUS_CDE     = 'A'                     51600000
516100                   AND A.TYPE_CDE       = '01'                    51610000
516200             END-EXEC                                             51620000
516300                                                                  51630000
516400             EVALUATE TRUE                                        51640000
516500                 WHEN SQLCODE = ZERO                              51650000
516600                 WHEN SQLCODE = +100                              51660000
516700                 WHEN SQLCODE = -904                              51670000
516800                 WHEN SQLCODE = -913                              51680000
516900                      CONTINUE                                    51690000
517000                                                                  51700000
517100                 WHEN SQLWARN0 NOT = SPACES                       51710000
517200                 WHEN SQLCODE  NOT = ZERO                         51720000
517300                      MOVE 'R950-SELECT-TENTNME           '       51730000
517400                                    TO WS-ABEND-PARAGRAPH         51740000
517500                      MOVE 'UNSUCCESSFUL SELECT ENTNME'           51750000
517600                                    TO WS-ABEND-OPERATION         51760000
517700                      MOVE 'TENTNME ' TO WS-ABEND-STRUCTURE-1     51770000
517800                      MOVE SPACES     TO WS-ABEND-STRUCTURE-2     51780000
517900                      PERFORM Z999-SQL-ERROR                      51790000
518000             END-EVALUATE                                         51800000
518100     END-PERFORM.                                                 51810000
518200                                                                  51820000
518300     IF WS-RETRY-COUNTER > 3                                      51830000
518400         MOVE 'R950-SELECT-TENTNME           '                    51840000
518500                       TO WS-ABEND-PARAGRAPH                      51850000
518600         MOVE 'MAX RETRIES EXCEEDED ON SELECT ENTNME'             51860000
518700                         TO WS-ABEND-OPERATION                    51870000
518800         PERFORM Z999-SQL-ERROR                                   51880000
518900     END-IF.                                                      51890000
519000                                                                  51900000
519100     EVALUATE TRUE                                                51910000
519200        WHEN SQLCODE = ZEROS                                      51920000
519300             SET WS-VALID-DUNS TO TRUE                            51930000
519400        WHEN SQLCODE = +100                                       51940000
519500             SET WS-NOT-VALID-DUNS TO TRUE                        51950000
519600        WHEN OTHER                                                51960000
519700             MOVE 'R950-SELECT-TENTNME           ' TO             51970000
519800                                       WS-ABEND-PARAGRAPH         51980000
519900             MOVE 'UNSUCCESSFUL SELECT EXTENT'                    51990000
520000                           TO WS-ABEND-OPERATION                  52000000
520100             MOVE 'TENTNME ' TO WS-ABEND-STRUCTURE-1              52010000
520200             MOVE 'TEXTENT ' TO WS-ABEND-STRUCTURE-2              52020000
520300             PERFORM Z999-SQL-ERROR                               52030000
520400     END-EVALUATE.                                                52040000
520500                                                                  52050000
520600*--------------------------------------------------------------*  52060000
520700* PROCESS ALLOWANCE CURSOR                                     *  52070000
520800*--------------------------------------------------------------*  52080000
520900 S100-SELECT-ALLW.                                                52090000
521000                                                                  52100000
521100     SET NO-PO-ALLW-DATA-EXISTS TO TRUE.                          52110000
521200     INITIALIZE TBL-ALLOWANCE-TABLE-AREA.                         52120000
521300                                                                  52130000
521400** OPEN ALLOWANCE CURSOR                                          52140000
521500     EXEC SQL                                                     52150000
521600        OPEN ALLOWANCE_CSR                                        52160000
521700     END-EXEC.                                                    52170000
521800                                                                  52180000
521900     EVALUATE TRUE                                                52190000
522000         WHEN SQLCODE = ZERO                                      52200000
522100              SET NOT-ALLOWANCE-EOC TO TRUE                       52210000
522200         WHEN SQLWARN0 NOT = SPACES                               52220000
522300         WHEN SQLCODE  NOT = ZERO                                 52230000
522400              MOVE 'S100-SELECT-ALLW'  TO WS-ABEND-PARAGRAPH      52240000
522500              MOVE 'UNSUCCESSFUL OPEN' TO WS-ABEND-OPERATION      52250000
522600              MOVE 'TPOAGMT '          TO WS-ABEND-STRUCTURE-1    52260000
522700              MOVE SPACES              TO WS-ABEND-STRUCTURE-2    52270000
522800              PERFORM Z999-SQL-ERROR                              52280000
522900     END-EVALUATE.                                                52290000
523000                                                                  52300000
523100** FETCH ALLOWANCE CURSOR                                         52310000
523200     SET ALLOW-INDX TO 1                                          52320000
523300     PERFORM UNTIL ALLOWANCE-EOC                                  52330000
523400             OR ALLOW-INDX > 10                                   52340000
523500         EXEC SQL                                                 52350000
523600             FETCH ALLOWANCE_CSR                                  52360000
523700             INTO  :POAGMT-TYP-CDE                                52370000
523800                 , :POAGMT-DISC-PCT                               52380000
523900         END-EXEC                                                 52390000
524000                                                                  52400000
524100         EVALUATE TRUE                                            52410000
524200             WHEN SQLCODE = ZERO                                  52420000
524300                  SET PO-ALLW-DATA-EXISTS TO TRUE                 52430000
524400             WHEN SQLCODE = +100                                  52440000
524500                  SET ALLOWANCE-EOC TO TRUE                       52450000
524600             WHEN SQLWARN0 NOT = SPACES                           52460000
524700             WHEN SQLCODE  NOT = ZERO                             52470000
524800                  MOVE 'S100-SELECT-ALLW'   TO WS-ABEND-PARAGRAPH 52480000
524900                  MOVE 'UNSUCCESSFUL FETCH' TO WS-ABEND-OPERATION 52490000
525000                  MOVE 'TPOAGMT '        TO WS-ABEND-STRUCTURE-1  52500000
525100                  MOVE SPACES            TO WS-ABEND-STRUCTURE-2  52510000
525200                  PERFORM Z999-SQL-ERROR                          52520000
525300         END-EVALUATE                                             52530000
525400                                                                  52540000
525500** FILL ALLOWANCE TABLE                                           52550000
525600         IF ALLOWANCE-EOC                                         52560000
525700            CONTINUE                                              52570000
525800         ELSE                                                     52580000
525900            EVALUATE POAGMT-TYP-CDE                               52590000
526000              WHEN 1                                              52600000
526100                  MOVE 'TRD'    TO TBL-ALLOWANCE-CDE(ALLOW-INDX)  52610000
526200              WHEN 7                                              52620000
526300                  MOVE 'MOS'    TO TBL-ALLOWANCE-CDE(ALLOW-INDX)  52630000
526400              WHEN 8                                              52640000
526500                  MOVE 'TRD'    TO TBL-ALLOWANCE-CDE(ALLOW-INDX)  52650000
526600              WHEN 9                                              52660000
526700                  MOVE 'ADV'    TO TBL-ALLOWANCE-CDE(ALLOW-INDX)  52670000
526800              WHEN 10                                             52680000
526900                  MOVE 'COP'    TO TBL-ALLOWANCE-CDE(ALLOW-INDX)  52690000
527000              WHEN 11                                             52700000
527100                  MOVE 'ALW'    TO TBL-ALLOWANCE-CDE(ALLOW-INDX)  52710000
527200            END-EVALUATE                                          52720000
527300            COMPUTE TBL-ALLOWANCE-PCT(ALLOW-INDX)                 52730000
527400                  = POAGMT-DISC-PCT * 100                         52740000
527500            COMPUTE TBL-ALLOWANCE-AMT(ALLOW-INDX)                 52750000
527600                  = WS-DETAIL-GROSS-INVOICE-AMT * POAGMT-DISC-PCT 52760000
527700            MOVE 'P' TO TBL-ALLOW-SRC-IND(ALLOW-INDX)             52770000
527800            SET ALLOW-INDX UP BY 1                                52780000
527900         END-IF                                                   52790000
528000     END-PERFORM.                                                 52800000
528100                                                                  52810000
528200** CHECK IF THERE WAS A DISCOUNT SELECTED IN THE TERMS CURSOR     52820000
528300     IF WS-SAVE-NEW-STR-DISC-PCT > 0                              52830000
528400        SET HOLD-ALLOW-INDX TO ALLOW-INDX                         52840000
528500                                                                  52850000
528600        IF PURCHS-NEW-STR-PO-IND = 'Y'                            52860000
528700           MOVE 'NSD' TO HOLD-ALLOWANCE-CDE                       52870000
528800        ELSE                                                      52880000
528900           MOVE 'TRD' TO HOLD-ALLOWANCE-CDE                       52890000
529000        END-IF                                                    52900000
529100                                                                  52910000
529200        SET ALLOW-INDX TO 1                                       52920000
529300        SEARCH TBL-ALLOWANCE-TABLE                                52930000
529400          AT END                                                  52940000
529500             SET ALLOW-CODE-NOT-FOUND TO TRUE                     52950000
529600          WHEN TBL-ALLOWANCE-CDE(ALLOW-INDX) = HOLD-ALLOWANCE-CDE 52960000
529700             SET ALLOW-CODE-FOUND TO TRUE                         52970000
529800          WHEN TBL-ALLOWANCE-CDE(ALLOW-INDX) = SPACES             52980000
529900             SET ALLOW-CODE-NOT-FOUND TO TRUE                     52990000
530000        END-SEARCH                                                53000000
530100                                                                  53010000
530200        IF ALLOW-CODE-FOUND                                       53020000
530300           COMPUTE TBL-ALLOWANCE-PCT(ALLOW-INDX)                  53030000
530400                 = TBL-ALLOWANCE-PCT(ALLOW-INDX)                  53040000
530500                 + (WS-SAVE-NEW-STR-DISC-PCT * 100)               53050000
530600           COMPUTE TBL-ALLOWANCE-AMT(ALLOW-INDX)                  53060000
530700                 = TBL-ALLOWANCE-AMT(ALLOW-INDX)                  53070000
530800                 + (WS-DETAIL-GROSS-INVOICE-AMT                   53080000
530900                    * WS-SAVE-NEW-STR-DISC-PCT)                   53090000
531000        ELSE                                                      53100000
531100           SET ALLOW-INDX TO HOLD-ALLOW-INDX                      53110000
531200           MOVE HOLD-ALLOWANCE-CDE                                53120000
531300                                TO TBL-ALLOWANCE-CDE(ALLOW-INDX)  53130000
531400           COMPUTE TBL-ALLOWANCE-PCT(ALLOW-INDX)                  53140000
531500                 = WS-SAVE-NEW-STR-DISC-PCT * 100                 53150000
531600           COMPUTE TBL-ALLOWANCE-AMT(ALLOW-INDX)                  53160000
531700                 = WS-DETAIL-GROSS-INVOICE-AMT                    53170000
531800                 * WS-SAVE-NEW-STR-DISC-PCT                       53180000
531900           MOVE 'P' TO TBL-ALLOW-SRC-IND(ALLOW-INDX)              53190000
532000        END-IF                                                    53200000
532100     END-IF.                                                      53210000
532200                                                                  53220000
532300** CLOSE ALLOWANCE CURSOR                                         53230000
532400     EXEC SQL                                                     53240000
532500        CLOSE ALLOWANCE_CSR                                       53250000
532600     END-EXEC.                                                    53260000
532700                                                                  53270000
532800     EVALUATE TRUE                                                53280000
532900         WHEN SQLCODE = ZERO                                      53290000
533000              CONTINUE                                            53300000
533100         WHEN SQLWARN0 NOT = SPACES                               53310000
533200         WHEN SQLCODE  NOT = ZERO                                 53320000
533300              MOVE 'S100-SELECT-ALLW'   TO WS-ABEND-PARAGRAPH     53330000
533400              MOVE 'UNSUCCESSFUL CLOSE' TO WS-ABEND-OPERATION     53340000
533500              MOVE 'TPOAGMT '           TO WS-ABEND-STRUCTURE-1   53350000
533600              MOVE SPACES               TO WS-ABEND-STRUCTURE-2   53360000
533700              PERFORM Z999-SQL-ERROR                              53370000
533800     END-EVALUATE.                                                53380000
533900                                                                  53390000
534000                                                                  53400000
534100*--------------------------------------------------------------*  53410000
534200* COMPARES THE ALLOWANCES ON THE EDI INVOICE TO THE TABLE OF   *  53420000
534300* ALLOWANCES LOADED FROM THE PO.                               *  53430000
534400*--------------------------------------------------------------*  53440000
534500 S200-LOAD-INVOICE-ALLOWANCE.                                     53450000
534600                                                                  53460000
534700     SET ALLOW-INDX TO 1.                                         53470000
534800     IF AP052-ALLW-CHRG-CODE = 'MOS' OR 'TRD' OR 'ADV' OR 'NSD'   53480000
534900      OR 'COP' OR 'ALW'                                           53490000
535000        SEARCH TBL-ALLOWANCE-TABLE                                53500000
535100          AT END                                                  53510000
535200               SET ALLOW-CODE-NOT-FOUND TO TRUE                   53520000
535300          WHEN TBL-ALLOWANCE-CDE(ALLOW-INDX)                      53530000
535400                 = AP052-ALLW-CHRG-CODE                           53540000
535500           AND TBL-ALLOW-SRC-IND(ALLOW-INDX) = 'P'                53550000
535600               SET ALLOW-CODE-FOUND     TO TRUE                   53560000
535700          WHEN TBL-ALLOWANCE-CDE(ALLOW-INDX) = SPACES             53570000
535800               SET ALLOW-CODE-NOT-FOUND     TO TRUE               53580000
535900        END-SEARCH                                                53590000
536000     ELSE                                                         53600000
536100        SEARCH TBL-ALLOWANCE-TABLE                                53610000
536200          AT END                                                  53620000
536300               SET ALLOW-CODE-NOT-FOUND TO TRUE                   53630000
536400          WHEN TBL-ALLOWANCE-CDE(ALLOW-INDX) = SPACES             53640000
536500               SET ALLOW-CODE-NOT-FOUND     TO TRUE               53650000
536600        END-SEARCH                                                53660000
536700     END-IF.                                                      53670000
536800                                                                  53680000
536900     IF ALLOW-CODE-FOUND                                          53690000
537000        IF AP052-ALLW-CHRG-PCT > 0                                53700000
537100           IF AP052-ALLW-CHRG-PCT >= TBL-ALLOWANCE-PCT(ALLOW-INDX)53710000
537200              MOVE AP052-ALLW-CHRG-PCT                            53720000
537300                                  TO TBL-ALLOWANCE-PCT(ALLOW-INDX)53730000
537400              MOVE AP052-ALLW-CHRG-TOTAL                          53740000
537500                                  TO TBL-ALLOWANCE-AMT(ALLOW-INDX)53750000
537600              MOVE 'I'            TO TBL-ALLOW-SRC-IND(ALLOW-INDX)53760000
537700              IF TBL-ALLOWANCE-CDE(ALLOW-INDX) = 'TRD'            53770000
537800                 MOVE AP052-ALLW-CHRG-CODE TO                     53780000
537900                                 TBL-ALLOWANCE-CDE(ALLOW-INDX)    53790000
538000              END-IF                                              53800000
538100           END-IF                                                 53810000
538200        ELSE                                                      53820000
538300           IF AP052-ALLW-CHRG-TOTAL >=                            53830000
538400                              TBL-ALLOWANCE-AMT(ALLOW-INDX)       53840000
538500             MOVE AP052-ALLW-CHRG-PCT                             53850000
538600                                 TO TBL-ALLOWANCE-PCT(ALLOW-INDX) 53860000
538700             MOVE AP052-ALLW-CHRG-TOTAL                           53870000
538800                                 TO TBL-ALLOWANCE-AMT(ALLOW-INDX) 53880000
538900             MOVE 'I'            TO TBL-ALLOW-SRC-IND(ALLOW-INDX) 53890000
539000             IF TBL-ALLOWANCE-CDE(ALLOW-INDX) = 'TRD'             53900000
539100                MOVE AP052-ALLW-CHRG-CODE                         53910000
539200                                 TO TBL-ALLOWANCE-CDE(ALLOW-INDX) 53920000
539300             END-IF                                               53930000
539400             ADD AP052-ALLW-CHRG-TOTAL TO WS-DETAIL-ALLW-AMT-NEW  53940000
539500           END-IF                                                 53950000
539600        END-IF                                                    53960000
539700     ELSE                                                         53970000
539800                                                                  53980000
539900        MOVE AP052-ALLW-CHRG-CODE                                 53990000
540000                            TO TBL-ALLOWANCE-CDE(ALLOW-INDX)      54000000
540100        MOVE AP052-ALLW-CHRG-PCT                                  54010000
540200                            TO TBL-ALLOWANCE-PCT(ALLOW-INDX)      54020000
540300        MOVE AP052-ALLW-CHRG-TOTAL                                54030000
540400                            TO TBL-ALLOWANCE-AMT(ALLOW-INDX)      54040000
540500        MOVE 'I'            TO TBL-ALLOW-SRC-IND(ALLOW-INDX)      54050000
540600        ADD AP052-ALLW-CHRG-TOTAL TO WS-DETAIL-ALLW-AMT-NEW       54060000
540700     END-IF.                                                      54070000
540800                                                                  54080000
540900*--------------------------------------------------------------*  54090000
541000* PROCESS THE MTCH_LVL_CSR CURSOR (OPEN, FETCH, AND CLOSE)     *  54100000
541100*--------------------------------------------------------------*  54110000
541200 S400-PROCESS-MTCH-LVL-CURSOR.                                    54120000
541300                                                                  54130000
541400     SET NOT-END-MTCH-LVL-CSR TO TRUE.                            54140000
541500     PERFORM WITH TEST AFTER                                      54150000
541600             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 54160000
541700             UNTIL   WS-RETRY-COUNTER > 3  OR                     54170000
541800                     SQLCODE = 0 OR                               54180000
541900                     SQLCODE = +100                               54190000
542000                                                                  54200000
542100             EXEC SQL                                             54210000
542200                OPEN MTCH_LVL_CSR                                 54220000
542300             END-EXEC                                             54230000
542400                                                                  54240000
542500             EVALUATE TRUE                                        54250000
542600                 WHEN SQLCODE = ZERO                              54260000
542700                 WHEN SQLCODE = +100                              54270000
542800                 WHEN SQLCODE = -904                              54280000
542900                 WHEN SQLCODE = -913                              54290000
543000                      CONTINUE                                    54300000
543100                 WHEN SQLWARN0 NOT = SPACES                       54310000
543200                 WHEN SQLCODE  NOT = ZERO                         54320000
543300                      MOVE 'S400-PROCESS-MTCH-LVL-CURSOR  '       54330000
543400                                    TO WS-ABEND-PARAGRAPH         54340000
543500                      MOVE 'UNSUCCESSFUL OPEN TINVOIC'            54350000
543600                                    TO WS-ABEND-OPERATION         54360000
543700                      MOVE 'TINVOIC ' TO WS-ABEND-STRUCTURE-1     54370000
543800                      MOVE SPACES     TO WS-ABEND-STRUCTURE-2     54380000
543900                      PERFORM Z999-SQL-ERROR                      54390000
544000             END-EVALUATE                                         54400000
544100     END-PERFORM.                                                 54410000
544200                                                                  54420000
544300     IF WS-RETRY-COUNTER > 3                                      54430000
544400         MOVE 'S400-PROCESS-MTCH-LVL-CURSOR  '                    54440000
544500                       TO WS-ABEND-PARAGRAPH                      54450000
544600         MOVE 'MAX RETRIES EXCEEDED ON OPEN TINVOIC'              54460000
544700                         TO WS-ABEND-OPERATION                    54470000
544800         PERFORM Z999-SQL-ERROR                                   54480000
544900     ELSE                                                         54490000
545000        IF SQLCODE = +100                                         54500000
545100           CONTINUE                                               54510000
545200        ELSE                                                      54520000
545300           PERFORM S450-FETCH-MTCH-LVL-CURSOR                     54530000
545400             UNTIL END-MTCH-LVL-CSR                               54540000
545500        END-IF                                                    54550000
545600     END-IF.                                                      54560000
545700                                                                  54570000
545800     PERFORM WITH TEST AFTER                                      54580000
545900             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 54590000
546000             UNTIL   WS-RETRY-COUNTER > 3  OR                     54600000
546100                     SQLCODE = ZERO OR                            54610000
546200                     SQLCODE = +100                               54620000
546300                                                                  54630000
546400             EXEC SQL                                             54640000
546500                CLOSE MTCH_LVL_CSR                                54650000
546600             END-EXEC                                             54660000
546700                                                                  54670000
546800             EVALUATE TRUE                                        54680000
546900                 WHEN SQLCODE = ZERO                              54690000
547000                 WHEN SQLCODE = +100                              54700000
547100                 WHEN SQLCODE = -904                              54710000
547200                 WHEN SQLCODE = -913                              54720000
547300                      CONTINUE                                    54730000
547400                 WHEN SQLWARN0 NOT = SPACES                       54740000
547500                 WHEN SQLCODE  NOT = ZERO                         54750000
547600                      MOVE 'S400-PROCESS-MTCH-LVL-CURSOR  '       54760000
547700                                    TO WS-ABEND-PARAGRAPH         54770000
547800                      MOVE 'UNSUCCESSFUL CLOSE TINVOIC'           54780000
547900                                    TO WS-ABEND-OPERATION         54790000
548000                      MOVE 'TINVOIC ' TO WS-ABEND-STRUCTURE-1     54800000
548100                      MOVE SPACES     TO WS-ABEND-STRUCTURE-2     54810000
548200                      PERFORM Z999-SQL-ERROR                      54820000
548300             END-EVALUATE                                         54830000
548400     END-PERFORM.                                                 54840000
548500                                                                  54850000
548600     IF WS-RETRY-COUNTER > 3                                      54860000
548700         MOVE 'S400-PROCESS-MTCH-LVL-CURSOR  '                    54870000
548800                       TO WS-ABEND-PARAGRAPH                      54880000
548900         MOVE 'MAX RETRIES EXCEEDED ON CLOSE TINVOIC'             54890000
549000                         TO WS-ABEND-OPERATION                    54900000
549100         PERFORM Z999-SQL-ERROR.                                  54910000
549200                                                                  54920000
549300*--------------------------------------------------------------*  54930000
549400* FETCH THE MTCH_LVL_CSR CURSOR                                *  54940000
549500*--------------------------------------------------------------*  54950000
549600 S450-FETCH-MTCH-LVL-CURSOR.                                      54960000
549700                                                                  54970000
549800     EXEC SQL                                                     54980000
549900         FETCH MTCH_LVL_CSR                                       54990000
550000         INTO  :INVOIC-MTCH-LVL-CDE                               55000000
550100     END-EXEC.                                                    55010000
550200                                                                  55020000
550300     EVALUATE TRUE                                                55030000
550400         WHEN SQLCODE = +100                                      55040000
550500              SET END-MTCH-LVL-CSR TO TRUE                        55050000
550600         WHEN SQLCODE = ZERO                                      55060000
550700              SET NOT-END-MTCH-LVL-CSR TO TRUE                    55070000
550800         WHEN SQLWARN0 NOT = SPACES                               55080000
550900         WHEN SQLCODE  NOT = ZERO                                 55090000
551000           MOVE 'S450-FETCH-MTCH-LVL-CURSOR    '                  55100000
551100                         TO WS-ABEND-PARAGRAPH                    55110000
551200           MOVE 'UNSUCCESSFUL FETCH TINVOIC'                      55120000
551300                         TO WS-ABEND-OPERATION                    55130000
551400           MOVE 'TINVOIC ' TO WS-ABEND-STRUCTURE-1                55140000
551500           MOVE SPACES     TO WS-ABEND-STRUCTURE-2                55150000
551600           PERFORM Z999-SQL-ERROR                                 55160000
551700        END-EVALUATE.                                             55170000
551800                                                                  55180000
551900*--------------------------------------------------------------*  55190000
552000* CHECK THE INVOICE FILE IF THE ONLY BY-STORE IS RI, THEN      *  55200000
552100* ALLOW BULK INVOICES TO BE LOADED                             *  55210000
552200*--------------------------------------------------------------*  55220000
552300 S600-COUNT-NON-RIS.                                              55230000
552400                                                                  55240000
552500     PERFORM WITH TEST AFTER                                      55250000
552600             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 55260000
552700             UNTIL   WS-RETRY-COUNTER >  3 OR                     55270000
552800                     SQLCODE = ZERO OR                            55280000
552900                     SQLCODE = +100                               55290000
553000                                                                  55300000
553100         EXEC SQL                                                 55310000
553200                SELECT COUNT(*)                                   55320000
553300                INTO :WS-COUNT                                    55330000
553400                FROM TINVOIC                                      55340000
553500                WHERE PO_NBR           = :WS-SAVE-PO-NBR-COMP     55350000
553600                  AND STATUS_CDE  NOT IN ('DE', 'PD', 'OP')       55360000
553700                  AND INVC_TYP_CDE NOT IN ('RI')                  55370000
553800                  AND INVC_TYP_CDE NOT IN ('EI')                  55380000
553900         END-EXEC                                                 55390000
554000                                                                  55400000
554100         EVALUATE TRUE                                            55410000
554200             WHEN SQLCODE = ZERO                                  55420000
554300             WHEN SQLCODE = +100                                  55430000
554400             WHEN SQLCODE = -904                                  55440000
554500             WHEN SQLCODE = -913                                  55450000
554600                  CONTINUE                                        55460000
554700                                                                  55470000
554800             WHEN SQLWARN0 NOT = SPACES                           55480000
554900             WHEN SQLCODE  NOT = ZERO                             55490000
555000                  MOVE 'S600-COUNT-NON-RIS            '           55500000
555100                                TO WS-ABEND-PARAGRAPH             55510000
555200                  MOVE 'UNSUCCESSFUL SELECT INVOIC'               55520000
555300                                TO WS-ABEND-OPERATION             55530000
555400                  MOVE 'TINVOIC ' TO WS-ABEND-STRUCTURE-1         55540000
555500                  MOVE SPACES     TO WS-ABEND-STRUCTURE-2         55550000
555600                  PERFORM Z999-SQL-ERROR                          55560000
555700         END-EVALUATE                                             55570000
555800     END-PERFORM.                                                 55580000
555900                                                                  55590000
556000     IF WS-RETRY-COUNTER > 3                                      55600000
556100         MOVE 'S600-COUHT-NON-RIS            '                    55610000
556200                       TO WS-ABEND-PARAGRAPH                      55620000
556300         MOVE 'MAX RETRIES EXCEEDED ON SELECT INVOIC'             55630000
556400                         TO WS-ABEND-OPERATION                    55640000
556500         PERFORM Z999-SQL-ERROR                                   55650000
556600     END-IF.                                                      55660000
556700                                                                  55670000
556800*--------------------------------------------------------------*  55680000
556900* SELECT THE PAYMENT TERMS                                     *  55690000
557000*--------------------------------------------------------------*  55700000
557100 S700-SELECT-TPAYTRM.                                             55710000
557200                                                                  55720000
557300     SET PO-PAYTRM-EXISTS TO TRUE.                                55730000
557400                                                                  55740000
557500     PERFORM WITH TEST AFTER                                      55750000
557600         VARYING WS-RETRY-COUNTER FROM 1 BY 1                     55760000
557700         UNTIL   WS-RETRY-COUNTER > 3  OR                         55770000
557800                 SQLCODE = ZERO OR                                55780000
557900                 SQLCODE = +100                                   55790000
558000                                                                  55800000
558100         EXEC SQL                                                 55810000
558200             SELECT A.DISC_PAY_DAY_QTY                            55820000
558300                  , A.DISC_PCT                                    55830000
558400                  , B.DISCOUNT_PCT                                55840000
558500                  , B.DUE_DAY_QTY                                 55850000
558600                  , B.DISCOUNT_DAYS_QTY                           55860000
558700                  , B.DUE_DAY_FR_DTE_TXT                          55870000
558800              INTO  :POAGMT-DISC-PAY-DAY-QTY                      55880000
558900                  , :POAGMT-DISC-PCT                              55890000
559000                  , :PAYTRM-DISCOUNT-PCT                          55900000
559100                  , :PAYTRM-DUE-DAY-QTY                           55910000
559200                  , :PAYTRM-DISCOUNT-DAYS-QTY                     55920000
559300                  , :PAYTRM-DUE-DAY-FR-DTE-TXT                    55930000
559400              FROM  TPOAGMT A                                     55940000
559500                  , TPAYTRM B                                     55950000
559600             WHERE  A.PO_NBR         = :WS-SAVE-PO-NBR-COMP       55960000
559700               AND  A.PAYT_TERM_ID   = B.PAY_TERM_ID              55970000
559800               AND  A.AGRMT_TYP_ID   = '2'                        55980000
559900               AND  A.VER_STATUS_CDE = 'A'                        55990000
560000         END-EXEC                                                 56000000
560100                                                                  56010000
560200         EVALUATE TRUE                                            56020000
560300             WHEN SQLCODE = ZERO                                  56030000
560400             WHEN SQLCODE = -904                                  56040000
560500             WHEN SQLCODE = -913                                  56050000
560600                  CONTINUE                                        56060000
560700                                                                  56070000
560800             WHEN SQLCODE = +100                                  56080000
560900                  SET PO-PAYTRM-NOT-EXIST TO TRUE                 56090000
561000                                                                  56100000
561100             WHEN SQLWARN0 NOT = SPACES                           56110000
561200             WHEN SQLCODE  NOT = ZERO                             56120000
561300                 DISPLAY '1ST SQL PO NBR =' WS-SAVE-PO-NBR        56130000
561400                  MOVE 'S700-SELECT-TPAYTRM           '           56140000
561500                                TO WS-ABEND-PARAGRAPH             56150000
561600                  MOVE 'UNSUCCESSFUL SELECT POAGMT'               56160000
561700                                TO WS-ABEND-OPERATION             56170000
561800                  MOVE 'TPOAGMT ' TO WS-ABEND-STRUCTURE-1         56180000
561900                  MOVE 'TPAYTRM ' TO WS-ABEND-STRUCTURE-2         56190000
562000                  PERFORM Z999-SQL-ERROR                          56200000
562100         END-EVALUATE                                             56210000
562200     END-PERFORM.                                                 56220000
562300                                                                  56230000
562400     IF WS-RETRY-COUNTER > 3                                      56240000
562500         MOVE 'S700-SELECT-TPAYTRM           '                    56250000
562600                       TO WS-ABEND-PARAGRAPH                      56260000
562700         MOVE 'MAX RETRIES EXCEEDED ON SELECT POAGMT'             56270000
562800                         TO WS-ABEND-OPERATION                    56280000
562900         PERFORM Z999-SQL-ERROR                                   56290000
563000     END-IF.                                                      56300000
563100                                                                  56310000
563200* THE FOLLOWING LOGIC IS PERFORMED BECAUSE ON TPOAGMT, THE NEW    56320000
563300* STORE DISCOUNT IS STORED ON THE AGREEMENT TYPE 2 ROW, ALONG     56330000
563400* WITH THE PAYMENT TERMS.  THE SAVED PERCENT WILL BE LOADED INTO  56340000
563500* THE ALLOWANCE ARRAY IN S100 AFTER THE ALLOWANCE_CSR IS LOADED.  56350000
563600                                                                  56360000
563700     IF PO-PAYTRM-EXISTS                                          56370000
563800        MOVE POAGMT-DISC-PCT TO WS-SAVE-NEW-STR-DISC-PCT          56380000
563900     ELSE                                                         56390000
564000        MOVE ZERO            TO WS-SAVE-NEW-STR-DISC-PCT          56400000
564100     END-IF.                                                      56410000
564200                                                                  56420000
564300                                                                  56430000
564400*  THE FOLLOWING SELECT IS DONE TO GET ANY ADDITIONAL DAYS THAT   56440000
564500*  THE BUYER ADDED TO THE PAYMENT TERMS THAT WERE NOT PART OF THE 56450000
564600*  REGULAR TERMS FOR THAT VENDOR.  THESE ARE STORED ON TPOAGMT    56460000
564700*  ON THE ROW WITH THE AGREEMENT TYPE AND TYPE CODE SHOWN BELOW.  56470000
564800                                                                  56480000
564900     EXEC SQL                                                     56490000
565000         SELECT  DISC_PAY_DAY_QTY                                 56500000
565100           INTO  :WS-DISC-PAY-DAY-QTY                             56510000
565200           FROM  TPOAGMT                                          56520000
565300          WHERE  PO_NBR         = :WS-SAVE-PO-NBR-COMP            56530000
565400            AND  AGRMT_TYP_ID   = '5'                             56540000
565500            AND  TYP_CDE        = 1                               56550000
565600            AND  VER_STATUS_CDE = 'A'                             56560000
565700     END-EXEC.                                                    56570000
565800     EVALUATE TRUE                                                56580000
565900         WHEN SQLCODE = ZERO                                      56590000
566000              ADD WS-DISC-PAY-DAY-QTY TO POAGMT-DISC-PAY-DAY-QTY  56600000
566100         WHEN SQLCODE = +100                                      56610000
566200              MOVE ZERO TO WS-DISC-PAY-DAY-QTY                    56620000
566300         WHEN SQLWARN0 NOT = SPACES                               56630000
566400         WHEN SQLCODE  NOT = ZERO                                 56640000
566500             DISPLAY '2ND SQL PO NBR =' WS-SAVE-PO-NBR            56650000
566600              MOVE 'S700-SELECT-TPAYTRM' TO WS-ABEND-PARAGRAPH    56660000
566700              MOVE 'UNSUCCESSFUL SELECT' TO WS-ABEND-OPERATION    56670000
566800              MOVE 'TPOAGMT '            TO WS-ABEND-STRUCTURE-1  56680000
566900              MOVE SPACES                TO WS-ABEND-STRUCTURE-2  56690000
567000              PERFORM Z999-SQL-ERROR                              56700000
567100     END-EVALUATE.                                                56710000
567200                                                                  56720000
567300*--------------------------------------------------------------*  56730000
567400* WRITE OUT THE VALID EDI INVOICE TRANSACTION RECORDS          *  56740000
567500*--------------------------------------------------------------*  56750000
567600 W100-WRITE-EDI.                                                  56760000
567700                                                                  56770000
567800     PERFORM VARYING INV-INDX FROM 1 BY 1                         56780000
567900        UNTIL INV-INDX > 10998 OR                                 56790000
568000              WS-AP052-KEY-AREA(INV-INDX) = HIGH-VALUES           56800000
568100        SET WRITE-EDI-REC TO TRUE                                 56810000
568200        MOVE WS-MTCH-LVL  TO WS-AP052-SORT-MTCH-LVL(INV-INDX)     56820000
568300        IF WS-AP052-REC-TYPE(INV-INDX) = '01'                     56830000
568400           MOVE WS-INV-REC(INV-INDX) TO WS-WORK-REC               56840000
568500*          IF CHCK-PS-DUP-YES                                     56850032
568600*             SET AP052-CHCK-PS-DUP-YES TO TRUE                   56860032
568700*          END-IF                                                 56870032
568800           MOVE WS-EXTENT-DUN-NBR TO WS-DUN-NBR-X                 56880000
568900           MOVE WS-DUN-NBR-9S  TO AP052-EXTENT-DUN-NBR            56890000
569000                                                                  56900000
569100           MOVE PURCHS-DEPT-NBR TO AP052-PURCH-DEPT-NBR           56910000
569300           MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX)               56940439
569400        END-IF                                                    56941000
569500        IF WS-AP052-REC-TYPE(INV-INDX) = '02'                     56950000
569600           MOVE WS-INV-REC(INV-INDX) TO WS-WORK-REC               56960000
569700           MOVE 'N' TO AP052-SPLIT-TERMS-IND                      56970000
569800*          IF CHRG-OVER-LIMIT                                     56980000
569900              IF WS-VENDOR-IS-LI-FUNG                             56990000
570000                 MOVE 'N' TO AP052-INVC-HOLD-IND                  57000000
570100              ELSE                                                57010000
570200                 MOVE 'N' TO AP052-INVC-HOLD-IND                  57020000
570300              END-IF                                              57030000
570400**         ELSE                                                   57040000
570500*             MOVE 'N' TO AP052-INVC-HOLD-IND                     57050000
570600*          END-IF                                                 57060000
570700           PERFORM R700-SELECT-FREIGHT                            57070000
570800           MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX)               57080000
570900        END-IF                                                    57090000
571000        IF WS-AP052-REC-TYPE(INV-INDX) = '06'                     57100000
571100           COMPUTE WS-SAVE-NET-COST                               57110000
571200                 = WS-DETAIL-GROSS-INVOICE-AMT                    57120000
571300                 + WS-DETAIL-CHRG-AMT                             57130000
571400                 - WS-DETAIL-ALLW-AMT-NEW                         57140000
571500           COMPUTE WS-SAVE-DISC-INVC-AMT                          57150000
571600                 = WS-DETAIL-GROSS-INVOICE-AMT                    57160000
571700                 - WS-DETAIL-ALLW-AMT-NEW                         57170000
571800           MOVE WS-INV-REC(INV-INDX)  TO WS-WORK-REC              57180000
571900           MOVE WS-TOTAL-QTY-INVOICED TO AP052-TOTAL-QTY-INVOICED 57190000
572000           MOVE WS-DETAIL-GROSS-INVOICE-AMT                       57200000
572100                                      TO AP052-GROSS-COST-INV-AMT 57210000
572200           MOVE WS-SAVE-NET-COST      TO AP052-GROSS-INVOICE-AMT  57220000
572300           MOVE WS-SAVE-DISC-INVC-AMT TO AP052-DISCOUNTED-AMT-DUE 57230000
572400           MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX)               57240000
572500        END-IF                                                    57250000
572600        IF WS-AP052-REC-TYPE(INV-INDX) = '07'                     57260000
572700           MOVE WS-INV-REC(INV-INDX) TO WS-WORK-REC               57270000
572800           IF AP052-IT1-MSR-PK-HDR                                57280000
572900*             IF AP052-UPC-CANT-EXPLODE-IND = 'Y'                 57290000
573000*                CONTINUE                                         57300000
573100*             ELSE                                                57310000
573200              SET NO-WRITE-EDI-REC TO TRUE                        57320000
573300*             END-IF                                              57330000
573400           END-IF                                                 57340000
573500           IF AP052-IT1-MSR-PK-ITEM                               57350000
573600              SET AP052-IT1-MSR-EACH TO TRUE                      57360000
573700           END-IF                                                 57370000
573800           MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX)               57380000
573900        END-IF                                                    57390000
574000        IF USE-SUFFIX-INVC                                        57400000
574100           MOVE WS-INVOICE-WITH-SUFFIX TO                         57410000
574200                                 WS-AP052-INV-NBR(INV-INDX)       57420000
574300        END-IF                                                    57430000
574400        IF WS-AP052-REC-TYPE(INV-INDX) = '04'                     57440000
574500           MOVE WS-INV-REC(INV-INDX) TO WS-WORK-REC               57450000
574600           IF PO-PAYTRM-EXISTS                                    57460000
574700              PERFORM W150-CHECK-FOR-DISCREPENCIES                57470000
574800           ELSE                                                   57480000
574900              SET PO-DSCRPNCY TO TRUE                             57490000
575000              SET USE-INVC-TERMS TO TRUE                          57500000
575100           END-IF                                                 57510000
575200           PERFORM W700-WRITE-INVOICE-TERMS                       57520000
575300           SET NO-WRITE-EDI-REC TO TRUE                           57530000
575400        END-IF                                                    57540000
575500**** LOGIC WAS ADDED BELOW TO BYPASS ALL ALLOWANCES TRANSMITTED BY57550000
575600**** NINE WEST AND ONLY LOAD THOSE FROM THE PO.  ACCOMPLISHED BY  57560000
575700**** NOT PERFORMING S200 FOR THIS VENDOR. NINE WEST IS ROLLING MOS57570000
575800**** AND ADV TOGETHER INTO MOS, AND OUR LOGIC WOULD TAKE BOTH THE 57580000
575900**** ROLLED TOGETHER MOS FROM THE TRANSMISSION AND THE ADV FROM PO57590000
576000        IF WS-AP052-REC-TYPE(INV-INDX) = '05'                     57600000
576100           MOVE WS-INV-REC(INV-INDX) TO WS-WORK-REC               57610000
576200           IF AP052-ALLOWANCE                                     57620000
576300              IF  WS-VENDOR-IS-NY-JONES                           57630000
576400                  SET NO-WRITE-EDI-REC TO TRUE                    57640000
576500              ELSE                                                57650000
576600                  PERFORM S200-LOAD-INVOICE-ALLOWANCE             57660000
576700                  SET NO-WRITE-EDI-REC TO TRUE                    57670000
576800              END-IF                                              57680000
576900           END-IF                                                 57690000
577000        END-IF                                                    57700000
577100        IF WRITE-EDI-REC                                          57710000
577200           WRITE EDIOUT-AP052-RECORD FROM WS-INV-REC(INV-INDX)    57720000
577300           ADD 1 TO WS-EDIOUT-REC-CNT                             57730000
577400        END-IF                                                    57740000
577500     END-PERFORM.                                                 57750000
577600      MOVE WS-AP052-KEY-AREA(INV-INDX - 1)                        57760000
577700           TO WS-AP052-KEY-AREA(INV-INDX)                         57770000
577800      MOVE '05' TO WS-AP052-REC-TYPE(INV-INDX)                    57780000
577900      MOVE WS-INV-REC(INV-INDX) TO WS-WORK-REC                    57790000
578000      MOVE 'A'  TO AP052-ALLW-CHG-TYPE                            57800000
578100      MOVE SPACES TO AP052-SPEC-SRVC-CODE                         57810000
578200      MOVE '02'   TO AP052-ALLW-CHRG-MTHD                         57820000
578300      MOVE '3'    TO AP052-ALLW-CHRG-PCT-QUAL                     57830000
578400      MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX)                    57840000
578500                                                                  57850000
578600      SET ALLOW-INDX TO 1                                         57860000
578700      PERFORM UNTIL (TBL-ALLOWANCE-CDE(ALLOW-INDX) = SPACES)      57870000
578800                 OR (ALLOW-INDX > 10)                             57880000
578900         MOVE TBL-ALLOWANCE-CDE(ALLOW-INDX)                       57890000
579000              TO AP052-ALLW-CHRG-CODE                             57900000
579100         IF TBL-ALLOW-SRC-IND(ALLOW-INDX) = 'P'                   57910000
579200            MOVE TBL-ALLOWANCE-PCT(ALLOW-INDX)                    57920000
579300                 TO AP052-ALLW-CHRG-PCT                           57930000
579400            MOVE ZERO TO AP052-ALLW-CHRG-TOTAL                    57940000
579500            SET AP052-KOHLS-PO-ADD TO TRUE                        57950000
579600         ELSE                                                     57960000
579700            MOVE TBL-ALLOWANCE-PCT(ALLOW-INDX)                    57970000
579800                 TO AP052-ALLW-CHRG-PCT                           57980000
579900            MOVE TBL-ALLOWANCE-AMT(ALLOW-INDX)                    57990000
580000                 TO AP052-ALLW-CHRG-TOTAL                         58000000
580100            SET AP052-VENDOR-SENT TO TRUE                         58010000
580200         END-IF                                                   58020000
580300         MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX)                 58030000
580400         WRITE EDIOUT-AP052-RECORD FROM WS-INV-REC(INV-INDX)      58040000
580500         ADD 1 TO WS-EDIOUT-REC-CNT                               58050000
580600         SET ALLOW-INDX UP BY 1                                   58060000
580700      END-PERFORM.                                                58070000
580800                                                                  58080031
580900*--------------------------------------------------------------*  58090000
581000* COMPARE THE INVOICE TERMS FROM THE EDI INVOICE FILE WITH THE *  58100000
581100* PO TERMS ON THE PO TERMS TABLE.  THIS IS DONE TO SEE WHICH   *  58110000
581200* TERMS ARE BETTER: PO, INVOICE OR A COMPOSITE OF THE BEST OF  *  58120000
581300* PO AND INVOICE.                                              *  58130000
581400*--------------------------------------------------------------*  58140000
581500 W150-CHECK-FOR-DISCREPENCIES.                                    58150000
581600                                                                  58160000
581700      MOVE WS-EXTENT-DUN-NBR TO PV-PO-TERMS-VNDR.                 58170000
581800      IF ALL-PO-TERMS-VNDRS                                       58180000
581900         SET PO-DSCRPNCY  TO TRUE                                 58190000
582000         SET USE-PO-TERMS TO TRUE                                 58200000
582100      END-IF.                                                     58210000
582200                                                                  58220000
582300      IF NOT ALL-PO-TERMS-VNDRS                                   58230000
582400         IF AP052-EOM                                             58240000
582500            IF PAYTRM-DUE-DAY-FR-DTE-TXT(1:3) NOT = 'EOM'         58250000
582600               SET PO-DSCRPNCY     TO TRUE                        58260000
582700               SET USE-PO-TERMS    TO TRUE                        58270000
582800               SET EOM-TERMS-FOUND TO TRUE                        58280000
582900            END-IF                                                58290000
583000         ELSE                                                     58300000
583100            IF PAYTRM-DUE-DAY-FR-DTE-TXT(1:3)     = 'EOM'         58310000
583200               SET PO-DSCRPNCY     TO TRUE                        58320000
583300               SET USE-PO-TERMS    TO TRUE                        58330000
583400               SET EOM-TERMS-FOUND TO TRUE                        58340000
583500            END-IF                                                58350000
583600         END-IF                                                   58360000
583700      END-IF.                                                     58370000
583800                                                                  58380000
583900      IF NOT ALL-PO-TERMS-VNDRS                                   58390000
584000         IF NO-EOM-TERMS-FOUND                                    58400000
584100*  TERMS TYPE CODE OF 04 IS DEFERRED                              58410000
584200            IF AP052-DEF-INSTALL                                  58420000
584300               PERFORM W160-CHK-DEFERRED-DSCRPNCYS                58430000
584400            ELSE                                                  58440000
584500               PERFORM W170-CHK-NONDEFERRED-DSCRPNCYS             58450000
584600            END-IF                                                58460000
584700         END-IF                                                   58470000
584800      END-IF.                                                     58480000
584900                                                                  58490000
585000      SET NO-EOM-TERMS-FOUND TO TRUE.                             58500000
585100                                                                  58510000
585200*--------------------------------------------------------------*  58520000
585300* EDI TERMS TYPE 04 (DEFERRED) - COMPARE THE VARIOUS TERMS     *  58530000
585400* COMPONENTS TO SEE IF ANY DISCREPACIES EXIST.  VARIOUS        *  58540000
585500* SWITCHES ARE SET THAT WILL BE CHECKED IN                     *  58550000
585600* W700-WRITE-INVOICE-TERMS.  DEPENDING ON THE COMBINATION THAT *  58560000
585700* THAT ARE SET, INVOICES COULD USE PO TERMS, INVOICE TERMS OR  *  58570000
585800* A COMPOSITE OF THE BEST OF PO AND INVOICE TERMS.             *  58580000
585900*--------------------------------------------------------------*  58590000
586000 W160-CHK-DEFERRED-DSCRPNCYS.                                     58600000
586100                                                                  58610000
586200      IF AP052-PCT-PAYABLE > (PAYTRM-DISCOUNT-PCT * 100)          58620000
586300         SET PO-DSCRPNCY          TO TRUE                         58630000
586400         SET USE-INVC-TERMS       TO TRUE                         58640000
586500         MOVE AP052-PCT-PAYABLE   TO WS-TERMS-PCT-PAYABLE         58650000
586600      END-IF.                                                     58660000
586700                                                                  58670000
586800      IF AP052-PCT-PAYABLE < (PAYTRM-DISCOUNT-PCT * 100)          58680000
586900         SET PO-DSCRPNCY          TO TRUE                         58690000
587000         SET USE-PO-TERMS         TO TRUE                         58700000
587100         COMPUTE WS-TERMS-PCT-PAYABLE =                           58710000
587200                       PAYTRM-DISCOUNT-PCT * 100                  58720000
587300      END-IF.                                                     58730000
587400                                                                  58740000
587500      IF AP052-PCT-PAYABLE = 0                                    58750000
587600         IF PAYTRM-DISCOUNT-PCT > 0                               58760000
587700            COMPUTE PV-TOTAL-DAYS-QTY =                           58770000
587800                    POAGMT-DISC-PAY-DAY-QTY +                     58780000
587900                    PAYTRM-DISCOUNT-DAYS-QTY                      58790000
588000            IF AP052-NET-DEFRD-DAYS-DUE > PV-TOTAL-DAYS-QTY       58800000
588100               SET PO-DSCRPNCY                 TO TRUE            58810000
588200               SET USE-INVC-TERMS              TO TRUE            58820000
588300               MOVE AP052-NET-DEFRD-DAYS-DUE   TO                 58830000
588400                    WS-TERMS-NET-DEFRD-DAYS-DUE                   58840000
588500            ELSE                                                  58850000
588600               IF AP052-NET-DEFRD-DAYS-DUE < PV-TOTAL-DAYS-QTY    58860000
588700                  SET PO-DSCRPNCY               TO TRUE           58870000
588800                  SET USE-PO-TERMS              TO TRUE           58880000
588900                  MOVE PAYTRM-DISCOUNT-DAYS-QTY TO                58890000
589000                       WS-TERMS-NET-DEFRD-DAYS-DUE                58900000
589100                  MOVE POAGMT-DISC-PAY-DAY-QTY TO                 58910000
589200                       WS-TERMS-EXTD-DAYS-QTY                     58920000
589300               END-IF                                             58930000
589400            END-IF                                                58940000
589500         ELSE                                                     58950000
589600            IF PAYTRM-DISCOUNT-PCT = 0                            58960000
589700               COMPUTE PV-TOTAL-DAYS-QTY =                        58970000
589800                       POAGMT-DISC-PAY-DAY-QTY +                  58980000
589900                       PAYTRM-DUE-DAY-QTY                         58990000
590000               IF AP052-NET-DEFRD-DAYS-DUE > PV-TOTAL-DAYS-QTY    59000000
590100                  SET PO-DSCRPNCY                 TO TRUE         59010000
590200                  SET USE-INVC-TERMS              TO TRUE         59020000
590300                  MOVE AP052-NET-DEFRD-DAYS-DUE   TO              59030000
590400                       WS-TERMS-NET-DEFRD-DAYS-DUE                59040000
590500               ELSE                                               59050000
590600                  IF AP052-NET-DEFRD-DAYS-DUE < PV-TOTAL-DAYS-QTY 59060000
590700                     SET PO-DSCRPNCY              TO TRUE         59070000
590800                     SET USE-PO-TERMS             TO TRUE         59080000
590900                     MOVE PAYTRM-DUE-DAY-QTY      TO              59090000
591000                          WS-TERMS-NET-DEFRD-DAYS-DUE             59100000
591100                     MOVE POAGMT-DISC-PAY-DAY-QTY TO              59110000
591200                          WS-TERMS-EXTD-DAYS-QTY                  59120000
591300                  END-IF                                          59130000
591400               END-IF                                             59140000
591500            END-IF                                                59150000
591600         END-IF                                                   59160000
591700      END-IF.                                                     59170000
591800                                                                  59180000
591900      IF AP052-PCT-PAYABLE > 0                                    59190000
592000         IF PAYTRM-DISCOUNT-PCT > 0                               59200000
592100            COMPUTE PV-TOTAL-DAYS-QTY =                           59210000
592200                    POAGMT-DISC-PAY-DAY-QTY +                     59220000
592300                    PAYTRM-DISCOUNT-DAYS-QTY                      59230000
592400            IF AP052-NET-DEFRD-DAYS-DUE > PV-TOTAL-DAYS-QTY       59240000
592500               SET PO-DSCRPNCY                  TO TRUE           59250000
592600               SET USE-INVC-TERMS               TO TRUE           59260000
592700               MOVE AP052-NET-DEFRD-DAYS-DUE    TO                59270000
592800                    WS-TERMS-NET-DEFRD-DAYS-DUE                   59280000
592900            ELSE                                                  59290000
593000               IF AP052-NET-DEFRD-DAYS-DUE < PV-TOTAL-DAYS-QTY    59300000
593100                  SET PO-DSCRPNCY               TO TRUE           59310000
593200                  SET USE-PO-TERMS              TO TRUE           59320000
593300                  MOVE PAYTRM-DISCOUNT-DAYS-QTY TO                59330000
593400                       WS-TERMS-NET-DEFRD-DAYS-DUE                59340000
593500                  MOVE POAGMT-DISC-PAY-DAY-QTY  TO                59350000
593600                       WS-TERMS-EXTD-DAYS-QTY                     59360000
593700               END-IF                                             59370000
593800            END-IF                                                59380000
593900         ELSE                                                     59390000
594000            IF PAYTRM-DISCOUNT-PCT = 0                            59400000
594100               COMPUTE PV-TOTAL-DAYS-QTY =                        59410000
594200                       POAGMT-DISC-PAY-DAY-QTY +                  59420000
594300                       PAYTRM-DUE-DAY-QTY                         59430000
594400               IF AP052-NET-DEFRD-DAYS-DUE > PV-TOTAL-DAYS-QTY    59440000
594500                  SET PO-DSCRPNCY                  TO TRUE        59450000
594600                  SET USE-INVC-TERMS               TO TRUE        59460000
594700                  MOVE AP052-NET-DEFRD-DAYS-DUE    TO             59470000
594800                       WS-TERMS-NET-DEFRD-DAYS-DUE                59480000
594900               ELSE                                               59490000
595000                  IF AP052-NET-DEFRD-DAYS-DUE < PV-TOTAL-DAYS-QTY 59500000
595100                     SET PO-DSCRPNCY               TO TRUE        59510000
595200                     SET USE-PO-TERMS              TO TRUE        59520000
595300                     MOVE PAYTRM-DUE-DAY-QTY       TO             59530000
595400                          WS-TERMS-NET-DEFRD-DAYS-DUE             59540000
595500                     MOVE POAGMT-DISC-PAY-DAY-QTY  TO             59550000
595600                          WS-TERMS-EXTD-DAYS-QTY                  59560000
595700                     PERFORM W165-CHK-SPECIALTY-TERMS             59570000
595800                  END-IF                                          59580000
595900               END-IF                                             59590000
596000            END-IF                                                59600000
596100         END-IF                                                   59610000
596200      END-IF.                                                     59620000
596300                                                                  59630000
596400*--------------------------------------------------------------*  59640000
596500* IN SPECIAL CIRCUMSTANCES, PO TERMS WON'T HAVE ANY PERCENTAGE,*  59650000
596600* DISCOUNT DAYS OR NET DAYS, BUT WILL HAVE EXTENDED DAYS (FROM *  59660000
596700* TPOAGMT-DISC-PAY-DAY-QTY).  IT WILL BE NECESSARY TO USE THE  *  59670000
596800* NET DAYS DUE FROM THE INVOICE TERMS AND THE EXTENDED DAYS    *  59680000
596900* FROM THE PO TERMS TO MAKE THE COMPOSITE TERMS RECORD.        *  59690000
597000*--------------------------------------------------------------*  59700000
597100 W165-CHK-SPECIALTY-TERMS.                                        59710000
597200                                                                  59720000
597300     IF POAGMT-DISC-PAY-DAY-QTY  > ZERO AND                       59730000
597400        PAYTRM-DUE-DAY-QTY       = ZERO AND                       59740000
597500        PAYTRM-DISCOUNT-DAYS-QTY = ZERO AND                       59750000
597600        PAYTRM-DISCOUNT-PCT      = ZERO AND                       59760000
597700        AP052-NET-DEFRD-DAYS-DUE > ZERO                           59770000
597800        MOVE AP052-NET-DEFRD-DAYS-DUE TO                          59780000
597900             WS-TERMS-NET-DEFRD-DAYS-DUE                          59790000
598000        ADD 1                    TO WS-SPECIALTY-CNT              59800000
598100*       DISPLAY '**********************************'              59810000
598200*       DISPLAY 'SPECIALTY COMPOSITE TERMS REQUIRED'              59820000
598300*       DISPLAY 'IN W165-CHK-SPECIALTY-TERMS'                     59830000
598400*       DISPLAY 'PO NUMBER           = ' AP052-KOHLS-PO-NBR       59840000
598500*       DISPLAY 'INVOICE NUMBER      = ' AP052-VENDOR-INVOICE-NBR 59850000
598600*       DISPLAY 'INVC NET DAYS USED  = ' AP052-NET-DEFRD-DAYS-DUE 59860000
598700*       DISPLAY '**********************************'              59870000
598800     END-IF.                                                      59880000
598900                                                                  59890000
599000*--------------------------------------------------------------*  59900000
599100* OTHER EDI TERM TYPES (NONDEFERRED) - COMPARE THE VARIOUS     *  59910000
599200* TERMS COMPONENTS TO SEE IF ANY DISCREPANCIES EXIST.  VARIOUS *  59920000
599300* SWITCHES ARE SET THAT WILL BE CHECKED IN                     *  59930000
599400* W700-WRITE-INVOICE-TERMS.  DEPENDING ON THE COMBINATION THAT *  59940000
599500* IS SET, INVOICES COULD USE PO TERMS, INVOICE TERMS OR A      *  59950000
599600* COMPOSITE OF THE BEST OF PO AND INVOICE TERMS.               *  59960000
599700*                                                              *  59970000
599800* NOTE THAT WHENEVER A DISC PERCENT > ZERO IS FOUND, THE DAYS  *  59980000
599900* WILL BE LOADED INTO THE DISC DAYS FIELD, AND WHENEVER THE    *  59990000
600000* DISC PERCENT = ZERO, THE DAYS ARE LOADED INTO THE NET DAYS   *  60000000
600100* FIELD - THIS IS DONE REGARDLESS OF WHICH FIELD THE DAYS WERE *  60010000
600200* ORIGINALLY IN.  ONCE TERMS ARE LOADED INTO THE DATABASE, ALL *  60020000
600300* PROGRAMS USING THEM WILL ONLY SELECT THE APPROPRIATE DAYS    *  60030000
600400* FIELD BASED ON WHETHER OR NOT THE PERCENT IS ZERO.           *  60040000
600500*--------------------------------------------------------------*  60050000
600600 W170-CHK-NONDEFERRED-DSCRPNCYS.                                  60060000
600700                                                                  60070000
600800      IF AP052-DISC-PCT > (PAYTRM-DISCOUNT-PCT * 100)             60080000
600900         SET PO-DSCRPNCY          TO TRUE                         60090000
601000         SET USE-INVC-TERMS       TO TRUE                         60100000
601100         MOVE AP052-DISC-PCT      TO WS-TERMS-DISC-PCT            60110000
601200      END-IF.                                                     60120000
601300                                                                  60130000
601400      IF AP052-DISC-PCT < (PAYTRM-DISCOUNT-PCT * 100)             60140000
601500         SET PO-DSCRPNCY          TO TRUE                         60150000
601600         SET USE-PO-TERMS         TO TRUE                         60160000
601700         COMPUTE WS-TERMS-DISC-PCT =                              60170000
601800                 PAYTRM-DISCOUNT-PCT * 100                        60180000
601900      END-IF.                                                     60190000
602000                                                                  60200000
602100* THE FOLLOWING WILL POPULATE THE 'COMPARE DAYS' WITH EITHER      60210000
602200* THE DISC DAYS OR THE NET DAYS SENT, DEPENDING WHICH CONTAINS    60220000
602300* A NON-ZERO VALUE.  WHEN THE NET DAYS IS USED, BUT THE DISC PCT  60230000
602400* IS GREATER THAN ZERO, OR WHEN THE DISC DAYS IS USED, BUT THE    60240000
602500* DISC PCT = ZERO, USE-PO-TERMS IS SET EVEN THOUGH THE TERMS      60250000
602600* LOADED MAY ALL END UP COMING FROM THE INVOICE.  THIS WILL       60260000
602700* FORCE 'COMPOSITE TERMS' LOGIC TO BE USED IN W700 SO THAT THE    60270000
602800* DAYS WILL END UP IN THE CORRECT DATABASE FIELD.                 60280000
602900                                                                  60290000
603000      IF  AP052-NET-DEFRD-DAYS-DUE = 0                            60300000
603100          IF  AP052-DISC-DAYS-DUE = 0                             60310000
603200              MOVE ZERO TO PV-COMPARE-DAYS-QTY                    60320000
603300          ELSE                                                    60330000
603400              MOVE AP052-DISC-DAYS-DUE TO PV-COMPARE-DAYS-QTY     60340000
603500              IF  AP052-DISC-PCT = 0                              60350000
603600                  SET USE-PO-TERMS TO TRUE                        60360000
603700              END-IF                                              60370000
603800          END-IF                                                  60380000
603900      ELSE                                                        60390000
604000          IF  AP052-DISC-DAYS-DUE = 0                             60400000
604100              MOVE AP052-NET-DEFRD-DAYS-DUE TO PV-COMPARE-DAYS-QTY60410000
604200              IF  AP052-DISC-PCT > 0                              60420000
604300                  SET USE-PO-TERMS TO TRUE                        60430000
604400              END-IF                                              60440000
604500          ELSE                                                    60450000
604600              IF  AP052-DISC-PCT = 0                              60460000
604700                  MOVE AP052-NET-DEFRD-DAYS-DUE                   60470000
604800                    TO PV-COMPARE-DAYS-QTY                        60480000
604900              ELSE                                                60490000
605000                  MOVE AP052-DISC-DAYS-DUE TO PV-COMPARE-DAYS-QTY 60500000
605100              END-IF                                              60510000
605200          END-IF                                                  60520000
605300      END-IF.                                                     60530000
605400                                                                  60540000
605500*     DISPLAY 'PO/INV = ' AP052-KOHLS-PO-NBR '/'                  60550000
605600*     AP052-VENDOR-INVOICE-NBR                                    60560000
605700*     '  COMPARE DAYS = ' PV-COMPARE-DAYS-QTY.                    60570000
605800                                                                  60580000
605900      IF AP052-DISC-PCT = 0                                       60590000
606000         IF PAYTRM-DISCOUNT-PCT > 0                               60600000
606100            COMPUTE PV-TOTAL-DAYS-QTY =                           60610000
606200                    POAGMT-DISC-PAY-DAY-QTY +                     60620000
606300                    PAYTRM-DISCOUNT-DAYS-QTY                      60630000
606400            IF PV-COMPARE-DAYS-QTY > PV-TOTAL-DAYS-QTY            60640000
606500               SET PO-DSCRPNCY                 TO TRUE            60650000
606600               SET USE-INVC-TERMS              TO TRUE            60660000
606700               MOVE PV-COMPARE-DAYS-QTY        TO                 60670000
606800                    WS-TERMS-DISC-DAYS-DUE                        60680000
606900            ELSE                                                  60690000
607000               IF PV-COMPARE-DAYS-QTY < PV-TOTAL-DAYS-QTY         60700000
607100                  SET PO-DSCRPNCY               TO TRUE           60710000
607200                  SET USE-PO-TERMS              TO TRUE           60720000
607300                  MOVE PAYTRM-DISCOUNT-DAYS-QTY TO                60730000
607400                       WS-TERMS-DISC-DAYS-DUE                     60740000
607500                  MOVE POAGMT-DISC-PAY-DAY-QTY  TO                60750000
607600                       WS-TERMS-EXTD-DAYS-QTY                     60760000
607700               END-IF                                             60770000
607800            END-IF                                                60780000
607900         ELSE                                                     60790000
608000            IF PAYTRM-DISCOUNT-PCT = 0                            60800000
608100               COMPUTE PV-TOTAL-DAYS-QTY =                        60810000
608200                       POAGMT-DISC-PAY-DAY-QTY +                  60820000
608300                       PAYTRM-DUE-DAY-QTY                         60830000
608400               IF PV-COMPARE-DAYS-QTY > PV-TOTAL-DAYS-QTY         60840000
608500                  SET PO-DSCRPNCY                 TO TRUE         60850000
608600                  SET USE-INVC-TERMS              TO TRUE         60860000
608700                  MOVE PV-COMPARE-DAYS-QTY        TO              60870000
608800                       WS-TERMS-NET-DEFRD-DAYS-DUE                60880000
608900               ELSE                                               60890000
609000                  IF PV-COMPARE-DAYS-QTY < PV-TOTAL-DAYS-QTY      60900000
609100                     SET PO-DSCRPNCY              TO TRUE         60910000
609200                     SET USE-PO-TERMS             TO TRUE         60920000
609300                     MOVE PAYTRM-DUE-DAY-QTY      TO              60930000
609400                          WS-TERMS-NET-DEFRD-DAYS-DUE             60940000
609500                     MOVE POAGMT-DISC-PAY-DAY-QTY TO              60950000
609600                          WS-TERMS-EXTD-DAYS-QTY                  60960000
609700                  END-IF                                          60970000
609800               END-IF                                             60980000
609900            END-IF                                                60990000
610000         END-IF                                                   61000000
610100      END-IF.                                                     61010000
610200                                                                  61020000
610300      IF  AP052-DISC-PCT > 0                                      61030000
610400          IF PAYTRM-DISCOUNT-PCT > 0                              61040000
610500             COMPUTE PV-TOTAL-DAYS-QTY =                          61050000
610600                     POAGMT-DISC-PAY-DAY-QTY +                    61060000
610700                     PAYTRM-DISCOUNT-DAYS-QTY                     61070000
610800             IF PV-COMPARE-DAYS-QTY > PV-TOTAL-DAYS-QTY           61080000
610900                SET PO-DSCRPNCY                  TO TRUE          61090000
611000                SET USE-INVC-TERMS               TO TRUE          61100000
611100                MOVE PV-COMPARE-DAYS-QTY         TO               61110000
611200                     WS-TERMS-DISC-DAYS-DUE                       61120000
611300             ELSE                                                 61130000
611400                IF PV-COMPARE-DAYS-QTY < PV-TOTAL-DAYS-QTY        61140000
611500                   SET PO-DSCRPNCY               TO TRUE          61150000
611600                   SET USE-PO-TERMS              TO TRUE          61160000
611700                   MOVE PAYTRM-DISCOUNT-DAYS-QTY TO               61170000
611800                        WS-TERMS-DISC-DAYS-DUE                    61180000
611900                   MOVE POAGMT-DISC-PAY-DAY-QTY  TO               61190000
612000                        WS-TERMS-EXTD-DAYS-QTY                    61200000
612100                END-IF                                            61210000
612200             END-IF                                               61220000
612300          ELSE                                                    61230000
612400             IF PAYTRM-DISCOUNT-PCT = 0                           61240000
612500                COMPUTE PV-TOTAL-DAYS-QTY =                       61250000
612600                        POAGMT-DISC-PAY-DAY-QTY +                 61260000
612700                        PAYTRM-DUE-DAY-QTY                        61270000
612800                IF PV-COMPARE-DAYS-QTY > PV-TOTAL-DAYS-QTY        61280000
612900                   SET PO-DSCRPNCY                  TO TRUE       61290000
613000                   SET USE-INVC-TERMS               TO TRUE       61300000
613100                   MOVE PV-COMPARE-DAYS-QTY         TO            61310000
613200                        WS-TERMS-DISC-DAYS-DUE                    61320000
613300                ELSE                                              61330000
613400                   IF PV-COMPARE-DAYS-QTY < PV-TOTAL-DAYS-QTY     61340000
613500                      SET PO-DSCRPNCY               TO TRUE       61350000
613600                      SET USE-PO-TERMS              TO TRUE       61360000
613700                      MOVE POAGMT-DISC-PAY-DAY-QTY  TO            61370000
613800                           WS-TERMS-EXTD-DAYS-QTY                 61380000
613900                      IF PAYTRM-DUE-DAY-QTY > 0                   61390000
614000                         MOVE PAYTRM-DUE-DAY-QTY    TO            61400000
614100                              WS-TERMS-DISC-DAYS-DUE              61410000
614200                      ELSE                                        61420000
614300                         IF PV-COMPARE-DAYS-QTY > 0               61430000
614400                            MOVE PV-COMPARE-DAYS-QTY TO           61440000
614500                                 WS-TERMS-DISC-DAYS-DUE           61450000
614600                         END-IF                                   61460000
614700                      END-IF                                      61470000
614800                END-IF                                            61480000
614900             END-IF                                               61490000
615000         END-IF                                                   61500000
615100      END-IF.                                                     61510000
615200                                                                  61520000
615300*--------------------------------------------------------------*  61530000
615400* WRITE OUT THE REJECTED EDI INVOICE TRANSACTION RECORDS       *  61540000
615500*--------------------------------------------------------------*  61550000
615600 W300-WRITE-REJECT.                                               61560000
615700                                                                  61570000
615800     PERFORM VARYING INV-INDX FROM 1 BY 1                         61580000
615900        UNTIL INV-INDX > 11000 OR                                 61590000
616000              WS-AP052-KEY-AREA(INV-INDX) = HIGH-VALUES           61600000
616100        INITIALIZE WS-REJCONS-REC                                 61610000
616200        MOVE WS-AP052-KEY-AREA(INV-INDX)  TO AP051-KEY            61620000
616300        MOVE WS-AP052-DATA-AREA(INV-INDX) TO AP051-DATA-AREA      61630000
616400        IF AP051-INV-INTERCHG                                     61640000
616500           PERFORM R900-SELECT-824-IND                            61650000
616600        END-IF                                                    61660043
616700        MOVE TRDTRN-PROD-TEST-IND TO AP051-EDI-824-IND            61670000
616800        MOVE WS-EXTENT-DUN-NBR TO WS-DUN-NBR-X                    61680000
616900        MOVE WS-DUN-NBR-9S  TO AP051-SORT-VENDOR-NBR              61690000
617000        MOVE ENTNME-ENT-NAME-DESC TO AP051-VENDOR-DESC            61700000
617100        MOVE WS-SAVE-INVOICE-NBR TO AP051-SORT-INVOICE-NBR        61710000
617200        IF  WS-SAVE-INTERCHG-CNTL-NBR NUMERIC                     61720000
617300            MOVE WS-SAVE-INTERCHG-CNTL-NBR                        61730000
617400                               TO AP051-SAVE-INTERCHG-CNTL-NBR    61740000
617500        ELSE                                                      61750000
617600            MOVE ZEROS         TO AP051-SAVE-INTERCHG-CNTL-NBR    61760000
617700        END-IF                                                    61770000
617800        MOVE WS-INV-ERR-TBL-AREA(INV-INDX) TO                     61780000
617900                                      AP051-ERROR-CODE-AREA       61790000
618000        IF ERR-DETAIL-GROSS-INVOICE AND                           61800000
618100           WS-AP052-REC-TYPE(INV-INDX) = HIGH-VALUES              61810000
618200           COMPUTE WS-DETAIL-ADJ-GROSS-INV-AMT                    61820000
618300              =   (WS-DETAIL-GROSS-INVOICE-AMT                    61830000
618400              +    WS-DETAIL-CHRG-AMT)                            61840000
618500              -    WS-DETAIL-ALLW-AMT                             61850000
618600           MOVE WS-DETAIL-ADJ-GROSS-INV-AMT TO                    61860000
618700                                      AP051-CALC-SUM-EXTEN        61870000
618800           SET AP051-ERR-DETL-GROSS-INV TO TRUE                   61880000
618900           SET AP051-CHOSE-FOR-PRINT TO TRUE                      61890000
569100           IF WS-INFOCHAIN                                        61891048
569100               SET AP052-NEXUS-INVC-YES TO TRUE                   61892048
619000           END-IF                                                 61900048
619000        END-IF                                                    61901048
619100        IF AP051-ERR-CD(1) NOT = '00' OR                          61910000
619200          (ERR-DETAIL-GROSS-INVOICE AND                           61920000
619300           (WS-AP052-REC-TYPE(INV-INDX) = '05' OR '06' OR '07'))  61930000
619400           SET AP051-CHOSE-FOR-PRINT TO TRUE                      61940000
619500        END-IF                                                    61950000
619600        IF TOO-MANY-INVC-LINES                                    61960000
619700           IF FIRST-07-REC-NOT-WRITTEN                            61970000
569100               IF WS-INFOCHAIN                                    61971050
569100                   SET AP051-ADDL-NEXUS-YES TO TRUE               61972052
619000               END-IF                                             61974050
619800              WRITE REJOUT-AP051-RECORD FROM WS-REJCONS-REC       61980000
619900              ADD 1 TO WS-REJOUT-REC-CNT                          61990000
620000              IF AP051-INV-DETAILS                                62000000
620100                 SET FIRST-07-REC-WRITTEN TO TRUE                 62010000
620200              END-IF                                              62020000
620300           ELSE                                                   62030000
620400              IF WS-AP052-REC-TYPE(INV-INDX) = HIGH-VALUES        62040000
620500                 IF TOO-MANY-INVC-LINES                           62050000
620600                    SET AP051-ERR-TOO-MANY-LINES TO TRUE          62060000
620700                 END-IF                                           62070000
620800                 MOVE WS-TOT-INVC-LINES TO AP051-TOT-INVC-LINES   62080000
569100                 IF WS-INFOCHAIN                                  62081050
569100                     SET AP051-ADDL-NEXUS-YES TO TRUE             62082052
619000                 END-IF                                           62084050
620900                 WRITE REJOUT-AP051-RECORD FROM WS-REJCONS-REC    62090000
621000                 ADD 1 TO WS-REJOUT-REC-CNT                       62100000
621100              END-IF                                              62110000
621200           END-IF                                                 62120000
621300        ELSE                                                      62130000
569100           IF WS-INFOCHAIN                                        62131050
569100               SET AP051-ADDL-NEXUS-YES TO TRUE                   62132052
619000           END-IF                                                 62134050
621400           WRITE REJOUT-AP051-RECORD FROM WS-REJCONS-REC          62140000
621500           ADD 1 TO WS-REJOUT-REC-CNT                             62150000
621600        END-IF                                                    62160000
621700     END-PERFORM.                                                 62170000
621800                                                                  62180000
621900*--------------------------------------------------------------*  62190000
622000* WRITE OUT THE RECYCLED EDI INVOICE RECS                      *  62200000
622100*--------------------------------------------------------------*  62210000
622200 W600-WRITE-RECYCLE-COMBIN.                                       62220000
622300                                                                  62230000
622400     PERFORM VARYING INV-INDX FROM 1 BY 1                         62240000
622500        UNTIL INV-INDX > 11000 OR                                 62250000
622600              WS-AP052-REC-TYPE(INV-INDX) = HIGH-VALUES           62260000
622700           OR WS-AP052-KEY-AREA(INV-INDX) = HIGH-VALUES           62270000
622800        MOVE WS-MTCH-LVL                  TO                      62280000
622900             WS-AP052-SORT-MTCH-LVL(INV-INDX)                     62290000
623000        MOVE WS-STORE-TO-USE TO WS-AP052-SORT-LOC(INV-INDX)       62300000
623100        MOVE WS-AP052-KEY-AREA(INV-INDX)  TO                      62310000
623200                      AP056-KEY OF AP056-EDI-OUT                  62320000
623300        MOVE WS-AP052-DATA-AREA(INV-INDX) TO                      62330000
623400                      AP056-DATA-AREA OF AP056-EDI-OUT            62340000
623500** CHANGE ALL PACK ITEM (PI) DETAIL RECORDS TO EACH (EA)          62350000
623600        IF (AP056-RECORD-TYPE-IND OF AP056-EDI-OUT = '07') AND    62360000
623700           (AP056-IT1-UNIT-MEASURE OF AP056-EDI-OUT = 'PI')       62370000
623800           MOVE 'EA' TO AP056-IT1-UNIT-MEASURE OF AP056-EDI-OUT   62380000
623900        END-IF                                                    62390000
624000** DO NOT WRITE OUT THE PACK HEADER (AS) DETAIL REC (07)          62400000
624100        IF (AP056-RECORD-TYPE-IND OF AP056-EDI-OUT = '07') AND    62410000
624200           (AP056-IT1-UNIT-MEASURE OF AP056-EDI-OUT = 'AS')       62420000
624300*          IF (AP056-UPC-CANT-EXPLODE-IND OF AP056-EDI-OUT = 'Y') 62430000
624400*             WRITE EDIOUT-RECYCLE-COMBIN-REC FROM AP056-EDI-OUT  62440000
624500*             ADD 1 TO WS-EDIOUT6-REC-CNT                         62450000
624600              CONTINUE                                            62460000
624700*          END-IF                                                 62470000
624800        ELSE                                                      62480000
624900** WRITE OUT ALL OTHER RECORD TYPES (01 THROUGH 06 & NON-'AS' 07) 62490000
625000           WRITE EDIOUT-RECYCLE-COMBIN-REC FROM AP056-EDI-OUT     62500000
625100           ADD 1 TO WS-EDIOUT6-REC-CNT                            62510000
625200        END-IF                                                    62520000
625300*       WRITE EDIOUT-RECYCLE-COMBIN-REC FROM AP056-EDI-OUT        62530000
625400*       ADD 1 TO WS-EDIOUT6-REC-CNT                               62540000
625500     END-PERFORM.                                                 62550000
625600                                                                  62560000
625700*--------------------------------------------------------------*  62570000
625800* WRITE OUT THE INVOICE TERMS REC(S)                           *  62580000
625900*--------------------------------------------------------------*  62590000
626000 W700-WRITE-INVOICE-TERMS.                                        62600000
626100                                                                  62610000
626200     IF NO-PO-DSCRPNCY                                            62620000
626300*  WRITE OUT 1 TERMS RECORD FOR NO DISCREPANCIES.  PO TERMS WILL  62630000
626400*  BE USED FOR THIS INVOICE.                                      62640000
626500        MOVE SPACES TO AP052-TERMS-DSCRPNCY-SW                    62650000
626600                       AP052-TERMS-DSCRPNCY-VENDOR                62660000
626700        SET AP052-SEL-PO-TERMS TO TRUE                            62670000
626800        SET AP052-SRC-INVC     TO TRUE                            62680000
626900        MOVE 1      TO AP052-TERMS-SEQ-NBR                        62690000
627000        MOVE ZEROS  TO AP052-TERMS-EXTD-DAYS-QTY                  62700000
627100        MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX)                  62710000
627200        WRITE EDIOUT-AP052-RECORD FROM WS-INV-REC(INV-INDX)       62720000
627300        ADD 1 TO WS-EDIOUT-REC-CNT                                62730000
627400     END-IF.                                                      62740000
627500                                                                  62750000
627600     IF PO-DSCRPNCY                                               62760000
627700*  WRITE OUT 2 TERMS RECORDS FOR DISCREPANCIES.  FIRST RECORD WILL62770000
627800*  BE A COMPOSITE OF THE BEST PO AND INVOICE TERMS.  THE SECOND   62780000
627900*  RECORD WILL BE THE ORIGINAL INVOICE TERMS TO BE USED FOR       62790000
628000*  REFERENCE ONLY.  THIS INVOICE WILL USE THE COMPOSITE TERMS.    62800000
628100        IF USE-PO-TERMS AND USE-INVC-TERMS                        62810000
628200           SET AP052-TERMS-DSCRPNCY-FOUND TO TRUE                 62820000
628300           MOVE ENTNME-ENT-NAME-DESC TO                           62830000
628400                  AP052-TERMS-DSCRPNCY-VENDOR                     62840000
628500           SET AP052-SEL-INVC-TERMS TO TRUE                       62850000
628600           SET AP052-SRC-CMP        TO TRUE                       62860000
628700           MOVE 1      TO AP052-TERMS-SEQ-NBR                     62870000
628800           MOVE WS-TERMS-EXTD-DAYS-QTY TO                         62880000
628900                    AP052-TERMS-EXTD-DAYS-QTY                     62890000
629000           MOVE WS-TERMS-DISC-PCT TO                              62900000
629100                    AP052-DISC-PCT                                62910000
629200           MOVE WS-TERMS-DISC-DAYS-DUE TO                         62920000
629300                    AP052-DISC-DAYS-DUE                           62930000
629400           MOVE WS-TERMS-NET-DEFRD-DAYS-DUE TO                    62940000
629500                    AP052-NET-DEFRD-DAYS-DUE                      62950000
629600           MOVE WS-TERMS-PCT-PAYABLE TO                           62960000
629700                    AP052-PCT-PAYABLE                             62970000
629800           WRITE EDIOUT-AP052-RECORD FROM WS-WORK-REC             62980000
629900           ADD 1 TO WS-EDIOUT-COMP-REC-CNT                        62990000
630000           MOVE WS-INV-REC(INV-INDX) TO WS-WORK-REC               63000000
630100           SET AP052-TERMS-DSCRPNCY-FOUND TO TRUE                 63010000
630200           MOVE ENTNME-ENT-NAME-DESC TO                           63020000
630300                  AP052-TERMS-DSCRPNCY-VENDOR                     63030000
630400           SET AP052-SEL-INVC-TERMS TO TRUE                       63040000
630500           SET AP052-SRC-CMP        TO TRUE                       63050000
630600           MOVE 2      TO AP052-TERMS-SEQ-NBR                     63060000
630700           MOVE ZEROS  TO AP052-TERMS-EXTD-DAYS-QTY               63070000
630800           MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX)               63080000
630900           WRITE EDIOUT-AP052-RECORD FROM WS-INV-REC(INV-INDX)    63090000
631000           ADD 1 TO WS-EDIOUT-REC-CNT                             63100000
631100        END-IF                                                    63110000
631200     END-IF.                                                      63120000
631300                                                                  63130000
631400     IF PO-DSCRPNCY                                               63140000
631500*  WRITE OUT 1 TERMS RECORD FOR DISCREPANCIES.  THIS INVOICE WILL 63150000
631600*  USE PO TERMS.  THIS RECORD WILL SHOW THE DISCREPANCIES FOR     63160000
631700*  VENDORS THAT DO NOT ALWAYS USE PO TERMS.                       63170000
631800        IF USE-PO-TERMS AND DONT-USE-INVC-TERMS AND               63180000
631900           NOT ALL-PO-TERMS-VNDRS                                 63190000
632000           SET AP052-TERMS-DSCRPNCY-FOUND TO TRUE                 63200000
632100           MOVE ENTNME-ENT-NAME-DESC TO                           63210000
632200                  AP052-TERMS-DSCRPNCY-VENDOR                     63220000
632300           SET AP052-SEL-PO-TERMS   TO TRUE                       63230000
632400           SET AP052-SRC-PO         TO TRUE                       63240000
632500           MOVE 1      TO AP052-TERMS-SEQ-NBR                     63250000
632600           MOVE ZEROS  TO AP052-TERMS-EXTD-DAYS-QTY               63260000
632700           MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX)               63270000
632800           WRITE EDIOUT-AP052-RECORD FROM WS-INV-REC(INV-INDX)    63280000
632900           ADD 1 TO WS-EDIOUT-REC-CNT                             63290000
633000        END-IF                                                    63300000
633100     END-IF.                                                      63310000
633200                                                                  63320000
633300     IF PO-DSCRPNCY                                               63330000
633400*  WRITE OUT 1 TERMS RECORD FOR DISCREPANCIES.  THIS INVOICE WILL 63340000
633500*  USE PO TERMS.  THIS RECORD WILL SHOW THE DISCREPANCIES FOR     63350000
633600*  VENDORS THAT ALWAYS USE PO TERMS.                              63360000
633700        IF USE-PO-TERMS AND DONT-USE-INVC-TERMS AND               63370000
633800           ALL-PO-TERMS-VNDRS                                     63380000
633900           SET AP052-TERMS-DSCRPNCY-FOUND TO TRUE                 63390000
634000           MOVE ENTNME-ENT-NAME-DESC TO                           63400000
634100                AP052-TERMS-DSCRPNCY-VENDOR                       63410000
634200           SET AP052-SEL-PO-TERMS   TO TRUE                       63420000
634300           SET AP052-SRC-PO         TO TRUE                       63430000
634400           MOVE 1      TO AP052-TERMS-SEQ-NBR                     63440000
634500           MOVE ZEROS  TO AP052-TERMS-EXTD-DAYS-QTY               63450000
634600           MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX)               63460000
634700           WRITE EDIOUT-AP052-RECORD FROM WS-INV-REC(INV-INDX)    63470000
634800           ADD 1 TO WS-EDIOUT-REC-CNT                             63480000
634900        END-IF                                                    63490000
635000     END-IF.                                                      63500000
635100                                                                  63510000
635200     IF PO-DSCRPNCY                                               63520000
635300*  WRITE OUT 1 TERMS RECORD FOR DISCREPANCIES.  THIS INVOICE WILL 63530000
635400*  USE INVOICE TERMS.                                             63540000
635500        IF USE-INVC-TERMS AND DONT-USE-PO-TERMS                   63550000
635600           SET AP052-TERMS-DSCRPNCY-FOUND TO TRUE                 63560000
635700           MOVE ENTNME-ENT-NAME-DESC TO                           63570000
635800                AP052-TERMS-DSCRPNCY-VENDOR                       63580000
635900           SET AP052-SEL-INVC-TERMS TO TRUE                       63590000
636000           SET AP052-SRC-INVC       TO TRUE                       63600000
636100           MOVE 1      TO AP052-TERMS-SEQ-NBR                     63610000
636200           MOVE ZEROS  TO AP052-TERMS-EXTD-DAYS-QTY               63620000
636300           MOVE WS-WORK-REC TO WS-INV-REC(INV-INDX)               63630000
636400           WRITE EDIOUT-AP052-RECORD FROM WS-INV-REC(INV-INDX)    63640000
636500           ADD 1 TO WS-EDIOUT-REC-CNT                             63650000
636600        END-IF                                                    63660000
636700     END-IF.                                                      63670000
636800                                                                  63680000
636900     SET NO-PO-DSCRPNCY          TO TRUE.                         63690000
637000     SET DONT-USE-PO-TERMS       TO TRUE.                         63700000
637100     SET DONT-USE-INVC-TERMS     TO TRUE.                         63710000
637200     INITIALIZE WS-TERMS-REC                                      63720000
637300                PV-TOTAL-DAYS-QTY.                                63730000
637400                                                                  63740000
637500*--------------------------------------------------------------*  63750000
637600* OPEN LOCATION CURSOR                                         *  63760000
637700*--------------------------------------------------------------*  63770000
637800 X100-OPEN-LOCATION-CSR.                                          63780000
637900                                                                  63790000
638000     EXEC SQL                                                     63800000
638100        OPEN LOCATION_CSR                                         63810000
638200     END-EXEC.                                                    63820000
638300                                                                  63830000
638400     EVALUATE TRUE                                                63840000
638500         WHEN SQLCODE = ZERO                                      63850000
638600              CONTINUE                                            63860000
638700         WHEN SQLWARN0 NOT = SPACES                               63870000
638800         WHEN SQLCODE  NOT = ZERO                                 63880000
638900              MOVE 'X100-OPEN-LOCATION-CSR        '               63890000
639000                            TO WS-ABEND-PARAGRAPH                 63900000
639100              MOVE 'UNSUCCESSFUL OPEN LOCATION CURSOR'            63910000
639200                            TO WS-ABEND-OPERATION                 63920000
639300              MOVE 'XFT00017' TO WS-ABEND-STRUCTURE-1             63930000
639400              MOVE SPACES     TO WS-ABEND-STRUCTURE-2             63940000
639500              PERFORM Z999-SQL-ERROR                              63950000
639600     END-EVALUATE.                                                63960000
639700                                                                  63970000
639800*--------------------------------------------------------------*  63980000
639900* FETCH ROWS FROM LOCATION CURSOR AND LOAD INTO LOCATION TABLE *  63990000
640000* FOR STORE NUMBER VALIDATION.                                 *  64000000
640100*--------------------------------------------------------------*  64010000
640200 X200-LOAD-LOCATION-TBL.                                          64020000
640300                                                                  64030000
640400     PERFORM VARYING LOC-INDX FROM 1 BY 1                         64040000
640500       UNTIL LOC-INDX > PC-LOC-TBL-MAX                            64050000
640600           MOVE SPACES TO WS-STORE-NBR(LOC-INDX)                  64060000
640700                          WS-STORE-TYP-CDE(LOC-INDX)              64070000
640800     END-PERFORM.                                                 64080000
640900                                                                  64090000
641000     PERFORM VARYING LOC-INDX FROM 1 BY 1                         64100000
641100       UNTIL LOC-INDX > PC-LOC-TBL-MAX                            64110000
641200          OR END-OF-LOC-CSR                                       64120000
641300             EXEC SQL                                             64130000
641400                  FETCH LOCATION_CSR                              64140000
641500                  INTO :PV-STORE-DIGITS                           64150000
641600                     , :XFT00017-LOC-TYP-CDE                      64160000
641700             END-EXEC                                             64170000
641800                                                                  64180000
641900             EVALUATE TRUE                                        64190000
642000               WHEN SQLCODE = +100                                64200000
642100                    SET END-OF-LOC-CSR TO TRUE                    64210000
642200               WHEN SQLCODE = ZERO                                64220000
642300                    MOVE PV-STORE-DIGITS TO WS-STORE-NBR(LOC-INDX)64230000
642400                    MOVE XFT00017-LOC-TYP-CDE                     64240000
642500                                     TO WS-STORE-TYP-CDE(LOC-INDX)64250000
642600               WHEN SQLWARN0 NOT = SPACES                         64260000
642700               WHEN SQLCODE  NOT = ZERO                           64270000
642800                    MOVE 'X200-LOAD-LOCATION-TBL        '         64280000
642900                                  TO WS-ABEND-PARAGRAPH           64290000
643000                    MOVE 'UNSUCCESSFUL FETCH LOCATION CSR'        64300000
643100                                  TO WS-ABEND-OPERATION           64310000
643200                    MOVE 'XFT00017' TO WS-ABEND-STRUCTURE-1       64320000
643300                    MOVE SPACES     TO WS-ABEND-STRUCTURE-2       64330000
643400                    PERFORM Z999-SQL-ERROR                        64340000
643500             END-EVALUATE                                         64350000
643600     END-PERFORM.                                                 64360000
643700                                                                  64370000
643800*--------------------------------------------------------------*  64380000
643900* CLOSE LOCATION CURSOR                                        *  64390000
644000*--------------------------------------------------------------*  64400000
644100 X300-CLOSE-LOCATION-CSR.                                         64410000
644200                                                                  64420000
644300     EXEC SQL                                                     64430000
644400        CLOSE LOCATION_CSR                                        64440000
644500     END-EXEC.                                                    64450000
644600                                                                  64460000
644700     EVALUATE TRUE                                                64470000
644800         WHEN SQLCODE = ZERO                                      64480000
644900              CONTINUE                                            64490000
645000         WHEN SQLWARN0 NOT = SPACES                               64500000
645100         WHEN SQLCODE  NOT = ZERO                                 64510000
645200              MOVE 'X300-CLOSE-LOCATION-CSR        '              64520000
645300                            TO WS-ABEND-PARAGRAPH                 64530000
645400              MOVE 'UNSUCCESSFUL CLOSE LOCATION CURSOR'           64540000
645500                            TO WS-ABEND-OPERATION                 64550000
645600              MOVE 'XFT00017' TO WS-ABEND-STRUCTURE-1             64560000
645700              MOVE SPACES     TO WS-ABEND-STRUCTURE-2             64570000
645800              PERFORM Z999-SQL-ERROR                              64580000
645900     END-EVALUATE.                                                64590000
646000                                                                  64600000
646100*--------------------------------------------------------------*  64610000
646200* SELECT IN THE ACCOUNT PAYABLE CONTROL ROW                    *  64620000
646300*--------------------------------------------------------------*  64630000
646400 X400-SELECT-TAPCNTL.                                             64640000
646500                                                                  64650000
646600     INITIALIZE DCLTAPCNTL.                                       64660000
646700                                                                  64670000
646800     EXEC SQL                                                     64680000
646900         SELECT CHRG_LIMIT_AMT                                    64690000
647000               ,BTCH_PRC_DTE                                      64700000
647100               ,CD_CHRG_LMT_AMT                                   64710000
647200               ,CD_CHRG_LMT_PCT                                   64720000
647300         INTO  :APCNTL-CHRG-LIMIT-AMT                             64730000
647400              ,:APCNTL-BTCH-PRC-DTE                               64740000
647500              ,:APCNTL-CD-CHRG-LMT-AMT                            64750000
647600              ,:APCNTL-CD-CHRG-LMT-PCT                            64760000
647700         FROM TAPCNTL                                             64770000
647800     END-EXEC                                                     64780000
647900                                                                  64790000
648000     EVALUATE TRUE                                                64800000
648100         WHEN SQLCODE = ZERO                                      64810000
648200         WHEN SQLCODE = +100                                      64820000
648300              CONTINUE                                            64830000
648400         WHEN SQLWARN0 NOT = SPACES                               64840000
648500         WHEN SQLCODE  NOT = ZERO                                 64850000
648600              MOVE 'X400-SELECT-TAPCNTL           '               64860000
648700                            TO WS-ABEND-PARAGRAPH                 64870000
648800              MOVE 'UNSUCCESSFUL SELECT APCNTL'                   64880000
648900                            TO WS-ABEND-OPERATION                 64890000
649000              MOVE 'TAPCNTL ' TO WS-ABEND-STRUCTURE-1             64900000
649100              MOVE SPACES     TO WS-ABEND-STRUCTURE-2             64910000
649200              PERFORM Z999-SQL-ERROR                              64920000
649300     END-EVALUATE.                                                64930000
649400                                                                  64940000
649500*------------------------------------------------------------*    64950000
649600* COMMIT                                                     *    64960000
649700*------------------------------------------------------------*    64970000
649800 X500-COMMIT.                                                     64980019
649900                                                                  64990019
650000     EXEC SQL                                                     65000019
650100         COMMIT                                                   65010019
650200     END-EXEC.                                                    65020019
650300                                                                  65030019
650400     EVALUATE TRUE                                                65040019
650500         WHEN SQLCODE = ZERO                                      65050019
650600              CONTINUE                                            65060019
650700         WHEN SQLWARN0 NOT = SPACES                               65070019
650800         WHEN SQLCODE  NOT = ZERO                                 65080019
650900              MOVE 'X500-COMMIT                    '              65090019
651000                            TO WS-ABEND-PARAGRAPH                 65100019
651100              MOVE 'UNSUCCESSFUL COMMIT               '           65110019
651200                            TO WS-ABEND-OPERATION                 65120019
651300              MOVE SPACES     TO WS-ABEND-STRUCTURE-1             65130019
651400              MOVE SPACES     TO WS-ABEND-STRUCTURE-2             65140019
651500              PERFORM Z999-SQL-ERROR                              65150019
651600     END-EVALUATE.                                                65160019
651700                                                                  65170019
651800*--------------------------------------------------------------*  65180000
651900* FINISH THE ERROR PROCESS, REPORT ON NECESSARY TOTALS, AND    *  65190000
652000* CLOSE ALL FILES                                              *  65200000
652100*--------------------------------------------------------------*  65210000
652200 Z900-END-OF-JOB.                                                 65220000
652300                                                                  65230000
652400     CLOSE EDIIN-AP056-COMBIN-FILE                                65240000
652500           EDIIN-AP050-FILE                                       65250000
652600           EDIOUT-AP052-FILE                                      65260000
652700           REJOUT-AP051-FILE                                      65270000
652800           EDIOUT-AP056-COMBIN-FILE.                              65280000
652900                                                                  65290000
653000     COMPUTE WS-EDIOUT-TOTL-REC-CNT                               65300000
653100             =    WS-EDIOUT-COMP-REC-CNT                          65310000
653200             +    WS-EDIOUT-REC-CNT.                              65320000
653300                                                                  65330000
653400     DISPLAY '**************************************************'.65340000
653500     DISPLAY 'TOTAL RECYCLED COMBIN RECS READ        = '          65350000
653600              WS-EDIIN-REC-CNT-COMBIN                             65360000
653700     DISPLAY 'TOTAL INVOICES RECORDS READ            = '          65370000
653800              WS-EDIIN-REC-CNT                                    65380000
653900     DISPLAY 'TOTAL GOOD EDI INVOICE RECORDS         = '          65390000
654000              WS-EDIOUT-REC-CNT                                   65400000
654100     DISPLAY 'TOTAL COMP INVC TERMS RECORDS          = '          65410000
654200              WS-EDIOUT-COMP-REC-CNT                              65420000
654300     DISPLAY 'TOTAL SPECIALTY COMP INVC TERMS        = '          65430000
654400              WS-SPECIALTY-CNT.                                   65440000
654500     DISPLAY 'TOTAL GOOD INVOICE RECORDS WRITTEN     = '          65450000
654600              WS-EDIOUT-TOTL-REC-CNT                              65460000
654700     DISPLAY 'TOTAL REJECTED INVOICE RECORDS WRITTEN = '          65470000
654800              WS-REJOUT-REC-CNT                                   65480000
654900     DISPLAY 'TOTAL RECYCLED COMBIN WRITTEN          = '          65490000
655000              WS-EDIOUT6-REC-CNT.                                 65500000
655100     DISPLAY '**************************************************'.65510000
655200                                                                  65520000
655300     IF   END-OF-EDIIN                                            65530000
655400          DISPLAY ' PROGRAM APKED201 ENDS NORMALLY '              65540000
655500     ELSE                                                         65550000
655600          DISPLAY ' PROGRAM APKED201 ENDS ABNORMALLY '            65560000
655700     END-IF.                                                      65570000
655800                                                                  65580000
655900     ACCEPT RUN-TIME FROM TIME.                                   65590000
656000     ACCEPT DATE-IN  FROM DATE.                                   65600000
656100                                                                  65610000
656200     DISPLAY ' RUN-DATE = ' DATE-IN '   RUN-TIME = ' RUN-TIME.    65620000
656300     DISPLAY '************************************************'.  65630000
656400                                                                  65640000
656500*--------------------------------------------------------------*  65650000
656600* PROCESS DB2 ABENDS                                           *  65660000
656700*--------------------------------------------------------------*  65670000
656800 Z999-SQL-ERROR.                                                  65680000
656900                                                                  65690000
657000     DISPLAY '*** DB2 ERROR '.                                    65700000
657100     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 65710000
657200     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               65720000
657300     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               65730000
657400     DISPLAY '*** TABLE 1   = ' WS-ABEND-STRUCTURE-1.             65740000
657500     IF WS-ABEND-STRUCTURE-2 > SPACES                             65750000
657600         DISPLAY '*** TABLE 2   = ' WS-ABEND-STRUCTURE-2.         65760000
657700                                                                  65770000
657800     MOVE +4013                    TO ABEND-CODE.                 65780000
657900                                                                  65790000
658000     COPY DPPD004.                                                65800000
658100     CALL 'ILBOABN0' USING ABEND-CODE.                            65810000
658200                                                                  65820000
