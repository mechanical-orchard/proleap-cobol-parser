000100 IDENTIFICATION DIVISION.                                         00010099
000200 PROGRAM-ID.    RCKCS804.                                         00020099
000300 AUTHOR.        AL PETERS.                                        00030099
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040099
000500 DATE-WRITTEN.  09/28/99.                                         00050099
000600 DATE-COMPILED.                                                   00060099
000700                                                                  00070099
000800*    TRANID      - E804                                         * 00080099
000900*    TYPE        - CICS ARCHITECTURE MAINTENANCE - DB2          * 00090099
001000*    DESCRIPTION - RECEIPT PACK UPDATE                          * 00100099
001100*    MAPSET      - RCKM804                                      * 00110099
001200*                                                               * 00120099
001300*    THIS PROGRAM ALLOWS THE USER TO CHANGE INFORMATION ON THE  * 00130099
001400*    RECITM TABLE.  IT IS ENTERED THROUGH THE RECEIVER PACK     * 00140099
001500*    LIST PROGRAM.                                              * 00150099
001510*---------------------------------------------------------------* 00151099
001520* MAINTENANCE:                                                  * 00152099
001530*    DAVID FELLENZ 07/07/14   CHG0081355                        * 00153099
001540*      MTK PROJECT - PACKAGE CODE CHANGES.                      * 00154099
001550*        CHANGES IN PARAGRAPHS:                                 * 00155099
001560*            2100-CHECK-FUNCTION-KEY                            * 00156099
001570*            2170-GET-PREPACK-TYPE-CODE                         * 00157099
001580*            3000-EDIT-DATA-IN-COMMAREA                         * 00158099
001590*---------------------------------------------------------------* 00159099
001592* CHANGED 11/11/2021    BY JIM HUNTER      WR: CHG0263784         00159299
001593* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00159399
001594* MAKING THE CALL DYNAMIC VS STATIC.                              00159499
001595*---------------------------------------------------------------* 00159599
001600                                                                  00160099
001700 ENVIRONMENT DIVISION.                                            00170099
001800 DATA DIVISION.                                                   00180099
001900                                                                  00190099
002000 WORKING-STORAGE SECTION.                                         00200099
002100                                                                  00210099
002200 01  DK-DB2-KEYS.                                                 00220099
002300     05  DK-ORD-NBR                   PIC S9(9) COMP VALUE +0.    00230099
002400     05  DK-REC-SEQ-NBR               PIC S9(9) COMP VALUE +0.    00240099
002500     05  DK-PO-LNE-NBR                PIC S9(9) COMP VALUE +0.    00250099
002600     05  DK-PACK-ID                   PIC S9(4) COMP VALUE +0.    00260099
002700     05  DK-OPR-ID                    PIC S9(4) COMP VALUE +0.    00270099
002800     05  DK-FACT                      PIC S9(4) COMP VALUE +0.    00280099
002900 01  PC-PROGRAM-CONSTANTS.                                        00290099
003000     05  PC-TRANS-ID                  PIC X(04)  VALUE 'E804'.    00300099
003100     05  PC-CURRENT-PROGRAM-NAME      PIC X(08)  VALUE 'RCKCS804'.00310099
003200     05  PC-CURRENT-MAP-NAME          PIC X(08)  VALUE 'RC804A  '.00320099
003300     05  PC-CURRENT-MAPSET-NAME       PIC X(08)  VALUE 'RCKM804 '.00330099
003400     05  PC-TROUBLE-RTN               PIC X(08)  VALUE 'TMKCS520'.00340099
003500     05  PC-TROUBLE-RTN-LENGTH        PIC S9(04) VALUE +600       00350099
003600                                                 COMP.            00360099
003700     05  PC-RECDIS-ALLOC              PIC X(08)  VALUE 'RCKCS811'.00370099
003800     05  PC-RECDIS-ALLOC-LENGTH       PIC S9(04) VALUE +34        00380099
003900                                                 COMP.            00390099
004000     05  PC-AUDIT-RTN                 PIC X(08) VALUE 'RCKCS290'. 00400099
004100     05  PC-APPL-MAP                  PIC S9(04) VALUE  +1        00410099
004200                                                 COMP.            00420099
004300     05  PC-MAX-RETRIES               PIC S9(04) VALUE  +3        00430099
004400                                                 COMP.            00440099
004500     05  PC-TRBL-QUEUE-SEQ            PIC  9(01) VALUE 3.         00450099
004600     05  PC-DEFAULT-TMST              PIC  X(26) VALUE            00460099
004700                             '9999-09-09-09.09.09.999999'.        00470099
004800     05  PC-1                         PIC S9(09) VALUE +1         00480099
004900                                                 COMP.            00490099
005000     05  PC-ACTIVE                    PIC X(01)  VALUE 'A'.       00500099
005100     05  PC-I                         PIC X(01)  VALUE 'I'.       00510099
005200     05  PC-N                         PIC X(01)  VALUE 'N'.       00520099
005300     05  PC-A                         PIC X(01)  VALUE 'A'.       00530099
005400     05  PC-F                         PIC X(01)  VALUE 'F'.       00540099
005500     05  PC-L                         PIC X(01)  VALUE 'L'.       00550099
005600     05  PC-R                         PIC X(01)  VALUE 'R'.       00560099
005700     05  PC-T                         PIC X(01)  VALUE 'T'.       00570099
005800     05  PC-U                         PIC X(01)  VALUE 'U'.       00580099
005900     05  PC-Y                         PIC X(01)  VALUE 'Y'.       00590099
006000     05  PC-AC                        PIC X(02)  VALUE 'AC'.      00600099
006100     05  PC-CM                        PIC X(02)  VALUE 'CM'.      00610099
006200     05  PC-DE                        PIC X(02)  VALUE 'DE'.      00620099
006300     05  PC-VE                        PIC X(02)  VALUE 'VE'.      00630099
006400     05  PC-IN                        PIC X(02)  VALUE 'IN'.      00640099
006500     05  PC-IP                        PIC X(02)  VALUE 'IP'.      00650099
006600     05  PC-01                        PIC X(02)  VALUE '01'.      00660099
006700     05  PC-DPKUT500                  PIC X(08)  VALUE 'DPKUT500'.00670099
006800     05  PC-INTER-APPL-CODES.                                     00680099
006900         10  PC-INTER-APPL-RCVG       PIC X(01)  VALUE '1'.       00690099
007000         10  PC-INTER-APPL-TRBL       PIC X(01)  VALUE '2'.       00700099
007100         10  PC-INTER-APPL-RCV-UPD    PIC X(01)  VALUE '3'.       00710099
007200         10  PC-INTER-APPL-RCV-DEL    PIC X(01)  VALUE '4'.       00720099
007300         10  PC-INTER-APPL-DELETE     PIC X(01)  VALUE 'D'.       00730099
007400     05  PC-DASH                      PIC X(01)  VALUE '-'.       00740099
007500     05  PC-999                       PIC 9(04)  VALUE 999.       00750099
007600     05  PC-1000                      PIC 9(04)  VALUE 1000.      00760099
007700     05  PC-8999                      PIC 9(04)  VALUE 8999.      00770099
007800     05  PC-9000                      PIC 9(04)  VALUE 9000.      00780099
007900     05  PC-MULTIPLE-MSG              PIC X(25)  VALUE            00790099
008000         'MULTIPLE TROUBLE EXISTS  '.                             00800099
008100                                                                  00810099
008200     05  PC-TSYMSG-NUMBERS.                                       00820099
008300         10  PC-TSYMSG-00005          PIC 9(05)  VALUE 00005.     00830099
008400*            INVALID VALUE                                        00840099
008500         10  PC-TSYMSG-00008          PIC 9(05)  VALUE 00008.     00850099
008600*            MUST BE NUMERIC                                      00860099
008700         10  PC-TSYMSG-00046          PIC 9(05)  VALUE 00046.     00870099
008800*            DATA NOT CHANGED; NO UPDATE PERFORMED                00880099
008900         10  PC-TSYMSG-00057          PIC 9(05)  VALUE 00057.     00890099
009000*            A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       00900099
009100         10  PC-TSYMSG-00059          PIC 9(05)  VALUE 00059.     00910099
009200*            UPDATE(S) SUCCESSFUL                                 00920099
009300         10  PC-TSYMSG-00069          PIC 9(05)  VALUE 00069.     00930099
009400*            TOP OF LIST                                          00940099
009500         10  PC-TSYMSG-00070          PIC 9(05)  VALUE 00070.     00950099
009600*            BOTTOM OF LIST                                       00960099
009700         10  PC-TSYMSG-00084          PIC 9(05)  VALUE 00084.     00970099
009800*            PURCHASE ORDER LINE DOES NOT EXIST                   00980099
009900         10  PC-TSYMSG-00115          PIC 9(05)  VALUE 00115.     00990099
010000*            DELETE SUCCESSFUL                                    01000099
010100         10  PC-TSYMSG-00116          PIC 9(05)  VALUE 00116.     01010099
010200*            CANNOT DELETE; DATA DOES NOT EXIST                   01020099
010300         10  PC-TSYMSG-00148          PIC 9(05)  VALUE 00148.     01030099
010400*            DATA DOES NOT EXIST                                  01040099
010500         10  PC-TSYMSG-00342          PIC 9(05)  VALUE 00342.     01050099
010600*            MUST BE NUMERIC AND > ZERO                           01060099
010700         10  PC-TSYMSG-00354          PIC 9(05)  VALUE 00354.     01070099
010800*            DELETE PENDING, PRESS F2 TO CONFIRM                  01080099
010900         10  PC-TSYMSG-00353          PIC 9(05)  VALUE 00353.     01090099
011000*            UPDATE PENDING                                       01100099
011100         10  PC-TSYMSG-00551          PIC 9(05)  VALUE 00551.     01110099
011200*            WAIT 15 SECONDS; RETRY FUNCTION AGAIN;               01120099
011300*            IF UNSUCCESSFUL CALL HELP DESK                       01130099
011400         10  PC-TSYMSG-00808          PIC 9(05)  VALUE 00808.     01140099
011500*            PURCHASE ORDER LINE STATUS MUST BE ACTIVE OR APPROVED01150099
011600         10  PC-TSYMSG-00854          PIC 9(05)  VALUE 00854.     01160099
011700*            ITEM QTY CAN NOT BE ZERO                             01170099
011800         10  PC-TSYMSG-00889          PIC 9(05)  VALUE 00889.     01180099
011900*            STATUS MUST BE 'IP' OR 'CM' TO DELETE                01190099
012000         10  PC-TSYMSG-00890          PIC 9(05)  VALUE 00890.     01200099
012100*            PACK SLIPS EXIST; ONLY WORK ORDER INFO DELETED       01210099
012200         10  PC-TSYMSG-00891          PIC 9(05)  VALUE 00891.     01220099
012300*            PACK SLIPS EXIST; WORK ORDER DELETE; NO STR ALLOC    01230099
012400         10  PC-TSYMSG-00892          PIC 9(05)  VALUE 00892.     01240099
012500*            PACK SLIPS EXIST; WORK ORDER DELETE; STATUS UPDATED  01250099
012600         10  PC-TSYMSG-00928          PIC 9(05)  VALUE 00928.     01260099
012700*            REDISTRO PROCEDURE INVALID FOR A PACKED BY STORE RECE01270099
012800         10  PC-TSYMSG-00929          PIC 9(05)  VALUE 00929.     01280099
012900*            RECEIPT LINE HAS ALREADY BEEN VERIFIED               01290099
013000         10  PC-TSYMSG-00937          PIC 9(05)  VALUE 00937.     01300099
013100*            UNABLE TO REDISTRO DUE TO TROUBLE                    01310099
013200         10  PC-TSYMSG-00941          PIC 9(05)  VALUE 00941.     01320099
013300*            REDISTRO SUCCESSFUL BUT TROUBLE CREATED              01330099
013400         10  PC-TSYMSG-01256          PIC 9(05)  VALUE 01256.     01340099
013500* UPDATE NOT ALLOWED:ADJUSTMENTS HAVE BEEN MADE TO THE VERIFIED QU01350099
013600         10  PC-TSYMSG-01795          PIC 9(05)  VALUE 01795.     01360099
013700* CANNOT UPDATE DETAIL CHECK QTY - CASEPACK SPLIT PROCESS PERFORMD01370099
013800         10  PC-TSYMSG-01801          PIC 9(05)  VALUE 01801.     01380099
013900* CANNOT UPDATE INNER PACK QTY - CASEPACK SPLIT PROCESS PERFORMED 01390099
014000         10  PC-TSYMSG-02106          PIC 9(05)  VALUE 02106.     01400099
014100* FUNCTION NOT ALLOWED PACK DOES NOT EXIST                        01410099
014200         10  PC-TSYMSG-02163          PIC 9(05)  VALUE 02163.     01420099
014300* UPDATE NOT ALLOWED; ODD UNITS PRESENT,                          01430099
014400*            USE PACK DTL LIST FOR CHGS                           01440099
014500         10  PC-TSYMSG-02168          PIC 9(05)  VALUE 02168.     01450099
014600* UPDATE SUCCESSFUL, PRESS PF14 TO REDISTRO                       01460099
014700         10  PC-TSYMSG-02165          PIC 9(05)  VALUE 02165.     01470099
014800* REDISTRO SUCCESSFUL                                             01480099
014900         10  PC-TSYMSG-02173          PIC 9(05)  VALUE 02173.     01490099
015000* UPDATE COMPLETE-STORE DISTRO WAS NOT FOUND FOR PACK             01500099
015100         10  PC-TSYMSG-02174          PIC 9(05)  VALUE 02174.     01510099
015200* CANNOT UPDATE LINE/PACK - CASEPACK SPLIT PROCESS WAS PERFORMED  01520099
015300         10  PC-TSYMSG-02176          PIC 9(05)  VALUE 02176.     01530099
015400* UPDATE PENDING - F2 TO CONFIRM UPD                              01540099
015500         10  PC-TSYMSG-02180          PIC 9(05)  VALUE 02180.     01550099
015600* PRESS F2 TO CONFIRM DELETE OF ENTIRE PACK                       01560099
015700         10  PC-TSYMSG-02223          PIC 9(05)  VALUE 02223.     01570099
015800* MUST BE AN INNER PACK TO MODIFY # OF INNER PACKS PER CARTON     01580099
015900         10  PC-TSYMSG-02229          PIC 9(05)  VALUE 02229.     01590099
016000* A PREPACK ERROR HAS OCCURRED (&VAR). PLEASE CONTACT HELP DESK   01600099
016100         10  PC-TSYMSG-02244          PIC 9(05)  VALUE 02244.     01610099
016200* THE NUMBER OF INNER PACKS PER CARTON MUST BE GREATER THAN 0     01620099
016300         10  PC-TSYMSG-02253          PIC 9(05)  VALUE 02253.     01630099
016400* CANNOT REDISTRO - CASEPACK SPLIT PROCESS WAS PERFORMED          01640099
016500         10  PC-TSYMSG-02305          PIC 9(05)  VALUE 02305.     01650099
016600* UPDATE SUCCESSFUL BUT TROUBLE CREATED                           01660099
016700         10  PC-TSYMSG-02360          PIC 9(05)  VALUE 02360.     01670099
016800* DTL # OF PACKS MUST BE GREATER THAN ZERO                        01680099
016900         10  PC-TSYMSG-02452          PIC 9(05)  VALUE 02452.     01690099
017000* ALLOCATION IS INCORRECT; PLEASE REVIEW DISTRO                   01700099
017010         10  PC-TSYMSG-03394          PIC 9(05)  VALUE 03394.     01701099
017020* UNABLE TO REDISTRO - MANIFESTED CARTONS EXIST FOR PO/RCVR/LNE   01702099
017030* JAK 05/2007 - ADD NEW MESSAGES FOR WMS                          01703099
017040         10  PC-TSYMSG-03568            PIC  9(05)  VALUE 03568.  01704099
017050* REDISTRO SUCCESSFUL AND ASN WILL BE DOWNLOADED TO WMS           01705099
017060         10  PC-TSYMSG-03569            PIC  9(05)  VALUE 03569.  01706099
017070* REDISTRO SUCCESSFUL, ASN WILL BE DWNLD TO WMS, BUT TROUBLE      01707099
017080* JAK 05/2007 - END                                               01708099
017100                                                                  01710099
017200                                                                  01720099
017300 01  PS-PROGRAM-SWITCHES.                                         01730099
017400     05  PS-ERROR-SW                  PIC X(01)  VALUE 'N'.       01740099
017500         88  PS-ERROR                            VALUE 'Y'.       01750099
017600         88  PS-NO-ERROR                         VALUE 'N'.       01760099
017700     05  PS-COMMAREA-SW               PIC X(01)  VALUE 'N'.       01770099
017800         88  PS-COMMAREA-VALID                   VALUE 'Y'.       01780099
017900         88  PS-COMMAREA-NOT-VALID               VALUE 'N'.       01790099
018000     05  PS-PKITEM-EXISTS-SW          PIC X(01)  VALUE 'N'.       01800099
018100         88  PS-PKITEM-FOUND                     VALUE 'Y'.       01810099
018200         88  PS-PKITEM-NOT-FOUND                 VALUE 'N'.       01820099
018300         88  PS-MULTI-PKITEM-FOUND               VALUE 'M'.       01830099
018400     05  PS-PURITM-EXISTS-SW          PIC X(01)  VALUE 'N'.       01840099
018500         88  PS-PURITM-FOUND                     VALUE 'Y'.       01850099
018600         88  PS-PURITM-NOT-FOUND                 VALUE 'N'.       01860099
018700     05  PS-UNPKSL-EXISTS-SW          PIC X(01)  VALUE 'N'.       01870099
018800         88  PS-UNPKSL-FOUND                     VALUE 'Y'.       01880099
018900         88  PS-UNPKSL-NOT-FOUND                 VALUE 'N'.       01890099
019000     05  PS-RECEIV-EXISTS-SW          PIC X(01)  VALUE 'N'.       01900099
019100         88  PS-RECEIV-FOUND                     VALUE 'Y'.       01910099
019200         88  PS-RECEIV-NOT-FOUND                 VALUE 'N'.       01920099
019300     05  PS-RTV-QTY-ERROR-SW          PIC X(01)  VALUE 'N'.       01930099
019400         88  PS-RTV-QTY-ERROR                    VALUE 'Y'.       01940099
019500         88  PS-NO-RTV-QTY-ERROR                 VALUE 'N'.       01950099
019600     05  PS-DMG-ITM-QTY-ERROR-SW      PIC X(01)  VALUE 'N'.       01960099
019700         88  PS-DMG-ITM-QTY-ERROR                VALUE 'Y'.       01970099
019800         88  PS-NO-DMG-ITM-QTY-ERROR             VALUE 'N'.       01980099
019900     05  PS-LIST-SW                   PIC X(01)  VALUE 'N'.       01990099
020000         88  PS-LIST-END                         VALUE 'Y'.       02000099
020100         88  PS-NO-LIST-END                      VALUE 'N'.       02010099
020200     05  PS-REDISTRO-SW               PIC X(01)  VALUE 'N'.       02020099
020300         88  PS-REDISTRO-OK                      VALUE 'Y'.       02030099
020400         88  PS-REDISTRO-NOT-OK                  VALUE 'N'.       02040099
020500     05  PS-RECDIS-CSR-SW             PIC X(01)  VALUE 'N'.       02050099
020600         88  PS-RECDIS-CSR-CLOSED                VALUE 'N'.       02060099
020700         88  PS-RECDIS-CSR-OPEN                  VALUE 'Y'.       02070099
020800     05  PS-RECITM-CSR-SW             PIC X(01)  VALUE 'N'.       02080099
020900         88  PS-RECITM-CSR-CLOSED                VALUE 'N'.       02090099
021000         88  PS-RECITM-CSR-OPEN                  VALUE 'Y'.       02100099
021100     05  PS-RECDIS-EOF-SW             PIC X(01)  VALUE 'N'.       02110099
021200         88  PS-EOF-RECDIS                       VALUE 'Y'.       02120099
021300         88  PS-START-RECDIS                     VALUE 'N'.       02130099
021400     05  PS-RECITM-EOF-SW             PIC X(01)  VALUE 'N'.       02140099
021500         88  PS-EOF-RECITM                       VALUE 'Y'.       02150099
021600         88  PS-START-RECITM                     VALUE 'N'.       02160099
021700                                                                  02170099
021800 01  PV-PROGRAM-VARIABLES.                                        02180099
021900     05  PV-CICS-RESPONSE             PIC S9(04) VALUE +0         02190099
022000                                                 COMP SYNC.       02200099
022100     05  PV-SEL-QUEUE-ITEM            PIC S9(04) VALUE +0         02210099
022200                                                 COMP SYNC.       02220099
022300     05  PV-DB2-COUNT                 PIC S9(09) VALUE +0         02230099
022400                                                 COMP-3.          02240099
022500     05  PV-LINE-NBR-IND              PIC S9(04) VALUE +0         02250099
022600                                                 COMP SYNC.       02260099
022700     05  PV-MAX-LINE-NBR              PIC S9(04) VALUE +0         02270099
022800                                                 COMP.            02280099
022900     05  PV-NEXT-LINE-NBR             PIC S9(04) VALUE +0         02290099
023000                                                 COMP.            02300099
023100     05  PV-RC-ORD-LNE-NBR            PIC S9(09) VALUE +0         02310099
023200                                                 COMP.            02320099
023300     05  PV-NULL-IND                  PIC S9(04) VALUE +0         02330099
023400                                                 COMP.            02340099
023500     05  PV-NULL-CKITM-QTY            PIC S9(04) VALUE +0         02350099
023600                                                 COMP.            02360099
023700     05  PV-NULL-RATO-QTY             PIC S9(04) VALUE +0         02370099
023800                                                 COMP.            02380099
023900     05  PV-ABSTIME                   PIC S9(15) COMP.            02390099
024000     05  PV-CURRENT-TIMESTAMP         PIC  X(26).                 02400099
024100     05  PV-CURRENT-TIME              PIC  9(06).                 02410099
024200     05  PV-CURRENT-DATE              PIC  9(06).                 02420099
024300     05  FILLER REDEFINES PV-CURRENT-DATE.                        02430099
024400         10  PV-CURRENT-DATE-YY       PIC  X(02).                 02440099
024500         10  PV-CURRENT-DATE-MM       PIC  X(02).                 02450099
024600         10  PV-CURRENT-DATE-DD       PIC  X(02).                 02460099
024700                                                                  02470099
024800     05  PV-CURRENT-DATE-ISO          PIC  X(10).                 02480099
024900     05  FILLER REDEFINES PV-CURRENT-DATE-ISO.                    02490099
025000         10  PV-CD-ISO-YEAR           PIC  9(04).                 02500099
025100         10  FILLER                   PIC  X(01).                 02510099
025200         10  PV-CD-ISO-MM             PIC  9(02).                 02520099
025300         10  FILLER                   PIC  X(01).                 02530099
025400         10  PV-CD-ISO-DD             PIC  9(02).                 02540099
025500                                                                  02550099
025600     05  PV-COMPARE-DATE1             PIC  X(04).                 02560099
025700     05  FILLER REDEFINES PV-COMPARE-DATE1.                       02570099
025800         10  PV-CD-YY-N               PIC  9(02).                 02580099
025900         10  PV-CD-MM-N               PIC  9(02).                 02590099
026000     05  PV-COMPARE-DATE2             PIC  X(04).                 02600099
026100     05  PV-DB2-RETURN-AREAS.                                     02610099
026200         10  PV-DB2-MONTH             PIC S9(09) VALUE +0 COMP.   02620099
026300         10  PV-DB2-DAY               PIC S9(09) VALUE +0 COMP.   02630099
026400         10  PV-DB2-YEAR              PIC S9(09) VALUE +0 COMP.   02640099
026500         10  PV-DB2-HOUR              PIC S9(09) VALUE +0 COMP.   02650099
026600         10  PV-DB2-MINUTE            PIC S9(09) VALUE +0 COMP.   02660099
026700                                                                  02670099
026800         10  PV-DB2-MONTH-TRSCP       PIC S9(09) VALUE +0 COMP.   02680099
026900         10  PV-DB2-DAY-TRSCP         PIC S9(09) VALUE +0 COMP.   02690099
027000         10  PV-DB2-YEAR-TRSCP        PIC S9(09) VALUE +0 COMP.   02700099
027100         10  PV-DB2-HOUR-TRSCP        PIC S9(09) VALUE +0 COMP.   02710099
027200         10  PV-DB2-MINUTE-TRSCP      PIC S9(09) VALUE +0 COMP.   02720099
027300                                                                  02730099
027400         10  PV-DB2-TMST.                                         02740099
027500             15  PV-DB2-DATE-AREA     PIC  X(10)   VALUE SPACES.  02750099
027600             15  FILLER               PIC  X(01)   VALUE SPACES.  02760099
027700             15  PV-DB2-TIME-AREA     PIC  X(15)   VALUE SPACES.  02770099
027800     05  PV-DISPLAY-DATE.                                         02780099
027900         10  PV-MONTH                 PIC  9(02)   VALUE ZEROES.  02790099
028000         10  FILLER                   PIC  X(01)   VALUE '-'.     02800099
028100         10  PV-DAY                   PIC  9(02)   VALUE ZEROES.  02810099
028200         10  FILLER                   PIC  X(01)   VALUE '-'.     02820099
028300         10  PV-YEAR                  PIC  9(04)   VALUE ZEROES.  02830099
028400     05  PV-DISPLAY-TIME.                                         02840099
028500         10  PV-HOUR                  PIC  9(02)   VALUE ZEROES.  02850099
028600         10  FILLER                   PIC  X(01)   VALUE ':'.     02860099
028700         10  PV-MINUTE                PIC  9(02)   VALUE ZEROES.  02870099
028800     05  PV-DB2-DATE-HOST             PIC  X(10).                 02880099
028900     05  PV-DB2-DATE                  PIC  X(10).                 02890099
029000     05  FILLER  REDEFINES PV-DB2-DATE.                           02900099
029100         10  PV-DB2-DATE-CCYY.                                    02910099
029200             15  PV-DB2-DATE-CC       PIC  X(02).                 02920099
029300             15  PV-DB2-DATE-YY       PIC  X(02).                 02930099
029400         10  FILLER                   PIC  X(01).                 02940099
029500         10  PV-DB2-DATE-MM           PIC  X(02).                 02950099
029600         10  FILLER                   PIC  X(01).                 02960099
029700         10  PV-DB2-DATE-DD           PIC  X(02).                 02970099
029800     05  PV-DB2-TIME                  PIC  X(16).                 02980099
029900     05  FILLER  REDEFINES PV-DB2-TIME.                           02990099
030000         10  PV-DB2-TIME-HH           PIC  X(02).                 03000099
030100         10  FILLER                   PIC  X(01).                 03010099
030200         10  PV-DB2-TIME-MM           PIC  X(02).                 03020099
030300         10  FILLER                   PIC  X(01).                 03030099
030400         10  PV-DB2-TIME-SS           PIC  X(02).                 03040099
030500         10  FILLER                   PIC  X(01).                 03050099
030600         10  PV-DB2-TIME-HS           PIC  X(06).                 03060099
030700     05  PV-INTEGER                   PIC  9(6).                  03070099
030800     05  PV-REMAINDER                 PIC  9(3).                  03080099
030900     05  PV-STATUS                    PIC  X(02)   VALUE SPACES.  03090099
031000     05  PV-PKSL-STAT-CDE             PIC  X(02)   VALUE SPACES.  03100099
031100         88 PV-PKSL-STAT-CDE-BEING-WORKED          VALUES         03110099
031200            'IP', 'CM'.                                           03120099
031300     05  PV-VALIDATE-IND              PIC  X(01)   VALUE SPACES.  03130099
031400         88  PV-VALID-RTV-IND                      VALUES         03140099
031500                                                   'Y', 'N', ' '. 03150099
031600         88  PV-VALID-PRE-TKT-IND                  VALUES         03160099
031700                                                   'Y', 'N', ' '. 03170099
031800     05  PV-PURITM-STATUS-CDE         PIC  X(02)   VALUE SPACES.  03180099
031900         88  PV-PURITM-STATUS-CDE-VALID            VALUES         03190099
032000                                                   'AC', 'AP'.    03200099
032100                                                                  03210099
032200     05  PV-TOTAL-DTL-CK-ITM-QTY      PIC S9(06)   COMP VALUE +0. 03220099
032300     05  PV-TOTAL-DTL-RATO-QTY        PIC S9(04)   COMP VALUE +0. 03230099
032400     05  PV-TOTAL-CASE-PACK-QTY       PIC S9(03)   COMP VALUE +0. 03240099
032500     05  PV-TOTAL-PREPK-RATO-QTY      PIC S9(04)   COMP VALUE +0. 03250099
032600     05  PV-TOTAL-UNTS-PER-CTN        PIC S9(04)   COMP VALUE +0. 03260099
032700     05  PV-TOTAL-DTL-PACK-QTY        PIC S9(06)   COMP VALUE +0. 03270099
032800     05  PV-TOTAL-CASEPACK            PIC S9(04)   COMP VALUE +0. 03280099
032900     05  PV-TOTAL-ODD-UNIT-QTY        PIC S9(04)   COMP VALUE +0. 03290099
033000                                                                  03300099
033100     05  PV-INPK-CTN-QTY              PIC S9(07)   VALUE +0.      03310099
033200     05  PV-DTL-CHK-ITM-QTY           PIC S9(09)   COMP VALUE +0. 03320099
033300     05  PV-PREPK-ODD-UNT-QTY         PIC S9(04)   COMP VALUE +0. 03330099
033400     05  PV-PREPK-RATO-QTY            PIC S9(04)   COMP VALUE +0. 03340099
033500     05  PV-EXPTED-ITM-QTY            PIC S9(09)   COMP VALUE +0. 03350099
033600                                                                  03360099
033700     05  PV-BASE-DISTRO-QTY           PIC S9(07)   VALUE +0.      03370099
033800     05  PV-DISTRO-QTY                PIC S9(07)   VALUE +0.      03380099
033900     05  PV-TROUBLE-COUNT             PIC 9(03)    VALUE ZEROS.   03390099
034000     05  PV-NOT-IN-TROUBLE-COUNT      PIC 9(03)    VALUE ZEROS.   03400099
034100     05  PV-PACK-BY-ST-IND            PIC X(01)    VALUE SPACE.   03410099
034200         88  PV-PACK-BY-ST-IND-YES                 VALUE 'Y'.     03420099
034300     05  PV-ORD-NBR                   PIC S9(09)   COMP           03430099
034400                                                   VALUE ZERO.    03440099
034500     05  PV-REC-SEQ-NBR               PIC S9(09)   COMP           03450099
034600                                                   VALUE ZERO.    03460099
034700     05  PV-CASE-PACK-QTY             PIC S9(04)   COMP VALUE +0. 03470099
034800                                                                  03480099
034900     05  PV-RECEIVER                  PIC X(13).                  03490099
035000     05  FILLER REDEFINES PV-RECEIVER.                            03500099
035100         10  PV-ORD                   PIC 9(08).                  03510099
035200         10  PV-DASH                  PIC X(01).                  03520099
035300         10  PV-REC                   PIC 9(04).                  03530099
035400     05  PV-TROUB-RSN-SHORT           PIC X(10)    VALUE SPACE.   03540099
035500     05  PV-UNPACK-OPER-UNT-ID        PIC 9(04)    VALUE ZEROS.   03550099
035600*----------------------------------------------------------------*03560099
035700*    THE LAYOUT FOR THE TEMPORARY STORAGE QUEUE CONTAINING       *03570099
035800*    SELECTED LIST ITEMS TO BE PROCESSED BY THIS PROGRAM.        *03580099
035900*----------------------------------------------------------------*03590099
036000                                                                  03600099
036100     COPY RCWS801.                                                03610099
036200/                                                                 03620099
036300     COPY PCWS016.                                                03630099
036400                                                                  03640099
036500*----------------------------------------------------------------*03650099
036600*    COPYBOOK FOR THE FIELDS PASSED TO THE TROUBLE SUBROUTINE     03660099
036700*----------------------------------------------------------------*03670099
036800                                                                  03680099
036900     COPY TMWS500.                                                03690099
037000                                                                  03700099
037100*----------------------------------------------------------------*03710099
037200*    COPYBOOK FOR THE FIELDS PASSED TO THE RECDIS  SUBROUTINE     03720099
037300*----------------------------------------------------------------*03730099
037400                                                                  03740099
037500     COPY RCWS811.                                                03750099
037600/                                                                 03760099
037700*----------------------------------------------------------------*03770099
037800*    COPYBOOK FOR LOGISTICS LOCATION MODULE (XLKUT071)            03780099
037900*----------------------------------------------------------------*03790099
038000                                                                  03800099
038100     COPY XLWS071.                                                03810099
038200                                                                  03820099
038300*----------------------------------------------------------------*03830099
038400*    MAP LAYOUT                                                  *03840099
038500*----------------------------------------------------------------*03850099
038600                                                                  03860099
038700     COPY RCKM804.                                                03870099
038800                                                                  03880099
038900/                                                                 03890099
039000*----------------------------------------------------------------*03900099
039100*    ATTRIBUTE SETTINGS COPYBOOK.                                *03910099
039200*----------------------------------------------------------------*03920099
039300                                                                  03930099
039400     COPY DPWS015.                                                03940099
039500                                                                  03950099
039600/                                                                 03960099
039700*----------------------------------------------------------------*03970099
039800*    FUNCTION KEYS COPYBOOK                                      *03980099
039900*----------------------------------------------------------------*03990099
040000                                                                  04000099
040100     COPY DPWS016.                                                04010099
040200                                                                  04020099
040300/                                                                 04030099
040400*----------------------------------------------------------------*04040099
040500*    THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT   *04050099
040600*    SUB-ROUTINE (POKUT100).                                     *04060099
040700*----------------------------------------------------------------*04070099
040800     COPY DPWS010I.                                               04080099
040900                                                                  04090099
041000/                                                                 04100099
041100*----------------------------------------------------------------*04110099
041200*  WORK AREA PASSED IN CALL TO DPKUT500                          *04120099
041300*----------------------------------------------------------------*04130099
041400     COPY DPWS500.                                                04140099
041500                                                                  04150099
041600/                                                                 04160099
041700******************************************************************04170099
041800** THE CALLING PARAMETER LIST (DPWS030/DPWS930) FOR THE CICS    **04180099
041900** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **04190099
042000******************************************************************04200099
042100     COPY DPWS030.                                                04210099
042110     COPY DPWS930.                                                04211099
042200                                                                  04220099
042300/                                                                 04230099
042400*----------------------------------------------------------------*04240099
042500*    STANDARD COMMAREA.                                          *04250099
042600*----------------------------------------------------------------*04260099
042700                                                                  04270099
042800     COPY DPWS020.                                                04280099
042900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04290099
043000                                                                  04300099
043100*----------------------------------------------------------------*04310099
043200*    INTER-APPLICATION COMMAREA.                                 *04320099
043300*----------------------------------------------------------------*04330099
043400                                                                  04340099
043500         10  INTER-APPL-COMM-AREA PIC X(200).                     04350099
043600     COPY RCWS800.                                                04360099
043700     COPY PCWS000.                                                04370099
043800*----------------------------------------------------------------*04380099
043900*    SPECIFIC COMMMAREA FOR RCKCS804.                            *04390099
044000*----------------------------------------------------------------*04400099
044100         10  ASC-SPECIFIC-COMMAREA.                               04410099
044200             15  ASC-USE-SELECTION-QUEUE-IND                      04420099
044300                                            PIC X(01).            04430099
044400                 88  ASC-USE-SELECTION-QUEUE    VALUE 'Y'.        04440099
044500             15  ASC-SEL-QUEUE-NAME         PIC X(08).            04450099
044600             15  ASC-SEL-QUEUE-NAME-2.                            04460099
044700                 20  ASC-SEL-TERM-ID-OUT PIC X(04).               04470099
044800                 20  ASC-SEL-TASK-NUMBER-OUT                      04480099
044900                                         PIC S9(05) COMP-3.       04490099
045000                 20  ASC-SEL-SEQ-OUT     PIC 9(01).               04500099
045100             15  ASC-NUMBER-OF-TS-ITEMS     PIC S9(05) COMP-3.    04510099
045200             15  ASC-NUMBER-OF-SELECTED-ITEMS                     04520099
045300                                            PIC S9(09) COMP-3.    04530099
045400             15  ASC-SEL-SUB                PIC S9(04) COMP.      04540099
045500             15  ASC-SEL-ITEM               PIC S9(04) COMP.      04550099
045600             15  ASC-CURRENT-DATE           PIC X(10).            04560099
045700             15  ASC-KEY-FIELDS.                                  04570099
045800                 20  ASC-KEY-REC-NBR        PIC S9(09) COMP.      04580099
045900                 20  ASC-KEY-PACK-ID        PIC 9(03).            04590099
046000                 20  ASC-KEY-REC-SEQ-NBR    PIC S9(09) COMP.      04600099
046100                 20  ASC-KEY-OPER-UNT-ID    PIC S9(4)  COMP.      04610099
046200                 20  ASC-KEY-FCLTY-ID       PIC S9(4)  COMP.      04620099
046300             15  ASC-SCREEN-FIELDS.                               04630099
046400                 20  ASC-OPER-UNT-ID        PIC S9(4)  COMP.      04640099
046500                 20  ASC-FCLTY-ID           PIC S9(4)  COMP.      04650099
046600                 20  ASC-FCLTY-DESC         PIC X(25).            04660099
046700                 20  ASC-ORD-NBR            PIC S9(9) COMP.       04670099
046800                 20  ASC-REC-SEQ-NBR        PIC S9(9) COMP.       04680099
046900                 20  ASC-CREATED-BY-UID     PIC X(08).            04690099
047000                 20  ASC-CREATED-BY-DTE     PIC X(10).            04700099
047100                 20  ASC-CREATED-BY-TME     PIC X(05).            04710099
047200                 20  ASC-LAST-UPD-BY-UID    PIC X(08).            04720099
047300                 20  ASC-LAST-UPD-BY-DTE    PIC X(10).            04730099
047400                 20  ASC-LAST-UPD-BY-TME    PIC X(05).            04740099
047500                 20  ASC-VEND-NAME          PIC X(16).            04750099
047600                 20  ASC-DEPT-NBR           PIC X(03).            04760099
047700                 20  ASC-PACK-ID            PIC 9(03).            04770099
047800                 20  ASC-STATUS-DESC        PIC X(15).            04780099
047900                 20  ASC-TROUBLE-DESC       PIC X(24).            04790099
048000                 20  ASC-PACK-TYP-CDE       PIC X(01).            04800099
048100                 20  ASC-PACK-TYP-DESC      PIC X(14).            04810099
048200                 20  ASC-PACK-DESC          PIC X(36).            04820099
048300                 20  ASC-PO-UNTS-CTN.                             04830099
048400                     25  ASC-PO-UNTS-CTN-N  PIC 9(03).            04840099
048500                 20  ASC-PO-UNTS-IPK.                             04850099
048600                     25  ASC-PO-UNTS-IPK-N  PIC 9(03).            04860099
048700                 20  ASC-PO-IPKS-CTN.                             04870099
048800                     25  ASC-PO-IPKS-CTN-N  PIC 9(03).            04880099
048900                 20  ASC-RC-UNTS-CTN.                             04890099
049000                     25  ASC-RC-UNTS-CTN-N  PIC 9(03).            04900099
049100                 20  ASC-RC-UNTS-IPK.                             04910099
049200                     25  ASC-RC-UNTS-IPK-N  PIC 9(03).            04920099
049300                 20  ASC-RC-IPKS-CTN.                             04930099
049400                     25  ASC-RC-IPKS-CTN-N  PIC 9(03).            04940099
049500                 20  ASC-PACK-OTR-QTY.                            04950099
049600                     25  ASC-PACK-OTR-QTY-N PIC 9(03).            04960099
049700                 20  ASC-CNVYB-INPK-IND     PIC X.                04970099
049800                 20  ASC-PKSL-PACK-QTY.                           04980099
049900                     25  ASC-PKSL-PACK-QTY-N                      04990099
050000                                            PIC 9(05).            05000099
050100                 20  ASC-DTL-PACK-QTY.                            05010099
050200                     25  ASC-DTL-PACK-QTY-N PIC 9(05).            05020099
050300                 20  ASC-ODD-UNTS.                                05030099
050400                     25  ASC-ODD-UNTS-N     PIC 9(05).            05040099
050500                 20  ASC-RTV-IND            PIC X(01).            05050099
050600                                                                  05060099
050700             15  ASC-SCREEN-SAVED-FIELDS.                         05070099
050800                 20  ASC-RC-IPKS-CTN-OLD    PIC 9(03).            05080099
050900                 20  ASC-DTL-PACK-QTY-OLD   PIC 9(05).            05090099
051000                 20  ASC-RTV-IND-OLD        PIC X(01).            05100099
051100                 20  ASC-ODD-UNTS-OLD       PIC 9(05).            05110099
051200                                                                  05120099
051300             15  ASC-PURITM-VER-NBR         PIC S9(04) COMP.      05130099
051400             15  ASC-ITM-NBR                PIC S9(15) COMP-3.    05140099
051500             15  ASC-PURITM-PIC-ITM-IND     PIC X(01).            05150099
051600             15  ASC-ENT-ID                 PIC S9(09) COMP.      05160099
051700             15  ASC-NOT-FOUND-SW           PIC X(01).            05170099
051800                 88  ASC-FOUND                         VALUE 'F'. 05180099
051900                 88  ASC-NOT-FOUND                     VALUE 'N'. 05190099
052000             15  ASC-DELETE-ITEM-SW         PIC X(01).            05200099
052100                 88  ASC-DELETE-ITEM               VALUE 'D', '4'.05210099
052200             15  ASC-DELETED-SW             PIC X(01).            05220099
052300                 88  ASC-DELETED                       VALUE 'D'. 05230099
052400                 88  ASC-NOT-DELETED                   VALUE 'N'. 05240099
052500             15  ASC-CASEPACK-SW            PIC X(01).            05250099
052600                 88  ASC-CASEPACK-YES                  VALUE 'Y'. 05260099
052700                 88  ASC-CASEPACK-NO                   VALUE 'N'. 05270099
052710             15  ASC-CARTONS-SW             PIC X(01).            05271099
052720                 88  ASC-CARTONS-FOUND                 VALUE 'Y'. 05272099
052730                 88  ASC-CARTONS-NOT-FOUND             VALUE 'N'. 05273099
052800             15  ASC-RECEIV-STATUS-CDE      PIC X(02).            05280099
052900                 88  ASC-RECEIV-STATUS-CM-VE           VALUES     05290099
053000                     'CM', 'VE'.                                  05300099
053100             15 ASC-RECITM-RCPT-DISTR-UPD-CDE                     05310099
053200                                            PIC   X(1).           05320099
053300             15  ASC-ORIGINATION-IND        PIC X(01).            05330099
053400                 88  ASC-CAME-FROM-RCVG                VALUE '1'. 05340099
053500                 88  ASC-CAME-FROM-TRBL                VALUE '2'. 05350099
053600             15  ASC-TKT-DESC               PIC X(16).            05360099
053700             15  ASC-UPD-CNTL-SW            PIC X(01).            05370099
053800                 88  ASC-NEW-PACK-ID                   VALUE 'N'. 05380099
053900                 88  ASC-UPDATE-PENDING                VALUE 'P'. 05390099
054000                 88  ASC-UPDATE-DONE                   VALUE 'D'. 05400099
054100                 88  ASC-UPDATE-ERROR                  VALUE 'E'. 05410099
054200                                                                  05420099
054300             15  ASC-TROUBLE-SW             PIC X(01).            05430099
054400                 88  ASC-TROUBLE-PENDING               VALUE 'T'. 05440099
054500                 88  ASC-TROUBLE-COMPLETE              VALUE 'C'. 05450099
054600                                                                  05460099
054700             15  ASC-NOT-CHANGED-SW         PIC X(01).            05470099
054800                 88  ASC-CHANGED                       VALUE 'Y'. 05480099
054900                 88  ASC-NOT-CHANGED                   VALUE 'N'. 05490099
055000                                                                  05500099
055100             15  ASC-REFRESH-SW             PIC X(01).            05510099
055200                 88  ASC-REFRESH                       VALUE 'Y'. 05520099
055300                 88  ASC-NO-REFRESH                    VALUE 'N'. 05530099
055400                                                                  05540099
055500             15  ASC-CONFIRM-SW             PIC X(01).            05550099
055600                 88  ASC-CONFIRM                       VALUE 'Y'. 05560099
055700                 88  ASC-NO-CONFIRM                    VALUE 'N'. 05570099
055800                                                                  05580099
055900             15  ASC-PACKDESC-SW            PIC X(01).            05590099
056000                 88  ASC-PACKDESC-YES                  VALUE 'Y'. 05600099
056100                 88  ASC-PACKDESC-NO                   VALUE 'N'. 05610099
056200                                                                  05620099
056300             15  ASC-PF19-SW                PIC X(01).            05630099
056400                 88  ASC-PF19-YES                      VALUE 'Y'. 05640099
056500                 88  ASC-PF19-NO                       VALUE 'N'. 05650099
056600                                                                  05660099
056700             15  ASC-PF20-SW                PIC X(01).            05670099
056800                 88  ASC-PF20-YES                      VALUE 'Y'. 05680099
056900                 88  ASC-PF20-NO                       VALUE 'N'. 05690099
057000                                                                  05700099
057100             15  ASC-LNE-NBR                PIC S9(09) COMP.      05710099
057200                                                                  05720099
057300*----------------------------------------------------------------*05730099
057400*    AUDIT FILE LAYOUT                                           *05740099
057500*----------------------------------------------------------------*05750099
057600     COPY RCWS031.                                                05760099
057700/                                                                 05770099
057800*----------------------------------------------------------------*05780099
057900*    ABEND PROCESSING COPYBOOK.                                  *05790099
058000*----------------------------------------------------------------*05800099
058100                                                                  05810099
058200     COPY DPWS013.                                                05820099
058300/                                                                 05830099
058400                                                                  05840099
058500*----------------------------------------------------------------*05850099
058600*    SYSTEM MESSAGE COPYBOOK                                     *05860099
058700*----------------------------------------------------------------*05870099
058800                                                                  05880099
058900     COPY DPRD507I.                                               05890099
059000/                                                                 05900099
059100                                                                  05910099
059200*----------------------------------------------------------------*05920099
059300*    DB2 SQL COMMUNICATION AREA                                   05930099
059400*----------------------------------------------------------------*05940099
059500     EXEC SQL                                                     05950099
059600          INCLUDE SQLCA                                           05960099
059700     END-EXEC.                                                    05970099
059800                                                                  05980099
059810******************************************************************05981099
059820*    CARTON MASTER    SUT_OTBND_CART                              05982099
059830******************************************************************05983099
059840     EXEC SQL                                                     05984099
059850         INCLUDE SUT00024                                         05985099
059860     END-EXEC.                                                    05986099
059870/                                                                 05987099
059880******************************************************************05988099
059890*    CARTON UPC       SUT_OTBND_UPC                               05989099
059891******************************************************************05989199
059892     EXEC SQL                                                     05989299
059893         INCLUDE SUT00028                                         05989399
059894     END-EXEC.                                                    05989499
059895/                                                                 05989599
059900/                                                                 05990099
060000*----------------------------------------------------------------*06000099
060100*    DB2 DCLGEN FOR THE RECEIVER TABLE                            06010099
060200*----------------------------------------------------------------*06020099
060300     EXEC SQL                                                     06030099
060400          INCLUDE TRECEIV                                         06040099
060500     END-EXEC.                                                    06050099
060600                                                                  06060099
060700/                                                                 06070099
060800*----------------------------------------------------------------*06080099
060900*    DB2 DCLGEN FOR THE PURCHASE ITEM TABLE                       06090099
061000*----------------------------------------------------------------*06100099
061100     EXEC SQL                                                     06110099
061200          INCLUDE TPURITM                                         06120099
061300     END-EXEC.                                                    06130099
061400                                                                  06140099
061500/                                                                 06150099
061600*----------------------------------------------------------------*06160099
061700*    DB2 DCLGEN FOR THE RECEIVER ITEM TABLE                       06170099
061800*----------------------------------------------------------------*06180099
061900     EXEC SQL                                                     06190099
062000          INCLUDE TRECITM                                         06200099
062100     END-EXEC.                                                    06210099
062200                                                                  06220099
062300/                                                                 06230099
062400*----------------------------------------------------------------*06240099
062500*    DB2 DCLGEN FOR THE DISTRIBUTION HEADER TABLE                 06250099
062600*----------------------------------------------------------------*06260099
062700     EXEC SQL                                                     06270099
062800          INCLUDE TDISTHD                                         06280099
062900     END-EXEC.                                                    06290099
063000                                                                  06300099
063100/                                                                 06310099
063200*----------------------------------------------------------------*06320099
063300*    DB2 DCLGEN FOR THE RECEIVER DISTRIBUTION TABLE               06330099
063400*----------------------------------------------------------------*06340099
063500     EXEC SQL                                                     06350099
063600          INCLUDE TRECDIS                                         06360099
063700     END-EXEC.                                                    06370099
063800                                                                  06380099
063900/                                                                 06390099
064000*----------------------------------------------------------------*06400099
064100*    DB2 DCLGEN FOR THE VENDOR NAME TABLE                         06410099
064200*----------------------------------------------------------------*06420099
064300     EXEC SQL                                                     06430099
064400          INCLUDE TENTNME                                         06440099
064500     END-EXEC.                                                    06450099
064600                                                                  06460099
064700/                                                                 06470099
064800*----------------------------------------------------------------*06480099
064900*    DB2 DCLGEN FOR THE PURCHASE ORDER PREPACK TABLE              06490099
065000*----------------------------------------------------------------*06500099
065100     EXEC SQL                                                     06510099
065200          INCLUDE TPOPRPK                                         06520099
065300     END-EXEC.                                                    06530099
065400                                                                  06540099
065500/                                                                 06550099
065600*----------------------------------------------------------------*06560099
065700*    DB2 DCLGEN FOR PURCHASE ORDER TABLE                          06570099
065800*----------------------------------------------------------------*06580099
065900     EXEC SQL                                                     06590099
066000          INCLUDE TPURCHS                                         06600099
066100     END-EXEC.                                                    06610099
066200                                                                  06620099
066300/                                                                 06630099
066400*----------------------------------------------------------------*06640099
066500*    DB2 DCLGEN FOR PURCHASE ORDER STATUS CODE TABLE              06650099
066600*----------------------------------------------------------------*06660099
066700     EXEC SQL                                                     06670099
066800          INCLUDE TSTATCD                                         06680099
066900     END-EXEC.                                                    06690099
067000                                                                  06700099
067100*----------------------------------------------------------------*06710099
067200*    DB2 DCLGEN FOR THE TROUBLE NOTIFICATION TABLE                06720099
067300*----------------------------------------------------------------*06730099
067400     EXEC SQL                                                     06740099
067500          INCLUDE TTRBNTF                                         06750099
067600     END-EXEC.                                                    06760099
067700                                                                  06770099
067800*----------------------------------------------------------------*06780099
067900*    DB2 DCLGEN FOR THE TROUBLE REASON CODE TABLE                 06790099
068000*----------------------------------------------------------------*06800099
068100     EXEC SQL                                                     06810099
068200          INCLUDE TTRBRSN                                         06820099
068300     END-EXEC.                                                    06830099
068400                                                                  06840099
068500/                                                                 06850099
068600******************************************************************06860099
068700*    DB2 DECLARE CURSOR FOR TRECITM TABLE                         06870099
068800******************************************************************06880099
068900     EXEC SQL                                                     06890099
069000     DECLARE TRECITM-CSR CURSOR WITH HOLD FOR                     06900099
069100     SELECT                                                       06910099
069200         ORD_LNE_NBR                                              06920099
069300        ,PREPK_RATO_QTY                                           06930099
069400                                                                  06940099
069500     FROM TRECITM                                                 06950099
069600                                                                  06960099
069700     WHERE                                                        06970099
069800         ORD_NBR                =  :DK-ORD-NBR                    06980099
069900         AND REC_SEQ_NBR        =  :DK-REC-SEQ-NBR                06990099
070000         AND OPER_UNT_ID        =  :DK-OPR-ID                     07000099
070100         AND FCLTY_ID           =  :DK-FACT                       07010099
070200         AND PREPK_ID           =  :DK-PACK-ID                    07020099
070300         AND PREPK_RATO_QTY     > 0                               07030099
070400         AND VER_STATUS_CDE     = 'A'                             07040099
070500     END-EXEC.                                                    07050099
070600/                                                                 07060099
070700 LINKAGE SECTION.                                                 07070099
070800                                                                  07080099
070900 01  DFHCOMMAREA.                                                 07090099
071000     05  FILLER                       OCCURS  1 TO 4072 TIMES     07100099
071100                                      DEPENDING ON EIBCALEN.      07110099
071200         10  FILLER                   PIC X.                      07120099
071300                                                                  07130099
071400/                                                                 07140099
071500 PROCEDURE DIVISION.                                              07150099
071600                                                                  07160099
071700*----------------------------------------------------------------*07170099
071800*    THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. *07180099
071900*    THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  *07190099
072000*    MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            *07200099
072100*                                                                *07210099
072200*    THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  *07220099
072300*    LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       *07230099
072400*----------------------------------------------------------------*07240099
072500 0000-MAIN-MODULE.                                                07250099
072600                                                                  07260099
072700     INITIALIZE DP030-CICS-API-FIELDS.                            07270099
072800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       07280099
072900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          07290099
073000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         07300099
073100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       07310099
073200     MOVE LENGTH OF RC804AI        TO DP030-MAP-LENGTH (1).       07320099
073300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     07330099
073400     PERFORM 0001-CALL-CICS-ARCH-API.                             07340099
073500                                                                  07350099
073600     PERFORM 1000-CONTROL-PROCESSING.                             07360099
073700                                                                  07370099
073800     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     07380099
073900     PERFORM 0001-CALL-CICS-ARCH-API.                             07390099
074000                                                                  07400099
074100/                                                                 07410099
074200 0001-CALL-CICS-ARCH-API.                                         07420099
074300                                                                  07430099
074410     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      07441099
074500                                    DFHCOMMAREA                   07450099
074600                                    DP030-CICS-API-FIELDS         07460099
074700                                    DP020-STANDARD-COMMAREA       07470099
074800                                    RC804AI.                      07480099
074900                                                                  07490099
075000     IF  DP030-RC-CALL-SUCCESSFUL                                 07500099
075100         CONTINUE                                                 07510099
075200     ELSE                                                         07520099
075300         SET DP013-NO-ROLLBACK                                    07530099
075400             DP013-XCTL-DISPLAY-RESTART                           07540099
075500             DP013-CICS-ABEND      TO TRUE                        07550099
075600         MOVE 'BEFORE 0000-MAIN-MODULE'                           07560099
075700                                   TO DP013-PARAGRAPH             07570099
075720         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN CODE O07572099
075730-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      07573099
076000         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      07600099
076100         PERFORM DP013-0000-PROCESS-ABEND                         07610099
076200     END-IF.                                                      07620099
076300                                                                  07630099
076400/                                                                 07640099
076500*----------------------------------------------------------------*07650099
076600*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *07660099
076700*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *07670099
076800*----------------------------------------------------------------*07680099
076900                                                                  07690099
077000 1000-CONTROL-PROCESSING.                                         07700099
077100                                                                  07710099
077200     EVALUATE TRUE                                                07720099
077300         WHEN DP020-NEXT-ACT-INITIAL                              07730099
077400              INITIALIZE ASC-SPECIFIC-COMMAREA                    07740099
077500              PERFORM 1100-PROCESS-INTER-APPL-COMM                07750099
077600              PERFORM 4000-BUILD-INITIAL-PANEL                    07760099
077700              PERFORM 3200-RESET-ATTRIBUTES                       07770099
077800              PERFORM 3500-SAVE-SCREEN-FIELDS                     07780099
077900                                                                  07790099
078000         WHEN DP020-NEXT-ACT-READ-MAP                             07800099
078100              PERFORM 2000-PROCESS-PANEL                          07810099
078200                                                                  07820099
078300         WHEN DP020-NEXT-ACT-RETURN                               07830099
078400              MOVE ASC-KEY-REC-NBR                                07840099
078500                            TO DK-ORD-NBR                         07850099
078600                               ASC-ORD-NBR                        07860099
078700              MOVE ASC-KEY-REC-SEQ-NBR                            07870099
078800                            TO ASC-REC-SEQ-NBR                    07880099
078900                               DK-REC-SEQ-NBR                     07890099
079000                                                                  07900099
079100              MOVE ASC-KEY-OPER-UNT-ID                            07910099
079200                            TO ASC-OPER-UNT-ID                    07920099
079300                               DK-OPR-ID                          07930099
079400                                                                  07940099
079500              MOVE ASC-KEY-FCLTY-ID                               07950099
079600                            TO ASC-FCLTY-ID                       07960099
079700                               DK-FACT                            07970099
079800                                                                  07980099
079900              MOVE ASC-KEY-PACK-ID                                07990099
080000                            TO ASC-PACK-ID                        08000099
080100                               DK-PACK-ID                         08010099
080200              PERFORM 4063-CALC-ODD-UNTS-QTY                      08020099
080300              MOVE PV-TOTAL-ODD-UNIT-QTY                          08030099
080400                            TO ASC-ODD-UNTS-N                     08040099
080500              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                08050099
080600*            PERFORM 3500-SAVE-SCREEN-FIELDS                      08060099
080700                                                                  08070099
080800         WHEN OTHER                                               08080099
080900              SET DP013-LOGIC-ABEND                               08090099
081000                  DP013-NO-ROLLBACK                               08100099
081100                                   TO TRUE                        08110099
081200              MOVE '1000-CONTROL-PROCESSING'                      08120099
081300                                   TO DP013-PARAGRAPH             08130099
081400              MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'  08140099
081500                                   TO DP013-MESSAGE-TEXT(1)       08150099
081600              MOVE DP020-NEXT-APPL-ACTIVITY                       08160099
081700                                   TO DP013-MESSAGE-TEXT(2)       08170099
081800              PERFORM DP013-0000-PROCESS-ABEND                    08180099
081900     END-EVALUATE.                                                08190099
082000                                                                  08200099
082100/                                                                 08210099
082200*----------------------------------------------------------------*08220099
082300*    SAVE THE KEYS PASSED IN THE INTER-APPL COMMAREA             *08230099
082400*----------------------------------------------------------------*08240099
082500 1100-PROCESS-INTER-APPL-COMM.                                    08250099
082600                                                                  08260099
082700     SET PS-COMMAREA-VALID         TO TRUE.                       08270099
082800                                                                  08280099
082900     IF RC800-NUMBER-OF-SELECTED-ITEMS = ZERO                     08290099
083000         MOVE PC-TSYMSG-00057      TO DP020-MSG-NUMBER            08300099
083100         SET DP020-MSG-FATAL       TO TRUE                        08310099
083200         SET DP020-NEXT-ACT-APPL-ERROR                            08320099
083300                                   TO TRUE                        08330099
083400         SET PS-ERROR              TO TRUE                        08340099
083500     ELSE                                                         08350099
083600         SET ASC-USE-SELECTION-QUEUE                              08360099
083700                                   TO TRUE                        08370099
083800         MOVE RC800-NUMBER-OF-SELECTED-ITEMS                      08380099
083900                                   TO ASC-NUMBER-OF-SELECTED-ITEMS08390099
084000         MOVE RC800-NUMBER-OF-TS-ITEMS                            08400099
084100                                   TO ASC-NUMBER-OF-TS-ITEMS      08410099
084200         MOVE RC800-SEL-QUEUE-NAME TO ASC-SEL-QUEUE-NAME          08420099
084300         PERFORM 1120-PREPARE-LIST-ENTRY                          08430099
084400     END-IF.                                                      08440099
084500                                                                  08450099
084600                                                                  08460099
084700/                                                                 08470099
084800*----------------------------------------------------------------*08480099
084900*    ENTRY IS FROM A LIST.  GET THE PO NUMBER FROM THE           *08490099
085000*    TEMP STORAGE QUEUE PASSED FROM THE LIST.                    *08500099
085100*----------------------------------------------------------------*08510099
085200 1120-PREPARE-LIST-ENTRY.                                         08520099
085300                                                                  08530099
085400     MOVE RC801-MAX-ITEMS          TO ASC-SEL-SUB.                08540099
085500     MOVE ZERO                     TO ASC-SEL-ITEM.               08550099
085600                                                                  08560099
085700     PERFORM 2110-GET-NEXT-RECITM-SELECT.                         08570099
085800                                                                  08580099
085900/                                                                 08590099
086000*----------------------------------------------------------------*08600099
086100*    MOVE THE PASSED DATA TO THE ASC FIELDS                      *08610099
086200*----------------------------------------------------------------*08620099
086300 1150-PREPARE-ASC-FIELDS.                                         08630099
086400                                                                  08640099
086500     MOVE RC801-REC-LNE-NBR (ASC-SEL-SUB)                         08650099
086600                                   TO ASC-LNE-NBR.                08660099
086700     MOVE RC801-PACK-ID (ASC-SEL-SUB)                             08670099
086800                                   TO ASC-PACK-ID.                08680099
086900     MOVE RC800-REC-STATUS         TO ASC-RECEIV-STATUS-CDE.      08690099
087000     MOVE RC800-PACK-TYPE          TO ASC-PACK-TYP-CDE.           08700099
087100     MOVE RC800-PACK-TYPE-DESC     TO ASC-PACK-TYP-DESC.          08710099
087200     MOVE RC801-PK-TRBL-RSN-LONG (ASC-SEL-SUB)                    08720099
087300                                   TO ASC-TROUBLE-DESC.           08730099
087400     MOVE RC801-PACK-OTR-QTY (ASC-SEL-SUB)                        08740099
087500                                   TO ASC-PACK-OTR-QTY-N.         08750099
087600     MOVE RC801-PKSL-PACK-QTY (ASC-SEL-SUB)                       08760099
087700                                   TO ASC-PKSL-PACK-QTY-N.        08770099
087800     IF RC801-DTL-PACK-QTY (ASC-SEL-SUB) > +0                     08780099
087900         MOVE RC801-DTL-PACK-QTY (ASC-SEL-SUB)                    08790099
088000                                   TO ASC-DTL-PACK-QTY-N          08800099
088100     ELSE                                                         08810099
088200         MOVE RC801-PKSL-PACK-QTY (ASC-SEL-SUB)                   08820099
088300                                   TO ASC-DTL-PACK-QTY-N.         08830099
088400     MOVE RC801-ODD-UNITS-PACK-QTY (ASC-SEL-SUB)                  08840099
088500                                   TO ASC-ODD-UNTS-N.             08850099
088600/                                                                 08860099
088700*----------------------------------------------------------------*08870099
088800*    DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA*08880099
088900*    ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT*08890099
089000*    USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE    *08900099
089100*    REST OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO      *08910099
089200*    INVALID FUNCTION KEYS CAN GET THIS FAR.                     *08920099
089300*----------------------------------------------------------------*08930099
089400                                                                  08940099
089500 2000-PROCESS-PANEL.                                              08950099
089600                                                                  08960099
089700     EVALUATE TRUE                                                08970099
089800*  CREATE TROUBLE LIST (TRBLLIST)                                 08980099
089900         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              08990099
090000*JPL                                                              09000099
090100             MOVE ASC-SEL-QUEUE-NAME   TO ASC-SEL-QUEUE-NAME-2    09010099
090200             MOVE PC-TRBL-QUEUE-SEQ    TO ASC-SEL-SEQ-OUT         09020099
090300             MOVE ASC-SEL-QUEUE-NAME-2 TO PC000-SEL-QUEUE-NAME    09030099
090400             PERFORM 2010-DELETE-SEL-QUEUE                        09040099
090500                                                                  09050099
090600             INITIALIZE PC016-SELECTED-ITEM-ARRAY                 09060099
090700                                                                  09070099
090800             MOVE +1                  TO PC016-ITEM(1)            09080099
090900             MOVE SPACES              TO PC016-ACTION-SW(1)       09090099
091000             MOVE ASC-KEY-REC-NBR     TO PC016-PO-NBR-N(1)        09100099
091100             MOVE ASC-KEY-REC-SEQ-NBR TO PC016-REC-SEQ-NBR-N(1)   09110099
091200             MOVE ASC-LNE-NBR         TO PC016-LINE-NBR-N(1)      09120099
091300             MOVE ASC-KEY-OPER-UNT-ID TO PC016-OPER-UNT-ID(1)     09130099
091400             MOVE ASC-KEY-FCLTY-ID    TO PC016-FCLTY-ID(1)        09140099
091500                                                                  09150099
091600             PERFORM 2020-WRITE-SEL-QUEUE                         09160099
091700                                                                  09170099
091800             MOVE +1 TO PC000-NUMBER-OF-SELECTED-ITEMS            09180099
091900             MOVE +1 TO PC000-NUMBER-OF-TS-ITEMS                  09190099
092000                                                                  09200099
092100*  CREATE TROUBLE (TRBLCRE)                                       09210099
092200         WHEN DP020-FK-LOCAL-FUNC-07 (DP020-SRC-AID)              09220099
092300             MOVE ASC-KEY-REC-NBR  TO RC800-REC-NBR-N             09230099
092400             MOVE ASC-SEL-QUEUE-NAME                              09240099
092500                                   TO RC800-SEL-QUEUE-NAME        09250099
092600             MOVE ASC-KEY-REC-SEQ-NBR                             09260099
092700                                   TO RC800-REC-SEQ-NBR-N         09270099
092800             MOVE ASC-KEY-OPER-UNT-ID                             09280099
092900                                   TO RC800-OPER-UNIT-ID          09290099
093000             MOVE ASC-KEY-FCLTY-ID TO RC800-FACILITY-ID           09300099
093100             MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    09310099
093200                               TO RC800-NUMBER-OF-SELECTED-ITEMS  09320099
093300             MOVE ASC-NUMBER-OF-TS-ITEMS                          09330099
093400                                   TO RC800-NUMBER-OF-TS-ITEMS    09340099
093500             MOVE ASC-PACK-ID TO RC800-PACK-ID                    09350099
093600             MOVE ASC-LNE-NBR TO RC800-LINE-NBR-N                 09360099
093700                                                                  09370099
093800*  CLEAR - ESC KEY                                                09380099
093900         WHEN DP020-SRC-AID = DP016-CLEAR                         09390099
094000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   09400099
094100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09410099
094200                                                                  09420099
094300*  REFESH - PF5                                                   09430099
094400         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     09440099
094500             MOVE ASC-KEY-REC-NBR  TO DK-ORD-NBR                  09450099
094600                                      ASC-ORD-NBR                 09460099
094700             MOVE ASC-KEY-REC-SEQ-NBR                             09470099
094800                                   TO ASC-REC-SEQ-NBR             09480099
094900                                      DK-REC-SEQ-NBR              09490099
095000                                                                  09500099
095100             MOVE ASC-KEY-OPER-UNT-ID                             09510099
095200                                   TO ASC-OPER-UNT-ID             09520099
095300                                      DK-OPR-ID                   09530099
095400                                                                  09540099
095500             MOVE ASC-KEY-FCLTY-ID TO ASC-FCLTY-ID                09550099
095600                                      DK-FACT                     09560099
095700             SET ASC-REFRESH       TO TRUE                        09570099
095800                                                                  09580099
095900             PERFORM 4000-BUILD-INITIAL-PANEL                     09590099
096000             PERFORM 3200-RESET-ATTRIBUTES                        09600099
096100             PERFORM 3500-SAVE-SCREEN-FIELDS                      09610099
096200                                                                  09620099
096300             SET ASC-PF19-NO       TO TRUE                        09630099
096400             SET ASC-PF20-NO       TO TRUE                        09640099
096500                                                                  09650099
096600*  NEXT SELECTION - PF20                                          09660099
096700         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             09670099
096800             IF  ASC-USE-SELECTION-QUEUE                          09680099
096900                 PERFORM 2110-GET-NEXT-RECITM-SELECT              09690099
097000                 IF PS-LIST-END                                   09700099
097100                     SET PS-NO-LIST-END                           09710099
097200                                   TO TRUE                        09720099
097300                 ELSE                                             09730099
097400                     MOVE ASC-KEY-REC-NBR                         09740099
097500                                   TO DK-ORD-NBR                  09750099
097600                                      ASC-ORD-NBR                 09760099
097700                     MOVE ASC-KEY-REC-SEQ-NBR                     09770099
097800                                   TO ASC-REC-SEQ-NBR             09780099
097900                                      DK-REC-SEQ-NBR              09790099
098000                                                                  09800099
098100                     MOVE ASC-KEY-OPER-UNT-ID                     09810099
098200                                   TO ASC-OPER-UNT-ID             09820099
098300                                      DK-OPR-ID                   09830099
098400                                                                  09840099
098500                     MOVE ASC-KEY-FCLTY-ID                        09850099
098600                                   TO ASC-FCLTY-ID                09860099
098700                                      DK-FACT                     09870099
098800                                                                  09880099
098900                     MOVE ASC-KEY-PACK-ID                         09890099
099000                                   TO ASC-PACK-ID                 09900099
099100                                      DK-PACK-ID                  09910099
099200                     SET ASC-PF20-YES    TO TRUE                  09920099
099300                                                                  09930099
099400                     PERFORM 4000-BUILD-INITIAL-PANEL             09940099
099500                     PERFORM 3200-RESET-ATTRIBUTES                09950099
099600                     PERFORM 3500-SAVE-SCREEN-FIELDS              09960099
099700                 END-IF                                           09970099
099800             ELSE                                                 09980099
099900*                --- BOTTOM OF LIST ---                           09990099
100000                 MOVE PC-TSYMSG-00070                             10000099
100100                                   TO DP020-MSG-NUMBER            10010099
100200                 SET DP020-MSG-INFORMATIONAL                      10020099
100300                     PS-LIST-END   TO TRUE                        10030099
100400             END-IF                                               10040099
100500                                                                  10050099
100600*  PREV SELECTION - PF19                                          10060099
100700         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             10070099
100800             IF  ASC-USE-SELECTION-QUEUE                          10080099
100900                 PERFORM 2120-GET-PREV-RECITM-SELECT              10090099
101000                 IF PS-LIST-END                                   10100099
101100                     SET PS-NO-LIST-END                           10110099
101200                                   TO TRUE                        10120099
101300                 ELSE                                             10130099
101400                     MOVE ASC-KEY-REC-NBR                         10140099
101500                                   TO DK-ORD-NBR                  10150099
101600                                      ASC-ORD-NBR                 10160099
101700                     MOVE ASC-KEY-REC-SEQ-NBR                     10170099
101800                                   TO ASC-REC-SEQ-NBR             10180099
101900                                      DK-REC-SEQ-NBR              10190099
102000                     MOVE ASC-KEY-OPER-UNT-ID                     10200099
102100                                   TO ASC-OPER-UNT-ID             10210099
102200                                      DK-OPR-ID                   10220099
102300                     MOVE ASC-KEY-FCLTY-ID                        10230099
102400                                   TO ASC-FCLTY-ID                10240099
102500                                      DK-FACT                     10250099
102600                     MOVE ASC-KEY-PACK-ID                         10260099
102700                                   TO ASC-PACK-ID                 10270099
102800                                      DK-PACK-ID                  10280099
102900                     SET ASC-PF19-YES   TO TRUE                   10290099
103000                                                                  10300099
103100                     PERFORM 4000-BUILD-INITIAL-PANEL             10310099
103200                     PERFORM 3200-RESET-ATTRIBUTES                10320099
103300                     PERFORM 3500-SAVE-SCREEN-FIELDS              10330099
103400                 END-IF                                           10340099
103500             ELSE                                                 10350099
103600*                --- TOP OF LIST ---                              10360099
103700                 MOVE PC-TSYMSG-00069                             10370099
103800                                   TO DP020-MSG-NUMBER            10380099
103900                 SET DP020-MSG-INFORMATIONAL                      10390099
104000                     PS-LIST-END   TO TRUE                        10400099
104100             END-IF                                               10410099
104200         WHEN OTHER                                               10420099
104300             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 10430099
104400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10440099
104500             IF PS-NO-ERROR                                       10450099
104600                 SET DP030-CONTINUE-GO                            10460099
104700                                   TO TRUE                        10470099
104800                 PERFORM 2100-CHECK-FUNCTION-KEY                  10480099
104900             ELSE                                                 10490099
105000                 SET DP030-OVERRIDE-GO                            10500099
105100                                   TO TRUE                        10510099
105200             END-IF                                               10520099
105300     END-EVALUATE.                                                10530099
105400                                                                  10540099
105500*JPL-------------------------------------------------------------*10550099
105600*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *10560099
105700*----------------------------------------------------------------*10570099
105800 2010-DELETE-SEL-QUEUE.                                           10580099
105900                                                                  10590099
106000     EXEC CICS                                                    10600099
106100         DELETEQ TS                                               10610099
106200             QUEUE (ASC-SEL-QUEUE-NAME-2)                         10620099
106300             RESP  (PV-CICS-RESPONSE)                             10630099
106400     END-EXEC.                                                    10640099
106500                                                                  10650099
106600     IF ((PV-CICS-RESPONSE = DFHRESP(NORMAL))                     10660099
106700       OR (PV-CICS-RESPONSE = DFHRESP(QIDERR)))                   10670099
106800         CONTINUE                                                 10680099
106900     ELSE                                                         10690099
107000         SET DP013-CICS-ABEND         TO TRUE                     10700099
107100         SET DP013-NO-ROLLBACK        TO TRUE                     10710099
107200         MOVE '2010-DELETE-SEL-QUEUE' TO DP013-PARAGRAPH          10720099
107300         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         10730099
107400                                   TO DP013-MESSAGE-TEXT (1)      10740099
107500         PERFORM DP013-0000-PROCESS-ABEND                         10750099
107600     END-IF.                                                      10760099
107700                                                                  10770099
107800*JPL-------------------------------------------------------------*10780099
107900*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *10790099
108000*----------------------------------------------------------------*10800099
108100 2020-WRITE-SEL-QUEUE.                                            10810099
108200                                                                  10820099
108300     MOVE +1 TO PC016-SELECTED-ITEMS.                             10830099
108400                                                                  10840099
108500     EXEC CICS                                                    10850099
108600          WRITEQ TS                                               10860099
108700              QUEUE (ASC-SEL-QUEUE-NAME-2)                        10870099
108800              FROM  (PC016-TS-SEL-REC)                            10880099
108900              ITEM  (PV-SEL-QUEUE-ITEM)                           10890099
109000              RESP  (PV-CICS-RESPONSE)                            10900099
109100     END-EXEC.                                                    10910099
109200                                                                  10920099
109300     IF PV-CICS-RESPONSE = DFHRESP (NORMAL)                       10930099
109400         CONTINUE                                                 10940099
109500     ELSE                                                         10950099
109600         SET DP013-CICS-ABEND        TO TRUE                      10960099
109700         SET DP013-NO-ROLLBACK       TO TRUE                      10970099
109800         MOVE '2020-WRITE-SEL-QUEUE' TO DP013-PARAGRAPH           10980099
109900         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          10990099
110000                                  TO DP013-MESSAGE-TEXT(1)        11000099
110100         PERFORM DP013-0000-PROCESS-ABEND                         11010099
110200     END-IF.                                                      11020099
110300                                                                  11030099
110400*----------------------------------------------------------------*11040099
110500*    ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED    *11050099
110600*    FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED*11060099
110700*    FROM THE CICS ARCHITECTURE API.                             *11070099
110800*----------------------------------------------------------------*11080099
110900                                                                  11090099
111000 2100-CHECK-FUNCTION-KEY.                                         11100099
111100                                                                  11110099
111200     EVALUATE TRUE                                                11120099
111300*  ENTER KEY                                                      11130099
111400         WHEN DP020-SRC-AID = DP016-ENTER                         11140099
111500             CONTINUE                                             11150099
111600                                                                  11160099
111700*  REDISTRO - PF14                                                11170099
111800         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              11180099
111900*  CHECK IF ANY LINES ARE VERIFIED OR COMPLETE                    11190099
112000             PERFORM 4100-PREPARE-CURSOR                          11200099
112100             PERFORM 6200-CHECK-TRECITM-VERIF                     11210099
112200             IF PV-DB2-COUNT > 0                                  11220099
112300                 MOVE PC-TSYMSG-00929 TO DP020-MSG-NUMBER         11230099
112400                 SET DP020-MSG-FATAL  TO TRUE                     11240099
112500             ELSE                                                 11250099
112600*  CHECK PACK BY STORE INDICATOR BEFORE REDISTRO                  11260099
112700                 PERFORM 2130-CHECK-PACK-BY-STORE                 11270099
112800                 IF  PV-PACK-BY-ST-IND-YES                        11280099
112900                     MOVE PC-TSYMSG-00928                         11290099
113000                                   TO DP020-MSG-NUMBER            11300099
113100                     SET DP020-MSG-FATAL                          11310099
113200                                   TO TRUE                        11320099
113300                 ELSE                                             11330099
113400*  CHECK CASEPACK SPLIT BEFORE REDISTRO                           11340099
113500                   PERFORM 4350-CK-CASEPACK-SPLIT-PROCESS         11350099
113600                   IF ASC-CASEPACK-YES                            11360099
113700                       MOVE PC-TSYMSG-02253                       11370099
113800                                   TO DP020-MSG-NUMBER            11380099
113900                       SET PS-ERROR                               11390099
114000                           DP030-OVERRIDE-GO                      11400099
114100                           DP020-MSG-FATAL                        11410099
114200                                   TO TRUE                        11420099
114300                   ELSE                                           11430099
114301*  CHECK FOR MANIFESTED CARTONS FOR PACK                          11430199
114310                       PERFORM 2160-CHECK-OUTBOUND                11431099
114320                       IF ASC-CARTONS-FOUND                       11432099
114321                           MOVE PC-TSYMSG-03394                   11432199
114322                                       TO DP020-MSG-NUMBER        11432299
114323                           SET PS-ERROR                           11432399
114324                               DP030-OVERRIDE-GO                  11432499
114325                               DP020-MSG-FATAL                    11432599
114326                                       TO TRUE                    11432699
114330                       ELSE                                       11433099
114400                         SET DP030-CONTINUE-GO                    11440099
114500                                       TO TRUE                    11450099
114600                         PERFORM 6000-PROCESS-REDISTRO            11460099
114610                       END-IF                                     11461099
114700                   END-IF                                         11470099
114800                 END-IF                                           11480099
114900             END-IF                                               11490099
115000                                                                  11500099
115100*  CONFIRM - PF2                                                  11510099
115200         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    11520099
115300           MOVE ASC-SEL-QUEUE-NAME                                11530099
115400                                 TO RC800-SEL-QUEUE-NAME          11540099
115500           MOVE ASC-KEY-REC-NBR          TO DK-ORD-NBR            11550099
115600           MOVE ASC-KEY-REC-SEQ-NBR      TO DK-REC-SEQ-NBR        11560099
115700           MOVE ASC-KEY-OPER-UNT-ID      TO DK-OPR-ID             11570099
115800           MOVE ASC-KEY-FCLTY-ID         TO DK-FACT               11580099
115900           MOVE ASC-KEY-PACK-ID          TO DK-PACK-ID            11590099
116000           SET ASC-CONFIRM               TO TRUE                  11600099
116100                                                                  11610099
116200*  CHECK FOR NO CHANGES                                           11620099
116300           PERFORM 4200-CHK-FOR-NO-CHANGES                        11630099
116400           IF ASC-NOT-CHANGED                                     11640099
116500               MOVE PC-TSYMSG-00046                               11650099
116600                               TO DP020-MSG-NUMBER                11660099
116700               SET DP020-MSG-INFORMATIONAL                        11670099
116800                               TO TRUE                            11680099
116900               SET ASC-CHANGED TO TRUE                            11690099
117000           ELSE                                                   11700099
117100*  CHECK FOR # OF INNER PACKS CHANGE                              11710099
117110             PERFORM 2170-GET-PREPACK-TYPE-CODE                   11711099
117200             IF (ASC-RC-IPKS-CTN-N NOT EQUAL                      11720099
117300                  ASC-RC-IPKS-CTN-OLD AND                         11730099
117400                  POPRPK-PREPK-TYP-CDE NOT EQUAL 'I')             11740099
117410*                 ASC-PACK-TYP-CDE NOT EQUAL 'I')                 11741099
117500                     MOVE PC-TSYMSG-02223                         11750099
117600                              TO DP020-MSG-NUMBER                 11760099
117700                     SET DP020-MSG-FATAL                          11770099
117800                              TO TRUE                             11780099
117900                     MOVE DP015-UNP-ALP-BRT-OFF                   11790099
118000                              TO ARCPKCTA                         11800099
118100                     MOVE DP015-RED                               11810099
118200                              TO ARCPKCTC                         11820099
118300                     MOVE DP015-REVERSE                           11830099
118400                              TO ARCPKCTH                         11840099
118500                     MOVE -1                                      11850099
118600                              TO ARCPKCTL                         11860099
118700                     SET DP030-SET-CURSOR-APPL-1                  11870099
118800                              TO TRUE                             11880099
118900             ELSE                                                 11890099
119000               IF ASC-UPDATE-PENDING                              11900099
119100                 PERFORM 8000-SELECT-RECEIV                       11910099
119200                                                                  11920099
119300                 IF ASC-RECEIV-STATUS-CM-VE                       11930099
119400                     MOVE PC-TSYMSG-00929                         11940099
119500                                       TO DP020-MSG-NUMBER        11950099
119600                     SET DP020-MSG-FATAL                          11960099
119700                                       TO TRUE                    11970099
119800                 ELSE                                             11980099
119900                     SET DP030-CONTINUE-GO                        11990099
120000                                       TO TRUE                    12000099
120100                     MOVE ASC-SEL-QUEUE-NAME                      12010099
120200                                       TO RC800-SEL-QUEUE-NAME    12020099
120300                     PERFORM 5200-UPDATE-RECITM                   12030099
120400                                                                  12040099
120500* MOVE DATA TO TEMP STORE TO PASS BACK                            12050099
120600                                                                  12060099
120700                     MOVE ASC-KEY-REC-NBR  TO RC800-REC-NBR-N     12070099
120800                     MOVE ASC-SEL-QUEUE-NAME                      12080099
120900                                       TO RC800-SEL-QUEUE-NAME    12090099
121000                     MOVE ASC-KEY-REC-SEQ-NBR                     12100099
121100                                       TO RC800-REC-SEQ-NBR-N     12110099
121200                     MOVE ASC-KEY-OPER-UNT-ID                     12120099
121300                                       TO RC800-OPER-UNIT-ID      12130099
121400                     MOVE ASC-KEY-FCLTY-ID                        12140099
121500                                       TO RC800-FACILITY-ID       12150099
121600                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            12160099
121700                               TO RC800-NUMBER-OF-SELECTED-ITEMS  12170099
121800                     MOVE ASC-NUMBER-OF-TS-ITEMS                  12180099
121900                                   TO RC800-NUMBER-OF-TS-ITEMS    12190099
122000                     MOVE ASC-DTL-PACK-QTY-N                      12200099
122100                           TO RC801-DTL-PACK-QTY (ASC-SEL-SUB)    12210099
122200                     MOVE ASC-RC-IPKS-CTN-N                       12220099
122300                           TO RC800-INNER-PACK-QTY                12230099
122400                                                                  12240099
122500*  SAVE SCREEN FIELDS                                             12250099
122600                     PERFORM 3500-SAVE-SCREEN-FIELDS              12260099
122700                                                                  12270099
122800*  CHECK FOR UPDATE DONE AND PERFORM TROUBLE                      12280099
122900                                                                  12290099
123000                     IF (ASC-UPDATE-DONE AND                      12300099
123100                            ASC-TROUBLE-PENDING)                  12310099
123200                         MOVE PC-TSYMSG-02168                     12320099
123300                                       TO DP020-MSG-NUMBER        12330099
123400                         SET DP020-MSG-INFORMATIONAL              12340099
123500                                       TO TRUE                    12350099
123600**************************************************************    12360099
123700*    THIS CODE CALLS TROUBLE                                      12370099
123800**************************************************************    12380099
123900*                    ELSE                                         12390099
124000*                        SET DP030-CONTINUE-GO                    12400099
124100*                                      TO TRUE                    12410099
124200*                        PERFORM 6125-CHK-TROUBLE-ONLY            12420099
124300*                        PERFORM 6175-TRBL-PAK-DESC               12430099
124400*                        IF ASC-PACKDESC-YES                      12440099
124500*                            MOVE ASC-TROUBLE-DESC                12450099
124600*                                   TO ATRBLO                     12460099
124700*                                      RC801-PK-TRBL-RSN-LONG     12470099
124800*                                            (ASC-SEL-SUB)        12480099
124900*                            MOVE PV-TROUB-RSN-SHORT              12490099
125000*                                   TO RC801-PK-TRBL-RSN-SHORT    12500099
125100*                                            (ASC-SEL-SUB)        12510099
125200*                            SET ASC-TROUBLE-COMPLETE             12520099
125300*                                                 TO TRUE         12530099
125400*                        ELSE                                     12540099
125500*                            IF ASC-PACKDESC-NO                   12550099
125600*                                PERFORM 6180-TRBL-LNE-DESC       12560099
125700*                                MOVE ASC-TROUBLE-DESC            12570099
125800*                                   TO RC801-PK-TRBL-RSN-LONG     12580099
125900*                                            (ASC-SEL-SUB)        12590099
126000*                                MOVE PV-TROUB-RSN-SHORT          12600099
126100*                                   TO RC801-PK-TRBL-RSN-SHORT    12610099
126200*                                            (ASC-SEL-SUB)        12620099
126300*                                SET ASC-TROUBLE-COMPLETE         12630099
126400*                                                 TO TRUE         12640099
126500*                            END-IF                               12650099
126600*                        END-IF                                   12660099
126700***************************************************************   12670099
126800                     ELSE                                         12680099
126900*  CHECK FOR UPDATE ONLY - NO REDISTRO                            12690099
127000                         IF ASC-UPDATE-DONE                       12700099
127100                             MOVE PC-TSYMSG-00059                 12710099
127200                                        TO DP020-MSG-NUMBER       12720099
127300                             SET DP020-MSG-INFORMATIONAL          12730099
127400                                        TO TRUE                   12740099
127500                         END-IF                                   12750099
127600                     END-IF                                       12760099
127700                 END-IF                                           12770099
127800               END-IF                                             12780099
127900             END-IF                                               12790099
128000           END-IF                                                 12800099
128100                                                                  12810099
128200*  UPDATE - PF15                                                  12820099
128300         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              12830099
128400                                                                  12840099
128500*  CHECK IF PACK HAS BEEN DELETED - UPDATE NOT ALLOWED *          12850099
128600*                                                                 12860099
128700*  BACK FROM PF19 AND PACK HAS BEEN DELETED                       12870099
128800           IF (ASC-PF19-YES                                       12880099
128900               AND ASC-RC-UNTS-CTN-N = ZERO                       12890099
129000               AND ASC-RC-UNTS-IPK-N = ZERO                       12900099
129100               AND ASC-DTL-PACK-QTY-N = ZERO)                     12910099
129200                 MOVE PC-TSYMSG-02106 TO DP020-MSG-NUMBER         12920099
129300                 SET DP020-MSG-FATAL  TO TRUE                     12930099
129400           ELSE                                                   12940099
129500                                                                  12950099
129600*  MOVE KEY FIELDS                                                12960099
129700               MOVE ASC-SEL-QUEUE-NAME                            12970099
129800                                 TO RC800-SEL-QUEUE-NAME          12980099
129900               MOVE ASC-KEY-REC-NBR        TO DK-ORD-NBR          12990099
130000               MOVE ASC-KEY-REC-SEQ-NBR    TO DK-REC-SEQ-NBR      13000099
130100                                                                  13010099
130200*  CHECK IF ANY LINES ARE VERIFIED OR COMPLETE                    13020099
130300               PERFORM 4100-PREPARE-CURSOR                        13030099
130400               PERFORM 6200-CHECK-TRECITM-VERIF                   13040099
130500               IF PV-DB2-COUNT > 0                                13050099
130600                 MOVE PC-TSYMSG-00929 TO DP020-MSG-NUMBER         13060099
130700                 SET DP020-MSG-FATAL  TO TRUE                     13070099
130800               ELSE                                               13080099
130900*  CHECK PACK BY STORE INDICATOR BEFORE UPDATE                    13090099
131000                 PERFORM 2130-CHECK-PACK-BY-STORE                 13100099
131100                 IF PV-PACK-BY-ST-IND-YES                         13110099
131200                   MOVE PC-TSYMSG-00928 TO DP020-MSG-NUMBER       13120099
131300                   SET DP020-MSG-FATAL  TO TRUE                   13130099
131400                 ELSE                                             13140099
131500*  CHECK CASEPACK SPLIT BEFORE UPDATE                             13150099
131600                   PERFORM 4350-CK-CASEPACK-SPLIT-PROCESS         13160099
131700                   IF ASC-CASEPACK-YES                            13170099
131800                     MOVE PC-TSYMSG-02174  TO DP020-MSG-NUMBER    13180099
131900                     SET PS-ERROR                                 13190099
132000                        DP030-OVERRIDE-GO                         13200099
132100                        DP020-MSG-FATAL   TO TRUE                 13210099
132200                   ELSE                                           13220099
132300*  MOVE MESSAGE - ODD UNITS WILL BE REMOVED PRESS PF2             13230099
132400*    CHANGE IN DTL PACK QTY                                       13240099
132500                     IF (ASC-DTL-PACK-QTY-N NOT EQUAL             13250099
132600                         ASC-DTL-PACK-QTY-OLD)                    13260099
132700*                       MOVE PC-TSYMSG-02163                      13270099
132800                        MOVE PC-TSYMSG-02176                      13280099
132900                                 TO DP020-MSG-NUMBER              13290099
133000                        SET DP020-MSG-INFORMATIONAL               13300099
133100                                 TO TRUE                          13310099
133200                        SET ASC-UPDATE-PENDING                    13320099
133300                                 TO TRUE                          13330099
133400                     ELSE                                         13340099
133500*  MOVE MESSAGE - UPDATE PENDING PF2 TO CONFIRM                   13350099
133600*    CHANGE IN INNER PACK QTY                                     13360099
133610                       PERFORM 2170-GET-PREPACK-TYPE-CODE         13361099
133700                       IF (ASC-RC-IPKS-CTN-N NOT EQUAL            13370099
133800                           ASC-RC-IPKS-CTN-OLD AND                13380099
133900                             POPRPK-PREPK-TYP-CDE = 'I')          13390099
133910*                            ASC-PACK-TYP-CDE = 'I')              13391099
134000                           MOVE PC-TSYMSG-02176                   13400099
134100                                     TO DP020-MSG-NUMBER          13410099
134200                           SET DP020-MSG-INFORMATIONAL            13420099
134300                                     TO TRUE                      13430099
134400                           SET ASC-UPDATE-PENDING                 13440099
134500                                     TO TRUE                      13450099
134600                       ELSE                                       13460099
134700                           IF (ASC-RC-IPKS-CTN-N NOT EQUAL        13470099
134800                               ASC-RC-IPKS-CTN-OLD AND            13480099
134900                              POPRPK-PREPK-TYP-CDE NOT EQUAL 'I') 13490099
134910*                                ASC-PACK-TYP-CDE NOT EQUAL 'I')  13491099
135000                                 MOVE PC-TSYMSG-02223             13500099
135100                                     TO DP020-MSG-NUMBER          13510099
135200                                 SET DP020-MSG-FATAL              13520099
135300                                     TO TRUE                      13530099
135400                                 MOVE DP015-UNP-ALP-BRT-OFF       13540099
135500                                     TO ARCPKCTA                  13550099
135600                                 MOVE DP015-RED                   13560099
135700                                     TO ARCPKCTC                  13570099
135800                                 MOVE DP015-REVERSE               13580099
135900                                     TO ARCPKCTH                  13590099
136000                                 MOVE -1                          13600099
136100                                     TO ARCPKCTL                  13610099
136200                                 SET DP030-SET-CURSOR-APPL-1      13620099
136300                                     TO TRUE                      13630099
136400                           ELSE                                   13640099
136500*  MOVE MESSAGE - UPDATE PENDING PRESS PF2 TO CONFIRM             13650099
136600*    OTHER CHANGES                                                13660099
136700                             MOVE PC-TSYMSG-02176                 13670099
136800                                     TO DP020-MSG-NUMBER          13680099
136900                             SET DP020-MSG-INFORMATIONAL          13690099
137000                                     TO TRUE                      13700099
137100                             SET ASC-UPDATE-PENDING               13710099
137200                                     TO TRUE                      13720099
137300                           END-IF                                 13730099
137400                       END-IF                                     13740099
137500                     END-IF                                       13750099
137600                   END-IF                                         13760099
137700                 END-IF                                           13770099
137800               END-IF                                             13780099
137900           END-IF                                                 13790099
138000                                                                  13800099
138100*  PACK DETAIL LIST - PF17                                        13810099
138200                                                                  13820099
138300         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              13830099
138400             MOVE ASC-SEL-QUEUE-NAME                              13840099
138500                               TO RC800-SEL-QUEUE-NAME            13850099
138600             MOVE ASC-KEY-REC-NBR                                 13860099
138700                               TO RC800-REC-NBR-N                 13870099
138800             MOVE ASC-SEL-QUEUE-NAME                              13880099
138900                               TO RC800-SEL-QUEUE-NAME            13890099
139000             MOVE ASC-KEY-REC-SEQ-NBR                             13900099
139100                               TO RC800-REC-SEQ-NBR-N             13910099
139200             MOVE ASC-KEY-OPER-UNT-ID                             13920099
139300                               TO RC800-OPER-UNIT-ID              13930099
139400             MOVE ASC-KEY-FCLTY-ID TO RC800-FACILITY-ID           13940099
139500             MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    13950099
139600                               TO RC800-NUMBER-OF-SELECTED-ITEMS  13960099
139700             MOVE ASC-NUMBER-OF-TS-ITEMS                          13970099
139800                               TO RC800-NUMBER-OF-TS-ITEMS        13980099
139900             MOVE ASC-PACK-ID  TO RC800-PACK-ID                   13990099
140000                                                                  14000099
140100         WHEN OTHER                                               14010099
140200             SET DP013-NO-ROLLBACK                                14020099
140300                 DP013-XCTL-DISPLAY-RESTART                       14030099
140400                 DP013-CICS-ABEND  TO TRUE                        14040099
140500             MOVE '2100-CHECK-FUNCTION-KEY'                       14050099
140600                                   TO DP013-PARAGRAPH             14060099
140700             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      14070099
140800                                   TO DP013-MESSAGE-TEXT (1)      14080099
140900             PERFORM DP013-0000-PROCESS-ABEND                     14090099
141000     END-EVALUATE.                                                14100099
141100                                                                  14110099
141200/                                                                 14120099
141300*----------------------------------------------------------------*14130099
141400*    GET THE RECITM (KEY) OF THE NEXT SELECTED OBJECT            *14140099
141500*    FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.                *14150099
141600*----------------------------------------------------------------*14160099
141700 2110-GET-NEXT-RECITM-SELECT.                                     14170099
141800                                                                  14180099
141900     ADD +1                        TO ASC-SEL-SUB.                14190099
142000     IF  ASC-SEL-SUB > RC801-MAX-ITEMS                            14200099
142100         ADD +1                    TO ASC-SEL-ITEM                14210099
142200         MOVE +1                   TO ASC-SEL-SUB                 14220099
142300     END-IF.                                                      14230099
142400                                                                  14240099
142500     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                14250099
142600         PERFORM 9150-READ-SEL-QUEUE                              14260099
142700         IF  RC801-ITEM (ASC-SEL-SUB) > ZERO                      14270099
142800                                                                  14280099
142900             MOVE RC800-REC-NBR-N  TO DK-ORD-NBR                  14290099
143000                                      ASC-KEY-REC-NBR             14300099
143100                                      ASC-ORD-NBR                 14310099
143200                                                                  14320099
143300             MOVE RC800-REC-SEQ-NBR-N TO ASC-KEY-REC-SEQ-NBR      14330099
143400                                         ASC-REC-SEQ-NBR          14340099
143500                                         DK-REC-SEQ-NBR           14350099
143600                                                                  14360099
143700             MOVE RC800-OPER-UNIT-ID  TO ASC-KEY-OPER-UNT-ID      14370099
143800                                         ASC-OPER-UNT-ID          14380099
143900                                         DK-OPR-ID                14390099
144000                                                                  14400099
144100             MOVE RC800-FACILITY-ID   TO ASC-KEY-FCLTY-ID         14410099
144200                                         ASC-FCLTY-ID             14420099
144300                                         DK-FACT                  14430099
144400                                                                  14440099
144500             MOVE RC801-PACK-ID (ASC-SEL-SUB)                     14450099
144600                                      TO ASC-KEY-PACK-ID          14460099
144700                                         ASC-PACK-ID              14470099
144800                                         DK-PACK-ID               14480099
144900                                                                  14490099
145000             MOVE RC801-REC-LNE-NBR (ASC-SEL-SUB)                 14500099
145100                                      TO ASC-LNE-NBR              14510099
145200                                                                  14520099
145300                                                                  14530099
145400             PERFORM 1150-PREPARE-ASC-FIELDS                      14540099
145500                                                                  14550099
145600             SET ASC-NEW-PACK-ID      TO TRUE                     14560099
145700                                                                  14570099
145800             SET RC801-INQ (ASC-SEL-SUB)                          14580099
145900                                   TO TRUE                        14590099
146000             PERFORM 9200-REWRITE-SEL-QUEUE                       14600099
146100         ELSE                                                     14610099
146200             SUBTRACT +1 FROM ASC-SEL-SUB                         14620099
146300*            --- BOTTOM OF LIST ---                               14630099
146400             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            14640099
146500             SET DP020-MSG-INFORMATIONAL                          14650099
146600                 PS-LIST-END                                      14660099
146700                                   TO TRUE                        14670099
146800         END-IF                                                   14680099
146900     ELSE                                                         14690099
147000         SUBTRACT +1 FROM ASC-SEL-ITEM                            14700099
147100         MOVE RC801-MAX-ITEMS      TO ASC-SEL-SUB                 14710099
147200         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            14720099
147300         SET DP020-MSG-INFORMATIONAL                              14730099
147400             PS-LIST-END           TO TRUE                        14740099
147500     END-IF.                                                      14750099
147600                                                                  14760099
147700/                                                                 14770099
147800*----------------------------------------------------------------*14780099
147900*    GET THE RECITM (KEY) OF THE PREVIOUS SELECTED               *14790099
148000*    OBJECT FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.         *14800099
148100*----------------------------------------------------------------*14810099
148200 2120-GET-PREV-RECITM-SELECT.                                     14820099
148300                                                                  14830099
148400     SUBTRACT +1 FROM ASC-SEL-SUB.                                14840099
148500     IF  ASC-SEL-SUB < +1                                         14850099
148600         SUBTRACT +1 FROM ASC-SEL-ITEM                            14860099
148700         MOVE RC801-MAX-ITEMS      TO ASC-SEL-SUB                 14870099
148800     END-IF.                                                      14880099
148900                                                                  14890099
149000     IF  ASC-SEL-ITEM > ZERO                                      14900099
149100         PERFORM 9150-READ-SEL-QUEUE                              14910099
149200         INITIALIZE ASC-SCREEN-FIELDS                             14920099
149300                                                                  14930099
149400         MOVE RC800-REC-NBR-N                                     14940099
149500                                   TO DK-ORD-NBR                  14950099
149600                                      ASC-KEY-REC-NBR             14960099
149700                                      ASC-ORD-NBR                 14970099
149800                                                                  14980099
149900         MOVE RC800-REC-SEQ-NBR-N                                 14990099
150000                                   TO ASC-KEY-REC-SEQ-NBR         15000099
150100                                      ASC-REC-SEQ-NBR             15010099
150200                                      DK-REC-SEQ-NBR              15020099
150300                                                                  15030099
150400         MOVE RC800-OPER-UNIT-ID                                  15040099
150500                                   TO ASC-KEY-OPER-UNT-ID         15050099
150600                                      ASC-OPER-UNT-ID             15060099
150700                                      DK-OPR-ID                   15070099
150800                                                                  15080099
150900         MOVE RC800-FACILITY-ID                                   15090099
151000                                   TO ASC-KEY-FCLTY-ID            15100099
151100                                      ASC-FCLTY-ID                15110099
151200                                      DK-FACT                     15120099
151300                                                                  15130099
151400         MOVE RC801-PACK-ID (ASC-SEL-SUB)                         15140099
151500                                   TO ASC-KEY-PACK-ID             15150099
151600                                      ASC-PACK-ID                 15160099
151700                                      DK-PACK-ID                  15170099
151800                                                                  15180099
151900         MOVE RC801-REC-LNE-NBR (ASC-SEL-SUB)                     15190099
152000                                   TO ASC-LNE-NBR                 15200099
152100                                                                  15210099
152200         PERFORM 1150-PREPARE-ASC-FIELDS                          15220099
152300                                                                  15230099
152400         SET ASC-NEW-PACK-ID       TO TRUE                        15240099
152500     ELSE                                                         15250099
152600         MOVE +1                   TO ASC-SEL-ITEM                15260099
152700                                      ASC-SEL-SUB                 15270099
152800*        --- TOP OF LIST ---                                      15280099
152900         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            15290099
153000         SET DP020-MSG-INFORMATIONAL                              15300099
153100             PS-LIST-END           TO TRUE                        15310099
153200     END-IF.                                                      15320099
153300/                                                                 15330099
153400*----------------------------------------------------------------*15340099
153500*    GET THE CURRENT ROW FOR PROCESSING.                         *15350099
153600*----------------------------------------------------------------*15360099
153700                                                                  15370099
153800 2130-CHECK-PACK-BY-STORE.                                        15380099
153900     MOVE ASC-KEY-REC-NBR          TO PV-ORD-NBR.                 15390099
154000     MOVE ASC-KEY-REC-SEQ-NBR      TO PV-REC-SEQ-NBR.             15400099
154100                                                                  15410099
154200     EXEC SQL                                                     15420099
154300          SELECT PACK_BY_ST_IND                                   15430099
154400            INTO :PV-PACK-BY-ST-IND                               15440099
154500            FROM TRECEIV                                          15450099
154600           WHERE ORD_NBR         =  :PV-ORD-NBR                   15460099
154700             AND REC_SEQ_NBR     =  :PV-REC-SEQ-NBR               15470099
154800             AND OPER_UNT_ID     =  :ASC-KEY-OPER-UNT-ID          15480099
154900             AND FCLTY_ID        =  :ASC-KEY-FCLTY-ID             15490099
155000             AND VER_STATUS_CDE  =  :PC-A                         15500099
155100     END-EXEC.                                                    15510099
155200                                                                  15520099
155300     EVALUATE TRUE                                                15530099
155400         WHEN SQLCODE = ZERO                                      15540099
155500              CONTINUE                                            15550099
155600         WHEN SQLWARN0 NOT = SPACE                                15560099
155700         WHEN SQLCODE NOT = ZERO                                  15570099
155800              MOVE '2130-CHECK-PACK-BY-STORE'                     15580099
155900                               TO DP013-PARAGRAPH                 15590099
156000              MOVE 'SELECT TRECEIV'                               15600099
156100                               TO DP013-MESSAGE-TEXT (1)          15610099
156200              MOVE SQLCA       TO DP013-SQLCA                     15620099
156300              MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (1)        15630099
156400              SET DP013-DB2-ABEND                                 15640099
156500                               TO TRUE                            15650099
156600              PERFORM DP013-0000-PROCESS-ABEND                    15660099
156700     END-EVALUATE.                                                15670099
156800/                                                                 15680099
156810 2160-CHECK-OUTBOUND.                                             15681099
156820                                                                  15682099
156830     EXEC SQL                                                     15683099
156840         SELECT A.SHIPT_UNT_ID                                    15684099
156850         INTO   :SUT00028-SHIPT-UNT-ID                            15685099
156860         FROM  SUT_OTBND_UPC A                                    15686099
156861             , TRECITM B                                          15686199
156870             , SUT_OTBND_CART C                                   15687099
156880       WHERE A.TRN_NBR              = :ASC-ORD-NBR                15688099
156890        AND  A.RCVR_SEQ_NBR         = :ASC-REC-SEQ-NBR            15689099
156892        AND  A.TRN_NBR              = B.ORD_NBR                   15689299
156894        AND  A.RCVR_SEQ_NBR         = B.REC_SEQ_NBR               15689499
156896        AND  B.PREPK_ID             = :DK-PACK-ID                 15689699
156899        AND  B.ORD_LNE_NBR          = A.TRN_LNE_NBR               15689999
156900        AND  B.PREPK_ID             = :DK-PACK-ID                 15690099
156903        AND  A.SHIPT_UNT_ID         = C.SHIPT_UNT_ID              15690399
156904        AND  C.ACTV_IND             =  'Y'                        15690499
156905     END-EXEC.                                                    15690599
156906                                                                  15690699
156907     EVALUATE TRUE                                                15690799
156908           WHEN SQLCODE = +0                                      15690899
156909           WHEN SQLCODE = -811                                    15690999
156910                SET ASC-CARTONS-FOUND TO TRUE                     15691099
156911           WHEN SQLCODE = +100                                    15691199
156912                SET ASC-CARTONS-NOT-FOUND TO TRUE                 15691299
156913           WHEN SQLWARN0 NOT = SPACES                             15691399
156914           WHEN SQLCODE  NOT = ZERO                               15691499
156915                MOVE '2160-CHECK-OUTBOUND'                        15691599
156916                               TO DP013-PARAGRAPH                 15691699
156917                MOVE 'UNSUCCESSFUL SELECT OF OUTBOUND TBL'        15691799
156918                               TO DP013-MESSAGE-TEXT (1)          15691899
156919                MOVE SQLCA     TO DP013-SQLCA                     15691999
156920                MOVE 'SUT00024' TO DP013-DB2-TABLE-NAME (1)       15692099
156921                MOVE 'SUT00028' TO DP013-DB2-TABLE-NAME (2)       15692199
156922                SET DP013-DB2-ABEND                               15692299
156923                      DP013-XCTL-DISPLAY-RESTART                  15692399
156924                                 TO TRUE                          15692499
156925                  PERFORM DP013-0000-PROCESS-ABEND                15692599
156926     END-EVALUATE.                                                15692699
156927                                                                  15692799
156928                                                                  15692899
156929*----------------------------------------------------------------*15692999
156930*    SELECT THE PREPACK TYPE CODE.                               *15693099
156931*----------------------------------------------------------------*15693199
156932                                                                  15693299
156933 2170-GET-PREPACK-TYPE-CODE.                                      15693399
156934                                                                  15693499
156935**** MOVE CURRENT PO NUMBER AND PACK IT *******                   15693599
156936                                                                  15693699
156937*    MOVE DK-ORD-NBR TO POPRPK-PO-NBR.                            15693799
156938     MOVE ASC-ORD-NBR TO POPRPK-PO-NBR.                           15693899
156939*    MOVE DK-PACK-ID TO POPRPK-PO-PREPK-ID.                       15693999
156940     MOVE ASC-PACK-ID TO POPRPK-PO-PREPK-ID.                      15694099
156941                                                                  15694199
156942     EXEC SQL                                                     15694299
156943        SELECT PREPK_TYP_CDE                                      15694399
156944              INTO :POPRPK-PREPK-TYP-CDE                          15694499
156945                FROM TPOPRPK                                      15694599
156946              WHERE PO_NBR            = :POPRPK-PO-NBR            15694699
156947                AND PO_PREPK_ID  = : POPRPK-PO-PREPK-ID           15694799
156948        END-EXEC.                                                 15694899
156949                                                                  15694999
156950     EVALUATE TRUE                                                15695099
156951        WHEN SQLCODE = +0                                         15695199
156952             CONTINUE                                             15695299
156953        WHEN SQLWARN0 NOT = SPACES                                15695399
156954        WHEN SQLCODE < +0                                         15695499
156955        WHEN SQLCODE > +0                                         15695599
156956             MOVE '2170-GET-PREPACK-TYPE-CODE '                   15695699
156957                             TO DP013-PARAGRAPH                   15695799
156958             MOVE 'UNSUCCESSFUL SELECT ON TPOPRPK'                15695899
156959                             TO DP013-MESSAGE-TEXT (1)            15695999
156960             MOVE SQLCA       TO DP013-SQLCA                      15696099
156961                  MOVE 'TPOPRPK '  TO DP013-DB2-TABLE-NAME (1)    15696199
156962             SET DP013-DB2-ABEND                                  15696299
156963                  DP013-XCTL-DISPLAY-RESTART                      15696399
156964                                   TO TRUE                        15696499
156965             PERFORM DP013-0000-PROCESS-ABEND                     15696599
156966     END-EVALUATE.                                                15696699
156967                                                                  15696799
156970*----------------------------------------------------------------*15697099
157000*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *15700099
157100*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *15710099
157200*----------------------------------------------------------------*15720099
157300 2200-MOVE-SCREEN-TO-COMMAREA.                                    15730099
157400                                                                  15740099
157500     IF ARTVINDL > ZERO                                           15750099
157600         MOVE ARTVINDI             TO ASC-RTV-IND                 15760099
157700     ELSE                                                         15770099
157800         IF ARTVINDF = DP015-ERASE-EOF                            15780099
157900             MOVE SPACES           TO ASC-RTV-IND                 15790099
158000         END-IF                                                   15800099
158100     END-IF.                                                      15810099
158200                                                                  15820099
158300     IF ARCPKCTL > ZERO                                           15830099
158400         MOVE ARCPKCTI             TO ASC-RC-IPKS-CTN             15840099
158500     ELSE                                                         15850099
158600         IF ARCPKCTF = DP015-ERASE-EOF                            15860099
158700             MOVE ZEROS            TO ASC-RC-IPKS-CTN-N           15870099
158800         END-IF                                                   15880099
158900     END-IF.                                                      15890099
159000                                                                  15900099
159100     IF ADTLPKSL > ZERO                                           15910099
159200         MOVE ADTLPKSI             TO ASC-DTL-PACK-QTY            15920099
159300     ELSE                                                         15930099
159400         IF ADTLPKSF = DP015-ERASE-EOF                            15940099
159500             MOVE ZEROS            TO ASC-DTL-PACK-QTY-N          15950099
159600         END-IF                                                   15960099
159700     END-IF.                                                      15970099
159800                                                                  15980099
159900/                                                                 15990099
160000*----------------------------------------------------------------*16000099
160100*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *16010099
160200*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *16020099
160300*----------------------------------------------------------------*16030099
160400 3000-EDIT-DATA-IN-COMMAREA.                                      16040099
160500                                                                  16050099
160600     SET PS-NO-ERROR               TO TRUE.                       16060099
160700                                                                  16070099
160800     PERFORM 3200-RESET-ATTRIBUTES.                               16080099
160900                                                                  16090099
161000**************************************                            16100099
161100     MOVE ASC-ODD-UNTS-N           TO PV-PREPK-ODD-UNT-QTY.       16110099
161200     MOVE ASC-RTV-IND              TO PV-VALIDATE-IND.            16120099
161300     IF PV-VALID-RTV-IND                                          16130099
161400         CONTINUE                                                 16140099
161500     ELSE                                                         16150099
161600         SET PS-ERROR                                             16160099
161700             DP020-MSG-FATAL       TO TRUE                        16170099
161800         MOVE PC-TSYMSG-00005      TO DP020-MSG-NUMBER            16180099
161900         MOVE DP015-UNP-ALP-BRT-OFF                               16190099
162000                                   TO ARTVINDA                    16200099
162100         MOVE DP015-RED            TO ARTVINDC                    16210099
162200         MOVE DP015-REVERSE        TO ARTVINDH                    16220099
162300         MOVE -1                   TO ARTVINDL                    16230099
162400         SET DP030-SET-CURSOR-APPL-1                              16240099
162500                                   TO TRUE                        16250099
162600     END-IF.                                                      16260099
162700                                                                  16270099
162710     PERFORM 2170-GET-PREPACK-TYPE-CODE.                          16271099
162810     IF (ARCPKCTL > ZERO AND POPRPK-PREPK-TYP-CDE NOT EQUAL 'I')  16281099
162820*    IF (ARCPKCTL > ZERO AND ASC-PACK-TYP-CDE NOT EQUAL 'I')      16282099
162900         SET PS-ERROR                                             16290099
163000             DP020-MSG-FATAL       TO TRUE                        16300099
163100         MOVE PC-TSYMSG-02223      TO DP020-MSG-NUMBER            16310099
163200         MOVE DP015-UNP-ALP-BRT-OFF                               16320099
163300                                   TO ARCPKCTA                    16330099
163400         MOVE DP015-RED            TO ARCPKCTC                    16340099
163500         MOVE DP015-REVERSE        TO ARCPKCTH                    16350099
163600         MOVE -1                   TO ARCPKCTL                    16360099
163700         SET DP030-SET-CURSOR-APPL-1                              16370099
163800                                   TO TRUE                        16380099
163900     END-IF.                                                      16390099
164000                                                                  16400099
164100     IF  ASC-RC-IPKS-CTN > SPACES                                 16410099
164200         MOVE ASC-RC-IPKS-CTN      TO DP010I-UNEDITED-FIELD       16420099
164300         MOVE LENGTH OF ASC-RC-IPKS-CTN                           16430099
164400                                   TO DP010I-MAXIMUM-DIGITS       16440099
164500         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     16450099
164600         SET DP010I-NEGATIVE-NOT-ALLOWED                          16460099
164700                                   TO TRUE                        16470099
164810         CALL DP010I-NUMERIC-EDIT-ROUTINE                         16481099
164820              USING DP010I-NUMERIC-EDIT-AREA                      16482099
164900                                                                  16490099
165000         IF  DP010I-ERROR-DETECTED                                16500099
165100             SET DP020-MSG-FATAL                                  16510099
165200                 PS-ERROR          TO TRUE                        16520099
165300             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            16530099
165400             MOVE DP015-UNP-NUM-BRT-OFF                           16540099
165500                                   TO ARCPKCTA                    16550099
165600             MOVE DP015-RED        TO ARCPKCTC                    16560099
165700             MOVE DP015-REVERSE    TO ARCPKCTH                    16570099
165800             MOVE -1               TO ARCPKCTL                    16580099
165900             SET DP030-SET-CURSOR-APPL-1                          16590099
166000                                   TO TRUE                        16600099
166100         ELSE                                                     16610099
166200             MOVE DP010I-NUMERIC-FIELD                            16620099
166300                                   TO ASC-RC-IPKS-CTN-N           16630099
166400             MOVE ASC-RC-IPKS-CTN-N                               16640099
166500                                   TO ARCPKCTO                    16650099
166600         END-IF                                                   16660099
166700     END-IF.                                                      16670099
166800                                                                  16680099
166900     EVALUATE TRUE                                                16690099
167000     WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                        16700099
167100*  CALCULATE UNITS PER CARTON                                     16710099
167200         PERFORM 4030-GET-UNTS-PER-CTN                            16720099
167300         IF PV-TOTAL-UNTS-PER-CTN > +0                            16730099
167400             MOVE PV-TOTAL-UNTS-PER-CTN                           16740099
167500                           TO ASC-RC-UNTS-CTN-N                   16750099
167600         ELSE                                                     16760099
167700             MOVE +0       TO ASC-RC-UNTS-CTN-N                   16770099
167800         END-IF                                                   16780099
167900*  WHEN DTL # OF PACKS ARE CHANGED - MOVE ZERO TO ODD UNITS       16790099
168000*                                    AFTER PF2 IS PRESSED         16800099
168100*        IF ASC-DTL-PACK-QTY-N NOT = ASC-DTL-PACK-QTY-OLD         16810099
168200*            MOVE +0       TO ASC-ODD-UNTS-N                      16820099
168300*        END-IF                                                   16830099
168400                                                                  16840099
168500                                                                  16850099
168600*  WHEN DTL # OF PACKS ARE CHANGED - ODD UNITS MUST BE ZERO       16860099
168700*  ELSE ERROR OUT AND USE PACK DETAIL LIST FOR CHANGES            16870099
168800         IF (ASC-DTL-PACK-QTY-N NOT = ASC-DTL-PACK-QTY-OLD        16880099
168900            AND ASC-ODD-UNTS-N > ZERO)                            16890099
169000             SET PS-ERROR                                         16900099
169100                 DP020-MSG-FATAL       TO TRUE                    16910099
169200             MOVE PC-TSYMSG-02163      TO DP020-MSG-NUMBER        16920099
169300             MOVE DP015-UNP-ALP-BRT-OFF                           16930099
169400                                       TO ADTLPKSA                16940099
169500             MOVE DP015-RED            TO ADTLPKSC                16950099
169600             MOVE DP015-REVERSE        TO ADTLPKSH                16960099
169700             MOVE -1                   TO ADTLPKSL                16970099
169800             SET DP030-SET-CURSOR-APPL-1                          16980099
169900                                       TO TRUE                    16990099
170000         END-IF                                                   17000099
170100     END-EVALUATE.                                                17010099
170200                                                                  17020099
170300     IF (ASC-RC-IPKS-CTN-N = ZERO AND POPRPK-PREPK-TYP-CDE = 'I') 17030099
170310*    IF (ASC-RC-IPKS-CTN-N = ZERO AND ASC-PACK-TYP-CDE = 'I')     17031099
170400         SET PS-ERROR                                             17040099
170500             DP020-MSG-FATAL       TO TRUE                        17050099
170600         MOVE PC-TSYMSG-02244      TO DP020-MSG-NUMBER            17060099
170700         MOVE DP015-UNP-ALP-BRT-OFF                               17070099
170800                                   TO ARCPKCTA                    17080099
170900         MOVE DP015-RED            TO ARCPKCTC                    17090099
171000         MOVE DP015-REVERSE        TO ARCPKCTH                    17100099
171100         MOVE -1                   TO ARCPKCTL                    17110099
171200         SET DP030-SET-CURSOR-APPL-1                              17120099
171300                                   TO TRUE                        17130099
171400     END-IF.                                                      17140099
171500                                                                  17150099
171600*  WHEN DTL # OF PACKS ARE CHANGED - ODD UNITS MUST BE ZERO       17160099
171700*  ELSE ERROR OUT AND USE PACK DETAIL LIST FOR CHANGES            17170099
171800     IF (ADTLPKSL > +0 AND ASC-ODD-UNTS-N > ZERO)                 17180099
171900         SET PS-ERROR                                             17190099
172000             DP020-MSG-FATAL       TO TRUE                        17200099
172100         MOVE PC-TSYMSG-02163      TO DP020-MSG-NUMBER            17210099
172200         MOVE DP015-UNP-ALP-BRT-OFF                               17220099
172300                                   TO ADTLPKSA                    17230099
172400         MOVE DP015-RED            TO ADTLPKSC                    17240099
172500         MOVE DP015-REVERSE        TO ADTLPKSH                    17250099
172600         MOVE -1                   TO ADTLPKSL                    17260099
172700         SET DP030-SET-CURSOR-APPL-1                              17270099
172800                                   TO TRUE                        17280099
172900     END-IF.                                                      17290099
173000                                                                  17300099
173100*  WHEN 0 ENTERED IN DTL # OF PACKS - INVALID VALUE               17310099
173200     IF (ADTLPKSL > +0 AND ASC-DTL-PACK-QTY = ZERO)               17320099
173300         SET PS-ERROR                                             17330099
173400             DP020-MSG-FATAL       TO TRUE                        17340099
173500         MOVE PC-TSYMSG-02360      TO DP020-MSG-NUMBER            17350099
173600         MOVE DP015-UNP-ALP-BRT-OFF                               17360099
173700                                   TO ADTLPKSA                    17370099
173800         MOVE DP015-RED            TO ADTLPKSC                    17380099
173900         MOVE DP015-REVERSE        TO ADTLPKSH                    17390099
174000         MOVE -1                   TO ADTLPKSL                    17400099
174100         SET DP030-SET-CURSOR-APPL-1                              17410099
174200                                   TO TRUE                        17420099
174300     END-IF.                                                      17430099
174400                                                                  17440099
174500*  EDIT DTL # OF PACKS                                            17450099
174600     IF  ASC-DTL-PACK-QTY > SPACES                                17460099
174700         MOVE ASC-DTL-PACK-QTY     TO DP010I-UNEDITED-FIELD       17470099
174800         MOVE LENGTH OF ASC-DTL-PACK-QTY                          17480099
174900                                   TO DP010I-MAXIMUM-DIGITS       17490099
175000         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     17500099
175100         SET DP010I-NEGATIVE-NOT-ALLOWED                          17510099
175200                                   TO TRUE                        17520099
175310         CALL DP010I-NUMERIC-EDIT-ROUTINE                         17531099
175320              USING DP010I-NUMERIC-EDIT-AREA                      17532099
175400                                                                  17540099
175500         IF  DP010I-ERROR-DETECTED                                17550099
175600             SET DP020-MSG-FATAL                                  17560099
175700                 PS-ERROR          TO TRUE                        17570099
175800             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            17580099
175900             MOVE DP015-UNP-NUM-BRT-OFF                           17590099
176000                                   TO ADTLPKSA                    17600099
176100             MOVE DP015-RED        TO ADTLPKSC                    17610099
176200             MOVE DP015-REVERSE    TO ADTLPKSH                    17620099
176300             MOVE -1               TO ADTLPKSL                    17630099
176400             SET DP030-SET-CURSOR-APPL-1                          17640099
176500                                   TO TRUE                        17650099
176600         ELSE                                                     17660099
176700             MOVE DP010I-NUMERIC-FIELD                            17670099
176800                                   TO ASC-DTL-PACK-QTY-N          17680099
176900             MOVE ASC-DTL-PACK-QTY-N                              17690099
177000                                   TO ADTLPKSO                    17700099
177100         END-IF                                                   17710099
177200     END-IF.                                                      17720099
177300                                                                  17730099
177400     IF  PS-NO-ERROR                                              17740099
177500         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     17750099
177600         MOVE -1                   TO ARCPKCTL                    17760099
177700         SET DP030-SET-CURSOR-APPL-1                              17770099
177800                                   TO TRUE                        17780099
177900     END-IF.                                                      17790099
178000                                                                  17800099
178100/                                                                 17810099
178200*----------------------------------------------------------------*17820099
178300*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *17830099
178400*----------------------------------------------------------------*17840099
178500                                                                  17850099
178600 3200-RESET-ATTRIBUTES.                                           17860099
178700                                                                  17870099
178800              MOVE DP015-UNP-NUM-NOR-OFF                          17880099
178900                                   TO ARCPKCTA                    17890099
179000                                      ADTLPKSA                    17900099
179100              MOVE DP015-GREEN     TO ARCPKCTC                    17910099
179200                                      ADTLPKSC                    17920099
179300                                      ARTVINDC                    17930099
179400              MOVE DP015-UNDERLINE TO ARCPKCTH                    17940099
179500                                      ADTLPKSH                    17950099
179600                                      ARTVINDH.                   17960099
179700                                                                  17970099
179800     IF  DP020-NEXT-ACT-INITIAL                                   17980099
179900         SET DP030-SET-CURSOR-APPL-1                              17990099
180000                                   TO TRUE                        18000099
180100         MOVE -1                   TO ARCPKCTL                    18010099
180200     END-IF.                                                      18020099
180300                                                                  18030099
180400     IF (ASC-RECEIV-STATUS-CM-VE                                  18040099
180500     OR  ASC-DELETE-ITEM)                                         18050099
180600         SET DP030-SET-CURSOR-TRAILER                             18060099
180700                                   TO TRUE                        18070099
180800     END-IF.                                                      18080099
180900/                                                                 18090099
181000*----------------------------------------------------------------*18100099
181100*  THIS PARAGRAPH SAVES THE ENTERABLE SCEEN FIELDS               *18110099
181200*----------------------------------------------------------------*18120099
181300                                                                  18130099
181400 3500-SAVE-SCREEN-FIELDS.                                         18140099
181500                                                                  18150099
181600     MOVE ASC-RC-IPKS-CTN-N  TO ASC-RC-IPKS-CTN-OLD.              18160099
181700     MOVE ASC-DTL-PACK-QTY-N TO ASC-DTL-PACK-QTY-OLD.             18170099
181800     MOVE ASC-RTV-IND        TO ASC-RTV-IND-OLD.                  18180099
181900     MOVE ASC-ODD-UNTS-N     TO ASC-ODD-UNTS-OLD.                 18190099
182000/                                                                 18200099
182100*----------------------------------------------------------------*18210099
182200*  THIS PARAGRAPH MOVES THE ENTERABLE SCEEN FIELDS               *18220099
182300*  BACK TO THE ORIGINAL STATUS                                   *18230099
182400*----------------------------------------------------------------*18240099
182500                                                                  18250099
182600 3550-MOVE-ORIG-SCREEN-FLDS.                                      18260099
182700                                                                  18270099
182800     MOVE ASC-RC-IPKS-CTN-OLD  TO ASC-RC-IPKS-CTN-N.              18280099
182900     MOVE ASC-DTL-PACK-QTY-OLD TO ASC-DTL-PACK-QTY-N.             18290099
183000     MOVE ASC-RTV-IND-OLD      TO ASC-RTV-IND.                    18300099
183100     MOVE ASC-ODD-UNTS-OLD     TO ASC-ODD-UNTS-N.                 18310099
183200/                                                                 18320099
183300*----------------------------------------------------------------*18330099
183400*  THIS PARAGRAPH BUILDS THE INITIAL SCREEN                      *18340099
183500*----------------------------------------------------------------*18350099
183600                                                                  18360099
183700 4000-BUILD-INITIAL-PANEL.                                        18370099
183800                                                                  18380099
183900     PERFORM 8000-SELECT-RECEIV.                                  18390099
184000     IF PS-RECEIV-FOUND                                           18400099
184100         CONTINUE                                                 18410099
184200     ELSE                                                         18420099
184300         MOVE PC-TSYMSG-00148      TO DP020-MSG-NUMBER            18430099
184400         SET DP020-MSG-FATAL       TO TRUE                        18440099
184500         SET DP020-NEXT-ACT-APPL-ERROR                            18450099
184600                                   TO TRUE                        18460099
184700         SET PS-ERROR              TO TRUE                        18470099
184800     END-IF.                                                      18480099
184900                                                                  18490099
185000* MOVE LOCATION NAME                                              18500099
185100     PERFORM 4010-GET-LOC-NAME.                                   18510099
185200                                                                  18520099
185300* MOVE VENDOR NAME                                                18530099
185400     PERFORM 4045-GET-VENDOR-NAME.                                18540099
185500                                                                  18550099
185600* MOVE PO INNER PACK FIELDS                                       18560099
185700     PERFORM 4050-GET-TPURCHS.                                    18570099
185800                                                                  18580099
185900* MOVE RC INNER AND DETAIL PACKS                                  18590099
186000     PERFORM 4070-GET-INNER-DTL-PACKS.                            18600099
186100                                                                  18610099
186200* MOVE RC UNITS PER INNNER PACK                                   18620099
186300     PERFORM 4055-CALC-UNT-PER-INPK.                              18630099
186400                                                                  18640099
186500* CALCULATE UNITS PER CTN                                         18650099
186600     IF ASC-PACK-TYP-CDE = 'M'                                    18660099
186700         PERFORM 4030-GET-UNTS-PER-CTN                            18670099
186800         MOVE PV-TOTAL-UNTS-PER-CTN                               18680099
186900                                   TO ASC-RC-UNTS-CTN-N.          18690099
187000     IF ASC-PACK-TYP-CDE = 'I'                                    18700099
187100         PERFORM 4064-SELECT-DRIVER-FOR-CTN                       18710099
187200         PERFORM 4065-SELECT-UNTS-PER-CTN.                        18720099
187300                                                                  18730099
187400* CALCULATE AND MOVE ODD UNITS                                    18740099
187500*    PERFORM 4063-CALC-ODD-UNTS-QTY.                              18750099
187600*    MOVE PV-TOTAL-ODD-UNIT-QTY    TO ASC-ODD-UNTS-N.             18760099
187700                                                                  18770099
187800* MOVE RTV INDICATOR                                              18780099
187900     PERFORM 4060-GET-RTV-IND.                                    18790099
188000     IF PV-DB2-COUNT > +0                                         18800099
188100         MOVE 'Y'                  TO ASC-RTV-IND                 18810099
188200     ELSE                                                         18820099
188300         MOVE 'N'                  TO ASC-RTV-IND                 18830099
188400     END-IF.                                                      18840099
188500                                                                  18850099
188600     IF PV-DB2-YEAR-TRSCP < 9999                                  18860099
188700         MOVE PV-DB2-MONTH-TRSCP   TO PV-MONTH                    18870099
188800         MOVE PV-DB2-DAY-TRSCP     TO PV-DAY                      18880099
188900         MOVE PV-DB2-YEAR-TRSCP    TO PV-YEAR                     18890099
189000         MOVE PV-DISPLAY-DATE      TO ASC-LAST-UPD-BY-DTE         18900099
189100         MOVE PV-DB2-HOUR-TRSCP    TO PV-HOUR                     18910099
189200         MOVE PV-DB2-MINUTE-TRSCP  TO PV-MINUTE                   18920099
189300         MOVE PV-DISPLAY-TIME      TO ASC-LAST-UPD-BY-TME         18930099
189400         MOVE RECEIV-UPD-UID       TO ASC-LAST-UPD-BY-UID         18940099
189500     ELSE                                                         18950099
189600         MOVE SPACES               TO ASC-LAST-UPD-BY-DTE         18960099
189700                                      ASC-LAST-UPD-BY-TME         18970099
189800                                      ASC-LAST-UPD-BY-UID         18980099
189900     END-IF.                                                      18990099
190000                                                                  19000099
190100* CREATED BY DATE/TIME/USER                                       19010099
190200     MOVE PV-DB2-MONTH             TO PV-MONTH.                   19020099
190300     MOVE PV-DB2-DAY               TO PV-DAY.                     19030099
190400     MOVE PV-DB2-YEAR              TO PV-YEAR.                    19040099
190500     MOVE PV-DISPLAY-DATE          TO ASC-CREATED-BY-DTE.         19050099
190600     MOVE PV-DB2-HOUR              TO PV-HOUR.                    19060099
190700     MOVE PV-DB2-MINUTE            TO PV-MINUTE                   19070099
190800     MOVE PV-DISPLAY-TIME          TO ASC-CREATED-BY-TME.         19080099
190900     MOVE RECEIV-CRE-UID           TO ASC-CREATED-BY-UID.         19090099
191000                                                                  19100099
191100                                                                  19110099
191200*  CONVERT STATUS CODE TO STATUS DESCRIPTION                      19120099
191300     PERFORM 4020-GET-STATUS-DESC.                                19130099
191400                                                                  19140099
191500*  MOVE TROUBLE REASON DESC                                       19150099
191600     PERFORM 6175-TRBL-PAK-DESC.                                  19160099
191700     IF ASC-PACKDESC-NO                                           19170099
191800         PERFORM 6180-TRBL-LNE-DESC                               19180099
191900     END-IF.                                                      19190099
192000                                                                  19200099
192100*  IF PF5(REFRESH) & PF2(CONFIRM) THEN MOVE CURR FLDS BACK        19210099
192200     IF ASC-REFRESH AND ASC-CONFIRM                               19220099
192300         CONTINUE                                                 19230099
192400     ELSE                                                         19240099
192500*  IF PF5(REFRESH) & PF19(BACK) THEN MOVE CURR FLDS BACK          19250099
192600         IF ASC-REFRESH AND ASC-PF19-YES                          19260099
192700             CONTINUE                                             19270099
192800         ELSE                                                     19280099
192900*  IF PF5(REFRESH) & PF20(FWD)  THEN MOVE CURR FLDS BACK          19290099
193000             IF ASC-REFRESH AND ASC-PF20-YES                      19300099
193100                 CONTINUE                                         19310099
193200             ELSE                                                 19320099
193300*  IF PF5(REFRESH) & NOT PF2, PF19 OR PF20 MOVE ORIG FLDS BACK    19330099
193400                 IF ASC-REFRESH                                   19340099
193500                     PERFORM 3550-MOVE-ORIG-SCREEN-FLDS           19350099
193600                 END-IF                                           19360099
193700             END-IF                                               19370099
193800         END-IF                                                   19380099
193900     END-IF.                                                      19390099
194000                                                                  19400099
194100*  MOVE COMMAREA FIELDS TO SCREEN                                 19410099
194200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        19420099
194300                                                                  19430099
194400*----------------------------------------------------------------*19440099
194500*  CALL XLKUT071 TO GET LOCATION NAME                            *19450099
194600*----------------------------------------------------------------*19460099
194700                                                                  19470099
194800 4010-GET-LOC-NAME.                                               19480099
194900     INITIALIZE XL071-COMMAREA-REC.                               19490099
195000                                                                  19500099
195100     MOVE ASC-KEY-OPER-UNT-ID   TO PV-UNPACK-OPER-UNT-ID.         19510099
195200     MOVE PV-UNPACK-OPER-UNT-ID TO XL071-LOCATION-NUMBER.         19520099
195300                                                                  19530099
195400                                                                  19540099
195500     CALL XL071-LOCATION-MODULE USING DFHEIBLK                    19550099
195600                                      XL071-COMMAREA              19560099
195700                                      XL071-COMMAREA-REC.         19570099
195800                                                                  19580099
195900     EVALUATE TRUE                                                19590099
196000         WHEN XL071-NO-ERRORS                                     19600099
196100             MOVE XL071-LOC-NM TO ASC-FCLTY-DESC                  19610099
196200                                  AFDESCO                         19620099
196300         WHEN XL071-LOC-NOT-FOUND                                 19630099
196400             SET PS-ERROR                                         19640099
196500                 DP020-MSG-FATAL   TO TRUE                        19650099
196600             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            19660099
196700             MOVE DP015-UNP-ALP-BRT-OFF TO AFCLTYA                19670099
196800             MOVE DP015-RED        TO AFCLTYC                     19680099
196900             MOVE DP015-REVERSE    TO AFCLTYH                     19690099
197000             MOVE -1               TO AFCLTYL                     19700099
197100             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  19710099
197200                                                                  19720099
197300         WHEN XL071-BAD-DB2-RETURN                                19730099
197400             MOVE '4010-GET-LOC-NAME'                             19740099
197500                               TO DP013-PARAGRAPH                 19750099
197600             MOVE 'SELECT LOCATION NAME'                          19760099
197700                               TO DP013-MESSAGE-TEXT (1)          19770099
197800             MOVE XL071-SQLCA  TO DP013-SQLCA                     19780099
197900             MOVE 'XLT_LOC'    TO DP013-DB2-TABLE-NAME (1)        19790099
198000             SET DP013-DB2-ABEND                                  19800099
198100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               19810099
198200             PERFORM DP013-0000-PROCESS-ABEND                     19820099
198300     END-EVALUATE.                                                19830099
198400                                                                  19840099
198500*----------------------------------------------------------------*19850099
198600*  SELECT THE STATUS CODE DESCRIPTION                            *19860099
198700*----------------------------------------------------------------*19870099
198800                                                                  19880099
198900 4020-GET-STATUS-DESC.                                            19890099
199000                                                                  19900099
199100     EXEC SQL                                                     19910099
199200        SELECT  STATUS_DESC                                       19920099
199300          INTO :STATCD-STATUS-DESC                                19930099
199400          FROM  TSTATCD                                           19940099
199500         WHERE  STATUS_CDE     = :ASC-RECEIV-STATUS-CDE           19950099
199600           AND  STATUS_TYP_CDE = :PC-R                            19960099
199700     END-EXEC.                                                    19970099
199800                                                                  19980099
199900     EVALUATE TRUE                                                19990099
200000         WHEN SQLCODE = +0                                        20000099
200100             MOVE STATCD-STATUS-DESC                              20010099
200200                               TO ASC-STATUS-DESC                 20020099
200300                                                                  20030099
200400         WHEN SQLCODE = +100                                      20040099
200500             MOVE RECEIV-STATUS-CDE                               20050099
200600                               TO ASC-STATUS-DESC                 20060099
200700                                                                  20070099
200800         WHEN SQLWARN0 NOT = SPACES                               20080099
200900         WHEN SQLCODE < +0                                        20090099
201000         WHEN SQLCODE > +0                                        20100099
201100             MOVE '4020-GET-STATUS-DESC'                          20110099
201200                               TO DP013-PARAGRAPH                 20120099
201300             MOVE 'SELECT STATUS DESC '                           20130099
201400                               TO DP013-MESSAGE-TEXT (1)          20140099
201500             MOVE SQLCA        TO DP013-SQLCA                     20150099
201600             MOVE 'TSTATCD'    TO DP013-DB2-TABLE-NAME (1)        20160099
201700             SET DP013-DB2-ABEND                                  20170099
201800                               TO TRUE                            20180099
201900             SET DP013-XCTL-DISPLAY-RESTART                       20190099
202000                               TO TRUE                            20200099
202100             PERFORM DP013-0000-PROCESS-ABEND                     20210099
202200     END-EVALUATE.                                                20220099
202300                                                                  20230099
202400*----------------------------------------------------------------*20240099
202500*  GET THE TOTAL UNITS PER CARTON                                *20250099
202600*----------------------------------------------------------------*20260099
202700                                                                  20270099
202800 4030-GET-UNTS-PER-CTN.                                           20280099
202900                                                                  20290099
203000     COMPUTE PV-TOTAL-UNTS-PER-CTN =                              20300099
203100         ASC-RC-UNTS-IPK-N * ASC-RC-IPKS-CTN-N.                   20310099
203200                                                                  20320099
203300*----------------------------------------------------------------*20330099
203400*    SELECT THE VENDOR NAME FIELD                                *20340099
203500*----------------------------------------------------------------*20350099
203600 4045-GET-VENDOR-NAME.                                            20360099
203700                                                                  20370099
203800     EXEC SQL                                                     20380099
203900          SELECT B.ENT_NAME_DESC                                  20390099
204000                                                                  20400099
204100            INTO :ENTNME-ENT-NAME-DESC                            20410099
204200                                                                  20420099
204300            FROM TPURCHS A                                        20430099
204400                ,TENTNME B                                        20440099
204500                                                                  20450099
204600           WHERE A.VER_STATUS_CDE  = :PC-ACTIVE                   20460099
204700             AND A.PO_NBR          = :DK-ORD-NBR                  20470099
204800             AND A.ENT_ID          = B.ENT_ID                     20480099
204900             AND B.TYPE_CDE        = :PC-01                       20490099
205000     END-EXEC                                                     20500099
205100                                                                  20510099
205200     EVALUATE TRUE                                                20520099
205300         WHEN SQLCODE = +0                                        20530099
205400             MOVE ENTNME-ENT-NAME-DESC                            20540099
205500                            TO ASC-VEND-NAME                      20550099
205600         WHEN SQLCODE = +100                                      20560099
205700             MOVE SPACE     TO ASC-VEND-NAME                      20570099
205800                                                                  20580099
205900         WHEN SQLCODE = -904                                      20590099
206000         WHEN SQLCODE = -913                                      20600099
206100             CONTINUE                                             20610099
206200         WHEN SQLWARN0 NOT = SPACE                                20620099
206300         WHEN SQLCODE < +0                                        20630099
206400         WHEN SQLCODE > +0                                        20640099
206500             MOVE '4045-GET-VENDOR-NAME'                          20650099
206600                            TO DP013-PARAGRAPH                    20660099
206700             MOVE 'SELECT VENDOR NAME'                            20670099
206800                            TO DP013-MESSAGE-TEXT (1)             20680099
206900             MOVE SQLCA     TO DP013-SQLCA                        20690099
207000             MOVE 'TENTNME' TO DP013-DB2-TABLE-NAME (1)           20700099
207100             SET DP013-DB2-ABEND                                  20710099
207200                            TO TRUE                               20720099
207300             SET DP013-XCTL-DISPLAY-RESTART                       20730099
207400                            TO TRUE                               20740099
207500             PERFORM DP013-0000-PROCESS-ABEND                     20750099
207600     END-EVALUATE.                                                20760099
207700                                                                  20770099
207800*----------------------------------------------------------------*20780099
207900*    SELECT THE PURCHASE ORDER AND INNR PACK FIELDS              *20790099
208000*----------------------------------------------------------------*20800099
208100 4050-GET-TPURCHS.                                                20810099
208200     MOVE ASC-PACK-ID      TO DK-PACK-ID.                         20820099
208300                                                                  20830099
208400     EXEC SQL                                                     20840099
208500          SELECT A.PO_NBR                                         20850099
208600                ,A.DEPT_NBR                                       20860099
208700                ,A.PKGNG_CDE                                      20870099
208800                ,B.OTPK_UNT_QTY                                   20880099
208900                ,B.INPK_UNT_QTY                                   20890099
209000                ,B.INPK_CNVYB_IND                                 20900099
209100                ,B.PREPK_DESC                                     20910099
209200            INTO :PURCHS-PO-NBR                                   20920099
209300                ,:PURCHS-DEPT-NBR                                 20930099
209400                ,:PURCHS-PKGNG-CDE                                20940099
209500                ,:POPRPK-OTPK-UNT-QTY                             20950099
209600                ,:POPRPK-INPK-UNT-QTY                             20960099
209700                ,:POPRPK-INPK-CNVYB-IND                           20970099
209800                ,:POPRPK-PREPK-DESC                               20980099
209900            FROM TPURCHS A                                        20990099
210000                ,TPOPRPK B                                        21000099
210100           WHERE A.PO_NBR         = :DK-ORD-NBR                   21010099
210200             AND A.VER_STATUS_CDE = :PC-ACTIVE                    21020099
210300             AND B.PO_NBR         = A.PO_NBR                      21030099
210400             AND B.PO_PREPK_ID    = :DK-PACK-ID                   21040099
210500     END-EXEC.                                                    21050099
210600                                                                  21060099
210700     EVALUATE TRUE                                                21070099
210800         WHEN SQLCODE = +0                                        21080099
210900              MOVE PURCHS-DEPT-NBR                                21090099
211000                               TO ASC-DEPT-NBR                    21100099
211100              MOVE POPRPK-PREPK-DESC                              21110099
211200                               TO ASC-PACK-DESC                   21120099
211300              MOVE POPRPK-INPK-UNT-QTY                            21130099
211400                               TO ASC-PO-UNTS-IPK-N               21140099
211500              MOVE POPRPK-INPK-CNVYB-IND                          21150099
211600                               TO ASC-CNVYB-INPK-IND              21160099
211700              MOVE POPRPK-OTPK-UNT-QTY                            21170099
211800                               TO ASC-PO-UNTS-CTN-N               21180099
211900              PERFORM 4060-CALC-INPKS-PERCTN                      21190099
212000              MOVE PV-INPK-CTN-QTY                                21200099
212100                               TO ASC-PO-IPKS-CTN-N               21210099
212200         WHEN SQLCODE = +100                                      21220099
212300              MOVE +0          TO ASC-PO-UNTS-IPK-N               21230099
212400                                  ASC-PO-IPKS-CTN-N               21240099
212500                                  ASC-PO-UNTS-CTN-N               21250099
212600         WHEN SQLWARN0 NOT = SPACES                               21260099
212700         WHEN SQLCODE < +0                                        21270099
212800         WHEN SQLCODE > +0                                        21280099
212900              MOVE '4050-GET-TPURCHS'                             21290099
213000                               TO DP013-PARAGRAPH                 21300099
213100              MOVE 'UNSUCCESSFUL SELECT ON TPURCHS'               21310099
213200                               TO DP013-MESSAGE-TEXT (1)          21320099
213300              MOVE SQLCA       TO DP013-SQLCA                     21330099
213400              MOVE 'TPURCHS '  TO DP013-DB2-TABLE-NAME (1)        21340099
213500              SET DP013-DB2-ABEND                                 21350099
213600                  DP013-XCTL-DISPLAY-RESTART                      21360099
213700                               TO TRUE                            21370099
213800              PERFORM DP013-0000-PROCESS-ABEND                    21380099
213900     END-EVALUATE.                                                21390099
214000                                                                  21400099
214100*----------------------------------------------------------------*21410099
214200*    SUMM THE QTY OF THE PREPACK RATIO                           *21420099
214300*----------------------------------------------------------------*21430099
214400 4055-CALC-UNT-PER-INPK.                                          21440099
214500                                                                  21450099
214600     EXEC SQL                                                     21460099
214700         SELECT                                                   21470099
214800             SUM(PREPK_RATO_QTY)                                  21480099
214900         INTO                                                     21490099
215000             :PV-TOTAL-PREPK-RATO-QTY :PV-NULL-IND                21500099
215100         FROM TRECITM                                             21510099
215200         WHERE   ORD_NBR        = :DK-ORD-NBR                     21520099
215300             AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                 21530099
215400             AND PREPK_ID       = :DK-PACK-ID                     21540099
215500             AND OPER_UNT_ID    = :DK-OPR-ID                      21550099
215600             AND FCLTY_ID       = :DK-FACT                        21560099
215700             AND PREPK_RATO_QTY > 0                               21570099
215800             AND VER_STATUS_CDE = 'A'                             21580099
215900     END-EXEC                                                     21590099
216000                                                                  21600099
216100     EVALUATE TRUE                                                21610099
216200         WHEN SQLCODE = +0                                        21620099
216300             MOVE PV-TOTAL-PREPK-RATO-QTY                         21630099
216400                             TO ASC-RC-UNTS-IPK-N                 21640099
216500         WHEN SQLCODE = +100                                      21650099
216600             CONTINUE                                             21660099
216700         WHEN SQLWARN0 NOT = SPACES                               21670099
216800         WHEN SQLCODE < +0                                        21680099
216900         WHEN SQLCODE > +0                                        21690099
217000             MOVE '4055-CALC-UNT-PER-INPK'                        21700099
217100                             TO DP013-PARAGRAPH                   21710099
217200             MOVE 'SELECT TRECITM'                                21720099
217300                             TO DP013-MESSAGE-TEXT (1)            21730099
217400             MOVE SQLCA      TO DP013-SQLCA                       21740099
217500             MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME (1)          21750099
217600             SET DP013-DB2-ABEND                                  21760099
217700                             TO TRUE                              21770099
217800             SET DP013-XCTL-DISPLAY-RESTART                       21780099
217900                             TO TRUE                              21790099
218000             PERFORM DP013-0000-PROCESS-ABEND                     21800099
218100     END-EVALUATE.                                                21810099
218200                                                                  21820099
218300*----------------------------------------------------------------*21830099
218400*    SUMM THE QTY OF THE PREPACK RATIO                           *21840099
218500*----------------------------------------------------------------*21850099
218600 4060-GET-RTV-IND.                                                21860099
218700                                                                  21870099
218800     MOVE ZERO TO PV-DB2-COUNT.                                   21880099
218900     EXEC SQL                                                     21890099
219000         SELECT COUNT(*)                                          21900099
219100         INTO :PV-DB2-COUNT  :PV-NULL-IND                         21910099
219200         FROM TRECITM                                             21920099
219300         WHERE   ORD_NBR        = :DK-ORD-NBR                     21930099
219400             AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                 21940099
219500             AND PREPK_ID       = :DK-PACK-ID                     21950099
219600             AND OPER_UNT_ID    = :DK-OPR-ID                      21960099
219700             AND FCLTY_ID       = :DK-FACT                        21970099
219800             AND VER_STATUS_CDE = 'A'                             21980099
219900             AND RTV_IND        = 'Y'                             21990099
220000     END-EXEC                                                     22000099
220100                                                                  22010099
220200     EVALUATE TRUE                                                22020099
220300         WHEN SQLCODE = +0                                        22030099
220400         WHEN SQLCODE = +100                                      22040099
220500             CONTINUE                                             22050099
220600         WHEN SQLWARN0 NOT = SPACES                               22060099
220700         WHEN SQLCODE < +0                                        22070099
220800         WHEN SQLCODE > +0                                        22080099
220900             MOVE '4060-GET-RTV-IND'                              22090099
221000                             TO DP013-PARAGRAPH                   22100099
221100             MOVE 'UNSUCCESSFUL SELECT RTV IND COUNT'             22110099
221200                             TO DP013-MESSAGE-TEXT (1)            22120099
221300             MOVE SQLCA      TO DP013-SQLCA                       22130099
221400             MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME (1)          22140099
221500             SET DP013-DB2-ABEND                                  22150099
221600                             TO TRUE                              22160099
221700             SET DP013-XCTL-DISPLAY-RESTART                       22170099
221800                             TO TRUE                              22180099
221900             PERFORM DP013-0000-PROCESS-ABEND                     22190099
222000     END-EVALUATE.                                                22200099
222100/                                                                 22210099
222200*----------------------------------------------------------------*22220099
222300*    CALCULATE THE NUMBER OF INNER PACKS PER CARTON              *22230099
222400*----------------------------------------------------------------*22240099
222500 4060-CALC-INPKS-PERCTN.                                          22250099
222600     IF POPRPK-OTPK-UNT-QTY > 0 AND                               22260099
222700        POPRPK-INPK-UNT-QTY > 0                                   22270099
222800           COMPUTE PV-INPK-CTN-QTY = POPRPK-OTPK-UNT-QTY          22280099
222900                             / POPRPK-INPK-UNT-QTY                22290099
223000     ELSE                                                         22300099
223100        MOVE ZEROS TO PV-INPK-CTN-QTY                             22310099
223200     END-IF                                                       22320099
223300                                                                  22330099
223400     IF PV-INPK-CTN-QTY = ZERO                                    22340099
223500         ADD 1 TO PV-INPK-CTN-QTY                                 22350099
223600     END-IF.                                                      22360099
223700*----------------------------------------------------------------*22370099
223800*    CALCULATE THE ODD UNITS QTY                                 *22380099
223900*----------------------------------------------------------------*22390099
224000 4063-CALC-ODD-UNTS-QTY.                                          22400099
224100                                                                  22410099
224200     EXEC SQL                                                     22420099
224300         SELECT DISTINCT                                          22430099
224400             SUM (A.PREPK_ODD_UNT_QTY)                            22440099
224500         INTO                                                     22450099
224600             :PV-TOTAL-ODD-UNIT-QTY   :PV-NULL-IND                22460099
224700         FROM TRECITM A                                           22470099
224800        WHERE A.ORD_NBR           = :DK-ORD-NBR                   22480099
224900          AND A.REC_SEQ_NBR       = :DK-REC-SEQ-NBR               22490099
225000          AND A.PREPK_ID          = :DK-PACK-ID                   22500099
225100          AND A.OPER_UNT_ID       = :DK-OPR-ID                    22510099
225200          AND A.FCLTY_ID          = :DK-FACT                      22520099
225300          AND A.VER_STATUS_CDE    = 'A'                           22530099
225400     END-EXEC                                                     22540099
225500                                                                  22550099
225600     EVALUATE TRUE                                                22560099
225700         WHEN SQLCODE = ZERO                                      22570099
225800              CONTINUE                                            22580099
225900         WHEN SQLCODE = -904                                      22590099
226000         WHEN SQLCODE = -911                                      22600099
226100         WHEN SQLCODE = -913                                      22610099
226200              PERFORM 9900-SOFT-ABORT                             22620099
226300         WHEN SQLCODE = +100                                      22630099
226400         WHEN SQLCODE = -305                                      22640099
226500              MOVE +0  TO PV-TOTAL-ODD-UNIT-QTY                   22650099
226600         WHEN SQLWARN0 NOT EQUAL SPACE                            22660099
226700         WHEN SQLCODE NOT EQUAL ZERO                              22670099
226800              MOVE '4063-CALC-ODD-UNTS-QTY'                       22680099
226900                           TO DP013-PARAGRAPH                     22690099
227000              MOVE 'SELECT TRECITM'                               22700099
227100                           TO DP013-MESSAGE-TEXT (1)              22710099
227200              MOVE SQLCA   TO DP013-SQLCA                         22720099
227300              SET DP013-DB2-ABEND                                 22730099
227400                           TO TRUE                                22740099
227500              PERFORM DP013-0000-PROCESS-ABEND                    22750099
227600     END-EVALUATE.                                                22760099
227700                                                                  22770099
227800*----------------------------------------------------------------*22780099
227900*    SELECT THE DRIVER LINE FOR RECEIVER UNITS PER CTN           *22790099
228000*----------------------------------------------------------------*22800099
228100 4064-SELECT-DRIVER-FOR-CTN.                                      22810099
228200                                                                  22820099
228300     EXEC SQL                                                     22830099
228400         SELECT                                                   22840099
228500            CASE_PACK_QTY                                         22850099
228600         INTO                                                     22860099
228700            :PV-TOTAL-CASE-PACK-QTY                               22870099
228800         FROM TRECITM                                             22880099
228900         WHERE   ORD_NBR        = :DK-ORD-NBR                     22890099
229000             AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                 22900099
229100             AND PREPK_ID       = :DK-PACK-ID                     22910099
229200             AND OPER_UNT_ID    = :DK-OPR-ID                      22920099
229300             AND FCLTY_ID       = :DK-FACT                        22930099
229400             AND VER_STATUS_CDE = 'A'                             22940099
229500             AND PREPK_DRV_LNE_CDE = 'A'                          22950099
229600     END-EXEC                                                     22960099
229700                                                                  22970099
229800     EVALUATE TRUE                                                22980099
229900         WHEN SQLCODE = +0                                        22990099
230000         WHEN SQLCODE = +100                                      23000099
230100             CONTINUE                                             23010099
230200         WHEN SQLWARN0 NOT = SPACES                               23020099
230300         WHEN SQLCODE < +0                                        23030099
230400         WHEN SQLCODE > +0                                        23040099
230500             MOVE '4064-SELECT-DRIVER-FOR-CTN'                    23050099
230600                             TO DP013-PARAGRAPH                   23060099
230700             MOVE 'SELECT TRECITM'                                23070099
230800                             TO DP013-MESSAGE-TEXT (1)            23080099
230900             MOVE SQLCA      TO DP013-SQLCA                       23090099
231000             MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME (1)          23100099
231100             SET DP013-DB2-ABEND                                  23110099
231200                             TO TRUE                              23120099
231300             SET DP013-XCTL-DISPLAY-RESTART                       23130099
231400                             TO TRUE                              23140099
231500             PERFORM DP013-0000-PROCESS-ABEND                     23150099
231600     END-EVALUATE.                                                23160099
231700                                                                  23170099
231800                                                                  23180099
231900*----------------------------------------------------------------*23190099
232000*    SELECT THE UNTS PER CTN FOR RECEIVER                        *23200099
232100*----------------------------------------------------------------*23210099
232200 4065-SELECT-UNTS-PER-CTN.                                        23220099
232300                                                                  23230099
232400     EXEC SQL                                                     23240099
232500         SELECT                                                   23250099
232600            SUM(PREPK_RATO_QTY)                                   23260099
232700         INTO                                                     23270099
232800            :PV-TOTAL-PREPK-RATO-QTY :PV-NULL-IND                 23280099
232900         FROM TRECITM                                             23290099
233000         WHERE   ORD_NBR        = :DK-ORD-NBR                     23300099
233100             AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                 23310099
233200             AND PREPK_ID       = :DK-PACK-ID                     23320099
233300             AND OPER_UNT_ID    = :DK-OPR-ID                      23330099
233400             AND FCLTY_ID       = :DK-FACT                        23340099
233500             AND VER_STATUS_CDE = 'A'                             23350099
233600     END-EXEC                                                     23360099
233700                                                                  23370099
233800     EVALUATE TRUE                                                23380099
233900         WHEN SQLCODE = +0                                        23390099
234000             PERFORM 4066-CALC-UNTS-PER-CTN                       23400099
234100             MOVE PV-TOTAL-UNTS-PER-CTN                           23410099
234200                             TO ASC-RC-UNTS-CTN-N                 23420099
234300         WHEN SQLCODE = +100                                      23430099
234400             CONTINUE                                             23440099
234500         WHEN SQLWARN0 NOT = SPACES                               23450099
234600         WHEN SQLCODE < +0                                        23460099
234700         WHEN SQLCODE > +0                                        23470099
234800             MOVE '4065-SELECT-UNTS-PER-CTN'                      23480099
234900                             TO DP013-PARAGRAPH                   23490099
235000             MOVE 'SELECT TRECITM'                                23500099
235100                             TO DP013-MESSAGE-TEXT (1)            23510099
235200             MOVE SQLCA      TO DP013-SQLCA                       23520099
235300             MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME (1)          23530099
235400             SET DP013-DB2-ABEND                                  23540099
235500                             TO TRUE                              23550099
235600             SET DP013-XCTL-DISPLAY-RESTART                       23560099
235700                             TO TRUE                              23570099
235800             PERFORM DP013-0000-PROCESS-ABEND                     23580099
235900     END-EVALUATE.                                                23590099
236000                                                                  23600099
236100/                                                                 23610099
236200*----------------------------------------------------------------*23620099
236300*    CALCULATE THE NUMBER OF UNITS PER CARTON                    *23630099
236400*----------------------------------------------------------------*23640099
236500 4066-CALC-UNTS-PER-CTN.                                          23650099
236600     COMPUTE PV-TOTAL-UNTS-PER-CTN =                              23660099
236700         PV-TOTAL-CASE-PACK-QTY * PV-TOTAL-PREPK-RATO-QTY.        23670099
236800                                                                  23680099
236900*----------------------------------------------------------------*23690099
237000*    SELECT THE # OF INNER AND DTL PACKS PER RECEIVER            *23700099
237100*----------------------------------------------------------------*23710099
237200 4070-GET-INNER-DTL-PACKS.                                        23720099
237300                                                                  23730099
237400     EXEC SQL                                                     23740099
237500         SELECT                                                   23750099
237600            CASE_PACK_QTY                                         23760099
237700           ,DTL_CK_ITM_QTY                                        23770099
237800           ,PREPK_RATO_QTY                                        23780099
237900         INTO                                                     23790099
238000            :PV-CASE-PACK-QTY                                     23800099
238100           ,:RECITM-DTL-CK-ITM-QTY                                23810099
238200           ,:RECITM-PREPK-RATO-QTY                                23820099
238300         FROM TRECITM                                             23830099
238400         WHERE   ORD_NBR        = :DK-ORD-NBR                     23840099
238500             AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                 23850099
238600             AND PREPK_ID       = :DK-PACK-ID                     23860099
238700             AND OPER_UNT_ID    = :DK-OPR-ID                      23870099
238800             AND FCLTY_ID       = :DK-FACT                        23880099
238900             AND VER_STATUS_CDE = 'A'                             23890099
239000             AND PREPK_DRV_LNE_CDE = 'A'                          23900099
239100     END-EXEC                                                     23910099
239200                                                                  23920099
239300     EVALUATE TRUE                                                23930099
239400         WHEN SQLCODE = +0                                        23940099
239500             PERFORM 5299-CALC-TOTAL-NBR-PACKS                    23950099
239600             MOVE PV-CASE-PACK-QTY    TO ASC-RC-IPKS-CTN-N        23960099
239700             MOVE PV-DTL-CHK-ITM-QTY  TO ASC-DTL-PACK-QTY-N       23970099
239800         WHEN SQLCODE = +100                                      23980099
239900             MOVE +0                  TO ASC-RC-IPKS-CTN-N        23990099
240000             MOVE +0                  TO ASC-DTL-PACK-QTY-N       24000099
240100                                                                  24010099
240200         WHEN SQLWARN0 NOT = SPACES                               24020099
240300         WHEN SQLCODE < +0                                        24030099
240400         WHEN SQLCODE > +0                                        24040099
240500             MOVE '4070-GET-INNER-DTL-PACKS'                      24050099
240600                             TO DP013-PARAGRAPH                   24060099
240700             MOVE 'SELECT TRECITM'                                24070099
240800                             TO DP013-MESSAGE-TEXT (1)            24080099
240900             MOVE SQLCA      TO DP013-SQLCA                       24090099
241000             MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME (1)          24100099
241100             SET DP013-DB2-ABEND                                  24110099
241200                             TO TRUE                              24120099
241300             SET DP013-XCTL-DISPLAY-RESTART                       24130099
241400                             TO TRUE                              24140099
241500             PERFORM DP013-0000-PROCESS-ABEND                     24150099
241600     END-EVALUATE.                                                24160099
241700                                                                  24170099
241800/                                                                 24180099
241900*----------------------------------------------------------------*24190099
242000*    DEPENDING ON WHAT WAS PASSED IN THE COMMAREA, SETUP THE     *24200099
242100*    DB2 KEYS                                                    *24210099
242200*----------------------------------------------------------------*24220099
242300 4100-PREPARE-CURSOR.                                             24230099
242400                                                                  24240099
242500     MOVE ASC-ORD-NBR      TO DK-ORD-NBR.                         24250099
242600     MOVE ASC-REC-SEQ-NBR  TO DK-REC-SEQ-NBR.                     24260099
242700     MOVE ASC-OPER-UNT-ID  TO DK-OPR-ID.                          24270099
242800     MOVE ASC-FCLTY-ID     TO DK-FACT.                            24280099
242900     MOVE ASC-PACK-ID      TO DK-PACK-ID.                         24290099
243000                                                                  24300099
243100/                                                                 24310099
243200*----------------------------------------------------------------*24320099
243300*    CHECK FOR CHANGES ON ENTERABLE FIELDS                       *24330099
243400*----------------------------------------------------------------*24340099
243500 4200-CHK-FOR-NO-CHANGES.                                         24350099
243600     IF (ASC-RC-IPKS-CTN-N = ASC-RC-IPKS-CTN-OLD)                 24360099
243700         AND                                                      24370099
243800           (ASC-DTL-PACK-QTY-N = ASC-DTL-PACK-QTY-OLD)            24380099
243900         AND                                                      24390099
244000           (ASC-RTV-IND = ASC-RTV-IND-OLD)                        24400099
244100                SET ASC-NOT-CHANGED                               24410099
244200                                 TO TRUE                          24420099
244300     END-IF.                                                      24430099
244400/                                                                 24440099
244500*----------------------------------------------------------------*24450099
244600*    CHECK TO SEE IF PO/RCVR/LINE HAS BEEN PROCESSED THROUGH     *24460099
244700*    CASEPACK SPLIT PROCESS                                      *24470099
244800*----------------------------------------------------------------*24480099
244900 4350-CK-CASEPACK-SPLIT-PROCESS.                                  24490099
245000                                                                  24500099
245100     MOVE ASC-PACK-ID    TO DK-PACK-ID.                           24510099
245200                                                                  24520099
245300     EXEC SQL                                                     24530099
245400          SELECT                                                  24540099
245500                COUNT(*)                                          24550099
245600          INTO    :PV-TOTAL-CASEPACK    :PV-NULL-IND              24560099
245700          FROM  TRECITM A                                         24570099
245800               ,TDISTHD B                                         24580099
245900          WHERE A.ORD_NBR         = :ASC-ORD-NBR                  24590099
246000            AND A.REC_SEQ_NBR     = :ASC-REC-SEQ-NBR              24600099
246100            AND A.PREPK_ID        = :DK-PACK-ID                   24610099
246400            AND B.ORD_NBR         = A.ORD_NBR                     24640099
246500            AND B.RCVR_SEQ_NBR    = A.REC_SEQ_NBR                 24650099
246600            AND B.ORD_LNE_NBR     = A.ORD_LNE_NBR                 24660099
246700            AND B.TOT_CART_CNT    > +0                            24670099
246800     END-EXEC.                                                    24680099
246900                                                                  24690099
247000     EVALUATE TRUE                                                24700099
247100         WHEN SQLCODE = +0                                        24710099
247200              IF PV-TOTAL-CASEPACK > 0                            24720099
247300                  SET ASC-CASEPACK-YES    TO TRUE                 24730099
247400              ELSE                                                24740099
247500                  SET ASC-CASEPACK-NO     TO TRUE                 24750099
247600              END-IF                                              24760099
247700         WHEN SQLCODE = +100                                      24770099
247800              SET ASC-CASEPACK-NO         TO TRUE                 24780099
247900         WHEN SQLCODE = -904                                      24790099
248000         WHEN SQLCODE = -911                                      24800099
248100         WHEN SQLCODE = -913                                      24810099
248200              PERFORM 9900-SOFT-ABORT                             24820099
248300         WHEN SQLWARN0 NOT = SPACES                               24830099
248400         WHEN SQLCODE < +0                                        24840099
248500         WHEN SQLCODE > +0                                        24850099
248600              MOVE '4350-CK-CASEPACK-SPLIT-PROCESS'               24860099
248700                              TO DP013-PARAGRAPH                  24870099
248800              MOVE 'UNSUCCESSFUL SELECT ON TDISTHD'               24880099
248900                              TO DP013-MESSAGE-TEXT (1)           24890099
249000              MOVE SQLCA      TO DP013-SQLCA                      24900099
249100              MOVE 'TDISTHD ' TO DP013-DB2-TABLE-NAME (1)         24910099
249200              SET DP013-DB2-ABEND                                 24920099
249300                  DP013-XCTL-DISPLAY-RESTART                      24930099
249400                              TO TRUE                             24940099
249500              PERFORM DP013-0000-PROCESS-ABEND                    24950099
249600     END-EVALUATE.                                                24960099
249700/                                                                 24970099
249800*----------------------------------------------------------------*24980099
249900*    RESTORE THE DATA ON THE SCREEN FROM THE COMMAREA.           *24990099
250000*----------------------------------------------------------------*25000099
250100 4400-MOVE-COMMAREA-TO-SCREEN.                                    25010099
250200                                                                  25020099
250300     MOVE ASC-OPER-UNT-ID          TO AOPERO.                     25030099
250400     MOVE ASC-FCLTY-ID             TO AFCLTYO.                    25040099
250500     MOVE ASC-FCLTY-DESC           TO AFDESCO.                    25050099
250600     MOVE ASC-ORD-NBR              TO PV-ORD.                     25060099
250700     MOVE PC-DASH                  TO PV-DASH.                    25070099
250800     MOVE ASC-REC-SEQ-NBR          TO PV-REC.                     25080099
250900     MOVE PV-RECEIVER              TO ARCVRO.                     25090099
251000     MOVE ASC-CREATED-BY-UID       TO ACRTBYO.                    25100099
251100     MOVE ASC-CREATED-BY-DTE       TO ACRTDTEO.                   25110099
251200     MOVE ASC-CREATED-BY-TME       TO ACRTTMEO.                   25120099
251300     MOVE ASC-LAST-UPD-BY-UID      TO ALSTBYO.                    25130099
251400     MOVE ASC-LAST-UPD-BY-DTE      TO ALSTDTEO.                   25140099
251500     MOVE ASC-LAST-UPD-BY-TME      TO ALSTTMEO.                   25150099
251600     MOVE ASC-VEND-NAME            TO AVNNAMEO.                   25160099
251700     MOVE ASC-DEPT-NBR             TO ADEPTNOO.                   25170099
251800     MOVE ASC-PACK-ID              TO APKIDO.                     25180099
251900     MOVE ASC-STATUS-DESC          TO ASTUSO.                     25190099
252000     MOVE ASC-TROUBLE-DESC         TO ATRBLO.                     25200099
252100*    MOVE ASC-PACK-TYP-CDE         TO APKGCDEO.                   25210099
252200     MOVE ASC-PACK-TYP-DESC        TO APKGDSCO.                   25220099
252300     MOVE ASC-PACK-DESC            TO APKDESCO.                   25230099
252400     MOVE ASC-PO-UNTS-CTN-N        TO AUNSCTNO.                   25240099
252500     MOVE ASC-RC-UNTS-CTN-N        TO AUNTCTNO.                   25250099
252600     MOVE ASC-PO-UNTS-IPK-N        TO AUNTIPKO.                   25260099
252700     MOVE ASC-RC-UNTS-IPK-N        TO AUNSIPKO.                   25270099
252800     MOVE ASC-PO-IPKS-CTN-N        TO APOPKCTO.                   25280099
252900     MOVE ASC-RC-IPKS-CTN-N        TO ARCPKCTO.                   25290099
253000     MOVE ASC-PACK-OTR-QTY-N       TO APKOTRO.                    25300099
253100     MOVE ASC-PKSL-PACK-QTY-N      TO APSLPKSO.                   25310099
253200     MOVE ASC-DTL-PACK-QTY-N       TO ADTLPKSO.                   25320099
253300     MOVE ASC-ODD-UNTS-N           TO AODDUNTO.                   25330099
253400     MOVE ASC-CNVYB-INPK-IND       TO ACNVPKSO.                   25340099
253500     MOVE ASC-RTV-IND              TO ARTVINDO.                   25350099
253600                                                                  25360099
253700/                                                                 25370099
253800*----------------------------------------------------------------*25380099
253900*    PERFORM UPDATE RECEIPT ITEM PROCESSING                      *25390099
254000*----------------------------------------------------------------*25400099
254100 5200-UPDATE-RECITM.                                              25410099
254200                                                                  25420099
254300* CHECK IF ADJUSTMENTS WERE MADE TO VERIFIED QTY                  25430099
254400     PERFORM 5205-CHECK-DISTR-UPD-CDE.                            25440099
254500     IF PV-DB2-COUNT > +0                                         25450099
254600         MOVE PC-TSYMSG-01256    TO DP020-MSG-NUMBER              25460099
254700         SET DP020-MSG-INFORMATIONAL                              25470099
254800                                 TO TRUE                          25480099
254900     ELSE                                                         25490099
255000* UPDATE DETAIL NUMBER OF PACKS AND RECALCULATE                   25500099
255100         IF (ASC-UPDATE-PENDING OR ASC-DTL-PACK-QTY-N = ZERO)     25510099
255200             PERFORM 5210-OPEN-TRECITM-CURSOR                     25520099
255300             IF PS-RECITM-CSR-OPEN                                25530099
255400                 PERFORM 5250-FETCH-TRECITM                       25540099
255500                     UNTIL PS-EOF-RECITM                          25550099
255600                 PERFORM 5290-CLOSE-TRECITM-CURSOR                25560099
255700                 PERFORM 5295-SELECT-TRECITM-DRIVER               25570099
255800* UPDATE QUEUE                                                    25580099
255900                 IF  ASC-USE-SELECTION-QUEUE                      25590099
256000                     PERFORM 5300-UPDATE-SELECTION-QUEUE          25600099
256100                 END-IF                                           25610099
256200             END-IF                                               25620099
256300         ELSE                                                     25630099
256400                                                                  25640099
256500* SET UPDATE PENDING MESSAGE SWITCH                               25650099
256600             SET ASC-UPDATE-PENDING      TO TRUE                  25660099
256700         END-IF                                                   25670099
256800     END-IF.                                                      25680099
256900/                                                                 25690099
257000*----------------------------------------------------------------*25700099
257100*    CHECK DISTR UPD CODE FOR 'A' OR 'U'                         *25710099
257200*----------------------------------------------------------------*25720099
257300 5205-CHECK-DISTR-UPD-CDE.                                        25730099
257400     MOVE ZERO TO PV-DB2-COUNT.                                   25740099
257500     EXEC SQL                                                     25750099
257600         SELECT COUNT(*)                                          25760099
257700         INTO  :PV-DB2-COUNT  :PV-NULL-IND                        25770099
257800         FROM  TRECITM                                            25780099
257900         WHERE ORD_NBR             = :DK-ORD-NBR                  25790099
258000               AND REC_SEQ_NBR     = :DK-REC-SEQ-NBR              25800099
258100               AND OPER_UNT_ID     = :DK-OPR-ID                   25810099
258200               AND FCLTY_ID        = :DK-FACT                     25820099
258300               AND PREPK_ID        = :DK-PACK-ID                  25830099
258400               AND PREPK_RATO_QTY  > 0                            25840099
258500               AND VER_STATUS_CDE  = 'A'                          25850099
258600               AND (RCPT_DISTR_UPD_CDE = :PC-A                    25860099
258700                 OR RCPT_DISTR_UPD_CDE = :PC-U)                   25870099
258800     END-EXEC                                                     25880099
258900                                                                  25890099
259000     EVALUATE TRUE                                                25900099
259100         WHEN SQLCODE = +0                                        25910099
259200         WHEN SQLCODE = +100                                      25920099
259300             CONTINUE                                             25930099
259400         WHEN SQLWARN0 NOT = SPACES                               25940099
259500         WHEN SQLCODE < +0                                        25950099
259600         WHEN SQLCODE > +0                                        25960099
259700             MOVE '5205-CHECK-DISTR-UPD-CDE'                      25970099
259800                         TO DP013-PARAGRAPH                       25980099
259900             MOVE 'UNSUCCESSFUL SELECT DISTR CDE COUNT'           25990099
260000                         TO DP013-MESSAGE-TEXT (1)                26000099
260100             MOVE SQLCA  TO DP013-SQLCA                           26010099
260200             MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME (1)          26020099
260300             SET DP013-DB2-ABEND                                  26030099
260400                 DP013-XCTL-DISPLAY-RESTART                       26040099
260500                             TO TRUE                              26050099
260600             PERFORM DP013-0000-PROCESS-ABEND                     26060099
260700     END-EVALUATE.                                                26070099
260800                                                                  26080099
260900/                                                                 26090099
261000*----------------------------------------------------------------*26100099
261100*    OPEN THE TRECITM CURSOR                                     *26110099
261200*----------------------------------------------------------------*26120099
261300 5210-OPEN-TRECITM-CURSOR.                                        26130099
261400     EXEC SQL                                                     26140099
261500         OPEN TRECITM-CSR                                         26150099
261600     END-EXEC                                                     26160099
261700                                                                  26170099
261800     EVALUATE TRUE                                                26180099
261900         WHEN SQLCODE = +0                                        26190099
262000              SET PS-RECITM-CSR-OPEN TO TRUE                      26200099
262100                                                                  26210099
262200         WHEN SQLWARN0 NOT = SPACES                               26220099
262300         WHEN SQLCODE  NOT = ZERO                                 26230099
262400              SET PS-RECITM-CSR-CLOSED TO TRUE                    26240099
262500              MOVE '5210-OPEN-TRECITM-CSR'                        26250099
262600                               TO DP013-PARAGRAPH                 26260099
262700              MOVE 'UNSUCCESSFUL OPEN TRECITM CSR'                26270099
262800                               TO DP013-MESSAGE-TEXT (1)          26280099
262900              MOVE SQLCA       TO DP013-SQLCA                     26290099
263000              MOVE 'TRECITM'   TO DP013-DB2-TABLE-NAME (1)        26300099
263100              SET DP013-DB2-ABEND                                 26310099
263200                  DP013-XCTL-DISPLAY-RESTART                      26320099
263300                               TO TRUE                            26330099
263400         PERFORM DP013-0000-PROCESS-ABEND                         26340099
263500     END-EVALUATE.                                                26350099
263600                                                                  26360099
263700/                                                                 26370099
263800*----------------------------------------------------------------*26380099
263900*    FETCH THE TRECITM ROW FOR UPDATE                            *26390099
264000*----------------------------------------------------------------*26400099
264100 5250-FETCH-TRECITM.                                              26410099
264200     EXEC SQL                                                     26420099
264300         FETCH TRECITM-CSR                                        26430099
264400              INTO :RECITM-ORD-LNE-NBR                            26440099
264500                  ,:RECITM-PREPK-RATO-QTY                         26450099
264600     END-EXEC                                                     26460099
264700                                                                  26470099
264800     EVALUATE TRUE                                                26480099
264900          WHEN SQLCODE = +0                                       26490099
265000               PERFORM 5260-CALC-DTL-CK-QTY                       26500099
265100               PERFORM 5270-UPDATE-TRECITM                        26510099
265200          WHEN SQLCODE = +100                                     26520099
265300               SET PS-EOF-RECITM                                  26530099
265400                               TO TRUE                            26540099
265500          WHEN SQLWARN0 NOT = SPACES                              26550099
265600          WHEN SQLCODE < +0                                       26560099
265700          WHEN SQLCODE > +0                                       26570099
265800               MOVE '5250-FETCH-TRECITM'                          26580099
265900                               TO DP013-PARAGRAPH                 26590099
266000               MOVE 'UNSUCCESSFUL FETCH OF TRECITM'               26600099
266100                               TO DP013-MESSAGE-TEXT (1)          26610099
266200               MOVE SQLCA      TO DP013-SQLCA                     26620099
266300               MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME (1)        26630099
266400               SET DP013-DB2-ABEND                                26640099
266500                   DP013-XCTL-DISPLAY-RESTART                     26650099
266600                               TO TRUE                            26660099
266700               PERFORM DP013-0000-PROCESS-ABEND                   26670099
266800     END-EVALUATE.                                                26680099
266900                                                                  26690099
267000/                                                                 26700099
267100*----------------------------------------------------------------*26710099
267200*    CALCULATE DETAIL CHECK ITEM QTY                             *26720099
267300*----------------------------------------------------------------*26730099
267400                                                                  26740099
267500 5260-CALC-DTL-CK-QTY.                                            26750099
267600     COMPUTE PV-DTL-CHK-ITM-QTY =                                 26760099
267700         RECITM-PREPK-RATO-QTY * ASC-DTL-PACK-QTY-N.              26770099
267800                                                                  26780099
267900/                                                                 26790099
268000*----------------------------------------------------------------*26800099
268100*    AUDIT UPDATE - BEFORE IMAGE                                 *26810099
268200*----------------------------------------------------------------*26820099
268300 5265-AUDIT-UPDATE.                                               26830099
268400                                                                  26840099
268500* AUDIT UPDATE - BEFORE IMAGE                                     26850099
268600     MOVE 'I'                      TO RC031-TABLE-TO-AUDIT.       26860099
268700     MOVE 'B'                      TO RC031-AUD-TYP-CDE.          26870099
268800     MOVE 'U'                      TO RC031-AUD-FUNC-CDE.         26880099
268900     MOVE DK-ORD-NBR               TO RC031-PO-NBR.               26890099
269000     MOVE RECITM-ORD-LNE-NBR       TO RC031-PO-LNE-NBR.           26900099
269100     MOVE DK-REC-SEQ-NBR           TO RC031-REC-SEQ-NBR.          26910099
269200     MOVE DK-OPR-ID                TO RC031-OPER-UNT-ID.          26920099
269300     MOVE DK-FACT                  TO RC031-FCLTY-ID.             26930099
269400     MOVE PC-CURRENT-PROGRAM-NAME  TO RC031-UPD-PGM-ID.           26940099
269500                                                                  26950099
269600     PERFORM 9000-LINK-AUDIT.                                     26960099
269700                                                                  26970099
269800     EVALUATE TRUE                                                26980099
269900         WHEN RC031-CALL-SUCCESSFUL                               26990099
270000             CONTINUE                                             27000099
270100                                                                  27010099
270200         WHEN OTHER                                               27020099
270300              MOVE '5265-AUDIT-UPDATE'                            27030099
270400                                   TO DP013-PARAGRAPH             27040099
270500              MOVE 'UNSUCCESSFUL CALL TO AUDIT RTN'               27050099
270600                                   TO DP013-MESSAGE-TEXT (1)      27060099
270700              MOVE RC031-RETURN-DESC                              27070099
270800                                   TO DP013-MESSAGE-TEXT (2)      27080099
270900              MOVE RC031-SQLCA     TO DP013-SQLCA                 27090099
271000              SET DP013-DB2-ABEND                                 27100099
271100                  DP013-XCTL-DISPLAY-RESTART                      27110099
271200                                   TO TRUE                        27120099
271300              PERFORM DP013-0000-PROCESS-ABEND                    27130099
271400     END-EVALUATE.                                                27140099
271500/                                                                 27150099
271600*----------------------------------------------------------------*27160099
271700*    UPDATE THE TRECITM AND AUDIT FILE                           *27170099
271800*----------------------------------------------------------------*27180099
271900 5270-UPDATE-TRECITM.                                             27190099
272000                                                                  27200099
272100* UPDATE RECITM BASED ON DTL # OF PACKS                           27210099
272200                                                                  27220099
272300     MOVE ASC-KEY-REC-NBR          TO PV-ORD-NBR.                 27230099
272400     MOVE ASC-KEY-REC-SEQ-NBR      TO PV-REC-SEQ-NBR.             27240099
272500     MOVE RECITM-ORD-LNE-NBR       TO PV-RC-ORD-LNE-NBR.          27250099
272600     MOVE ASC-RC-IPKS-CTN-N        TO PV-CASE-PACK-QTY.           27260099
272700     MOVE ASC-PACK-ID              TO DK-PACK-ID.                 27270099
272800                                                                  27280099
272900* UPDATE RECITM WHEN DTL PACK QTY IS CHANGED TO > ZERO            27290099
273000         IF (ASC-DTL-PACK-QTY-N NOT = ASC-DTL-PACK-QTY-OLD)       27300099
273100           AND (ASC-DTL-PACK-QTY-N NOT = ZERO)                    27310099
273200             PERFORM 5265-AUDIT-UPDATE                            27320099
273300             PERFORM 5280-UPD-TRECITM-GRTR-CHK                    27330099
273400         ELSE                                                     27340099
273500* UPDATE RECITM WHEN ONLY # OF INNER PACKS PER CTN CHANGE         27350099
273600*   AND DTL PACK QTY NOT CHANGED                                  27360099
273700             IF (ASC-RC-IPKS-CTN-N NOT = ASC-RC-IPKS-CTN-OLD)     27370099
273800               AND (ASC-DTL-PACK-QTY-N = ASC-DTL-PACK-QTY-OLD)    27380099
273900                 PERFORM 5265-AUDIT-UPDATE                        27390099
274000                 PERFORM 5273-UPD-TRECITM-IPKS                    27400099
274100             ELSE                                                 27410099
274200* UPDATE RECITM WHEN ONLY THE RTV INDICATOR CHANGES               27420099
274300                 IF (ASC-RTV-IND NOT = ASC-RTV-IND-OLD)           27430099
274400                   AND (ASC-RC-IPKS-CTN-N =                       27440099
274500                         ASC-RC-IPKS-CTN-OLD)                     27450099
274600                   AND (ASC-DTL-PACK-QTY-N =                      27460099
274700                         ASC-DTL-PACK-QTY-OLD)                    27470099
274800                     PERFORM 5265-AUDIT-UPDATE                    27480099
274900                     PERFORM 5282-UPD-TRECITM-RTV                 27490099
275000                 END-IF                                           27500099
275100             END-IF                                               27510099
275200         END-IF.                                                  27520099
275300/                                                                 27530099
275400*----------------------------------------------------------------*27540099
275500*    UPDATE THE TRECITM WHEN ONLY # OF INNER PACKS ARE CHANGED   *27550099
275600*----------------------------------------------------------------*27560099
275700 5273-UPD-TRECITM-IPKS.                                           27570099
275800                                                                  27580099
275900     EXEC SQL                                                     27590099
276000          UPDATE TRECITM                                          27600099
276100          SET CASE_PACK_QTY     = :PV-CASE-PACK-QTY               27610099
276200             ,RTV_IND           = :PV-VALIDATE-IND                27620099
276300          WHERE ORD_NBR         = :PV-ORD-NBR                     27630099
276400            AND ORD_LNE_NBR     = :PV-RC-ORD-LNE-NBR              27640099
276500            AND REC_SEQ_NBR     = :PV-REC-SEQ-NBR                 27650099
276600            AND OPER_UNT_ID     = :ASC-OPER-UNT-ID                27660099
276700            AND FCLTY_ID        = :ASC-FCLTY-ID                   27670099
276800            AND VER_STATUS_CDE  = 'A'                             27680099
276900            AND PREPK_ID        = :DK-PACK-ID                     27690099
277000     END-EXEC                                                     27700099
277100                                                                  27710099
277200     EVALUATE TRUE                                                27720099
277300         WHEN SQLCODE = +0                                        27730099
277400              SET ASC-UPDATE-DONE         TO TRUE                 27740099
277500         WHEN SQLWARN0 NOT = SPACES                               27750099
277600         WHEN SQLCODE < +0                                        27760099
277700         WHEN SQLCODE > +0                                        27770099
277800              MOVE '5273-UPD-TRECITM-IPKS'                        27780099
277900                               TO DP013-PARAGRAPH                 27790099
278000              MOVE 'UNSUCCESSFUL UPDATE FOR TRECITM'              27800099
278100                               TO DP013-MESSAGE-TEXT (1)          27810099
278200              MOVE SQLCA       TO DP013-SQLCA                     27820099
278300              MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)        27830099
278400              SET DP013-DB2-ABEND                                 27840099
278500                  DP013-XCTL-DISPLAY-RESTART                      27850099
278600                               TO TRUE                            27860099
278700              PERFORM DP013-0000-PROCESS-ABEND                    27870099
278800     END-EVALUATE.                                                27880099
278900                                                                  27890099
279000/                                                                 27900099
279100*----------------------------------------------------------------*27910099
279200*    UPDATE THE TRECITM WHEN DTL # PACKS ARE GREATER THAN ZERO   *27920099
279300*----------------------------------------------------------------*27930099
279400 5280-UPD-TRECITM-GRTR-CHK.                                       27940099
279500                                                                  27950099
279600     MOVE +0    TO PV-PREPK-ODD-UNT-QTY.                          27960099
279700                                                                  27970099
279800     EXEC SQL                                                     27980099
279900          UPDATE TRECITM                                          27990099
280000          SET CASE_PACK_QTY     = :PV-CASE-PACK-QTY               28000099
280100            ,DTL_CK_ITM_QTY     = :PV-DTL-CHK-ITM-QTY             28010099
280200            ,PREPK_ODD_UNT_QTY  = :PV-PREPK-ODD-UNT-QTY           28020099
280300            ,RTV_IND            = :PV-VALIDATE-IND                28030099
280400          WHERE ORD_NBR         = :PV-ORD-NBR                     28040099
280500            AND ORD_LNE_NBR     = :PV-RC-ORD-LNE-NBR              28050099
280600            AND REC_SEQ_NBR     = :PV-REC-SEQ-NBR                 28060099
280700            AND OPER_UNT_ID     = :ASC-OPER-UNT-ID                28070099
280800            AND FCLTY_ID        = :ASC-FCLTY-ID                   28080099
280900            AND VER_STATUS_CDE  = 'A'                             28090099
281000            AND PREPK_ID        = :DK-PACK-ID                     28100099
281100     END-EXEC                                                     28110099
281200                                                                  28120099
281300     EVALUATE TRUE                                                28130099
281400         WHEN SQLCODE = +0                                        28140099
281500*  SET TROUBLE-PENDING SWITCH                                     28150099
281600              SET ASC-TROUBLE-PENDING     TO TRUE                 28160099
281700              SET ASC-UPDATE-DONE         TO TRUE                 28170099
281800         WHEN SQLWARN0 NOT = SPACES                               28180099
281900         WHEN SQLCODE < +0                                        28190099
282000         WHEN SQLCODE > +0                                        28200099
282100              MOVE '5280-UPD-TRECITM-GRTR-CHK'                    28210099
282200                               TO DP013-PARAGRAPH                 28220099
282300              MOVE 'UNSUCCESSFUL UPDATE FOR TRECITM'              28230099
282400                               TO DP013-MESSAGE-TEXT (1)          28240099
282500              MOVE SQLCA       TO DP013-SQLCA                     28250099
282600              MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)        28260099
282700              SET DP013-DB2-ABEND                                 28270099
282800                  DP013-XCTL-DISPLAY-RESTART                      28280099
282900                               TO TRUE                            28290099
283000              PERFORM DP013-0000-PROCESS-ABEND                    28300099
283100     END-EVALUATE.                                                28310099
283200                                                                  28320099
283300/                                                                 28330099
283400*----------------------------------------------------------------*28340099
283500*    UPDATE THE TRECITM WHEN ONLY RTV-IND CHANGES                *28350099
283600*----------------------------------------------------------------*28360099
283700 5282-UPD-TRECITM-RTV.                                            28370099
283800                                                                  28380099
283900     EXEC SQL                                                     28390099
284000          UPDATE TRECITM                                          28400099
284100          SET RTV_IND           = :PV-VALIDATE-IND                28410099
284200          WHERE ORD_NBR         = :PV-ORD-NBR                     28420099
284300            AND ORD_LNE_NBR     = :PV-RC-ORD-LNE-NBR              28430099
284400            AND REC_SEQ_NBR     = :PV-REC-SEQ-NBR                 28440099
284500            AND OPER_UNT_ID     = :ASC-OPER-UNT-ID                28450099
284600            AND FCLTY_ID        = :ASC-FCLTY-ID                   28460099
284700            AND VER_STATUS_CDE  = 'A'                             28470099
284800            AND PREPK_ID        = :DK-PACK-ID                     28480099
284900     END-EXEC                                                     28490099
285000                                                                  28500099
285100     EVALUATE TRUE                                                28510099
285200         WHEN SQLCODE = +0                                        28520099
285300              SET ASC-UPDATE-DONE         TO TRUE                 28530099
285400         WHEN SQLWARN0 NOT = SPACES                               28540099
285500         WHEN SQLCODE < +0                                        28550099
285600         WHEN SQLCODE > +0                                        28560099
285700              MOVE '5282-UPD-TRECITM-RTV'                         28570099
285800                               TO DP013-PARAGRAPH                 28580099
285900              MOVE 'UNSUCCESSFUL UPDATE FOR TRECITM'              28590099
286000                               TO DP013-MESSAGE-TEXT (1)          28600099
286100              MOVE SQLCA       TO DP013-SQLCA                     28610099
286200              MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)        28620099
286300              SET DP013-DB2-ABEND                                 28630099
286400                  DP013-XCTL-DISPLAY-RESTART                      28640099
286500                               TO TRUE                            28650099
286600              PERFORM DP013-0000-PROCESS-ABEND                    28660099
286700     END-EVALUATE.                                                28670099
286800                                                                  28680099
286900*----------------------------------------------------------------*28690099
287000*    CLOSE THE TRECITM CURSOR                                    *28700099
287100*----------------------------------------------------------------*28710099
287200 5290-CLOSE-TRECITM-CURSOR.                                       28720099
287300                                                                  28730099
287400     EXEC SQL                                                     28740099
287500         CLOSE TRECITM-CSR                                        28750099
287600     END-EXEC                                                     28760099
287700                                                                  28770099
287800     EVALUATE TRUE                                                28780099
287900         WHEN SQLCODE = ZERO                                      28790099
288000         WHEN SQLCODE = +100                                      28800099
288100              CONTINUE                                            28810099
288200         WHEN SQLWARN0 NOT = SPACE                                28820099
288300         WHEN SQLCODE NOT = ZERO                                  28830099
288400              MOVE '5290-CLOSE-TRECITM-CSR'                       28840099
288500                               TO DP013-PARAGRAPH                 28850099
288600              MOVE 'CLOSE TRECITM CSR'                            28860099
288700                               TO DP013-MESSAGE-TEXT (1)          28870099
288800              MOVE SQLCA       TO DP013-SQLCA                     28880099
288900              MOVE 'TRECITM'   TO DP013-DB2-TABLE-NAME (1)        28890099
289000              SET DP013-DB2-ABEND                                 28900099
289100                               TO TRUE                            28910099
289200              PERFORM DP013-0000-PROCESS-ABEND                    28920099
289300     END-EVALUATE.                                                28930099
289400                                                                  28940099
289500/                                                                 28950099
289600*----------------------------------------------------------------*28960099
289700*    SELECT TRECITM DRIVER LINE AFTER UPDATE                     *28970099
289800*----------------------------------------------------------------*28980099
289900 5295-SELECT-TRECITM-DRIVER.                                      28990099
290000                                                                  29000099
290100     EXEC SQL                                                     29010099
290200         SELECT                                                   29020099
290300             DTL_CK_ITM_QTY                                       29030099
290400            ,PREPK_RATO_QTY                                       29040099
290500         INTO                                                     29050099
290600             :RECITM-DTL-CK-ITM-QTY                               29060099
290700            ,:RECITM-PREPK-RATO-QTY                               29070099
290800         FROM                                                     29080099
290900             TRECITM                                              29090099
291000         WHERE ORD_NBR      = :ASC-ORD-NBR                        29100099
291100           AND ORD_LNE_NBR  = :ASC-LNE-NBR                        29110099
291200           AND REC_SEQ_NBR  = :ASC-REC-SEQ-NBR                    29120099
291300           AND OPER_UNT_ID  = :ASC-OPER-UNT-ID                    29130099
291400           AND FCLTY_ID     = :ASC-FCLTY-ID                       29140099
291500           AND VER_STATUS_CDE = 'A'                               29150099
291600           AND PREPK_DRV_LNE_CDE = 'A'                            29160099
291700     END-EXEC                                                     29170099
291800                                                                  29180099
291900     EVALUATE TRUE                                                29190099
292000         WHEN SQLCODE = +0                                        29200099
292100              PERFORM 5299-CALC-TOTAL-NBR-PACKS                   29210099
292200         WHEN SQLCODE = +100                                      29220099
292300              CONTINUE                                            29230099
292400         WHEN SQLWARN0 NOT = SPACE                                29240099
292500         WHEN SQLCODE NOT = ZERO                                  29250099
292600              MOVE '5295-SELECT-TRECITM-DRIVER'                   29260099
292700                               TO DP013-PARAGRAPH                 29270099
292800              MOVE 'UNSUCCESSFUL SELECT FOR TRECITM'              29280099
292900                               TO DP013-MESSAGE-TEXT (1)          29290099
293000              MOVE SQLCA       TO DP013-SQLCA                     29300099
293100              MOVE 'TRECITM'   TO DP013-DB2-TABLE-NAME (1)        29310099
293200              SET DP013-DB2-ABEND                                 29320099
293300                               TO TRUE                            29330099
293400              PERFORM DP013-0000-PROCESS-ABEND                    29340099
293500     END-EVALUATE.                                                29350099
293600/                                                                 29360099
293700*----------------------------------------------------------------*29370099
293800*    CALCULATE THE TOTAL NUMBER OF PACKS FROM DRIVER LINE        *29380099
293900*----------------------------------------------------------------*29390099
294000                                                                  29400099
294100 5299-CALC-TOTAL-NBR-PACKS.                                       29410099
294200                                                                  29420099
294300     IF RECITM-PREPK-RATO-QTY > 0                                 29430099
294400         COMPUTE PV-DTL-CHK-ITM-QTY ROUNDED =                     29440099
294500             RECITM-DTL-CK-ITM-QTY / RECITM-PREPK-RATO-QTY        29450099
294600     ELSE                                                         29460099
294700         MOVE +0        TO PV-DTL-CHK-ITM-QTY.                    29470099
294800                                                                  29480099
294900*----------------------------------------------------------------*29490099
295000* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *29500099
295100* OBJECT WAS UDPATED.                                            *29510099
295200*----------------------------------------------------------------*29520099
295300                                                                  29530099
295400 5300-UPDATE-SELECTION-QUEUE.                                     29540099
295500                                                                  29550099
295600     PERFORM 9150-READ-SEL-QUEUE.                                 29560099
295700                                                                  29570099
295800     SET RC801-UPD (ASC-SEL-SUB)   TO TRUE.                       29580099
295900     MOVE PV-PREPK-ODD-UNT-QTY                                    29590099
296000               TO RC801-ODD-UNITS-PACK-QTY (ASC-SEL-SUB).         29600099
296100     MOVE PV-DTL-CHK-ITM-QTY                                      29610099
296200               TO RC801-DTL-PACK-QTY (ASC-SEL-SUB).               29620099
296300     MOVE PV-TROUB-RSN-SHORT                                      29630099
296400               TO RC801-PK-TRBL-RSN-SHORT (ASC-SEL-SUB).          29640099
296500                                                                  29650099
296600     PERFORM 9200-REWRITE-SEL-QUEUE.                              29660099
296700                                                                  29670099
296800/                                                                 29680099
296900*----------------------------------------------------------------*29690099
297000* DETERMINE WHAT QUANITITY NEEDS TO BE REDISTROED AND PASS IT    *29700099
297100* FOR PROCESSING THRU THE TROUBLE AND REDISTRO ROUTINES.         *29710099
297200*----------------------------------------------------------------*29720099
297300 6000-PROCESS-REDISTRO.                                           29730099
297400                                                                  29740099
297500     PERFORM 6500-CHECK-RECDIS-ALLOC.                             29750099
297600     PERFORM 6100-CHECK-FOR-TROUBLE.                              29760099
297700                                                                  29770099
297800     IF PS-REDISTRO-OK                                            29780099
297900* UPDATE CURRENT TIMESTAMP ON TRECITM                             29790099
298000         PERFORM 5210-OPEN-TRECITM-CURSOR                         29800099
298100         IF PS-RECITM-CSR-OPEN                                    29810099
298200             PERFORM 6400-FETCH-TRECITM                           29820099
298300                 UNTIL PS-EOF-RECITM                              29830099
298400             PERFORM 5290-CLOSE-TRECITM-CURSOR                    29840099
298500         END-IF                                                   29850099
298600*                                                                 29860099
298700         IF TM500-IN-TROUBLE                                      29870099
298710* JAK 05/2007 ADD ERROR MSGS FOR WMS                              29871099
298800*            MOVE PC-TSYMSG-00941        TO DP020-MSG-NUMBER      29880099
298900*            SET DP020-MSG-INFORMATIONAL TO TRUE                  29890099
298910             IF TM500-ASN-SENT-TO-WMS-YES                         29891099
298920*                * REDISTRO SUCCESSFUL, ASN WILL BE               29892099
298930*                * DOWNLOADED TO WMS BUT TROUBLE CREATED          29893099
298940                 MOVE PC-TSYMSG-03569  TO DP020-MSG-NUMBER        29894099
298950                 SET DP020-MSG-INFORMATIONAL TO TRUE              29895099
298970             ELSE                                                 29897099
298980*                * REDISTRO SUCCESSFUL BUT TROUBLE CREATED        29898099
298990                 MOVE PC-TSYMSG-00941  TO DP020-MSG-NUMBER        29899099
298991                 SET DP020-MSG-INFORMATIONAL TO TRUE              29899199
298993             END-IF                                               29899399
299000         ELSE                                                     29900099
299100*            MOVE PC-TSYMSG-02165        TO DP020-MSG-NUMBER      29910099
299200*            SET DP020-MSG-INFORMATIONAL TO TRUE                  29920099
299210             IF TM500-ASN-SENT-TO-WMS-YES                         29921099
299220*                * REDISTRO SUCCESSFUL AND ASN WILL BE            29922099
299230*                * DOWNLOADED TO WMS                              29923099
299240                 MOVE PC-TSYMSG-03568  TO DP020-MSG-NUMBER        29924099
299250                 SET DP020-MSG-INFORMATIONAL TO TRUE              29925099
299270             ELSE                                                 29927099
299280*                * REDISTRO SUCCESSFUL                            29928099
299290                 MOVE PC-TSYMSG-02165  TO DP020-MSG-NUMBER        29929099
299291                 SET DP020-MSG-INFORMATIONAL TO TRUE              29929199
299293             END-IF                                               29929399
299294* JAK 05/2007 END                                                 29929499
299300         END-IF                                                   29930099
299400     ELSE                                                         29940099
299500         MOVE PC-TSYMSG-00937        TO DP020-MSG-NUMBER          29950099
299600         SET DP020-MSG-INFORMATIONAL TO TRUE                      29960099
299700     END-IF.                                                      29970099
299800                                                                  29980099
299900 6100-CHECK-FOR-TROUBLE.                                          29990099
300000                                                                  30000099
300100     INITIALIZE TM500-FIELDS.                                     30010099
300200                                                                  30020099
300300     SET  TM500-CREATE-AUTO        TO TRUE.                       30030099
300400     SET  TM500-PACK-LEVEL         TO TRUE.                       30040099
300500     SET  TM500-NO-DETAILS         TO TRUE.                       30050099
300600     SET  TM500-REDISTRO-YES       TO TRUE.                       30060099
300700     MOVE ASC-KEY-REC-NBR          TO TM500-PO-NBR.               30070099
300800     MOVE ASC-LNE-NBR              TO TM500-PO-LNE-NBR.           30080099
300900     MOVE ASC-KEY-OPER-UNT-ID      TO TM500-OPER-UNT-ID.          30090099
301000     MOVE ASC-KEY-FCLTY-ID         TO TM500-FCLTY-ID.             30100099
301100     MOVE ASC-PACK-ID              TO TM500-PREPK-ID.             30110099
301200     MOVE ASC-PACK-TYP-CDE         TO TM500-PKGNG-CDE.            30120099
301300                                                                  30130099
301400* CHECK PIC ITM IND ON PURITM                                     30140099
301500     PERFORM 6150-GET-PURITM.                                     30150099
301600     IF PV-DB2-COUNT > +0                                         30160099
301700         SET TM500-AD-YES          TO TRUE                        30170099
301800     ELSE                                                         30180099
301900         SET TM500-AD-NO           TO TRUE                        30190099
302000     END-IF.                                                      30200099
302100*                                                                 30210099
302200     MOVE PC-CURRENT-PROGRAM-NAME  TO TM500-NOTIF-UID.            30220099
302300     MOVE ASC-KEY-REC-SEQ-NBR      TO TM500-REC-SEQ-NBR           30230099
302400                                                                  30240099
302500     SET PS-REDISTRO-OK            TO TRUE                        30250099
302600     PERFORM 9100-LINK-TROUBLE.                                   30260099
302700                                                                  30270099
302800     EVALUATE TRUE                                                30280099
302900         WHEN TM500-CALL-SUCCESSFUL                               30290099
303000         WHEN TM500-DUPLICATE-TROUBLE                             30300099
303100         WHEN TM500-TTRBNTF-UPDATE-NOT-FND                        30310099
303200              IF TM500-IN-TROUBLE                                 30320099
303300*        * REDISTRO SUCCESSFUL BUT TROUBLE CREATED                30330099
303400                  SET PS-REDISTRO-NOT-OK TO TRUE                  30340099
303500                  MOVE PC-TSYMSG-00941   TO DP020-MSG-NUMBER      30350099
303600                  SET DP020-MSG-INFORMATIONAL                     30360099
303700                                         TO TRUE                  30370099
303800              ELSE                                                30380099
303900                  MOVE PC-TSYMSG-02165   TO DP020-MSG-NUMBER      30390099
304000                  SET DP020-MSG-INFORMATIONAL                     30400099
304100                                         TO TRUE                  30410099
304200              END-IF                                              30420099
304300                                                                  30430099
304400         WHEN TM500-INVALID-PRORATION                             30440099
304500              SET DP020-MSG-WARNING      TO TRUE                  30450099
304600              MOVE PC-TSYMSG-02452       TO DP020-MSG-NUMBER      30460099
304700                                                                  30470099
304800         WHEN TM500-DIDNT-ALLOC-DUE-TO-TRBL                       30480099
304900              SET PS-REDISTRO-NOT-OK     TO TRUE                  30490099
305000              MOVE PC-TSYMSG-00937       TO DP020-MSG-NUMBER      30500099
305100              SET DP020-MSG-INFORMATIONAL TO TRUE                 30510099
305200                                                                  30520099
305300         WHEN OTHER                                               30530099
305400              EXEC CICS                                           30540099
305500                   SYNCPOINT ROLLBACK                             30550099
305600              END-EXEC                                            30560099
305700              STRING TM500-PREPACK-PGM-NBR '-'                    30570099
305800                     TM500-PREPACK-ERROR-NBR                      30580099
305900                     DELIMITED BY SIZE                            30590099
306000                                  INTO DP020-MSG-TEXT             30600099
306100              MOVE PC-TSYMSG-02229  TO DP020-MSG-NUMBER           30610099
306200              SET DP020-MSG-FATAL   TO TRUE                       30620099
306300     END-EVALUATE.                                                30630099
306400                                                                  30640099
306500 6125-CHK-TROUBLE-ONLY.                                           30650099
306600                                                                  30660099
306700     INITIALIZE TM500-FIELDS.                                     30670099
306800                                                                  30680099
306900     SET  TM500-PREPACK-EDIT-ONLY  TO TRUE.                       30690099
307000     SET  TM500-PACK-LEVEL         TO TRUE.                       30700099
307100     SET  TM500-NO-DETAILS         TO TRUE.                       30710099
307200     SET  TM500-REDISTRO-YES       TO TRUE.                       30720099
307300     MOVE ASC-KEY-REC-NBR          TO TM500-PO-NBR.               30730099
307400     MOVE ASC-LNE-NBR              TO TM500-PO-LNE-NBR.           30740099
307500     MOVE ASC-KEY-OPER-UNT-ID      TO TM500-OPER-UNT-ID.          30750099
307600     MOVE ASC-KEY-FCLTY-ID         TO TM500-FCLTY-ID.             30760099
307700     MOVE ASC-PACK-ID              TO TM500-PREPK-ID.             30770099
307800     MOVE ASC-PACK-TYP-CDE         TO TM500-PKGNG-CDE.            30780099
307900                                                                  30790099
308000* CHECK PIC ITM IND ON PURITM                                     30800099
308100     PERFORM 6150-GET-PURITM.                                     30810099
308200     IF PV-DB2-COUNT > +0                                         30820099
308300         SET TM500-AD-YES          TO TRUE                        30830099
308400     ELSE                                                         30840099
308500         SET TM500-AD-NO           TO TRUE                        30850099
308600     END-IF.                                                      30860099
308700*                                                                 30870099
308800     MOVE PC-CURRENT-PROGRAM-NAME  TO TM500-NOTIF-UID.            30880099
308900     MOVE ASC-KEY-REC-SEQ-NBR      TO TM500-REC-SEQ-NBR           30890099
309000                                                                  30900099
309100     PERFORM 9100-LINK-TROUBLE.                                   30910099
309200                                                                  30920099
309300     EVALUATE TRUE                                                30930099
309400         WHEN TM500-CALL-SUCCESSFUL                               30940099
309500         WHEN TM500-DUPLICATE-TROUBLE                             30950099
309600         WHEN TM500-TTRBNTF-UPDATE-NOT-FND                        30960099
309700         WHEN TM500-DIDNT-ALLOC-DUE-TO-TRBL                       30970099
309800              IF TM500-IN-TROUBLE                                 30980099
309900*        * UPDATE SUCCESSFUL BUT TROUBLE CREATED                  30990099
310000                  MOVE PC-TSYMSG-02305   TO DP020-MSG-NUMBER      31000099
310100                  SET DP020-MSG-INFORMATIONAL                     31010099
310200                                         TO TRUE                  31020099
310300              ELSE                                                31030099
310400*        * UPDATE SUCCESSFUL, PF14 TO REDISTRO                    31040099
310500                  MOVE PC-TSYMSG-02168   TO DP020-MSG-NUMBER      31050099
310600                  SET DP020-MSG-INFORMATIONAL                     31060099
310700                                         TO TRUE                  31070099
310800              END-IF                                              31080099
310900                                                                  31090099
311000         WHEN OTHER                                               31100099
311100              EXEC CICS                                           31110099
311200                   SYNCPOINT ROLLBACK                             31120099
311300              END-EXEC                                            31130099
311400              STRING TM500-PREPACK-PGM-NBR '-'                    31140099
311500                     TM500-PREPACK-ERROR-NBR                      31150099
311600                     DELIMITED BY SIZE                            31160099
311700                                  INTO DP020-MSG-TEXT             31170099
311800              MOVE PC-TSYMSG-02229  TO DP020-MSG-NUMBER           31180099
311900              SET DP020-MSG-FATAL   TO TRUE                       31190099
312000     END-EVALUATE.                                                31200099
312100/                                                                 31210099
312200 6150-GET-PURITM.                                                 31220099
312300                                                                  31230099
312400     INITIALIZE PV-DB2-COUNT.                                     31240099
312500     EXEC SQL                                                     31250099
312600         SELECT COUNT(*)                                          31260099
312700           INTO :PV-DB2-COUNT  :PV-NULL-IND                       31270099
312800           FROM TRECITM A                                         31280099
312900               ,TPURITM B                                         31290099
313000         WHERE A.ORD_NBR          = :DK-ORD-NBR                   31300099
313100           AND A.REC_SEQ_NBR      = :DK-REC-SEQ-NBR               31310099
313200           AND A.OPER_UNT_ID      = :DK-OPR-ID                    31320099
313300           AND A.FCLTY_ID         = :DK-FACT                      31330099
313400           AND B.PO_NBR           = A.ORD_NBR                     31340099
313500           AND B.APP_PO_LNE_NBR   = A.ORD_LNE_NBR                 31350099
313600           AND B.PO_PREPK_ID      = A.PREPK_ID                    31360099
313700           AND B.PIC_ITM_IND      = 'Y'                           31370099
313800     END-EXEC                                                     31380099
313900                                                                  31390099
314000     EVALUATE TRUE                                                31400099
314100         WHEN SQLCODE = +0                                        31410099
314200         WHEN SQLCODE = +100                                      31420099
314300         WHEN SQLCODE = -904                                      31430099
314400         WHEN SQLCODE = -913                                      31440099
314500             CONTINUE                                             31450099
314600         WHEN SQLWARN0 NOT = SPACES                               31460099
314700         WHEN SQLCODE < +0                                        31470099
314800         WHEN SQLCODE > +0                                        31480099
314900             MOVE '6150-GET-PURITM'                               31490099
315000                              TO DP013-PARAGRAPH                  31500099
315100             MOVE 'SELECT A TPURITM ROW'                          31510099
315200                              TO DP013-MESSAGE-TEXT (1)           31520099
315300             MOVE SQLCA       TO DP013-SQLCA                      31530099
315400             MOVE 'TPURITM'   TO DP013-DB2-TABLE-NAME (1)         31540099
315500             SET DP013-DB2-ABEND                                  31550099
315600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               31560099
315700             PERFORM DP013-0000-PROCESS-ABEND                     31570099
315800     END-EVALUATE.                                                31580099
315900                                                                  31590099
316000*----------------------------------------------------------------*31600099
316100* DETERMINE PACK TROUBLE DESCRIPTION                             *31610099
316200*----------------------------------------------------------------*31620099
316300/                                                                 31630099
316400 6175-TRBL-PAK-DESC.                                              31640099
316500                                                                  31650099
316600     EXEC SQL                                                     31660099
316700         SELECT C.TRBL_SHT_DESC                                   31670099
316800               ,C.TRBL_LONG_DESC                                  31680099
316900         INTO :TRBRSN-TRBL-SHT-DESC                               31690099
317000             ,:TRBRSN-TRBL-LONG-DESC                              31700099
317100         FROM  TRECITM A                                          31710099
317200              ,TTRBNTF B                                          31720099
317300              ,TTRBRSN C                                          31730099
317400         WHERE A.ORD_NBR           = :DK-ORD-NBR                  31740099
317500           AND A.REC_SEQ_NBR       = :DK-REC-SEQ-NBR              31750099
317600           AND A.OPER_UNT_ID       = :ASC-KEY-OPER-UNT-ID         31760099
317700           AND A.FCLTY_ID          = :ASC-KEY-FCLTY-ID            31770099
317800           AND A.ORD_LNE_NBR       > 0                            31780099
317900           AND A.PREPK_ID          = :DK-PACK-ID                  31790099
318000           AND B.PO_NBR            = A.ORD_NBR                    31800099
318100           AND B.REC_SEQ_NBR       = A.REC_SEQ_NBR                31810099
318200           AND B.OPER_UNT_ID       = A.OPER_UNT_ID                31820099
318300           AND B.FCLTY_ID          = A.FCLTY_ID                   31830099
318400           AND B.PO_LNE_NBR        = 0                            31840099
318500           AND B.PREPK_ID          = A.PREPK_ID                   31850099
318600           AND B.RESOLVED_IND IN  (:PC-N, :PC-I)                  31860099
318700           AND B.TRBL_RSN_CDE      = C.TRBL_RSN_CDE               31870099
318800     END-EXEC                                                     31880099
318900                                                                  31890099
319000     EVALUATE TRUE                                                31900099
319100         WHEN SQLCODE = +0                                        31910099
319200         WHEN SQLCODE = -811                                      31920099
319300             MOVE TRBRSN-TRBL-SHT-DESC TO PV-TROUB-RSN-SHORT      31930099
319400             MOVE TRBRSN-TRBL-LONG-DESC                           31940099
319500                                       TO ASC-TROUBLE-DESC        31950099
319600             SET ASC-PACKDESC-YES      TO TRUE                    31960099
319700         WHEN SQLCODE = +100                                      31970099
319800             MOVE SPACES               TO PV-TROUB-RSN-SHORT      31980099
319900             MOVE SPACES               TO ASC-TROUBLE-DESC        31990099
320000             SET ASC-PACKDESC-NO       TO TRUE                    32000099
320100         WHEN SQLCODE = -904                                      32010099
320200         WHEN SQLCODE = -911                                      32020099
320300         WHEN SQLCODE = -913                                      32030099
320400             PERFORM 9900-SOFT-ABORT                              32040099
320500         WHEN SQLWARN0 NOT = SPACE                                32050099
320600         WHEN SQLCODE < ZERO                                      32060099
320700         WHEN SQLCODE > ZERO                                      32070099
320800             MOVE '6175-TRBL-PAK-DESC'                            32080099
320900                             TO DP013-PARAGRAPH                   32090099
321000             MOVE 'SELECT ON TTRBNTF'                             32100099
321100                             TO DP013-MESSAGE-TEXT (1)            32110099
321200             MOVE SQLCA      TO DP013-SQLCA                       32120099
321300             MOVE 'TTRBNTF'  TO DP013-DB2-TABLE-NAME (1)          32130099
321400             SET DP013-DB2-ABEND                                  32140099
321500                             TO TRUE                              32150099
321600             SET DP013-XCTL-DISPLAY-RESTART                       32160099
321700                             TO TRUE                              32170099
321800             PERFORM DP013-0000-PROCESS-ABEND                     32180099
321900     END-EVALUATE.                                                32190099
322000                                                                  32200099
322100*----------------------------------------------------------------*32210099
322200* DETERMINE LINE TROUBLE DESCRIPTION                             *32220099
322300*----------------------------------------------------------------*32230099
322400/                                                                 32240099
322500 6180-TRBL-LNE-DESC.                                              32250099
322600                                                                  32260099
322700     EXEC SQL                                                     32270099
322800         SELECT                                                   32280099
322900             C.TRBL_SHT_DESC                                      32290099
323000            ,C.TRBL_LONG_DESC                                     32300099
323100         INTO                                                     32310099
323200              :TRBRSN-TRBL-SHT-DESC                               32320099
323300             ,:TRBRSN-TRBL-LONG-DESC                              32330099
323400         FROM TRECITM A                                           32340099
323500             ,TTRBNTF B                                           32350099
323600             ,TTRBRSN C                                           32360099
323700         WHERE A.ORD_NBR         = :DK-ORD-NBR                    32370099
323800            AND A.REC_SEQ_NBR    = :DK-REC-SEQ-NBR                32380099
323900            AND A.ORD_LNE_NBR    > 0                              32390099
324000            AND A.PREPK_ID       = :DK-PACK-ID                    32400099
324100            AND A.OPER_UNT_ID    = :ASC-KEY-OPER-UNT-ID           32410099
324200            AND A.FCLTY_ID       = :ASC-KEY-FCLTY-ID              32420099
324300            AND B.PO_NBR         = A.ORD_NBR                      32430099
324400            AND B.REC_SEQ_NBR    = A.REC_SEQ_NBR                  32440099
324500            AND B.OPER_UNT_ID    = A.OPER_UNT_ID                  32450099
324600            AND B.FCLTY_ID       = A.FCLTY_ID                     32460099
324700            AND B.PO_LNE_NBR     = A.ORD_LNE_NBR                  32470099
324800            AND B.RESOLVED_IND IN (:PC-N, :PC-I)                  32480099
324900            AND B.TRBL_RSN_CDE   = C.TRBL_RSN_CDE                 32490099
325000     END-EXEC                                                     32500099
325100                                                                  32510099
325200     EVALUATE TRUE                                                32520099
325300         WHEN SQLCODE = +0                                        32530099
325400         WHEN SQLCODE = -811                                      32540099
325500             MOVE TRBRSN-TRBL-SHT-DESC TO PV-TROUB-RSN-SHORT      32550099
325600             MOVE TRBRSN-TRBL-LONG-DESC                           32560099
325700                                       TO ASC-TROUBLE-DESC        32570099
325800         WHEN SQLCODE = +100                                      32580099
325900             MOVE SPACES               TO PV-TROUB-RSN-SHORT      32590099
326000             MOVE SPACES               TO ASC-TROUBLE-DESC        32600099
326100         WHEN SQLCODE = -904                                      32610099
326200         WHEN SQLCODE = -911                                      32620099
326300         WHEN SQLCODE = -913                                      32630099
326400             PERFORM 9900-SOFT-ABORT                              32640099
326500         WHEN SQLWARN0 NOT = SPACE                                32650099
326600         WHEN SQLCODE < ZERO                                      32660099
326700         WHEN SQLCODE > ZERO                                      32670099
326800             MOVE '6180-TRBL-LNE-DESC'                            32680099
326900                             TO DP013-PARAGRAPH                   32690099
327000             MOVE 'SELECT ON TTRBNTF'                             32700099
327100                             TO DP013-MESSAGE-TEXT (1)            32710099
327200             MOVE SQLCA      TO DP013-SQLCA                       32720099
327300             MOVE 'TTRBNTF'  TO DP013-DB2-TABLE-NAME (1)          32730099
327400             SET DP013-DB2-ABEND                                  32740099
327500                             TO TRUE                              32750099
327600             SET DP013-XCTL-DISPLAY-RESTART                       32760099
327700                             TO TRUE                              32770099
327800             PERFORM DP013-0000-PROCESS-ABEND                     32780099
327900     END-EVALUATE.                                                32790099
328000                                                                  32800099
328100 6200-CHECK-TRECITM-VERIF.                                        32810099
328200                                                                  32820099
328300     MOVE ZERO TO PV-DB2-COUNT.                                   32830099
328400     EXEC SQL                                                     32840099
328500         SELECT COUNT(*)                                          32850099
328600           INTO :PV-DB2-COUNT  :PV-NULL-IND                       32860099
328700           FROM TRECITM                                           32870099
328800         WHERE ORD_NBR        = :DK-ORD-NBR                       32880099
328900           AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                   32890099
329000           AND OPER_UNT_ID    = :DK-OPR-ID                        32900099
329100           AND FCLTY_ID       = :DK-FACT                          32910099
329200           AND PREPK_ID       = :DK-PACK-ID                       32920099
329300           AND VER_STATUS_CDE = 'A'                               32930099
329400           AND STATUS_CDE     IN ('VE','CM')                      32940099
329500     END-EXEC                                                     32950099
329600                                                                  32960099
329700     EVALUATE TRUE                                                32970099
329800         WHEN SQLCODE = +0                                        32980099
329900         WHEN SQLCODE = +100                                      32990099
330000             CONTINUE                                             33000099
330100         WHEN SQLWARN0 NOT = SPACES                               33010099
330200         WHEN SQLCODE < +0                                        33020099
330300         WHEN SQLCODE > +0                                        33030099
330400             MOVE '6200-CHECK-TRECITM-VERIF'                      33040099
330500                            TO DP013-PARAGRAPH                    33050099
330600             MOVE 'UNSUCCESSFUL SELECT STA CDE CNT'               33060099
330700                            TO DP013-MESSAGE-TEXT (1)             33070099
330800             MOVE SQLCA     TO DP013-SQLCA                        33080099
330900             MOVE 'TRECITM' TO DP013-DB2-TABLE-NAME (1)           33090099
331000             SET DP013-DB2-ABEND                                  33100099
331100                 DP013-XCTL-DISPLAY-RESTART                       33110099
331200                            TO TRUE                               33120099
331300             PERFORM DP013-0000-PROCESS-ABEND                     33130099
331400     END-EVALUATE.                                                33140099
331500                                                                  33150099
331600/                                                                 33160099
331700*----------------------------------------------------------------*33170099
331800*    FETCH THE TRECITM ROW FOR UPDATE                            *33180099
331900*----------------------------------------------------------------*33190099
332000 6400-FETCH-TRECITM.                                              33200099
332100     EXEC SQL                                                     33210099
332200         FETCH TRECITM-CSR                                        33220099
332300              INTO :RECITM-ORD-LNE-NBR                            33230099
332400     END-EXEC                                                     33240099
332500                                                                  33250099
332600     EVALUATE TRUE                                                33260099
332700          WHEN SQLCODE = +0                                       33270099
332800               PERFORM 6410-UPDATE-TRECITM                        33280099
332900          WHEN SQLCODE = +100                                     33290099
333000               SET PS-EOF-RECITM                                  33300099
333100                               TO TRUE                            33310099
333200          WHEN SQLWARN0 NOT = SPACES                              33320099
333300          WHEN SQLCODE < +0                                       33330099
333400          WHEN SQLCODE > +0                                       33340099
333500               MOVE '6400-FETCH-TRECITM'                          33350099
333600                               TO DP013-PARAGRAPH                 33360099
333700               MOVE 'UNSUCCESSFUL FETCH OF TRECITM'               33370099
333800                               TO DP013-MESSAGE-TEXT (1)          33380099
333900               MOVE SQLCA      TO DP013-SQLCA                     33390099
334000               MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME (1)        33400099
334100               SET DP013-DB2-ABEND                                33410099
334200                   DP013-XCTL-DISPLAY-RESTART                     33420099
334300                               TO TRUE                            33430099
334400               PERFORM DP013-0000-PROCESS-ABEND                   33440099
334500     END-EVALUATE.                                                33450099
334600                                                                  33460099
334700/                                                                 33470099
334800*----------------------------------------------------------------*33480099
334900*    UPDATE THE TRECITM WITH THE CURRENT TIMESTAMP               *33490099
335000*----------------------------------------------------------------*33500099
335100 6410-UPDATE-TRECITM.                                             33510099
335200                                                                  33520099
335300     MOVE ASC-KEY-REC-NBR          TO PV-ORD-NBR.                 33530099
335400     MOVE ASC-KEY-REC-SEQ-NBR      TO PV-REC-SEQ-NBR.             33540099
335500     MOVE RECITM-ORD-LNE-NBR       TO PV-RC-ORD-LNE-NBR.          33550099
335600     MOVE ASC-RC-IPKS-CTN-N        TO PV-CASE-PACK-QTY.           33560099
335700     MOVE ASC-PACK-ID              TO DK-PACK-ID.                 33570099
335800                                                                  33580099
335900     EXEC SQL                                                     33590099
336000          UPDATE TRECITM                                          33600099
336100          SET LAST_TRSCP_TMST   = CURRENT TIMESTAMP               33610099
336200             ,LAST_TRSCP_USR_ID = :DP020-USERID                   33620099
336300          WHERE ORD_NBR         = :PV-ORD-NBR                     33630099
336400            AND ORD_LNE_NBR     = :PV-RC-ORD-LNE-NBR              33640099
336500            AND REC_SEQ_NBR     = :PV-REC-SEQ-NBR                 33650099
336600            AND OPER_UNT_ID     = :ASC-OPER-UNT-ID                33660099
336700            AND FCLTY_ID        = :ASC-FCLTY-ID                   33670099
336800            AND VER_STATUS_CDE  = 'A'                             33680099
336900            AND PREPK_ID        = :DK-PACK-ID                     33690099
337000     END-EXEC                                                     33700099
337100                                                                  33710099
337200     EVALUATE TRUE                                                33720099
337300         WHEN SQLCODE = +0                                        33730099
337400              CONTINUE                                            33740099
337500         WHEN SQLWARN0 NOT = SPACES                               33750099
337600         WHEN SQLCODE < +0                                        33760099
337700         WHEN SQLCODE > +0                                        33770099
337800              MOVE '6410-UPDATE-TRECITM'                          33780099
337900                               TO DP013-PARAGRAPH                 33790099
338000              MOVE 'UNSUCCESSFUL UPDATE FOR TRECITM'              33800099
338100                               TO DP013-MESSAGE-TEXT (1)          33810099
338200              MOVE SQLCA       TO DP013-SQLCA                     33820099
338300              MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)        33830099
338400              SET DP013-DB2-ABEND                                 33840099
338500                  DP013-XCTL-DISPLAY-RESTART                      33850099
338600                               TO TRUE                            33860099
338700              PERFORM DP013-0000-PROCESS-ABEND                    33870099
338800     END-EVALUATE.                                                33880099
338900                                                                  33890099
339000/                                                                 33900099
339100*----------------------------------------------------------------*33910099
339200*    CHECK RECDIS ALLOCATION                                     *33920099
339300*----------------------------------------------------------------*33930099
339400 6500-CHECK-RECDIS-ALLOC.                                         33940099
339500                                                                  33950099
339600*  INITIALIZE FIELDS.                                             33960099
339700     SET RC811-DELETE-A-DISTRO-PACK   TO TRUE.                    33970099
339800     MOVE ASC-ORD-NBR                 TO RC811-PO-NBR.            33980099
339900     MOVE ASC-REC-SEQ-NBR             TO RC811-REC-SEQ-NBR.       33990099
340000     MOVE ASC-OPER-UNT-ID             TO RC811-OPER-UNIT-ID.      34000099
340100     MOVE ASC-FCLTY-ID                TO RC811-FACILITY-ID.       34010099
340200     MOVE ASC-PACK-ID                 TO RC811-PREPK-ID.          34020099
340300                                                                  34030099
340400     PERFORM 9125-LINK-RECDIS-ALLOC.                              34040099
340500                                                                  34050099
340600     EVALUATE TRUE                                                34060099
340700         WHEN RC811-SUCCESSFUL-PACK-DELETE                        34070099
340800             CONTINUE                                             34080099
340900         WHEN RC811-PACK-IN-RECDIS-NOT-FOUND                      34090099
341000             MOVE PC-TSYMSG-02173 TO DP020-MSG-NUMBER             34100099
341100             SET DP020-MSG-INFORMATIONAL                          34110099
341200                                  TO TRUE                         34120099
341300         WHEN OTHER                                               34130099
341400             MOVE '9125-LINK-RECDIS-ALLOC'                        34140099
341500                               TO DP013-PARAGRAPH                 34150099
341600             MOVE 'UNSUCCESSFUL CALL TO RECDIS ALLOC'             34160099
341700                               TO DP013-MESSAGE-TEXT (1)          34170099
341800             MOVE 'TRECDIS'    TO DP013-DB2-TABLE-NAME (1)        34180099
341900             MOVE SQLCA        TO DP013-SQLCA                     34190099
342000             SET DP013-DB2-ABEND                                  34200099
342100                               TO TRUE                            34210099
342200             PERFORM DP013-0000-PROCESS-ABEND                     34220099
342300     END-EVALUATE.                                                34230099
342400                                                                  34240099
342500/                                                                 34250099
342600 8000-SELECT-RECEIV.                                              34260099
342700                                                                  34270099
342800     EXEC SQL                                                     34280099
342900     SELECT                                                       34290099
343000           ORD_NBR                                                34300099
343100          ,REC_SEQ_NBR                                            34310099
343200          ,CRE_TMST                                               34320099
343300          ,CRE_UID                                                34330099
343400          ,OPER_UNT_ID                                            34340099
343500          ,FCLTY_ID                                               34350099
343600          ,STATUS_CDE                                             34360099
343700          ,VER_STATUS_CDE                                         34370099
343800          ,UPD_UID                                                34380099
343900          ,MONTH  (CRE_TMST)                                      34390099
344000          ,DAY    (CRE_TMST)                                      34400099
344100          ,YEAR   (CRE_TMST)                                      34410099
344200          ,HOUR   (CRE_TMST)                                      34420099
344300          ,MINUTE (CRE_TMST)                                      34430099
344400          ,MONTH  (UPD_TMST)                                      34440099
344500          ,DAY    (UPD_TMST)                                      34450099
344600          ,YEAR   (UPD_TMST)                                      34460099
344700          ,HOUR   (UPD_TMST)                                      34470099
344800          ,MINUTE (UPD_TMST)                                      34480099
344900          ,CURRENT TIMESTAMP                                      34490099
345000     INTO                                                         34500099
345100           :RECEIV-ORD-NBR                                        34510099
345200         , :RECEIV-REC-SEQ-NBR                                    34520099
345300         , :RECEIV-CRE-TMST                                       34530099
345400         , :RECEIV-CRE-UID                                        34540099
345500         , :RECEIV-OPER-UNT-ID                                    34550099
345600         , :RECEIV-FCLTY-ID                                       34560099
345700         , :RECEIV-STATUS-CDE                                     34570099
345800         , :RECEIV-VER-STATUS-CDE                                 34580099
345900         , :RECEIV-UPD-UID                                        34590099
346000         , :PV-DB2-MONTH                                          34600099
346100         , :PV-DB2-DAY                                            34610099
346200         , :PV-DB2-YEAR                                           34620099
346300         , :PV-DB2-HOUR                                           34630099
346400         , :PV-DB2-MINUTE                                         34640099
346500         , :PV-DB2-MONTH-TRSCP                                    34650099
346600         , :PV-DB2-DAY-TRSCP                                      34660099
346700         , :PV-DB2-YEAR-TRSCP                                     34670099
346800         , :PV-DB2-HOUR-TRSCP                                     34680099
346900         , :PV-DB2-MINUTE-TRSCP                                   34690099
347000         , :PV-CURRENT-TIMESTAMP                                  34700099
347100                                                                  34710099
347200     FROM TRECEIV                                                 34720099
347300          WHERE ORD_NBR        = :DK-ORD-NBR                      34730099
347400            AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                  34740099
347500            AND OPER_UNT_ID    = :ASC-KEY-OPER-UNT-ID             34750099
347600            AND FCLTY_ID       = :ASC-KEY-FCLTY-ID                34760099
347700            AND VER_STATUS_CDE = :PC-ACTIVE                       34770099
347800     END-EXEC.                                                    34780099
347900                                                                  34790099
348000     EVALUATE TRUE                                                34800099
348100         WHEN SQLCODE = ZERO                                      34810099
348200              SET PS-RECEIV-FOUND                                 34820099
348300                  ASC-FOUND    TO TRUE                            34830099
348400         WHEN SQLCODE = +100                                      34840099
348500              SET PS-RECEIV-NOT-FOUND                             34850099
348600                  ASC-NOT-FOUND                                   34860099
348700                               TO TRUE                            34870099
348800         WHEN SQLWARN0 NOT = SPACES                               34880099
348900         WHEN SQLCODE < +0                                        34890099
349000         WHEN SQLCODE > +0                                        34900099
349100              MOVE '8000-SELECT-RECEIV'                           34910099
349200                               TO DP013-PARAGRAPH                 34920099
349300              MOVE 'UNSUCCESSFUL SELECT OF RECEIVER'              34930099
349400                               TO DP013-MESSAGE-TEXT (1)          34940099
349500              MOVE SQLCA       TO DP013-SQLCA                     34950099
349600              MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (1)        34960099
349700              SET DP013-DB2-ABEND                                 34970099
349800                  DP013-XCTL-DISPLAY-RESTART                      34980099
349900                               TO TRUE                            34990099
350000              PERFORM DP013-0000-PROCESS-ABEND                    35000099
350100     END-EVALUATE.                                                35010099
350200                                                                  35020099
350300/                                                                 35030099
350400 9000-LINK-AUDIT.                                                 35040099
350500     EXEC CICS                                                    35050099
350600         LINK PROGRAM  (PC-AUDIT-RTN)                             35060099
350700              COMMAREA (RC031-FIELDS)                             35070099
350800     END-EXEC.                                                    35080099
350900                                                                  35090099
351000/                                                                 35100099
351100 9005-UPDATE-STATUS-CDE.                                          35110099
351200                                                                  35120099
351300* BEFORE IMAGE                                                    35130099
351400     MOVE 'I'                      TO RC031-TABLE-TO-AUDIT.       35140099
351500     MOVE 'B'                      TO RC031-AUD-TYP-CDE.          35150099
351600     MOVE 'U'                      TO RC031-AUD-FUNC-CDE.         35160099
351700     MOVE RECITM-ORD-NBR           TO RC031-PO-NBR.               35170099
351800     MOVE RECITM-ORD-LNE-NBR       TO RC031-PO-LNE-NBR.           35180099
351900     MOVE RECITM-REC-SEQ-NBR       TO RC031-REC-SEQ-NBR.          35190099
352000     MOVE RECITM-OPER-UNT-ID       TO RC031-OPER-UNT-ID.          35200099
352100     MOVE RECITM-FCLTY-ID          TO RC031-FCLTY-ID.             35210099
352200     MOVE PC-CURRENT-PROGRAM-NAME  TO RC031-UPD-PGM-ID.           35220099
352300                                                                  35230099
352400     PERFORM 9000-LINK-AUDIT.                                     35240099
352500                                                                  35250099
352600     EVALUATE TRUE                                                35260099
352700         WHEN RC031-CALL-SUCCESSFUL                               35270099
352800             CONTINUE                                             35280099
352900                                                                  35290099
353000         WHEN OTHER                                               35300099
353100              MOVE '9005-UPDATE-STATUS-CDE'                       35310099
353200                                   TO DP013-PARAGRAPH             35320099
353300              MOVE 'UNSUCCESSFUL CALL TO AUDIT RTN'               35330099
353400                                   TO DP013-MESSAGE-TEXT (1)      35340099
353500              MOVE RC031-RETURN-DESC                              35350099
353600                                   TO DP013-MESSAGE-TEXT (2)      35360099
353700              MOVE RC031-SQLCA     TO DP013-SQLCA                 35370099
353800              SET DP013-DB2-ABEND                                 35380099
353900                  DP013-XCTL-DISPLAY-RESTART                      35390099
354000                                   TO TRUE                        35400099
354100              PERFORM DP013-0000-PROCESS-ABEND                    35410099
354200     END-EVALUATE.                                                35420099
354300                                                                  35430099
354400     EXEC SQL                                                     35440099
354500          UPDATE TRECITM                                          35450099
354600             SET STATUS_CDE     = :RECITM-STATUS-CDE              35460099
354700           WHERE ORD_NBR        = :DK-ORD-NBR                     35470099
354800             AND ORD_LNE_NBR    = :DK-PO-LNE-NBR                  35480099
354900             AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                 35490099
355000             AND OPER_UNT_ID    = :ASC-KEY-OPER-UNT-ID            35500099
355100             AND FCLTY_ID       = :ASC-KEY-FCLTY-ID               35510099
355200             AND VER_STATUS_CDE = :PC-ACTIVE                      35520099
355300     END-EXEC.                                                    35530099
355400                                                                  35540099
355500     EVALUATE TRUE                                                35550099
355600         WHEN SQLCODE = +0                                        35560099
355700              CONTINUE                                            35570099
355800                                                                  35580099
355900         WHEN SQLWARN0 NOT = SPACES                               35590099
356000         WHEN SQLCODE < +0                                        35600099
356100         WHEN SQLCODE > +0                                        35610099
356200              MOVE '9005-UPDATE-STATUS-CDE'                       35620099
356300                               TO DP013-PARAGRAPH                 35630099
356400              MOVE 'UNSUCCESSFUL UPDATE FOR TRECITM'              35640099
356500                               TO DP013-MESSAGE-TEXT (1)          35650099
356600              MOVE SQLCA       TO DP013-SQLCA                     35660099
356700              MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)        35670099
356800              SET DP013-DB2-ABEND                                 35680099
356900                  DP013-XCTL-DISPLAY-RESTART                      35690099
357000                               TO TRUE                            35700099
357100              PERFORM DP013-0000-PROCESS-ABEND                    35710099
357200     END-EVALUATE.                                                35720099
357300/                                                                 35730099
357400*----------------------------------------------------------------*35740099
357500*    INSERT A RECEIPT ITEM ROW                                   *35750099
357600*----------------------------------------------------------------*35760099
357700                                                                  35770099
357800 9010-UPDATE-RECITM.                                              35780099
357900                                                                  35790099
358000* BEFORE IMAGE                                                    35800099
358100     MOVE 'I'                      TO RC031-TABLE-TO-AUDIT.       35810099
358200     MOVE 'B'                      TO RC031-AUD-TYP-CDE.          35820099
358300     MOVE 'U'                      TO RC031-AUD-FUNC-CDE.         35830099
358400     MOVE RECITM-ORD-NBR           TO RC031-PO-NBR.               35840099
358500     MOVE RECITM-ORD-LNE-NBR       TO RC031-PO-LNE-NBR.           35850099
358600     MOVE RECITM-REC-SEQ-NBR       TO RC031-REC-SEQ-NBR.          35860099
358700     MOVE RECITM-OPER-UNT-ID       TO RC031-OPER-UNT-ID.          35870099
358800     MOVE RECITM-FCLTY-ID          TO RC031-FCLTY-ID.             35880099
358900     MOVE PC-CURRENT-PROGRAM-NAME  TO RC031-UPD-PGM-ID.           35890099
359000                                                                  35900099
359100     PERFORM 9000-LINK-AUDIT.                                     35910099
359200                                                                  35920099
359300     EVALUATE TRUE                                                35930099
359400         WHEN RC031-CALL-SUCCESSFUL                               35940099
359500             CONTINUE                                             35950099
359600                                                                  35960099
359700         WHEN OTHER                                               35970099
359800              MOVE '9010-UPDATE-TRECITM'                          35980099
359900                                   TO DP013-PARAGRAPH             35990099
360000              MOVE 'UNSUCCESSFUL CALL TO AUDIT RTN'               36000099
360100                                   TO DP013-MESSAGE-TEXT (1)      36010099
360200              MOVE RC031-RETURN-DESC                              36020099
360300                                   TO DP013-MESSAGE-TEXT (2)      36030099
360400              MOVE RC031-SQLCA     TO DP013-SQLCA                 36040099
360500              SET DP013-DB2-ABEND                                 36050099
360600                  DP013-XCTL-DISPLAY-RESTART                      36060099
360700                                   TO TRUE                        36070099
360800              PERFORM DP013-0000-PROCESS-ABEND                    36080099
360900     END-EVALUATE.                                                36090099
361000                                                                  36100099
361100     EXEC SQL                                                     36110099
361200         UPDATE TRECITM                                           36120099
361300         SET PO_VER_NBR            = :RECITM-PO-VER-NBR           36130099
361400           , ITM_NBR               = :RECITM-ITM-NBR              36140099
361500           , INNR_PACK_QTY         = :RECITM-INNR-PACK-QTY        36150099
361600           , CASE_PACK_QTY         = :RECITM-CASE-PACK-QTY        36160099
361700           , PRE_TKT_IND           = :RECITM-PRE-TKT-IND          36170099
361800           , DTL_CK_ITM_QTY        = :RECITM-DTL-CK-ITM-QTY       36180099
361900           , DMG_ITM_QTY           = :RECITM-DMG-ITM-QTY          36190099
362000           , RTV_IND               = :RECITM-RTV-IND              36200099
362100           , RTV_QTY               = :RECITM-RTV-QTY              36210099
362200           , UNT_COST_AMT          = :RECITM-UNT-COST-AMT         36220099
362300           , PKSL_ITM_QTY          = :RECITM-PKSL-ITM-QTY         36230099
362400          WHERE ORD_NBR            = :DK-ORD-NBR                  36240099
362500            AND ORD_LNE_NBR        = :DK-PO-LNE-NBR               36250099
362600            AND REC_SEQ_NBR        = :DK-REC-SEQ-NBR              36260099
362700            AND OPER_UNT_ID        = :ASC-KEY-OPER-UNT-ID         36270099
362800            AND FCLTY_ID           = :ASC-KEY-FCLTY-ID            36280099
362900            AND VER_STATUS_CDE     = :PC-ACTIVE                   36290099
363000     END-EXEC.                                                    36300099
363100                                                                  36310099
363200     EVALUATE TRUE                                                36320099
363300         WHEN SQLCODE = ZERO                                      36330099
363400              CONTINUE                                            36340099
363500                                                                  36350099
363600         WHEN SQLWARN0 NOT = SPACES                               36360099
363700         WHEN SQLCODE < +0                                        36370099
363800         WHEN SQLCODE > +0                                        36380099
363900              MOVE '9010-UPDATE-RECITM'                           36390099
364000                               TO DP013-PARAGRAPH                 36400099
364100              MOVE 'UNSUCCESSFUL INSERT FOR TRECITM'              36410099
364200                               TO DP013-MESSAGE-TEXT (1)          36420099
364300              MOVE SQLCA       TO DP013-SQLCA                     36430099
364400              MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)        36440099
364500              SET DP013-DB2-ABEND                                 36450099
364600                  DP013-XCTL-DISPLAY-RESTART                      36460099
364700                               TO TRUE                            36470099
364800              PERFORM DP013-0000-PROCESS-ABEND                    36480099
364900     END-EVALUATE.                                                36490099
365000                                                                  36500099
365100 9100-LINK-TROUBLE.                                               36510099
365200     EXEC CICS                                                    36520099
365300         LINK PROGRAM  (PC-TROUBLE-RTN)                           36530099
365400              COMMAREA (TM500-FIELDS)                             36540099
365500              LENGTH   (PC-TROUBLE-RTN-LENGTH)                    36550099
365600     END-EXEC.                                                    36560099
365700                                                                  36570099
365800 9125-LINK-RECDIS-ALLOC.                                          36580099
365900     EXEC CICS                                                    36590099
366000         LINK PROGRAM  (PC-RECDIS-ALLOC)                          36600099
366100              COMMAREA (RC811-STORE-RECDIS-PROCESSING)            36610099
366200              LENGTH   (PC-RECDIS-ALLOC-LENGTH)                   36620099
366300     END-EXEC.                                                    36630099
366400                                                                  36640099
366500/                                                                 36650099
366600*----------------------------------------------------------------*36660099
366700*    READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE     *36670099
366800*----------------------------------------------------------------*36680099
366900                                                                  36690099
367000 9150-READ-SEL-QUEUE.                                             36700099
367100                                                                  36710099
367200     EXEC CICS                                                    36720099
367300         READQ TS                                                 36730099
367400             QUEUE (ASC-SEL-QUEUE-NAME)                           36740099
367500             INTO  (RC801-PREPACK-SELECT-RECORD)                  36750099
367600             ITEM  (ASC-SEL-ITEM)                                 36760099
367700             RESP  (PV-CICS-RESPONSE)                             36770099
367800     END-EXEC.                                                    36780099
367900                                                                  36790099
368000     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                       36800099
368100         CONTINUE                                                 36810099
368200     ELSE                                                         36820099
368300         SET DP013-LOGIC-ABEND                                    36830099
368400             DP013-NO-ROLLBACK     TO TRUE                        36840099
368500         MOVE '9150-READ-SEL-QUEUE'                               36850099
368600                                   TO DP013-PARAGRAPH             36860099
368700         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   36870099
368800                                   TO DP013-MESSAGE-TEXT (1)      36880099
368900         PERFORM DP013-0000-PROCESS-ABEND                         36890099
369000     END-IF.                                                      36900099
369100                                                                  36910099
369200/                                                                 36920099
369300*----------------------------------------------------------------*36930099
369400*    UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE     *36940099
369500*----------------------------------------------------------------*36950099
369600 9200-REWRITE-SEL-QUEUE.                                          36960099
369700                                                                  36970099
369800     EXEC CICS                                                    36980099
369900          WRITEQ TS                                               36990099
370000              QUEUE  (ASC-SEL-QUEUE-NAME)                         37000099
370100              FROM   (RC801-PREPACK-SELECT-RECORD)                37010099
370200              ITEM   (ASC-SEL-ITEM)                               37020099
370300              RESP   (PV-CICS-RESPONSE)                           37030099
370400              REWRITE                                             37040099
370500     END-EXEC.                                                    37050099
370600                                                                  37060099
370700     IF  PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                   37070099
370800         SET DP013-CICS-ABEND                                     37080099
370900             DP013-NO-ROLLBACK     TO TRUE                        37090099
371000         MOVE '9200-REWRITE-SEL-QUEUE'                            37100099
371100                                   TO DP013-PARAGRAPH             37110099
371200         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   37120099
371300                                   TO DP013-MESSAGE-TEXT (1)      37130099
371400         PERFORM DP013-0000-PROCESS-ABEND                         37140099
371500     END-IF.                                                      37150099
371600                                                                  37160099
371700/                                                                 37170099
371800*----------------------------------------------------------------*37180099
371900*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *37190099
372000*    AND THE ERROR SWITCHES.                                     *37200099
372100*----------------------------------------------------------------*37210099
372200 9900-SOFT-ABORT.                                                 37220099
372300     SET PS-ERROR            TO TRUE.                             37230099
372400     SET DP020-MSG-FATAL     TO TRUE.                             37240099
372500     MOVE PC-TSYMSG-00551    TO DP020-MSG-NUMBER.                 37250099
372600     SET DP020-NEXT-ACT-APPL-ERROR TO TRUE.                       37260099
372700     MOVE 'PROGRAM EXIT CALL'  TO DP013-MESSAGE-TEXT (1).         37270099
372800     PERFORM 0001-CALL-CICS-ARCH-API.                             37280099
372900                                                                  37290099
373000/                                                                 37300099
373100*----------------------------------------------------------------*37310099
373200*    ABEND PROCESSOR MODULE                                      *37320099
373300*----------------------------------------------------------------*37330099
373400                                                                  37340099
373500     COPY DPPD013.                                                37350099
