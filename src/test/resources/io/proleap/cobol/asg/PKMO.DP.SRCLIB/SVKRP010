000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.         SVKRP010.                                    00020000
000300 AUTHOR.             DAVID COLOMBO - COMPUWARE.                   00030000
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040000
000500 DATE-WRITTEN.       APRIL 2000.                                  00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800*----------------------------------------------------------------*00080000
000900* THIS PROGRAM WILL PRODUCE THE STORED VALUE FEE ADJUSTMENT      *00090000
001000*   REPORT.                                                      *00100000
001100*                                                                *00110000
001200* THERE WITH BE TWO REPORTS CREATED. ONE FOR KMRC AND THE OTHER  *00120000
001300* FOR GIFT CARDS.                                                *00130000
001400*                                                                *00140000
001500* THE PURPOSE OF THIS REPORT IS TO SHOW THE FEE ADJUSTMENTS      *00150000
001600* (IE: VOIDED FEES) TRANSACTIONS APPLIED TO A CARD. THE REPORT   *00160000
001700* WILL BE ORDERED BY ADJUSTMENT DATE, AUTHORIZER AND CARD NUMBER *00170000
001800* WITH TOTALS SHOWING THE NUMBER OF CARDS AND THE DOLLAR AMOUNT  *00180000
001900* ADJUSTED FOR THE WEEK.                                         *00190000
001910******************************************************************00191004
001920*                                                                *00192002
001930*  CHANGED 06/05/00 BY BARB SCHULTZ                              *00193004
001940*   WR#       ADDED ONE STATEMENT IN PARAGRAPH                   *00194004
001941*             C100-CRD-TYP-CDE-BREAK TO CORRECT PAGE BREAKING.   *00194104
001942*             ALSO ADDED A FEW STATEMENTS TO CHANGE A DATE WITH  *00194204
001943*             DASHES TO SLASHES IN B200-PROCESS-FEE-ADJUSTMENTS. *00194304
001960******************************************************************00196002
001970*  CHANGED 03/31/02 BY BARB ERTL                                 *00197005
001980*   WR# 22603 MULTI-CHANNEL GIFT CARD PROJECT                    *00198005
001990*             CHANGE TO USE NEW STORED VALUE TABLES.             *00199007
001991*                                                                *00199120
001992*  CHANGED 06/08/09 BY ROLF NOHE                                 *00199220
001993*   WR# 29062 - PROJECT 2317 - GIFT CARD NUMBERING TO 30 DIGITS. *00199320
001994*             RECOMPILE TO PICK UP CHANGES TO SVWS004.           *00199420
001995******************************************************************00199520
002000*----------------------------------------------------------------*00200000
002100 ENVIRONMENT DIVISION.                                            00210000
002200*----------------------------------------------------------------*00220000
002300 CONFIGURATION SECTION.                                           00230000
002400                                                                  00240000
002500 SOURCE-COMPUTER.    IBM-3090.                                    00250000
002600 OBJECT-COMPUTER.    IBM-3090.                                    00260000
002700                                                                  00270000
002800 INPUT-OUTPUT SECTION.                                            00280000
002900                                                                  00290000
003000 FILE-CONTROL.                                                    00300000
003100                                                                  00310000
003200     SELECT CONTROL-DATE-FILE         ASSIGN TO INP01.            00320000
003300     SELECT KMRC-REPORT-FILE          ASSIGN TO RPT01.            00330000
003400     SELECT GFTC-REPORT-FILE          ASSIGN TO RPT02.            00340000
003500                                                                  00350000
003600*----------------------------------------------------------------*00360000
003700 DATA DIVISION.                                                   00370000
003800*----------------------------------------------------------------*00380000
003900                                                                  00390000
004000 FILE SECTION.                                                    00400000
004100                                                                  00410000
004200                                                                  00420000
004300 FD  CONTROL-DATE-FILE                                            00430000
004400     RECORDING MODE IS F                                          00440000
004500     BLOCK CONTAINS 0 RECORDS                                     00450000
004600     LABEL RECORDS ARE OMITTED.                                   00460000
004700                                                                  00470000
004800 01  CONTROL-DATE-RECORD              PIC X(80).                  00480000
004900                                                                  00490000
005000 FD  KMRC-REPORT-FILE                                             00500000
005100     RECORDING MODE IS F                                          00510000
005200     BLOCK CONTAINS 0 RECORDS                                     00520000
005300     LABEL RECORDS ARE OMITTED.                                   00530000
005400                                                                  00540000
005500 01  KMRC-REPORT-RECORD               PIC X(132).                 00550000
005600                                                                  00560000
005700 FD  GFTC-REPORT-FILE                                             00570000
005800     RECORDING MODE IS F                                          00580000
005900     BLOCK CONTAINS 0 RECORDS                                     00590000
006000     LABEL RECORDS ARE OMITTED.                                   00600000
006100                                                                  00610000
006200 01  GFTC-REPORT-RECORD               PIC X(132).                 00620000
006300                                                                  00630000
006400                                                                  00640000
006500 WORKING-STORAGE SECTION.                                         00650000
006600                                                                  00660000
006700 01  ABEND-CODE                       PIC S9(04)    VALUE +0 COMP.00670000
006800                                                                  00680000
006900*----------------------------------------------------------------*00690000
007000*    CR-CONTROL RECORD   DATE IN MMDDCCYY FORMAT                 *00700000
007100*----------------------------------------------------------------*00710000
007200 01  CR-CONTROL-RECORD.                                           00720000
007300     05  CR-CONTROL-DATE.                                         00730000
007400         10  CR-CC                    PIC  X(02)    VALUE SPACES. 00740000
007500         10  CR-YY                    PIC  X(02)    VALUE SPACES. 00750000
007600         10  FILLER                   PIC  X(01)    VALUE SPACES. 00760000
007700         10  CR-MM                    PIC  X(02)    VALUE SPACES. 00770000
007800         10  FILLER                   PIC  X(01)    VALUE SPACES. 00780000
007900         10  CR-DD                    PIC  X(02)    VALUE SPACES. 00790000
008000     05  FILLER                       PIC  X(72)    VALUE SPACES. 00800000
008100                                                                  00810000
008200*----------------------------------------------------------------*00820000
008300*    PC-PROGRAM CONSTANTS                                        *00830000
008400*----------------------------------------------------------------*00840000
008500 01  PC-PROGRAM-CONSTANTS.                                        00850000
008600     05  PC-PROGRAM-NAME              PIC  X(08)     VALUE        00860000
008700                                                     'SVKRP010'.  00870000
008800     05  PC-CALENDAR-PGM              PIC  X(08)     VALUE        00880000
008900                                                     'DPKUT500'.  00890000
009000     05  PC-KMRC-REPORT-TITLE         PIC  X(45)     VALUE        00900000
009100         '   STORED VALUE KMRC FEE ADJUSTMENT REPORT   '.         00910000
009200     05  PC-GFTC-REPORT-TITLE         PIC  X(45)     VALUE        00920000
009300         ' STORED VALUE GIFTCARD FEE ADJUSTMENT REPORT '.         00930000
009400                                                                  00940000
009500     05      MOHEN                    PIC  X(01)     VALUE '-'.   00950000
009600     05  PC-SLASH                     PIC  X(01)     VALUE '/'.   00960000
009700     05  PC-ONE                       PIC  9(01)     VALUE 1.     00970000
009800     05  PC-TWO                       PIC  9(01)     VALUE 2.     00980000
009900     05  PC-HEADER-LINE-COUNT         PIC S9(03)     VALUE +7     00990000
010000                                                     COMP.        01000000
010100     05  PC-MAX-LINES-PER-PAGE        PIC S9(03)     VALUE +60    01010000
010200                                                     COMP.        01020000
010300                                                                  01030000
010400*----------------------------------------------------------------*01040000
010500*    RESPROGRAM VARIABLES                                        *01050000
010600*----------------------------------------------------------------*01060000
010700 01  PV-PROGRAM-VARIABLES.                                        01070000
010800     05  PV-PARAGRAPH-NAME            PIC  X(30)     VALUE SPACES.01080000
010900     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30)     VALUE SPACES.01090000
011000     05  PV-DISPLAY-CRD-NBR           PIC  9(12)     VALUE ZEROS. 01100000
011100                                                                  01110000
011200     05  PV-CURRENT-DATE.                                         01120000
011300         10  PV-CURRENT-YEAR          PIC  9(04)     VALUE ZERO.  01130000
011400         10  PV-CURRENT-MONTH         PIC  9(02)     VALUE ZERO.  01140000
011500         10  PV-CURRENT-DAY           PIC  9(02)     VALUE ZERO.  01150000
011600     05  PV-CURRENT-TIME.                                         01160000
011700         10  PV-CURRENT-HOUR          PIC  9(02)     VALUE ZERO.  01170000
011800         10  PV-CURRENT-MINUTE        PIC  9(02)     VALUE ZERO.  01180000
011900         10  FILLER                   PIC  9(04)     VALUE ZERO.  01190000
012000     05  PV-BEG-TIMESTAMP-DETAIL.                                 01200000
012100         10  PV-BEG-DTE.                                          01210000
012200             15  PV-BEG-CCYY          PIC  X(04).                 01220000
012300             15  FILLER               PIC  X(01)     VALUE '-'.   01230000
012400             15  PV-BEG-MM            PIC  X(02).                 01240000
012500             15  FILLER               PIC  X(01)     VALUE '-'.   01250000
012600             15  PV-BEG-DD            PIC  X(02).                 01260000
012700         10  FILLER                   PIC  X(01)     VALUE '-'.   01270000
012800         10  PV-BEG-TMST              PIC  X(15)     VALUE        01280000
012900             '00.00.00.000000'.                                   01290000
013000     05  PV-BEG-TIMESTAMP REDEFINES PV-BEG-TIMESTAMP-DETAIL       01300000
013100                                      PIC  X(26).                 01310000
013200                                                                  01320000
013300     05  PV-END-TIMESTAMP-DETAIL.                                 01330000
013400         10  PV-END-CC                PIC  X(02).                 01340000
013500         10  PV-END-YY                PIC  X(02).                 01350000
013600         10  FILLER                   PIC  X(01)     VALUE '-'.   01360000
013700         10  PV-END-MM                PIC  X(02).                 01370000
013800         10  FILLER                   PIC  X(01)     VALUE '-'.   01380000
013900         10  PV-END-DD                PIC  X(02).                 01390000
014000         10  FILLER                   PIC  X(01)     VALUE '-'.   01400000
014100         10  PV-END-TMST              PIC  X(15)     VALUE        01410000
014200             '23.59.59.999999'.                                   01420000
014300     05  PV-END-TIMESTAMP REDEFINES PV-END-TIMESTAMP-DETAIL       01430000
014400                                      PIC  X(26).                 01440000
014500                                                                  01450000
014600     05  PV-HOLD-APVL-USR-ID          PIC  X(08)     VALUE SPACES.01460000
014700     05  PV-HOLD-CRD-TYP-CDE          PIC S9(01)     VALUE ZEROS  01470006
014710                                                     COMP-3.      01471006
014800     05  PV-HOLD-CRD-NBR              PIC S9(12)     VALUE ZEROS  01480005
014900                                                     COMP-3.      01490000
015000     05  PV-HOLD-ADJ-DTE              PIC  X(10)     VALUE SPACES.01500000
015100     05  PV-CARD-BALANCE              PIC S9(07)V9(02)            01510000
015200                                                     VALUE ZERO   01520000
015300                                                     COMP-3.      01530000
015400     05  PV-TOTAL-ADJ-FEES            PIC S9(07)V9(02)            01540000
015500                                                     VALUE ZERO   01550000
015600                                                     COMP-3.      01560000
015700     05  PV-ISSUE-AMT                 PIC S9(07)V9(02)            01570000
015800                                                     VALUE ZERO   01580000
015900                                                     COMP-3.      01590000
016000     05  PV-ISSUE-DATE                PIC  X(26).                 01600016
016010     05  PV-ISSUE-DATE-R REDEFINES PV-ISSUE-DATE.                 01601019
016020         10  PV-ISSUE-DTE             PIC  X(10).                 01602019
016030         10  FILLER                   PIC  X(16).                 01603019
016100     05  PV-LAST-DTE                  PIC  X(10)     VALUE SPACES.01610000
016200     05  PV-ADJUST-DTE                PIC  X(10)     VALUE SPACES.01620000
016300                                                                  01630000
016400*----------------------------------------------------------------*01640000
016500*    PS-PROGRAM SWITCHES                                         *01650000
016600*----------------------------------------------------------------*01660000
016700 01  PS-PROGRAM-SWITCHES.                                         01670000
016800     05  PS-END-OF-CONTROL-FILE-SW    PIC  X(01)     VALUE 'N'.   01680000
016900         88  PS-END-OF-CONTROL-FILE                  VALUE 'Y'.   01690000
017000     05  PS-END-OF-FEE-CSR-SW         PIC  X(01)     VALUE 'N'.   01700000
017100         88  PS-END-OF-FEE-CSR                       VALUE 'Y'.   01710000
017200         88  PS-NOT-END-OF-FEE-CSR                   VALUE 'N'.   01720000
017300     05  PS-KMRC-TOTALS-PRNTED-SW     PIC  X(01)     VALUE 'N'.   01730000
017400         88  PS-KMRC-TOTALS-PRNTED                   VALUE 'Y'.   01740000
017500     05  PS-GFTC-TOTALS-PRNTED-SW     PIC  X(01)     VALUE 'N'.   01750000
017600         88  PS-GFTC-TOTALS-PRNTED                   VALUE 'Y'.   01760000
017700                                                                  01770000
017800*----------------------------------------------------------------*01780000
017900*    PA-PROGRAM ACCUMULATORS                                     *01790000
018000*----------------------------------------------------------------*01800000
018100 01  PA-PROGRAM-ACCUMULATORS.                                     01810000
018200     05  PA-TOTAL-CRD-CNT             PIC S9(07)     VALUE ZEROS  01820000
018300                                                     COMP-3.      01830000
018400     05  PA-TOTAL-FEE-AMT             PIC S9(07)V99  VALUE ZEROS  01840000
018500                                                     COMP-3.      01850000
018600     05  PA-RECS-FETCHED              PIC S9(11)     COMP-3       01860000
018700                                                     VALUE ZEROES.01870000
018800     05  PA-LINE-COUNTER              PIC S9(11)     COMP-3       01880000
018900                                                     VALUE ZEROES.01890000
019000     05  PA-PAGE-COUNTER              PIC S9(11)     COMP-3       01900000
019100                                                     VALUE ZEROES.01910000
019200*----------------------------------------------------------------*01920000
019300*    STANDARD HEADER FOR 132 COLUMN REPORT                       *01930000
019400*----------------------------------------------------------------*01940000
019500     COPY DPWS132.                                                01950000
019600                                                                  01960000
019700 01  REPORT-TITLE-LINE.                                           01970000
019800     05  FILLER                         PIC  X(44)   VALUE SPACES.01980000
019900     05  RTH-TITLE                      PIC  X(45)   VALUE SPACES.01990000
020000     05  FILLER                         PIC  X(43)   VALUE SPACES.02000000
020100                                                                  02010000
020200 01  REPORT-SUBTITLE-LINE.                                        02020000
020300     05  FILLER                         PIC  X(54)   VALUE SPACES.02030000
020400     05  FILLER                         PIC  X(14)   VALUE        02040000
020500         'WEEK ENDING:  '.                                        02050000
020600     05  RSL-DATE-MM                    PIC  X(02)   VALUE SPACES.02060000
020700     05  FILLER                         PIC  X(01)   VALUE '/'.   02070000
020800     05  RSL-DATE-DD                    PIC  X(02)   VALUE SPACES.02080000
020900     05  FILLER                         PIC  X(01)   VALUE '/'.   02090000
021000     05  RSL-DATE-CC                    PIC  X(02)   VALUE SPACES.02100000
021100     05  RSL-DATE-YY                    PIC  X(02)   VALUE SPACES.02110000
021200     05  FILLER                         PIC  X(54)   VALUE SPACES.02120000
021300                                                                  02130000
021400*----------------------------------------------------------------*02140000
021500*    HEADERS                                                     *02150000
021600*----------------------------------------------------------------*02160000
021700 01  REPORT-DETAIL-HEADER-1.                                      02170000
021800     05  FILLER                         PIC  X(03)   VALUE SPACES.02180000
021900     05  FILLER                         PIC  X(08)   VALUE        02190000
022000         'ADJUSTED'.                                              02200000
022100     05  FILLER                         PIC  X(26)   VALUE SPACES.02210011
022200     05  FILLER                         PIC  X(03)   VALUE 'FEE'. 02220000
022300     05  FILLER                         PIC  X(12)   VALUE SPACES.02230000
022400     05  FILLER                         PIC  X(03)   VALUE 'FEE'. 02240000
022500     05  FILLER                         PIC  X(07)   VALUE SPACES.02250000
022600     05  FILLER                         PIC  X(09)   VALUE        02260000
022700         'TOTAL FEE'.                                             02270000
022800     05  FILLER                         PIC  X(13)   VALUE SPACES.02280011
022810     05  FILLER                         PIC  X(11)   VALUE        02281010
022811         'MOST RECENT'.                                           02281109
022820     05  FILLER                         PIC  X(05)   VALUE SPACES.02282011
022900     05  FILLER                         PIC  X(05)   VALUE        02290000
023000         'ISSUE'.                                                 02300000
023100     05  FILLER                         PIC  X(08)   VALUE SPACES.02310000
023200     05  FILLER                         PIC  X(04)   VALUE        02320000
023300         'CARD'.                                                  02330000
023400     05  FILLER                         PIC  X(08)   VALUE SPACES.02340000
023500     05  FILLER                         PIC  X(04)   VALUE 'LAST'.02350000
023600     05  FILLER                         PIC  X(05)   VALUE SPACES.02360000
023700                                                                  02370000
023800 01  REPORT-DETAIL-HEADER-2.                                      02380000
023900     05  FILLER                         PIC  X(05)   VALUE SPACES.02390000
024000     05  FILLER                         PIC  X(04)   VALUE 'DATE'.02400000
024100     05  FILLER                         PIC  X(12)   VALUE SPACES.02410011
024200     05  FILLER                         PIC  X(07)   VALUE        02420000
024300         'CARD ID'.                                               02430000
024400     05  FILLER                         PIC  X(06)   VALUE SPACES.02440000
024500     05  FILLER                         PIC  X(10)   VALUE        02450000
024600         'ISSUE DATE'.                                            02460000
024700     05  FILLER                         PIC  X(04)   VALUE SPACES.02470000
024800     05  FILLER                         PIC  X(10)   VALUE        02480000
024900         'ADJUSTMENT'.                                            02490000
025000     05  FILLER                         PIC  X(03)   VALUE SPACES.02500000
025100     05  FILLER                         PIC  X(10)   VALUE        02510000
025200         'ADJUSTMENT'.                                            02520000
025300     05  FILLER                         PIC  X(03)   VALUE SPACES.02530000
025400     05  FILLER                         PIC  X(07)   VALUE        02540000
025500         'USER ID'.                                               02550000
025600     05  FILLER                         PIC  X(03)   VALUE SPACES.02560000
025700     05  FILLER                         PIC  X(10)   VALUE        02570000
025800         'ISSUE DATE'.                                            02580000
025900     05  FILLER                         PIC  X(06)   VALUE SPACES.02590000
026000     05  FILLER                         PIC  X(06)   VALUE        02600000
026100         'AMOUNT'.                                                02610000
026200     05  FILLER                         PIC  X(06)   VALUE SPACES.02620000
026300     05  FILLER                         PIC  X(07)   VALUE        02630000
026400         'BALANCE'.                                               02640000
026500     05  FILLER                         PIC  X(04)   VALUE SPACES.02650000
026600     05  FILLER                         PIC  X(08)   VALUE        02660000
026700         'ACTIVITY'.                                              02670000
026800     05  FILLER                         PIC  X(05)   VALUE SPACES.02680000
026900                                                                  02690000
027000*----------------------------------------------------------------*02700000
027100*    DETAIL LINE                                                 *02710000
027200*----------------------------------------------------------------*02720000
027300 01  REPORT-DETAIL-LINE.                                          02730000
027400     05  FILLER                         PIC  X(02)   VALUE SPACES.02740000
027500     05  RDL-ADJ-DATE.                                            02750000
027600         10  RDL-ADJ-DTE-MM             PIC  X(02)   VALUE SPACES.02760000
027700         10  RDL-ADJ-DTE-SLASH1         PIC  X(01)   VALUE '/'.   02770000
027800         10  RDL-ADJ-DTE-DD             PIC  X(02)   VALUE SPACES.02780000
027900         10  RDL-ADJ-DTE-SLASH2         PIC  X(01)   VALUE '/'.   02790000
028000         10  RDL-ADJ-DTE-CCYY           PIC  X(04)   VALUE SPACES.02800000
028100     05  FILLER                         PIC  X(05)   VALUE SPACES.02810000
028200     05  RDL-CRD-NBR-X                  PIC  X(12)   VALUE SPACES.02820005
028300     05  RDL-CRD-NBR REDEFINES RDL-CRD-NBR-X                      02830000
028400                                        PIC  Z(12).               02840008
028500     05  FILLER                         PIC  X(05)   VALUE SPACES.02850000
028600     05  RDL-FEE-DATE.                                            02860000
028700         10  RDL-FEE-DTE-MM             PIC  X(02)   VALUE SPACES.02870000
028800         10  RDL-FEE-DTE-SLASH1         PIC  X(01)   VALUE '/'.   02880000
028900         10  RDL-FEE-DTE-DD             PIC  X(02)   VALUE SPACES.02890000
029000         10  RDL-FEE-DTE-SLASH2         PIC  X(01)   VALUE '/'.   02900000
029100         10  RDL-FEE-DTE-CCYY           PIC  X(04)   VALUE SPACES.02910000
029200     05  FILLER                         PIC  X(08)   VALUE SPACES.02920000
029300     05  RDL-FEE-AMT                    PIC  ZZZ.99  VALUE ZEROS. 02930000
029400     05  FILLER                         PIC  X(06)   VALUE SPACES.02940000
029500     05  RDL-TOTAL-FEE-AMT-X            PIC  X(07)   VALUE SPACES.02950000
029600     05  RDL-TOTAL-FEE-AMT REDEFINES RDL-TOTAL-FEE-AMT-X          02960000
029700                                        PIC  ZZZZ.99.             02970000
029800     05  FILLER                         PIC  X(03)   VALUE SPACES.02980000
029900     05  RDL-USER-ID                    PIC  X(08)   VALUE SPACES.02990000
030000     05  FILLER                         PIC  X(02)   VALUE SPACES.03000000
030100     05  RDL-ISSUE-DATE.                                          03010000
030200         10  RDL-ISS-DTE-MM             PIC  X(02)   VALUE SPACES.03020000
030300         10  RDL-ISS-DTE-SLASH1         PIC  X(01)   VALUE '/'.   03030000
030400         10  RDL-ISS-DTE-DD             PIC  X(02)   VALUE SPACES.03040000
030500         10  RDL-ISS-DTE-SLASH2         PIC  X(01)   VALUE '/'.   03050000
030600         10  RDL-ISS-DTE-CCYY           PIC  X(04)   VALUE SPACES.03060000
030700     05  FILLER                         PIC  X(02)   VALUE SPACES.03070000
030800     05  RDL-ISSUE-AMT-X                PIC  X(10)   VALUE SPACES.03080000
030900     05  RDL-ISSUE-AMT REDEFINES RDL-ISSUE-AMT-X                  03090000
031000                                        PIC  ZZZ,ZZZ.99.          03100000
031100     05  FILLER                         PIC  X(03)   VALUE SPACES.03110000
031200     05  RDL-CARD-BALANCE-X             PIC  X(10)   VALUE SPACES.03120000
031300     05  RDL-CARD-BALANCE REDEFINES RDL-CARD-BALANCE-X            03130000
031400                                        PIC  ZZZ,ZZZ.99.          03140000
031500     05  FILLER                         PIC  X(03)   VALUE SPACES.03150000
031600     05  RDL-LAST-DATE.                                           03160000
031700         10  RDL-LST-DTE-MM             PIC  X(02)   VALUE SPACES.03170000
031800         10  RDL-LST-DTE-SLASH1         PIC  X(01)   VALUE '/'.   03180000
031900         10  RDL-LST-DTE-DD             PIC  X(02)   VALUE SPACES.03190000
032000         10  RDL-LST-DTE-SLASH2         PIC  X(01)   VALUE '/'.   03200000
032100         10  RDL-LST-DTE-CCYY           PIC  X(04)   VALUE SPACES.03210000
032200     05  FILLER                         PIC  X(05)   VALUE SPACES.03220000
032300                                                                  03230000
032400*----------------------------------------------------------------*03240000
032500*    TOTAL LINES                                                 *03250000
032600*----------------------------------------------------------------*03260000
032700 01  REPORT-TOTAL-LINE.                                           03270000
032800     05  FILLER                         PIC  X(02)   VALUE SPACES.03280000
032900     05  FILLER                         PIC  X(21)   VALUE        03290000
033000         'WEEK ENDING TOTALS:  '.                                 03300000
033100     05  RTL-NUM-CARDS                  PIC  ZZZ,ZZ9 VALUE ZEROS. 03310000
033200     05  FILLER                         PIC  X(03)   VALUE SPACES.03320012
033300     05  FILLER                         PIC  X(14)   VALUE        03330000
033400         'CARDS VOIDED  '.                                        03340000
033500     05  RTL-FEE-AMT-ADJUSTED           PIC  ZZZZ,ZZZ.99          03350000
033600                                                     VALUE ZEROS. 03360000
033700     05  FILLER                         PIC  X(74)   VALUE SPACES.03370012
033800                                                                  03380000
033900 01  REPORT-TOTAL-DASH-LINE.                                      03390000
034000     05  FILLER                         PIC  X(47)   VALUE SPACES.03400013
034100     05  FILLER                         PIC  X(11)   VALUE ALL    03410000
034200         '-'.                                                     03420000
034300     05  FILLER                         PIC  X(74)   VALUE SPACES.03430013
034400                                                                  03440000
034500 01  REPORT-BLANK-LINE.                                           03450000
034600     05  FILLER                         PIC  X(132)  VALUE SPACES.03460000
034700*----------------------------------------------------------------*03470000
034800*    STORED VALUE CARD CONSTANTS                                 *03480005
034900*----------------------------------------------------------------*03490000
035000     COPY SVWS004.                                                03500005
035100                                                                  03510000
035200*----------------------------------------------------------------*03520000
035300*    DATE ROUTINE COPY MEMBERS                                   *03530000
035400*----------------------------------------------------------------*03540000
035500     COPY DPWS500.                                                03550000
035600                                                                  03560000
035700*----------------------------------------------------------------*03570000
035800*    VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004     *03580000
035900*----------------------------------------------------------------*03590000
036000     COPY DPWS004.                                                03600000
036100                                                                  03610000
036200*----------------------------------------------------------------*03620000
036300*    RD-KOHL'S STORED VALUE CARD ACTIVITY TABLE                  *03630005
036400*----------------------------------------------------------------*03640000
036500     EXEC SQL                                                     03650000
036600         INCLUDE SVT00002                                         03660005
036700     END-EXEC.                                                    03670000
036800                                                                  03680000
036900*----------------------------------------------------------------*03690000
037000*    RD-KOHL'S STORED VALUE CARD TABLE                           *03700005
037100*----------------------------------------------------------------*03710000
037200     EXEC SQL                                                     03720000
037300         INCLUDE SVT00001                                         03730005
037400     END-EXEC.                                                    03740000
037500                                                                  03750000
037600*----------------------------------------------------------------*03760000
037700*    CURSOR TO ACCESS THE FEE ADJUSTMENTS                        *03770000
037800*----------------------------------------------------------------*03780000
037900     EXEC SQL                                                     03790000
038000       DECLARE FEE-CSR CURSOR FOR                                 03800000
038100            SELECT T.CRD_TYP_CDE                                  03810000
038200                  ,DATE(A.TRN_AUTH_TMST)                          03820000
038300                  ,A.APVL_USR_ID                                  03830000
038400                  ,A.CRD_NBR                                      03840000
038500                  ,A.POS_DTE                                      03850000
038600                  ,A.APP_AUTH_AMT                                 03860000
038700             FROM  SVT_KOHLS_CRD_TXN A                            03870005
038800                  ,SVT_KOHLS_CRD_ACCT T                           03880005
038900            WHERE  A.TRN_AUTH_TMST BETWEEN :PV-BEG-TIMESTAMP      03890000
039000                                       AND :PV-END-TIMESTAMP      03900000
039100              AND  A.ACTVY_TYP_CDE     = :SV004-SRV-FEE-ACT-TYP-N 03910005
039200              AND  A.TRN_RVRSL_CDE     = :SV004-REV-CDE-REVERSAL  03920005
039300              AND  A.TRN_VOID_IND      = :SV004-VOID-TRANS        03930005
039400              AND  A.CRD_NBR           = T.CRD_NBR                03940000
039500         ORDER BY  T.CRD_TYP_CDE ,2 ,A.APVL_USR_ID ,A.CRD_NBR     03950000
039600          WITH UR                                                 03960000
039700     END-EXEC.                                                    03970000
039800                                                                  03980000
039900*----------------------------------------------------------------*03990000
040000*    STANDARD LAYOUT FOR THE SQL COMMUNCATIONS AREA              *04000000
040100*----------------------------------------------------------------*04010000
040200     EXEC SQL                                                     04020000
040300         INCLUDE SQLCA                                            04030000
040400     END-EXEC.                                                    04040000
040500                                                                  04050000
040600     COPY SQLCA2.                                                 04060000
040700                                                                  04070000
040800 PROCEDURE DIVISION.                                              04080000
040900                                                                  04090000
041000 A100-MAINLINE.                                                   04100000
041100                                                                  04110000
041200     PERFORM B100-INITIALIZE.                                     04120000
041300                                                                  04130000
041400     IF PS-NOT-END-OF-FEE-CSR                                     04140000
041500         PERFORM B200-PROCESS-FEE-ADJUSTMENTS                     04150000
041600             UNTIL PS-END-OF-FEE-CSR                              04160000
041700         PERFORM B300-FINISH-REPORTS                              04170000
041800     END-IF.                                                      04180000
041900                                                                  04190000
042000     PERFORM B900-EOJ-ROUTINE.                                    04200000
042100                                                                  04210000
042200     GOBACK.                                                      04220000
042300                                                                  04230000
042400*----------------------------------------------------------------*04240000
042500*     B100-INITIALIZE                                            *04250000
042600* ==> PROCESSES:                                                 *04260000
042700*     - READS CONTROL DATE FROM CONTROL RECORD                   *04270000
042800*     - ACCEPTS THE CURRENT DATE AND TIME FOR THE REPORT HEADING *04280000
042900*     - OPEN THE FEE-CSR                                         *04290000
043000*     - FETCH THE FIRST FEE ROW. IF ONE IS NOT FOUND, ISSUE      *04300000
043100*       MESSAGE.                                                 *04310000
043200*----------------------------------------------------------------*04320000
043300 B100-INITIALIZE.                                                 04330000
043400                                                                  04340000
043500     OPEN INPUT CONTROL-DATE-FILE.                                04350000
043600     OPEN OUTPUT KMRC-REPORT-FILE                                 04360000
043700                 GFTC-REPORT-FILE.                                04370000
043800                                                                  04380000
043900     READ CONTROL-DATE-FILE INTO CR-CONTROL-RECORD                04390000
044000         AT END                                                   04400000
044100             SET PS-END-OF-CONTROL-FILE TO TRUE.                  04410000
044200                                                                  04420000
044300     IF PS-END-OF-CONTROL-FILE                                    04430000
044400         DISPLAY ' '                                              04440000
044500         DISPLAY '** ABEND     **'                                04450000
044600         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            04460000
044700         DISPLAY '** PARAGRAPH **  = B100-INITIALIZE      '       04470000
044800         DISPLAY '** CONTROL DATE FILE IS EMPTY  '                04480000
044900         DISPLAY ' '                                              04490000
045000         MOVE +4002 TO ABEND-CODE                                 04500000
045100         CALL 'ILBOABN0' USING ABEND-CODE                         04510000
045200     ELSE                                                         04520000
045300         DISPLAY PC-PROGRAM-NAME ' CONTROL DATE:  '               04530000
045400                 CR-CONTROL-DATE                                  04540000
045500     END-IF.                                                      04550000
045600                                                                  04560000
045700     INITIALIZE DPG51 DPG52 DPG53                                 04570000
045800                DPG54 DPG55 DPG56.                                04580000
045900     SET DPG51-ACTUAL-CALENDAR-ONLY                               04590000
046000                                   TO TRUE.                       04600000
046100     SET DPG51-DO-NOT-INCR-DECR-DATE                              04610000
046200                                   TO TRUE.                       04620000
046300     MOVE ZEROES                   TO DPG51-INCR-DECR-DAYS-9      04630000
046400                                      DPG51-INCR-DECR-BUS-DAYS-9. 04640000
046500     MOVE CR-CONTROL-DATE          TO DPG52-LK-DATE-INPUT.        04650000
046600     SET DPG52-LK-DTE-ISO-FMT      TO TRUE.                       04660000
046700     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    04670000
046800                                       DPG54 DPG55 DPG56.         04680000
046900                                                                  04690000
047000     EVALUATE TRUE                                                04700000
047100         WHEN DPG54-SEVERE-ERROR                                  04710000
047200         WHEN DPG54-WARNING-ERROR                                 04720000
047300             DISPLAY ' '                                          04730000
047400             DISPLAY '** ABEND     **'                            04740000
047500             DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME        04750000
047600             DISPLAY '** PARAGRAPH **  = B100-INITIALIZE'         04760000
047700             DISPLAY '** BAD CALL TO CALENDAR MODULE '            04770000
047800                     PC-CALENDAR-PGM                              04780000
047900             DISPLAY '** DETERMINE VALID DATE **'                 04790000
048000             DISPLAY 'CR-CONTROL-DATE = ' CR-CONTROL-DATE         04800000
048100             DISPLAY DPG54-ERROR-MESSAGE                          04810000
048200             DISPLAY ' '                                          04820000
048300             MOVE +4019            TO ABEND-CODE                  04830000
048400             CALL 'ILBOABN0' USING ABEND-CODE                     04840000
048500     END-EVALUATE.                                                04850000
048600                                                                  04860000
048700     MOVE CR-CC                    TO RSL-DATE-CC                 04870000
048800                                      PV-END-CC.                  04880000
048900     MOVE CR-YY                    TO RSL-DATE-YY                 04890000
049000                                      PV-END-YY.                  04900000
049100     MOVE CR-MM                    TO RSL-DATE-MM                 04910000
049200                                      PV-END-MM.                  04920000
049300     MOVE CR-DD                    TO RSL-DATE-DD                 04930000
049400                                      PV-END-DD.                  04940000
049500     MOVE DPG55-1ST-WKDY-DB2ISO-FMT-YR                            04950000
049600                                   TO PV-BEG-CCYY.                04960000
049700     MOVE DPG55-1ST-WKDY-DB2ISO-FMT-MO                            04970000
049800                                   TO PV-BEG-MM.                  04980000
049900     MOVE DPG55-1ST-WKDY-DB2ISO-FMT-DY                            04990000
050000                                   TO PV-BEG-DD.                  05000000
050100                                                                  05010000
050200     DISPLAY PC-PROGRAM-NAME ' WEEK BEG DATE:  '                  05020000
050300                                    PV-BEG-TIMESTAMP.             05030000
050400     DISPLAY PC-PROGRAM-NAME ' WEEK END DATE:  '                  05040000
050500                                    PV-END-TIMESTAMP.             05050000
050600                                                                  05060000
050700     MOVE FUNCTION CURRENT-DATE (1:8)                             05070000
050800                                   TO PV-CURRENT-DATE.            05080000
050900     MOVE PV-CURRENT-YEAR          TO DP132-RUN-YEAR.             05090000
051000     MOVE PV-CURRENT-MONTH         TO DP132-RUN-MONTH.            05100000
051100     MOVE PV-CURRENT-DAY           TO DP132-RUN-DAY.              05110000
051200                                                                  05120000
051300     ACCEPT PV-CURRENT-TIME      FROM TIME.                       05130000
051400     MOVE PV-CURRENT-HOUR          TO DP132-RUN-HOUR.             05140000
051500     MOVE PV-CURRENT-MINUTE        TO DP132-RUN-MINUTE.           05150000
051600                                                                  05160000
051700     MOVE PC-PROGRAM-NAME          TO DP132-PROGRAM-NAME.         05170000
051800                                                                  05180000
051900     EXEC SQL                                                     05190000
052000         OPEN FEE-CSR                                             05200000
052100     END-EXEC.                                                    05210000
052200     EVALUATE TRUE                                                05220000
052300         WHEN SQLCODE = 0                                         05230000
052400             CONTINUE                                             05240000
052500         WHEN OTHER                                               05250000
052600             DISPLAY ' '                                          05260000
052700             MOVE 'B100-INITIALIZE               '                05270000
052800                                   TO PV-PARAGRAPH-NAME           05280000
052900             MOVE 'OPEN CURSOR TO ACTIVITY TABLE  '               05290005
053000                                   TO PV-DB2-OPERATION-ATTEMPTED  05300000
053100             PERFORM Z900-SQL-ABEND                               05310000
053200     END-EVALUATE.                                                05320000
053300                                                                  05330000
053400     PERFORM D100-FETCH-FEE-CURSOR.                               05340000
053500                                                                  05350000
053600     MOVE SV004-GIFT-CRD-TYP       TO PV-HOLD-CRD-TYP-CDE.        05360005
053700     PERFORM F100-PROCESS-PAGE-BREAK.                             05370000
053800     MOVE ZERO                     TO PA-PAGE-COUNTER.            05380000
053900     MOVE SV004-KMRC-CRD-TYP       TO PV-HOLD-CRD-TYP-CDE.        05390005
054000     PERFORM F100-PROCESS-PAGE-BREAK.                             05400000
054100                                                                  05410000
054200     IF PS-END-OF-FEE-CSR                                         05420000
054300         DISPLAY ' '                                              05430000
054400         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            05440000
054500         DISPLAY '** FIRST FETCH FOUND NO FEE RECORDS'            05450000
054600         DISPLAY ' '                                              05460000
054700         MOVE SV004-KMRC-CRD-TYP   TO PV-HOLD-CRD-TYP-CDE         05470005
054800         PERFORM E100-PRINT-TOTALS                                05480000
054900         MOVE SV004-GIFT-CRD-TYP   TO PV-HOLD-CRD-TYP-CDE         05490005
055000         PERFORM E100-PRINT-TOTALS                                05500000
055100     ELSE                                                         05510000
055200         MOVE SVT00001-CRD-TYP-CDE TO PV-HOLD-CRD-TYP-CDE         05520005
055300     END-IF.                                                      05530000
055400                                                                  05540000
055500*----------------------------------------------------------------*05550000
055600*     B200-PROCESS-FEE-ADJUSTMENTS                               *05560000
055700* ==> PROCESSES:                                                 *05570000
055800*     - PROCESSES THE FEE ADJUSTMENT RECORDS FOR PRINTING        *05580000
055900*----------------------------------------------------------------*05590000
056000 B200-PROCESS-FEE-ADJUSTMENTS.                                    05600000
056100                                                                  05610000
056200     IF SVT00001-CRD-TYP-CDE = PV-HOLD-CRD-TYP-CDE                05620005
056300         CONTINUE                                                 05630000
056400     ELSE                                                         05640000
056500         PERFORM E100-PRINT-TOTALS                                05650000
056600         PERFORM C100-CRD-TYP-CDE-BREAK                           05660000
056700     END-IF.                                                      05670000
056800                                                                  05680000
056900     IF PV-ADJUST-DTE = PV-HOLD-ADJ-DTE                           05690000
057000         MOVE SPACES               TO RDL-ADJ-DATE                05700000
057100     ELSE                                                         05710000
057200         PERFORM C200-ADJUSTMENT-DATE-BREAK                       05720000
057300     END-IF.                                                      05730000
057400                                                                  05740000
057500     IF SVT00002-APVL-USR-ID = PV-HOLD-APVL-USR-ID                05750005
057600         MOVE SPACES               TO RDL-USER-ID                 05760000
057700     ELSE                                                         05770000
057800         PERFORM C300-APVL-USR-ID-BREAK                           05780000
057900     END-IF.                                                      05790000
058000                                                                  05800000
058100     IF SVT00002-CRD-NBR = PV-HOLD-CRD-NBR                        05810005
058200         MOVE SPACES               TO RDL-CRD-NBR-X               05820000
058300                                      RDL-TOTAL-FEE-AMT-X         05830000
058400                                      RDL-ISSUE-DATE              05840000
058500                                      RDL-ISSUE-AMT-X             05850000
058600                                      RDL-CARD-BALANCE-X          05860000
058700                                      RDL-LAST-DATE               05870000
058800     ELSE                                                         05880000
058900         PERFORM C400-CARD-NBR-BREAK                              05890000
059000     END-IF.                                                      05900000
059100                                                                  05910000
059200     MOVE SVT00002-POS-DTE(1:4)    TO RDL-FEE-DTE-CCYY.           05920005
059300     MOVE SVT00002-POS-DTE(6:2)    TO RDL-FEE-DTE-MM.             05930005
059400     MOVE SVT00002-POS-DTE(9:2)    TO RDL-FEE-DTE-DD.             05940005
059500     MOVE PC-SLASH                 TO RDL-FEE-DTE-SLASH1          05950000
059600                                      RDL-FEE-DTE-SLASH2.         05960000
059700     MOVE SVT00002-APP-AUTH-AMT    TO RDL-FEE-AMT.                05970005
059800     ADD SVT00002-APP-AUTH-AMT     TO PA-TOTAL-FEE-AMT.           05980005
059900                                                                  05990000
060000     IF PA-LINE-COUNTER > PC-MAX-LINES-PER-PAGE                   06000000
060100         PERFORM F100-PROCESS-PAGE-BREAK                          06010000
060220         MOVE PV-ADJUST-DTE(1:4)   TO RDL-ADJ-DTE-CCYY            06022003
060230         MOVE PV-ADJUST-DTE(6:2)   TO RDL-ADJ-DTE-MM              06023003
060240         MOVE PV-ADJUST-DTE(9:2)   TO RDL-ADJ-DTE-DD              06024003
060250         MOVE PC-SLASH             TO RDL-ADJ-DTE-SLASH1          06025003
060260                                      RDL-ADJ-DTE-SLASH2          06026003
060300         MOVE PV-HOLD-CRD-NBR      TO RDL-CRD-NBR                 06030000
060400     END-IF.                                                      06040000
060500                                                                  06050000
060600     IF PV-HOLD-CRD-TYP-CDE = SV004-KMRC-CRD-TYP                  06060005
060700         WRITE KMRC-REPORT-RECORD FROM REPORT-DETAIL-LINE         06070000
060800             AFTER ADVANCING 1 LINE                               06080000
060900     ELSE                                                         06090000
061000         WRITE GFTC-REPORT-RECORD FROM REPORT-DETAIL-LINE         06100000
061100             AFTER ADVANCING 1 LINE                               06110000
061200     END-IF.                                                      06120000
061300                                                                  06130000
061400     ADD +1                        TO PA-LINE-COUNTER.            06140000
061500                                                                  06150000
061600     PERFORM D100-FETCH-FEE-CURSOR.                               06160000
061700                                                                  06170000
061800*----------------------------------------------------------------*06180000
061900*     B300-FINISH-REPORTS                                        *06190000
062000* ==> PROCESSES:                                                 *06200000
062100*     - PRINT FINAL TOTALS FROM END OF CUROR PROCESSING          *06210000
062200*     - PRINT FINAL TOTALS IF CARD TYPE WAS NOT PROCESSED        *06220000
062300*----------------------------------------------------------------*06230000
062400 B300-FINISH-REPORTS.                                             06240000
062500                                                                  06250000
062600      PERFORM E100-PRINT-TOTALS.                                  06260000
062700                                                                  06270000
062800      IF PS-KMRC-TOTALS-PRNTED                                    06280000
062900          CONTINUE                                                06290000
063000      ELSE                                                        06300000
063100          MOVE SV004-KMRC-CRD-TYP  TO PV-HOLD-CRD-TYP-CDE         06310005
063200          PERFORM E100-PRINT-TOTALS                               06320000
063300      END-IF.                                                     06330000
063400                                                                  06340000
063500      IF PS-GFTC-TOTALS-PRNTED                                    06350000
063600          CONTINUE                                                06360000
063700      ELSE                                                        06370000
063800          MOVE SV004-GIFT-CRD-TYP  TO PV-HOLD-CRD-TYP-CDE         06380005
063900          PERFORM E100-PRINT-TOTALS                               06390000
064000      END-IF.                                                     06400000
064100                                                                  06410000
064200*----------------------------------------------------------------*06420000
064300*     B900-EOJ-ROUTINE                                           *06430000
064400* ==> PROCESSES:                                                 *06440000
064500*     - CLOSES THE FILES                                         *06450000
064600*     - DISPLAYS THE NUMBER OF RECORDS READ                      *06460000
064700*----------------------------------------------------------------*06470000
064800 B900-EOJ-ROUTINE.                                                06480000
064900                                                                  06490000
065000     DISPLAY ' '.                                                 06500000
065100     DISPLAY 'MESSAGES FOR PROGRAM ' PC-PROGRAM-NAME.             06510000
065200     DISPLAY 'NUMBER OF RECORDS FETCHED: ' PA-RECS-FETCHED.       06520000
065300     DISPLAY ' '.                                                 06530000
065400                                                                  06540000
065500     CLOSE CONTROL-DATE-FILE                                      06550000
065600           KMRC-REPORT-FILE                                       06560000
065700           GFTC-REPORT-FILE.                                      06570000
065800                                                                  06580000
065900     EXEC SQL                                                     06590000
066000        CLOSE FEE-CSR                                             06600000
066100     END-EXEC.                                                    06610000
066200                                                                  06620000
066300     EVALUATE TRUE                                                06630000
066400         WHEN SQLCODE = 0                                         06640000
066500             CONTINUE                                             06650000
066600                                                                  06660000
066700         WHEN OTHER                                               06670000
066800             DISPLAY ' '                                          06680000
066900             MOVE 'B900-EOJ-ROUTINE              '                06690000
067000                                   TO PV-PARAGRAPH-NAME           06700000
067100             MOVE 'CLOSE THE FEE CURSOR          '                06710000
067200                                   TO PV-DB2-OPERATION-ATTEMPTED  06720000
067300             PERFORM Z900-SQL-ABEND                               06730000
067400     END-EVALUATE.                                                06740000
067500                                                                  06750000
067600*----------------------------------------------------------------*06760000
067700*     C100-CRD-TYP-CDE-BREAK                                     *06770000
067800* ==> PROCESSES:                                                 *06780000
067900*     - PROCESS CHANGE OF ADJUSTMENT DATE                        *06790000
068000*----------------------------------------------------------------*06800000
068100 C100-CRD-TYP-CDE-BREAK.                                          06810000
068200                                                                  06820000
068300     MOVE SVT00001-CRD-TYP-CDE     TO PV-HOLD-CRD-TYP-CDE.        06830005
068400     MOVE ZEROES                   TO PV-HOLD-CRD-NBR.            06840000
068500     MOVE SPACES                   TO PV-HOLD-ADJ-DTE             06850000
068600                                      PV-HOLD-APVL-USR-ID.        06860000
068700     MOVE PC-ONE                   TO PA-PAGE-COUNTER.            06870000
068800     MOVE PC-HEADER-LINE-COUNT     TO PA-LINE-COUNTER.            06880001
068810                                                                  06881001
068900*----------------------------------------------------------------*06890000
069000*     C200-ADJUSTMENT-DATE-BREAK                                 *06900000
069100* ==> PROCESSES:                                                 *06910000
069200*     - PROCESS CHANGE OF ADJUSTMENT DATE                        *06920000
069300*----------------------------------------------------------------*06930000
069400 C200-ADJUSTMENT-DATE-BREAK.                                      06940000
069500                                                                  06950000
069600     MOVE PV-ADJUST-DTE            TO PV-HOLD-ADJ-DTE.            06960000
069700     MOVE PV-ADJUST-DTE(1:4)       TO RDL-ADJ-DTE-CCYY.           06970000
069800     MOVE PV-ADJUST-DTE(6:2)       TO RDL-ADJ-DTE-MM.             06980000
069900     MOVE PV-ADJUST-DTE(9:2)       TO RDL-ADJ-DTE-DD.             06990000
070000     MOVE PC-SLASH                 TO RDL-ADJ-DTE-SLASH1          07000000
070100                                      RDL-ADJ-DTE-SLASH2.         07010000
070200                                                                  07020000
070300*----------------------------------------------------------------*07030000
070400*     C300-APVL-USR-ID-BREAK                                     *07040000
070500* ==> PROCESSES:                                                 *07050000
070600*     - PROCESS BREAK IN APROVAL USER ID                         *07060000
070700*----------------------------------------------------------------*07070000
070800 C300-APVL-USR-ID-BREAK.                                          07080000
070900                                                                  07090000
071000     MOVE SVT00002-APVL-USR-ID     TO PV-HOLD-APVL-USR-ID         07100005
071100                                      RDL-USER-ID.                07110000
071200                                                                  07120000
071300*----------------------------------------------------------------*07130000
071400*     C400-CARD-NBR-BREAK                                        *07140000
071500* ==> PROCESSES:                                                 *07150000
071600*     - PROCESS BREAK IN CARD NUMBER RETRIEVING CARD DATA        *07160000
071700*----------------------------------------------------------------*07170000
071800 C400-CARD-NBR-BREAK.                                             07180000
071900                                                                  07190000
072000     MOVE SVT00002-CRD-NBR         TO PV-HOLD-CRD-NBR             07200005
072100                                      RDL-CRD-NBR.                07210000
072200     ADD 1                         TO PA-TOTAL-CRD-CNT.           07220000
072300                                                                  07230000
072400     PERFORM C410-GET-CARD-BALANCE.                               07240000
072500     MOVE PV-CARD-BALANCE          TO RDL-CARD-BALANCE.           07250000
072600                                                                  07260000
072700     PERFORM C420-GET-CARD-ACTIVITY-DATE.                         07270000
072800     IF PV-LAST-DTE = SPACES                                      07280000
072900         MOVE SPACES               TO RDL-LAST-DATE               07290000
073000     ELSE                                                         07300000
073100         MOVE PV-LAST-DTE(1:4)     TO RDL-LST-DTE-CCYY            07310000
073200         MOVE PV-LAST-DTE(6:2)     TO RDL-LST-DTE-MM              07320000
073300         MOVE PV-LAST-DTE(9:2)     TO RDL-LST-DTE-DD              07330000
073400         MOVE PC-SLASH             TO RDL-LST-DTE-SLASH1          07340000
073500                                      RDL-LST-DTE-SLASH2          07350000
073600     END-IF.                                                      07360000
073700                                                                  07370000
073800     PERFORM C430-GET-CARD-ISSUE-DATA.                            07380000
073900     IF PV-ISSUE-DTE = SPACES                                     07390000
074000         MOVE SPACES               TO RDL-ISSUE-DATE              07400000
074100     ELSE                                                         07410000
074200         MOVE PV-ISSUE-DTE(1:4)    TO RDL-ISS-DTE-CCYY            07420000
074300         MOVE PV-ISSUE-DTE(6:2)    TO RDL-ISS-DTE-MM              07430000
074400         MOVE PV-ISSUE-DTE(9:2)    TO RDL-ISS-DTE-DD              07440000
074500         MOVE PC-SLASH             TO RDL-ISS-DTE-SLASH1          07450000
074600                                      RDL-ISS-DTE-SLASH2          07460000
074700     END-IF.                                                      07470000
074800     MOVE PV-ISSUE-AMT             TO RDL-ISSUE-AMT.              07480000
074900                                                                  07490000
075000     PERFORM C440-GET-TOTAL-FEES.                                 07500000
075100     MOVE PV-TOTAL-ADJ-FEES        TO RDL-TOTAL-FEE-AMT.          07510000
075200                                                                  07520000
075300*----------------------------------------------------------------*07530000
075400*     C410-GET-CARD-BALANCE.                                     *07540000
075500* ==> PROCESSES:                                                 *07550000
075600*     - GET THE CURRENT BALANCE OF THE CARD                      *07560000
075700*----------------------------------------------------------------*07570000
075800 C410-GET-CARD-BALANCE.                                           07580000
075900                                                                  07590000
076000     EXEC SQL                                                     07600000
076100         SELECT  SUM(A.APP_AUTH_AMT)                              07610000
076200           INTO  :PV-CARD-BALANCE                                 07620000
076300           FROM  SVT_KOHLS_CRD_TXN A                              07630005
076400          WHERE  A.CRD_NBR = :SVT00002-CRD-NBR                    07640005
076500        WITH UR                                                   07650000
076600     END-EXEC.                                                    07660000
076700                                                                  07670000
076800     EVALUATE TRUE                                                07680000
076900         WHEN SQLCODE = +0                                        07690000
077000             CONTINUE                                             07700000
077100         WHEN SQLCODE = -305                                      07710000
077200*             NO NULL INDICATOR MEANS NO ROWS WERE FOUND          07720000
077300              MOVE ZEROS       TO PV-CARD-BALANCE                 07730000
077400         WHEN OTHER                                               07740000
077500             MOVE SVT00002-CRD-NBR TO PV-DISPLAY-CRD-NBR          07750005
077600             DISPLAY ' '                                          07760000
077700             DISPLAY PC-PROGRAM-NAME ' CARD NBR: '                07770000
077800                     PV-DISPLAY-CRD-NBR                           07780000
077900             MOVE 'C410-GET-CARD-BALANCE         '                07790000
078000                                   TO PV-PARAGRAPH-NAME           07800000
078100             MOVE 'SUMMATION OF APPROVED AUTH AMT'                07810000
078200                                   TO PV-DB2-OPERATION-ATTEMPTED  07820000
078300             PERFORM Z900-SQL-ABEND                               07830000
078400     END-EVALUATE.                                                07840000
078500                                                                  07850000
078600*----------------------------------------------------------------*07860000
078700*     C420-GET-CARD-ACTIVITY-DATE                                *07870000
078800* ==> PROCESSES:                                                 *07880000
078900*     - GET THE LAST ACTIVITY DATE FOR THE CARD                  *07890000
079000*----------------------------------------------------------------*07900000
079100 C420-GET-CARD-ACTIVITY-DATE.                                     07910000
079200                                                                  07920000
079300     EXEC SQL                                                     07930000
079400        SELECT  MAX(DATE(A.TRN_AUTH_TMST))                        07940000
079500          INTO :PV-LAST-DTE                                       07950000
079600          FROM  SVT_KOHLS_CRD_TXN A                               07960005
079700         WHERE  A.CRD_NBR        = :SVT00002-CRD-NBR              07970005
079800           AND  A.ACTVY_TYP_CDE IN (:SV004-ISSUE-KMRC-ACT-TYP-N   07980005
079900                                  ,:SV004-ISSUE-GIFT-CRD-ACT-TYP-N07990005
080000                                  ,:SV004-TENDER-ACT-TYP-N)       08000005
080100           AND  A.TRN_RVRSL_CDE  = :SV004-REV-CDE-NORMAL          08010005
080200           AND  A.TRN_VOID_IND   = :SV004-NOT-VOID-TRANS          08020005
080300       WITH UR                                                    08030000
080400     END-EXEC.                                                    08040000
080500                                                                  08050000
080600     EVALUATE TRUE                                                08060000
080700         WHEN SQLCODE = +0                                        08070000
080800             IF PV-LAST-DTE < PV-HOLD-ADJ-DTE                     08080000
080900                 MOVE SPACES       TO PV-LAST-DTE                 08090000
081000             END-IF                                               08100000
081100         WHEN SQLCODE = -305                                      08110000
081200*             NO NULL INDICATOR MEANS NO ROWS WERE FOUND          08120000
081300              MOVE SPACES          TO PV-LAST-DTE                 08130000
081400         WHEN OTHER                                               08140000
081500             DISPLAY ' '                                          08150000
081600             DISPLAY PC-PROGRAM-NAME ' CARD NBR: '                08160000
081700                     PV-DISPLAY-CRD-NBR                           08170000
081800             MOVE 'C420-GET-CARD-ACTIVITY-DATE   '                08180000
081900                                   TO PV-PARAGRAPH-NAME           08190000
082000             MOVE 'GET MAX ACTIVITY DATE FOR CARD'                08200000
082100                                   TO PV-DB2-OPERATION-ATTEMPTED  08210000
082200             PERFORM Z900-SQL-ABEND                               08220000
082300     END-EVALUATE.                                                08230000
082400                                                                  08240000
082500*----------------------------------------------------------------*08250000
082600*     3430-GET-CARD-ISSUE-DATA                                   *08260017
082700* ==> PROCESSES:                                                 *08270000
082800*     - GET THE ISSUE DATE AND AMOUNT                            *08280000
082900*----------------------------------------------------------------*08290000
083000 C430-GET-CARD-ISSUE-DATA.                                        08300000
083100                                                                  08310000
083200     EXEC SQL                                                     08320000
083300        SELECT  MAX(A.TRN_AUTH_TMST)                              08330019
083400          INTO  :PV-ISSUE-DATE                                    08340015
083500          FROM  SVT_KOHLS_CRD_TXN A                               08350005
083600         WHERE  A.CRD_NBR        = :SVT00002-CRD-NBR              08360005
083700           AND  A.ACTVY_TYP_CDE IN (:SV004-ISSUE-KMRC-ACT-TYP-N   08370005
083800                                 ,:SV004-ISSUE-GIFT-CRD-ACT-TYP-N)08380005
083900           AND  A.TRN_RVRSL_CDE  = :SV004-REV-CDE-NORMAL          08390005
084000       WITH UR                                                    08400000
084100     END-EXEC.                                                    08410000
084200                                                                  08420000
084300     EVALUATE TRUE                                                08430000
084400         WHEN SQLCODE = +0                                        08440000
084500             CONTINUE                                             08450019
084600         WHEN SQLCODE = -305                                      08460000
084700*             NO NULL INDICATOR MEANS NO ROWS WERE FOUND          08470000
084800              MOVE SPACES          TO PV-ISSUE-DTE                08480000
084810                                      PV-ISSUE-DATE               08481016
084900         WHEN OTHER                                               08490000
085000             DISPLAY ' '                                          08500000
085100             DISPLAY PC-PROGRAM-NAME ' CARD NBR: '                08510000
085200                     PV-DISPLAY-CRD-NBR                           08520000
085300             MOVE 'C430-GET-CARD-ISSUE-DATA      '                08530000
085400                                   TO PV-PARAGRAPH-NAME           08540000
085500             MOVE 'GET CARD ISSUE DATE           '                08550000
085600                                   TO PV-DB2-OPERATION-ATTEMPTED  08560000
085700             PERFORM Z900-SQL-ABEND                               08570000
085800     END-EVALUATE.                                                08580000
085900                                                                  08590000
086000                                                                  08600000
086100     EXEC SQL                                                     08610000
086200        SELECT  A.APP_AUTH_AMT                                    08620000
086300          INTO  :PV-ISSUE-AMT                                     08630000
086400          FROM  SVT_KOHLS_CRD_TXN A                               08640005
086500         WHERE  A.CRD_NBR         = :SVT00002-CRD-NBR             08650014
086510           AND  A.TRN_AUTH_TMST   = :PV-ISSUE-DATE                08651015
086600           AND  A.ACTVY_TYP_CDE IN (:SV004-ISSUE-KMRC-ACT-TYP-N   08660005
086700                                 ,:SV004-ISSUE-GIFT-CRD-ACT-TYP-N)08670005
086800           AND  A.TRN_RVRSL_CDE  = :SV004-REV-CDE-NORMAL          08680005
086900       WITH UR                                                    08690000
087000     END-EXEC.                                                    08700000
087100                                                                  08710000
087200     EVALUATE TRUE                                                08720000
087300         WHEN SQLCODE = +0                                        08730000
087400             CONTINUE                                             08740000
087500         WHEN SQLCODE = -305                                      08750000
087600*             NO NULL INDICATOR MEANS NO ROWS WERE FOUND          08760000
087700              MOVE ZEROS           TO PV-ISSUE-AMT                08770000
087800         WHEN OTHER                                               08780000
087900             DISPLAY ' '                                          08790000
088000             DISPLAY PC-PROGRAM-NAME ' CARD NBR: '                08800000
088100                     PV-DISPLAY-CRD-NBR                           08810000
088200             MOVE 'C430-GET-CARD-ISSUE-DATA      '                08820000
088300                                   TO PV-PARAGRAPH-NAME           08830000
088400             MOVE 'GET CARD ISSUE AMOUNT         '                08840000
088500                                   TO PV-DB2-OPERATION-ATTEMPTED  08850000
088600             PERFORM Z900-SQL-ABEND                               08860000
088700     END-EVALUATE.                                                08870000
088800                                                                  08880000
088900*----------------------------------------------------------------*08890000
089000*     C440-GET-TOTAL-FEES.                                       *08900000
089100* ==> PROCESSES:                                                 *08910000
089200*     - GET THE CURRENT BALANCE OF THE CARD                      *08920000
089300*----------------------------------------------------------------*08930000
089400 C440-GET-TOTAL-FEES.                                             08940000
089500                                                                  08950000
089600     EXEC SQL                                                     08960000
089700         SELECT  SUM(A.APP_AUTH_AMT)                              08970000
089800           INTO  :PV-TOTAL-ADJ-FEES                               08980000
089900           FROM  SVT_KOHLS_CRD_TXN A                              08990005
090000          WHERE  A.CRD_NBR = :SVT00002-CRD-NBR                    09000005
090100            AND  A.TRN_AUTH_TMST BETWEEN :PV-BEG-TIMESTAMP        09010000
090200                                     AND :PV-END-TIMESTAMP        09020000
090300            AND  A.ACTVY_TYP_CDE     = :SV004-SRV-FEE-ACT-TYP-N   09030005
090400            AND  A.TRN_RVRSL_CDE     = :SV004-REV-CDE-REVERSAL    09040005
090500            AND  A.TRN_VOID_IND      = :SV004-VOID-TRANS          09050005
090600        WITH UR                                                   09060000
090700     END-EXEC.                                                    09070000
090800                                                                  09080000
090900     EVALUATE TRUE                                                09090000
091000         WHEN SQLCODE = +0                                        09100000
091100             CONTINUE                                             09110000
091200         WHEN SQLCODE = -305                                      09120000
091300*             NO NULL INDICATOR MEANS NO ROWS WERE FOUND          09130000
091400              MOVE ZEROS       TO PV-CARD-BALANCE                 09140000
091500         WHEN OTHER                                               09150000
091600             MOVE SVT00002-CRD-NBR TO PV-DISPLAY-CRD-NBR          09160005
091700             DISPLAY ' '                                          09170000
091800             DISPLAY PC-PROGRAM-NAME ' CARD NBR: '                09180000
091900                     PV-DISPLAY-CRD-NBR                           09190000
092000             MOVE 'C440-GET-TOTAL-FEES           '                09200000
092100                                   TO PV-PARAGRAPH-NAME           09210000
092200             MOVE 'SUMMATION OF ADJUSTED FEES    '                09220000
092300                                   TO PV-DB2-OPERATION-ATTEMPTED  09230000
092400             PERFORM Z900-SQL-ABEND                               09240000
092500     END-EVALUATE.                                                09250000
092600                                                                  09260000
092700*----------------------------------------------------------------*09270000
092800*     D100-FETCH-FEE-CURSOR                                      *09280000
092900* ==> PROCESSES:                                                 *09290000
093000*     - FETCH A ROW FROM THE FEE CURSOR                          *09300000
093100*----------------------------------------------------------------*09310000
093200 D100-FETCH-FEE-CURSOR.                                           09320000
093300                                                                  09330000
093400     EXEC SQL                                                     09340000
093500         FETCH  FEE-CSR                                           09350000
093600          INTO :SVT00001-CRD-TYP-CDE                              09360005
093700              ,:PV-ADJUST-DTE                                     09370000
093800              ,:SVT00002-APVL-USR-ID                              09380005
093900              ,:SVT00002-CRD-NBR                                  09390005
094000              ,:SVT00002-POS-DTE                                  09400005
094100              ,:SVT00002-APP-AUTH-AMT                             09410005
094200     END-EXEC.                                                    09420000
094300                                                                  09430000
094400     EVALUATE TRUE                                                09440000
094500         WHEN SQLCODE = +0                                        09450000
094600             ADD +1                TO PA-RECS-FETCHED             09460000
094700         WHEN SQLCODE = +100                                      09470000
094800             SET PS-END-OF-FEE-CSR TO TRUE                        09480000
094900         WHEN OTHER                                               09490000
095000             DISPLAY ' '                                          09500000
095100             MOVE 'D100-FETCH-FEE-CURSOR         '                09510000
095200                                   TO PV-PARAGRAPH-NAME           09520000
095300             MOVE 'FETCH ROW FROM TSVT00002 CURSOR '              09530005
095400                                   TO PV-DB2-OPERATION-ATTEMPTED  09540000
095500             PERFORM Z900-SQL-ABEND                               09550000
095600     END-EVALUATE.                                                09560000
095700                                                                  09570000
095800*----------------------------------------------------------------*09580000
095900*     E100-PRINT-TOTALS                                          *09590000
096000* ==> PROCESSES:                                                 *09600000
096100*     - PROCESS BREAK IN CARD TYPE CODE (CHANGE IN REPORTS)      *09610000
096200*----------------------------------------------------------------*09620000
096300 E100-PRINT-TOTALS.                                               09630000
096400                                                                  09640000
096500     MOVE PA-TOTAL-CRD-CNT         TO RTL-NUM-CARDS.              09650000
096600     MOVE PA-TOTAL-FEE-AMT         TO RTL-FEE-AMT-ADJUSTED.       09660000
096700                                                                  09670000
096800     IF PV-HOLD-CRD-TYP-CDE = SV004-KMRC-CRD-TYP                  09680005
096900         WRITE KMRC-REPORT-RECORD FROM REPORT-TOTAL-DASH-LINE     09690000
097000             AFTER ADVANCING 1 LINE                               09700000
097100         WRITE KMRC-REPORT-RECORD FROM REPORT-TOTAL-LINE          09710000
097200             AFTER ADVANCING 1 LINE                               09720000
097300         DISPLAY ' '                                              09730000
097400         DISPLAY PC-PROGRAM-NAME ' KMRC CARDS: ' RTL-NUM-CARDS    09740000
097500         DISPLAY PC-PROGRAM-NAME ' KMRC FEES:  '                  09750000
097600                 RTL-FEE-AMT-ADJUSTED                             09760000
097700         SET PS-KMRC-TOTALS-PRNTED TO TRUE                        09770000
097800     ELSE                                                         09780000
097900         WRITE GFTC-REPORT-RECORD FROM REPORT-TOTAL-DASH-LINE     09790000
098000             AFTER ADVANCING 1 LINE                               09800000
098100         WRITE GFTC-REPORT-RECORD FROM REPORT-TOTAL-LINE          09810000
098200             AFTER ADVANCING 1 LINE                               09820000
098300         DISPLAY ' '                                              09830000
098400         DISPLAY PC-PROGRAM-NAME ' GFTC CARDS: ' RTL-NUM-CARDS    09840000
098500         DISPLAY PC-PROGRAM-NAME ' GFTC FEES:  '                  09850000
098600                 RTL-FEE-AMT-ADJUSTED                             09860000
098700         SET PS-GFTC-TOTALS-PRNTED TO TRUE                        09870000
098800     END-IF.                                                      09880000
098900                                                                  09890000
099000     MOVE ZEROS                    TO PA-TOTAL-CRD-CNT            09900000
099100                                      PA-TOTAL-FEE-AMT.           09910000
099200                                                                  09920000
099300*----------------------------------------------------------------*09930000
099400*     F100-PROCESS-PAGE-BREAK.                                   *09940000
099500* ==> PROCESSES:                                                 *09950000
099600*     - ADVANCES TO A NEW PAGE AND WRITES THE REPORT HEADINGS    *09960000
099700*----------------------------------------------------------------*09970000
099800 F100-PROCESS-PAGE-BREAK.                                         09980000
099900                                                                  09990000
100000     ADD PC-ONE                    TO PA-PAGE-COUNTER.            10000000
100100     MOVE PA-PAGE-COUNTER          TO DP132-PAGE-NUMBER.          10010000
100200                                                                  10020000
100300     MOVE PC-HEADER-LINE-COUNT     TO PA-LINE-COUNTER.            10030000
100400                                                                  10040000
100500     IF PV-HOLD-CRD-TYP-CDE = SV004-KMRC-CRD-TYP                  10050005
100600         MOVE PC-ONE               TO DP132-REPORT-NUMBER         10060000
100700         MOVE PC-KMRC-REPORT-TITLE TO RTH-TITLE                   10070000
100800         WRITE KMRC-REPORT-RECORD                                 10080000
100900             FROM DP132-STANDRD-HEADER-132-COLS                   10090000
101000             AFTER ADVANCING PAGE                                 10100000
101100                                                                  10110000
101200         INITIALIZE DP132-LASER-NEW-PAGE-INDICATR                 10120000
101300                                                                  10130000
101400         WRITE KMRC-REPORT-RECORD FROM REPORT-TITLE-LINE          10140000
101500             AFTER ADVANCING 1 LINE                               10150000
101600                                                                  10160000
101700         WRITE KMRC-REPORT-RECORD FROM REPORT-SUBTITLE-LINE       10170000
101800             AFTER ADVANCING 1 LINE                               10180000
101900                                                                  10190000
102000         WRITE KMRC-REPORT-RECORD FROM REPORT-DETAIL-HEADER-1     10200000
102100             AFTER ADVANCING 2 LINES                              10210000
102200                                                                  10220000
102300         WRITE KMRC-REPORT-RECORD FROM REPORT-DETAIL-HEADER-2     10230000
102400             AFTER ADVANCING 1 LINES                              10240000
102500                                                                  10250000
102600         WRITE KMRC-REPORT-RECORD FROM REPORT-BLANK-LINE          10260000
102700             AFTER ADVANCING 1 LINES                              10270000
102800     ELSE                                                         10280000
102900         MOVE PC-TWO               TO DP132-REPORT-NUMBER         10290000
103000         MOVE PC-GFTC-REPORT-TITLE TO RTH-TITLE                   10300000
103100         WRITE GFTC-REPORT-RECORD                                 10310000
103200             FROM DP132-STANDRD-HEADER-132-COLS                   10320000
103300             AFTER ADVANCING PAGE                                 10330000
103400                                                                  10340000
103500         INITIALIZE DP132-LASER-NEW-PAGE-INDICATR                 10350000
103600                                                                  10360000
103700         WRITE GFTC-REPORT-RECORD FROM REPORT-TITLE-LINE          10370000
103800             AFTER ADVANCING 1 LINE                               10380000
103900                                                                  10390000
104000         WRITE GFTC-REPORT-RECORD FROM REPORT-SUBTITLE-LINE       10400000
104100             AFTER ADVANCING 1 LINE                               10410000
104200                                                                  10420000
104300         WRITE GFTC-REPORT-RECORD FROM REPORT-DETAIL-HEADER-1     10430000
104400             AFTER ADVANCING 2 LINES                              10440000
104500                                                                  10450000
104600         WRITE GFTC-REPORT-RECORD FROM REPORT-DETAIL-HEADER-2     10460000
104700             AFTER ADVANCING 1 LINES                              10470000
104800                                                                  10480000
104900         WRITE GFTC-REPORT-RECORD FROM REPORT-BLANK-LINE          10490000
105000             AFTER ADVANCING 1 LINES                              10500000
105100     END-IF.                                                      10510000
105200                                                                  10520000
105300*----------------------------------------------------------------*10530000
105400*     Z900-SQL-ABEND                                             *10540000
105500* ==> PROCESSES:                                                 *10550000
105600*     -PERFORMS ABEND PROCESSING FOR SQL ERRORS.                 *10560000
105700*----------------------------------------------------------------*10570000
105800 Z900-SQL-ABEND.                                                  10580000
105900                                                                  10590000
106000     DISPLAY 'Z900-SQL-ABEND'.                                    10600000
106100     DISPLAY '**  ABEND     **'.                                  10610000
106200     DISPLAY '**  PROGRAM   ** = ' PC-PROGRAM-NAME.               10620000
106300     DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.             10630000
106400     DISPLAY '**  OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.    10640000
106500                                                                  10650000
106600*----------------------------------------------------------------*10660000
106700* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *10670000
106800* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *10680000
106900* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *10690000
107000* FORMAT.                                                        *10700000
107100*----------------------------------------------------------------*10710000
107200     COPY DPPD004.                                                10720000
107300                                                                  10730000
107400     MOVE +4013 TO ABEND-CODE.                                    10740000
107500     CALL 'ILBOABN0' USING ABEND-CODE.                            10750000
