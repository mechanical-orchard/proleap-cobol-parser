000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.    AHKUT072.                                         00020001
000300 AUTHOR.        DENISE HAHN.                                      00030001
000400 INSTALLATION.  KOHLS.                                            00040001
000500 DATE-WRITTEN   APRIL, 2020                                       00050001
000600 DATE-COMPILED.                                                   00060001
000700                                                                  00070001
000800******************************************************************00080001
000900*   AHKUT072.  ARCHIVE HISTORY EXTRACT PROGRAM:  RCT_PRC_RCPT    *00090001
001000*                                                                *00100001
001100*   PURPOSE:                                                     *00110001
001200*   THIS PROGRAM CREATES AN EXTRACT FILE FROM: RCT_PRC_RCPT      *00120001
001300*   THIS EXTRACT FILE CONSISTS OF ROWS ELIGIBLE TO BE            *00130001
001500*   DELETED FROM THE OPERATIONAL VERSIONS OF THE TABLES.         *00150001
001600*                                                                *00160001
001700*   PROCESSING OVERVIEW:                                         *00170001
001800*   THIS PROGRAM READS A "DRIVER" FILE. FOR EACH RECORD READ,    *00180001
001900*   1) INCREMENT COUNT OF RECORDS READ.                          *00190001
002000*   2) ATTEMPT TO FIND RELATED ROW(S) ON THE TABLE.              *00200001
002100*      2.A) IF NO MATCH(ES):                                     *00210001
002200*           2.A.1) PROCESSING CONTINUES                          *00220001
002400*      2.B) IF MATCH(ES):                                        *00240001
002900*           2.B.1) INCREMENT COUNT OF ROW(S) FOUND.              *00290001
003000*           2.B.2) WRITE THESE ROW(S) TO THE EXTRACT FILE.       *00300001
003100*           2.B.3) INCREMENT COUNT OF RECORDS WRITTEN.           *00310001
003200*           2.B.4) DO NOT REMOVE THE ROW(S) FROM THE TABLE       *00320001
003300*                  AT THIS TIME.  THEY WILL BE REMOVED IN OTHER  *00330001
003400*                  PROCESSING, BY AHKUP072.                      *00340001
003600*   3) EVERY NTH RECORD (IE: INITIAL SETTING 5000), REPORT       *00360001
003700*      RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST     *00370001
003800*      WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.     *00380001
003900* ************************************************************** *00390001
004000 ENVIRONMENT DIVISION.                                            00400001
004100 CONFIGURATION SECTION.                                           00410001
004200 SOURCE-COMPUTER.        IBM-3090.                                00420001
004300 OBJECT-COMPUTER.        IBM-3090.                                00430001
004400                                                                  00440001
004500 INPUT-OUTPUT SECTION.                                            00450001
004600 FILE-CONTROL.                                                    00460001
004700                                                                  00470001
004800     SELECT IN-DRIVER-FILE                ASSIGN TO IN01.         00480001
004900     SELECT OUT-EXTRACT-FILE              ASSIGN TO OUT01.        00490001
005000                                                                  00500001
005100******************************************************************00510001
005200 DATA DIVISION.                                                   00520001
005300 FILE SECTION.                                                    00530001
005400                                                                  00540001
005500 FD  IN-DRIVER-FILE                                               00550001
005600     RECORDING MODE IS F                                          00560001
005700     LABEL RECORDS ARE STANDARD                                   00570001
005800     BLOCK CONTAINS 0 RECORDS.                                    00580001
005900 01  IN-DRIVER-RECORD                PIC  X(004).                 00590001
006000                                                                  00600001
006100**** RCT_PRC_RCPT ****                                            00610001
006200 FD  OUT-EXTRACT-FILE                                             00620001
006300     RECORDING MODE IS F                                          00630001
006400     LABEL RECORDS ARE STANDARD                                   00640001
006500     BLOCK CONTAINS 0 RECORDS.                                    00650001
006600 01  OUT-EXTRACT-RECORD              PIC  X(31).                  00660004
006700                                                                  00670001
006800                                                                  00680001
006900                                                                  00690001
007000 WORKING-STORAGE SECTION.                                         00700001
007100                                                                  00710001
007200 01  PC-PROGRAM-CONSTANTS.                                        00720001
007300     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'AHKUT072'.  00730001
007400     05  PC-PGM-PROGRESS-DESC.                                    00740001
007500         10  PC-BEGINNING            PIC X(09) VALUE 'BEGINNING'. 00750001
007600         10  PC-CONTINUING           PIC X(10) VALUE              00760001
007700                                               'CONTINUING'.      00770001
007800         10  PC-ENDING               PIC X(06) VALUE 'ENDING'.    00780001
007900         10  PC-ABENDING             PIC X(08) VALUE 'ABENDING'.  00790001
008000     05  PC-ABEND-INFO.                                           00800001
008100         10  PC-ABEND                PIC X(11) VALUE              00810001
008200                                               '** ABEND **'.     00820001
008300         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00830001
008400                                               '- PARA       : '. 00840001
008500         10  PC-ABEND-MSG-DISPLAY-PARA                            00850001
008600                                     PIC X(15) VALUE              00860001
008700                                               '  CALLED PARA: '. 00870001
008800         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00880001
008900                                               '  FOR ABEND# : '. 00890001
009000         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00900001
009100                                               '- ERROR IS   : '. 00910001
009200         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00920001
009300         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              00930001
009400                                               '- ACTION     : '. 00940001
009500     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 5000.        00950001
009600                                                                  00960001
009700 01  PS-PROGRAM-SWITCHES.                                         00970001
009800     05  PS-IN-DRIVER-EOF-SW         PIC X(01) VALUE 'N'.         00980001
009900         88  PS-IN-DRIVER-EOF                  VALUE 'Y'.         00990001
010000         88  PS-IN-DRIVER-NOT-EOF              VALUE 'N'.         01000001
010100     05  PS-CURSOR-HAS-DATA-SW       PIC X(01) VALUE 'N'.         01010001
010200         88  PS-CURSOR-HAS-DATA                VALUE 'Y'.         01020001
010300         88  PS-CURSOR-HAS-NO-DATA             VALUE 'N'.         01030001
010400     05  PS-TABLE-LOOP-DONE-SW       PIC X(01) VALUE 'N'.         01040001
010500         88  PS-TABLE-LOOP-DONE                VALUE 'Y'.         01050001
010600         88  PS-TABLE-LOOP-NOT-DONE            VALUE 'N'.         01060001
010700                                                                  01070001
010800 01  PV-PROGRAM-VARIABLES.                                        01080001
010900     05  PV-PO-NBR-COMP              PIC S9(9) VALUE 0 COMP.      01090001
011000     05  PV-PO-NBR-NUM               PIC  9(9) VALUE 0.           01100001
011100     05  PV-IN-DRIVER-RECS-READ-CNT  PIC  9(9) VALUE 0.           01110001
011200     05  PV-RECS-WITH-MATCHES-CNT    PIC  9(9) VALUE 0.           01120001
011300     05  PV-TABLE-ROW-SELECT-CNT     PIC  9(9) VALUE 0.           01130001
011400     05  PV-EXTRACT-WRITTEN-CNT      PIC  9(9) VALUE 0.           01140001
011500                                                                  01150001
011600     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACES.      01160001
011700     05  PV-DB2-OPERATION-MSG-1      PIC X(79) VALUE SPACES.      01170001
011800     05  PV-DB2-TABLE-NAME           PIC X(18) VALUE SPACES.      01180001
011900     05  PV-DISPLAY-NTH-MULTIPLE     PIC 9(9)  VALUE 0.           01190001
012000     05  PV-DISPLAY-NTH-REMAINDER    PIC 9(9)  VALUE 0.           01200001
012100     05  PV-SQLCODE                  PIC +999  VALUE ZERO.        01210001
012200                                                                  01220001
012300     05  PV-TMST                     PIC X(26) VALUE SPACES.      01230001
012400     05  PV-TIMESTAMP-DETAIL                                      01240001
012500         REDEFINES                                                01250001
012600         PV-TMST.                                                 01260001
012700         10  PV-TIMESTAMP-19.                                     01270001
012800             15  PV-TMS-DATE.                                     01280001
012900                 20  PV-TMS-YEAR.                                 01290001
013000                     25  PV-TMS-CC   PIC X(02).                   01300001
013100                     25  PV-TMS-YY   PIC X(02).                   01310001
013200                 20  FILLER          PIC X(01).                   01320001
013300                 20  PV-TMS-MONTH    PIC X(02).                   01330001
013400                 20  FILLER          PIC X(01).                   01340001
013500                 20  PV-TMS-DAY      PIC X(02).                   01350001
013600             15  FILLER              PIC X(01).                   01360001
013700             15  PV-TMS-HOUR         PIC X(02).                   01370001
013800             15  FILLER              PIC X(01).                   01380001
013900             15  PV-TMS-MINUTE       PIC X(02).                   01390001
014000             15  FILLER              PIC X(01).                   01400001
014100             15  PV-TMS-SECOND       PIC X(02).                   01410001
014200         10  FILLER                  PIC X(01).                   01420001
014300         10  PV-TMS-MSECOND          PIC X(06).                   01430001
014400                                                                  01440001
014500 01  DM-DISPLAY-MESSAGE.                                          01450001
014600     05  DM-01-10.                                                01460001
014700         10  DM-PROGRAM              PIC X(08) VALUE SPACE.       01470001
014800         10  FILLER                  PIC X(02) VALUE ': '.        01480001
014900     05  DM-11-80.                                                01490001
015000         10  FILLER                  PIC X(37) VALUE              01500001
015100                        'SELECT ROWS MATCHING PO DRIVER FILE, '.  01510001
015200         10  FILLER                  PIC X(35) VALUE              01520003
015300                        'CREATING RCT_PRC_RCPT EXTRACT FILE.'.    01530002
015400         10  FILLER                  PIC X(01) VALUE SPACE.       01540001
015500         10  FILLER                  PIC X(01) VALUE ALL '*'.     01550001
015600     05  DM-81-120.                                               01560001
015700         10  FILLER                  PIC X(40) VALUE ALL '*'.     01570001
015800                                                                  01580001
015900 01  DP-DISPLAY-PROGRESS-MSG.                                     01590001
016000     05  DP-PROGRAM                  PIC X(08) VALUE SPACE.       01600001
016100     05  FILLER                      PIC X(02) VALUE SPACE.       01610001
016200     05  DP-STATUS-DESCRIPTION       PIC X(10) VALUE SPACE.       01620001
016300     05  FILLER                      PIC X(04) VALUE ' AT '.      01630001
016400     05  DP-TIMESTAMP-19             PIC X(19) VALUE SPACE.       01640001
016500     05  FILLER                      PIC X(03) VALUE '.  '.       01650001
016600     05  FILLER                      PIC X(03) VALUE              01660001
016700                                         'IN:'.                   01670001
016800     05  DP-IN-CNT                   PIC ZZZ,ZZZ,ZZ9              01680001
016900                                               VALUE ZERO.        01690001
017000     05  FILLER                      PIC X(02) VALUE ', '.        01700001
017600     05  FILLER                      PIC X(14) VALUE              01760001
017700                                         'ROWS SELECTED:'.        01770001
017800     05  DP-ROWS-SELECTED-CNT        PIC ZZZ,ZZZ,ZZ9              01780001
017900                                               VALUE ZERO.        01790001
018000     05  FILLER                      PIC X(02) VALUE ', '.        01800001
018100     05  FILLER                      PIC X(04) VALUE              01810001
018200                                         'OUT:'.                  01820001
018300     05  DP-OUT-CNT                  PIC ZZZ,ZZZ,ZZ9              01830001
018400                                               VALUE ZERO.        01840001
018500     05  FILLER                      PIC X(01) VALUE '.'.         01850001
018600                                                                  01860001
018700 01  ABEND-CODE                      PIC S9(04)                   01870001
018800                                               VALUE ZEROES       01880001
018900                                               COMP SYNC.         01890001
019000                                                                  01900001
019100*---------------------------------------------------------------* 01910001
019200*  DB2 FORMATTED MESSAGE AREA                                     01920001
019300*---------------------------------------------------------------* 01930001
019400     COPY DPWS004.                                                01940001
019500                                                                  01950001
019600                                                                  01960001
019700*---------------------------------------------------------------* 01970001
019800*  AHRD002  - RECORD LAYOUT FOR PO DRIVER FILE, INPUT.          * 01980001
019900*---------------------------------------------------------------* 01990001
020000     COPY AHRD002.                                                02000001
020100                                                                  02010001
020200                                                                  02020001
020300*---------------------------------------------------------------* 02030001
020400*    DB2 AREA FOR RCT_PRC_RCPT                                  * 02040001
020500*---------------------------------------------------------------* 02050001
020600     EXEC SQL                                                     02060001
020700          INCLUDE RCT00019                                        02070001
020800     END-EXEC.                                                    02080001
020900                                                                  02090001
021000*---------------------------------------------------------------* 02100001
021100*    DB2 AREA FOR COMMUNICATIONS                                * 02110001
021200*---------------------------------------------------------------* 02120001
021300     EXEC SQL                                                     02130001
021400          INCLUDE SQLCA                                           02140001
021500     END-EXEC.                                                    02150001
021600                                                                  02160001
021700*---------------------------------------------------------------* 02170001
021800*    DEFINE CURSOR FOR RCT_PRC_RCPT"                            * 02180002
021900*    PULL ALL AVAILABLE COLUMNS, SO EXTRACT FILE WILL CONTAIN   * 02190001
022000*    ALL DATA TO BE ARCHIVED BY AHKUP072                        * 02200002
022100*---------------------------------------------------------------* 02210001
022200     EXEC SQL                                                     02220001
022300          DECLARE TABLE-CURSOR CURSOR FOR                         02230001
022400           SELECT ORD_NBR                                         02240001
022500                 ,ORD_LNE_NBR                                     02250001
022600                 ,REC_SEQ_NBR                                     02260001
022700                 ,OPER_UNT_ID                                     02270001
022800                 ,FCLTY_ID                                        02280001
022900                 ,PRC_RCPT_TYP_CDE                                02290002
023000                 ,AMT_TYP_CDE                                     02300002
023100                 ,UNT_AMT                                         02310002
023200                 ,GP_AMT                                          02320002
023300                 ,GP_QTY                                          02330002
026160           FROM   RCT_PRC_RCPT                                    02616006
026170          WHERE   ORD_NBR = :PV-PO-NBR-COMP                       02617002
026200           WITH  UR                                               02620001
026300     END-EXEC.                                                    02630001
026400                                                                  02640001
026500                                                                  02650001
026600 PROCEDURE DIVISION.                                              02660001
026700********************                                              02670001
026800                                                                  02680001
026900 0000-PROGRAM-MAINLINE.                                           02690001
027000                                                                  02700001
027100     PERFORM 1000-INITIALIZE.                                     02710001
027200                                                                  02720001
027300     SET PS-IN-DRIVER-NOT-EOF TO TRUE.                            02730001
027400     PERFORM 2000-PROCESS-DRIVER-FILE                             02740001
027500         UNTIL PS-IN-DRIVER-EOF.                                  02750001
027600                                                                  02760001
027700     PERFORM 9090-CLOSE-FILES.                                    02770002
027710                                                                  02771002
027720     MOVE PC-ENDING                 TO DP-STATUS-DESCRIPTION.     02772002
027730     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02773002
027740                                                                  02774002
027800     STOP RUN.                                                    02780001
027900                                                                  02790001
028000                                                                  02800001
028100******************************************************************02810002
028200*                                                                *02820002
028300******************************************************************02830002
028400 1000-INITIALIZE.                                                 02840001
028500                                                                  02850001
028600     MOVE PC-CURRENT-PROGRAM-NAME TO DM-PROGRAM.                  02860001
028700     DISPLAY DM-DISPLAY-MESSAGE.                                  02870001
028800                                                                  02880001
028900     MOVE PC-BEGINNING              TO DP-STATUS-DESCRIPTION.     02890001
029000     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02900001
029100                                                                  02910001
029200     OPEN  INPUT  IN-DRIVER-FILE.                                 02920002
029300     OPEN OUTPUT OUT-EXTRACT-FILE.                                02930002
029400                                                                  02940001
029500                                                                  02950001
029600******************************************************************02960002
029700*   1) GET NEXT RECORD FROM DRIVER FILE, AND                     *02970002
029800*      1A- POPULATE KEY (WHERE CLAUSE) FOR TABLE CURSOR          *02980002
029900*      1B- OPEN TABLE CURSOR                                     *02990002
030000*      1C- LOOP THRU TABLE CURSOR TO EXTRACT ALL                 *03000002
030100*          ROWS FOR THIS INPUT DRIVER RECORD                     *03010002
030200*      2) FOR EACH ROW,                                          *03020002
030300*         2A- INCREMENT COUNTS                                   *03030002
030400*         2B- WRITE EXTRACT RECORD                               *03040002
030500*      1D- CLOSE TABLE CURSOR                                    *03050002
030600******************************************************************03060002
030700 2000-PROCESS-DRIVER-FILE.                                        03070001
030800                                                                  03080001
030900     PERFORM 9050-READ-IN-DRIVER-FILE.                            03090001
031000     IF PS-IN-DRIVER-EOF                                          03100001
031100         CONTINUE                                                 03110001
031200     ELSE                                                         03120001
031300         MOVE AH002-PO-NBR TO         PV-PO-NBR-COMP              03130001
031400                                      PV-PO-NBR-NUM               03140001
031500         PERFORM 2100-CHECK-PGM-PROGRESS                          03150001
031600         SET PS-TABLE-LOOP-NOT-DONE   TO TRUE                     03160001
031700         SET PS-CURSOR-HAS-NO-DATA    TO TRUE                     03170001
031800         PERFORM 9100-OPEN-TABLE-CURSOR                           03180001
031900         PERFORM 3000-EXTRACT-ROWS-FROM-TABLE                     03190001
032000             UNTIL PS-TABLE-LOOP-DONE                             03200001
032100         PERFORM 9190-CLOSE-TABLE-CURSOR                          03210001
032200     END-IF.                                                      03220001
032300                                                                  03230001
032400                                                                  03240001
032500******************************************************************03250002
032600*      EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT       *03260002
032700*      RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST     *03270002
032800*      WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.     *03280002
032900******************************************************************03290002
033000 2100-CHECK-PGM-PROGRESS.                                         03300001
033100     DIVIDE    PV-IN-DRIVER-RECS-READ-CNT                         03310001
033200         BY        PC-HOW-OFTEN-TO-DISPLAY                        03320001
033300         GIVING    PV-DISPLAY-NTH-MULTIPLE                        03330001
033400         REMAINDER PV-DISPLAY-NTH-REMAINDER.                      03340001
033500                                                                  03350001
033600     IF PV-DISPLAY-NTH-REMAINDER = ZERO                           03360001
033700         MOVE PC-CONTINUING         TO DP-STATUS-DESCRIPTION      03370001
033800         PERFORM 6200-DISPLAY-PGM-PROGRESS                        03380001
033900     END-IF.                                                      03390001
034000                                                                  03400001
034100                                                                  03410001
034200******************************************************************03420002
034300*   EXTRACT ROWS FROM TABLE, FOR THE CURRENT DRIVER RECORD       *03430002
034400******************************************************************03440002
034500 3000-EXTRACT-ROWS-FROM-TABLE.                                    03450001
034600     INITIALIZE DCLRCT00019.                                      03460002
034700     PERFORM 9150-FETCH-TABLE-CURSOR.                             03470001
034800     IF PS-TABLE-LOOP-DONE                                        03480001
034900         CONTINUE                                                 03490001
035000     ELSE                                                         03500001
035100         PERFORM 9750-WRITE-EXTRACT-RECORD                        03510001
035200     END-IF.                                                      03520001
035300                                                                  03530001
035400                                                                  03540001
036700******************************************************************03670002
036800*   DISPLAY PROGRAM PROGRESS.                                    *03680002
036900******************************************************************03690002
037000 6200-DISPLAY-PGM-PROGRESS.                                       03700001
037100                                                                  03710001
037200     EXEC SQL                                                     03720001
037300          SET :PV-TMST = CURRENT TIMESTAMP                        03730001
037400     END-EXEC.                                                    03740001
037500                                                                  03750001
037600     MOVE PC-CURRENT-PROGRAM-NAME   TO DP-PROGRAM.                03760001
037700     MOVE PV-TIMESTAMP-19           TO DP-TIMESTAMP-19.           03770001
037800     MOVE PV-IN-DRIVER-RECS-READ-CNT                              03780001
037900                                    TO DP-IN-CNT.                 03790001
038000*    MOVE PV-RECS-WITH-MATCHES-CNT  TO DP-MATCHES-FOUND-CNT.      03800001
038100     MOVE PV-TABLE-ROW-SELECT-CNT   TO DP-ROWS-SELECTED-CNT.      03810001
038200     MOVE PV-EXTRACT-WRITTEN-CNT    TO DP-OUT-CNT.                03820001
038300                                                                  03830001
038400     DISPLAY DP-DISPLAY-PROGRESS-MSG.                             03840001
038500                                                                  03850001
038600                                                                  03860001
040100******************************************************************04010002
040200*   READ  INPUT DRIVER FILE OF ELIGIBLE DATA TO EXTRACT          *04020002
040300******************************************************************04030002
040400 9050-READ-IN-DRIVER-FILE.                                        04040001
040500     READ IN-DRIVER-FILE                                          04050001
040600          INTO AH002-DRIVER-RECORD-LAYOUT                         04060001
040700          AT END                                                  04070001
040800              SET PS-IN-DRIVER-EOF TO TRUE.                       04080001
040900                                                                  04090001
041000     IF PS-IN-DRIVER-EOF                                          04100001
041100         CONTINUE                                                 04110001
041200     ELSE                                                         04120001
041300         ADD +1 TO PV-IN-DRIVER-RECS-READ-CNT                     04130001
041400     END-IF.                                                      04140001
041500                                                                  04150001
041600                                                                  04160001
041700******************************************************************04170002
041800*   CLOSE INPUT DRIVER FILE                                      *04180002
041900******************************************************************04190002
042000 9090-CLOSE-FILES.                                                04200002
042100     CLOSE IN-DRIVER-FILE.                                        04210001
042110     CLOSE OUT-EXTRACT-FILE.                                      04211002
042200                                                                  04220001
042300                                                                  04230001
042400******************************************************************04240002
042500*   OPEN  TABLE CURSOR                                           *04250002
042600******************************************************************04260002
042700 9100-OPEN-TABLE-CURSOR.                                          04270001
042800     EXEC SQL                                                     04280001
042900          OPEN TABLE-CURSOR                                       04290001
043000     END-EXEC.                                                    04300001
043100                                                                  04310001
043200     EVALUATE TRUE                                                04320001
043300         WHEN SQLCODE = ZERO                                      04330001
043400              ADD +1 TO PV-RECS-WITH-MATCHES-CNT                  04340001
043500              SET PS-CURSOR-HAS-DATA TO TRUE                      04350001
043600         WHEN SQLCODE = +100                                      04360001
043700              SET PS-TABLE-LOOP-DONE TO TRUE                      04370001
043800         WHEN SQLWARN0 NOT EQUAL SPACE                            04380001
043900         WHEN SQLCODE  NOT EQUAL ZERO                             04390001
044000              MOVE '9100-OPEN-TABLE-CURSOR'                       04400001
044100                                 TO PV-PARAGRAPH-NAME             04410001
044200              MOVE 'OPEN TABLE CURSOR'                            04420001
044300                                 TO PV-DB2-OPERATION-MSG-1        04430001
044400              MOVE 'RCT_PRC_RCPT' TO PV-DB2-TABLE-NAME            04440002
044500              PERFORM 9999-DB2-ABEND                              04450001
044600     END-EVALUATE.                                                04460001
044700                                                                  04470001
044800                                                                  04480001
044900******************************************************************04490002
045000*   FETCH TABLE CURSOR                                           *04500002
045100******************************************************************04510002
045200 9150-FETCH-TABLE-CURSOR.                                         04520001
045300     EXEC SQL                                                     04530001
045400         FETCH TABLE-CURSOR                                       04540001
045500          INTO  :RCT00019-ORD-NBR                                 04550002
045600               ,:RCT00019-ORD-LNE-NBR                             04560002
045700               ,:RCT00019-REC-SEQ-NBR                             04570002
045800               ,:RCT00019-OPER-UNT-ID                             04580002
045900               ,:RCT00019-FCLTY-ID                                04590002
046000               ,:RCT00019-PRC-RCPT-TYP-CDE                        04600002
046100               ,:RCT00019-AMT-TYP-CDE                             04610002
046200               ,:RCT00019-UNT-AMT                                 04620002
046300               ,:RCT00019-GP-AMT                                  04630002
046400               ,:RCT00019-GP-QTY                                  04640002
049700     END-EXEC.                                                    04970001
049800                                                                  04980001
049900     EVALUATE TRUE                                                04990001
050000         WHEN SQLCODE = ZERO                                      05000001
050100              ADD +1                 TO PV-TABLE-ROW-SELECT-CNT   05010001
050200              SET PS-CURSOR-HAS-DATA TO TRUE                      05020001
050300         WHEN SQLCODE = +100                                      05030001
050400              SET PS-TABLE-LOOP-DONE TO TRUE                      05040001
050500         WHEN SQLWARN0 NOT EQUAL SPACE                            05050001
050600         WHEN SQLCODE NOT EQUAL ZERO                              05060001
050700              MOVE '9150-FETCH-TABLE-CURSOR'                      05070001
050800                                 TO PV-PARAGRAPH-NAME             05080001
050900              MOVE 'FETCH TABLE CURSOR'                           05090001
051000                                 TO PV-DB2-OPERATION-MSG-1        05100001
051100              MOVE 'RCT_PRC_RCPT' TO PV-DB2-TABLE-NAME            05110002
051200              PERFORM 9999-DB2-ABEND                              05120001
051300     END-EVALUATE.                                                05130001
051400                                                                  05140001
051500                                                                  05150001
051600******************************************************************05160002
051700*   CLOSE TABLE CURSOR                                           *05170002
051800******************************************************************05180002
051900 9190-CLOSE-TABLE-CURSOR.                                         05190001
052000     EXEC SQL                                                     05200001
052100          CLOSE TABLE-CURSOR                                      05210001
052200     END-EXEC.                                                    05220001
052300                                                                  05230001
052400     EVALUATE TRUE                                                05240001
052500         WHEN SQLCODE = ZERO                                      05250001
052600              CONTINUE                                            05260001
052700         WHEN SQLWARN0 NOT EQUAL SPACE                            05270001
052800         WHEN SQLCODE NOT EQUAL ZERO                              05280001
052900              MOVE '9190-CLOSE-TABLE-CURSOR'                      05290001
053000                                 TO PV-PARAGRAPH-NAME             05300001
053100              MOVE 'CLOSE TABLE CURSOR'                           05310001
053200                                 TO PV-DB2-OPERATION-MSG-1        05320001
053300              MOVE 'RCT_PRC_RCPT' TO PV-DB2-TABLE-NAME            05330002
053400              PERFORM 9999-DB2-ABEND                              05340001
053500     END-EVALUATE.                                                05350001
053600                                                                  05360001
053700                                                                  05370001
054500******************************************************************05450002
054600*   WRITE A RECORD TO THE TABLE EXTRACT FILE                     *05460002
054700******************************************************************05470002
054800 9750-WRITE-EXTRACT-RECORD.                                       05480001
054900     WRITE  OUT-EXTRACT-RECORD  FROM  DCLRCT00019.                05490002
055000     ADD +1 TO PV-EXTRACT-WRITTEN-CNT.                            05500001
055100                                                                  05510001
055200                                                                  05520001
056000******************************************************************05600002
056100*   DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT *05610002
056200*   AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN            *05620002
056300*   SQL ERROR OR WARNING CODE OCCURS.                            *05630002
056400******************************************************************05640002
056500 9999-DB2-ABEND.                                                  05650001
056600                                                                  05660001
056700     DISPLAY PC-CURRENT-PROGRAM-NAME                              05670001
056800             ' 9999-DB2-ABEND'.                                   05680001
056900     DISPLAY PC-CURRENT-PROGRAM-NAME                              05690001
057000             ' ** ABEND           **'.                            05700001
057100     DISPLAY PC-CURRENT-PROGRAM-NAME                              05710001
057200             ' ** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.       05720001
057300     DISPLAY PC-CURRENT-PROGRAM-NAME                              05730001
057400             ' ** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME.       05740001
057500     DISPLAY PC-CURRENT-PROGRAM-NAME                              05750001
057600             ' ** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.  05760001
057700                                                                  05770001
057800     DISPLAY PC-CURRENT-PROGRAM-NAME                              05780001
057900             ' ** SQLCODE         ** = ' SQLCODE.                 05790001
058000     MOVE SQLCODE TO PV-SQLCODE.                                  05800001
058100     DISPLAY PC-CURRENT-PROGRAM-NAME                              05810001
058200             ' ** PV-SQLCODE      ** = ' PV-SQLCODE '.'.          05820001
058300                                                                  05830001
058400     DISPLAY PC-CURRENT-PROGRAM-NAME                              05840001
058500             ' ** SQLWARN0        ** = ' SQLWARN0 '.'.            05850001
058600                                                                  05860001
058700                                                                  05870001
058800*----------------------------------------------------------------*05880001
058900* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *05890001
059000* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *05900001
059100* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *05910001
059200* FORMAT.                                                        *05920001
059300*----------------------------------------------------------------*05930001
059400     COPY DPPD004.                                                05940001
059500                                                                  05950001
059600     MOVE PC-ABENDING               TO DP-STATUS-DESCRIPTION.     05960001
059700     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           05970001
059800     PERFORM 9090-CLOSE-FILES.                                    05980002
060000                                                                  06000001
060100*----------------------------------------------------------------*06010001
060200* CALL ABEND                                                     *06020001
060300*----------------------------------------------------------------*06030001
060400     MOVE +4013                  TO ABEND-CODE.                   06040001
060500     CALL 'ILBOABN0' USING ABEND-CODE.                            06050001
060600*                                                                 06060001
