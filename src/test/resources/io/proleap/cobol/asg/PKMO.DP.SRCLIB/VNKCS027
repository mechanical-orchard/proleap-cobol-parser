000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    VNKCS027.                                         00040000
000500 AUTHOR.        MIKE BESKE.                                       00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  AUGUST 2003.                                      00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    V027 - VENDOR OFF-INVOICE PROGRAM MAINTENANCE SCREEN       * 00110000
001200*                                                               * 00120000
001300*    THIS PROGRAM WILL SHOW THE USER TO ADD/UPDATE ON A LIST OF * 00130000
001400*    OFF-INVOICE ALLOWANCE AGREEMENTS (PROGRAM) THAT HAVE BEEN  * 00140000
001500*    CREATED FOR A VENDOR/DEPARTMENT. THE LIST WILL DEFAULT TO  * 00150000
001600*    SHOW ONLY THOSE AGREEMENTS THAT ARE CURRENTLY ACTIVE, BUT  * 00160000
001700*    A PF KEY WILL ALLOW THE USER TO INCLUDE AGREEMENTS OF THIS * 00170000
001800*    TYPE THAT HAVE EXPIRED AS WELL. EXPIRED ROWS CANNOT BE UP- * 00180000
001900*    DATED.  THIS IS AN UPDATEABLE LIST SCREEN WHICH IS A KOHLS * 00190000
002000*    NON-STANDARD SCREEN TYPE.                                  * 00200000
002100*---------------------------------------------------------------* 00210000
002200*  DATE  03/16/2004                                             * 00220000
002300*      CHANGE MADE: ADDED 'RO' AS A VALID VALUE FOR POSTING     * 00230000
002400*      FREQUENCY CODE - IT MEANS REPORT ONLY, DO NOT CREATE     * 00240000
002500*      VENDOR DEDUCTIONS.                                       * 00250000
002600*      MADE BY: NANCY EILBES            WR/IR #: WR26677        * 00260000
002700*                                                               * 00270000
002800*  DATE  04/14/2004                                             * 00280000
002900*      CHANGE MADE: MODIFIED THE CODE IN THIS PROGRAM AS FOLLOWS* 00290000
003000*      TRAN CODE CAN NO LONGER BE UPDATED ONCE AN AGREEMENT IS  * 00300000
003100*      IS ADDED.  EXPIRING A CURRENT ROW ONLY HAPPENS WHEN THE  * 00310000
003200*      % OR POSTING FREQUENCY ARE CHANGED.  IF THESE FIELDS ARE * 00320000
003300*      CHANGED ON A FUTURE EFFECTIVE ROW, THEN THE ROW IS JUST  * 00330000
003400*      UPDATED WITH NO EXPIRING.  IF ANY OTHER FIELDS ARE       * 00340000
003500*      CHANGED, THE ROW (CURRENT OR FUTURE) IS UPDATED, NOT EX- * 00350000
003600*      EXPIRED.  THE EFFECTIVE DATE FOR ANY OF THE POSTING      * 00360000
003700*      FREQUENCIES MUST NOW BE A VALID FIRST FISCAL DAY OF A    * 00370000
003800*      FISCAL MONTH FOR THAT POSTING FREQUENCY.  WHEN A NEW ROW * 00380000
003900*      IS ADDED AND THE EFFECTIVE DATE IS NOT KEYED, THEN THE   * 00390000
004000*      EFFECTIVE DATE THAT IS COMPUTED WILL BE BASED ON THE     * 00400000
004100*      CURRENT DATE AND THE ENTERED POSTING FREQUENCY.  WHENEVER* 00410000
004200*      THE % OR POSTING FREQUENCY IS CHANGED THE EFFECTIVE DATE * 00420000
004300*      MUST ALSO BE KEYED, EVEN IF THE VALUE OF THE EFFECTIVE   * 00430000
004400*      DATE IS NOT CHANGING.  FAILURE TO DO THIS WILL RESULT IN * 00440000
004500*      AN ERROR MESSAGE.  THE POSTING FREQ 'RO' WILL FOLLOW     * 00450000
004600*      THE EFFECTIVE DATE RULES OF THE 'FM' POSTING FREQ.  THE  * 00460000
004700*      DATE ATTRIBUTE TABLE (TDTATTR) WAS ADDED.  IT IS USED TO * 00470000
004800*      COMPUTE AND VALIDATE THE FIRST DATES (EFFECTIVE DATE     * 00480000
004900*      VALUES) OF FISCAL MONTHS FOR THE VARIOUS POSTING FREQS.  * 00490000
005000*      MADE BY: MIKE BESKE              WR/IR #: WR26677        * 00500000
005100*                                                               * 00510000
005200*  DATE  07/08/2005                                             * 00520000
005300*      CHANGE MADE: OFF-INVOICE CO-OP ADVERTISING ALLOWANCES.   * 00530000
005400*      ADDED THE FIELD VN013-COOP-DISC-PCT TO COPYBOOK VNWS013  * 00540000
005500*      ALONG WITH THE 88 LEVEL VN013-FUNCTION-VENDOR-ALLW.      * 00550000
005600*      ADDED 'IV' TO THE LIST OF VALID VALUES FOR ASC-FREQ-IND  * 00560000
005700*      IN PARAGRAPH 3420-.  IN PARAGRAPH 4420-, MOVED THE       * 00570000
005800*      STRING 'OFFINVC' TO THE MR-FREQUENCY FIELD WHEN THE      * 00580000
005900*      ASC-FREQUENCY IS 'IV'.  IN PARAGRAPHS 8000- AND 8500-    * 00590000
006000*      ADDED LOGIC TO USE THE CURRENT DATE AS THE EFFECTIVE     * 00600000
006100*      DATE WHEN THE FREQUENCY IS 'IV'.  CREATED PARAGRAPH      * 00610000
006200*      4005- TO SELECT THOSE COLUMNS FROM THE TEXTENT AND       * 00620000
006300*      TENTNME TABLES NEEDED FOR MESSAGE PASSING.  ADDED LOGIC  * 00630000
006400*      TO PARAGRAPH 3300- TO SET THE ASC-VND-IN-RMS-IND TO 'Y'  * 00640000
006500*      IF NO ERRORS OCCURRED UPDATING OR INSERTING INTO THE     * 00650000
006600*      TVNDAGR TABLE.  ALSO CREATED PARAGRAPH 5300- TO          * 00660000
006700*      INTERFACE WITH RMS WHEN THE FOLLOWING CONDITIONS ARE     * 00670000
006800*      SATISFIED:                                               * 00680000
006900*         PV-TRANCODE = '90'                                    * 00690000
007000*         ASC-FREQ-IND = 'IV'                                   * 00700000
007100*         ASC-VND-IN-RMS-IND = 'Y'                              * 00710000
007200*      ADDED THE FIELDS ASC-VND-IN-RMS-IND, ASC-STATUS-CDE,     * 00720000
007300*      ASC-EDI-PO-PREPK-CDE, ASC-PRIM-TYP-CDE, ASC-GVRNG-IND,   * 00730000
007400*      ASC-GVRNG-ENT-ID, ASC-CART-LBL-IND, ASC-CART-LBL-EFF-DTE,* 00740000
007500*      AND ASC-COOP-PERCENT TO THE COMMAREA TO BE USED IN       * 00750000
007600*      PARAGRAPH 5300- FOR MESSAGING.                           * 00760000
007700*      MADE BY: KRYSTEN LEARY           WR/IR #: WR28651        * 00770000
007800*                                                               * 00780000
007900*  DATE  03/21/2006                                             * 00790000
008000*      CHANGE MADE: DUE TO THE CHANGES THAT ARE PART OF THE     * 00800000
008100*      VENDOR ALLOWANCE AUTOMATION PROJECT, THE PREVIOUS VERSION* 00810000
008200*      OF THIS PROGRAM (ARCH.VNKCS027.PKMO.G0004V00) IS BEING   * 00820000
008300*      REINSTATED AS THE PRODUCTION VERSION.  THE MQ MESSAGING  * 00830000
008400*      CODE THAT WAS ADDED IS NO LONGER NEEDED AND THE IV TYPE  * 00840000
008500*      (OFF INVOICE) ENTRY WILL NOT BE MAINTAINED FROM THIS     * 00850000
008600*      PROGRAM.  IT IS BEING MOVED TO THE PROGRAM MAINTENANCE   * 00860000
008700*      PROGRAM VNKCS012.                                        * 00870001
008800*      MADE BY: MIKE BESKE              WR/IR #: WR30028        * 00880000
008860*                                                               * 00880105
008810*  DATE  09/07/2021                                              *00881002
008820*            - CHANGE CALL OF DPKUT100 TO                       * 00882002
008830*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00883002
008840*              MAKING THE CALL DYNAMIC VS STATIC                * 00884002
008850*      MADE BY: GERMAN BANDA            WR/IR #: CHG0261091      *00885004
008860*                                                               * 00886002
008810*  DATE  01/05/2023                                              *00887005
008820*            - CHANGE CALL OF DPKCS030 TO DYNAMIC               * 00888005
008850*      MADE BY: JEAN KURK               WR/IR #: CHG0277999      *00889205
008900*---------------------------------------------------------------* 00890000
009000 EJECT                                                            00900000
009100 ENVIRONMENT DIVISION.                                            00910000
009200                                                                  00920000
009300 DATA DIVISION.                                                   00930000
009400                                                                  00940000
009500 WORKING-STORAGE SECTION.                                         00950000
009600                                                                  00960000
009700******************************************************************00970000
009800* WORK AREA PASSED IN CALL TO DPKUT500 DATE ROUTINE.             *00980000
009900******************************************************************00990000
010000     COPY DPWS500.                                                01000000
010100                                                                  01010000
010200 01  DN-DB2-NULL-INDICATORS.                                      01020000
010300     05  DN-DISCOUNT-PCT              PIC S9(04) VALUE +0         01030000
010400                                                  COMP.           01040000
010500     05  DN-EXPIRATION-DATE           PIC S9(04) VALUE +0         01050000
010600                                                  COMP.           01060000
010700 01  DK-DB2-KEYS.                                                 01070000
010800     05  DK-DEPT-NBR                  PIC  X(03) VALUE SPACES.    01080000
010900     05  DK-VEND-NAME                 PIC  X(30) VALUE SPACES.    01090000
011000     05  DK-DUNS-NUMBER               PIC  X(09).                 01100000
011100     05  DK-INHOUSE-NUMBER            PIC S9(03) VALUE +0         01110000
011200                                                 COMP-3.          01120000
011300     05  DK-ENT-ID                    PIC S9(09) VALUE +0         01130000
011400                                                 COMP.            01140000
011500                                                                  01150000
011600 01  PC-PROGRAM-CONSTANTS.                                        01160000
011700     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         01170000
011800                                                    'VN027A  '.   01180000
011900     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         01190000
012000                                                    'VNKM027 '.   01200000
012100     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         01210000
012200                                                    'VNKCS027'.   01220000
012300     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      01230000
012400     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      01240000
012500     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    01250000
012600     05  PC-INTER-APPL-CODES.                                     01260000
012700         10  PC-INTER-APPL-CRIT-SPEC  PIC X(01)  VALUE '1'.       01270000
012800         10  PC-INTER-APPL-LIST       PIC X(01)  VALUE '2'.       01280000
012900         10  PC-INTER-APPL-BLANK      PIC X(01)  VALUE ' '.       01290000
013000     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +11     01300000
013100                                                    COMP SYNC.    01310000
013200     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      01320000
013300                                                    COMP SYNC.    01330000
013400     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         01340000
013500                                                    +999999       01350000
013600                                                    COMP-3.       01360000
013700     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       01370000
013800                                                    COMP-3.       01380000
013900     05  PC-INQ                         PIC  X(01)  VALUE 'I'.    01390000
014000     05  PC-UPD                         PIC  X(01)  VALUE 'U'.    01400000
014100     05  PC-DEL                         PIC  X(01)  VALUE 'D'.    01410000
014200     05  PC-ERR                         PIC  X(01)  VALUE 'E'.    01420000
014300*                                                                 01430000
014400     05  PC-TSYMSG-NUMBERS.                                       01440000
014500         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01450000
014600         10  PC-TSYMSG-00007            PIC  9(05)  VALUE 00007.  01460000
014700         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  01470000
014800         10  PC-TSYMSG-00009            PIC  9(05)  VALUE 00009.  01480000
014900         10  PC-TSYMSG-00034            PIC  9(05)  VALUE 00034.  01490000
015000         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01500000
015100         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01510000
015200         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01520000
015300         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01530000
015400         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01540000
015500         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01550000
015600         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01560000
015700         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.  01570000
015800         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01580000
015900         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01590000
016000         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01600000
016100         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  01610000
016200         10  PC-TSYMSG-00174            PIC  9(05)  VALUE 00174.  01620000
016300         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01630000
016400         10  PC-TSYMSG-00308            PIC  9(05)  VALUE 00308.  01640000
016500         10  PC-TSYMSG-00984            PIC  9(05)  VALUE 00984.  01650000
016600         10  PC-TSYMSG-00635            PIC  9(05)  VALUE 00635.  01660000
016700         10  PC-TSYMSG-00636            PIC  9(05)  VALUE 00636.  01670000
016800         10  PC-TSYMSG-01318            PIC  9(05)  VALUE 01318.  01680000
016900         10  PC-TSYMSG-01375            PIC  9(05)  VALUE 01375.  01690000
017000         10  PC-TSYMSG-01933            PIC  9(05)  VALUE 01933.  01700000
017100         10  PC-TSYMSG-02521            PIC  9(05)  VALUE 02521.  01710000
017200         10  PC-TSYMSG-02522            PIC  9(05)  VALUE 02522.  01720000
017300         10  PC-TSYMSG-02523            PIC  9(05)  VALUE 02523.  01730000
017400         10  PC-TSYMSG-02524            PIC  9(05)  VALUE 02524.  01740000
017500         10  PC-TSYMSG-02525            PIC  9(05)  VALUE 02525.  01750000
017600         10  PC-TSYMSG-02526            PIC  9(05)  VALUE 02526.  01760000
017700         10  PC-TSYMSG-02585            PIC  9(05)  VALUE 02585.  01770000
017800         10  PC-TSYMSG-02586            PIC  9(05)  VALUE 02586.  01780000
017900         10  PC-TSYMSG-02587            PIC  9(05)  VALUE 02587.  01790000
018000         10  PC-TSYMSG-02645            PIC  9(05)  VALUE 02645.  01800000
018100         10  PC-TSYMSG-02646            PIC  9(05)  VALUE 02646.  01810000
018200         10  PC-TSYMSG-03110            PIC  9(05)  VALUE 03110.  01820000
018300         10  PC-TSYMSG-03111            PIC  9(05)  VALUE 03111.  01830000
018400         10  PC-TSYMSG-03112            PIC  9(05)  VALUE 03112.  01840000
018500         10  PC-TSYMSG-03113            PIC  9(05)  VALUE 03113.  01850000
018600         10  PC-TSYMSG-03114            PIC  9(05)  VALUE 03114.  01860000
018700         10  PC-TSYMSG-03115            PIC  9(05)  VALUE 03115.  01870000
018800         10  PC-TSYMSG-03116            PIC  9(05)  VALUE 03116.  01880000
018900         10  PC-TSYMSG-03117            PIC  9(05)  VALUE 03117.  01890000
019000         10  PC-TSYMSG-03118            PIC  9(05)  VALUE 03118.  01900000
019100         10  PC-TSYMSG-03119            PIC  9(05)  VALUE 03119.  01910000
019200         10  PC-TSYMSG-03120            PIC  9(05)  VALUE 03120.  01920000
019300         10  PC-TSYMSG-03121            PIC  9(05)  VALUE 03121.  01930000
019400         10  PC-TSYMSG-03123            PIC  9(05)  VALUE 03123.  01940000
019500         10  PC-TSYMSG-03124            PIC  9(05)  VALUE 03124.  01950000
019600         10  PC-TSYMSG-03131            PIC  9(05)  VALUE 03131.  01960000
019700         10  PC-TSYMSG-03132            PIC  9(05)  VALUE 03132.  01970000
019800         10  PC-TSYMSG-03139            PIC  9(05)  VALUE 03139.  01980000
019900         10  PC-TSYMSG-03140            PIC  9(05)  VALUE 03140.  01990000
020000         10  PC-TSYMSG-03143            PIC  9(05)  VALUE 03143.  02000000
020100         10  PC-TSYMSG-03144            PIC  9(05)  VALUE 03144.  02010000
020200         10  PC-TSYMSG-03145            PIC  9(05)  VALUE 03145.  02020000
020300         10  PC-TSYMSG-03146            PIC  9(05)  VALUE 03146.  02030000
020400         10  PC-TSYMSG-03147            PIC  9(05)  VALUE 03147.  02040000
020500         10  PC-TSYMSG-03148            PIC  9(05)  VALUE 03148.  02050000
020600         10  PC-TSYMSG-03250            PIC  9(05)  VALUE 03250.  02060000
020700         10  PC-TSYMSG-03251            PIC  9(05)  VALUE 03251.  02070000
020800         10  PC-TSYMSG-03252            PIC  9(05)  VALUE 03252.  02080000
020900         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  02090000
021000*                                                                 02100000
021100 01  PS-PROGRAM-SWITCHES.                                         02110000
021200     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    02120000
021300         88  PS-NO-ERROR                            VALUE 'Y'.    02130000
021400         88  PS-ERROR                               VALUE 'N'.    02140000
021500     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    02150000
021600         88  PS-COMMAREA-VALID                      VALUE 'Y'.    02160000
021700         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    02170000
021800     05  PS-VALID-DATE-SW               PIC  X(01).               02180000
021900         88  PS-VALID-DATE                          VALUE 'Y'.    02190000
022000         88  PS-INVALID-DATE                        VALUE 'N'.    02200000
022100*                                                                 02210000
022200 01  PV-PROGRAM-VARIABLES.                                        02220000
022300     05  PV-SUB                         PIC S9(04)  VALUE +0      02230000
022400                                                    COMP SYNC.    02240000
022500     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      02250000
022600                                                    COMP SYNC.    02260000
022700     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      02270000
022800                                                    COMP-3.       02280000
022900     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      02290000
023000                                                    COMP-3.       02300000
023100     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      02310000
023200                                                    COMP-3.       02320000
023300     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      02330000
023400                                                    COMP-3.       02340000
023500     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      02350000
023600                                                    COMP-3.       02360000
023700     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      02370000
023800                                                    COMP-3.       02380000
023900     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      02390000
024000                                                    COMP-3.       02400000
024100     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      02410000
024200                                                    COMP SYNC.    02420000
024300     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      02430000
024400                                                    COMP SYNC.    02440000
024500     05  PV-ITEM                        PIC S9(04)  VALUE +0      02450000
024600                                                    COMP SYNC.    02460000
024700     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      02470000
024800                                                    COMP SYNC.    02480000
024900     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      02490000
025000                                                    COMP SYNC.    02500000
025100     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      02510000
025200                                                    COMP SYNC.    02520000
025300     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      02530000
025400                                                    COMP SYNC.    02540000
025500     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      02550000
025600                                                    COMP SYNC.    02560000
025700     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02570000
025800                                                    COMP SYNC.    02580000
025900     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02590000
026000                                                    COMP SYNC.    02600000
026100     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      02610000
026200                                                    COMP SYNC.    02620000
026300     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      02630000
026400                                                    COMP SYNC.    02640000
026500     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      02650000
026600                                                    COMP SYNC.    02660000
026700     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      02670000
026800                                                    COMP SYNC.    02680000
026900     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      02690000
027000                                                    COMP SYNC.    02700000
027100     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02710000
027200                                                    COMP SYNC.    02720000
027300     05  PV-INHOUSE-NBR-X.                                        02730000
027400         10  PV-INHOUSE-NBR             PIC  9(03)  VALUE ZERO.   02740000
027500     05  PV-INHOUSE-NUMBER              PIC S9(03)  VALUE +0      02750000
027600                                                    COMP-3.       02760000
027700     05  PV-MAX-SEQ-NBR                 PIC S9(04)  VALUE +0      02770000
027800                                                    COMP.         02780000
027900     05  PV-NEXT-SEQ-NBR                PIC S9(04)  VALUE +0      02790000
028000                                                    COMP.         02800000
028100     05  PV-OVERLAP-COUNT               PIC S9(09)  VALUE +0      02810000
028200                                                    COMP.         02820000
028300     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      02830000
028400                                                    COMP.         02840000
028500     05  PV-SEQ-NBR                     PIC S9(04)  VALUE +0      02850000
028600                                                    COMP.         02860000
028700     05  PV-TRANCODE                    PIC  X(02)  VALUE SPACE.  02870000
028800     05  PV-PERCENT                     PIC  X(05).               02880000
028900     05  PV-PERCENT-FMT REDEFINES PV-PERCENT                      02890000
029000                                        PIC  ZZ.99.               02900000
029100     05  PV-ONE                         PIC  X(01)  VALUE SPACE.  02910000
029200     05  PV-EFFECTIVE-DATE              PIC  X(10)  VALUE SPACE.  02920000
029300     05  PV-CALC-EXPDTE                 PIC  X(10)  VALUE SPACE.  02930000
029400     05  PV-ORIGINAL-EFFDTE             PIC  X(10).               02940000
029500     05  PV-ORIGINAL-EXPDTE             PIC  X(10).               02950000
029600     05  PV-ORIGINAL-EXPDTE-RED REDEFINES PV-ORIGINAL-EXPDTE.     02960000
029700         10  PV-ORIG-EXPDTE-CCYY        PIC  9(04).               02970000
029800         10  PV-ORIG-EXPDTE-DASH1       PIC  X(01).               02980000
029900         10  PV-ORIG-EXPDTE-MM          PIC  9(02).               02990000
030000         10  PV-ORIG-EXPDTE-DASH2       PIC  X(01).               03000000
030100         10  PV-ORIG-EXPDTE-DD          PIC  9(02).               03010000
030200     05  PV-DB2-EFFDTE                  PIC  X(10).               03020000
030300     05  PV-DB2-EFFDTE-RED REDEFINES PV-DB2-EFFDTE.               03030000
030400         10  PV-DB2-EFFDTE-CCYY         PIC  9(04).               03040000
030500         10  PV-DB2-EFFDTE-DASH1        PIC  X(01).               03050000
030600         10  PV-DB2-EFFDTE-MM           PIC  9(02).               03060000
030700         10  PV-DB2-EFFDTE-DASH2        PIC  X(01).               03070000
030800         10  PV-DB2-EFFDTE-DD           PIC  9(02).               03080000
030900     05  PV-DB2-EXPDTE                  PIC  X(10).               03090000
031000     05  PV-DB2-EXPDTE-RED REDEFINES PV-DB2-EXPDTE.               03100000
031100         10  PV-DB2-EXPDTE-CCYY         PIC  9(04).               03110000
031200         10  PV-DB2-EXPDTE-DASH1        PIC  X(01).               03120000
031300         10  PV-DB2-EXPDTE-MM           PIC  9(02).               03130000
031400         10  PV-DB2-EXPDTE-DASH2        PIC  X(01).               03140000
031500         10  PV-DB2-EXPDTE-DD           PIC  9(02).               03150000
031600     05  PV-TMP-EFFDTE                  PIC  X(10).               03160000
031700     05  PV-TMP-EFFDTE-RED REDEFINES PV-TMP-EFFDTE.               03170000
031800         10  PV-TMP-EFFDTE-CCYY         PIC  9(04).               03180000
031900         10  PV-TMP-EFFDTE-DASH1        PIC  X(01).               03190000
032000         10  PV-TMP-EFFDTE-MM           PIC  9(02).               03200000
032100         10  PV-TMP-EFFDTE-DASH2        PIC  X(01).               03210000
032200         10  PV-TMP-EFFDTE-DD           PIC  9(02).               03220000
032300     05  PV-TMP-EXPDTE                  PIC  X(10).               03230000
032400     05  PV-TMP-EXPDTE-RED REDEFINES PV-TMP-EXPDTE.               03240000
032500         10  PV-TMP-EXPDTE-CCYY         PIC  9(04).               03250000
032600         10  PV-TMP-EXPDTE-DASH1        PIC  X(01).               03260000
032700         10  PV-TMP-EXPDTE-MM           PIC  9(02).               03270000
032800         10  PV-TMP-EXPDTE-DASH2        PIC  X(01).               03280000
032900         10  PV-TMP-EXPDTE-DD           PIC  9(02).               03290000
033000     05  PV-EFFDTE                      PIC  X(10).               03300000
033100     05  PV-EFFDTE-RED REDEFINES PV-EFFDTE.                       03310000
033200         10  PV-EFFDTE-CCYY             PIC  9(04).               03320000
033300         10  FILLER                     PIC  X(01).               03330000
033400         10  PV-EFFDTE-MM               PIC  9(02).               03340000
033500         10  FILLER                     PIC  X(01).               03350000
033600         10  PV-EFFDTE-DD               PIC  9(02).               03360000
033700     05  PV-EXPDTE                      PIC  X(10).               03370000
033800     05  PV-EXPDTE-RED REDEFINES PV-EXPDTE.                       03380000
033900         10  PV-EXPDTE-CCYY             PIC  9(04).               03390000
034000         10  FILLER                     PIC  X(01).               03400000
034100         10  PV-EXPDTE-MM               PIC  9(02).               03410000
034200         10  FILLER                     PIC  X(01).               03420000
034300         10  PV-EXPDTE-DD               PIC  9(02).               03430000
034400                                                                  03440000
034500     05  PV-EFFDTE-FMT.                                           03450000
034600         10  PV-EFFDTE-FMTMM            PIC  9(02).               03460000
034700         10  FILLER                     PIC  X(01)  VALUE '/'.    03470000
034800         10  PV-EFFDTE-FMTDD            PIC  9(02).               03480000
034900         10  FILLER                     PIC  X(01)  VALUE '/'.    03490000
035000         10  PV-EFFDTE-FMTCCYY          PIC  9(04).               03500000
035100                                                                  03510000
035200     05  PV-EXPDTE-FMT.                                           03520000
035300         10  PV-EXPDTE-FMTMM            PIC  9(02).               03530000
035400         10  FILLER                     PIC  X(01)  VALUE '/'.    03540000
035500         10  PV-EXPDTE-FMTDD            PIC  9(02).               03550000
035600         10  FILLER                     PIC  X(01)  VALUE '/'.    03560000
035700         10  PV-EXPDTE-FMTCCYY          PIC  9(04).               03570000
035800     05  PV-DEFAULT-DATE                PIC  X(10).               03580000
035900     05  PV-CCYYMMDD-DATE               PIC  X(10).               03590000
036000     05  PV-CCYYMMDD-DATE-RDF           REDEFINES                 03600000
036100         PV-CCYYMMDD-DATE.                                        03610000
036200         10  PV-CCYY                    PIC  X(04).               03620000
036300         10  PV-CCYY-9   REDEFINES PV-CCYY                        03630000
036400                                        PIC  9(04).               03640000
036500         10  PV-CCYY-RDF REDEFINES PV-CCYY.                       03650000
036600             15  PV-CC                  PIC  9(02).               03660000
036700             15  PV-YY                  PIC  9(02).               03670000
036800         10  PV-DASH1                   PIC  X(01).               03680000
036900         10  PV-MM                      PIC  X(02).               03690000
037000         10  PV-MM-9     REDEFINES PV-MM                          03700000
037100                                        PIC  9(02).               03710000
037200         10  PV-DASH2                   PIC  X(01).               03720000
037300         10  PV-DD                      PIC  X(02).               03730000
037400         10  PV-DD-9     REDEFINES PV-DD                          03740000
037500                                        PIC  9(02).               03750000
037600******************************************************************03760000
037700**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **03770000
037800**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **03780000
037900**  APPLICATION-SPECIFIC COMMAREA.                              **03790000
038000******************************************************************03800000
038100 01  LQW-LIST-QUEUE-WORK-AREA.                                    03810000
038200     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  03820000
038300     05  LQW-ITEM-ENTRIES               OCCURS 11 TIMES           03830000
038400                                        INDEXED BY LQW-IDX.       03840000
038500         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       03850000
038600         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               03860000
038700         10  LQW-SELECTED-SW            PIC  X(01).               03870000
038800             88  LQW-SELECT                         VALUE 'S'.    03880000
038900             88  LQW-DESELECT                       VALUE ' '.    03890000
039000         10  LQW-ENT-ID                 PIC S9(09)                03900000
039100                                             COMP.                03910000
039200         10  LQW-TRANCODE               PIC  X(02).               03920000
039300         10  LQW-SEQ-NBR                PIC S9(04)                03930000
039400                                             COMP.                03940000
039500         10  LQW-PERCENT                PIC  99V99.               03950000
039600         10  LQW-PERCENT-UNFMT          PIC  X(05).               03960000
039700         10  LQW-PERCENT-ORIG-ENTRD     PIC  X(05).               03970000
039800         10  LQW-PERCENT-ERR-FLAG       PIC  X(01).               03980000
039900         10  LQW-DESCRIPTION            PIC  X(18).               03990000
040000         10  LQW-NET-RTV                PIC  X(01).               04000000
040100         10  LQW-NET-DISC               PIC  X(01).               04010000
040200         10  LQW-FREQ-IND               PIC  X(02).               04020000
040300         10  LQW-EFFDTE-MM              PIC  9(02).               04030000
040400         10  LQW-EFFDTE-DD              PIC  9(02).               04040000
040500         10  LQW-EFFDTE-CCYY            PIC  9(04).               04050000
040600         10  LQW-EXPDTE-MM              PIC  9(02).               04060000
040700         10  LQW-EXPDTE-DD              PIC  9(02).               04070000
040800         10  LQW-EXPDTE-CCYY            PIC  9(04).               04080000
040900         10  LQW-LINE-CHANGED-SW        PIC  X(01).               04090000
041000*            88  LQW-LINE-UPDATED       VALUE 'A'.                04100000
041100*            88  LQW-LINE-CHANGED       VALUE 'Y'.                04110000
041200*            88  LQW-LINE-NOT-CHANGED   VALUE ' '.                04120000
041300         10  LQW-LINE-PROBLEM-SW        PIC  X(01).               04130000
041400*            88  LQW-LINE-ERROR         VALUE 'E'.                04140000
041500*            88  LQW-LINE-OK            VALUE ' '.                04150000
041600         10  LQW-PERCENT-CHANGED-SW     PIC  X(01).               04160000
041700*          88  LQW-PERCENT-NOT-CHANGED  VALUE 'N'.                04170000
041800*          88  LQW-PERCENT-CHANGED      VALUE 'Y'.                04180000
041900         10  LQW-FREQ-IND-CHANGED-SW    PIC  X(01).               04190000
042000*          88  LQW-FREQ-IND-NOT-CHANGED VALUE 'N'.                04200000
042100*          88  LQW-FREQ-IND-CHANGED     VALUE 'Y'.                04210000
042200         10  LQW-FREQ-IND-VALID-SW      PIC  X(01).               04220000
042300*          88  LQW-FREQ-IND-NOT-VALID   VALUE 'N'.                04230000
042400*          88  LQW-FREQ-IND-VALID       VALUE 'Y'.                04240000
042500         10  LQW-FREQ-EFFDATE-MATCH-SW  PIC  X(01).               04250000
042600*          88  LQW-FREQ-EFFDATE-NOT-MATCH  VALUE 'N'.             04260000
042700*          88  LQW-FREQ-EFFDATE-MATCH      VALUE 'Y'.             04270000
042800         10  LQW-EFF-MM-CHANGED-SW      PIC  X(01).               04280000
042900*          88  LQW-EFF-MM-NOT-CHANGED   VALUE 'N'.                04290000
043000*          88  LQW-EFF-MM-CHANGED       VALUE 'Y'.                04300000
043100         10  LQW-EFF-DD-CHANGED-SW      PIC  X(01).               04310000
043200*          88  LQW-EFF-DD-NOT-CHANGED   VALUE 'N'.                04320000
043300*          88  LQW-EFF-DD-CHANGED       VALUE 'Y'.                04330000
043400         10  LQW-EFF-CY-CHANGED-SW      PIC  X(01).               04340000
043500*          88  LQW-EFF-CY-NOT-CHANGED   VALUE 'N'.                04350000
043600*          88  LQW-EFF-CY-CHANGED       VALUE 'Y'.                04360000
043700                                                                  04370000
043800     EJECT                                                        04380000
043900*---------------------------------------------------------------* 04390000
044000*  RECORD LAYOUT FOR THE PROGRAM SELECTION TEMP STORAGE QUEUE.  * 04400000
044100*---------------------------------------------------------------* 04410000
044200                                                                  04420000
044300     COPY VNWS003.                                                04430000
044400                                                                  04440000
044500     EJECT                                                        04450000
044600*---------------------------------------------------------------* 04460000
044700*    MAP LAYOUT                                                 * 04470000
044800*---------------------------------------------------------------* 04480000
044900                                                                  04490000
045000     COPY VNKM027.                                                04500000
045100*                                                                 04510000
045200 01  MR-OCCURS-LAYOUT                   REDEFINES  VN027AO.       04520000
045300     05  FILLER                         PIC X(17).                04530000
045400     05  MR-DPTNBR                      PIC X(03).                04540000
045500     05  FILLER                         PIC X(05).                04550000
045600     05  MR-VNNAME                      PIC X(30).                04560000
045700     05  FILLER                         PIC X(05).                04570000
045800     05  MR-INHS                        PIC X(03).                04580000
045900     05  FILLER                         PIC X(05).                04590000
046000     05  MR-DUNNBR                      PIC X(09).                04600000
046100     05  FILLER                         PIC X(30).                04610000
046200     05  MR-SCROLL-AREA                 OCCURS 11 TIMES.          04620000
046300         10  MR-SELECTL                 PIC S9(04) COMP.          04630000
046400         10  MR-SELECTA                 PIC  X(01).               04640000
046500         10  MR-SELECTC                 PIC  X(01).               04650000
046600         10  MR-SELECTH                 PIC  X(01).               04660000
046700         10  MR-SELECTI                 PIC  X(01).               04670000
046800                                                                  04680000
046900         10  MR-TRANCODEL               PIC S9(04) COMP.          04690000
047000         10  MR-TRANCODEA               PIC  X(01).               04700000
047100         10  MR-TRANCODEC               PIC  X(01).               04710000
047200         10  MR-TRANCODEH               PIC  X(01).               04720000
047300         10  MR-TRANCODE                PIC  X(02).               04730000
047400                                                                  04740000
047500         10  MR-PERCENTL                PIC S9(04) COMP.          04750000
047600         10  MR-PERCENTA                PIC  X(01).               04760000
047700         10  MR-PERCENTC                PIC  X(01).               04770000
047800         10  MR-PERCENTH                PIC  X(01).               04780000
047900         10  MR-PERCENT-FMT             PIC  Z9.99.               04790000
048000         10  MR-PERCENT REDEFINES MR-PERCENT-FMT                  04800000
048100                                        PIC  X(05).               04810000
048200                                                                  04820000
048300         10  MR-DESCRIPTIONL            PIC S9(04) COMP.          04830000
048400         10  MR-DESCRIPTIONA            PIC  X(01).               04840000
048500         10  MR-DESCRIPTIONC            PIC  X(01).               04850000
048600         10  MR-DESCRIPTIONH            PIC  X(01).               04860000
048700         10  MR-DESCRIPTION             PIC  X(17).               04870000
048800                                                                  04880000
048900         10  MR-NET-RTVL                PIC S9(04) COMP.          04890000
049000         10  MR-NET-RTVA                PIC  X(01).               04900000
049100         10  MR-NET-RTVC                PIC  X(01).               04910000
049200         10  MR-NET-RTVH                PIC  X(01).               04920000
049300         10  MR-NET-RTV                 PIC  X(01).               04930000
049400                                                                  04940000
049500         10  MR-NET-DISCL               PIC S9(04) COMP.          04950000
049600         10  MR-NET-DISCA               PIC  X(01).               04960000
049700         10  MR-NET-DISCC               PIC  X(01).               04970000
049800         10  MR-NET-DISCH               PIC  X(01).               04980000
049900         10  MR-NET-DISC                PIC  X(01).               04990000
050000                                                                  05000000
050100         10  MR-FREQ-INDL               PIC S9(04) COMP.          05010000
050200         10  MR-FREQ-INDA               PIC  X(01).               05020000
050300         10  MR-FREQ-INDC               PIC  X(01).               05030000
050400         10  MR-FREQ-INDH               PIC  X(01).               05040000
050500         10  MR-FREQ-IND                PIC  X(02).               05050000
050600                                                                  05060000
050700         10  MR-FREQUENCYL              PIC S9(04) COMP.          05070000
050800         10  MR-FREQUENCYA              PIC  X(01).               05080000
050900         10  MR-FREQUENCYC              PIC  X(01).               05090000
051000         10  MR-FREQUENCYH              PIC  X(01).               05100000
051100         10  MR-FREQUENCY               PIC  X(07).               05110000
051200                                                                  05120000
051300         10  MR-EFFDTE-MML              PIC S9(04) COMP.          05130000
051400         10  MR-EFFDTE-MMA              PIC  X(01).               05140000
051500         10  MR-EFFDTE-MMC              PIC  X(01).               05150000
051600         10  MR-EFFDTE-MMH              PIC  X(01).               05160000
051700         10  MR-EFFDTE-MM               PIC  X(02).               05170000
051800                                                                  05180000
051900         10  MR-EFFDTE-DDL              PIC S9(04) COMP.          05190000
052000         10  MR-EFFDTE-DDA              PIC  X(01).               05200000
052100         10  MR-EFFDTE-DDC              PIC  X(01).               05210000
052200         10  MR-EFFDTE-DDH              PIC  X(01).               05220000
052300         10  MR-EFFDTE-DD               PIC  X(02).               05230000
052400                                                                  05240000
052500         10  MR-EFFDTE-CCYYL            PIC S9(04) COMP.          05250000
052600         10  MR-EFFDTE-CCYYA            PIC  X(01).               05260000
052700         10  MR-EFFDTE-CCYYC            PIC  X(01).               05270000
052800         10  MR-EFFDTE-CCYYH            PIC  X(01).               05280000
052900         10  MR-EFFDTE-CCYY             PIC  X(04).               05290000
053000                                                                  05300000
053100         10  MR-EXPDTE-MML              PIC S9(04) COMP.          05310000
053200         10  MR-EXPDTE-MMA              PIC  X(01).               05320000
053300         10  MR-EXPDTE-MMC              PIC  X(01).               05330000
053400         10  MR-EXPDTE-MMH              PIC  X(01).               05340000
053500         10  MR-EXPDTE-MM               PIC  X(02).               05350000
053600                                                                  05360000
053700         10  MR-EXPDTE-DDL              PIC S9(04) COMP.          05370000
053800         10  MR-EXPDTE-DDA              PIC  X(01).               05380000
053900         10  MR-EXPDTE-DDC              PIC  X(01).               05390000
054000         10  MR-EXPDTE-DDH              PIC  X(01).               05400000
054100         10  MR-EXPDTE-DD               PIC  X(02).               05410000
054200                                                                  05420000
054300         10  MR-EXPDTE-CCYYL            PIC S9(04) COMP.          05430000
054400         10  MR-EXPDTE-CCYYA            PIC  X(01).               05440000
054500         10  MR-EXPDTE-CCYYC            PIC  X(01).               05450000
054600         10  MR-EXPDTE-CCYYH            PIC  X(01).               05460000
054700         10  MR-EXPDTE-CCYY             PIC  X(04).               05470000
054800     EJECT                                                        05480000
054900*---------------------------------------------------------------* 05490000
055000*    ATTRIBUTE SETTINGS COPYBOOK.                               * 05500000
055100*---------------------------------------------------------------* 05510000
055200                                                                  05520000
055300     COPY DPWS015.                                                05530000
055400                                                                  05540000
055500*---------------------------------------------------------------* 05550000
055600*    FUNCTION KEYS COPYBOOK.                                    * 05560000
055700*---------------------------------------------------------------* 05570000
055800                                                                  05580000
055900     COPY DPWS016.                                                05590000
056000                                                                  05600000
056100*---------------------------------------------------------------* 05610000
056200*    NUMERIC EDIT LAYOUT.                                       * 05620000
056300*---------------------------------------------------------------* 05630000
056400                                                                  05640000
056500     COPY DPWS010I.                                               05650000
056600 EJECT                                                            05660000
056700*---------------------------------------------------------------* 05670000
056800*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * 05680005
056900*---------------------------------------------------------------* 05690000
057000                                                                  05700000
057100     COPY DPWS030.                                                05710000
057100     COPY DPWS930.                                                05711005
057200 EJECT                                                            05720000
057300*---------------------------------------------------------------* 05730000
057400*    STANDARD COMMAREA.                                         * 05740000
057500*---------------------------------------------------------------* 05750000
057600                                                                  05760000
057700     COPY DPWS020.                                                05770000
057800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                05780000
057900                                                                  05790000
058000*---------------------------------------------------------------* 05800000
058100* INTER-APPLICATION COMMAREA.                                   * 05810000
058200*   VNWS001 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 05820000
058300*             SPEC SCREEN.                                      * 05830000
058400*** VNWS002 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 05840000
058500***           THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 05850000
058600*---------------------------------------------------------------* 05860000
058700                                                                  05870000
058800         10  INTER-APPL-COMM-AREA       PIC X(200).               05880000
058900     COPY VNWS001.                                                05890000
059000     COPY VNWS002.                                                05900000
059100*---------------------------------------------------------------* 05910000
059200*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 05920000
059300*---------------------------------------------------------------* 05930000
059400         10  ASC-SPECIFIC-COMMAREA.                               05940000
059500             15  ASC-LIST-KEYS.                                   05950000
059600                 20  ASC-KEY-ENT-ID           PIC S9(9) COMP.     05960000
059700                 20  ASC-KEY-DEPT-NBR         PIC X(03).          05970000
059800                 20  ASC-KEY-INHOUSE-NBR      PIC 9(03).          05980000
059900                 20  ASC-KEY-ENT-NAME-DESC    PIC X(30).          05990000
060000                 20  ASC-KEY-DUN-NBR          PIC X(09).          06000000
060100             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                06010000
060200                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  06020000
060300                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   06030000
060400                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   06040000
060500                                                                  06050000
060600                 20  ASC-ITEM-ARRAY.                              06060000
060700                     25  ASC-ITEM-ENTRIES OCCURS 11 TIMES.        06070000
060800                         30  ASC-LIST-ITEM-NUMBER                 06080000
060900                                                     PIC S9(09)   06090000
061000                                                     COMP-3.      06100000
061100                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  06110000
061200                             88  ASC-VALID-SELECT    VALUE ' '    06120000
061300                                                           'S'.   06130000
061400                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   06140000
061500                             88  ASC-TEMP-SELECT     VALUE 'S'.   06150000
061600                         30  ASC-SELECTED-SW         PIC  X(01).  06160000
061700                             88  ASC-NO-SELECT       VALUE ' '.   06170000
061800                             88  ASC-SELECT          VALUE 'S'.   06180000
061900                         30  ASC-ENT-ID              PIC S9(09)   06190000
062000                                                          COMP.   06200000
062100                         30  ASC-TRANCODE            PIC  X(02).  06210000
062200                         30  ASC-SEQ-NBR             PIC S9(04)   06220000
062300                                                          COMP.   06230000
062400                         30  ASC-PERCENT             PIC  99V99.  06240000
062500                         30  ASC-PERCENT-UNFMT       PIC  X(05).  06250000
062600                         30  ASC-PERCENT-ORIG-ENTRD  PIC  X(05).  06260000
062700                         30  ASC-PERCENT-ERR-FLAG    PIC  X(01).  06270000
062800                         30  ASC-DESCRIPTION         PIC  X(18).  06280000
062900                         30  ASC-NET-RTV             PIC  X(01).  06290000
063000                         30  ASC-NET-DISC            PIC  X(01).  06300000
063100                         30  ASC-FREQ-IND            PIC  X(02).  06310000
063200                         30  ASC-EFFDTE-MM           PIC  9(02).  06320000
063300                         30  ASC-EFFDTE-DD           PIC  9(02).  06330000
063400                         30  ASC-EFFDTE-CCYY         PIC  9(04).  06340000
063500                         30  ASC-EXPDTE-MM           PIC  9(02).  06350000
063600                         30  ASC-EXPDTE-DD           PIC  9(02).  06360000
063700                         30  ASC-EXPDTE-CCYY         PIC  9(04).  06370000
063800                                                                  06380000
063900                         30  ASC-LINE-CHANGED-SW     PIC  X(01).  06390000
064000                             88  ASC-LINE-UPDATED     VALUE 'A'.  06400000
064100                             88  ASC-LINE-CHANGED     VALUE 'Y'.  06410000
064200                             88  ASC-LINE-NOT-CHANGED VALUE ' '.  06420000
064300                         30  ASC-LINE-PROBLEM-SW     PIC  X(01).  06430000
064400                             88  ASC-LINE-ERROR       VALUE 'E'.  06440000
064500                             88  ASC-LINE-OK          VALUE ' '.  06450000
064600                         30  ASC-PERCENT-CHANGED-SW  PIC  X(01).  06460000
064700                           88  ASC-PERCENT-NOT-CHANGED  VALUE 'N'.06470000
064800                           88  ASC-PERCENT-CHANGED      VALUE 'Y'.06480000
064900                         30  ASC-FREQ-IND-CHANGED-SW PIC  X(01).  06490000
065000                           88  ASC-FREQ-IND-NOT-CHANGED VALUE 'N'.06500000
065100                           88  ASC-FREQ-IND-CHANGED     VALUE 'Y'.06510000
065200                         30  ASC-FREQ-IND-VALID-SW   PIC  X(01).  06520000
065300                           88  ASC-FREQ-IND-NOT-VALID   VALUE 'N'.06530000
065400                           88  ASC-FREQ-IND-VALID       VALUE 'Y'.06540000
065500                         30  ASC-FREQ-EFFDATE-MATCH-SW            06550000
065600                                                     PIC  X(01).  06560000
065700                           88  ASC-FREQ-EFFDATE-NOT-MATCH         06570000
065800                                                        VALUE 'N'.06580000
065900                           88  ASC-FREQ-EFFDATE-MATCH   VALUE 'Y'.06590000
066000                         30  ASC-EFF-MM-CHANGED-SW   PIC  X(01).  06600000
066100                           88  ASC-EFF-MM-NOT-CHANGED   VALUE 'N'.06610000
066200                           88  ASC-EFF-MM-CHANGED       VALUE 'Y'.06620000
066300                         30  ASC-EFF-DD-CHANGED-SW   PIC  X(01).  06630000
066400                           88  ASC-EFF-DD-NOT-CHANGED   VALUE 'N'.06640000
066500                           88  ASC-EFF-DD-CHANGED       VALUE 'Y'.06650000
066600                         30  ASC-EFF-CY-CHANGED-SW   PIC  X(01).  06660000
066700                           88  ASC-EFF-CY-NOT-CHANGED   VALUE 'N'.06670000
066800                           88  ASC-EFF-CY-CHANGED       VALUE 'Y'.06680000
066900                                                                  06690000
067000             15  ASC-BLK-SUB                         PIC S9(04)   06700000
067100                                                          COMP    06710000
067200                                                          SYNC.   06720000
067300             15  ASC-ITEM-SUB                        PIC S9(04)   06730000
067400                                                          COMP    06740000
067500                                                          SYNC.   06750000
067600             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   06760000
067700                                                          COMP-3. 06770000
067800             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   06780000
067900                                                          COMP-3. 06790000
068000             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   06800000
068100                                                          COMP-3. 06810000
068200             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   06820000
068300                                                          COMP-3. 06830000
068400             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   06840000
068500                                                          COMP-3. 06850000
068600             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   06860000
068700                                                          COMP    06870000
068800                                                          SYNC.   06880000
068900             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   06890000
069000                                                          COMP-3. 06900000
069100             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   06910000
069200                                                          COMP-3. 06920000
069300             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  06930000
069400                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   06940000
069500                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   06950000
069600             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  06960000
069700                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   06970000
069800                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   06980000
069900             15  ASC-LIST-QUEUE-NAME.                             06990000
070000                 20  ASC-LIST-TERM-ID                PIC  X(04).  07000000
070100                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   07010000
070200                                                          COMP-3. 07020000
070300                 20  ASC-LIST-SEQ                    PIC  9(01).  07030000
070400             15  ASC-SEL-QUEUE-NAME.                              07040000
070500                 20  ASC-SEL-TERM-ID                 PIC  X(04).  07050000
070600                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   07060000
070700                                                          COMP-3. 07070000
070800                 20  ASC-SEL-SEQ                     PIC  9(01).  07080000
070900                                                                  07090000
071000             15  ASC-START-ITEM-REQUEST.                          07100000
071100                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  07110000
071200             15  ASC-ACTION-SW                       PIC  X(01).  07120000
071300             15  ASC-SAVE-CURSOR-SW                  PIC X(01).   07130000
071400             15  ASC-CURSOR-SW                       PIC X(01).   07140000
071500                 88  ASC-NO-CURSOR                    VALUE 'N'.  07150000
071600                 88  ASC-ACTIVE-CURSOR                VALUE 'A'.  07160000
071700                 88  ASC-EXPIRE-CURSOR                VALUE 'E'.  07170000
071800             15  ASC-TRANCODE-VALID-SW               PIC X(01).   07180000
071900                 88  ASC-TRANCODE-INVALID             VALUE 'N'.  07190000
072000                 88  ASC-TRANCODE-VALID               VALUE 'Y'.  07200000
072100             15  ASC-CHANGES-FOUND-SW                PIC X(01).   07210000
072200                 88  ASC-NO-CHANGES-FOUND             VALUE 'N'.  07220000
072300                 88  ASC-CHANGES-FOUND                VALUE 'Y'.  07230000
072400             15  ASC-OVERLAPPING-DTE-SW              PIC X(01).   07240000
072500                 88  ASC-NO-OVERLAPPING-DATES         VALUE 'N'.  07250000
072600                 88  ASC-OVERLAPPING-DATES            VALUE 'Y'.  07260000
072700             15  ASC-CURR-ACTIVE-AGMT-SW             PIC X(01).   07270000
072800                 88  ASC-NO-CURR-ACTIVE-AGMT          VALUE 'N'.  07280000
072900                 88  ASC-CURR-ACTIVE-AGMT             VALUE 'Y'.  07290000
073000             15  ASC-CURRENT-DATE                    PIC X(10).   07300000
073100             15  ASC-CURR-DATE-1DAY                  PIC X(10).   07310000
073200             15  ASC-CURR-DATE-2DAYS                 PIC X(10).   07320000
073300     EJECT                                                        07330000
073400*---------------------------------------------------------------* 07340000
073500*    ABEND PROCESSING COPYBOOK.                                 * 07350000
073600*---------------------------------------------------------------* 07360000
073700                                                                  07370000
073800     COPY DPWS013.                                                07380000
073900                                                                  07390000
074000 EJECT                                                            07400000
074100*---------------------------------------------------------------* 07410000
074200*    DB2 AREA FOR VENDOR AGREEMENT TABLE                        * 07420000
074300*---------------------------------------------------------------* 07430000
074400     EXEC SQL                                                     07440000
074500          INCLUDE TVNDAGR                                         07450000
074600     END-EXEC.                                                    07460000
074700                                                                  07470000
074800*---------------------------------------------------------------* 07480000
074900*    DB2 AREA FOR TRANSACTION CODE TABLE                        * 07490000
075000*---------------------------------------------------------------* 07500000
075100     EXEC SQL                                                     07510000
075200          INCLUDE TTRNCDE                                         07520000
075300     END-EXEC.                                                    07530000
075400                                                                  07540000
075500*---------------------------------------------------------------* 07550000
075600*    DB2 AREA FOR EXTERNAL ENTERPRISE TABLE                     * 07560000
075700*---------------------------------------------------------------* 07570000
075800     EXEC SQL                                                     07580000
075900          INCLUDE TEXTENT                                         07590000
076000     END-EXEC.                                                    07600000
076100                                                                  07610000
076200*---------------------------------------------------------------* 07620000
076300*    DB2 AREA FOR DATE ATTRIBUTE TABLES                         * 07630000
076400*---------------------------------------------------------------* 07640000
076500     EXEC SQL                                                     07650000
076600          INCLUDE TDTATTR                                         07660000
076700     END-EXEC.                                                    07670000
076800*                                                                 07680000
076900*---------------------------------------------------------------* 07690000
077000*    DB2 AREA FOR SYSDUMMY1 IBM TABLE                           * 07700000
077100*---------------------------------------------------------------* 07710000
077200     EXEC SQL                                                     07720000
077300          INCLUDE SYSDUMMY                                        07730000
077400     END-EXEC.                                                    07740000
077500                                                                  07750000
077600*---------------------------------------------------------------* 07760000
077700*    DB2 AREA FOR COMMUNICATIONS                                * 07770000
077800*---------------------------------------------------------------* 07780000
077900     EXEC SQL                                                     07790000
078000          INCLUDE SQLCA                                           07800000
078100     END-EXEC.                                                    07810000
078200                                                                  07820000
078300*---------------------------------------------------------------* 07830000
078400*    ACTIVE PROGAM CURSOR                                       * 07840000
078500*---------------------------------------------------------------* 07850000
078600                                                                  07860000
078700     EXEC SQL                                                     07870000
078800          DECLARE ACTIVE-PROGRAM-CSR CURSOR FOR                   07880000
078900          SELECT A.AP_TRN_CDE                                     07890000
079000                ,A.DISCOUNT_PCT                                   07900000
079100                ,A.EFFECTIVE_DATE                                 07910000
079200                ,A.EXPIRATION_DATE                                07920000
079300                ,A.SEQ_NBR                                        07930000
079400                ,A.PSTG_FRQ_CDE                                   07940000
079500                ,A.DED_DISC_IND                                   07950000
079600                ,A.DED_RTV_IND                                    07960000
079700                ,B.TRN_SHRT_DESC                                  07970000
079800            FROM TVNDAGR A                                        07980000
079900                ,TTRNCDE B                                        07990000
080000           WHERE A.AP_TRN_CDE     = B.AP_TRN_CDE                  08000000
080100             AND A.AGRMT_TYP_ID   = '6'                           08010000
080200             AND A.TYP_CDE        = 6                             08020000
080300             AND (CURRENT DATE BETWEEN A.EFFECTIVE_DATE AND       08030000
080400                                       A.EXPIRATION_DATE          08040000
080500                  OR A.EFFECTIVE_DATE > CURRENT DATE)             08050000
080600             AND B.EFF_STRT_DTE =                                 08060000
080700                 (SELECT MIN(T.EFF_STRT_DTE)                      08070000
080800                    FROM TTRNCDE T                                08080000
080900                   WHERE T.AP_TRN_CDE  = B.AP_TRN_CDE             08090000
081000                     AND (A.EFFECTIVE_DATE  BETWEEN T.EFF_STRT_DTE08100000
081100                                                AND T.EFF_END_DTE 08110000
081200                      OR  (A.EFFECTIVE_DATE < T.EFF_STRT_DTE AND  08120000
081300                           A.EFFECTIVE_DATE < T.EFF_END_DTE)))    08130000
081400             AND A.ENT_ID         = :DK-ENT-ID                    08140000
081500             AND A.DEPT_NBR       = :DK-DEPT-NBR                  08150000
081600           ORDER BY A.AP_TRN_CDE                                  08160000
081700                   ,A.EFFECTIVE_DATE                              08170000
081800     END-EXEC.                                                    08180000
081900                                                                  08190000
082000*---------------------------------------------------------------* 08200000
082100*    EXPIRED PROGRAM CURSOR                                     * 08210000
082200*---------------------------------------------------------------* 08220000
082300                                                                  08230000
082400     EXEC SQL                                                     08240000
082500          DECLARE EXPIRE-PROGRAM-CSR CURSOR FOR                   08250000
082600          SELECT A.AP_TRN_CDE                                     08260000
082700                ,A.DISCOUNT_PCT                                   08270000
082800                ,A.EFFECTIVE_DATE                                 08280000
082900                ,A.EXPIRATION_DATE                                08290000
083000                ,A.SEQ_NBR                                        08300000
083100                ,A.PSTG_FRQ_CDE                                   08310000
083200                ,A.DED_DISC_IND                                   08320000
083300                ,A.DED_RTV_IND                                    08330000
083400                ,B.TRN_SHRT_DESC                                  08340000
083500            FROM TVNDAGR A                                        08350000
083600                ,TTRNCDE B                                        08360000
083700           WHERE A.AP_TRN_CDE      = B.AP_TRN_CDE                 08370000
083800             AND A.AGRMT_TYP_ID    = '6'                          08380000
083900             AND A.TYP_CDE         = 6                            08390000
084000             AND B.EFF_STRT_DTE =                                 08400000
084100                 (SELECT MIN(T.EFF_STRT_DTE)                      08410000
084200                    FROM TTRNCDE T                                08420000
084300                   WHERE T.AP_TRN_CDE  = B.AP_TRN_CDE             08430000
084400                     AND (A.EFFECTIVE_DATE  BETWEEN T.EFF_STRT_DTE08440000
084500                                                 AND T.EFF_END_DTE08450000
084600                    AND (A.EXPIRATION_DATE  BETWEEN T.EFF_STRT_DTE08460000
084700                                                AND T.EFF_END_DTE)08470000
084800                       OR  (A.EFFECTIVE_DATE < T.EFF_STRT_DTE AND 08480000
084900                            A.EFFECTIVE_DATE < T.EFF_END_DTE)))   08490000
085000             AND A.ENT_ID          = :DK-ENT-ID                   08500000
085100             AND A.DEPT_NBR        = :DK-DEPT-NBR                 08510000
085200           ORDER BY A.AP_TRN_CDE ASC                              08520000
085300                   ,A.EXPIRATION_DATE DESC                        08530000
085400                   ,A.EFFECTIVE_DATE ASC                          08540000
085500     END-EXEC.                                                    08550000
085600                                                                  08560000
085700 EJECT                                                            08570000
085800 LINKAGE SECTION.                                                 08580000
085900                                                                  08590000
086000 01  DFHCOMMAREA.                                                 08600000
086100     05  FILLER                         OCCURS  1 TO 4072 TIMES   08610000
086200                                        DEPENDING ON EIBCALEN.    08620000
086300         10  FILLER                     PIC X.                    08630000
086400                                                                  08640000
086500 EJECT                                                            08650000
086600 PROCEDURE DIVISION.                                              08660000
086700******************************************************************08670000
086800**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **08680000
086900**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **08690000
087000**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **08700000
087100******************************************************************08710000
087200 0000-MAIN-MODULE.                                                08720000
087300     INITIALIZE DP030-CICS-API-FIELDS.                            08730000
087400     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       08740000
087500     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          08750000
087600     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         08760000
087700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       08770000
087800     MOVE LENGTH OF VN027AI        TO DP030-MAP-LENGTH (1).       08780000
087900     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     08790000
088000     PERFORM 0001-CALL-CICS-ARCH-API.                             08800000
088100*                                                                 08810000
088200     PERFORM 1000-CONTROL-PROCESSING                              08820000
088300*                                                                 08830000
088400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     08840000
088500     PERFORM 0001-CALL-CICS-ARCH-API.                             08850000
088600                                                                  08860000
088700******************************************************************08870000
088800**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **08880000
088900**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **08890000
089000******************************************************************08900000
089100 0001-CALL-CICS-ARCH-API.                                         08910000
089200*    CALL 'DPKCS030' USING DFHEIBLK                               08920005
089200     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      08921005
089300                           DFHCOMMAREA                            08930000
089400                           DP030-CICS-API-FIELDS                  08940000
089500                           DP020-STANDARD-COMMAREA                08950000
089600                           VN027AI.                               08960000
089700*                                                                 08970000
089800     IF  DP030-RC-CALL-SUCCESSFUL                                 08980000
089900         CONTINUE                                                 08990000
090000     ELSE                                                         09000000
090100         SET DP013-NO-ROLLBACK                                    09010000
090200             DP013-XCTL-DISPLAY-RESTART                           09020000
090300             DP013-CICS-ABEND      TO TRUE                        09030000
090400         MOVE '0001-CALL-CICS-ARCH-API'                           09040000
090500                                   TO DP013-PARAGRAPH             09050000
090600*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX09060005
090700*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      09070005
090600         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O09071005
090700-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      09072005
090800         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      09080000
090900         PERFORM DP013-0000-PROCESS-ABEND                         09090000
091000     END-IF.                                                      09100000
091100*----------------------------------------------------------------*09110000
091200* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *09120000
091300* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *09130000
091400*                                                                *09140000
091500* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *09150000
091600*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *09160000
091700*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *09170000
091800*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *09180000
091900*----------------------------------------------------------------*09190000
092000                                                                  09200000
092100 1000-CONTROL-PROCESSING.                                         09210000
092200                                                                  09220000
092300     EVALUATE TRUE                                                09230000
092400         WHEN DP020-NEXT-ACT-INITIAL                              09240000
092500             INITIALIZE ASC-SPECIFIC-COMMAREA                     09250000
092600             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            09260000
092700                                      ASC-SEL-TERM-ID             09270000
092800             MOVE DP020-SRC-TASK-NUMBER                           09280000
092900                                   TO ASC-LIST-TASK-NUMBER        09290000
093000                                      ASC-SEL-TASK-NUMBER         09300000
093100             MOVE PC-LIST-QUEUE-SEQ                               09310000
093200                                   TO ASC-LIST-SEQ                09320000
093300             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 09330000
093400             PERFORM 1100-PROCESS-INTER-APPL-COMM                 09340000
093500***-----$TEMPLATE NOTE$-------------------------------------------09350000
093600*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,09360000
093700*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  09370000
093800*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.09380000
093900***---------------------------------------------------------------09390000
094000             IF  PS-COMMAREA-NOT-VALID                            09400000
094100                 SET DP020-NEXT-ACT-APPL-ERROR                    09410000
094200                                   TO TRUE                        09420000
094300             ELSE                                                 09430000
094400                 PERFORM 4000-BUILD-INITIAL-PANEL                 09440000
094500             END-IF                                               09450000
094600                                                                  09460000
094700         WHEN DP020-NEXT-ACT-READ-MAP                             09470000
094800             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        09480000
094900                                   TO PV-TOP-ITEM                 09490000
095000             PERFORM 2000-PROCESS-PANEL                           09500000
095100                                                                  09510000
095200         WHEN DP020-NEXT-ACT-RETURN                               09520000
095300             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        09530000
095400                                   TO PV-TOP-ITEM                 09540000
095500             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    09550000
095600             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 09560000
095700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09570000
095800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   09580000
095900                                                                  09590000
096000         WHEN OTHER                                               09600000
096100             SET DP013-LOGIC-ABEND TO TRUE                        09610000
096200             SET DP013-NO-ROLLBACK TO TRUE                        09620000
096300             MOVE '1000-CONTROL-PROCESSING'                       09630000
096400                                   TO DP013-PARAGRAPH             09640000
096500             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    09650000
096600                                   TO DP013-MESSAGE-TEXT(1)       09660000
096700             PERFORM DP013-0000-PROCESS-ABEND                     09670000
096800     END-EVALUATE.                                                09680000
096900                                                                  09690000
097000 EJECT                                                            09700000
097100*----------------------------------------------------------------*09710000
097200* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *09720000
097300* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *09730000
097400*----------------------------------------------------------------*09740000
097500                                                                  09750000
097600 1100-PROCESS-INTER-APPL-COMM.                                    09760000
097700                                                                  09770000
097800     EXEC SQL                                                     09780000
097900         SET :ASC-CURRENT-DATE    = CURRENT DATE                  09790000
098000     END-EXEC.                                                    09800000
098100                                                                  09810000
098200     EXEC SQL                                                     09820000
098300         SET :ASC-CURR-DATE-1DAY  = (CURRENT DATE - 1 DAY)        09830000
098400     END-EXEC.                                                    09840000
098500                                                                  09850000
098600     EXEC SQL                                                     09860000
098700         SET :ASC-CURR-DATE-2DAYS = (CURRENT DATE - 2 DAY)        09870000
098800     END-EXEC.                                                    09880000
098900                                                                  09890000
099000     SET PS-COMMAREA-VALID         TO TRUE.                       09900000
099100     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     09910000
099200     MOVE VN001-DEPARTMENT-NUMBER TO DK-DEPT-NBR                  09920000
099300                                     ASC-KEY-DEPT-NBR.            09930000
099400     MOVE VN001-VENDOR-NAME       TO DK-VEND-NAME                 09940000
099500                                     ASC-KEY-ENT-NAME-DESC.       09950000
099600     MOVE VN001-DUNS-NUMBER       TO DK-DUNS-NUMBER               09960000
099700                                     ASC-KEY-DUN-NBR.             09970000
099800     MOVE VN001-INHOUSE-NUMBER    TO PV-INHOUSE-NBR-X.            09980000
099900     MOVE PV-INHOUSE-NBR          TO DK-INHOUSE-NUMBER            09990000
100000                                     ASC-KEY-INHOUSE-NBR.         10000000
100100     SET ASC-ACTIVE-CURSOR        TO TRUE.                        10010000
100200     MOVE ASC-CURSOR-SW           TO ASC-SAVE-CURSOR-SW.          10020000
100300     PERFORM 1150-SELECT-ENT-ID.                                  10030000
100400                                                                  10040000
100500 EJECT                                                            10050000
100600 1150-SELECT-ENT-ID.                                              10060000
100700                                                                  10070000
100800     PERFORM                                                      10080000
100900         WITH TEST AFTER                                          10090000
101000         VARYING PV-RETRY-COUNTER                                 10100000
101100         FROM 1 BY 1                                              10110000
101200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10120000
101300             OR (SQLCODE = +0)                                    10130000
101400             OR (SQLCODE = +100))                                 10140000
101500                                                                  10150000
101600         EXEC SQL                                                 10160000
101700              SELECT A.ENT_ID                                     10170000
101800                INTO :EXTENT-ENT-ID                               10180000
101900                FROM TEXTENT A                                    10190000
102000               WHERE A.DUN_NBR       = :DK-DUNS-NUMBER            10200000
102100                 AND A.STATUS_CDE    = 'A'                        10210000
102200         END-EXEC                                                 10220000
102300                                                                  10230000
102400         EVALUATE TRUE                                            10240000
102500             WHEN SQLCODE = +0                                    10250000
102600                  MOVE EXTENT-ENT-ID TO ASC-KEY-ENT-ID            10260000
102700                                        DK-ENT-ID                 10270000
102800                                                                  10280000
102900             WHEN SQLCODE = +100                                  10290000
103000                  SET PS-ERROR                                    10300000
103100                      DP020-MSG-FATAL                             10310000
103200                      DP020-NEXT-ACT-APPL-ERROR                   10320000
103300                                     TO TRUE                      10330000
103400                  MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER        10340000
103500                                                                  10350000
103600             WHEN SQLCODE = -904                                  10360000
103700             WHEN SQLCODE = -913                                  10370000
103800                  CONTINUE                                        10380000
103900                                                                  10390000
104000             WHEN SQLWARN0 NOT = SPACES                           10400000
104100             WHEN SQLCODE < +0                                    10410000
104200             WHEN SQLCODE > +0                                    10420000
104300                  MOVE '1150-SELECT-ENT-ID'                       10430000
104400                                  TO DP013-PARAGRAPH              10440000
104500                  MOVE 'UNSUCCESSFUL SELECT ENTERPRIS ID'         10450000
104600                                  TO DP013-MESSAGE-TEXT (1)       10460000
104700                  MOVE SQLCA      TO DP013-SQLCA                  10470000
104800                  MOVE 'TEXTENT ' TO DP013-DB2-TABLE-NAME (1)     10480000
104900                  SET DP013-DB2-ABEND                             10490000
105000                      DP013-XCTL-DISPLAY-RESTART                  10500000
105100                                  TO TRUE                         10510000
105200                  PERFORM DP013-0000-PROCESS-ABEND                10520000
105300         END-EVALUATE                                             10530000
105400     END-PERFORM.                                                 10540000
105500                                                                  10550000
105600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10560000
105700         MOVE '1150-SELECT-ENT-ID'                                10570000
105800                                  TO DP013-PARAGRAPH              10580000
105900         MOVE 'MAX RETRIES EXCEEDED ON SELECT ENTERPRISE ID'      10590000
106000                                  TO DP013-MESSAGE-TEXT (1)       10600000
106100         MOVE SQLCA               TO DP013-SQLCA                  10610000
106200         MOVE 'TEXTENT '          TO DP013-DB2-TABLE-NAME (1)     10620000
106300         SET DP013-DB2-ABEND                                      10630000
106400             DP013-XCTL-DISPLAY-RESTART                           10640000
106500                                  TO TRUE                         10650000
106600         PERFORM DP013-0000-PROCESS-ABEND                         10660000
106700     END-IF.                                                      10670000
106800                                                                  10680000
106900 EJECT                                                            10690000
107000*----------------------------------------------------------------*10700000
107100* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *10710000
107200* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *10720000
107300* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *10730000
107400* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *10740000
107500* FUNCTION KEYS CAN GET THIS FAR.                                *10750000
107600*----------------------------------------------------------------*10760000
107700                                                                  10770000
107800 2000-PROCESS-PANEL.                                              10780000
107900     EVALUATE TRUE                                                10790000
108000         WHEN DP020-SRC-AID = DP016-CLEAR                         10800000
108100             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    10810000
108200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10820000
108300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10830000
108400                                                                  10840000
108500         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    10850000
108600             MOVE ASC-SAVE-CURSOR-SW    TO ASC-CURSOR-SW          10860000
108700             MOVE ASC-KEY-ENT-ID        TO DK-ENT-ID              10870000
108800             MOVE ASC-KEY-DEPT-NBR      TO DK-DEPT-NBR            10880000
108900             MOVE ASC-KEY-INHOUSE-NBR   TO DK-INHOUSE-NUMBER      10890000
109000             MOVE ASC-KEY-ENT-NAME-DESC TO DK-VEND-NAME           10900000
109100             MOVE ASC-KEY-DUN-NBR       TO DK-DUNS-NUMBER         10910000
109200             PERFORM 2050-DELETE-LIST-QUEUE                       10920000
109300             PERFORM 4000-BUILD-INITIAL-PANEL                     10930000
109400                                                                  10940000
109500         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               10950000
109600* THIS IS PF24 AND EXECUTES THE EXPIRED CURSOR                    10960000
109700             PERFORM 2050-DELETE-LIST-QUEUE                       10970000
109800             SET ASC-EXPIRE-CURSOR TO TRUE                        10980000
109900             MOVE ASC-CURSOR-SW         TO ASC-SAVE-CURSOR-SW     10990000
110000             MOVE ASC-KEY-ENT-ID        TO DK-ENT-ID              11000000
110100             MOVE ASC-KEY-DEPT-NBR      TO DK-DEPT-NBR            11010000
110200             MOVE ASC-KEY-INHOUSE-NBR   TO DK-INHOUSE-NUMBER      11020000
110300             MOVE ASC-KEY-ENT-NAME-DESC TO DK-VEND-NAME           11030000
110400             MOVE ASC-KEY-DUN-NBR       TO DK-DUNS-NUMBER         11040000
110500             PERFORM 4000-BUILD-INITIAL-PANEL                     11050000
110600                                                                  11060000
110700         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    11070000
110800             PERFORM 2140-DESELECT-ALL-ITEMS                      11080000
110900             PERFORM 3200-RESET-ATTRIBUTES                        11090000
111000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11100000
111100                                                                  11110000
111200         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  11120000
111300             PERFORM 2150-SELECT-ALL-ITEMS                        11130000
111400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11140000
111500                                                                  11150000
111600         WHEN OTHER                                               11160000
111700             IF DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)             11170000
111800                MOVE 'A' TO ASC-ACTION-SW                         11180000
111900                MOVE +11 TO ASC-ITEMS-DISPLAYED                   11190000
112000             ELSE                                                 11200000
112100                IF DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)          11210000
112200                   MOVE 'U' TO ASC-ACTION-SW                      11220000
112300                ELSE                                              11230000
112400                   MOVE ' ' TO ASC-ACTION-SW                      11240000
112500                END-IF                                            11250000
112600             END-IF                                               11260000
112700             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 11270000
112800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   11280000
112900             IF  PS-NO-ERROR                                      11290000
113000                 SET DP030-CONTINUE-GO                            11300000
113100                                 TO TRUE                          11310000
113200                 PERFORM 2100-CHECK-FUNCTION-KEY                  11320000
113300             ELSE                                                 11330000
113400                 SET DP030-OVERRIDE-GO                            11340000
113500                                 TO TRUE                          11350000
113600**               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             11360000
113700             END-IF                                               11370000
113800     END-EVALUATE.                                                11380000
113900 EJECT                                                            11390000
114000*----------------------------------------------------------------*11400000
114100*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *11410000
114200*----------------------------------------------------------------*11420000
114300 2050-DELETE-LIST-QUEUE.                                          11430000
114400                                                                  11440000
114500     EXEC CICS                                                    11450000
114600         DELETEQ TS                                               11460000
114700             QUEUE (ASC-LIST-QUEUE-NAME)                          11470000
114800             RESP  (PV-CICS-RESP)                                 11480000
114900     END-EXEC.                                                    11490000
115000                                                                  11500000
115100     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       11510000
115200        (PV-CICS-RESP = DFHRESP(QIDERR))                          11520000
115300         CONTINUE                                                 11530000
115400     ELSE                                                         11540000
115500         SET DP013-CICS-ABEND      TO TRUE                        11550000
115600         SET DP013-NO-ROLLBACK     TO TRUE                        11560000
115700                                                                  11570000
115800         MOVE '2050-DELETE-LIST-QUEUE'                            11580000
115900                                   TO DP013-PARAGRAPH             11590000
116000         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    11600000
116100                                   TO DP013-MESSAGE-TEXT (1)      11610000
116200         PERFORM DP013-0000-PROCESS-ABEND                         11620000
116300     END-IF.                                                      11630000
116400                                                                  11640000
116500     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  11650000
116600 EJECT                                                            11660000
116700*----------------------------------------------------------------*11670000
116800* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*11680000
116900* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *11690000
117000* CICS ARCHITECTURE API.                                         *11700000
117100*----------------------------------------------------------------*11710000
117200 2100-CHECK-FUNCTION-KEY.                                         11720000
117300     EVALUATE TRUE                                                11730000
117400         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               11740000
117500* THIS IS FOR PF13(ADD)                                           11750000
117600              IF PS-NO-ERROR                                      11760000
117700                  PERFORM 2105-WRITE-TSQ                          11770000
117800                  IF PS-NO-ERROR                                  11780000
117900                     PERFORM 4100-TRAVERSE-TSQ-INSERT             11790000
118000                     IF PS-ERROR                                  11800000
118100                        SET DP030-OVERRIDE-GO                     11810000
118200                                       TO TRUE                    11820000
118300*                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN      11830000
118400                     ELSE                                         11840000
118500                        MOVE ASC-SAVE-CURSOR-SW  TO ASC-CURSOR-SW 11850000
118600                        MOVE ASC-KEY-ENT-ID      TO DK-ENT-ID     11860000
118700                        MOVE ASC-KEY-DEPT-NBR    TO DK-DEPT-NBR   11870000
118800                        MOVE ASC-KEY-INHOUSE-NBR TO               11880000
118900                                                 DK-INHOUSE-NUMBER11890000
119000                        MOVE ASC-KEY-ENT-NAME-DESC TO DK-VEND-NAME11900000
119100                        MOVE ASC-KEY-DUN-NBR     TO DK-DUNS-NUMBER11910000
119200                        PERFORM 2050-DELETE-LIST-QUEUE            11920000
119300                        PERFORM 4000-BUILD-INITIAL-PANEL          11930000
119400                        SET DP030-CONTINUE-GO TO TRUE             11940000
119500                        MOVE PC-TSYMSG-00034 TO DP020-MSG-NUMBER  11950000
119600                        SET DP020-MSG-INFORMATIONAL TO TRUE       11960000
119700                        SET DP030-ERASE-UNPROT TO TRUE            11970000
119800                     END-IF                                       11980000
119900                  END-IF                                          11990000
120000              END-IF                                              12000000
120100                                                                  12010000
120200         WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)               12020000
120300* THIS IS FOR PF15(UPDATE)                                        12030000
120400              IF PS-NO-ERROR                                      12040000
120500                  PERFORM 2105-WRITE-TSQ                          12050000
120600                  IF PS-NO-ERROR                                  12060000
120700                     PERFORM 4110-TRAVERSE-TSQ-UPDATE             12070000
120800                     IF PS-ERROR                                  12080000
120900                        SET DP030-OVERRIDE-GO                     12090000
121000                                       TO TRUE                    12100000
121100*                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN      12110000
121200                     ELSE                                         12120000
121300                        MOVE ASC-SAVE-CURSOR-SW  TO ASC-CURSOR-SW 12130000
121400                        MOVE ASC-KEY-ENT-ID      TO DK-ENT-ID     12140000
121500                        MOVE ASC-KEY-DEPT-NBR    TO DK-DEPT-NBR   12150000
121600                        MOVE ASC-KEY-INHOUSE-NBR TO               12160000
121700                                                 DK-INHOUSE-NUMBER12170000
121800                        MOVE ASC-KEY-ENT-NAME-DESC TO DK-VEND-NAME12180000
121900                        MOVE ASC-KEY-DUN-NBR     TO DK-DUNS-NUMBER12190000
122000                        PERFORM 2050-DELETE-LIST-QUEUE            12200000
122100                        PERFORM 4000-BUILD-INITIAL-PANEL          12210000
122200                        SET DP030-CONTINUE-GO TO TRUE             12220000
122300                        MOVE PC-TSYMSG-00059 TO DP020-MSG-NUMBER  12230000
122400                        SET DP020-MSG-INFORMATIONAL TO TRUE       12240000
122500                     END-IF                                       12250000
122600                  END-IF                                          12260000
122700              END-IF                                              12270000
122800                                                                  12280000
122900         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  12290000
123000             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              12300000
123100                 INITIALIZE VN002-INTER-APPL-COMMAREA             12310000
123200                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                12320000
123300                                TO VN002-NUMBER-OF-SELECTED-ITEMS 12330000
123400                 PERFORM 5000-PREPARE-SEL-QUEUE                   12340000
123500             ELSE                                                 12350000
123600                 SET DP030-OVERRIDE-GO                            12360000
123700                                   TO TRUE                        12370000
123800                 MOVE PC-TSYMSG-00057                             12380000
123900                                   TO DP020-MSG-NUMBER            12390000
124000                 SET DP020-MSG-WARNING                            12400000
124100                                   TO TRUE                        12410000
124200             END-IF                                               12420000
124300                                                                  12430000
124400         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  12440000
124500             MOVE +1               TO PV-TOP-ITEM                 12450000
124600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12460000
124700                                                                  12470000
124800         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   12480000
124900             PERFORM 2110-BROWSE-BACKWARD                         12490000
125000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12500000
125100                                                                  12510000
125200         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   12520000
125300             PERFORM 2120-BROWSE-FORWARD                          12530000
125400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12540000
125500                                                                  12550000
125600         WHEN DP020-SRC-AID = DP016-ENTER                         12560000
125700             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   12570000
125800             IF  PS-ERROR                                         12580000
125900                 CONTINUE                                         12590000
126000             ELSE                                                 12600000
126100                 PERFORM 2105-WRITE-TSQ                           12610000
126200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             12620000
126300             END-IF                                               12630000
126400                                                                  12640000
126500         WHEN OTHER                                               12650000
126600             SET DP013-NO-ROLLBACK                                12660000
126700                 DP013-XCTL-DISPLAY-RESTART                       12670000
126800                 DP013-CICS-ABEND  TO TRUE                        12680000
126900             MOVE '2100-CHECK-FUNCTION-KEY'                       12690000
127000                                   TO DP013-PARAGRAPH             12700000
127100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      12710000
127200                                   TO DP013-MESSAGE-TEXT (1)      12720000
127300             PERFORM DP013-0000-PROCESS-ABEND                     12730000
127400     END-EVALUATE.                                                12740000
127500                                                                  12750000
127600     IF PS-NO-ERROR                                               12760000
127700        PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                      12770000
127800     END-IF.                                                      12780000
127900                                                                  12790000
128000*                                                                 12800000
128100*    PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12810000
128200*                                                                 12820000
128300******************************************************************12830000
128400*    THIS PARAGRAPH WILL WRITE NEWLY ENTERED LINES OF            *12840000
128500*    DISTRIBUTION TO THE TEMPORARY STORAGE QUEUE.                *12850000
128600******************************************************************12860000
128700 2105-WRITE-TSQ.                                                  12870000
128800                                                                  12880000
128900     MOVE +1                    TO ASC-BLK-SUB.                   12890000
129000                                                                  12900000
129100     PERFORM 5100-WRITE-TEMP-STORAGE.                             12910000
129200                                                                  12920000
129300     ADD +1                     TO ASC-BLK-SUB.                   12930000
129400                                                                  12940000
129500     PERFORM 5100-WRITE-TEMP-STORAGE.                             12950000
129600                                                                  12960000
129700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               12970000
129800                                TO PV-LIST-ITEM-NUMBER.           12980000
129900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            12990000
130000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    13000000
130100                                                                  13010000
130200     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     13020000
130300        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    13030000
130400         MOVE +1                   TO PV-BLOCK-NUMBER             13040000
130500                                                                  13050000
130600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13060000
130700             PV-FIRST-BLOCK-IN-ARRAY - 1                          13070000
130800                                                                  13080000
130900         PERFORM                                                  13090000
131000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       13100000
131100                                                                  13110000
131200             PERFORM 4410-READ-TEMP-STORAGE                       13120000
131300             PERFORM 5100-WRITE-TEMP-STORAGE                      13130000
131400                                                                  13140000
131500             ADD +1                TO PV-BLOCK-NUMBER             13150000
131600                                                                  13160000
131700         END-PERFORM                                              13170000
131800                                                                  13180000
131900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13190000
132000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13200000
132100         PERFORM                                                  13210000
132200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13220000
132300                   ASC-HIGHEST-BLOCK-WRITTEN                      13230000
132400                                                                  13240000
132500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          13250000
132600                                   TO PV-BLOCK-NUMBER             13260000
132700                                                                  13270000
132800             PERFORM 4410-READ-TEMP-STORAGE                       13280000
132900                                                                  13290000
133000             PERFORM 5100-WRITE-TEMP-STORAGE                      13300000
133100                                                                  13310000
133200             ADD +1            TO PV-NEXT-BLOCK-IN-ARRAY          13320000
133300                                                                  13330000
133400         END-PERFORM                                              13340000
133500                                                                  13350000
133600         MOVE +1                   TO ASC-BLK-SUB                 13360000
133700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             13370000
133800                                   TO PV-BLOCK-NUMBER             13380000
133900                                                                  13390000
134000         PERFORM 4410-READ-TEMP-STORAGE                           13400000
134100                                                                  13410000
134200         ADD +1                    TO PV-BLOCK-NUMBER             13420000
134300                                      ASC-BLK-SUB                 13430000
134400         PERFORM 4410-READ-TEMP-STORAGE                           13440000
134500     END-IF.                                                      13450000
134600                                                                  13460000
134700*----------------------------------------------------------------*13470000
134800*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *13480000
134900*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *13490000
135000*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *13500000
135100*    MESSAGE.                                                    *13510000
135200*----------------------------------------------------------------*13520000
135300                                                                  13530000
135400 2110-BROWSE-BACKWARD.                                            13540000
135500     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    13550000
135600         GIVING PV-TOP-ITEM.                                      13560000
135700*                                                                 13570000
135800     IF  ((PV-TOP-ITEM < +1)                                      13580000
135900       OR (PV-TOP-ITEM = +1))                                     13590000
136000         MOVE +1                   TO PV-TOP-ITEM                 13600000
136100*        -- TOP OF LIST --                                        13610000
136200         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            13620000
136300         SET DP020-MSG-INFORMATIONAL TO TRUE                      13630000
136400     END-IF.                                                      13640000
136500                                                                  13650000
136600 EJECT                                                            13660000
136700*----------------------------------------------------------------*13670000
136800*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *13680000
136900*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *13690000
137000*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *13700000
137100*----------------------------------------------------------------*13710000
137200                                                                  13720000
137300 2120-BROWSE-FORWARD.                                             13730000
137400                                                                  13740000
137500     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              13750000
137600         GIVING PV-TOP-ITEM.                                      13760000
137700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   13770000
137800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            13780000
137900                                   TO PV-TOP-ITEM                 13790000
138000*        -- BOTTOM OF LIST --                                     13800000
138100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            13810000
138200         SET DP020-MSG-INFORMATIONAL                              13820000
138300                                   TO TRUE                        13830000
138400     ELSE                                                         13840000
138500         COMPUTE PV-BOTTOM-ITEM =                                 13850000
138600             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 13860000
138700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            13870000
138800*            -- BOTTOM OF LIST --                                 13880000
138900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            13890000
139000             SET DP020-MSG-INFORMATIONAL                          13900000
139100                                   TO TRUE                        13910000
139200         END-IF                                                   13920000
139300     END-IF.                                                      13930000
139400 EJECT                                                            13940000
139500*----------------------------------------------------------------*13950000
139600*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *13960000
139700*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *13970000
139800*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *13980000
139900*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *13990000
140000*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *14000000
140100*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *14010000
140200*----------------------------------------------------------------*14020000
140300                                                                  14030000
140400 2130-CHECK-FOR-JUMP-BROWSE.                                      14040000
140500     SET PS-NO-ERROR               TO TRUE.                       14050000
140600     IF (ASC-START-ITEM-REQUEST = SPACE)                          14060000
140700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            14070000
140800                                   TO PV-TOP-ITEM                 14080000
140900     ELSE                                                         14090000
141000         MOVE ASC-START-ITEM-REQUEST                              14100000
141100                                   TO DP010I-UNEDITED-FIELD       14110000
141200         MOVE +5                   TO DP010I-MAXIMUM-DIGITS       14120000
141300         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     14130000
141400         SET DP010I-NEGATIVE-NOT-ALLOWED                          14140000
141500                                   TO TRUE                        14150000
141610         CALL DP010I-NUMERIC-EDIT-ROUTINE                         14161002
141620                         USING DP010I-NUMERIC-EDIT-AREA           14162002
141630                                                                  14163002
141700                                                                  14170000
141800         IF  NOT DP010I-ERROR-DETECTED                            14180000
141900             MOVE DP010I-NUMERIC-FIELD                            14190000
142000                                   TO  ASC-START-ITEM-REQUEST-N   14200000
142100             IF  ASC-START-ITEM-REQUEST-N > ZERO                  14210000
142200                 IF  ASC-START-ITEM-REQUEST-N >                   14220000
142300                                          ASC-NUMBER-OF-ITEMS-READ14230000
142400                     MOVE SPACE TO ASC-START-ITEM-REQUEST         14240000
142500                     COMPUTE PV-TOP-ITEM =                        14250000
142600                             ASC-NUMBER-OF-ITEMS-READ             14260000
142700                             - PC-ITEMS-PER-PANEL + 1             14270000
142800                     IF  PV-TOP-ITEM < +1                         14280000
142900                         MOVE +1   TO PV-TOP-ITEM                 14290000
143000                         MOVE PC-TSYMSG-00070                     14300000
143100                                   TO DP020-MSG-NUMBER            14310000
143200                         SET DP020-MSG-INFORMATIONAL              14320000
143300                                   TO TRUE                        14330000
143400                     END-IF                                       14340000
143500                 ELSE                                             14350000
143600                     MOVE ASC-START-ITEM-REQUEST-N                14360000
143700                                   TO PV-TOP-ITEM                 14370000
143800                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      14380000
143900                     COMPUTE PV-BOTTOM-ITEM =                     14390000
144000                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     14400000
144100                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ14410000
144200*                        -- BOTTOM OF LIST --                     14420000
144300                         MOVE PC-TSYMSG-00070                     14430000
144400                                   TO DP020-MSG-NUMBER            14440000
144500                         SET DP020-MSG-INFORMATIONAL              14450000
144600                                   TO TRUE                        14460000
144700                     END-IF                                       14470000
144800                 END-IF                                           14480000
144900             ELSE                                                 14490000
145000*                --- VALUE OUT OF RANGE ----                      14500000
145100                 MOVE PC-TSYMSG-00101                             14510000
145200                                   TO DP020-MSG-NUMBER            14520000
145300                 MOVE -1           TO ASTRTITL                    14530000
145400                 SET DP030-SET-CURSOR-APPL-1                      14540000
145500                                   TO TRUE                        14550000
145600                 MOVE DP015-REVERSE                               14560000
145700                                   TO ASTRTITH                    14570000
145800                 MOVE DP015-RED    TO ASTRTITC                    14580000
145900                 MOVE DP015-UNP-NUM-BRT-MDT                       14590000
146000                                   TO ASTRTITA                    14600000
146100                 SET DP020-MSG-FATAL                              14610000
146200                                   TO TRUE                        14620000
146300                 SET PS-ERROR      TO TRUE                        14630000
146400             END-IF                                               14640000
146500                                                                  14650000
146600         ELSE                                                     14660000
146700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            14670000
146800             MOVE -1               TO ASTRTITL                    14680000
146900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  14690000
147000             MOVE DP015-REVERSE    TO ASTRTITH                    14700000
147100             MOVE DP015-RED        TO ASTRTITC                    14710000
147200             MOVE DP015-UNP-NUM-BRT-MDT                           14720000
147300                                   TO ASTRTITA                    14730000
147400             SET DP020-MSG-FATAL   TO TRUE                        14740000
147500             SET PS-ERROR          TO TRUE                        14750000
147600         END-IF                                                   14760000
147700     END-IF.                                                      14770000
147800 EJECT                                                            14780000
147900*----------------------------------------------------------------*14790000
148000*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *14800000
148100*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *14810000
148200*----------------------------------------------------------------*14820000
148300 2140-DESELECT-ALL-ITEMS.                                         14830000
148400     MOVE +1                       TO ASC-BLK-SUB.                14840000
148500                                                                  14850000
148600     PERFORM 2141-CLEAR-SELECTED-INDS                             14860000
148700         VARYING ASC-ITEM-SUB                                     14870000
148800         FROM 1 BY 1                                              14880000
148900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14890000
149000                                                                  14900000
149100     ADD +1                        TO ASC-BLK-SUB.                14910000
149200                                                                  14920000
149300     PERFORM 2141-CLEAR-SELECTED-INDS                             14930000
149400         VARYING ASC-ITEM-SUB                                     14940000
149500         FROM 1 BY 1                                              14950000
149600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14960000
149700                                                                  14970000
149800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               14980000
149900                                   TO PV-LIST-ITEM-NUMBER.        14990000
150000                                                                  15000000
150100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15010000
150200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    15020000
150300                                                                  15030000
150400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     15040000
150500        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      15050000
150600         MOVE +1                   TO ASC-BLK-SUB                 15060000
150700                                                                  15070000
150800         PERFORM 5100-WRITE-TEMP-STORAGE                          15080000
150900                                                                  15090000
151000         MOVE +1                   TO PV-BLOCK-NUMBER             15100000
151100                                                                  15110000
151200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15120000
151300             PV-FIRST-BLOCK-IN-ARRAY - 1                          15130000
151400                                                                  15140000
151500         PERFORM                                                  15150000
151600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       15160000
151700                                                                  15170000
151800             PERFORM 4410-READ-TEMP-STORAGE                       15180000
151900                                                                  15190000
152000             PERFORM 2141-CLEAR-SELECTED-INDS                     15200000
152100                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 15210000
152200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15220000
152300                                                                  15230000
152400             PERFORM 5100-WRITE-TEMP-STORAGE                      15240000
152500                                                                  15250000
152600             ADD +1                TO PV-BLOCK-NUMBER             15260000
152700                                                                  15270000
152800         END-PERFORM                                              15280000
152900                                                                  15290000
153000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15300000
153100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15310000
153200                                                                  15320000
153300         PERFORM                                                  15330000
153400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15340000
153500                   ASC-HIGHEST-BLOCK-WRITTEN                      15350000
153600                                                                  15360000
153700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15370000
153800                                   TO PV-BLOCK-NUMBER             15380000
153900                                                                  15390000
154000             PERFORM 4410-READ-TEMP-STORAGE                       15400000
154100                                                                  15410000
154200             PERFORM 2141-CLEAR-SELECTED-INDS                     15420000
154300                 VARYING ASC-ITEM-SUB                             15430000
154400                 FROM 1 BY 1                                      15440000
154500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15450000
154600                                                                  15460000
154700             PERFORM 5100-WRITE-TEMP-STORAGE                      15470000
154800                                                                  15480000
154900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      15490000
155000                                                                  15500000
155100         END-PERFORM                                              15510000
155200                                                                  15520000
155300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             15530000
155400                                   TO PV-BLOCK-NUMBER             15540000
155500                                                                  15550000
155600         PERFORM 4410-READ-TEMP-STORAGE                           15560000
155700     END-IF.                                                      15570000
155800                                                                  15580000
155900                                                                  15590000
156000     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 15600000
156100     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.15610000
156200     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  15620000
156300                                                                  15630000
156400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        15640000
156500                                                                  15650000
156600 EJECT                                                            15660000
156700*----------------------------------------------------------------*15670000
156800*    MARK EACH ITEM AS BEING NOT SELECTED.                       *15680000
156900*----------------------------------------------------------------*15690000
157000                                                                  15700000
157100 2141-CLEAR-SELECTED-INDS.                                        15710000
157200                                                                  15720000
157300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           15730000
157400             NOT EQUAL ZERO                                       15740000
157500         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15750000
157600             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15760000
157700                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    15770000
157800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  15780000
157900                                   TO TRUE                        15790000
158000         END-IF                                                   15800000
158100     END-IF.                                                      15810000
158200                                                                  15820000
158300 EJECT                                                            15830000
158400*----------------------------------------------------------------*15840000
158500*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *15850000
158600*  FOR ALL ITEMS.                                                *15860000
158700*----------------------------------------------------------------*15870000
158800                                                                  15880000
158900 2150-SELECT-ALL-ITEMS.                                           15890000
159000                                                                  15900000
159100     MOVE +1                       TO ASC-BLK-SUB.                15910000
159200                                                                  15920000
159300     PERFORM 2151-SET-SELECTED-INDS                               15930000
159400         VARYING ASC-ITEM-SUB                                     15940000
159500         FROM 1 BY 1                                              15950000
159600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15960000
159700                                                                  15970000
159800     ADD +1                        TO ASC-BLK-SUB.                15980000
159900                                                                  15990000
160000     PERFORM 2151-SET-SELECTED-INDS                               16000000
160100         VARYING ASC-ITEM-SUB                                     16010000
160200         FROM 1 BY 1                                              16020000
160300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16030000
160400                                                                  16040000
160500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               16050000
160600                                   TO PV-LIST-ITEM-NUMBER.        16060000
160700                                                                  16070000
160800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            16080000
160900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    16090000
161000                                                                  16100000
161100     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     16110000
161200        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    16120000
161300         MOVE +1                   TO ASC-BLK-SUB                 16130000
161400                                                                  16140000
161500         PERFORM 5100-WRITE-TEMP-STORAGE                          16150000
161600                                                                  16160000
161700         MOVE +1                   TO PV-BLOCK-NUMBER             16170000
161800                                                                  16180000
161900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         16190000
162000             PV-FIRST-BLOCK-IN-ARRAY - 1                          16200000
162100                                                                  16210000
162200         PERFORM                                                  16220000
162300             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       16230000
162400                                                                  16240000
162500             PERFORM 4410-READ-TEMP-STORAGE                       16250000
162600                                                                  16260000
162700             PERFORM 2151-SET-SELECTED-INDS                       16270000
162800                 VARYING ASC-ITEM-SUB                             16280000
162900                 FROM 1 BY 1                                      16290000
163000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16300000
163100                                                                  16310000
163200             PERFORM 5100-WRITE-TEMP-STORAGE                      16320000
163300                                                                  16330000
163400             ADD +1                TO PV-BLOCK-NUMBER             16340000
163500                                                                  16350000
163600         END-PERFORM                                              16360000
163700                                                                  16370000
163800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         16380000
163900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     16390000
164000                                                                  16400000
164100         PERFORM                                                  16410000
164200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       16420000
164300                   ASC-HIGHEST-BLOCK-WRITTEN                      16430000
164400                                                                  16440000
164500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          16450000
164600                                   TO PV-BLOCK-NUMBER             16460000
164700                                                                  16470000
164800             PERFORM 4410-READ-TEMP-STORAGE                       16480000
164900                                                                  16490000
165000             PERFORM 2151-SET-SELECTED-INDS                       16500000
165100                 VARYING ASC-ITEM-SUB                             16510000
165200                 FROM 1 BY 1                                      16520000
165300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16530000
165400                                                                  16540000
165500             PERFORM 5100-WRITE-TEMP-STORAGE                      16550000
165600                                                                  16560000
165700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16570000
165800                                                                  16580000
165900         END-PERFORM                                              16590000
166000                                                                  16600000
166100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             16610000
166200                                   TO PV-BLOCK-NUMBER             16620000
166300                                                                  16630000
166400         PERFORM 4410-READ-TEMP-STORAGE                           16640000
166500     END-IF.                                                      16650000
166600                                                                  16660000
166700                                                                  16670000
166800     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             16680000
166900                       ASC-NUMBER-OF-SELECTED-ITEMS.              16690000
167000                                                                  16700000
167100     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        16710000
167200                                                                  16720000
167300 EJECT                                                            16730000
167400*----------------------------------------------------------------*16740000
167500*    MARK EACH ITEM AS BEING SELECTED.                           *16750000
167600*----------------------------------------------------------------*16760000
167700                                                                  16770000
167800 2151-SET-SELECTED-INDS.                                          16780000
167900                                                                  16790000
168000     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           16800000
168100             NOT EQUAL ZERO                                       16810000
168200         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             16820000
168300             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             16830000
168400                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        16840000
168500                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  16850000
168600                               TO  TRUE                           16860000
168700         END-IF                                                   16870000
168800     END-IF.                                                      16880000
168900******************************************************************16890000
169000** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **16900000
169100** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **16910000
169200******************************************************************16920000
169300 2200-MOVE-SCREEN-TO-COMMAREA.                                    16930000
169400                                                                  16940000
169500     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             16950000
169600     MOVE +1                       TO PV-SUB.                     16960000
169700*                                                                 16970000
169800     PERFORM 3100-SET-SUBSCRIPTS.                                 16980000
169900     IF  ASTRTITL > ZERO                                          16990000
170000         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          17000000
170100     ELSE                                                         17010000
170200         IF  ASTRTITF = DP015-ERASE-EOF                           17020000
170300             INITIALIZE ASC-START-ITEM-REQUEST                    17030000
170400         END-IF                                                   17040000
170500     END-IF.                                                      17050000
170600     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          17060000
170700         VARYING PV-SUB                                           17070000
170800         FROM 1 BY 1                                              17080000
170900         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      17090000
171000                                                                  17100000
171100******************************************************************17110000
171200** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**17120000
171300******************************************************************17130000
171400 2210-MOVE-LINES-TO-COMMAREA.                                     17140000
171500                                                                  17150000
171600     SET ASC-EFF-MM-NOT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)       17160000
171700         ASC-EFF-DD-NOT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)       17170000
171800         ASC-EFF-CY-NOT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)       17180000
171900                                   TO TRUE.                       17190000
172000                                                                  17200000
172100     IF MR-SELECTL (PV-SUB) > ZERO                                17210000
172200        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE              17220000
172300        MOVE MR-SELECTI (PV-SUB)  TO ASC-TEMP-SELECTED-SW         17230000
172400                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      17240000
172500     ELSE                                                         17250000
172600        IF MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                  17260000
172700           SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE           17270000
172800           MOVE SPACE             TO ASC-TEMP-SELECTED-SW         17280000
172900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      17290000
173000        END-IF                                                    17300000
173100     END-IF.                                                      17310000
173200                                                                  17320000
173300     IF MR-TRANCODEL (PV-SUB) > ZERO                              17330000
173400        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE              17340000
173500        MOVE MR-TRANCODE (PV-SUB) TO ASC-TRANCODE                 17350000
173600                                  (ASC-BLK-SUB, ASC-ITEM-SUB)     17360000
173700        IF MR-TRANCODE (PV-SUB) = SPACES                          17370000
173800           SET ASC-LINE-NOT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)   17380000
173900                                   TO TRUE                        17390000
174000        ELSE                                                      17400000
174100           SET ASC-LINE-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)       17410000
174200                                   TO TRUE                        17420000
174300        END-IF                                                    17430000
174400     ELSE                                                         17440000
174500        IF MR-TRANCODEA (PV-SUB) = DP015-ERASE-EOF                17450000
174600           SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                   17460000
174700                                   TO TRUE                        17470000
174800           MOVE SPACES             TO ASC-TRANCODE                17480000
174900                                  (ASC-BLK-SUB, ASC-ITEM-SUB)     17490000
175000           SET ASC-LINE-NOT-CHANGED                               17500000
175100                     (ASC-BLK-SUB, ASC-ITEM-SUB) TO TRUE          17510000
175200*          SET ASC-LINE-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)       17520000
175300*                                  TO TRUE                        17530000
175400        END-IF                                                    17540000
175500     END-IF.                                                      17550000
175600                                                                  17560000
175700     IF MR-PERCENTL (PV-SUB) > ZERO                               17570000
175800        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE              17580000
175900        MOVE MR-PERCENT-FMT (PV-SUB)   TO ASC-PERCENT             17590000
176000                               (ASC-BLK-SUB, ASC-ITEM-SUB)        17600000
176100                                          ASC-PERCENT-UNFMT       17610000
176200                               (ASC-BLK-SUB, ASC-ITEM-SUB)        17620000
176300        MOVE MR-PERCENT (PV-SUB)   TO ASC-PERCENT-ORIG-ENTRD      17630000
176400                               (ASC-BLK-SUB, ASC-ITEM-SUB)        17640000
176500        IF MR-PERCENT (PV-SUB) = SPACES                           17650000
176600           SET ASC-LINE-NOT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)   17660000
176700               ASC-PERCENT-NOT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)17670000
176800                                   TO TRUE                        17680000
176900        ELSE                                                      17690000
177000           SET ASC-LINE-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)       17700000
177100               ASC-PERCENT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)    17710000
177200                                   TO TRUE                        17720000
177300        END-IF                                                    17730000
177400     ELSE                                                         17740000
177500        IF MR-PERCENTA (PV-SUB) = DP015-ERASE-EOF                 17750000
177600           SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE           17760000
177700           MOVE ZERO             TO ASC-PERCENT                   17770000
177800                                   (ASC-BLK-SUB, ASC-ITEM-SUB)    17780000
177900           MOVE SPACE            TO ASC-PERCENT-UNFMT             17790000
178000                                   (ASC-BLK-SUB, ASC-ITEM-SUB)    17800000
178100                                    ASC-PERCENT-ORIG-ENTRD        17810000
178200                                   (ASC-BLK-SUB, ASC-ITEM-SUB)    17820000
178300           SET ASC-LINE-NOT-CHANGED                               17830000
178400                        (ASC-BLK-SUB, ASC-ITEM-SUB)               17840000
178500               ASC-PERCENT-NOT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)17850000
178600                                 TO TRUE                          17860000
178700*          SET ASC-LINE-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)       17870000
178800*                                  TO TRUE                        17880000
178900        END-IF                                                    17890000
179000     END-IF.                                                      17900000
179100                                                                  17910000
179200     IF MR-FREQ-INDL (PV-SUB) > ZERO                              17920000
179300        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE              17930000
179400        MOVE MR-FREQ-IND (PV-SUB) TO ASC-FREQ-IND                 17940000
179500                                  (ASC-BLK-SUB, ASC-ITEM-SUB)     17950000
179600        IF MR-FREQ-IND (PV-SUB) = SPACES                          17960000
179700           SET ASC-LINE-NOT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)   17970000
179800               ASC-FREQ-IND-NOT-CHANGED(ASC-BLK-SUB, ASC-ITEM-SUB)17980000
179900                                   TO TRUE                        17990000
180000        ELSE                                                      18000000
180100           SET ASC-LINE-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)       18010000
180200               ASC-FREQ-IND-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)   18020000
180300                                   TO TRUE                        18030000
180400        END-IF                                                    18040000
180500     ELSE                                                         18050000
180600        IF MR-FREQ-INDA (PV-SUB) = DP015-ERASE-EOF                18060000
180700           SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                   18070000
180800                                   TO TRUE                        18080000
180900           MOVE SPACES             TO ASC-FREQ-IND                18090000
181000                                  (ASC-BLK-SUB, ASC-ITEM-SUB)     18100000
181100           SET ASC-LINE-NOT-CHANGED                               18110000
181200                     (ASC-BLK-SUB, ASC-ITEM-SUB)                  18120000
181300               ASC-FREQ-IND-NOT-CHANGED(ASC-BLK-SUB, ASC-ITEM-SUB)18130000
181400                                   TO TRUE                        18140000
181500*          SET ASC-LINE-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)       18150000
181600*                                  TO TRUE                        18160000
181700        END-IF                                                    18170000
181800     END-IF.                                                      18180000
181900                                                                  18190000
182000     IF MR-NET-RTVL (PV-SUB) > ZERO                               18200000
182100        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE              18210000
182200        MOVE MR-NET-RTV (PV-SUB) TO ASC-NET-RTV                   18220000
182300                                  (ASC-BLK-SUB, ASC-ITEM-SUB)     18230000
182400        IF MR-NET-RTV (PV-SUB) = SPACES                           18240000
182500           SET ASC-LINE-NOT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)   18250000
182600                                   TO TRUE                        18260000
182700        ELSE                                                      18270000
182800           SET ASC-LINE-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)       18280000
182900                                   TO TRUE                        18290000
183000        END-IF                                                    18300000
183100     ELSE                                                         18310000
183200        IF MR-NET-RTVA (PV-SUB) = DP015-ERASE-EOF                 18320000
183300           SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                   18330000
183400                                   TO TRUE                        18340000
183500           MOVE SPACES             TO ASC-NET-RTV                 18350000
183600                                  (ASC-BLK-SUB, ASC-ITEM-SUB)     18360000
183700           SET ASC-LINE-NOT-CHANGED                               18370000
183800                     (ASC-BLK-SUB, ASC-ITEM-SUB) TO TRUE          18380000
183900*          SET ASC-LINE-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)       18390000
184000*                                  TO TRUE                        18400000
184100        END-IF                                                    18410000
184200     END-IF.                                                      18420000
184300                                                                  18430000
184400     IF MR-NET-DISCL (PV-SUB) > ZERO                              18440000
184500        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE              18450000
184600        MOVE MR-NET-DISC (PV-SUB) TO ASC-NET-DISC                 18460000
184700                                  (ASC-BLK-SUB, ASC-ITEM-SUB)     18470000
184800        IF MR-NET-DISC (PV-SUB) = SPACES                          18480000
184900           SET ASC-LINE-NOT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)   18490000
185000                                   TO TRUE                        18500000
185100        ELSE                                                      18510000
185200           SET ASC-LINE-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)       18520000
185300                                   TO TRUE                        18530000
185400        END-IF                                                    18540000
185500     ELSE                                                         18550000
185600        IF MR-NET-DISCA (PV-SUB) = DP015-ERASE-EOF                18560000
185700           SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                   18570000
185800                                   TO TRUE                        18580000
185900           MOVE SPACES             TO ASC-NET-DISC                18590000
186000                                  (ASC-BLK-SUB, ASC-ITEM-SUB)     18600000
186100           SET ASC-LINE-NOT-CHANGED                               18610000
186200                     (ASC-BLK-SUB, ASC-ITEM-SUB) TO TRUE          18620000
186300*          SET ASC-LINE-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)       18630000
186400*                                  TO TRUE                        18640000
186500        END-IF                                                    18650000
186600     END-IF.                                                      18660000
186700                                                                  18670000
186800     IF MR-EFFDTE-MML (PV-SUB) > ZERO                             18680000
186900        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE              18690000
187000        MOVE MR-EFFDTE-MM (PV-SUB)      TO ASC-EFFDTE-MM          18700000
187100                                  (ASC-BLK-SUB, ASC-ITEM-SUB)     18710000
187200        IF MR-EFFDTE-MM (PV-SUB) = SPACES                         18720000
187300           SET ASC-LINE-NOT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)   18730000
187400               ASC-EFF-MM-NOT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB) 18740000
187500                                   TO TRUE                        18750000
187600        ELSE                                                      18760000
187700           SET ASC-LINE-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)       18770000
187800               ASC-EFF-MM-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)     18780000
187900                                   TO TRUE                        18790000
188000        END-IF                                                    18800000
188100     ELSE                                                         18810000
188200        IF MR-EFFDTE-MMA (PV-SUB) = DP015-ERASE-EOF               18820000
188300           SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                   18830000
188400                                   TO TRUE                        18840000
188500           MOVE ZERO            TO ASC-EFFDTE-MM                  18850000
188600                                  (ASC-BLK-SUB, ASC-ITEM-SUB)     18860000
188700           SET ASC-LINE-NOT-CHANGED                               18870000
188800                     (ASC-BLK-SUB, ASC-ITEM-SUB)                  18880000
188900               ASC-EFF-MM-NOT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB) 18890000
189000*          SET ASC-LINE-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)       18900000
189100                                   TO TRUE                        18910000
189200        END-IF                                                    18920000
189300     END-IF.                                                      18930000
189400                                                                  18940000
189500     IF MR-EFFDTE-DDL (PV-SUB) > ZERO                             18950000
189600        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE              18960000
189700        MOVE MR-EFFDTE-DD (PV-SUB)      TO ASC-EFFDTE-DD          18970000
189800                                  (ASC-BLK-SUB, ASC-ITEM-SUB)     18980000
189900        IF MR-EFFDTE-DD (PV-SUB) = SPACES                         18990000
190000           SET ASC-LINE-NOT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)   19000000
190100               ASC-EFF-DD-NOT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB) 19010000
190200                                   TO TRUE                        19020000
190300        ELSE                                                      19030000
190400           SET ASC-LINE-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)       19040000
190500               ASC-EFF-DD-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)     19050000
190600                                   TO TRUE                        19060000
190700        END-IF                                                    19070000
190800     ELSE                                                         19080000
190900        IF MR-EFFDTE-DDA (PV-SUB) = DP015-ERASE-EOF               19090000
191000           SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                   19100000
191100                                   TO TRUE                        19110000
191200           MOVE ZERO            TO ASC-EFFDTE-DD                  19120000
191300                                  (ASC-BLK-SUB, ASC-ITEM-SUB)     19130000
191400           SET ASC-LINE-NOT-CHANGED                               19140000
191500                     (ASC-BLK-SUB, ASC-ITEM-SUB)                  19150000
191600               ASC-EFF-DD-NOT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB) 19160000
191700*          SET ASC-LINE-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)       19170000
191800                                   TO TRUE                        19180000
191900        END-IF                                                    19190000
192000     END-IF.                                                      19200000
192100                                                                  19210000
192200     IF MR-EFFDTE-CCYYL (PV-SUB) > ZERO                           19220000
192300        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE              19230000
192400        MOVE MR-EFFDTE-CCYY (PV-SUB)      TO ASC-EFFDTE-CCYY      19240000
192500                                  (ASC-BLK-SUB, ASC-ITEM-SUB)     19250000
192600        IF MR-EFFDTE-CCYY (PV-SUB) = SPACES                       19260000
192700           SET ASC-LINE-NOT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)   19270000
192800               ASC-EFF-CY-NOT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB) 19280000
192900                                   TO TRUE                        19290000
193000        ELSE                                                      19300000
193100           SET ASC-LINE-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)       19310000
193200               ASC-EFF-CY-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)     19320000
193300                                   TO TRUE                        19330000
193400        END-IF                                                    19340000
193500     ELSE                                                         19350000
193600        IF MR-EFFDTE-CCYYA (PV-SUB) = DP015-ERASE-EOF             19360000
193700           SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                   19370000
193800                                   TO TRUE                        19380000
193900           MOVE ZERO            TO ASC-EFFDTE-CCYY                19390000
194000                                  (ASC-BLK-SUB, ASC-ITEM-SUB)     19400000
194100           SET ASC-LINE-NOT-CHANGED                               19410000
194200                     (ASC-BLK-SUB, ASC-ITEM-SUB)                  19420000
194300               ASC-EFF-CY-NOT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB) 19430000
194400*          SET ASC-LINE-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)       19440000
194500                                   TO TRUE                        19450000
194600        END-IF                                                    19460000
194700     END-IF.                                                      19470000
194800                                                                  19480000
194900     IF MR-EXPDTE-MML (PV-SUB) > ZERO                             19490000
195000        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE              19500000
195100        MOVE MR-EXPDTE-MM (PV-SUB)      TO ASC-EXPDTE-MM          19510000
195200                                  (ASC-BLK-SUB, ASC-ITEM-SUB)     19520000
195300        IF MR-EXPDTE-MM (PV-SUB) = SPACES                         19530000
195400           SET ASC-LINE-NOT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)   19540000
195500                                   TO TRUE                        19550000
195600        ELSE                                                      19560000
195700           SET ASC-LINE-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)       19570000
195800                                   TO TRUE                        19580000
195900        END-IF                                                    19590000
196000     ELSE                                                         19600000
196100        IF MR-EXPDTE-MMA (PV-SUB) = DP015-ERASE-EOF               19610000
196200           SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                   19620000
196300                                   TO TRUE                        19630000
196400           MOVE ZERO            TO ASC-EXPDTE-MM                  19640000
196500                                  (ASC-BLK-SUB, ASC-ITEM-SUB)     19650000
196600           SET ASC-LINE-NOT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)   19660000
196700                                   TO TRUE                        19670000
196800*          SET ASC-LINE-CHANGED                                   19680000
196900*                    (ASC-BLK-SUB, ASC-ITEM-SUB) TO TRUE          19690000
197000        END-IF                                                    19700000
197100     END-IF.                                                      19710000
197200                                                                  19720000
197300     IF MR-EXPDTE-DDL (PV-SUB) > ZERO                             19730000
197400        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE              19740000
197500        MOVE MR-EXPDTE-DD (PV-SUB)      TO ASC-EXPDTE-DD          19750000
197600                                  (ASC-BLK-SUB, ASC-ITEM-SUB)     19760000
197700        IF MR-EXPDTE-DD (PV-SUB) = SPACES                         19770000
197800           SET ASC-LINE-NOT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)   19780000
197900                                   TO TRUE                        19790000
198000        ELSE                                                      19800000
198100           SET ASC-LINE-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)       19810000
198200                                   TO TRUE                        19820000
198300        END-IF                                                    19830000
198400     ELSE                                                         19840000
198500        IF MR-EXPDTE-DDA (PV-SUB) = DP015-ERASE-EOF               19850000
198600           SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                   19860000
198700                                   TO TRUE                        19870000
198800           MOVE ZERO            TO ASC-EXPDTE-DD                  19880000
198900                                  (ASC-BLK-SUB, ASC-ITEM-SUB)     19890000
199000           SET ASC-LINE-NOT-CHANGED                               19900000
199100                     (ASC-BLK-SUB, ASC-ITEM-SUB) TO TRUE          19910000
199200*          SET ASC-LINE-CHANGED                                   19920000
199300*                    (ASC-BLK-SUB, ASC-ITEM-SUB) TO TRUE          19930000
199400        END-IF                                                    19940000
199500     END-IF.                                                      19950000
199600                                                                  19960000
199700     IF MR-EXPDTE-CCYYL (PV-SUB) > ZERO                           19970000
199800        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE              19980000
199900        MOVE MR-EXPDTE-CCYY (PV-SUB)      TO ASC-EXPDTE-CCYY      19990000
200000                                  (ASC-BLK-SUB, ASC-ITEM-SUB)     20000000
200100        IF MR-EXPDTE-CCYY (PV-SUB) = SPACES                       20010000
200200           SET ASC-LINE-NOT-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)   20020000
200300                                   TO TRUE                        20030000
200400        ELSE                                                      20040000
200500           SET ASC-LINE-CHANGED (ASC-BLK-SUB, ASC-ITEM-SUB)       20050000
200600                                   TO TRUE                        20060000
200700        END-IF                                                    20070000
200800     ELSE                                                         20080000
200900        IF MR-EXPDTE-CCYYA (PV-SUB) = DP015-ERASE-EOF             20090000
201000           SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                   20100000
201100                                   TO TRUE                        20110000
201200           MOVE ZERO            TO ASC-EXPDTE-CCYY                20120000
201300                                  (ASC-BLK-SUB, ASC-ITEM-SUB)     20130000
201400           SET ASC-LINE-NOT-CHANGED                               20140000
201500                     (ASC-BLK-SUB, ASC-ITEM-SUB) TO TRUE          20150000
201600*          SET ASC-LINE-CHANGED                                   20160000
201700*                    (ASC-BLK-SUB, ASC-ITEM-SUB) TO TRUE          20170000
201800        END-IF                                                    20180000
201900     END-IF.                                                      20190000
202000                                                                  20200000
202100     ADD +1                        TO ASC-ITEM-SUB.               20210000
202200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        20220000
202300         ADD +1                    TO ASC-BLK-SUB                 20230000
202400         MOVE +1                   TO ASC-ITEM-SUB                20240000
202500     END-IF.                                                      20250000
202600                                                                  20260000
202700******************************************************************20270000
202800** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **20280000
202900** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **20290000
203000******************************************************************20300000
203100 3000-EDIT-DATA-IN-COMMAREA.                                      20310000
203200     SET PS-NO-ERROR               TO TRUE.                       20320000
203300     PERFORM 3200-RESET-ATTRIBUTES.                               20330000
203400     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     20340000
203500**                                                                20350000
203600* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              20360000
203700* EDITTING IS DONE FROM THE BOTTOM UP.                            20370000
203800**                                                                20380000
203900     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       20390000
204000         ASC-ITEMS-DISPLAYED - 1.                                 20400000
204100     PERFORM 3100-SET-SUBSCRIPTS.                                 20410000
204200     PERFORM 3300-EDIT-SELECTIONS                                 20420000
204300         VARYING PV-SUB                                           20430000
204400         FROM PV-SUB BY -1                                        20440000
204500         UNTIL PV-SUB < +1.                                       20450000
204600*                                                                 20460000
204700 EJECT                                                            20470000
204800*----------------------------------------------------------------*20480000
204900*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *20490000
205000*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*20500000
205100*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *20510000
205200*                                                                *20520000
205300*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *20530000
205400*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *20540000
205500*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *20550000
205600*    US IN THE 2ND BLOCK OF THE ARRAY.                           *20560000
205700*----------------------------------------------------------------*20570000
205800                                                                  20580000
205900 3100-SET-SUBSCRIPTS.                                             20590000
206000                                                                  20600000
206100     COMPUTE ASC-ITEM-SUB =                                       20610000
206200         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        20620000
206300                                                                  20630000
206400     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         20640000
206500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            20650000
206600                                                                  20660000
206700         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               20670000
206800     ELSE                                                         20680000
206900         MOVE +1                     TO ASC-BLK-SUB               20690000
207000     END-IF.                                                      20700000
207100******************************************************************20710000
207200** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **20720000
207300******************************************************************20730000
207400                                                                  20740000
207500 3200-RESET-ATTRIBUTES.                                           20750000
207600     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   20760000
207700     MOVE DP015-GREEN              TO ASTRTITC.                   20770000
207800     MOVE DP015-UNDERLINE          TO ASTRTITH.                   20780000
207900*                                                                 20790000
208000     PERFORM                                                      20800000
208100         VARYING PV-SUB                                           20810000
208200         FROM 1 BY 1                                              20820000
208300         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        20830000
208400         MOVE DP015-UNP-ALP-NOR-OFF TO MR-SELECTA      (PV-SUB)   20840000
208500                                       MR-TRANCODEA    (PV-SUB)   20850000
208600                                       MR-PERCENTA     (PV-SUB)   20860000
208700                                       MR-FREQ-INDA    (PV-SUB)   20870000
208800                                       MR-NET-RTVA     (PV-SUB)   20880000
208900                                       MR-NET-DISCA    (PV-SUB)   20890000
209000                                       MR-EFFDTE-MMA   (PV-SUB)   20900000
209100                                       MR-EFFDTE-DDA   (PV-SUB)   20910000
209200                                       MR-EFFDTE-CCYYA (PV-SUB)   20920000
209300                                       MR-EXPDTE-MMA   (PV-SUB)   20930000
209400                                       MR-EXPDTE-DDA   (PV-SUB)   20940000
209500                                       MR-EXPDTE-CCYYA (PV-SUB)   20950000
209600         MOVE DP015-GREEN           TO MR-SELECTC      (PV-SUB)   20960000
209700                                       MR-TRANCODEC    (PV-SUB)   20970000
209800                                       MR-PERCENTC     (PV-SUB)   20980000
209900                                       MR-FREQ-INDC    (PV-SUB)   20990000
210000                                       MR-NET-RTVC     (PV-SUB)   21000000
210100                                       MR-NET-DISCC    (PV-SUB)   21010000
210200                                       MR-EFFDTE-MMC   (PV-SUB)   21020000
210300                                       MR-EFFDTE-DDC   (PV-SUB)   21030000
210400                                       MR-EFFDTE-CCYYC (PV-SUB)   21040000
210500                                       MR-EXPDTE-MMC   (PV-SUB)   21050000
210600                                       MR-EXPDTE-DDC   (PV-SUB)   21060000
210700                                       MR-EXPDTE-CCYYC (PV-SUB)   21070000
210800         MOVE DP015-UNDERLINE       TO MR-SELECTH      (PV-SUB)   21080000
210900                                       MR-TRANCODEH    (PV-SUB)   21090000
211000                                       MR-PERCENTH     (PV-SUB)   21100000
211100                                       MR-FREQ-INDH    (PV-SUB)   21110000
211200                                       MR-NET-RTVH     (PV-SUB)   21120000
211300                                       MR-NET-DISCH    (PV-SUB)   21130000
211400                                       MR-EFFDTE-MMH   (PV-SUB)   21140000
211500                                       MR-EFFDTE-DDH   (PV-SUB)   21150000
211600                                       MR-EFFDTE-CCYYH (PV-SUB)   21160000
211700                                       MR-EXPDTE-MMH   (PV-SUB)   21170000
211800                                       MR-EXPDTE-DDH   (PV-SUB)   21180000
211900                                       MR-EXPDTE-CCYYH (PV-SUB)   21190000
212000         IF ASC-ACTION-SW = 'U'                                   21200000
212100            MOVE DP015-PRO-NOR-OFF     TO MR-TRANCODEA (PV-SUB)   21210000
212200            MOVE DP015-BLUE            TO MR-TRANCODEC (PV-SUB)   21220000
212300            MOVE DP015-HL-OFF          TO MR-TRANCODEH (PV-SUB)   21230000
212400         END-IF                                                   21240000
212500     END-PERFORM.                                                 21250000
212600******************************************************************21260000
212700** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **21270000
212800** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **21280000
212900** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **21290000
213000** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **21300000
213100******************************************************************21310000
213200 3300-EDIT-SELECTIONS.                                            21320000
213300                                                                  21330000
213400     MOVE 'N' TO ASC-PERCENT-ERR-FLAG (ASC-BLK-SUB, ASC-ITEM-SUB).21340000
213500                                                                  21350000
213600     EVALUATE TRUE                                                21360000
213700         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     21370000
213800             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         21380000
213900                 CONTINUE                                         21390000
214000         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         21400000
214100             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        21410000
214200                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   21420000
214300                 MOVE ASC-TEMP-SELECTED-SW                        21430000
214400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  21440000
214500                                TO ASC-SELECTED-SW                21450000
214600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  21460000
214700             END-IF                                               21470000
214800         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     21480000
214900                 = SPACE                                          21490000
215000             EVALUATE TRUE                                        21500000
215100                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       21510000
215200                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS21520000
215300                     MOVE SPACE TO ASC-SELECTED-SW                21530000
215400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  21540000
215500             END-EVALUATE                                         21550000
215600         WHEN OTHER                                               21560000
215700             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           21570000
215800             SET DP020-MSG-FATAL    TO TRUE                       21580000
215900             MOVE -1                TO MR-SELECTL (PV-SUB)        21590000
216000             SET DP030-SET-CURSOR-APPL-1                          21600000
216100                                    TO TRUE                       21610000
216200             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        21620000
216300             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        21630000
216400             SET PS-ERROR TO TRUE                                 21640000
216500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            21650000
216600                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     21660000
216700                 MOVE SPACE         TO ASC-SELECTED-SW            21670000
216800                                        (ASC-BLK-SUB ASC-ITEM-SUB)21680000
216900             END-IF                                               21690000
217000     END-EVALUATE.                                                21700000
217100                                                                  21710000
217200     IF ASC-ACTION-SW = 'U'                                       21720000
217300        IF ASC-LINE-CHANGED (ASC-BLK-SUB ASC-ITEM-SUB)            21730000
217400           IF ASC-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            21740000
217500*  LINE MUST BE SELECTED BEFORE UPDATE TAKES PLACE.               21750000
217600              SET DP020-MSG-FATAL  TO TRUE                        21760000
217700              MOVE -1              TO MR-SELECTL      (PV-SUB)    21770000
217800              SET DP030-SET-CURSOR-APPL-1 TO TRUE                 21780000
217900              MOVE SPACE           TO MR-SELECTI      (PV-SUB)    21790000
218000              MOVE DP015-RED       TO MR-SELECTC      (PV-SUB)    21800000
218100*                                     MR-TRANCODEC    (PV-SUB)    21810000
218200                                      MR-PERCENTC     (PV-SUB)    21820000
218300                                      MR-FREQ-INDC    (PV-SUB)    21830000
218400                                      MR-NET-RTVC     (PV-SUB)    21840000
218500                                      MR-NET-DISCC    (PV-SUB)    21850000
218600                                      MR-EFFDTE-MMC   (PV-SUB)    21860000
218700                                      MR-EFFDTE-DDC   (PV-SUB)    21870000
218800                                      MR-EFFDTE-CCYYC (PV-SUB)    21880000
218900                                      MR-EXPDTE-MMC   (PV-SUB)    21890000
219000                                      MR-EXPDTE-DDC   (PV-SUB)    21900000
219100                                      MR-EXPDTE-CCYYC (PV-SUB)    21910000
219200              MOVE DP015-REVERSE   TO MR-SELECTH      (PV-SUB)    21920000
219300*                                     MR-TRANCODEH    (PV-SUB)    21930000
219400                                      MR-PERCENTH     (PV-SUB)    21940000
219500                                      MR-FREQ-INDH    (PV-SUB)    21950000
219600                                      MR-NET-RTVH     (PV-SUB)    21960000
219700                                      MR-NET-DISCH    (PV-SUB)    21970000
219800                                      MR-EFFDTE-MMH   (PV-SUB)    21980000
219900                                      MR-EFFDTE-DDH   (PV-SUB)    21990000
220000                                      MR-EFFDTE-CCYYH (PV-SUB)    22000000
220100                                      MR-EXPDTE-MMH   (PV-SUB)    22010000
220200                                      MR-EXPDTE-DDH   (PV-SUB)    22020000
220300                                      MR-EXPDTE-CCYYH (PV-SUB)    22030000
220400              MOVE DP015-UNP-ALP-BRT-OFF                          22040000
220500                                   TO MR-SELECTA      (PV-SUB)    22050000
220600*                                     MR-TRANCODEA    (PV-SUB)    22060000
220700                                      MR-PERCENTA     (PV-SUB)    22070000
220800                                      MR-FREQ-INDA    (PV-SUB)    22080000
220900                                      MR-NET-RTVA     (PV-SUB)    22090000
221000                                      MR-NET-DISCA    (PV-SUB)    22100000
221100                                      MR-EFFDTE-MMA   (PV-SUB)    22110000
221200                                      MR-EFFDTE-DDA   (PV-SUB)    22120000
221300                                      MR-EFFDTE-CCYYA (PV-SUB)    22130000
221400                                      MR-EXPDTE-MMA   (PV-SUB)    22140000
221500                                      MR-EXPDTE-DDA   (PV-SUB)    22150000
221600                                      MR-EXPDTE-CCYYA (PV-SUB)    22160000
221700              MOVE DP015-PRO-NOR-OFF  TO MR-TRANCODEA (PV-SUB)    22170000
221800              MOVE DP015-BLUE         TO MR-TRANCODEC (PV-SUB)    22180000
221900              MOVE DP015-HL-OFF       TO MR-TRANCODEH (PV-SUB)    22190000
222000              IF PS-NO-ERROR                                      22200000
222100                 MOVE PC-TSYMSG-03112 TO DP020-MSG-NUMBER         22210000
222200              END-IF                                              22220000
222300              SET PS-ERROR TO TRUE                                22230000
222400           ELSE                                                   22240000
222500              PERFORM 3320-CHECK-IF-ALREADY-EXPIRED               22250000
222600              IF PS-NO-ERROR                                      22260000
222700                 PERFORM 3330-EDIT-LINE-FOR-UPDATE                22270000
222800              END-IF                                              22280000
222900           END-IF                                                 22290000
223000        ELSE                                                      22300000
223100           IF ASC-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            22310000
223200*  NO UPDATE; NO SELECTIONS OR CHANGES WERE MADE                  22320000
223300              NEXT SENTENCE                                       22330000
223400           ELSE                                                   22340000
223500*  UPDATE NOT ALLOWED; NO CHANGES WERE MADE TO THE SELECTED LINE  22350000
223600              MOVE PC-TSYMSG-03111   TO DP020-MSG-NUMBER          22360000
223700              SET DP020-MSG-FATAL    TO TRUE                      22370000
223800              MOVE -1                TO MR-SELECTL (PV-SUB)       22380000
223900              SET DP030-SET-CURSOR-APPL-1                         22390000
224000                                     TO TRUE                      22400000
224100              MOVE DP015-RED         TO MR-SELECTC (PV-SUB)       22410000
224200              MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)       22420000
224300              SET PS-ERROR TO TRUE                                22430000
224400           END-IF                                                 22440000
224500        END-IF                                                    22450000
224600     END-IF.                                                      22460000
224700                                                                  22470000
224800     IF ASC-ACTION-SW = 'A'                                       22480000
224900        IF ASC-LINE-CHANGED (ASC-BLK-SUB ASC-ITEM-SUB)            22490000
225000           IF ASC-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            22500000
225100*  LINE MUST BE SELECTED BEFORE ADD TAKES PLACE.                  22510000
225200              SET DP020-MSG-FATAL  TO TRUE                        22520000
225300              MOVE -1              TO MR-SELECTL      (PV-SUB)    22530000
225400              SET DP030-SET-CURSOR-APPL-1 TO TRUE                 22540000
225500              MOVE SPACE           TO MR-SELECTI      (PV-SUB)    22550000
225600              MOVE DP015-RED       TO MR-SELECTC      (PV-SUB)    22560000
225700                                      MR-TRANCODEC    (PV-SUB)    22570000
225800                                      MR-PERCENTC     (PV-SUB)    22580000
225900                                      MR-FREQ-INDC    (PV-SUB)    22590000
226000                                      MR-NET-RTVC     (PV-SUB)    22600000
226100                                      MR-NET-DISCC    (PV-SUB)    22610000
226200                                      MR-EFFDTE-MMC   (PV-SUB)    22620000
226300                                      MR-EFFDTE-DDC   (PV-SUB)    22630000
226400                                      MR-EFFDTE-CCYYC (PV-SUB)    22640000
226500                                      MR-EXPDTE-MMC   (PV-SUB)    22650000
226600                                      MR-EXPDTE-DDC   (PV-SUB)    22660000
226700                                      MR-EXPDTE-CCYYC (PV-SUB)    22670000
226800              MOVE DP015-REVERSE   TO MR-SELECTH      (PV-SUB)    22680000
226900                                      MR-TRANCODEH    (PV-SUB)    22690000
227000                                      MR-PERCENTH     (PV-SUB)    22700000
227100                                      MR-FREQ-INDH    (PV-SUB)    22710000
227200                                      MR-NET-RTVH     (PV-SUB)    22720000
227300                                      MR-NET-DISCH    (PV-SUB)    22730000
227400                                      MR-EFFDTE-MMH   (PV-SUB)    22740000
227500                                      MR-EFFDTE-DDH   (PV-SUB)    22750000
227600                                      MR-EFFDTE-CCYYH (PV-SUB)    22760000
227700                                      MR-EXPDTE-MMH   (PV-SUB)    22770000
227800                                      MR-EXPDTE-DDH   (PV-SUB)    22780000
227900                                      MR-EXPDTE-CCYYH (PV-SUB)    22790000
228000              MOVE DP015-UNP-ALP-BRT-OFF                          22800000
228100                                   TO MR-SELECTA      (PV-SUB)    22810000
228200                                      MR-TRANCODEA    (PV-SUB)    22820000
228300                                      MR-PERCENTA     (PV-SUB)    22830000
228400                                      MR-FREQ-INDA    (PV-SUB)    22840000
228500                                      MR-NET-RTVA     (PV-SUB)    22850000
228600                                      MR-NET-DISCA    (PV-SUB)    22860000
228700                                      MR-EFFDTE-MMA   (PV-SUB)    22870000
228800                                      MR-EFFDTE-DDA   (PV-SUB)    22880000
228900                                      MR-EFFDTE-CCYYA (PV-SUB)    22890000
229000                                      MR-EXPDTE-MMA   (PV-SUB)    22900000
229100                                      MR-EXPDTE-DDA   (PV-SUB)    22910000
229200                                      MR-EXPDTE-CCYYA (PV-SUB)    22920000
229300              IF PS-NO-ERROR                                      22930000
229400                 MOVE PC-TSYMSG-03119 TO DP020-MSG-NUMBER         22940000
229500              END-IF                                              22950000
229600              SET PS-ERROR TO TRUE                                22960000
229700           ELSE                                                   22970000
229800              PERFORM 3340-EDIT-LINE-FOR-ADD                      22980000
229900           END-IF                                                 22990000
230000        ELSE                                                      23000000
230100           IF ASC-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            23010000
230200*  ADD DOES NOT TAKE PLACE; NO SELECTIONS OR CHANGES WERE MADE    23020000
230300              NEXT SENTENCE                                       23030000
230400           ELSE                                                   23040000
230500*  ADD NOT ALLOWED; NO CHANGES WERE MADE TO THE SELECTED LINE     23050000
230600              MOVE PC-TSYMSG-03120   TO DP020-MSG-NUMBER          23060000
230700              SET DP020-MSG-FATAL    TO TRUE                      23070000
230800              MOVE -1                TO MR-SELECTL (PV-SUB)       23080000
230900              SET DP030-SET-CURSOR-APPL-1                         23090000
231000                                     TO TRUE                      23100000
231100              MOVE DP015-RED         TO MR-SELECTC (PV-SUB)       23110000
231200              MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)       23120000
231300              SET PS-ERROR TO TRUE                                23130000
231400           END-IF                                                 23140000
231500        END-IF                                                    23150000
231600     END-IF.                                                      23160000
231700                                                                  23170000
231800     SUBTRACT +1             FROM PV-ITEM-IN-USE                  23180000
231900                                  ASC-ITEM-SUB.                   23190000
232000                                                                  23200000
232100     IF  ASC-ITEM-SUB < 1                                         23210000
232200         SUBTRACT +1 FROM ASC-BLK-SUB                             23220000
232300         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                23230000
232400     END-IF.                                                      23240000
232500                                                                  23250000
232600******************************************************************23260000
232700*  SELECT THE ORIGINAL EXPIRATION DATE OF THE ROW THAT IS BEING  *23270000
232800*  UPDATED.  IF THE ORIGINAL EXPIRATION DATE IS                  *23280000
232900*  LESS THAN THE CURRENT DATE, THEN BLOCK THE UPDATE OF AN AL-   *23290000
233000*  READY EXPIRED ROW.                                            *23300000
233100******************************************************************23310000
233200 3320-CHECK-IF-ALREADY-EXPIRED.                                   23320000
233300                                                                  23330000
233400     PERFORM 7220-SELECT-ORIGINAL-EXPDATE.                        23340000
233500                                                                  23350000
233600     IF  PV-ORIGINAL-EXPDTE < ASC-CURRENT-DATE                    23360000
233700*  UPDATE NOT ALLOWED ON AN EXPIRED OFF-INVOICE PROGRAM           23370000
233800         SET DP020-MSG-FATAL        TO TRUE                       23380000
233900         MOVE DP015-UNP-ALP-BRT-OFF TO MR-SELECTA (PV-SUB)        23390000
234000         MOVE DP015-RED             TO MR-SELECTC (PV-SUB)        23400000
234100         MOVE DP015-REVERSE         TO MR-SELECTH (PV-SUB)        23410000
234200         MOVE -1                    TO MR-SELECTL (PV-SUB)        23420000
234300         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      23430000
234400         IF PS-NO-ERROR                                           23440000
234500            MOVE PC-TSYMSG-03118    TO DP020-MSG-NUMBER           23450000
234600         END-IF                                                   23460000
234700         SET PS-ERROR               TO TRUE                       23470000
234800     END-IF.                                                      23480000
234900                                                                  23490000
235000******************************************************************23500000
235100* THIS PARAGRAPH PERFORMS THE EDITS TO THE VARIOUS PARTS OF THE  *23510000
235200* SELECTED LINE FOR VALIDITY WHILE IN UPDATE MODE.               *23520000
235300******************************************************************23530000
235400 3330-EDIT-LINE-FOR-UPDATE.                                       23540000
235500                                                                  23550000
235600*     PERFORM 3400-EDIT-TRANCODE.                                 23560000
235700                                                                  23570000
235800      PERFORM 3410-EDIT-PERCENT.                                  23580000
235900                                                                  23590000
236000      PERFORM 3415-EDIT-NET-RTV.                                  23600000
236100                                                                  23610000
236200      PERFORM 3416-EDIT-NET-DISC.                                 23620000
236300                                                                  23630000
236400      PERFORM 3420-EDIT-FREQ-CDE.                                 23640000
236500                                                                  23650000
236600      IF ASC-FREQ-IND-VALID (ASC-BLK-SUB ASC-ITEM-SUB)            23660000
236700         PERFORM 8000-GET-DEFAULT-EFF-DATE                        23670000
236800      ELSE                                                        23680000
236900         MOVE ASC-CURRENT-DATE  TO PV-DEFAULT-DATE                23690000
237000      END-IF.                                                     23700000
237100                                                                  23710000
237200*     IF MR-EFFDTE-MML   (PV-SUB) > 0 OR                          23720000
237300*        MR-EFFDTE-DDL   (PV-SUB) > 0 OR                          23730000
237400*        MR-EFFDTE-CCYYL (PV-SUB) > 0                             23740000
237500      IF (MR-EFFDTE-MML   (PV-SUB) > 0 OR = -1) OR                23750000
237600         (MR-EFFDTE-DDL   (PV-SUB) > 0 OR = -1) OR                23760000
237700         (MR-EFFDTE-CCYYL (PV-SUB) > 0 OR = -1)                   23770000
237800* EDIT THE EFFECTIVE DATE IF ANY PART OF THE SCREEN DATE WAS      23780000
237900* CHANGED                                                         23790000
238000         PERFORM 3430-EDIT-EFFECTIVE-DATE                         23800000
238100      ELSE                                                        23810000
238200         IF MR-EFFDTE-MML   (PV-SUB) = 0 AND                      23820000
238300            MR-EFFDTE-DDL   (PV-SUB) = 0 AND                      23830000
238400            MR-EFFDTE-CCYYL (PV-SUB) = 0                          23840000
238500* MOVE THE ASC EFFECTIVE DATE TO THE W/S DATE FIELD IF THE DATE   23850000
238600* WAS NOT CHANGED                                                 23860000
238700            MOVE ASC-EFFDTE-MM   (ASC-BLK-SUB ASC-ITEM-SUB)       23870000
238800                                 TO PV-MM                         23880000
238900            MOVE ASC-EFFDTE-DD   (ASC-BLK-SUB ASC-ITEM-SUB)       23890000
239000                                 TO PV-DD                         23900000
239100            MOVE ASC-EFFDTE-CCYY (ASC-BLK-SUB ASC-ITEM-SUB)       23910000
239200                                 TO PV-CCYY                       23920000
239300            MOVE '-'             TO PV-DASH1 PV-DASH2             23930000
239400            MOVE PV-CCYYMMDD-DATE TO PV-DB2-EFFDTE                23940000
239500            SET PS-VALID-DATE     TO TRUE                         23950000
239600            MOVE SPACES           TO PV-CCYYMMDD-DATE             23960000
239700         ELSE                                                     23970000
239800* MOVE THE DEFAULT DATE TO THE W/S DATE FIELD, ASC EFFECTIVE DATE 23980000
239900* & SCREEN EFFECTIVE DATE AS THE DEFAULT DATE VALUE.              23990000
240000*           MOVE ASC-CURRENT-DATE TO PV-CCYYMMDD-DATE             24000000
240100            MOVE PV-DEFAULT-DATE  TO PV-CCYYMMDD-DATE             24010000
240200            MOVE PV-MM   TO                                       24020000
240300                       ASC-EFFDTE-MM   (ASC-BLK-SUB ASC-ITEM-SUB) 24030000
240400                       MR-EFFDTE-MM    (PV-SUB)                   24040000
240500            MOVE PV-DD   TO                                       24050000
240600                       ASC-EFFDTE-DD   (ASC-BLK-SUB ASC-ITEM-SUB) 24060000
240700                       MR-EFFDTE-DD    (PV-SUB)                   24070000
240800            MOVE PV-CCYY TO                                       24080000
240900                       ASC-EFFDTE-CCYY (ASC-BLK-SUB ASC-ITEM-SUB) 24090000
241000                       MR-EFFDTE-CCYY  (PV-SUB)                   24100000
241100            MOVE PV-CCYYMMDD-DATE TO PV-DB2-EFFDTE                24110000
241200            SET PS-VALID-DATE     TO TRUE                         24120000
241300            MOVE SPACES           TO PV-CCYYMMDD-DATE             24130000
241400         END-IF                                                   24140000
241500      END-IF.                                                     24150000
241600                                                                  24160000
241700     IF PS-VALID-DATE                                             24170000
241800        PERFORM 8500-MATCH-EFFDATE-TO-FREQ                        24180000
241900        IF ASC-FREQ-EFFDATE-NOT-MATCH (ASC-BLK-SUB ASC-ITEM-SUB)  24190000
242000* INVALID EFFECTIVE DATE FOR THE POSTING FREQUENCY                24200000
242100           MOVE DP015-UNP-ALP-BRT-OFF                             24210000
242200                                   TO MR-FREQ-INDA    (PV-SUB)    24220000
242300                                      MR-EFFDTE-MMA   (PV-SUB)    24230000
242400                                      MR-EFFDTE-DDA   (PV-SUB)    24240000
242500                                      MR-EFFDTE-CCYYA (PV-SUB)    24250000
242600           MOVE DP015-REVERSE      TO MR-FREQ-INDH    (PV-SUB)    24260000
242700                                      MR-EFFDTE-MMH   (PV-SUB)    24270000
242800                                      MR-EFFDTE-DDH   (PV-SUB)    24280000
242900                                      MR-EFFDTE-CCYYH (PV-SUB)    24290000
243000           MOVE DP015-RED          TO MR-FREQ-INDC    (PV-SUB)    24300000
243100                                      MR-EFFDTE-MMC   (PV-SUB)    24310000
243200                                      MR-EFFDTE-DDC   (PV-SUB)    24320000
243300                                      MR-EFFDTE-CCYYC (PV-SUB)    24330000
243400           MOVE -1                 TO MR-EFFDTE-MML   (PV-SUB)    24340000
243500           SET DP030-SET-CURSOR-APPL-1 TO TRUE                    24350000
243600           IF PS-NO-ERROR                                         24360000
243700              MOVE PC-TSYMSG-03250 TO DP020-MSG-NUMBER            24370000
243800           END-IF                                                 24380000
243900           SET PS-ERROR            TO TRUE                        24390000
244000           SET DP020-MSG-FATAL     TO TRUE                        24400000
244100        END-IF                                                    24410000
244200     END-IF.                                                      24420000
244300                                                                  24430000
244400      IF PS-VALID-DATE                                            24440000
244500*        PERFORM 3440-VALIDATE-TRANCODE                           24450000
244600*  INVALID TRANCODE FOR THIS OFF-INVOICE PROGRAM                  24460000
244700*        IF ASC-TRANCODE-INVALID                                  24470000
244800*           SET DP020-MSG-FATAL     TO TRUE                       24480000
244900*           MOVE DP015-UNP-ALP-BRT-OFF                            24490000
245000*                                   TO MR-TRANCODEA (PV-SUB)      24500000
245100*           MOVE DP015-REVERSE      TO MR-TRANCODEH (PV-SUB)      24510000
245200*           MOVE DP015-RED          TO MR-TRANCODEC (PV-SUB)      24520000
245300*           MOVE -1                 TO MR-TRANCODEL (PV-SUB)      24530000
245400*           SET DP030-SET-CURSOR-APPL-1 TO TRUE                   24540000
245500*           IF PS-NO-ERROR                                        24550000
245600*              MOVE PC-TSYMSG-03110 TO DP020-MSG-NUMBER           24560000
245700*           END-IF                                                24570000
245800*           SET PS-ERROR            TO TRUE                       24580000
245900*        END-IF                                                   24590000
246000         IF MR-EXPDTE-MML   (PV-SUB) > 0 OR                       24600000
246100            MR-EXPDTE-DDL   (PV-SUB) > 0 OR                       24610000
246200            MR-EXPDTE-CCYYL (PV-SUB) > 0                          24620000
246300            PERFORM 3450-EDIT-EXPIRATION-DATE                     24630000
246400****** NOTE FROM 9-22-2003 *******                                24640000
246500* THIS IS THE AREA IN THE CODE THAT CHECKS FOR ONLY THE EXPIRE    24650000
246600* DATE BEING UPDATED AND NOTHING ELSE. SET A SWITCH IN ASC-       24660000
246700* TO BE CHECKED LATER WHERE THE 7200-EXPIRE AND INSERT OF UPDATED 24670000
246800* AGREEMENT ARE PERFORMED IN 6900-.  CHECK IF THIS ASC- SWITCH WAS24680000
246900* SET AND JUST PERFORM A STRAIGHT UPDATE OF ONLY THE EXPIRATION   24690000
247000* DATE.  THIS WOULD 'DELETE' AN AGREEMENT BECAUSE THE EFFECTIVE   24700000
247100* AND EXPIRE DATES ARE EQUAL.  THIS IS FOR A FUTURE ENHANCEMENT   24710000
247200* TO BE WORKED OUT WITH NANCY AFTER THE INITIAL INSTALL ON THE    24720000
247300* WEEKEND OF 9-27                                                 24730000
247400*           IF PS-VALID-DATE                                      24740000
247500*           AND (MR-TRANCODEL   (PV-SUB) = 0 AND                  24750000
247600*                MR-PERCENTL    (PV-SUB) = 0 AND                  24760000
247700*                MR-NET-RTVL    (PV-SUB) = 0 AND                  24770000
247800*                MR-NET-DISCL   (PV-SUB) = 0 AND                  24780000
247900*                MR-FREQ-INDL   (PV-SUB) = 0 AND                  24790000
248000*                MR-EFFDTE-MML  (PV-SUB) = 0 AND                  24800000
248100*                MR-EFFDTE-DDL  (PV-SUB) = 0 AND                  24810000
248200*                MR-EFFDTE-CCYYL(PV-SUB) = 0)                     24820000
248300*           AND MR-EFFDTE-MM   (PV-SUB) = MR-EXPDTE-MM   (PV-SUB) 24830000
248400*           AND MR-EFFDTE-DD   (PV-SUB) = MR-EXPDTE-DD   (PV-SUB) 24840000
248500*           AND MR-EFFDTE-CCYY (PV-SUB) = MR-EXPDTE-CCYY (PV-SUB) 24850000
248600*              MOVE 'Y' TO ASC-         (ASC-BLK-SUB ASC-ITEM-SUB)24860000
248700*           END-IF                                                24870000
248800         ELSE                                                     24880000
248900            MOVE ASC-EXPDTE-MM   (ASC-BLK-SUB ASC-ITEM-SUB)       24890000
249000                                 TO PV-MM                         24900000
249100            MOVE ASC-EXPDTE-DD   (ASC-BLK-SUB ASC-ITEM-SUB)       24910000
249200                                 TO PV-DD                         24920000
249300            MOVE ASC-EXPDTE-CCYY (ASC-BLK-SUB ASC-ITEM-SUB)       24930000
249400                                 TO PV-CCYY                       24940000
249500            MOVE '-'             TO PV-DASH1 PV-DASH2             24950000
249600            MOVE PV-CCYYMMDD-DATE TO PV-DB2-EXPDTE                24960000
249700            MOVE SPACES TO PV-CCYYMMDD-DATE                       24970000
249800         END-IF                                                   24980000
249900*        PERFORM 7210-SELECT-ORIGINAL-EFFDATE                     24990000
250000*        IF (PV-DB2-EFFDTE < PV-ORIGINAL-EFFDTE) AND              25000000
250100*           (PV-DB2-EFFDTE <= ASC-CURRENT-DATE)                   25010000
250200* ENTERED EFFECTIVE DATE <= ORIGINAL EFFECTIVE DATE & CURRENT     25020000
250300* DATE                                                            25030000
250400*           MOVE DP015-UNP-ALP-BRT-OFF TO                         25040000
250500*                  MR-EFFDTE-MMA   (PV-SUB)                       25050000
250600*                  MR-EFFDTE-DDA   (PV-SUB)                       25060000
250700*                  MR-EFFDTE-CCYYA (PV-SUB)                       25070000
250800*           MOVE DP015-RED TO                                     25080000
250900*                  MR-EFFDTE-MMC   (PV-SUB)                       25090000
251000*                  MR-EFFDTE-DDC   (PV-SUB)                       25100000
251100*                  MR-EFFDTE-CCYYC (PV-SUB)                       25110000
251200*           MOVE DP015-REVERSE TO                                 25120000
251300*                  MR-EFFDTE-MMH   (PV-SUB)                       25130000
251400*                  MR-EFFDTE-DDH   (PV-SUB)                       25140000
251500*                  MR-EFFDTE-CCYYH (PV-SUB)                       25150000
251600*           MOVE -1 TO MR-EFFDTE-MML   (PV-SUB)                   25160000
251700*           SET DP030-SET-CURSOR-APPL-1 TO TRUE                   25170000
251800*           IF PS-NO-ERROR                                        25180000
251900*              MOVE PC-TSYMSG-03144 TO DP020-MSG-NUMBER           25190000
252000*           END-IF                                                25200000
252100*           SET PS-ERROR            TO TRUE                       25210000
252200*           SET DP020-MSG-FATAL     TO TRUE                       25220000
252300*        END-IF                                                   25230000
252400*        IF (PV-DB2-EFFDTE >= PV-DB2-EXPDTE) AND                  25240000
252500         IF (PV-DB2-EFFDTE > PV-DB2-EXPDTE) AND                   25250000
252600            PS-VALID-DATE AND                                     25260000
252700            PS-NO-ERROR                                           25270000
252800* EFFECTIVE DATE MUST BE <= EXPIRATION DATE                       25280000
252900            MOVE DP015-UNP-ALP-BRT-OFF TO                         25290000
253000                   MR-EFFDTE-MMA   (PV-SUB)                       25300000
253100                   MR-EFFDTE-DDA   (PV-SUB)                       25310000
253200                   MR-EFFDTE-CCYYA (PV-SUB)                       25320000
253300                   MR-EXPDTE-MMA   (PV-SUB)                       25330000
253400                   MR-EXPDTE-DDA   (PV-SUB)                       25340000
253500                   MR-EXPDTE-CCYYA (PV-SUB)                       25350000
253600            MOVE DP015-RED TO                                     25360000
253700                   MR-EFFDTE-MMC   (PV-SUB)                       25370000
253800                   MR-EFFDTE-DDC   (PV-SUB)                       25380000
253900                   MR-EFFDTE-CCYYC (PV-SUB)                       25390000
254000                   MR-EXPDTE-MMC   (PV-SUB)                       25400000
254100                   MR-EXPDTE-DDC   (PV-SUB)                       25410000
254200                   MR-EXPDTE-CCYYC (PV-SUB)                       25420000
254300            MOVE DP015-REVERSE TO                                 25430000
254400                   MR-EFFDTE-MMH   (PV-SUB)                       25440000
254500                   MR-EFFDTE-DDH   (PV-SUB)                       25450000
254600                   MR-EFFDTE-CCYYH (PV-SUB)                       25460000
254700                   MR-EXPDTE-MMH   (PV-SUB)                       25470000
254800                   MR-EXPDTE-DDH   (PV-SUB)                       25480000
254900                   MR-EXPDTE-CCYYH (PV-SUB)                       25490000
255000            MOVE -1 TO MR-EFFDTE-MML   (PV-SUB)                   25500000
255100            SET DP030-SET-CURSOR-APPL-1 TO TRUE                   25510000
255200            IF PS-NO-ERROR                                        25520000
255300               MOVE PC-TSYMSG-03148 TO DP020-MSG-NUMBER           25530000
255400            END-IF                                                25540000
255500            SET PS-ERROR            TO TRUE                       25550000
255600            SET DP020-MSG-FATAL     TO TRUE                       25560000
255700         END-IF                                                   25570000
255800*        IF (MR-TRANCODEL (PV-SUB) > 0) AND                       25580000
255900*           ASC-TRANCODE-VALID AND                                25590000
256000*           PS-VALID-DATE                                         25600000
256100*           PERFORM 3470-CHECK-TRCD-CHNG-OVERLAP                  25610000
256200*        END-IF                                                   25620000
256300      END-IF.                                                     25630000
256400                                                                  25640000
256500******************************************************************25650000
256600* THIS PARAGRAPH PERFORMS THE EDITS TO THE VARIOUS PARTS OF THE  *25660000
256700* SELECTED LINE FOR VALIDITY WHILE IN ADD MODE.                  *25670000
256800******************************************************************25680000
256900 3340-EDIT-LINE-FOR-ADD.                                          25690000
257000                                                                  25700000
257100      PERFORM 3400-EDIT-TRANCODE.                                 25710000
257200                                                                  25720000
257300      PERFORM 3410-EDIT-PERCENT.                                  25730000
257400                                                                  25740000
257500      PERFORM 3415-EDIT-NET-RTV.                                  25750000
257600                                                                  25760000
257700      PERFORM 3416-EDIT-NET-DISC.                                 25770000
257800                                                                  25780000
257900      PERFORM 3420-EDIT-FREQ-CDE.                                 25790000
258000                                                                  25800000
258100      IF ASC-FREQ-IND-VALID (ASC-BLK-SUB ASC-ITEM-SUB)            25810000
258200         PERFORM 8000-GET-DEFAULT-EFF-DATE                        25820000
258300      ELSE                                                        25830000
258400         MOVE ASC-CURRENT-DATE  TO PV-DEFAULT-DATE                25840000
258500      END-IF.                                                     25850000
258600                                                                  25860000
258700      IF (MR-EFFDTE-MM    (PV-SUB) > 0 OR = -1) OR                25870000
258800         (MR-EFFDTE-DD    (PV-SUB) > 0 OR = -1) OR                25880000
258900         (MR-EFFDTE-CCYY  (PV-SUB) > 0 OR = -1)                   25890000
259000* EDIT THE EFFECTIVE DATE IF ANY PART OF THE SCREEN DATE WAS      25900000
259100* ENTERED OR CHANGED                                              25910000
259200         PERFORM 3430-EDIT-EFFECTIVE-DATE                         25920000
259300      ELSE                                                        25930000
259400         IF (ASC-EFFDTE-MM (ASC-BLK-SUB ASC-ITEM-SUB)             25940000
259500                                                   = ZERO)        25950000
259600        AND (ASC-EFFDTE-DD (ASC-BLK-SUB ASC-ITEM-SUB)             25960000
259700                                                   = ZERO)        25970000
259800        AND (ASC-EFFDTE-CCYY (ASC-BLK-SUB ASC-ITEM-SUB)           25980000
259900                                                   = ZERO)        25990000
260000* MOVE THE DEFAULT DATE TO THE W/S DATE FIELD, ASC EFFECTIVE DATE 26000000
260100* & SCREEN EFFECTIVE DATE AS THE DEFAULT DATE VALUE.              26010000
260200*           MOVE ASC-CURRENT-DATE TO PV-CCYYMMDD-DATE             26020000
260300            MOVE PV-DEFAULT-DATE  TO PV-CCYYMMDD-DATE             26030000
260400            MOVE PV-MM   TO                                       26040000
260500                       ASC-EFFDTE-MM   (ASC-BLK-SUB ASC-ITEM-SUB) 26050000
260600                       MR-EFFDTE-MM    (PV-SUB)                   26060000
260700            MOVE PV-DD   TO                                       26070000
260800                       ASC-EFFDTE-DD   (ASC-BLK-SUB ASC-ITEM-SUB) 26080000
260900                       MR-EFFDTE-DD    (PV-SUB)                   26090000
261000            MOVE PV-CCYY TO                                       26100000
261100                       ASC-EFFDTE-CCYY (ASC-BLK-SUB ASC-ITEM-SUB) 26110000
261200                       MR-EFFDTE-CCYY  (PV-SUB)                   26120000
261300            MOVE PV-CCYYMMDD-DATE TO PV-DB2-EFFDTE                26130000
261400            SET PS-VALID-DATE     TO TRUE                         26140000
261500            MOVE SPACES           TO PV-CCYYMMDD-DATE             26150000
261600         ELSE                                                     26160000
261700            IF (ASC-EFFDTE-MM (ASC-BLK-SUB ASC-ITEM-SUB)          26170000
261800                                                 > ZERO)          26180000
261900            AND (ASC-EFFDTE-DD (ASC-BLK-SUB ASC-ITEM-SUB)         26190000
262000                                                 > ZERO)          26200000
262100            AND (ASC-EFFDTE-CCYY (ASC-BLK-SUB ASC-ITEM-SUB)       26210000
262200                                                 > ZERO)          26220000
262300* EDIT THE EFFECTIVE DATE FOR SUBSEQUENT PASSES DUE TO MULTIPLE   26230000
262400* ERRORS DURING AN ADD.  THIS WILL KEEP THE PROGRAM FROM INSERTING26240000
262500* A ROW TO TVNDAGR WITH AN INVALID TRANCODE. WITH THIS ADDITIONAL 26250000
262600* CHECK, THE PS-VALID-DATE-SW CAN BE SET AND THUS ALLOW THE TRAN  26260000
262700* CODE AND EXPIRATION DATE TO BE RE-EDITTED FOR VALIDITY.         26270000
262800               PERFORM 3430-EDIT-EFFECTIVE-DATE                   26280000
262900            END-IF                                                26290000
263000         END-IF                                                   26300000
263100      END-IF.                                                     26310000
263200                                                                  26320000
263300     IF PS-VALID-DATE                                             26330000
263400        PERFORM 8500-MATCH-EFFDATE-TO-FREQ                        26340000
263500        IF ASC-FREQ-EFFDATE-NOT-MATCH (ASC-BLK-SUB ASC-ITEM-SUB)  26350000
263600* INVALID EFFECTIVE DATE FOR THE FREQUENCY                        26360000
263700           MOVE DP015-UNP-ALP-BRT-OFF                             26370000
263800                                   TO MR-FREQ-INDA    (PV-SUB)    26380000
263900                                      MR-EFFDTE-MMA   (PV-SUB)    26390000
264000                                      MR-EFFDTE-DDA   (PV-SUB)    26400000
264100                                      MR-EFFDTE-CCYYA (PV-SUB)    26410000
264200           MOVE DP015-REVERSE      TO MR-FREQ-INDH    (PV-SUB)    26420000
264300                                      MR-EFFDTE-MMH   (PV-SUB)    26430000
264400                                      MR-EFFDTE-DDH   (PV-SUB)    26440000
264500                                      MR-EFFDTE-CCYYH (PV-SUB)    26450000
264600           MOVE DP015-RED          TO MR-FREQ-INDC    (PV-SUB)    26460000
264700                                      MR-EFFDTE-MMC   (PV-SUB)    26470000
264800                                      MR-EFFDTE-DDC   (PV-SUB)    26480000
264900                                      MR-EFFDTE-CCYYC (PV-SUB)    26490000
265000           MOVE -1                 TO MR-EFFDTE-MML   (PV-SUB)    26500000
265100           SET DP030-SET-CURSOR-APPL-1 TO TRUE                    26510000
265200           IF PS-NO-ERROR                                         26520000
265300              MOVE PC-TSYMSG-03250 TO DP020-MSG-NUMBER            26530000
265400           END-IF                                                 26540000
265500           SET PS-ERROR            TO TRUE                        26550000
265600           SET DP020-MSG-FATAL     TO TRUE                        26560000
265700        END-IF                                                    26570000
265800     END-IF.                                                      26580000
265900                                                                  26590000
266000      IF PS-VALID-DATE                                            26600000
266100         PERFORM 3440-VALIDATE-TRANCODE                           26610000
266200*  INVALID TRANCODE FOR THIS OFF-INVOICE PROGRAM                  26620000
266300         IF ASC-TRANCODE-INVALID                                  26630000
266400            SET DP020-MSG-FATAL     TO TRUE                       26640000
266500            MOVE DP015-UNP-ALP-BRT-OFF                            26650000
266600                                    TO MR-TRANCODEA (PV-SUB)      26660000
266700            MOVE DP015-REVERSE      TO MR-TRANCODEH (PV-SUB)      26670000
266800            MOVE DP015-RED          TO MR-TRANCODEC (PV-SUB)      26680000
266900            MOVE -1                 TO MR-TRANCODEL (PV-SUB)      26690000
267000            SET DP030-SET-CURSOR-APPL-1 TO TRUE                   26700000
267100            IF PS-NO-ERROR                                        26710000
267200               MOVE PC-TSYMSG-03110 TO DP020-MSG-NUMBER           26720000
267300            END-IF                                                26730000
267400            SET PS-ERROR            TO TRUE                       26740000
267500         END-IF                                                   26750000
267600         IF MR-EXPDTE-MML   (PV-SUB) > 0 OR                       26760000
267700            MR-EXPDTE-DDL   (PV-SUB) > 0 OR                       26770000
267800            MR-EXPDTE-CCYYL (PV-SUB) > 0                          26780000
267900* EDIT THE EXPIRATION DATE IF ANY PART OF THE SCREEN EXPIRATION   26790000
268000* DATE WAS CHANGED                                                26800000
268100            PERFORM 3450-EDIT-EXPIRATION-DATE                     26810000
268200         ELSE                                                     26820000
268300            IF (ASC-EXPDTE-MM (ASC-BLK-SUB ASC-ITEM-SUB)          26830000
268400                                                      = ZERO)     26840000
268500           AND (ASC-EXPDTE-DD (ASC-BLK-SUB ASC-ITEM-SUB)          26850000
268600                                                      = ZERO)     26860000
268700           AND (ASC-EXPDTE-CCYY (ASC-BLK-SUB ASC-ITEM-SUB)        26870000
268800                                                      = ZERO)     26880000
268900* MOVE 9999-09-09 AS THE DEFAULT VALUE TO THE ASC EXPIRATION DATE 26890000
269000* AND SCREEN EXPIRATION DATE.                                     26900000
269100               MOVE '09'                                          26910000
269200                     TO ASC-EXPDTE-MM   (ASC-BLK-SUB ASC-ITEM-SUB)26920000
269300                        MR-EXPDTE-MM    (PV-SUB)                  26930000
269400               MOVE '09'                                          26940000
269500                     TO ASC-EXPDTE-DD   (ASC-BLK-SUB ASC-ITEM-SUB)26950000
269600                        MR-EXPDTE-DD    (PV-SUB)                  26960000
269700               MOVE '9999'                                        26970000
269800                     TO ASC-EXPDTE-CCYY (ASC-BLK-SUB ASC-ITEM-SUB)26980000
269900                        MR-EXPDTE-CCYY  (PV-SUB)                  26990000
270000               MOVE PV-CCYYMMDD-DATE TO PV-DB2-EXPDTE             27000000
270100               MOVE SPACES TO PV-CCYYMMDD-DATE                    27010000
270200            END-IF                                                27020000
270300         END-IF                                                   27030000
270400      END-IF.                                                     27040000
270500                                                                  27050000
270600******************************************************************27060000
270700* THIS PARAGRAPH PERFORMS THE EDITS TO THE TRANCODE ENTERED ON   *27070000
270800* THE SELECTED LINE FOR VALIDITY.                                *27080000
270900******************************************************************27090000
271000 3400-EDIT-TRANCODE.                                              27100000
271100                                                                  27110000
271200      IF ASC-TRANCODE (ASC-BLK-SUB ASC-ITEM-SUB) = SPACES         27120000
271300         SET DP020-MSG-FATAL     TO TRUE                          27130000
271400         MOVE DP015-UNP-ALP-BRT-OFF                               27140000
271500                                 TO MR-TRANCODEA (PV-SUB)         27150000
271600         MOVE DP015-REVERSE      TO MR-TRANCODEH (PV-SUB)         27160000
271700         MOVE DP015-RED          TO MR-TRANCODEC (PV-SUB)         27170000
271800         MOVE -1                 TO MR-TRANCODEL (PV-SUB)         27180000
271900         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      27190000
272000         IF PS-NO-ERROR                                           27200000
272100            MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER              27210000
272200         END-IF                                                   27220000
272300         SET PS-ERROR            TO TRUE                          27230000
272400      ELSE                                                        27240000
272500         MOVE ASC-TRANCODE (ASC-BLK-SUB ASC-ITEM-SUB) TO          27250000
272600                                             PV-TRANCODE          27260000
272700      END-IF.                                                     27270000
272800                                                                  27280000
272900******************************************************************27290000
273000* THIS PARAGRAPH PERFORMS THE EDITS TO THE PERCENT ENTERED ON THE*27300000
273100* SELECTED LINE FOR VALIDITY.                                    *27310000
273200******************************************************************27320000
273300 3410-EDIT-PERCENT.                                               27330000
273400                                                                  27340000
273500     MOVE ASC-PERCENT-UNFMT (ASC-BLK-SUB ASC-ITEM-SUB)            27350000
273600                                       TO PV-PERCENT.             27360000
273700     IF PV-PERCENT > SPACE                                        27370000
273800        MOVE PV-PERCENT            TO DP010I-UNEDITED-FIELD       27380000
273900        MOVE 2                     TO DP010I-MAXIMUM-DIGITS       27390000
274000        MOVE 2                     TO DP010I-MAXIMUM-DECIMALS     27400000
274100        SET DP010I-NEGATIVE-NOT-ALLOWED                           27410000
274200                                   TO TRUE                        27420000
274310        CALL DP010I-NUMERIC-EDIT-ROUTINE                          27431002
274320                         USING DP010I-NUMERIC-EDIT-AREA           27432002
274330                                                                  27433002
274400                                                                  27440000
274500        IF DP010I-ERROR-DETECTED                                  27450000
274600           SET DP020-MSG-FATAL        TO TRUE                     27460000
274700           MOVE DP015-UNP-ALP-BRT-OFF TO MR-PERCENTA (PV-SUB)     27470000
274800           MOVE DP015-RED             TO MR-PERCENTC (PV-SUB)     27480000
274900           MOVE DP015-REVERSE         TO MR-PERCENTH (PV-SUB)     27490000
275000           MOVE -1                    TO MR-PERCENTL (PV-SUB)     27500000
275100           SET DP030-SET-CURSOR-APPL-1 TO TRUE                    27510000
275200           IF PS-NO-ERROR                                         27520000
275300              IF DP010I-INVALID-CHARACTER                         27530000
275400                 MOVE PC-TSYMSG-00008    TO DP020-MSG-NUMBER      27540000
275500              ELSE                                                27550000
275600                 MOVE PC-TSYMSG-03143    TO DP020-MSG-NUMBER      27560000
275700              END-IF                                              27570000
275800           END-IF                                                 27580000
275900           SET PS-ERROR               TO TRUE                     27590000
276000           MOVE 'Y' TO ASC-PERCENT-ERR-FLAG                       27600000
276100                                    (ASC-BLK-SUB, ASC-ITEM-SUB)   27610000
276200        ELSE                                                      27620000
276300           MOVE DP010I-NUMERIC-FIELD  TO ASC-PERCENT              27630000
276400                               (ASC-BLK-SUB, ASC-ITEM-SUB)        27640000
276500           MOVE ASC-PERCENT (ASC-BLK-SUB, ASC-ITEM-SUB) TO        27650000
276600                              MR-PERCENT-FMT (PV-SUB)             27660000
276700           MOVE MR-PERCENT-FMT (PV-SUB) TO                        27670000
276800                ASC-PERCENT-UNFMT (ASC-BLK-SUB, ASC-ITEM-SUB)     27680000
276900        END-IF                                                    27690000
277000     END-IF.                                                      27700000
277100                                                                  27710000
277200     IF ASC-PERCENT (ASC-BLK-SUB ASC-ITEM-SUB) EQUAL ZERO         27720000
277300        SET DP020-MSG-FATAL         TO TRUE                       27730000
277400        MOVE DP015-UNP-ALP-BRT-OFF  TO MR-PERCENTA (PV-SUB)       27740000
277500        MOVE DP015-RED              TO MR-PERCENTC (PV-SUB)       27750000
277600        MOVE DP015-REVERSE          TO MR-PERCENTH (PV-SUB)       27760000
277700        MOVE -1                     TO MR-PERCENTL (PV-SUB)       27770000
277800        SET DP030-SET-CURSOR-APPL-1 TO TRUE                       27780000
277900        IF PS-NO-ERROR                                            27790000
278000           MOVE PC-TSYMSG-03116     TO DP020-MSG-NUMBER           27800000
278100        END-IF                                                    27810000
278200        SET PS-ERROR                TO TRUE                       27820000
278300     END-IF.                                                      27830000
278400                                                                  27840000
278500******************************************************************27850000
278600* THIS PARAGRAPH PERFORMS THE EDITS TO THE NET RTV INDICATOR     *27860000
278700* ENTERED ON THE SELECTED LINE FOR VALIDITY.                     *27870000
278800******************************************************************27880000
278900 3415-EDIT-NET-RTV.                                               27890000
279000                                                                  27900000
279100      IF ASC-NET-RTV (ASC-BLK-SUB ASC-ITEM-SUB) = 'Y' OR 'N'      27910000
279200         NEXT SENTENCE                                            27920000
279300      ELSE                                                        27930000
279400*  NET RTV INDICATOR MUST BE 'Y' OR 'N'                           27940000
279500         SET DP020-MSG-FATAL     TO TRUE                          27950000
279600         MOVE DP015-UNP-ALP-BRT-OFF                               27960000
279700                                 TO MR-NET-RTVA (PV-SUB)          27970000
279800         MOVE DP015-REVERSE      TO MR-NET-RTVH (PV-SUB)          27980000
279900         MOVE DP015-RED          TO MR-NET-RTVC (PV-SUB)          27990000
280000         MOVE -1                 TO MR-NET-RTVL (PV-SUB)          28000000
280100         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      28010000
280200         IF PS-NO-ERROR                                           28020000
280300            MOVE PC-TSYMSG-03123 TO DP020-MSG-NUMBER              28030000
280400         END-IF                                                   28040000
280500         SET PS-ERROR            TO TRUE                          28050000
280600      END-IF.                                                     28060000
280700                                                                  28070000
280800******************************************************************28080000
280900* THIS PARAGRAPH PERFORMS THE EDITS TO THE NET DISC INDICATOR    *28090000
281000* ENTERED ON THE SELECTED LINE FOR VALIDITY.                     *28100000
281100******************************************************************28110000
281200 3416-EDIT-NET-DISC.                                              28120000
281300                                                                  28130000
281400      IF ASC-NET-DISC (ASC-BLK-SUB ASC-ITEM-SUB) = 'Y' OR 'N'     28140000
281500         NEXT SENTENCE                                            28150000
281600      ELSE                                                        28160000
281700*  NET DISC INDICATOR MUST BE 'Y' OR 'N'                          28170000
281800         SET DP020-MSG-FATAL     TO TRUE                          28180000
281900         MOVE DP015-UNP-ALP-BRT-OFF                               28190000
282000                                 TO MR-NET-DISCA (PV-SUB)         28200000
282100         MOVE DP015-REVERSE      TO MR-NET-DISCH (PV-SUB)         28210000
282200         MOVE DP015-RED          TO MR-NET-DISCC (PV-SUB)         28220000
282300         MOVE -1                 TO MR-NET-DISCL (PV-SUB)         28230000
282400         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      28240000
282500         IF PS-NO-ERROR                                           28250000
282600            MOVE PC-TSYMSG-03124 TO DP020-MSG-NUMBER              28260000
282700         END-IF                                                   28270000
282800         SET PS-ERROR            TO TRUE                          28280000
282900      END-IF.                                                     28290000
283000                                                                  28300000
283100******************************************************************28310000
283200* THIS PARAGRAPH PERFORMS THE EDITS TO THE FREQUENCY CODE ENTERED*28320000
283300* ON THE SELECTED LINE FOR VALIDITY.                             *28330000
283400******************************************************************28340000
283500 3420-EDIT-FREQ-CDE.                                              28350000
283600                                                                  28360000
283700      IF ASC-FREQ-IND (ASC-BLK-SUB ASC-ITEM-SUB) = 'FM' OR        28370000
283800                           'FQ' OR 'CQ' OR 'FS' OR 'CS' OR        28380000
283900                           'FA' OR 'CA' OR 'RO'                   28390000
284000*        NEXT SENTENCE                                            28400000
284100         SET ASC-FREQ-IND-VALID (ASC-BLK-SUB ASC-ITEM-SUB)        28410000
284200                                 TO TRUE                          28420000
284300      ELSE                                                        28430000
284400* POSTING FREQ CD MUST BE 'FM','FQ','CQ','FS','CS','FA','CA','RO' 28440000
284500         SET ASC-FREQ-IND-NOT-VALID (ASC-BLK-SUB ASC-ITEM-SUB)    28450000
284600                                 TO TRUE                          28460000
284700         SET DP020-MSG-FATAL     TO TRUE                          28470000
284800         MOVE DP015-UNP-ALP-BRT-OFF                               28480000
284900                                 TO MR-FREQ-INDA (PV-SUB)         28490000
285000         MOVE DP015-REVERSE      TO MR-FREQ-INDH (PV-SUB)         28500000
285100         MOVE DP015-RED          TO MR-FREQ-INDC (PV-SUB)         28510000
285200         MOVE -1                 TO MR-FREQ-INDL (PV-SUB)         28520000
285300         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      28530000
285400         IF PS-NO-ERROR                                           28540000
285500            MOVE PC-TSYMSG-03117 TO DP020-MSG-NUMBER              28550000
285600         END-IF                                                   28560000
285700         SET PS-ERROR            TO TRUE                          28570000
285800      END-IF.                                                     28580000
285900                                                                  28590000
286000******************************************************************28600000
286100* THIS PARAGRAPH WILL PERFORM EDITS ON THE ENTERED EFFECTIVE DATE*28610000
286200******************************************************************28620000
286300 3430-EDIT-EFFECTIVE-DATE.                                        28630000
286400                                                                  28640000
286500     MOVE SPACES TO PV-CCYYMMDD-DATE.                             28650000
286600                                                                  28660000
286700     IF MR-EFFDTE-MM   (PV-SUB) = SPACE AND                       28670000
286800        MR-EFFDTE-DD   (PV-SUB) = SPACE AND                       28680000
286900        MR-EFFDTE-CCYY (PV-SUB) = SPACE                           28690000
287000* MOVE THE DEFAULT DATE TO ASC & SCREEN EFFECTIVE DATE IF SPACE IS28700000
287100* FOUND IN ALL OF THE SCREEN EFFECTIVE DATE FIELDS                28710000
287200*       MOVE ASC-CURRENT-DATE TO PV-CCYYMMDD-DATE                 28720000
287300        MOVE PV-DEFAULT-DATE  TO PV-CCYYMMDD-DATE                 28730000
287400        MOVE PV-MM  TO ASC-EFFDTE-MM    (ASC-BLK-SUB ASC-ITEM-SUB)28740000
287500                       MR-EFFDTE-MM     (PV-SUB)                  28750000
287600        MOVE PV-DD  TO ASC-EFFDTE-DD    (ASC-BLK-SUB ASC-ITEM-SUB)28760000
287700                       MR-EFFDTE-DD     (PV-SUB)                  28770000
287800        MOVE PV-CCYY TO ASC-EFFDTE-CCYY (ASC-BLK-SUB ASC-ITEM-SUB)28780000
287900                       MR-EFFDTE-CCYY   (PV-SUB)                  28790000
288000        MOVE PV-CCYYMMDD-DATE TO PV-DB2-EFFDTE                    28800000
288100        SET PS-VALID-DATE TO TRUE                                 28810000
288200     ELSE                                                         28820000
288300* MOVE THE DEFAULT DATE TO ASC & SCREEN EFFECTIVE DATE IF ANY PART28830000
288400* OF THE SCREEN EFFECTIVE DATE IS MISSING                         28840000
288500        IF MR-EFFDTE-MML (PV-SUB)    = -1 OR                      28850000
288600           MR-EFFDTE-DDL (PV-SUB)    = -1 OR                      28860000
288700           MR-EFFDTE-CCYYL (PV-SUB)  = -1                         28870000
288800*          MOVE ASC-CURRENT-DATE TO PV-CCYYMMDD-DATE              28880000
288900           MOVE PV-DEFAULT-DATE  TO PV-CCYYMMDD-DATE              28890000
289000           MOVE PV-MM   TO                                        28900000
289100                    ASC-EFFDTE-MM   (ASC-BLK-SUB ASC-ITEM-SUB)    28910000
289200                    MR-EFFDTE-MM    (PV-SUB)                      28920000
289300           MOVE PV-DD   TO                                        28930000
289400                    ASC-EFFDTE-DD   (ASC-BLK-SUB ASC-ITEM-SUB)    28940000
289500                    MR-EFFDTE-DD    (PV-SUB)                      28950000
289600           MOVE PV-CCYY TO                                        28960000
289700                    ASC-EFFDTE-CCYY (ASC-BLK-SUB ASC-ITEM-SUB)    28970000
289800                    MR-EFFDTE-CCYY  (PV-SUB)                      28980000
289900           MOVE PV-CCYYMMDD-DATE TO PV-DB2-EFFDTE                 28990000
290000        ELSE                                                      29000000
290100* MOVE ASC EFFECTIVE DATE TO PV-CCYYMMDD-DATE                     29010000
290200           MOVE ASC-EFFDTE-MM   (ASC-BLK-SUB ASC-ITEM-SUB)        29020000
290300                                TO PV-MM                          29030000
290400           MOVE ASC-EFFDTE-DD   (ASC-BLK-SUB ASC-ITEM-SUB)        29040000
290500                                TO PV-DD                          29050000
290600           MOVE ASC-EFFDTE-CCYY (ASC-BLK-SUB ASC-ITEM-SUB)        29060000
290700                                TO PV-CCYY                        29070000
290800           MOVE '-'             TO PV-DASH1 PV-DASH2              29080000
290900           PERFORM 3460-EDIT-DATE                                 29090000
291000           IF PS-VALID-DATE                                       29100000
291100* MOVE PV-CCYYMMDD-DATE TO ASC EFFECT DATE                        29110000
291200              MOVE PV-MM   TO                                     29120000
291300                   ASC-EFFDTE-MM   (ASC-BLK-SUB ASC-ITEM-SUB)     29130000
291400              MOVE PV-DD   TO                                     29140000
291500                   ASC-EFFDTE-DD   (ASC-BLK-SUB ASC-ITEM-SUB)     29150000
291600              MOVE PV-CCYY TO                                     29160000
291700                   ASC-EFFDTE-CCYY (ASC-BLK-SUB ASC-ITEM-SUB)     29170000
291800              MOVE PV-CCYYMMDD-DATE TO PV-DB2-EFFDTE              29180000
291900           ELSE                                                   29190000
292000* INVALID DATE                                                    29200000
292100              MOVE DP015-UNP-ALP-BRT-OFF TO                       29210000
292200                     MR-EFFDTE-MMA   (PV-SUB)                     29220000
292300                     MR-EFFDTE-DDA   (PV-SUB)                     29230000
292400                     MR-EFFDTE-CCYYA (PV-SUB)                     29240000
292500              MOVE DP015-RED TO                                   29250000
292600                     MR-EFFDTE-MMC   (PV-SUB)                     29260000
292700                     MR-EFFDTE-DDC   (PV-SUB)                     29270000
292800                     MR-EFFDTE-CCYYC (PV-SUB)                     29280000
292900              MOVE DP015-REVERSE TO                               29290000
293000                     MR-EFFDTE-MMH   (PV-SUB)                     29300000
293100                     MR-EFFDTE-DDH   (PV-SUB)                     29310000
293200                     MR-EFFDTE-CCYYH (PV-SUB)                     29320000
293300              MOVE -1 TO MR-EFFDTE-MML   (PV-SUB)                 29330000
293400              SET DP030-SET-CURSOR-APPL-1 TO TRUE                 29340000
293500              IF PS-NO-ERROR                                      29350000
293600                 MOVE PC-TSYMSG-00009 TO DP020-MSG-NUMBER         29360000
293700              END-IF                                              29370000
293800              SET PS-ERROR                                        29380000
293900                  DP020-MSG-FATAL     TO TRUE                     29390000
294000           END-IF                                                 29400000
294100        END-IF                                                    29410000
294200     END-IF.                                                      29420000
294300                                                                  29430000
294400*    IF PS-VALID-DATE                                             29440000
294500*       PERFORM 8500-MATCH-EFFDATE-TO-FREQ                        29450000
294600*       IF ASC-FREQ-EFFDATE-NOT-MATCH (ASC-BLK-SUB ASC-ITEM-SUB)  29460000
294700* INVALID EFFECTIVE DATE FOR THE FREQUENCY                        29470000
294800*          MOVE DP015-UNP-ALP-BRT-OFF                             29480000
294900*                                  TO MR-FREQ-INDA    (PV-SUB)    29490000
295000*                                     MR-EFFDTE-MMA   (PV-SUB)    29500000
295100*                                     MR-EFFDTE-DDA   (PV-SUB)    29510000
295200*                                     MR-EFFDTE-CCYYA (PV-SUB)    29520000
295300*          MOVE DP015-REVERSE      TO MR-FREQ-INDH    (PV-SUB)    29530000
295400*                                     MR-EFFDTE-MMH   (PV-SUB)    29540000
295500*                                     MR-EFFDTE-DDH   (PV-SUB)    29550000
295600*                                     MR-EFFDTE-CCYYH (PV-SUB)    29560000
295700*          MOVE DP015-RED          TO MR-FREQ-INDC    (PV-SUB)    29570000
295800*                                     MR-EFFDTE-MMC   (PV-SUB)    29580000
295900*                                     MR-EFFDTE-DDC   (PV-SUB)    29590000
296000*                                     MR-EFFDTE-CCYYC (PV-SUB)    29600000
296100*          MOVE -1                 TO MR-EFFDTE-MML   (PV-SUB)    29610000
296200*          SET DP030-SET-CURSOR-APPL-1 TO TRUE                    29620000
296300*          IF PS-NO-ERROR                                         29630000
296400*             MOVE PC-TSYMSG-03250 TO DP020-MSG-NUMBER            29640000
296500*          END-IF                                                 29650000
296600*          SET PS-ERROR            TO TRUE                        29660000
296700*          SET DP020-MSG-FATAL     TO TRUE                        29670000
296800*       END-IF                                                    29680000
296900*    END-IF.                                                      29690000
297000                                                                  29700000
297100     MOVE SPACES           TO PV-CCYYMMDD-DATE.                   29710000
297200                                                                  29720000
297300*----------------------------------------------------------------*29730000
297400* PERFORM VALIDATE OF TRANCODE                                   *29740000
297500*----------------------------------------------------------------*29750000
297600 3440-VALIDATE-TRANCODE.                                          29760000
297700                                                                  29770000
297800     SET ASC-TRANCODE-VALID        TO TRUE.                       29780000
297900*    SET ASC-TRANCODE-INVALID        TO TRUE.                     29790000
298000                                                                  29800000
298100     EXEC SQL                                                     29810000
298200       SELECT '1'                                                 29820000
298300         INTO :PV-ONE                                             29830000
298400         FROM SYSIBM.SYSDUMMY1 X                                  29840000
298500        WHERE EXISTS (SELECT 1                                    29850000
298600         FROM  TTRNCDE B                                          29860000
298700      WHERE B.AP_TRN_CDE   = :PV-TRANCODE                         29870000
298800        AND B.BTCH_SRC_CDE = 'VDA'                                29880000
298900        AND ((:PV-DB2-EFFDTE BETWEEN B.EFF_STRT_DTE               29890000
299000                               AND B.EFF_END_DTE)                 29900000
299100            OR (B.EFF_STRT_DTE >= :PV-DB2-EFFDTE))                29910000
299200        AND X.IBMREQD = X.IBMREQD)                                29920000
299300     END-EXEC.                                                    29930000
299400                                                                  29940000
299500     EVALUATE TRUE                                                29950000
299600         WHEN SQLCODE = +0                                        29960000
299700         WHEN SQLCODE = -811                                      29970000
299800             SET ASC-TRANCODE-VALID        TO TRUE                29980000
299900                                                                  29990000
300000         WHEN SQLCODE = +100                                      30000000
300100             SET ASC-TRANCODE-INVALID      TO TRUE                30010000
300200                                                                  30020000
300300         WHEN SQLCODE = -904                                      30030000
300400         WHEN SQLCODE = -913                                      30040000
300500             CONTINUE                                             30050000
300600         WHEN SQLWARN0 NOT = SPACES                               30060000
300700         WHEN SQLCODE < ZERO                                      30070000
300800         WHEN SQLCODE > ZERO                                      30080000
300900             MOVE '3440-VAIDATE-TRANCODE'                         30090000
301000                               TO DP013-PARAGRAPH                 30100000
301100             MOVE 'SELECT ON TVNDAGR        '                     30110000
301200                               TO DP013-MESSAGE-TEXT (1)          30120000
301300             MOVE SQLCA        TO DP013-SQLCA                     30130000
301400             MOVE 'TVNDAGR'    TO DP013-DB2-TABLE-NAME (1)        30140000
301500             MOVE '       '    TO DP013-DB2-TABLE-NAME (2)        30150000
301600             SET DP013-DB2-ABEND                                  30160000
301700                 DP013-XCTL-DISPLAY-RESTART                       30170000
301800                               TO TRUE                            30180000
301900             PERFORM DP013-0000-PROCESS-ABEND                     30190000
302000         END-EVALUATE.                                            30200000
302100                                                                  30210000
302200******************************************************************30220000
302300* THIS PARAGRAPH WILL PERFORM EDITS ON THE ENTERED EXPIRATION    *30230000
302400* DATE.                                                          *30240000
302500******************************************************************30250000
302600 3450-EDIT-EXPIRATION-DATE.                                       30260000
302700                                                                  30270000
302800     MOVE SPACES TO PV-CCYYMMDD-DATE.                             30280000
302900                                                                  30290000
303000     IF MR-EXPDTE-MM   (PV-SUB) = SPACE AND                       30300000
303100        MR-EXPDTE-DD   (PV-SUB) = SPACE AND                       30310000
303200        MR-EXPDTE-CCYY (PV-SUB) = SPACE                           30320000
303300* MOVE THE 9999-09-09 DATE TO ASC & SCREEN EXPIRATION DATE IF     30330000
303400* SPACE IS FOUND IN THE SCREEN EXPIRATION DATE FIELDS             30340000
303500        MOVE '09'   TO ASC-EXPDTE-MM    (ASC-BLK-SUB ASC-ITEM-SUB)30350000
303600                       MR-EXPDTE-MM     (PV-SUB)                  30360000
303700        MOVE '09'   TO ASC-EXPDTE-DD    (ASC-BLK-SUB ASC-ITEM-SUB)30370000
303800                       MR-EXPDTE-DD     (PV-SUB)                  30380000
303900        MOVE '9999' TO ASC-EXPDTE-CCYY  (ASC-BLK-SUB ASC-ITEM-SUB)30390000
304000                       MR-EXPDTE-CCYY   (PV-SUB)                  30400000
304100        MOVE '9999-09-09' TO PV-DB2-EXPDTE                        30410000
304200     ELSE                                                         30420000
304300        IF MR-EXPDTE-MML (PV-SUB)    = -1 OR                      30430000
304400           MR-EXPDTE-DDL (PV-SUB)    = -1 OR                      30440000
304500           MR-EXPDTE-CCYYL (PV-SUB)  = -1                         30450000
304600* MOVE THE 9999-09-09 DATE TO ASC & SCREEN EXPIRATION DATE IF ANY 30460000
304700* PART OF THE SCREEN EFFECTIVE DATE IS MISSING                    30470000
304800           MOVE '09'    TO                                        30480000
304900                   ASC-EXPDTE-MM   (ASC-BLK-SUB ASC-ITEM-SUB)     30490000
305000                   MR-EXPDTE-MM    (PV-SUB)                       30500000
305100           MOVE '09'    TO                                        30510000
305200                   ASC-EXPDTE-DD   (ASC-BLK-SUB ASC-ITEM-SUB)     30520000
305300                   MR-EXPDTE-DD    (PV-SUB)                       30530000
305400           MOVE '9999'  TO                                        30540000
305500                   ASC-EXPDTE-CCYY (ASC-BLK-SUB ASC-ITEM-SUB)     30550000
305600                   MR-EXPDTE-CCYY  (PV-SUB)                       30560000
305700            MOVE '9999-09-09' TO PV-DB2-EXPDTE                    30570000
305800        ELSE                                                      30580000
305900* MOVE ASC EXPIRE DATE TO PV-CCYYMMDD-DATE                        30590000
306000           MOVE ASC-EXPDTE-MM   (ASC-BLK-SUB ASC-ITEM-SUB)        30600000
306100                                TO PV-MM                          30610000
306200           MOVE ASC-EXPDTE-DD   (ASC-BLK-SUB ASC-ITEM-SUB)        30620000
306300                                TO PV-DD                          30630000
306400           MOVE ASC-EXPDTE-CCYY (ASC-BLK-SUB ASC-ITEM-SUB)        30640000
306500                                TO PV-CCYY                        30650000
306600           MOVE '-'             TO PV-DASH1 PV-DASH2              30660000
306700           IF PV-CCYYMMDD-DATE = '9999-09-09'                     30670000
306800              SET PS-VALID-DATE TO TRUE                           30680000
306900              MOVE '9999-09-09' TO PV-DB2-EXPDTE                  30690000
307000           ELSE                                                   30700000
307100              PERFORM 3460-EDIT-DATE                              30710000
307200           END-IF                                                 30720000
307300           IF PS-VALID-DATE                                       30730000
307400*             IF PV-CCYYMMDD-DATE <= PV-DB2-EFFDTE                30740000
307500              IF PV-CCYYMMDD-DATE < PV-DB2-EFFDTE                 30750000
307600* EXPIRATION DATE MUST BE >= THE EFFECTIVE DATE                   30760000
307700                 MOVE DP015-UNP-ALP-BRT-OFF TO                    30770000
307800                        MR-EXPDTE-MMA   (PV-SUB)                  30780000
307900                        MR-EXPDTE-DDA   (PV-SUB)                  30790000
308000                        MR-EXPDTE-CCYYA (PV-SUB)                  30800000
308100                 MOVE DP015-RED      TO                           30810000
308200                        MR-EXPDTE-MMC   (PV-SUB)                  30820000
308300                        MR-EXPDTE-DDC   (PV-SUB)                  30830000
308400                        MR-EXPDTE-CCYYC (PV-SUB)                  30840000
308500                 MOVE DP015-REVERSE  TO                           30850000
308600                        MR-EXPDTE-MMH   (PV-SUB)                  30860000
308700                        MR-EXPDTE-DDH   (PV-SUB)                  30870000
308800                        MR-EXPDTE-CCYYH (PV-SUB)                  30880000
308900                 MOVE -1             TO MR-EXPDTE-MML (PV-SUB)    30890000
309000                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              30900000
309100                 IF PS-NO-ERROR                                   30910000
309200                    MOVE PC-TSYMSG-03132                          30920000
309300                                     TO DP020-MSG-NUMBER          30930000
309400                 END-IF                                           30940000
309500                 SET PS-ERROR                                     30950000
309600                     DP020-MSG-FATAL TO TRUE                      30960000
309700              ELSE                                                30970000
309800* MOVE PV-CCYYMMDD-DATE TO ASC EXPIRE DATE                        30980000
309900                 MOVE PV-MM   TO                                  30990000
310000                        ASC-EXPDTE-MM   (ASC-BLK-SUB ASC-ITEM-SUB)31000000
310100                 MOVE PV-DD   TO                                  31010000
310200                        ASC-EXPDTE-DD   (ASC-BLK-SUB ASC-ITEM-SUB)31020000
310300                 MOVE PV-CCYY TO                                  31030000
310400                        ASC-EXPDTE-CCYY (ASC-BLK-SUB ASC-ITEM-SUB)31040000
310500                 MOVE PV-CCYYMMDD-DATE TO PV-DB2-EXPDTE           31050000
310600              END-IF                                              31060000
310700           ELSE                                                   31070000
310800* INVALID DATE                                                    31080000
310900              MOVE DP015-UNP-ALP-BRT-OFF TO                       31090000
311000                     MR-EXPDTE-MMA   (PV-SUB)                     31100000
311100                     MR-EXPDTE-DDA   (PV-SUB)                     31110000
311200                     MR-EXPDTE-CCYYA (PV-SUB)                     31120000
311300              MOVE DP015-RED TO                                   31130000
311400                     MR-EXPDTE-MMC   (PV-SUB)                     31140000
311500                     MR-EXPDTE-DDC   (PV-SUB)                     31150000
311600                     MR-EXPDTE-CCYYC (PV-SUB)                     31160000
311700              MOVE DP015-REVERSE TO                               31170000
311800                     MR-EXPDTE-MMH   (PV-SUB)                     31180000
311900                     MR-EXPDTE-DDH   (PV-SUB)                     31190000
312000                     MR-EXPDTE-CCYYH (PV-SUB)                     31200000
312100              MOVE -1 TO MR-EXPDTE-MML   (PV-SUB)                 31210000
312200              SET DP030-SET-CURSOR-APPL-1 TO TRUE                 31220000
312300              IF PS-NO-ERROR                                      31230000
312400                 MOVE PC-TSYMSG-00009 TO DP020-MSG-NUMBER         31240000
312500              END-IF                                              31250000
312600              SET PS-ERROR                                        31260000
312700                  DP020-MSG-FATAL     TO TRUE                     31270000
312800           END-IF                                                 31280000
312900        END-IF                                                    31290000
313000     END-IF.                                                      31300000
313100                                                                  31310000
313200     MOVE SPACES           TO PV-CCYYMMDD-DATE.                   31320000
313300                                                                  31330000
313400*----------------------------------------------------------------*31340000
313500* PERFORM VALIDATE OF TRANCODE                                   *31350000
313600*----------------------------------------------------------------*31360000
313700                                                                  31370000
313800******************************************************************31380000
313900* THIS PARAGRAPH PERFORMS COMMON DATE EDITS.                     *31390000
314000******************************************************************31400000
314100 3460-EDIT-DATE.                                                  31410000
314200                                                                  31420000
314300     IF PV-MM NUMERIC                                             31430000
314400     OR PV-MM = SPACE                                             31440000
314500         CONTINUE                                                 31450000
314600     ELSE                                                         31460000
314700         MOVE PV-MM                  TO DP010I-UNEDITED-FIELD     31470000
314800         MOVE 2                      TO DP010I-MAXIMUM-DIGITS     31480000
314900         MOVE 0                      TO DP010I-MAXIMUM-DECIMALS   31490000
315000         SET DP010I-NEGATIVE-NOT-ALLOWED                          31500000
315100                                     TO TRUE                      31510000
315210         CALL DP010I-NUMERIC-EDIT-ROUTINE                         31521002
315220                         USING DP010I-NUMERIC-EDIT-AREA           31522002
315230                                                                  31523002
315300         IF DP010I-ERROR-DETECTED                                 31530000
315400             CONTINUE                                             31540000
315500         ELSE                                                     31550000
315600             MOVE DP010I-NUMERIC-FIELD                            31560000
315700                                     TO PV-MM-9                   31570000
315800         END-IF                                                   31580000
315900     END-IF.                                                      31590000
316000                                                                  31600000
316100     IF PV-DD NUMERIC                                             31610000
316200     OR PV-DD = SPACE                                             31620000
316300         CONTINUE                                                 31630000
316400     ELSE                                                         31640000
316500         MOVE PV-DD                  TO DP010I-UNEDITED-FIELD     31650000
316600         MOVE 2                      TO DP010I-MAXIMUM-DIGITS     31660000
316700         MOVE 0                      TO DP010I-MAXIMUM-DECIMALS   31670000
316800         SET DP010I-NEGATIVE-NOT-ALLOWED                          31680000
316900                                     TO TRUE                      31690000
317010         CALL DP010I-NUMERIC-EDIT-ROUTINE                         31701002
317020                         USING DP010I-NUMERIC-EDIT-AREA           31702002
317030                                                                  31703002
317100         IF DP010I-ERROR-DETECTED                                 31710000
317200             CONTINUE                                             31720000
317300         ELSE                                                     31730000
317400             MOVE DP010I-NUMERIC-FIELD                            31740000
317500                                     TO PV-DD-9                   31750000
317600         END-IF                                                   31760000
317700     END-IF.                                                      31770000
317800                                                                  31780000
317900     IF PV-CCYY = SPACE                                           31790000
318000         CONTINUE                                                 31800000
318100     ELSE                                                         31810000
318200         IF PV-CCYY NUMERIC                                       31820000
318300             IF PV-YY < 80                                        31830000
318400                 MOVE 20             TO PV-CC                     31840000
318500             ELSE                                                 31850000
318600                 MOVE 19             TO PV-CC                     31860000
318700             END-IF                                               31870000
318800         ELSE                                                     31880000
318900             MOVE PV-CCYY            TO DP010I-UNEDITED-FIELD     31890000
319000             MOVE 4                  TO DP010I-MAXIMUM-DIGITS     31900000
319100             MOVE 0                  TO DP010I-MAXIMUM-DECIMALS   31910000
319200             SET DP010I-NEGATIVE-NOT-ALLOWED                      31920000
319300                                         TO TRUE                  31930000
319410             CALL DP010I-NUMERIC-EDIT-ROUTINE                     31941002
319420                         USING DP010I-NUMERIC-EDIT-AREA           31942002
319430                                                                  31943002
319500             IF DP010I-ERROR-DETECTED                             31950000
319600                 CONTINUE                                         31960000
319700             ELSE                                                 31970000
319800                 MOVE DP010I-NUMERIC-FIELD                        31980000
319900                                         TO PV-CCYY-9             31990000
320000*         ALLOW THEM TO ENTER A TWO DIGIT YEAR W/OUT CENT         32000000
320100                 IF PV-YY < 80                                    32010000
320200                     MOVE 20             TO PV-CC                 32020000
320300                 ELSE                                             32030000
320400                     IF PV-CCYY-9 > 1999                          32040000
320500                         CONTINUE                                 32050000
320600                     ELSE                                         32060000
320700                         MOVE 19         TO PV-CC                 32070000
320800                     END-IF                                       32080000
320900                 END-IF                                           32090000
321000             END-IF                                               32100000
321100         END-IF                                                   32110000
321200     END-IF.                                                      32120000
321300                                                                  32130000
321400     SET PS-VALID-DATE TO TRUE.                                   32140000
321500                                                                  32150000
321600     INITIALIZE DPG51                                             32160000
321700                DPG52                                             32170000
321800                DPG53                                             32180000
321900                DPG54                                             32190000
322000                DPG55                                             32200000
322100                DPG56.                                            32210000
322200                                                                  32220000
322300     SET DPG51-FISCAL-454-CALENDAR TO TRUE.                       32230000
322400                                                                  32240000
322500     SET DPG51-DO-NOT-INCR-DECR-DATE                              32250000
322600         DPG52-LK-DTE-ISO-FMT  TO TRUE.                           32260000
322700                                                                  32270000
322800     IF PV-CCYY NUMERIC AND                                       32280000
322900        PV-MM NUMERIC AND                                         32290000
323000        PV-DD NUMERIC                                             32300000
323100         MOVE '-'  TO PV-DASH1                                    32310000
323200                          PV-DASH2                                32320000
323300         MOVE PV-CCYYMMDD-DATE TO DPG52-LK-DATE-INPUT             32330000
323400                                                                  32340000
323500         CALL DP500-KOHLS-CALENDAR-ROUTINE                        32350000
323600             USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56            32360000
323700                                                                  32370000
323800         IF (DPG54-WARNING-ERROR OR                               32380000
323900             DPG54-SEVERE-ERROR)                                  32390000
324000             SET PS-INVALID-DATE TO TRUE                          32400000
324100         END-IF                                                   32410000
324200     ELSE                                                         32420000
324300         SET PS-INVALID-DATE TO TRUE                              32430000
324400     END-IF.                                                      32440000
324500                                                                  32450000
324600******************************************************************32460000
324700* THIS PARAGRAPH WILL CHECK FOR ANY AGREEMENT OVERLAPPING WHEN   *32470000
324800* THE TRANCODE HAS BEEN CHANGED AND IS VALID.  THIS CHECK IS DONE*32480000
324900* HERE TO AVOID EXPIRING A ROW & THEN NOT BEING ABLE TO INSERT A *32490000
325000* NEW AGREEMENT ROW.                                             *32500000
325100******************************************************************32510000
325200 3470-CHECK-TRCD-CHNG-OVERLAP.                                    32520000
325300                                                                  32530000
325400     MOVE ASC-KEY-DEPT-NBR       TO DK-DEPT-NBR.                  32540000
325500     MOVE ASC-KEY-ENT-ID         TO DK-ENT-ID.                    32550000
325600     MOVE ASC-EFFDTE-MM(ASC-BLK-SUB ASC-ITEM-SUB)                 32560000
325700                                 TO PV-TMP-EFFDTE-MM.             32570000
325800     MOVE ASC-EFFDTE-DD(ASC-BLK-SUB ASC-ITEM-SUB)                 32580000
325900                                 TO PV-TMP-EFFDTE-DD.             32590000
326000     MOVE ASC-EFFDTE-CCYY(ASC-BLK-SUB ASC-ITEM-SUB)               32600000
326100                                 TO PV-TMP-EFFDTE-CCYY.           32610000
326200     MOVE '-'                    TO PV-TMP-EFFDTE-DASH1           32620000
326300                                    PV-TMP-EFFDTE-DASH2.          32630000
326400     MOVE ASC-EXPDTE-MM(ASC-BLK-SUB ASC-ITEM-SUB)                 32640000
326500                                 TO PV-TMP-EXPDTE-MM.             32650000
326600     MOVE ASC-EXPDTE-DD(ASC-BLK-SUB ASC-ITEM-SUB)                 32660000
326700                                 TO PV-TMP-EXPDTE-DD.             32670000
326800     MOVE ASC-EXPDTE-CCYY(ASC-BLK-SUB ASC-ITEM-SUB)               32680000
326900                                 TO PV-TMP-EXPDTE-CCYY.           32690000
327000     MOVE '-'                    TO PV-TMP-EXPDTE-DASH1           32700000
327100                                    PV-TMP-EXPDTE-DASH2.          32710000
327200                                                                  32720000
327300     EXEC SQL                                                     32730000
327400       SELECT '1'                                                 32740000
327500         INTO :PV-ONE                                             32750000
327600         FROM SYSIBM.SYSDUMMY1 X                                  32760000
327700        WHERE EXISTS (SELECT 1                                    32770000
327800            FROM TVNDAGR                                          32780000
327900           WHERE ENT_ID            = :DK-ENT-ID                   32790000
328000             AND DEPT_NBR          = :DK-DEPT-NBR                 32800000
328100             AND AGRMT_TYP_ID      = '6'                          32810000
328200             AND TYP_CDE           =  6                           32820000
328300             AND AP_TRN_CDE        = :PV-TRANCODE                 32830000
328400             AND EXPIRATION_DATE   >= CURRENT DATE                32840000
328500*            AND (EFFECTIVE_DATE BETWEEN :PV-TMP-EFFDTE           32850000
328600*                                    AND :PV-TMP-EXPDTE           32860000
328700*              OR EXPIRATION_DATE BETWEEN :PV-TMP-EFFDTE          32870000
328800*                                     AND :PV-TMP-EXPDTE)         32880000
328900             AND (:PV-TMP-EFFDTE BETWEEN EFFECTIVE_DATE           32890000
329000                                     AND EXPIRATION_DATE          32900000
329100               OR :PV-TMP-EXPDTE BETWEEN EFFECTIVE_DATE           32910000
329200                                     AND EXPIRATION_DATE)         32920000
329300             AND X.IBMREQD = X.IBMREQD)                           32930000
329400     END-EXEC.                                                    32940000
329500                                                                  32950000
329600     EVALUATE TRUE                                                32960000
329700         WHEN SQLCODE = ZERO                                      32970000
329800* TRANCODE WILL CAUSE OVERLAPPING AGREEMENTS TO EXIST IF USED     32980000
329900              SET DP020-MSG-FATAL     TO TRUE                     32990000
330000              MOVE DP015-UNP-ALP-BRT-OFF                          33000000
330100                                      TO MR-TRANCODEA (PV-SUB)    33010000
330200                                         MR-SELECTA   (PV-SUB)    33020000
330300              MOVE DP015-REVERSE      TO MR-TRANCODEH (PV-SUB)    33030000
330400                                         MR-SELECTH   (PV-SUB)    33040000
330500              MOVE DP015-RED          TO MR-TRANCODEC (PV-SUB)    33050000
330600                                         MR-SELECTC   (PV-SUB)    33060000
330700              MOVE -1                 TO MR-TRANCODEL (PV-SUB)    33070000
330800*             MOVE -1                 TO MR-SELECTL   (PV-SUB)    33080000
330900              SET DP030-SET-CURSOR-APPL-1 TO TRUE                 33090000
331000              IF PS-NO-ERROR                                      33100000
331100                 MOVE PC-TSYMSG-03139 TO DP020-MSG-NUMBER         33110000
331200              END-IF                                              33120000
331300              SET PS-ERROR            TO TRUE                     33130000
331400                                                                  33140000
331500         WHEN SQLCODE = +100                                      33150000
331600              CONTINUE                                            33160000
331700                                                                  33170000
331800         WHEN SQLWARN0 NOT = SPACES                               33180000
331900         WHEN SQLCODE < ZERO                                      33190000
332000         WHEN SQLCODE > ZERO                                      33200000
332100              MOVE '3470-CHECK-TRCD-CHNG-OVERLAP'                 33210000
332200                                  TO DP013-PARAGRAPH              33220000
332300              MOVE DK-DEPT-NBR    TO DP013-MESSAGE-TEXT (1)       33230000
332400              MOVE DK-ENT-ID      TO DP013-MESSAGE-TEXT (2)       33240000
332500              MOVE SQLCA          TO DP013-SQLCA                  33250000
332600              MOVE 'TVNDAGR'      TO DP013-DB2-TABLE-NAME (1)     33260000
332700              SET DP013-DB2-ABEND                                 33270000
332800                  DP013-XCTL-DISPLAY-RESTART TO TRUE              33280000
332900              PERFORM DP013-0000-PROCESS-ABEND                    33290000
333000     END-EVALUATE.                                                33300000
333100                                                                  33310000
333200 EJECT                                                            33320000
333300*----------------------------------------------------------------*33330000
333400*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *33340000
333500*    INITIALIZE ALL COUNTERS AND FLAGS.                          *33350000
333600*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *33360000
333700*    DISPLAY THE PANEL TO USER.                                  *33370000
333800*----------------------------------------------------------------*33380000
333900                                                                  33390000
334000 4000-BUILD-INITIAL-PANEL.                                        33400000
334100                                                                  33410000
334200     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            33420000
334300                                 ASC-BLOCK-ENTRIES (2).           33430000
334400     MOVE +1                 TO ASC-BLK-SUB.                      33440000
334500     SET ASC-ITEMS-LEFT-ON-DB                                     33450000
334600                             TO TRUE.                             33460000
334700                                                                  33470000
334800     MOVE +0                 TO ASC-ITEM-SUB                      33480000
334900                                ASC-NUMBER-OF-ITEMS-READ          33490000
335000                                ASC-NUMBER-OF-SELECTED-ITEMS      33500000
335100                                ASC-HIGHEST-BLOCK-WRITTEN         33510000
335200                                ASC-START-OF-SELECTED-RANGE       33520000
335300                                ASC-END-OF-SELECTED-RANGE         33530000
335400                                ASC-ITEM-AT-TOP-OF-PANEL.         33540000
335500                                                                  33550000
335600     IF ASC-ACTIVE-CURSOR                                         33560000
335700        PERFORM 4010-OPEN-CURSOR                                  33570000
335800     ELSE                                                         33580000
335900        PERFORM 4030-OPEN-CURSOR                                  33590000
336000     END-IF.                                                      33600000
336100                                                                  33610000
336200     PERFORM 4300-READ-ITEMS-FROM-DB                              33620000
336300                                                                  33630000
336400     IF ASC-ACTIVE-CURSOR                                         33640000
336500        PERFORM 4020-CLOSE-CURSOR                                 33650000
336600     ELSE                                                         33660000
336700        PERFORM 4040-CLOSE-CURSOR                                 33670000
336800     END-IF.                                                      33680000
336900                                                                  33690000
337000     MOVE +1                   TO  PV-TOP-ITEM.                   33700000
337100*    IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          33710000
337200*        SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    33720000
337300*        SET DP020-MSG-FATAL   TO  TRUE                           33730000
337400*        MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               33740000
337500*    ELSE                                                         33750000
337600         MOVE -1               TO ASTRTITL.                       33760000
337700         SET DP030-SET-CURSOR-APPL-1                              33770000
337800                               TO TRUE.                           33780000
337900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                    33790000
338000*    END-IF.                                                      33800000
338100 EJECT                                                            33810000
338200*----------------------------------------------------------------*33820000
338300* OPEN THE ACTIVE PROGRAM CURSOR.                                *33830000
338400*----------------------------------------------------------------*33840000
338500                                                                  33850000
338600 4010-OPEN-CURSOR.                                                33860000
338700     PERFORM                                                      33870000
338800         WITH TEST AFTER                                          33880000
338900         VARYING PV-RETRY-COUNTER                                 33890000
339000         FROM 1 BY 1                                              33900000
339100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               33910000
339200                   OR (SQLCODE = ZERO))                           33920000
339300                                                                  33930000
339400         EXEC SQL                                                 33940000
339500              OPEN ACTIVE-PROGRAM-CSR                             33950000
339600         END-EXEC                                                 33960000
339700                                                                  33970000
339800                                                                  33980000
339900         EVALUATE TRUE                                            33990000
340000             WHEN SQLCODE = ZERO                                  34000000
340100             WHEN SQLCODE = -904                                  34010000
340200             WHEN SQLCODE = -913                                  34020000
340300                 CONTINUE                                         34030000
340400             WHEN SQLWARN0 NOT = SPACES                           34040000
340500             WHEN SQLCODE < ZERO                                  34050000
340600             WHEN SQLCODE > ZERO                                  34060000
340700                 MOVE '4010-OPEN-CURSOR'                          34070000
340800                                   TO DP013-PARAGRAPH             34080000
340900                 MOVE 'UNSUCCESSFUL OPEN CURSOR     '             34090000
341000                                   TO DP013-MESSAGE-TEXT (1)      34100000
341100                 MOVE SQLCA        TO DP013-SQLCA                 34110000
341200                 MOVE 'TVNDAGR '   TO DP013-DB2-TABLE-NAME (1)    34120000
341300                 MOVE 'TTRNCDE '   TO DP013-DB2-TABLE-NAME (2)    34130000
341400                 SET DP013-DB2-ABEND                              34140000
341500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           34150000
341600                 PERFORM DP013-0000-PROCESS-ABEND                 34160000
341700         END-EVALUATE                                             34170000
341800     END-PERFORM.                                                 34180000
341900*                                                                 34190000
342000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        34200000
342100         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             34210000
342200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   34220000
342300                                   TO DP013-MESSAGE-TEXT (1)      34230000
342400         MOVE SQLCA                TO DP013-SQLCA                 34240000
342500         MOVE 'TVNDAGR '           TO DP013-DB2-TABLE-NAME (1)    34250000
342600         MOVE 'TTRNCDE '           TO DP013-DB2-TABLE-NAME (1)    34260000
342700         SET DP013-DB2-ABEND                                      34270000
342800             DP013-XCTL-DISPLAY-RESTART                           34280000
342900                                   TO TRUE                        34290000
343000         PERFORM DP013-0000-PROCESS-ABEND                         34300000
343100     END-IF.                                                      34310000
343200                                                                  34320000
343300 EJECT                                                            34330000
343400*----------------------------------------------------------------*34340000
343500* CLOSE THE ACTIVE PROGRAM CSR                                   *34350000
343600*----------------------------------------------------------------*34360000
343700                                                                  34370000
343800 4020-CLOSE-CURSOR.                                               34380000
343900     EXEC SQL                                                     34390000
344000         CLOSE ACTIVE-PROGRAM-CSR                                 34400000
344100     END-EXEC.                                                    34410000
344200*                                                                 34420000
344300     EVALUATE TRUE                                                34430000
344400         WHEN SQLCODE = ZERO                                      34440000
344500             CONTINUE                                             34450000
344600         WHEN SQLWARN0 NOT = SPACES                               34460000
344700         WHEN SQLCODE < ZERO                                      34470000
344800         WHEN SQLCODE > ZERO                                      34480000
344900             MOVE '4020-CLOSE-CURSOR'                             34490000
345000                               TO DP013-PARAGRAPH                 34500000
345100             MOVE 'UNSUCCESSFUL CLOSE CURSOR   '                  34510000
345200                               TO DP013-MESSAGE-TEXT (1)          34520000
345300             MOVE SQLCA        TO DP013-SQLCA                     34530000
345400             MOVE 'TVNDAGR '   TO DP013-DB2-TABLE-NAME (1)        34540000
345500             MOVE 'TTRNCDE '   TO DP013-DB2-TABLE-NAME (2)        34550000
345600             SET DP013-DB2-ABEND                                  34560000
345700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               34570000
345800             PERFORM DP013-0000-PROCESS-ABEND                     34580000
345900     END-EVALUATE.                                                34590000
346000                                                                  34600000
346100 EJECT                                                            34610000
346200*----------------------------------------------------------------*34620000
346300* OPEN THE EXPIRE PROGRAM CURSOR.                                *34630000
346400*----------------------------------------------------------------*34640000
346500                                                                  34650000
346600 4030-OPEN-CURSOR.                                                34660000
346700     PERFORM                                                      34670000
346800         WITH TEST AFTER                                          34680000
346900         VARYING PV-RETRY-COUNTER                                 34690000
347000         FROM 1 BY 1                                              34700000
347100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               34710000
347200                   OR (SQLCODE = ZERO))                           34720000
347300                                                                  34730000
347400         EXEC SQL                                                 34740000
347500              OPEN EXPIRE-PROGRAM-CSR                             34750000
347600         END-EXEC                                                 34760000
347700                                                                  34770000
347800                                                                  34780000
347900         EVALUATE TRUE                                            34790000
348000             WHEN SQLCODE = ZERO                                  34800000
348100             WHEN SQLCODE = -904                                  34810000
348200             WHEN SQLCODE = -913                                  34820000
348300                 CONTINUE                                         34830000
348400             WHEN SQLWARN0 NOT = SPACES                           34840000
348500             WHEN SQLCODE < ZERO                                  34850000
348600             WHEN SQLCODE > ZERO                                  34860000
348700                 MOVE '4030-OPEN-CURSOR'                          34870000
348800                                   TO DP013-PARAGRAPH             34880000
348900                 MOVE 'UNSUCCESSFUL OPEN CURSOR     '             34890000
349000                                   TO DP013-MESSAGE-TEXT (1)      34900000
349100                 MOVE SQLCA        TO DP013-SQLCA                 34910000
349200                 MOVE 'TVNDAGR '   TO DP013-DB2-TABLE-NAME (1)    34920000
349300                 MOVE 'TTRNCDE '   TO DP013-DB2-TABLE-NAME (2)    34930000
349400                 SET DP013-DB2-ABEND                              34940000
349500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           34950000
349600                 PERFORM DP013-0000-PROCESS-ABEND                 34960000
349700         END-EVALUATE                                             34970000
349800     END-PERFORM.                                                 34980000
349900*                                                                 34990000
350000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        35000000
350100         MOVE '4030-OPEN-CURSOR'   TO DP013-PARAGRAPH             35010000
350200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   35020000
350300                                   TO DP013-MESSAGE-TEXT (1)      35030000
350400         MOVE SQLCA                TO DP013-SQLCA                 35040000
350500         MOVE 'TVNDAGR '           TO DP013-DB2-TABLE-NAME (1)    35050000
350600         MOVE 'TTRNCDE '           TO DP013-DB2-TABLE-NAME (1)    35060000
350700         SET DP013-DB2-ABEND                                      35070000
350800             DP013-XCTL-DISPLAY-RESTART                           35080000
350900                                   TO TRUE                        35090000
351000         PERFORM DP013-0000-PROCESS-ABEND                         35100000
351100     END-IF.                                                      35110000
351200                                                                  35120000
351300 EJECT                                                            35130000
351400*----------------------------------------------------------------*35140000
351500* CLOSE THE EXPIRE PROGRAM CSR                                   *35150000
351600*----------------------------------------------------------------*35160000
351700                                                                  35170000
351800 4040-CLOSE-CURSOR.                                               35180000
351900     EXEC SQL                                                     35190000
352000         CLOSE EXPIRE-PROGRAM-CSR                                 35200000
352100     END-EXEC.                                                    35210000
352200*                                                                 35220000
352300     EVALUATE TRUE                                                35230000
352400         WHEN SQLCODE = ZERO                                      35240000
352500             CONTINUE                                             35250000
352600         WHEN SQLWARN0 NOT = SPACES                               35260000
352700         WHEN SQLCODE < ZERO                                      35270000
352800         WHEN SQLCODE > ZERO                                      35280000
352900             MOVE '4040-CLOSE-CURSOR'                             35290000
353000                               TO DP013-PARAGRAPH                 35300000
353100             MOVE 'UNSUCCESSFUL CLOSE CURSOR   '                  35310000
353200                               TO DP013-MESSAGE-TEXT (1)          35320000
353300             MOVE SQLCA        TO DP013-SQLCA                     35330000
353400             MOVE 'TVNDAGR '   TO DP013-DB2-TABLE-NAME (1)        35340000
353500             MOVE 'TTRNCDE '   TO DP013-DB2-TABLE-NAME (2)        35350000
353600             SET DP013-DB2-ABEND                                  35360000
353700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               35370000
353800             PERFORM DP013-0000-PROCESS-ABEND                     35380000
353900     END-EVALUATE.                                                35390000
354000                                                                  35400000
354100******************************************************************35410000
354200* THIS PARAGRAPH PHYSICALLY LOOPS THROUGH ALL ITEMS IN THE LIST  *35420000
354300* TEMP STORAGE QUEUE.                                            *35430000
354400******************************************************************35440000
354500 4100-TRAVERSE-TSQ-INSERT.                                        35450000
354600                                                                  35460000
354700     MOVE ASC-LIST-ITEM-NUMBER (1 1)                              35470000
354800                                 TO PV-LIST-ITEM-NUMBER.          35480000
354900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            35490000
355000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    35500000
355100                                                                  35510000
355200     MOVE +1                     TO ASC-BLK-SUB.                  35520000
355300                                                                  35530000
355400     PERFORM                                                      35540000
355500         VARYING PV-BLOCK-NUMBER                                  35550000
355600         FROM 1 BY 1                                              35560000
355700         UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN        35570000
355800                                                                  35580000
355900         PERFORM 4410-READ-TEMP-STORAGE                           35590000
356000                                                                  35600000
356100         PERFORM                                                  35610000
356200             VARYING ASC-ITEM-SUB                                 35620000
356300             FROM 1 BY 1                                          35630000
356400             UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL              35640000
356500                                                                  35650000
356600             IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)             35660000
356700                PERFORM 6700-INSERT-PROCESSING                    35670000
356800             END-IF                                               35680000
356900         END-PERFORM                                              35690000
357000                                                                  35700000
357100     END-PERFORM.                                                 35710000
357200                                                                  35720000
357300     MOVE +1                        TO ASC-BLK-SUB.               35730000
357400     MOVE PV-FIRST-BLOCK-IN-ARRAY   TO PV-BLOCK-NUMBER.           35740000
357500                                                                  35750000
357600     PERFORM 4410-READ-TEMP-STORAGE.                              35760000
357700                                                                  35770000
357800     ADD +1                         TO PV-BLOCK-NUMBER            35780000
357900                                       ASC-BLK-SUB.               35790000
358000     PERFORM 4410-READ-TEMP-STORAGE.                              35800000
358100                                                                  35810000
358200******************************************************************35820000
358300* THIS PARAGRAPH WILL TRAVERSE THE TEMPORARY STORAGE QUEUE FOR   *35830000
358400* PURPOSES OF UPDATING THE VENDOR OFF-INVOICE AGREEMENT LINES.   *35840000
358500******************************************************************35850000
358600 4110-TRAVERSE-TSQ-UPDATE.                                        35860000
358700                                                                  35870000
358800     MOVE ASC-LIST-ITEM-NUMBER (1 1)                              35880000
358900                                 TO PV-LIST-ITEM-NUMBER.          35890000
359000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            35900000
359100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    35910000
359200                                                                  35920000
359300     MOVE +1                     TO ASC-BLK-SUB.                  35930000
359400                                                                  35940000
359500     PERFORM                                                      35950000
359600         VARYING PV-BLOCK-NUMBER                                  35960000
359700         FROM 1 BY 1                                              35970000
359800         UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN        35980000
359900                                                                  35990000
360000         PERFORM 4410-READ-TEMP-STORAGE                           36000000
360100                                                                  36010000
360200         PERFORM                                                  36020000
360300             VARYING ASC-ITEM-SUB                                 36030000
360400             FROM 1 BY 1                                          36040000
360500             UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL              36050000
360600                                                                  36060000
360700             IF ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)   36070000
360800                GREATER THAN ZERO                                 36080000
360900                IF ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)          36090000
361000                   PERFORM 6900-UPDATE-PROCESSING                 36100000
361100                   SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS  36110000
361200                   SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE    36120000
361300                   SET ASC-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)   36130000
361400                                                    TO TRUE       36140000
361500                   SET ASC-TEMP-NO-SELECT                         36150000
361600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   36160000
361700                                                    TO TRUE       36170000
361800                END-IF                                            36180000
361900             END-IF                                               36190000
362000         END-PERFORM                                              36200000
362100                                                                  36210000
362200         IF ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                       36220000
362300            PERFORM 5105-REWRITE-ASC-LISTQ                        36230000
362400         END-IF                                                   36240000
362500                                                                  36250000
362600     END-PERFORM.                                                 36260000
362700                                                                  36270000
362800     MOVE +1                        TO ASC-BLK-SUB.               36280000
362900     MOVE PV-FIRST-BLOCK-IN-ARRAY   TO PV-BLOCK-NUMBER.           36290000
363000                                                                  36300000
363100     PERFORM 4410-READ-TEMP-STORAGE.                              36310000
363200                                                                  36320000
363300     ADD +1                         TO PV-BLOCK-NUMBER            36330000
363400                                       ASC-BLK-SUB.               36340000
363500     PERFORM 4410-READ-TEMP-STORAGE.                              36350000
363600                                                                  36360000
363700 EJECT                                                            36370000
363800*----------------------------------------------------------------*36380000
363900*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *36390000
364000*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *36400000
364100*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *36410000
364200*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *36420000
364300*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *36430000
364400*                                                                *36440000
364500*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *36450000
364600*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *36460000
364700*    UPON INITIALIZATION.                                        *36470000
364800*----------------------------------------------------------------*36480000
364900                                                                  36490000
365000 4300-READ-ITEMS-FROM-DB.                                         36500000
365100                                                                  36510000
365200     PERFORM                                                      36520000
365300         VARYING PV-READ-COUNT                                    36530000
365400         FROM 1 BY 1                                              36540000
365500         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    36550000
365600            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         36560000
365700                                                                  36570000
365800         IF ASC-ACTIVE-CURSOR                                     36580000
365900             PERFORM 4310-FETCH                                   36590000
366000         ELSE                                                     36600000
366100             PERFORM 4320-FETCH                                   36610000
366200         END-IF                                                   36620000
366300                                                                  36630000
366400         IF  ASC-ITEMS-LEFT-ON-DB                                 36640000
366500             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                36650000
366600                 ADD +1            TO ASC-ITEM-SUB                36660000
366700             ELSE                                                 36670000
366800                 ADD +1            TO ASC-BLK-SUB                 36680000
366900                 MOVE +1           TO ASC-ITEM-SUB                36690000
367000                                                                  36700000
367100                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         36710000
367200                     MOVE +1       TO ASC-BLK-SUB                 36720000
367300                     SET ASC-BLOCK-MODIFIED (1)                   36730000
367400                                   TO TRUE                        36740000
367500                     PERFORM 5100-WRITE-TEMP-STORAGE              36750000
367600                     MOVE ASC-BLOCK-ENTRIES                       36760000
367700                               (PC-MAX-BLOCKS-IN-ARRAY)           36770000
367800                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 36780000
367900                     ADD +1        TO ASC-BLK-SUB                 36790000
368000                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   36800000
368100                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      36810000
368200                                   TO TRUE                        36820000
368300                 END-IF                                           36830000
368400             END-IF                                               36840000
368500             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    36850000
368600             MOVE ASC-NUMBER-OF-ITEMS-READ                        36860000
368700                                   TO ASC-LIST-ITEM-NUMBER        36870000
368800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  36880000
368900             MOVE VNDAGR-AP-TRN-CDE TO ASC-TRANCODE               36890000
369000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36900000
369100             MOVE VNDAGR-SEQ-NBR    TO ASC-SEQ-NBR                36910000
369200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36920000
369300             COMPUTE ASC-PERCENT (ASC-BLK-SUB ASC-ITEM-SUB) =     36930000
369400                               VNDAGR-DISCOUNT-PCT * 100          36940000
369500             MOVE VNDAGR-EFFECTIVE-DATE  TO PV-EFFDTE             36950000
369600             MOVE PV-EFFDTE-MM           TO ASC-EFFDTE-MM         36960000
369700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36970000
369800             MOVE PV-EFFDTE-DD           TO ASC-EFFDTE-DD         36980000
369900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 36990000
370000             MOVE PV-EFFDTE-CCYY         TO ASC-EFFDTE-CCYY       37000000
370100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37010000
370200             MOVE VNDAGR-EXPIRATION-DATE TO PV-EXPDTE             37020000
370300             MOVE PV-EXPDTE-MM           TO ASC-EXPDTE-MM         37030000
370400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37040000
370500             MOVE PV-EXPDTE-DD           TO ASC-EXPDTE-DD         37050000
370600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37060000
370700             MOVE PV-EXPDTE-CCYY         TO ASC-EXPDTE-CCYY       37070000
370800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37080000
370900             MOVE TRNCDE-TRN-SHRT-DESC   TO ASC-DESCRIPTION       37090000
371000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37100000
371100             MOVE VNDAGR-PSTG-FRQ-CDE    TO ASC-FREQ-IND          37110000
371200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37120000
371300             MOVE VNDAGR-DED-DISC-IND    TO ASC-NET-DISC          37130000
371400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37140000
371500             MOVE VNDAGR-DED-RTV-IND     TO ASC-NET-RTV           37150000
371600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 37160000
371700         END-IF                                                   37170000
371800     END-PERFORM.                                                 37180000
371900                                                                  37190000
372000     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          37200000
372100         MOVE +1               TO ASC-BLK-SUB                     37210000
372200         PERFORM 5100-WRITE-TEMP-STORAGE                          37220000
372300         ADD +1                TO ASC-BLK-SUB                     37230000
372400         PERFORM 5100-WRITE-TEMP-STORAGE                          37240000
372500                                                                  37250000
372600         MOVE 1                TO ASC-BLK-SUB                     37260000
372700                                  PV-BLOCK-NUMBER                 37270000
372800         PERFORM 4410-READ-TEMP-STORAGE                           37280000
372900         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             37290000
373000             MOVE 2            TO ASC-BLK-SUB                     37300000
373100                                  PV-BLOCK-NUMBER                 37310000
373200             PERFORM 4410-READ-TEMP-STORAGE                       37320000
373300         END-IF                                                   37330000
373400     END-IF.                                                      37340000
373500 EJECT                                                            37350000
373600*----------------------------------------------------------------*37360000
373700*    FETCH THE ACTIVE PROGRAM CSR                                *37370000
373800*----------------------------------------------------------------*37380000
373900                                                                  37390000
374000 4310-FETCH.                                                      37400000
374100                                                                  37410000
374200     EXEC SQL                                                     37420000
374300          FETCH ACTIVE-PROGRAM-CSR                                37430000
374400          INTO  :VNDAGR-AP-TRN-CDE                                37440000
374500              , :VNDAGR-DISCOUNT-PCT                              37450000
374600              , :VNDAGR-EFFECTIVE-DATE                            37460000
374700              , :VNDAGR-EXPIRATION-DATE                           37470000
374800              , :VNDAGR-SEQ-NBR                                   37480000
374900              , :VNDAGR-PSTG-FRQ-CDE                              37490000
375000              , :VNDAGR-DED-DISC-IND                              37500000
375100              , :VNDAGR-DED-RTV-IND                               37510000
375200              , :TRNCDE-TRN-SHRT-DESC                             37520000
375300     END-EXEC.                                                    37530000
375400                                                                  37540000
375500     EVALUATE TRUE                                                37550000
375600         WHEN SQLCODE = ZERO                                      37560000
375700         WHEN SQLCODE = +100                                      37570000
375800              CONTINUE                                            37580000
375900         WHEN SQLWARN0 NOT = SPACE                                37590000
376000         WHEN SQLCODE NOT = ZERO                                  37600000
376100              MOVE '4310-FETCH-CURSOR'                            37610000
376200                               TO DP013-PARAGRAPH                 37620000
376300              MOVE 'FETCH ACTIVE PROGRAM CSR'                     37630000
376400                               TO DP013-MESSAGE-TEXT (1)          37640000
376500              MOVE SQLCA       TO DP013-SQLCA                     37650000
376600              SET DP013-DB2-ABEND                                 37660000
376700                               TO TRUE                            37670000
376800              PERFORM DP013-0000-PROCESS-ABEND                    37680000
376900     END-EVALUATE.                                                37690000
377000                                                                  37700000
377100     IF  SQLCODE EQUAL +100                                       37710000
377200         SET ASC-NO-ITEMS-LEFT-ON-DB                              37720000
377300                                   TO TRUE                        37730000
377400     END-IF.                                                      37740000
377500                                                                  37750000
377600 EJECT                                                            37760000
377700*----------------------------------------------------------------*37770000
377800*    FETCH THE EXPIRE PROGRAM CSR                                *37780000
377900*----------------------------------------------------------------*37790000
378000                                                                  37800000
378100 4320-FETCH.                                                      37810000
378200                                                                  37820000
378300     EXEC SQL                                                     37830000
378400          FETCH EXPIRE-PROGRAM-CSR                                37840000
378500          INTO  :VNDAGR-AP-TRN-CDE                                37850000
378600              , :VNDAGR-DISCOUNT-PCT                              37860000
378700              , :VNDAGR-EFFECTIVE-DATE                            37870000
378800              , :VNDAGR-EXPIRATION-DATE                           37880000
378900              , :VNDAGR-SEQ-NBR                                   37890000
379000              , :VNDAGR-PSTG-FRQ-CDE                              37900000
379100              , :VNDAGR-DED-DISC-IND                              37910000
379200              , :VNDAGR-DED-RTV-IND                               37920000
379300              , :TRNCDE-TRN-SHRT-DESC                             37930000
379400     END-EXEC.                                                    37940000
379500                                                                  37950000
379600     EVALUATE TRUE                                                37960000
379700         WHEN SQLCODE = ZERO                                      37970000
379800         WHEN SQLCODE = +100                                      37980000
379900              CONTINUE                                            37990000
380000         WHEN SQLWARN0 NOT = SPACE                                38000000
380100         WHEN SQLCODE NOT = ZERO                                  38010000
380200              MOVE '4320-FETCH-CURSOR'                            38020000
380300                               TO DP013-PARAGRAPH                 38030000
380400              MOVE 'FETCH EXPIRE PROGRAM CSR'                     38040000
380500                               TO DP013-MESSAGE-TEXT (1)          38050000
380600              MOVE SQLCA       TO DP013-SQLCA                     38060000
380700              SET DP013-DB2-ABEND                                 38070000
380800                               TO TRUE                            38080000
380900              PERFORM DP013-0000-PROCESS-ABEND                    38090000
381000     END-EVALUATE.                                                38100000
381100                                                                  38110000
381200     IF  SQLCODE EQUAL +100                                       38120000
381300         SET ASC-NO-ITEMS-LEFT-ON-DB                              38130000
381400                                   TO TRUE                        38140000
381500     END-IF.                                                      38150000
381600                                                                  38160000
381700 EJECT                                                            38170000
381800*----------------------------------------------------------------*38180000
381900* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *38190000
382000*----------------------------------------------------------------*38200000
382100                                                                  38210000
382200 4400-MOVE-COMMAREA-TO-SCREEN.                                    38220000
382300     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             38230000
382400         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          38240000
382500         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          38250000
382600             MOVE +1    TO ASC-BLK-SUB                            38260000
382700             PERFORM 5100-WRITE-TEMP-STORAGE                      38270000
382800             ADD +1     TO ASC-BLK-SUB                            38280000
382900             PERFORM 5100-WRITE-TEMP-STORAGE                      38290000
383000             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             38300000
383100                 GIVING PV-BLOCK-NUMBER                           38310000
383200                 REMAINDER PV-REMAINDER                           38320000
383300             IF  PV-REMAINDER > ZERO                              38330000
383400                 ADD +1 TO PV-BLOCK-NUMBER                        38340000
383500             END-IF                                               38350000
383600             MOVE +1    TO ASC-BLK-SUB                            38360000
383700             PERFORM 4410-READ-TEMP-STORAGE                       38370000
383800             ADD +1     TO ASC-BLK-SUB                            38380000
383900                           PV-BLOCK-NUMBER                        38390000
384000             PERFORM 4410-READ-TEMP-STORAGE                       38400000
384100     END-IF.                                                      38410000
384200     MOVE +1            TO ASC-BLK-SUB.                           38420000
384300     COMPUTE ASC-ITEM-SUB =                                       38430000
384400         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              38440000
384500         + PC-ITEMS-PER-PANEL).                                   38450000
384600*                                                                 38460000
384700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        38470000
384800         ADD +1         TO ASC-BLK-SUB                            38480000
384900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            38490000
385000     END-IF.                                                      38500000
385100*                                                                 38510000
385200     MOVE ASC-KEY-DEPT-NBR         TO ADPTNBRO.                   38520000
385300     MOVE ASC-KEY-INHOUSE-NBR      TO AINHSO.                     38530000
385400     MOVE ASC-KEY-ENT-NAME-DESC    TO AVNNAMEO.                   38540000
385500     MOVE ASC-KEY-DUN-NBR          TO ADUNNBRO.                   38550000
385600*                                                                 38560000
385700     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           38570000
385800         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                38580000
385900     PERFORM 4420-FORMAT-LIST-LINES                               38590000
386000         VARYING PV-SUB                                           38600000
386100         FROM PC-ITEMS-PER-PANEL BY -1                            38610000
386200         UNTIL PV-SUB < +1.                                       38620000
386300*                                                                 38630000
386400     COMPUTE ASC-ITEMS-DISPLAYED =                                38640000
386500         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          38650000
386600     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    38660000
386700                                      ASTRTITO.                   38670000
386800     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    38680000
386900     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    38690000
387000                                                                  38700000
387100     IF  DP020-MSG-NUMBER-X = SPACE                               38710000
387200         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  38720000
387300*            --- MORE ITEMS TO DISPLAY ----                       38730000
387400             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            38740000
387500             SET DP020-MSG-INFORMATIONAL TO TRUE                  38750000
387600         END-IF                                                   38760000
387700     END-IF.                                                      38770000
387800*----------------------------------------------------------------*38780000
387900*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *38790000
388000*----------------------------------------------------------------*38800000
388100                                                                  38810000
388200 4410-READ-TEMP-STORAGE.                                          38820000
388300                                                                  38830000
388400     EXEC CICS                                                    38840000
388500         READQ TS                                                 38850000
388600             QUEUE (ASC-LIST-QUEUE-NAME)                          38860000
388700             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               38870000
388800             ITEM  (PV-BLOCK-NUMBER)                              38880000
388900             RESP  (PV-CICS-RESP)                                 38890000
389000     END-EXEC.                                                    38900000
389100                                                                  38910000
389200     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       38920000
389300       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     38930000
389400         CONTINUE                                                 38940000
389500     ELSE                                                         38950000
389600         SET DP013-CICS-ABEND     TO TRUE                         38960000
389700         SET DP013-NO-ROLLBACK    TO TRUE                         38970000
389800         MOVE '4410-READ-TEMP-STORAGE'                            38980000
389900                                  TO DP013-PARAGRAPH              38990000
390000         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      39000000
390100                                  TO DP013-MESSAGE-TEXT(1)        39010000
390200         PERFORM DP013-0000-PROCESS-ABEND                         39020000
390300     END-IF.                                                      39030000
390400                                                                  39040000
390500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             39050000
390600*                                                                 39060000
390700     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         39070000
390800         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               39080000
390900     END-IF.                                                      39090000
391000 EJECT                                                            39100000
391100*----------------------------------------------------------------*39110000
391200*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *39120000
391300*----------------------------------------------------------------*39130000
391400                                                                  39140000
391500 4420-FORMAT-LIST-LINES.                                          39150000
391600     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      39160000
391700         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                39170000
391800         MOVE SPACE              TO MR-SELECTI     (PV-SUB)       39180000
391900                                    MR-TRANCODE    (PV-SUB)       39190000
392000                                    MR-PERCENT     (PV-SUB)       39200000
392100                                    MR-DESCRIPTION (PV-SUB)       39210000
392200                                    MR-NET-DISC    (PV-SUB)       39220000
392300                                    MR-NET-RTV     (PV-SUB)       39230000
392400                                    MR-FREQ-IND    (PV-SUB)       39240000
392500                                    MR-FREQUENCY   (PV-SUB)       39250000
392600                                    MR-EFFDTE-MM   (PV-SUB)       39260000
392700                                    MR-EFFDTE-DD   (PV-SUB)       39270000
392800                                    MR-EFFDTE-CCYY (PV-SUB)       39280000
392900                                    MR-EXPDTE-MM   (PV-SUB)       39290000
393000                                    MR-EXPDTE-DD   (PV-SUB)       39300000
393100                                    MR-EXPDTE-CCYY (PV-SUB)       39310000
393200     ELSE                                                         39320000
393300         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      39330000
393400                                                   > SPACE        39340000
393500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 39350000
393600                                 TO MR-SELECTI (PV-SUB)           39360000
393700         ELSE                                                     39370000
393800             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      39380000
393900                                 TO MR-SELECTI (PV-SUB)           39390000
394000         END-IF                                                   39400000
394100                                                                  39410000
394200         IF  DP030-SET-CURSOR-TRAILER                             39420000
394300             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)39430000
394400                 > SPACE)                                         39440000
394500               OR (PV-SUB = 1))                                   39450000
394600*               MOVE -1          TO MR-SELECTL  (PV-SUB)          39460000
394700                MOVE -1          TO ASTRTITL                      39470000
394800                SET DP030-SET-CURSOR-APPL-1 TO TRUE               39480000
394900             END-IF                                               39490000
395000         END-IF                                                   39500000
395100                                                                  39510000
395200         IF ASC-TRANCODE  (ASC-BLK-SUB ASC-ITEM-SUB) = SPACES     39520000
395300            MOVE SPACES      TO MR-TRANCODE    (PV-SUB)           39530000
395400         ELSE                                                     39540000
395500            MOVE ASC-TRANCODE  (ASC-BLK-SUB ASC-ITEM-SUB)         39550000
395600                             TO MR-TRANCODE    (PV-SUB)           39560000
395700            MOVE DP015-PRO-NOR-OFF TO MR-TRANCODEA (PV-SUB)       39570000
395800            MOVE DP015-BLUE        TO MR-TRANCODEC (PV-SUB)       39580000
395900            MOVE DP015-HL-OFF      TO MR-TRANCODEH (PV-SUB)       39590000
396000         END-IF                                                   39600000
396100                                                                  39610000
396200         IF ASC-PERCENT   (ASC-BLK-SUB ASC-ITEM-SUB) = ZERO       39620000
396300*           MOVE SPACES      TO MR-PERCENT     (PV-SUB)           39630000
396400            MOVE ZERO        TO MR-PERCENT-FMT (PV-SUB)           39640000
396500         ELSE                                                     39650000
396600            IF  ASC-PERCENT-ERR-FLAG (ASC-BLK-SUB, ASC-ITEM-SUB)  39660000
396700                                      = 'Y'                       39670000
396800                MOVE ASC-PERCENT-ORIG-ENTRD                       39680000
396900                                    (ASC-BLK-SUB ASC-ITEM-SUB)    39690000
397000                                 TO MR-PERCENT (PV-SUB)           39700000
397100            ELSE                                                  39710000
397200                MOVE ASC-PERCENT   (ASC-BLK-SUB ASC-ITEM-SUB)     39720000
397300                                 TO MR-PERCENT-FMT (PV-SUB)       39730000
397400            END-IF                                                39740000
397500         END-IF                                                   39750000
397600                                                                  39760000
397700         MOVE ASC-DESCRIPTION (ASC-BLK-SUB ASC-ITEM-SUB)          39770000
397800                             TO MR-DESCRIPTION (PV-SUB)           39780000
397900                                                                  39790000
398000         IF ASC-NET-RTV   (ASC-BLK-SUB ASC-ITEM-SUB) = SPACES     39800000
398100            MOVE SPACES      TO MR-NET-RTV     (PV-SUB)           39810000
398200         ELSE                                                     39820000
398300            MOVE ASC-NET-RTV     (ASC-BLK-SUB ASC-ITEM-SUB)       39830000
398400                             TO MR-NET-RTV     (PV-SUB)           39840000
398500         END-IF                                                   39850000
398600                                                                  39860000
398700         IF ASC-NET-DISC  (ASC-BLK-SUB ASC-ITEM-SUB) = SPACES     39870000
398800            MOVE SPACES      TO MR-NET-DISC    (PV-SUB)           39880000
398900         ELSE                                                     39890000
399000            MOVE ASC-NET-DISC    (ASC-BLK-SUB ASC-ITEM-SUB)       39900000
399100                             TO MR-NET-DISC    (PV-SUB)           39910000
399200         END-IF                                                   39920000
399300                                                                  39930000
399400         IF ASC-FREQ-IND  (ASC-BLK-SUB ASC-ITEM-SUB) = SPACES     39940000
399500            MOVE SPACES      TO MR-FREQ-IND    (PV-SUB)           39950000
399600         ELSE                                                     39960000
399700            MOVE ASC-FREQ-IND    (ASC-BLK-SUB ASC-ITEM-SUB)       39970000
399800                             TO MR-FREQ-IND    (PV-SUB)           39980000
399900         END-IF                                                   39990000
400000                                                                  40000000
400100         IF ASC-FREQ-IND  (ASC-BLK-SUB ASC-ITEM-SUB) = 'FM'       40010000
400200            MOVE 'FSCL MN' TO MR-FREQUENCY (PV-SUB)               40020000
400300         END-IF                                                   40030000
400400         IF ASC-FREQ-IND  (ASC-BLK-SUB ASC-ITEM-SUB) = 'FQ'       40040000
400500            MOVE 'FSC QTR' TO MR-FREQUENCY (PV-SUB)               40050000
400600         END-IF                                                   40060000
400700         IF ASC-FREQ-IND  (ASC-BLK-SUB ASC-ITEM-SUB) = 'CQ'       40070000
400800            MOVE 'CAL QTR' TO MR-FREQUENCY (PV-SUB)               40080000
400900         END-IF                                                   40090000
401000         IF ASC-FREQ-IND  (ASC-BLK-SUB ASC-ITEM-SUB) = 'FS'       40100000
401100            MOVE 'FSCL SA' TO MR-FREQUENCY (PV-SUB)               40110000
401200         END-IF                                                   40120000
401300         IF ASC-FREQ-IND  (ASC-BLK-SUB ASC-ITEM-SUB) = 'CS'       40130000
401400            MOVE 'CAL SA ' TO MR-FREQUENCY (PV-SUB)               40140000
401500         END-IF                                                   40150000
401600         IF ASC-FREQ-IND  (ASC-BLK-SUB ASC-ITEM-SUB) = 'FA'       40160000
401700            MOVE 'FSCL YR' TO MR-FREQUENCY (PV-SUB)               40170000
401800         END-IF                                                   40180000
401900         IF ASC-FREQ-IND  (ASC-BLK-SUB ASC-ITEM-SUB) = 'CA'       40190000
402000            MOVE 'CAL YR ' TO MR-FREQUENCY (PV-SUB)               40200000
402100         END-IF                                                   40210000
402200         IF ASC-FREQ-IND  (ASC-BLK-SUB ASC-ITEM-SUB) = 'RO'       40220000
402300            MOVE 'RPTONLY' TO MR-FREQUENCY (PV-SUB)               40230000
402400         END-IF                                                   40240000
402500                                                                  40250000
402600         IF ASC-EFFDTE-MM (ASC-BLK-SUB ASC-ITEM-SUB) EQUAL ZERO   40260000
402700            MOVE SPACES   TO MR-EFFDTE-MM      (PV-SUB)           40270000
402800         ELSE                                                     40280000
402900            MOVE ASC-EFFDTE-MM (ASC-BLK-SUB ASC-ITEM-SUB)         40290000
403000                          TO MR-EFFDTE-MM      (PV-SUB)           40300000
403100         END-IF                                                   40310000
403200                                                                  40320000
403300         IF ASC-EFFDTE-DD (ASC-BLK-SUB ASC-ITEM-SUB) EQUAL ZERO   40330000
403400            MOVE SPACES   TO MR-EFFDTE-DD      (PV-SUB)           40340000
403500         ELSE                                                     40350000
403600            MOVE ASC-EFFDTE-DD (ASC-BLK-SUB ASC-ITEM-SUB)         40360000
403700                          TO MR-EFFDTE-DD      (PV-SUB)           40370000
403800         END-IF                                                   40380000
403900                                                                  40390000
404000         IF ASC-EFFDTE-CCYY (ASC-BLK-SUB ASC-ITEM-SUB) EQUAL ZERO 40400000
404100            MOVE SPACES   TO MR-EFFDTE-CCYY    (PV-SUB)           40410000
404200         ELSE                                                     40420000
404300            MOVE ASC-EFFDTE-CCYY (ASC-BLK-SUB ASC-ITEM-SUB)       40430000
404400                          TO MR-EFFDTE-CCYY    (PV-SUB)           40440000
404500         END-IF                                                   40450000
404600                                                                  40460000
404700         IF ASC-EXPDTE-MM (ASC-BLK-SUB ASC-ITEM-SUB) EQUAL ZERO   40470000
404800            MOVE SPACES   TO MR-EXPDTE-MM      (PV-SUB)           40480000
404900         ELSE                                                     40490000
405000            MOVE ASC-EXPDTE-MM (ASC-BLK-SUB ASC-ITEM-SUB)         40500000
405100                          TO MR-EXPDTE-MM      (PV-SUB)           40510000
405200         END-IF                                                   40520000
405300                                                                  40530000
405400         IF ASC-EXPDTE-DD (ASC-BLK-SUB ASC-ITEM-SUB) EQUAL ZERO   40540000
405500            MOVE SPACES   TO MR-EXPDTE-DD      (PV-SUB)           40550000
405600         ELSE                                                     40560000
405700            MOVE ASC-EXPDTE-DD (ASC-BLK-SUB ASC-ITEM-SUB)         40570000
405800                          TO MR-EXPDTE-DD      (PV-SUB)           40580000
405900         END-IF                                                   40590000
406000                                                                  40600000
406100         IF ASC-EXPDTE-CCYY (ASC-BLK-SUB ASC-ITEM-SUB) EQUAL ZERO 40610000
406200            MOVE SPACES   TO MR-EXPDTE-CCYY    (PV-SUB)           40620000
406300         ELSE                                                     40630000
406400            MOVE ASC-EXPDTE-CCYY (ASC-BLK-SUB ASC-ITEM-SUB)       40640000
406500                          TO MR-EXPDTE-CCYY    (PV-SUB)           40650000
406600         END-IF                                                   40660000
406700     END-IF.                                                      40670000
406800                                                                  40680000
406900     SUBTRACT +1 FROM ASC-ITEM-SUB.                               40690000
407000     IF  ASC-ITEM-SUB < + 1                                       40700000
407100         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  40710000
407200         MOVE +1                 TO ASC-BLK-SUB                   40720000
407300     END-IF.                                                      40730000
407400 EJECT                                                            40740000
407500*----------------------------------------------------------------*40750000
407600* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *40760000
407700* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *40770000
407800* FOR THE SELECTED ITEMS QUEUE.                                  *40780000
407900*                                                                *40790000
408000* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *40800000
408100* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *40810000
408200* THE ARRAY IS FULL.                                             *40820000
408300*----------------------------------------------------------------*40830000
408400                                                                  40840000
408500 5000-PREPARE-SEL-QUEUE.                                          40850000
408600                                                                  40860000
408700     MOVE +1                   TO  ASC-BLK-SUB.                   40870000
408800     PERFORM 5100-WRITE-TEMP-STORAGE.                             40880000
408900     ADD +1                    TO  ASC-BLK-SUB.                   40890000
409000     PERFORM 5100-WRITE-TEMP-STORAGE.                             40900000
409100                                                                  40910000
409200     MOVE ASC-SEL-QUEUE-NAME   TO  VN002-SEL-QUEUE-NAME.          40920000
409300     PERFORM 6010-DELETE-SEL-QUEUE.                               40930000
409400                                                                  40940000
409500     SET ASC-UPDATE-TSQ        TO  TRUE.                          40950000
409600                                                                  40960000
409700     SET VN003-IDX             TO  1.                             40970000
409800     MOVE ZERO                 TO VN002-NUMBER-OF-TS-ITEMS.       40980000
409900     INITIALIZE VN003-SELECTED-ITEM-ARRAY.                        40990000
410000                                                                  41000000
410100     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           41010000
410200             VARYING PV-ITEM                                      41020000
410300             FROM 1 BY 1                                          41030000
410400             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     41040000
410500                                                                  41050000
410600     IF  VN003-IDX > 1                                            41060000
410700         PERFORM 5205-WRITE-SEL-QUEUE                             41070000
410800         ADD +1                TO VN002-NUMBER-OF-TS-ITEMS        41080000
410900     END-IF.                                                      41090000
411000 EJECT                                                            41100000
411100*----------------------------------------------------------------*41110000
411200*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *41120000
411300*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *41130000
411400*----------------------------------------------------------------*41140000
411500                                                                  41150000
411600 5100-WRITE-TEMP-STORAGE.                                         41160000
411700     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     41170000
411800                                   TO PV-LIST-ITEM-NUMBER.        41180000
411900     COMPUTE PV-BLOCK-NUMBER =                                    41190000
412000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    41200000
412100                                                                  41210000
412200     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             41220000
412300     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             41230000
412400         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      41240000
412500             PERFORM 5105-REWRITE-ASC-LISTQ                       41250000
412600         END-IF                                                   41260000
412700     ELSE                                                         41270000
412800         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       41280000
412900         ASC-HIGHEST-BLOCK-WRITTEN + 1                            41290000
413000         PERFORM 5110-WRITE-ASC-LISTQ                             41300000
413100         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   41310000
413200     END-IF.                                                      41320000
413300                                                                  41330000
413400     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             41340000
413500******************************************************************41350000
413600** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **41360000
413700** SPECIFIC COMMAREA.                                           **41370000
413800******************************************************************41380000
413900 5105-REWRITE-ASC-LISTQ.                                          41390000
414000     EXEC CICS                                                    41400000
414100         WRITEQ TS                                                41410000
414200             QUEUE (ASC-LIST-QUEUE-NAME)                          41420000
414300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               41430000
414400             ITEM  (PV-BLOCK-NUMBER)                              41440000
414500             REWRITE                                              41450000
414600             RESP  (PV-CICS-RESP)                                 41460000
414700     END-EXEC.                                                    41470000
414800                                                                  41480000
414900     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           41490000
415000         CONTINUE                                                 41500000
415100     ELSE                                                         41510000
415200         SET DP013-CICS-ABEND            TO TRUE                  41520000
415300         SET DP013-NO-ROLLBACK           TO TRUE                  41530000
415400         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       41540000
415500         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     41550000
415600                                         TO DP013-MESSAGE-TEXT(1) 41560000
415700         PERFORM DP013-0000-PROCESS-ABEND                         41570000
415800     END-IF.                                                      41580000
415900                                                                  41590000
416000******************************************************************41600000
416100** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **41610000
416200** SPECIFIC COMMAREA.                                           **41620000
416300******************************************************************41630000
416400 5110-WRITE-ASC-LISTQ.                                            41640000
416500     EXEC CICS                                                    41650000
416600         WRITEQ TS                                                41660000
416700             QUEUE (ASC-LIST-QUEUE-NAME)                          41670000
416800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               41680000
416900             ITEM  (PV-BLOCK-NUMBER)                              41690000
417000             RESP  (PV-CICS-RESP)                                 41700000
417100     END-EXEC.                                                    41710000
417200     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      41720000
417300         SET DP013-CICS-ABEND      TO TRUE                        41730000
417400         SET DP013-NO-ROLLBACK     TO TRUE                        41740000
417500         MOVE '5110-WRITE-ASC-LISTQ'                              41750000
417600                                   TO DP013-PARAGRAPH             41760000
417700         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           41770000
417800                                   TO DP013-MESSAGE-TEXT(1)       41780000
417900         PERFORM DP013-0000-PROCESS-ABEND                         41790000
418000     END-IF.                                                      41800000
418100 EJECT                                                            41810000
418200*----------------------------------------------------------------*41820000
418300* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *41830000
418400* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *41840000
418500*----------------------------------------------------------------*41850000
418600                                                                  41860000
418700 5200-FILL-SEL-QUEUE-RECORD.                                      41870000
418800                                                                  41880000
418900     PERFORM 6112-READ-LIST-QUEUE.                                41890000
419000                                                                  41900000
419100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       41910000
419200         PERFORM                                                  41920000
419300         VARYING LQW-IDX                                          41930000
419400         FROM 1 BY 1                                              41940000
419500         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            41950000
419600           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          41960000
419700                                                                  41970000
419800             IF  LQW-SELECT (LQW-IDX)                             41980000
419900                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              41990000
420000                                   TO VN003-ITEM (VN003-IDX)      42000000
420100                 MOVE LQW-ENT-ID (LQW-IDX)                        42010000
420200                                   TO VN003-ENT-ID    (VN003-IDX) 42020000
420300                 MOVE SPACE        TO VN003-ACTION-SW (VN003-IDX) 42030000
420400                 SET VN003-IDX UP BY 1                            42040000
420500                 IF  VN003-IDX > VN003-MAX-ITEMS                  42050000
420600                     PERFORM 5205-WRITE-SEL-QUEUE                 42060000
420700                     ADD +1        TO VN002-NUMBER-OF-TS-ITEMS    42070000
420800                     INITIALIZE VN003-SELECTED-ITEM-ARRAY         42080000
420900                     SET VN003-IDX TO  1                          42090000
421000                 END-IF                                           42100000
421100             END-IF                                               42110000
421200         END-PERFORM                                              42120000
421300     END-IF.                                                      42130000
421400                                                                  42140000
421500*----------------------------------------------------------------*42150000
421600*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *42160000
421700*----------------------------------------------------------------*42170000
421800                                                                  42180000
421900 5205-WRITE-SEL-QUEUE.                                            42190000
422000                                                                  42200000
422100     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            42210000
422200                                   TO VN003-SELECTED-ITEMS.       42220000
422300                                                                  42230000
422400     EXEC CICS                                                    42240000
422500          WRITEQ TS                                               42250000
422600              QUEUE (ASC-SEL-QUEUE-NAME)                          42260000
422700              FROM  (VN003-VENDOR-SEL-REC)                        42270000
422800              ITEM  (PV-SEL-QUEUE-ITEM)                           42280000
422900              RESP  (PV-CICS-RESP)                                42290000
423000     END-EXEC.                                                    42300000
423100                                                                  42310000
423200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          42320000
423300         CONTINUE                                                 42330000
423400     ELSE                                                         42340000
423500         SET DP013-CICS-ABEND      TO TRUE                        42350000
423600         SET DP013-NO-ROLLBACK     TO TRUE                        42360000
423700         MOVE '5205-WRITE-SEL-QUEUE'                              42370000
423800                                   TO DP013-PARAGRAPH             42380000
423900         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          42390000
424000                                   TO DP013-MESSAGE-TEXT(1)       42400000
424100         PERFORM DP013-0000-PROCESS-ABEND                         42410000
424200     END-IF.                                                      42420000
424300 EJECT                                                            42430000
424400******************************************************************42440000
424500** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **42450000
424600** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **42460000
424700** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **42470000
424800** THE USER.                                                    **42480000
424900******************************************************************42490000
425000 6000-REFRESH-PANEL-FROM-TEMP.                                    42500000
425100     IF  ASC-UPDATE-TSQ                                           42510000
425200         SET ASC-NO-TSQ-UPDATE TO TRUE                            42520000
425300         MOVE ZERO                 TO PV-SAVE-ITEM                42530000
425400                                      PV-SEL-QUEUE-ITEM           42540000
425500         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        42550000
425600                                   TO PV-HOLD-SELECTED-ITEMS      42560000
425700         MOVE +1                   TO PV-ITEMS-PROCESSED          42570000
425800         PERFORM 6100-UPDATE-TSQ                                  42580000
425900             UNTIL PV-ITEMS-PROCESSED >                           42590000
426000                                     PV-HOLD-SELECTED-ITEMS       42600000
426100         PERFORM 6010-DELETE-SEL-QUEUE                            42610000
426200         INITIALIZE ASC-BLOCK-ENTRIES (1)                         42620000
426300                    ASC-BLOCK-ENTRIES (2)                         42630000
426400     END-IF.                                                      42640000
426500                                                                  42650000
426600*----------------------------------------------------------------*42660000
426700*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *42670000
426800*----------------------------------------------------------------*42680000
426900 6010-DELETE-SEL-QUEUE.                                           42690000
427000                                                                  42700000
427100     EXEC CICS                                                    42710000
427200         DELETEQ TS                                               42720000
427300             QUEUE (ASC-SEL-QUEUE-NAME)                           42730000
427400             RESP  (PV-CICS-RESP)                                 42740000
427500     END-EXEC.                                                    42750000
427600*                                                                 42760000
427700     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      42770000
427800        (PV-CICS-RESP = DFHRESP(QIDERR)))                         42780000
427900         CONTINUE                                                 42790000
428000     ELSE                                                         42800000
428100         SET DP013-CICS-ABEND TO TRUE                             42810000
428200         SET DP013-NO-ROLLBACK TO TRUE                            42820000
428300         MOVE '6010-DELETE-SEL-QUEUE'                             42830000
428400                        TO DP013-PARAGRAPH                        42840000
428500         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         42850000
428600                        TO DP013-MESSAGE-TEXT (1)                 42860000
428700         PERFORM DP013-0000-PROCESS-ABEND                         42870000
428800     END-IF.                                                      42880000
428900                                                                  42890000
429000*----------------------------------------------------------------*42900000
429100*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *42910000
429200*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *42920000
429300*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *42930000
429400*    THE TEMP QUEUE.                                             *42940000
429500*----------------------------------------------------------------*42950000
429600                                                                  42960000
429700 6100-UPDATE-TSQ.                                                 42970000
429800                                                                  42980000
429900     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             42990000
430000     PERFORM 6105-READ-SEL-QUEUE.                                 43000000
430100     PERFORM                                                      43010000
430200         VARYING VN003-IDX                                        43020000
430300         FROM 1 BY 1                                              43030000
430400         UNTIL ((PV-ITEMS-PROCESSED >                             43040000
430500                              PV-HOLD-SELECTED-ITEMS)             43050000
430600         OR (VN003-IDX GREATER THAN VN003-MAX-ITEMS))             43060000
430700         IF  VN003-ACTION-SW (VN003-IDX) > SPACE                  43070000
430800             PERFORM 6110-PROCESS-ITEMS                           43080000
430900         END-IF                                                   43090000
431000         ADD +1                TO PV-ITEMS-PROCESSED              43100000
431100     END-PERFORM.                                                 43110000
431200     PERFORM 6111-WRITE-LIST-QUEUE.                               43120000
431300*----------------------------------------------------------------*43130000
431400*    READ THE LIST QUEUE RECORD.                                 *43140000
431500*----------------------------------------------------------------*43150000
431600                                                                  43160000
431700 6105-READ-SEL-QUEUE.                                             43170000
431800                                                                  43180000
431900     EXEC CICS                                                    43190000
432000          READQ TS                                                43200000
432100              QUEUE (ASC-SEL-QUEUE-NAME)                          43210000
432200              INTO  (VN003-VENDOR-SEL-REC)                        43220000
432300              ITEM  (PV-SEL-QUEUE-ITEM)                           43230000
432400              RESP  (PV-CICS-RESP)                                43240000
432500     END-EXEC.                                                    43250000
432600*                                                                 43260000
432700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          43270000
432800         CONTINUE                                                 43280000
432900     ELSE                                                         43290000
433000         SET DP013-CICS-ABEND      TO  TRUE                       43300000
433100         SET DP013-NO-ROLLBACK     TO  TRUE                       43310000
433200         MOVE '6105-READ-SEL-QUEUE'                               43320000
433300                                   TO  DP013-PARAGRAPH            43330000
433400         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           43340000
433500                                   TO  DP013-MESSAGE-TEXT(1)      43350000
433600         PERFORM DP013-0000-PROCESS-ABEND                         43360000
433700     END-IF.                                                      43370000
433800 EJECT                                                            43380000
433900*----------------------------------------------------------------*43390000
434000*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*43400000
434100*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*43410000
434200*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *43420000
434300*----------------------------------------------------------------*43430000
434400                                                                  43440000
434500 6110-PROCESS-ITEMS.                                              43450000
434600                                                                  43460000
434700     COMPUTE PV-ITEM = 1 + ((VN003-ITEM (VN003-IDX) - 1)          43470000
434800                     / PC-ITEMS-PER-PANEL).                       43480000
434900                                                                  43490000
435000     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           43500000
435100         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          43510000
435200             PERFORM 6111-WRITE-LIST-QUEUE                        43520000
435300         END-IF                                                   43530000
435400         MOVE PV-ITEM          TO PV-SAVE-ITEM                    43540000
435500                                                                  43550000
435600         PERFORM 6112-READ-LIST-QUEUE                             43560000
435700         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               43570000
435800             CONTINUE                                             43580000
435900         END-IF                                                   43590000
436000     END-IF.                                                      43600000
436100                                                                  43610000
436200     COMPUTE PV-SUB = (VN003-ITEM (VN003-IDX)                     43620000
436300                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              43630000
436400     SET LQW-DESELECT (PV-SUB) TO    TRUE                         43640000
436500     MOVE LQW-SELECTED-SW (PV-SUB)                                43650000
436600                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  43660000
436700                                                                  43670000
436800     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                43680000
436900                                                                  43690000
437000*----------------------------------------------------------------*43700000
437100*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *43710000
437200*----------------------------------------------------------------*43720000
437300                                                                  43730000
437400 6111-WRITE-LIST-QUEUE.                                           43740000
437500                                                                  43750000
437600     EXEC CICS                                                    43760000
437700         WRITEQ TS                                                43770000
437800             QUEUE (ASC-LIST-QUEUE-NAME)                          43780000
437900             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     43790000
438000             ITEM  (PV-SAVE-ITEM)                                 43800000
438100             REWRITE                                              43810000
438200             RESP  (PV-CICS-RESP)                                 43820000
438300     END-EXEC.                                                    43830000
438400*                                                                 43840000
438500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          43850000
438600         CONTINUE                                                 43860000
438700     ELSE                                                         43870000
438800         SET DP013-CICS-ABEND  TO  TRUE                           43880000
438900         SET DP013-NO-ROLLBACK TO  TRUE                           43890000
439000         MOVE '6111-WRITE-LIST-QUEUE'                             43900000
439100                               TO  DP013-PARAGRAPH                43910000
439200         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  43920000
439300                               TO  DP013-MESSAGE-TEXT(1)          43930000
439400         PERFORM DP013-0000-PROCESS-ABEND                         43940000
439500     END-IF.                                                      43950000
439600                                                                  43960000
439700 EJECT                                                            43970000
439800*----------------------------------------------------------------*43980000
439900*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*43990000
440000*----------------------------------------------------------------*44000000
440100                                                                  44010000
440200 6112-READ-LIST-QUEUE.                                            44020000
440300                                                                  44030000
440400     EXEC CICS                                                    44040000
440500         READQ TS                                                 44050000
440600             QUEUE (ASC-LIST-QUEUE-NAME)                          44060000
440700             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     44070000
440800             ITEM  (PV-ITEM)                                      44080000
440900             RESP  (PV-CICS-RESP)                                 44090000
441000     END-EXEC.                                                    44100000
441100*                                                                 44110000
441200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          44120000
441300         CONTINUE                                                 44130000
441400     ELSE                                                         44140000
441500         SET DP013-CICS-ABEND        TO TRUE                      44150000
441600         SET DP013-NO-ROLLBACK       TO TRUE                      44160000
441700         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           44170000
441800         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    44180000
441900                                     TO DP013-MESSAGE-TEXT(1)     44190000
442000         PERFORM DP013-0000-PROCESS-ABEND                         44200000
442100     END-IF.                                                      44210000
442200                                                                  44220000
442300 EJECT                                                            44230000
442400/                                                                 44240000
442500*----------------------------------------------------------------*44250000
442600* PERFORM INSERT LOGIC                                           *44260000
442700*----------------------------------------------------------------*44270000
442800                                                                  44280000
442900 6700-INSERT-PROCESSING.                                          44290000
443000                                                                  44300000
443100     MOVE ASC-KEY-DEPT-NBR       TO DK-DEPT-NBR.                  44310000
443200     MOVE ASC-KEY-ENT-ID         TO DK-ENT-ID.                    44320000
443300     MOVE ASC-TRANCODE (ASC-BLK-SUB ASC-ITEM-SUB) TO PV-TRANCODE. 44330000
443400     MOVE ASC-SEQ-NBR (ASC-BLK-SUB ASC-ITEM-SUB)                  44340000
443500                                           TO VNDAGR-SEQ-NBR.     44350000
443600     MOVE ASC-FREQ-IND (ASC-BLK-SUB ASC-ITEM-SUB)                 44360000
443700                                  TO VNDAGR-PSTG-FRQ-CDE.         44370000
443800     MOVE ASC-NET-RTV (ASC-BLK-SUB ASC-ITEM-SUB)                  44380000
443900                                  TO VNDAGR-DED-RTV-IND.          44390000
444000     MOVE ASC-NET-DISC (ASC-BLK-SUB ASC-ITEM-SUB)                 44400000
444100                                  TO VNDAGR-DED-DISC-IND.         44410000
444200     COMPUTE VNDAGR-DISCOUNT-PCT =                                44420000
444300                 ASC-PERCENT (ASC-BLK-SUB ASC-ITEM-SUB) / 100.    44430000
444400     MOVE ASC-EFFDTE-MM(ASC-BLK-SUB ASC-ITEM-SUB)                 44440000
444500                                           TO PV-DB2-EFFDTE-MM.   44450000
444600     MOVE ASC-EFFDTE-DD(ASC-BLK-SUB ASC-ITEM-SUB)                 44460000
444700                                           TO PV-DB2-EFFDTE-DD.   44470000
444800     MOVE ASC-EFFDTE-CCYY(ASC-BLK-SUB ASC-ITEM-SUB)               44480000
444900                                           TO PV-DB2-EFFDTE-CCYY. 44490000
445000     MOVE '-'                              TO PV-DB2-EFFDTE-DASH1 44500000
445100                                              PV-DB2-EFFDTE-DASH2.44510000
445200     MOVE PV-DB2-EFFDTE                 TO VNDAGR-EFFECTIVE-DATE. 44520000
445300     MOVE ASC-EXPDTE-MM(ASC-BLK-SUB ASC-ITEM-SUB)                 44530000
445400                                           TO PV-DB2-EXPDTE-MM.   44540000
445500     MOVE ASC-EXPDTE-DD(ASC-BLK-SUB ASC-ITEM-SUB)                 44550000
445600                                           TO PV-DB2-EXPDTE-DD.   44560000
445700     MOVE ASC-EXPDTE-CCYY(ASC-BLK-SUB ASC-ITEM-SUB)               44570000
445800                                           TO PV-DB2-EXPDTE-CCYY. 44580000
445900     MOVE '-'                              TO PV-DB2-EXPDTE-DASH1 44590000
446000                                              PV-DB2-EXPDTE-DASH2.44600000
446100     MOVE PV-DB2-EXPDTE                 TO VNDAGR-EXPIRATION-DATE.44610000
446200     MOVE +1                               TO DN-DISCOUNT-PCT     44620000
446300                                              DN-EXPIRATION-DATE. 44630000
446400     MOVE ASC-ITEM-SUB                     TO PV-SUB.             44640000
446500                                                                  44650000
446600     PERFORM 7000-GET-MAX-SEQ-NBR.                                44660000
446700                                                                  44670000
446800     PERFORM 7300-CHECK-FOR-OVERLAP-AGMT.                         44680000
446900                                                                  44690000
447000     IF PS-NO-ERROR                                               44700000
447100        IF ASC-NO-CURR-ACTIVE-AGMT                                44710000
447200           PERFORM 7100-INSERT-TVNDAGR                            44720000
447300        ELSE                                                      44730000
447400* ADD NOT ALLOWED; AN ACTIVE/FUTURE AGMT WITH TRANCODE ALREADY    44740000
447500* EXISTS                                                          44750000
447600           MOVE DP015-UNP-ALP-BRT-OFF TO                          44760000
447700                  MR-SELECTA      (PV-SUB)                        44770000
447800                  MR-TRANCODEA    (PV-SUB)                        44780000
447900           MOVE DP015-RED TO                                      44790000
448000                  MR-SELECTC      (PV-SUB)                        44800000
448100                  MR-TRANCODEC    (PV-SUB)                        44810000
448200           MOVE DP015-REVERSE TO                                  44820000
448300                  MR-SELECTH      (PV-SUB)                        44830000
448400                  MR-TRANCODEH    (PV-SUB)                        44840000
448500           MOVE -1 TO MR-TRANCODEL    (PV-SUB)                    44850000
448600           SET DP030-SET-CURSOR-APPL-1 TO TRUE                    44860000
448700           IF PS-NO-ERROR                                         44870000
448800              MOVE PC-TSYMSG-03251 TO DP020-MSG-NUMBER            44880000
448900           END-IF                                                 44890000
449000           SET PS-ERROR            TO TRUE                        44900000
449100           SET DP020-MSG-FATAL     TO TRUE                        44910000
449200*          PERFORM 7310-SELECT-OVRLP-AGMT-EFFDATE                 44920000
449300*          IF VNDAGR-EFFECTIVE-DATE <= PV-EFFECTIVE-DATE          44930000
449400* ADD NOT ALLOWED; ENTERED AGMT EFFECT DATE <= CURRENT AGMT EFFECT44940000
449500* DATE                                                            44950000
449600*             MOVE DP015-UNP-ALP-BRT-OFF TO                       44960000
449700*                    MR-SELECTA      (PV-SUB)                     44970000
449800*                    MR-EFFDTE-MMA   (PV-SUB)                     44980000
449900*                    MR-EFFDTE-DDA   (PV-SUB)                     44990000
450000*                    MR-EFFDTE-CCYYA (PV-SUB)                     45000000
450100*             MOVE DP015-RED TO                                   45010000
450200*                    MR-SELECTC      (PV-SUB)                     45020000
450300*                    MR-EFFDTE-MMC   (PV-SUB)                     45030000
450400*                    MR-EFFDTE-DDC   (PV-SUB)                     45040000
450500*                    MR-EFFDTE-CCYYC (PV-SUB)                     45050000
450600*             MOVE DP015-REVERSE TO                               45060000
450700*                    MR-SELECTH      (PV-SUB)                     45070000
450800*                    MR-EFFDTE-MMH   (PV-SUB)                     45080000
450900*                    MR-EFFDTE-DDH   (PV-SUB)                     45090000
451000*                    MR-EFFDTE-CCYYH (PV-SUB)                     45100000
451100*             MOVE -1 TO MR-EFFDTE-MML   (PV-SUB)                 45110000
451200*             SET DP030-SET-CURSOR-APPL-1 TO TRUE                 45120000
451300*             IF PS-NO-ERROR                                      45130000
451400*                MOVE PC-TSYMSG-03145 TO DP020-MSG-NUMBER         45140000
451500*             END-IF                                              45150000
451600*             SET PS-ERROR            TO TRUE                     45160000
451700*             SET DP020-MSG-FATAL     TO TRUE                     45170000
451800*          ELSE                                                   45180000
451900*             PERFORM 7325-CALC-OVRLP-AGMT-EXPDTE                 45190000
452000*             IF PS-VALID-DATE                                    45200000
452100*                PERFORM 7500-UPDATE-OVRLP-AGMT-EXPDTE            45210000
452200*                PERFORM 7100-INSERT-TVNDAGR                      45220000
452300*             END-IF                                              45230000
452400*          END-IF                                                 45240000
452500        END-IF                                                    45250000
452600     END-IF.                                                      45260000
452700                                                                  45270000
452800*----------------------------------------------------------------*45280000
452900* PERFORM UPDATE LOGIC                                           *45290000
453000*----------------------------------------------------------------*45300000
453100                                                                  45310000
453200 6900-UPDATE-PROCESSING.                                          45320000
453300                                                                  45330000
453400     MOVE ASC-KEY-DEPT-NBR       TO DK-DEPT-NBR.                  45340000
453500     MOVE ASC-KEY-ENT-ID         TO DK-ENT-ID.                    45350000
453600     MOVE ASC-TRANCODE (ASC-BLK-SUB ASC-ITEM-SUB) TO PV-TRANCODE. 45360000
453700     MOVE ASC-SEQ-NBR (ASC-BLK-SUB ASC-ITEM-SUB)                  45370000
453800                                           TO VNDAGR-SEQ-NBR.     45380000
453900     MOVE ASC-FREQ-IND (ASC-BLK-SUB ASC-ITEM-SUB)                 45390000
454000                                  TO VNDAGR-PSTG-FRQ-CDE.         45400000
454100     MOVE ASC-NET-RTV (ASC-BLK-SUB ASC-ITEM-SUB)                  45410000
454200                                  TO VNDAGR-DED-RTV-IND.          45420000
454300     MOVE ASC-NET-DISC (ASC-BLK-SUB ASC-ITEM-SUB)                 45430000
454400                                  TO VNDAGR-DED-DISC-IND.         45440000
454500     COMPUTE VNDAGR-DISCOUNT-PCT =                                45450000
454600                 ASC-PERCENT (ASC-BLK-SUB ASC-ITEM-SUB) / 100.    45460000
454700     MOVE ASC-EFFDTE-MM(ASC-BLK-SUB ASC-ITEM-SUB)                 45470000
454800                                           TO PV-DB2-EFFDTE-MM.   45480000
454900     MOVE ASC-EFFDTE-DD(ASC-BLK-SUB ASC-ITEM-SUB)                 45490000
455000                                           TO PV-DB2-EFFDTE-DD.   45500000
455100     MOVE ASC-EFFDTE-CCYY(ASC-BLK-SUB ASC-ITEM-SUB)               45510000
455200                                           TO PV-DB2-EFFDTE-CCYY. 45520000
455300     MOVE '-'                              TO PV-DB2-EFFDTE-DASH1 45530000
455400                                              PV-DB2-EFFDTE-DASH2.45540000
455500     MOVE PV-DB2-EFFDTE                 TO VNDAGR-EFFECTIVE-DATE. 45550000
455600     MOVE ASC-EXPDTE-MM(ASC-BLK-SUB ASC-ITEM-SUB)                 45560000
455700                                           TO PV-DB2-EXPDTE-MM.   45570000
455800     MOVE ASC-EXPDTE-DD(ASC-BLK-SUB ASC-ITEM-SUB)                 45580000
455900                                           TO PV-DB2-EXPDTE-DD.   45590000
456000     MOVE ASC-EXPDTE-CCYY(ASC-BLK-SUB ASC-ITEM-SUB)               45600000
456100                                           TO PV-DB2-EXPDTE-CCYY. 45610000
456200     MOVE '-'                              TO PV-DB2-EXPDTE-DASH1 45620000
456300                                              PV-DB2-EXPDTE-DASH2.45630000
456400     MOVE PV-DB2-EXPDTE                 TO VNDAGR-EXPIRATION-DATE.45640000
456500     MOVE +1                               TO DN-DISCOUNT-PCT     45650000
456600                                              DN-EXPIRATION-DATE. 45660000
456700                                                                  45670000
456800     IF ASC-FREQ-IND-CHANGED (ASC-BLK-SUB ASC-ITEM-SUB) OR        45680000
456900        ASC-PERCENT-CHANGED (ASC-BLK-SUB ASC-ITEM-SUB)            45690000
457000        IF ASC-EFF-MM-NOT-CHANGED (ASC-BLK-SUB ASC-ITEM-SUB) AND  45700000
457100           ASC-EFF-DD-NOT-CHANGED (ASC-BLK-SUB ASC-ITEM-SUB) AND  45710000
457200           ASC-EFF-CY-NOT-CHANGED (ASC-BLK-SUB ASC-ITEM-SUB)      45720000
457300* EFFECTIVE DATE MUST BE KEYED WHEN UPDATING PERCENT OR POSTING   45730000
457400* FREQ                                                            45740000
457500           MOVE ASC-ITEM-SUB        TO PV-SUB                     45750000
457600           MOVE DP015-UNP-ALP-BRT-OFF                             45760000
457700                                   TO MR-PERCENTA     (PV-SUB)    45770000
457800                                      MR-FREQ-INDA    (PV-SUB)    45780000
457900                                      MR-EFFDTE-MMA   (PV-SUB)    45790000
458000                                      MR-EFFDTE-DDA   (PV-SUB)    45800000
458100                                      MR-EFFDTE-CCYYA (PV-SUB)    45810000
458200           MOVE DP015-REVERSE      TO MR-PERCENTH     (PV-SUB)    45820000
458300                                      MR-FREQ-INDH    (PV-SUB)    45830000
458400                                      MR-EFFDTE-MMH   (PV-SUB)    45840000
458500                                      MR-EFFDTE-DDH   (PV-SUB)    45850000
458600                                      MR-EFFDTE-CCYYH (PV-SUB)    45860000
458700           MOVE DP015-RED          TO MR-PERCENTC     (PV-SUB)    45870000
458800                                      MR-FREQ-INDC    (PV-SUB)    45880000
458900                                      MR-EFFDTE-MMC   (PV-SUB)    45890000
459000                                      MR-EFFDTE-DDC   (PV-SUB)    45900000
459100                                      MR-EFFDTE-CCYYC (PV-SUB)    45910000
459200           MOVE -1                 TO MR-EFFDTE-MML   (PV-SUB)    45920000
459300           SET DP030-SET-CURSOR-APPL-1 TO TRUE                    45930000
459400           IF PS-NO-ERROR                                         45940000
459500              MOVE PC-TSYMSG-03252 TO DP020-MSG-NUMBER            45950000
459600           END-IF                                                 45960000
459700           SET PS-ERROR            TO TRUE                        45970000
459800           SET DP020-MSG-FATAL     TO TRUE                        45980000
459900        ELSE                                                      45990000
460000           PERFORM 7200-EXPIRE-TVNDAGR                            46000000
460100           PERFORM 7000-GET-MAX-SEQ-NBR                           46010000
460200           PERFORM 7350-SEE-IF-ROW-EXISTS                         46020000
460300           IF ASC-NO-OVERLAPPING-DATES                            46030000
460400              IF VNDAGR-EFFECTIVE-DATE > ASC-CURRENT-DATE         46040000
460500                 PERFORM 7400-UPDATE-TVNDAGR                      46050000
460600              ELSE                                                46060000
460700                 PERFORM 7100-INSERT-TVNDAGR                      46070000
460800              END-IF                                              46080000
460900           ELSE                                                   46090000
461000*  UPDATE THE FUTURE EFFECTIVE DATE ROW FOR THE TRANCODE THAT WAS 46100000
461100*  SELECTED, RATHER THAN EXPIRE IT AND INSERT A NEW ROW           46110000
461200              IF (VNDAGR-EFFECTIVE-DATE >= ASC-CURRENT-DATE) AND  46120000
461300                 (PV-OVERLAP-COUNT = +1)                          46130000
461400                 PERFORM 7400-UPDATE-TVNDAGR                      46140000
461500              ELSE                                                46150000
461600*  OVERLAPPING AGREEMENTS WERE FOUND FOR THIS TRANCODE            46160000
461700                 SET PS-ERROR               TO TRUE               46170000
461800                 SET DP020-MSG-FATAL        TO TRUE               46180000
461900                 MOVE ASC-ITEM-SUB          TO PV-SUB             46190000
462000                 MOVE PC-TSYMSG-03114       TO DP020-MSG-NUMBER   46200000
462100                 MOVE -1                    TO MR-SELECTL (PV-SUB)46210000
462200                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              46220000
462300                 MOVE DP015-RED             TO MR-SELECTC (PV-SUB)46230000
462400                 MOVE DP015-REVERSE         TO MR-SELECTH (PV-SUB)46240000
462500                 MOVE DP015-UNP-ALP-BRT-OFF TO MR-SELECTA (PV-SUB)46250000
462600              END-IF                                              46260000
462700           END-IF                                                 46270000
462800        END-IF                                                    46280000
462900     ELSE                                                         46290000
463000        PERFORM 7400-UPDATE-TVNDAGR                               46300000
463100     END-IF.                                                      46310000
463200                                                                  46320000
463300*    PERFORM 7200-EXPIRE-TVNDAGR.                                 46330000
463400                                                                  46340000
463500*       PERFORM 7000-GET-MAX-SEQ-NBR.                             46350000
463600*       PERFORM 7350-SEE-IF-ROW-EXISTS.                           46360000
463700*       IF ASC-NO-OVERLAPPING-DATES                               46370000
463800*          IF VNDAGR-EFFECTIVE-DATE > ASC-CURRENT-DATE            46380000
463900*             PERFORM 7400-UPDATE-TVNDAGR                         46390000
464000*          ELSE                                                   46400000
464100*             PERFORM 7100-INSERT-TVNDAGR                         46410000
464200*          END-IF                                                 46420000
464300*       ELSE                                                      46430000
464400*  UPDATE THE FUTURE EFFECTIVE DATE ROW FOR THE TRANCODE THAT WAS 46440000
464500*  SELECTED, RATHER THAN EXPIRE IT AND INSERT A NEW ROW           46450000
464600*          IF (VNDAGR-EFFECTIVE-DATE >= ASC-CURRENT-DATE) AND     46460000
464700*             (PV-OVERLAP-COUNT = +1)                             46470000
464800*             PERFORM 7400-UPDATE-TVNDAGR                         46480000
464900*          ELSE                                                   46490000
465000*  OVERLAPPING AGREEMENTS WERE FOUND FOR THIS TRANCODE            46500000
465100*             SET PS-ERROR               TO TRUE                  46510000
465200*             SET DP020-MSG-FATAL        TO TRUE                  46520000
465300*             MOVE ASC-ITEM-SUB          TO PV-SUB                46530000
465400*             MOVE PC-TSYMSG-03114       TO DP020-MSG-NUMBER      46540000
465500*             MOVE -1                    TO MR-SELECTL (PV-SUB)   46550000
465600*             SET DP030-SET-CURSOR-APPL-1 TO TRUE                 46560000
465700*             MOVE DP015-RED             TO MR-SELECTC (PV-SUB)   46570000
465800*             MOVE DP015-REVERSE         TO MR-SELECTH (PV-SUB)   46580000
465900*             MOVE DP015-UNP-ALP-BRT-OFF TO MR-SELECTA (PV-SUB)   46590000
466000*          END-IF                                                 46600000
466100*       END-IF.                                                   46610000
466200                                                                  46620000
466300/                                                                 46630000
466400*----------------------------------------------------------------*46640000
466500*    FIND THE ROW WITH THE HIGHEST SEQUENCE NUMBER               *46650000
466600*----------------------------------------------------------------*46660000
466700                                                                  46670000
466800 7000-GET-MAX-SEQ-NBR.                                            46680000
466900                                                                  46690000
467000     PERFORM                                                      46700000
467100         WITH TEST AFTER                                          46710000
467200         VARYING PV-RETRY-COUNTER                                 46720000
467300         FROM 1 BY 1                                              46730000
467400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               46740000
467500             OR (SQLCODE = +0)                                    46750000
467600             OR (SQLCODE = -305))                                 46760000
467700                                                                  46770000
467800         EXEC SQL                                                 46780000
467900              SELECT MAX(SEQ_NBR)                                 46790000
468000                INTO :PV-MAX-SEQ-NBR                              46800000
468100                FROM TVNDAGR                                      46810000
468200               WHERE DEPT_NBR          = :DK-DEPT-NBR             46820000
468300                 AND ENT_ID            = :DK-ENT-ID               46830000
468400                 AND AGRMT_TYP_ID      = '6'                      46840000
468500         END-EXEC                                                 46850000
468600                                                                  46860000
468700         EVALUATE TRUE                                            46870000
468800             WHEN SQLCODE = +0                                    46880000
468900                  COMPUTE PV-NEXT-SEQ-NBR =                       46890000
469000                          PV-MAX-SEQ-NBR + 1                      46900000
469100             WHEN SQLCODE = -305                                  46910000
469200                  MOVE +1         TO PV-NEXT-SEQ-NBR              46920000
469300                                                                  46930000
469400             WHEN SQLCODE = -904                                  46940000
469500             WHEN SQLCODE = -913                                  46950000
469600                  CONTINUE                                        46960000
469700                                                                  46970000
469800             WHEN SQLWARN0 NOT = SPACES                           46980000
469900             WHEN SQLCODE < +0                                    46990000
470000             WHEN SQLCODE > +0                                    47000000
470100                  MOVE '7000-GET-MAX-SEQ-NBR'                     47010000
470200                                  TO DP013-PARAGRAPH              47020000
470300                  MOVE 'UNSUCCESSFUL SELECT MAX SEQ NBR'          47030000
470400                                  TO DP013-MESSAGE-TEXT (1)       47040000
470500                  MOVE SQLCA      TO DP013-SQLCA                  47050000
470600                  MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)     47060000
470700                  SET DP013-DB2-ABEND                             47070000
470800                      DP013-XCTL-DISPLAY-RESTART                  47080000
470900                                  TO TRUE                         47090000
471000                  PERFORM DP013-0000-PROCESS-ABEND                47100000
471100         END-EVALUATE                                             47110000
471200     END-PERFORM.                                                 47120000
471300                                                                  47130000
471400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        47140000
471500         MOVE '7000-GET-MAX-SEQ-NBR'                              47150000
471600                                  TO DP013-PARAGRAPH              47160000
471700         MOVE 'MAX RETRIES EXCEEDED ON SELECT MAX SEQ NBR'        47170000
471800                                  TO DP013-MESSAGE-TEXT (1)       47180000
471900         MOVE SQLCA               TO DP013-SQLCA                  47190000
472000         MOVE 'TVNDAGR '          TO DP013-DB2-TABLE-NAME (1)     47200000
472100         SET DP013-DB2-ABEND                                      47210000
472200             DP013-XCTL-DISPLAY-RESTART                           47220000
472300                                  TO TRUE                         47230000
472400         PERFORM DP013-0000-PROCESS-ABEND                         47240000
472500     END-IF.                                                      47250000
472600                                                                  47260000
472700/                                                                 47270000
472800*----------------------------------------------------------------*47280000
472900*    INSERT A PROGRAM ROW                                        *47290000
473000*----------------------------------------------------------------*47300000
473100*                                                                 47310000
473200 7100-INSERT-TVNDAGR.                                             47320000
473300                                                                  47330000
473400     PERFORM                                                      47340000
473500         WITH TEST AFTER                                          47350000
473600         VARYING PV-RETRY-COUNTER                                 47360000
473700         FROM 1 BY 1                                              47370000
473800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               47380000
473900             OR (SQLCODE = +0))                                   47390000
474000                                                                  47400000
474100         EXEC SQL                                                 47410000
474200              INSERT INTO TVNDAGR                                 47420000
474300                     ( ENT_ID                                     47430000
474400                      ,DEPT_NBR                                   47440000
474500                      ,AGRMT_TYP_ID                               47450000
474600                      ,SEQ_NBR                                    47460000
474700                      ,TYP_CDE                                    47470000
474800                      ,EFFECTIVE_DATE                             47480000
474900                      ,EXPIRATION_DATE                            47490000
475000                      ,DISCOUNT_PCT                               47500000
475100                      ,LAST_UPD_TMST                              47510000
475200                      ,LAST_UPD_ID                                47520000
475300                      ,AP_TRN_CDE                                 47530000
475400                      ,PSTG_FRQ_CDE                               47540000
475500                      ,DED_DISC_IND                               47550000
475600                      ,DED_RTV_IND )                              47560000
475700              VALUES ( :DK-ENT-ID                                 47570000
475800                      ,:DK-DEPT-NBR                               47580000
475900                      ,'6'                                        47590000
476000                      ,:PV-NEXT-SEQ-NBR                           47600000
476100                      ,6                                          47610000
476200                      ,:VNDAGR-EFFECTIVE-DATE                     47620000
476300                      ,:VNDAGR-EXPIRATION-DATE                    47630000
476400                         :DN-EXPIRATION-DATE                      47640000
476500                      ,:VNDAGR-DISCOUNT-PCT                       47650000
476600                         :DN-DISCOUNT-PCT                         47660000
476700                      ,CURRENT TIMESTAMP                          47670000
476800                      ,:DP020-USERID                              47680000
476900                      ,:PV-TRANCODE                               47690000
477000                      ,:VNDAGR-PSTG-FRQ-CDE                       47700000
477100                      ,:VNDAGR-DED-DISC-IND                       47710000
477200                      ,:VNDAGR-DED-RTV-IND )                      47720000
477300         END-EXEC                                                 47730000
477400                                                                  47740000
477500         EVALUATE TRUE                                            47750000
477600             WHEN SQLCODE = +0                                    47760000
477700             WHEN SQLCODE = -904                                  47770000
477800             WHEN SQLCODE = -913                                  47780000
477900                  CONTINUE                                        47790000
478000                                                                  47800000
478100             WHEN SQLWARN0 NOT = SPACES                           47810000
478200             WHEN SQLCODE < +0                                    47820000
478300             WHEN SQLCODE > +0                                    47830000
478400                  MOVE '7100-INSERT-TVNDAGR'                      47840000
478500                                  TO DP013-PARAGRAPH              47850000
478600                  MOVE 'UNSUCCESSFUL INSERT FOR TVNDAGR'          47860000
478700                                  TO DP013-MESSAGE-TEXT (1)       47870000
478800                  MOVE SQLCA      TO DP013-SQLCA                  47880000
478900                  MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)     47890000
479000                  SET DP013-DB2-ABEND                             47900000
479100                      DP013-XCTL-DISPLAY-RESTART                  47910000
479200                                  TO TRUE                         47920000
479300                  PERFORM DP013-0000-PROCESS-ABEND                47930000
479400         END-EVALUATE                                             47940000
479500     END-PERFORM.                                                 47950000
479600                                                                  47960000
479700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        47970000
479800         MOVE '7100-INSERT-TVNDAGR'                               47980000
479900                                  TO DP013-PARAGRAPH              47990000
480000         MOVE 'MAX RETRIES EXCEEDED FOR INSERT ON TVNDAGR'        48000000
480100                                  TO DP013-MESSAGE-TEXT (1)       48010000
480200         MOVE SQLCA               TO DP013-SQLCA                  48020000
480300         MOVE 'TVNDAGR '          TO DP013-DB2-TABLE-NAME (1)     48030000
480400         SET DP013-DB2-ABEND                                      48040000
480500             DP013-XCTL-DISPLAY-RESTART                           48050000
480600                                  TO TRUE                         48060000
480700         PERFORM DP013-0000-PROCESS-ABEND                         48070000
480800     END-IF.                                                      48080000
480900                                                                  48090000
481000/                                                                 48100000
481100*----------------------------------------------------------------*48110000
481200*    "DELETE" THE ROW - EXPIRE THE ROW ON THE TABLE              *48120000
481300*----------------------------------------------------------------*48130000
481400                                                                  48140000
481500 7200-EXPIRE-TVNDAGR.                                             48150000
481600                                                                  48160000
481700     PERFORM 7210-SELECT-ORIGINAL-EFFDATE.                        48170000
481800                                                                  48180000
481900**   IF PV-ORIGINAL-EFFDTE = ASC-CURRENT-DATE OR                  48190000
482000**                           ASC-CURR-DATE-1DAY                   48200000
482100**      PERFORM 7250-FUTURE-EFFDTE-EXPIRE                         48210000
482200**   END-IF.                                                      48220000
482300                                                                  48230000
482400**   IF PV-ORIGINAL-EFFDTE < VNDAGR-EFFECTIVE-DATE                48240000
482500     IF PV-ORIGINAL-EFFDTE < ASC-CURRENT-DATE                     48250000
482600        PERFORM 7325-CALC-OVRLP-AGMT-EXPDTE                       48260000
482700        PERFORM                                                   48270000
482800            WITH TEST AFTER                                       48280000
482900            VARYING PV-RETRY-COUNTER                              48290000
483000            FROM 1 BY 1                                           48300000
483100            UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)            48310000
483200                OR (SQLCODE = +0))                                48320000
483300                                                                  48330000
483400            EXEC SQL                                              48340000
483500                 UPDATE TVNDAGR                                   48350000
483600                    SET EXPIRATION_DATE = :PV-CALC-EXPDTE         48360000
483700*                   SET EXPIRATION_DATE = :ASC-CURR-DATE-1DAY     48370000
483800**                  SET EXPIRATION_DATE = :VNDAGR-EFFECTIVE-DATE  48380000
483900                                         :DN-EXPIRATION-DATE      48390000
484000                       ,LAST_UPD_TMST   = CURRENT TIMESTAMP       48400000
484100                       ,LAST_UPD_ID     = :DP020-USERID           48410000
484200                  WHERE DEPT_NBR          = :DK-DEPT-NBR          48420000
484300                    AND ENT_ID            = :DK-ENT-ID            48430000
484400                    AND AGRMT_TYP_ID      = '6'                   48440000
484500                    AND SEQ_NBR           = :VNDAGR-SEQ-NBR       48450000
484600                    AND TYP_CDE           = 6                     48460000
484700            END-EXEC                                              48470000
484800                                                                  48480000
484900            EVALUATE TRUE                                         48490000
485000                WHEN SQLCODE = +0                                 48500000
485100*                    MOVE ASC-CURRENT-DATE TO                     48510000
485200*                         VNDAGR-EFFECTIVE-DATE                   48520000
485300                                                                  48530000
485400                WHEN SQLCODE = -904                               48540000
485500                WHEN SQLCODE = -913                               48550000
485600                     CONTINUE                                     48560000
485700                                                                  48570000
485800                WHEN SQLWARN0 NOT = SPACES                        48580000
485900                WHEN SQLCODE < +0                                 48590000
486000                WHEN SQLCODE > +0                                 48600000
486100                     MOVE '7200-EXPIRE-TVNDAGR'                   48610000
486200                                     TO DP013-PARAGRAPH           48620000
486300                     MOVE 'UNSUCCESSFUL UPDATE ON TVNDAGR'        48630000
486400                                     TO DP013-MESSAGE-TEXT (1)    48640000
486500                     MOVE SQLCA      TO DP013-SQLCA               48650000
486600                     MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)  48660000
486700                     SET DP013-DB2-ABEND                          48670000
486800                         DP013-XCTL-DISPLAY-RESTART               48680000
486900                                     TO TRUE                      48690000
487000                     PERFORM DP013-0000-PROCESS-ABEND             48700000
487100            END-EVALUATE                                          48710000
487200        END-PERFORM                                               48720000
487300                                                                  48730000
487400        IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                     48740000
487500            MOVE '7200-EXPIRE-TVNDAGR'                            48750000
487600                                     TO DP013-PARAGRAPH           48760000
487700            MOVE 'MAX RETRIES EXCEEDED ON UPDATE TVNDAGR'         48770000
487800                                     TO DP013-MESSAGE-TEXT (1)    48780000
487900            MOVE SQLCA               TO DP013-SQLCA               48790000
488000            MOVE 'TVNDAGR '          TO DP013-DB2-TABLE-NAME (1)  48800000
488100            SET DP013-DB2-ABEND                                   48810000
488200                DP013-XCTL-DISPLAY-RESTART                        48820000
488300                                     TO TRUE                      48830000
488400            PERFORM DP013-0000-PROCESS-ABEND                      48840000
488500        END-IF                                                    48850000
488600**   ELSE                                                         48860000
488700**UPDATE NOT ALLOWED; ENTERED EFFECTIVE DATE < ORIGINAL EFFECTIVE 48870000
488800**DATE                                                            48880000
488900**      MOVE DP015-UNP-ALP-BRT-OFF TO                             48890000
489000**             MR-EFFDTE-MMA   (PV-SUB)                           48900000
489100**             MR-EFFDTE-DDA   (PV-SUB)                           48910000
489200**             MR-EFFDTE-CCYYA (PV-SUB)                           48920000
489300**      MOVE DP015-RED TO                                         48930000
489400**             MR-EFFDTE-MMC   (PV-SUB)                           48940000
489500**             MR-EFFDTE-DDC   (PV-SUB)                           48950000
489600**             MR-EFFDTE-CCYYC (PV-SUB)                           48960000
489700**      MOVE DP015-REVERSE TO                                     48970000
489800**             MR-EFFDTE-MMH   (PV-SUB)                           48980000
489900**             MR-EFFDTE-DDH   (PV-SUB)                           48990000
490000**             MR-EFFDTE-CCYYH (PV-SUB)                           49000000
490100**      MOVE -1 TO MR-EFFDTE-MML   (PV-SUB)                       49010000
490200**      SET DP030-SET-CURSOR-APPL-1 TO TRUE                       49020000
490300**      IF PS-NO-ERROR                                            49030000
490400**         MOVE PC-TSYMSG-03144 TO DP020-MSG-NUMBER               49040000
490500**      END-IF                                                    49050000
490600**      SET PS-ERROR            TO TRUE                           49060000
490700**      SET DP020-MSG-FATAL     TO TRUE                           49070000
490800     END-IF.                                                      49080000
490900                                                                  49090000
491000/                                                                 49100000
491100*----------------------------------------------------------------*49110000
491200*    "DELETE" THE ROW - SELECT THE ORIGINAL EFFECTIVE DATE OF THE*49120000
491300*    ROW THAT WILL BE EXPIRED.  THIS EFFECTIVE DATE WILL BE      *49130000
491400*    COMPARED TO ENTERED EFFECTIVE DATE.                         *49140000
491500*----------------------------------------------------------------*49150000
491600                                                                  49160000
491700 7210-SELECT-ORIGINAL-EFFDATE.                                    49170000
491800                                                                  49180000
491900     MOVE SPACES TO PV-ORIGINAL-EFFDTE.                           49190000
492000     MOVE ASC-KEY-DEPT-NBR       TO DK-DEPT-NBR.                  49200000
492100     MOVE ASC-KEY-ENT-ID         TO DK-ENT-ID.                    49210000
492200     MOVE ASC-SEQ-NBR (ASC-BLK-SUB ASC-ITEM-SUB)                  49220000
492300                                 TO VNDAGR-SEQ-NBR.               49230000
492400                                                                  49240000
492500     PERFORM                                                      49250000
492600         WITH TEST AFTER                                          49260000
492700         VARYING PV-RETRY-COUNTER                                 49270000
492800         FROM 1 BY 1                                              49280000
492900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               49290000
493000             OR (SQLCODE = +0))                                   49300000
493100                                                                  49310000
493200         EXEC SQL                                                 49320000
493300              SELECT EFFECTIVE_DATE                               49330000
493400                INTO :PV-ORIGINAL-EFFDTE                          49340000
493500                FROM TVNDAGR                                      49350000
493600               WHERE DEPT_NBR          = :DK-DEPT-NBR             49360000
493700                 AND ENT_ID            = :DK-ENT-ID               49370000
493800                 AND AGRMT_TYP_ID      = '6'                      49380000
493900                 AND SEQ_NBR           = :VNDAGR-SEQ-NBR          49390000
494000                 AND TYP_CDE           = 6                        49400000
494100         END-EXEC                                                 49410000
494200                                                                  49420000
494300         EVALUATE TRUE                                            49430000
494400             WHEN SQLCODE = +0                                    49440000
494500             WHEN SQLCODE = -904                                  49450000
494600             WHEN SQLCODE = -913                                  49460000
494700                  CONTINUE                                        49470000
494800                                                                  49480000
494900             WHEN SQLWARN0 NOT = SPACES                           49490000
495000             WHEN SQLCODE < +0                                    49500000
495100             WHEN SQLCODE > +0                                    49510000
495200                  MOVE '7210-SELECT-ORIGINAL-EFFDATE'             49520000
495300                                  TO DP013-PARAGRAPH              49530000
495400                  MOVE 'UNSUCCESSFUL SELECT ON TVNDAGR'           49540000
495500                                  TO DP013-MESSAGE-TEXT (1)       49550000
495600                  MOVE SQLCA      TO DP013-SQLCA                  49560000
495700                  MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)     49570000
495800                  SET DP013-DB2-ABEND                             49580000
495900                      DP013-XCTL-DISPLAY-RESTART                  49590000
496000                                  TO TRUE                         49600000
496100                  PERFORM DP013-0000-PROCESS-ABEND                49610000
496200         END-EVALUATE                                             49620000
496300     END-PERFORM.                                                 49630000
496400                                                                  49640000
496500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        49650000
496600         MOVE '7210-SELECT-ORIGINAL-EFFDATE'                      49660000
496700                                  TO DP013-PARAGRAPH              49670000
496800         MOVE 'MAX RETRIES EXCEEDED ON SELECT TVNDAGR'            49680000
496900                                  TO DP013-MESSAGE-TEXT (1)       49690000
497000         MOVE SQLCA               TO DP013-SQLCA                  49700000
497100         MOVE 'TVNDAGR '          TO DP013-DB2-TABLE-NAME (1)     49710000
497200         SET DP013-DB2-ABEND                                      49720000
497300             DP013-XCTL-DISPLAY-RESTART                           49730000
497400                                  TO TRUE                         49740000
497500         PERFORM DP013-0000-PROCESS-ABEND                         49750000
497600     END-IF.                                                      49760000
497700                                                                  49770000
497800/                                                                 49780000
497900*----------------------------------------------------------------*49790000
498000*    SELECT THE ORIGINAL EXPIRATION DATE OF THE ROW THAT IS BEING*49800000
498100*    SELECTED FOR AN UPDATE.                                     *49810000
498200*----------------------------------------------------------------*49820000
498300                                                                  49830000
498400 7220-SELECT-ORIGINAL-EXPDATE.                                    49840000
498500                                                                  49850000
498600     MOVE SPACES TO PV-ORIGINAL-EXPDTE.                           49860000
498700     MOVE ASC-KEY-DEPT-NBR       TO DK-DEPT-NBR.                  49870000
498800     MOVE ASC-KEY-ENT-ID         TO DK-ENT-ID.                    49880000
498900     MOVE ASC-SEQ-NBR (ASC-BLK-SUB ASC-ITEM-SUB) TO PV-SEQ-NBR.   49890000
499000                                                                  49900000
499100     PERFORM                                                      49910000
499200         WITH TEST AFTER                                          49920000
499300         VARYING PV-RETRY-COUNTER                                 49930000
499400         FROM 1 BY 1                                              49940000
499500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               49950000
499600             OR (SQLCODE = +0)                                    49960000
499700             OR (SQLCODE = +100))                                 49970000
499800                                                                  49980000
499900         EXEC SQL                                                 49990000
500000              SELECT EXPIRATION_DATE                              50000000
500100                INTO :PV-ORIGINAL-EXPDTE                          50010000
500200                FROM TVNDAGR                                      50020000
500300               WHERE DEPT_NBR          = :DK-DEPT-NBR             50030000
500400                 AND ENT_ID            = :DK-ENT-ID               50040000
500500                 AND AGRMT_TYP_ID      = '6'                      50050000
500600                 AND SEQ_NBR           = :PV-SEQ-NBR              50060000
500700                 AND TYP_CDE           = 6                        50070000
500800         END-EXEC                                                 50080000
500900                                                                  50090000
501000         EVALUATE TRUE                                            50100000
501100             WHEN SQLCODE = +0                                    50110000
501200             WHEN SQLCODE = -904                                  50120000
501300             WHEN SQLCODE = -913                                  50130000
501400                  CONTINUE                                        50140000
501500                                                                  50150000
501600             WHEN SQLCODE = +100                                  50160000
501700* UPDATE NOT VALID WHEN ADDING A NEW AGREEMENT                    50170000
501800                  MOVE DP015-UNP-ALP-BRT-OFF TO                   50180000
501900                         MR-SELECTA      (PV-SUB)                 50190000
502000                  MOVE DP015-RED     TO                           50200000
502100                         MR-SELECTC      (PV-SUB)                 50210000
502200                  MOVE DP015-REVERSE TO                           50220000
502300                         MR-SELECTH      (PV-SUB)                 50230000
502400                  MOVE -1 TO MR-SELECTL  (PV-SUB)                 50240000
502500                  SET DP030-SET-CURSOR-APPL-1 TO TRUE             50250000
502600                  IF PS-NO-ERROR                                  50260000
502700                     MOVE PC-TSYMSG-03146 TO DP020-MSG-NUMBER     50270000
502800                  END-IF                                          50280000
502900                  SET PS-ERROR            TO TRUE                 50290000
503000                  SET DP020-MSG-FATAL     TO TRUE                 50300000
503100                                                                  50310000
503200             WHEN SQLWARN0 NOT = SPACES                           50320000
503300             WHEN SQLCODE < +0                                    50330000
503400             WHEN SQLCODE > +0                                    50340000
503500                  MOVE '7220-SELECT-ORIGINAL-EXPDATE'             50350000
503600                                  TO DP013-PARAGRAPH              50360000
503700                  MOVE 'UNSUCCESSFUL SELECT ON TVNDAGR'           50370000
503800                                  TO DP013-MESSAGE-TEXT (1)       50380000
503900                  MOVE SQLCA      TO DP013-SQLCA                  50390000
504000                  MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)     50400000
504100                  SET DP013-DB2-ABEND                             50410000
504200                      DP013-XCTL-DISPLAY-RESTART                  50420000
504300                                  TO TRUE                         50430000
504400                  PERFORM DP013-0000-PROCESS-ABEND                50440000
504500         END-EVALUATE                                             50450000
504600     END-PERFORM.                                                 50460000
504700                                                                  50470000
504800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        50480000
504900         MOVE '7220-SELECT-ORIGINAL-EXPDATE'                      50490000
505000                                  TO DP013-PARAGRAPH              50500000
505100         MOVE 'MAX RETRIES EXCEEDED ON SELECT TVNDAGR'            50510000
505200                                  TO DP013-MESSAGE-TEXT (1)       50520000
505300         MOVE SQLCA               TO DP013-SQLCA                  50530000
505400         MOVE 'TVNDAGR '          TO DP013-DB2-TABLE-NAME (1)     50540000
505500         SET DP013-DB2-ABEND                                      50550000
505600             DP013-XCTL-DISPLAY-RESTART                           50560000
505700                                  TO TRUE                         50570000
505800         PERFORM DP013-0000-PROCESS-ABEND                         50580000
505900     END-IF.                                                      50590000
506000                                                                  50600000
506100/                                                                 50610000
506200*----------------------------------------------------------------*50620000
506300*    "DELETE" THE ROW - IF THE ROW THAT IS BEING EXPIRED HAS AN  *50630000
506400*    EFFECTIVE DATE THAT IS = CURRENT OR CURRENT - 1 DAY, THEN IT*50640000
506500*    IS UPDATED TO HAVE A VALUE OF CURRENT DATE - 2 DAYS. THIS IS*50650000
506600*    BECAUSE ITS EXPIRATION DATE WILL BE UPDATED TO HAVE A VALUE *50660000
506700*    OF CURRENT DATE - 1 DAY.                                    *50670000
506800*----------------------------------------------------------------*50680000
506900                                                                  50690000
507000 7250-FUTURE-EFFDTE-EXPIRE.                                       50700000
507100                                                                  50710000
507200     PERFORM                                                      50720000
507300         WITH TEST AFTER                                          50730000
507400         VARYING PV-RETRY-COUNTER                                 50740000
507500         FROM 1 BY 1                                              50750000
507600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               50760000
507700             OR (SQLCODE = +0))                                   50770000
507800                                                                  50780000
507900         EXEC SQL                                                 50790000
508000              UPDATE TVNDAGR                                      50800000
508100                 SET EFFECTIVE_DATE = :ASC-CURR-DATE-2DAYS        50810000
508200               WHERE DEPT_NBR          = :DK-DEPT-NBR             50820000
508300                 AND ENT_ID            = :DK-ENT-ID               50830000
508400                 AND AGRMT_TYP_ID      = '6'                      50840000
508500                 AND SEQ_NBR           = :VNDAGR-SEQ-NBR          50850000
508600                 AND TYP_CDE           = 6                        50860000
508700         END-EXEC                                                 50870000
508800                                                                  50880000
508900         EVALUATE TRUE                                            50890000
509000             WHEN SQLCODE = +0                                    50900000
509100* WHEN THE EFFECTIVE DATE FOR THE EXPIRED ROW HAS BEEN UPDATED    50910000
509200* TO THE CURRENT DATE - 2 DAYS AND THE VALUE OF THE EFFECTIVE DATE50920000
509300* FOR THE ROW THAT WILL BE INSERTED = TO THE CURRENT DATE - 1 DAY,50930000
509400* MOVE THE CURRENT DATE TO THAT EFFECTIVE DATE.                   50940000
509500                  IF VNDAGR-EFFECTIVE-DATE = ASC-CURR-DATE-1DAY   50950000
509600                     MOVE ASC-CURRENT-DATE TO                     50960000
509700                          VNDAGR-EFFECTIVE-DATE                   50970000
509800                  END-IF                                          50980000
509900             WHEN SQLCODE = -904                                  50990000
510000             WHEN SQLCODE = -913                                  51000000
510100                  CONTINUE                                        51010000
510200                                                                  51020000
510300             WHEN SQLWARN0 NOT = SPACES                           51030000
510400             WHEN SQLCODE < +0                                    51040000
510500             WHEN SQLCODE > +0                                    51050000
510600                  MOVE '7250-FUTURE-EFFDTE-EXPIRE'                51060000
510700                                  TO DP013-PARAGRAPH              51070000
510800                  MOVE 'UNSUCCESSFUL UPDATE ON TVNDAGR'           51080000
510900                                  TO DP013-MESSAGE-TEXT (1)       51090000
511000                  MOVE SQLCA      TO DP013-SQLCA                  51100000
511100                  MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)     51110000
511200                  SET DP013-DB2-ABEND                             51120000
511300                      DP013-XCTL-DISPLAY-RESTART                  51130000
511400                                  TO TRUE                         51140000
511500                  PERFORM DP013-0000-PROCESS-ABEND                51150000
511600         END-EVALUATE                                             51160000
511700     END-PERFORM.                                                 51170000
511800                                                                  51180000
511900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        51190000
512000         MOVE '7250-FUTURE-EFFDTE-EXPIRE'                         51200000
512100                                  TO DP013-PARAGRAPH              51210000
512200         MOVE 'MAX RETRIES EXCEEDED ON UPDATE TVNDAGR'            51220000
512300                                  TO DP013-MESSAGE-TEXT (1)       51230000
512400         MOVE SQLCA               TO DP013-SQLCA                  51240000
512500         MOVE 'TVNDAGR '          TO DP013-DB2-TABLE-NAME (1)     51250000
512600         SET DP013-DB2-ABEND                                      51260000
512700             DP013-XCTL-DISPLAY-RESTART                           51270000
512800                                  TO TRUE                         51280000
512900         PERFORM DP013-0000-PROCESS-ABEND                         51290000
513000     END-IF.                                                      51300000
513100                                                                  51310000
513200*----------------------------------------------------------------*51320000
513300*    CHECK FOR ANY AGREEMENT ALREADY ON TVNDAGR THAT OVERLAPS    *51330000
513400*    THE AGREEMENT BEING ADDED.  IF AN OVERLAPPING AGREEMENT IS  *51340000
513500*    FOUND, THEN AN ERROR MESSAGE WILL BE TRIGGERED.             *51350000
513600*    IF MORE THAN ONE OVERLAPPING AGREEMENT IS FOUND (-811), THEN*51360000
513700*    AN ERROR MESSAGE WILL BE TRIGGERED.                         *51370000
513800*----------------------------------------------------------------*51380000
513900 7300-CHECK-FOR-OVERLAP-AGMT.                                     51390000
514000                                                                  51400000
514100     EXEC SQL                                                     51410000
514200       SELECT SEQ_NBR                                             51420000
514300         INTO :PV-SEQ-NBR                                         51430000
514400            FROM TVNDAGR                                          51440000
514500           WHERE ENT_ID            = :DK-ENT-ID                   51450000
514600             AND DEPT_NBR          = :DK-DEPT-NBR                 51460000
514700             AND AGRMT_TYP_ID      = '6'                          51470000
514800             AND TYP_CDE           =  6                           51480000
514900             AND AP_TRN_CDE        = :PV-TRANCODE                 51490000
515000             AND EXPIRATION_DATE   >= CURRENT DATE                51500000
515100             AND (:VNDAGR-EFFECTIVE-DATE BETWEEN EFFECTIVE_DATE   51510000
515200                                     AND EXPIRATION_DATE          51520000
515300               OR :VNDAGR-EXPIRATION-DATE BETWEEN EFFECTIVE_DATE  51530000
515400                                      AND EXPIRATION_DATE)        51540000
515500     END-EXEC.                                                    51550000
515600                                                                  51560000
515700     EVALUATE TRUE                                                51570000
515800         WHEN SQLCODE = ZERO                                      51580000
515900              SET ASC-CURR-ACTIVE-AGMT    TO TRUE                 51590000
516000         WHEN SQLCODE = +100                                      51600000
516100         WHEN SQLCODE = -305                                      51610000
516200              SET ASC-NO-CURR-ACTIVE-AGMT TO TRUE                 51620000
516300         WHEN SQLCODE = -811                                      51630000
516400* ADD NOT ALLOWED; ENTERED AGREEMENT OVERLAPS MORE THAN ONE       51640000
516500* AGREEMENT                                                       51650000
516600              MOVE DP015-UNP-ALP-BRT-OFF TO                       51660000
516700                     MR-SELECTA      (PV-SUB)                     51670000
516800              MOVE DP015-RED TO                                   51680000
516900                     MR-SELECTC      (PV-SUB)                     51690000
517000              MOVE DP015-REVERSE TO                               51700000
517100                     MR-SELECTH      (PV-SUB)                     51710000
517200              MOVE -1 TO MR-SELECTL  (PV-SUB)                     51720000
517300              SET DP030-SET-CURSOR-APPL-1 TO TRUE                 51730000
517400              IF PS-NO-ERROR                                      51740000
517500                 MOVE PC-TSYMSG-03147 TO DP020-MSG-NUMBER         51750000
517600              END-IF                                              51760000
517700              SET PS-ERROR            TO TRUE                     51770000
517800              SET DP020-MSG-FATAL     TO TRUE                     51780000
517900                                                                  51790000
518000         WHEN SQLWARN0 NOT = SPACES                               51800000
518100         WHEN SQLCODE < ZERO                                      51810000
518200         WHEN SQLCODE > ZERO                                      51820000
518300              MOVE '7300-CHECK-FOR-OVERLAP-AGMT'                  51830000
518400                                  TO DP013-PARAGRAPH              51840000
518500              MOVE DK-DEPT-NBR    TO DP013-MESSAGE-TEXT (1)       51850000
518600              MOVE DK-ENT-ID      TO DP013-MESSAGE-TEXT (2)       51860000
518700              MOVE SQLCA          TO DP013-SQLCA                  51870000
518800              MOVE 'TVNDAGR'      TO DP013-DB2-TABLE-NAME (1)     51880000
518900              SET DP013-DB2-ABEND                                 51890000
519000                  DP013-XCTL-DISPLAY-RESTART TO TRUE              51900000
519100              PERFORM DP013-0000-PROCESS-ABEND                    51910000
519200     END-EVALUATE.                                                51920000
519300                                                                  51930000
519400/                                                                 51940000
519500*----------------------------------------------------------------*51950000
519600*    SELECT THE EFFECTIVE DATE FOR THE OVERLAP AGREEMENT ALREADY *51960000
519700*    ON TVNDAGR.  COMPARE IT TO THE EFFECTIVE DATE OF THE AGREE- *51970000
519800*    MENT BEING ADDED.  IF THE ADDED EFFECTIVE DATE IS <= THE    *51980000
519900*    OVERLAP AGREEMENT EFFECTIVE DATE THEN THE ADDED WILL NOT BE *51990000
520000*    ALLOWED TO HAPPEN.                                          *52000000
520100*----------------------------------------------------------------*52010000
520200 7310-SELECT-OVRLP-AGMT-EFFDATE.                                  52020000
520300                                                                  52030000
520400     MOVE SPACES TO PV-EFFECTIVE-DATE.                            52040000
520500                                                                  52050000
520600     EXEC SQL                                                     52060000
520700       SELECT EFFECTIVE_DATE                                      52070000
520800         INTO :PV-EFFECTIVE-DATE                                  52080000
520900            FROM TVNDAGR                                          52090000
521000           WHERE ENT_ID            = :DK-ENT-ID                   52100000
521100             AND DEPT_NBR          = :DK-DEPT-NBR                 52110000
521200             AND AGRMT_TYP_ID      = '6'                          52120000
521300             AND TYP_CDE           =  6                           52130000
521400*            AND AP_TRN_CDE        = :PV-TRANCODE                 52140000
521500             AND SEQ_NBR           = :PV-SEQ-NBR                  52150000
521600     END-EXEC.                                                    52160000
521700                                                                  52170000
521800     EVALUATE TRUE                                                52180000
521900         WHEN SQLCODE = ZERO                                      52190000
522000         WHEN SQLCODE = -811                                      52200000
522100              CONTINUE                                            52210000
522200         WHEN SQLWARN0 NOT = SPACES                               52220000
522300         WHEN SQLCODE < ZERO                                      52230000
522400         WHEN SQLCODE > ZERO                                      52240000
522500              MOVE '7310-SELECT-OVRLP-AGMT-EFFDATE'               52250000
522600                                  TO DP013-PARAGRAPH              52260000
522700              MOVE DK-DEPT-NBR    TO DP013-MESSAGE-TEXT (1)       52270000
522800              MOVE DK-ENT-ID      TO DP013-MESSAGE-TEXT (2)       52280000
522900              MOVE SQLCA          TO DP013-SQLCA                  52290000
523000              MOVE 'TVNDAGR'      TO DP013-DB2-TABLE-NAME (1)     52300000
523100              SET DP013-DB2-ABEND                                 52310000
523200                  DP013-XCTL-DISPLAY-RESTART TO TRUE              52320000
523300              PERFORM DP013-0000-PROCESS-ABEND                    52330000
523400     END-EVALUATE.                                                52340000
523500                                                                  52350000
523600/                                                                 52360000
523700*----------------------------------------------------------------*52370000
523800*    CALCULATE THE NEW EXPIRATION DATE OF THE OVERLAP AGREEMENT  *52380000
523900*    FROM THE EFFECTIVE DATE MINUS ONE DAY OF THE AGREEMENT BEING*52390000
524000*    ADDED.                                                      *52400000
524100*----------------------------------------------------------------*52410000
524200 7325-CALC-OVRLP-AGMT-EXPDTE.                                     52420000
524300                                                                  52430000
524400     MOVE ASC-EFFDTE-MM   (ASC-BLK-SUB ASC-ITEM-SUB)              52440000
524500                          TO PV-MM.                               52450000
524600     MOVE ASC-EFFDTE-DD   (ASC-BLK-SUB ASC-ITEM-SUB)              52460000
524700                          TO PV-DD.                               52470000
524800     MOVE ASC-EFFDTE-CCYY (ASC-BLK-SUB ASC-ITEM-SUB)              52480000
524900                          TO PV-CCYY.                             52490000
525000     MOVE '-'             TO PV-DASH1 PV-DASH2.                   52500000
525100     SET PS-VALID-DATE TO TRUE.                                   52510000
525200                                                                  52520000
525300     INITIALIZE DPG51                                             52530000
525400                DPG52                                             52540000
525500                DPG53                                             52550000
525600                DPG54                                             52560000
525700                DPG55                                             52570000
525800                DPG56.                                            52580000
525900                                                                  52590000
526000     SET DPG51-FISCAL-454-CALENDAR                                52600000
526100         DPG51-DECREMENT-DATE                                     52610000
526200         DPG52-LK-DTE-ISO-FMT  TO TRUE.                           52620000
526300                                                                  52630000
526400     MOVE PV-CCYYMMDD-DATE TO DPG52-LK-DATE-INPUT.                52640000
526500     MOVE 1                TO DPG51-INCR-DECR-DAYS-9.             52650000
526600                                                                  52660000
526700     CALL DP500-KOHLS-CALENDAR-ROUTINE                            52670000
526800         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56                52680000
526900                                                                  52690000
527000     IF (DPG54-WARNING-ERROR OR                                   52700000
527100         DPG54-SEVERE-ERROR)                                      52710000
527200         SET PS-INVALID-DATE TO TRUE                              52720000
527300     ELSE                                                         52730000
527400         MOVE DPG55-DB2-ISO-DATE-FMT TO PV-CALC-EXPDTE            52740000
527500     END-IF.                                                      52750000
527600                                                                  52760000
527700/                                                                 52770000
527800*----------------------------------------------------------------*52780000
527900*    CHECK TO SEE IF A ROW(S) ALREADY EXIST(S) FOR THE TRANCODE  *52790000
528000*    OF THE AGREEMENT BEING ADDED/UPDATED WITHIN THE DATE RANGE  *52800000
528100*    OF ITS EFFECTIVE & EXPIRATION.                              *52810000
528200*----------------------------------------------------------------*52820000
528300 7350-SEE-IF-ROW-EXISTS.                                          52830000
528400                                                                  52840000
528500     MOVE ZERO TO PV-OVERLAP-COUNT.                               52850000
528600                                                                  52860000
528700                                                                  52870000
528800     EXEC SQL                                                     52880000
528900       SELECT COUNT(*)                                            52890000
529000         INTO :PV-OVERLAP-COUNT                                   52900000
529100         FROM TVNDAGR                                             52910000
529200        WHERE ENT_ID            = :DK-ENT-ID                      52920000
529300          AND DEPT_NBR          = :DK-DEPT-NBR                    52930000
529400          AND AGRMT_TYP_ID      = '6'                             52940000
529500          AND TYP_CDE           =  6                              52950000
529600          AND AP_TRN_CDE        = :PV-TRANCODE                    52960000
529700          AND EXPIRATION_DATE   >= CURRENT DATE                   52970000
529800          AND (:VNDAGR-EFFECTIVE-DATE BETWEEN EFFECTIVE_DATE      52980000
529900                                  AND EXPIRATION_DATE             52990000
530000            OR :VNDAGR-EXPIRATION-DATE BETWEEN EFFECTIVE_DATE     53000000
530100                                   AND EXPIRATION_DATE)           53010000
530200     END-EXEC.                                                    53020000
530300                                                                  53030000
530400     EVALUATE TRUE                                                53040000
530500         WHEN SQLCODE = ZERO                                      53050000
530600              IF PV-OVERLAP-COUNT > 0                             53060000
530700                 SET ASC-OVERLAPPING-DATES      TO TRUE           53070000
530800              ELSE                                                53080000
530900                 SET ASC-NO-OVERLAPPING-DATES   TO TRUE           53090000
531000              END-IF                                              53100000
531100                                                                  53110000
531200         WHEN SQLWARN0 NOT = SPACES                               53120000
531300         WHEN SQLCODE < ZERO                                      53130000
531400         WHEN SQLCODE > ZERO                                      53140000
531500              MOVE '7350-SEE-IF-ROW-EXISTS'                       53150000
531600                                  TO DP013-PARAGRAPH              53160000
531700              MOVE DK-DEPT-NBR    TO DP013-MESSAGE-TEXT (1)       53170000
531800              MOVE DK-ENT-ID      TO DP013-MESSAGE-TEXT (2)       53180000
531900              MOVE SQLCA          TO DP013-SQLCA                  53190000
532000              MOVE 'TVNDAGR'      TO DP013-DB2-TABLE-NAME (1)     53200000
532100              SET DP013-DB2-ABEND                                 53210000
532200                  DP013-XCTL-DISPLAY-RESTART TO TRUE              53220000
532300              PERFORM DP013-0000-PROCESS-ABEND                    53230000
532400     END-EVALUATE.                                                53240000
532500                                                                  53250000
532600/                                                                 53260000
532700*----------------------------------------------------------------*53270000
532800*    UPDATE AN AGREEMENT THAT HAS AN EFFECTIVE DATE > CURRENT    *53280000
532900*    DATE. THESE AGREEMENTS ARE NOT EXPIRED UNTIL THE EFFECTIVE  *53290000
533000*    DATE <= CURRENT DATE.  THIS IS DONE BECAUSE AN ATTEMPT TO DO*53300000
533100*    AN INSERT WOULD FAIL BECAUSE OF THE OVERLAPPING AGREEMENT   *53310000
533200*    CHECK ROUTINE.                                              *53320000
533300*----------------------------------------------------------------*53330000
533400                                                                  53340000
533500 7400-UPDATE-TVNDAGR.                                             53350000
533600                                                                  53360000
533700     PERFORM                                                      53370000
533800         WITH TEST AFTER                                          53380000
533900         VARYING PV-RETRY-COUNTER                                 53390000
534000         FROM 1 BY 1                                              53400000
534100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               53410000
534200             OR (SQLCODE = +0))                                   53420000
534300                                                                  53430000
534400         EXEC SQL                                                 53440000
534500              UPDATE TVNDAGR                                      53450000
534600                 SET EFFECTIVE_DATE  = :VNDAGR-EFFECTIVE-DATE     53460000
534700                    ,EXPIRATION_DATE = :VNDAGR-EXPIRATION-DATE    53470000
534800                                         :DN-EXPIRATION-DATE      53480000
534900                    ,DISCOUNT_PCT    = :VNDAGR-DISCOUNT-PCT       53490000
535000                                         :DN-DISCOUNT-PCT         53500000
535100                    ,LAST_UPD_TMST   = CURRENT TIMESTAMP          53510000
535200                    ,LAST_UPD_ID     = :DP020-USERID              53520000
535300*                   ,AP_TRN_CDE      = :PV-TRANCODE               53530000
535400                    ,PSTG_FRQ_CDE    = :VNDAGR-PSTG-FRQ-CDE       53540000
535500                    ,DED_DISC_IND    = :VNDAGR-DED-DISC-IND       53550000
535600                    ,DED_RTV_IND     = :VNDAGR-DED-RTV-IND        53560000
535700               WHERE DEPT_NBR          = :DK-DEPT-NBR             53570000
535800                 AND ENT_ID            = :DK-ENT-ID               53580000
535900                 AND AGRMT_TYP_ID      = '6'                      53590000
536000                 AND SEQ_NBR           = :VNDAGR-SEQ-NBR          53600000
536100                 AND TYP_CDE           = 6                        53610000
536200         END-EXEC                                                 53620000
536300                                                                  53630000
536400         EVALUATE TRUE                                            53640000
536500             WHEN SQLCODE = +0                                    53650000
536600             WHEN SQLCODE = -904                                  53660000
536700             WHEN SQLCODE = -913                                  53670000
536800                  CONTINUE                                        53680000
536900                                                                  53690000
537000             WHEN SQLWARN0 NOT = SPACES                           53700000
537100             WHEN SQLCODE < +0                                    53710000
537200             WHEN SQLCODE > +0                                    53720000
537300                  MOVE '7250-FUTURE-EFFDTE-EXPIRE'                53730000
537400                                  TO DP013-PARAGRAPH              53740000
537500                  MOVE 'UNSUCCESSFUL UPDATE ON TVNDAGR'           53750000
537600                                  TO DP013-MESSAGE-TEXT (1)       53760000
537700                  MOVE SQLCA      TO DP013-SQLCA                  53770000
537800                  MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)     53780000
537900                  SET DP013-DB2-ABEND                             53790000
538000                      DP013-XCTL-DISPLAY-RESTART                  53800000
538100                                  TO TRUE                         53810000
538200                  PERFORM DP013-0000-PROCESS-ABEND                53820000
538300         END-EVALUATE                                             53830000
538400     END-PERFORM.                                                 53840000
538500                                                                  53850000
538600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        53860000
538700         MOVE '7250-FUTURE-EFFDTE-EXPIRE'                         53870000
538800                                  TO DP013-PARAGRAPH              53880000
538900         MOVE 'MAX RETRIES EXCEEDED ON UPDATE TVNDAGR'            53890000
539000                                  TO DP013-MESSAGE-TEXT (1)       53900000
539100         MOVE SQLCA               TO DP013-SQLCA                  53910000
539200         MOVE 'TVNDAGR '          TO DP013-DB2-TABLE-NAME (1)     53920000
539300         SET DP013-DB2-ABEND                                      53930000
539400             DP013-XCTL-DISPLAY-RESTART                           53940000
539500                                  TO TRUE                         53950000
539600         PERFORM DP013-0000-PROCESS-ABEND                         53960000
539700     END-IF.                                                      53970000
539800                                                                  53980000
539900/                                                                 53990000
540000*----------------------------------------------------------------*54000000
540100*    UPDATE AN AGREEMENT THAT HAS AN OVERLAPPING AGREEMENT'S     *54010000
540200*    EXPIRATION DATE TO BE THE EFFECTIVE DATE MINUS 1 DAY OF THE *54020000
540300*    AGREEMENT THAT IS BEING ADDED.                              *54030000
540400*----------------------------------------------------------------*54040000
540500                                                                  54050000
540600 7500-UPDATE-OVRLP-AGMT-EXPDTE.                                   54060000
540700                                                                  54070000
540800     PERFORM                                                      54080000
540900         WITH TEST AFTER                                          54090000
541000         VARYING PV-RETRY-COUNTER                                 54100000
541100         FROM 1 BY 1                                              54110000
541200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               54120000
541300             OR (SQLCODE = +0))                                   54130000
541400                                                                  54140000
541500         EXEC SQL                                                 54150000
541600              UPDATE TVNDAGR                                      54160000
541700                 SET EXPIRATION_DATE = :PV-CALC-EXPDTE            54170000
541800                                         :DN-EXPIRATION-DATE      54180000
541900                    ,LAST_UPD_TMST   = CURRENT TIMESTAMP          54190000
542000                    ,LAST_UPD_ID     = :DP020-USERID              54200000
542100               WHERE DEPT_NBR          = :DK-DEPT-NBR             54210000
542200                 AND ENT_ID            = :DK-ENT-ID               54220000
542300                 AND AGRMT_TYP_ID      = '6'                      54230000
542400                 AND SEQ_NBR           = :PV-SEQ-NBR              54240000
542500                 AND TYP_CDE           = 6                        54250000
542600         END-EXEC                                                 54260000
542700                                                                  54270000
542800         EVALUATE TRUE                                            54280000
542900             WHEN SQLCODE = +0                                    54290000
543000             WHEN SQLCODE = -904                                  54300000
543100             WHEN SQLCODE = -913                                  54310000
543200                  CONTINUE                                        54320000
543300                                                                  54330000
543400             WHEN SQLWARN0 NOT = SPACES                           54340000
543500             WHEN SQLCODE < +0                                    54350000
543600             WHEN SQLCODE > +0                                    54360000
543700                  MOVE '7500-UPDATE-OVRLP-AGMT-EXPDTE'            54370000
543800                                  TO DP013-PARAGRAPH              54380000
543900                  MOVE 'UNSUCCESSFUL UPDATE ON TVNDAGR'           54390000
544000                                  TO DP013-MESSAGE-TEXT (1)       54400000
544100                  MOVE SQLCA      TO DP013-SQLCA                  54410000
544200                  MOVE 'TVNDAGR ' TO DP013-DB2-TABLE-NAME (1)     54420000
544300                  SET DP013-DB2-ABEND                             54430000
544400                      DP013-XCTL-DISPLAY-RESTART                  54440000
544500                                  TO TRUE                         54450000
544600                  PERFORM DP013-0000-PROCESS-ABEND                54460000
544700         END-EVALUATE                                             54470000
544800     END-PERFORM.                                                 54480000
544900                                                                  54490000
545000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        54500000
545100         MOVE '7500-UPDATE-OVRLP-AGMT-EXPDTE'                     54510000
545200                                  TO DP013-PARAGRAPH              54520000
545300         MOVE 'MAX RETRIES EXCEEDED ON UPDATE TVNDAGR'            54530000
545400                                  TO DP013-MESSAGE-TEXT (1)       54540000
545500         MOVE SQLCA               TO DP013-SQLCA                  54550000
545600         MOVE 'TVNDAGR '          TO DP013-DB2-TABLE-NAME (1)     54560000
545700         SET DP013-DB2-ABEND                                      54570000
545800             DP013-XCTL-DISPLAY-RESTART                           54580000
545900                                  TO TRUE                         54590000
546000         PERFORM DP013-0000-PROCESS-ABEND                         54600000
546100     END-IF.                                                      54610000
546200                                                                  54620000
546300/                                                                 54630000
546400*----------------------------------------------------------------*54640000
546500*    GET THE DEFAULT EFFECTIVE DATE DEPENDING ON WHAT THE        *54650000
546600*    POSTING FREQUENCY IS.  THE DEFAULT DATE WILL BE BASED ON THE*54660000
546700*    ASC-CURRENT-DATE.                                           *54670000
546800*----------------------------------------------------------------*54680000
546900                                                                  54690000
547000 8000-GET-DEFAULT-EFF-DATE.                                       54700000
547100                                                                  54710000
547200     IF ASC-FREQ-IND (ASC-BLK-SUB ASC-ITEM-SUB) = 'FM' OR 'RO'    54720000
547300        PERFORM 8010-SELECT-FM-EFF-DATE                           54730000
547400     END-IF.                                                      54740000
547500                                                                  54750000
547600     IF ASC-FREQ-IND (ASC-BLK-SUB ASC-ITEM-SUB) = 'FQ'            54760000
547700        PERFORM 8020-SELECT-FQ-EFF-DATE                           54770000
547800     END-IF.                                                      54780000
547900                                                                  54790000
548000     IF ASC-FREQ-IND (ASC-BLK-SUB ASC-ITEM-SUB) = 'FS'            54800000
548100        PERFORM 8030-SELECT-FS-EFF-DATE                           54810000
548200     END-IF.                                                      54820000
548300                                                                  54830000
548400     IF ASC-FREQ-IND (ASC-BLK-SUB ASC-ITEM-SUB) = 'FA'            54840000
548500        PERFORM 8040-SELECT-FA-EFF-DATE                           54850000
548600     END-IF.                                                      54860000
548700                                                                  54870000
548800     IF ASC-FREQ-IND (ASC-BLK-SUB ASC-ITEM-SUB) = 'CQ' OR 'CS' OR 54880000
548900                                                  'CA'            54890000
549000        PERFORM 8050-SELECT-CAL-EFF-DATES                         54900000
549100     END-IF.                                                      54910000
549200                                                                  54920000
549300/                                                                 54930000
549400*----------------------------------------------------------------*54940000
549500*    GET THE EFFECTIVE DATE FOR FISCAL MONTH (FM) POSTING        *54950000
549600*    FREQUENCY.  THIS IS BASED ON THE CURRENT DATE WHEN NOTHING  *54960000
549700*    IS ENTERED IN THE EFFECTIVE DATE.  THE FIRST DAY OF THE     *54970000
549800*    FISCAL MONTH IS SELECTED TO BE THE DEFAULT EFFECTIVE DATE.  *54980000
549900*----------------------------------------------------------------*54990000
550000                                                                  55000000
550100 8010-SELECT-FM-EFF-DATE.                                         55010000
550200                                                                  55020000
550300     PERFORM                                                      55030000
550400         WITH TEST AFTER                                          55040000
550500         VARYING PV-RETRY-COUNTER                                 55050000
550600         FROM 1 BY 1                                              55060000
550700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               55070000
550800             OR (SQLCODE = +0))                                   55080000
550900                                                                  55090000
551000         EXEC SQL                                                 55100000
551100              SELECT A.FSCL_MN_BEG_DTE                            55110000
551200*               INTO :DTATTR-FSCL-MN-BEG-DTE                      55120000
551300                INTO :PV-DEFAULT-DATE                             55130000
551400                FROM TDTATTR A                                    55140000
551500               WHERE A.KY_DTE  = :ASC-CURRENT-DATE                55150000
551600         END-EXEC                                                 55160000
551700                                                                  55170000
551800         EVALUATE TRUE                                            55180000
551900             WHEN SQLCODE = +0                                    55190000
552000             WHEN SQLCODE = -904                                  55200000
552100             WHEN SQLCODE = -913                                  55210000
552200                  CONTINUE                                        55220000
552300                                                                  55230000
552400             WHEN SQLWARN0 NOT = SPACES                           55240000
552500             WHEN SQLCODE < +0                                    55250000
552600             WHEN SQLCODE > +0                                    55260000
552700                  MOVE '8010-SELECT-FM-EFF-DATE      '            55270000
552800                                  TO DP013-PARAGRAPH              55280000
552900                  MOVE 'UNSUCCESSFUL SELECT ON TDTATTR'           55290000
553000                                  TO DP013-MESSAGE-TEXT (1)       55300000
553100                  MOVE SQLCA      TO DP013-SQLCA                  55310000
553200                  MOVE 'TDTATTR ' TO DP013-DB2-TABLE-NAME (1)     55320000
553300                  SET DP013-DB2-ABEND                             55330000
553400                      DP013-XCTL-DISPLAY-RESTART                  55340000
553500                                  TO TRUE                         55350000
553600                  PERFORM DP013-0000-PROCESS-ABEND                55360000
553700         END-EVALUATE                                             55370000
553800     END-PERFORM.                                                 55380000
553900                                                                  55390000
554000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        55400000
554100         MOVE '8010-SELECT-FM-EFF-DATE      '                     55410000
554200                                  TO DP013-PARAGRAPH              55420000
554300         MOVE 'MAX RETRIES EXCEEDED ON SELECT TDTATTR'            55430000
554400                                  TO DP013-MESSAGE-TEXT (1)       55440000
554500         MOVE SQLCA               TO DP013-SQLCA                  55450000
554600         MOVE 'TDTATTR '          TO DP013-DB2-TABLE-NAME (1)     55460000
554700         SET DP013-DB2-ABEND                                      55470000
554800             DP013-XCTL-DISPLAY-RESTART                           55480000
554900                                  TO TRUE                         55490000
555000         PERFORM DP013-0000-PROCESS-ABEND                         55500000
555100     END-IF.                                                      55510000
555200                                                                  55520000
555300/                                                                 55530000
555400*----------------------------------------------------------------*55540000
555500*    GET THE EFFECTIVE DATE FOR FISCAL QUARTER (FQ) POSTING      *55550000
555600*    FREQUENCY.  THIS IS BASED ON THE CURRENT DATE WHEN NOTHING  *55560000
555700*    IS ENTERED IN THE EFFECTIVE DATE.  THE FIRST DAY OF THE     *55570000
555800*    FISCAL QUARTER IS SELECTED TO BE THE DEFAULT EFFECTIVE DATE.*55580000
555900*----------------------------------------------------------------*55590000
556000                                                                  55600000
556100 8020-SELECT-FQ-EFF-DATE.                                         55610000
556200                                                                  55620000
556300     PERFORM                                                      55630000
556400         WITH TEST AFTER                                          55640000
556500         VARYING PV-RETRY-COUNTER                                 55650000
556600         FROM 1 BY 1                                              55660000
556700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               55670000
556800             OR (SQLCODE = +0))                                   55680000
556900                                                                  55690000
557000         EXEC SQL                                                 55700000
557100              SELECT MIN(A.FSCL_MN_BEG_DTE)                       55710000
557200*               INTO :DTATTR-FSCL-MN-BEG-DTE                      55720000
557300                INTO :PV-DEFAULT-DATE                             55730000
557400                FROM TDTATTR A                                    55740000
557500               WHERE A.FSCL_QTR_NBR =                             55750000
557600                      (SELECT B.FSCL_QTR_NBR                      55760000
557700                         FROM TDTATTR B                           55770000
557800                        WHERE B.KY_DTE = :ASC-CURRENT-DATE)       55780000
557900                 AND A.FSCL_YR_NBR =                              55790000
558000                      (SELECT C.FSCL_YR_NBR                       55800000
558100                         FROM TDTATTR C                           55810000
558200                        WHERE C.KY_DTE = :ASC-CURRENT-DATE)       55820000
558300         END-EXEC                                                 55830000
558400                                                                  55840000
558500         EVALUATE TRUE                                            55850000
558600             WHEN SQLCODE = +0                                    55860000
558700             WHEN SQLCODE = -904                                  55870000
558800             WHEN SQLCODE = -913                                  55880000
558900                  CONTINUE                                        55890000
559000                                                                  55900000
559100             WHEN SQLWARN0 NOT = SPACES                           55910000
559200             WHEN SQLCODE < +0                                    55920000
559300             WHEN SQLCODE > +0                                    55930000
559400                  MOVE '8020-SELECT-FQ-EFF-DATE      '            55940000
559500                                  TO DP013-PARAGRAPH              55950000
559600                  MOVE 'UNSUCCESSFUL SELECT ON TDTATTR'           55960000
559700                                  TO DP013-MESSAGE-TEXT (1)       55970000
559800                  MOVE SQLCA      TO DP013-SQLCA                  55980000
559900                  MOVE 'TDTATTR ' TO DP013-DB2-TABLE-NAME (1)     55990000
560000                  SET DP013-DB2-ABEND                             56000000
560100                      DP013-XCTL-DISPLAY-RESTART                  56010000
560200                                  TO TRUE                         56020000
560300                  PERFORM DP013-0000-PROCESS-ABEND                56030000
560400         END-EVALUATE                                             56040000
560500     END-PERFORM.                                                 56050000
560600                                                                  56060000
560700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        56070000
560800         MOVE '8020-SELECT-FQ-EFF-DATE      '                     56080000
560900                                  TO DP013-PARAGRAPH              56090000
561000         MOVE 'MAX RETRIES EXCEEDED ON SELECT TDTATTR'            56100000
561100                                  TO DP013-MESSAGE-TEXT (1)       56110000
561200         MOVE SQLCA               TO DP013-SQLCA                  56120000
561300         MOVE 'TDTATTR '          TO DP013-DB2-TABLE-NAME (1)     56130000
561400         SET DP013-DB2-ABEND                                      56140000
561500             DP013-XCTL-DISPLAY-RESTART                           56150000
561600                                  TO TRUE                         56160000
561700         PERFORM DP013-0000-PROCESS-ABEND                         56170000
561800     END-IF.                                                      56180000
561900                                                                  56190000
562000/                                                                 56200000
562100*----------------------------------------------------------------*56210000
562200*    GET THE EFFECTIVE DATE FOR FISCAL SEMI-ANNUAL (FS) POSTING  *56220000
562300*    FREQUENCY.  THIS IS BASED ON THE CURRENT DATE WHEN NOTHING  *56230000
562400*    IS ENTERED IN THE EFFECTIVE DATE.  THE FIRST DAY OF THE     *56240000
562500*    FISCAL SEMI-ANNUAL PERIOD IS SELECTED TO BE THE DEFAULT     *56250000
562600*    EFFECTIVE DATE.                                             *56260000
562700*----------------------------------------------------------------*56270000
562800                                                                  56280000
562900 8030-SELECT-FS-EFF-DATE.                                         56290000
563000                                                                  56300000
563100     PERFORM                                                      56310000
563200         WITH TEST AFTER                                          56320000
563300         VARYING PV-RETRY-COUNTER                                 56330000
563400         FROM 1 BY 1                                              56340000
563500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               56350000
563600             OR (SQLCODE = +0))                                   56360000
563700                                                                  56370000
563800         EXEC SQL                                                 56380000
563900              SELECT A.SEA_BEG_DTE                                56390000
564000*               INTO :DTATTR-SEA-BEG-DTE                          56400000
564100                INTO :PV-DEFAULT-DATE                             56410000
564200                FROM TDTATTR A                                    56420000
564300               WHERE A.KY_DTE  = :ASC-CURRENT-DATE                56430000
564400         END-EXEC                                                 56440000
564500                                                                  56450000
564600         EVALUATE TRUE                                            56460000
564700             WHEN SQLCODE = +0                                    56470000
564800             WHEN SQLCODE = -904                                  56480000
564900             WHEN SQLCODE = -913                                  56490000
565000                  CONTINUE                                        56500000
565100                                                                  56510000
565200             WHEN SQLWARN0 NOT = SPACES                           56520000
565300             WHEN SQLCODE < +0                                    56530000
565400             WHEN SQLCODE > +0                                    56540000
565500                  MOVE '8030-SELECT-FS-EFF-DATE      '            56550000
565600                                  TO DP013-PARAGRAPH              56560000
565700                  MOVE 'UNSUCCESSFUL SELECT ON TDTATTR'           56570000
565800                                  TO DP013-MESSAGE-TEXT (1)       56580000
565900                  MOVE SQLCA      TO DP013-SQLCA                  56590000
566000                  MOVE 'TDTATTR ' TO DP013-DB2-TABLE-NAME (1)     56600000
566100                  SET DP013-DB2-ABEND                             56610000
566200                      DP013-XCTL-DISPLAY-RESTART                  56620000
566300                                  TO TRUE                         56630000
566400                  PERFORM DP013-0000-PROCESS-ABEND                56640000
566500         END-EVALUATE                                             56650000
566600     END-PERFORM.                                                 56660000
566700                                                                  56670000
566800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        56680000
566900         MOVE '8030-SELECT-FS-EFF-DATE      '                     56690000
567000                                  TO DP013-PARAGRAPH              56700000
567100         MOVE 'MAX RETRIES EXCEEDED ON SELECT TDTATTR'            56710000
567200                                  TO DP013-MESSAGE-TEXT (1)       56720000
567300         MOVE SQLCA               TO DP013-SQLCA                  56730000
567400         MOVE 'TDTATTR '          TO DP013-DB2-TABLE-NAME (1)     56740000
567500         SET DP013-DB2-ABEND                                      56750000
567600             DP013-XCTL-DISPLAY-RESTART                           56760000
567700                                  TO TRUE                         56770000
567800         PERFORM DP013-0000-PROCESS-ABEND                         56780000
567900     END-IF.                                                      56790000
568000                                                                  56800000
568100/                                                                 56810000
568200*----------------------------------------------------------------*56820000
568300*    GET THE EFFECTIVE DATE FOR FISCAL YEAR (FA) POSTING         *56830000
568400*    FREQUENCY.  THIS IS BASED ON THE CURRENT DATE WHEN NOTHING  *56840000
568500*    IS ENTERED IN THE EFFECTIVE DATE.  THE FIRST DAY OF THE     *56850000
568600*    FISCAL YEAR IS SELECTED TO BE THE DEFAULT EFFECTIVE DATE.   *56860000
568700*----------------------------------------------------------------*56870000
568800                                                                  56880000
568900 8040-SELECT-FA-EFF-DATE.                                         56890000
569000                                                                  56900000
569100     PERFORM                                                      56910000
569200         WITH TEST AFTER                                          56920000
569300         VARYING PV-RETRY-COUNTER                                 56930000
569400         FROM 1 BY 1                                              56940000
569500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               56950000
569600             OR (SQLCODE = +0))                                   56960000
569700                                                                  56970000
569800         EXEC SQL                                                 56980000
569900              SELECT FSCL_YR_BEG_DTE                              56990000
570000*               INTO :DTATTR-FSCL-YR-BEG-DTE                      57000000
570100                INTO :PV-DEFAULT-DATE                             57010000
570200                FROM TDTATTR A                                    57020000
570300               WHERE A.KY_DTE = :ASC-CURRENT-DATE                 57030000
570400                 AND A.FSCL_YR_NBR =                              57040000
570500                      (SELECT C.FSCL_YR_NBR                       57050000
570600                         FROM TDTATTR C                           57060000
570700                        WHERE C.KY_DTE = :ASC-CURRENT-DATE)       57070000
570800         END-EXEC                                                 57080000
570900                                                                  57090000
571000         EVALUATE TRUE                                            57100000
571100             WHEN SQLCODE = +0                                    57110000
571200             WHEN SQLCODE = -904                                  57120000
571300             WHEN SQLCODE = -913                                  57130000
571400                  CONTINUE                                        57140000
571500                                                                  57150000
571600             WHEN SQLWARN0 NOT = SPACES                           57160000
571700             WHEN SQLCODE < +0                                    57170000
571800             WHEN SQLCODE > +0                                    57180000
571900                  MOVE '8040-SELECT-FA-EFF-DATE      '            57190000
572000                                  TO DP013-PARAGRAPH              57200000
572100                  MOVE 'UNSUCCESSFUL SELECT ON TDTATTR'           57210000
572200                                  TO DP013-MESSAGE-TEXT (1)       57220000
572300                  MOVE SQLCA      TO DP013-SQLCA                  57230000
572400                  MOVE 'TDTATTR ' TO DP013-DB2-TABLE-NAME (1)     57240000
572500                  SET DP013-DB2-ABEND                             57250000
572600                      DP013-XCTL-DISPLAY-RESTART                  57260000
572700                                  TO TRUE                         57270000
572800                  PERFORM DP013-0000-PROCESS-ABEND                57280000
572900         END-EVALUATE                                             57290000
573000     END-PERFORM.                                                 57300000
573100                                                                  57310000
573200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        57320000
573300         MOVE '8040-SELECT-FA-EFF-DATE      '                     57330000
573400                                  TO DP013-PARAGRAPH              57340000
573500         MOVE 'MAX RETRIES EXCEEDED ON SELECT TDTATTR'            57350000
573600                                  TO DP013-MESSAGE-TEXT (1)       57360000
573700         MOVE SQLCA               TO DP013-SQLCA                  57370000
573800         MOVE 'TDTATTR '          TO DP013-DB2-TABLE-NAME (1)     57380000
573900         SET DP013-DB2-ABEND                                      57390000
574000             DP013-XCTL-DISPLAY-RESTART                           57400000
574100                                  TO TRUE                         57410000
574200         PERFORM DP013-0000-PROCESS-ABEND                         57420000
574300     END-IF.                                                      57430000
574400                                                                  57440000
574500/                                                                 57450000
574600*----------------------------------------------------------------*57460000
574700*    GET THE EFFECTIVE DATES FOR ALL CALENDAR POSTING FREQUENCIES*57470000
574800*    BASED ON THE CURRENT DATE WHEN NOTHING IS ENTERED IN THE    *57480000
574900*    EFFECTIVE DATE.  THE FIRST DAY OF THE APPROPRIATE FISCAL    *57490000
575000*    PERIOD (QUARTER, SEMI-ANNUAL, YEAR) IS SELECTED TO BE THE   *57500000
575100*    DEFAULT EFFECTIVE DATE.  THE KOHLS CALENDAR ROUTINE WITH    *57510000
575200*    CALENDAR TYPE F4 (4-4-5, JAN - DEC) WILL BE USED TO GET THE *57520000
575300*    FISCAL FIRST DAYS FOR THE CALENDAR POSTING FREQUENCIES.     *57530000
575400*----------------------------------------------------------------*57540000
575500                                                                  57550000
575600 8050-SELECT-CAL-EFF-DATES.                                       57560000
575700                                                                  57570000
575800     SET PS-VALID-DATE TO TRUE.                                   57580000
575900                                                                  57590000
576000     INITIALIZE DPG51                                             57600000
576100                DPG52                                             57610000
576200                DPG53                                             57620000
576300                DPG54                                             57630000
576400                DPG55                                             57640000
576500                DPG56.                                            57650000
576600                                                                  57660000
576700* THIS INDICATES CALENDAR TYPE F4 (4-4-5 F2 JAN - DEC)            57670000
576800     SET DPG51-FISCAL-JAN-DEC-F2 TO TRUE.                         57680000
576900                                                                  57690000
577000     SET DPG51-DO-NOT-INCR-DECR-DATE                              57700000
577100         DPG52-LK-DTE-ISO-FMT  TO TRUE.                           57710000
577200                                                                  57720000
577300     MOVE ASC-CURRENT-DATE TO DPG52-LK-DATE-INPUT.                57730000
577400                                                                  57740000
577500     CALL DP500-KOHLS-CALENDAR-ROUTINE                            57750000
577600         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               57760000
577700                                                                  57770000
577800     IF (DPG54-WARNING-ERROR OR                                   57780000
577900         DPG54-SEVERE-ERROR)                                      57790000
578000         SET PS-INVALID-DATE TO TRUE                              57800000
578100     ELSE                                                         57810000
578200        IF ASC-FREQ-IND(ASC-BLK-SUB ASC-ITEM-SUB) = 'CQ'          57820000
578300           MOVE DPG56-FIRST-FQ-DB2-ISO-FMT TO PV-DEFAULT-DATE     57830000
578400        END-IF                                                    57840000
578500        IF ASC-FREQ-IND(ASC-BLK-SUB ASC-ITEM-SUB) = 'CS'          57850000
578600           MOVE DPG56-FIRST-FS-DB2-ISO-FMT TO PV-DEFAULT-DATE     57860000
578700        END-IF                                                    57870000
578800        IF ASC-FREQ-IND(ASC-BLK-SUB ASC-ITEM-SUB) = 'CA'          57880000
578900           MOVE DPG56-FIRST-FD-DB2-ISO-FMT TO PV-DEFAULT-DATE     57890000
579000        END-IF                                                    57900000
579100     END-IF.                                                      57910000
579200                                                                  57920000
579300/                                                                 57930000
579400*----------------------------------------------------------------*57940000
579500*    MATCH THE ENTERED EFFECTIVE DATE WITH THE POSTING FREQUENCY *57950000
579600*    TO DETERMINE IF IT IS A VALID COMBINATION.                  *57960000
579700*----------------------------------------------------------------*57970000
579800                                                                  57980000
579900 8500-MATCH-EFFDATE-TO-FREQ.                                      57990000
580000                                                                  58000000
580100     SET ASC-FREQ-EFFDATE-MATCH (ASC-BLK-SUB ASC-ITEM-SUB)        58010000
580200                                TO TRUE.                          58020000
580300                                                                  58030000
580400     IF ASC-FREQ-IND (ASC-BLK-SUB ASC-ITEM-SUB) = 'FM' OR 'RO'    58040000
580500        PERFORM 8510-MATCH-FM-EFF-DATE                            58050000
580600     END-IF.                                                      58060000
580700                                                                  58070000
580800     IF ASC-FREQ-IND (ASC-BLK-SUB ASC-ITEM-SUB) = 'FQ'            58080000
580900        PERFORM 8520-MATCH-FQ-EFF-DATE                            58090000
581000     END-IF.                                                      58100000
581100                                                                  58110000
581200     IF ASC-FREQ-IND (ASC-BLK-SUB ASC-ITEM-SUB) = 'FS'            58120000
581300        PERFORM 8530-MATCH-FS-EFF-DATE                            58130000
581400     END-IF.                                                      58140000
581500                                                                  58150000
581600     IF ASC-FREQ-IND (ASC-BLK-SUB ASC-ITEM-SUB) = 'FA'            58160000
581700        PERFORM 8540-MATCH-FA-EFF-DATE                            58170000
581800     END-IF.                                                      58180000
581900                                                                  58190000
582000     IF ASC-FREQ-IND (ASC-BLK-SUB ASC-ITEM-SUB) = 'CQ'            58200000
582100        PERFORM 8550-MATCH-CQ-EFF-DATE                            58210000
582200     END-IF.                                                      58220000
582300                                                                  58230000
582400     IF ASC-FREQ-IND (ASC-BLK-SUB ASC-ITEM-SUB) = 'CS'            58240000
582500        PERFORM 8560-MATCH-CS-EFF-DATE                            58250000
582600     END-IF.                                                      58260000
582700                                                                  58270000
582800     IF ASC-FREQ-IND (ASC-BLK-SUB ASC-ITEM-SUB) = 'CA'            58280000
582900        PERFORM 8570-MATCH-CA-EFF-DATE                            58290000
583000     END-IF.                                                      58300000
583100                                                                  58310000
583200/                                                                 58320000
583300*----------------------------------------------------------------*58330000
583400*    MATCH THE EFFECTIVE DATE FOR FISCAL MONTH (FM) POSTING      *58340000
583500*    FREQUENCY.                                                  *58350000
583600*----------------------------------------------------------------*58360000
583700                                                                  58370000
583800 8510-MATCH-FM-EFF-DATE.                                          58380000
583900                                                                  58390000
584000     EXEC SQL                                                     58400000
584100          SELECT '1'                                              58410000
584200           INTO  :PV-ONE                                          58420000
584300            FROM SYSIBM.SYSDUMMY1 X                               58430000
584400           WHERE EXISTS (SELECT 1                                 58440000
584500                       FROM TDTATTR A                             58450000
584600                      WHERE A.FSCL_MN_BEG_DTE = :PV-DB2-EFFDTE    58460000
584700                        AND X.IBMREQD = X.IBMREQD)                58470000
584800     END-EXEC.                                                    58480000
584900                                                                  58490000
585000     EVALUATE TRUE                                                58500000
585100         WHEN SQLCODE = +0                                        58510000
585200             SET ASC-FREQ-EFFDATE-MATCH                           58520000
585300                           (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE     58530000
585400                                                                  58540000
585500         WHEN SQLCODE = +100                                      58550000
585600             SET ASC-FREQ-EFFDATE-NOT-MATCH                       58560000
585700                           (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE     58570000
585800                                                                  58580000
585900         WHEN SQLWARN0 NOT = SPACES                               58590000
586000         WHEN SQLCODE < ZERO                                      58600000
586100         WHEN SQLCODE > ZERO                                      58610000
586200             MOVE '8510-MATCH-FM-EFF-DATE'                        58620000
586300                               TO DP013-PARAGRAPH                 58630000
586400             MOVE 'SELECT ON TDTATTR        '                     58640000
586500                               TO DP013-MESSAGE-TEXT (1)          58650000
586600             MOVE SQLCA        TO DP013-SQLCA                     58660000
586700             MOVE 'TDTATTR'    TO DP013-DB2-TABLE-NAME (1)        58670000
586800             MOVE '       '    TO DP013-DB2-TABLE-NAME (2)        58680000
586900             SET DP013-DB2-ABEND                                  58690000
587000                 DP013-XCTL-DISPLAY-RESTART                       58700000
587100                               TO TRUE                            58710000
587200             PERFORM DP013-0000-PROCESS-ABEND                     58720000
587300     END-EVALUATE.                                                58730000
587400                                                                  58740000
587500/                                                                 58750000
587600*----------------------------------------------------------------*58760000
587700*    MATCH THE EFFECTIVE DATE FOR FISCAL QUARTER (FQ) POSTING    *58770000
587800*    FREQUENCY.                                                  *58780000
587900*----------------------------------------------------------------*58790000
588000                                                                  58800000
588100 8520-MATCH-FQ-EFF-DATE.                                          58810000
588200                                                                  58820000
588300     EXEC SQL                                                     58830000
588400          SELECT '1'                                              58840000
588500           INTO  :PV-ONE                                          58850000
588600            FROM SYSIBM.SYSDUMMY1 X                               58860000
588700           WHERE EXISTS (SELECT 1                                 58870000
588800                       FROM TDTATTR A                             58880000
588900                      WHERE A.FSCL_MN_BEG_DTE = :PV-DB2-EFFDTE    58890000
589000                        AND A.FSCL_MN_NBR IN ('01','04','07','10')58900000
589100                        AND A.FSCL_YR_NBR =                       58910000
589200                            (SELECT B.FSCL_YR_NBR                 58920000
589300                               FROM TDTATTR B                     58930000
589400                              WHERE B.KY_DTE = :PV-DB2-EFFDTE)    58940000
589500                        AND X.IBMREQD = X.IBMREQD)                58950000
589600     END-EXEC.                                                    58960000
589700                                                                  58970000
589800     EVALUATE TRUE                                                58980000
589900         WHEN SQLCODE = +0                                        58990000
590000             SET ASC-FREQ-EFFDATE-MATCH                           59000000
590100                           (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE     59010000
590200                                                                  59020000
590300         WHEN SQLCODE = +100                                      59030000
590400             SET ASC-FREQ-EFFDATE-NOT-MATCH                       59040000
590500                           (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE     59050000
590600                                                                  59060000
590700         WHEN SQLWARN0 NOT = SPACES                               59070000
590800         WHEN SQLCODE < ZERO                                      59080000
590900         WHEN SQLCODE > ZERO                                      59090000
591000             MOVE '8520-MATCH-FQ-EFF-DATE'                        59100000
591100                               TO DP013-PARAGRAPH                 59110000
591200             MOVE 'SELECT ON TDTATTR        '                     59120000
591300                               TO DP013-MESSAGE-TEXT (1)          59130000
591400             MOVE SQLCA        TO DP013-SQLCA                     59140000
591500             MOVE 'TDTATTR'    TO DP013-DB2-TABLE-NAME (1)        59150000
591600             MOVE '       '    TO DP013-DB2-TABLE-NAME (2)        59160000
591700             SET DP013-DB2-ABEND                                  59170000
591800                 DP013-XCTL-DISPLAY-RESTART                       59180000
591900                               TO TRUE                            59190000
592000             PERFORM DP013-0000-PROCESS-ABEND                     59200000
592100     END-EVALUATE.                                                59210000
592200                                                                  59220000
592300/                                                                 59230000
592400*----------------------------------------------------------------*59240000
592500*    MATCH THE EFFECTIVE DATE FOR FISCAL SEMI-ANNUAL (FS) POSTING*59250000
592600*    FREQUENCY.                                                  *59260000
592700*----------------------------------------------------------------*59270000
592800                                                                  59280000
592900 8530-MATCH-FS-EFF-DATE.                                          59290000
593000                                                                  59300000
593100     EXEC SQL                                                     59310000
593200          SELECT '1'                                              59320000
593300           INTO  :PV-ONE                                          59330000
593400            FROM SYSIBM.SYSDUMMY1 X                               59340000
593500           WHERE EXISTS (SELECT 1                                 59350000
593600                       FROM TDTATTR A                             59360000
593700                      WHERE A.SEA_BEG_DTE = :PV-DB2-EFFDTE        59370000
593800                        AND A.FSCL_MN_NBR IN ('01','07')          59380000
593900                        AND A.FSCL_YR_NBR =                       59390000
594000                            (SELECT B.FSCL_YR_NBR                 59400000
594100                               FROM TDTATTR B                     59410000
594200                              WHERE B.KY_DTE = :PV-DB2-EFFDTE)    59420000
594300                        AND X.IBMREQD = X.IBMREQD)                59430000
594400     END-EXEC.                                                    59440000
594500                                                                  59450000
594600     EVALUATE TRUE                                                59460000
594700         WHEN SQLCODE = +0                                        59470000
594800             SET ASC-FREQ-EFFDATE-MATCH                           59480000
594900                           (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE     59490000
595000                                                                  59500000
595100         WHEN SQLCODE = +100                                      59510000
595200             SET ASC-FREQ-EFFDATE-NOT-MATCH                       59520000
595300                           (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE     59530000
595400                                                                  59540000
595500         WHEN SQLWARN0 NOT = SPACES                               59550000
595600         WHEN SQLCODE < ZERO                                      59560000
595700         WHEN SQLCODE > ZERO                                      59570000
595800             MOVE '8530-MATCH-FS-EFF-DATE'                        59580000
595900                               TO DP013-PARAGRAPH                 59590000
596000             MOVE 'SELECT ON TDTATTR        '                     59600000
596100                               TO DP013-MESSAGE-TEXT (1)          59610000
596200             MOVE SQLCA        TO DP013-SQLCA                     59620000
596300             MOVE 'TDTATTR'    TO DP013-DB2-TABLE-NAME (1)        59630000
596400             MOVE '       '    TO DP013-DB2-TABLE-NAME (2)        59640000
596500             SET DP013-DB2-ABEND                                  59650000
596600                 DP013-XCTL-DISPLAY-RESTART                       59660000
596700                               TO TRUE                            59670000
596800             PERFORM DP013-0000-PROCESS-ABEND                     59680000
596900     END-EVALUATE.                                                59690000
597000                                                                  59700000
597100/                                                                 59710000
597200*----------------------------------------------------------------*59720000
597300*    MATCH THE EFFECTIVE DATE FOR FISCAL ANNUAL (FA) POSTING     *59730000
597400*    FREQUENCY.                                                  *59740000
597500*----------------------------------------------------------------*59750000
597600                                                                  59760000
597700 8540-MATCH-FA-EFF-DATE.                                          59770000
597800                                                                  59780000
597900     EXEC SQL                                                     59790000
598000          SELECT '1'                                              59800000
598100           INTO  :PV-ONE                                          59810000
598200            FROM SYSIBM.SYSDUMMY1 X                               59820000
598300           WHERE EXISTS (SELECT 1                                 59830000
598400                       FROM TDTATTR A                             59840000
598500                      WHERE A.FSCL_YR_BEG_DTE = :PV-DB2-EFFDTE    59850000
598600                        AND A.FSCL_MN_NBR IN ('01')               59860000
598700                        AND A.FSCL_YR_NBR =                       59870000
598800                            (SELECT B.FSCL_YR_NBR                 59880000
598900                               FROM TDTATTR B                     59890000
599000                              WHERE B.KY_DTE = :PV-DB2-EFFDTE)    59900000
599100                        AND X.IBMREQD = X.IBMREQD)                59910000
599200     END-EXEC.                                                    59920000
599300                                                                  59930000
599400     EVALUATE TRUE                                                59940000
599500         WHEN SQLCODE = +0                                        59950000
599600             SET ASC-FREQ-EFFDATE-MATCH                           59960000
599700                           (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE     59970000
599800                                                                  59980000
599900         WHEN SQLCODE = +100                                      59990000
600000             SET ASC-FREQ-EFFDATE-NOT-MATCH                       60000000
600100                           (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE     60010000
600200                                                                  60020000
600300         WHEN SQLWARN0 NOT = SPACES                               60030000
600400         WHEN SQLCODE < ZERO                                      60040000
600500         WHEN SQLCODE > ZERO                                      60050000
600600             MOVE '8540-MATCH-FA-EFF-DATE'                        60060000
600700                               TO DP013-PARAGRAPH                 60070000
600800             MOVE 'SELECT ON TDTATTR        '                     60080000
600900                               TO DP013-MESSAGE-TEXT (1)          60090000
601000             MOVE SQLCA        TO DP013-SQLCA                     60100000
601100             MOVE 'TDTATTR'    TO DP013-DB2-TABLE-NAME (1)        60110000
601200             MOVE '       '    TO DP013-DB2-TABLE-NAME (2)        60120000
601300             SET DP013-DB2-ABEND                                  60130000
601400                 DP013-XCTL-DISPLAY-RESTART                       60140000
601500                               TO TRUE                            60150000
601600             PERFORM DP013-0000-PROCESS-ABEND                     60160000
601700     END-EVALUATE.                                                60170000
601800                                                                  60180000
601900/                                                                 60190000
602000*----------------------------------------------------------------*60200000
602100*    MATCH THE EFFECTIVE DATE FOR THE CALENDAR QUARTER (CQ)      *60210000
602200*    POSTING FREQUENCY.                                          *60220000
602300*----------------------------------------------------------------*60230000
602400                                                                  60240000
602500 8550-MATCH-CQ-EFF-DATE.                                          60250000
602600                                                                  60260000
602700     EXEC SQL                                                     60270000
602800          SELECT '1'                                              60280000
602900           INTO  :PV-ONE                                          60290000
603000            FROM SYSIBM.SYSDUMMY1 X                               60300000
603100           WHERE EXISTS (SELECT 1                                 60310000
603200                       FROM TDTATTR A                             60320000
603300                      WHERE A.FSCL_MN_BEG_DTE = :PV-DB2-EFFDTE    60330000
603400                        AND A.CAL_MN_NBR IN ('01','04','07','10') 60340000
603500                        AND YEAR(A.KY_DTE) = YEAR(:PV-DB2-EFFDTE) 60350000
603600                        AND X.IBMREQD = X.IBMREQD)                60360000
603700     END-EXEC.                                                    60370000
603800                                                                  60380000
603900     EVALUATE TRUE                                                60390000
604000         WHEN SQLCODE = +0                                        60400000
604100             SET ASC-FREQ-EFFDATE-MATCH                           60410000
604200                           (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE     60420000
604300                                                                  60430000
604400         WHEN SQLCODE = +100                                      60440000
604500             SET ASC-FREQ-EFFDATE-NOT-MATCH                       60450000
604600                           (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE     60460000
604700                                                                  60470000
604800         WHEN SQLWARN0 NOT = SPACES                               60480000
604900         WHEN SQLCODE < ZERO                                      60490000
605000         WHEN SQLCODE > ZERO                                      60500000
605100             MOVE '8550-MATCH-CQ-EFF-DATE'                        60510000
605200                               TO DP013-PARAGRAPH                 60520000
605300             MOVE 'SELECT ON TDTATTR        '                     60530000
605400                               TO DP013-MESSAGE-TEXT (1)          60540000
605500             MOVE SQLCA        TO DP013-SQLCA                     60550000
605600             MOVE 'TDTATTR'    TO DP013-DB2-TABLE-NAME (1)        60560000
605700             MOVE '       '    TO DP013-DB2-TABLE-NAME (2)        60570000
605800             SET DP013-DB2-ABEND                                  60580000
605900                 DP013-XCTL-DISPLAY-RESTART                       60590000
606000                               TO TRUE                            60600000
606100             PERFORM DP013-0000-PROCESS-ABEND                     60610000
606200     END-EVALUATE.                                                60620000
606300                                                                  60630000
606400/                                                                 60640000
606500*----------------------------------------------------------------*60650000
606600*    MATCH THE EFFECTIVE DATE FOR THE CALENDAR SEMI-ANNUAL (CS)  *60660000
606700*    POSTING FREQUENCY.                                          *60670000
606800*----------------------------------------------------------------*60680000
606900                                                                  60690000
607000 8560-MATCH-CS-EFF-DATE.                                          60700000
607100                                                                  60710000
607200     EXEC SQL                                                     60720000
607300          SELECT '1'                                              60730000
607400           INTO  :PV-ONE                                          60740000
607500            FROM SYSIBM.SYSDUMMY1 X                               60750000
607600           WHERE EXISTS (SELECT 1                                 60760000
607700                       FROM TDTATTR A                             60770000
607800                      WHERE A.FSCL_MN_BEG_DTE = :PV-DB2-EFFDTE    60780000
607900                        AND A.CAL_MN_NBR IN ('01','07')           60790000
608000                        AND YEAR(A.KY_DTE) = YEAR(:PV-DB2-EFFDTE) 60800000
608100                        AND X.IBMREQD = X.IBMREQD)                60810000
608200     END-EXEC.                                                    60820000
608300                                                                  60830000
608400     EVALUATE TRUE                                                60840000
608500         WHEN SQLCODE = +0                                        60850000
608600             SET ASC-FREQ-EFFDATE-MATCH                           60860000
608700                           (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE     60870000
608800                                                                  60880000
608900         WHEN SQLCODE = +100                                      60890000
609000             SET ASC-FREQ-EFFDATE-NOT-MATCH                       60900000
609100                           (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE     60910000
609200                                                                  60920000
609300         WHEN SQLWARN0 NOT = SPACES                               60930000
609400         WHEN SQLCODE < ZERO                                      60940000
609500         WHEN SQLCODE > ZERO                                      60950000
609600             MOVE '8560-MATCH-CS-EFF-DATE'                        60960000
609700                               TO DP013-PARAGRAPH                 60970000
609800             MOVE 'SELECT ON TDTATTR        '                     60980000
609900                               TO DP013-MESSAGE-TEXT (1)          60990000
610000             MOVE SQLCA        TO DP013-SQLCA                     61000000
610100             MOVE 'TDTATTR'    TO DP013-DB2-TABLE-NAME (1)        61010000
610200             MOVE '       '    TO DP013-DB2-TABLE-NAME (2)        61020000
610300             SET DP013-DB2-ABEND                                  61030000
610400                 DP013-XCTL-DISPLAY-RESTART                       61040000
610500                               TO TRUE                            61050000
610600             PERFORM DP013-0000-PROCESS-ABEND                     61060000
610700     END-EVALUATE.                                                61070000
610800                                                                  61080000
610900/                                                                 61090000
611000*----------------------------------------------------------------*61100000
611100*    MATCH THE EFFECTIVE DATE FOR THE CALENDAR ANNUAL (CA)       *61110000
611200*    POSTING FREQUENCY.                                          *61120000
611300*----------------------------------------------------------------*61130000
611400                                                                  61140000
611500 8570-MATCH-CA-EFF-DATE.                                          61150000
611600                                                                  61160000
611700     EXEC SQL                                                     61170000
611800          SELECT '1'                                              61180000
611900           INTO  :PV-ONE                                          61190000
612000            FROM SYSIBM.SYSDUMMY1 X                               61200000
612100           WHERE EXISTS (SELECT 1                                 61210000
612200                       FROM TDTATTR A                             61220000
612300                      WHERE A.FSCL_MN_BEG_DTE = :PV-DB2-EFFDTE    61230000
612400                        AND A.CAL_MN_NBR IN ('01')                61240000
612500                        AND YEAR(A.KY_DTE) = YEAR(:PV-DB2-EFFDTE) 61250000
612600                        AND X.IBMREQD = X.IBMREQD)                61260000
612700     END-EXEC.                                                    61270000
612800                                                                  61280000
612900     EVALUATE TRUE                                                61290000
613000         WHEN SQLCODE = +0                                        61300000
613100             SET ASC-FREQ-EFFDATE-MATCH                           61310000
613200                           (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE     61320000
613300                                                                  61330000
613400         WHEN SQLCODE = +100                                      61340000
613500             SET ASC-FREQ-EFFDATE-NOT-MATCH                       61350000
613600                           (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE     61360000
613700                                                                  61370000
613800         WHEN SQLWARN0 NOT = SPACES                               61380000
613900         WHEN SQLCODE < ZERO                                      61390000
614000         WHEN SQLCODE > ZERO                                      61400000
614100             MOVE '8570-MATCH-CA-EFF-DATE'                        61410000
614200                               TO DP013-PARAGRAPH                 61420000
614300             MOVE 'SELECT ON TDTATTR        '                     61430000
614400                               TO DP013-MESSAGE-TEXT (1)          61440000
614500             MOVE SQLCA        TO DP013-SQLCA                     61450000
614600             MOVE 'TDTATTR'    TO DP013-DB2-TABLE-NAME (1)        61460000
614700             MOVE '       '    TO DP013-DB2-TABLE-NAME (2)        61470000
614800             SET DP013-DB2-ABEND                                  61480000
614900                 DP013-XCTL-DISPLAY-RESTART                       61490000
615000                               TO TRUE                            61500000
615100             PERFORM DP013-0000-PROCESS-ABEND                     61510000
615200     END-EVALUATE.                                                61520000
615300                                                                  61530000
615400/                                                                 61540000
615500 EJECT                                                            61550000
615600*----------------------------------------------------------------*61560000
615700*    ABEND PROCESSOR MODULE                                      *61570000
615800*----------------------------------------------------------------*61580000
615900                                                                  61590000
616000     COPY DPPD013.                                                61600000
