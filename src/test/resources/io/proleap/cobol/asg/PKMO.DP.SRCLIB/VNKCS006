000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    VNKCS006.                                         00040000
000500 AUTHOR.        DOUG NOLTNER - STRATAGEM.                         00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  06/93.                                            00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    V006 - VENDOR INQUIRY PROGRAM                              * 00110000
001200*                                                               * 00120000
001300*    THIS PROGRAM DISPLAY INFORMATION ABOUT A VENDOR.           * 00130000
001400*                                                               * 00140000
001500*    DATE       CHANGE                                          * 00150000
001600*    ----       ------                                          * 00160000
001700*    08/08/95 - ADD STORE DISTRO LEAD TIME TO THE SCREEN.       * 00170000
001800*    01/23/01 - REMOVED INFO PERTAINING TO THE FED EX NUMBER,   * 00180000
001900*               RN NUMBER, STORE DISTRO LEADTIME, EDI214 (SHIP),* 00190000
002000*               WPL NUMBER, MERCHANDISE INDICATOR, DC SPLIT REQ,* 00200000
002100*               DC SPLIT LEADTIME, IMPORT INDICATOR, CARRIER    * 00210000
002200*               INDICATOR, EXPENSE INDICATOR, AND FACTOR        * 00220000
002300*               INDICATOR.  THESE FIELDS ARE OBSOLETE AND WILL  * 00230000
002400*               NOT BE USED IN THE RETEK RMS SUPPLIER PROJECT.  * 00240000
002500*               THE FOLLOWING FIELD HAVE BEEN ADDED FOR THIS    * 00250000
002600*               CHANGE:  PRIMARY TYPE CODE AND DESCRIPTION,     * 00260000
002700*               PARTNER INDICATOR, TYPE CODE AND DESCRIPTION,   * 00270000
002800*               AND LINE OF CREDIT.                             * 00280000
002900*    08/08/02 - REMOVED THE CODE REFERENCING THE FIRST PO DATE. * 00290000
003000*                                                               * 00300000
003100*  DATE  05/27/2003                                             * 00310000
003200*      CHANGE MADE: CHANGE ALL INSTANCES OF EDI-PO-PREPK-IND TO * 00320000
003300*      EDI-PO-PREPK-CDE FOR VENDOR MULTI PRE-PACK USAGE PROJECT.* 00330000
003400*      MADE BY: KEVIN CATLIN            WR/IR #: WR24663        * 00340000
003500*                                                                *00350000
003600*  DATE  10/09/2003                                              *00360000
003700*      CHANGE MADE: UCC128 CARTON LABEL PROJECT.  ADDED 'S2'     *00370000
003800*      IMPORT PARENT COMPANY AS A VALID VALUE FOR PARTNER CODE.  *00380000
003900*      MADE BY: NANCY EILBES            WR/IR #: WR25358         *00390000
004000*                                                                *00400000
004100*  DATE  11/05/2003                                              *00410000
004200*      CHANGE MADE: ADDED  CODE TO SELECT AND DISPLAY SEVERAL NEW*00420000
004300*      FIELDS THAT HAVE BEEN ADDED TO THE EXPANDED TEXTENT TABLE:*00430000
004400*      GVRNG_IND, GVRNG_ENT_ID, CART_LBL_IND.                    *00440000
004500*      MADE BY: MIKE BESKE              WR/IR #: WR25358         *00450000
004600*                                                                *00460000
004700*  DATE  05/24/2004                                              *00470000
004800*      CHANGE MADE: ADDED  CODE TO DISPLAY NEW FIELDS: NDA       *00480000
004900*      INDICATOR, NDA BEGIN DATE, NDA END DATE, AND ENT-ID.      *00490000
005000*      MADE BY: PAUL OMAN               WR/IR #: WR26951         *00500000
005100*                                                                *00510000
005200*  DATE  04/14/2005                                              *00520000
005300*      CHANGE MADE: ADDED LOCAL-FUNC-01 & 02 TO GO TO NEW        *00530000
005400*      SCREENS FOR VENDOR CAPABILITIES & RELATIONSHIPS.          *00540000
005500*      ALSO ADDED COPYBOOK VNWS004 TO PASS DATA TO THESE SCREENS *00550000
005600*      MADE BY: JACK KRAMER             WR/IR #: WR25278         *00560000
005700*                                                                 00570000
005800*  DATE  02/24/2005                                              *00580000
005900*      CHANGE MADE: ADDED NEW FIELD, CAPACITY, FOR VENDORS WITH  *00590000
006000*      A PARTNER TYPE OF 'FA'CTORY.  THIS FIELD WILL SHOW THE    *00600000
006100*      MONTHLY CAPACITY FOR A FACTORY.  THE COLUMN LNE_OF_CR_AMT *00610000
006200*      FROM TABLE TEXTENT WILL BE USED TO STORE THIS VALUE.      *00620000
006300*      CODE ADDED TO PARAGRAPH 4400-MOVE-COMMAREA-TO-SCREEN.     *00630000
006400*      MADE BY: KEVIN CATLIN            WR/IR #: WR28060         *00640000
006500*                                                                *00650000
006600*  DATE  06/13/2005                                              *00660000
006700*      CHANGE MADE: ADDED LOGIC IN PARAGRAPH 4400- TO MOVE THE   *00670000
006800*      STRING 'OFFICE OF PLACEMENT' TO THE PARTNER TYPE          *00680000
006900*      DESCRIPTION FIELD WHEN THE CODE VALUE EQUALS 'OP'.        *00690000
007000*      MADE BY: KRYSTEN LEARY           WR/IR #: WR28905         *00700000
007100*                                                                *00710000
007200*  DATE  01/11/2008                                              *00720000
007300*      CHANGE MADE: ADDED F23=CERTIFNS FUNCTIONALITY TO SCREEN   *00730000
007400*      MAP VNKM006. WHEN USER PRESSES KEY, CONTROL WILL TRANSFER *00740000
007500*      TO VMKCS037-CERTIFICATION COUNT.                          *00750000
007600*      MADE BY: CHRISTINE TWIEHAUS      WR/IR #: WR32218         *00760000
007700*                                                                *00770000
007800*  DATE  05/19/2008                                              *00780000
007900*      CHANGE MADE: IN 4400-  ADDED CLAUSE FOR 'CL' CARTON LABEL *00790000
008000*      MAKER IN EVALUATE TRUE STATEMENT                          *00800000
008100*      MADE BY: GREG WISIALOWSKI        WR/IR #: WR34276         *00810000
008200*                                                                *00820000
008210*  DATE  06/06/2018                                              *00821001
008220*   CHANGE MADE: REMOVED ALL REFERENCES TO ASC-FED-TX-ID-TYP-CDE,*00822001
008221*   ASC-FED-TX-ID-NBR, ATAXIDTO AND ATAXIDO AS THESE FIELDS WERE *00822101
008222*   REMOVED FROM THE MAP.  ALSO REMOVED THESE COLUMNS FROM ALL   *00822201
008230*   SQL STATEMENTS.                                              *00823001
008240*   MADE BY: NANCY EILBES            WR/IR #: CHG0199468         *00824001
008250*                                                                *00825001
008210*  DATE  05/18/2020                                              *00826002
008220*   CHANGE MADE: REMOVE F23 KEY, LOCAL-FUNC-09, WHICH LINKED     *00827002
008220*                TO THE VENDOR CERTIFICATION SCREENS             *00828002
008240*   MADE BY: JEAN KURK               WR/IR #: CHG0243494         *00829202
008250*                                                                *00829303
008210*  DATE  01/05/2023                                              *00829403
008220*   CHANGE MADE: CHANGE CALL TO DPKCS030 TO DYNAMIC              *00829503
008240*   MADE BY: JEAN KURK               WR/IR #: CHG0277999         *00829703
008250*                                                                *00829802
008300*----------------------------------------------------------------*00830000
008400 EJECT                                                            00840000
008500 ENVIRONMENT DIVISION.                                            00850000
008600                                                                  00860000
008700 DATA DIVISION.                                                   00870000
008800                                                                  00880000
008900 WORKING-STORAGE SECTION.                                         00890000
009000                                                                  00900000
009100 01  PC-PROGRAM-CONSTANTS.                                        00910000
009200     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00920000
009300                                                    'VN006A  '.   00930000
009400     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00940000
009500                                                    'VNKM006 '.   00950000
009600     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00960000
009700                                                    'VNKCS006'.   00970000
009800     05  PC-DEFAULT-DATE                PIC  X(10)  VALUE         00980000
009900                                                    '0001-01-01'. 00990000
010000     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      01000000
010100     05  PC-INTER-APPL-CODES.                                     01010000
010200         10  PC-INTER-APPL-CRIT         PIC  X(01)  VALUE '1'.    01020000
010300         10  PC-INTER-APPL-LIST         PIC  X(01)  VALUE '2'.    01030000
010400     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +5      01040000
010500                                                    COMP SYNC.    01050000
010600     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      01060000
010700                                                    COMP SYNC.    01070000
010800     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         01080000
010900                                                    +1000000      01090000
011000                                                    COMP-3.       01100000
011100     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      01110000
011200                                                    COMP SYNC.    01120000
011300     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       01130000
011400                                                    COMP-3.       01140000
011500     05  PC-VENDOR-HOLD                 PIC  X(14)  VALUE         01150000
011600         'VENDOR ON HOLD'.                                        01160000
011700     05  PC-TYPE-CODES.                                           01170000
011800         10  PC-PRIMARY                 PIC  X(02)  VALUE '01'.   01180000
011900         10  PC-ALIAS                   PIC  X(02)  VALUE '02'.   01190000
012000         10  PC-LABEL                   PIC  X(02)  VALUE '03'.   01200000
012100         10  PC-SHORTNAME               PIC  X(02)  VALUE '04'.   01210000
012200         10  PC-PARENT                  PIC  X(02)  VALUE '99'.   01220000
012300                                                                  01230000
012400     05  PC-TSYMSG-NUMBERS.                                       01240000
012500         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01250000
012600         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  01260000
012700         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01270000
012800         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01280000
012900         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01290000
013000         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01300000
013100         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01310000
013200         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01320000
013300         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01330000
013400         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01340000
013500         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01350000
013600         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01360000
013700         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  01370000
013800         10  PC-TSYMSG-00159            PIC  9(05)  VALUE 00159.  01380000
013900         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01390000
014000         10  PC-TSYMSG-00398            PIC  9(05)  VALUE 00398.  01400000
014100         10  PC-TSYMSG-00487            PIC  9(05)  VALUE 00487.  01410000
014200         10  PC-TSYMSG-00499            PIC  9(05)  VALUE 00499.  01420000
014300         10  PC-TSYMSG-00500            PIC  9(05)  VALUE 00500.  01430000
014400         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  01440000
014500                                                                  01450000
014600 01  PS-PROGRAM-SWITCHES.                                         01460000
014700     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01470000
014800         88  PS-NO-ERROR                            VALUE 'Y'.    01480000
014900         88  PS-ERROR                               VALUE 'N'.    01490000
015000     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01500000
015100         88  PS-DONE                                VALUE 'Y'.    01510000
015200         88  PS-NOT-DONE                            VALUE 'N'.    01520000
015300     05  PS-PARENT-CO-SW                PIC  X(01)  VALUE 'N'.    01530000
015400         88  PS-PARENT-CO-FOUND                     VALUE 'Y'.    01540000
015500         88  PS-PARENT-CO-NOT-FOUND                 VALUE 'N'.    01550000
015600                                                                  01560000
015700 01  PL-PROGRAM-LITERALS.                                         01570000
015800     05  PL-PRIMARY                     PIC  X(10)  VALUE         01580000
015900                                                    'PRIMARY   '. 01590000
016000     05  PL-ALIAS                       PIC  X(10)  VALUE         01600000
016100                                                    'ALIAS     '. 01610000
016200     05  PL-LABEL                       PIC  X(10)  VALUE         01620000
016300                                                    'LABEL     '. 01630000
016400     05  PL-SHORTNAME                   PIC  X(10)  VALUE         01640000
016500                                                    'SHORT NAME'. 01650000
016600     05  PL-PARENT                      PIC  X(10)  VALUE         01660000
016700                                                    'PARENT    '. 01670000
016800                                                                  01680000
016900 01  PV-PROGRAM-VARIABLES.                                        01690000
017000     05  PV-SUB                         PIC S9(04)  VALUE +0      01700000
017100                                                    COMP SYNC.    01710000
017200     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01720000
017300                                                    COMP SYNC.    01730000
017400     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01740000
017500                                                    COMP-3.       01750000
017600     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01760000
017700                                                    COMP-3.       01770000
017800     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01780000
017900                                                    COMP-3.       01790000
018000     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01800000
018100                                                    COMP-3.       01810000
018200     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01820000
018300                                                    COMP-3.       01830000
018400     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01840000
018500                                                    COMP-3.       01850000
018600     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01860000
018700                                                    COMP-3.       01870000
018800     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01880000
018900                                                    COMP SYNC.    01890000
019000     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01900000
019100                                                    COMP SYNC.    01910000
019200     05  PV-ITEM                        PIC S9(04)  VALUE +0      01920000
019300                                                    COMP SYNC.    01930000
019400     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01940000
019500                                                    COMP SYNC.    01950000
019600     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01960000
019700                                                    COMP SYNC.    01970000
019800     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01980000
019900                                                    COMP SYNC.    01990000
020000     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      02000000
020100                                                    COMP SYNC.    02010000
020200     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02020000
020300                                                    COMP SYNC.    02030000
020400     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02040000
020500                                                    COMP SYNC.    02050000
020600     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      02060000
020700                                                    COMP SYNC.    02070000
020800     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02080000
020900                                                    COMP SYNC.    02090000
021000     05  PV-HOLD-LNE-OF-CRDT            PIC ZZZZZZZZZZZ.99.       02100000
021100     05  PV-HOLD-FACT-CAPACITY          PIC 9(11).9(2).           02110000
021200     05  FILLER REDEFINES PV-HOLD-FACT-CAPACITY.                  02120000
021300         10  PV-HOLD-CAPACITY           PIC ZZZZZZZZZZ9.          02130000
021400         10  FILLER                     PIC X(1).                 02140000
021500         10  PV-SIG-DIGITS              PIC 9(2).                 02150000
021600     05  PV-YTD-COLON                   PIC X(05).                02160000
021700     05  FILLER REDEFINES PV-YTD-COLON.                           02170000
021800         10  PV-YTD-YR                  PIC X(04).                02180000
021900         10  PV-COLON-1                 PIC X(01).                02190000
022000     05  PV-PREV-YR-COLON               PIC X(05).                02200000
022100     05  FILLER REDEFINES PV-PREV-YR-COLON.                       02210000
022200         10  PV-PREV-YR                 PIC X(04).                02220000
022300         10  PV-COLON-2                 PIC X(01).                02230000
022400     05  PV-LAST-PO-DATE-IND            PIC S9(04)  COMP.         02240000
022500     05  PV-ABSTIME                     PIC S9(15)  COMP.         02250000
022600     05  PV-HOLD-DATE-6                 PIC  9(06)  VALUE ZEROS.  02260000
022700     05  PV-DATE-CONVERSION-10.                                   02270000
022800         10  PV-DT-CONV-10-CCYY.                                  02280000
022900             15  PV-DT-CONV-10-CC       PIC  9(02)  VALUE ZEROS.  02290000
023000             15  PV-DT-CONV-10-YY       PIC  9(02)  VALUE ZEROS.  02300000
023100         10  FILLER                REDEFINES PV-DT-CONV-10-CCYY.  02310000
023200             15  PV-DT-CONV-10-CCYY-N   PIC  9(04).               02320000
023300         10  PV-DASH-1                  PIC  X(01)  VALUE '-'.    02330000
023400         10  PV-DT-CONV-10-MM           PIC  9(02)  VALUE ZEROS.  02340000
023500         10  PV-DASH-2                  PIC  X(01)  VALUE '-'.    02350000
023600         10  PV-DT-CONV-10-DD           PIC  9(02)  VALUE ZEROS.  02360000
023700                                                                  02370000
023800     05  PV-DATE-CONVERSION-8.                                    02380000
023900         10  PV-DT-CONV-8-MM            PIC  9(02)  VALUE ZEROS.  02390000
024000         10  PV-SLASH-1                 PIC  X(01)  VALUE '/'.    02400000
024100         10  PV-DT-CONV-8-DD            PIC  9(02)  VALUE ZEROS.  02410000
024200         10  PV-SLASH-2                 PIC  X(01)  VALUE '/'.    02420000
024300         10  PV-DT-CONV-8-YY            PIC  9(02)  VALUE ZEROS.  02430000
024400                                                                  02440000
024500     05  PV-DATE-CONVERSION-6.                                    02450000
024600         10  PV-DT-CONV-6-YY            PIC  9(02)  VALUE ZEROS.  02460000
024700         10  PV-DT-CONV-6-MM            PIC  9(02)  VALUE ZEROS.  02470000
024800         10  PV-DT-CONV-6-DD            PIC  9(02)  VALUE ZEROS.  02480000
024900                                                                  02490000
025000     05  PV-CURR-FSCL-YR                PIC 9(4)    VALUE ZEROS.  02500000
025100     05  PV-PREV-FSCL-YR                PIC 9(4)    VALUE ZEROS.  02510000
025200******************************************************************02520000
025300**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **02530000
025400**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **02540000
025500**  APPLICATION-SPECIFIC COMMAREA.                              **02550000
025600******************************************************************02560000
025700 01  LQW-LIST-QUEUE-WORK-AREA.                                    02570000
025800     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02580000
025900     05  LQW-ITEM-ENTRIES               OCCURS  5 TIMES           02590000
026000                                        INDEXED BY LQW-IDX.       02600000
026100         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02610000
026200         10  LQW-VEND-NAME              PIC  X(30).               02620000
026300         10  LQW-TYPE-CDE               PIC  X(02).               02630000
026400                                                                  02640000
026500     EJECT                                                        02650000
026600*---------------------------------------------------------------* 02660000
026700*    MAP LAYOUT                                                 * 02670000
026800*---------------------------------------------------------------* 02680000
026900                                                                  02690000
027000     COPY VNKM006.                                                02700000
027100*                                                                 02710000
027200 01  MR-OCCURS-LAYOUT                   REDEFINES  VN006AO.       02720000
027300     05  FILLER                         PIC X(51).                02730000
027400     05  MR-SCROLL-AREA                 OCCURS 5  TIMES.          02740000
027500         10  MR-VEND-NAMEL              PIC S9(04) COMP.          02750000
027600         10  MR-VEND-NAMEA              PIC  X(01).               02760000
027700         10  MR-VEND-NAMEC              PIC  X(01).               02770000
027800         10  MR-VEND-NAMEH              PIC  X(01).               02780000
027900         10  MR-VEND-NAME               PIC  X(30).               02790000
028000                                                                  02800000
028100         10  MR-TYPE-DSCL               PIC S9(04) COMP.          02810000
028200         10  MR-TYPE-DSCA               PIC  X(01).               02820000
028300         10  MR-TYPE-DSCC               PIC  X(01).               02830000
028400         10  MR-TYPE-DSCH               PIC  X(01).               02840000
028500         10  MR-TYPE-DSC                PIC  X(10).               02850000
028600                                                                  02860000
028700         10  FILLER                     PIC  X(13).               02870000
028800                                                                  02880000
028900     EJECT                                                        02890000
029000*---------------------------------------------------------------* 02900000
029100*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02910000
029200*---------------------------------------------------------------* 02920000
029300                                                                  02930000
029400     COPY DPWS015.                                                02940000
029500                                                                  02950000
029600*---------------------------------------------------------------* 02960000
029700*    FUNCTION KEYS COPYBOOK.                                    * 02970000
029800*---------------------------------------------------------------* 02980000
029900                                                                  02990000
030000     COPY DPWS016.                                                03000000
030100                                                                  03010000
030200*---------------------------------------------------------------* 03020000
030300*    NUMERIC EDIT LAYOUT.                                       * 03030000
030400*---------------------------------------------------------------* 03040000
030500                                                                  03050000
030600     COPY DPWS010I.                                               03060000
030700 EJECT                                                            03070000
030800*---------------------------------------------------------------* 03080000
030900*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * 03090003
031000*---------------------------------------------------------------* 03100000
031100                                                                  03110000
031200     COPY DPWS030.                                                03120000
031200     COPY DPWS930.                                                03121003
031300 EJECT                                                            03130000
031400*---------------------------------------------------------------* 03140000
031500*    COPYBOOK FOR CALENDAR ROUTINE.                             * 03150000
031600*---------------------------------------------------------------* 03160000
031700                                                                  03170000
031800     COPY DPWS500.                                                03180000
031900 EJECT                                                            03190000
032000*---------------------------------------------------------------* 03200000
032100*    LAYOUT FOR TEMP STORAGE QUEUE CONTAINING LIST ITEMS TO BE  * 03210000
032200*    PROCESSED.                                                 * 03220000
032300*---------------------------------------------------------------* 03230000
032400                                                                  03240000
032500     COPY VNWS003.                                                03250000
032600 EJECT                                                            03260000
032700*---------------------------------------------------------------* 03270000
032800*    STANDARD COMMAREA.                                         * 03280000
032900*---------------------------------------------------------------* 03290000
033000                                                                  03300000
033100     COPY DPWS020.                                                03310000
033200     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03320000
033300                                                                  03330000
033400*---------------------------------------------------------------* 03340000
033500* INTER-APPLICATION COMMAREA.                                   * 03350000
033600*   VNWS001 - INPUT FROM VENDOR CRITERIA                        * 03360000
033700*   VNWS002 - INPUT FROM SELECTION LIST                         * 03370000
033800*   VNWS004 - OUTPUT TO LOCAL-GO FUNCTION                       * 03380000
033900*---------------------------------------------------------------* 03390000
034000                                                                  03400000
034100         10  INTER-APPL-COMM-AREA       PIC X(200).               03410000
034200     COPY VNWS001.                                                03420000
034300     COPY VNWS002.                                                03430000
034400     COPY VNWS004.                                                03440000
034500*---------------------------------------------------------------* 03450000
034600*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03460000
034700*---------------------------------------------------------------* 03470000
034800         10  ASC-SPECIFIC-COMMAREA.                               03480000
034900             15  ASC-LIST-KEYS.                                   03490000
035000                 20  ASC-ENT-ID                      PIC S9(09)   03500000
035100                                                     COMP.        03510000
035200                 20  ASC-KEY-VEND-NAME               PIC  X(30).  03520000
035300                 20  ASC-KEY-DUNS-NBR                PIC  X(09).  03530000
035400                 20  ASC-ORD-DTE                     PIC  X(10).  03540000
035500                 20  ASC-ORDERS-COUNT             PIC  S9(9) COMP.03550000
035600                 20  ASC-CFY-SLSRNK-NBR           PIC  S9(9) COMP.03560000
035700                 20  ASC-PFY-SLSRNK-NBR           PIC  S9(9) COMP.03570000
035800                 20  ASC-CURR-FSCL-YR             PIC   X(4).     03580000
035900                 20  ASC-PREV-FSCL-YR             PIC   X(4).     03590000
036000                                                                  03600000
036100             15  ASC-SCREEN-DATA.                                 03610000
036200                 20  ASC-HLD-PAYT-IND                PIC  X(01).  03620000
036300                 20  ASC-STATUS-CDE                  PIC  X(01).  03630000
036400                 20  ASC-DUN-NBR                     PIC  X(09).  03640000
036500                 20  ASC-LAST-PO-DATE                PIC  X(10).  03650000
036600                 20  ASC-HOLD-ORDERS-YTD          PIC  ZZZZZZZ9.  03660000
036700                 20  ASC-HOLD-L12-COUNT           PIC  ZZZZZZZ9.  03670000
036800                 20  ASC-CRE-DATE                    PIC  X(10).  03680000
036900                 20  ASC-PRIMARY-TYPE                PIC  X(01).  03690000
037000                 20  ASC-PRIMARY-TYPE-DESC           PIC  X(11).  03700000
037100                 20  ASC-NDA-FLAG                    PIC  X(01).  03710000
037200                 20  ASC-NDA-BEG-DATE                PIC  X(10).  03720000
037300                 20  ASC-NDA-END-DATE                PIC  X(10).  03730000
037400                 20  ASC-EDI-PO-PREPK-CDE            PIC  X(01).  03740000
037500                 20  ASC-EDI856-IND                  PIC  X(01).  03750000
037600                 20  ASC-CURR-YEAR                   PIC  X(05).  03760000
037700                 20  ASC-VENDOR-RANK-YTD             PIC  ZZZ9.   03770000
037800                 20  ASC-PREV-YEAR                   PIC  X(05).  03780000
037900                 20  ASC-VENDOR-RANK-LY              PIC  ZZZ9.   03790000
038000                 20  ASC-PRNT-CO-IND                 PIC  X(01).  03800000
038100                 20  ASC-PARTNER-IND                 PIC  X(01).  03810000
038200                 20  ASC-PARTNER-TYP-CDE             PIC  X(02).  03820000
038300                 20  ASC-PARTNER-TYPE-DESC           PIC  X(20).  03830000
038400                 20  ASC-SCAC-CDE                    PIC  X(04).  03840000
038500                 20  ASC-MAN-PRO-IND                 PIC  X(01).  03850000
038600                 20  ASC-LINE-OF-CRDT                PIC          03860000
038700                                              S9(11)V9(2) COMP-3. 03870000
038800                 20  ASC-CAP-EXP-CDE                 PIC  X(01).  03880000
038900                 20  ASC-DEPARTMENT                  PIC  X(03).  03890000
039000                 20  ASC-NEED-1099                   PIC  X(01).  03900000
039100*                20  ASC-FED-TX-ID-TYP-CDE           PIC  X(01).  03910000
039200*                20  ASC-FED-TX-ID-NBR               PIC  X(09).  03920000
039300                                                                  03930000
039400             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03940000
039500                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03950000
039600                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03960000
039700                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03970000
039800                                                                  03980000
039900                 20  ASC-ITEM-ARRAY.                              03990000
040000                     25  ASC-ITEM-ENTRIES OCCURS  5 TIMES.        04000000
040100                         30  ASC-LIST-ITEM-NUMBER    PIC S9(09)   04010000
040200                                                     COMP-3.      04020000
040300                         30  ASC-VEND-NAME           PIC  X(30).  04030000
040400                         30  ASC-TYPE-CDE            PIC  X(02).  04040000
040500                                                                  04050000
040600             15  ASC-BLK-SUB                         PIC S9(04)   04060000
040700                                                          COMP    04070000
040800                                                          SYNC.   04080000
040900             15  ASC-ITEM-SUB                        PIC S9(04)   04090000
041000                                                          COMP    04100000
041100                                                          SYNC.   04110000
041200             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   04120000
041300                                                          COMP-3. 04130000
041400             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   04140000
041500                                                          COMP-3. 04150000
041600             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   04160000
041700                                                          COMP-3. 04170000
041800             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   04180000
041900                                                          COMP    04190000
042000                                                          SYNC.   04200000
042100             15  ASC-USE-SELECTION-QUE-IND           PIC  X(01).  04210000
042200                 88  ASC-USE-SELECTION-QUEUE         VALUE 'Y'.   04220000
042300             15  ASC-SEL-QUEUE-NAME                  PIC  X(08).  04230000
042400             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   04240000
042500                                                          COMP-3. 04250000
042600             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   04260000
042700                                                          COMP-3. 04270000
042800             15  ASC-SEL-SUB                         PIC S9(04)   04280000
042900                                                          COMP.   04290000
043000             15  ASC-SEL-ITEM                        PIC S9(04)   04300000
043100                                                          COMP.   04310000
043200             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  04320000
043300                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   04330000
043400                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   04340000
043500             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  04350000
043600                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   04360000
043700                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   04370000
043800             15  ASC-LIST-QUEUE-NAME.                             04380000
043900                 20  ASC-LIST-TERM-ID                PIC  X(04).  04390000
044000                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04400000
044100                                                          COMP-3. 04410000
044200                 20  ASC-LIST-SEQ                    PIC  9(01).  04420000
044300             15  ASC-START-ITEM-REQUEST.                          04430000
044400                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04440000
044500             15  ASC-PRNT-CO-ENT-ID                  PIC S9(09)   04450000
044600                                                     COMP.        04460000
044700     EJECT                                                        04470000
044800*---------------------------------------------------------------* 04480000
044900*    ABEND PROCESSING COPYBOOK.                                 * 04490000
045000*---------------------------------------------------------------* 04500000
045100                                                                  04510000
045200     COPY DPWS013.                                                04520000
045300                                                                  04530000
045400 EJECT                                                            04540000
045500*---------------------------------------------------------------* 04550000
045600*    DB2 AREA FOR EXTERNAL ENTERPRISE                           * 04560000
045700*---------------------------------------------------------------* 04570000
045800     EXEC SQL                                                     04580000
045900          INCLUDE TEXTENT                                         04590000
046000     END-EXEC.                                                    04600000
046100*---------------------------------------------------------------* 04610000
046200*    DB2 AREA FOR ENTERPRISE NAME                               * 04620000
046300*---------------------------------------------------------------* 04630000
046400     EXEC SQL                                                     04640000
046500          INCLUDE TENTNME                                         04650000
046600     END-EXEC.                                                    04660000
046700*---------------------------------------------------------------* 04670000
046800*    DB2 AREA FOR TPURCHS PO PURCHASE ORDER TABLE               * 04680000
046900*---------------------------------------------------------------* 04690000
047000     EXEC SQL                                                     04700000
047100          INCLUDE TPURCHS                                         04710000
047200     END-EXEC.                                                    04720000
047300*---------------------------------------------------------------* 04730000
047400*    DB2 AREA FOR TVNDDPT VENDOR DEPARTMENT RELATIONSHIP TABLE  * 04740000
047500*---------------------------------------------------------------* 04750000
047600     EXEC SQL                                                     04760000
047700          INCLUDE TVNDDPT                                         04770000
047800     END-EXEC.                                                    04780000
047900*---------------------------------------------------------------* 04790000
048000*    DB2 AREA FOR TVNDCTL VENDOR CONTROL TABLE                  * 04800000
048100*---------------------------------------------------------------* 04810000
048200     EXEC SQL                                                     04820000
048300          INCLUDE TVNDCTL                                         04830000
048400     END-EXEC.                                                    04840000
048500*---------------------------------------------------------------* 04850000
048600*    DB2 AREA FOR COMMUNICATIONS                                * 04860000
048700*---------------------------------------------------------------* 04870000
048800     EXEC SQL                                                     04880000
048900          INCLUDE SQLCA                                           04890000
049000     END-EXEC.                                                    04900000
049100*---------------------------------------------------------------* 04910000
049200*    VENDOR NAME CURSOR                                         * 04920000
049300*---------------------------------------------------------------* 04930000
049400                                                                  04940000
049500     EXEC SQL                                                     04950000
049600          DECLARE VENDOR-CSR CURSOR FOR                           04960000
049700          SELECT ENT_NAME_DESC,                                   04970000
049800                 TYPE_CDE,                                        04980000
049900                 SEQ_NBR                                          04990000
050000          FROM TENTNME                                            05000000
050100          WHERE ENT_ID = :ASC-ENT-ID                              05010000
050200            AND TYPE_CDE NOT IN ('05')                            05020000
050300          ORDER BY TYPE_CDE, ENT_NAME_DESC                        05030000
050400     END-EXEC.                                                    05040000
050500                                                                  05050000
050600 EJECT                                                            05060000
050700 LINKAGE SECTION.                                                 05070000
050800                                                                  05080000
050900 01  DFHCOMMAREA.                                                 05090000
051000     05  FILLER                         OCCURS  1 TO 4072 TIMES   05100000
051100                                        DEPENDING ON EIBCALEN.    05110000
051200         10  FILLER                     PIC X.                    05120000
051300                                                                  05130000
051400 EJECT                                                            05140000
051500 PROCEDURE DIVISION.                                              05150000
051600 0000-MAIN-MODULE.                                                05160000
051700     INITIALIZE DP030-CICS-API-FIELDS.                            05170000
051800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05180000
051900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05190000
052000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05200000
052100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05210000
052200     MOVE LENGTH OF VN006AI        TO DP030-MAP-LENGTH (1).       05220000
052300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05230000
052400     PERFORM 0001-CALL-CICS-ARCH-API.                             05240000
052500*                                                                 05250000
052600     PERFORM 1000-CONTROL-PROCESSING                              05260000
052700*                                                                 05270000
052800     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05280000
052900     PERFORM 0001-CALL-CICS-ARCH-API.                             05290000
053000                                                                  05300000
053100******************************************************************05310000
053200**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **05320000
053300**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **05330000
053400******************************************************************05340000
053500 0001-CALL-CICS-ARCH-API.                                         05350000
053600*    CALL 'DPKCS030' USING DFHEIBLK                               05360003
053600     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05361004
053700                           DFHCOMMAREA                            05370000
053800                           DP030-CICS-API-FIELDS                  05380000
053900                           DP020-STANDARD-COMMAREA                05390000
054000                           VN006AI.                               05400000
054100*                                                                 05410000
054200     IF  DP030-RC-CALL-SUCCESSFUL                                 05420000
054300         CONTINUE                                                 05430000
054400     ELSE                                                         05440000
054500         SET DP013-NO-ROLLBACK                                    05450000
054600             DP013-XCTL-DISPLAY-RESTART                           05460000
054700             DP013-CICS-ABEND      TO TRUE                        05470000
054800         MOVE '0001-CALL-CICS-ARCH-API'                           05480000
054900                                   TO DP013-PARAGRAPH             05490000
055000*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX05500003
055100*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      05510003
055000         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05511003
055100-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05512003
055200         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05520000
055300         PERFORM DP013-0000-PROCESS-ABEND.                        05530000
055400*----------------------------------------------------------------*05540000
055500* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05550000
055600* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05560000
055700*----------------------------------------------------------------*05570000
055800                                                                  05580000
055900 1000-CONTROL-PROCESSING.                                         05590000
056000                                                                  05600000
056100     EVALUATE TRUE                                                05610000
056200         WHEN DP020-NEXT-ACT-INITIAL                              05620000
056300             INITIALIZE ASC-SPECIFIC-COMMAREA                     05630000
056400             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05640000
056500             MOVE DP020-SRC-TASK-NUMBER                           05650000
056600                                   TO ASC-LIST-TASK-NUMBER        05660000
056700             MOVE PC-LIST-QUEUE-SEQ                               05670000
056800                                   TO ASC-LIST-SEQ                05680000
056900             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05690000
057000             IF PS-ERROR                                          05700000
057100                 CONTINUE                                         05710000
057200             ELSE                                                 05720000
057300                 PERFORM 4000-BUILD-INITIAL-PANEL                 05730000
057400             END-IF                                               05740000
057500                                                                  05750000
057600         WHEN DP020-NEXT-ACT-READ-MAP                             05760000
057700             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05770000
057800                                   TO PV-TOP-ITEM                 05780000
057900             PERFORM 2000-PROCESS-PANEL                           05790000
058000                                                                  05800000
058100         WHEN DP020-NEXT-ACT-RETURN                               05810000
058200             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05820000
058300                                   TO PV-TOP-ITEM                 05830000
058400             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05840000
058500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05850000
058600                                                                  05860000
058700         WHEN OTHER                                               05870000
058800             SET DP013-LOGIC-ABEND TO TRUE                        05880000
058900             SET DP013-NO-ROLLBACK TO TRUE                        05890000
059000             MOVE '1000-CONTROL-PROCESSING'                       05900000
059100                                   TO DP013-PARAGRAPH             05910000
059200             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05920000
059300                                   TO DP013-MESSAGE-TEXT(1)       05930000
059400             PERFORM DP013-0000-PROCESS-ABEND                     05940000
059500     END-EVALUATE.                                                05950000
059600                                                                  05960000
059700 EJECT                                                            05970000
059800*----------------------------------------------------------------*05980000
059900* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05990000
060000* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06000000
060100*----------------------------------------------------------------*06010000
060200                                                                  06020000
060300 1100-PROCESS-INTER-APPL-COMM.                                    06030000
060400                                                                  06040000
060500     EVALUATE DP020-INT-APPL-FORMAT-IND                           06050000
060600         WHEN PC-INTER-APPL-CRIT                                  06060000
060700             IF  VN001-DUNS-NUMBER > SPACES                       06070000
060800                 MOVE VN001-DUNS-NUMBER TO ASC-KEY-DUNS-NBR       06080000
060900             ELSE                                                 06090000
061000             IF VN001-VENDOR-NAME > SPACES                        06100000
061100                 MOVE VN001-VENDOR-NAME TO ASC-KEY-VEND-NAME      06110000
061200             ELSE                                                 06120000
061300                 MOVE PC-TSYMSG-00487                             06130000
061400                                        TO DP020-MSG-NUMBER       06140000
061500                 SET DP020-MSG-FATAL                              06150000
061600                     DP020-NEXT-ACT-APPL-ERROR                    06160000
061700                     PS-ERROR                                     06170000
061800                                        TO TRUE                   06180000
061900             END-IF                                               06190000
062000             END-IF                                               06200000
062100                                                                  06210000
062200         WHEN PC-INTER-APPL-LIST                                  06220000
062300             SET ASC-USE-SELECTION-QUEUE TO TRUE                  06230000
062400             MOVE VN002-NUMBER-OF-SELECTED-ITEMS                  06240000
062500                                   TO ASC-NUMBER-OF-SELECTED-ITEMS06250000
062600             MOVE VN002-NUMBER-OF-TS-ITEMS                        06260000
062700                                   TO ASC-NUMBER-OF-TS-ITEMS      06270000
062800             MOVE VN002-SEL-QUEUE-NAME                            06280000
062900                                   TO ASC-SEL-QUEUE-NAME          06290000
063000             PERFORM 1120-PREPARE-LIST-ENTRY                      06300000
063100                                                                  06310000
063200     END-EVALUATE.                                                06320000
063300*----------------------------------------------------------------*06330000
063400* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *06340000
063500* STORAGE QUEUE PASSED FROM THE LIST.                            *06350000
063600*----------------------------------------------------------------*06360000
063700 1120-PREPARE-LIST-ENTRY.                                         06370000
063800     MOVE VN003-MAX-ITEMS          TO ASC-SEL-SUB.                06380000
063900     MOVE ZERO                     TO ASC-SEL-ITEM.               06390000
064000     PERFORM 2110-GET-NEXT-VENDOR.                                06400000
064100                                                                  06410000
064200 EJECT                                                            06420000
064300*----------------------------------------------------------------*06430000
064400* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06440000
064500* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06450000
064600* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06460000
064700* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06470000
064800* FUNCTION KEYS CAN GET THIS FAR.                                *06480000
064900*----------------------------------------------------------------*06490000
065000                                                                  06500000
065100 2000-PROCESS-PANEL.                                              06510000
065200     EVALUATE TRUE                                                06520000
065300         WHEN DP020-SRC-AID = DP016-CLEAR                         06530000
065400             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06540000
065500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06550000
065600                                                                  06560000
065700         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06570000
065800             PERFORM 2050-DELETE-LIST-QUEUE                       06580000
065900             PERFORM 4000-BUILD-INITIAL-PANEL                     06590000
066000                                                                  06600000
066100         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             06610000
066200             IF  ASC-USE-SELECTION-QUEUE                          06620000
066300                 PERFORM 2050-DELETE-LIST-QUEUE                   06630000
066400                 PERFORM 2110-GET-NEXT-VENDOR                     06640000
066500                 PERFORM 4000-BUILD-INITIAL-PANEL                 06650000
066600             ELSE                                                 06660000
066700*                --- BOTTOM OF LIST ---                           06670000
066800                 MOVE PC-TSYMSG-00070                             06680000
066900                                   TO DP020-MSG-NUMBER            06690000
067000                 SET DP020-MSG-INFORMATIONAL                      06700000
067100                                   TO TRUE                        06710000
067200             END-IF                                               06720000
067300                                                                  06730000
067400         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             06740000
067500             IF  ASC-USE-SELECTION-QUEUE                          06750000
067600                 PERFORM 2050-DELETE-LIST-QUEUE                   06760000
067700                 PERFORM 2120-GET-PREV-VENDOR                     06770000
067800                 PERFORM 4000-BUILD-INITIAL-PANEL                 06780000
067900             ELSE                                                 06790000
068000*                --- TOP OF LIST ---                              06800000
068100                 MOVE PC-TSYMSG-00069                             06810000
068200                                   TO DP020-MSG-NUMBER            06820000
068300                 SET DP020-MSG-INFORMATIONAL                      06830000
068400                                   TO TRUE                        06840000
068500             END-IF                                               06850000
068600                                                                  06860000
068700         WHEN OTHER                                               06870000
068800             PERFORM 2100-CHECK-FUNCTION-KEY                      06880000
068900     END-EVALUATE.                                                06890000
069000 EJECT                                                            06900000
069100*----------------------------------------------------------------*06910000
069200*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06920000
069300*----------------------------------------------------------------*06930000
069400 2050-DELETE-LIST-QUEUE.                                          06940000
069500                                                                  06950000
069600     EXEC CICS                                                    06960000
069700         DELETEQ TS                                               06970000
069800             QUEUE (ASC-LIST-QUEUE-NAME)                          06980000
069900             RESP  (PV-CICS-RESP)                                 06990000
070000     END-EXEC.                                                    07000000
070100                                                                  07010000
070200     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07020000
070300        (PV-CICS-RESP = DFHRESP(QIDERR))                          07030000
070400         CONTINUE                                                 07040000
070500     ELSE                                                         07050000
070600         SET DP013-CICS-ABEND      TO TRUE                        07060000
070700         SET DP013-NO-ROLLBACK     TO TRUE                        07070000
070800                                                                  07080000
070900         MOVE '2050-DELETE-LIST-QUEUE'                            07090000
071000                                   TO DP013-PARAGRAPH             07100000
071100         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    07110000
071200                                   TO DP013-MESSAGE-TEXT (1)      07120000
071300         PERFORM DP013-0000-PROCESS-ABEND                         07130000
071400     END-IF.                                                      07140000
071500                                                                  07150000
071600     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  07160000
071700 EJECT                                                            07170000
071800*----------------------------------------------------------------*07180000
071900* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*07190000
072000* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *07200000
072100* CICS ARCHITECTURE API.                                         *07210000
072200*----------------------------------------------------------------*07220000
072300 2100-CHECK-FUNCTION-KEY.                                         07230000
072400     EVALUATE TRUE                                                07240000
072500         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              07250000
072600         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              07260000
072700         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              07270000
072900             INITIALIZE VN004-INTER-APPL-COMMAREA                 07290000
073000             MOVE ASC-ENT-ID TO VN004-ENT-ID                      07300000
073100                                                                  07310000
073200         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07320000
073300             MOVE +1               TO PV-TOP-ITEM                 07330000
073400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07340000
073500                                                                  07350000
073600         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07360000
073700             PERFORM 2110-BROWSE-BACKWARD                         07370000
073800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07380000
073900                                                                  07390000
074000         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07400000
074100             PERFORM 2120-BROWSE-FORWARD                          07410000
074200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07420000
074300                                                                  07430000
074400         WHEN DP020-SRC-AID = DP016-ENTER                         07440000
074500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07450000
074600                                                                  07460000
074700         WHEN OTHER                                               07470000
074800             SET DP013-NO-ROLLBACK                                07480000
074900                 DP013-XCTL-DISPLAY-RESTART                       07490000
075000                 DP013-CICS-ABEND  TO TRUE                        07500000
075100             MOVE '2100-CHECK-FUNCTION-KEY'                       07510000
075200                                   TO DP013-PARAGRAPH             07520000
075300             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07530000
075400                                   TO DP013-MESSAGE-TEXT (1)      07540000
075500             PERFORM DP013-0000-PROCESS-ABEND                     07550000
075600     END-EVALUATE.                                                07560000
075700*                                                                 07570000
075800*----------------------------------------------------------------*07580000
075900*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07590000
076000*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07600000
076100*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07610000
076200*    MESSAGE.                                                    *07620000
076300*----------------------------------------------------------------*07630000
076400                                                                  07640000
076500 2110-BROWSE-BACKWARD.                                            07650000
076600     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07660000
076700         GIVING PV-TOP-ITEM.                                      07670000
076800*                                                                 07680000
076900     IF  ((PV-TOP-ITEM < +1)                                      07690000
077000       OR (PV-TOP-ITEM = +1))                                     07700000
077100         MOVE +1                   TO PV-TOP-ITEM                 07710000
077200*        -- TOP OF LIST --                                        07720000
077300         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07730000
077400         SET DP020-MSG-INFORMATIONAL TO TRUE                      07740000
077500     END-IF.                                                      07750000
077600                                                                  07760000
077700 EJECT                                                            07770000
077800*----------------------------------------------------------------*07780000
077900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07790000
078000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07800000
078100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07810000
078200*----------------------------------------------------------------*07820000
078300                                                                  07830000
078400 2120-BROWSE-FORWARD.                                             07840000
078500                                                                  07850000
078600     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07860000
078700         GIVING PV-TOP-ITEM.                                      07870000
078800     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07880000
078900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07890000
079000                                   TO PV-TOP-ITEM                 07900000
079100*        -- BOTTOM OF LIST --                                     07910000
079200         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07920000
079300         SET DP020-MSG-INFORMATIONAL                              07930000
079400                                   TO TRUE                        07940000
079500     ELSE                                                         07950000
079600         COMPUTE PV-BOTTOM-ITEM =                                 07960000
079700             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07970000
079800         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07980000
079900*            -- BOTTOM OF LIST --                                 07990000
080000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08000000
080100             SET DP020-MSG-INFORMATIONAL                          08010000
080200                                   TO TRUE                        08020000
080300         END-IF                                                   08030000
080400     END-IF.                                                      08040000
080500 EJECT                                                            08050000
080600******************************************************************08060000
080700** GET THE VENDOR  NUMBER (KEY) OF THE NEXT SELECTED            **08070000
080800** OBJECT FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.          **08080000
080900******************************************************************08090000
081000 2110-GET-NEXT-VENDOR.                                            08100000
081100     ADD +1                        TO ASC-SEL-SUB.                08110000
081200     IF  ASC-SEL-SUB > VN003-MAX-ITEMS                            08120000
081300         ADD +1                    TO ASC-SEL-ITEM                08130000
081400         MOVE +1                   TO ASC-SEL-SUB                 08140000
081500     END-IF.                                                      08150000
081600     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                08160000
081700         PERFORM 9100-READ-SEL-QUEUE                              08170000
081800         IF  VN003-ENT-ID (ASC-SEL-SUB) > ZERO                    08180000
081900             MOVE VN003-ENT-ID (ASC-SEL-SUB)                      08190000
082000                                   TO ASC-ENT-ID                  08200000
082100             SET VN003-INQ (ASC-SEL-SUB)                          08210000
082200                                   TO TRUE                        08220000
082300             PERFORM 9200-REWRITE-LIST-QUEUE                      08230000
082400         ELSE                                                     08240000
082500             SUBTRACT +1 FROM ASC-SEL-SUB                         08250000
082600*            --- BOTTOM OF LIST ---                               08260000
082700             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08270000
082800             SET DP020-MSG-INFORMATIONAL                          08280000
082900                                   TO TRUE                        08290000
083000         END-IF                                                   08300000
083100     ELSE                                                         08310000
083200         SUBTRACT +1 FROM ASC-SEL-ITEM                            08320000
083300         MOVE VN003-MAX-ITEMS      TO ASC-SEL-SUB                 08330000
083400         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08340000
083500         SET DP020-MSG-INFORMATIONAL                              08350000
083600                                   TO TRUE                        08360000
083700     END-IF.                                                      08370000
083800******************************************************************08380000
083900** GET THE MESSAGE NUMBER (KEY) OF THE PREVIOUS SELECTED        **08390000
084000** OBJECT FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.          **08400000
084100******************************************************************08410000
084200 2120-GET-PREV-VENDOR.                                            08420000
084300     SUBTRACT +1 FROM ASC-SEL-SUB.                                08430000
084400     IF  ASC-SEL-SUB < +1                                         08440000
084500         SUBTRACT +1 FROM ASC-SEL-ITEM                            08450000
084600         MOVE VN003-MAX-ITEMS      TO ASC-SEL-SUB                 08460000
084700     END-IF.                                                      08470000
084800*                                                                 08480000
084900     IF  ASC-SEL-ITEM > ZERO                                      08490000
085000         PERFORM 9100-READ-SEL-QUEUE                              08500000
085100         MOVE VN003-ENT-ID (ASC-SEL-SUB)                          08510000
085200                                   TO ASC-ENT-ID                  08520000
085300     ELSE                                                         08530000
085400         MOVE +1                   TO ASC-SEL-ITEM                08540000
085500                                      ASC-SEL-SUB                 08550000
085600*        --- TOP OF LIST ---                                      08560000
085700         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            08570000
085800         SET DP020-MSG-INFORMATIONAL                              08580000
085900                                   TO TRUE                        08590000
086000     END-IF.                                                      08600000
086100 EJECT                                                            08610000
086200*----------------------------------------------------------------*08620000
086300*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *08630000
086400*    INITIALIZE ALL COUNTERS AND FLAGS.                          *08640000
086500*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *08650000
086600*    DISPLAY THE PANEL TO USER.                                  *08660000
086700*----------------------------------------------------------------*08670000
086800                                                                  08680000
086900 4000-BUILD-INITIAL-PANEL.                                        08690000
087000                                                                  08700000
087100     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            08710000
087200                                 ASC-BLOCK-ENTRIES (2)            08720000
087300                                 ASC-SCREEN-DATA.                 08730000
087400     MOVE +1                 TO ASC-BLK-SUB.                      08740000
087500     SET ASC-ITEMS-LEFT-ON-DB                                     08750000
087600                             TO TRUE.                             08760000
087700                                                                  08770000
087800     MOVE +0                 TO ASC-ITEM-SUB                      08780000
087900                                ASC-NUMBER-OF-ITEMS-READ          08790000
088000                                ASC-HIGHEST-BLOCK-WRITTEN         08800000
088100                                ASC-ITEM-AT-TOP-OF-PANEL.         08810000
088200                                                                  08820000
088300     EVALUATE DP020-INT-APPL-FORMAT-IND                           08830000
088400         WHEN PC-INTER-APPL-CRIT                                  08840000
088500             IF ASC-KEY-VEND-NAME > SPACES                        08850000
088600                 PERFORM 4001-GET-ENT-VIA-NAME                    08860000
088700                 IF SQLCODE = ZERO                                08870000
088800                     PERFORM 4099-GET-VENDOR-FROM-ENT             08880000
088900                 END-IF                                           08890000
089000             ELSE                                                 08900000
089100             IF ASC-KEY-DUNS-NBR > SPACES                         08910000
089200                 PERFORM 4002-GET-ENT-VIA-DUNS                    08920000
089300                 IF SQLCODE = ZERO                                08930000
089400                     PERFORM 4099-GET-VENDOR-FROM-ENT             08940000
089500                 END-IF                                           08950000
089600             ELSE                                                 08960000
089700                 IF SQLCODE = ZERO                                08970000
089800                     PERFORM 4099-GET-VENDOR-FROM-ENT             08980000
089900                 END-IF                                           08990000
090000             END-IF                                               09000000
090100             END-IF                                               09010000
090200         WHEN PC-INTER-APPL-LIST                                  09020000
090300             PERFORM 4099-GET-VENDOR-FROM-ENT                     09030000
090400     END-EVALUATE.                                                09040000
090500                                                                  09050000
090600     IF SQLCODE = ZERO                                            09060000
090700         IF ASC-CAP-EXP-CDE = 'Y'                                 09070000
090800             PERFORM 4010-GET-DEPARTMENT                          09080000
090900         ELSE                                                     09090000
091000             MOVE SPACES TO ASC-DEPARTMENT                        09100000
091100         END-IF                                                   09110000
091200         PERFORM 4050-GET-RANK-YEAR                               09120000
091300         PERFORM 4200-GET-NAMES                                   09130000
091400         PERFORM 4300-GET-PO-DATES                                09140000
091500         IF (PV-LAST-PO-DATE-IND = -1)                            09150000
091600             MOVE SPACES TO ASC-LAST-PO-DATE                      09160000
091700         END-IF                                                   09170000
091800         PERFORM 4308-DATE-ONE-YEAR-PRIOR-CALC                    09180000
091900         PERFORM 4310-GET-ORDERS-COUNT                            09190000
092000         MOVE ASC-ORDERS-COUNT     TO  ASC-HOLD-L12-COUNT         09200000
092100         PERFORM 4309-FIRST-DAY-FISCAL-YR-CALC                    09210000
092200         PERFORM 4310-GET-ORDERS-COUNT                            09220000
092300         MOVE ASC-ORDERS-COUNT     TO  ASC-HOLD-ORDERS-YTD        09230000
092400         MOVE ASC-CFY-SLSRNK-NBR   TO  ASC-VENDOR-RANK-YTD        09240000
092500         MOVE ASC-PFY-SLSRNK-NBR   TO  ASC-VENDOR-RANK-LY         09250000
092600         MOVE +1                   TO  PV-TOP-ITEM                09260000
092700         SET DP030-SET-CURSOR-APPL-1                              09270000
092800                               TO TRUE                            09280000
092900                                                                  09290000
093000         MOVE ASC-CURR-FSCL-YR TO PV-YTD-YR                       09300000
093100         MOVE ':' TO PV-COLON-1                                   09310000
093200         MOVE PV-YTD-COLON TO ASC-CURR-YEAR                       09320000
093300                                                                  09330000
093400         MOVE ASC-PREV-FSCL-YR TO PV-PREV-YR                      09340000
093500         MOVE ':' TO PV-COLON-2                                   09350000
093600         MOVE PV-PREV-YR-COLON TO ASC-PREV-YEAR                   09360000
093700         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     09370000
093800     ELSE                                                         09380000
093900         IF ASC-KEY-VEND-NAME > SPACES                            09390000
094000             SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                09400000
094100             SET DP020-MSG-FATAL   TO  TRUE                       09410000
094200             MOVE PC-TSYMSG-00398  TO  DP020-MSG-NUMBER           09420000
094300         ELSE                                                     09430000
094400         IF ASC-KEY-DUNS-NBR > SPACES                             09440000
094500             SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                09450000
094600             SET DP020-MSG-FATAL   TO  TRUE                       09460000
094700             MOVE PC-TSYMSG-00159  TO  DP020-MSG-NUMBER           09470000
094800         END-IF                                                   09480000
094900         END-IF                                                   09490000
095000     END-IF.                                                      09500000
095100                                                                  09510000
095200 EJECT                                                            09520000
095300*----------------------------------------------------------------*09530000
095400* GET ENT ID FROM CRITERIA FIELD ENTERED                         *09540000
095500*----------------------------------------------------------------*09550000
095600                                                                  09560000
095700 4001-GET-ENT-VIA-NAME.                                           09570000
095800     PERFORM                                                      09580000
095900         WITH TEST AFTER                                          09590000
096000         VARYING PV-RETRY-COUNTER                                 09600000
096100         FROM 1 BY 1                                              09610000
096200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09620000
096300                   OR (SQLCODE = ZERO)                            09630000
096400                   OR (SQLCODE = +100))                           09640000
096500             EXEC SQL                                             09650000
096600                  SELECT B.ENT_ID                                 09660000
096700                  INTO  :ASC-ENT-ID                               09670000
096800                  FROM TENTNME A,                                 09680000
096900                       TEXTENT B                                  09690000
097000                  WHERE A.ENT_NAME_DESC = :ASC-KEY-VEND-NAME      09700000
097100                    AND B.ENT_ID = A.ENT_ID                       09710000
097200             END-EXEC                                             09720000
097300         EVALUATE TRUE                                            09730000
097400             WHEN SQLCODE = ZERO                                  09740000
097500             WHEN SQLCODE = +100                                  09750000
097600             WHEN SQLCODE = -904                                  09760000
097700             WHEN SQLCODE = -913                                  09770000
097800                 CONTINUE                                         09780000
097900             WHEN SQLWARN0 NOT = SPACES                           09790000
098000             WHEN SQLCODE < ZERO                                  09800000
098100             WHEN SQLCODE > ZERO                                  09810000
098200                 MOVE '4001-GET-ENT-VIA-NAME'                     09820000
098300                                   TO DP013-PARAGRAPH             09830000
098400                 MOVE 'SELECT TENTNME'                            09840000
098500                                   TO DP013-MESSAGE-TEXT (1)      09850000
098600                 MOVE SQLCA        TO DP013-SQLCA                 09860000
098700                 MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (1)    09870000
098800                 SET DP013-DB2-ABEND                              09880000
098900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09890000
099000                 PERFORM DP013-0000-PROCESS-ABEND                 09900000
099100         END-EVALUATE                                             09910000
099200     END-PERFORM                                                  09920000
099300                                                                  09930000
099400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09940000
099500         MOVE '4001-GET-ENT-VIA-NAME'                             09950000
099600                                   TO DP013-PARAGRAPH             09960000
099700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO READ    '   09970000
099800                                   TO DP013-MESSAGE-TEXT (1)      09980000
099900         MOVE SQLCA                TO DP013-SQLCA                 09990000
100000         MOVE 'TENTNME '           TO DP013-DB2-TABLE-NAME (1)    10000000
100100         SET DP013-DB2-ABEND                                      10010000
100200             DP013-XCTL-DISPLAY-RESTART                           10020000
100300                                   TO TRUE                        10030000
100400         PERFORM DP013-0000-PROCESS-ABEND                         10040000
100500     END-IF.                                                      10050000
100600                                                                  10060000
100700 4002-GET-ENT-VIA-DUNS.                                           10070000
100800     PERFORM                                                      10080000
100900         WITH TEST AFTER                                          10090000
101000         VARYING PV-RETRY-COUNTER                                 10100000
101100         FROM 1 BY 1                                              10110000
101200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10120000
101300                   OR (SQLCODE = ZERO)                            10130000
101400                   OR (SQLCODE = +100))                           10140000
101500             EXEC SQL                                             10150000
101600                  SELECT ENT_ID                                   10160000
101700                  INTO  :ASC-ENT-ID                               10170000
101800                  FROM TEXTENT                                    10180000
101900                  WHERE DUN_NBR = :ASC-KEY-DUNS-NBR               10190000
102000             END-EXEC                                             10200000
102100         EVALUATE TRUE                                            10210000
102200             WHEN SQLCODE = ZERO                                  10220000
102300             WHEN SQLCODE = +100                                  10230000
102400             WHEN SQLCODE = -904                                  10240000
102500             WHEN SQLCODE = -913                                  10250000
102600                 CONTINUE                                         10260000
102700             WHEN SQLWARN0 NOT = SPACES                           10270000
102800             WHEN SQLCODE < ZERO                                  10280000
102900             WHEN SQLCODE > ZERO                                  10290000
103000                 MOVE '4002-GET-ENT-VIA-DUNS'                     10300000
103100                                   TO DP013-PARAGRAPH             10310000
103200                 MOVE 'SELECT TEXTENT'                            10320000
103300                                   TO DP013-MESSAGE-TEXT (1)      10330000
103400                 MOVE SQLCA        TO DP013-SQLCA                 10340000
103500                 MOVE 'TEXTENT '   TO DP013-DB2-TABLE-NAME (1)    10350000
103600                 SET DP013-DB2-ABEND                              10360000
103700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           10370000
103800                 PERFORM DP013-0000-PROCESS-ABEND                 10380000
103900         END-EVALUATE                                             10390000
104000     END-PERFORM                                                  10400000
104100                                                                  10410000
104200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10420000
104300         MOVE '4002-GET-ENT-VIA-DUNS'                             10430000
104400                                   TO DP013-PARAGRAPH             10440000
104500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO READ    '   10450000
104600                                   TO DP013-MESSAGE-TEXT (1)      10460000
104700         MOVE SQLCA                TO DP013-SQLCA                 10470000
104800         MOVE 'TEXTENT '           TO DP013-DB2-TABLE-NAME (1)    10480000
104900         SET DP013-DB2-ABEND                                      10490000
105000             DP013-XCTL-DISPLAY-RESTART                           10500000
105100                                   TO TRUE                        10510000
105200         PERFORM DP013-0000-PROCESS-ABEND                         10520000
105300     END-IF.                                                      10530000
105400                                                                  10540000
105500*----------------------------------------------------------------*10550000
105600* GET DEPARTMENT NUMBER FOR CAPITAL AND EXPENSE VENDORS          *10560000
105700*----------------------------------------------------------------*10570000
105800                                                                  10580000
105900 4010-GET-DEPARTMENT.                                             10590000
106000                                                                  10600000
106100     PERFORM                                                      10610000
106200         WITH TEST AFTER                                          10620000
106300         VARYING PV-RETRY-COUNTER                                 10630000
106400         FROM 1 BY 1                                              10640000
106500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10650000
106600                   OR (SQLCODE = ZERO)                            10660000
106700                   OR (SQLCODE = -811)                            10670000
106800                   OR (SQLCODE = +100))                           10680000
106900             EXEC SQL                                             10690000
107000                  SELECT DEPT_NBR                                 10700000
107100                   INTO :ASC-DEPARTMENT                           10710000
107200                  FROM TVNDDPT                                    10720000
107300                  WHERE ENT_ID = :ASC-ENT-ID                      10730000
107400                    AND VEND_TYP_IND = 'E'                        10740000
107500                    AND VND_DEPT_STAT_CD = 'A'                    10750000
107600             END-EXEC                                             10760000
107700         EVALUATE TRUE                                            10770000
107800             WHEN SQLCODE = ZERO                                  10780000
107900             WHEN SQLCODE = -904                                  10790000
108000             WHEN SQLCODE = -913                                  10800000
108100                 CONTINUE                                         10810000
108200             WHEN SQLCODE = +100                                  10820000
108300                  MOVE SPACES TO ASC-DEPARTMENT                   10830000
108400             WHEN SQLCODE = -811                                  10840000
108500                  MOVE 'MLT'  TO ASC-DEPARTMENT                   10850000
108600             WHEN SQLWARN0 NOT = SPACES                           10860000
108700             WHEN SQLCODE < ZERO                                  10870000
108800             WHEN SQLCODE > ZERO                                  10880000
108900                 MOVE '4010-GET-DEPARTMENT'                       10890000
109000                                   TO DP013-PARAGRAPH             10900000
109100                 MOVE 'SELECT TVNDDPT'                            10910000
109200                                   TO DP013-MESSAGE-TEXT (1)      10920000
109300                 MOVE SQLCA        TO DP013-SQLCA                 10930000
109400                 MOVE 'TVNDDPT '   TO DP013-DB2-TABLE-NAME (1)    10940000
109500                 SET DP013-DB2-ABEND                              10950000
109600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           10960000
109700                 PERFORM DP013-0000-PROCESS-ABEND                 10970000
109800         END-EVALUATE                                             10980000
109900     END-PERFORM                                                  10990000
110000                                                                  11000000
110100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11010000
110200         MOVE '4010-GET-DEPARTMENT'                               11020000
110300                                   TO DP013-PARAGRAPH             11030000
110400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO READ    '   11040000
110500                                   TO DP013-MESSAGE-TEXT (1)      11050000
110600         MOVE SQLCA                TO DP013-SQLCA                 11060000
110700         MOVE 'TVNDDPT '           TO DP013-DB2-TABLE-NAME (1)    11070000
110800         SET DP013-DB2-ABEND                                      11080000
110900             DP013-XCTL-DISPLAY-RESTART                           11090000
111000                                   TO TRUE                        11100000
111100         PERFORM DP013-0000-PROCESS-ABEND                         11110000
111200     END-IF.                                                      11120000
111300                                                                  11130000
111400*----------------------------------------------------------------*11140000
111500* GET THE YEAR THE VENDOR RANK REPRESENTS                        *11150000
111600*----------------------------------------------------------------*11160000
111700                                                                  11170000
111800 4050-GET-RANK-YEAR.                                              11180000
111900                                                                  11190000
112000     PERFORM                                                      11200000
112100         WITH TEST AFTER                                          11210000
112200         VARYING PV-RETRY-COUNTER                                 11220000
112300         FROM 1 BY 1                                              11230000
112400         UNTIL (PV-RETRY-COUNTER > PC-MAX-RETRIES)                11240000
112500                   OR (SQLCODE = ZERO)                            11250000
112600                                                                  11260000
112700             EXEC SQL                                             11270000
112800                  SELECT PRCG_FSCL_YR_NBR                         11280000
112900                   INTO :ASC-CURR-FSCL-YR                         11290000
113000                  FROM TVNDCTL                                    11300000
113100             END-EXEC                                             11310000
113200         EVALUATE TRUE                                            11320000
113300             WHEN SQLCODE = ZERO                                  11330000
113400                 MOVE ASC-CURR-FSCL-YR TO PV-CURR-FSCL-YR         11340000
113500                 COMPUTE PV-PREV-FSCL-YR = PV-CURR-FSCL-YR - 1    11350000
113600                 MOVE PV-PREV-FSCL-YR TO ASC-PREV-FSCL-YR         11360000
113700             WHEN SQLCODE = -904                                  11370000
113800             WHEN SQLCODE = -913                                  11380000
113900                 CONTINUE                                         11390000
114000             WHEN SQLWARN0 NOT = SPACES                           11400000
114100             WHEN SQLCODE < ZERO                                  11410000
114200             WHEN SQLCODE > ZERO                                  11420000
114300                 MOVE '4050-GET-RANK-YEAR'                        11430000
114400                                   TO DP013-PARAGRAPH             11440000
114500                 MOVE 'SELECT TVNDCTL'                            11450000
114600                                   TO DP013-MESSAGE-TEXT (1)      11460000
114700                 MOVE SQLCA        TO DP013-SQLCA                 11470000
114800                 MOVE 'TVNDCTL '   TO DP013-DB2-TABLE-NAME (1)    11480000
114900                 SET DP013-DB2-ABEND                              11490000
115000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           11500000
115100                 PERFORM DP013-0000-PROCESS-ABEND                 11510000
115200         END-EVALUATE                                             11520000
115300     END-PERFORM                                                  11530000
115400                                                                  11540000
115500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11550000
115600         MOVE '4050-GET-RANK-YEAR'                                11560000
115700                                   TO DP013-PARAGRAPH             11570000
115800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO READ    '   11580000
115900                                   TO DP013-MESSAGE-TEXT (1)      11590000
116000         MOVE SQLCA                TO DP013-SQLCA                 11600000
116100         MOVE 'TVNDCTL '           TO DP013-DB2-TABLE-NAME (1)    11610000
116200         SET DP013-DB2-ABEND                                      11620000
116300             DP013-XCTL-DISPLAY-RESTART                           11630000
116400                                   TO TRUE                        11640000
116500         PERFORM DP013-0000-PROCESS-ABEND                         11650000
116600     END-IF.                                                      11660000
116700                                                                  11670000
116800*----------------------------------------------------------------*11680000
116900* GET NON LIST SCREEN FIELDS FROM ENTERPRISE                     *11690000
117000*----------------------------------------------------------------*11700000
117100                                                                  11710000
117200 4099-GET-VENDOR-FROM-ENT.                                        11720000
117300     PERFORM                                                      11730000
117400         WITH TEST AFTER                                          11740000
117500         VARYING PV-RETRY-COUNTER                                 11750000
117600         FROM 1 BY 1                                              11760000
117700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11770000
117800                   OR (SQLCODE = ZERO)                            11780000
117900                   OR (SQLCODE = +100))                           11790000
118000             EXEC SQL                                             11800000
118100                  SELECT SCAC_CDE,                                11810000
118200                         DUN_NBR,                                 11820000
118300                         ASN_TRSCP_IND,                           11830000
118400                         STATUS_CDE,                              11840000
118500                         CARR_MAN_PRO_IND,                        11850000
118600                         NEED_1099_IND,                           11860000
118700                         DATE (CRE_TMST),                         11870000
118800                         CFY_SLSRNK_NBR,                          11880000
118900                         PFY_SLSRNK_NBR,                          11890000
119000                         PRNT_CO_ENT_ID,                          11900000
119100*                        FED_TX_ID_TYP_CDE,                       11910000
119200*                        FED_TX_ID_NBR,                           11920000
119300                         PRNT_CO_IND,                             11930000
119400                         CAP_EXP_CDE,                             11940000
119500                         HLD_PAYT_IND,                            11950000
119600                         EDI_PO_PREPK_CDE,                        11960000
119700                         PRIM_TYP_CDE,                            11970000
119800                         PRTNR_IND,                               11980000
119900                         PRTNR_TYP_CDE,                           11990000
120000                         LNE_OF_CR_AMT,                           12000000
120100                         NDA_IND,                                 12010000
120200                         NDA_BEG_DTE,                             12020000
120300                         NDA_END_DTE                              12030000
120400                   INTO :ASC-SCAC-CDE,                            12040000
120500                        :ASC-DUN-NBR,                             12050000
120600                        :ASC-EDI856-IND,                          12060000
120700                        :ASC-STATUS-CDE,                          12070000
120800                        :ASC-MAN-PRO-IND,                         12080000
120900                        :ASC-NEED-1099,                           12090000
121000                        :ASC-CRE-DATE,                            12100000
121100                        :ASC-CFY-SLSRNK-NBR,                      12110000
121200                        :ASC-PFY-SLSRNK-NBR,                      12120000
121300                        :ASC-PRNT-CO-ENT-ID,                      12130000
121400*                       :ASC-FED-TX-ID-TYP-CDE,                   12140000
121500*                       :ASC-FED-TX-ID-NBR,                       12150000
121600                        :ASC-PRNT-CO-IND,                         12160000
121700                        :ASC-CAP-EXP-CDE,                         12170000
121800                        :ASC-HLD-PAYT-IND,                        12180000
121900                        :ASC-EDI-PO-PREPK-CDE,                    12190000
122000                        :ASC-PRIMARY-TYPE,                        12200000
122100                        :ASC-PARTNER-IND,                         12210000
122200                        :ASC-PARTNER-TYP-CDE,                     12220000
122300                        :ASC-LINE-OF-CRDT,                        12230000
122400                        :ASC-NDA-FLAG,                            12240000
122500                        :ASC-NDA-BEG-DATE,                        12250000
122600                        :ASC-NDA-END-DATE                         12260000
122700                  FROM TEXTENT                                    12270000
122800                  WHERE ENT_ID = :ASC-ENT-ID                      12280000
122900             END-EXEC                                             12290000
123000                                                                  12300000
123100         EVALUATE TRUE                                            12310000
123200             WHEN SQLCODE = ZERO                                  12320000
123300             WHEN SQLCODE = +100                                  12330000
123400             WHEN SQLCODE = -904                                  12340000
123500             WHEN SQLCODE = -913                                  12350000
123600                 CONTINUE                                         12360000
123700             WHEN SQLWARN0 NOT = SPACES                           12370000
123800             WHEN SQLCODE < ZERO                                  12380000
123900             WHEN SQLCODE > ZERO                                  12390000
124000                 MOVE '4099-GET-VENDOR-FROM-ENT'                  12400000
124100                                   TO DP013-PARAGRAPH             12410000
124200                 MOVE 'SELECT TEXTENT'                            12420000
124300                                   TO DP013-MESSAGE-TEXT (1)      12430000
124400                 MOVE SQLCA        TO DP013-SQLCA                 12440000
124500                 MOVE 'TEXTENT '   TO DP013-DB2-TABLE-NAME (1)    12450000
124600                 SET DP013-DB2-ABEND                              12460000
124700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           12470000
124800                 PERFORM DP013-0000-PROCESS-ABEND                 12480000
124900         END-EVALUATE                                             12490000
125000     END-PERFORM                                                  12500000
125100                                                                  12510000
125200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        12520000
125300         MOVE '4099-GET-VENDOR-FROM-ENT'                          12530000
125400                                   TO DP013-PARAGRAPH             12540000
125500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO READ    '   12550000
125600                                   TO DP013-MESSAGE-TEXT (1)      12560000
125700         MOVE SQLCA                TO DP013-SQLCA                 12570000
125800         MOVE 'TEXTENT '           TO DP013-DB2-TABLE-NAME (1)    12580000
125900         SET DP013-DB2-ABEND                                      12590000
126000             DP013-XCTL-DISPLAY-RESTART                           12600000
126100                                   TO TRUE                        12610000
126200         PERFORM DP013-0000-PROCESS-ABEND                         12620000
126300     END-IF.                                                      12630000
126400                                                                  12640000
126500*----------------------------------------------------------------*12650000
126600* CONTROLS PROCESSING OF NAME CURSOR                             *12660000
126700*----------------------------------------------------------------*12670000
126800                                                                  12680000
126900 4200-GET-NAMES.                                                  12690000
127000         PERFORM 4201-OPEN-NAME-CURSOR.                           12700000
127100         PERFORM 4202-READ-NAME-CURSOR.                           12710000
127200         PERFORM 4203-CLOSE-NAME-CURSOR.                          12720000
127300*----------------------------------------------------------------*12730000
127400* OPEN  THE VENDOR   CURSOR.                                     *12740000
127500*----------------------------------------------------------------*12750000
127600                                                                  12760000
127700 4201-OPEN-NAME-CURSOR.                                           12770000
127800     PERFORM                                                      12780000
127900         WITH TEST AFTER                                          12790000
128000         VARYING PV-RETRY-COUNTER                                 12800000
128100         FROM 1 BY 1                                              12810000
128200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12820000
128300                   OR (SQLCODE = ZERO))                           12830000
128400             MOVE 'CURSOR:  VENDOR-CSR'                           12840000
128500                               TO DP013-MESSAGE-TEXT (2)          12850000
128600             EXEC SQL                                             12860000
128700                  OPEN VENDOR-CSR                                 12870000
128800             END-EXEC                                             12880000
128900                                                                  12890000
129000         EVALUATE TRUE                                            12900000
129100             WHEN SQLCODE = ZERO                                  12910000
129200             WHEN SQLCODE = -904                                  12920000
129300             WHEN SQLCODE = -913                                  12930000
129400                 CONTINUE                                         12940000
129500             WHEN SQLWARN0 NOT = SPACES                           12950000
129600             WHEN SQLCODE < ZERO                                  12960000
129700             WHEN SQLCODE > ZERO                                  12970000
129800                 MOVE '4201-OPEN-NAME-CURSOR'                     12980000
129900                                   TO DP013-PARAGRAPH             12990000
130000                 MOVE 'OPEN VENDOR CURSOR - '                     13000000
130100                                   TO DP013-MESSAGE-TEXT (1)      13010000
130200                 MOVE SQLCA        TO DP013-SQLCA                 13020000
130300                 MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (1)    13030000
130400                 SET DP013-DB2-ABEND                              13040000
130500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           13050000
130600                 PERFORM DP013-0000-PROCESS-ABEND                 13060000
130700         END-EVALUATE                                             13070000
130800     END-PERFORM.                                                 13080000
130900*                                                                 13090000
131000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13100000
131100         MOVE '4201-OPEN-NAME-CURSOR'   TO DP013-PARAGRAPH        13110000
131200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   13120000
131300                                   TO DP013-MESSAGE-TEXT (1)      13130000
131400         MOVE SQLCA                TO DP013-SQLCA                 13140000
131500         MOVE 'TENTNME '           TO DP013-DB2-TABLE-NAME (1)    13150000
131600         SET DP013-DB2-ABEND                                      13160000
131700             DP013-XCTL-DISPLAY-RESTART                           13170000
131800                                   TO TRUE                        13180000
131900         PERFORM DP013-0000-PROCESS-ABEND                         13190000
132000     END-IF.                                                      13200000
132100                                                                  13210000
132200*----------------------------------------------------------------*13220000
132300*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *13230000
132400*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *13240000
132500*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *13250000
132600*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *13260000
132700*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *13270000
132800*                                                                *13280000
132900*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *13290000
133000*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *13300000
133100*    UPON INITIALIZATION.                                        *13310000
133200*----------------------------------------------------------------*13320000
133300                                                                  13330000
133400 4202-READ-NAME-CURSOR.                                           13340000
133500                                                                  13350000
133600     PERFORM                                                      13360000
133700         VARYING PV-READ-COUNT                                    13370000
133800         FROM 1 BY 1                                              13380000
133900         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    13390000
134000            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         13400000
134100                                                                  13410000
134200         PERFORM 4202-FETCH                                       13420000
134300                                                                  13430000
134400         IF  ASC-ITEMS-LEFT-ON-DB OR                              13440000
134500             PS-PARENT-CO-FOUND                                   13450000
134600             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                13460000
134700                 ADD +1            TO ASC-ITEM-SUB                13470000
134800             ELSE                                                 13480000
134900                 ADD +1            TO ASC-BLK-SUB                 13490000
135000                 MOVE +1           TO ASC-ITEM-SUB                13500000
135100                                                                  13510000
135200                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         13520000
135300                     MOVE +1       TO ASC-BLK-SUB                 13530000
135400                     SET ASC-BLOCK-MODIFIED (1)                   13540000
135500                                   TO TRUE                        13550000
135600                     PERFORM 5100-WRITE-TEMP-STORAGE              13560000
135700                     MOVE ASC-BLOCK-ENTRIES                       13570000
135800                               (PC-MAX-BLOCKS-IN-ARRAY)           13580000
135900                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 13590000
136000                     ADD +1        TO ASC-BLK-SUB                 13600000
136100                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   13610000
136200                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      13620000
136300                                   TO TRUE                        13630000
136400                 END-IF                                           13640000
136500             END-IF                                               13650000
136600             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    13660000
136700             MOVE ASC-NUMBER-OF-ITEMS-READ                        13670000
136800                                   TO ASC-LIST-ITEM-NUMBER        13680000
136900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13690000
137000             MOVE ENTNME-ENT-NAME-DESC TO ASC-VEND-NAME           13700000
137100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 13710000
137200             MOVE ENTNME-TYPE-CDE      TO ASC-TYPE-CDE            13720000
137300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 13730000
137400         END-IF                                                   13740000
137500     END-PERFORM.                                                 13750000
137600                                                                  13760000
137700     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          13770000
137800         MOVE +1               TO ASC-BLK-SUB                     13780000
137900         PERFORM 5100-WRITE-TEMP-STORAGE                          13790000
138000         ADD +1                TO ASC-BLK-SUB                     13800000
138100         PERFORM 5100-WRITE-TEMP-STORAGE                          13810000
138200                                                                  13820000
138300         MOVE 1                TO ASC-BLK-SUB                     13830000
138400                                  PV-BLOCK-NUMBER                 13840000
138500         PERFORM 4410-READ-TEMP-STORAGE                           13850000
138600         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             13860000
138700             MOVE 2            TO ASC-BLK-SUB                     13870000
138800                                  PV-BLOCK-NUMBER                 13880000
138900             PERFORM 4410-READ-TEMP-STORAGE                       13890000
139000         END-IF                                                   13900000
139100     END-IF.                                                      13910000
139200 EJECT                                                            13920000
139300*----------------------------------------------------------------*13930000
139400*    FETCH THE MESSAGE CURSOR.                                   *13940000
139500*----------------------------------------------------------------*13950000
139600                                                                  13960000
139700 4202-FETCH.                                                      13970000
139800                                                                  13980000
139900     EXEC SQL                                                     13990000
140000          FETCH VENDOR-CSR                                        14000000
140100          INTO  :ENTNME-ENT-NAME-DESC,                            14010000
140200                :ENTNME-TYPE-CDE,                                 14020000
140300                :ENTNME-SEQ-NBR                                   14030000
140400     END-EXEC                                                     14040000
140500                                                                  14050000
140600     EVALUATE TRUE                                                14060000
140700         WHEN SQLCODE = ZERO                                      14070000
140800         WHEN SQLCODE = +100                                      14080000
140900              CONTINUE                                            14090000
141000         WHEN SQLWARN0 NOT = SPACE                                14100000
141100         WHEN SQLCODE NOT = ZERO                                  14110000
141200              MOVE '4202-FETCH-CURSOR'                            14120000
141300                               TO DP013-PARAGRAPH                 14130000
141400              MOVE 'FETCH VENDOR CURSOR'                          14140000
141500                               TO DP013-MESSAGE-TEXT (1)          14150000
141600              MOVE SQLCA       TO DP013-SQLCA                     14160000
141700              SET DP013-DB2-ABEND                                 14170000
141800                               TO TRUE                            14180000
141900              PERFORM DP013-0000-PROCESS-ABEND                    14190000
142000     END-EVALUATE.                                                14200000
142100                                                                  14210000
142200     IF  SQLCODE EQUAL +100                                       14220000
142300         IF ASC-PRNT-CO-ENT-ID > ZEROES                           14230000
142400             SET PS-PARENT-CO-NOT-FOUND TO TRUE                   14240000
142500             PERFORM 4210-GET-PARENT-CO                           14250000
142600         END-IF                                                   14260000
142700         SET ASC-NO-ITEMS-LEFT-ON-DB                              14270000
142800                                   TO TRUE                        14280000
142900     END-IF.                                                      14290000
143000                                                                  14300000
143100 EJECT                                                            14310000
143200*----------------------------------------------------------------*14320000
143300* CLOSE THE NAME     CURSOR.                                     *14330000
143400*----------------------------------------------------------------*14340000
143500                                                                  14350000
143600 4203-CLOSE-NAME-CURSOR.                                          14360000
143700     PERFORM                                                      14370000
143800         WITH TEST AFTER                                          14380000
143900         VARYING PV-RETRY-COUNTER                                 14390000
144000         FROM 1 BY 1                                              14400000
144100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14410000
144200                   OR (SQLCODE = ZERO))                           14420000
144300             MOVE 'CURSOR:  VENDOR-CSR'                           14430000
144400                               TO DP013-MESSAGE-TEXT (2)          14440000
144500             EXEC SQL                                             14450000
144600                  CLOSE VENDOR-CSR                                14460000
144700             END-EXEC                                             14470000
144800                                                                  14480000
144900         EVALUATE TRUE                                            14490000
145000             WHEN SQLCODE = ZERO                                  14500000
145100             WHEN SQLCODE = -904                                  14510000
145200             WHEN SQLCODE = -913                                  14520000
145300                 CONTINUE                                         14530000
145400             WHEN SQLWARN0 NOT = SPACES                           14540000
145500             WHEN SQLCODE < ZERO                                  14550000
145600             WHEN SQLCODE > ZERO                                  14560000
145700                 MOVE '4203-CLOSE-NAME-CURSOR'                    14570000
145800                                   TO DP013-PARAGRAPH             14580000
145900                 MOVE 'CLOSE VENDOR CURSOR - '                    14590000
146000                                   TO DP013-MESSAGE-TEXT (1)      14600000
146100                 MOVE SQLCA        TO DP013-SQLCA                 14610000
146200                 MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (1)    14620000
146300                 SET DP013-DB2-ABEND                              14630000
146400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           14640000
146500                 PERFORM DP013-0000-PROCESS-ABEND                 14650000
146600         END-EVALUATE                                             14660000
146700     END-PERFORM.                                                 14670000
146800*                                                                 14680000
146900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        14690000
147000         MOVE '4203-CLOSE-NAME-CURSOR'   TO DP013-PARAGRAPH       14700000
147100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO CLOSE CSR'  14710000
147200                                   TO DP013-MESSAGE-TEXT (1)      14720000
147300         MOVE SQLCA                TO DP013-SQLCA                 14730000
147400         MOVE 'TENTNME '           TO DP013-DB2-TABLE-NAME (1)    14740000
147500         SET DP013-DB2-ABEND                                      14750000
147600             DP013-XCTL-DISPLAY-RESTART                           14760000
147700                                   TO TRUE                        14770000
147800         PERFORM DP013-0000-PROCESS-ABEND                         14780000
147900     END-IF.                                                      14790000
148000                                                                  14800000
148100*----------------------------------------------------------------*14810000
148200* GET PARENT COMPANY                                             *14820000
148300*----------------------------------------------------------------*14830000
148400 4210-GET-PARENT-CO.                                              14840000
148500                                                                  14850000
148600     PERFORM                                                      14860000
148700         WITH TEST AFTER                                          14870000
148800         VARYING PV-RETRY-COUNTER                                 14880000
148900         FROM 1 BY 1                                              14890000
149000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14900000
149100                   OR (SQLCODE = ZERO)                            14910000
149200                   OR (SQLCODE = +100))                           14920000
149300         EXEC SQL                                                 14930000
149400             SELECT ENT_NAME_DESC                                 14940000
149500               INTO :ENTNME-ENT-NAME-DESC                         14950000
149600               FROM TENTNME                                       14960000
149700              WHERE ENT_ID = :ASC-PRNT-CO-ENT-ID                  14970000
149800                AND TYPE_CDE = '01'                               14980000
149900         END-EXEC                                                 14990000
150000                                                                  15000000
150100         EVALUATE TRUE                                            15010000
150200             WHEN SQLCODE = ZERO                                  15020000
150300                 SET PS-PARENT-CO-FOUND TO TRUE                   15030000
150400                 MOVE '99' TO ENTNME-TYPE-CDE                     15040000
150500             WHEN SQLCODE = +100                                  15050000
150600             WHEN SQLCODE = -904                                  15060000
150700             WHEN SQLCODE = -913                                  15070000
150800                 CONTINUE                                         15080000
150900             WHEN SQLWARN0 NOT = SPACES                           15090000
151000             WHEN SQLCODE < ZERO                                  15100000
151100             WHEN SQLCODE > ZERO                                  15110000
151200                 MOVE '4210-GET-PARENT-CO'                        15120000
151300                                   TO DP013-PARAGRAPH             15130000
151400                 MOVE 'SELECT TENTNME'                            15140000
151500                                   TO DP013-MESSAGE-TEXT (1)      15150000
151600                 MOVE SQLCA        TO DP013-SQLCA                 15160000
151700                 MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (1)    15170000
151800                 SET DP013-DB2-ABEND                              15180000
151900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15190000
152000                 PERFORM DP013-0000-PROCESS-ABEND                 15200000
152100         END-EVALUATE                                             15210000
152200     END-PERFORM                                                  15220000
152300                                                                  15230000
152400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15240000
152500         MOVE '4210-GET-PARENT-CO'                                15250000
152600                                   TO DP013-PARAGRAPH             15260000
152700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO READ    '   15270000
152800                                   TO DP013-MESSAGE-TEXT (1)      15280000
152900         MOVE SQLCA                TO DP013-SQLCA                 15290000
153000         MOVE 'TENTNME '           TO DP013-DB2-TABLE-NAME (1)    15300000
153100         SET DP013-DB2-ABEND                                      15310000
153200             DP013-XCTL-DISPLAY-RESTART                           15320000
153300                                   TO TRUE                        15330000
153400         PERFORM DP013-0000-PROCESS-ABEND                         15340000
153500     END-IF.                                                      15350000
153600                                                                  15360000
153700*----------------------------------------------------------------*15370000
153800* GET ORD_DTE FROM TPURCHS TABLE (USED TO ACCESS PO DATES)       *15380000
153900*----------------------------------------------------------------*15390000
154000 4300-GET-PO-DATES.                                               15400000
154100                                                                  15410000
154200     PERFORM                                                      15420000
154300         WITH TEST AFTER                                          15430000
154400         VARYING PV-RETRY-COUNTER                                 15440000
154500         FROM 1 BY 1                                              15450000
154600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15460000
154700                   OR (SQLCODE = ZERO)                            15470000
154800                   OR (SQLCODE = +100))                           15480000
154900             EXEC SQL                                             15490000
155000                  SELECT MAX (B.ORD_DTE)                          15500000
155100                  INTO  :ASC-LAST-PO-DATE:PV-LAST-PO-DATE-IND     15510000
155200                  FROM TEXTENT  A,                                15520000
155300                       TPURCHS  B                                 15530000
155400                  WHERE A.ENT_ID = :ASC-ENT-ID AND                15540000
155500                        A.ENT_ID = B.ENT_ID AND                   15550000
155600                        B.VER_STATUS_CDE = 'A' AND                15560000
155700                        B.PO_CATEG_CDE = 'MR' AND                 15570000
155800                        B.STATUS_CDE IN ('AC', 'CM', 'AP', 'CA')  15580000
155900             END-EXEC                                             15590000
156000                                                                  15600000
156100         EVALUATE TRUE                                            15610000
156200             WHEN SQLCODE = ZERO                                  15620000
156300             WHEN SQLCODE = +100                                  15630000
156400             WHEN SQLCODE = -904                                  15640000
156500             WHEN SQLCODE = -913                                  15650000
156600                 CONTINUE                                         15660000
156700             WHEN SQLWARN0 NOT = SPACES                           15670000
156800             WHEN SQLCODE < ZERO                                  15680000
156900             WHEN SQLCODE > ZERO                                  15690000
157000                 MOVE '4300-GET-PO-DATES'                         15700000
157100                                   TO DP013-PARAGRAPH             15710000
157200                 MOVE 'SELECT ORDER DATE'                         15720000
157300                                   TO DP013-MESSAGE-TEXT (1)      15730000
157400                 MOVE SQLCA        TO DP013-SQLCA                 15740000
157500                 MOVE 'TEXTENT '   TO DP013-DB2-TABLE-NAME (1)    15750000
157600                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (2)    15760000
157700                 SET DP013-DB2-ABEND                              15770000
157800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15780000
157900                 PERFORM DP013-0000-PROCESS-ABEND                 15790000
158000         END-EVALUATE                                             15800000
158100     END-PERFORM                                                  15810000
158200                                                                  15820000
158300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15830000
158400         MOVE '4300-GET-PO-DATES'                                 15840000
158500                                   TO DP013-PARAGRAPH             15850000
158600         MOVE 'MAXIMUM RETRIES EXCEEDED ON SELECT ORD DATE'       15860000
158700                                   TO DP013-MESSAGE-TEXT (1)      15870000
158800         MOVE SQLCA                TO DP013-SQLCA                 15880000
158900         MOVE 'TEXTENT '           TO DP013-DB2-TABLE-NAME (1)    15890000
159000         MOVE 'TPURCHS '           TO DP013-DB2-TABLE-NAME (2)    15900000
159100         SET DP013-DB2-ABEND                                      15910000
159200             DP013-XCTL-DISPLAY-RESTART                           15920000
159300                                   TO TRUE                        15930000
159400         PERFORM DP013-0000-PROCESS-ABEND                         15940000
159500     END-IF.                                                      15950000
159600                                                                  15960000
159700*----------------------------------------------------------------*15970000
159800* RETRIEVE TODAY'S DATE AND SUBTRACT 1 FROM THE YEAR. THEN       *15980000
159900* CONVERT THE FORMAT FROM YYMMDD TO CCYY-MM-DD.                  *15990000
160000*----------------------------------------------------------------*16000000
160100 4308-DATE-ONE-YEAR-PRIOR-CALC.                                   16010000
160200                                                                  16020000
160300     EXEC CICS ASKTIME                                            16030000
160400         ABSTIME (PV-ABSTIME)                                     16040000
160500     END-EXEC                                                     16050000
160600     EXEC CICS FORMATTIME                                         16060000
160700         ABSTIME (PV-ABSTIME)                                     16070000
160800         YYMMDD  (PV-HOLD-DATE-6)                                 16080000
160900     END-EXEC                                                     16090000
161000                                                                  16100000
161100     MOVE PV-HOLD-DATE-6        TO PV-DATE-CONVERSION-6.          16110000
161200     IF PV-DT-CONV-6-YY > 80                                      16120000
161300         MOVE 19                TO PV-DT-CONV-10-CC               16130000
161400     ELSE                                                         16140000
161500         MOVE 20                TO PV-DT-CONV-10-CC.              16150000
161600     MOVE PV-DT-CONV-6-YY       TO PV-DT-CONV-10-YY.              16160000
161700     SUBTRACT 1                 FROM PV-DT-CONV-10-CCYY-N.        16170000
161800*-- ACCOUNT FOR LEAP-YEAR                                         16180000
161900     IF PV-DT-CONV-6-MM = 02 AND PV-DT-CONV-6-DD = 29             16190000
162000         MOVE 28                TO PV-DT-CONV-6-DD                16200000
162100     END-IF                                                       16210000
162200     MOVE PV-DT-CONV-6-MM       TO PV-DT-CONV-10-MM.              16220000
162300     MOVE PV-DT-CONV-6-DD       TO PV-DT-CONV-10-DD.              16230000
162400     MOVE '-'                   TO PV-DASH-1                      16240000
162500                                   PV-DASH-2.                     16250000
162600     MOVE PV-DATE-CONVERSION-10 TO ASC-ORD-DTE.                   16260000
162700                                                                  16270000
162800*----------------------------------------------------------------*16280000
162900* RETRIEVE THE FIRST FISCAL DAY OF THE CURRENT YEAR.             *16290000
163000*----------------------------------------------------------------*16300000
163100 4309-FIRST-DAY-FISCAL-YR-CALC.                                   16310000
163200                                                                  16320000
163300     MOVE PV-HOLD-DATE-6             TO PV-DATE-CONVERSION-6.     16330000
163400     IF PV-DT-CONV-6-YY > 80                                      16340000
163500         MOVE 19                     TO PV-DT-CONV-10-CC          16350000
163600     ELSE                                                         16360000
163700         MOVE 20                     TO PV-DT-CONV-10-CC.         16370000
163800     MOVE PV-DT-CONV-6-YY            TO PV-DT-CONV-10-YY.         16380000
163900     MOVE PV-DT-CONV-6-MM            TO PV-DT-CONV-10-MM.         16390000
164000     MOVE PV-DT-CONV-6-DD            TO PV-DT-CONV-10-DD.         16400000
164100     MOVE '-'                        TO PV-DASH-1                 16410000
164200                                        PV-DASH-2.                16420000
164300     SET DPG51-FISCAL-454-CALENDAR   TO TRUE.                     16430000
164400     SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                     16440000
164500     SET DPG52-LK-DTE-ISO-FMT        TO TRUE.                     16450000
164600     MOVE PV-DATE-CONVERSION-10      TO DPG52-LK-DATE-INPUT.      16460000
164700                                                                  16470000
164800     CALL DP500-KOHLS-CALENDAR-ROUTINE USING                      16480000
164900          DPG51 DPG52 DPG53 DPG54 DPG55 DPG56                     16490000
165000                                                                  16500000
165100     IF  (DPG54-NO-ERROR                                          16510000
165200      OR  DPG54-WARNING-ERROR)                                    16520000
165300      AND DPG54-DATE-VALID                                        16530000
165400          MOVE DPG56-FIRST-FD-DB2-ISO-FMT                         16540000
165500            TO ASC-ORD-DTE.                                       16550000
165600                                                                  16560000
165700*----------------------------------------------------------------*16570000
165800* COUNT NUMBER OF ORDERS BETWEEN CURRENT DATE & THE FIRST DAY OF *16580000
165900* THE FISCAL PERIOD (ASC-ORDERS-YTD) OR THE 12 MONTHS PRIOR TO   *16590000
166000* THE CURRENT DATE. (ASC-ORDERS-LAST-12-MO).                     *16600000
166100*----------------------------------------------------------------*16610000
166200 4310-GET-ORDERS-COUNT.                                           16620000
166300     PERFORM                                                      16630000
166400         WITH TEST AFTER                                          16640000
166500         VARYING PV-RETRY-COUNTER                                 16650000
166600         FROM 1 BY 1                                              16660000
166700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16670000
166800                   OR (SQLCODE = ZERO)                            16680000
166900                   OR (SQLCODE = +100))                           16690000
167000             EXEC SQL                                             16700000
167100                  SELECT COUNT (*)                                16710000
167200                  INTO  :ASC-ORDERS-COUNT                         16720000
167300                  FROM TEXTENT  A,                                16730000
167400                       TPURCHS  B                                 16740000
167500                  WHERE A.ENT_ID = :ASC-ENT-ID AND                16750000
167600                        A.ENT_ID = B.ENT_ID AND                   16760000
167700                        B.VER_STATUS_CDE = 'A' AND                16770000
167800                        B.PO_CATEG_CDE = 'MR' AND                 16780000
167900                       (B.ORD_DTE BETWEEN :ASC-ORD-DTE AND        16790000
168000                          CURRENT DATE) AND                       16800000
168100                        B.STATUS_CDE IN ('AC', 'CM', 'AP', 'CA')  16810000
168200             END-EXEC                                             16820000
168300                                                                  16830000
168400         EVALUATE TRUE                                            16840000
168500             WHEN SQLCODE = ZERO                                  16850000
168600             WHEN SQLCODE = +100                                  16860000
168700             WHEN SQLCODE = -904                                  16870000
168800             WHEN SQLCODE = -913                                  16880000
168900                 CONTINUE                                         16890000
169000             WHEN SQLWARN0 NOT = SPACES                           16900000
169100             WHEN SQLCODE < ZERO                                  16910000
169200             WHEN SQLCODE > ZERO                                  16920000
169300                 MOVE '4310-GET-ORDERS-COUNT'                     16930000
169400                                   TO DP013-PARAGRAPH             16940000
169500                 MOVE 'SELECT ORDERS COUNT'                       16950000
169600                                   TO DP013-MESSAGE-TEXT (1)      16960000
169700                 MOVE SQLCA        TO DP013-SQLCA                 16970000
169800                 MOVE 'TEXTENT '   TO DP013-DB2-TABLE-NAME (1)    16980000
169900                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (2)    16990000
170000                 SET DP013-DB2-ABEND                              17000000
170100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           17010000
170200                 PERFORM DP013-0000-PROCESS-ABEND                 17020000
170300         END-EVALUATE                                             17030000
170400     END-PERFORM                                                  17040000
170500                                                                  17050000
170600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17060000
170700         MOVE '4310-GET-ORDERS-COUNT'                             17070000
170800                                   TO DP013-PARAGRAPH             17080000
170900         MOVE 'MAXIMUM RETRIES EXCEEDED ON SELECT ORDERS COUNT'   17090000
171000                                   TO DP013-MESSAGE-TEXT (1)      17100000
171100         MOVE SQLCA                TO DP013-SQLCA                 17110000
171200         MOVE 'TEXTENT '           TO DP013-DB2-TABLE-NAME (1)    17120000
171300         MOVE 'TPURCHS '           TO DP013-DB2-TABLE-NAME (2)    17130000
171400         SET DP013-DB2-ABEND                                      17140000
171500             DP013-XCTL-DISPLAY-RESTART                           17150000
171600                                   TO TRUE                        17160000
171700         PERFORM DP013-0000-PROCESS-ABEND                         17170000
171800     END-IF.                                                      17180000
171900                                                                  17190000
172000*----------------------------------------------------------------*17200000
172100* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *17210000
172200*----------------------------------------------------------------*17220000
172300 4400-MOVE-COMMAREA-TO-SCREEN.                                    17230000
172400                                                                  17240000
172500     IF   ASC-HLD-PAYT-IND = 'Y'                                  17250000
172600          MOVE PC-VENDOR-HOLD     TO AVNHOLDO                     17260000
172700     ELSE                                                         17270000
172800          MOVE SPACES             TO AVNHOLDO                     17280000
172900     END-IF.                                                      17290000
173000     MOVE ASC-STATUS-CDE          TO AVNSTATO.                    17300000
173100     MOVE ASC-DUN-NBR             TO ADUNNBRO.                    17310000
173200     PERFORM 4405-FILL-DATE-OUTPUT.                               17320000
173300     MOVE ASC-HOLD-ORDERS-YTD     TO AORDYTDO.                    17330000
173400     MOVE ASC-HOLD-L12-COUNT      TO AORDL12O.                    17340000
173500     MOVE ASC-PRIMARY-TYPE        TO APRMTPEO.                    17350000
173600                                                                  17360000
173700     IF ASC-PRIMARY-TYPE = 'M'                                    17370000
173800        MOVE 'MERCHANDISE'  TO ASC-PRIMARY-TYPE-DESC              17380000
173900     ELSE                                                         17390000
174000        IF ASC-PRIMARY-TYPE = 'E'                                 17400000
174100           MOVE 'EXPENSE'   TO ASC-PRIMARY-TYPE-DESC              17410000
174200        ELSE                                                      17420000
174300           IF ASC-PRIMARY-TYPE = 'F'                              17430000
174400              MOVE 'FACTOR' TO ASC-PRIMARY-TYPE-DESC              17440000
174500           END-IF                                                 17450000
174600        END-IF                                                    17460000
174700     END-IF.                                                      17470000
174800                                                                  17480000
174900     MOVE ASC-NDA-FLAG            TO ANDAINDO.                    17490000
175000     STRING ASC-NDA-BEG-DATE (6:2) '/'                            17500000
175100            ASC-NDA-BEG-DATE (9:2) '/'                            17510000
175200            ASC-NDA-BEG-DATE (3:2)                                17520000
175300            DELIMITED BY SIZE                                     17530000
175400            INTO ANDABEGO.                                        17540000
175500     STRING ASC-NDA-END-DATE (6:2) '/'                            17550000
175600            ASC-NDA-END-DATE (9:2) '/'                            17560000
175700            ASC-NDA-END-DATE (3:2)                                17570000
175800            DELIMITED BY SIZE                                     17580000
175900            INTO ANDAENDO.                                        17590000
176000                                                                  17600000
176100     MOVE ASC-PRIMARY-TYPE-DESC   TO APRMDSCO.                    17610000
176200     MOVE ASC-EDI-PO-PREPK-CDE    TO APPEDIO.                     17620000
176300     MOVE ASC-CURR-YEAR           TO ACURYERO.                    17630000
176400     MOVE ASC-VENDOR-RANK-YTD     TO AVNRKYDO.                    17640000
176500     MOVE ASC-PREV-YEAR           TO AVNYEARO.                    17650000
176600     MOVE ASC-VENDOR-RANK-LY      TO AVNRKPYO.                    17660000
176700     MOVE ASC-PRNT-CO-IND         TO APARINDO.                    17670000
176800     MOVE ASC-ENT-ID              TO AENTIDO.                     17680000
176900                                                                  17690000
177000     MOVE ASC-PARTNER-IND         TO APARTNRO.                    17700000
177100     MOVE ASC-PARTNER-TYP-CDE     TO APRTTYPO.                    17710000
177200                                                                  17720000
177300     EVALUATE TRUE                                                17730000
177400        WHEN  ASC-PARTNER-TYP-CDE = 'AG'                          17740000
177500              MOVE 'AGENT'       TO ASC-PARTNER-TYPE-DESC         17750000
177600        WHEN  ASC-PARTNER-TYP-CDE = 'BK'                          17760000
177700              MOVE 'BANK'        TO ASC-PARTNER-TYPE-DESC         17770000
177800        WHEN  ASC-PARTNER-TYP-CDE = 'BR'                          17780000
177900              MOVE 'BROKER'      TO ASC-PARTNER-TYPE-DESC         17790000
178000        WHEN  ASC-PARTNER-TYP-CDE = 'CO'                          17800000
178100              MOVE 'CONSOLIDATOR' TO ASC-PARTNER-TYPE-DESC        17810000
178200        WHEN  ASC-PARTNER-TYP-CDE = 'CR'                          17820000
178300              MOVE 'CARRIER'     TO ASC-PARTNER-TYPE-DESC         17830000
178400        WHEN  ASC-PARTNER-TYP-CDE = 'DE'                          17840000
178500              MOVE 'DECONSOLIDATOR' TO ASC-PARTNER-TYPE-DESC      17850000
178600        WHEN  ASC-PARTNER-TYP-CDE = 'FA'                          17860000
178700              MOVE 'FACTORY'     TO ASC-PARTNER-TYPE-DESC         17870000
178800        WHEN  ASC-PARTNER-TYP-CDE = 'FF'                          17880000
178900              MOVE 'FREIGHT FORWARDER' TO ASC-PARTNER-TYPE-DESC   17890000
179000        WHEN  ASC-PARTNER-TYP-CDE = 'S1'                          17900000
179100              MOVE 'MAKER' TO ASC-PARTNER-TYPE-DESC               17910000
179200        WHEN  ASC-PARTNER-TYP-CDE = 'TM'                          17920000
179300              MOVE 'TICKET MAKER' TO ASC-PARTNER-TYPE-DESC        17930000
179400        WHEN  ASC-PARTNER-TYP-CDE = 'S2'                          17940000
179500              MOVE 'IMPORT PARENT CO' TO ASC-PARTNER-TYPE-DESC    17950000
179600        WHEN  ASC-PARTNER-TYP-CDE = 'OP'                          17960000
179700              MOVE 'OFFICE OF PLACEMENT' TO ASC-PARTNER-TYPE-DESC 17970000
179800        WHEN  ASC-PARTNER-TYP-CDE = 'CL'                          17980000
179900              MOVE 'CARTON LABEL MAKER ' TO ASC-PARTNER-TYPE-DESC 17990000
180000        WHEN  OTHER                                               18000000
180100              MOVE '       '      TO ASC-PARTNER-TYPE-DESC        18010000
180200     END-EVALUATE.                                                18020000
180300                                                                  18030000
180400     MOVE ASC-PARTNER-TYPE-DESC   TO APRTDSCO.                    18040000
180500     MOVE ASC-SCAC-CDE            TO ASCACDEO.                    18050000
180600     MOVE ASC-MAN-PRO-IND         TO AMANPROO.                    18060000
180700**** MOVE ASC-LINE-OF-CRDT        TO PV-HOLD-LNE-OF-CRDT.         18070000
180800**** MOVE PV-HOLD-LNE-OF-CRDT     TO ACRDLNEO.                    18080000
180900                                                                  18090000
181000     IF ASC-PARTNER-TYP-CDE = 'FA'                                18100000
181100        MOVE ASC-LINE-OF-CRDT     TO PV-HOLD-FACT-CAPACITY        18110000
181200        MOVE PV-HOLD-CAPACITY     TO ACAPCTYO                     18120000
181300        MOVE ZEROES               TO PV-HOLD-LNE-OF-CRDT          18130000
181400        MOVE PV-HOLD-LNE-OF-CRDT  TO ACRDLNEO                     18140000
181500     ELSE                                                         18150000
181600        MOVE ZEROES               TO PV-HOLD-FACT-CAPACITY        18160000
181700        MOVE PV-HOLD-CAPACITY     TO ACAPCTYO                     18170000
181800        MOVE ASC-LINE-OF-CRDT     TO PV-HOLD-LNE-OF-CRDT          18180000
181900        MOVE PV-HOLD-LNE-OF-CRDT  TO ACRDLNEO                     18190000
182000     END-IF.                                                      18200000
182100                                                                  18210000
182200     MOVE ASC-CAP-EXP-CDE         TO ACAPEXPO.                    18220000
182300     MOVE ASC-DEPARTMENT          TO ADEPTO.                      18230000
182400     MOVE ASC-NEED-1099           TO A1099O.                      18240000
182500*    MOVE ASC-FED-TX-ID-TYP-CDE   TO ATAXIDTO.                    18250000
182600*    MOVE ASC-FED-TX-ID-NBR       TO ATAXIDO.                     18260000
182700                                                                  18270000
182800     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             18280000
182900         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          18290000
183000         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          18300000
183100             MOVE +1    TO ASC-BLK-SUB                            18310000
183200             PERFORM 5100-WRITE-TEMP-STORAGE                      18320000
183300             ADD +1     TO ASC-BLK-SUB                            18330000
183400             PERFORM 5100-WRITE-TEMP-STORAGE                      18340000
183500             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             18350000
183600                 GIVING PV-BLOCK-NUMBER                           18360000
183700                 REMAINDER PV-REMAINDER                           18370000
183800             IF  PV-REMAINDER > ZERO                              18380000
183900                 ADD +1 TO PV-BLOCK-NUMBER                        18390000
184000             END-IF                                               18400000
184100             MOVE +1    TO ASC-BLK-SUB                            18410000
184200             PERFORM 4410-READ-TEMP-STORAGE                       18420000
184300             ADD +1     TO ASC-BLK-SUB                            18430000
184400                           PV-BLOCK-NUMBER                        18440000
184500             PERFORM 4410-READ-TEMP-STORAGE                       18450000
184600     END-IF.                                                      18460000
184700     MOVE +1            TO ASC-BLK-SUB.                           18470000
184800     COMPUTE ASC-ITEM-SUB =                                       18480000
184900         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              18490000
185000         + PC-ITEMS-PER-PANEL).                                   18500000
185100*                                                                 18510000
185200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        18520000
185300         ADD +1         TO ASC-BLK-SUB                            18530000
185400         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            18540000
185500     END-IF.                                                      18550000
185600*                                                                 18560000
185700     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           18570000
185800         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                18580000
185900     PERFORM 4420-FORMAT-LIST-LINES                               18590000
186000         VARYING PV-SUB                                           18600000
186100         FROM PC-ITEMS-PER-PANEL BY -1                            18610000
186200         UNTIL PV-SUB < +1.                                       18620000
186300*                                                                 18630000
186400     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    18640000
186500*                                                                 18650000
186600     IF  DP020-MSG-NUMBER-X = SPACE                               18660000
186700         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  18670000
186800*            --- MORE ITEMS TO DISPLAY ----                       18680000
186900             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            18690000
187000             SET DP020-MSG-INFORMATIONAL TO TRUE                  18700000
187100         END-IF                                                   18710000
187200     END-IF.                                                      18720000
187300*----------------------------------------------------------------*18730000
187400*    CONVERT DB2 DATES FROM CCYY-MM-DD FORMAT TO MM/DD/YY FORMAT *18740000
187500*----------------------------------------------------------------*18750000
187600 4405-FILL-DATE-OUTPUT.                                           18760000
187700                                                                  18770000
187800*----  LAST-PO-DATE CONVERSION  ----*                             18780000
187900     MOVE ASC-LAST-PO-DATE    TO PV-DATE-CONVERSION-10.           18790000
188000     IF (PV-DT-CONV-10-MM <= ZERO) OR                             18800000
188100        (PV-DATE-CONVERSION-10 = PC-DEFAULT-DATE)                 18810000
188200         MOVE SPACES TO ALSPODTO                                  18820000
188300     ELSE                                                         18830000
188400         PERFORM 4406-DATE-CONVERSION                             18840000
188500         MOVE PV-DATE-CONVERSION-8 TO ALSPODTO.                   18850000
188600                                                                  18860000
188700*----  CREATED-DATE CONVERSION  ----*                             18870000
188800     MOVE ASC-CRE-DATE        TO PV-DATE-CONVERSION-10.           18880000
188900     IF (PV-DT-CONV-10-MM <= ZERO) OR                             18890000
189000        (PV-DATE-CONVERSION-10 = PC-DEFAULT-DATE)                 18900000
189100         MOVE SPACES TO ACREADTO                                  18910000
189200     ELSE                                                         18920000
189300         PERFORM 4406-DATE-CONVERSION                             18930000
189400         MOVE PV-DATE-CONVERSION-8 TO ACREADTO.                   18940000
189500                                                                  18950000
189600 4406-DATE-CONVERSION.                                            18960000
189700     MOVE PV-DT-CONV-10-YY TO PV-DT-CONV-8-YY.                    18970000
189800     MOVE PV-DT-CONV-10-MM TO PV-DT-CONV-8-MM.                    18980000
189900     MOVE PV-DT-CONV-10-DD TO PV-DT-CONV-8-DD.                    18990000
190000*----------------------------------------------------------------*19000000
190100*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *19010000
190200*----------------------------------------------------------------*19020000
190300                                                                  19030000
190400 4410-READ-TEMP-STORAGE.                                          19040000
190500                                                                  19050000
190600     EXEC CICS                                                    19060000
190700         READQ TS                                                 19070000
190800             QUEUE (ASC-LIST-QUEUE-NAME)                          19080000
190900             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19090000
191000             ITEM  (PV-BLOCK-NUMBER)                              19100000
191100             RESP  (PV-CICS-RESP)                                 19110000
191200     END-EXEC.                                                    19120000
191300                                                                  19130000
191400     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       19140000
191500       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     19150000
191600         CONTINUE                                                 19160000
191700     ELSE                                                         19170000
191800         SET DP013-CICS-ABEND     TO TRUE                         19180000
191900         SET DP013-NO-ROLLBACK    TO TRUE                         19190000
192000         MOVE '4410-READ-TEMP-STORAGE'                            19200000
192100                                  TO DP013-PARAGRAPH              19210000
192200         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      19220000
192300                                  TO DP013-MESSAGE-TEXT(1)        19230000
192400         PERFORM DP013-0000-PROCESS-ABEND                         19240000
192500     END-IF.                                                      19250000
192600                                                                  19260000
192700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             19270000
192800*                                                                 19280000
192900     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         19290000
193000         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               19300000
193100     END-IF.                                                      19310000
193200 EJECT                                                            19320000
193300*----------------------------------------------------------------*19330000
193400*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *19340000
193500*----------------------------------------------------------------*19350000
193600                                                                  19360000
193700 4420-FORMAT-LIST-LINES.                                          19370000
193800                                                                  19380000
193900     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      19390000
194000         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                19400000
194100         MOVE SPACE TO MR-VEND-NAME (PV-SUB)                      19410000
194200                       MR-TYPE-DSC  (PV-SUB)                      19420000
194300     ELSE                                                         19430000
194400         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           19440000
194500             MOVE ASC-VEND-NAME (ASC-BLK-SUB ASC-ITEM-SUB)        19450000
194600                                 TO MR-VEND-NAME (PV-SUB)         19460000
194700             EVALUATE ASC-TYPE-CDE (ASC-BLK-SUB ASC-ITEM-SUB)     19470000
194800                 WHEN PC-PRIMARY                                  19480000
194900                     MOVE PL-PRIMARY TO MR-TYPE-DSC (PV-SUB)      19490000
195000                 WHEN PC-ALIAS                                    19500000
195100                     MOVE PL-ALIAS TO MR-TYPE-DSC (PV-SUB)        19510000
195200                 WHEN PC-LABEL                                    19520000
195300                     MOVE PL-LABEL TO MR-TYPE-DSC (PV-SUB)        19530000
195400                 WHEN PC-SHORTNAME                                19540000
195500                     MOVE PL-SHORTNAME TO MR-TYPE-DSC (PV-SUB)    19550000
195600                 WHEN PC-PARENT                                   19560000
195700                     MOVE PL-PARENT    TO MR-TYPE-DSC (PV-SUB)    19570000
195800             END-EVALUATE                                         19580000
195900         END-IF                                                   19590000
196000     END-IF.                                                      19600000
196100     SUBTRACT +1 FROM ASC-ITEM-SUB                                19610000
196200     IF  ASC-ITEM-SUB < + 1                                       19620000
196300         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  19630000
196400         MOVE +1                 TO ASC-BLK-SUB                   19640000
196500     END-IF.                                                      19650000
196600                                                                  19660000
196700*----------------------------------------------------------------*19670000
196800*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *19680000
196900*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *19690000
197000*----------------------------------------------------------------*19700000
197100                                                                  19710000
197200 5100-WRITE-TEMP-STORAGE.                                         19720000
197300     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     19730000
197400                                   TO PV-LIST-ITEM-NUMBER.        19740000
197500     COMPUTE PV-BLOCK-NUMBER =                                    19750000
197600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    19760000
197700                                                                  19770000
197800     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             19780000
197900     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             19790000
198000         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      19800000
198100             PERFORM 5105-REWRITE-ASC-LISTQ                       19810000
198200         END-IF                                                   19820000
198300     ELSE                                                         19830000
198400         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       19840000
198500         ASC-HIGHEST-BLOCK-WRITTEN + 1                            19850000
198600         PERFORM 5110-WRITE-ASC-LISTQ                             19860000
198700         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   19870000
198800     END-IF.                                                      19880000
198900                                                                  19890000
199000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             19900000
199100******************************************************************19910000
199200** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **19920000
199300** SPECIFIC COMMAREA.                                           **19930000
199400******************************************************************19940000
199500 5105-REWRITE-ASC-LISTQ.                                          19950000
199600     EXEC CICS                                                    19960000
199700         WRITEQ TS                                                19970000
199800             QUEUE (ASC-LIST-QUEUE-NAME)                          19980000
199900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19990000
200000             ITEM  (PV-BLOCK-NUMBER)                              20000000
200100             REWRITE                                              20010000
200200             RESP  (PV-CICS-RESP)                                 20020000
200300     END-EXEC.                                                    20030000
200400                                                                  20040000
200500     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           20050000
200600         CONTINUE                                                 20060000
200700     ELSE                                                         20070000
200800         SET DP013-CICS-ABEND            TO TRUE                  20080000
200900         SET DP013-NO-ROLLBACK           TO TRUE                  20090000
201000         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       20100000
201100         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     20110000
201200                                         TO DP013-MESSAGE-TEXT(1) 20120000
201300         PERFORM DP013-0000-PROCESS-ABEND                         20130000
201400     END-IF.                                                      20140000
201500                                                                  20150000
201600******************************************************************20160000
201700** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **20170000
201800** SPECIFIC COMMAREA.                                           **20180000
201900******************************************************************20190000
202000 5110-WRITE-ASC-LISTQ.                                            20200000
202100     EXEC CICS                                                    20210000
202200         WRITEQ TS                                                20220000
202300             QUEUE (ASC-LIST-QUEUE-NAME)                          20230000
202400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20240000
202500             ITEM  (PV-BLOCK-NUMBER)                              20250000
202600             RESP  (PV-CICS-RESP)                                 20260000
202700     END-EXEC.                                                    20270000
202800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      20280000
202900         SET DP013-CICS-ABEND      TO TRUE                        20290000
203000         SET DP013-NO-ROLLBACK     TO TRUE                        20300000
203100         MOVE '5110-WRITE-ASC-LISTQ'                              20310000
203200                                   TO DP013-PARAGRAPH             20320000
203300         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           20330000
203400                                   TO DP013-MESSAGE-TEXT(1)       20340000
203500         PERFORM DP013-0000-PROCESS-ABEND                         20350000
203600     END-IF.                                                      20360000
203700 EJECT                                                            20370000
203800                                                                  20380000
203900*----------------------------------------------------------------*20390000
204000* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *20400000
204100*----------------------------------------------------------------*20410000
204200                                                                  20420000
204300 9100-READ-SEL-QUEUE.                                             20430000
204400     EXEC CICS                                                    20440000
204500         READQ TS                                                 20450000
204600             QUEUE (ASC-SEL-QUEUE-NAME)                           20460000
204700             INTO  (VN003-VENDOR-SEL-REC)                         20470000
204800             ITEM  (ASC-SEL-ITEM)                                 20480000
204900             RESP  (PV-CICS-RESP)                                 20490000
205000     END-EXEC.                                                    20500000
205100                                                                  20510000
205200     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       20520000
205300         CONTINUE                                                 20530000
205400     ELSE                                                         20540000
205500         SET DP013-LOGIC-ABEND                                    20550000
205600             DP013-NO-ROLLBACK     TO TRUE                        20560000
205700         MOVE '9100-READ-SEL-QUEUE'                               20570000
205800                                   TO DP013-PARAGRAPH             20580000
205900         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   20590000
206000                                   TO DP013-MESSAGE-TEXT (1)      20600000
206100         PERFORM DP013-0000-PROCESS-ABEND                         20610000
206200     END-IF.                                                      20620000
206300*----------------------------------------------------------------*20630000
206400* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *20640000
206500*----------------------------------------------------------------*20650000
206600 9200-REWRITE-LIST-QUEUE.                                         20660000
206700     EXEC CICS                                                    20670000
206800          WRITEQ TS                                               20680000
206900              QUEUE  (ASC-SEL-QUEUE-NAME)                         20690000
207000              FROM   (VN003-VENDOR-SEL-REC)                       20700000
207100              ITEM   (ASC-SEL-ITEM)                               20710000
207200              RESP   (PV-CICS-RESP)                               20720000
207300              REWRITE                                             20730000
207400     END-EXEC.                                                    20740000
207500                                                                  20750000
207600     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   20760000
207700         SET DP013-CICS-ABEND                                     20770000
207800             DP013-NO-ROLLBACK     TO TRUE                        20780000
207900         MOVE '9200-REWRITE-LIST-QUEUE'                           20790000
208000                                   TO DP013-PARAGRAPH             20800000
208100         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   20810000
208200                                   TO DP013-MESSAGE-TEXT (1)      20820000
208300         PERFORM DP013-0000-PROCESS-ABEND                         20830000
208400     END-IF.                                                      20840000
208500                                                                  20850000
208600 EJECT                                                            20860000
208700*----------------------------------------------------------------*20870000
208800*    ABEND PROCESSOR MODULE                                      *20880000
208900*----------------------------------------------------------------*20890000
209000                                                                  20900000
209100     COPY DPPD013.                                                20910000
