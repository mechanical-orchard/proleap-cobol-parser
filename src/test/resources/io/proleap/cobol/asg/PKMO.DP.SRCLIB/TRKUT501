000100******************************************************************00010011
000200 IDENTIFICATION DIVISION.                                         00020011
000300******************************************************************00030011
000400                                                                  00040011
000500 PROGRAM-ID.    TRKUT501.                                         00050014
000600 AUTHOR.        BUDDY BARNES.                                     00060011
000700 INSTALLATION.  KOHLS.                                            00070011
000800 DATE-WRITTEN   APR 2011.                                         00080011
000900 DATE-COMPILED.                                                   00090011
001000                                                                  00100011
001100******************************************************************00110011
001200* THIS PROGRAM TAKES IN THE EXTRACT OF THE WHOLE TRT_VND_TRANS_RT 00120011
001300* TABLE WHICH IS SORTED. IF THERE IS A DUPLICATE FOUND, THE WHOLE 00130011
001310* RECORD WILL BE WRITTEN TO AN OUTPUT FILE FOR THE DELETE PROGRAM 00140011
001330******************************************************************00160011
001340******************************************************************00170011
001350 ENVIRONMENT DIVISION.                                            00180011
001360******************************************************************00190011
001370 CONFIGURATION SECTION.                                           00200011
001380 SOURCE-COMPUTER.        IBM-3090.                                00210011
001390 OBJECT-COMPUTER.        IBM-3090.                                00220011
001400                                                                  00230011
001500 INPUT-OUTPUT SECTION.                                            00240011
001600 FILE-CONTROL.                                                    00250011
001700                                                                  00260011
001800     SELECT INPUT-FILE                                            00270011
001900         ASSIGN TO INP01.                                         00280011
002000                                                                  00290011
002100     SELECT OUTPUT-FILE1                                          00300011
002200         ASSIGN TO OUT01.                                         00310011
002300                                                                  00320011
002700******************************************************************00360011
002800 DATA DIVISION.                                                   00370011
002900******************************************************************00380011
003000                                                                  00390011
003100 FILE SECTION.                                                    00400011
003200                                                                  00410011
003300 FD  INPUT-FILE                                                   00420011
003400     RECORDING MODE IS F                                          00430011
003500     LABEL RECORDS ARE STANDARD                                   00440011
003600     RECORD CONTAINS 184                                          00450013
003700     BLOCK CONTAINS 0 RECORDS                                     00460011
003800     DATA RECORD IS INPUT-RECORD.                                 00470011
003900                                                                  00480011
004000 01  INPUT-RECORD              PIC  X(184).                       00490013
004100                                                                  00500011
004200 FD  OUTPUT-FILE1                                                 00510011
004300     RECORDING MODE IS F                                          00520011
004400     LABEL RECORDS ARE STANDARD                                   00530011
004500     RECORD CONTAINS 184                                          00540013
004510     BLOCK CONTAINS 0 RECORDS                                     00550011
004520     DATA RECORD IS OUTPUT-RECORD1.                               00560011
004530                                                                  00570011
004531 01  OUTPUT-RECORD1            PIC  X(184).                       00580013
004532                                                                  00590011
004560******************************************************************00690011
004570 WORKING-STORAGE SECTION.                                         00700011
004580******************************************************************00710011
004590 01  PS-PROGRAM-SWITCHES.                                         00720011
004600     05  PS-EOF-INPUT-SW              PIC X(01)  VALUE 'N'.       00730011
004700         88  PS-EOF-INPUT                        VALUE 'Y'.       00740011
004800         88  PS-NOT-EOF-INPUT                    VALUE 'N'.       00750011
004900     05  PS-FIRST-RECORD-SW           PIC X(01)  VALUE 'Y'.       00760011
005000         88  PS-FIRST-RECORD                     VALUE 'Y'.       00770011
005100         88  PS-FIRST-RECORD-NO                  VALUE 'N'.       00780011
005401                                                                  00890011
005402 01  PC-PROGRAM-CONSTANTS.                                        00900011
005403     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'TRKUT501'. 00910014
005404     05  PC-MAX-RETRIES           PIC S9(04) VALUE +3 COMP.       00920011
005419                                                                  01070011
005420 01  PV-PROGRAM-VARIABLES.                                        01080011
005421     05  PV-RECORDS-READ              PIC 9(09)  VALUE ZERO.      01090011
005422     05  PV-DUPLICATES-WRITTEN        PIC 9(09)  VALUE ZERO.      01100011
005423     05  PV-RETRY-COUNTER             PIC S9(04) VALUE 0 COMP.    01110011
005424     05  PV-SAVE-DC                   PIC 9(04) VALUE ZEROS.      01120011
005804                                                                  02120011
       01  WS-HOLD-RECORD.                                              02121011
           10 WS-HOLD-VND-TRANS-RT-ID       PIC  S9(9) COMP.            02122011
           10 WS-HOLD-VND-NBR               PIC   X(10).                02123011
           10 WS-HOLD-TRANS-RT-TYP-CDE      PIC   X(4).                 02124011
           10 WS-HOLD-EFF-RT-BEG-DTE        PIC   X(26).                02125011
           10 WS-HOLD-EFF-RT-END-DTE        PIC   X(26).                02126011
           10 WS-HOLD-DCONSLR-SCAC-ID       PIC   X(4).                 02127011
           10 WS-HOLD-POE-STD-EDI-CDE       PIC   X(5).                 02128011
           10 WS-HOLD-FOB-STD-EDI-CDE       PIC   X(5).                 02129011
           10 WS-HOLD-EDI-CONTNR-SZ-TYP-CDE                             02129111
                                            PIC   X(4).                 02129211
           10 WS-HOLD-CMDTY-TYP-GRP-CDE     PIC   X(4).                 02129311
           10 WS-HOLD-TRANS-RT-AMT          PIC  S9(8)V9(2) COMP-3.     02129411
           10 WS-HOLD-RT-WT-TYP-CDE         PIC   X(3).                 02129511
           10 WS-HOLD-UOM-CDE               PIC   X(3).                 02129611
           10 WS-HOLD-RT-BSS-MAX-QTY        PIC  S9(8)V9(2) COMP-3.     02129711
           10 WS-HOLD-RT-BSS-MIN-QTY        PIC  S9(8)V9(2) COMP-3.     02129811
           10 WS-HOLD-CRE-TMST              PIC   X(26).                02129911
           10 WS-HOLD-CRE-USRID             PIC   X(8).                 02130011
           10 WS-HOLD-LAST-UPD-TMST         PIC   X(26).                02130111
           10 WS-HOLD-LAST-UPD-USRID        PIC   X(8).                 02130211
                                                                        02132511
005805 01  PV-ABEND-FIELDS.                                             02133011
005806     05  PV-ABEND-CODE                PIC  S9(4) VALUE +0         02140011
005807                                                 COMP SYNC.       02150011
005809     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    02170011
005810     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    02180011
005811     05  PV-ABEND-STRUCTURE-1         PIC  X(08) VALUE SPACES.    02190011
005812     05  PV-ABEND-STRUCTURE-2         PIC  X(08) VALUE SPACES.    02200011
005843                                                                  02530011
005844******************************************************************02531028
005845*  VENDOR TRANSPORTATION RATES RECORD LAYOUT                      02532033
005846******************************************************************02533028
005847     COPY TRRD272.                                                02534028
005843                                                                  02535028
005844******************************************************************02540011
005845*  DB2 FORMATTED MESSAGE AREA                                     02550011
005846******************************************************************02560011
005847     COPY DPWS004.                                                02570011
005848*                                                                 02580011
008520******************************************************************04700011
008530 PROCEDURE DIVISION.                                              04710011
008540******************************************************************04720011
008550 0000-PROGRAM-MAINLINE.                                           04730011
008560                                                                  04740011
008570     OPEN INPUT  INPUT-FILE                                       04750011
008580          OUTPUT OUTPUT-FILE1.                                    04760025
008600                                                                  04780011
008900     PERFORM 7000-READ-INPUT-FILE.                                04810023
009000                                                                  04820011
009100     PERFORM 2000-PROCESS-INPUT-FILE                              04830011
009200         UNTIL PS-EOF-INPUT.                                      04840011
009300                                                                  04850011
009400     PERFORM 9000-EOJ.                                            04860011
009500                                                                  04870011
009600     STOP RUN.                                                    04880011
009700                                                                  04890011
011400******************************************************************05060011
011500* PROCESS INPUT RECORDS                                          *05070011
011600******************************************************************05080011
011700 2000-PROCESS-INPUT-FILE.                                         05090011
011800     MOVE '2000-PROCESS-INPUT-FILE.'   TO PV-ABEND-PARAGRAPH.     05100011
011900                                                                  05110011
012200     IF PS-FIRST-RECORD                                           05140011
012300         MOVE TR272-VENDOR-TRANS-RATE-REC TO WS-HOLD-RECORD       05150031
012300         SET PS-FIRST-RECORD-NO TO TRUE                           05160011
012600     ELSE                                                         05180011
           IF WS-HOLD-EFF-RT-END-DTE = '9999-09-09-00.00.00.000000' AND 05190016
             (TR272-VND-NBR = WS-HOLD-VND-NBR AND                       05202129
              TR272-TRANS-RT-TYP-CDE = WS-HOLD-TRANS-RT-TYP-CDE AND     05203029
              TR272-EFF-RT-END-DTE = WS-HOLD-EFF-RT-END-DTE AND         05205029
              TR272-DCONSLR-SCAC-ID = WS-HOLD-DCONSLR-SCAC-ID AND       05206029
              TR272-POE-STD-EDI-CDE = WS-HOLD-POE-STD-EDI-CDE AND       05207029
              TR272-FOB-STD-EDI-CDE = WS-HOLD-FOB-STD-EDI-CDE AND       05208029
              TR272-EDI-CONTNR-SZ-TYP-CDE =                             05209029
                                  WS-HOLD-EDI-CONTNR-SZ-TYP-CDE AND     05209115
              TR272-CMDTY-TYP-GRP-CDE =                                 05209229
                                  WS-HOLD-CMDTY-TYP-GRP-CDE AND         05209315
              TR272-RT-WT-TYP-CDE = WS-HOLD-RT-WT-TYP-CDE AND           05209429
              TR272-UOM-CDE = WS-HOLD-UOM-CDE AND                       05209529
              TR272-RT-BSS-MAX-QTY = WS-HOLD-RT-BSS-MAX-QTY AND         05209629
              TR272-RT-BSS-MIN-QTY = WS-HOLD-RT-BSS-MIN-QTY)            05209729
014000             PERFORM 8000-WRITE-OUTPUT-RECORD                     05360022
012300             MOVE TR272-VENDOR-TRANS-RATE-REC TO WS-HOLD-RECORD   05361032
014100         ELSE                                                     05370011
012300             MOVE TR272-VENDOR-TRANS-RATE-REC TO WS-HOLD-RECORD.  05371032
016500                                                                  05809811
016600     PERFORM 7000-READ-INPUT-FILE.                                05809923
016700                                                                  05810011
009800******************************************************************05820023
009900* READS RECORD FROM THE INPUT FILE                                05830023
010000******************************************************************05840023
010100 7000-READ-INPUT-FILE.                                            05850023
010200     MOVE '7000-READ-INPUT-FILE.'      TO  PV-ABEND-PARAGRAPH.    05860023
010300                                                                  05870023
010400     READ INPUT-FILE                                              05880023
010500          INTO TR272-VENDOR-TRANS-RATE-REC                        05890031
010600            AT END                                                05900023
010700               SET PS-EOF-INPUT     TO TRUE                       05910023
010800                                                                  05920023
010900            NOT AT END                                            05930023
011000               SET PS-NOT-EOF-INPUT TO TRUE                       05940023
011100               ADD +1 TO PV-RECORDS-READ                          05950023
011200     END-READ.                                                    05960023
011300                                                                  05970023
050903******************************************************************28070011
050904* WRITES THE APPROPRIATE OUTPUT RECORDS                          *28080011
050905******************************************************************28090011
050906 8000-WRITE-OUTPUT-RECORD.                                        28100022
050908     MOVE '8000-WRITE-OUTPUT-RECORD.'  TO PV-ABEND-PARAGRAPH.     28120022
050910                                                                  28140011
050912     WRITE OUTPUT-RECORD1 FROM WS-HOLD-RECORD                     28160011
050918                                                                  28260011
050919     ADD  1  TO  PV-DUPLICATES-WRITTEN.                           28270011
050920                                                                  28280011
050921 9000-EOJ.                                                        28290011
050923                                                                  28310011
050924     CLOSE INPUT-FILE                                             28320011
050925           OUTPUT-FILE1.                                          28330025
050927                                                                  28350011
050928     DISPLAY ' RECORDS READ      = ' PV-RECORDS-READ              28360027
050929     DISPLAY ' DUPLICATE RECORDS = ' PV-DUPLICATES-WRITTEN.       28370017
                                                                        28370127
           IF PV-DUPLICATES-WRITTEN = ZERO                              28371027
               MOVE 1 TO RETURN-CODE.                                   28372027
050930                                                                  28380011
050931******************************************************************28390011
050932* ABEND PROCEDURE                                                *28400011
050933******************************************************************28410011
050934*9999-SQL-ABEND.                                                  28420026
050936*    DISPLAY '** PROGRAM ABEND   ** = ' PC-PROGRAM-NAME.          28440026
050937*    DISPLAY '** PARAGRAPH       ** = ' PV-ABEND-PARAGRAPH.       28450026
050944*    CALL 'ILBOABN0'   USING PV-ABEND-CODE.                       28520026
050945                                                                  28530011
