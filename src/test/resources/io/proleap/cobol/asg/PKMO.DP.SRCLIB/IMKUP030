       IDENTIFICATION DIVISION.                                         09/16/94
                                                                           LV020
       PROGRAM-ID.             IMKUP030.                                   CL**1
       AUTHOR.                 PAUL KEBER.                                 CL**1
       INSTALLATION.           KOHLS DEPARTMENT STORES.                    CL**1
       DATE-WRITTEN.           10/03/2002.                                 CL**1
       DATE-COMPILED.                                                      CL**1
                                                                           CL**1
      ******************************************************************   CL**1
      *  IMKUP030 - PROCESS NON-VSM ITEM CHANGE MESSAGES               *   CL**1
      ******************************************************************   CL**1
      * THIS BATCH MQSERIES PROGRAM WILL BE USED TO PROCESS NON-VSM        CL**1
      * ITEM MAINTENANCE CHANGE MESSAGES READ FROM THE                     CL**1
      * IM.NONVSM.ITEM.CHANGES.Q MQSERIES QUEUE.                           CL**1
      *                                                                    CL**1
      * A SIZE DESCRIPTION CHANGE MESSAGE WILL FIND ALL SKUS AND UPCS      CL**1
      * ON TUPC CONTAINING THE SIZE CODE WHOSE DESCRIPTION IS BEING        CL**1
      * CHANGED.  A SKU COLOR/SIZE CHANGE MESSAGE (TYPE 050) WILL BE       CL**1
      * CREATED FOR EACH SKU FOUND ON TUPC MEETING THE CRITERIA.           CL**1
      * A UPC COLOR/SIZE CHANGE MESSAGE (TYPE 115) WILL BE CREATED         CL**1
      * FOR EACH UPC FOUND ON TUPC MEETING THE CRITERIA.                   CL**1
      *                                                                    CL**1
      * A TICKET TYPE DESCRIPTION CHANGE MESSAGE WILL FIND ALL STYLES      CL**1
      * ON TMDARVS CONTAINING THE TICKET TYPE WHOSE DESCRIPTION IS         CL**1
      * BEING CHANGED.  A STYLE ATTRIBUTE CHANGE MESSAGE (TYPE 015)        CL**1
      * WILL BE CREATED FOR EACH STYLE FOUND ON TMDARVS MEETING THE        CL**1
      * CRITERIA.                                                          CL**1
      *                                                                    CL**1
      * A LABEL TYPE CODE CHANGE MESSAGE WILL FIND ALL STYLES ON           CL**1
      * TMDARVS CONTAINING THE LABEL WHOSE LABEL TYPE CODE IS BEING        CL**1
      * CHANGED.  A STYLE ATTRIBUTE CHANGE MESSAGE (TYPE 015) WILL BE      CL**1
      * CREATED FOR EACH STYLE FOUND ON TMDARVS MEETING THE CRITERIA.      CL**1
      *                                                                    CL**1
      * A LABEL PRICE TIER/LIFESTYLE CHANGE MESSAGE WILL FIND ALL          CL**1
      * STYLES ON TMDARVS CONTAINING THE LABEL AND WILL UPDATE THE         CL**1
      * PRICE TIER AND LIFESTYLE FOR THOSE STYLES.                         CL**1
      *                                                                    CL**1
      * ALL MESSAGES THAT ARE CREATED WILL BE INSERTED ON THE VSM TO       CL**1
      * RMS MESSAGE BRIDGE TO MQSERIES DB2 TABLE (IMT_EVNT_MSG_BRG).       CL**1
      *                                                                    CL**1
      *****************************************************************    CL**1
      * WR/PITS#    DATE       DESCRIPTION                              00180061
      * --------  --------  ------------------------------------------- 00190061
      * WR#25951  10/30/03  P. KEBER - REPLACED SLHTT WITH KY_CLSN AND  00200061
      * FBRCN WITH CLLCTN AND ADDED FNSH DESC IN THE STYLE ATTRIBUTE            
      * CHANGE MESSAGE.                                                         
      *                                                                         
      * WR#24363  04/21/04  P. KEBER - ADDED LOGIC TO WRITE OUT THE     00200061
      * TCOLOR SHORT COLOR DESCRIPTION AND NRF COLOR DESCRIPTION ON THE         
      * SKU AND UPC COLOR/SIZE ATTRIBUTES CHANGE MESSAGES.                      
      *                                                                         
      * WR#26741  04/13/04  P. KEBER - ADDED LOGIC TO POPULATE THE NEW  00200061
      * MAP RETAIL AMOUNT COLUMN TO THE STYLE ATTRIBUTES CHANGE MESSAGE.        
      *                                                                         
      * WR#29786  12/22/05  P. KEBER - CHANGE TO ADD                    00200061
      * IM008-STYL-ATTR-OLD-LBL TO THE STYLE ATTRIBUTES CHANGE MESSAGE.         
      *                                                                         
      * 12/22/2005  P. KEBER      WR29786 - PRICE TIER AND LIFESTYLE            
      *   CHANGE TO FILL IM008-STYLE-RECL-LBL-SUP ON THE 010 MESSAGE.           
      *                                                                         
      * 08/16/2006  D. THEEL      WR30627 - PRIVATE BRAND ACCOUNTING            
      * ADD LOGIC TO PROCESS LBL TYP CDE UPDATES FOR STYLE ATTRIBUTE            
      * CHANGE MESSAGES.                                                        
      *                                                                         
      * 02/16/2007  D. THEEL   PM00984014                                       
      * FIX TICKET TYPE.                                                        
      *                                                                         
      * 02/16/2007  P. KEBER   PM01065239                                       
      * HANDLE A MISSING LABEL TYPE CODE IN 6450-GET-LBL-TYP-CDE.               
      *                                                                         
      * 10/06/2008  P. KEBER   WR35174 - PRICE TIER AND LIFESTYLE               
      * ADD LOGIC TO PROCESS LABEL PRICE TIER/LIFESTYLE CHANGE MESSAGES         
      * THAT WILL FIND ALL STYLES ON TMDARVS CONTAINING THE LABEL AND      CL**1
      * WILL UPDATE THE PRICE TIER AND LIFESTYLE FOR THOSE STYLES.         CL**1
      * THAT WILL INDIRECTLY GENERATE A STYLE ATTRIBUTE CHANGE 2 MESSAGE        
      * (TYPE 017).  TCKRSTCNTL CHECKPOINT FREQUENCY TIME WILL BE USED          
      * TO TAKE CHECKPOINTS.                                                    
      *                                                                         
      * 01/29/2009  D. THEEL   WR36002 - FIX SIZE DESCRIPTION                   
      * DUE TO PERFORMANCE ISSUES, SIZE DESCRIPTION CHANGE MESSAGES             
      * WILL NO LONGER BE PROCESSED IN THIS PROGRAM.  INSTEAD, THESE       CL**1
      * MESSAGES WILL BE WRITTEN TO AN OUTPUT FILE TO BE PROCESSED BY      CL**1
      * A NEW SET OF PROGRAMS IN THE SAME JOB.                             CL**1
      *                                                                         
219606* 03/08/2019  J. HUNTER  CHG0219606                                       
219606* DELETED PARA. 8300-PUT-MSG-ON-DLQ TO PREVENT MESSAGES FROM              
219606* BEING WRITTEN TO THE DEAD LETTER QUEUE.  ALSO, DELETED CALLS            
219606* IN PARA. 1500-MQ-SETUP TO OPEN QUEUE MANAGER AND GET QUEUE              
219606* NAME FOR DEAD LETTER QUEUE.                                             
219606* WHEN BUSINESS EVENT ISN'T VALID IN PARA 2000-PROCESS-MESSAGES,          
219606* CHANGED DISPLAY FROM PV-INPUT-REC (WHICH INVALID RECORDS                
219606* AREN'T MOVED INTO) TO IMRD018-RECORD.                                   
      ***************************************************************** 00250061
                                                                                
       ENVIRONMENT DIVISION.                                            00270025
                                                                        00290025
       CONFIGURATION SECTION.                                           00300025
                                                                        00310025
       SOURCE-COMPUTER.       IBM-3090.                                 00320025
       OBJECT-COMPUTER.       IBM-3090.                                 00330025
                                                                        00340025
       INPUT-OUTPUT SECTION.                                            00350025
                                                                        00360025
       FILE-CONTROL.                                                    00370025
           SELECT CONTROL-CARD-1   ASSIGN TO INP01.                     00380025
           SELECT CONTROL-CARD-2   ASSIGN TO INP02.                     00390025
                                                                        00490025
W36002     SELECT SIZE-DESC-OUT-FILE ASSIGN TO OUT01.                   00500025
      * ------------------------------------------------------------- * 00510025
       DATA DIVISION.                                                   00520025
      * ------------------------------------------------------------- * 00530025
       FILE SECTION.                                                    00540025
                                                                        00550025
       FD  CONTROL-CARD-1                                               00560025
           RECORDING MODE F                                             00570025
           BLOCK CONTAINS 0 RECORDS                                     00580025
           LABEL RECORDS ARE OMITTED.                                   00590025
       01  CONTROL-CARD-1-LINE           PIC  X(80).                    00600025
                                                                        00610025
       FD  CONTROL-CARD-2                                               00620025
           RECORDING MODE F                                             00630025
           BLOCK CONTAINS 0 RECORDS                                     00640025
           LABEL RECORDS ARE OMITTED.                                   00650025
       01  CONTROL-CARD-2-LINE           PIC  X(80).                    00660025
                                                                        00670025
W36002 FD  SIZE-DESC-OUT-FILE                                           00440024
W36002     LABEL RECORDS ARE STANDARD                                   00450024
W36002     RECORDING MODE IS F                                          00460024
W36002     BLOCK CONTAINS 0 RECORDS.                                    00470024
W36002 01  SIZE-DESC-OUT-RECORD          PIC  X(100).                   00480024
      * ------------------------------------------------------------- * 00850025
       WORKING-STORAGE SECTION.                                         00860025
      * ------------------------------------------------------------- * 00870025
                                                                        00880025
       01  WS-MQCONN                 PIC X(8)  VALUE 'CSQBCONN'.        00890025
       01  WS-MQOPEN                 PIC X(8)  VALUE 'CSQBOPEN'.        00900025
       01  WS-MQINQ                  PIC X(8)  VALUE 'CSQBINQ'.         00910025
       01  WS-MQGET                  PIC X(8)  VALUE 'CSQBGET'.         00920025
       01  WS-MQPUT1                 PIC X(8)  VALUE 'CSQBPUT1'.        00930025
       01  WS-MQBACK                 PIC X(8)  VALUE 'CSQBBACK'.        00940025
       01  WS-MQCMIT                 PIC X(8)  VALUE 'CSQBCOMM'.        00950025
       01  WS-MQCLOSE                PIC X(8)  VALUE 'CSQBCLOS'.        00960025
       01  WS-MQDISC                 PIC X(8)  VALUE 'CSQBDISC'.        00970025
                                                                        01000025
      *    API CONTROL BLOCKS                                           01010025
                                                                        01020025
       01  MQM-OBJECT-DESCRIPTOR.                                       01030025
           COPY CMQODV.                                                 01040025
       01  MQM-MESSAGE-DESCRIPTOR.                                      01050025
           COPY CMQMDV.                                                 01060025
       01  MQM-GET-MESSAGE-OPTIONS.                                     01070025
           COPY CMQGMOV.                                                01080025
       01  MQM-PUT-MESSAGE-OPTIONS.                                     01090025
           COPY CMQPMOV.                                                01100025
                                                                        01110025
      *    MQV CONTAINS CONSTANTS (FOR FILLING IN THE CONTROL BLOCKS)   01120025
      *    AND RETURN CODES (FOR TESTING THE RESULT OF A CALL)          01130025
                                                                        01140025
       01  MQM-CONSTANTS.                                               01150025
           COPY CMQV.                                                   01160025
      *                                                                 01170025
      *----------------------------------------------------------------*01180025
      *    CONTROL CARD                                                 01190025
      *----------------------------------------------------------------*01200025
       01  CC-CONTROL-CARD-1.                                           01210025
           05  CC-QMGR-NAME              PIC X(48).                     01220025
           05  FILLER                    PIC X(32).                     01230025
                                                                        01240025
       01  CC-CONTROL-CARD-2.                                           01250025
           05  CC-NONVSM-ITEM-CHG-QNAME  PIC X(48).                     01260025
           05  FILLER                    PIC X(32).                     01270025
                                                                        01280025
      *----------------------------------------------------------------*01290025
      *    PROGRAM ACCUMULATORS                                         01300025
      *----------------------------------------------------------------*01310025
       01  PA-PROGRAM-ACCUMULATORS.                                     01320025
           05  PA-IMT-EVNT-MSG-BRG-INSERTS                              01390025
                                         PIC 9(07) VALUE 0.             01400025
           05  PA-MQGET                  PIC 9(07) VALUE 0.             01370025
           05  PA-COMMIT-CNTR            PIC 9(07) VALUE 0.             01370025
           05  PA-SIZE-DESC-CHG-MSGS     PIC 9(07) VALUE 0.             01420025
           05  PA-TKT-TYP-DESC-CHG-MSGS  PIC 9(07) VALUE 0.             01430025
           05  PA-LBL-TYP-CDE-CHG-MSGS   PIC 9(07) VALUE 0.             01430025
           05  PA-LBL-PT-LS-CHG-MSGS     PIC 9(07) VALUE 0.             01430025
           05  PA-STYLE-PT-LS-UPDATES    PIC 9(07) VALUE 0.             01430025
W36002     05  PA-SIZE-DESC-CHGS-OUT     PIC 9(07) VALUE 0.                     
                                                                        01840025
      *----------------------------------------------------------------*01850025
      *    PROGRAM CONSTANTS                                            01860025
      *----------------------------------------------------------------*01870025
       01  PC-PROGRAM-CONSTANTS.                                        01880025
           05  PC-DEADLOCK               PIC S9(04) VALUE -913 COMP.    02350025
           05  PC-ESL-CHARTC-CDE         PIC S9(04) VALUE +19  COMP.            
           05  PC-HNG-FLD-CHARTC-CDE     PIC S9(04) VALUE +10  COMP.            
           05  PC-LBL-CHARTC-CDE         PIC S9(04) VALUE +3   COMP.            
           05  PC-KY-CLSN-CHARTC-CDE     PIC S9(04) VALUE +8   COMP.            
           05  PC-FNSH-CHARTC-CDE        PIC S9(04) VALUE +9   COMP.            
           05  PC-CLLCTN-CHARTC-CDE      PIC S9(04) VALUE +20  COMP.            
           05  PC-MAX-RETRIES            PIC S9(04) VALUE +3   COMP.    02320025
           05  PC-ROW-NOT-FOUND          PIC S9(04) VALUE +100 COMP.    02340025
           05  PC-RTL-CLSN-CHARTC-CDE    PIC S9(04) VALUE +6   COMP.            
           05  PC-TKT-CHARTC-CDE         PIC S9(04) VALUE +2   COMP.            
           05  PC-UNAVAILABLE-RESOURCES  PIC S9(04) VALUE -904 COMP.    02360025
           05  PC-PGM-NAME               PIC X(08)  VALUE 'IMKUP030'.   01890025
           05  PC-JOB-NAME               PIC X(08)  VALUE 'IMK929'.     01890025
           05  PC-FIFTY-STARS            PIC X(50)  VALUE ALL '*'.      02280025
           05  PC-ORIGIN-CNTRY           PIC X(03)  VALUE 'US '.        02320025
                                                                        02370025
      *----------------------------------------------------------------*02380025
      *    PROGRAM SWITCHES                                             02390025
      *----------------------------------------------------------------*02400025
       01  PS-PROGRAM-SWITCHES.                                         02410025
           05  PS-CONTROL-CARD-1-SW      PIC X(01) VALUE 'N'.           02420025
               88  PS-CONTROL-CARD-1-END           VALUE 'Y'.           02430025
               88  PS-CONTROL-CARD-1-START         VALUE 'N'.           02440025
           05  PS-CONTROL-CARD-2-SW      PIC X(01) VALUE 'N'.           02450025
               88  PS-CONTROL-CARD-2-END           VALUE 'Y'.           02460025
               88  PS-CONTROL-CARD-2-START         VALUE 'N'.           02470025
           05  PS-MQGET-SUCCESSFUL-SW    PIC X(01) VALUE 'N'.           02510025
               88  PS-MQGET-SUCCESSFUL             VALUE 'Y'.           02520025
           05  PS-NO-RECORD-FOUND-IND    PIC X(01) VALUE 'N'.           02560025
               88  PS-NO-RECORD-FOUND              VALUE 'Y'.           02570025
           05  PS-ROW-FOUND-SW           PIC X(01) VALUE 'Y'.           02620025
               88  PS-ROW-FOUND                    VALUE 'Y'.           02630025
               88  PS-ROW-NOT-FOUND                VALUE 'N'.           02640025
                                                                        02650025
      *----------------------------------------------------------------*02660025
      *    PROGRAM VARIABLES                                            02670025
      *----------------------------------------------------------------*02680025
       01  PV-PROGRAM-VARIABLES.                                        02690025
           05  PV-UPC-ID-DOUBLE          PIC S9(10) VALUE +0 COMP.              
           05  PV-CHAR-ATTR-LENGTH       PIC S9(9)  VALUE +48 COMP.             
           05  PV-COMPLETION-CODE        PIC S9(9)  VALUE +0 COMP.      03400025
           05  PV-CON-REASON             PIC S9(9)  VALUE +0 COMP.      03430025
           05  PV-DATA-LENGTH            PIC S9(9)  VALUE +0 COMP.      03220025
           05  PV-HCONN                  PIC S9(9)  VALUE +0 COMP.      03370025
           05  PV-INT-ATTR-COUNT         PIC S9(9)  VALUE +0 COMP.      03260025
           05  PV-INT-ATTR-TABLE.                                       03270025
               10  PV-INT-ATTR           PIC S9(9)  COMP OCCURS 1 TIMES.03280025
           05  PV-GQ-HANDLE              PIC S9(9)  VALUE +0 COMP.      03380025
           05  PV-MSGLENGTH              PIC S9(9)  VALUE +100 COMP.    03210025
           05  PV-OPEN-OPTIONS           PIC S9(9)  VALUE +0 COMP.      03390025
           05  PV-REASON                 PIC S9(9)  VALUE +0 COMP.      03410025
           05  PV-RETRY-COUNT            PIC S9(03) VALUE +0 COMP.      03420025
           05  PV-SELECT-COUNT           PIC S9(9)  VALUE +1 COMP.      03230025
           05  PV-SELECTOR-TABLE.                                       03240025
               10  PV-SELECTOR           PIC S9(9)  COMP OCCURS 1 TIMES.03250025
           05  PV-SQL-SUB                PIC S9(4)  VALUE +0 COMP.      03060025
                                                                        03580025
           05  PV-ACTION                 PIC X(08)  VALUE SPACES.       03140025
           05  PV-CHAR-ATTRS             PIC X(48)  VALUE SPACES.       03300030
           05  PV-CURRENT-DATE.                                         03310054
               10  PV-CURRENT-YEAR       PIC X(04)  VALUE SPACES.       03320054
               10  FILLER                PIC X(01)  VALUE '-'.          03330054
               10  PV-CURRENT-MONTH      PIC X(02)  VALUE SPACES.       03340054
               10  FILLER                PIC X(01)  VALUE '-'.          03350054
               10  PV-CURRENT-DAY        PIC X(02)  VALUE SPACES.       03360054
           05  PV-ERROR-MESSAGE          PIC X(48)  VALUE SPACES.       03570025
           05  PV-INPUT-RECORD           PIC X(100) VALUE SPACES.       03540044
               88  PV-COMMIT-DB2-INSERTS-UPDATES    VALUE               03550025
                   'ATTEMPT TO COMMIT INSERTS OR UPDATES TO DB2 TABLE'. 03560025
           05  PV-MESSAGE                PIC X(100) VALUE SPACES.       03530025
           05  PV-MSGBUFFER              PIC X(100) VALUE SPACES.       03150025
           05  PV-PARAGRAPH              PIC X(50)  VALUE SPACES.       03130025
           05  PV-SUB-CL-MDSEAR-ID       PIC S9(06) VALUE +0 COMP-3.            
           05  PV-QM-NAME                PIC X(48)  VALUE SPACES.       03120025
           05  PV-COMMIT-TIMESTAMP       PIC X(26)  VALUE SPACES.               
           05  PV-CURRENT-TIMESTAMP      PIC X(26)  VALUE SPACES.               
                                                                                
W36002*    05  PV-TCOLOR-KEY-INFO.                                         CL**1
W36002*        10  FILLER                      PIC X(14)   VALUE           CL**1
W36002*            'NRF_CLOR_CDE: '.                                            
W36002*        10  PV-TCOLOR-KEY-COLOR-CDE     PIC X(03)   VALUE SPACES.   CL**1
                                                                                
W36002*    05  PV-TCOLOR-NOT-FOUND-MSG.                                         
W36002*        10  FILLER                      PIC X(41)   VALUE                
W36002*            'TCOLOR ROW NOT FOUND FOR NRF COLOR CODE: '.                 
W36002*        10  PV-TCOLOR-NFM-NRF-CLOR-CDE  PIC X(3)    VALUE SPACES.        
                                                                        03580025
           05  PV-TVSCHVL-NOT-FOUND-MSG.                                        
               10  FILLER                      PIC X(31)   VALUE                
                   'TVSCHVL ROW NOT FOUND FOR CDE: '.                           
               10  PV-TVSCHVL-NFM-CHARTC-CDE   PIC Z(4)    VALUE ZERO.          
               10  FILLER                      PIC X(14)   VALUE                
                   ' AND SEQ NBR: '.                                            
               10  PV-TVSCHVL-NFM-SEQ-NBR      PIC Z(4)    VALUE ZERO.          
                                                                        03580025
      *****************************************************************         
      *  NON-VSM ITEM MAINTENANCE INFO COPYBOOK                                 
      ******************************************************************        
           COPY IMRD018.                                                        
                                                                           CL**1
      *****************************************************************         
      *  LEGACY ITEM MAINTENANCE INFO COPYBOOK                                  
      ******************************************************************        
           COPY IMRD008.                                                        
                                                                                
      *----------------------------------------------------------------*03730025
      *    ABEND CODES THE ARE APPLICATION DEFINED                      03740025
      *----------------------------------------------------------------*03750025
       01  ABEND-CODE                  PIC S9(4)    VALUE ZEROS         03760025
                                                    COMP SYNC.          03770025
           88  AC-CONTROL-CARD-1-MISSING            VALUE +4001.        03780025
           88  AC-CONTROL-CARD-2-MISSING            VALUE +4002.        03790025
           88  AC-DB2-ERROR                         VALUE +4013.        03820025
           88  AC-MQ-ERROR                          VALUE +4020.        03830025
                                                                        03840025
      ******************************************************************        
      *  ITEM EVENT MESSAGE BRIDGE TABLE                                        
      ******************************************************************        
                                                                                
           EXEC SQL                                                             
               INCLUDE IMT00001                                                 
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  EXTERNAL ENTITY TABLE                                                  
      ******************************************************************        
                                                                                
           EXEC SQL                                                             
               INCLUDE TEXTENT                                                  
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  MERCHANDISE AREA VENDOR STYLE TABLE                                    
      ******************************************************************        
                                                                                
           EXEC SQL                                                             
               INCLUDE TMDARVS                                                  
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  SKU CROSS-REFERENCE TABLE                                              
      ******************************************************************        
                                                                                
W36002*    EXEC SQL                                                             
W36002*        INCLUDE TSKXREF                                                  
W36002*    END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  UPC TABLE                                                              
      ******************************************************************        
                                                                                
W36002*    EXEC SQL                                                             
W36002*        INCLUDE TUPC                                                     
W36002*    END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  VENDOR STYLE CHARACTERISTIC VALUES TABLE                               
      ******************************************************************        
                                                                                
           EXEC SQL                                                             
               INCLUDE TVSCHVL                                                  
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  VENDOR STYLE TABLE                                                     
      ******************************************************************        
                                                                                
           EXEC SQL                                                             
               INCLUDE TVNDSTL                                                  
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  ITEM COLOR TABLE                                                       
      ******************************************************************        
                                                                                
W36002*    EXEC SQL                                                             
W36002*        INCLUDE TCOLOR                                                   
W36002*    END-EXEC.                                                            
                                                                                
      *****************************************************************         
      *  CHECKPOINT RESTART CONTROL TABLE                                       
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE TCKRSTCN                                                 
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  ITEM LABEL TABLE  (IMT_LBL)                                            
      ******************************************************************        
                                                                                
           EXEC SQL                                                             
               INCLUDE IMT00000                                                 
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      *  COMMUNICATION AREAS FOR DB2                                    03860025
      ******************************************************************        
           EXEC SQL                                                     03880025
               INCLUDE SQLCA                                            03890025
           END-EXEC.                                                    03900025
                                                                        03910025
      ******************************************************************        
      *  ERROR MESSAGE AREA FOR DB2                                   * 03930025
      ******************************************************************        
           COPY DPWS004.                                                03950025
                                                                        03960025
W36002***************************************************************** 04640025
W36002*    SIZE DESCRIPTION CHANGES CURSOR                              04650025
W36002***************************************************************** 04660025
W36002*    EXEC SQL                                                     04670025
W36002*        DECLARE SIZE_DESC_CHGS_CSR CURSOR FOR                    04680025
W36002*            SELECT  UPC.UPC_ID                                           
W36002*                   ,UPC.UPC_NBR                                          
W36002*                   ,UPC.SUB_CL_MDSEAR_ID                                 
W36002*                   ,UPC.VS_ID                                            
W36002*                   ,UPC.INTR_UPC_ID                                      
W36002*                   ,UPC.UPC_TYP_CDE                                      
W36002*                   ,UPC.NRF_CLOR_CDE                                     
W36002*                   ,UPC.CSTM_CLOR_DESC                                   
W36002*                   ,UPC.CUSTFACG_CLOR_DESC                               
W36002*                   ,UPC.INTR_UPC_DESC                                    
W36002*                   ,MDARVS.DEPT_NBR                                      
W36002*                   ,MDARVS.MAJ_CL_NBR                                    
W36002*                   ,MDARVS.SUB_CL_NBR                                    
W36002*                   ,MDARVS.RMS_STYL_ID                                   
W36002*                   ,VNDSTL.VS_NBR                                        
W36002*                   ,VNDSTL.ENT_ID                                        
W36002*                   ,EXTENT.DUN_NBR                                       
W36002*                   ,SKXREF.SKU                                           
W36002*              FROM  TUPC UPC,                                            
W36002*                    TMDARVS MDARVS,                                      
W36002*                    TVNDSTL VNDSTL,                                      
W36002*                    TEXTENT EXTENT,                                      
W36002*                    TSKXREF SKXREF                                       
W36002*             WHERE  UPC.KOHLS_SIZE_CDE = :UPC-KOHLS-SIZE-CDE             
W36002*               AND  UPC.UPC_TYP_CDE IN ('I','V')                         
W36002*               AND  UPC.EFF_END_DTE IS NULL                              
W36002*               AND  MDARVS.SUB_CL_MDSEAR_ID                              
W36002*                                  = UPC.SUB_CL_MDSEAR_ID                 
W36002*               AND  MDARVS.VS_ID  = UPC.VS_ID                            
W36002*               AND  VNDSTL.VS_ID  = UPC.VS_ID                            
W36002*               AND  EXTENT.ENT_ID = VNDSTL.ENT_ID                        
W36002*               AND  SKXREF.INTR_UPC_ID = UPC.INTR_UPC_ID                 
W36002*               AND  SKXREF.SKU_STAT_CDE <> '98'                          
W36002*    END-EXEC.                                                    04760025
                                                                        04770025
      ***************************************************************** 04640025
      *    TICKET TYPE DESCRIPTION CHANGES CURSOR                       04650025
      ***************************************************************** 04660025
           EXEC SQL                                                     04670025
               DECLARE TKT_TYP_D_CHGS_CSR CURSOR FOR                    04680025
                   SELECT  MDARVS.SUB_CL_MDSEAR_ID                              
                          ,MDARVS.VS_ID                                         
                          ,MDARVS.VS_DESC                                       
                          ,MDARVS.STKR_NBR                                      
                          ,MDARVS.LBL_SEQ_NBR                                   
                          ,MDARVS.HNG_FOLD_SEQ_NBR                              
                          ,MDARVS.KY_CLSN_SEQ_NBR                               
                          ,MDARVS.FNSH_SEQ_NBR                                  
                          ,MDARVS.RMS_STYL_ID                                   
                          ,MDARVS.RTL_CLSN_SEQ_NBR                              
                          ,MDARVS.DEPT_NBR                                      
                          ,MDARVS.MAJ_CL_NBR                                    
                          ,MDARVS.SUB_CL_NBR                                    
                          ,MDARVS.CLLCTN_SEQ_NBR                                
                          ,MDARVS.MAP_UNT_RTL_AMT                               
                          ,VNDSTL.VS_NBR                                        
                          ,VNDSTL.ENT_ID                                        
                          ,EXTENT.DUN_NBR                                       
                     FROM  TMDARVS MDARVS,                                      
                           TVNDSTL VNDSTL,                                      
                           TEXTENT EXTENT                                       
                    WHERE  MDARVS.TKT_TYP_SEQ_NBR =                             
                                                :MDARVS-TKT-TYP-SEQ-NBR         
                      AND  MDARVS.ACTV_IND = 'Y'                                
                      AND  VNDSTL.VS_ID  = MDARVS.VS_ID                         
                      AND  EXTENT.ENT_ID = VNDSTL.ENT_ID                        
           END-EXEC.                                                    04760025
                                                                        04770025
      ***************************************************************** 04640025
      *    LABEL TYPE CODE CHANGES CURSOR                               04650025
      ***************************************************************** 04660025
           EXEC SQL                                                     04670025
               DECLARE LBL_TYP_CDE_CSR CURSOR FOR                       04680025
                   SELECT  MDARVS.SUB_CL_MDSEAR_ID                              
                          ,MDARVS.VS_ID                                         
                          ,MDARVS.VS_DESC                                       
                          ,MDARVS.STKR_NBR                                      
                          ,MDARVS.TKT_TYP_SEQ_NBR                               
                          ,MDARVS.LBL_SEQ_NBR                                   
                          ,MDARVS.HNG_FOLD_SEQ_NBR                              
                          ,MDARVS.KY_CLSN_SEQ_NBR                               
                          ,MDARVS.FNSH_SEQ_NBR                                  
                          ,MDARVS.RMS_STYL_ID                                   
                          ,MDARVS.RTL_CLSN_SEQ_NBR                              
                          ,MDARVS.DEPT_NBR                                      
                          ,MDARVS.MAJ_CL_NBR                                    
                          ,MDARVS.SUB_CL_NBR                                    
                          ,MDARVS.CLLCTN_SEQ_NBR                                
                          ,MDARVS.MAP_UNT_RTL_AMT                               
                          ,VNDSTL.VS_NBR                                        
                          ,VNDSTL.ENT_ID                                        
                          ,EXTENT.DUN_NBR                                       
                     FROM  TMDARVS MDARVS,                                      
                           TVNDSTL VNDSTL,                                      
                           TEXTENT EXTENT                                       
                    WHERE  MDARVS.LBL_SEQ_NBR =                                 
                                                :MDARVS-LBL-SEQ-NBR             
                      AND  MDARVS.ACTV_IND = 'Y'                                
                      AND  VNDSTL.VS_ID  = MDARVS.VS_ID                         
                      AND  EXTENT.ENT_ID = VNDSTL.ENT_ID                        
           END-EXEC.                                                    04760025
                                                                        04770025
      ***************************************************************** 04640025
      *    LABEL PRICE TIER/LIFESTYLE CHANGES CURSOR                    04650025
      ***************************************************************** 04660025
           EXEC SQL                                                     04670025
               DECLARE LBL_PT_LS_CHGS_CSR CURSOR WITH HOLD FOR          04680025
                   SELECT  SUB_CL_MDSEAR_ID                                     
                          ,VS_ID                                                
                     FROM  TMDARVS                                              
                    WHERE  LBL_SEQ_NBR = :MDARVS-LBL-SEQ-NBR                    
                      AND  ACTV_IND = 'Y'                                       
                      AND (PRIC_TIER_SEQ_NBR <>                                 
                                             :MDARVS-PRIC-TIER-SEQ-NBR          
                           OR LFSTYL_SEQ_NBR <> :MDARVS-LFSTYL-SEQ-NBR)         
                    FOR UPDATE OF PRIC_TIER_SEQ_NBR, LFSTYL_SEQ_NBR             
           END-EXEC.                                                    04760025
                                                                        04770025
      * ------------------------------------------------------------- * 04780025
       PROCEDURE DIVISION.                                              04790025
      * ------------------------------------------------------------- * 04800025
       0000-IMKUP030.                                                   04810025
                                                                        04820025
           PERFORM 1000-INITIALIZE.                                     04830025
                                                                        04840025
           PERFORM 2000-PROCESS-MESSAGES                                0025    
               UNTIL NOT PS-MQGET-SUCCESSFUL.                           0025    
                                                                        04910025
           PERFORM 2500-EOJ-PROCESSING.                                 04920025
                                                                        08290025
           STOP RUN.                                                    04930025
                                                                        04940025
      *----------------------------------------------------------------*04950025
      *  INITIALIZATION ROUTINE.                                        04960025
      *----------------------------------------------------------------*04970025
       1000-INITIALIZE.                                                 04980025
                                                                        04990025
           MOVE FUNCTION CURRENT-DATE (1:4) TO PV-CURRENT-YEAR.         05000054
           MOVE FUNCTION CURRENT-DATE (5:2) TO PV-CURRENT-MONTH.        05010054
           MOVE FUNCTION CURRENT-DATE (7:2) TO PV-CURRENT-DAY.          05020054
           DISPLAY '***IMKUP030 CURRENT DATE = ' PV-CURRENT-DATE.       05030055
                                                                        05040054
           SET PS-CONTROL-CARD-1-START TO TRUE.                         05050025
           OPEN INPUT CONTROL-CARD-1                                    05060025
                      CONTROL-CARD-2                                    05070025
                OUTPUT SIZE-DESC-OUT-FILE.                              05110025
           PERFORM 8000-READ-CONTROL-CARD1.                             05120025
                                                                        05130025
           IF PS-CONTROL-CARD-1-END                                     05140025
               SET AC-CONTROL-CARD-1-MISSING TO TRUE                    05150025
               DISPLAY '* * * * * * * * * * * * * * * * *'              05160025
               DISPLAY '*    ***IMKUP030 ABEND***       *'              05170025
               DISPLAY '*                               *'              05180025
               DISPLAY '*   CONTROL CARD MISSING -      *'              05190025
               DISPLAY '*   FOR QMGR NAME               *'              05200025
               DISPLAY '*                               *'              05210025
               DISPLAY '*   ABEND CODE: ' ABEND-CODE                    05220025
                           '             *'                             05230025
               DISPLAY '* * * * * * * * * * * * * * * * *'              05240025
               CALL 'ILBOABN0'    USING  ABEND-CODE                     05250025
           ELSE                                                         05260025
               DISPLAY PC-PGM-NAME                                      05270025
                       ' - '                                            05280025
                       PC-FIFTY-STARS                                   05290025
               DISPLAY PC-PGM-NAME                                      05300025
                       ' - CONTROL CARD: '                              05310025
                       CC-CONTROL-CARD-1                                05320025
           END-IF.                                                      05330025
                                                                        05340025
           PERFORM 8100-READ-CONTROL-CARD2.                             05350025
           IF PS-CONTROL-CARD-2-END                                     05360025
               SET AC-CONTROL-CARD-2-MISSING TO TRUE                    05370025
               DISPLAY '* * * * * * * * * * * * * * * * *'              05380025
               DISPLAY '*    ***IMKUP030 ABEND***       *'              05390025
               DISPLAY '*                               *'              05400025
               DISPLAY '*   CONTROL CARD MISSING -      *'              05410025
               DISPLAY '*   NON-VSM ITEM INFO QUEUE NAME*'              05420025
               DISPLAY '*                               *'              05430025
               DISPLAY '*   ABEND CODE: ' ABEND-CODE                    05440025
                           '             *'                             05450025
               DISPLAY '* * * * * * * * * * * * * * * * *'              05460025
               CALL 'ILBOABN0'    USING  ABEND-CODE                     05470025
           ELSE                                                         05480025
               DISPLAY PC-PGM-NAME                                      05490025
                       ' - '                                            05500025
                       PC-FIFTY-STARS                                   05510025
               DISPLAY PC-PGM-NAME                                      05520025
                       ' - CONTROL CARD: '                              05530025
                       CC-CONTROL-CARD-2                                05540025
           END-IF.                                                      05550025
                                                                        05560025
           CLOSE CONTROL-CARD-1.                                        05570025
           CLOSE CONTROL-CARD-2.                                        05580025
                                                                        05590025
           PERFORM 1500-MQ-SETUP.                                       05600025
           PERFORM 8200-MQGET-MSG.                                      05610025
                                                                        05640025
      * ------------------------------------------------------------- * 05650025
      *  SETUP MQ VALUES                                                05660025
      * ------------------------------------------------------------- * 05670025
       1500-MQ-SETUP.                                                   05690025
                                                                        05640025
      *    CONNECT TO THE QUEUE MANAGER                                 05700025
           MOVE CC-QMGR-NAME TO PV-QM-NAME.                             05720025
           CALL WS-MQCONN USING PV-QM-NAME                              05730025
                               PV-HCONN                                 05740025
                               PV-COMPLETION-CODE                       05750025
                               PV-REASON.                               05760025
                                                                        05770025
      *    IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE              05780025
      *    AND EXIT                                                     05790025
                                                                        05800025
           MOVE PV-REASON TO PV-CON-REASON.                             05810025
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   05820025
              MOVE 'MQCONN ERROR'   TO PV-ERROR-MESSAGE                 05830025
              PERFORM 9000-MQ-ABEND                                     05840025
           END-IF.                                                      05850025
           DISPLAY 'MQCONN SUCCESSFUL TO ', PV-QM-NAME.                 05860025
                                                                        05870025
                                                                        06460025
      *    OPEN THE NON-VSM ITEM MAINTENANCE INFO QUEUE FOR INPUT       06470031
                                                                        06480025
           COMPUTE PV-OPEN-OPTIONS = MQOO-INPUT-SHARED +                06490025
                                     MQOO-FAIL-IF-QUIESCING.            06500025
           MOVE MQOT-Q                   TO MQOD-OBJECTTYPE.            06510025
           MOVE CC-NONVSM-ITEM-CHG-QNAME TO MQOD-OBJECTNAME.            06520025
           MOVE PV-QM-NAME               TO MQOD-OBJECTQMGRNAME.        06530025
      *                                                                 06540025
           CALL WS-MQOPEN USING PV-HCONN                                06550025
                               MQM-OBJECT-DESCRIPTOR                    06560025
                               PV-OPEN-OPTIONS                          06570025
                               PV-GQ-HANDLE                             06580025
                               PV-COMPLETION-CODE                       06590025
                               PV-REASON.                               06600025
      *                                                                 06610025
      *    IF OPEN FAILED THEN DISPLAY ERROR MESSAGE                    06620025
      *    AND EXIT.                                                    06630025
      *                                                                 06640025
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   06650025
              MOVE 'MQOPEN ERROR'   TO PV-ERROR-MESSAGE                 06660025
              PERFORM 1700-DISCONNECT-QMGR                              06670025
              PERFORM 9000-MQ-ABEND                                     06680025
           END-IF.                                                      06690025
           DISPLAY 'MQOPEN SUCCESSFUL TO ' MQOD-OBJECTNAME.             06700025
                                                                        06720025
      * ------------------------------------------------------------- * 06730025
      *  CLOSE MQ QUEUE                                                 06740025
      * ------------------------------------------------------------- * 06750025
       1600-CLOSE-QUEUE.                                                06770025
                                                                        06780025
           CALL WS-MQCLOSE USING PV-HCONN                               06790025
                                 PV-GQ-HANDLE                           06800025
                                 MQCO-NONE                              06810025
                                 PV-COMPLETION-CODE                     06820025
                                 PV-REASON.                             06830025
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   06840025
              MOVE 'MQCLOSE ERROR' TO PV-ERROR-MESSAGE                  06850025
              PERFORM 9000-MQ-ABEND                                     06860025
           ELSE                                                         06870025
              DISPLAY 'MQCLOSE SUCCESSFUL'                              06880025
           END-IF.                                                      06890025
                                                                        06910025
      * ------------------------------------------------------------- * 06920025
      *  DISCONNECT QUEUE MANAGER                                       06930025
      * ------------------------------------------------------------- * 06940025
       1700-DISCONNECT-QMGR.                                            06960025
                                                                        06970025
           IF PV-CON-REASON IS NOT EQUAL TO MQRC-ALREADY-CONNECTED      06980025
              CALL WS-MQDISC USING PV-HCONN                             06990025
                                  PV-COMPLETION-CODE                    07000025
                                  PV-REASON                             07010025
              IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                07020025
                 MOVE 'MQDISC ERROR'   TO PV-ERROR-MESSAGE              07030025
                 PERFORM 9000-MQ-ABEND                                  07040025
              ELSE                                                      07050025
                 DISPLAY 'MQDISC SUCCESSFUL'                            07060025
              END-IF                                                    07070025
           END-IF.                                                      07080025
                                                                        07100025
      * ------------------------------------------------------------- * 07110025
      *  PROCESS MESSAGES                                               07120025
      * ------------------------------------------------------------- * 07130025
       2000-PROCESS-MESSAGES.                                           07150025
                                                                        07170025
           EVALUATE TRUE                                                07200025
              WHEN IM018-BUS-EVENT-SIZE-DESC-CHG                        07210075
                 PERFORM 3100-PROCESS-SIZE-DESC-CHG                     07220025
              WHEN IM018-BUS-EVENT-TKT-TYP-DE-CHG                       07230025
                 PERFORM 3200-PROCESS-TKT-TYP-DESC-CHG                  07240025
              WHEN IM018-BUS-EVENT-LBL-TYP-CD-CHG                       07230025
                 PERFORM 3300-PROCESS-LBL-TYP-CD-CHG                    07240025
              WHEN IM018-BUS-EVENT-LBL-PT-LS-CHG                        07230025
                 PERFORM 3400-PROCESS-LBL-PT-LS-CHG                     07240025
              WHEN OTHER                                                07490025
                   DISPLAY '@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'            07500025
                   DISPLAY ' ERROR IN 2000-PROCESS-MESSAGES'            07510025
                   DISPLAY ' CANNOT PROCESS BUSINESS EVENT '            07520025
219606             DISPLAY ' INPUT REC = ' IMRD018-RECORD                       
                   DISPLAY '@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'            07530025
           END-EVALUATE.                                                07560025
                                                                        07570025
           PERFORM 8400-COMMIT-DB2.                                     07610056
           PERFORM 8450-COMMIT-MQ.                                      07630025
           PERFORM 8200-MQGET-MSG.                                      07640025
                                                                        07660025
      * ------------------------------------------------------------- * 07110025
      *  PERFORM END OF JOB PROCESSING                                  07120025
      * ------------------------------------------------------------- * 07130025
       2500-EOJ-PROCESSING.                                             07670025
                                                                        07680025
           CLOSE SIZE-DESC-OUT-FILE.                                            
           DISPLAY '*-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-*'    07690025
           DISPLAY 'END OF JOB RECORD COUNTERS'.                        07700025
           DISPLAY 'SUCCESSFUL MQGETS     ' PA-MQGET.                   07710025
           DISPLAY '*-%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-*'.             07720025
           DISPLAY 'SIZE-DESC-CHG-MSGS-IN ' PA-SIZE-DESC-CHG-MSGS.      07730025
           DISPLAY 'TKT-TYP-DESC-CHG-MSGS ' PA-TKT-TYP-DESC-CHG-MSGS.   07740025
           DISPLAY 'LBL-TYP-CDE-CHG-MSGS  ' PA-LBL-TYP-CDE-CHG-MSGS.    07740025
           DISPLAY 'LBL-PT-LS-CHG-MSGS    ' PA-LBL-PT-LS-CHG-MSGS.      07740025
           DISPLAY 'IMT-EVNT-MSG-BRG-INS  ' PA-IMT-EVNT-MSG-BRG-INSERTS.08170050
           DISPLAY 'STYLE-PT-LS-UPDATES   ' PA-STYLE-PT-LS-UPDATES.     08170050
W36002     DISPLAY 'SIZE-DESC-CHG-MSGS-OUT' PA-SIZE-DESC-CHGS-OUT.      08170050
           DISPLAY 'DB2 COMMITS           ' PA-COMMIT-CNTR.             08170050
           DISPLAY '*-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-*'    08200025
                                                                        08310025
           PERFORM 1600-CLOSE-QUEUE.                                    08230025
           PERFORM 1700-DISCONNECT-QMGR.                                08240025
                                                                        07680025
      * ------------------------------------------------------------- * 08320025
      * PROCESS A SIZE DESCRIPTION CHANGE MESSAGE                       08330025
W36002* JUST WRITE THE SIZE DESC MSG TO OUTPUT FILE                             
      * ------------------------------------------------------------- * 08340025
       3100-PROCESS-SIZE-DESC-CHG.                                      08350025
                                                                        08360025
           MOVE '3100-PROCESS-SIZE-DESC-CHG' TO  PV-PARAGRAPH.          08370025
                                                                        08380025
           ADD 1 TO PA-SIZE-DESC-CHG-MSGS.                              08390025
W36602     WRITE SIZE-DESC-OUT-RECORD FROM IMRD018-RECORD.                      
W36002     ADD 1 TO PA-SIZE-DESC-CHGS-OUT.                                      
W36002*    MOVE IM018-SIZE-DESC-CHG-SIZE-CDE TO UPC-KOHLS-SIZE-CDE.     08410056
W36002*    SET PS-ROW-FOUND TO TRUE.                                            
W36002*    PERFORM 6000-OPEN-SZ-DESC-CHGS-CURSOR.                               
      *    PROCESS EACH TUPC ROW CONTAINING THE INPUT KOHLS SIZE CODE           
W36002*    PERFORM 6010-FETCH-SZ-DESC-CHGS-CURSOR                               
W36002*      UNTIL PS-ROW-NOT-FOUND.                                            
W36002*    PERFORM 6020-CLOSE-SZ-DESC-CHGS-CURSOR.                              
                                                                                
      * ------------------------------------------------------------- * 08320025
      *  FORMAT AND WRITE A SKU COLOR/SIZE ATTRIBUTES CHANGE BUSINESS           
      *  EVENT                                                                  
      * ------------------------------------------------------------- * 08320025
W36002*3110-CREATE-SKU-CLR-SZ-CHG.                                              
                                                                                
W36002*    SET IM008-BUS-EVENT-SKU-CLR-SZ-CHG TO TRUE.                          
W36002*    MOVE SPACES TO IM008-CRE-TMST.                                       
                                                                                
W36002*    FILL IN THE ITEM KEY DATA FIELDS                                     
W36002*    INITIALIZE IM008-ITEM-KEY-DATA.                                      
W36002*    MOVE UPC-VS-ID           TO IM008-ITEM-KEY-VS-ID.                    
W36002*    MOVE VNDSTL-ENT-ID       TO IM008-ITEM-KEY-ENT-ID.                   
W36002*    MOVE EXTENT-DUN-NBR      TO IM008-ITEM-KEY-DUN-NBR.                  
W36002*    MOVE VNDSTL-VS-NBR       TO IM008-ITEM-KEY-VS-NBR.                   
W36002*    MOVE UPC-SUB-CL-MDSEAR-ID                                            
W36002*                             TO IM008-ITEM-KEY-SUBCL-MDSE-ID.            
W36002*    MOVE MDARVS-DEPT-NBR     TO IM008-ITEM-KEY-DEPT.                     
W36002*    MOVE MDARVS-MAJ-CL-NBR   TO IM008-ITEM-KEY-CLASS.                    
W36002*    MOVE MDARVS-SUB-CL-NBR   TO IM008-ITEM-KEY-SUBCL.                    
W36002*    MOVE MDARVS-RMS-STYL-ID  TO IM008-ITEM-KEY-RMS-STYL-ID.              
W36002*    MOVE SKXREF-SKU          TO IM008-ITEM-KEY-SKU.                      
W36002*    MOVE UPC-INTR-UPC-ID     TO PV-UPC-ID-DOUBLE.                        
W36002*    MOVE PV-UPC-ID-DOUBLE    TO IM008-ITEM-KEY-INTR-UPC-ID               
W36002*    MOVE UPC-UPC-ID          TO PV-UPC-ID-DOUBLE.                        
W36002*    MOVE PV-UPC-ID-DOUBLE    TO IM008-ITEM-KEY-UPC-ID.                   
W36002*    MOVE UPC-UPC-NBR         TO IM008-ITEM-KEY-UPC-NBR.                  
W36002*    MOVE PC-ORIGIN-CNTRY     TO IM008-ITEM-KEY-ORIGIN-CNTRY.             
                                                                                
      *    GET TCOLOR INFO FOR SKU NRF AND SHORT COLOR DESCRIPTION DATA         
W36002*    PERFORM 6300-GET-COLOR-INFO.                                         
                                                                                
      *    FILL IN THE SKU COLOR/SIZE ATTRIBUTES CHANGE DATA                    
W36002*    INITIALIZE IM008-SKU-CLR-SZ-CHG-DATA.                                
W36002*    MOVE IM018-SIZE-DESC-CHG-SIZE-CDE                                    
W36002*                             TO IM008-SKU-CLR-KOHLS-SIZE-CDE-N.          
W36002*    SET IM008-SKU-CLR-KOHLS-SIZE-NOC TO TRUE.                            
W36002*    MOVE UPC-NRF-CLOR-CDE    TO IM008-SKU-CLR-NRF-CLOR-CDE-N.            
W36002*    SET IM008-SKU-CLR-NRF-CLOR-CDE-NOC TO TRUE.                          
W36002*    MOVE UPC-CSTM-CLOR-DESC  TO IM008-SKU-CLR-CSTM-CLOR-DESC-N.          
W36002*    SET IM008-SKU-CLR-CSTM-CLOR-NOC TO TRUE.                             
W36002*    MOVE UPC-CUSTFACG-CLOR-DESC                                          
W36002*                             TO IM008-SKU-CLR-CUSTFACG-CLOR-N.           
W36002*    SET IM008-SKU-CLR-CUSTFACG-CLR-NOC TO TRUE.                          
W36002*    MOVE UPC-INTR-UPC-DESC   TO IM008-SKU-CLR-SKU-DESC-SUP.              
W36002*    MOVE IM018-SIZE-DESC-CHG-KOHLS-DESC                                  
W36002*                             TO IM008-SKU-CLR-SIZE-DESC-NEW.             
W36002*    SET IM008-SKU-CLR-SIZE-DESC-CHG TO TRUE.                             
W36002*    MOVE COLOR-SHRT-CLOR-DESC                                            
W36002*                             TO IM008-SKU-CLR-SHRT-CLOR-DESC-N.          
W36002*    SET IM008-SKU-CLR-SHRT-CLR-DSC-NOC TO TRUE.                          
W36002*    MOVE COLOR-NRF-CLOR-DESC TO IM008-SKU-CLR-NRF-CLOR-DESC-N.           
W36002*    SET IM008-SKU-CLR-NRF-CLOR-DSC-NOC TO TRUE.                          
W36002*    MOVE LOW-VALUES          TO IM008-SKU-CLR-FILLER.                    
                                                                                
      *    INSERT SKU COLOR/SIZE ATTRIBUTES CHANGE RECORD TO THE ITEM           
      *    EVENT MESSAGE BRIDGE DB2 TABLE.                                      
W36002*    COMPUTE IMT00001-MSG-TXT-LEN =                                       
W36002*       LENGTH OF IMRD008-RECORD -                                        
W36002*       LENGTH OF IM008-SKU-CLR-FILLER.                                   
W36002*    PERFORM 7000-INSERT-IMT-EVNT-MSG.                                    
                                                                        09040025
      * ------------------------------------------------------------- * 08320025
      *  FORMAT AND WRITE A UPC COLOR/SIZE ATTRIBUTES CHANGE BUSINESS           
      *  EVENT                                                                  
      * ------------------------------------------------------------- * 08320025
W36002*3120-CREATE-UPC-CLR-SZ-CHG.                                              
                                                                                
W36002*    SET IM008-BUS-EVENT-UPC-CLR-SZ-CHG TO TRUE.                          
W36002*    MOVE SPACES TO IM008-CRE-TMST.                                       
                                                                                
      *    FILL IN THE ITEM KEY DATA FIELDS                                     
W36002*    INITIALIZE IM008-ITEM-KEY-DATA.                                      
W36002*    MOVE UPC-VS-ID           TO IM008-ITEM-KEY-VS-ID.                    
W36002*    MOVE VNDSTL-ENT-ID       TO IM008-ITEM-KEY-ENT-ID.                   
W36002*    MOVE EXTENT-DUN-NBR      TO IM008-ITEM-KEY-DUN-NBR.                  
W36002*    MOVE VNDSTL-VS-NBR       TO IM008-ITEM-KEY-VS-NBR.                   
W36002*    MOVE UPC-SUB-CL-MDSEAR-ID                                            
W36002*                             TO IM008-ITEM-KEY-SUBCL-MDSE-ID.            
W36002*    MOVE MDARVS-DEPT-NBR     TO IM008-ITEM-KEY-DEPT.                     
W36002*    MOVE MDARVS-MAJ-CL-NBR   TO IM008-ITEM-KEY-CLASS.                    
W36002*    MOVE MDARVS-SUB-CL-NBR   TO IM008-ITEM-KEY-SUBCL.                    
W36002*    MOVE MDARVS-RMS-STYL-ID  TO IM008-ITEM-KEY-RMS-STYL-ID.              
W36002*    MOVE SKXREF-SKU          TO IM008-ITEM-KEY-SKU.                      
W36002*    MOVE UPC-INTR-UPC-ID     TO PV-UPC-ID-DOUBLE.                        
W36002*    MOVE PV-UPC-ID-DOUBLE    TO IM008-ITEM-KEY-INTR-UPC-ID               
W36002*    MOVE UPC-UPC-ID          TO PV-UPC-ID-DOUBLE.                        
W36002*    MOVE PV-UPC-ID-DOUBLE    TO IM008-ITEM-KEY-UPC-ID.                   
W36002*    MOVE UPC-UPC-NBR         TO IM008-ITEM-KEY-UPC-NBR.                  
W36002*    MOVE PC-ORIGIN-CNTRY     TO IM008-ITEM-KEY-ORIGIN-CNTRY.             
                                                                                
      *    GET TCOLOR INFO FOR UPC NRF AND SHORT COLOR DESCRIPTION DATA         
W36002*    PERFORM 6300-GET-COLOR-INFO.                                         
                                                                                
      *    FILL IN THE UPC COLOR/SIZE ATTRIBUTES CHANGE DATA                    
W36002*    INITIALIZE IM008-UPC-CLR-SZ-CHG-DATA.                                
W36002*    MOVE IM018-SIZE-DESC-CHG-SIZE-CDE                                    
W36002*                             TO IM008-UPC-CLR-KOHLS-SIZE-CDE-N.          
W36002*    SET IM008-UPC-CLR-KOHLS-SIZE-NOC TO TRUE.                            
W36002*    MOVE UPC-NRF-CLOR-CDE    TO IM008-UPC-CLR-NRF-CLOR-CDE-N.            
W36002*    SET IM008-UPC-CLR-NRF-CLOR-CDE-NOC TO TRUE.                          
W36002*    MOVE UPC-CSTM-CLOR-DESC  TO IM008-UPC-CLR-CSTM-CLOR-DESC-N.          
W36002*    SET IM008-UPC-CLR-CSTM-CLOR-NOC TO TRUE.                             
W36002*    MOVE IM018-SIZE-DESC-CHG-KOHLS-DESC                                  
W36002*                             TO IM008-UPC-CLR-SIZE-DESC-NEW.             
W36002*    SET IM008-UPC-CLR-SIZE-DESC-CHG TO TRUE.                             
W36002*    MOVE COLOR-SHRT-CLOR-DESC                                            
W36002*                             TO IM008-UPC-CLR-SHRT-CLOR-DESC-N.          
W36002*    SET IM008-UPC-CLR-SHRT-CLR-DSC-NOC TO TRUE.                          
W36002*    MOVE COLOR-NRF-CLOR-DESC TO IM008-UPC-CLR-NRF-CLOR-DESC-N.           
W36002*    SET IM008-UPC-CLR-NRF-CLOR-DSC-NOC TO TRUE.                          
W36002*    MOVE LOW-VALUES          TO IM008-UPC-CLR-FILLER.                    
                                                                                
      *    INSERT UPC COLOR/SIZE ATTRIBUTES CHANGE RECORD TO THE ITEM           
      *    EVENT MESSAGE BRIDGE DB2 TABLE.                                      
W36002*    COMPUTE IMT00001-MSG-TXT-LEN =                                       
W36002*       LENGTH OF IMRD008-RECORD -                                        
W36002*       LENGTH OF IM008-UPC-CLR-FILLER.                                   
W36002*    PERFORM 7000-INSERT-IMT-EVNT-MSG.                                    
                                                                        09040025
      * ------------------------------------------------------------- * 08320025
      * PROCESS A TICKET TYPE DESCRIPTION CHANGE MESSAGE                08330025
      * ------------------------------------------------------------- * 08340025
       3200-PROCESS-TKT-TYP-DESC-CHG.                                   08350025
                                                                        08360025
           MOVE '3200-PROCESS-TKT-TYP-DESC-CHG' TO  PV-PARAGRAPH.       08370025
                                                                        08380025
           ADD 1 TO PA-TKT-TYP-DESC-CHG-MSGS.                           08390025
                                                                        08410056
           MOVE IM018-TKT-TYP-DESC-CHG-SEQ-NBR                          08410056
                                             TO MDARVS-TKT-TYP-SEQ-NBR. 08410056
           SET PS-ROW-FOUND TO TRUE.                                            
           PERFORM 6100-OPEN-TKT-TYP-DSC-CHGS-CSR.                              
      *    PROCESS EACH TMDARVS ROW CONTAINING THE INPUT TICKET TYPE            
           PERFORM 6110-FETCH-TKT-TYP-D-CHGS-CSR                                
             UNTIL PS-ROW-NOT-FOUND.                                            
           PERFORM 6120-CLOSE-TKT-TYP-D-CHGS-CSR.                               
                                                                                
      * ------------------------------------------------------------- * 08320025
      *  FORMAT AND WRITE A STYLE ATTRIBUTES CHANGE BUSINESS EVENT              
      * ------------------------------------------------------------- * 08320025
       3210-CREATE-STYLE-ATTR-CHG.                                              
                                                                                
           SET IM008-BUS-EVENT-STYLE-ATTR-CHG TO TRUE.                          
           MOVE SPACES TO IM008-CRE-TMST.                                       
                                                                                
      *    FILL IN THE ITEM KEY DATA FIELDS                                     
           INITIALIZE IM008-ITEM-KEY-DATA.                                      
           MOVE MDARVS-VS-ID        TO IM008-ITEM-KEY-VS-ID.                    
           MOVE VNDSTL-ENT-ID       TO IM008-ITEM-KEY-ENT-ID.                   
           MOVE EXTENT-DUN-NBR      TO IM008-ITEM-KEY-DUN-NBR.                  
           MOVE VNDSTL-VS-NBR       TO IM008-ITEM-KEY-VS-NBR.                   
           MOVE MDARVS-SUB-CL-MDSEAR-ID                                         
                                    TO IM008-ITEM-KEY-SUBCL-MDSE-ID.            
           MOVE MDARVS-DEPT-NBR     TO IM008-ITEM-KEY-DEPT.                     
           MOVE MDARVS-MAJ-CL-NBR   TO IM008-ITEM-KEY-CLASS.                    
           MOVE MDARVS-SUB-CL-NBR   TO IM008-ITEM-KEY-SUBCL.                    
           MOVE MDARVS-RMS-STYL-ID  TO IM008-ITEM-KEY-RMS-STYL-ID.              
           MOVE PC-ORIGIN-CNTRY     TO IM008-ITEM-KEY-ORIGIN-CNTRY.             
                                                                                
      *    FILL IN THE STYLE ATTRIBUTES CHANGE DATA                             
           INITIALIZE IM008-STYLE-ATTR-CHG-DATA.                                
           SET IM008-STYL-ATTR-STKR-NBR-NOCHG TO TRUE.                          
           MOVE MDARVS-STKR-NBR         TO IM008-STYL-ATTR-STKR-NBR.            
           SET IM008-STYL-ATTR-VS-DESC-NOCHG  TO TRUE.                          
           MOVE MDARVS-VS-DESC          TO IM008-STYL-ATTR-VS-DESC.             
           SET IM008-STYL-ATTR-TKT-TYP-NOCHG  TO TRUE.                          
           MOVE MDARVS-TKT-TYP-SEQ-NBR                                          
                                        TO IM008-STYL-ATTR-TKT-TYP.             
           SET IM008-STYL-ATTR-LBL-NOCHG      TO TRUE.                          
           MOVE MDARVS-LBL-SEQ-NBR      TO IM008-STYL-ATTR-LBL.                 
           SET IM008-STYL-ATTR-HNG-FOLD-NOCHG TO TRUE.                          
           MOVE MDARVS-HNG-FOLD-SEQ-NBR TO IM008-STYL-ATTR-HNG-FOLD.            
           SET IM008-STYL-ATTR-KY-CLSN-NOCHG  TO TRUE.                          
           MOVE MDARVS-KY-CLSN-SEQ-NBR  TO IM008-STYL-ATTR-KY-CLSN.             
           SET IM008-STYL-ATTR-CLLCTN-NOCHG   TO TRUE.                          
           MOVE MDARVS-CLLCTN-SEQ-NBR   TO IM008-STYL-ATTR-CLLCTN.              
           SET IM008-STYL-ATTR-FNSH-NOCHG     TO TRUE.                          
           MOVE MDARVS-FNSH-SEQ-NBR     TO IM008-STYL-ATTR-FNSH.                
           SET IM008-STYL-ATTR-RTL-CLSN-NOCHG TO TRUE.                          
           MOVE MDARVS-RTL-CLSN-SEQ-NBR TO IM008-STYL-ATTR-RTL-CLSN.            
           IF IM018-BUS-EVENT-TKT-TYP-DE-CHG                            07230025
               SET IM008-STYL-ATTR-TKT-DSC-CHG    TO TRUE                       
               MOVE IM018-TKT-TYP-DESC-CHG-DESC                                 
                                        TO IM008-STYL-ATTR-TKT-TYP-DESC         
           ELSE                                                                 
               SET IM008-STYL-ATTR-TKT-DSC-NOCHG  TO TRUE                       
               MOVE PC-TKT-CHARTC-CDE                                           
                                    TO VSCHVL-CHARTC-CDE                        
               MOVE MDARVS-TKT-TYP-SEQ-NBR                                      
                                    TO VSCHVL-CHARTC-SEQ-NBR                    
               PERFORM 6200-GET-TVSCHVL-DESC                                    
               MOVE VSCHVL-CHARTC-VAL-DESC                                      
                                        TO IM008-STYL-ATTR-TKT-TYP-DESC         
           END-IF.                                                              
           SET IM008-STYL-ATTR-LBL-DESC-NOCHG TO TRUE.                          
           MOVE MDARVS-MAP-UNT-RTL-AMT  TO IM008-STYL-ATTR-MAP-UNT-RTL.         
           SET IM008-STYL-ATTR-MAP-RTL-NOCHG TO TRUE.                           
           IF MDARVS-LBL-SEQ-NBR = ZERO                                         
               MOVE SPACES          TO IM008-STYL-ATTR-LBL-DESC                 
           ELSE                                                                 
               MOVE PC-LBL-CHARTC-CDE                                           
                                    TO VSCHVL-CHARTC-CDE                        
               MOVE MDARVS-LBL-SEQ-NBR                                          
                                    TO VSCHVL-CHARTC-SEQ-NBR                    
               PERFORM 6200-GET-TVSCHVL-DESC                                    
               MOVE VSCHVL-CHARTC-VAL-DESC                                      
                                    TO IM008-STYL-ATTR-LBL-DESC                 
           END-IF.                                                              
           SET IM008-STYL-ATTR-HNG-DSC-NOCHG  TO TRUE.                          
           IF MDARVS-HNG-FOLD-SEQ-NBR = ZERO                                    
               MOVE SPACES          TO IM008-STYL-ATTR-HNG-FOLD-DESC            
           ELSE                                                                 
               MOVE PC-HNG-FLD-CHARTC-CDE                                       
                                    TO VSCHVL-CHARTC-CDE                        
               MOVE MDARVS-HNG-FOLD-SEQ-NBR                                     
                                    TO VSCHVL-CHARTC-SEQ-NBR                    
               PERFORM 6200-GET-TVSCHVL-DESC                                    
               MOVE VSCHVL-CHARTC-VAL-DESC                                      
                                    TO IM008-STYL-ATTR-HNG-FOLD-DESC            
           END-IF.                                                              
           SET IM008-STYL-ATTR-RTL-CL-DSC-NOC TO TRUE.                          
           IF MDARVS-RTL-CLSN-SEQ-NBR = ZERO                                    
               MOVE SPACES          TO IM008-STYL-ATTR-RTL-CLSN-DESC            
           ELSE                                                                 
               MOVE PC-RTL-CLSN-CHARTC-CDE                                      
                                    TO VSCHVL-CHARTC-CDE                        
               MOVE MDARVS-RTL-CLSN-SEQ-NBR                                     
                                    TO VSCHVL-CHARTC-SEQ-NBR                    
               PERFORM 6200-GET-TVSCHVL-DESC                                    
               MOVE VSCHVL-CHARTC-VAL-DESC                                      
                                    TO IM008-STYL-ATTR-RTL-CLSN-DESC            
           END-IF.                                                              
           SET IM008-STYL-ATTR-KY-CLS-DSC-NOC TO TRUE.                          
           IF IM008-STYL-ATTR-KY-CLSN = ZERO                                    
               MOVE SPACES          TO IM008-STYL-ATTR-KY-CLSN-DESC             
           ELSE                                                                 
               MOVE PC-KY-CLSN-CHARTC-CDE                                       
                                    TO VSCHVL-CHARTC-CDE                        
               MOVE IM008-STYL-ATTR-KY-CLSN                                     
                                    TO VSCHVL-CHARTC-SEQ-NBR                    
               PERFORM 6200-GET-TVSCHVL-DESC                                    
               MOVE VSCHVL-CHARTC-VAL-DESC                                      
                                    TO IM008-STYL-ATTR-KY-CLSN-DESC             
           END-IF.                                                              
           SET IM008-STYL-ATTR-CLLCTN-DSC-NOC TO TRUE.                          
           IF IM008-STYL-ATTR-CLLCTN = ZERO                                     
               MOVE SPACES          TO IM008-STYL-ATTR-CLLCTN-DESC              
           ELSE                                                                 
               MOVE PC-CLLCTN-CHARTC-CDE                                        
                                    TO VSCHVL-CHARTC-CDE                        
               MOVE IM008-STYL-ATTR-CLLCTN                                      
                                    TO VSCHVL-CHARTC-SEQ-NBR                    
               PERFORM 6200-GET-TVSCHVL-DESC                                    
               MOVE VSCHVL-CHARTC-VAL-DESC                                      
                                    TO IM008-STYL-ATTR-CLLCTN-DESC              
           END-IF.                                                              
           SET IM008-STYL-ATTR-FNSH-DSC-NOC TO TRUE.                            
           IF IM008-STYL-ATTR-FNSH = ZERO                                       
               MOVE SPACES          TO IM008-STYL-ATTR-FNSH-DESC                
           ELSE                                                                 
               MOVE PC-FNSH-CHARTC-CDE                                          
                                    TO VSCHVL-CHARTC-CDE                        
               MOVE IM008-STYL-ATTR-FNSH                                        
                                    TO VSCHVL-CHARTC-SEQ-NBR                    
               PERFORM 6200-GET-TVSCHVL-DESC                                    
               MOVE VSCHVL-CHARTC-VAL-DESC                                      
                                    TO IM008-STYL-ATTR-FNSH-DESC                
           END-IF.                                                              
           MOVE MDARVS-LBL-SEQ-NBR  TO IM008-STYL-ATTR-OLD-LBL.                 
           IF IM018-BUS-EVENT-LBL-TYP-CD-CHG                            07230025
               SET IM008-STYL-ATTR-LBL-TYP-CHG   TO TRUE                        
               MOVE IM018-LBL-TYP-CDE-CHG-CDE TO                                
                                    IM008-STYL-ATTR-LBL-TYP-CDE                 
           ELSE                                                                 
               SET IM008-STYL-ATTR-LBL-TYP-NOCHG TO TRUE                        
               PERFORM 6450-GET-LBL-TYP-CDE                                     
               MOVE IMT00000-LBL-TYP-CDE TO                             08410056
                                    IM008-STYL-ATTR-LBL-TYP-CDE                 
           END-IF.                                                              
           MOVE LOW-VALUES          TO IM008-STYL-ATTR-FILLER.                  
                                                                                
      *    INSERT STYLE ATTRIBUTES CHANGE RECORD TO THE ITEM EVENT              
      *    MESSAGE BRIDGE DB2 TABLE.                                            
           COMPUTE IMT00001-MSG-TXT-LEN =                                       
              LENGTH OF IMRD008-RECORD -                                        
              LENGTH OF IM008-STYL-ATTR-FILLER.                                 
           PERFORM 7000-INSERT-IMT-EVNT-MSG.                                    
                                                                                
      * ------------------------------------------------------------- * 43390025
      *   PROCESS LABEL TYPE CODE CHANGE                                43400025
      * ------------------------------------------------------------- * 43410025
       3300-PROCESS-LBL-TYP-CD-CHG.                                     07240025
           MOVE '3300-PROCESS-LBL-TYP-CD-CHG' TO  PV-PARAGRAPH.         08370025
                                                                        08380025
           ADD 1 TO PA-LBL-TYP-CDE-CHG-MSGS.                            08390025
                                                                        08410056
           MOVE IM018-LBL-TYP-CDE-CHG-SEQ-NBR                           08410056
                                             TO MDARVS-LBL-SEQ-NBR.     08410056
           SET PS-ROW-FOUND TO TRUE.                                            
                                                                                
           PERFORM 6400-OPEN-LBL-TYP-CDE-CSR.                                   
      *    PROCESS EACH TMDARVS ROW CONTAINING THE INPUT LABEL                  
      *        SEQ NUMBER TO CREATE STYLE ATTR CHANGE MESSAGES                  
      *        FOR EACH ACTIVE STYLE FOR THIS BRAND/LABEL                       
           PERFORM 6410-FETCH-LBL-TYP-CDE-CSR                                   
             UNTIL PS-ROW-NOT-FOUND.                                            
           PERFORM 6420-CLOSE-LBL-TYP-CDE-CSR.                                  
                                                                                
      * ------------------------------------------------------------- * 43390025
      *   PROCESS LABEL TYPE CODE CHANGE                                43400025
      * ------------------------------------------------------------- * 43410025
       3400-PROCESS-LBL-PT-LS-CHG.                                      07240025
           MOVE '3400-PROCESS-LBL-PT-LS-CHG' TO  PV-PARAGRAPH.          08370025
                                                                        08380025
           ADD 1 TO PA-LBL-PT-LS-CHG-MSGS.                              08390025
                                                                        08410056
           MOVE IM018-LBL-PT-LS-CHG-LBL-SEQ-NR                          08410056
                                           TO MDARVS-LBL-SEQ-NBR.               
           MOVE IM018-LBL-PT-LS-CHG-P-TIER-SEQ                          08410056
                                           TO MDARVS-PRIC-TIER-SEQ-NBR. 08410056
           MOVE IM018-LBL-PT-LS-CHG-LFSTYL-SEQ                          08410056
                                           TO MDARVS-LFSTYL-SEQ-NBR.    08410056
           SET PS-ROW-FOUND TO TRUE.                                            
                                                                                
           PERFORM 7100-GET-COMMIT-TIMESTAMP.                                   
                                                                                
           PERFORM 6500-OPEN-LBL-PT-LS-CSR.                                     
      *    PROCESS EACH TMDARVS ROW CONTAINING THE INPUT LABEL                  
      *        SEQ NUMBER TO UPDATE PRICE TIER AND LIFESTYLE                    
      *        FOR EACH ACTIVE STYLE FOR THIS BRAND/LABEL                       
           PERFORM 6510-FETCH-LBL-PT-LS-CSR                                     
             UNTIL PS-ROW-NOT-FOUND.                                            
           PERFORM 6520-CLOSE-LBL-PT-LS-CSR.                                    
                                                                        08410056
      * ------------------------------------------------------------- * 08320025
      *  CHECK IF WE NEED TO TAKE A COMMIT AND COMMIT THIS UNIT OF WORK.        
      * ------------------------------------------------------------- * 08320025
       4000-COMMIT-PROCESSING.                                                  
                                                                                
           PERFORM 7200-SET-CURRENT-TIMESTAMP.                                  
           IF PV-CURRENT-TIMESTAMP > PV-COMMIT-TIMESTAMP                        
               PERFORM 8400-COMMIT-DB2                                          
               PERFORM 7100-GET-COMMIT-TIMESTAMP                                
           END-IF.                                                              
                                                                                
W36002* ------------------------------------------------------------- * 43390025
W36002* OPEN THE SIZE DESCRIPTION CHANGES CURSOR                        43400025
W36002* ------------------------------------------------------------- * 43410025
W36002*6000-OPEN-SZ-DESC-CHGS-CURSOR.                                   43420025
      *                                                                 43430025
W36002*    MOVE '6000-OPEN-SZ-DESC-CHGS-CURSOR' TO PV-PARAGRAPH.        43440025
      *                                                                 43450025
W36002*    PERFORM                                                      43460025
W36002*        WITH TEST AFTER                                          43470025
W36002*        VARYING PV-SQL-SUB                                       43480025
W36002*        FROM 1 BY 1                                              43490025
W36002*        UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        43500025
W36002*           OR SQLCODE = ZERO                                     43510025
      *                                                                 43530025
W36002*          EXEC SQL                                               43540025
W36002*              OPEN SIZE_DESC_CHGS_CSR                            43550025
W36002*          END-EXEC                                               43560025
      *                                                                 43570025
W36002*        EVALUATE TRUE                                            43580025
W36002*            WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              43590025
W36002*            WHEN SQLCODE = PC-DEADLOCK                           43600025
W36002*            WHEN SQLCODE = ZERO                                  43610025
W36002*                 CONTINUE                                        43620025
W36002*            WHEN SQLWARN0 NOT = SPACE                            43630025
W36002*            WHEN SQLCODE NOT = ZERO                              43640025
W36002*                MOVE 'BAD SQLCODE FOR OPEN SIZE_DESC_CHGS_CSR'   43650025
W36002*                              TO  PV-MESSAGE                     43660025
W36002*                MOVE IMRD018-RECORD TO PV-INPUT-RECORD           43670044
W36002*                PERFORM 9900-SQL-ABEND                           43680025
W36002*        END-EVALUATE                                             43700025
W36002*    END-PERFORM.                                                 43710025
      *                                                                 43720025
W36002*    IF PV-SQL-SUB > PC-MAX-RETRIES                               43730025
W36002*        MOVE 'MAX RETRIES EXCEEDED FOR OPEN SIZE_DESC_CHGS_CSR'  43740025
W36002*                              TO  PV-MESSAGE                     43750025
W36002*        MOVE IMRD018-RECORD TO PV-INPUT-RECORD                   43760044
W36002*        PERFORM 9900-SQL-ABEND                                   43770025
W36002*    END-IF.                                                      43790025
                                                                        43800025
W36002* ------------------------------------------------------------- * 43810025
W36002* FETCH A ROW FROM THE SIZE DESCRIPTION CHANGES CURSOR            43820025
W36002* ------------------------------------------------------------- * 43830025
W36002*6010-FETCH-SZ-DESC-CHGS-CURSOR.                                  43840025
                                                                        43850025
W36002*    MOVE '6010-FETCH-SZ-DESC-CHGS-CURSOR' TO PV-PARAGRAPH.       43860025
                                                                        43870025
W36002*    PERFORM                                                      43880025
W36002*        WITH TEST AFTER                                          43890025
W36002*        VARYING PV-SQL-SUB                                       43900025
W36002*        FROM 1 BY 1                                              43910025
W36002*        UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        43920025
W36002*           OR SQLCODE = ZERO                                     43930025
W36002*           OR SQLCODE = PC-ROW-NOT-FOUND                         43940025
                                                                        43960025
W36002*          EXEC SQL                                               43970025
W36002*              FETCH  SIZE_DESC_CHGS_CSR                          43980025
W36002*              INTO  :UPC-UPC-ID                                  43990025
W36002*                   ,:UPC-UPC-NBR                                 44000025
W36002*                   ,:UPC-SUB-CL-MDSEAR-ID                        44010025
W36002*                   ,:UPC-VS-ID                                   44020025
W36002*                   ,:UPC-INTR-UPC-ID                             44020025
W36002*                   ,:UPC-UPC-TYP-CDE                             44020025
W36002*                   ,:UPC-NRF-CLOR-CDE                            44020025
W36002*                   ,:UPC-CSTM-CLOR-DESC                          44020025
W36002*                   ,:UPC-CUSTFACG-CLOR-DESC                      44020025
W36002*                   ,:UPC-INTR-UPC-DESC                           44020025
W36002*                   ,:MDARVS-DEPT-NBR                             44020025
W36002*                   ,:MDARVS-MAJ-CL-NBR                           44020025
W36002*                   ,:MDARVS-SUB-CL-NBR                           44020025
W36002*                   ,:MDARVS-RMS-STYL-ID                          44020025
W36002*                   ,:VNDSTL-VS-NBR                               44020025
W36002*                   ,:VNDSTL-ENT-ID                               44020025
W36002*                   ,:EXTENT-DUN-NBR                                      
W36002*                   ,:SKXREF-SKU                                          
W36002*          END-EXEC                                               44030025
      *                                                                 44040025
W36002*        EVALUATE TRUE                                            44050025
W36002*            WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              44060025
W36002*            WHEN SQLCODE = PC-DEADLOCK                           44070025
W36002*            WHEN SQLCODE = PC-ROW-NOT-FOUND                      44080025
W36002*                SET PS-ROW-NOT-FOUND TO TRUE                     44090025
W36002*            WHEN SQLCODE = ZERO                                  44100025
W36002*                 IF UPC-UPC-TYP-CDE = 'I'                        44110025
W36002*                     PERFORM 3110-CREATE-SKU-CLR-SZ-CHG          44110025
W36002*                 ELSE                                            44110025
W36002*                     PERFORM 3120-CREATE-UPC-CLR-SZ-CHG          44110025
W36002*                 END-IF                                          44110025
W36002*            WHEN SQLWARN0 NOT = SPACE                            44120025
W36002*            WHEN SQLCODE NOT = ZERO                              44130025
W36002*                MOVE 'BAD SQLCODE FOR FETCH SIZE_DESC_CHGS_CSR'  43650025
W36002*                              TO  PV-MESSAGE                     44150025
W36002*                MOVE IMRD018-RECORD TO PV-INPUT-RECORD           44160044
W36002*                PERFORM 9900-SQL-ABEND                           44170025
W36002*        END-EVALUATE                                             44190025
W36002*    END-PERFORM.                                                 44200025
      *                                                                 44210025
W36002*    IF PV-SQL-SUB > PC-MAX-RETRIES                               44220025
W36002*        MOVE 'MAX RETRIES EXCEEDED FOR FETCH SIZE_DESC_CHGS_CSR' 44230025
W36002*                              TO  PV-MESSAGE                     44240025
W36002*        MOVE IMRD018-RECORD TO PV-INPUT-RECORD                   44250044
W36002*        PERFORM 9900-SQL-ABEND                                   44260025
W36002*    END-IF.                                                      44280025
                                                                        44290025
W36002* ------------------------------------------------------------- * 44300025
W36002* CLOSE THE SIZE DESCRIPTION CHANGES CURSOR                       44310025
W36002* ------------------------------------------------------------- * 44320025
W36002 6020-CLOSE-SZ-DESC-CHGS-CURSOR.                                  44330025
      *                                                                 44340025
W36002*    MOVE '6020-CLOSE-SZ-DESC-CHGS-CURSOR' TO PV-PARAGRAPH.       44350025
      *                                                                 44360025
W36002*    PERFORM                                                      44370025
W36002*        WITH TEST AFTER                                          44380025
W36002*        VARYING PV-SQL-SUB                                       44390025
W36002*        FROM 1 BY 1                                              44400025
W36002*        UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        44410025
W36002*           OR SQLCODE = ZERO                                     44420025
      *                                                                 44440025
W36002*          EXEC SQL                                               44450025
W36002*              CLOSE SIZE_DESC_CHGS_CSR                           44460025
W36002*          END-EXEC                                               44470025
      *                                                                 44480025
W36002*        EVALUATE TRUE                                            44490025
W36002*            WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              44500025
W36002*            WHEN SQLCODE = PC-DEADLOCK                           44510025
W36002*            WHEN SQLCODE = ZERO                                  44520025
W36002*                 CONTINUE                                        44530025
W36002*            WHEN SQLWARN0 NOT = SPACE                            44540025
W36002*            WHEN SQLCODE NOT = ZERO                              44550025
W36002*                MOVE 'BAD SQLCODE FOR CLOSE SIZE_DESC_CHGS_CSR'  43650025
W36002*                              TO  PV-MESSAGE                     44570025
W36002*                MOVE IMRD018-RECORD TO PV-INPUT-RECORD           44580044
W36002*                PERFORM 9900-SQL-ABEND                           44590025
W36002*        END-EVALUATE                                             44610025
W36002*    END-PERFORM.                                                 44620025
      *                                                                 44630025
W36002*    IF PV-SQL-SUB > PC-MAX-RETRIES                               44640025
W36002*        MOVE 'MAX RETRIES EXCEEDED FOR CLOSE SIZE_DESC_CHGS_CSR' 44650025
W36002*                              TO  PV-MESSAGE                     44660025
W36002*        MOVE IMRD018-RECORD TO PV-INPUT-RECORD                   44670044
W36002*        PERFORM 9900-SQL-ABEND                                   44680025
W36002*    END-IF.                                                      44700025
                                                                        44710025
      * ------------------------------------------------------------- * 43390025
      * OPEN THE TICKET TYPE DESCRIPTION CHANGES CURSOR                 43400025
      * ------------------------------------------------------------- * 43410025
       6100-OPEN-TKT-TYP-DSC-CHGS-CSR.                                  43420025
      *                                                                 43430025
           MOVE '6100-OPEN-TKT-TYP-DSC-CHGS-CSR' TO PV-PARAGRAPH.       43440025
      *                                                                 43450025
           PERFORM                                                      43460025
               WITH TEST AFTER                                          43470025
               VARYING PV-SQL-SUB                                       43480025
               FROM 1 BY 1                                              43490025
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        43500025
                  OR SQLCODE = ZERO                                     43510025
      *                                                                 43530025
                 EXEC SQL                                               43540025
                     OPEN TKT_TYP_D_CHGS_CSR                            43550025
                 END-EXEC                                               43560025
      *                                                                 43570025
               EVALUATE TRUE                                            43580025
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              43590025
                   WHEN SQLCODE = PC-DEADLOCK                           43600025
                   WHEN SQLCODE = ZERO                                  43610025
                        CONTINUE                                        43620025
                   WHEN SQLWARN0 NOT = SPACE                            43630025
                   WHEN SQLCODE NOT = ZERO                              43640025
                       MOVE 'BAD SQLCODE FOR OPEN TKT_TYP_D_CHGS_CSR'   43650025
                                     TO  PV-MESSAGE                     43660025
                       MOVE IMRD018-RECORD TO PV-INPUT-RECORD           43670044
                       PERFORM 9900-SQL-ABEND                           43680025
               END-EVALUATE                                             43700025
           END-PERFORM.                                                 43710025
      *                                                                 43720025
           IF PV-SQL-SUB > PC-MAX-RETRIES                               43730025
               MOVE 'MAX RETRIES EXCEEDED FOR OPEN TKT_TYP_D_CHGS_CSR'  43740025
                                     TO  PV-MESSAGE                     43750025
               MOVE IMRD018-RECORD TO PV-INPUT-RECORD                   43760044
               PERFORM 9900-SQL-ABEND                                   43770025
           END-IF.                                                      43790025
                                                                        43800025
      * ------------------------------------------------------------- * 43810025
      * FETCH A ROW FROM THE TICKET TYPE DESCRIPTION CHANGES CURSOR     43820025
      * ------------------------------------------------------------- * 43830025
       6110-FETCH-TKT-TYP-D-CHGS-CSR.                                   43420025
                                                                        43850025
           MOVE '6110-FETCH-TKT-TYP-D-CHGS-CSR' TO PV-PARAGRAPH.        43860025
                                                                        43870025
           PERFORM                                                      43880025
               WITH TEST AFTER                                          43890025
               VARYING PV-SQL-SUB                                       43900025
               FROM 1 BY 1                                              43910025
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        43920025
                  OR SQLCODE = ZERO                                     43930025
                  OR SQLCODE = PC-ROW-NOT-FOUND                         43940025
                                                                        43960025
                 EXEC SQL                                               43970025
                     FETCH  TKT_TYP_D_CHGS_CSR                          43980025
                     INTO  :MDARVS-SUB-CL-MDSEAR-ID                     43990025
                          ,:MDARVS-VS-ID                                44000025
                          ,:MDARVS-VS-DESC                              44010025
                          ,:MDARVS-STKR-NBR                             44020025
                          ,:MDARVS-LBL-SEQ-NBR                          44020025
                          ,:MDARVS-HNG-FOLD-SEQ-NBR                     44020025
                          ,:MDARVS-KY-CLSN-SEQ-NBR                      44020025
                          ,:MDARVS-FNSH-SEQ-NBR                         44020025
                          ,:MDARVS-RMS-STYL-ID                          44020025
                          ,:MDARVS-RTL-CLSN-SEQ-NBR                     44020025
                          ,:MDARVS-DEPT-NBR                             44020025
                          ,:MDARVS-MAJ-CL-NBR                           44020025
                          ,:MDARVS-SUB-CL-NBR                           44020025
                          ,:MDARVS-CLLCTN-SEQ-NBR                       44020025
                          ,:MDARVS-MAP-UNT-RTL-AMT                      44020025
                          ,:VNDSTL-VS-NBR                               44020025
                          ,:VNDSTL-ENT-ID                               44020025
                          ,:EXTENT-DUN-NBR                                      
                 END-EXEC                                               44030025
      *                                                                 44040025
               EVALUATE TRUE                                            44050025
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              44060025
                   WHEN SQLCODE = PC-DEADLOCK                           44070025
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      44080025
                       SET PS-ROW-NOT-FOUND TO TRUE                     44090025
                   WHEN SQLCODE = ZERO                                  44100025
                        PERFORM 3210-CREATE-STYLE-ATTR-CHG              44110025
                   WHEN SQLWARN0 NOT = SPACE                            44120025
                   WHEN SQLCODE NOT = ZERO                              44130025
                       MOVE 'BAD SQLCODE FOR FETCH TKT_TYP_D_CHGS_CSR'  43650025
                                     TO  PV-MESSAGE                     44150025
                       MOVE IMRD018-RECORD TO PV-INPUT-RECORD           44160044
                       PERFORM 9900-SQL-ABEND                           44170025
               END-EVALUATE                                             44190025
           END-PERFORM.                                                 44200025
      *                                                                 44210025
           IF PV-SQL-SUB > PC-MAX-RETRIES                               44220025
               MOVE 'MAX RETRIES EXCEEDED FOR FETCH TKT_TYP_D_CHGS_CSR' 44230025
                                     TO  PV-MESSAGE                     44240025
               MOVE IMRD018-RECORD TO PV-INPUT-RECORD                   44250044
               PERFORM 9900-SQL-ABEND                                   44260025
           END-IF.                                                      44280025
                                                                        44290025
      * ------------------------------------------------------------- * 44300025
      * CLOSE THE TICKET TYPE DESCRIPTION CHANGES CURSOR                44310025
      * ------------------------------------------------------------- * 44320025
       6120-CLOSE-TKT-TYP-D-CHGS-CSR.                                   43420025
      *                                                                 44340025
           MOVE '6120-CLOSE-TKT-TYP-D-CHGS-CSR' TO PV-PARAGRAPH.        44350025
      *                                                                 44360025
           PERFORM                                                      44370025
               WITH TEST AFTER                                          44380025
               VARYING PV-SQL-SUB                                       44390025
               FROM 1 BY 1                                              44400025
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        44410025
                  OR SQLCODE = ZERO                                     44420025
      *                                                                 44440025
                 EXEC SQL                                               44450025
                     CLOSE TKT_TYP_D_CHGS_CSR                           44460025
                 END-EXEC                                               44470025
      *                                                                 44480025
               EVALUATE TRUE                                            44490025
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              44500025
                   WHEN SQLCODE = PC-DEADLOCK                           44510025
                   WHEN SQLCODE = ZERO                                  44520025
                        CONTINUE                                        44530025
                   WHEN SQLWARN0 NOT = SPACE                            44540025
                   WHEN SQLCODE NOT = ZERO                              44550025
                       MOVE 'BAD SQLCODE FOR CLOSE TKT_TYP_D_CHGS_CSR'  43650025
                                     TO  PV-MESSAGE                     44570025
                       MOVE IMRD018-RECORD TO PV-INPUT-RECORD           44580044
                       PERFORM 9900-SQL-ABEND                           44590025
               END-EVALUATE                                             44610025
           END-PERFORM.                                                 44620025
      *                                                                 44630025
           IF PV-SQL-SUB > PC-MAX-RETRIES                               44640025
               MOVE 'MAX RETRIES EXCEEDED FOR CLOSE TKT_TYP_D_CHGS_CSR' 44650025
                                     TO  PV-MESSAGE                     44660025
               MOVE IMRD018-RECORD TO PV-INPUT-RECORD                   44670044
               PERFORM 9900-SQL-ABEND                                   44680025
           END-IF.                                                      44700025
                                                                        44710025
      ******************************************************************        
      *  GET TMSDEAR INFO                                                       
      ******************************************************************        
       6200-GET-TVSCHVL-DESC.                                                   
                                                                                
           MOVE '6200-GET-TVSCHVL-DESC' TO PV-PARAGRAPH.                20600025
           MOVE 'SELECT ROW '           TO PV-ACTION.                   20610025
                                                                        20590025
           PERFORM                                                      20630025
               WITH TEST AFTER                                          20640025
               VARYING PV-SQL-SUB                                       20650025
               FROM 1 BY 1                                              20660025
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        20670025
                  OR SQLCODE = 0                                        20680025
                  OR SQLCODE = +100                                     20680025
      *                                                                 20710025
                 EXEC SQL                                               20720025
                     SELECT  CHARTC_VAL_DESC                                    
                       INTO :VSCHVL-CHARTC-VAL-DESC                             
                       FROM TVSCHVL                                             
                      WHERE CHARTC_CDE     = :VSCHVL-CHARTC-CDE                 
                        AND CHARTC_SEQ_NBR = :VSCHVL-CHARTC-SEQ-NBR             
                 END-EXEC                                               20800025
      *                                                                 20810025
               EVALUATE TRUE                                            20820025
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              20830025
                   WHEN SQLCODE = PC-DEADLOCK                           20840025
                   WHEN SQLCODE = ZERO                                  20870025
                       CONTINUE                                         20880025
                   WHEN SQLCODE = +100                                          
                       MOVE VSCHVL-CHARTC-CDE                              CL*11
                                      TO PV-TVSCHVL-NFM-CHARTC-CDE         CL**1
                       MOVE VSCHVL-CHARTC-SEQ-NBR                          CL*11
                                      TO PV-TVSCHVL-NFM-SEQ-NBR            CL**1
                       MOVE PV-TVSCHVL-NOT-FOUND-MSG TO PV-MESSAGE              
                       MOVE IMRD008-RECORD TO PV-INPUT-RECORD           20930044
                       PERFORM 9900-SQL-ABEND                           20940025
                   WHEN SQLWARN0 NOT = SPACE                            20890025
                   WHEN SQLCODE NOT =  ZERO                             20900025
                       MOVE 'BAD SQLCODE FOR TVSCHVL SELECT'            20910025
                                     TO  PV-MESSAGE                     20920025
                       MOVE IMRD008-RECORD TO PV-INPUT-RECORD           20930044
                       PERFORM 9900-SQL-ABEND                           20940025
               END-EVALUATE                                             20960025
           END-PERFORM.                                                 20970025
      *                                                                 20980025
           IF PV-SQL-SUB > PC-MAX-RETRIES                               20990025
               MOVE  'MAX RETRIES EXCEEDED FOR TVSCHVL SELECT'          21000025
                      TO PV-MESSAGE                                     21010025
               MOVE IMRD008-RECORD TO PV-INPUT-RECORD                   21020044
               PERFORM 9900-SQL-ABEND                                   21030025
           END-IF.                                                      21040025
                                                                                
W36002******************************************************************        
W36002*  GET TCOLOR INFO                                                        
W36002******************************************************************        
W36002*6300-GET-COLOR-INFO.                                                     
                                                                                
W36002*    MOVE '6300-GET-COLOR-INFO'   TO PV-PARAGRAPH.                20600025
W36002*    MOVE 'SELECT ROW '           TO PV-ACTION.                   20610025
                                                                        20590025
W36002*    PERFORM                                                      20630025
W36002*        WITH TEST AFTER                                          20640025
W36002*        VARYING PV-SQL-SUB                                       20650025
W36002*        FROM 1 BY 1                                              20660025
W36002*        UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        20670025
W36002*           OR SQLCODE = 0                                        20680025
W36002*           OR SQLCODE = +100                                     20680025
      *                                                                 20710025
W36002*          EXEC SQL                                               20720025
W36002*              SELECT  NRF_CLOR_DESC                                      
W36002*                     ,SHRT_CLOR_DESC                                     
W36002*                INTO :COLOR-NRF-CLOR-DESC                                
W36002*                    ,:COLOR-SHRT-CLOR-DESC                               
W36002*                FROM TCOLOR                                              
W36002*               WHERE NRF_CLOR_CDE = :UPC-NRF-CLOR-CDE                    
W36002*          END-EXEC                                               20800025
      *                                                                 20810025
W36002*        EVALUATE TRUE                                            20820025
W36002*            WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              20830025
W36002*            WHEN SQLCODE = PC-DEADLOCK                           20840025
W36002*            WHEN SQLCODE = ZERO                                  20870025
W36002*                CONTINUE                                         20880025
W36002*            WHEN SQLCODE = +100                                          
W36002*                MOVE UPC-NRF-CLOR-CDE                               CL*11
W36002*                               TO PV-TCOLOR-NFM-NRF-CLOR-CDE        CL**1
W36002*                MOVE PV-TCOLOR-NOT-FOUND-MSG TO PV-MESSAGE               
W36002*                MOVE IMRD008-RECORD TO PV-INPUT-RECORD           20930044
W36002*                PERFORM 9900-SQL-ABEND                           20940025
W36002*            WHEN SQLWARN0 NOT = SPACE                            20890025
W36002*            WHEN SQLCODE NOT =  ZERO                             20900025
W36002*                MOVE 'BAD SQLCODE FOR TCOLOR SELECT'             20910025
W36002*                              TO  PV-MESSAGE                     20920025
W36002*                MOVE IMRD008-RECORD TO PV-INPUT-RECORD           20930044
W36002*                PERFORM 9900-SQL-ABEND                           20940025
W36002*        END-EVALUATE                                             20960025
W36002*    END-PERFORM.                                                 20970025
      *                                                                 20980025
W36002*    IF PV-SQL-SUB > PC-MAX-RETRIES                               20990025
W36002*        MOVE  'MAX RETRIES EXCEEDED FOR TCOLOR SELECT'           21000025
W36002*               TO PV-MESSAGE                                     21010025
W36002*        MOVE IMRD008-RECORD TO PV-INPUT-RECORD                   21020044
W36002*        PERFORM 9900-SQL-ABEND                                   21030025
W36002*    END-IF.                                                      21040025
                                                                                
      * ------------------------------------------------------------- * 43810025
      * OPEN LABEL TYPE CODE CURSOR                                     43820025
      * ------------------------------------------------------------- * 43830025
       6400-OPEN-LBL-TYP-CDE-CSR.                                               
      *                                                                 43430025
           MOVE '6400-OPEN-LBL-TYP-CDE-CSR' TO PV-PARAGRAPH.            43440025
      *                                                                 43450025
           PERFORM                                                      43460025
               WITH TEST AFTER                                          43470025
               VARYING PV-SQL-SUB                                       43480025
               FROM 1 BY 1                                              43490025
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        43500025
                  OR SQLCODE = ZERO                                     43510025
      *                                                                 43530025
                 EXEC SQL                                               43540025
                     OPEN LBL_TYP_CDE_CSR                               43550025
                 END-EXEC                                               43560025
      *                                                                 43570025
               EVALUATE TRUE                                            43580025
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              43590025
                   WHEN SQLCODE = PC-DEADLOCK                           43600025
                   WHEN SQLCODE = ZERO                                  43610025
                        CONTINUE                                        43620025
                   WHEN SQLWARN0 NOT = SPACE                            43630025
                   WHEN SQLCODE NOT = ZERO                              43640025
                       MOVE 'BAD SQLCODE FOR OPEN LBL_TYP_CDE_CSR'      43650025
                                     TO  PV-MESSAGE                     43660025
                       MOVE IMRD018-RECORD TO PV-INPUT-RECORD           43670044
                       PERFORM 9900-SQL-ABEND                           43680025
               END-EVALUATE                                             43700025
           END-PERFORM.                                                 43710025
      *                                                                 43720025
           IF PV-SQL-SUB > PC-MAX-RETRIES                               43730025
               MOVE 'MAX RETRIES EXCEEDED FOR OPEN LBL_TYP_CDE_CSR'     43740025
                                     TO  PV-MESSAGE                     43750025
               MOVE IMRD018-RECORD TO PV-INPUT-RECORD                   43760044
               PERFORM 9900-SQL-ABEND                                   43770025
           END-IF.                                                      43790025
                                                                        43800025
      * ------------------------------------------------------------- * 43810025
      * FETCH A ROW FROM THE LABEL TYPE CODE CURSOR                     43820025
      * ------------------------------------------------------------- * 43830025
       6410-FETCH-LBL-TYP-CDE-CSR.                                              
                                                                        43850025
           MOVE '6410-FETCH-LBL-TYP-CDE-CSR' TO PV-PARAGRAPH.           43860025
                                                                        43870025
           PERFORM                                                      43880025
               WITH TEST AFTER                                          43890025
               VARYING PV-SQL-SUB                                       43900025
               FROM 1 BY 1                                              43910025
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        43920025
                  OR SQLCODE = ZERO                                     43930025
                  OR SQLCODE = PC-ROW-NOT-FOUND                         43940025
                                                                        43960025
                 EXEC SQL                                               43970025
                     FETCH  LBL_TYP_CDE_CSR                             43980025
                     INTO  :MDARVS-SUB-CL-MDSEAR-ID                     43990025
                          ,:MDARVS-VS-ID                                44000025
                          ,:MDARVS-VS-DESC                              44010025
                          ,:MDARVS-STKR-NBR                             44020025
                          ,:MDARVS-TKT-TYP-SEQ-NBR                              
                          ,:MDARVS-LBL-SEQ-NBR                          44020025
                          ,:MDARVS-HNG-FOLD-SEQ-NBR                     44020025
                          ,:MDARVS-KY-CLSN-SEQ-NBR                      44020025
                          ,:MDARVS-FNSH-SEQ-NBR                         44020025
                          ,:MDARVS-RMS-STYL-ID                          44020025
                          ,:MDARVS-RTL-CLSN-SEQ-NBR                     44020025
                          ,:MDARVS-DEPT-NBR                             44020025
                          ,:MDARVS-MAJ-CL-NBR                           44020025
                          ,:MDARVS-SUB-CL-NBR                           44020025
                          ,:MDARVS-CLLCTN-SEQ-NBR                       44020025
                          ,:MDARVS-MAP-UNT-RTL-AMT                      44020025
                          ,:VNDSTL-VS-NBR                               44020025
                          ,:VNDSTL-ENT-ID                               44020025
                          ,:EXTENT-DUN-NBR                                      
                 END-EXEC                                               44030025
      *                                                                 44040025
               EVALUATE TRUE                                            44050025
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              44060025
                   WHEN SQLCODE = PC-DEADLOCK                           44070025
                       CONTINUE                                                 
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      44080025
                       SET PS-ROW-NOT-FOUND TO TRUE                     44090025
                   WHEN SQLCODE = ZERO                                  44100025
                       PERFORM 3210-CREATE-STYLE-ATTR-CHG               44110025
                   WHEN SQLWARN0 NOT = SPACE                            44120025
                   WHEN SQLCODE NOT = ZERO                              44130025
                       MOVE 'BAD SQLCODE FOR FETCH LBL_TYP_CDE_CSR'     43650025
                                     TO  PV-MESSAGE                     44150025
                       MOVE IMRD018-RECORD TO PV-INPUT-RECORD           44160044
                       PERFORM 9900-SQL-ABEND                           44170025
               END-EVALUATE                                             44190025
           END-PERFORM.                                                 44200025
      *                                                                 44210025
           IF PV-SQL-SUB > PC-MAX-RETRIES                               44220025
               MOVE 'MAX RETRIES EXCEEDED FOR FETCH LBL_TYP_CDE_CSR'    44230025
                                     TO  PV-MESSAGE                     44240025
               MOVE IMRD018-RECORD TO PV-INPUT-RECORD                   44250044
               PERFORM 9900-SQL-ABEND                                   44260025
           END-IF.                                                      44280025
                                                                        44290025
      * ------------------------------------------------------------- * 44300025
      * CLOSE THE LABEL TYPE CODE CURSOR                                44310025
      * ------------------------------------------------------------- * 44320025
       6420-CLOSE-LBL-TYP-CDE-CSR.                                              
      *                                                                 44340025
           MOVE '6420-CLOSE-LBL-TYP-CDE-CSR' TO PV-PARAGRAPH.           44350025
      *                                                                 44360025
           PERFORM                                                      44370025
               WITH TEST AFTER                                          44380025
               VARYING PV-SQL-SUB                                       44390025
               FROM 1 BY 1                                              44400025
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        44410025
                  OR SQLCODE = ZERO                                     44420025
      *                                                                 44440025
                 EXEC SQL                                               44450025
                     CLOSE LBL_TYP_CDE_CSR                              44460025
                 END-EXEC                                               44470025
      *                                                                 44480025
               EVALUATE TRUE                                            44490025
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              44500025
                   WHEN SQLCODE = PC-DEADLOCK                           44510025
                   WHEN SQLCODE = ZERO                                  44520025
                        CONTINUE                                        44530025
                   WHEN SQLWARN0 NOT = SPACE                            44540025
                   WHEN SQLCODE NOT = ZERO                              44550025
                       MOVE 'BAD SQLCODE FOR CLOSE LBL_TYP_CDE_CSR'     43650025
                                     TO  PV-MESSAGE                     44570025
                       MOVE IMRD018-RECORD TO PV-INPUT-RECORD           44580044
                       PERFORM 9900-SQL-ABEND                           44590025
               END-EVALUATE                                             44610025
           END-PERFORM.                                                 44620025
      *                                                                 44630025
           IF PV-SQL-SUB > PC-MAX-RETRIES                               44640025
               MOVE 'MAX RETRIES EXCEEDED FOR CLOSE LBL_TYP_CDE_CSR'    44650025
                                     TO  PV-MESSAGE                     44660025
               MOVE IMRD018-RECORD TO PV-INPUT-RECORD                   44670044
               PERFORM 9900-SQL-ABEND                                   44680025
           END-IF.                                                      44700025
                                                                        44710025
      *-----------------------------------------------------------------        
      * SELECT THE LABEL TYPE CODE FOR THIS STYLES BRAND USING THE              
      * LABEL SEQUENCE NUMBER.                                                  
      *-----------------------------------------------------------------        
       6450-GET-LBL-TYP-CDE.                                                    
                                                                                
           MOVE '6450-GET-LBL-TYP-CDE' TO PV-PARAGRAPH.                 43860025
                                                                        43870025
           PERFORM                                                      43880025
               WITH TEST AFTER                                          43890025
               VARYING PV-SQL-SUB                                       43900025
               FROM 1 BY 1                                              43910025
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        43920025
                  OR SQLCODE = ZERO                                     43930025
                  OR SQLCODE = PC-ROW-NOT-FOUND                         43940025
                                                                                
               EXEC SQL                                                         
                   SELECT  LBL_TYP_CDE                                          
                     INTO :IMT00000-LBL-TYP-CDE                                 
                     FROM IMT_LBL                                               
                    WHERE LBL_SEQ_NBR    = :MDARVS-LBL-SEQ-NBR                  
                     WITH UR                                                    
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                            44050025
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              44060025
                   WHEN SQLCODE = PC-DEADLOCK                           44070025
                   WHEN SQLCODE = ZERO                                  44100025
                       CONTINUE                                         44110025
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      44100025
                       MOVE SPACE TO IMT00000-LBL-TYP-CDE               44110025
                   WHEN SQLWARN0 NOT = SPACE                            44120025
                   WHEN SQLCODE NOT = ZERO                              44130025
                       MOVE 'BAD SQLCODE FOR SELECT FROM IMT_LBL'       43650025
                                     TO  PV-MESSAGE                     44150025
                       MOVE IMRD018-RECORD TO PV-INPUT-RECORD           44160044
                       PERFORM 9900-SQL-ABEND                           44170025
               END-EVALUATE                                             44190025
           END-PERFORM.                                                 44200025
      *                                                                 44210025
           IF PV-SQL-SUB > PC-MAX-RETRIES                               44220025
               MOVE 'MAX RETRIES EXCEEDED FOR SELECT FROM IMT_LBL'      44230025
                                     TO  PV-MESSAGE                     44240025
               MOVE IMRD018-RECORD TO PV-INPUT-RECORD                   44250044
               PERFORM 9900-SQL-ABEND                                   44260025
           END-IF.                                                      44280025
                                                                                
      * ------------------------------------------------------------- * 43810025
      * OPEN LABEL PRICE TIER/LIFESTYLE CHANGES CURSOR                  43820025
      * ------------------------------------------------------------- * 43830025
       6500-OPEN-LBL-PT-LS-CSR.                                                 
      *                                                                 43430025
           MOVE '6500-OPEN-LBL-PT-LS-CSR' TO PV-PARAGRAPH.              43440025
      *                                                                 43450025
           PERFORM                                                      43460025
               WITH TEST AFTER                                          43470025
               VARYING PV-SQL-SUB                                       43480025
               FROM 1 BY 1                                              43490025
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        43500025
                  OR SQLCODE = ZERO                                     43510025
      *                                                                 43530025
                 EXEC SQL                                               43540025
                     OPEN LBL_PT_LS_CHGS_CSR                            43550025
                 END-EXEC                                               43560025
      *                                                                 43570025
               EVALUATE TRUE                                            43580025
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              43590025
                   WHEN SQLCODE = PC-DEADLOCK                           43600025
                   WHEN SQLCODE = ZERO                                  43610025
                        CONTINUE                                        43620025
                   WHEN SQLWARN0 NOT = SPACE                            43630025
                   WHEN SQLCODE NOT = ZERO                              43650025
                       MOVE 'BAD SQLCODE FOR OPEN LBL_PT_LS_CHGS_CSR'   43650025
                                     TO  PV-MESSAGE                     43660025
                       MOVE IMRD018-RECORD TO PV-INPUT-RECORD           43670044
                       PERFORM 9900-SQL-ABEND                           43680025
               END-EVALUATE                                             43700025
           END-PERFORM.                                                 43710025
      *                                                                 43720025
           IF PV-SQL-SUB > PC-MAX-RETRIES                               43730025
               MOVE 'MAX RETRIES EXCEEDED FOR OPEN LBL_PT_LS_CHGS_CSR'  43740025
                                     TO  PV-MESSAGE                     43750025
               MOVE IMRD018-RECORD TO PV-INPUT-RECORD                   43760044
               PERFORM 9900-SQL-ABEND                                   43770025
           END-IF.                                                      43790025
                                                                        43800025
      * ------------------------------------------------------------- * 43810025
      * FETCH A ROW FROM THE LABEL PRICE TIER/LIFESTYLE CHANGES CURSOR  43820025
      * ------------------------------------------------------------- * 43830025
       6510-FETCH-LBL-PT-LS-CSR.                                                
                                                                        43850025
           MOVE '6510-FETCH-LBL-PT-LS-CSR' TO PV-PARAGRAPH.             43860025
                                                                        43870025
           PERFORM                                                      43880025
               WITH TEST AFTER                                          43890025
               VARYING PV-SQL-SUB                                       43900025
               FROM 1 BY 1                                              43910025
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        43920025
                  OR SQLCODE = ZERO                                     43930025
                  OR SQLCODE = PC-ROW-NOT-FOUND                         43940025
                                                                        43960025
                 EXEC SQL                                               43970025
                     FETCH  LBL_PT_LS_CHGS_CSR                          43980025
                     INTO  :MDARVS-SUB-CL-MDSEAR-ID                     43990025
                          ,:MDARVS-VS-ID                                44000025
                 END-EXEC                                               44030025
      *                                                                 44040025
               EVALUATE TRUE                                            44050025
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              44060025
                   WHEN SQLCODE = PC-DEADLOCK                           44070025
                       CONTINUE                                                 
                   WHEN SQLCODE = PC-ROW-NOT-FOUND                      44080025
                       SET PS-ROW-NOT-FOUND TO TRUE                     44090025
                   WHEN SQLCODE = ZERO                                  44100025
                       PERFORM 7300-UPDATE-STYLE-PT-LS                  44110025
                       PERFORM 4000-COMMIT-PROCESSING                           
                   WHEN SQLWARN0 NOT = SPACE                            44120025
                   WHEN SQLCODE NOT = ZERO                              44130025
                       MOVE 'BAD SQLCODE FOR FETCH LBL_PT_LS_CHGS_CSR'  43650025
                                     TO  PV-MESSAGE                     44150025
                       MOVE IMRD018-RECORD TO PV-INPUT-RECORD           44160044
                       PERFORM 9900-SQL-ABEND                           44170025
               END-EVALUATE                                             44190025
           END-PERFORM.                                                 44200025
      *                                                                 44210025
           IF PV-SQL-SUB > PC-MAX-RETRIES                               44220025
               MOVE 'MAX RETRIES EXCEEDED FOR FETCH LBL_PT_LS_CHGS_CSR' 44230025
                                     TO  PV-MESSAGE                     44240025
               MOVE IMRD018-RECORD TO PV-INPUT-RECORD                   44250044
               PERFORM 9900-SQL-ABEND                                   44260025
           END-IF.                                                      44280025
                                                                        44290025
      * ------------------------------------------------------------- * 44300025
      * CLOSE THE LABEL PRICE TIER/LIFESTYLE CHANGES CURSOR             44310025
      * ------------------------------------------------------------- * 44320025
       6520-CLOSE-LBL-PT-LS-CSR.                                                
      *                                                                 44340025
           MOVE '6520-CLOSE-LBL-PT-LS-CSR' TO PV-PARAGRAPH.             44350025
      *                                                                 44360025
           PERFORM                                                      44370025
               WITH TEST AFTER                                          44380025
               VARYING PV-SQL-SUB                                       44390025
               FROM 1 BY 1                                              44400025
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        44410025
                  OR SQLCODE = ZERO                                     44420025
      *                                                                 44440025
                 EXEC SQL                                               44450025
                     CLOSE LBL_PT_LS_CHGS_CSR                           44460025
                 END-EXEC                                               44470025
      *                                                                 44480025
               EVALUATE TRUE                                            44490025
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              44500025
                   WHEN SQLCODE = PC-DEADLOCK                           44510025
                   WHEN SQLCODE = ZERO                                  44520025
                        CONTINUE                                        44530025
                   WHEN SQLWARN0 NOT = SPACE                            44540025
                   WHEN SQLCODE NOT = ZERO                              44550025
                       MOVE 'BAD SQLCODE FOR CLOSE LBL_PT_LS_CHGS_CSR'  43650025
                                     TO  PV-MESSAGE                     44570025
                       MOVE IMRD018-RECORD TO PV-INPUT-RECORD           44580044
                       PERFORM 9900-SQL-ABEND                           44590025
               END-EVALUATE                                             44610025
           END-PERFORM.                                                 44620025
      *                                                                 44630025
           IF PV-SQL-SUB > PC-MAX-RETRIES                               44650025
               MOVE 'MAX RETRIES EXCEEDED FOR CLOSE LBL_PT_LS_CHGS_CSR' 44650025
                                     TO  PV-MESSAGE                     44660025
               MOVE IMRD018-RECORD TO PV-INPUT-RECORD                   44670044
               PERFORM 9900-SQL-ABEND                                   44680025
           END-IF.                                                      44700025
                                                                        44710025
      ******************************************************************        
      *  INSERT A BUSINESS EVENT RECORD TO THE ITEM EVENT MESSAGE               
      *  BRIDGE DB2 TABLE.                                                      
      ******************************************************************        
       7000-INSERT-IMT-EVNT-MSG.                                        20580025
                                                                        20590025
           MOVE '7000-INSERT-IMT-EVNT-MSG' TO PV-PARAGRAPH.             20600025
           MOVE 'INSERT ROW '              TO PV-ACTION.                20610025
                                                                        20590025
           MOVE IM008-ITEM-KEY-RMS-STYL-ID                                      
                                    TO IMT00001-RMS-STYL-ID.                    
           MOVE IM008-BUSINESS-EVENT-ID                                         
                                    TO IMT00001-BUS-EVNT-TYP-CDE.               
           MOVE IMRD008-RECORD      TO IMT00001-MSG-TXT-TEXT.                   
                                                                        20620025
           PERFORM                                                      20630025
               WITH TEST AFTER                                          20650025
               VARYING PV-SQL-SUB                                       20650025
               FROM 1 BY 1                                              20660025
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        20670025
                  OR SQLCODE = 0                                        20680025
      *                                                                 20710025
                 EXEC SQL                                               20720025
                     INSERT INTO IMT_EVNT_MSG_BRG                               
                            ( CRE_TMST                                          
                            ,RMS_STYL_ID                                        
                            ,BUS_EVNT_TYP_CDE                                   
                            ,MSG_TXT )                                          
                     VALUES                                                     
                           ( CURRENT TIMESTAMP                                  
                           ,:IMT00001-RMS-STYL-ID                               
                           ,:IMT00001-BUS-EVNT-TYP-CDE                          
                           ,:IMT00001-MSG-TXT)                                  
                 END-EXEC                                               20800025
      *                                                                 20810025
               EVALUATE TRUE                                            20820025
                   WHEN SQLCODE = ZERO                                  20870025
                       ADD 1 TO PA-IMT-EVNT-MSG-BRG-INSERTS             20880025
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              20830025
                   WHEN SQLCODE = PC-DEADLOCK                           20840025
                        CONTINUE                                        20860025
                   WHEN SQLWARN0 NOT = SPACE                            20890025
                   WHEN SQLCODE NOT =  ZERO                             20900025
                       MOVE 'BAD SQLCODE FOR IMT_EVNT_MSG_BRG INSERT'   20910025
                                     TO  PV-MESSAGE                     20920025
                       MOVE IMRD008-RECORD TO PV-INPUT-RECORD           20930044
                       PERFORM 9900-SQL-ABEND                           20940025
               END-EVALUATE                                             20960025
           END-PERFORM.                                                 20970025
      *                                                                 20980025
           IF PV-SQL-SUB > PC-MAX-RETRIES                               20990025
               MOVE  'MAX RETRIES EXCEEDED FOR IMT_EVNT_MSG_BRG INSERT' 21000025
                      TO PV-MESSAGE                                     21010025
               MOVE IMRD008-RECORD TO PV-INPUT-RECORD                   21020044
               PERFORM 9900-SQL-ABEND                                   21030025
           END-IF.                                                      21040025
                                                                        21120025
      ******************************************************************        
      *  GET THE COMMIT TIMESTAMP FROM THE CHECKPOINT CONTROL TABLE.            
      ******************************************************************        
       7100-GET-COMMIT-TIMESTAMP.                                               
                                                                        21120025
           MOVE '7100-GET-COMMIT-TIMESTAMP' TO PV-PARAGRAPH.                    
           MOVE 'SELECT ROW '               TO PV-ACTION.               20610025
                                                                                
           PERFORM                                                      20630025
               WITH TEST AFTER                                          20640025
               VARYING PV-SQL-SUB                                       20650025
               FROM 1 BY 1                                              20660025
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        20670025
                  OR SQLCODE = 0                                        20680025
      *                                                                 20710025
                 EXEC SQL                                                       
                     SELECT                                                     
                       (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)            
                     INTO                                                       
                       :PV-COMMIT-TIMESTAMP                                     
                     FROM TCKRSTCNTL                                            
                    WHERE JOB_NAME  = :PC-JOB-NAME                              
                      AND PLAN_NAME = :PC-PGM-NAME                              
                 END-EXEC                                                       
                                                                                
               EVALUATE TRUE                                            20820025
                   WHEN SQLCODE = ZERO                                  20870025
                       CONTINUE                                         20880025
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              20830025
                   WHEN SQLCODE = PC-DEADLOCK                           20840025
                       CONTINUE                                         20860025
                   WHEN SQLWARN0 NOT = SPACE                            20890025
                   WHEN SQLCODE NOT =  ZERO                             20900025
                       MOVE 'BAD SQLCODE FOR TCKRSTCNTL SELECT'         20910025
                                     TO  PV-MESSAGE                     20920025
                       MOVE IMRD018-RECORD TO PV-INPUT-RECORD           43670044
                       PERFORM 9900-SQL-ABEND                           20940025
               END-EVALUATE                                             20960025
           END-PERFORM.                                                 20970025
      *                                                                 20980025
           IF PV-SQL-SUB > PC-MAX-RETRIES                               20990025
               MOVE  'MAX RETRIES EXCEEDED FOR SELECT OF TCKRSTCNTL'    21000025
                      TO PV-MESSAGE                                     21010025
               MOVE IMRD018-RECORD TO PV-INPUT-RECORD                   43670044
               PERFORM 9900-SQL-ABEND                                   21030025
           END-IF.                                                      21040025
                                                                                
      ******************************************************************        
      *  GET THE CURRENT TIMESTAMP FROM DB2.                                    
      ******************************************************************        
       7200-SET-CURRENT-TIMESTAMP.                                              
                                                                        21120025
           MOVE '7200-SET-CURRENT-TIMESTAMP' TO PV-PARAGRAPH.                   
           MOVE 'SELECT CURRENT TIMESTAMP'   TO PV-ACTION.              20610025
                                                                                
           EXEC SQL                                                             
                SET :PV-CURRENT-TIMESTAMP = CURRENT TIMESTAMP                   
           END-EXEC.                                                            
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
                   CONTINUE                                                     
               WHEN OTHER                                                       
                   MOVE 'BAD SQLCODE FOR TIMESTAMP SELECT' TO                   
                         PV-MESSAGE                                             
                   MOVE IMRD018-RECORD TO PV-INPUT-RECORD               0044    
                   PERFORM 9900-SQL-ABEND                               0025    
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      *  UPDATE PRICE TIER AND LIFESTYLE FOR A STYLE.                           
      ******************************************************************        
       7300-UPDATE-STYLE-PT-LS.                                         20580025
                                                                        20590025
           MOVE '7300-UPDATE-STYLE-PT-LS' TO PV-PARAGRAPH.              20600025
           MOVE 'UPDATE ROW '             TO PV-ACTION.                 20610025
                                                                        20590025
           PERFORM                                                      20630025
               WITH TEST AFTER                                          20650025
               VARYING PV-SQL-SUB                                       20650025
               FROM 1 BY 1                                              20660025
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        20670025
                  OR SQLCODE = 0                                        20680025
      *                                                                 20710025
                 EXEC SQL                                               20720025
                   UPDATE  TMDARVS                                              
                     SET  PRIC_TIER_SEQ_NBR = :MDARVS-PRIC-TIER-SEQ-NBR         
                         ,LFSTYL_SEQ_NBR    = :MDARVS-LFSTYL-SEQ-NBR            
                   WHERE CURRENT OF LBL_PT_LS_CHGS_CSR                          
                 END-EXEC                                               20800025
      *                                                                 20810025
               EVALUATE TRUE                                            20820025
                   WHEN SQLCODE = ZERO                                  20870025
                       ADD 1 TO PA-STYLE-PT-LS-UPDATES                  20880025
                   WHEN SQLCODE = PC-UNAVAILABLE-RESOURCES              20830025
                   WHEN SQLCODE = PC-DEADLOCK                           20840025
                        CONTINUE                                        20860025
                   WHEN SQLWARN0 NOT = SPACE                            20890025
                   WHEN SQLCODE NOT =  ZERO                             20900025
                       MOVE 'BAD SQLCODE FOR TMDARVS UPDATE'            20910025
                                     TO  PV-MESSAGE                     20920025
                       DISPLAY '**  MDARVS-SUB-CL-MDSEAR-ID = '         48040044
                               MDARVS-SUB-CL-MDSEAR-ID                  48040044
                               ',  MDARVS-VS-ID = ' MDARVS-VS-ID        48040044
                       MOVE IMRD008-RECORD TO PV-INPUT-RECORD           20930044
                       PERFORM 9900-SQL-ABEND                           20940025
               END-EVALUATE                                             20960025
           END-PERFORM.                                                 20970025
      *                                                                 20980025
           IF PV-SQL-SUB > PC-MAX-RETRIES                               20990025
               MOVE  'MAX RETRIES EXCEEDED FOR TMDARVS UPDATE'          21000025
                      TO PV-MESSAGE                                     21010025
               MOVE IMRD018-RECORD TO PV-INPUT-RECORD                   21020044
               PERFORM 9900-SQL-ABEND                                   21030025
           END-IF.                                                      21040025
                                                                        21120025
      * ------------------------------------------------------------- * 45970051
      * READ CONTROL CARD 1 TO OBTAIN THE INPUT QUEUE MGR NAME          45980051
      * ------------------------------------------------------------- * 45990051
       8000-READ-CONTROL-CARD1.                                         46000051
            READ CONTROL-CARD-1 INTO CC-CONTROL-CARD-1                  46010051
                AT END                                                  46020051
                    SET PS-CONTROL-CARD-1-END   TO TRUE.                46030051
                                                                        46040051
      * ------------------------------------------------------------- * 46050051
      * READ CONTROL CARD 2 TO OBTAIN THE INPUT QUEUE NAME              46060051
      * ------------------------------------------------------------- * 46070025
       8100-READ-CONTROL-CARD2.                                         46080025
            READ CONTROL-CARD-2 INTO CC-CONTROL-CARD-2                  46090025
                AT END                                                  46100025
                    SET PS-CONTROL-CARD-2-END TO TRUE.                  46110025
                                                                        46120025
      * ------------------------------------------------------------- * 46190025
      * GET RMS MERCH HIERARCHY MESSAGES FROM MQ SERIES                 46200025
      * ------------------------------------------------------------- * 46210025
       8200-MQGET-MSG.                                                  46220025
                                                                        46230025
           INITIALIZE PS-MQGET-SUCCESSFUL-SW.                           46240025
           INITIALIZE PV-MSGBUFFER.                                     46250025
           MOVE MQMI-NONE              TO MQMD-MSGID.                   46260025
           MOVE MQCI-NONE              TO MQMD-CORRELID.                46270025
           MOVE CC-NONVSM-ITEM-CHG-QNAME                                46280025
                                       TO MQOD-OBJECTNAME.              46280025
      *    WAIT ONE MINUTE IF NO MORE MESSAGES ARE FOUND                46200025
           MOVE 60000                  TO MQGMO-WAITINTERVAL.           46270025
           COMPUTE MQGMO-OPTIONS  = MQGMO-SYNCPOINT +                   46300025
                                    MQGMO-CONVERT +                     46310025
                                    MQGMO-WAIT.                         46320025
                                                                        46330025
           CALL WS-MQGET USING PV-HCONN                                 46340025
                               PV-GQ-HANDLE                             46350025
                               MQM-MESSAGE-DESCRIPTOR                   46360025
                               MQM-GET-MESSAGE-OPTIONS                  46370025
                               PV-MSGLENGTH                             46380025
                               PV-MSGBUFFER                             46390025
                               PV-DATA-LENGTH                           46400025
                               PV-COMPLETION-CODE                       46410025
                               PV-REASON.                               46420025
                                                                        46430025
      *        IF GET FAILED THEN DISPLAY ERROR MESSAGE                 46440025
      *        AND BREAK OUT OF LOOP                                    46450025
                                                                        46460025
           IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        46470025
              IF (PV-REASON NOT = MQRC-NO-MSG-AVAILABLE)                46480025
                  MOVE 'MQGET ERROR'      TO PV-ERROR-MESSAGE           46540025
                  PERFORM 8500-BACK-OUT-MQ                                      
                  PERFORM 9000-MQ-ABEND                                         
              ELSE                                                      46580025
                  DISPLAY 'NO MORE MESSAGES AVAILABLE'                  46590025
              END-IF                                                    46600025
           ELSE                                                         46610025
              SET PS-MQGET-SUCCESSFUL TO TRUE                           46650025
              ADD 1 TO PA-MQGET                                         46660025
              MOVE PV-MSGBUFFER TO IMRD018-RECORD                       46670025
              DISPLAY '***MQ MESSAGE = ' IMRD018-RECORD                    05030
           END-IF.                                                      46710025
                                                                        46720025
      * ------------------------------------------------------------- * 46730025
      *  COMMIT DB2 PROCESSING SINCE THE POINT OF THE LAST COMMIT      *47080025
      * ------------------------------------------------------------- * 46730025
       8400-COMMIT-DB2.                                                 47110025
                                                                        47120025
           EXEC SQL                                                     47130025
              COMMIT                                                    47140025
           END-EXEC.                                                    47150025
                                                                        47160025
           IF SQLCODE = 0                                                       
               ADD +1              TO PA-COMMIT-CNTR                            
           ELSE                                                         47170025
               SET PV-COMMIT-DB2-INSERTS-UPDATES TO TRUE                47180025
               MOVE '8400-COMMIT-DB2'    TO PV-PARAGRAPH                47200025
               PERFORM 9900-SQL-ABEND                                   47210025
           END-IF.                                                      47220025
                                                                        47240025
      * ------------------------------------------------------------- * 46730025
      *  COMMIT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT       *47450025
      * ------------------------------------------------------------- * 46730025
       8450-COMMIT-MQ.                                                  47480025
                                                                        47490025
           CALL WS-MQCMIT USING PV-HCONN                                47500025
                                PV-COMPLETION-CODE                      47510025
                                PV-REASON.                              47520025
                                                                        47530025
           IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        47540025
              MOVE '8450-COMMIT-MQ'  TO PV-PARAGRAPH                    47550025
              MOVE 'MQCMIT ERROR'    TO PV-ERROR-MESSAGE                47560025
              PERFORM 9000-MQ-ABEND                                     47580025
           END-IF.                                                      47590025
                                                                        47600025
      * ------------------------------------------------------------- * 46730025
      * BACK OUT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT      *        
      * ------------------------------------------------------------- * 46730025
       8500-BACK-OUT-MQ.                                                        
                                                                                
           CALL WS-MQBACK USING PV-HCONN                                        
                                PV-COMPLETION-CODE                              
                                PV-REASON.                                      
                                                                                
           IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                           
              MOVE '8500-BACK-OUT-MQ'  TO PV-PARAGRAPH                          
              MOVE 'MQBACK ERROR'      TO PV-ERROR-MESSAGE                      
              PERFORM 9000-MQ-ABEND                                             
           END-IF.                                                              
                                                                                
      * ------------------------------------------------------------- * 47770025
      * PERFORM MQ-SERIES ABEND PROCESSING                              47780025
      * ------------------------------------------------------------- * 47790025
       9000-MQ-ABEND.                                                   47800025
                                                                        47810025
           DISPLAY '**** ABEND *************************************'   47820030
           DISPLAY '** MQSERIES ERROR **'                               47830025
           DISPLAY '** PROGRAM:    ', PC-PGM-NAME                       47840025
           DISPLAY '** PARAGRAPH:  ', PV-PARAGRAPH                      47850025
           DISPLAY '** MESSAGE:    ', PV-ERROR-MESSAGE                  47860030
           DISPLAY '** COMP CODE:  ', PV-COMPLETION-CODE                47870030
           DISPLAY '** RSN CODE:   ', PV-REASON                         47880030
           DISPLAY '************************************************'   47890030
           SET AC-MQ-ERROR TO TRUE.                                     47900025
           CALL 'ILBOABN0' USING ABEND-CODE.                            47910025
                                                                        47920025
      *----------------------------------------------------------------*47930025
      *  FORMAT A DB2 ERROR MESSAGE                                    *47940025
      *----------------------------------------------------------------*47950025
       9900-SQL-ABEND.                                                  47970025
                                                                        47980025
           DISPLAY '***************************************************'47990025
           DISPLAY '**  ERROR     **'                                   48000030
           DISPLAY '**  PROGRAM   **  = ' PC-PGM-NAME.                  48010025
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH.                 48020025
           DISPLAY '**  MESSAGE   **  = ' PV-MESSAGE.                   48030025
           DISPLAY '**  INPUT REC **  = ' PV-INPUT-RECORD.              48040044
      *                                                                 48050025
      *  ROUTINE TO CONVERT THE SQLCA INTO A READABLE FORMAT, USING     48060025
      *  THE CALLED MODULE DSNTIAR.                                     48070025
      *                                                                 48080025
           COPY DPPD004.                                                48090025
                                                                        48100025
           EXEC SQL                                                     08680024
                ROLLBACK                                                08690024
           END-EXEC.                                                    08700024
                                                                        08710024
           PERFORM 8500-BACK-OUT-MQ.                                    08710024
                                                                        08710024
           SET AC-DB2-ERROR TO TRUE.                                    47900025
           CALL 'ILBOABN0' USING ABEND-CODE.                               CL**1
