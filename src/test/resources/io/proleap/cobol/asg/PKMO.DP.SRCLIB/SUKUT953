000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    SUKUT953.                                         00020000
000300 AUTHOR.        DENISE HAHN.                                      00030000
000400 DATE-WRITTEN.  NOVEMBER 2012.                                    00040000
000500 ENVIRONMENT DIVISION.                                            00050000
000600 INPUT-OUTPUT SECTION.                                            00060000
000700                                                                  00070000
000800* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00080000
000801*                                                               * 00080104
000810*         I M P O R T A N T                                     * 00081004
000811*                                                               * 00081104
000820*   BEFORE USING THIS PROGRAM AGAIN....THE CHECK FOR A DIVERT   * 00082004
000830*   NEEDS TO BE CHANGED - IF THERE IS AN ACTIVE DIVERT FOR THE  * 00083004
000840*   SAME DOOR - DO NOT INSERT A NEW DIVERT - 7030               * 00084004
000841*                                                               * 00084104
000842*   ALSO ANOTHER CHECK NEEDS TO BE MADE TO CHECK IF A CARTON    * 00084204
000843*   HAS BEEN SCANNED ON  - SUT_OTBND_LOC - SHON                 * 00084304
000844*                                                               * 00084404
000845*                                                               * 00084504
000846*                                                               * 00084604
000850* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00085004
000851*                                                                 00085104
000852*                                                                 00085204
000860* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00086004
000900* READ IN EDITED DIVERT FILE FROM DEMATIC                         00090000
001000* ELIMINATE:  EXPECTED AND ACTUAL DIVERT DO NOT MATCH             00100000
001100* ELIMINATE:  ANY RECORDS ALREADY ON THE DIVERT TABLE.            00110000
001200* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00120000
001300                                                                  00130000
001400 FILE-CONTROL.                                                    00140000
001500                                                                  00150000
001600     SELECT SU-DIVERT-FILE-IN   ASSIGN TO IN01.                   00160000
001700     SELECT SU-DIVERT-FILE-OUT  ASSIGN TO OUT01.                  00170000
001800                                                                  00180000
001900 DATA DIVISION.                                                   00190000
002000 FILE SECTION.                                                    00200000
002100                                                                  00210000
002200 FD  SU-DIVERT-FILE-IN                                            00220000
002300     RECORDING MODE IS F                                          00230000
002400     LABEL RECORDS ARE STANDARD                                   00240000
002500     BLOCK CONTAINS 0 RECORDS.                                    00250000
002600 01  SU-DIVERT-RECORD-IN.                                         00260000
002700     05  SU-SML-NUMBER                PIC X(20).                  00270000
002800     05  FILLER                       PIC X(01).                  00280000
002900     05  SU-DOOR-ID                   PIC X(04).                  00290000
002910     05  FILLER                       PIC X(01).                  00291000
002920     05  SU-DIVERT-NBR                PIC 9(03).                  00292000
002930     05  FILLER                       PIC X(01).                  00293000
002940     05  SU-DIVERT-DATE               PIC X(10).                  00294000
002941     05  SU-DIVERT-DATE-R  REDEFINES SU-DIVERT-DATE.              00294100
002942         10  SU-DIVERT-DATE-YY        PIC X(04).                  00294200
002943         10  FILLER                   PIC X(01).                  00294300
002944         10  SU-DIVERT-DATE-MM        PIC X(02).                  00294400
002945         10  FILLER                   PIC X(01).                  00294500
002946         10  SU-DIVERT-DATE-DD        PIC X(02).                  00294600
002950     05  FILLER                       PIC X(01).                  00295000
002960     05  SU-DIVERT-TIME               PIC X(08).                  00296000
002961     05  SU-DIVERT-TIME-R REDEFINES SU-DIVERT-TIME.               00296100
002962         10  SU-DIVERT-TIME-HH        PIC X(02).                  00296200
002963         10  FILLER                   PIC X(01).                  00296300
002964         10  SU-DIVERT-TIME-MM        PIC X(02).                  00296400
002965         10  FILLER                   PIC X(01).                  00296500
002966         10  SU-DIVERT-TIME-SS        PIC X(02).                  00296600
002967     05  FILLER                       PIC X(03).                  00296700
003003                                                                  00300300
003004 FD  SU-DIVERT-FILE-OUT                                           00300400
003005     RECORDING MODE IS F                                          00300500
003006     LABEL RECORDS ARE STANDARD                                   00300600
003007     BLOCK CONTAINS 0 RECORDS.                                    00300700
003008 01  SU-DIVERT-RECORD-OUT             PIC X(57).                  00300802
003009                                                                  00300900
003010                                                                  00301000
003020 WORKING-STORAGE SECTION.                                         00302000
003030                                                                  00303000
003040 01  PV-ABEND-CODE                    PIC S9(04)   VALUE +0       00304000
003050                                                   COMP SYNC.     00305000
003060                                                                  00306000
003070 01  PS-PROGRAM-SWITCHES.                                         00307000
003080     05  PS-EOF-SW                    PIC X(1)   VALUE 'N'.       00308000
003090         88  PS-EOF-YES                          VALUE 'Y'.       00309000
003100         88  PS-EOF-NO                           VALUE 'N'.       00310000
003200                                                                  00320000
003300 01  PV-PROGRAM-VARIABLES.                                        00330000
003400                                                                  00340000
003500     05  PV-COUNT-IN                  PIC  9(09)  VALUE ZEROS.    00350000
003600     05  PV-COUNT-OUT                 PIC  9(09)  VALUE ZEROS.    00360000
003700     05  PV-COUNT-DIFF-DEST           PIC  9(09)  VALUE ZEROS.    00370000
003800     05  PV-COUNT-DIVERTED            PIC  9(09)  VALUE ZEROS.    00380000
003900*                                                                 00390000
004000     05  PV-DATE                      PIC  X(10)  VALUE SPACES.   00400000
004100     05  PV-DATE-R REDEFINES PV-DATE.                             00410000
004200         10  PV-DATE-YY             PIC  X(04).                   00420000
004300         10  PV-DATE-SLASH-1        PIC  X(01).                   00430000
004400         10  PV-DATE-MM             PIC  X(02).                   00440000
004500         10  PV-DATE-SLASH-2        PIC  X(01).                   00450000
004600         10  PV-DATE-DD             PIC  X(02).                   00460000
004700     05  PV-TIME                    PIC  X(08)  VALUE SPACES.     00470000
004800     05  PV-TIME-R REDEFINES PV-TIME.                             00480000
004900         10  PV-TIME-HH             PIC  X(02).                   00490000
005000         10  PV-TIME-COLON-1        PIC  X(01).                   00500000
005100         10  PV-TIME-MM             PIC  X(02).                   00510000
005200         10  PV-TIME-COLON-2        PIC  X(01).                   00520000
005300         10  PV-TIME-SS             PIC  X(02).                   00530000
005400                                                                  00540000
005500 01  PV-ABEND-FIELDS.                                             00550000
005600     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'SUKUT953'.00560000
005700     05  PV-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    00570000
005800     05  PV-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    00580000
005900     05  PV-ABEND-STRUCTURE-1         PIC X(8)   VALUE SPACES.    00590000
006000     05  PV-ABEND-STRUCTURE-2         PIC X(8)   VALUE SPACES.    00600000
006100     05  PV-ABEND-STRUCTURE-3         PIC X(8)   VALUE SPACES.    00610000
006200     05  PV-ABEND-STATUS              PIC XX     VALUE SPACES.    00620000
006300     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    00630000
006400     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    00640000
006500     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    00650000
006600     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    00660000
006700     05  PV-SQLCODE                   PIC 9(9)  VALUE ZERO.       00670000
006800                                                                  00680000
006810     05  PV-DATE-OUT.                                             00681003
006820         10  PV-DIVERT-YY-OUT         PIC 9(04).                  00682003
006830         10  PV-DIVERT-MM-OUT         PIC 9(02).                  00683003
006840         10  PV-DIVERT-DD-OUT         PIC 9(02).                  00684003
006850     05  PV-TIME-OUT.                                             00685003
006860         10  PV-DIVERT-HOUR-OUT       PIC 9(02).                  00686003
006870         10  PV-DIVERT-MIN-OUT        PIC 9(02).                  00687003
006880         10  PV-DIVERT-SEC-OUT        PIC 9(02).                  00688003
006900                                                                  00690000
007000*    DIVERT TABLE                                                 00700000
007100     EXEC SQL                                                     00710000
007200         INCLUDE TSUCRDV                                          00720000
007300     END-EXEC.                                                    00730000
007400                                                                  00740000
007500*  USED FOR DB2 ERROR MESSAGE BUILDING                            00750000
007600     COPY DPWS004.                                                00760000
007700                                                                  00770000
007800                                                                  00780000
007810*  DIVERT RECORD LAYOUT                                           00781002
007820     COPY SURD014.                                                00782002
007830                                                                  00783002
007900*   DB2 SQL COMMUNICATION AREA                                    00790000
008000     EXEC SQL                                                     00800000
008100          INCLUDE SQLCA                                           00810000
008200     END-EXEC.                                                    00820000
008300                                                                  00830000
008400                                                                  00840000
008500 PROCEDURE DIVISION.                                              00850000
008600                                                                  00860000
008700     PERFORM 1000-INIT.                                           00870000
008800                                                                  00880000
008900     PERFORM 2000-PROCESS                                         00890000
009000        UNTIL PS-EOF-YES.                                         00900000
009100                                                                  00910000
009200     DISPLAY '************************'.                          00920000
009300     DISPLAY '*PV-COUNT-IN = ' PV-COUNT-IN.                       00930000
009400     DISPLAY '*PV-DIFF-DEST= ' PV-COUNT-DIFF-DEST                 00940000
009500     DISPLAY '*PV-DIVERTED = ' PV-COUNT-DIVERTED                  00950000
009600     DISPLAY '*PV-COUNT-OUT= ' PV-COUNT-OUT.                      00960000
009700     DISPLAY '************************'.                          00970000
009800     PERFORM 9000-TERMINATE.                                      00980000
009900                                                                  00990000
010000     GOBACK.                                                      01000000
010100                                                                  01010000
010200 1000-INIT.                                                       01020000
010300                                                                  01030000
010400                                                                  01040000
010500     DISPLAY '************************'.                          01050000
010600     DISPLAY '******* SUKUT953 *******'.                          01060000
010700     DISPLAY '************************'.                          01070000
010800                                                                  01080000
010900     OPEN INPUT  SU-DIVERT-FILE-IN                                01090000
011000          OUTPUT SU-DIVERT-FILE-OUT.                              01100000
011100                                                                  01110000
011200     PERFORM 7000-READ-INPUT.                                     01120000
011300                                                                  01130000
011400                                                                  01140000
011500 2000-PROCESS.                                                    01150000
011600                                                                  01160000
012000     PERFORM 7030-CHECK-DIVERT.                                   01200000
012200                                                                  01220000
012300     PERFORM 7000-READ-INPUT.                                     01230000
012400                                                                  01240000
012500                                                                  01250000
012600                                                                  01260000
012700 7000-READ-INPUT.                                                 01270000
012800     READ SU-DIVERT-FILE-IN                                       01280000
012900          AT END                                                  01290000
013000              SET PS-EOF-YES               TO TRUE                01300000
013100          NOT AT END                                              01310000
013200              ADD  1                       TO PV-COUNT-IN         01320000
013300     END-READ.                                                    01330000
013400                                                                  01340000
013500                                                                  01350000
013600 7030-CHECK-DIVERT.                                               01360000
013700                                                                  01370000
013800     MOVE  SU-SML-NUMBER    TO  SUCRDV-SHIPT-UNT-ID.              01380000
013900     MOVE  SU-DIVERT-DATE   TO  SUCRDV-DIVERT-SYS-DTE.            01390000
014000     MOVE  SU-DIVERT-TIME   TO  SUCRDV-DIVERT-SYS-TM.             01400000
014100     MOVE  865              TO  SUCRDV-OPER-UNT-ID.               01410000
014200                                                                  01420000
014300     MOVE SU-DIVERT-DATE-YY     TO  PV-DATE-YY                    01430000
014400     MOVE '-'                   TO  PV-DATE-SLASH-1               01440000
014500     MOVE SU-DIVERT-DATE-MM     TO  PV-DATE-MM                    01450000
014600     MOVE '-'                   TO  PV-DATE-SLASH-2               01460000
014700     MOVE SU-DIVERT-DATE-DD     TO  PV-DATE-DD                    01470000
014800                                                                  01480000
014900     MOVE SU-DIVERT-TIME-HH     TO  PV-TIME-HH                    01490000
015000     MOVE '.'                   TO  PV-TIME-COLON-1               01500000
015100     MOVE SU-DIVERT-TIME-MM     TO  PV-TIME-MM                    01510000
015200     MOVE '.'                   TO  PV-TIME-COLON-2               01520000
015300     MOVE SU-DIVERT-TIME-SS     TO  PV-TIME-SS                    01530000
015400                                                                  01540000
015500     EXEC SQL                                                     01550000
015600         SELECT                                                   01560000
015700                 OPER_UNT_ID                                      01570000
015800                ,DIVERT_TMST                                      01580000
015900                ,DOOR_ID                                          01590000
016000         INTO                                                     01600000
016100                 :SUCRDV-OPER-UNT-ID                              01610000
016200                ,:SUCRDV-DIVERT-TMST                              01620000
016300                ,:SUCRDV-DOOR-ID                                  01630000
016400         FROM                                                     01640000
016500                 TSUCRDV                                          01650000
016600         WHERE                                                    01660000
016700                 SHIPT_UNT_ID        =  :SUCRDV-SHIPT-UNT-ID      01670000
016800           AND   DIVERT_SYS_DTE      =  :PV-DATE                  01680000
016900           AND   DIVERT_SYS_TM       =  :PV-TIME                  01690000
017000           AND   OPER_UNT_ID         =  :SUCRDV-OPER-UNT-ID       01700000
017100     END-EXEC.                                                    01710000
017200                                                                  01720000
017300     EVALUATE TRUE                                                01730000
017400         WHEN SQLCODE = ZERO                                      01740000
017500         WHEN SQLCODE = -811                                      01750000
017600              ADD  1  TO  PV-COUNT-DIVERTED                       01760000
017700              DISPLAY  'SML:'  SU-SML-NUMBER   '  '               01770000
017800                       'DATE:' SU-DIVERT-DATE  '  '               01780000
017900                       'TIME:' SU-DIVERT-TIME  '  '               01790000
018000                       'TMST:' SUCRDV-DIVERT-TMST  '  '           01800000
018100                       'DOOR:' SUCRDV-DOOR-ID                     01810000
018200                                                                  01820000
018300         WHEN SQLCODE = +100                                      01830000
018400              PERFORM 8000-WRITE-EXTRACT                          01840000
018500                                                                  01850000
018600         WHEN SQLWARN0 NOT = SPACE                                01860000
018700         WHEN SQLCODE  NOT = ZERO                                 01870000
018800             MOVE '7030-CHECK-DIVERT'                             01880000
018900                                       TO PV-ABEND-PARAGRAPH      01890000
019000             MOVE 'SELECT'             TO PV-ABEND-OPERATION      01900000
019100             MOVE SU-SML-NUMBER                                   01910000
019200                                    TO PV-DB2-OPERATION-MESSAGE-1 01920000
019300             MOVE 'TSUCRDV' TO PV-ABEND-STRUCTURE-1               01930000
019400             PERFORM 9900-DB2-ABEND                               01940000
019500     END-EVALUATE.                                                01950000
019600                                                                  01960000
019700                                                                  01970000
019800 8000-WRITE-EXTRACT.                                              01980000
019801     MOVE  865                    TO  SU014-DC-NUMBER.            01980102
019802     MOVE  0                      TO  SU014-MESSAGE-SEQ-NUMBER.   01980202
019810     MOVE  SU-SML-NUMBER          TO  SU014-BAR-CODE.             01981002
019830     MOVE  SU-DOOR-ID             TO  SU014-DOOR-NUMBER.          01983002
019850     MOVE  SU-DIVERT-NBR          TO  SU014-DIVERT-NUMBER.        01985002
019851                                                                  01985103
019865     MOVE  SU-DIVERT-DATE-YY      TO  PV-DIVERT-YY-OUT.           01986503
019866     MOVE  SU-DIVERT-DATE-MM      TO  PV-DIVERT-MM-OUT.           01986603
019867     MOVE  SU-DIVERT-DATE-DD      TO  PV-DIVERT-DD-OUT.           01986703
019868                                                                  01986803
019869     MOVE  SU-DIVERT-TIME-HH      TO  PV-DIVERT-HOUR-OUT.         01986903
019870     MOVE  SU-DIVERT-TIME-MM      TO  PV-DIVERT-MIN-OUT.          01987003
019871     MOVE  SU-DIVERT-TIME-SS      TO  PV-DIVERT-SEC-OUT.          01987103
019872                                                                  01987203
019880     MOVE  PV-DATE-OUT            TO  SU014-DATE.                 01988003
019896     MOVE  PV-TIME-OUT            TO  SU014-TIME.                 01989603
019897     MOVE  ';'                    TO  SU014-CARRIAGE-RETURN.      01989702
019910                                                                  01991000
020000     ADD  1   TO  PV-COUNT-OUT                                    02000000
020010     DISPLAY SU014-CONV-DIVERT-RECORD                             02001002
020020                                                                  02002000
020100     WRITE SU-DIVERT-RECORD-OUT   FROM                            02010002
020200           SU014-CONV-DIVERT-RECORD.                              02020002
020300/                                                                 02030000
020400 9000-TERMINATE.                                                  02040000
020500                                                                  02050000
020600     CLOSE SU-DIVERT-FILE-IN                                      02060000
020700           SU-DIVERT-FILE-OUT.                                    02070000
020800                                                                  02080000
020900 9900-DB2-ABEND.                                                  02090000
021000                                                                  02100000
021100     MOVE SQLCODE TO PV-SQLCODE.                                  02110000
021200     DISPLAY '*** DB2 ERROR '.                                    02120000
021300     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       02130000
021400     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 02140000
021500     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               02150000
021600     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               02160000
021700     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       02170000
021800     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             02180000
021900                                                                  02190000
022000                                                                  02200000
022100     COPY DPPD004.                                                02210000
022200                                                                  02220000
022300                                                                  02230000
