000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.             IMKUT234.                                00050000
000600 AUTHOR.                 CHERI PARMLEY.                           00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            JUNE, 2015.                              00080000
000900 DATE-COMPILED.                                                   00090000
001000***************************************************************** 00100000
001100***************************************************************** 00110000
001200*                                                               * 00120000
001300*  THIS PROGRAM WILL CREATE AN EXTRACT FILE OF THE BRANDS ALONG * 00130000
001400*  WITH BRAND DESCRIPTION AND TYPE. IT WILL BE LOADED TO THE    * 00140000
001500*  XLT_BRND TABLE.                                              * 00150000
001200*                                                               * 00151000
001200*  IT WILL ALSO RUN AS A STEP IN THE INTEGRITY PROCESS TO LOAD  * 00152000
001200*  ALL THE BRANDS FOR COMPARISON WITH THE VSM FILE.             * 00153000
001600***************************************************************** 00160000
002500***************************************************************** 00170000
002600 ENVIRONMENT DIVISION.                                            00180000
002700***************************************************************** 00190000
002800                                                                  00200000
002900 CONFIGURATION SECTION.                                           00210000
003000                                                                  00220000
003100 SOURCE-COMPUTER.        IBM-3090.                                00230000
003200 OBJECT-COMPUTER.        IBM-3090.                                00240000
003300                                                                  00250000
003400 INPUT-OUTPUT SECTION.                                            00260000
003500                                                                  00270000
003600 FILE-CONTROL.                                                    00280000
003700*                                                                 00290000
004100     SELECT IM-EXTRACT-FILE                                       00300000
004200         ASSIGN TO OUT01.                                         00310000
004300*                                                                 00320000
004400***************************************************************** 00330000
004500 DATA DIVISION.                                                   00340000
004600***************************************************************** 00350000
004700*                                                                 00360000
004800 FILE SECTION.                                                    00370000
004900*                                                                 00380000
005700 FD  IM-EXTRACT-FILE                                              00390000
005800     RECORDING MODE IS F                                          00400000
005900     BLOCK CONTAINS 0  RECORDS.                                   00410000
006000 01  IM-EXTRACT-RECORD               PIC  X(050).                 00420000
006100*                                                                 00430000
006200                                                                  00440000
006300 WORKING-STORAGE SECTION.                                         00450000
006400*                                                                 00460000
006500 01  PROGRAM-SWITCHES.                                            00470000
006600     05  PS-END-OF-BRAND-CURSOR-SW PIC X(01)  VALUE 'N'.          00480000
006700         88  PS-END-OF-BRAND-CURSOR           VALUE 'Y'.          00490000
007800*                                                                 00600000
007900 01  PC-CONSTANTS.                                                00610000
008000     05  PC-3                        PIC S9(03)    VALUE +3       00620000
008100                                                   COMP-3.        00630000
008000     05  PC-Y                        PIC X(01)     VALUE 'Y'.     00640000
008000     05  PC-A                        PIC X(01)     VALUE 'A'.     00650000
008800*                                                                 00720000
008900 01  PV-MISC-FIELDS.                                              00730000
009200     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     00760000
009300                                                   COMP SYNC.     00770000
009400     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  00780000
009400     05  PV-RECORDS-WRITTEN          PIC  9(07)    VALUE ZEROES.  00790001
009800 EJECT                                                            00960000
009900*                                                                 00970000
010800******************************************************************00971000
010900*  EXTRACT COPY FOR XLKUP047 *                                    00972000
011000******************************************************************00973000
       01  XL065-BRAND-RECORD.                                          00974000
010600     COPY XLRD065.                                                00980000
010700                                                                  00990000
010800******************************************************************01000000
010900*  DCLGEN FOR TMDARVS TABLE *                                     01010000
011000******************************************************************01020000
011100     EXEC SQL                                                     01030000
011200          INCLUDE TMDARVS                                         01040000
011300     END-EXEC.                                                    01050000
010800******************************************************************01051000
010900*  DCLGEN FOR TVSCHVL TABLE *                                     01052000
011000******************************************************************01053000
011100     EXEC SQL                                                     01054000
011200          INCLUDE TVSCHVL                                         01055000
011300     END-EXEC.                                                    01056000
011400******************************************************************01060000
010900*  DCLGEN FOR IMT_LBL TABLE *                                     01062000
011000******************************************************************01063000
011100     EXEC SQL                                                     01064000
011200          INCLUDE IMT00000                                        01065000
011300     END-EXEC.                                                    01066000
011400******************************************************************01067000
021900 EJECT                                                            01070000
022000*  DB2 COMMUNICATION AREA                                         01080000
022100*                                                                 01090000
022200     EXEC SQL                                                     01100000
022300         INCLUDE SQLCA                                            01110000
022400     END-EXEC.                                                    01120000
022500 EJECT                                                            01130000
022600*  DB2 COMMUNICATION AREA2                                        01140000
022700*                                                                 01150000
022800     COPY SQLCA2.                                                 01160000
022900 EJECT                                                            01170000
023000                                                                  01180000
023100                                                                  01190000
023200     EXEC SQL                                                     01200000
023300       DECLARE BRND_CSR CURSOR FOR                                01210000
023400         SELECT DISTINCT                                          01220000
023500                A.LBL_SEQ_NBR                                     01231000
023510              , B.CHARTC_VAL_DESC                                 01240000
023520              , C.LBL_TYP_CDE                                     01250000
023800          FROM  TMDARVS A                                         01290000
                     ,TVSCHVL B                                         01291000
                     ,IMT_LBL C                                         01292000
                WHERE A.LBL_SEQ_NBR      = C.LBL_SEQ_NBR                01301100
                  AND A.LBL_SEQ_NBR      = B.CHARTC_SEQ_NBR             01302000
                  AND A.ACTV_IND         = :PC-Y                        01303000
                  AND B.STAT_CDE         = :PC-A                        01303100
024500            AND B.CHARTC_CDE       = :PC-3                        01304000
024600          ORDER BY A.LBL_SEQ_NBR                                  01310000
176760         WITH UR                                                  01311002
025800     END-EXEC.                                                    01320000
029600                                                                  01330000
029700*                                                                 01340000
029800 PROCEDURE DIVISION.                                              01350000
029900*                                                                 01360000
030000 0000-MAINLINE-PROCESSING.                                        01370000
030100******************************************************************01380000
030200**  THIS IS THE MAIN DRIVER FOR THE PROGRAM.                      01390000
030300******************************************************************01400000
           DISPLAY 'START IMKUT234 '.                                   01401001
                                                                        01402001
030500     OPEN OUTPUT IM-EXTRACT-FILE.                                 01410000
030800*                                                                 01420000
030900     PERFORM 2000-PROCESS-BRANDS.                                 01430000
031100                                                                  01440000
031300     CLOSE IM-EXTRACT-FILE.                                       01450000
031400*                                                                 01460000
031500     GOBACK.                                                      01470000
031600*                                                                 01480000
035200 2000-PROCESS-BRANDS.                                             01490000
035400     PERFORM 2100-OPEN-BRAND-CURSOR.                              01500000
035500                                                                  01510000
035600     PERFORM 2200-FETCH-BRAND-CURSOR                              01520000
035700                                                                  01530000
035800     PERFORM 2300-PROCESS-BRAND-CURSOR                            01540000
035900         UNTIL PS-END-OF-BRAND-CURSOR.                            01550000
036100                                                                  01570000
036200     PERFORM 2400-CLOSE-BRAND-CURSOR.                             01580000
036300                                                                  01590000
           DISPLAY 'EXTRACT RECORDS WRITTEN = ' PV-RECORDS-WRITTEN.     01591001
036310                                                                  01600000
036400 2100-OPEN-BRAND-CURSOR.                                          01610000
036500     MOVE '2100-OPEN-BRAND-CURSOR   '                             01620000
036600                                 TO PV-ABEND-PARAGRAPH.           01630000
036700     EXEC SQL                                                     01640000
036800         OPEN BRND_CSR                                            01650000
036900     END-EXEC.                                                    01660000
036910                                                                  01670000
037000     EVALUATE TRUE                                                01680000
037100       WHEN SQLCODE = ZEROS                                       01690000
037200         CONTINUE                                                 01700000
037700       WHEN OTHER                                                 01710000
037800         DISPLAY PV-ABEND-PARAGRAPH                               01720000
037900         PERFORM Z999-SQL-ERROR                                   01730000
038000     END-EVALUATE.                                                01740000
038100                                                                  01750000
038200 2200-FETCH-BRAND-CURSOR.                                         01760000
038300     MOVE '2200-FETCH-BRAND-CURSOR   '                            01770000
038400                                 TO PV-ABEND-PARAGRAPH.           01780000
038500     EXEC SQL                                                     01790000
038600          FETCH BRND_CSR                                          01800000
038700          INTO  :MDARVS-LBL-SEQ-NBR                               01801000
038800              , :VSCHVL-CHARTC-VAL-DESC                           01820000
038900              , :IMT00000-LBL-TYP-CDE                             01830000
039000     END-EXEC.                                                    01870000
039100                                                                  01880000
039200     EVALUATE TRUE                                                01890000
039300       WHEN SQLCODE = ZEROS                                       01900000
039400         CONTINUE                                                 01910000
039500       WHEN SQLCODE = +100                                        01920000
039600         SET PS-END-OF-BRAND-CURSOR TO TRUE                       01930000
040100       WHEN OTHER                                                 01940000
040200         DISPLAY PV-ABEND-PARAGRAPH                               01950000
040300         PERFORM Z999-SQL-ERROR                                   01960000
040400     END-EVALUATE.                                                01970000
040500                                                                  01980000
040600 2300-PROCESS-BRAND-CURSOR.                                       01990000
040610     INITIALIZE XL065-BRAND-RECORD.                               02000000
040620                                                                  02010000
040700     MOVE MDARVS-LBL-SEQ-NBR     TO XL065-BRND-ID.                02021000
040900     MOVE VSCHVL-CHARTC-VAL-DESC TO XL065-BRND-DESC.              02030000
040900     MOVE IMT00000-LBL-TYP-CDE   TO XL065-BRND-TYP-CDE.           02031000
041400                                                                  02220000
041900     PERFORM 8000-WRITE-EXTRACT-RECORD.                           02230000
042000     PERFORM 2200-FETCH-BRAND-CURSOR.                             02240000
042200                                                                  02260000
042300 2400-CLOSE-BRAND-CURSOR.                                         02270000
042400     MOVE '2400-CLOSE-BRAND-CURSOR   '                            02280000
042500                                 TO PV-ABEND-PARAGRAPH.           02290000
042600     EXEC SQL                                                     02300000
042700         CLOSE BRND_CSR                                           02310000
042800     END-EXEC.                                                    02320000
042900     EVALUATE TRUE                                                02330000
043000       WHEN SQLCODE = ZEROS                                       02340000
043100         CONTINUE                                                 02350000
043600       WHEN OTHER                                                 02360000
043700         DISPLAY PV-ABEND-PARAGRAPH                               02370000
043800         PERFORM Z999-SQL-ERROR                                   02380000
043900     END-EVALUATE.                                                02390000
044000                                                                  02400000
080200*                                                                 02410000
080300 8000-WRITE-EXTRACT-RECORD.                                       02420000
080400     WRITE IM-EXTRACT-RECORD                                      02430000
080500       FROM XL065-BRAND-RECORD.                                   02440000
           ADD 1 TO PV-RECORDS-WRITTEN.                                 02441001
080600*                                                                 02450000
080700******************************************************************02460000
080800*     SQL WARNING OR ERROR PROCESSING                            *02470000
080900*                                                                *02480000
081000******************************************************************02490000
081100                                                                  02500000
081200*                                                                 02510000
081300 Z999-SQL-ERROR.                                                  02520000
081400*---------------                                                  02530000
081500                                                                  02540000
081600     MOVE SQLCODE    TO SQLCODE2.                                 02550000
081700     MOVE SQLERRD(3) TO SQLERRD3.                                 02560000
081800     DISPLAY '** ABEND **       ** = SQLERROR'.                   02570000
081900     DISPLAY '** PROGRAM        ** = IMKUT234'.                   02580000
082000     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  02590000
082100     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  02600000
082200     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   02610000
082300     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  02620000
082400     EXEC SQL                                                     02630000
082500         COMMIT                                                   02640000
082600     END-EXEC.                                                    02650000
082700     MOVE +4013 TO PV-ABEND-CODE.                                 02660000
082800     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02670000
