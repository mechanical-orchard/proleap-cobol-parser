000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400 PROGRAM-ID.    XLKUT022.                                         00040000
000500 AUTHOR.        STEPHANIE HERON.                                  00050000
000600 INSTALLATION.  KOHLS.                                            00060000
000700 DATE-WRITTEN   FEB 2003.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900***************************************************************** 00090000
001000*  THIS BATCH DB2 PROGRAM READS THE FILE CREATED BY XLKUT011    * 00100000
001100*  CONTAINING UPC XREF INFORMATION.  THIS DATA IS INSERTED INTO * 00110000
001200*  THE XLT_SKU TABLE.                                           * 00120000
001400***************************************************************** 00130000
      *****************************************************************         
      * CHANGE DESCRIPTION                                                      
      *****************************************************************         
      * DATE  05/21/2010                                                        
      *  MADE BY: TOYAM SAIKH     TKID:TKMAX89                                  
      *  CHANGES ARE TAGGED AS TS 05/21/2010                                    
      *****************************************************************         
001500 ENVIRONMENT DIVISION.                                            00140000
001600 INPUT-OUTPUT SECTION.                                            00150000
001700                                                                  00160000
001800 FILE-CONTROL.                                                    00170000
001900                                                                  00180000
002000     SELECT SKU-UPDATE-FILE                                       00190000
002010         ASSIGN TO INP01.                                         00200000
002100                                                                  00210000
002200***************************************************************** 00220000
002300 DATA DIVISION.                                                   00230000
002400***************************************************************** 00240000
002500 FILE SECTION.                                                    00250000
002600                                                                  00260000
002700 FD  SKU-UPDATE-FILE                                              00270000
002800     RECORDING MODE IS F                                          00280000
002810     BLOCK CONTAINS 0 RECORDS                                     00281000
002900     LABEL RECORDS ARE STANDARD.                                  00282000
003000                                                                  00283000
003300 01  SKU-UPDATE-FILE-RECORD       PIC X(150).                     00284000
003700                                                                  00285000
003800                                                                  00286000
003900***************************************************************** 00287000
004000 WORKING-STORAGE SECTION.                                         00288000
004100                                                                  00289000
004200 01  PA-DB2-COMMIT-COUNT              PIC S9(09) VALUE +0         00290000
004201                                                    COMP-3.       00300000
004202 01  PS-PROGRAM-SWITCHES.                                         00310000
004300     05  PS-EOF-INPUT-SW              PIC X(01)  VALUE 'N'.       00320000
004400         88  PS-EOF-INPUT-YES                    VALUE 'Y'.       00330000
004500         88  PS-EOF-INPUT-NO                     VALUE 'N'.       00340000
004600                                                                  00350000
004700 01  PC-PROGRAM-CONSTANTS.                                        00360000
004800     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'XLKUT022'.00370000
005000                                                                  00380000
005100 01  PV-PROGRAM-VARIABLES.                                        00390000
005900     05  PV-RECORDS-READ              PIC  9(09) VALUE  0.        00400000
006000     05  PV-RECORDS-UPDATE            PIC  9(09) VALUE  0.        00410000
006100     05  PV-RECORDS-INSERTED          PIC  9(09) VALUE  0.        00410000
006400     05  PV-DISP-INTR-UPC-ID          PIC  9(09) VALUE  0.        00420000
006410     05  PV-DISP-UPC-ID               PIC  9(09) VALUE  0.        00420000
006500     05  PV-DISP-ITM-NBR              PIC  9(15) VALUE  0.        00430000
006600     05  PV-DISP-SKU                  PIC  9(08) VALUE  0.        00430000
006610     05  PV-DISP-STYL-ID              PIC  9(08) VALUE  0.        00430000
006700     05  PV-SQLCODE                   PIC  S9(9) VALUE +0.        00440000
006800     05  PV-DISP-SQLCODE              PIC ZZZZZZ9-.               00450000
006900                                                                  00460000
007000                                                                  00470000
007100 01  PV-ABEND-FIELDS.                                             00480000
007200     05  PV-ABEND-CODE                PIC  S9(4) VALUE +0         00490000
007300                                                 COMP SYNC.       00500000
007400     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'XLKUT022'.00510000
007500     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00520000
007600     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    00530000
007700     05  PV-ABEND-TABLE               PIC  X(12) VALUE SPACES.    00540000
007900     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    00550000
008000     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    00560000
008100     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    00570000
008200                                                                  00580000
008300                                                                  00590000
008400***********************************************************       00600000
008500*  COPYBOOK USED FOR THE SKU ERROR INPUT FILE             *       00610000
008600***********************************************************       00620000
008700     COPY XLRD008.                                                00630000
008800                                                                  00640000
008900***********************************************************       00650000
009000*  USED FOR DB2 ERROR MESSAGE BUILDING                    *       00660000
009100***********************************************************       00670000
009200     COPY DPWS004.                                                00680000
009300                                                                  00690000
009400***********************************************************       00700000
009500*  DB2 SQL COMMUNICATION AREA                             *       00710000
009600***********************************************************       00720000
009700     EXEC SQL                                                     00730000
009800          INCLUDE SQLCA                                           00740000
009900     END-EXEC.                                                    00750000
010000                                                                  00760000
010100***********************************************************       00770000
010200*  XLT_SKU TABLE                                          *       00780000
010300***********************************************************       00790000
010400     EXEC SQL                                                     00800000
010500          INCLUDE XLT00003                                        00810000
010600     END-EXEC.                                                    00820000
010700                                                                  00830000
010800***************************************************************** 00840000
010900 PROCEDURE DIVISION.                                              00850000
011000***************************************************************** 00860000
011100     DISPLAY '**** BEGINNING XLKUT022 ****'.                      00870000
011200     DISPLAY ' '.                                                 00880000
011300                                                                  00890000
011400     OPEN INPUT  SKU-UPDATE-FILE.                                 00900000
011500                                                                  00910000
011600     PERFORM 1000-READ-INPUT-FILE.                                00920000
011700                                                                  00930000
012100     PERFORM 2000-PROCESS-INPUT-FILE                              00940000
012200       UNTIL PS-EOF-INPUT-YES.                                    00950000
012300                                                                  00960000
012400     CLOSE SKU-UPDATE-FILE.                                       00970000
012500                                                                  00980000
012510     PERFORM 3000-TABLE-COMMIT.                                   00990000
012520                                                                  01000000
012600     DISPLAY '  INPUT SKU RECS READ    = ' PV-RECORDS-READ.       01010000
012700     DISPLAY '  XLT_SKU ROWS UPDATED   = ' PV-RECORDS-UPDATE.     01020000
012710     DISPLAY '  XLT_SKU ROWS INSERTED  = ' PV-RECORDS-INSERTED.   01020000
012800     DISPLAY ' '.                                                 01030000
012900     DISPLAY '****  END OF  XLKUT022  ****'.                      01040000
013000                                                                  01050000
013100     GOBACK.                                                      01060000
013200                                                                  01070000
013300                                                                  01080000
013400***************************************************************** 01090000
013500*  READ A UPC ADD EXTRACT RECORD THAT WILL BE USED TO UPDATE    * 01100000
013510*  A ROW OF DATA INTO THE XLT_SKU TABLE.                        * 01110000
013600***************************************************************** 01120000
013700 1000-READ-INPUT-FILE.                                            01130000
013800                                                                  01140000
013900     MOVE '1000-READ-INPUT-FILE    ' TO PV-ABEND-PARAGRAPH.       01150000
014000                                                                  01160000
014010     INITIALIZE XL008-SKU-RECORD                                  01170000
014011                PA-DB2-COMMIT-COUNT.                              01180000
014020                                                                  01190000
014100     READ SKU-UPDATE-FILE                                         01200000
014200          INTO XL008-SKU-RECORD                                   01210000
014300            AT END                                                01220000
014400               SET PS-EOF-INPUT-YES TO TRUE                       01230000
014500                                                                  01240000
014600            NOT AT END                                            01250000
014700               SET PS-EOF-INPUT-NO  TO TRUE                       01260000
014800               ADD +1 TO PV-RECORDS-READ                          01270000
014900     END-READ.                                                    01280000
015000                                                                  01290000
015100                                                                  01300000
015200***************************************************************** 01310000
015300*  LOAD THE INFORMATION FROM THE UPC ADD EXTRACT FILE INTO THE  * 01320000
015310*  HOST VARIABLES AND PERFORM A PARAGRAPH TO INSERT THE NEW ROW * 01330000
015320*  INTO THE XLT_SKU TABLE.                                      * 01340000
015400***************************************************************** 01350000
015500 2000-PROCESS-INPUT-FILE.                                         01360000
015600                                                                  01370000
015700     MOVE '2000-PROCESS-INPUT-FILE ' TO PV-ABEND-PARAGRAPH.       Ù1380000
015800                                                                  01390000
015900     IF XL008-FILE-INDICATOR = 'A'                                        
016000        PERFORM 2100-UPDATE-SKU-TABLE                                     
016100     END-IF.                                                              
017700                                                                  01490000
017800     PERFORM 1000-READ-INPUT-FILE.                                01500000
018500                                                                  01510000
018600                                                                  01520000
021600***************************************************************** 01530000
021700*  UPDATE THE SKU TABLE                                                 00
021800***************************************************************** 01550000
021900 2100-UPDATE-SKU-TABLE.                                           01560000
022000                                                                  01570000
022030     MOVE XL008-INTR-UPC-ID          TO XLT00003-INTR-UPC-ID.     01420000
022040     MOVE XL008-STYL-ID              TO XLT00003-STYL-ID.                 
022050     MOVE XL008-ITM-NBR              TO XLT00003-ITM-NBR.                 
022060     MOVE XL008-SKU-NBR              TO XLT00003-SKU-NBR.                 
022070     MOVE XL008-SKU-STAT-CDE         TO XLT00003-SKU-STAT-CDE.            
022071     MOVE XL008-SKU-STAT-DESC        TO XLT00003-SKU-STAT-DESC.           
022072     MOVE XL008-INNR-PK-QTY          TO XLT00003-INNR-PK-QTY.             
022073     MOVE XL008-OUTR-PK-QTY          TO XLT00003-OUTR-PK-QTY.             
022074     MOVE XL008-SKU-DESC             TO XLT00003-SKU-DESC.                
022075     MOVE XL008-KOHLS-SIZE-CDE       TO XLT00003-KOHLS-SIZE-CDE.          
022076     MOVE XL008-SIZE-DESC            TO XLT00003-SIZE-DESC.               
022077     MOVE XL008-NRF-CLOR-CDE         TO XLT00003-NRF-CLOR-CDE.            
022078     MOVE XL008-SHRT-CLOR-DESC       TO XLT00003-SHRT-CLOR-DESC.          
022079     MOVE XL008-CSTM-CLOR-DESC       TO XLT00003-CSTM-CLOR-DESC.          
022080     MOVE XL008-REGN-PRIC-IND        TO XLT00003-REGN-PRIC-IND.           
022081     MOVE XL008-KY-ITM-IND           TO XLT00003-KY-ITM-IND.              
022082     MOVE XL008-GP-CDE               TO XLT00003-GP-CDE.                  
      *TS 05/21/2010 BEG                                                        
           MOVE XL008-WHSE-RPLNT-IND    TO XLT00003-WHSE-RPLNT-IND.             
      *TS 05/21/2010 END                                                        
022090                                                                  01570000
      *TO INCLUDE THE NEW WAREHOUSE INDICATOR TO THE XLT_SKU TABLE*             
      *TS 05/21/2010                                                            
022100     EXEC SQL                                                     01580000
022200          UPDATE XLT_SKU                                                00
022300       SET   ITM_NBR        = :XLT00003-ITM-NBR                         00
022400            ,STYL_ID        = :XLT00003-STYL-ID                           
022500            ,SKU_NBR        = :XLT00003-SKU-NBR                           
022700            ,SKU_STAT_CDE   = :XLT00003-SKU-STAT-CDE                      
022800            ,SKU_STAT_DESC  = :XLT00003-SKU-STAT-DESC                     
022900            ,INNR_PK_QTY    = :XLT00003-INNR-PK-QTY                       
023000            ,OUTR_PK_QTY    = :XLT00003-OUTR-PK-QTY                       
023010            ,SKU_DESC       = :XLT00003-SKU-DESC                          
023020            ,KOHLS_SIZE_CDE = :XLT00003-KOHLS-SIZE-CDE                    
023030            ,SIZE_DESC      = :XLT00003-SIZE-DESC                         
023040            ,NRF_CLOR_CDE   = :XLT00003-NRF-CLOR-CDE                      
023050            ,SHRT_CLOR_DESC = :XLT00003-SHRT-CLOR-DESC                    
023060            ,CSTM_CLOR_DESC = :XLT00003-CSTM-CLOR-DESC                    
023070            ,REGN_PRIC_IND  = :XLT00003-REGN-PRIC-IND                     
023080            ,KY_ITM_IND     = :XLT00003-KY-ITM-IND                        
023090            ,GP_CDE         = :XLT00003-GP-CDE                            
                  ,LAST_UPD_TMST  = CURRENT TIMESTAMP                           
                  ,WHSE_RPLNT_IND = :XLT00003-WHSE-RPLNT-IND                    
023097       WHERE INTR_UPC_ID    = :XLT00003-INTR-UPC-ID                       
024010     END-EXEC.                                                    01760000
024100                                                                  01770000
024200     EVALUATE TRUE                                                01780000
024300         WHEN SQLCODE = ZERO                                      01790000
024400              ADD +1                 TO PV-RECORDS-UPDATE               00
024500              ADD +1                 TO PA-DB2-COMMIT-COUNT       01810000
024600              IF PA-DB2-COMMIT-COUNT > 200                              00
024700                  PERFORM 3000-TABLE-COMMIT                       01830000
024800                  MOVE 0 TO PA-DB2-COMMIT-COUNT                   01840000
024900              END-IF                                              01850000
025000         WHEN SQLCODE = +100                                      01860000
025001              MOVE XLT00003-ITM-NBR     TO PV-DISP-ITM-NBR                
025002              STRING ' ITEM NUMBER '   DELIMITED BY SIZE                13
025003                     PV-DISP-ITM-NBR    DELIMITED BY SIZE                 
025004                     ' NOT FOUND ON XLT_SKU        '                      
025005                                       DELIMITED BY SIZE                  
025006                                   INTO PV-DB2-OPERATION-MESSAGE-102670001
025007              DISPLAY '*** MESSAGE   = '                                  
025008                                        PV-DB2-OPERATION-MESSAGE-1        
025009              PERFORM 2200-INSERT-SKU                                     
025010         WHEN SQLCODE = -803                                      01860000
025011              MOVE XLT00003-INTR-UPC-ID TO PV-DISP-INTR-UPC-ID            
025012              STRING ' INTR UPC ID '   DELIMITED BY SIZE                13
025013                     PV-DISP-INTR-UPC-ID DELIMITED BY SIZE                
025014                     ' ALREADY EXISTS ON XLT_SKU ON UPDATE '              
025015                                       DELIMITED BY SIZE                  
025016                                   INTO PV-DB2-OPERATION-MESSAGE-102670001
025017              DISPLAY '*** MESSAGE   = '                                  
025018                                        PV-DB2-OPERATION-MESSAGE-1        
025019         WHEN SQLCODE NOT = +0                                    01880000
025020              MOVE '2100-UPDATE-XLT-UPC'                          01890000
025021                                     TO PV-ABEND-PARAGRAPH        01900000
025022              MOVE 'UPDATE XLT_SKU'                               01910000
025023                                     TO PV-ABEND-OPERATION        01920000
025030              MOVE XL008-ITM-NBR     TO PV-DISP-ITM-NBR           01930000
025500              STRING 'ITEM NUMBER: '          DELIMITED BY SIZE   01950000
025600                     PV-DISP-ITM-NBR          DELIMITED BY SIZE   01960000
026700                                   INTO PV-DB2-OPERATION-MESSAGE-101990000
026800                                                                  02000000
026900              MOVE 'XLT_SKU'         TO PV-ABEND-TABLE            02010000
027000              PERFORM Z999-SQL-ABEND                              02020000
027100     END-EVALUATE.                                                02030000
027200                                                                  02040000
027300                                                                  02050000
027400***************************************************************** 02060000
027500* INSERT TO XLT_SKU                                             * 02070000
027600***************************************************************** 02080000
027700 2200-INSERT-SKU.                                                 02090000
027800                                                                  02100000
      *TO INCLUDE THE NEW WAREHOUSE INDICATOR TO THE XLT_SKU TABLE*             
      *TS 05/21/2010                                                            
027801     EXEC SQL                                                     02210001
027802          INSERT                                                  02220001
027803          INTO  XLT_SKU                                           02230003
027804              ( INTR_UPC_ID                                       02309303
027805               ,STYL_ID                                           02309403
027806               ,ITM_NBR                                           02309503
027807               ,SKU_NBR                                           02309603
027808               ,SKU_STAT_CDE                                      02309703
027809               ,SKU_STAT_DESC                                     02309803
027810               ,INNR_PK_QTY                                       02309903
027811               ,OUTR_PK_QTY                                       02310003
027812               ,SKU_DESC                                          02311011
027813               ,KOHLS_SIZE_CDE                                    02312003
027814               ,SIZE_DESC                                         02313003
027815               ,NRF_CLOR_CDE                                      02314003
027816               ,SHRT_CLOR_DESC                                    02315003
027817               ,CSTM_CLOR_DESC                                    02316003
027818               ,REGN_PRIC_IND                                     02317003
027819               ,KY_ITM_IND                                        02318003
027820               ,GP_CDE                                            02319003
                     ,LAST_UPD_TMST                                             
                     ,WHSE_RPLNT_IND)                                           
027821          VALUES                                                  02320001
027822             (  :XLT00003-INTR-UPC-ID                             02399304
027823               ,:XLT00003-STYL-ID                                 02399403
027824               ,:XLT00003-ITM-NBR                                 02399503
027825               ,:XLT00003-SKU-NBR                                 02399603
027826               ,:XLT00003-SKU-STAT-CDE                            02399703
027827               ,:XLT00003-SKU-STAT-DESC                           02399803
027828               ,:XLT00003-INNR-PK-QTY                             02399903
027829               ,:XLT00003-OUTR-PK-QTY                             02400003
027830               ,:XLT00003-SKU-DESC                                02400111
027831               ,:XLT00003-KOHLS-SIZE-CDE                          02400203
027832               ,:XLT00003-SIZE-DESC                               02400303
027833               ,:XLT00003-NRF-CLOR-CDE                            02400403
027834               ,:XLT00003-SHRT-CLOR-DESC                          02400503
027835               ,:XLT00003-CSTM-CLOR-DESC                          02400603
027836               ,:XLT00003-REGN-PRIC-IND                           02400703
027837               ,:XLT00003-KY-ITM-IND                              02400803
027838               ,:XLT00003-GP-CDE                                  02400903
                     ,CURRENT TIMESTAMP                                         
                     ,:XLT00003-WHSE-RPLNT-IND)                                 
027839     END-EXEC.                                                    02401001
027840                                                                  02410001
027841     EVALUATE TRUE                                                02420001
027842         WHEN SQLCODE = ZERO                                      02430001
027843              ADD +1                 TO PV-RECORDS-INSERTED       02440001
027844         WHEN SQLCODE = -803                                      02441013
027845              MOVE XLT00003-INTR-UPC-ID TO PV-DISP-INTR-UPC-ID            
027848              STRING ' INTR UPC ID '   DELIMITED BY SIZE                13
027849                     PV-DISP-INTR-UPC-ID DELIMITED BY SIZE                
027850                     ' ALREADY EXISTS ON XLT_SKU ON INSERT '              
027851                                       DELIMITED BY SIZE                  
027853                                   INTO PV-DB2-OPERATION-MESSAGE-102670001
027854              DISPLAY '*** MESSAGE   = '                                  
027855                                        PV-DB2-OPERATION-MESSAGE-1        
027856         WHEN SQLCODE = -530                                      02441013
027857              MOVE XLT00003-ITM-NBR TO PV-DISP-ITM-NBR                    
027858              MOVE XLT00003-SKU-NBR TO PV-DISP-SKU                        
027859              MOVE XLT00003-STYL-ID TO PV-DISP-STYL-ID                    
027860              STRING ' SKU '           DELIMITED BY SIZE                13
027861                     PV-DISP-SKU       DELIMITED BY SIZE                  
027862                     ' NOT INSERTED DUE TO RI FOR STYLE '                 
027863                                       DELIMITED BY SIZE                  
027864                     PV-DISP-STYL-ID   DELIMITED BY SIZE                  
027865                                   INTO PV-DB2-OPERATION-MESSAGE-102670001
027866              DISPLAY '*** MESSAGE   = '                                  
027867                                        PV-DB2-OPERATION-MESSAGE-1        
027868         WHEN SQLCODE NOT = +0                                    02450001
027869              MOVE '2100-INSERT-XLT-SKU'                          02460003
027870                                     TO PV-ABEND-PARAGRAPH        02470001
027871              MOVE 'INSERT XLT_SKU'                               02480003
027872                                     TO PV-ABEND-OPERATION        02481001
027873              MOVE XLT00003-SKU-NBR  TO PV-DISP-SKU               02482109
027874              MOVE XLT00003-ITM-NBR  TO PV-DISP-ITM-NBR           02482210
027875              STRING 'ITEM NBR: '             DELIMITED BY SIZE   02550009
027876                     PV-DISP-ITM-NBR          DELIMITED BY SIZE   02560010
027877                     '  SKU NBR: '            DELIMITED BY SIZE   02610003
027878                     PV-DISP-SKU              DELIMITED BY SIZE   02620003
027879                                   INTO PV-DB2-OPERATION-MESSAGE-102670001
027880                                                                  02680001
027881              MOVE 'XLT_SKU'         TO PV-ABEND-TABLE            02690003
027882              PERFORM Z999-SQL-ABEND                              02700001
027883     END-EVALUATE.                                                02710001
027884                                                                  02720001
027885                                                                  02730001
027886***************************************************************** 02060000
027887* COMMIT THE PENDING TABLE CHANGES.                             * 02070000
027888***************************************************************** 02080000
027889 3000-TABLE-COMMIT.                                               02090000
027890                                                                  02100000
027900     EXEC SQL                                                     02110000
028000          COMMIT                                                  02120000
028100     END-EXEC.                                                    02130000
028200                                                                  02140000
028300                                                                  02150000
028400***************************************************************** 02160000
028500*  DISPLAY DB2 ERROR INFORMATION, ROLLBACK ANY PENDING CHANGES, * 02170000
028510*  AND ABEND THE PROGRAM.                                       * 02180000
028600***************************************************************** 02190000
028700 Z999-SQL-ABEND.                                                  02200000
028800                                                                  02210000
028900     MOVE SQLCODE            TO PV-SQLCODE.                       02220000
029000     MOVE PV-SQLCODE         TO PV-DISP-SQLCODE.                  02230000
029100     DISPLAY '*** DB2 ERROR '.                                    02240000
029200     DISPLAY '*** SQLCODE   = ' PV-DISP-SQLCODE.                  02250000
029300     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 02260000
029400     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               02270000
029500     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               02280000
029600     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       02290000
029700     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       02300000
029800     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       02310000
029900     DISPLAY '*** TABLE 1   = ' PV-ABEND-TABLE.                   02320000
030000                                                                  02330000
030100     COPY DPPD004.                                                02340000
030200                                                                  02350000
030300     MOVE +4013         TO PV-ABEND-CODE.                         02360000
030400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02370000
