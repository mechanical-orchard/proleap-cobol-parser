000100*************************                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*************************                                         00030000
000400 PROGRAM-ID.    APKUT047.                                         00040000
000500 AUTHOR.        JOYCE KNOKE - TCC.                                00050000
000600 DATE-WRITTEN.  08/25/97.                                         00060000
000700                                                                  00070000
000800***************************************************************** 00080000
000900*                                                               * 00090000
001000*        GENERATE AP TRANSACTIONS FOR EXPENSE INVOICES          * 00100000
001100*                                                               * 00110000
001200*    THIS PROGRAM SELECTS ALL EXPENSE INVOICES WHICH HAVE NOT   * 00120000
001300*    YET BEEN POSTED (STATUS OF 'EN') TO THE OPEN TO PAY AND    * 00130000
001400*    CREATES AP TRANSACTIONS AND INVOICE STATUS UPDATE RECORDS, * 00140000
001500*    WHICH WILL BE PASSED TO OTHER PROGRAMS.                    * 00150000
001600*    THE AP TRANSACTIONS WILL UPDATE THE PAYMENT HISTORY        * 00160000
001700*    DATABASE, WHILE THE STATUS UPDATES WILL UPDATE THE STATUS  * 00170000
001800*    ON EACH EXPENSE INVOICE PROCESSED TO INDICATE THAT IT HAS  * 00180000
001900*    BEEN POSTED TO OTP.                                        * 00190000
002000*                                                               * 00200000
002100***************************************************************** 00210000
002200*                                                               * 00220000
002300* DB2 TABLES:                                                   * 00230000
002400*  1. AP CONTROL TABLE                 (TAPCNTL)                * 00240000
002500*  2. INVOICE TABLE                    (TINVOIC)                * 00250000
002600*  3. INVOICE TERMS TABLE              (TINVCTM)                * 00260000
002700*  4. INVOICE CHARGES/ALLOWANCES TABLE (TALCHRG)                * 00270000
002800*  5. AP CHARGE TYPE TABLE             (TACCTYP)                * 00280000
002900*  6. EXTERNAL ENTERPRISE              (TEXTENT)                * 00290000
003000*  7. EXTERNAL ENTERPRISE NAME         (TENTNME)                * 00300000
003100*  8. AP TRANSACTION CODE              (TTRNCDE)                * 00310000
003200*  9. EXPENSE INVOICE TABLE            (TEXINVC)                * 00320000
003300* 10. AP VENDOR SPECIFICATION TABLE    (TAPVNDS)                * 00330000
003400*                                                               * 00340000
003500* OUTPUT:                                                       * 00350000
003600*  1. AP-TRANSACTION FILE              (COPYBOOK APRD040)       * 00360000
003700*  2. INVOICE-STATUS-UPDATE-FILE       (COPYBOOK APRD252)       * 00370000
003800*                                                               * 00380000
003900***************************************************************** 00390000
004000*   CHANGES:                                                    * 00400000
004100*                                                               * 00410000
004200*  DATE: 09/17/97                                               * 00420000
004300*     ADDED SELECT OF HOLD INDICATOR TO THE INVOICE CURSOR.     * 00430000
004400*     ADDED LOGIC TO PARAGRAPH E100 TO POPULATE THE AP040-HOLD- * 00440000
004500*     IND AND AP040-HOLD-DTE BASED ON THE VALUE IN THE HOLD     * 00450000
004600*     INDICATOR ON TINVOIC.                                     * 00460000
004700*  MADE BY:  NANCY EILBES                   PITS#:114211        * 00470000
004800*                                                               * 00480000
004900*  DATE: 06/16/98                                               * 00490000
005000*     RECOMPILED TO INCLUDE THE THE ADDITIONS OF TWO NEW ITEMS  * 00500000
005100*     IN APRD252.  THESE TWO FIELDS ARE THE AP-PRC-CDE AND      * 00510000
005200*     AP-PRC-DTE.                                               * 00520000
005300*  MADE BY:  ROBIN BERNOSKI                 WR/IR: 4164         * 00530000
005400*                                                               * 00540000
005500*  DATE: 10/20/98                                               * 00550000
005600*     PEOPLESOFT CONVERSION.  CHANGED THE SIZE OF THE AP-TRANS- * 00560000
005700*     ACTION-FILE FROM 450 TO 400.  THIS REFLECTS THE CHANGES TO* 00570000
005800*     DONE TO APRD040 FOR PEOPLESOFT.  SOME OF THE AP040- FIELD * 00580000
005900*     NAMES WERE CHANGED IN THE E100- PARAGRAPH DUE TO THE MOD- * 00590000
006000*     IFIED COPYBOOK.  THE SIZE OF THE INVOICE ID STORED IN     * 00600000
006100*     PEOPLESOFT IS 16 INSTEAD OF 10 ON THE IMS DATABASE.  THE  * 00610000
006200*     CALCULATION WAS MODIFIED IN THE F100- PARAGRAPH TO REFLECT* 00620000
006300*     THIS CHANGE.                                              * 00630000
006400*  MADE BY:  MIKE BESKE                     WR/IR: 5998         * 00640000
006500*                                                               * 00650000
006600*  DATE: 04/16/99                                               * 00660000
006700*     ADDED ENTRY NUMBER TO DESCRIPTION FROM TEXINVC TABLE      * 00670000
006800*  MADE BY:  JILL JUEL                      WR/IR: 5998         * 00680000
006900*                                                               * 00690000
007000*  DATE: 05/03/99                                               * 00700000
007100*     ADDED LOGIC TO PUT A DIFFERENT ORIGIN CODE ON PREPAID     * 00710000
007200*     INVOICES (THOSE WHERE AUTO POSTING INDICATOR IS 'N').     * 00720000
007300*  MADE BY:  NANCY EILBES                   WR/IR: 5998         * 00730000
007400*                                                               * 00740000
007500*  DATE: 08/24/99                                               * 00750000
007600*     APWS051 EXPANDED TO INCLUDE CENTURY.  CHANGED RETURN-DATE * 00760000
007700*     MOVE TO USE NEW FIELD.                                    * 00770000
007800*  MADE BY:  L SCHALLHORN                   WR/IR: 6041         * 00780000
007900*                                                               * 00790000
008000*  DATE: 04/03/00                                               * 00800000
008100*     MODIFIED PROGRAM TO SELECT THE VALUE IN PAYT-FLOAT-DAY-QTY* 00810000
008200*     FROM TAPVNDS SO THAT THE FLOAT DAYS WOULD BE VENDOR       * 00820000
008300*     DEFINED.  IF NO ROW IS FOUND ON TAPVNDS THEN THE          * 00830000
008400*     PAYT-FLOAT-DAY-QTY FROM TAPCNTL IS USED.                  * 00840000
008500*  MADE BY:  ROBIN BERNOSKI                 WR/IR: 20704        * 00850000
008600*                                                               * 00860000
008700*  DATE: 08/11/00                                               * 00870000
008800*     THE EXPENSE INVOICE TABLE (TEXINVC) HAS BEEN EXPANDED     * 00880000
008900*     WITH A NEW COLUMN WHICH WILL CONTAIN A 'BOL' BILL OF      * 00890000
009000*     LADING NUMBER.                                            * 00900000
009100*                                                               * 00910000
009200*     MODIFY THE PROGRAM LOGIC TO RETRIEVE THE 'BOL' NUMBER     * 00920000
009300*     WHERE IT EXISTS AND LOAD IT INTO THE COMMENT AREA OF THE  * 00930000
009400*     TRANSACTION IT IS BUILDING TO INTERFACE TO PEOPLESOFT.    * 00940000
009500*                                                               * 00950000
009600*     COPY BOOK 'APRD040'.                                      * 00960000
009700*                                                               * 00970000
009800*     THE OUTPUT TRANSACTION RECORD WILL REQUIRE THE DUAL USAGE * 00980000
009900*     OF THE AP040-RSN-TXT FIELD. THIS FIELD WILL CONTAIN       * 00990000
010000*     EITHER THE 'EXINVC-IMPRT-ENTR-NBR' OR THE                 * 01000000
010100*     'EXINVC-IMPRT-BOL-ID' VALUES IF EITHER APPLY. THEY ARE    * 01010000
010200*     MUTIALLY EXCLUSIVE FIELDS.                                * 01020000
010300*  MADE BY:  W A EHMKE                      WR/IR: 201186       * 01030000
010400*                                                               * 01040000
010500*  DATE: 11/10/2000                                             * 01050000
010600*    ADDED LOGIC TO PROCESS THE NEW MOS-DISC AND ADV-DISC       * 01060000
010700*    FIELDS. THE NEW FIELDS ARE HANDLED THE SAME WAY THE NEW    * 01070000
010800*    STORE DISCOUNT IS HANDLED.                                 * 01080000
010900* MADE BY: JILL JUEL                   WR/IR #: 20224           * 01090000
011000*                                                               * 01100000
011100* DATE: 07/24/2001                                              * 01110000
011200*    INCREASED SIZE OF OUTPUT FILE AP-TRANSACTION-FILE TO 500.  * 01120000
011300*    THIS CHANGE WAS MADE BECAUSE COPYBOOK APRD040 WAS          * 01130000
011400*    INCREASED TO 500.                                          * 01140000
011500* MADE BY: ALEXIS KEIKER               WR/IR #: 22467           * 01150000
011600*                                                               * 01160000
011700* DATE: 01/21/2002                                              * 01170000
011800*     ADDED CODE TO FORMAT THE ENTRY NUMBER AND IMPORT BILL OF  * 01180000
011900*     LADING NUMBER IN THE REASON TEXT.                         * 01190000
012000* MADE BY:  ALEXIS KEIKER                  WR/IR: 20530         * 01200000
012100*                                                               * 01210000
012200* DATE: 04/16/2002                                              * 01220000
012300*     ADDED MISSING END-IF WHICH CAUSED THE BOL NUMBER TO NOT   * 01230000
012400*     BE MOVED TO THE REASON TEXT WHEN THERE WAS ONLY A BOL AND * 01240000
012500*     NOT A ENTRY NUMBER.                                       * 01250000
012600* MADE BY:  NANCY EILBES                   WR/IR: 462538        * 01260000
012700*                                                               * 01270000
012800* DATE: 06/17/2002                                              * 01280000
012900*     ARK PO PROJECT PHASE 1.  REMOVE TABLE TPAYREQ FROM        * 01290000
013000*     INVOICE_CSR AND REPLACED REFERENCES TO TPAYREQ DCLGENS    * 01300000
013100*     WITH NEW TINVOIC DCLGENS.  ELIMINATED ALL REFERENCES TO   * 01310000
013200*     ENTR-TRMNL-ID.  IN C100, REPLACED AP252-PAY-REQ-SEQ-NBR   * 01320000
013300*     WITH AP252-PO-NBR.                                        * 01330000
013400* MADE BY:  KEVIN CATLIN                   WR/IR: 23500         * 01340000
013500*                                                               * 01350000
013600* DATE: 07/17/2002                                              * 01360000
013700*     ARK PO PROJECT PHASE 1.  CHANGED SELECT FROM TEXINVC TO   * 01370000
013800*     USE PO NUMBER AND INVOICE ID IN PLACE OF PAYT-REQ-SEQ-NBR.* 01380000
013900*     CHANGE TO BE INSTALLED WITH PHASE 2 CHANGES BELOW.        * 01390000
014000* MADE BY: NANCY EILBES                    WR/IR: 23500         * 01400000
014100*                                                               * 01410000
014200* DATE: 07/07/2002                                              * 01420000
014300*     ARK PO PROJECT PHASE 2.  REMOVED REFERENCES TP PAYMENT    * 01430000
014400*     REQUEST NUMBER IN THE INVOICE CURSOR AND THEN ALLOWANCE   * 01440000
014500*     CHARGE CURSOR BECAUSE IT WIL NO LONGER BE USED.  ADDED    * 01450000
014600*     PO NUMBER AND INVOICE ID IN IT'S PLACE.                   * 01460000
014700* MADE BY: BRIAN HASSLINGER                WR/IR: 23500         * 01470000
014800*                                                               * 01480000
014900* DATE: 11/04/2002                                              * 01490000
015000*     COLBY DATING PROJECT.                                     * 01500000
015100*     ADDED EFFECTIVE DATING TO THE ALWCHRG_CSR USING THE       * 01510000
015200*     INVOIC_INVC_DTE. ALSO MODIFIED CODE TO HANDLE THE A       * 01520000
015300*     REWORKED APRD252 COPYBOOK.                                * 01530000
015400* MADE BY: MIKE BESKE                      WR/IR: 23750         * 01540000
015500*                                                               * 01550000
015600* DATE: 04/22/2004                                              * 01560000
015700*     INCREASED THE LENGTH OF PV-STR-NBR TO S9(4) FROM 9(03)    * 01570000
015800*     AS PART OF THE STORE CONSTRAINTS PROJECT.                 * 01580000
015900* MADE BY: MIKE BESKE                      WR/IR: 25805         * 01590000
015910*                                                               * 01591000
015920* DATE: 10/28/2004                                              * 01592000
015930*     CORRECT MOVE OF HOLD INDICATOR. IT WAS NOT BEING MOVED    * 01593000
015940*     TO THE OUTPUT RECORD.                                     * 01594000
015950* MADE BY: L SCHALLHORN                    WR/IR: P000706185    * 01595000
015951*                                                               * 01595100
015952* DATE: 09/26/2006                                              * 01595200
015953*     RECOMPILE FROM PRODUCTION TO PICK UP THE NEW FIELD        * 01595300
015954*     AP040-SEPARATE-CHCK IN THE APRD040 COPYBOOK.              * 01595400
015955* MADE BY: KRYSTEN LEARY                   WR/IR: WR31177       * 01595500
015956*                                                               * 01595600
015957* DATE: 03/22/2007                                              * 01595700
015958*     RECOMPILE FROM PRODUCTION TO PICK UP THE NEW FIELDS       * 01595800
015959*     AP040-WTHD-SETID, AP040-WTHD-SW, AND AP040-WTHD-CD IN THE * 01595900
015960*     APRD040 COPYBOOK.                                         * 01596000
015970* MADE BY: KRYSTEN LEARY                   WR/IR: WR32060       * 01597000
015980*                                                                 01598000
015990* DATE: 01/04/2010                                              * 01599000
015991*     CHANGED LOGIC IN PARAGRAPH E100 TO INCLUDE DATA FROM THE  * 01599100
015992*     NEW TEXINVC COLUMNS WHEN WRITING TO AP040-RSN-TXT. NEW    * 01599200
015993*     COLUMNS ARE FOR CONTAINER ID AND BROKER REFERENCE NUMBER  * 01599300
015994* MADE BY: PAUL STROEDE                    WR/IR: WR23145       * 01599400
015995*                                                                 01599500
015996* DATE: 03/04/2019                                              * 01599600
015997*     CHANGED LOGIC IN PARAGRAPH E100 TO INITIALIZE NEW DISCOUNT* 01599701
015998*     FIELDS FROM APRD040 COPYBOOK. (AP040-COOP-DISC,           * 01599801
015999*     AP040-ALW-DISC, AP040-MSC-DISC)                           * 01599903
016000* MADE BY: GERMAN BANDA                    CHANGE: CHG0220043   * 01600003
016001***************************************************************** 01600100
016002 EJECT                                                            01600200
016003                                                                  01600300
016004 ENVIRONMENT DIVISION.                                            01600400
016005 CONFIGURATION SECTION.                                           01600500
016006 SOURCE-COMPUTER. IBM-3090.                                       01600600
016007 OBJECT-COMPUTER. IBM-3090.                                       01600700
016008                                                                  01600800
016009*                                                                 01600900
016010 INPUT-OUTPUT SECTION.                                            01601000
016020 FILE-CONTROL.                                                    01602000
016030*                                                                 01603000
016040     SELECT AP-TRANSACTION-FILE        ASSIGN TO UT-S-OUT01.      01604000
016050*                                                                 01605000
016060     SELECT INVOICE-STATUS-UPDATE-FILE ASSIGN TO UT-S-OUT02.      01606000
016070*                                                                 01607000
016080 DATA DIVISION.                                                   01608000
016090 FILE SECTION.                                                    01609000
016100*                                                                 01610000
016200 FD  AP-TRANSACTION-FILE                                          01620000
016300     RECORDING MODE IS F                                          01630000
016400     BLOCK CONTAINS 0 CHARACTERS                                  01640000
016500     LABEL RECORDS ARE STANDARD                                   01650000
016600     DATA RECORD IS AP-TRANSACTION-RECORD.                        01660000
016700*                                                                 01670000
016800 01  AP-TRANSACTION-RECORD               PIC X(500).              01680000
016900*                                                                 01690000
017000 FD  INVOICE-STATUS-UPDATE-FILE                                   01700000
017100     RECORDING MODE IS F                                          01710000
017200     BLOCK CONTAINS 0 CHARACTERS                                  01720000
017300     LABEL RECORDS ARE STANDARD                                   01730000
017400     DATA RECORD IS INVOICE-STATUS-UPDATE-RECORD.                 01740000
017500*                                                                 01750000
017600 01  INVOICE-STATUS-UPDATE-RECORD        PIC X(80).               01760000
017700*                                                                 01770000
017800 EJECT                                                            01780000
017900 WORKING-STORAGE SECTION.                                         01790000
018000                                                                  01800000
018100 01  PC-PROGRAM-CONSTANTS.                                        01810000
018200     05  PC-RETRY-MAX            PIC S9(04)  VALUE +3             01820000
018300                                             COMP SYNC.           01830000
018400     05  PC-RETRY-COUNT          PIC S9(04)  VALUE ZEROS.         01840000
018500     05  PC-WS-PROGRAM           PIC  X(40)  VALUE                01850000
018600         '**** WORKING STORAGE ** APKUT047 ****'.                 01860000
018700     05  PC-CO-FRGT-PCT          PIC  S9(03)V99  COMP-3           01870000
018800                                             VALUE +100.00.       01880000
018900     05  PC-TERM-SEQ             PIC  S9(04) VALUE 01  COMP.      01890000
019000     05  PC-DLT-IND              PIC  9(02)  VALUE ZEROS.         01900000
019100     05  PC-VENDOR-NF            PIC  X(15)  VALUE                01910000
019200                                             'VENDR NOT FOUND'.   01920000
019300                                                                  01930000
019400 01  PV-PROGRAM-VARIABLES.                                        01940000
019500     05  PV-CURRENT-PARAGRAPH    PIC  X(35).                      01950000
019600     05  PV-DUE-DATE-CCYY-MM-DD  PIC  X(10)    VALUE SPACES.      01960000
019700     05  PV-HOLD-DUN-NBR         PIC  X(09)    VALUE SPACES.      01970000
019800     05  PV-SEQ-NBR              PIC  9(01)    VALUE ZEROS.       01980000
019900     05  PV-SEQ-NBR-R   REDEFINES   PV-SEQ-NBR                    01990000
020000                                 PIC  X(01).                      02000000
020100     05  PV-VENDOR-NAME          PIC  X(30)    VALUE SPACES.      02010000
020200     05  PV-INVOICE-ID           PIC  X(16)    VALUE SPACES.      02020000
020300     05  HOLD-INVOICE-ID         PIC  X(16)    VALUE SPACES.      02030000
020400     05  PV-START                PIC S9(04)    VALUE +0           02040000
020500                                               COMP.              02050000
020600     05  PV-INVOICE-COUNT        PIC S9(9)     VALUE ZEROS        02060000
020700                                               COMP.              02070000
020800     05  PV-AP-TRAN-COUNT        PIC S9(9)     VALUE ZEROS        02080000
020900                                               COMP.              02090000
021000     05  PV-INV-STAT-COUNT       PIC S9(9)     VALUE ZEROS        02100000
021100                                               COMP.              02110000
021200     05  PV-STR-NBR              PIC S9(4)     VALUE ZEROS.       02120000
021300     05  PV-COMM-POS             PIC 9(03)     VALUE ZEROS.       02130000
021400     05  PV-PO-NBR               PIC 9(09)     VALUE ZEROS.       02140000
021500     05  PV-PO-NBR-R   REDEFINES   PV-PO-NBR                      02150000
021600                                 PIC X(09).                       02160000
021700     05  PV-PS-BTCH-NBR          PIC  X(15).                      02170000
021800     05  PV-PS-BTCH-NBR-RED REDEFINES PV-PS-BTCH-NBR.             02180000
021900         10  PV-PS-BTCH-NBR-DTE  PIC  X(10).                      02190000
022000         10  PV-PS-BTCH-NBR-SRC-CDE                               02200000
022100                                 PIC  X(03).                      02210000
022200         10  PV-PS-BTCH-NBR-SEQ-NBR                               02220000
022300                                 PIC  X(02).                      02230000
022400                                                                  02240000
022500 01  PS-PROGRAM-SWITCHES.                                         02250000
022600     05  PS-END-INVOICES-SW      PIC  X(01)  VALUE ' '.           02260000
022700         88  PS-END-INVOICES                 VALUE 'Y'.           02270000
022800         88  PS-MORE-INVOICES                VALUE ' '.           02280000
022900     05  PS-END-ALW-CHARGES-SW   PIC  X(01)  VALUE ' '.           02290000
023000         88  PS-END-ALW-CHARGES              VALUE 'Y'.           02300000
023100         88  PS-MORE-ALW-CHARGES             VALUE ' '.           02310000
023200     05  PS-END-MONTH-SW         PIC  X(01)  VALUE ' '.           02320000
023300         88  PS-END-MONTH                    VALUE 'Y'.           02330000
023400         88  PS-NOT-END-MONTH                VALUE ' '.           02340000
023500     05  PS-FLOAT-DAY-SW         PIC  X(01)  VALUE ' '.           02350000
023600         88  TAPVNDS-FLOAT-DAY-FOUND         VALUE 'Y'.           02360000
023700         88  TAPVNDS-FLOAT-DAY-NOT-FOUND     VALUE ' '.           02370000
023800                                                                  02380000
023900/                                                                 02390000
024000*                                                                 02400000
024100*    DATE ROUTINE NEEDED IN APPD051                               02410000
024200*                                                                 02420000
024300     COPY DPWS500.                                                02430000
024400/                                                                 02440000
024500*                                                                 02450000
024600*    AP TRANSACTION FILE                                          02460000
024700*                                                                 02470000
024800     COPY APRD040.                                                02480000
024900/                                                                 02490000
025000*                                                                 02500000
025100*    INVOICE STATUS UPDATE FILE                                   02510000
025200*                                                                 02520000
025300     COPY APRD252.                                                02530000
025400/                                                                 02540000
025500*                                                                 02550000
025600*    TAPCNTL DCLGEN                                               02560000
025700*                                                                 02570000
025800     EXEC SQL                                                     02580000
025900         INCLUDE TAPCNTL                                          02590000
026000     END-EXEC.                                                    02600000
026100/                                                                 02610000
026200*                                                                 02620000
026300*    TINVOIC DCLGEN                                               02630000
026400*                                                                 02640000
026500     EXEC SQL                                                     02650000
026600         INCLUDE TINVOIC                                          02660000
026700     END-EXEC.                                                    02670000
026800/                                                                 02680000
026900*                                                                 02690000
027000*    TINVCTM DCLGEN                                               02700000
027100*                                                                 02710000
027200     EXEC SQL                                                     02720000
027300         INCLUDE TINVCTM                                          02730000
027400     END-EXEC.                                                    02740000
027500/                                                                 02750000
027600*                                                                 02760000
027700*    TALCHRG DCLGEN                                               02770000
027800*                                                                 02780000
027900     EXEC SQL                                                     02790000
028000         INCLUDE TALCHRG                                          02800000
028100     END-EXEC.                                                    02810000
028200/                                                                 02820000
028300*                                                                 02830000
028400*    TACCTYP DCLGEN                                               02840000
028500*                                                                 02850000
028600     EXEC SQL                                                     02860000
028700         INCLUDE TACCTYP                                          02870000
028800     END-EXEC.                                                    02880000
028900/                                                                 02890000
029000*                                                                 02900000
029100*    TEXTENT DCLGEN                                               02910000
029200*                                                                 02920000
029300     EXEC SQL                                                     02930000
029400         INCLUDE TEXTENT                                          02940000
029500     END-EXEC.                                                    02950000
029600/                                                                 02960000
029700*                                                                 02970000
029800*    TENTNME DCLGEN                                               02980000
029900*                                                                 02990000
030000     EXEC SQL                                                     03000000
030100         INCLUDE TENTNME                                          03010000
030200     END-EXEC.                                                    03020000
030300/                                                                 03030000
030400*                                                                 03040000
030500*    TTRNCDE DCLGEN                                               03050000
030600*                                                                 03060000
030700     EXEC SQL                                                     03070000
030800         INCLUDE TTRNCDE                                          03080000
030900     END-EXEC.                                                    03090000
031000/                                                                 03100000
031100*                                                                 03110000
031200*    TEXINVC DCLGEN                                               03120000
031300*                                                                 03130000
031400     EXEC SQL                                                     03140000
031500         INCLUDE TEXINVC                                          03150000
031600     END-EXEC.                                                    03160000
031700                                                                  03170000
031800/                                                                 03180000
031900*                                                                 03190000
032000*    TAPVNDS DCLGEN                                               03200000
032100*                                                                 03210000
032200     EXEC SQL                                                     03220000
032300         INCLUDE TAPVNDS                                          03230000
032400     END-EXEC.                                                    03240000
032500                                                                  03250000
032600*                                                                 03260000
032700*    SQL COMMUNICATIONS AREA DCLGEN                               03270000
032800*                                                                 03280000
032900     EXEC SQL                                                     03290000
033000         INCLUDE SQLCA                                            03300000
033100     END-EXEC.                                                    03310000
033200/                                                                 03320000
033300***************************************************************** 03330000
033400*         CURSOR DECLARATIONS                                     03340000
033500***************************************************************** 03350000
033600* INVOICE_CSR RETURNS ALL EXPENSE INVOICE WHICH HAVE A STATUS     03360000
033700* OF 'EN' (ENTERED).                                              03370000
033800***************************************************************** 03380000
033900     EXEC SQL                                                     03390000
034000         DECLARE INVOICE_CSR CURSOR                               03400000
034100             FOR SELECT                                           03410000
034200                 IV.RMIT_VND_ID                                   03420000
034300                ,IV.CRE_DTE                                       03430000
034400                ,IV.CRE_BY_USR_ID                                 03440000
034500                ,IV.PO_NBR                                        03450000
034600                ,IV.INVC_ID                                       03460000
034700                ,IV.STR_NBR                                       03470000
034800                ,IV.INVC_TYP_CDE                                  03480000
034900                ,IV.INVC_DTE                                      03490000
035000                ,IV.HOLD_IND                                      03500000
035100                ,IV.BAR_CDE                                       03510000
035200                ,IV.CALC_DUE_DTE                                  03520000
035300                ,IM.TERM_TYP_CDE                                  03530000
035400                ,IM.DISC_PCT                                      03540000
035500                ,IM.DISC_DUE_DAY_QTY                              03550000
035600                ,IM.NET_DUE_DAY_QTY                               03560000
035700                ,IM.EXTD_DAYS_QTY                                 03570000
035800             FROM                                                 03580000
035900                 TINVOIC IV                                       03590000
036000                ,TINVCTM IM                                       03600000
036100             WHERE IV.PO_NBR          = IM.PO_NBR                 03610000
036200               AND IV.INVC_ID         = IM.INVC_ID                03620000
036300               AND IV.INVC_TYP_CDE    = 'EI'                      03630000
036400               AND IV.STATUS_CDE      = 'EN'                      03640000
036500               AND IM.TERM_SEQ_NBR    = :PC-TERM-SEQ              03650000
036600             ORDER BY                                             03660000
036700                   IV.RMIT_VND_ID                                 03670000
036800                  ,IV.PO_NBR                                      03680000
036900                  ,IV.INVC_ID                                     03690000
037000     END-EXEC.                                                    03700000
037100/                                                                 03710000
037200***************************************************************** 03720000
037300* ALW_CHRG_CSR RETRIEVES ALL CHARGES AND CORRESPONDING ACCOUNT    03730000
037400* NUMBERS, FOR AN EXPENSE INVOICE.                                03740000
037500***************************************************************** 03750000
037600     EXEC SQL                                                     03760000
037700       DECLARE ALW_CHRG_CSR CURSOR FOR                            03770000
037800         SELECT AC.ALW_CHRG_AMT                                   03780000
037900               ,AT.GL_ACCT_NBR                                    03790000
038000               ,AT.AUTO_OTP_PSTG_IND                              03800000
038100            FROM TALCHRG AC                                       03810000
038200                ,TACCTYP AT                                       03820000
038300            WHERE AC.PO_NBR           = :INVOIC-PO-NBR            03830000
038400              AND AC.INVC_ID          = :INVOIC-INVC-ID           03840000
038500              AND AC.ALW_CHRG_CDE     =  AT.ALW_CHRG_CDE          03850000
038600             AND :INVOIC-INVC-DTE BETWEEN AT.EFF_STRT_DTE         03860000
038700                                      AND AT.EFF_END_DTE          03870000
038800     END-EXEC.                                                    03880000
038900                                                                  03890000
039000***************************************************************** 03900000
039100*  WORKING STORAGE AREA FOR APPD051                               03910000
039200***************************************************************** 03920000
039300     COPY APWS051.                                                03930000
039400/                                                                 03940000
039500***************************************************************** 03950000
039600*  ABEND DATA AREAS                                               03960000
039700***************************************************************** 03970000
039800 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          03980000
039900                                             COMP SYNC.           03990000
040000     88  AC-DB2-ERROR                        VALUE +4013.         04000000
040100                                                                  04010000
040200                                                                  04020000
040300 01  ABEND-AREAS.                                                 04030000
040400     05  AA-ABEND-LIT            PIC  X(40)  VALUE                04040000
040500             '*****       ABEND'.                                 04050000
040600     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                04060000
040700             '*****   PROGRAM: APKUP253'.                         04070000
040800     05  AA-PARAGRAPH-LIT.                                        04080000
040900         10  FILLER              PIC  X(17)  VALUE                04090000
041000             '***** PARAGRAPH: '.                                 04100000
041100         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        04110000
041200     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                04120000
041300             '*****    DB2 ERROR'.                                04130000
041400     05  AA-DB2-OPERATION-LIT.                                    04140000
041500         10  FILLER              PIC  X(17)  VALUE                04150000
041600             '***** OPERATION: '.                                 04160000
041700         10  AA-DB2-OPERATION    PIC  X(75)  VALUE SPACES.        04170000
041800     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        04180000
041900     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        04190000
042000     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        04200000
042100                                                                  04210000
042200/                                                                 04220000
042300***************************************************************** 04230000
042400*  SQLCA FORMATTED MESSAGE AREA                                   04240000
042500***************************************************************** 04250000
042600     COPY DPWS004.                                                04260000
042700*                                                                 04270000
042800/                                                                 04280000
042900 01  FILLER                      PIC  X(35)  VALUE                04290000
043000     '**** END OF W/S ** APKUT047 ****'.                          04300000
043100 EJECT                                                            04310000
043200                                                                  04320000
043300 PROCEDURE DIVISION.                                              04330000
043400                                                                  04340000
043500     PERFORM A100-MAINLINE.                                       04350000
043600     GOBACK.                                                      04360000
043700                                                                  04370000
043800 EJECT                                                            04380000
043900 A100-MAINLINE.                                                   04390000
044000                                                                  04400000
044100     MOVE 'A100-MAINLINE' TO PV-CURRENT-PARAGRAPH.                04410000
044200                                                                  04420000
044300     PERFORM B100-INITIALIZE.                                     04430000
044400                                                                  04440000
044500     PERFORM B200-PROCESS-INVOICES                                04450000
044600         UNTIL PS-END-INVOICES.                                   04460000
044700                                                                  04470000
044800     PERFORM B300-END-OF-PROGRAM.                                 04480000
044900                                                                  04490000
045000 EJECT                                                            04500000
045100***************************************************************** 04510000
045200*    INITIALIZATION PROCESSING                                    04520000
045300***************************************************************** 04530000
045400 B100-INITIALIZE.                                                 04540000
045500                                                                  04550000
045600     MOVE 'B100-INITIALIZE' TO PV-CURRENT-PARAGRAPH.              04560000
045700                                                                  04570000
045800     OPEN OUTPUT AP-TRANSACTION-FILE                              04580000
045900                 INVOICE-STATUS-UPDATE-FILE.                      04590000
046000                                                                  04600000
046100     INITIALIZE DCLTAPCNTL                                        04610000
046200                DCLTINVOIC                                        04620000
046300                DCLTINVCTM                                        04630000
046400                DCLTALCHRG                                        04640000
046500                DCLTACCTYP                                        04650000
046600                DCLTEXTENT                                        04660000
046700                DCLTENTNME                                        04670000
046800                DCLTEXINVC                                        04680000
046900                DCLTTRNCDE.                                       04690000
047000                                                                  04700000
047100     INITIALIZE PS-PROGRAM-SWITCHES.                              04710000
047200                                                                  04720000
047300     PERFORM S100-SELECT-AP-CONTROL.                              04730000
047400                                                                  04740000
047500     MOVE APCNTL-BTCH-PRC-DTE     TO PV-PS-BTCH-NBR-DTE.          04750000
047600     MOVE '00'                    TO PV-PS-BTCH-NBR-SEQ-NBR.      04760000
047700                                                                  04770000
047800     PERFORM X100-OPEN-INVOICE-CSR.                               04780000
047900     PERFORM R100-FETCH-INVOICES.                                 04790000
048000                                                                  04800000
048100 EJECT                                                            04810000
048200***************************************************************** 04820000
048300*    CONTROLS THE PROCESSING OF EXPENSE INVOICES                  04830000
048400*      A. FOR EACH INVOICE CREATE AN INVOICE STATUS RECORD        04840000
048500*      B. SELECT VENDOR NAME                                      04850000
048600*      C. ROUTINE FOR PAYMENT DUE DATE                            04860000
048700*      D. FETCH ALL CHARGES FOR SPECIFIC INVOICE                  04870000
048800***************************************************************** 04880000
048900 B200-PROCESS-INVOICES.                                           04890000
049000                                                                  04900000
049100     MOVE 'B200-PROCESS-INVOICES' TO PV-CURRENT-PARAGRAPH.        04910000
049200                                                                  04920000
049300     PERFORM C100-CREATE-INV-STATUS-RECORD.                       04930000
049400                                                                  04940000
049500     IF INVOIC-RMIT-VND-ID NOT = PV-HOLD-DUN-NBR                  04950000
049600         MOVE INVOIC-RMIT-VND-ID TO PV-HOLD-DUN-NBR               04960000
049700         PERFORM S200-GET-VENDOR-NAME                             04970000
049800         PERFORM S500-SELECT-VENDOR-FLOAT-DAYS                    04980000
049900     END-IF.                                                      04990000
050000                                                                  05000000
050100     PERFORM D100-GET-PAYT-DUE-DATE.                              05010000
050200                                                                  05020000
050300     PERFORM X200-OPEN-CHARGE-CODE-CSR.                           05030000
050400     MOVE ZEROS TO PV-SEQ-NBR.                                    05040000
050500     SET PS-MORE-ALW-CHARGES TO TRUE.                             05050000
050600     PERFORM R200-FETCH-ALW-CHRG.                                 05060000
050700                                                                  05070000
050800     PERFORM E100-PROCESS-ALW-CHRG                                05080000
050900         UNTIL PS-END-ALW-CHARGES.                                05090000
051000                                                                  05100000
051100     PERFORM Y200-CLOSE-CHARGE-CODE-CSR.                          05110000
051200                                                                  05120000
051300     PERFORM R100-FETCH-INVOICES.                                 05130000
051400                                                                  05140000
051500 EJECT                                                            05150000
051600***************************************************************** 05160000
051700*    END OF PROGRAM                                               05170000
051800***************************************************************** 05180000
051900 B300-END-OF-PROGRAM.                                             05190000
052000                                                                  05200000
052100     MOVE 'B300-END-OF-PROGRAM' TO PV-CURRENT-PARAGRAPH.          05210000
052200                                                                  05220000
052300     PERFORM Y100-CLOSE-INVOICE-CSR.                              05230000
052400                                                                  05240000
052500     DISPLAY 'NBR OF INVOICES PROCESSED     = ' PV-INVOICE-COUNT. 05250000
052600     DISPLAY 'NBR OF AP-TRANSACTIONS        = ' PV-AP-TRAN-COUNT. 05260000
052700     DISPLAY 'NBR OF INVOICE-STATUS-RECORDS = ' PV-INV-STAT-COUNT.05270000
052800                                                                  05280000
052900     CLOSE AP-TRANSACTION-FILE                                    05290000
053000           INVOICE-STATUS-UPDATE-FILE.                            05300000
053100                                                                  05310000
053200 EJECT                                                            05320000
053300***************************************************************** 05330000
053400*    CREATES  THE INVOICE STATUS RECORD                           05340000
053500***************************************************************** 05350000
053600 C100-CREATE-INV-STATUS-RECORD.                                   05360000
053700                                                                  05370000
053800     MOVE 'C100-CREATE-INV-STATUS-RECORD' TO                      05380000
053900             PV-CURRENT-PARAGRAPH.                                05390000
054000                                                                  05400000
054100     MOVE SPACES                  TO AP252-RECORD.                05410000
054200     MOVE INVOIC-PO-NBR           TO AP252-PO-NBR.                05420000
054300     MOVE INVOIC-INVC-ID          TO AP252-INVOICE-ID.            05430000
054400     MOVE '9999-09-09'            TO AP252-PAYT-DTE.              05440000
054500     SET AP252-OPEN-TO-PAY        TO TRUE.                        05450000
054600     PERFORM W100-AP252-RECORD.                                   05460000
054700 EJECT                                                            05470000
054800***************************************************************** 05480000
054900*    CALLS ROUTINES TO CALCULATE THE PAYMENT DUE DATE AND         05490000
055000*   REFORMAT THE DATE INTO DB2 ISO DATE FORMAT                    05500000
055100***************************************************************** 05510000
055200 D100-GET-PAYT-DUE-DATE.                                          05520000
055300                                                                  05530000
055400     MOVE 'D100-GET-PAYT-DUE-DATE' TO PV-CURRENT-PARAGRAPH.       05540000
055500                                                                  05550000
055600     PERFORM D200-PROCESS-INVOICE-TERMS.                          05560000
055700                                                                  05570000
055800     MOVE INVOIC-INVC-DTE            TO APPD051-INVOICE-DATE.     05580000
055900     MOVE PS-END-MONTH-SW            TO APPD051-EOM-IND.          05590000
056000                                                                  05600000
056100     IF TAPVNDS-FLOAT-DAY-FOUND                                   05610000
056200        MOVE APVNDS-PAYT-FLOAT-DAY-QTY TO APPD051-FLOAT-DAYS      05620000
056300     ELSE                                                         05630000
056400        IF TAPVNDS-FLOAT-DAY-NOT-FOUND                            05640000
056500           MOVE APCNTL-PAYT-FLOAT-DAY-QTY TO APPD051-FLOAT-DAYS   05650000
056600        END-IF                                                    05660000
056700     END-IF.                                                      05670000
056800                                                                  05680000
056900     PERFORM D300-CALC-DUE-DATE.                                  05690000
057000                                                                  05700000
057100     MOVE APPD051-RETURN-DATE-CCYY-MM-DD TO                       05710000
057200           PV-DUE-DATE-CCYY-MM-DD.                                05720000
057300                                                                  05730000
057400***************************************************************** 05740000
057500*    PREPARES THE FIELDS FROM THE INVOICE NEEDED TO CALCULATE     05750000
057600*    THE PAYMENT DUE DATE.                                        05760000
057700***************************************************************** 05770000
057800 D200-PROCESS-INVOICE-TERMS.                                      05780000
057900                                                                  05790000
058000     MOVE 'D200-PROCESS-INVOICE-TERMS' TO PV-CURRENT-PARAGRAPH.   05800000
058100                                                                  05810000
058200     IF INVCTM-DISC-PCT = ZERO                                    05820000
058300         MOVE INVCTM-NET-DUE-DAY-QTY  TO APPD051-DISCOUNT-DAYS    05830000
058400     ELSE                                                         05840000
058500         MOVE INVCTM-DISC-DUE-DAY-QTY TO APPD051-DISCOUNT-DAYS.   05850000
058600                                                                  05860000
058700     IF INVCTM-TERM-TYP-CDE = '02'                                05870000
058800         SET PS-END-MONTH TO TRUE                                 05880000
058900     ELSE                                                         05890000
059000         SET PS-NOT-END-MONTH TO TRUE                             05900000
059100     END-IF.                                                      05910000
059200                                                                  05920000
059300     MOVE INVCTM-EXTD-DAYS-QTY    TO APPD051-EXTENDED-DAYS.       05930000
059400                                                                  05940000
059500 EJECT                                                            05950000
059600***************************************************************** 05960000
059700*    CALCULATES THE PAYMENT DUE DATE.                             05970000
059800***************************************************************** 05980000
059900 D300-CALC-DUE-DATE.                                              05990000
060000                                                                  06000000
060100     MOVE 'D300-CALC-DUE-DATE' TO PV-CURRENT-PARAGRAPH.           06010000
060200                                                                  06020000
060300     PERFORM CALC-PAYMENT-DUE-DATE.                               06030000
060400                                                                  06040000
060500     COPY APPD051.                                                06050000
060600                                                                  06060000
060700 EJECT                                                            06070000
060800***************************************************************** 06080000
060900*    CREATES THE AP TRANSACTION RECORD FOR EACH CHARGE AND        06090000
061000*    CORRESPONDING ACCOUNT NUMBER ROW FETCHED                     06100000
061100***************************************************************** 06110000
061200 E100-PROCESS-ALW-CHRG.                                           06120000
061300                                                                  06130000
061400     MOVE 'E100-PROCESS-ALW-CHRG' TO PV-CURRENT-PARAGRAPH.        06140000
061500                                                                  06150000
061600     PERFORM F100-CONVERT-INVOICE-ID.                             06160000
061700                                                                  06170000
061800     INITIALIZE AP040-TRANSACTION-FILE.                           06180000
061900     MOVE '70'                    TO AP040-AP-TRN-CDE.            06190000
062000     MOVE INVOIC-RMIT-VND-ID      TO AP040-VND-NBR.               06200000
062100     MOVE PV-INVOICE-ID           TO AP040-DOC-NBR.               06210000
062200     MOVE INVOIC-STR-NBR          TO PV-STR-NBR.                  06220000
062300     MOVE PV-STR-NBR              TO AP040-STR-NBR.               06230000
062400     MOVE INVOIC-PO-NBR           TO PV-PO-NBR.                   06240000
062500     MOVE PV-PO-NBR-R             TO AP040-PO-NBR.                06250000
062600     MOVE ACCTYP-GL-ACCT-NBR      TO AP040-GL-ACCT-NBR.           06260000
062700     MOVE ENTNME-ENT-ID           TO AP040-ENT-ID.                06270000
062800     MOVE PV-VENDOR-NAME          TO AP040-ENT-NME-DESC.          06280000
062900     MOVE INVOIC-INVC-DTE         TO AP040-DOC-DTE.               06290000
063000     MOVE ZEROS TO AP040-RETL-AMT,      AP040-FRGT-AMT,           06300000
063100                   AP040-MISC-CHRG-AMT, AP040-NW-STR-DISC-AMT,    06310000
063200                   AP040-TRD-DISC-AMT,  AP040-NW-STR-DISC-PCT,    06320000
063300                   AP040-TRD-DISC-PCT,  AP040-MOS-DISC-PCT        06330000
063400                   AP040-MOS-DISC-AMT,  AP040-ADV-DISC-PCT        06340000
063500                   AP040-ADV-DISC-AMT,  AP040-COOP-DISC-AMT       06350000
063600                   AP040-ALW-DISC-AMT,  AP040-COOP-DISC-PCT       06360000
063700                   AP040-ALW-DISC-PCT,  AP040-MSC-DISC-AMT        06370004
063800                   AP040-MSC-DISC-PCT                             06380006
063900     IF PV-INVOICE-ID = HOLD-INVOICE-ID                           06390000
064000         CONTINUE                                                 06400000
064100     ELSE                                                         06410000
064200         MOVE INVOIC-PO-NBR  TO EXINVC-PO-NBR                     06420000
064300         MOVE INVOIC-INVC-ID TO EXINVC-INVC-ID                    06430000
064400         PERFORM S400-SELECT-ENTR-NBR                             06440000
064500     END-IF.                                                      06450000
064600                                                                  06460000
064700     MOVE SPACES TO AP040-RSN-TXT.                                06470000
064800     MOVE +1 TO PV-COMM-POS.                                      06480000
064900                                                                  06490000
065000     IF EXINVC-INVC-CONTNR-ID NOT = SPACES                        06500000
065100         MOVE 'CONTAINER: ' TO AP040-RSN-TXT(PV-COMM-POS:11)      06510000
065200         ADD +11 TO PV-COMM-POS                                   06520000
065300         MOVE EXINVC-INVC-CONTNR-ID TO                            06530000
065400                        AP040-RSN-TXT(PV-COMM-POS:12)             06540000
065500         ADD +13 TO PV-COMM-POS                                   06550000
065600     END-IF.                                                      06560000
065700                                                                  06570000
065800     IF EXINVC-IMPRT-BOL-ID NOT = SPACES                          06580000
065900         MOVE 'BOL: ' TO AP040-RSN-TXT(PV-COMM-POS:5)             06590000
066000         ADD +5 TO PV-COMM-POS                                    06600000
066100         MOVE EXINVC-IMPRT-BOL-ID TO                              06610000
066200                        AP040-RSN-TXT(PV-COMM-POS:30)             06620000
066300         ADD +31 TO PV-COMM-POS                                   06630000
066400     END-IF.                                                      06640000
066500                                                                  06650000
066600     IF EXINVC-IMPRT-ENTR-NBR NOT = SPACES                        06660000
066700         MOVE 'ENT NBR: ' TO AP040-RSN-TXT(PV-COMM-POS:9)         06670000
066800         ADD +9 TO PV-COMM-POS                                    06680000
066900         MOVE EXINVC-IMPRT-ENTR-NBR TO                            06690000
067000                        AP040-RSN-TXT(PV-COMM-POS:16)             06700000
067100         ADD +17 TO PV-COMM-POS                                   06710000
067200     END-IF.                                                      06720000
067300                                                                  06730000
067400     IF EXINVC-IMPRT-BKR-REF-NBR NOT = SPACES                     06740000
067500         MOVE 'REF NBR: ' TO AP040-RSN-TXT(PV-COMM-POS:9)         06750000
067600         ADD +9 TO PV-COMM-POS                                    06760000
067601         MOVE EXINVC-IMPRT-BKR-REF-NBR TO                         06760100
067602                        AP040-RSN-TXT(PV-COMM-POS:15)             06760200
067603         ADD +16 TO PV-COMM-POS                                   06760300
067604     END-IF.                                                      06760400
067605                                                                  06760500
067606     MOVE SPACE TO AP040-AUTH-NBR,                                06760600
067607                   AP040-DEPT-NBR,      AP040-ENTR-TME,           06760700
067608                   AP040-PSTG-FYR-NBR,  AP040-PSTG-FMN-NBR,       06760800
067609                   AP040-PSTG-FWK-NBR.                            06760900
067610     MOVE ALCHRG-ALW-CHRG-AMT     TO AP040-GRO-COST-AMT.          06761000
067620     MOVE INVCTM-DISC-PCT         TO AP040-TERM-DISC-PCT.         06762000
067630     COMPUTE AP040-TERM-DISC-AMT  =                               06763000
067640        (AP040-GRO-COST-AMT * AP040-TERM-DISC-PCT) + .005.        06764000
067650     COMPUTE AP040-NET-COST-AMT = (AP040-GRO-COST-AMT             06765000
067660                           + AP040-FRGT-AMT                       06766000
067670                           + AP040-MISC-CHRG-AMT                  06767000
067680                           - AP040-TERM-DISC-AMT                  06768000
067690                           - AP040-NW-STR-DISC-AMT                06769000
067700                           - AP040-TRD-DISC-AMT                   06770000
067800                           - AP040-MOS-DISC-AMT                   06780000
067900                           - AP040-ADV-DISC-AMT).                 06790000
068000     MOVE PV-DUE-DATE-CCYY-MM-DD  TO AP040-PYMT-DUE-DTE.          06800000
068100     MOVE INVOIC-CRE-BY-USR-ID    TO AP040-ENTR-ID.               06810000
068200     MOVE INVOIC-CRE-DTE          TO AP040-ENTR-DTE.              06820000
068300     MOVE APCNTL-BTCH-PRC-DTE     TO AP040-INV-CUTOFF-DTE.        06830000
068400                                                                  06840000
068500     PERFORM S300-SELECT-TTRNCDE-DATA.                            06850000
068600     MOVE TRNCDE-TRN-TYP-CDE      TO AP040-TRN-TYP-CDE.           06860000
068700     MOVE TRNCDE-PSTG-TYP-CDE     TO AP040-PSTG-TYP-CDE.          06870000
068800     MOVE TRNCDE-BTCH-SRC-CDE     TO PV-PS-BTCH-NBR-SRC-CDE.      06880000
068900     MOVE PV-PS-BTCH-NBR          TO AP040-PS-BTCH-NBR.           06890000
069000                                                                  06900000
069100     IF INVOIC-HOLD-IND = 'Y'                                     06910000
069200        SET AP040-DOC-HLD TO TRUE                                 06920000
069300     END-IF.                                                      06930000
069400                                                                  06940000
069500     MOVE INVOIC-BAR-CDE          TO AP040-BAR-CDE.               06950000
069600     MOVE ACCTYP-AUTO-OTP-PSTG-IND TO AP040-AUTO-OTP-PSTG-IND.    06960000
069700                                                                  06970000
069800     IF  AP040-AUTO-OTP-PSTG-IND = 'Y'                            06980000
069900         SET AP040-ORGN-IMPORT    TO TRUE                         06990000
070000     ELSE                                                         07000000
070100         SET AP040-ORGN-PREPAID   TO TRUE                         07010000
070200     END-IF.                                                      07020000
070300                                                                  07030000
070400     PERFORM W200-AP040-TRANSACTION.                              07040000
070500     PERFORM R200-FETCH-ALW-CHRG.                                 07050000
070600                                                                  07060000
070700 EJECT                                                            07070000
070800***************************************************************** 07080000
070900*    SINCE THE INVOICE ID IS 22 BYTES ON TINVOIC AND 16 BYTES FOR 07090000
071000*    PEOPLESOFT. THIS ROUTINE USES 16 BYTES STARTING AT POSITION  07100000
071100*    22 GOING RIGHT TO LEFT, BYPASSING SPACES. THIS PREVENTS      07110000
071200*    CREATING DUPLICATE KEYS WHEN CREATING PEOPLESOFT ENTRIES.    07120000
071300***************************************************************** 07130000
071400 F100-CONVERT-INVOICE-ID.                                         07140000
071500                                                                  07150000
071600     MOVE 'F100-CONVERT-INVOICE-ID' TO PV-CURRENT-PARAGRAPH.      07160000
071700                                                                  07170000
071800     MOVE LENGTH OF INVOIC-INVC-ID   TO PV-START.                 07180000
071900     PERFORM                                                      07190000
072000         UNTIL INVOIC-INVC-ID (PV-START:1) > SPACES OR            07200000
072100               PV-START = +0                                      07210000
072200         COMPUTE PV-START = PV-START - 1                          07220000
072300     END-PERFORM.                                                 07230000
072400     IF PV-START < 16                                             07240000
072500         MOVE +1 TO PV-START                                      07250000
072600     ELSE                                                         07260000
072700         SUBTRACT +15 FROM PV-START                               07270000
072800     END-IF.                                                      07280000
072900     MOVE INVOIC-INVC-ID (PV-START:16)  TO PV-INVOICE-ID.         07290000
073000                                                                  07300000
073100 EJECT                                                            07310000
073200***************************************************************** 07320000
073300*    FETCHES ALL EXPENSE INVOICES                                 07330000
073400***************************************************************** 07340000
073500 R100-FETCH-INVOICES.                                             07350000
073600                                                                  07360000
073700     MOVE 'R100-FETCH-INVOICES' TO PV-CURRENT-PARAGRAPH.          07370000
073800                                                                  07380000
073900     EXEC SQL                                                     07390000
074000         FETCH INVOICE_CSR                                        07400000
074100          INTO:INVOIC-RMIT-VND-ID                                 07410000
074200             ,:INVOIC-CRE-DTE                                     07420000
074300             ,:INVOIC-CRE-BY-USR-ID                               07430000
074400             ,:INVOIC-PO-NBR                                      07440000
074500             ,:INVOIC-INVC-ID                                     07450000
074600             ,:INVOIC-STR-NBR                                     07460000
074700             ,:INVOIC-INVC-TYP-CDE                                07470000
074800             ,:INVOIC-INVC-DTE                                    07480000
074900             ,:INVOIC-HOLD-IND                                    07490000
075000             ,:INVOIC-BAR-CDE                                     07500000
075100             ,:INVOIC-CALC-DUE-DTE                                07510000
075200             ,:INVCTM-TERM-TYP-CDE                                07520000
075300             ,:INVCTM-DISC-PCT                                    07530000
075400             ,:INVCTM-DISC-DUE-DAY-QTY                            07540000
075500             ,:INVCTM-NET-DUE-DAY-QTY                             07550000
075600             ,:INVCTM-EXTD-DAYS-QTY                               07560000
075700     END-EXEC.                                                    07570000
075800                                                                  07580000
075900     EVALUATE TRUE                                                07590000
076000         WHEN SQLCODE = ZERO                                      07600000
076100              ADD 1 TO PV-INVOICE-COUNT                           07610000
076200                                                                  07620000
076300         WHEN SQLCODE = +100                                      07630000
076400              SET PS-END-INVOICES TO TRUE                         07640000
076500                                                                  07650000
076600         WHEN SQLWARN0 NOT = SPACES                               07660000
076700         WHEN SQLCODE  NOT = ZERO                                 07670000
076800             MOVE PV-CURRENT-PARAGRAPH                            07680000
076900                                TO AA-PARAGRAPH-NAME              07690000
077000             MOVE 'BAD FETCH WITH INVOICE_CSR'                    07700000
077100                                TO AA-DB2-OPERATION               07710000
077200             MOVE 'TINVOIC'     TO AA-DB2-TABLE-1                 07720000
077300             MOVE 'TINVCTM'     TO AA-DB2-TABLE-2                 07730000
077400             MOVE SPACES        TO AA-DB2-TABLE-3                 07740000
077500             PERFORM Z999-DB2-ABEND                               07750000
077600     END-EVALUATE.                                                07760000
077700                                                                  07770000
077800 EJECT                                                            07780000
077900***************************************************************** 07790000
078000*    RETRIEVES ALL CHARGES AND CORRESPONDING ACCOUNT NUMBERS      07800000
078100*    FROM THE TALCHRG AND TACCTYP TABLES.                         07810000
078200***************************************************************** 07820000
078300 R200-FETCH-ALW-CHRG.                                             07830000
078400                                                                  07840000
078500     MOVE 'R200-FETCH-ALW-CHRG' TO PV-CURRENT-PARAGRAPH.          07850000
078600                                                                  07860000
078700     EXEC SQL                                                     07870000
078800         FETCH ALW_CHRG_CSR                                       07880000
078900         INTO :ALCHRG-ALW-CHRG-AMT                                07890000
079000             ,:ACCTYP-GL-ACCT-NBR                                 07900000
079100             ,:ACCTYP-AUTO-OTP-PSTG-IND                           07910000
079200     END-EXEC.                                                    07920000
079300                                                                  07930000
079400     EVALUATE TRUE                                                07940000
079500         WHEN SQLCODE = +100                                      07950000
079600              SET PS-END-ALW-CHARGES TO TRUE                      07960000
079700                                                                  07970000
079800         WHEN SQLCODE = ZERO                                      07980000
079900             CONTINUE                                             07990000
080000         WHEN SQLWARN0 NOT = SPACES                               08000000
080100         WHEN SQLCODE  NOT = ZERO                                 08010000
080200             MOVE PV-CURRENT-PARAGRAPH                            08020000
080300                                 TO AA-PARAGRAPH-NAME             08030000
080400             MOVE                                                 08040000
080500               'UNSUCCESSFUL FETCH WITH ALW_CHRG_CSR'             08050000
080600                                 TO AA-DB2-OPERATION              08060000
080700             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                08070000
080800             MOVE 'TACCTYP'      TO AA-DB2-TABLE-2                08080000
080900             MOVE SPACES         TO AA-DB2-TABLE-3                08090000
081000             PERFORM Z999-DB2-ABEND                               08100000
081100     END-EVALUATE.                                                08110000
081200                                                                  08120000
081300 EJECT                                                            08130000
081400***************************************************************** 08140000
081500*    RETRIEVES THE PAYMENT FLOAT DAYS AND THE BATCH DATE FROM     08150000
081600*    THE AP CONTROL TABLE                                         08160000
081700*    NOTE:  A NOT FOUND CONDITION IN THIS INSTANCE PREVENTS THE   08170000
081800*           CALCULATION OF PAYMENT DUE DATE SO PROCESSING CANNOT  08180000
081900*           PROCEED AND THE PROGRAM MUST ABEND.                   08190000
082000***************************************************************** 08200000
082100 S100-SELECT-AP-CONTROL.                                          08210000
082200                                                                  08220000
082300     MOVE 'S100-SELECT-AP-CONTROL' TO PV-CURRENT-PARAGRAPH.       08230000
082400                                                                  08240000
082500     EXEC SQL                                                     08250000
082600         SELECT PAYT_FLOAT_DAY_QTY                                08260000
082700               ,BTCH_PRC_DTE                                      08270000
082800         INTO   :APCNTL-PAYT-FLOAT-DAY-QTY                        08280000
082900               ,:APCNTL-BTCH-PRC-DTE                              08290000
083000         FROM TAPCNTL                                             08300000
083100     END-EXEC.                                                    08310000
083200                                                                  08320000
083300     EVALUATE TRUE                                                08330000
083400         WHEN SQLCODE = ZERO                                      08340000
083500              CONTINUE                                            08350000
083600                                                                  08360000
083700         WHEN SQLWARN0 NOT = SPACES                               08370000
083800         WHEN SQLCODE  NOT = ZERO                                 08380000
083900         MOVE PV-CURRENT-PARAGRAPH                                08390000
084000                            TO AA-PARAGRAPH-NAME                  08400000
084100         MOVE 'UNSUCCESSFUL SELECT OF PAYMENT CONTROL TBL'        08410000
084200                            TO AA-DB2-OPERATION                   08420000
084300         MOVE 'TAPCNTL'     TO AA-DB2-TABLE-1                     08430000
084400         MOVE SPACES        TO AA-DB2-TABLE-2                     08440000
084500                                                                  08450000
084600         PERFORM Z999-DB2-ABEND                                   08460000
084700     END-EVALUATE.                                                08470000
084800                                                                  08480000
084900 EJECT                                                            08490000
085000***************************************************************** 08500000
085100*    RETRIEVES THE VENDER NAME FROM TABLES TEXTENT AND TENTNME    08510000
085200*    NOTE:  A NOT FOUND CONDITION RESULTS IN THE VENDOR NAME      08520000
085300*           BEING FILLED WITH 'VENDOR NOT FOUND'.                 08530000
085400***************************************************************** 08540000
085500 S200-GET-VENDOR-NAME.                                            08550000
085600                                                                  08560000
085700     MOVE 'S200-GET-VENDOR-NAME' TO PV-CURRENT-PARAGRAPH.         08570000
085800                                                                  08580000
085900     EXEC SQL                                                     08590000
086000         SELECT                                                   08600000
086100             VN.ENT_ID                                            08610000
086200            ,VN.ENT_NAME_DESC                                     08620000
086300         INTO                                                     08630000
086400             :ENTNME-ENT-ID                                       08640000
086500            ,:ENTNME-ENT-NAME-DESC                                08650000
086600         FROM TEXTENT EX                                          08660000
086700             ,TENTNME VN                                          08670000
086800         WHERE EX.DUN_NBR   = :INVOIC-RMIT-VND-ID                 08680000
086900           AND EX.ENT_ID    =  VN.ENT_ID                          08690000
087000           AND VN.TYPE_CDE  = '01'                                08700000
087100     END-EXEC.                                                    08710000
087200                                                                  08720000
087300     EVALUATE TRUE                                                08730000
087400         WHEN SQLCODE = ZERO                                      08740000
087500            MOVE ENTNME-ENT-NAME-DESC TO PV-VENDOR-NAME           08750000
087600                                                                  08760000
087700         WHEN SQLCODE = +100                                      08770000
087800            MOVE PC-VENDOR-NF TO PV-VENDOR-NAME                   08780000
087900                                                                  08790000
088000         WHEN SQLWARN0 NOT = SPACES                               08800000
088100         WHEN SQLCODE  NOT = ZERO                                 08810000
088200             MOVE PV-CURRENT-PARAGRAPH                            08820000
088300                                 TO AA-PARAGRAPH-NAME             08830000
088400             MOVE 'UNSUCCESSFUL SELECT FOR VENDOR NAME'           08840000
088500                                 TO AA-DB2-OPERATION              08850000
088600             MOVE 'TEXTENT'      TO AA-DB2-TABLE-1                08860000
088700             MOVE 'TENTNME'      TO AA-DB2-TABLE-2                08870000
088800             MOVE SPACES         TO AA-DB2-TABLE-3                08880000
088900             PERFORM Z999-DB2-ABEND                               08890000
089000     END-EVALUATE.                                                08900000
089100                                                                  08910000
089200 EJECT                                                            08920000
089300*----------------------------------------------------------------*08930000
089400*    RETRIEVES THE FOLLOWING DATA FROM THE TTRNCDE TABLE:        *08940000
089500*      1) BATCH SOURCE CODE                                      *08950000
089600*----------------------------------------------------------------*08960000
089700 S300-SELECT-TTRNCDE-DATA.                                        08970000
089800                                                                  08980000
089900     MOVE 'S300-SELECT-TTRNCDE-DATA' TO  PV-CURRENT-PARAGRAPH.    08990000
090000                                                                  09000000
090100     EXEC SQL                                                     09010000
090200         SELECT                                                   09020000
090300             PSTG_TYP_CDE                                         09030000
090400            ,TRN_TYP_CDE                                          09040000
090500            ,BTCH_SRC_CDE                                         09050000
090600         INTO                                                     09060000
090700             :TRNCDE-PSTG-TYP-CDE                                 09070000
090800            ,:TRNCDE-TRN-TYP-CDE                                  09080000
090900            ,:TRNCDE-BTCH-SRC-CDE                                 09090000
091000         FROM                                                     09100000
091100              TTRNCDE                                             09110000
091200         WHERE AP_TRN_CDE   =  :AP040-AP-TRN-CDE                  09120000
091300           AND EFF_STRT_DTE <= :APCNTL-BTCH-PRC-DTE               09130000
091400           AND EFF_END_DTE  >  :APCNTL-BTCH-PRC-DTE               09140000
091500     END-EXEC.                                                    09150000
091600                                                                  09160000
091700     EVALUATE TRUE                                                09170000
091800         WHEN SQLCODE = ZERO                                      09180000
091900         WHEN SQLCODE = +100                                      09190000
092000              CONTINUE                                            09200000
092100                                                                  09210000
092200         WHEN SQLWARN0 NOT = SPACES                               09220000
092300         WHEN SQLCODE  NOT = ZERO                                 09230000
092400             MOVE PV-CURRENT-PARAGRAPH                            09240000
092500                                 TO AA-PARAGRAPH-NAME             09250000
092600             MOVE 'UNSUCCESSFUL SELECT'                           09260000
092700                                 TO AA-DB2-OPERATION              09270000
092800             MOVE 'TTRNCDE'      TO AA-DB2-TABLE-1                09280000
092900             MOVE SPACES         TO AA-DB2-TABLE-2                09290000
093000                                    AA-DB2-TABLE-3                09300000
093100             PERFORM Z999-DB2-ABEND                               09310000
093200     END-EVALUATE.                                                09320000
093300                                                                  09330000
093400                                                                  09340000
093500 EJECT                                                            09350000
093600                                                                  09360000
093700*----------------------------------------------------------------*09370000
093800*    RETRIEVES THE FOLLOWING DATA FROM THE TEXINVC TABLE:        *09380000
093900*      1) IMPORT ENTRY NUMBER                                    *09390000
094000*      2) IMPORT BOL ID                                          *09400000
094100*----------------------------------------------------------------*09410000
094200 S400-SELECT-ENTR-NBR.                                            09420000
094300     MOVE 'S400-SELECT-ENTR-NBR' TO PV-CURRENT-PARAGRAPH.         09430000
094400                                                                  09440000
094500     EXEC SQL                                                     09450000
094600         SELECT IMPRT_ENTR_NBR,                                   09460000
094700                IMPRT_BOL_ID,                                     09470000
094800                INVC_CONTNR_ID,                                   09480000
094900                IMPRT_BKR_REF_NBR                                 09490000
095000           INTO :EXINVC-IMPRT-ENTR-NBR,                           09500000
095100                :EXINVC-IMPRT-BOL-ID,                             09510000
095200                :EXINVC-INVC-CONTNR-ID,                           09520000
095300                :EXINVC-IMPRT-BKR-REF-NBR                         09530000
095400           FROM TEXINVC                                           09540000
095500          WHERE PO_NBR  = :EXINVC-PO-NBR                          09550000
095600            AND INVC_ID = :EXINVC-INVC-ID                         09560000
095700     END-EXEC.                                                    09570000
095800                                                                  09580000
095900     EVALUATE TRUE                                                09590000
096000         WHEN SQLCODE = +0                                        09600000
096100             CONTINUE                                             09610000
096200         WHEN SQLCODE = +100                                      09620000
096300             MOVE SPACES TO EXINVC-IMPRT-ENTR-NBR                 09630000
096400             MOVE SPACES TO EXINVC-IMPRT-BOL-ID                   09640000
096500             MOVE SPACES TO EXINVC-INVC-CONTNR-ID                 09650000
096600             MOVE SPACES TO EXINVC-IMPRT-BKR-REF-NBR              09660000
096700         WHEN OTHER                                               09670000
096800             DISPLAY 'INVOICE ID = ' EXINVC-INVC-ID               09680000
096900             DISPLAY 'PO NUMBER  = ' EXINVC-PO-NBR                09690000
097000             MOVE PV-CURRENT-PARAGRAPH  TO AA-PARAGRAPH-NAME      09700000
097100             MOVE 'UNSUCCESSFUL SELECT' TO AA-DB2-OPERATION       09710000
097200             MOVE 'TTRNCDE'             TO AA-DB2-TABLE-1         09720000
097300             MOVE SPACES                TO AA-DB2-TABLE-2         09730000
097400             MOVE SPACES                TO AA-DB2-TABLE-3         09740000
097500             PERFORM Z999-DB2-ABEND                               09750000
097600     END-EVALUATE.                                                09760000
097700                                                                  09770000
097800     MOVE PV-INVOICE-ID TO HOLD-INVOICE-ID.                       09780000
097900                                                                  09790000
098000***************************************************************** 09800000
098100*     CHECK IF THIS VENDOR HAS CONTROL DAYS DEFINED               09810000
098200***************************************************************** 09820000
098300 S500-SELECT-VENDOR-FLOAT-DAYS.                                   09830000
098400                                                                  09840000
098500     MOVE 'S500-SELECT-VENDOR-FLOAT-DAYS' TO PV-CURRENT-PARAGRAPH.09850000
098600                                                                  09860000
098700     EXEC SQL                                                     09870000
098800         SELECT                                                   09880000
098900             PAYT_FLOAT_DAY_QTY                                   09890000
099000         INTO                                                     09900000
099100             :APVNDS-PAYT-FLOAT-DAY-QTY                           09910000
099200         FROM TAPVNDS AV                                          09920000
099300         WHERE AV.ENT_ID          = :ENTNME-ENT-ID                09930000
099400           AND AV.VND_FLT_DAY_IND = 'V'                           09940000
099500     END-EXEC.                                                    09950000
099600                                                                  09960000
099700     EVALUATE TRUE                                                09970000
099800         WHEN SQLCODE = ZEROS                                     09980000
099900              SET TAPVNDS-FLOAT-DAY-FOUND TO TRUE                 09990000
100000         WHEN SQLCODE = +100                                      10000000
100100              SET TAPVNDS-FLOAT-DAY-NOT-FOUND TO TRUE             10010000
100200         WHEN OTHER                                               10020000
100300               MOVE PV-CURRENT-PARAGRAPH  TO AA-PARAGRAPH-NAME    10030000
100400               MOVE 'UNSUCCESSFUL SELECT' TO AA-DB2-OPERATION     10040000
100500               MOVE 'TAPVNDS'             TO AA-DB2-TABLE-1       10050000
100600               MOVE SPACES                TO AA-DB2-TABLE-2       10060000
100700                                             AA-DB2-TABLE-3       10070000
100800               PERFORM Z999-DB2-ABEND                             10080000
100900      END-EVALUATE.                                               10090000
101000                                                                  10100000
101100 EJECT                                                            10110000
101200                                                                  10120000
101300 EJECT                                                            10130000
101400                                                                  10140000
101500***************************************************************** 10150000
101600*    WRITES THE INVOICE STATUS RECORD                             10160000
101700***************************************************************** 10170000
101800 W100-AP252-RECORD.                                               10180000
101900     WRITE INVOICE-STATUS-UPDATE-RECORD FROM AP252-RECORD.        10190000
102000     ADD +1 TO PV-INV-STAT-COUNT.                                 10200000
102100                                                                  10210000
102200 EJECT                                                            10220000
102300***************************************************************** 10230000
102400*    WRITES THE AP TRANSACTION RECORD FOR EACH                    10240000
102500*    CHARGE AND CORRESPONDING ACCOUNT NUMBER ROW FETCHED          10250000
102600***************************************************************** 10260000
102700 W200-AP040-TRANSACTION.                                          10270000
102800     WRITE AP-TRANSACTION-RECORD FROM AP040-TRANSACTION-FILE.     10280000
102900     ADD +1 TO PV-AP-TRAN-COUNT.                                  10290000
103000                                                                  10300000
103100 EJECT                                                            10310000
103200***************************************************************** 10320000
103300*    OPENS THE INVOICE CURSOR.                                    10330000
103400***************************************************************** 10340000
103500 X100-OPEN-INVOICE-CSR.                                           10350000
103600                                                                  10360000
103700     MOVE 'X100-OPEN-INVOICE-CSR '      TO PV-CURRENT-PARAGRAPH.  10370000
103800                                                                  10380000
103900     EXEC SQL                                                     10390000
104000         OPEN INVOICE_CSR                                         10400000
104100     END-EXEC.                                                    10410000
104200                                                                  10420000
104300     EVALUATE TRUE                                                10430000
104400         WHEN SQLCODE = ZERO                                      10440000
104500              CONTINUE                                            10450000
104600                                                                  10460000
104700         WHEN SQLWARN0 NOT = SPACES                               10470000
104800         WHEN SQLCODE  NOT = ZERO                                 10480000
104900             MOVE PV-CURRENT-PARAGRAPH                            10490000
105000                                TO AA-PARAGRAPH-NAME              10500000
105100             MOVE 'UNSUCCESSFUL OPEN ON INVOICE_CSR'              10510000
105200                                TO AA-DB2-OPERATION               10520000
105300             MOVE 'TINVOIC'     TO AA-DB2-TABLE-1                 10530000
105400             MOVE 'TINVCTM'     TO AA-DB2-TABLE-2                 10540000
105500             MOVE SPACES        TO AA-DB2-TABLE-3                 10550000
105600             PERFORM Z999-DB2-ABEND                               10560000
105700     END-EVALUATE.                                                10570000
105800                                                                  10580000
105900 EJECT                                                            10590000
106000***************************************************************** 10600000
106100*    OPENS THE CHARGE CODE CURSOR.                                10610000
106200***************************************************************** 10620000
106300 X200-OPEN-CHARGE-CODE-CSR.                                       10630000
106400                                                                  10640000
106500     MOVE 'X200-OPEN-CHARGE-CODE-CSR' TO PV-CURRENT-PARAGRAPH.    10650000
106600                                                                  10660000
106700     EXEC SQL                                                     10670000
106800         OPEN ALW_CHRG_CSR                                        10680000
106900     END-EXEC.                                                    10690000
107000                                                                  10700000
107100     EVALUATE TRUE                                                10710000
107200         WHEN SQLCODE = ZERO                                      10720000
107300              CONTINUE                                            10730000
107400                                                                  10740000
107500         WHEN SQLWARN0 NOT = SPACES                               10750000
107600         WHEN SQLCODE  NOT = ZERO                                 10760000
107700             MOVE PV-CURRENT-PARAGRAPH                            10770000
107800                                 TO AA-PARAGRAPH-NAME             10780000
107900             MOVE 'UNSUCCESSFUL OPEN ON ALW_CHRG_CSR'             10790000
108000                                 TO AA-DB2-OPERATION              10800000
108100             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                10810000
108200             MOVE 'TACCTYP'      TO AA-DB2-TABLE-2                10820000
108300             MOVE SPACES         TO AA-DB2-TABLE-3                10830000
108400             PERFORM Z999-DB2-ABEND                               10840000
108500     END-EVALUATE.                                                10850000
108600                                                                  10860000
108700 EJECT                                                            10870000
108800***************************************************************** 10880000
108900*    CLOSES THE INVOICE CSR                                       10890000
109000***************************************************************** 10900000
109100 Y100-CLOSE-INVOICE-CSR.                                          10910000
109200                                                                  10920000
109300     MOVE 'Y100-CLOSE-INVOICE-CSR'       TO PV-CURRENT-PARAGRAPH. 10930000
109400                                                                  10940000
109500     EXEC SQL                                                     10950000
109600         CLOSE INVOICE_CSR                                        10960000
109700     END-EXEC.                                                    10970000
109800                                                                  10980000
109900     EVALUATE TRUE                                                10990000
110000         WHEN SQLCODE = ZERO                                      11000000
110100              CONTINUE                                            11010000
110200                                                                  11020000
110300         WHEN SQLWARN0 NOT = SPACES                               11030000
110400         WHEN SQLCODE  NOT = ZERO                                 11040000
110500             MOVE PV-CURRENT-PARAGRAPH                            11050000
110600                                   TO AA-PARAGRAPH-NAME           11060000
110700             MOVE 'UNSUCCESSFUL CLOSE OF INVOICE_CSR'             11070000
110800                                   TO AA-DB2-OPERATION            11080000
110900             MOVE 'TINVOIC'        TO AA-DB2-TABLE-1              11090000
111000             MOVE 'TINVCTM'        TO AA-DB2-TABLE-2              11100000
111100             MOVE SPACES           TO AA-DB2-TABLE-3              11110000
111200             PERFORM Z999-DB2-ABEND                               11120000
111300     END-EVALUATE.                                                11130000
111400                                                                  11140000
111500 EJECT                                                            11150000
111600***************************************************************** 11160000
111700*    CLOSES THE CHARGE CODE CURSOR.                               11170000
111800***************************************************************** 11180000
111900 Y200-CLOSE-CHARGE-CODE-CSR.                                      11190000
112000                                                                  11200000
112100     MOVE 'Y200-CLOSE-CHARGE-CODE-CSR' TO PV-CURRENT-PARAGRAPH.   11210000
112200                                                                  11220000
112300     EXEC SQL                                                     11230000
112400         CLOSE ALW_CHRG_CSR                                       11240000
112500     END-EXEC.                                                    11250000
112600                                                                  11260000
112700     EVALUATE TRUE                                                11270000
112800         WHEN SQLCODE = ZERO                                      11280000
112900              CONTINUE                                            11290000
113000                                                                  11300000
113100         WHEN SQLWARN0 NOT = SPACES                               11310000
113200         WHEN SQLCODE  NOT = ZERO                                 11320000
113300             MOVE PV-CURRENT-PARAGRAPH                            11330000
113400                                 TO AA-PARAGRAPH-NAME             11340000
113500             MOVE 'UNSUCCESSFUL CLOSE ON ALW_CHRG_CSR'            11350000
113600                                 TO AA-DB2-OPERATION              11360000
113700             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                11370000
113800             MOVE 'TACCTYP'      TO AA-DB2-TABLE-2                11380000
113900             MOVE SPACES         TO AA-DB2-TABLE-3                11390000
114000             PERFORM Z999-DB2-ABEND                               11400000
114100     END-EVALUATE.                                                11410000
114200                                                                  11420000
114300 EJECT                                                            11430000
114400***************************************************************** 11440000
114500*    ABEND ROUTINE FOR DB2 ERRORS                                 11450000
114600***************************************************************** 11460000
114700 Z999-DB2-ABEND.                                                  11470000
114800                                                                  11480000
114900     DISPLAY AA-ABEND-LIT.                                        11490000
115000     DISPLAY AA-DB2-ERROR-LIT.                                    11500000
115100     DISPLAY AA-PROGRAM-LIT.                                      11510000
115200     DISPLAY AA-PARAGRAPH-LIT.                                    11520000
115300     DISPLAY AA-DB2-OPERATION-LIT.                                11530000
115400     DISPLAY AA-DB2-TABLE-1.                                      11540000
115500     DISPLAY AA-DB2-TABLE-2.                                      11550000
115600     DISPLAY AA-DB2-TABLE-3.                                      11560000
115700     SET AC-DB2-ERROR TO TRUE.                                    11570000
115800                                                                  11580000
115900     COPY DPPD004.                                                11590000
116000                                                                  11600000
116100     CALL 'ILBOABN0' USING ABEND-CODE.                            11610000
