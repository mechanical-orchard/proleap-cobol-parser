000100******************************************************************00010032
000200 IDENTIFICATION DIVISION.                                         00020032
000300******************************************************************00030002
000400                                                                  00040032
000500 PROGRAM-ID.             RCKUT991.                                00050032
000600 AUTHOR.                 DAN HINTZ.                               00060032
000700 INSTALLATION.           KOHLS.                                   00070032
000800 DATE-WRITTEN            MAY 1994.                                00080032
000900 DATE-COMPILED.                                                   00090032
001000                                                                  00100032
001100******************************************************************00110032
001200*   THE PURPOSE OF THIS PROGRAM IS TO READ THE DAILY STORE OR     00120032
001300*   DAILY KEYREC EXTRACT FILES, ELIMINATING ANY PO THAT ARE IN    00130032
001400*   ERROR.  PO'S THAT ARE IN ERROR ARE FOUND ON THE PO ERROR FILE.00140032
001500******************************************************************00150032
001600 ENVIRONMENT DIVISION.                                            00160032
001700                                                                  00170032
001800 CONFIGURATION SECTION.                                           00180032
001900                                                                  00190032
002000 SOURCE-COMPUTER.        IBM-3090.                                00200032
002100 OBJECT-COMPUTER.        IBM-3090.                                00210032
002200                                                                  00220032
002300 INPUT-OUTPUT SECTION.                                            00230032
002400                                                                  00240032
002500 FILE-CONTROL.                                                    00250032
002600                                                                  00260032
002700     SELECT PO-FILE-IN                                            00270032
002800         ASSIGN TO INP01.                                         00280032
002900                                                                  00290032
003000     SELECT PO-ERROR-FILE                                         00300032
003100         ASSIGN TO INP02.                                         00310032
003200                                                                  00320032
003300     SELECT PO-FILE-OUT                                           00330032
003400         ASSIGN TO OUT01.                                         00340032
003500                                                                  00350032
003600******************************************************************00360032
003700 DATA DIVISION.                                                   00370032
003800******************************************************************00380032
003900                                                                  00390032
004000 FILE SECTION.                                                    00400032
004100                                                                  00410032
004200 FD  PO-FILE-IN                                                   00420032
004300     RECORDING MODE IS F                                          00430032
004400     BLOCK CONTAINS 0 RECORDS                                     00440032
004500     LABEL RECORDS ARE STANDARD.                                  00450032
004600                                                                  00460032
004700 01  PO-FILE-IN-REC                          PIC X(300).          00470032
004800                                                                  00480032
004900 FD  PO-ERROR-FILE                                                00490032
005000     RECORDING MODE IS F                                          00500032
005100     BLOCK CONTAINS 0 RECORDS                                     00510032
005200     LABEL RECORDS ARE STANDARD.                                  00520032
005300                                                                  00530032
005400 01  PO-ERROR-FILE-REC                       PIC X(080).          00540032
005500                                                                  00550032
005600 FD  PO-FILE-OUT                                                  00560032
005700     RECORDING MODE IS F                                          00570032
005800     BLOCK CONTAINS 0 RECORDS                                     00580032
005900     LABEL RECORDS ARE STANDARD.                                  00590032
006000                                                                  00600032
006100 01  PO-FILE-OUT-REC                         PIC X(300).          00610032
006200                                                                  00620032
006300******************************************************************00630032
006400 WORKING-STORAGE SECTION.                                         00640032
006500******************************************************************00650032
006600                                                                  00660032
006700 01  ABEND-CODE                          PIC S9(04)  VALUE +0     00670032
006800                                                     COMP SYNC.   00680032
006840     88  AC-4004-TABLE-OVERFLOW-ERROR             VALUE +4004.    00690032
006850                                                                  00700032
006900 01  WS-ERROR-PO-RECORD.                                          00710032
007000     05  WS-PO-NBR                       PIC 9(08).               00720032
007100     05  FILLER                          PIC X(01).               00730032
007200     05  WS-PO-SEQ-NBR                   PIC 9(09).               00740032
007300     05  FILLER                          PIC X(62).               00750032
007400*                                                                 00760032
007500     COPY STOREEXT.                                               00770032
007700*                                                                 00780032
007710 01  PV-PROGRAM-CONSTANTS.                                        00790032
007720     05  PC-MAX-TABLE-ENTRIES           PIC S9(04)  VALUE +5000   00800032
007721                                                    COMP SYNC.    00810032
007730*                                                                 00820032
007800 01  WS-ERROR-PO-TABLE.                                           00830032
007900     05  WS-ERROR-PO-ENTRY              OCCURS 5000 TIMES         00840032
008000                                        INDEXED BY WS-PO-IDX.     00850032
008100         10  WS-ERROR-PO                PIC  9(08)  VALUE ZEROS.  00860032
008200         10  WS-ERROR-PO-SEQ-NBR        PIC  9(09)  VALUE ZEROS.  00870032
008300*                                                                 00880032
008400 EJECT                                                            00890032
008500                                                                  00900032
0522RM*- INCREASED SIZE OF RECORD COUNTERS                              00910032
008710 01  PV-PROGRAM-VARIABLES.                                        00920032
008720     05  PV-PARA                         PIC X(30)   VALUE SPACES.00930032
008800     05  PV-PO-RECS-READ-NO-ERROR        PIC 9(08)   VALUE ZEROS. 00940032
008810     05  PV-PO-RECS-READ                 PIC 9(08)   VALUE ZEROS. 00950032
008900     05  PV-PO-RECS-BYPASSED             PIC 9(08)   VALUE ZEROS. 00960032
009000     05  PV-PO-RECS-WRITTEN              PIC 9(08)   VALUE ZEROS. 00970032
009100     05  PV-ERROR-RECS-READ              PIC 9(08)   VALUE ZEROS. 00980032
009120     05  PV-DISP-IDX                     PIC 9999    VALUE ZEROS. 00990032
0622RM*- ADDED FIELDS TO COMBINE PO-SEQ FOR EASIER COMPARE              01000038
0622RM     05  PV-ERROR-PO-SEQ.                                         01010038
0622RM         10  PV-ERROR-PO                 PIC 9(08)   VALUE 0.     01020038
0622RM         10  PV-ERROR-SEQ                PIC 9(09)   VALUE 0.     01030038
0622RM     05  PV-EXTR-PO-SEQ.                                          01040038
0622RM         10  PV-EXTR-PO                  PIC 9(08)   VALUE 0.     01050038
0622RM         10  PV-EXTR-SEQ                 PIC 9(09)   VALUE 0.     01060038
009200                                                                  01070032
009300 01  PROGRAM-SWITCHES.                                            01080032
009400     05  END-OF-PO-INPUT-SW              PIC X(01)   VALUE 'N'.   01090032
009500         88  END-OF-PO-INPUT                         VALUE 'Y'.   01100032
009600     05  END-OF-PO-ERROR-SW              PIC X(01)   VALUE 'N'.   01110032
009700         88  END-OF-PO-ERROR                         VALUE 'Y'.   01120032
010100*                                                                 01160032
010200*                                                                 01170032
010300 PROCEDURE DIVISION.                                              01180032
010400                                                                  01190032
010500******************************************************************01200032
010600*  0000-INITIAL-ROUTINE  -  MAIN LINE OF THE PROGRAM PERFORMS THE 01210032
010700*  INITIALIZATION ROUTINE AND CONTROLS THE PROCESSING OF THE PGM. 01220032
010800******************************************************************01230032
010900                                                                  01240032
011000 0000-MAINLINE.                                                   01250032
011100                                                                  01260032
011110     DISPLAY 'RCKUT991 - START'                                   01270032
011120                                                                  01280032
011200     PERFORM 0100-HOUSEKEEPING.                                   01290032
011300                                                                  01300032
011400     PERFORM 7000-READ-ERROR-FILE.                                01310032
0622RM     IF END-OF-PO-ERROR                                           01320032
0622RM         CONTINUE                                                 01330032
0622RM     ELSE                                                         01340032
0622RM         ADD 1              TO PV-ERROR-RECS-READ                 01350032
0622RM         MOVE WS-PO-NBR     TO PV-ERROR-PO                        01360032
0622RM         MOVE WS-PO-SEQ-NBR TO PV-ERROR-SEQ                       01370032
0622RM     END-IF.                                                      01380032
011500                                                                  01390032
012040                                                                  01400032
012100     PERFORM 7100-READ-PO-INPUT-FILE.                             01410032
012200                                                                  01490032
0622RM     IF  END-OF-PO-ERROR                                          01500032
012220         PERFORM 3000-PROCESS-READ-WRITE                          01510032
012221           UNTIL END-OF-PO-INPUT                                  01520032
012230     ELSE                                                         01530032
012300         PERFORM 2000-PROCESS-INPUT-RECORDS                       01540032
012400           UNTIL END-OF-PO-INPUT                                  01550032
012410     END-IF.                                                      01560032
012500                                                                  01570032
012600     CLOSE PO-FILE-IN                                             01580032
012700           PO-ERROR-FILE                                          01590032
012800           PO-FILE-OUT.                                           01600032
012900                                                                  01610032
013000     DISPLAY '*** PO EXTRACT RECS READ....: ' PV-PO-RECS-READ.    01620032
013100     DISPLAY '*** PO ERROR RECS READ......: ' PV-ERROR-RECS-READ. 01630032
013200     DISPLAY '*** PO EXTRACT RECS WRITTEN.: ' PV-PO-RECS-WRITTEN. 01640032
013300     DISPLAY '*** PO EXTRACT RECS BYPASSED: ' PV-PO-RECS-BYPASSED.01650032
013310     DISPLAY '                                '                   01660032
013311     DISPLAY '*** NO ERROR RECORDS - PO RECS READ: '              01670032
013320              PV-PO-RECS-READ-NO-ERROR.                           01680032
013400                                                                  01690032
013500     STOP RUN.                                                    01700032
013600                                                                  01710032
013700 0100-HOUSEKEEPING.                                               01720032
013800                                                                  01730032
013900     OPEN INPUT  PO-FILE-IN                                       01740032
014000                 PO-ERROR-FILE.                                   01750032
014100                                                                  01760032
014200     OPEN OUTPUT PO-FILE-OUT.                                     01770032
014300                                                                  01780032
015000                                                                  01790032
015100 2000-PROCESS-INPUT-RECORDS.                                      01800032
015200     MOVE '*2000-PROCESS-INPUT-RECORDS.     *' TO PV-PARA.        01810032
015300                                                                  01820032
0622RM     IF END-OF-PO-ERROR                                           01830037
012220         PERFORM 3000-PROCESS-READ-WRITE                          01840032
012221           UNTIL END-OF-PO-INPUT                                  01850032
0622RM     ELSE                                                         01860037
0622RM     IF PV-ERROR-PO-SEQ = PV-EXTR-PO-SEQ                          01890037
0622RM         ADD 1 TO PV-PO-RECS-BYPASSED                             01910037
0622RM         PERFORM 7100-READ-PO-INPUT-FILE                          01920037
0622RM     ELSE                                                         01930037
0622RM         IF PV-ERROR-PO-SEQ > PV-EXTR-PO-SEQ                      01940037
0622RM             PERFORM 8000-WRITE-EXTRACT-FILE                      01970037
0622RM             ADD 1 TO PV-PO-RECS-READ-NO-ERROR                    01971036
0622RM             PERFORM 7100-READ-PO-INPUT-FILE                      01980037
0622RM         ELSE                                                     02020037
0622RM             IF PV-ERROR-PO-SEQ < PV-EXTR-PO-SEQ                  02030037
0622RM                 PERFORM 7000-READ-ERROR-FILE                     02060037
0622RM             END-IF                                               02070037
0622RM         END-IF                                                   02080037
0622RM     END-IF.                                                      02090037
0522RM                                                                  02100032
017500                                                                  02110032
017510 3000-PROCESS-READ-WRITE.                                         02120032
017511     MOVE '*3000-PROCESS-READ-WRITE         *' TO PV-PARA.        02130032
017512                                                                  02140032
017517                                                                  02160032
017530     PERFORM 8000-WRITE-EXTRACT-FILE.                             02170036
017516     ADD 1               TO PV-PO-RECS-READ-NO-ERROR.             02180036
017532                                                                  02190032
017533     PERFORM 7100-READ-PO-INPUT-FILE.                             02200032
017560                                                                  02260032
017600 7000-READ-ERROR-FILE.                                            02270032
017700     READ PO-ERROR-FILE INTO WS-ERROR-PO-RECORD                   02280032
017800        AT END                                                    02290032
017900           SET END-OF-PO-ERROR TO TRUE.                           02300032
0622RM     IF END-OF-PO-ERROR                                           02310032
0622RM         CONTINUE                                                 02320032
0622RM     ELSE                                                         02330032
0622RM         ADD 1              TO PV-ERROR-RECS-READ                 02340032
0522RM         MOVE WS-PO-NBR     TO PV-ERROR-PO                        02350032
0522RM         MOVE WS-PO-SEQ-NBR TO PV-ERROR-SEQ                       02360032
0622RM     END-IF.                                                      02370032
0622RM                                                                  02380032
018000                                                                  02390032
018100 7100-READ-PO-INPUT-FILE.                                         02400032
018200     READ PO-FILE-IN    INTO STORE-EXTRACT-LINE                   02410032
018300        AT END                                                    02420032
018400           SET END-OF-PO-INPUT TO TRUE.                           02430032
0622RM     IF END-OF-PO-INPUT                                           02440032
0622RM         CONTINUE                                                 02450032
0622RM     ELSE                                                         02460032
0622RM         ADD 1               TO PV-PO-RECS-READ                   02470032
0622RM         MOVE SE-PO          TO PV-EXTR-PO                        02480032
0622RM         MOVE SE-REC-SEQ-NBR TO PV-EXTR-SEQ                       02490032
0622RM     END-IF.                                                      02500032
018500                                                                  02510032
018600 8000-WRITE-EXTRACT-FILE.                                         02520032
018700     WRITE PO-FILE-OUT-REC                                        02530032
018800         FROM STORE-EXTRACT-LINE.                                 02540032
018900                                                                  02550032
019000     ADD 1 TO PV-PO-RECS-WRITTEN.                                 02560032
019100                                                                  02570032
019200******************************************************************02580032
019300*     ABEND PROGRAM WHEN ERROR OCCURS.                           *02590032
019400******************************************************************02600032
019500 9910-ABEND.                                                      02610032
019600                                                                  02620032
020500     CALL 'ILBOABN0' USING ABEND-CODE.                            02630032
020600                                                                  02640032
