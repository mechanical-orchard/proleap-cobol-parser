000100*----------------------------------------------------------------*00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*----------------------------------------------------------------*00030000
000400 PROGRAM-ID.    PEKUT905.                                         00040065
000500 AUTHOR.        CHUCK HERO (GENESIS 10).                          00050000
000600 DATE-WRITTEN.  12 NOV 2007.                                      00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900*----------------------------------------------------------------*00090000
001000*        ** VALIDATE CLEARANCE EVENT CALENDAR CSV FILE **        *00100000
001100*           ** TO MAINTAIN THE PET_CLR_EVNT TABLES **            *00110000
001200*----------------------------------------------------------------*00120000
001300*   THIS PROGRAM PROCESSES A CSV FILE OF EVENT CALENDAR           00130000
001400*   INFORMATION GENERATED FROM AN EXCEL SPREADSHEET.              00140000
001500*   EACH DATA RECORD ON THE FILE REPRESENTS A MARKDOWN EVENT.     00150000
001600*   OTHER RECORDS ON THE FILE INCLUDE HEADER AND OTHER INFO, NOT  00160000
001700*   RELEVANT TO THIS SPECIFIC FUNCTION, AND ARE IGNORED.          00170000
001800*   EACH DATA RECORD IS PARSED, DATES ARE CONVERTED, AND A        00180000
001900*   RECORD IS WRITTEN TO AN OUTPUT FILE. THE OUTPUT IS USED BY A  00190000
002000*   WEEKLY PROCESS TO INSERT TO OR UPDATE THE ORACLE DATABASE.    00200000
002100*                                                                 00210000
002200*   THE PRIMARY (CORRELATION) KEY IS GENERATED AS A GUID NUMBER   00220000
002300*   (GUI_LOD_ID) WITHIN THE SPREADSHEET.                          00230000
002400*   THE PROGRAM DETERMINES WHETHER THE EVENT IS NEW OR IF IT      00240000
002500*   ALREADY EXISTS IN PET_CLR_EVNT, BASED UPON THE GUI_LOD_ID.    00250000
002600*   IF IT EXISTS THE OUTPUT RECORD IS MARKED AS AN UPDATE RECORD. 00260000
002700*   IF NOT FOUND, THE OUTPUT RECORD IS MARKED AS AN INSERT RECORD.00270000
002800*   IF THE INPUT RECORD IS MARKED AS INACTIVE, A DELETE OUTPUT    00280000
002900*   RECORD IS WRITTEN.  (IF THE EVENT EXISTS IN THE DATABASE?)    00290000
003000*                                                                 00300000
003100*   THE CALENDAR ROUTINE DPKUT500 IS CALLED TO VALIDATE           00310000
003200*    DATES FOUND IN INPUT FILE.                                   00320000
003300*                                                                 00330000
003400*   TRANSLATE ANY LOWER CASE IN PV-EVNT-ID-EXP-EVENT TO UPPER CASE00340000
003500*   THEN VALIDATE PV-EVNT-ID-EXP-EVENT = EVENT.                   00350000
003600*     IF VALID, PUT 'Event' INTO PV-EVNT-ID-EXP-EVENT             00360000
003700*      SO IT WILL MATCH CLR_EVNT_NM ON TABLE.                     00370000
003800*                                                                 00380000
003900*   THE TABLES BEING MAINTAINED ARE IN TWO ORACLE DATABASES.      00390000
004000*                                                                 00400000
004100*   SPECIFICATIONS HAVE CHANGED SIGNIFICANTLY SINCE THE ORIGINAL  00410000
004200*   CONSTRUCTION OF THIS PROGRAM SO THE COMMENTS ABOVE MAY NOT    00420000
004300*   ACCURATELY REFLECT THE FULL FUNCTIONALITY OF THE CODE.        00430000
004400*                                                                 00440000
004500*----------------------------------------------------------------*00450000
004600* HISTORY LOG:                                                    00460000
004700*----------------------------------------------------------------*00470000
004800* DATE:        2008-04-15                                         00480000
004900* WR/IR#:      WR#30737                                           00490000
005000* PROGRAMMER:  SHARON SZPISZAR - STRATAGEM    AND                 00500000
005100*              CHUCK HERO - GENESIS 10                            00510000
005200* DESCRIPTION: INITIAL IMPLEMENTATION.                            00520000
005300*                                                                 00530000
005400*----------------------------------------------------------------*00540000
005500* DATE: 2008-06-04                                                00550001
005600* WR/IR#: WR#30737                                                00560001
005700* PROGRAMMER: Riley kehoe                                         00570001
005800* DESCRIPTION: adding additional marks                            00580001
005900*                                                                 00590000
005400*----------------------------------------------------------------*00591001
005500* DATE:  2008-07-31                                               00592043
005600* WR/IR#: WR#30737                                                00593043
005700* PROGRAMMER: Riley Kehoe                                         00594043
005800* DESCRIPTION: adding additional messaging for emailing           00595043
005900*                                                                 00596001
006000*----------------------------------------------------------------*00600000
006010* DATE:  2011-06-28                                               00601055
006020* WR/IR#: CRQ000000003840                                         00602054
006030* PROGRAMMER: Michael Liesener                                    00603053
006040* DESCRIPTION: April and prior do not increment the year number   00604055
006050*              for fall carryovers.  Changed logic to use July as 00605055
006051*              the cutoff for most carryovers and June as the     00605155
0618ML*              cutoff if it starts in July.                       00605256
0618ML*----------------------------------------------------------------*00606056
0618ML* DATE:  2018-07-24                                               00607066
0618ML* WR/IR#: CHG0203891                                              00608066
0618ML* PROGRAMMER: Michael Liesener                                    00609056
0618ML* DESCRIPTION: Update oracle login externalization for MF refactor00609156
0618ML*              Remove PA references from job                      00609264
006000*----------------------------------------------------------------*00609556
1020ML* DATE:  2020-10-28                                               00610174
1020ML* WR/IR#: CHG0250359                                              00610274
1020ML* PROGRAMMER: Michael Liesener                                    00610374
1020ML* DESCRIPTION: Allow for events longer than 3 seasons due to covid00610474
1020ML*              and fixed oracle date format                       00610574
006000*----------------------------------------------------------------*00610667
006100 ENVIRONMENT DIVISION.                                            00611067
006200*----------------------------------------------------------------*00620000
006300 CONFIGURATION SECTION.                                           00630000
006400 SOURCE-COMPUTER. IBM-3090.                                       00640000
006500 OBJECT-COMPUTER. IBM-3090.                                       00650000
006600                                                                  00660000
006700 INPUT-OUTPUT SECTION.                                            00670000
006800                                                                  00680000
006900 FILE-CONTROL.                                                    00690000
007000                                                                  00700000
0618ML     SELECT ORACLE-LOGON-FILE                 ASSIGN TO ORALOGON. 00701056
0618ML                                                                  00702056
007100     SELECT EVENT-FILE                        ASSIGN TO INP01.    00710000
007200                                                                  00720000
007300     SELECT DTE-CNTL-VALIDATE-FILE-IN         ASSIGN TO INP02.    00730000
007400                                                                  00740000
007500     SELECT VALIDATED-EVENT-FILE              ASSIGN TO OUT01.    00750000
007600                                                                  00760000
007700     SELECT EVENT-ERROR-FILE                  ASSIGN TO OUT02.    00770000
007800                                                                  00780000
007900     SELECT EVENT-CAL-CSV-ERROR-EMAIL-FILE    ASSIGN TO OUT03.    00790000
008000                                                                  00800000
008100     SELECT DTE-CNTL-VALIDATE-FILE-OUT        ASSIGN TO OUT04.    00810000
008200                                                                  00820000
007500     SELECT VALIDATED-EVENT-FILE-INSERTS      ASSIGN TO OUT05.    00821049
008300*----------------------------------------------------------------*00830000
008400 DATA DIVISION.                                                   00840000
008500*----------------------------------------------------------------*00850000
008600 FILE SECTION.                                                    00860000
008700                                                                  00870000
0618ML FD  ORACLE-LOGON-FILE                                            00871056
0618ML     RECORDING MODE IS F                                          00872056
0618ML     LABEL RECORDS ARE STANDARD                                   00873056
0618ML     BLOCK CONTAINS 0 RECORDS                                     00874056
0618ML     RECORD CONTAINS 80 CHARACTERS                                00875056
0618ML     DATA RECORDS IS OL-ORACLE-LOGON-RECORD.                      00876056
0618ML                                                                  00876156
0618ML 01  OL-ORACLE-LOGON-RECORD      PIC X(80).                       00877056
0618ML                                                                  00878056
008800 FD  EVENT-FILE                                                   00880000
008900     RECORDING MODE IS F                                          00890000
009000     BLOCK CONTAINS 0 RECORDS                                     00900000
009100     LABEL RECORDS ARE STANDARD                                   00910000
009200     DATA RECORD IS EVENT-RECORD.                                 00920000
009300                                                                  00930000
009400 01  EVENT-RECORD                     PIC X(224).                 00940000
009500                                                                  00950000
009600 FD  DTE-CNTL-VALIDATE-FILE-IN                                    00960000
009700     RECORDING MODE IS F                                          00970000
009800     LABEL RECORDS ARE STANDARD                                   00980000
009900     BLOCK CONTAINS 0 RECORDS.                                    00990000
010000                                                                  01000000
010100 01  DTE-CNTL-VALIDATE-IN-RCD         PIC X(080).                 01010000
010200                                                                  01020000
010300 FD  VALIDATED-EVENT-FILE                                         01030000
010400     RECORDING MODE IS F                                          01040000
010500     LABEL RECORDS ARE STANDARD                                   01050000
010600     BLOCK CONTAINS 0 RECORDS.                                    01060000
010700                                                                  01070000
010800 01  VALIDATED-EVENT-RECORD           PIC X(212).                 01080006
010900                                                                  01090000
011000 FD  EVENT-ERROR-FILE                                             01100000
011100     RECORDING MODE IS F                                          01110000
011200     LABEL RECORDS ARE STANDARD                                   01120000
011300     BLOCK CONTAINS 0 RECORDS.                                    01130000
011400                                                                  01140000
011500 01  EVENT-ERROR-RECORD               PIC X(240).                 01150000
011600                                                                  01160000
011700 FD  EVENT-CAL-CSV-ERROR-EMAIL-FILE                               01170000
011800     RECORDING MODE IS F                                          01180000
011900     LABEL RECORDS ARE STANDARD                                   01190000
012000     BLOCK CONTAINS 0 RECORDS.                                    01200000
012100                                                                  01210000
012200 01  EVENT-CAL-CSV-ERROR-EMAIL-RCD    PIC  X(80).                 01220000
012300                                                                  01230000
012400 FD  DTE-CNTL-VALIDATE-FILE-OUT                                   01240000
012500     RECORDING MODE IS F                                          01250000
012600     LABEL RECORDS ARE STANDARD                                   01260000
012700     BLOCK CONTAINS 0 RECORDS.                                    01270000
012800                                                                  01280000
012900 01  DTE-CNTL-VALIDATE-OUT-RCD        PIC X(080).                 01290000
013000                                                                  01300000
010300 FD  VALIDATED-EVENT-FILE-INSERTS                                 01301049
010400     RECORDING MODE IS F                                          01302049
010500     LABEL RECORDS ARE STANDARD                                   01303049
010600     BLOCK CONTAINS 0 RECORDS.                                    01304049
010700                                                                  01305049
010800 01  VALIDATED-EVENT-INSERT-REC      PIC X(212).                  01306049
013100*----------------------------------------------------------------*01310000
013200                                                                  01320000
013300 WORKING-STORAGE SECTION.                                         01330000
013400                                                                  01340000
0618ML 01 CC-ORACLE-CONNECTION.                                         01341056
0618ML    05  CC-ORACLE-USERID       PIC  X(40).                        01342056
0618ML        88 CC-AUTO-LOGON                   VALUE '/'.             01343056
0618ML    05  CC-ORACLE-PASSWORD     PIC  X(40).                        01344056
013500*----------------------------------------------------------------*01350000
013600* COPYBOOK - VERIFIED EVENT CALENDAR OUTPUT FILE LAYOUT          *01360000
013700*----------------------------------------------------------------*01370000
013800     COPY PARD905.                                                01380000
013900                                                                  01390000
014000*----------------------------------------------------------------*01400000
014100* COPYBOOK - LAST SUCCESS DATE CONTROL CARD FILE LAYOUT          *01410000
014200*----------------------------------------------------------------*01420000
014300     COPY PARD025.                                                01430000
014400                                                                  01440000
014500*----------------------------------------------------------------*01450000
014600* ERROR E-MAIL FILE RECORD LAYOUT                                *01460000
014700*----------------------------------------------------------------*01470000
014800 01  EM-ERROR-EMAIL-RECORD.                                       01480000
014900     05  EM-MESSAGE-TYPE              PIC  X(16) VALUE SPACES.    01490000
015000     05  EM-MESSAGE-TEXT.                                         01500000
015100         10  EM-GUI-LOD-ID-TXT        PIC  X(16)                  01510000
015200                                      VALUE ' * GUI LOD ID > '.   01520000
015300         10  EM-GUI-LOD-ID            PIC  9(10) VALUE ZEROES.    01530000
015400         10  EM-GUI-LOD-ID-X     REDEFINES                        01540000
015500             EM-GUI-LOD-ID            PIC  X(10).                 01550000
015600         10  EM-INPUT-ITEM-TXT        PIC  X(14)                  01560000
015700                                      VALUE ' INPUT ITEM > '.     01570000
015800         10  EM-DATA-ITEM             PIC  X(24) VALUE SPACES.    01580000
015900                                                                  01590000
016000*----------------------------------------------------------------*01600000
016100* PV- EVENT ERROR FILE RECORD                                    *01610000
016200*----------------------------------------------------------------*01620000
016300 01  PV-ERROR-RECORD.                                             01630000
016400     05  PV-ERROR-TYPE                PIC  X(016) VALUE SPACES.   01640000
016500         88 PV-ERR-TYP-NO-EVNTS          VALUE ' NO EVENTS      '.01650000
016600         88 PV-ERR-TYP-NO-ACTIONS        VALUE ' NO ACTIONS     '.01660000
016700         88 PV-ERR-TYP-NO-RECORDS        VALUE ' NO RECORDS     '.01670000
016800         88 PV-ERR-TYP-NO-M1-FOR-EVNT    VALUE ' NO M1 FOR EVENT'.01680000
016900*        88 PV-ERR-TYP-NO-MOS-FOR-EVNT   VALUE ' NO MOS FOR EVNT'.01690000
017000         88 PV-ERR-TYP-BAD-EVNT-CSV-NAME VALUE 'BAD CSV EVENT NM'.01700000
017100         88 PV-ERR-TYP-BAD-GUI-LOD-ID    VALUE 'BAD GUI LOD ID  '.01710000
017200         88 PV-ERR-TYP-BAD-LY-GUI-LOD-ID VALUE 'BAD LY GUI ID   '.01720000
017300         88 PV-ERR-TYP-BAD-CSV-DATE-NAME VALUE 'BAD CSV DTE NAME'.01730000
017400         88 PV-ERR-TYP-BAD-WEEK          VALUE 'BAD WEEK        '.01740000
017500         88 PV-ERR-TYP-BAD-DATE-FMT      VALUE 'BAD DATE FORMAT '.01750000
017600         88 PV-ERR-TYP-MULT-MKDN-EVNT-RW VALUE 'MULT MARK 1 ROWS'.01760000
017700         88 PV-ERR-TYP-BAD-DTE-FMT-MD1   VALUE 'BAD DATE FMT MD1'.01770000
017800         88 PV-ERR-TYP-BAD-DTE-FMT-MD2   VALUE 'BAD DATE FMT MD2'.01780000
017900         88 PV-ERR-TYP-BAD-DTE-FMT-MD3   VALUE 'BAD DATE FMT MD3'.01790005
017900         88 PV-ERR-TYP-BAD-DTE-FMT-MD4   VALUE 'BAD DATE FMT MD4'.01791005
017900         88 PV-ERR-TYP-BAD-DTE-FMT-MD5   VALUE 'BAD DATE FMT MD5'.01792005
017900         88 PV-ERR-TYP-BAD-DTE-FMT-MD6   VALUE 'BAD DATE FMT MD6'.01793005
018000         88 PV-ERR-TYP-BAD-DTE-FMT-MOS   VALUE 'BAD DATE FMT MOS'.01800000
018100         88 PV-ERR-TYP-BAD-DTE-ORDER     VALUE 'BAD DATE ORDER  '.01810000
018100         88 PV-ERR-TYP-BAD-DTE-PAST      VALUE 'CANT UPDATE PAST'.01811008
018200     05  FILLER                       PIC  X(003) VALUE ' * '.    01820000
018300     05  PV-ERROR-MESSAGE             PIC  X(201) VALUE SPACES.   01830000
018400                                                                  01840000
018500*----------------------------------------------------------------*01850000
018600* PV- PROGRAM STATUS                                             *01860000
018700*----------------------------------------------------------------*01870000
018800 01  PV-PROGRAM-STATUS.                                           01880000
018900     05  FILLER                       PIC  X(27) VALUE            01890000
019000         'WORKING STORAGE STARTS HERE'.                           01900000
019100     05  PV-PARAGRAPH-NAME            PIC  X(50) VALUE SPACES.    01910000
019200     05  PV-ORA-OPERATION             PIC  X(50) VALUE SPACES.    01920000
019300     05  PV-OPERATION-MSG-1           PIC  X(40) VALUE SPACES.    01930000
019400     05  PV-OPERATION-MSG-2           PIC  X(40) VALUE SPACES.    01940000
019500 01  FILLER                           REDEFINES                   01950000
019600     PV-PROGRAM-STATUS                PIC  X(207).                01960000
019700                                                                  01970000
019800 01  AC-ABEND-CODE                    PIC S9(04) VALUE +0 COMP.   01980000
019900     88  AC-4003-CONTROL-CARD-ERROR              VALUE +4003.     01990000
020000     88  AC-4013-ORA-ERROR                       VALUE +4013.     02000000
020100     88  AC-4019-CALENDAR-ROUTINE-ERROR          VALUE +4019.     02010000
020200     88  AC-4444-NON-ORA-ERROR                   VALUE +4444.     02020000
020300                                                                  02030000
020400*----------------------------------------------------------------*02040000
020500* PC- PROGRAM CONSTANTS                                          *02050000
020600*----------------------------------------------------------------*02060000
020700 01  PC-PROGRAM-CONSTANTS.                                        02070000
020800     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'PEKUT905'.02080065
020900     05  PC-MAX-RETRIES               PIC  9(01) VALUE 5.         02090000
021000     05  PC-FIELD-LENGTH              PIC S9(03) VALUE +10 COMP-3.02100000
021100     05  PC-DFLT-MKDN-QTY-TYP-CDE     PIC  X(03) VALUE 'PCT'.     02110000
021200     05  PC-NO-ACTIONS-FOR-FILE       PIC  X(52) VALUE            02120000
021300         'NO EVENT INSERT OR UPDATE ACTIONS WERE FOUND IN FILE'.  02130000
021200     05  PC-MSG-FOR-MKT-SOLUTION1     PIC  X(56) VALUE            02131025
021300       'Market Solutions needs to research and fix the issue(s).'.02132022
021200     05  PC-MSG-FOR-CUR-DTE-CHG1      PIC  X(54) VALUE            02133034
021300       'There was a calendar event change in the current week.'.  02134032
021200     05  PC-MSG-FOR-CUR-DTE-CHG2      PIC  X(55) VALUE            02135043
021300       'If calendar load job PAK106 fails during weekend batch,'. 02136043
021200     05  PC-MSG-FOR-CUR-DTE-CHG3      PIC  X(52) VALUE            02137043
021300       'it must be resolved immediately - no force complete.'.    02138043
021400     05  PC-NO-EVENTS-IN-FILE         PIC  X(35) VALUE            02140000
021500                          'NO USABLE EVENTS WERE FOUND IN FILE'.  02150000
021600     05  PC-NO-RECORDS-IN-FILE        PIC  X(43) VALUE            02160000
021700                  'EMPTY INPUT - NO RECORDS WERE FOUND IN FILE'.  02170000
021800     05  PC-MULT-MARK-1-IN-DB         PIC  X(54) VALUE            02180000
021900         'MULT. ROWS IN PET_CLR_MKDN_EVNT FOR MARK 1 OF EVENT # '.02190000
022000     05  PC-EM-GUI-LOD-ID-TXT         PIC  X(16)                  02200000
022100                                      VALUE ' * GUI LOD ID > '.   02210000
022200     05  PC-EM-INPUT-ITEM-TXT         PIC  X(14)                  02220000
022300                                      VALUE ' INPUT ITEM > '.     02230000
0618ML     05  PC-AUTO-LOGON                PIC  X(01)  VALUE '/'.      02231056
022400                                                                  02240000
022500*----------------------------------------------------------------*02250000
022600* PS- PROGRAM SWITCHES                                           *02260000
022700*----------------------------------------------------------------*02270000
022800 01  PS-PROGRAM-SWITCHES.                                         02280000
022900     05  PS-END-OF-FILE-SW            PIC  X(01) VALUE 'N'.       02290000
023000         88  PS-END-OF-FILE                      VALUE 'Y'.       02300000
023100         88  PS-NOT-END-OF-FILE                  VALUE 'N'.       02310000
023200     05  PS-CSV-ERROR-SW              PIC  X(01) VALUE 'N'.       02320000
023300         88  PS-CSV-ERROR-FOUND                  VALUE 'Y'.       02330000
023400         88  PS-CSV-ERROR-NOT-FOUND              VALUE 'N'.       02340000
023500     05  PS-CSV-RCD-ERROR-SW          PIC  X(01) VALUE 'N'.       02350000
023600         88  PS-CSV-RCD-ERROR-FOUND              VALUE 'Y'.       02360000
023700         88  PS-CSV-RCD-ERROR-NOT-FOUND          VALUE 'N'.       02370000
023800     05  PS-VALID-DATE-FORMAT-SW      PIC  X(01) VALUE 'Y'.       02380000
023900         88  PS-VALID-DATE-FMT                   VALUE 'Y'.       02390000
024000         88  PS-INVALID-DATE-FMT                 VALUE 'N'.       02400000
024100     05  PS-END-OF-FETCH-SW           PIC  X(01) VALUE 'N'.       02410000
024200         88  PS-END-OF-FETCH                     VALUE 'Y'.       02420000
024300         88  PS-NOT-END-OF-FETCH                 VALUE 'N'.       02430000
024400     05  PS-LAST-DATE-PROCESSED-SW    PIC  X(01) VALUE 'N'.       02440000
024500         88  PS-LAST-DATE-PROCESSED              VALUE 'Y'.       02450000
024600         88  PS-NOT-LAST-DATE-PROCESSED          VALUE 'N'.       02460000
024700     05  PS-LAST-DASH-PROCESSED-SW    PIC  X(01) VALUE 'N'.       02470000
024800         88  PS-LAST-DASH-PROCESSED              VALUE 'Y'.       02480000
024900         88  PS-NOT-LAST-DASH-PROCESSED          VALUE 'N'.       02490000
025000     05  PS-READY-TRACE-SW            PIC  X(01) VALUE 'N'.       02500000
025100         88  PS-READY-TRACE                      VALUE 'Y'.       02510000
025200         88  PS-RESET-TRACE                      VALUE 'N'.       02520000
025300     05  PS-EVNT-EXISTENCE-SW         PIC  X(01) VALUE 'N'.       02530000
025400         88  PS-EXISTING-EVNT                    VALUE 'Y'.       02540000
025500         88  PS-NOT-EXISTING-EVNT                VALUE 'N'.       02550000
025600     05  PS-LY-CLR-EVNT-ID-SW         PIC  X(01) VALUE 'N'.       02560000
025700         88  PS-LY-EVNT-ID-FOUND                 VALUE 'Y'.       02570000
025800         88  PS-NO-LY-EVNT-ID                    VALUE 'N'.       02580000
025900     05  PS-EVNT-UPDATE-NEEDED-SW     PIC  X(01) VALUE 'N'.       02590000
026000         88  PS-EVNT-UPDATE-NEEDED               VALUE 'Y'.       02600000
026100         88  PS-EVNT-UPDATE-NOT-NEEDED           VALUE 'N'.       02610000
026200     05  PS-EVNT-MARK-INSERT-SW       PIC  X(01) VALUE 'N'.       02620000
026300         88  PS-CLR-EVNT-MARK-INS-REQ            VALUE 'Y'.       02630000
026400         88  PS-CLR-EVNT-MARK-EXISTS             VALUE 'N'.       02640000
026500     05  PS-EVNT-SEASON-SW            PIC  X(01) VALUE 'N'.       02650000
026600         88  PS-EVNT-SEA-SPRING                  VALUE 'Y'.       02660000
026700         88  PS-EVNT-SEA-FALL                    VALUE 'N'.       02670000
026800     05  PS-EVNT-NEW-FRMT-NAME-SW     PIC  X(01) VALUE 'N'.       02680000
026900         88  PS-NEW-FRMT-NAME                    VALUE 'Y'.       02690000
027000         88  PS-OLD-FRMT-NAME                    VALUE 'N'.       02700000
027100     05  PS-EVNT-OK-TO-DELETE-SW      PIC  X(01) VALUE 'N'.       02710000
027200         88  PS-EVNT-OK-TO-DELETE                VALUE 'Y'.       02720000
027300         88  PS-EVNT-NOT-OK-TO-DELETE            VALUE 'N'.       02730000
027400     05  PS-EVNT-INACTIVE-SW          PIC  X(01) VALUE 'N'.       02740000
027500         88  PS-EVNT-INACTIVE                    VALUE 'Y'.       02750000
027600         88  PS-EVNT-ACTIVE                      VALUE 'N'.       02760000
027400     05  PS-CURRENT-EVENT-SW          PIC  X(01) VALUE 'N'.       02761032
027500         88  PS-CURRENT-EVENT-CHANGE             VALUE 'Y'.       02762032
027600         88  PS-CURRENT-EVENT-NO-CHANGE          VALUE 'N'.       02763032
0618ML     05  PS-END-OF-LOGON-FILE-SW      PIC  X(01) VALUE 'N'.       02765057
0618ML         88  PS-END-OF-LOGON-FILE                VALUE 'Y'.       02766057
1020ML     05  PS-CURRENT-EVENT-OVERRIDE-SW PIC  X(01) VALUE 'N'.       02767067
1020ML         88  PS-CURRENT-EVENT-OVERRIDE           VALUE 'Y'.       02768067
1020ML         88  PS-CURRENT-EVENT-NO-OVERRIDE        VALUE 'N'.       02769067
027700                                                                  02770000
027800*----------------------------------------------------------------*02780000
027900* PV- PROGRAM VARIABLES                                          *02790000
028000*----------------------------------------------------------------*02800000
028600 01  PV-PROGRAM-VARIABLES.                                        02860000
028700     05  PV-SLASH-COUNT               PIC  9(01) VALUE ZERO.      02870000
028800     05  PV-DASH-COUNT                PIC  9(01) VALUE ZERO.      02880000
028900     05  PV-MKDN1-COUNT               PIC  9(01) VALUE ZERO.      02890000
029000     05  PV-MKDN2-COUNT               PIC  9(01) VALUE ZERO.      02900000
029100     05  PV-MKDN3-COUNT               PIC  9(01) VALUE ZERO.      02910002
029100     05  PV-MKDN4-COUNT               PIC  9(01) VALUE ZERO.      02911002
029100     05  PV-MKDN5-COUNT               PIC  9(01) VALUE ZERO.      02912002
029100     05  PV-MKDN6-COUNT               PIC  9(01) VALUE ZERO.      02913002
029200     05  PV-MKDNO-COUNT               PIC  9(01) VALUE ZERO.      02920000
029300     05  PV-BYTE-COUNT                PIC  9(04) VALUE ZERO.      02930000
029400     05  PV-SQL-SUB                   PIC  9(01) VALUE ZERO.      02940000
029500     05  PV-SPACE                     PIC  X(01).                 02950000
029600     05  PV-DISPLAY-INDEX             PIC S9(04) COMP.            02960000
029700     05  PV-HOLD-INDEX-1              PIC S9(04) COMP.            02970000
029800     05  PV-HOLD-INDEX-2              PIC S9(04) COMP.            02980000
029900     05  PV-TALLY                     PIC S9(03) COMP-3 VALUE +0. 02990000
030000     05  PV-INIT-MAX-CLR-EVNT-ID      PIC S9(10) COMP-3 VALUE +0. 03000000
030100     05  PV-NEXT-CLR-EVNT-ID          PIC S9(10) COMP VALUE +0.   03010000
030200     05  PV-LY-CLR-EVNT-NM            PIC  X(20) VALUE SPACES.    03020000
030300     05  PV-LY-EVNT-GUI-LOD-ID        PIC S9(10) COMP-3 VALUE +0. 03030000
030400     05  PV-HOLD-PRJCTN-ID            PIC S9(10) COMP-3 VALUE +0. 03040000
030500     05  PV-PESA-COUNT                PIC  9(04) VALUE ZERO.      03050000
030600     05  PV-PEMA-COUNT                PIC  9(04) VALUE ZERO.      03060000
030700     05  PV-GUI-LOD-ID                PIC  9(10) VALUE ZEROES.    03070000
030800     05  PV-DATA-ITEM                 PIC  X(24) VALUE SPACES.    03080000
030900     05  PV-CLR-MKDN-CDE              PIC  X(01) VALUE SPACE.     03090000
0618ML     05  PV-ORACLE-USERID-LEN         PIC S9(04) VALUE ZEROS      03091056
0618ML                                        COMP SYNC.                03092056
0618ML     05  PV-ORACLE-PASSWORD-LEN       PIC S9(04) VALUE ZEROS      03093056
0618ML                                        COMP SYNC.                03094056
031000                                                                  03100000
031100 01  PV-DISPLAY-VARIABLES.                                        03110000
031200     05  PV-DISP-MAX-CLR-EVNT-ID      PIC  9(10) VALUE ZEROES.    03120000
031300     05  PV-DISP-NEXT-CLR-EVNT-ID     PIC  9(10) VALUE ZEROES.    03130000
031400     05  PV-DISP-CLR-EVNT-ID          PIC  9(10) VALUE ZEROES.    03140000
031500     05  PV-DISP-CLR-EVNT-GUI-ID      PIC  9(10) VALUE ZEROES.    03150000
031600     05  PV-DISP-LY-CLR-EVNT-ID       PIC  9(10) VALUE ZEROES.    03160000
031700     05  PV-DISP-LY-EVNT-GUI-ID       PIC  9(10) VALUE ZEROES.    03170000
031800     05  PV-DISP-EA-CLR-EVNT-ID       PIC  9(10) VALUE ZEROES.    03180000
031900     05  PV-DISP-EA-LY-CLR-EVNT-ID    PIC  9(10) VALUE ZEROES.    03190000
032000     05  PV-DISP-EA-GUI-LOD-ID        PIC  9(10) VALUE ZEROES.    03200000
032100     05  PV-DISP-CLR-FRST-EFF-DTE     PIC  X(20) VALUE SPACES.    03210000
032200     05  PV-DISP-MKDN-EVNT-ASSN-UPD   PIC  9(09) VALUE ZEROES.    03220000
032300     05  PV-DISP-PRJCTN-ID            PIC  9(10) VALUE ZEROES.    03230000
032400     05  PV-DISP-EVNT-YR-NBR          PIC  9(04) VALUE ZEROES.    03240000
032500     05  PV-DISP-EVNT-WK-NBR          PIC  9(02) VALUE ZEROES.    03250000
032600                                                                  03260000
032700 01  PV-CSV-EVNT-NM-FIELDS.                                       03270000
032800     05  PV-EVNT-CSV-NM-FSCL-YR.                                  03280000
032900         10  PV-EVNT-CSV-NM-FY-CC     PIC  X(02) VALUE '20'.      03290000
033000         10  PV-EVNT-CSV-NM-FY        PIC  X(02).                 03300000
033100     05  PV-EVNT-CSV-NM-WK            PIC  X(02).                 03310000
033200     05  PV-EVNT-START-CAL-MN         PIC  X(02).                 03320000
033300     05  PV-FRST-DY-OF-FSCL-WK        PIC  X(10).                 03330000
033400     05  PV-EVNT-CSV-NM-OLD-STYLE.                                03340000
033500         10  PV-EVNT-CSV-NM-OS-FY     PIC  X(02).                 03350000
033600         10  FILLER                   PIC  X(01) VALUE SPACE.     03360000
033700         10  PV-EVNT-CSV-NM-OS-MON    PIC  X(03).                 03370000
033800         10  FILLER                   PIC  X(01) VALUE SPACE.     03380000
033900         10  PV-EVNT-CSV-NM-OS-WK-FL  PIC  X(02).                 03390000
034000         10  FILLER                   PIC  X(01) VALUE SPACE.     03400000
034100         10  PV-EVNT-CSV-NM-OS-MO-WK  PIC  X(01).                 03410000
034200     05  PV-MONTH                     PIC  X(03) VALUE SPACES.    03420000
034300     05  MTH-NDX                      PIC S9(09) COMP VALUE ZEROS.03430000
034400                                                                  03440000
034500 01  PV-DATE-FIELDS.                                              03450000
034600     05  PV-CURRENT-DATE.                                         03460000
034700         10  PV-CURRENT-YEAR          PIC  X(04).                 03470000
034800         10  FILLER                   PIC  X(01) VALUE '-'.       03480000
034900         10  PV-CURRENT-MONTH         PIC  X(02).                 03490000
035000         10  FILLER                   PIC  X(01) VALUE '-'.       03500000
035100         10  PV-CURRENT-DAY           PIC  X(02).                 03510000
035200     05  PV-DATE-TODAY                PIC  X(10).                 03520000
035300                                                                  03530000
035400 01  PV-CRNT-DATE-FIELDS.                                         03540000
035500     10  PV-CRNT-FSCL-YR-NBR          PIC  9(04).                 03550000
035600     10  PV-CRNT-FSCL-WK-NBR          PIC  9(02).                 03560000
035600     10  PV-CRNT-FSCL-WK-BEG-DTE      PIC  X(10).                 03561032
035600     10  PV-CRNT-FSCL-WK-END-DTE      PIC  X(10).                 03562032
035700     10  PV-CRNT-SEA-DESC             PIC  X(06).                 03570000
035800     10  PV-CRNT-SEA-END-DTE          PIC  X(19).                 03580000
035900                                                                  03590000
036000 01  PV-UNSTRING-COLUMNS.                                         03600000
036100     05  PV-UC-ELEMENT.                                           03610000
036200         10  PV-UC-A                  PIC  X(40).                 03620000
036300         10  PV-UC-B                  PIC  X(40).                 03630000
036400         10  PV-UC-C                  PIC  X(40).                 03640000
036500         10  PV-UC-D                  PIC  X(40).                 03650000
036600         10  PV-UC-E                  PIC  X(40).                 03660000
036700         10  PV-UC-F                  PIC  X(40).                 03670000
036800         10  PV-UC-G                  PIC  X(40).                 03680000
036900         10  PV-UC-H                  PIC  X(40).                 03690000
037000         10  PV-UC-I                  PIC  X(40).                 03700000
037100         10  PV-UC-J                  PIC  X(40).                 03710000
037200         10  PV-UC-K                  PIC  X(40).                 03720000
037200         10  PV-UC-L                  PIC  X(40).                 03721001
037200         10  PV-UC-M                  PIC  X(40).                 03722001
037300                                                                  03730000
037400 01  PV-COLUMN-ARRAY                  REDEFINES                   03740000
037500     PV-UNSTRING-COLUMNS.                                         03750000
037600         10  PV-CA-ELEMENT            OCCURS 13 TIMES             03760001
037700                                      INDEXED BY PV-CADEX2        03770000
037800                                      PIC  X(40).                 03780000
037900                                                                  03790000
038000 01  PV-VARIABLE-ARRAYS.                                          03800000
038100     05  PV-VA1-ELEMENT.                                          03810000
038200         10  PV-VA1-BYTE              OCCURS 20 TIMES             03820000
038300                                      INDEXED BY PV-VA1BEGDEX     03830000
038400                                                 PV-VA1CURDEX     03840000
038500                                                 PV-VA1ENDDEX     03850000
038600                                      PIC  X(01).                 03860000
038700     05  PV-VA2-ELEMENT.                                          03870000
038800         10  PV-VA2-BYTE              OCCURS 20 TIMES             03880000
038900                                      INDEXED BY PV-VA2BEGDEX     03890000
039000                                                 PV-VA2CURDEX     03900000
039100                                                 PV-VA2ENDDEX     03910000
039200                                      PIC  X(01).                 03920000
039300     05  PV-VA2-NUMBER                REDEFINES                   03930000
039400         PV-VA2-ELEMENT               PIC  9(20).                 03940000
039500                                                                  03950000
039600 01  PV-DATE-CELL-AREA.                                           03960000
039700     05  FILLER                       PIC  X(01) VALUE SPACE.     03970000
039800     05  PV-DATE-CELL-ARRAY.                                      03980000
039900         10  PV-DCA-ELEMENT           OCCURS 40 TIMES             03990000
040000                                      INDEXED BY PV-DCEDEX1       04000000
040100                                                 PV-DCEDEX2       04010000
040200                                      PIC  X(01).                 04020000
040300     05  PV-DCEDEX3                   USAGE INDEX.                04030000
040400                                                                  04040000
040500 01  PV-DATE-CONVERSION-AREA.                                     04050000
040600     05  PV-DCA-DATE.                                             04060000
040700         10  PV-DCA-YEAR              PIC  X(04).                 04070000
040800         10  PV-DCA-YEAR-NUM          REDEFINES                   04080000
040900             PV-DCA-YEAR              PIC  9(04).                 04090000
041000         10  PV-DCA-YEAR-ALL          REDEFINES                   04100000
041100             PV-DCA-YEAR.                                         04110000
041200             15  PV-DCA-YEAR-POS12    PIC  9(02).                 04120000
041300             15  PV-DCA-YEAR-POS3     PIC  9(01).                 04130000
041400             15  PV-DCA-YEAR-POS4     PIC  9(01).                 04140000
041500         10  FILLER                   PIC  X(01) VALUE '-'.       04150000
041600         10  PV-DCA-MM                PIC  X(02).                 04160000
041700         10  FILLER                   PIC  X(01) VALUE '-'.       04170000
041800         10  PV-DCA-DA                PIC  X(02).                 04180000
041900         10  FILLER                   PIC X(09) VALUE ' 00.00.00'.04190000
042000                                                                  04200000
042100     05  FILLER                       PIC  X(01) VALUE SPACE.     04210000
042200     05  PV-DATE-ARRAY.                                           04220000
042300         10 PV-DA-ELEMENT             OCCURS 20 TIMES             04230000
042400                                      INDEXED BY PV-DAEDEX        04240000
042500                                      PIC  X(01).                 04250000
042600                                                                  04260000
042700     05  PV-DCA-MARK-DATE             PIC  X(10).                 04270000
042800     05  PV-DCA-MOS-DATE              PIC  X(10).                 04280000
042900     05  PV-DCA-EXTR-DTE              PIC  X(19) VALUE            04290000
043000         '1801-01-01 00.00.00'.                                   04300000
043100     05  PV-DCA-PRC-DTE               PIC  X(19) VALUE            04310000
043200         '1801-01-01 00.00.00'.                                   04320000
043300                                                                  04330000
043400     05  PV-HOLD-MM-1                 PIC  X(02) VALUE '00'.      04340000
043500     05  PV-HOLD-MM-2                 PIC  X(02) VALUE '00'.      04350000
043600     05  PV-HOLD-MM-3                 PIC  X(02) VALUE '00'.      04360002
043600     05  PV-HOLD-MM-4                 PIC  X(02) VALUE '00'.      04361002
043600     05  PV-HOLD-MM-5                 PIC  X(02) VALUE '00'.      04362002
043600     05  PV-HOLD-MM-6                 PIC  X(02) VALUE '00'.      04363002
043700     05  PV-HOLD-MM-O                 PIC  X(02) VALUE '00'.      04370000
043800     05  PV-DCA-YEAR-1                PIC  9(04) VALUE ZEROS.     04380000
043900     05  PV-DCA-YEAR-2                PIC  9(04) VALUE ZEROS.     04390000
044000     05  PV-DCA-YEAR-3                PIC  9(04) VALUE ZEROS.     04400002
044000     05  PV-DCA-YEAR-4                PIC  9(04) VALUE ZEROS.     04401002
044000     05  PV-DCA-YEAR-5                PIC  9(04) VALUE ZEROS.     04402002
044000     05  PV-DCA-YEAR-6                PIC  9(04) VALUE ZEROS.     04403002
044100     05  PV-DCA-YEAR-O                PIC  9(04) VALUE ZEROS.     04410000
044200     05  PV-DCA-YEAR-H                PIC  9(04) VALUE ZEROS.     04420000
044300     05  PV-EVNT-CAL-YEAR             PIC  9(04) VALUE ZEROS.     04430000
1020ML     05  PV-PRIOR-MM                  PIC  X(02) VALUE '00'.      04431067
1020ML     05  PV-PRIOR-YEAR                PIC  9(04) VALUE ZEROS.     04432067
044400                                                                  04440000
044500 01  PV-DATE-TO-VALIDATE.                                         04450000
044600     05  PV-VALIDATE-DATE             PIC  X(10).                 04460000
044700     05  FILLER                       PIC  X(09).                 04470000
044800                                                                  04480000
044900 01  PV-NULL-INDICATORS.                                          04490000
045000     05  PV-LY-CE-ID-NULL-IND         PIC S9(04) COMP VALUE ZERO. 04500000
045100     05  PV-IN-LY-CE-ID-NULL-IND      PIC S9(04) COMP VALUE ZERO. 04510000
045200     05  PV-GUI-LOD-ID-NULL-IND       PIC S9(04) COMP VALUE ZERO. 04520000
045300     05  PV-NULL-IND2                 PIC S9(04) COMP VALUE ZERO. 04530000
045400                                                                  04540000
045500 01  PV-MONTH-TABLE.                                              04550000
045600     05  FILLER                       PIC  X(05) VALUE '01JAN'.   04560000
045700     05  FILLER                       PIC  X(05) VALUE '02FEB'.   04570000
045800     05  FILLER                       PIC  X(05) VALUE '03MAR'.   04580000
045900     05  FILLER                       PIC  X(05) VALUE '04APR'.   04590000
046000     05  FILLER                       PIC  X(05) VALUE '05MAY'.   04600000
046100     05  FILLER                       PIC  X(05) VALUE '06JUN'.   04610000
046200     05  FILLER                       PIC  X(05) VALUE '07JUL'.   04620000
046300     05  FILLER                       PIC  X(05) VALUE '08AUG'.   04630000
046400     05  FILLER                       PIC  X(05) VALUE '09SEP'.   04640000
046500     05  FILLER                       PIC  X(05) VALUE '10OCT'.   04650000
046600     05  FILLER                       PIC  X(05) VALUE '11NOV'.   04660000
046700     05  FILLER                       PIC  X(05) VALUE '12DEC'.   04670000
046800 01  PV-MONTH-ELEMENTS REDEFINES PV-MONTH-TABLE.                  04680000
046900     05  PV-MTH-ELEMENTS              OCCURS 12 TIMES.            04690000
047000         10  PV-MTH-CAL-MM            PIC  X(02).                 04700000
047100         10  PV-MTH-MON-ABBR          PIC  X(03).                 04710000
047200                                                                  04720000
047300*----------------------------------------------------------------*04730000
047400* DF- DATE AND TIME FIELDS USED IN P9990-                        *04740000
047500*----------------------------------------------------------------*04750000
047600 01  DF-DATE-TIME-FIELDS.                                         04760000
047700     05  DF-CURRENT-DATE-TIME.                                    04770000
047800         10  DF-CURRENT-YR            PIC  9(04) VALUE ZEROS.     04780000
047900         10  DF-CURRENT-MO            PIC  9(02) VALUE ZEROS.     04790000
048000         10  DF-CURRENT-DY            PIC  9(02) VALUE ZEROS.     04800000
048100         10  DF-CURRENT-HR            PIC  9(02) VALUE ZEROS.     04810000
048200         10  DF-CURRENT-MIN           PIC  9(02) VALUE ZEROS.     04820000
048300         10  DF-CURRENT-SEC           PIC  9(02) VALUE ZEROS.     04830000
048400         10  DF-CURRENT-HSEC          PIC  9(02) VALUE ZEROS.     04840000
048500     05  DF-ACCEPT-DATE.                                          04850000
048600         10  DF-ACCEPT-YR             PIC  9(02) VALUE ZEROS.     04860000
048700         10  DF-ACCEPT-MO             PIC  9(02) VALUE ZEROS.     04870000
048800         10  DF-ACCEPT-DY             PIC  9(02) VALUE ZEROS.     04880000
048900     05  DF-ACCEPT-TIME.                                          04890000
049000         10  DF-ACCEPT-HR             PIC  9(02) VALUE ZEROS.     04900000
049100         10  DF-ACCEPT-MIN            PIC  9(02) VALUE ZEROS.     04910000
049200         10  DF-ACCEPT-SEC            PIC  9(02) VALUE ZEROS.     04920000
049300         10  DF-ACCEPT-HSEC           PIC  9(02) VALUE ZEROS.     04930000
049400     05  DF-DISPLAY-DATE.                                         04940000
049500         10  DF-DD-YR                 PIC  X(04) VALUE SPACES.    04950000
049600         10  FILLER                   PIC  X(01) VALUE '-'.       04960000
049700         10  DF-DD-MO                 PIC  X(02) VALUE SPACES.    04970000
049800         10  FILLER                   PIC  X(01) VALUE '-'.       04980000
049900         10  DF-DD-DY                 PIC  X(02) VALUE SPACES.    04990000
050000     05  DF-DISPLAY-TIME.                                         05000000
050100         10  DF-DT-HR                 PIC  X(02) VALUE SPACE.     05010000
050200         10  FILLER                   PIC  X(01) VALUE ':'.       05020000
050300         10  DF-DT-MIN                PIC  X(02) VALUE SPACE.     05030000
050400         10  FILLER                   PIC  X(01) VALUE ':'.       05040000
050500         10  DF-DT-SEC                PIC  X(02) VALUE SPACE.     05050000
050600                                                                  05060000
050700*----------------------------------------------------------------*05070000
050800* PV- TABLE RECORD VARIABLES                                     *05080000
050900*----------------------------------------------------------------*05090000
051000 01  PV-CC-LSC-CONTROL-CARD-RCD.                                  05100000
051100     05  PV-CC-LST-SUCCESS-CSV-LABEL    PIC X(19)                 05110000
051200                                     VALUE 'PREV SUCCESS TMST: '. 05120000
051300     05  PV-CC-LST-SUCCESS-CSV-TMST.                              05130000
051400         10  PV-CC-LST-SUCCESS-CSV-DTE  PIC X(10) VALUE SPACES.   05140000
051500         10  PV-CC-LST-SUCCESS-FILLER   PIC X(01) VALUE '-'.      05150000
051600         10  PV-CC-LST-SUCCESS-CSV-TIME PIC X(08) VALUE SPACES.   05160000
051700     05  PV-CC-LSC-FILLER-1             PIC X(01) VALUE SPACES.   05170000
051800     05  PV-CC-LST-SUCCESS-CSV-IND-LBL  PIC X(18)                 05180000
051900                                     VALUE 'PREV SUCCESS IND: '.  05190000
052000     05  PV-CC-LST-SUCCESS-CSV-IND      PIC X(01) VALUE SPACES.   05200000
052100     05  PV-CC-LSC-FILLER-2             PIC X(22) VALUE SPACES.   05210000
052200                                                                  05220000
052300*----------------------------------------------------------------*05230000
052400* PV- TABLE RECORD VARIABLES                                     *05240000
052500*----------------------------------------------------------------*05250000
052600 01  PV-CLR-EVNT-RECORD.                                          05260000
052700     05  PV-CER-CLR-EVNT-ID           PIC S9(10) COMP-3.          05270000
052800     05  PV-CER-CLR-EVNT-NM           PIC  X(20) VALUE SPACES.    05280000
052900     05  PV-CER-LY-CLR-EVNT-ID        PIC S9(10) COMP-3.          05290000
053000     05  PV-CER-GUI-LOD-ID            PIC S9(10) COMP-3.          05300000
053100                                                                  05310000
053200 01  PV-CLR-EVNT-OUTPUT-DATES.                                    05320000
053300     05  PV-MD1-FRST-EFF-DATE         PIC  X(10) VALUE SPACES.    05330000
053400     05  PV-MD1-LAST-EFF-DATE         PIC  X(10) VALUE SPACES.    05340000
053500     05  PV-MD2-FRST-EFF-DATE         PIC  X(10) VALUE SPACES.    05350000
053600     05  PV-MD2-LAST-EFF-DATE         PIC  X(10) VALUE SPACES.    05360000
053700     05  PV-MD3-FRST-EFF-DATE         PIC  X(10) VALUE SPACES.    05370002
053800     05  PV-MD3-LAST-EFF-DATE         PIC  X(10) VALUE SPACES.    05380002
053700     05  PV-MD4-FRST-EFF-DATE         PIC  X(10) VALUE SPACES.    05381002
053800     05  PV-MD4-LAST-EFF-DATE         PIC  X(10) VALUE SPACES.    05381102
053700     05  PV-MD5-FRST-EFF-DATE         PIC  X(10) VALUE SPACES.    05381202
053800     05  PV-MD5-LAST-EFF-DATE         PIC  X(10) VALUE SPACES.    05382002
053700     05  PV-MD6-FRST-EFF-DATE         PIC  X(10) VALUE SPACES.    05383002
053800     05  PV-MD6-LAST-EFF-DATE         PIC  X(10) VALUE SPACES.    05384002
053900     05  PV-MOS-FRST-EFF-DATE         PIC  X(10) VALUE SPACES.    05390000
054000     05  PV-MOS-LAST-EFF-DATE         PIC  X(10) VALUE SPACES.    05400000
054100                                                                  05410000
054200 01  PV-COMPARE-DATES.                                            05420000
054300     05  PV-COMPARE-DATE-ALPHA        PIC  X(10) VALUE SPACES.    05430000
054400     05  PV-COMPARE-DATE-NUM REDEFINES PV-COMPARE-DATE-ALPHA.     05440000
054500         10  PV-COMPARE-YEAR          PIC  9(04).                 05450000
054600         10  FILLER                   PIC  X(01).                 05460000
054700         10  PV-COMPARE-MONTH         PIC  9(02).                 05470000
054800         10  FILLER                   PIC  X(01).                 05480000
054900         10  PV-COMPARE-DAY           PIC  9(02).                 05490000
055000                                                                  05500000
055100 01  PV-DO-LOW-DATE.                                              05510000
055200     05  PV-DO-LOW-YYYY               PIC  9(04).                 05520000
055300     05  PV-DO-LOW-MM                 PIC  9(02).                 05530000
055400     05  PV-DO-LOW-DD                 PIC  9(02).                 05540000
055500                                                                  05550000
055100 01  PV-DO-LOW-DATE-ALTERNATE.                                    05551032
055200     05  PV-DO-LOW-YYYY-ALT           PIC  9(04).                 05552032
055300     05  PV-DO-LOW-MM-ALT             PIC  9(02).                 05553032
055400     05  PV-DO-LOW-DD-ALT             PIC  9(02).                 05554032
055500                                                                  05555032
055600 01  PV-DO-HIGH-DATE.                                             05560000
055700     05  PV-DO-HIGH-YYYY              PIC  9(04).                 05570000
055800     05  PV-DO-HIGH-MM                PIC  9(02).                 05580000
055900     05  PV-DO-HIGH-DD                PIC  9(02).                 05590000
056000                                                                  05600000
056100 01  PV-CLR-MKDN-EVNT-RECORD.                                     05610000
056200     05  PV-CMER-CLR-EVNT-ID          PIC S9(10) COMP-3.          05620000
056300     05  PV-CMER-CLR-MKDN-CDE         PIC  X(01).                 05630000
056400     05  PV-CMER-MKDN-OPTMZN-GP-CDE   PIC  X(01).                 05640000
056500     05  PV-CMER-CLR-FRST-EFF-DTE     PIC  X(19).                 05650000
056600     05  PV-CMER-CLR-LAST-EFF-DTE     PIC  X(19).                 05660000
056700     05  PV-CMER-MKDN-QTY-TYP-CDE     PIC  X(03).                 05670000
056800     05  PV-CMER-MKDN-PCT             PIC S9(03) COMP-3.          05680000
056900     05  PV-CMER-MKDN-PRPT-AMT        PIC S9(03)V9(2) COMP-3.     05690000
057000     05  PV-CMER-EVNT-MKDN-EXTR-DTE   PIC  X(19).                 05700000
057100     05  PV-CMER-EVNT-MKDN-PRC-DTE    PIC  X(19).                 05710000
057200     05  PV-CMER-ACTV-IND             PIC  X(01).                 05720000
057300     05  PV-CMER-CRE-TMST             PIC  X(19).                 05730000
057400     05  PV-CMER-CRE-BY-USR-ID        PIC  X(08).                 05740000
057500     05  PV-CMER-LAST-UPD-TMST        PIC  X(19).                 05750000
057600     05  PV-CMER-LAST-UPD-BY-USR-ID   PIC  X(08).                 05760000
057700                                                                  05770000
056100 01  PV-PET-MKDN-EVNT-DBREC.                                      05771007
056200     05  PV-PET-CLR-EVNT-ID          PIC S9(10) COMP-3.           05772007
056300     05  PV-PET-CLR-MKDN-CDE         PIC  X(01).                  05773007
056500     05  PV-PET-CLR-FRST-EFF-DTE     PIC  X(19).                  05775007
056600     05  PV-PET-CLR-LAST-EFF-DTE     PIC  X(19).                  05776007
                                                                        05777007
057800 01  PV-EVNT-NAME-EXPANDED.                                       05780000
057900     05  PV-EVNT-ID-EXP-EVENT         PIC  X(05).                 05790000
058000     05  FILLER                       PIC  X(01) VALUE SPACES.    05800000
058100     05  PV-EVNT-ID-EXP-ID            PIC  X(03) JUST RIGHT.      05810000
058200     05  PV-EVNT-ID-EXP-ALPHA         PIC  X(01) VALUE SPACES.    05820000
058300     05  FILLER                       PIC  X(10) VALUE SPACES.    05830000
058400                                                                  05840000
058500*----------------------------------------------------------------*05850000
058600* PV- PROGRAM COUNTER VARIABLES                                   05860007
058700*----------------------------------------------------------------*05870000
058800 01  PV-PROGRAM-COUNTERS.                                         05880000
058900     05  PV-RECS-READ                 PIC  9(09) VALUE 0.         05890000
059000     05  PV-EVNT-RECS-READ            PIC  9(09) VALUE 0.         05900000
059100     05  PV-CLR-EVNT-INS              PIC  9(09) VALUE 0.         05910000
059200     05  PV-CLR-EVNT-UPD              PIC  9(09) VALUE 0.         05920000
059300     05  PV-CLR-EVNT-DEL              PIC  9(09) VALUE 0.         05930000
059400     05  PV-EVNT-RECS-OUT             PIC  9(09) VALUE 0.         05940000
059400     05  PV-EVNT-INS-RECS-OUT         PIC  9(09) VALUE 0.         05941049
059500     05  PV-ERR-RECS-OUT              PIC  9(09) VALUE 0.         05950000
059600     05  PV-ERR-EMAIL-RECS-OUT        PIC  9(09) VALUE 0.         05960000
059700     05  PV-UC-B-LENGTH               PIC  9(09) VALUE 0.         05970000
059800                                                                  05980000
059900*----------------------------------------------------------------*05990000
060000*     TRANSLATE TABLES - FOR LOWER CASE TO UPPER CASE CONVERSION *06000000
060100*----------------------------------------------------------------*06010000
060200 01  TT-TRANS-TABLES.                                             06020000
060300     05  TT-TRANS-TABLE-LOW-GROUP.                                06030000
060400         10  TT-TRANS-TABLE-LOW OCCURS 26 TIMES                   06040000
060500                      INDEXED BY TABLE-LOW-INDEX.                 06050000
060600            15  TT-TRANS-TABLE-LOW-BITE    PIC X.                 06060000
060700     05  TT-LOWER-CASE-CHARS               PIC X(26)              06070000
060800         VALUE 'abcdefghijklmnopqrstuvwxyz'.                      06080000
060900     05  TT-TRANS-TABLE-HIGH-GROUP.                               06090000
061000         10  TT-TRANS-TABLE-HIGH OCCURS 26 TIMES                  06100000
061100                      INDEXED BY TABLE-HIGH-INDEX.                06110000
061200            15  TT-TRANS-TABLE-HIGH-BITE   PIC X.                 06120000
061300     05  TT-UPPER-CASE-CHARS               PIC X(26)              06130000
061400         VALUE 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.                      06140000
061500                                                                  06150000
061600 01  UC-AREA-ARRAY.                                               06160000
061700     05  UC-AREA-ELEMENT.                                         06170000
061800         10  PV-UC-BITE               OCCURS 5 TIMES              06180000
061900                                      INDEXED BY PV-UC-INDEX      06190000
062000                                      PIC  X(01).                 06200000
062100     05  UC-WHOLE-AREA                REDEFINES                   06210000
062200         UC-AREA-ELEMENT              PIC  X(05).                 06220000
062300                                                                  06230000
062400*--------------------------------------------------------------*  06240000
062500* DATE ROUTINE COPY MEMBERS                                       06250000
062600*--------------------------------------------------------------*  06260000
062700     COPY DPWS500.                                                06270000
062800                                                                  06280000
062900*----------------------------------------------------------------*06290000
063000* ORACLE DELARE SECTION START                                    *06300000
063100*----------------------------------------------------------------*06310000
063200     EXEC SQL                                                     06320000
063300        BEGIN DECLARE SECTION                                     06330000
063400     END-EXEC.                                                    06340000
063500                                                                  06350000
063600*----------------------------------------------------------------*06360000
063700* PD- ORA VARIABLES (NON DCLGEN)                                 *06370000
063800*----------------------------------------------------------------*06380000
063900 01  USERNAME                         PIC  X(10)  VARYING.        06390000
064000 01  PASSWD                           PIC  X(10)  VARYING.        06400000
064100 01  PV-ORACLE-ID                     PIC  X(01)  VALUE '/'.      06410000
064200                                                                  06420000
064300*----------------------------------------------------------------*06430000
064400* PET00001 PET_CLR_MKDN_EVNT COPYBOOK                            *06440000
064600*----------------------------------------------------------------*06460000
064700     EXEC SQL                                                     06470000
064800        INCLUDE PET00001                                          06480000
064900     END-EXEC.                                                    06490000
065000                                                                  06500000
065900*----------------------------------------------------------------*06590000
066000* PET00003 PET_CLR_EVNT COPYBOOK                                 *06600000
066200*----------------------------------------------------------------*06620000
066300     EXEC SQL                                                     06630000
066400         INCLUDE PET00003                                         06640000
066500     END-EXEC.                                                    06650000
066600                                                                  06660000
066700*----------------------------------------------------------------*06670000
066800* NO ORACLE DCLGEN - ORACLE VIEW K_DBLINKS.v_TDTATTR OF DB2 TABLE*06680064
066900* SO, COPY COBOL DECLARATION FOR TABLE TDTATTR                   *06690000
067000*----------------------------------------------------------------*06700000
067100 01  DCLTDTATTR.                                                  06710000
067200     10 DTATTR-KY-DTE                 PIC  X(10).                 06720000
067300     10 DTATTR-FSCL-YR-NBR            PIC  X(04).                 06730000
067400     10 DTATTR-FSCL-MN-NBR            PIC  X(02).                 06740000
067500     10 DTATTR-FSCL-MN-NM             PIC  X(09).                 06750000
067600     10 DTATTR-FSCL-WK-NBR            PIC  X(02).                 06760000
067700     10 DTATTR-WK-IN-MN-NBR           PIC  X(01).                 06770000
067800     10 DTATTR-DAY-NM                 PIC  X(09).                 06780000
067900     10 DTATTR-DAY-OF-WK-NBR          PIC  X(01).                 06790000
068000     10 DTATTR-FSCL-QTR-NBR           PIC  X(01).                 06800000
068100     10 DTATTR-CAL-MN-NBR             PIC  X(02).                 06810000
068200     10 DTATTR-JLN-DTE                PIC S9(09) COMP.            06820000
068300     10 DTATTR-LY-THIS-DAY-KY-DTE     PIC  X(10).                 06830000
068400     10 DTATTR-FSCL-YR-BEG-DTE        PIC  X(10).                 06840000
068500     10 DTATTR-FSCL-YR-END-DTE        PIC  X(10).                 06850000
068600     10 DTATTR-FSCL-MN-BEG-DTE        PIC  X(10).                 06860000
068700     10 DTATTR-FSCL-MN-END-DTE        PIC  X(10).                 06870000
068800     10 DTATTR-FSCL-WK-BEG-DTE        PIC  X(10).                 06880000
068900     10 DTATTR-FSCL-WK-END-DTE        PIC  X(10).                 06890000
069000     10 DTATTR-SEA-DESC               PIC  X(06).                 06900000
069100     10 DTATTR-SEA-BEG-DTE            PIC  X(10).                 06910000
069200     10 DTATTR-SEA-END-DTE            PIC  X(10).                 06920000
069300     10 DTATTR-PREV-SEA-END-DTE       PIC  X(10).                 06930000
069400     10 DTATTR-PFM-END-DTE            PIC  X(10).                 06940000
069500     10 DTATTR-NFM-END-DTE            PIC  X(10).                 06950000
069600     10 DTATTR-PFW-END-DTE            PIC  X(10).                 06960000
069700                                                                  06970000
069800*----------------------------------------------------------------*06980000
069900* ORACLE END OF DECLARATIVE SECTION                              *06990000
070000*----------------------------------------------------------------*07000000
070100     EXEC SQL                                                     07010000
070200       END DECLARE SECTION                                        07020000
070300     END-EXEC.                                                    07030000
070400                                                                  07040000
070500     EXEC SQL                                                     07050000
070600       INCLUDE SQLCACOB                                           07060000
070700     END-EXEC.                                                    07070000
070800*----------------------------------------------------------------*07080000
070900* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004        *07090000
071000*----------------------------------------------------------------*07100000
071100     COPY DPWS004.                                                07110000
071200                                                                  07120000
071300*----------------------------------------------------------------*07130000
071400* ORA ABEND COPYBOOK                                             *07140000
071500*----------------------------------------------------------------*07150000
071600     COPY DPWS900.                                                07160000
071700                                                                  07170000
071800******************************************************************07180000
071900 PROCEDURE DIVISION.                                              07190000
072000******************************************************************07200000
072100 0000-MAINLINE.                                                   07210000
072200*****TEST ONLY                                                    07220000
072300*    SET PS-READY-TRACE            TO TRUE.                       07230071
072400*****TEST ONLY                                                    07240000
           SET PS-CURRENT-EVENT-NO-CHANGE TO TRUE.                      07242041
072500                                                                  07250000
072600     PERFORM 1000-INITIALIZATION.                                 07260000
072700                                                                  07270000
072800     PERFORM 2000-PROCESS                                         07280000
072900       UNTIL PS-END-OF-FILE.                                      07290000
073000                                                                  07300000
073100     PERFORM 1200-CHECK-ACTIVITY.                                 07310000
073200                                                                  07320000
073300     PERFORM 9000-WRAPUP.                                         07330000
073400                                                                  07340000
073500     EXEC SQL                                                     07350000
073600        COMMIT                                                    07360000
073700     END-EXEC.                                                    07370000
073800                                                                  07380000
073900     GOBACK.                                                      07390000
074000                                                                  07400000
074100*0000-EXIT.                                                       07410000
074200******************************************************************07420000
074300*     INTIALIZES VARIABLES, OPENS ANY FILES, AND PERFORMS        *07430000
074400*     ANY SET-UP ROUTINES.                                       *07440000
074500******************************************************************07450000
074600 1000-INITIALIZATION.                                             07460000
074700     MOVE '1000-INITIALIZATION             ' TO PV-PARAGRAPH-NAME.07470000
074800                                                                  07480000
074900     PERFORM 9990-GET-CURRENT.                                    07490000
075000                                                                  07500000
075100     DISPLAY '****************************************'.          07510000
075200     DISPLAY '**          PEKUT905 STARTED          **'.          07520065
075300     DISPLAY '****************************************'.          07530000
075400     DISPLAY '** CURRENT DATE ' DF-DISPLAY-DATE                   07540000
075500             '            **'.                                    07550000
075600     DISPLAY '** CURRENT TIME ' DF-DISPLAY-TIME                   07560000
075700             '              **'.                                  07570000
075800     DISPLAY '****************************************'.          07580000
075900                                                                  07590000
076000                                                                  07600000
076100     MOVE DF-DISPLAY-DATE TO PV-DATE-TODAY.                       07610000
076200*    DISPLAY 'CURRENT DATE > ' PV-DATE-TODAY.                     07620000
076300                                                                  07630000
076400     OPEN INPUT  EVENT-FILE                                       07640000
076500                 DTE-CNTL-VALIDATE-FILE-IN                        07650000
076600          OUTPUT VALIDATED-EVENT-FILE                             07660000
076700                 EVENT-ERROR-FILE                                 07670000
076800                 DTE-CNTL-VALIDATE-FILE-OUT                       07680000
076900                 EVENT-CAL-CSV-ERROR-EMAIL-FILE                   07690049
077000                 VALIDATED-EVENT-FILE-INSERTS.                    07700049
077100     MOVE TT-UPPER-CASE-CHARS TO TT-TRANS-TABLE-HIGH-GROUP        07710000
077200     MOVE TT-LOWER-CASE-CHARS TO TT-TRANS-TABLE-LOW-GROUP.        07720000
077300                                                                  07730061
0618ML     OPEN INPUT ORACLE-LOGON-FILE.                                07731056
0618ML                                                                  07732058
0618ML     PERFORM 1050-READ-ORACLE-LOGON.                              07740058
0618ML                                                                  07750056
0618ML     CLOSE ORACLE-LOGON-FILE.                                     07751056
0618ML                                                                  07752063
0618ML     IF ((PS-END-OF-LOGON-FILE)                                   07753058
0618ML             OR (CC-ORACLE-CONNECTION = SPACES))                  07754058
0618ML         DISPLAY '** ABEND **'                                    07755058
0618ML         DISPLAY PC-PROGRAM-NAME ' - ORACLE LOGON CONTROL CARD '  07756058
0618ML                   'NOT PROVIDED'                                 07757058
0618ML         SET AC-4003-CONTROL-CARD-ERROR TO TRUE                   07758058
0618ML         CALL 'ILBOABN0' USING AC-ABEND-CODE                      07759059
0618ML     END-IF.                                                      07759158
0618ML                                                                  07759258
0618ML     PERFORM 1100-CONNECT-TO-ORACLE.                              07759358
0618ML                                                                  07759461
077600     PERFORM 7500-GET-CURRENT-DTE-ATTR.                           07760000
077800***** GET CURRENT MAXIMUM VALUE OF CLR_EVNT_ID FROM PET_CLR_EVNT  07780000
077900     PERFORM 7400-GET-INIT-MAX-CLR-EVNT-ID.                       07790000
078000     COMPUTE PV-NEXT-CLR-EVNT-ID = PV-INIT-MAX-CLR-EVNT-ID + 1.   07800000
078100     MOVE PV-INIT-MAX-CLR-EVNT-ID  TO PV-DISP-MAX-CLR-EVNT-ID.    07810000
078200     MOVE PV-NEXT-CLR-EVNT-ID      TO PV-DISP-NEXT-CLR-EVNT-ID.   07820000
078300                                                                  07830000
078400     DISPLAY '** CURRENT MAX CLR-EVNT-ID ' PV-DISP-MAX-CLR-EVNT-ID07840000
078500             '       **'.                                         07850000
078600     DISPLAY '** NEXT CLR-EVNT-ID ' PV-DISP-NEXT-CLR-EVNT-ID      07860000
078700             '              **'.                                  07870000
078800     DISPLAY '****************************************'.          07880000
078900                                                                  07890000
079000***** READ DATE CONTROL CARD - WHICH IS UPDATED LATER UPON SUCCESS07900000
079100     PERFORM 8100-READ-DTE-CNTL-FILE.                             07910000
079200                                                                  07920000
079300     IF  PA025-LST-SUCCESS-CSV-TMST = SPACES                      07930000
079400         DISPLAY 'EMPTY CONTROL CARD'                             07940000
079500         MOVE '1000-INITIALIZATION' TO PV-PARAGRAPH-NAME          07950000
079600         MOVE 'CONTROL CARD IS EMPTY' TO PV-OPERATION-MSG-1       07960000
079700         SET  AC-4003-CONTROL-CARD-ERROR TO TRUE                  07970000
079800         PERFORM 9800-ABEND                                       07980000
079900     END-IF.                                                      07990000
080000                                                                  08000000
080100     MOVE PA025-DTE-CONTROL-CARD-RCD                              08010000
080200                                TO PV-CC-LSC-CONTROL-CARD-RCD.    08020000
080300                                                                  08030000
080400     SET PS-CSV-ERROR-NOT-FOUND    TO TRUE.                       08040000
080500                                                                  08050000
080600*1000-EXIT.                                                       08060000
080700******************************************************************08060158
080800*     READ IN THE ORACLE DATABASE CONTROL CARD.                  *08060258
080900******************************************************************08060358
0618ML 1050-READ-ORACLE-LOGON.                                          08061058
0618ML     READ ORACLE-LOGON-FILE                                       08062059
0618ML         INTO CC-ORACLE-CONNECTION                                08063059
0618ML         AT END                                                   08064059
0618ML             SET PS-END-OF-LOGON-FILE TO TRUE                     08065059
0618ML     END-READ.                                                    08066059
0618ML*1050-EXIT.                                                       08067058
080700******************************************************************08070000
080800*     SET UP TO CONNECT TO THE ORACLE DATABASE.                  *08080000
080900******************************************************************08090000
081000 1100-CONNECT-TO-ORACLE.                                          08100000
081100     MOVE '1100-CONNECT-TO-ORACLE          ' TO PV-PARAGRAPH-NAME.08110000
081200     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          08120000
081300*                                                                 08130000
083800****************************************************************  08140056
083900* IF USERNAME IS DASH, THE LOGON ID IS MISSING FROM SYSIN.        08150056
084000* THEREFORE IT IS A PRODUCTION RUN WHERE THE LOGON INFO COMES     08160056
084100* FROM THE JCL                                                    08170056
084200****************************************************************  08180056
0618ML     IF CC-AUTO-LOGON                                             08370056
0618ML         DISPLAY PC-PROGRAM-NAME  ' - AUTO LOGON TO ORACLE'       08371056
0618ML         EXEC SQL                                                 08372056
0618ML             CONNECT :PC-AUTO-LOGON                               08373056
0618ML         END-EXEC                                                 08374056
0618ML     ELSE                                                         08375056
0618ML         INITIALIZE PV-ORACLE-USERID-LEN                          08375156
0618ML                    PV-ORACLE-PASSWORD-LEN                        08375256
0618ML         INSPECT CC-ORACLE-USERID                                 08375356
0618ML             TALLYING PV-ORACLE-USERID-LEN                        08375456
0618ML             FOR CHARACTERS BEFORE INITIAL SPACE                  08375556
0618ML         INSPECT CC-ORACLE-PASSWORD                               08375656
0618ML             TALLYING PV-ORACLE-PASSWORD-LEN                      08375756
0618ML             FOR CHARACTERS BEFORE INITIAL SPACE                  08375856
0618ML         MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO        08375956
0618ML                 USERNAME-ARR                                     08376056
0618ML         MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                08376156
0618ML         MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO    08376256
0618ML                 PASSWD-ARR                                       08376356
0618ML         MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                08376456
0618ML         DISPLAY PC-PROGRAM-NAME  ' - LOGON TO ORACLE AS USER '   08376556
0618ML                 USERNAME-ARR                                     08376656
0618ML         EXEC SQL                                                 08376756
0618ML             CONNECT :USERNAME IDENTIFIED BY :PASSWD              08376856
0618ML         END-EXEC                                                 08376956
0618ML         INITIALIZE CC-ORACLE-PASSWORD                            08377056
0618ML                    PASSWD                                        08377156
0618ML     END-IF.                                                      08378056
0618ML                                                                  08378156
0618ML     IF (SQLCODE NOT = 0)                                         08379056
0618ML        DISPLAY '***  ABEND  ***'                                 08379156
0618ML        DISPLAY '1100-CONNECT-TO-ORACLE'                          08379256
0618ML        DISPLAY '** CONNECT TO ORACLE FAILED UNDER: ' USERNAME-ARR08379356
0618ML        MOVE 'CONNECT TO ORACLE DATABASE'                         08379456
0618ML                         TO PV-ORA-OPERATION                      08379556
0618ML        PERFORM 9700-ORA-ERROR                                    08379656
0618ML     END-IF.                                                      08379756
084400                                                                  08440000
084500*1100-EXIT.                                                       08450000
084600******************************************************************08460000
084700*     CHECK WHETHER ANY EVENTS - OR RECORDS - WERE RECEIVED,     *08470000
084800*     AND WHETHER ANY ORACLE TABLE ROWS HAVE BEEN INSERTED OR    *08480000
084900*     UPDATED, AND WRITE AN ERROR RECORD IF NONE.                *08490000
085000******************************************************************08500000
085100 1200-CHECK-ACTIVITY.                                             08510000
085200     MOVE '1200-CHECK-ACTIVITY            ' TO PV-PARAGRAPH-NAME. 08520000
085300                                                                  08530000
085400*    RECORDS                                                      08540000
085500     IF  PV-RECS-READ      = 0                                    08550000
085600         SET  PV-ERR-TYP-NO-RECORDS     TO TRUE                   08560000
085700         SET  PS-CSV-ERROR-FOUND        TO TRUE                   08570000
085800         MOVE PC-NO-RECORDS-IN-FILE     TO PV-ERROR-MESSAGE       08580000
085900         DISPLAY '*****  ERROR MESSAGE  ************************' 08590000
086000         DISPLAY  PV-ERROR-RECORD(1:122)                          08600000
086100         DISPLAY '**********************************************' 08610000
086200         PERFORM 8400-WRITE-ERR-RECORD                            08620000
086300         MOVE    PV-ERROR-RECORD(1:80) TO EM-ERROR-EMAIL-RECORD   08630000
086400         PERFORM 8600-WRITE-ERROR-EMAIL-RECORD                    08640000
086500     END-IF.                                                      08650000
086600                                                                  08660000
086700*    EVENTS                                                       08670000
086800     IF  PV-EVNT-RECS-READ = 0                                    08680000
086900         SET  PV-ERR-TYP-NO-EVNTS       TO TRUE                   08690000
087000         SET  PS-CSV-ERROR-FOUND        TO TRUE                   08700000
087100         MOVE PC-NO-EVENTS-IN-FILE      TO PV-ERROR-MESSAGE       08710000
087200         DISPLAY '*****  ERROR MESSAGE  ************************' 08720000
087300         DISPLAY  PV-ERROR-RECORD(1:122)                          08730000
087400         DISPLAY '**********************************************' 08740000
087500         PERFORM 8400-WRITE-ERR-RECORD                            08750000
087600         MOVE    PV-ERROR-RECORD(1:80) TO EM-ERROR-EMAIL-RECORD   08760000
087700         PERFORM 8600-WRITE-ERROR-EMAIL-RECORD                    08770000
087800     END-IF.                                                      08780000
087900                                                                  08790000
088000     IF  PS-CSV-ERROR-NOT-FOUND                                   08800000
088100         PERFORM 1300-SUCCESS-WRITE-DATE-CARD                     08810000
               IF PS-CURRENT-EVENT-CHANGE                               08811042
087600           MOVE  ' '  TO EM-ERROR-EMAIL-RECORD                    08812042
087700           PERFORM 8650-WRITE-CRITICAL-EMAIL                      08813045
087600           MOVE  PC-MSG-FOR-CUR-DTE-CHG1 TO EM-ERROR-EMAIL-RECORD 08814042
087700           PERFORM 8650-WRITE-CRITICAL-EMAIL                      08815045
087600           MOVE  PC-MSG-FOR-CUR-DTE-CHG2 TO EM-ERROR-EMAIL-RECORD 08816042
087700           PERFORM 8650-WRITE-CRITICAL-EMAIL                      08817045
087600           MOVE  PC-MSG-FOR-CUR-DTE-CHG3 TO EM-ERROR-EMAIL-RECORD 08818042
087700           PERFORM 8650-WRITE-CRITICAL-EMAIL                      08819045
               END-IF                                                   08819142
088200     ELSE                                                         08820000
088300         PERFORM 1400-FAILURE-WRITE-DATE-CARD                     08830000
087600         MOVE  ' '  TO EM-ERROR-EMAIL-RECORD                      08831045
087700         PERFORM 8600-WRITE-ERROR-EMAIL-RECORD                    08832045
087600         MOVE  PC-MSG-FOR-MKT-SOLUTION1 TO EM-ERROR-EMAIL-RECORD  08833026
087700         PERFORM 8600-WRITE-ERROR-EMAIL-RECORD                    08834045
088400     END-IF.                                                      08840000
088500                                                                  08850000
088600*1200-EXIT.  EXIT.                                                08860000
088700******************************************************************08870000
088800*     WRITE OUT DATE CARD UPON SUCCESS.                          *08880000
088900******************************************************************08890000
089000 1300-SUCCESS-WRITE-DATE-CARD.                                    08900000
089100     MOVE '1300-SUCCESS-WRITE-DATE-CARD    ' TO PV-PARAGRAPH-NAME.08910000
089200                                                                  08920000
089300     MOVE  DF-DISPLAY-DATE TO PA025-LST-SUCCESS-CSV-DTE.          08930000
089400     MOVE  '-'             TO PA025-LST-SUCCESS-FILLER.           08940000
089500     MOVE  DF-DISPLAY-TIME TO PA025-LST-SUCCESS-CSV-TIME.         08950000
089600     MOVE  'Y'             TO PA025-LST-SUCCESS-CSV-IND.          08960000
089700                                                                  08970000
089800     PERFORM 8200-WRITE-DATE-CNTL-RECORD.                         08980000
089900                                                                  08990000
090000*1300-EXIT.  EXIT.                                                09000000
090100******************************************************************09010000
090200*     WRITE OUT DATE CARD UPON FAILURE.                          *09020000
090300******************************************************************09030000
090400 1400-FAILURE-WRITE-DATE-CARD.                                    09040000
090500     MOVE '1400-FAILURE-WRITE-DATE-CARD    ' TO PV-PARAGRAPH-NAME.09050000
090600                                                                  09060000
090700     MOVE PV-CC-LST-SUCCESS-CSV-DTE  TO PA025-LST-SUCCESS-CSV-DTE.09070000
090800     MOVE '-'                        TO PA025-LST-SUCCESS-FILLER. 09080000
090900     MOVE PV-CC-LST-SUCCESS-CSV-TIME                              09090000
091000                                  TO PA025-LST-SUCCESS-CSV-TIME.  09100000
091100     MOVE  'N'                       TO PA025-LST-SUCCESS-CSV-IND.09110000
091200                                                                  09120000
091300     PERFORM 8200-WRITE-DATE-CNTL-RECORD.                         09130000
091400                                                                  09140000
091500*1400-EXIT.  EXIT.                                                09150000
091600******************************************************************09160000
091700*     MAIN DRIVING PARAGRAPH OF PROGRAM.                         *09170000
091800******************************************************************09180000
091900 2000-PROCESS.                                                    09190000
092000     MOVE '2000-PROCESS                    ' TO PV-PARAGRAPH-NAME.09200000
092100                                                                  09210000
092200     READ EVENT-FILE                                              09220000
092300       AT END                                                     09230000
092400          SET PS-END-OF-FILE       TO TRUE                        09240000
092500                                                                  09250000
092600       NOT AT END                                                 09260000
092700          ADD 1                    TO PV-RECS-READ                09270000
092800          PERFORM 2100-UNSTRING-EVENT                             09280000
092900     END-READ.                                                    09290000
093000                                                                  09300000
093100*2000-EXIT.  EXIT.                                                09310000
093200******************************************************************09320000
093300*     UNSTRING INPUT CSV RECORD TO INDIVIDUAL FIELDS.            *09330000
093400******************************************************************09340000
093500 2100-UNSTRING-EVENT.                                             09350000
093600     MOVE '2100-UNSTRING-EVENT             ' TO PV-PARAGRAPH-NAME.09360000
093700     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          09370000
093800                                                                  09380000
093900     MOVE SPACES                   TO PV-UNSTRING-COLUMNS.        09390000
094000                                                                  09400000
094100     UNSTRING EVENT-RECORD DELIMITED BY ','                       09410000
094200         INTO PV-UC-A                                             09420000
094300              PV-UC-B                                             09430000
094400              PV-UC-C                                             09440000
094500              PV-UC-D                                             09450000
094600              PV-UC-E                                             09460000
094700              PV-UC-F                                             09470000
094800              PV-UC-G                                             09480000
094900              PV-UC-H                                             09490000
095000              PV-UC-I                                             09500000
095100              PV-UC-J                                             09510000
095200              PV-UC-K                                             09520002
095200              PV-UC-L                                             09521002
095200              PV-UC-M.                                            09522002
095300                                                                  09530000
095400     EVALUATE TRUE                                                09540000
095500        WHEN PV-UC-A(1:4)              NUMERIC                    09550000
095600           MOVE PV-UC-A(1:4)           TO PV-EVNT-CAL-YEAR        09560000
095700                                          PV-DCA-YEAR-H           09570000
095800        WHEN PV-UC-L(1:1)              NUMERIC                    09580002
095900           PERFORM 2200-EVENT-PROCESSOR                           09590000
096000        WHEN OTHER                                                09600000
096100           CONTINUE                                               09610000
096200     END-EVALUATE.                                                09620000
096300                                                                  09630000
096400*2100-EXIT.  EXIT.                                                09640000
096500******************************************************************09650000
096600*     TABLE INSERT DRIVER ROUTINE                                *09660000
096700******************************************************************09670000
096800 2200-EVENT-PROCESSOR.                                            09680000
096900     MOVE '2200-EVENT-PROCESSOR        ' TO PV-PARAGRAPH-NAME.    09690000
097000                                                                  09700000
097100     SET PS-CSV-RCD-ERROR-NOT-FOUND TO TRUE.                      09710000
097200     ADD 1 TO PV-EVNT-RECS-READ.                                  09720000
097300                                                                  09730000
097400     MOVE ZEROS TO PV-MKDN1-COUNT,                                09740000
097500                   PV-MKDN2-COUNT,                                09750000
097600                   PV-MKDN3-COUNT,                                09760002
097600                   PV-MKDN4-COUNT,                                09761002
097600                   PV-MKDN5-COUNT,                                09762002
097600                   PV-MKDN6-COUNT,                                09763002
097700                   PV-MKDNO-COUNT.                                09770000
097800                                                                  09780000
097900***** ALL VARIABLES BUT FIRST & LAST EFFECTIVE DATES              09790000
098000                                                                  09800000
098100***** GUI_LOD_ID (Column L in new csv layout):                    09810002
098200     MOVE ZEROS TO PA905-GUI-LOD-ID.                              09820000
098300                                                                  09830000
098400     MOVE PV-UC-L                  TO PV-VA1-ELEMENT.             09840002
098500     PERFORM 6000-CONVERT-TO-NUMBER.                              09850000
098600     IF  PV-VA2-NUMBER > ZERO                                     09860000
098700         MOVE PV-VA2-NUMBER       TO GUI-LOD-ID      IN PET00003  09870000
098800                                     PV-GUI-LOD-ID                09880000
098900                                     PV-CER-GUI-LOD-ID            09890000
099000                                     PA905-GUI-LOD-ID             09900000
099100     ELSE                                                         09910000
099200         MOVE PV-UC-L                   TO PV-DATA-ITEM           09920002
099300         SET  PV-ERR-TYP-BAD-GUI-LOD-ID TO TRUE                   09930000
099400         SET  PS-CSV-ERROR-FOUND        TO TRUE                   09940000
099500         SET  PS-CSV-RCD-ERROR-FOUND    TO TRUE                   09950000
099600         PERFORM 8300-BUILD-ERR-RECORD                            09960000
099700     END-IF.                                                      09970000
099800                                                                  09980000
099900     MOVE ZEROS TO PA905-LY-CLR-EVNT-ID                           09990000
100000                   PA905-LY-GUI-LOD-ID.                           10000000
100100                                                                  10010000
100200***** LAST YEAR EVENT GUI_LOD_ID (Column K in new csv layout)     10020002
100300     IF  PV-UC-K(1:1) NUMERIC                                     10030002
100400        MOVE PV-UC-K                    TO PV-VA1-ELEMENT         10040002
100500        PERFORM 6000-CONVERT-TO-NUMBER                            10050000
100600        IF PV-VA2-NUMBER > ZERO                                   10060000
100700           MOVE PV-VA2-NUMBER           TO PV-LY-EVNT-GUI-LOD-ID  10070000
100800           MOVE PV-LY-EVNT-GUI-LOD-ID   TO PA905-LY-GUI-LOD-ID    10080000
100900           PERFORM 7200-GET-LY-CLR-EVNT-ID                        10090000
101000           IF PS-LY-EVNT-ID-FOUND                                 10100000
101100              MOVE PV-CER-LY-CLR-EVNT-ID TO PA905-LY-CLR-EVNT-ID  10110000
101200           ELSE                                                   10120000
101300              MOVE -1 TO PV-IN-LY-CE-ID-NULL-IND                  10130000
101400           END-IF                                                 10140000
101500        ELSE                                                      10150000
101600           SET PS-NO-LY-EVNT-ID    TO TRUE                        10160000
101700        END-IF                                                    10170000
101800     ELSE                                                         10180000
101900         SET  PS-NO-LY-EVNT-ID     TO TRUE                        10190000
102000     END-IF.                                                      10200000
102100                                                                  10210000
102200*    ASSEMBLE EVENT NAME FOR INSERT / UPDATE TO TABLE             10220000
102300*    - IN THE FORM "EVENT ###"                                    10230000
102400*    - 4300-EXPAND-EVNT-NM inserts spaces for Event 1 -> Event   110240000
102500*      resulting in 'Event 1'   becoming 'Event   1'              10250000
102600*       and         'Event 23a' becoming 'Event  23a'             10260000
102700*      - this facilitates Event selection by the Actuals process  10270000
102800     IF PV-UC-A > SPACES                                          10280000
102900       AND PV-UC-B > SPACES                                       10290000
103000         STRING PV-UC-A(1:5)  DELIMITED BY SIZE                   10300000
103100                  ' '         DELIMITED BY SIZE                   10310000
103200                  PV-UC-B     DELIMITED BY SIZE                   10320000
103300           INTO PV-CER-CLR-EVNT-NM                                10330000
103400           PERFORM 4300-EXPAND-EVNT-NM                            10340000
103500     ELSE                                                         10350000
103600         STRING PV-UC-A(1:5)  DELIMITED BY SIZE                   10360000
103700                  ' '         DELIMITED BY SIZE                   10370000
103800                  PV-UC-B     DELIMITED BY SIZE                   10380000
103900           INTO PV-DATA-ITEM                                      10390000
104000         SET  PV-ERR-TYP-BAD-EVNT-CSV-NAME TO TRUE                10400000
104100         SET  PS-CSV-ERROR-FOUND           TO TRUE                10410000
104200         SET  PS-CSV-RCD-ERROR-FOUND       TO TRUE                10420000
104300         PERFORM 8300-BUILD-ERR-RECORD                            10430000
104400     END-IF.                                                      10440000
104500*    DISPLAY 'EVENT NAME BY STRING: ' PV-CER-CLR-EVNT-NM.         10450000
104600                                                                  10460000
104700*    CHECK ACTIVE / INACTIVE INDICATOR (Col. M in new csv layout) 10470002
104800*    'A' = ACTIVE / 'I' = INACTIVE (TO BE DELETED FROM TABLES)    10480000
104900*    The new layout (07 Jan 08) has it in col M in the csv.       10490002
105000     IF  PV-UC-M > SPACES                                         10500002
105100         IF   PV-UC-M = 'I'                                       10510002
105200           OR PV-UC-M = 'Inactive'                                10520002
105300           OR PV-UC-M(1:1) = 'I'                                  10530002
105400             SET PA905-CLR-EVNT-INACTIVE   TO TRUE                10540000
105500         ELSE                                                     10550000
105600             SET PA905-CLR-EVNT-ACTIVE     TO TRUE                10560000
105700         END-IF                                                   10570000
105800     ELSE                                                         10580000
105900         SET PA905-CLR-EVNT-ACTIVE         TO TRUE                10590000
106000     END-IF.                                                      10600000
106100                                                                  10610000
1020ML*    Force override to true for now since the excel spreadsheet   10610173
1020ML*    the business uses for this is hard coded to approved         10610273
1020ML     SET PS-CURRENT-EVENT-OVERRIDE TO TRUE.                       10610373
1020ML*    Check if the event should allow more than 3 seasons          10610467
1020ML*    IF  PV-UC-M > SPACES                                         10611073
1020ML*        IF   PV-UC-M = 'O'                                       10612073
1020ML*          OR PV-UC-M = 'Override'                                10613073
1020ML*          OR PV-UC-M(1:1) = 'O'                                  10614073
1020ML*            SET PS-CURRENT-EVENT-OVERRIDE TO TRUE                10615073
1020ML*        ELSE                                                     10616073
1020ML*            SET PS-CURRENT-EVENT-NO-OVERRIDE TO TRUE             10617073
1020ML*        END-IF                                                   10618073
1020ML*    ELSE                                                         10619073
1020ML*        SET PS-CURRENT-EVENT-NO-OVERRIDE  TO TRUE                10619173
1020ML*    END-IF.                                                      10619273
1020ML                                                                  10619367
106200***** GET CLR_EVNT_ID BACK FOR FURTHER PROCESSING                 10620000
106300*     IF FOUND - IDENTIFY AND SET EVENT FOR UPDATE,               10630000
106400*     IF NOT FOUND - IDENTIFY EVENT AS NEW, AND SET FOR INSERT    10640000
106500     PERFORM 7100-GET-CLR-EVNT-ID.                                10650000
106600     EVALUATE TRUE                                                10660000
106700        WHEN PS-EXISTING-EVNT                                     10670000
106800           SET PA905-CLR-EVNT-ACT-UPDATE   TO TRUE                10680000
106900           MOVE CLR-EVNT-ID IN PET00003    TO PA905-CLR-EVNT-ID   10690000
107000                                              PV-DISP-CLR-EVNT-ID 10700000
107100           PERFORM 3000-VALIDATE-EXISTING-EVNT                    10710000
107200        WHEN PS-NOT-EXISTING-EVNT                                 10720000
107300           IF PA905-CLR-EVNT-ACTIVE                               10730000
107400               SET PA905-CLR-EVNT-ACT-ADD  TO TRUE                10740000
107500               MOVE PV-NEXT-CLR-EVNT-ID      TO PA905-CLR-EVNT-ID 10750000
107600               ADD 1 TO PV-NEXT-CLR-EVNT-ID                       10760000
107700           ELSE                                                   10770000
107800               SET PA905-CLR-EVNT-ACT-DELETE TO TRUE              10780000
107900               MOVE PV-NEXT-CLR-EVNT-ID      TO PA905-CLR-EVNT-ID 10790000
108000               ADD 1 TO PV-NEXT-CLR-EVNT-ID                       10800000
108100           END-IF                                                 10810000
108200     END-EVALUATE.                                                10820000
108300                                                                  10830000
108400****************  PARSE OUT YEAR AND WEEK OF THE EVENT            10840000
108500**** TWO POSSIBLE FORMATS FOR THE COLUMN - 'OLD STYLE' AND 'NEW'  10850000
108600**** IT'S A BAD RECORD IF NEITHER FORMAT (NEED IT TO GET FY)      10860000
108700     IF  PV-UC-C(1:2) NUMERIC                                     10870000
108800*        DISPLAY 'PV-UC-C > ' PV-UC-C                             10880000
108900         IF  PV-UC-C(4:2) NUMERIC                                 10890000
109000*            NEW FORMAT NAME                                      10900000
109100             MOVE PV-UC-C(1:2) TO PV-EVNT-CSV-NM-FY               10910000
109200             MOVE PV-UC-C(4:2) TO PV-EVNT-CSV-NM-WK               10920000
109300             SET  PS-NEW-FRMT-NAME TO TRUE                        10930000
109400         ELSE                                                     10940000
109500*            OLD FORMAT NAME                                      10950000
109600             IF  PV-UC-C(8:2) = 'WK'                              10960000
109700                MOVE PV-UC-C   TO PV-EVNT-CSV-NM-OLD-STYLE        10970000
109800                SET  PS-OLD-FRMT-NAME TO TRUE                     10980000
109900                PERFORM 6200-OLD-STYLE-EVNT-NAME                  10990000
110000             ELSE                                                 11000000
110100                SET  PV-ERR-TYP-BAD-CSV-DATE-NAME TO TRUE         11010000
110200                SET  PS-CSV-ERROR-FOUND           TO TRUE         11020000
110300                SET  PS-CSV-RCD-ERROR-FOUND       TO TRUE         11030000
110400                PERFORM 8300-BUILD-ERR-RECORD                     11040000
110500             END-IF                                               11050000
110600         END-IF                                                   11060000
110700         PERFORM 2300-GET-EVNT-CAL-DTE                            11070000
110800     ELSE                                                         11080000
110900         SET  PV-ERR-TYP-BAD-CSV-DATE-NAME TO TRUE                11090000
111000         SET  PS-CSV-ERROR-FOUND           TO TRUE                11100000
111100         SET  PS-CSV-RCD-ERROR-FOUND       TO TRUE                11110000
111200         PERFORM 8300-BUILD-ERR-RECORD                            11120000
111300     END-IF.                                                      11130000
111400                                                                  11140000
111500     IF  PS-CSV-RCD-ERROR-NOT-FOUND                               11150000
111600         PERFORM 2400-EVENT-DETAIL                                11160000
111700     END-IF.                                                      11170000
111800                                                                  11180000
111900     IF  PS-CSV-RCD-ERROR-NOT-FOUND                               11190000
112000         PERFORM 2500-BUILD-EVENT-OUT-RCD                         11200000
112100     END-IF.                                                      11210000
112200                                                                  11220000
112300                                                                  11230000
112400*2200-EXIT.  EXIT.                                                11240000
112500******************************************************************11250000
112600*   OBTAIN EVENT DATE INFORMATION FROM TDTATTR                   *11260064
112700******************************************************************11270000
112800 2300-GET-EVNT-CAL-DTE.                                           11280000
112900     MOVE '2300-GET-EVNT-CAL-DTE       ' TO PV-PARAGRAPH-NAME.    11290000
113000     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          11300000
113100*                                                                 11310000
113200     IF  PS-NEW-FRMT-NAME                                         11320000
113300         MOVE PV-EVNT-CSV-NM-FSCL-YR  TO  DTATTR-FSCL-YR-NBR      11330000
113400         MOVE PV-EVNT-CSV-NM-WK       TO  DTATTR-FSCL-WK-NBR      11340000
113500*        DISPLAY 'EVNT-CSV-NM-FSCL-YR > ' PV-EVNT-CSV-NM-FSCL-YR  11350000
113600*        DISPLAY 'EVNT-CSV-NM-WK      > ' PV-EVNT-CSV-NM-WK       11360000
113700         PERFORM 3100-GET-EVNT-CAL-DTE                            11370000
113800         IF PS-CSV-RCD-ERROR-NOT-FOUND                            11380000
113900             MOVE DTATTR-CAL-MN-NBR   TO  PV-EVNT-START-CAL-MN    11390000
114000         ELSE                                                     11400000
114100             MOVE ZEROS               TO  PV-EVNT-START-CAL-MN    11410000
114200         END-IF                                                   11420000
114300     ELSE                                                         11430000
114400         MOVE PV-EVNT-CSV-NM-FSCL-YR  TO  DTATTR-FSCL-YR-NBR      11440000
114500         MOVE PV-EVNT-START-CAL-MN    TO  DTATTR-CAL-MN-NBR       11450000
114600         MOVE PV-EVNT-CSV-NM-OS-MO-WK TO  DTATTR-WK-IN-MN-NBR     11460000
114700         PERFORM 3150-GET-EVNT-CAL-DTE                            11470000
114800     END-IF.                                                      11480000
114900                                                                  11490000
115000     IF  PS-CSV-RCD-ERROR-NOT-FOUND                               11500000
115100         MOVE DTATTR-KY-DTE           TO  PV-FRST-DY-OF-FSCL-WK   11510000
115200         MOVE PV-EVNT-CSV-NM-FSCL-YR  TO  PV-DCA-YEAR-1           11520000
115300                                          PV-DCA-YEAR-2           11530000
115400                                          PV-DCA-YEAR-3           11540002
115400                                          PV-DCA-YEAR-4           11541002
115400                                          PV-DCA-YEAR-5           11542002
115400                                          PV-DCA-YEAR-6           11543002
115500                                          PV-DCA-YEAR-O           11550000
115600                                          PA905-FSCL-YR-NBR       11560000
115700*        DISPLAY 'AFTER... '                                      11570000
115800*        DISPLAY 'PV-DCA-YEAR-1 > ' PV-DCA-YEAR-1                 11580000
115900*              ', PV-DCA-YEAR-2 > ' PV-DCA-YEAR-2                 11590000
116000*              ', PV-DCA-YEAR-3 > ' PV-DCA-YEAR-3                 11600002
116000*              ', PV-DCA-YEAR-4 > ' PV-DCA-YEAR-4                 11601002
116000*              ', PV-DCA-YEAR-5 > ' PV-DCA-YEAR-5                 11602002
116000*              ', PV-DCA-YEAR-6 > ' PV-DCA-YEAR-6                 11603002
116100*              ', PV-DCA-YEAR-O > ' PV-DCA-YEAR-O                 11610000
116200         EVALUATE TRUE                                            11620000
116300             WHEN DTATTR-SEA-DESC = 'SPRING'                      11630000
116400                  SET PS-EVNT-SEA-SPRING TO TRUE                  11640000
116500             WHEN DTATTR-SEA-DESC = 'FALL'                        11650000
116600                  SET PS-EVNT-SEA-FALL TO TRUE                    11660000
116700         END-EVALUATE                                             11670000
116800*        DISPLAY 'DTATTR-SEA-DESC > ' DTATTR-SEA-DESC             11680000
116900         MOVE DTATTR-SEA-DESC TO PA905-SEA-DESC                   11690000
117000     END-IF.                                                      11700000
117100                                                                  11710000
117200*2300-EXIT.  EXIT.                                                11720000
117300******************************************************************11730000
117400*  2400-EVENT-DETAIL.                                            *11740000
117500*     TABLE INSERT / UPDATE DRIVER ROUTINE                       *11750000
117600*    The Column layout has been changed, 07 Jan 2008             *11760000
117700*     Col D :  1st Mark Dates (Mark '1')                         *11770003
      *     Col E :  2nd Mark Dates (Mark '2')                         *11780003
      *     Col F :  3rd Mark Dates (Mark '3')                         *11790003
      *     Col G :  4th Mark Dates (Mark '4')                         *11800003
      *     Col H :  5th Mark Dates (Mark '5')                         *11801003
      *     Col I :  6th Mark Dates (Mark '6')                         *11801103
118100*     Col J :  MOS Dates      (Mark 'O')                         *11810003
118200******************************************************************11820000
118300 2400-EVENT-DETAIL.                                               11830000
118400     MOVE '2400-EVENT-DETAIL           ' TO PV-PARAGRAPH-NAME.    11840000
118500     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          11850000
118600                                                                  11860000
118700***** FIRST MARKDOWN (Column D in new csv layout)                 11870000
118800     MOVE '1'                 TO PV-CLR-MKDN-CDE.                 11880000
118900     IF  PV-UC-D              NOT = '---'                         11890000
119000         MOVE PV-UC-D         TO PV-DATE-CELL-ARRAY               11900000
119100         SET PS-NOT-LAST-DATE-PROCESSED TO TRUE                   11910000
119200         SET PV-DCEDEX1       TO 1                                11920000
119300         PERFORM 4000-DATE-DELIMIT                                11930000
119400           UNTIL PS-LAST-DATE-PROCESSED                           11940000
119500         MOVE PV-CMER-CLR-FRST-EFF-DTE  TO PV-MD1-FRST-EFF-DATE   11950000
119600         MOVE PV-CMER-CLR-LAST-EFF-DTE  TO PV-MD1-LAST-EFF-DATE   11960000
119700                                                                  11970000
119800         SET PV-HOLD-INDEX-2 TO PV-DCEDEX2                        11980000
119900                                                                  11990000
120000*    CHECK FOR INVALID DATE ERROR                                 12000000
120100         IF PV-MKDN1-COUNT = 0                                    12010000
120200            PERFORM 2450-DASHES-SLASHES                           12020000
120300         END-IF                                                   12030000
120400                                                                  12040000
120500         SET PV-DCEDEX2 TO PV-HOLD-INDEX-2                        12050000
120600                                                                  12060000
120700     ELSE                                                         12070000
120800         MOVE PV-UC-D                   TO PV-DATA-ITEM           12080000
120900         SET PV-ERR-TYP-NO-M1-FOR-EVNT  TO TRUE                   12090000
121000         SET PS-CSV-ERROR-FOUND         TO TRUE                   12100000
121100         SET PS-CSV-RCD-ERROR-FOUND     TO TRUE                   12110000
121200         PERFORM 8300-BUILD-ERR-RECORD                            12120000
121300     END-IF.                                                      12130000
121400*                                                                 12140000
121500***** SECOND MARKDOWN (Column E in new csv layout)                12150000
121600     MOVE '2'                 TO PV-CLR-MKDN-CDE.                 12160000
121700     IF  PV-UC-E                NOT = '---'                       12170000
121800         MOVE PV-UC-E           TO PV-DATE-CELL-ARRAY             12180000
121900         SET PS-NOT-LAST-DATE-PROCESSED TO TRUE                   12190000
122000         SET PV-DCEDEX1         TO 1                              12200000
122100         PERFORM 4000-DATE-DELIMIT                                12210000
122200           UNTIL PS-LAST-DATE-PROCESSED                           12220000
122300         MOVE PV-CMER-CLR-FRST-EFF-DTE TO PV-MD2-FRST-EFF-DATE    12230000
122400         MOVE PV-CMER-CLR-LAST-EFF-DTE TO PV-MD2-LAST-EFF-DATE    12240000
122500                                                                  12250000
122600         SET PV-HOLD-INDEX-2 TO PV-DCEDEX2                        12260000
122700                                                                  12270000
122800*    CHECK FOR INVALID DATE ERROR                                 12280000
122900         IF PV-MKDN2-COUNT = 0                                    12290000
123000            PERFORM 2450-DASHES-SLASHES                           12300000
123100         END-IF                                                   12310000
123200                                                                  12320000
123300         SET PV-DCEDEX2 TO PV-HOLD-INDEX-2                        12330000
123400                                                                  12340000
123500     ELSE                                                         12350000
123600         MOVE '~'              TO PV-MD2-FRST-EFF-DATE            12360000
123700         MOVE '~'              TO PV-MD2-LAST-EFF-DATE            12370000
123800     END-IF.                                                      12380000
123900                                                                  12390000
124000***** 3rd MARKDOWN (Column F in new csv layout)                   12400004
124100     MOVE '3'                  TO PV-CLR-MKDN-CDE.                12410004
124200     IF  PV-UC-F                NOT = '---'                       12420000
124300         MOVE PV-UC-F           TO PV-DATE-CELL-ARRAY             12430000
124400         SET PS-NOT-LAST-DATE-PROCESSED TO TRUE                   12440000
124500         SET PV-DCEDEX1         TO 1                              12450000
124600         PERFORM 4000-DATE-DELIMIT                                12460000
124700           UNTIL PS-LAST-DATE-PROCESSED                           12470000
124800         MOVE PV-CMER-CLR-FRST-EFF-DTE TO PV-MD3-FRST-EFF-DATE    12480004
124900         MOVE PV-CMER-CLR-LAST-EFF-DTE TO PV-MD3-LAST-EFF-DATE    12490004
125000                                                                  12500000
125100         SET PV-HOLD-INDEX-2 TO PV-DCEDEX2                        12510000
125200                                                                  12520000
125300*    CHECK FOR INVALID DATE ERROR                                 12530000
125400         IF PV-MKDN3-COUNT = 0                                    12540004
125500            PERFORM 2450-DASHES-SLASHES                           12550000
125600         END-IF                                                   12560000
125700                                                                  12560104
123300         SET PV-DCEDEX2 TO PV-HOLD-INDEX-2                        12561004
125700                                                                  12570000
125800     ELSE                                                         12580000
125900         MOVE '~'              TO PV-MD3-FRST-EFF-DATE            12590004
126000         MOVE '~'              TO PV-MD3-LAST-EFF-DATE            12600004
126100     END-IF.                                                      12610000
                                                                        12610104
124000***** 4TH MARKDOWN (Column G in new csv layout)                   12611004
124100     MOVE '4'                  TO PV-CLR-MKDN-CDE.                12612004
124200     IF  PV-UC-G                NOT = '---'                       12613004
124300         MOVE PV-UC-G           TO PV-DATE-CELL-ARRAY             12614004
124400         SET PS-NOT-LAST-DATE-PROCESSED TO TRUE                   12615004
124500         SET PV-DCEDEX1         TO 1                              12616004
124600         PERFORM 4000-DATE-DELIMIT                                12617004
124700           UNTIL PS-LAST-DATE-PROCESSED                           12618004
124800         MOVE PV-CMER-CLR-FRST-EFF-DTE TO PV-MD4-FRST-EFF-DATE    12619004
124900         MOVE PV-CMER-CLR-LAST-EFF-DTE TO PV-MD4-LAST-EFF-DATE    12619104
125000                                                                  12619204
125100         SET PV-HOLD-INDEX-2 TO PV-DCEDEX2                        12619304
125200                                                                  12619404
125300*    CHECK FOR INVALID DATE ERROR                                 12619504
125400         IF PV-MKDN4-COUNT = 0                                    12619604
125500            PERFORM 2450-DASHES-SLASHES                           12619704
125600         END-IF                                                   12619804
125700                                                                  12619904
123300         SET PV-DCEDEX2 TO PV-HOLD-INDEX-2                        12620004
125700                                                                  12620104
125800     ELSE                                                         12620204
125900         MOVE '~'              TO PV-MD4-FRST-EFF-DATE            12620304
126000         MOVE '~'              TO PV-MD4-LAST-EFF-DATE            12620404
126100     END-IF.                                                      12620504
126200                                                                  12621004
124000***** 5TH MARKDOWN (Column H in new csv layout)                   12622004
124100     MOVE '5'                  TO PV-CLR-MKDN-CDE.                12623004
124200     IF  PV-UC-H                NOT = '---'                       12624004
124300         MOVE PV-UC-H           TO PV-DATE-CELL-ARRAY             12625004
124400         SET PS-NOT-LAST-DATE-PROCESSED TO TRUE                   12626004
124500         SET PV-DCEDEX1         TO 1                              12627004
124600         PERFORM 4000-DATE-DELIMIT                                12628004
124700           UNTIL PS-LAST-DATE-PROCESSED                           12629004
124800         MOVE PV-CMER-CLR-FRST-EFF-DTE TO PV-MD5-FRST-EFF-DATE    12629104
124900         MOVE PV-CMER-CLR-LAST-EFF-DTE TO PV-MD5-LAST-EFF-DATE    12629204
125000                                                                  12629304
125100         SET PV-HOLD-INDEX-2 TO PV-DCEDEX2                        12629404
125200                                                                  12629504
125300*    CHECK FOR INVALID DATE ERROR                                 12629604
125400         IF PV-MKDN5-COUNT = 0                                    12629704
125500            PERFORM 2450-DASHES-SLASHES                           12629804
125600         END-IF                                                   12629904
125700                                                                  12630004
123300         SET PV-DCEDEX2 TO PV-HOLD-INDEX-2                        12630104
125700                                                                  12630204
125800     ELSE                                                         12630304
125900         MOVE '~'              TO PV-MD5-FRST-EFF-DATE            12630404
126000         MOVE '~'              TO PV-MD5-LAST-EFF-DATE            12630504
126100     END-IF.                                                      12630604
126200                                                                  12630704
124000***** 6TH MARKDOWN (Column I in new csv layout)                   12630804
124100     MOVE '6'                  TO PV-CLR-MKDN-CDE.                12630904
124200     IF  PV-UC-I                NOT = '---'                       12631004
124300         MOVE PV-UC-I           TO PV-DATE-CELL-ARRAY             12631104
124400         SET PS-NOT-LAST-DATE-PROCESSED TO TRUE                   12631204
124500         SET PV-DCEDEX1         TO 1                              12631304
124600         PERFORM 4000-DATE-DELIMIT                                12631404
124700           UNTIL PS-LAST-DATE-PROCESSED                           12631504
124800         MOVE PV-CMER-CLR-FRST-EFF-DTE TO PV-MD6-FRST-EFF-DATE    12631604
124900         MOVE PV-CMER-CLR-LAST-EFF-DTE TO PV-MD6-LAST-EFF-DATE    12631704
125000                                                                  12631804
125100         SET PV-HOLD-INDEX-2 TO PV-DCEDEX2                        12631904
125200                                                                  12632004
125300*    CHECK FOR INVALID DATE ERROR                                 12632104
125400         IF PV-MKDN6-COUNT = 0                                    12632204
125500            PERFORM 2450-DASHES-SLASHES                           12632304
125600         END-IF                                                   12632404
125700                                                                  12632504
125800     ELSE                                                         12632804
125900         MOVE '~'              TO PV-MD6-FRST-EFF-DATE            12632904
126000         MOVE '~'              TO PV-MD6-LAST-EFF-DATE            12633004
126100     END-IF.                                                      12633104
126200                                                                  12633204
127300***** MARK OUT OF STOCK (Column J in new csv layout)              12730004
127400     MOVE 'O'                 TO PV-CLR-MKDN-CDE.                 12740000
127500     IF  PV-UC-J               NOT = '---'                        12750004
127600         MOVE PV-UC-J                    TO PV-DATE-CELL-ARRAY    12760004
127700         SET  PS-NOT-LAST-DATE-PROCESSED TO TRUE                  12770000
127800         SET  PV-DCEDEX1                 TO 1                     12780000
127900         PERFORM 4000-DATE-DELIMIT                                12790000
128000           UNTIL PS-LAST-DATE-PROCESSED                           12800000
128100         MOVE PV-CMER-CLR-FRST-EFF-DTE   TO PV-MOS-FRST-EFF-DATE  12810000
128200         MOVE PV-CMER-CLR-LAST-EFF-DTE   TO PV-MOS-LAST-EFF-DATE  12820000
128300                                                                  12830000
128400         SET PV-HOLD-INDEX-2 TO PV-DCEDEX2                        12840000
128500                                                                  12850000
128600*    CHECK FOR INVALID DATE ERROR                                 12860000
128700         IF PV-MKDNO-COUNT = 0                                    12870000
128800            PERFORM 2450-DASHES-SLASHES                           12880000
128900         END-IF                                                   12890000
129000                                                                  12900000
129100     ELSE                                                         12910000
129200         MOVE '~'              TO PV-MOS-FRST-EFF-DATE            12920000
129300         MOVE '~'              TO PV-MOS-LAST-EFF-DATE            12930000
129400     END-IF.                                                      12940000
129500                                                                  12950000
129600     MOVE PV-MD1-LAST-EFF-DATE           TO PV-COMPARE-DATE-ALPHA.12960000
129700     PERFORM 2460-MOVE-TO-LOW.                                    12970000
129800                                                                  12980000
129900     IF PV-MD2-LAST-EFF-DATE = '~'                                12990000
130000        CONTINUE                                                  13000000
130100     ELSE                                                         13010000
130200        MOVE PV-MD2-LAST-EFF-DATE         TO PV-COMPARE-DATE-ALPHA13020000
130300        PERFORM 2470-MOVE-TO-HIGH                                 13030000
130400        IF PV-DO-LOW-DATE > PV-DO-HIGH-DATE                       13040000
130500           MOVE PV-UC-E                   TO PV-DATA-ITEM         13050000
130600           SET PV-ERR-TYP-BAD-DTE-ORDER   TO TRUE                 13060000
130700           DISPLAY 'BAD MD2 DTE ORDER = ' PV-MD2-LAST-EFF-DATE    13070000
130800           SET PS-CSV-ERROR-FOUND         TO TRUE                 13080000
130900           SET PS-CSV-RCD-ERROR-FOUND     TO TRUE                 13090000
131000           PERFORM 8300-BUILD-ERR-RECORD                          13100000
131100           MOVE PV-DO-HIGH-DATE           TO PV-DO-LOW-DATE       13110000
131200        ELSE                                                      13120000
131300           MOVE PV-DO-HIGH-DATE           TO PV-DO-LOW-DATE       13130000
131400        END-IF                                                    13140000
131500     END-IF.                                                      13150000
131600                                                                  13160000
131700     IF PV-MD3-LAST-EFF-DATE = '~'                                13170005
131800        CONTINUE                                                  13180000
131900     ELSE                                                         13190000
132000        MOVE PV-MD3-LAST-EFF-DATE         TO PV-COMPARE-DATE-ALPHA13200005
132100        PERFORM 2470-MOVE-TO-HIGH                                 13210000
132200        IF PV-DO-LOW-DATE > PV-DO-HIGH-DATE                       13220000
132300           MOVE PV-UC-F                   TO PV-DATA-ITEM         13230000
132400           SET PV-ERR-TYP-BAD-DTE-ORDER   TO TRUE                 13240000
132500           DISPLAY 'BAD MD3 DTE ORDER = ' PV-MD3-LAST-EFF-DATE    13250005
132600           SET PS-CSV-ERROR-FOUND         TO TRUE                 13260000
132700           SET PS-CSV-RCD-ERROR-FOUND     TO TRUE                 13270000
132800           PERFORM 8300-BUILD-ERR-RECORD                          13280000
132900           MOVE PV-DO-HIGH-DATE           TO PV-DO-LOW-DATE       13290000
133000        ELSE                                                      13300000
133100           MOVE PV-DO-HIGH-DATE           TO PV-DO-LOW-DATE       13310000
133200        END-IF                                                    13320000
133300     END-IF.                                                      13330000
131600                                                                  13331005
131700     IF PV-MD4-LAST-EFF-DATE = '~'                                13332005
131800        CONTINUE                                                  13333005
131900     ELSE                                                         13334005
132000        MOVE PV-MD4-LAST-EFF-DATE         TO PV-COMPARE-DATE-ALPHA13335005
132100        PERFORM 2470-MOVE-TO-HIGH                                 13336005
132200        IF PV-DO-LOW-DATE > PV-DO-HIGH-DATE                       13337005
132300           MOVE PV-UC-G                   TO PV-DATA-ITEM         13338005
132400           SET PV-ERR-TYP-BAD-DTE-ORDER   TO TRUE                 13339005
132500           DISPLAY 'BAD MD4 DTE ORDER = ' PV-MD4-LAST-EFF-DATE    13339105
132600           SET PS-CSV-ERROR-FOUND         TO TRUE                 13339205
132700           SET PS-CSV-RCD-ERROR-FOUND     TO TRUE                 13339305
132800           PERFORM 8300-BUILD-ERR-RECORD                          13339405
132900           MOVE PV-DO-HIGH-DATE           TO PV-DO-LOW-DATE       13339505
133000        ELSE                                                      13339605
133100           MOVE PV-DO-HIGH-DATE           TO PV-DO-LOW-DATE       13339705
133200        END-IF                                                    13339805
133300     END-IF.                                                      13339905
133400                                                                  13340000
131700     IF PV-MD5-LAST-EFF-DATE = '~'                                13341005
131800        CONTINUE                                                  13342005
131900     ELSE                                                         13343005
132000        MOVE PV-MD5-LAST-EFF-DATE         TO PV-COMPARE-DATE-ALPHA13344005
132100        PERFORM 2470-MOVE-TO-HIGH                                 13345005
132200        IF PV-DO-LOW-DATE > PV-DO-HIGH-DATE                       13346005
132300           MOVE PV-UC-H                   TO PV-DATA-ITEM         13347005
132400           SET PV-ERR-TYP-BAD-DTE-ORDER   TO TRUE                 13348005
132500           DISPLAY 'BAD MD5 DTE ORDER = ' PV-MD5-LAST-EFF-DATE    13349005
132600           SET PS-CSV-ERROR-FOUND         TO TRUE                 13349105
132700           SET PS-CSV-RCD-ERROR-FOUND     TO TRUE                 13349205
132800           PERFORM 8300-BUILD-ERR-RECORD                          13349305
132900           MOVE PV-DO-HIGH-DATE           TO PV-DO-LOW-DATE       13349405
133000        ELSE                                                      13349505
133100           MOVE PV-DO-HIGH-DATE           TO PV-DO-LOW-DATE       13349605
133200        END-IF                                                    13349705
133300     END-IF.                                                      13349805
133400                                                                  13349905
131700     IF PV-MD6-LAST-EFF-DATE = '~'                                13350005
131800        CONTINUE                                                  13350105
131900     ELSE                                                         13350205
132000        MOVE PV-MD6-LAST-EFF-DATE         TO PV-COMPARE-DATE-ALPHA13350305
132100        PERFORM 2470-MOVE-TO-HIGH                                 13350405
132200        IF PV-DO-LOW-DATE > PV-DO-HIGH-DATE                       13350505
132300           MOVE PV-UC-I                   TO PV-DATA-ITEM         13350605
132400           SET PV-ERR-TYP-BAD-DTE-ORDER   TO TRUE                 13350705
132500           DISPLAY 'BAD MD6 DTE ORDER = ' PV-MD6-LAST-EFF-DATE    13350805
132600           SET PS-CSV-ERROR-FOUND         TO TRUE                 13350905
132700           SET PS-CSV-RCD-ERROR-FOUND     TO TRUE                 13351005
132800           PERFORM 8300-BUILD-ERR-RECORD                          13351105
132900           MOVE PV-DO-HIGH-DATE           TO PV-DO-LOW-DATE       13351205
133000        ELSE                                                      13351305
133100           MOVE PV-DO-HIGH-DATE           TO PV-DO-LOW-DATE       13351405
133200        END-IF                                                    13351505
133300     END-IF.                                                      13351605
133400                                                                  13351705
133500     IF PV-MOS-LAST-EFF-DATE = '~'                                13352005
133600        CONTINUE                                                  13360000
133700     ELSE                                                         13370000
133800        MOVE PV-MOS-LAST-EFF-DATE         TO PV-COMPARE-DATE-ALPHA13380000
133900        PERFORM 2470-MOVE-TO-HIGH                                 13390000
134000        IF PV-DO-LOW-DATE > PV-DO-HIGH-DATE                       13400000
134100           MOVE PV-UC-J                   TO PV-DATA-ITEM         13410005
134200           SET PV-ERR-TYP-BAD-DTE-ORDER   TO TRUE                 13420000
134300           DISPLAY 'BAD MOS DTE ORDER = ' PV-MOS-LAST-EFF-DATE    13430005
134400           SET PS-CSV-ERROR-FOUND         TO TRUE                 13440000
134500           SET PS-CSV-RCD-ERROR-FOUND     TO TRUE                 13450000
134600           PERFORM 8300-BUILD-ERR-RECORD                          13460000
134700        END-IF                                                    13470000
134800     END-IF.                                                      13480000
134900                                                                  13490000
      * NOW MAKE SURE UPDATES ON CALENDAR AND ON DATABASE AREN'T IN PAST13491007
                                                                        13491352
131700     IF PV-MD1-LAST-EFF-DATE = '~'                                13491452
131800        CONTINUE                                                  13491552
131900     ELSE                                                         13491652
              MOVE '1' TO  CLR-MKDN-CDE  IN PET00001                    13491752
              PERFORM 7310-SLCT-CLR-MKDN-EVNT-DATA                      13491852
096000        IF (PV-MD1-FRST-EFF-DATE         NOT =                    13492352
096100            PV-PET-CLR-FRST-EFF-DTE(1:10) OR                      13492452
096200            PV-MD1-LAST-EFF-DATE         NOT =                    13492552
096300            PV-PET-CLR-LAST-EFF-DTE(1:10))                        13492652
                                                                        13492952
132000            MOVE PV-MD1-LAST-EFF-DATE  TO PV-COMPARE-DATE-ALPHA   13493052
132100            PERFORM 2470-MOVE-TO-HIGH                             13493152
132000            MOVE PV-CRNT-FSCL-WK-BEG-DTE       TO                 13493552
                                                PV-COMPARE-DATE-ALPHA   13493652
132100            PERFORM 2460-MOVE-TO-LOW                              13493752
132200            IF PV-DO-LOW-DATE > PV-DO-HIGH-DATE                   13493852
132300              MOVE PV-UC-D                   TO PV-DATA-ITEM      13493952
132400              SET PV-ERR-TYP-BAD-DTE-PAST    TO TRUE              13494052
132500              DISPLAY 'CANT UPDATE PAST M1 ON CSV= '              13494152
                                          PV-MD1-FRST-EFF-DATE          13494252
132600              SET PS-CSV-ERROR-FOUND         TO TRUE              13494352
132700              SET PS-CSV-RCD-ERROR-FOUND     TO TRUE              13494452
132800              PERFORM 8300-BUILD-ERR-RECORD                       13494552
133200            ELSE                                                  13495552
132000              MOVE PV-CRNT-FSCL-WK-END-DTE       TO               13495652
                                                PV-COMPARE-DATE-ALPHA   13495752
132100              PERFORM 2470-MOVE-TO-HIGH                           13495852
132000              MOVE PV-MD1-LAST-EFF-DATE  TO PV-COMPARE-DATE-ALPHA 13495952
132100              PERFORM 2461-MOVE-TO-LOW-ALTERNATE                  13496052
132200              IF PV-DO-LOW-DATE-ALTERNATE < PV-DO-HIGH-DATE       13496152
                       SET PS-CURRENT-EVENT-CHANGE TO TRUE              13496252
                    END-IF                                              13496352
                                                                        13496452
132000              MOVE PV-PET-CLR-FRST-EFF-DTE(1:10) TO               13496552
                                                PV-COMPARE-DATE-ALPHA   13496652
132100              PERFORM 2470-MOVE-TO-HIGH                           13496752
132200              IF PV-DO-LOW-DATE > PV-DO-HIGH-DATE                 13496852
132300                MOVE PV-UC-D                   TO PV-DATA-ITEM    13496952
132400                SET PV-ERR-TYP-BAD-DTE-PAST    TO TRUE            13497052
132500                DISPLAY 'CANT UPDATE PAST M1 ON PET TABLES = '    13497152
                                           PV-PET-CLR-FRST-EFF-DTE(1:10)13497252
132600                SET PS-CSV-ERROR-FOUND         TO TRUE            13497352
132700                SET PS-CSV-RCD-ERROR-FOUND     TO TRUE            13497452
132800                PERFORM 8300-BUILD-ERR-RECORD                     13497552
                    ELSE                                                13497652
132000                MOVE PV-CRNT-FSCL-WK-END-DTE       TO             13497752
                                           PV-COMPARE-DATE-ALPHA        13497852
132100                PERFORM 2470-MOVE-TO-HIGH                         13497952
132000                MOVE PV-PET-CLR-FRST-EFF-DTE(1:10) TO             13498052
                                           PV-COMPARE-DATE-ALPHA        13498152
132100                PERFORM 2461-MOVE-TO-LOW-ALTERNATE                13498252
132200                IF PV-DO-LOW-DATE-ALTERNATE < PV-DO-HIGH-DATE     13498352
                         SET PS-CURRENT-EVENT-CHANGE TO TRUE            13498452
                      END-IF                                            13498552
133200              END-IF                                              13498652
                  END-IF                                                13498752
              END-IF                                                    13498852
133300     END-IF.                                                      13498952
                                                                        13499052
131700     IF PV-MD2-LAST-EFF-DATE = '~'                                13499152
131800        CONTINUE                                                  13499252
131900     ELSE                                                         13499352
              MOVE '2' TO  CLR-MKDN-CDE  IN PET00001                    13499452
              PERFORM 7310-SLCT-CLR-MKDN-EVNT-DATA                      13499552
096000        IF (PV-MD2-FRST-EFF-DATE         NOT =                    13499652
096100            PV-PET-CLR-FRST-EFF-DTE(1:10) OR                      13499752
096200            PV-MD2-LAST-EFF-DATE         NOT =                    13499852
096300            PV-PET-CLR-LAST-EFF-DTE(1:10))                        13499952
                                                                        13500052
132000            MOVE PV-MD2-LAST-EFF-DATE  TO PV-COMPARE-DATE-ALPHA   13500152
132100            PERFORM 2470-MOVE-TO-HIGH                             13500252
132000            MOVE PV-CRNT-FSCL-WK-BEG-DTE       TO                 13500352
                                                PV-COMPARE-DATE-ALPHA   13500452
132100            PERFORM 2460-MOVE-TO-LOW                              13500552
132200            IF PV-DO-LOW-DATE > PV-DO-HIGH-DATE                   13500652
132300              MOVE PV-UC-E                   TO PV-DATA-ITEM      13500752
132400              SET PV-ERR-TYP-BAD-DTE-PAST    TO TRUE              13500852
132500              DISPLAY 'CANT UPDATE PAST M2 ON CSV= '              13500952
                                          PV-MD2-FRST-EFF-DATE          13501052
132600              SET PS-CSV-ERROR-FOUND         TO TRUE              13501152
132700              SET PS-CSV-RCD-ERROR-FOUND     TO TRUE              13501252
132800              PERFORM 8300-BUILD-ERR-RECORD                       13501352
133200            ELSE                                                  13502052
132000              MOVE PV-CRNT-FSCL-WK-END-DTE       TO               13502352
                                                PV-COMPARE-DATE-ALPHA   13502452
132100              PERFORM 2470-MOVE-TO-HIGH                           13502552
132000              MOVE PV-MD2-LAST-EFF-DATE  TO PV-COMPARE-DATE-ALPHA 13502652
132100              PERFORM 2461-MOVE-TO-LOW-ALTERNATE                  13502752
132200              IF PV-DO-LOW-DATE-ALTERNATE < PV-DO-HIGH-DATE       13502852
                       SET PS-CURRENT-EVENT-CHANGE TO TRUE              13503052
                    END-IF                                              13503152
                                                                        13503252
132000              MOVE PV-PET-CLR-FRST-EFF-DTE(1:10) TO               13503352
                                                PV-COMPARE-DATE-ALPHA   13503452
132100              PERFORM 2470-MOVE-TO-HIGH                           13503552
132200              IF PV-DO-LOW-DATE > PV-DO-HIGH-DATE                 13503652
132300                MOVE PV-UC-E                   TO PV-DATA-ITEM    13503752
132400                SET PV-ERR-TYP-BAD-DTE-PAST    TO TRUE            13503852
132500                DISPLAY 'CANT UPDATE PAST M2 ON PET TABLES = '    13503952
                                           PV-PET-CLR-FRST-EFF-DTE(1:10)13504052
132600                SET PS-CSV-ERROR-FOUND         TO TRUE            13504152
132700                SET PS-CSV-RCD-ERROR-FOUND     TO TRUE            13504252
132800                PERFORM 8300-BUILD-ERR-RECORD                     13504352
                    ELSE                                                13504452
132000                MOVE PV-CRNT-FSCL-WK-END-DTE       TO             13504552
                                           PV-COMPARE-DATE-ALPHA        13504652
132100                PERFORM 2470-MOVE-TO-HIGH                         13504752
132000                MOVE PV-PET-CLR-FRST-EFF-DTE(1:10) TO             13504852
                                           PV-COMPARE-DATE-ALPHA        13504952
132100                PERFORM 2461-MOVE-TO-LOW-ALTERNATE                13505052
132200                IF PV-DO-LOW-DATE-ALTERNATE < PV-DO-HIGH-DATE     13505152
                         SET PS-CURRENT-EVENT-CHANGE TO TRUE            13505252
                      END-IF                                            13505352
133200              END-IF                                              13505452
                  END-IF                                                13505552
              END-IF                                                    13505652
133300     END-IF.                                                      13505752
                                                                        13505852
131700     IF PV-MD3-LAST-EFF-DATE = '~'                                13505952
131800        CONTINUE                                                  13506052
131900     ELSE                                                         13506152
              MOVE '3' TO  CLR-MKDN-CDE  IN PET00001                    13506252
              PERFORM 7310-SLCT-CLR-MKDN-EVNT-DATA                      13506352
096000        IF (PV-MD3-FRST-EFF-DATE         NOT =                    13506452
096100            PV-PET-CLR-FRST-EFF-DTE(1:10) OR                      13506552
096200            PV-MD3-LAST-EFF-DATE         NOT =                    13506652
096300            PV-PET-CLR-LAST-EFF-DTE(1:10)  )                      13506752
                                                                        13506852
132000            MOVE PV-MD3-LAST-EFF-DATE  TO PV-COMPARE-DATE-ALPHA   13506952
132100            PERFORM 2470-MOVE-TO-HIGH                             13507052
132000            MOVE PV-CRNT-FSCL-WK-BEG-DTE       TO                 13507152
                                                PV-COMPARE-DATE-ALPHA   13507252
132100            PERFORM 2460-MOVE-TO-LOW                              13507352
132200            IF PV-DO-LOW-DATE > PV-DO-HIGH-DATE                   13507452
132300              MOVE PV-UC-F                   TO PV-DATA-ITEM      13507552
132400              SET PV-ERR-TYP-BAD-DTE-PAST    TO TRUE              13507652
132500              DISPLAY 'CANT UPDATE PAST M3 ON CSV= '              13507752
                                          PV-MD3-FRST-EFF-DATE          13507852
132600              SET PS-CSV-ERROR-FOUND         TO TRUE              13507952
132700              SET PS-CSV-RCD-ERROR-FOUND     TO TRUE              13508052
132800              PERFORM 8300-BUILD-ERR-RECORD                       13508152
133200            ELSE                                                  13508252
132000              MOVE PV-CRNT-FSCL-WK-END-DTE       TO               13508352
                                                PV-COMPARE-DATE-ALPHA   13508452
132100              PERFORM 2470-MOVE-TO-HIGH                           13508552
132000              MOVE PV-MD3-LAST-EFF-DATE  TO PV-COMPARE-DATE-ALPHA 13508652
132100              PERFORM 2461-MOVE-TO-LOW-ALTERNATE                  13508752
132200              IF PV-DO-LOW-DATE-ALTERNATE < PV-DO-HIGH-DATE       13508852
                       SET PS-CURRENT-EVENT-CHANGE TO TRUE              13508952
                    END-IF                                              13509052
                                                                        13509152
132000              MOVE PV-PET-CLR-FRST-EFF-DTE(1:10) TO               13509252
                                                 PV-COMPARE-DATE-ALPHA  13509352
132100              PERFORM 2470-MOVE-TO-HIGH                           13509452
132200              IF PV-DO-LOW-DATE > PV-DO-HIGH-DATE                 13509552
132300                MOVE PV-UC-F                   TO PV-DATA-ITEM    13509652
132400                SET PV-ERR-TYP-BAD-DTE-PAST    TO TRUE            13509752
132500                DISPLAY 'CANT UPDATE PAST M3 ON PET TABLES = '    13509852
                                          PV-PET-CLR-FRST-EFF-DTE(1:10) 13509952
132600                SET PS-CSV-ERROR-FOUND         TO TRUE            13510052
132700                SET PS-CSV-RCD-ERROR-FOUND     TO TRUE            13510152
132800                PERFORM 8300-BUILD-ERR-RECORD                     13510252
                    ELSE                                                13510352
132000                MOVE PV-CRNT-FSCL-WK-END-DTE       TO             13510452
                                           PV-COMPARE-DATE-ALPHA        13510552
132100                PERFORM 2470-MOVE-TO-HIGH                         13510652
132000                MOVE PV-PET-CLR-FRST-EFF-DTE(1:10) TO             13510752
                                           PV-COMPARE-DATE-ALPHA        13510852
132100                PERFORM 2461-MOVE-TO-LOW-ALTERNATE                13510952
132200                IF PV-DO-LOW-DATE-ALTERNATE < PV-DO-HIGH-DATE     13511052
                         SET PS-CURRENT-EVENT-CHANGE TO TRUE            13511152
                      END-IF                                            13511252
133200              END-IF                                              13511352
                  END-IF                                                13511452
              END-IF                                                    13511552
133300     END-IF.                                                      13511652
                                                                        13511752
131700     IF PV-MD4-LAST-EFF-DATE = '~'                                13511852
131800        CONTINUE                                                  13511952
131900     ELSE                                                         13512052
              MOVE '4' TO  CLR-MKDN-CDE  IN PET00001                    13512152
              PERFORM 7310-SLCT-CLR-MKDN-EVNT-DATA                      13512252
096000        IF (PV-MD4-FRST-EFF-DATE         NOT =                    13512352
096100            PV-PET-CLR-FRST-EFF-DTE(1:10) OR                      13512452
096200            PV-MD4-LAST-EFF-DATE         NOT =                    13512552
096300            PV-PET-CLR-LAST-EFF-DTE(1:10))                        13512652
                                                                        13512752
132000            MOVE PV-MD4-LAST-EFF-DATE  TO PV-COMPARE-DATE-ALPHA   13512852
132100            PERFORM 2470-MOVE-TO-HIGH                             13512952
132000            MOVE PV-CRNT-FSCL-WK-BEG-DTE       TO                 13513052
                                                PV-COMPARE-DATE-ALPHA   13513152
132100            PERFORM 2460-MOVE-TO-LOW                              13513252
132200            IF PV-DO-LOW-DATE > PV-DO-HIGH-DATE                   13513352
132300              MOVE PV-UC-G                   TO PV-DATA-ITEM      13513452
13240               SET PV-ERR-TYP-BAD-DTE-PAST    TO TRUE              13513552
132500              DISPLAY 'CANT UPDATE PAST M4 ON CSV= '              13513652
                                          PV-MD4-FRST-EFF-DATE          13513752
132600              SET PS-CSV-ERROR-FOUND         TO TRUE              13513852
132700              SET PS-CSV-RCD-ERROR-FOUND     TO TRUE              13513952
132800              PERFORM 8300-BUILD-ERR-RECORD                       13514052
133200            ELSE                                                  13514152
132000              MOVE PV-CRNT-FSCL-WK-END-DTE       TO               13514252
                                                PV-COMPARE-DATE-ALPHA   13514352
132100              PERFORM 2470-MOVE-TO-HIGH                           13514452
132000              MOVE PV-MD4-LAST-EFF-DATE  TO PV-COMPARE-DATE-ALPHA 13514552
132100              PERFORM 2461-MOVE-TO-LOW-ALTERNATE                  13514652
132200              IF PV-DO-LOW-DATE-ALTERNATE < PV-DO-HIGH-DATE       13514752
                       SET PS-CURRENT-EVENT-CHANGE TO TRUE              13514852
                    END-IF                                              13514952
                                                                        13515052
132000              MOVE PV-PET-CLR-FRST-EFF-DTE(1:10) TO               13515152
                                                PV-COMPARE-DATE-ALPHA   13515252
132100              PERFORM 2470-MOVE-TO-HIGH                           13515352
132200              IF PV-DO-LOW-DATE > PV-DO-HIGH-DATE                 13515452
132300                MOVE PV-UC-G                   TO PV-DATA-ITEM    13515552
13240                 SET PV-ERR-TYP-BAD-DTE-PAST    TO TRUE            13515652
132500                DISPLAY 'CANT UPDATE PAST M4 ON PET TABLES = '    13515752
                                          PV-PET-CLR-FRST-EFF-DTE(1:10) 13515852
132600                SET PS-CSV-ERROR-FOUND         TO TRUE            13515952
132700                SET PS-CSV-RCD-ERROR-FOUND     TO TRUE            13516052
132800                PERFORM 8300-BUILD-ERR-RECORD                     13516152
                    ELSE                                                13516252
132000                MOVE PV-CRNT-FSCL-WK-END-DTE       TO             13516352
                                           PV-COMPARE-DATE-ALPHA        13516452
132100                PERFORM 2470-MOVE-TO-HIGH                         13516552
132000                MOVE PV-PET-CLR-FRST-EFF-DTE(1:10) TO             13516652
                                           PV-COMPARE-DATE-ALPHA        13516752
132100                PERFORM 2461-MOVE-TO-LOW-ALTERNATE                13516852
132200                IF PV-DO-LOW-DATE-ALTERNATE < PV-DO-HIGH-DATE     13516952
                         SET PS-CURRENT-EVENT-CHANGE TO TRUE            13517052
                      END-IF                                            13517152
133200              END-IF                                              13517252
                  END-IF                                                13517352
              END-IF                                                    13517452
133300     END-IF.                                                      13517552
                                                                        13517652
131700     IF PV-MD5-LAST-EFF-DATE = '~'                                13517752
131800        CONTINUE                                                  13517852
131900     ELSE                                                         13517952
              MOVE '5' TO  CLR-MKDN-CDE  IN PET00001                    13518052
              PERFORM 7310-SLCT-CLR-MKDN-EVNT-DATA                      13518152
096000        IF (PV-MD5-FRST-EFF-DATE         NOT =                    13518252
09610             PV-PET-CLR-FRST-EFF-DTE(1:10) OR                      13518352
09620             PV-MD5-LAST-EFF-DATE         NOT =                    13518452
096300            PV-PET-CLR-LAST-EFF-DTE(1:10))                        13518552
                                                                        13518652
132000            MOVE PV-MD5-LAST-EFF-DATE  TO PV-COMPARE-DATE-ALPHA   13518752
132100            PERFORM 2470-MOVE-TO-HIGH                             13518852
132000            MOVE PV-CRNT-FSCL-WK-BEG-DTE       TO                 13518952
                                                PV-COMPARE-DATE-ALPHA   13519052
132100            PERFORM 2460-MOVE-TO-LOW                              13519152
132200            IF PV-DO-LOW-DATE > PV-DO-HIGH-DATE                   13519252
132300              MOVE PV-UC-H                   TO PV-DATA-ITEM      13519352
132400              SET PV-ERR-TYP-BAD-DTE-PAST    TO TRUE              13519452
132500              DISPLAY 'CANT UPDATE PAST M5 ON CSV= '              13519552
                                          PV-MD5-FRST-EFF-DATE          13519652
132600              SET PS-CSV-ERROR-FOUND         TO TRUE              13519752
132700              SET PS-CSV-RCD-ERROR-FOUND     TO TRUE              13519852
132800              PERFORM 8300-BUILD-ERR-RECORD                       13519952
133200            ELSE                                                  13520052
132000              MOVE PV-CRNT-FSCL-WK-END-DTE       TO               13520152
                                                PV-COMPARE-DATE-ALPHA   13520252
132100              PERFORM 2470-MOVE-TO-HIGH                           13520352
132000              MOVE PV-MD5-LAST-EFF-DATE  TO PV-COMPARE-DATE-ALPHA 13520452
132100              PERFORM 2461-MOVE-TO-LOW-ALTERNATE                  13520552
132200              IF PV-DO-LOW-DATE-ALTERNATE < PV-DO-HIGH-DATE       13520652
                       SET PS-CURRENT-EVENT-CHANGE TO TRUE              13520752
                    END-IF                                              13520852
                                                                        13520952
132000              MOVE PV-PET-CLR-FRST-EFF-DTE(1:10) TO               13521052
                                                PV-COMPARE-DATE-ALPHA   13521152
132100              PERFORM 2470-MOVE-TO-HIGH                           13521252
132200              IF PV-DO-LOW-DATE > PV-DO-HIGH-DATE                 13521352
132300                MOVE PV-UC-H                   TO PV-DATA-ITEM    13521452
132400                SET PV-ERR-TYP-BAD-DTE-PAST    TO TRUE            13521552
132500                DISPLAY 'CANT UPDATE PAST M5 ON PET TABLES = '    13521652
                                          PV-PET-CLR-FRST-EFF-DTE(1:10) 13521752
132600                SET PS-CSV-ERROR-FOUND         TO TRUE            13521852
132700                SET PS-CSV-RCD-ERROR-FOUND     TO TRUE            13521952
132800                PERFORM 8300-BUILD-ERR-RECORD                     13522052
                    ELSE                                                13522152
132000                MOVE PV-CRNT-FSCL-WK-END-DTE       TO             13522252
                                           PV-COMPARE-DATE-ALPHA        13522352
132100                PERFORM 2470-MOVE-TO-HIGH                         13522452
132000                MOVE PV-PET-CLR-FRST-EFF-DTE(1:10) TO             13522552
                                           PV-COMPARE-DATE-ALPHA        13522652
13210                 PERFORM 2461-MOVE-TO-LOW-ALTERNATE                13522752
132200                IF PV-DO-LOW-DATE-ALTERNATE < PV-DO-HIGH-DATE     13522852
                         SET PS-CURRENT-EVENT-CHANGE TO TRUE            13522952
                      END-IF                                            13523052
133200              END-IF                                              13523152
                  END-IF                                                13523252
              END-IF                                                    13523352
133300     END-IF.                                                      13523452
                                                                        13523552
131700     IF PV-MD6-LAST-EFF-DATE = '~'                                13523652
131800        CONTINUE                                                  13523752
131900     ELSE                                                         13523852
              MOVE '6' TO  CLR-MKDN-CDE  IN PET00001                    13523952
              PERFORM 7310-SLCT-CLR-MKDN-EVNT-DATA                      13524052
096000        IF (PV-MD6-FRST-EFF-DATE         NOT =                    13524152
096100            PV-PET-CLR-FRST-EFF-DTE(1:10) OR                      13524252
096200            PV-MD6-LAST-EFF-DATE         NOT =                    13524352
096300            PV-PET-CLR-LAST-EFF-DTE(1:10))                        13524452
                                                                        13524552
132000            MOVE PV-MD6-LAST-EFF-DATE  TO PV-COMPARE-DATE-ALPHA   13524652
132100            PERFORM 2470-MOVE-TO-HIGH                             13524752
132000            MOVE PV-CRNT-FSCL-WK-BEG-DTE       TO                 13524852
                                                PV-COMPARE-DATE-ALPHA   13524952
132100            PERFORM 2460-MOVE-TO-LOW                              13525052
132200            IF PV-DO-LOW-DATE > PV-DO-HIGH-DATE                   13525152
132300              MOVE PV-UC-I                   TO PV-DATA-ITEM      13525252
132400              SET PV-ERR-TYP-BAD-DTE-PAST    TO TRUE              13525352
132500              DISPLAY 'CANT UPDATE PAST M6 ON CSV= '              13525452
                                          PV-MD6-FRST-EFF-DATE          13525552
132600              SET PS-CSV-ERROR-FOUND         TO TRUE              13525652
132700              SET PS-CSV-RCD-ERROR-FOUND     TO TRUE              13525752
132800              PERFORM 8300-BUILD-ERR-RECORD                       13525852
133200            ELSE                                                  13525952
13200               MOVE PV-CRNT-FSCL-WK-END-DTE       TO               13526052
                                                PV-COMPARE-DATE-ALPHA   13526152
132100              PERFORM 2470-MOVE-TO-HIGH                           13526252
132000              MOVE PV-MD6-LAST-EFF-DATE  TO PV-COMPARE-DATE-ALPHA 13526352
132100              PERFORM 2461-MOVE-TO-LOW-ALTERNATE                  13526452
132200              IF PV-DO-LOW-DATE-ALTERNATE < PV-DO-HIGH-DATE       13526552
                       SET PS-CURRENT-EVENT-CHANGE TO TRUE              13526652
                    END-IF                                              13526752
                                                                        13526852
132000              MOVE PV-PET-CLR-FRST-EFF-DTE(1:10) TO               13526952
                                                PV-COMPARE-DATE-ALPHA   13527052
132100              PERFORM 2470-MOVE-TO-HIGH                           13527152
132200              IF PV-DO-LOW-DATE > PV-DO-HIGH-DATE                 13527252
132300                MOVE PV-UC-I                   TO PV-DATA-ITEM    13527352
132400                SET PV-ERR-TYP-BAD-DTE-PAST    TO TRUE            13527452
132500                DISPLAY 'CANT UPDATE PAST M6 ON PET TABLES = '    13527552
                                          PV-PET-CLR-FRST-EFF-DTE(1:10) 13527652
132600                SET PS-CSV-ERROR-FOUND         TO TRUE            13527752
13270                 SET PS-CSV-RCD-ERROR-FOUND     TO TRUE            13527852
132800                PERFORM 8300-BUILD-ERR-RECORD                     13527952
                    ELSE                                                13528052
132000                MOVE PV-CRNT-FSCL-WK-END-DTE       TO             13528152
                                           PV-COMPARE-DATE-ALPHA        13528252
132100                PERFORM 2470-MOVE-TO-HIGH                         13528352
132000                MOVE PV-PET-CLR-FRST-EFF-DTE(1:10) TO             13528452
                                           PV-COMPARE-DATE-ALPHA        13528552
132100                PERFORM 2461-MOVE-TO-LOW-ALTERNATE                13528652
132200                IF PV-DO-LOW-DATE-ALTERNATE < PV-DO-HIGH-DATE     13528752
                         SET PS-CURRENT-EVENT-CHANGE TO TRUE            13528852
                      END-IF                                            13528952
133200              END-IF                                              13529052
                  END-IF                                                13529152
              END-IF                                                    13529252
133300     END-IF.                                                      13529352
                                                                        13529452
131700     IF PV-MOS-LAST-EFF-DATE = '~'                                13529552
131800        CONTINUE                                                  13529652
131900     ELSE                                                         13529752
              MOVE 'O' TO  CLR-MKDN-CDE  IN PET00001                    13529852
              PERFORM 7310-SLCT-CLR-MKDN-EVNT-DATA                      13529952
096000        IF (PV-MOS-FRST-EFF-DATE         NOT =                    13530052
096100            PV-PET-CLR-FRST-EFF-DTE(1:10) OR                      13530152
096200            PV-MOS-LAST-EFF-DATE         NOT =                    13530252
096300            PV-PET-CLR-LAST-EFF-DTE(1:10))                        13530352
                                                                        13530452
132000            MOVE PV-MOS-LAST-EFF-DATE  TO PV-COMPARE-DATE-ALPHA   13530552
132100            PERFORM 2470-MOVE-TO-HIGH                             13530652
132000            MOVE PV-CRNT-FSCL-WK-BEG-DTE       TO                 13530752
                                                PV-COMPARE-DATE-ALPHA   13530852
132100            PERFORM 2460-MOVE-TO-LOW                              13530952
132200            IF PV-DO-LOW-DATE > PV-DO-HIGH-DATE                   13531052
132300              MOVE PV-UC-J                   TO PV-DATA-ITEM      13531152
132400              SET PV-ERR-TYP-BAD-DTE-PAST    TO TRUE              13531252
132500              DISPLAY 'CANT UPDATE PAST MOS ON CSV= '             13531352
                                          PV-MOS-FRST-EFF-DATE          13531452
132600              SET PS-CSV-ERROR-FOUND         TO TRUE              13531552
132700              SET PS-CSV-RCD-ERROR-FOUND     TO TRUE              13531652
132800              PERFORM 8300-BUILD-ERR-RECORD                       13531752
133200            ELSE                                                  13531852
132000              MOVE PV-CRNT-FSCL-WK-END-DTE       TO               13531952
                                                PV-COMPARE-DATE-ALPHA   13532052
132100              PERFORM 2470-MOVE-TO-HIGH                           13532152
132000              MOVE PV-MOS-LAST-EFF-DATE  TO PV-COMPARE-DATE-ALPHA 13532252
132100              PERFORM 2461-MOVE-TO-LOW-ALTERNATE                  13532352
132200              IF PV-DO-LOW-DATE-ALTERNATE < PV-DO-HIGH-DATE       13532452
                       SET PS-CURRENT-EVENT-CHANGE TO TRUE              13532552
                    END-IF                                              13532652
                                                                        13532752
132000              MOVE PV-PET-CLR-FRST-EFF-DTE(1:10) TO               13532852
                                                PV-COMPARE-DATE-ALPHA   13532952
132100              PERFORM 2470-MOVE-TO-HIGH                           13533052
132200              IF PV-DO-LOW-DATE > PV-DO-HIGH-DATE                 13533152
132300                MOVE PV-UC-J                   TO PV-DATA-ITEM    13533252
132400                SET PV-ERR-TYP-BAD-DTE-PAST    TO TRUE            13533352
132500                DISPLAY 'CANT UPDATE PAST MOS ON PET TABLES = '   13533452
                                          PV-PET-CLR-FRST-EFF-DTE(1:10) 13533552
132600                SET PS-CSV-ERROR-FOUND         TO TRUE            13533652
132700                SET PS-CSV-RCD-ERROR-FOUND     TO TRUE            13533752
132800                PERFORM 8300-BUILD-ERR-RECORD                     13533852
                    ELSE                                                13533952
132000                MOVE PV-CRNT-FSCL-WK-END-DTE       TO             13534052
                                           PV-COMPARE-DATE-ALPHA        13534152
132100                PERFORM 2470-MOVE-TO-HIGH                         13534252
132000                MOVE PV-PET-CLR-FRST-EFF-DTE(1:10) TO             13534352
                                           PV-COMPARE-DATE-ALPHA        13534452
132100                PERFORM 2461-MOVE-TO-LOW-ALTERNATE                13534552
132200                IF PV-DO-LOW-DATE-ALTERNATE < PV-DO-HIGH-DATE     13534652
                         SET PS-CURRENT-EVENT-CHANGE TO TRUE            13534752
                      END-IF                                            13534852
133200              END-IF                                              13534952
                  END-IF                                                13535052
              END-IF                                                    13535152
133300     END-IF.                                                      13535252
                                                                        13535352
135000*2400-EXIT.  EXIT.                                                13535408
135100******************************************************************13535508
135200*     LOOK FOR DASHES AND SLASHES IN DATE                         13535608
135300******************************************************************13536000
135400 2450-DASHES-SLASHES.                                             13540000
135500     MOVE '2450-DASHES-SLASHES           ' TO PV-PARAGRAPH-NAME.  13550000
135600                                                                  13560000
135700     MOVE ZEROS TO PV-DASH-COUNT, PV-SLASH-COUNT.                 13570000
135800                                                                  13580000
135900     SET PV-DCEDEX1                UP BY 1.                       13590000
136000     SET PS-VALID-DATE-FMT         TO TRUE.                       13600000
136100                                                                  13610000
136200     PERFORM                                                      13620000
136300      VARYING PV-DCEDEX2 FROM PV-DCEDEX1 BY -1                    13630000
136400        UNTIL PV-DCEDEX2              = 1                         13640000
136500                                                                  13650000
136600        IF PV-DCA-ELEMENT(PV-DCEDEX2) = '-'                       13660000
136700           ADD +1 TO PV-DASH-COUNT                                13670000
136800        END-IF                                                    13680000
136900                                                                  13690000
137000        IF PV-DCA-ELEMENT(PV-DCEDEX2) = '/'                       13700000
137100           ADD +1 TO PV-SLASH-COUNT                               13710000
137200        END-IF                                                    13720000
137300     END-PERFORM.                                                 13730000
137400                                                                  13740000
137500     IF ((PV-SLASH-COUNT = 5 AND PV-DASH-COUNT = 4) OR            13750000
137600         (PV-SLASH-COUNT = 4 AND PV-DASH-COUNT = 3) OR            13760000
137700         (PV-SLASH-COUNT = 3 AND PV-DASH-COUNT = 2) OR            13770000
137800         (PV-SLASH-COUNT = 2 AND PV-DASH-COUNT = 1) OR            13780000
137900         (PV-SLASH-COUNT = 1 AND PV-DASH-COUNT = 0))              13790000
138000            CONTINUE                                              13800000
138100     ELSE                                                         13810000
138200         SET PS-INVALID-DATE-FMT TO TRUE                          13820000
138300         PERFORM 6400-INVALID-DATE-INPUT                          13830000
138400     END-IF.                                                      13840000
138500                                                                  13850000
138600*2450-EXIT.  EXIT.                                                13860000
138700******************************************************************13870000
138800*     MOVE LAST EFF DATE TO LOW DATES FOR COMPARING               13880000
138900******************************************************************13890000
139000 2460-MOVE-TO-LOW.                                                13900012
139100     MOVE '2460-MOVE-TO-LOW              ' TO PV-PARAGRAPH-NAME.  13910012
139200     MOVE PV-COMPARE-YEAR                  TO PV-DO-LOW-YYYY.     13920000
139300     MOVE PV-COMPARE-MONTH                 TO PV-DO-LOW-MM.       13930000
139400     MOVE PV-COMPARE-DAY                   TO PV-DO-LOW-DD.       13940000
139500                                                                  13950000
139600*2460-EXIT.  EXIT.                                                13960000
138700******************************************************************13961032
138800*     MOVE LAST EFF DATE TO LOW DATES FOR COMPARING (ALTERNATE)   13962032
138900******************************************************************13963032
139000 2461-MOVE-TO-LOW-ALTERNATE.                                      13964032
139100     MOVE '2461-MOVE-TO-LOW-ALTERNATE    ' TO PV-PARAGRAPH-NAME.  13965037
139200     MOVE PV-COMPARE-YEAR                  TO PV-DO-LOW-YYYY-ALT. 13966032
139300     MOVE PV-COMPARE-MONTH                 TO PV-DO-LOW-MM-ALT.   13967032
139400     MOVE PV-COMPARE-DAY                   TO PV-DO-LOW-DD-ALT.   13968032
139500                                                                  13969032
139600*2461-EXIT.  EXIT.                                                13969132
139700******************************************************************13970000
139800*     MOVE LAST EFF DATE TO HIGH DATES FOR COMPARING              13980000
139900******************************************************************13990000
140000 2470-MOVE-TO-HIGH.                                               14000000
140100     MOVE '2470-MOVE-TO-HIGH             ' TO PV-PARAGRAPH-NAME.  14010000
140200     MOVE PV-COMPARE-YEAR                  TO PV-DO-HIGH-YYYY.    14020000
140300     MOVE PV-COMPARE-MONTH                 TO PV-DO-HIGH-MM.      14030000
140400     MOVE PV-COMPARE-DAY                   TO PV-DO-HIGH-DD.      14040000
140500                                                                  14050000
140600*2470-EXIT.  EXIT.                                                14060000
140700******************************************************************14070000
140800*     BUILD COMMON EVENT DATA.                                   *14080000
140900******************************************************************14090000
141000 2500-BUILD-EVENT-OUT-RCD.                                        14100000
141100     MOVE '2500-BUILD-EVENT-OUT-RCD      ' TO PV-PARAGRAPH-NAME.  14110000
141200     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          14120000
141300                                                                  14130000
141400*    Expand Event Name in 4300-EXPAND-EVNT-NM                     14140000
141500     MOVE PV-EVNT-NAME-EXPANDED     TO PA905-CLR-EVNT-NM.         14150000
141600*    DISPLAY PA905-CLR-EVNT-NM.                                   14160000
141700                                                                  14170000
141800     MOVE PV-MD1-FRST-EFF-DATE      TO PA905-MD1-CLR-FRST-EFF-DTE.14180000
141900     MOVE PV-MD1-LAST-EFF-DATE      TO PA905-MD1-CLR-LAST-EFF-DTE.14190000
142000     MOVE PV-MD2-FRST-EFF-DATE      TO PA905-MD2-CLR-FRST-EFF-DTE.14200000
142100     MOVE PV-MD2-LAST-EFF-DATE      TO PA905-MD2-CLR-LAST-EFF-DTE.14210000
142200     MOVE PV-MD3-FRST-EFF-DATE      TO PA905-MD3-CLR-FRST-EFF-DTE.14220005
142300     MOVE PV-MD3-LAST-EFF-DATE      TO PA905-MD3-CLR-LAST-EFF-DTE.14230005
142200     MOVE PV-MD4-FRST-EFF-DATE      TO PA905-MD4-CLR-FRST-EFF-DTE.14230105
142300     MOVE PV-MD4-LAST-EFF-DATE      TO PA905-MD4-CLR-LAST-EFF-DTE.14230205
142200     MOVE PV-MD5-FRST-EFF-DATE      TO PA905-MD5-CLR-FRST-EFF-DTE.14230305
142300     MOVE PV-MD5-LAST-EFF-DATE      TO PA905-MD5-CLR-LAST-EFF-DTE.14230405
142200     MOVE PV-MD6-FRST-EFF-DATE      TO PA905-MD6-CLR-FRST-EFF-DTE.14231005
142300     MOVE PV-MD6-LAST-EFF-DATE      TO PA905-MD6-CLR-LAST-EFF-DTE.14232005
142400     MOVE PV-MOS-FRST-EFF-DATE      TO PA905-MOS-CLR-FRST-EFF-DTE.14240000
142500     MOVE PV-MOS-LAST-EFF-DATE      TO PA905-MOS-CLR-LAST-EFF-DTE.14250000
142600                                                                  14260000
142700     PERFORM 8000-WRITE-EVNT-RECORD.                              14270000
142800                                                                  14280000
142900*2500-EXIT.  EXIT.                                                14290000
143000******************************************************************14300000
143100*     CLEARANCE EVENT CSV VALIDATION ROUTINE                     *14310000
143200******************************************************************14320000
143300 3000-VALIDATE-EXISTING-EVNT.                                     14330000
143400     MOVE '3000-VALIDATE-EXISTING-EVNT ' TO PV-PARAGRAPH-NAME.    14340000
143500     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          14350000
143600                                                                  14360000
143700     EVALUATE TRUE                                                14370000
143800        WHEN PS-LY-EVNT-ID-FOUND                                  14380000
143900           IF PV-LY-CE-ID-NULL-IND = -1                           14390000
144000              MOVE PV-CER-LY-CLR-EVNT-ID                          14400000
144100                            TO LY-CLR-EVNT-ID IN PET00003         14410000
144200           ELSE                                                   14420000
144300              IF PV-CER-LY-CLR-EVNT-ID IS NOT EQUAL TO            14430000
144400                                 LY-CLR-EVNT-ID IN PET00003       14440000
144500                  MOVE PV-CER-LY-CLR-EVNT-ID                      14450000
144600                            TO LY-CLR-EVNT-ID IN PET00003         14460000
144700              END-IF                                              14470000
144800           END-IF                                                 14480000
144900        WHEN OTHER                                                14490000
145000           IF PV-LY-CE-ID-NULL-IND = -1                           14500000
145100              SET  PS-EVNT-UPDATE-NOT-NEEDED TO TRUE              14510000
145200           ELSE                                                   14520000
145300              MOVE -1 TO PV-LY-CE-ID-NULL-IND                     14530000
145400              SET PS-EVNT-UPDATE-NEEDED TO TRUE                   14540000
145500           END-IF                                                 14550000
145600     END-EVALUATE.                                                14560000
146000     EVALUATE TRUE                                                14600000
146100        WHEN PV-EVNT-NAME-EXPANDED = CLR-EVNT-NM IN PET00003      14610000
146200            SET PS-EVNT-UPDATE-NOT-NEEDED    TO TRUE              14620000
146300        WHEN OTHER                                                14630048
146400            SET PS-EVNT-UPDATE-NEEDED        TO TRUE              14640000
147200     END-EVALUATE.                                                14720000
147300                                                                  14730000
147400*3000-EXIT.  EXIT.                                                14740000
147500******************************************************************14750000
147600*  ROUTINE TO GET CALENDAR DATE FOR EVENT WITH NEW FORMAT NAME   *14760000
147700******************************************************************14770000
147800 3100-GET-EVNT-CAL-DTE.                                           14780000
147900     MOVE '3100-GET-EVNT-CAL-DTE           ' TO PV-PARAGRAPH-NAME.14790000
148000     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          14800000
148100                                                                  14810000
148200     PERFORM                                                      14820000
148300         WITH TEST AFTER                                          14830000
148400         VARYING PV-SQL-SUB                                       14840000
148500         FROM 1 BY 1                                              14850000
148600         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 14860000
148700                   OR  SQLCODE = 0                                14870000
148800                   OR  SQLCODE = +1403 )                          14880000
148900                                                                  14890000
149000         PERFORM 7300-GET-EVNT-CAL-DTE                            14900000
149100                                                                  14910000
149200         EVALUATE TRUE                                            14920000
149300             WHEN SQLCODE = 0                                     14930000
149400                 CONTINUE                                         14940000
149500             WHEN SQLCODE = + 1403                                14950000
149600                 SET PV-ERR-TYP-BAD-CSV-DATE-NAME TO TRUE         14960000
149700                 SET PS-CSV-ERROR-FOUND           TO TRUE         14970000
149800                 SET PS-CSV-RCD-ERROR-FOUND       TO TRUE         14980000
149900                 MOVE PV-EVNT-CSV-NM-FSCL-YR      TO PV-DATA-ITEM 14990000
150000                 PERFORM 8300-BUILD-ERR-RECORD                    15000000
150100             WHEN OTHER                                           15010000
150200                 DISPLAY 'ORACLE ERROR IN 7300-GET-EVNT-CAL-DTE'  15020000
150300                 MOVE '7300-GET-EVNT-CAL-DTE' TO PV-PARAGRAPH-NAME15030000
150400                 MOVE 'SELECT FROM TDTATTR FOR FSCL YR & WK'      15040064
150500                                    TO PV-ORA-OPERATION           15050000
150600                 PERFORM 9700-ORA-ERROR                           15060000
150700          END-EVALUATE                                            15070000
150800     END-PERFORM.                                                 15080000
150900                                                                  15090000
151000     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         15100000
151100         DISPLAY 'MAX RETRIES EXCEEDED IN 7300-GET-EVNT-CAL-DTE'  15110000
151200         MOVE '7300-GET-EVNT-CAL-DTE' TO PV-PARAGRAPH-NAME        15120000
151300         MOVE 'MAX RETRIES EXCEEDED IN SELECT FROM TDTATTR'       15130064
151400                              TO  PV-ORA-OPERATION                15140000
151500         PERFORM 9700-ORA-ERROR                                   15150000
151600     END-IF.                                                      15160000
151700                                                                  15170000
151800*3100-EXIT.  EXIT.                                                15180000
151900******************************************************************15190000
152000*  ROUTINE TO GET CALENDAR DATE FOR EVENT WITH OLD FORMAT NAME   *15200000
152100******************************************************************15210000
152200 3150-GET-EVNT-CAL-DTE.                                           15220000
152300     MOVE '3150-GET-EVNT-CAL-DTE           ' TO PV-PARAGRAPH-NAME.15230000
152400     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          15240000
152500                                                                  15250000
152600     PERFORM                                                      15260000
152700         WITH TEST AFTER                                          15270000
152800         VARYING PV-SQL-SUB                                       15280000
152900         FROM 1 BY 1                                              15290000
153000         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 15300000
153100                   OR  SQLCODE = 0                                15310000
153200                   OR  SQLCODE = +1403 )                          15320000
153300                                                                  15330000
153400         PERFORM 7350-SELECT-EVNT-CAL-DTE                         15340000
153500                                                                  15350000
153600         EVALUATE TRUE                                            15360000
153700             WHEN SQLCODE = 0                                     15370000
153800                 CONTINUE                                         15380000
153900             WHEN SQLCODE = + 1403                                15390000
154000                 SET PV-ERR-TYP-BAD-CSV-DATE-NAME TO TRUE         15400000
154100                 SET PS-CSV-ERROR-FOUND           TO TRUE         15410000
154200                 SET PS-CSV-RCD-ERROR-FOUND       TO TRUE         15420000
154300                 MOVE PV-EVNT-CSV-NM-OLD-STYLE    TO PV-DATA-ITEM 15430000
154400                 PERFORM 8300-BUILD-ERR-RECORD                    15440000
154500             WHEN OTHER                                           15450000
154600                 DISPLAY ' '                                      15460000
154700                 DISPLAY 'ORACLE ERROR - 7350-SELECT-EVNT-CAL-DTE'15470000
154800                 DISPLAY 'FSCL YR   > ' DTATTR-FSCL-YR-NBR        15480000
154900                       ', CAL MON   > ' DTATTR-CAL-MN-NBR         15490000
155000                       ', WK-IN-MN  > ' DTATTR-WK-IN-MN-NBR       15500000
155100                 MOVE '7350-SELECT-EVNT-CAL-DTE'                  15510000
155200                                         TO PV-PARAGRAPH-NAME     15520000
155300                 MOVE 'SELECT TDTATTR - FY, CAL MN, WK IN MN'     15530064
155400                                    TO PV-ORA-OPERATION           15540000
155500                 PERFORM 9700-ORA-ERROR                           15550000
155600         END-EVALUATE                                             15560000
155700     END-PERFORM.                                                 15570000
155800                                                                  15580000
155900     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        15590000
156000         DISPLAY 'MAX RETRIES EXCEEDED - 7350-SELECT-EVNT-CAL-DTE'15600000
156100         MOVE '7350-SELECT-EVNT-CAL-DTE' TO PV-PARAGRAPH-NAME     15610000
156200         MOVE 'SELECT FROM TDTATTR FOR FSCL YR & WK'              15620064
156300                              TO  PV-ORA-OPERATION                15630000
156400         PERFORM 9700-ORA-ERROR                                   15640000
156500     END-IF.                                                      15650000
156600                                                                  15660000
156700*3150-EXIT.  EXIT.                                                15670000
156800******************************************************************15680000
156900*     SEARCH FOR DATE DELIMITERS                                 *15690000
157000******************************************************************15700000
157100 4000-DATE-DELIMIT.                                               15710000
157200     MOVE '4000-DATE-DELIMIT               ' TO PV-PARAGRAPH-NAME.15720000
157300     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          15730000
157400                                                                  15740000
157500*****TEST ONLY                                                    15750000
157600*    DISPLAY 'DATE CELL ARRAY>' PV-DATE-CELL-ARRAY                15760000
157700*            ', CLR-MKDN-CDE: ' CLR-MKDN-CDE  IN PET00001.        15770000
157800*****TEST ONLY                                                    15780000
157900                                                                  15790000
158000     SET PS-NOT-LAST-DASH-PROCESSED TO TRUE.                      15800000
158100                                                                  15810000
158200     SEARCH PV-DCA-ELEMENT                                        15820000
158300       AT END                                                     15830000
158400         PERFORM 4100-PROCESS-DATE                                15840000
158500     WHEN PV-DCA-ELEMENT(PV-DCEDEX1) = '-'                        15850000
158600*****TEST ONLY                                                    15860000
158700*    SET PV-DISPLAY-INDEX          TO PV-DCEDEX1                  15870000
158800*    DISPLAY 'DASH FOUND AT ' PV-DISPLAY-INDEX                    15880000
158900*****TEST ONLY                                                    15890000
159000         PERFORM 4100-PROCESS-DATE                                15900000
159100           UNTIL PS-LAST-DATE-PROCESSED.                          15910000
159200                                                                  15920000
159300*4000-EXIT.  EXIT.                                                15930000
159400******************************************************************15940000
159500*     FIND MONTH/DAY DELIMITER AND BUILD DATE                    *15950000
159600******************************************************************15960000
159700 4100-PROCESS-DATE.                                               15970000
159800     MOVE '4100-PROCESS-DATE               ' TO PV-PARAGRAPH-NAME.15980000
159900     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          15990000
160000                                                                  16000000
160100     SET PV-DCEDEX1                UP BY 1.                       16010000
160200     SET PS-VALID-DATE-FMT         TO TRUE.                       16020000
160300                                                                  16030000
160400     PERFORM                                                      16040000
160500      VARYING PV-DCEDEX2 FROM PV-DCEDEX1 BY -1                    16050000
160600        UNTIL PV-DCA-ELEMENT(PV-DCEDEX2) = '/'                    16060000
160700           OR PV-DCEDEX2              = 1                         16070000
160800                                                                  16080000
160900        MOVE ' '                   TO PV-SPACE                    16090000
161000                                                                  16100000
161100     END-PERFORM.                                                 16110000
161200                                                                  16120000
161300     IF  PV-DCEDEX2                 = 1                           16130000
161400         DISPLAY 'INVALID DATE FORMAT ' PV-DATE-CELL-ARRAY        16140000
161500         DISPLAY 'IN 4100-PROCESS-DATE'                           16150000
161600         DISPLAY 'RECORD IN>' EVENT-RECORD                        16160000
161700         MOVE 'ATTEMPTING TO REFORMAT A DATE'                     16170000
161800                                     TO PV-OPERATION-MSG-1        16180000
161900         SET  PV-ERR-TYP-BAD-DATE-FMT TO TRUE                     16190000
162000         SET  PS-INVALID-DATE-FMT     TO TRUE                     16200000
162100         SET  PS-CSV-ERROR-FOUND      TO TRUE                     16210000
162200         SET  PS-CSV-RCD-ERROR-FOUND  TO TRUE                     16220000
162300         MOVE PV-DATE-CELL-ARRAY      TO PV-DATA-ITEM             16230000
162400         PERFORM 8300-BUILD-ERR-RECORD                            16240000
162500     END-IF.                                                      16250000
162600                                                                  16260000
162700     SET PV-HOLD-INDEX-1 TO PV-DCEDEX1.                           16270000
162800                                                                  16280000
162900     IF  PS-VALID-DATE-FMT                                        16290000
1020ML         IF PS-CURRENT-EVENT-NO-OVERRIDE                          16291067
163000             PERFORM 6100-DATE-CONVERSION-ROUTINE                 16300067
1020ML         ELSE                                                     16301067
1020ML             PERFORM 6105-DATE-CONV-OVRD-ROUTINE                  16302069
1020ML         END-IF                                                   16303068
163100     END-IF.                                                      16310000
163200                                                                  16320000
163300     SET PV-DCEDEX1 TO PV-HOLD-INDEX-1.                           16330000
163400                                                                  16340000
163500     IF  PV-DCA-ELEMENT(PV-DCEDEX1 - 1) = '-'                     16350000
163600         MOVE PV-DCA-DATE        TO CLR-FRST-EFF-DTE  IN PET00001 16360000
163700                                    PV-CMER-CLR-FRST-EFF-DTE      16370000
163800         PERFORM 4200-GET-NEXT-DATE                               16380000
163900           UNTIL PS-LAST-DASH-PROCESSED                           16390000
164000         MOVE PV-DCA-DATE        TO CLR-LAST-EFF-DTE  IN PET00001 16400000
164100                                    PV-CMER-CLR-LAST-EFF-DTE      16410000
164200*    CHECK FOR DATE RANGE ERROR                                   16420000
164300         IF PV-CMER-CLR-FRST-EFF-DTE > PV-CMER-CLR-LAST-EFF-DTE   16430000
164400            PERFORM 6400-INVALID-DATE-INPUT                       16440000
164500         END-IF                                                   16450000
164600     ELSE                                                         16460000
164700         MOVE PV-DCA-DATE        TO CLR-FRST-EFF-DTE  IN PET00001 16470000
164800                                    CLR-LAST-EFF-DTE  IN PET00001 16480000
164900                                    PV-CMER-CLR-FRST-EFF-DTE      16490000
165000                                    PV-CMER-CLR-LAST-EFF-DTE      16500000
165100     END-IF.                                                      16510000
165200                                                                  16520000
165300     SET PS-LAST-DATE-PROCESSED TO TRUE.                          16530000
165400                                                                  16540000
165500*4100-EXIT.  EXIT.                                                16550000
165600******************************************************************16560000
165700*     GET ADDITIONAL DATES IN CELL                               *16570000
165800******************************************************************16580000
165900 4200-GET-NEXT-DATE.                                              16590000
166000     MOVE '4200-GET-NEXT-DATE              ' TO PV-PARAGRAPH-NAME.16600000
166100*    DISPLAY PV-PARAGRAPH-NAME.                                   16610000
166200                                                                  16620000
166300     SET PV-DCEDEX3                TO PV-DCEDEX1.                 16630000
166400     SET PV-DCEDEX1                UP BY 1.                       16640000
166500*                                                                 16650000
166600     SEARCH PV-DCA-ELEMENT                                        16660000
166700       AT END                                                     16670000
166800*****TEST ONLY                                                    16680000
166900*        DISPLAY 'AT END'                                         16690000
167000         SET  PS-LAST-DASH-PROCESSED TO TRUE                      16700000
167100         CONTINUE                                                 16710000
167200*****TEST ONLY                                                    16720000
167300     WHEN PV-DCA-ELEMENT(PV-DCEDEX1) = '-'                        16730000
167400*****TEST ONLY                                                    16740000
167500         SET PV-DISPLAY-INDEX      TO PV-DCEDEX1                  16750000
167600*        DISPLAY 'DASH FOUND AT - LOC2 ' PV-DISPLAY-INDEX         16760000
167700*****TEST ONLY                                                    16770000
167800         CONTINUE.                                                16780000
167900                                                                  16790000
168000     PERFORM                                                      16800000
168100      VARYING PV-DCEDEX2 FROM PV-DCEDEX1 BY -1                    16810000
168200        UNTIL PV-DCA-ELEMENT(PV-DCEDEX2) = '/'                    16820000
168300           OR PV-DCEDEX2              = 1                         16830000
168400                                                                  16840000
168500        MOVE ' '                   TO PV-SPACE                    16850000
168600                                                                  16860000
168700     END-PERFORM.                                                 16870000
168800                                                                  16880000
168900     IF  PV-DCEDEX2                 = 1                           16890000
169000         DISPLAY 'INVALID DATE FORMAT ' PV-DATE-CELL-ARRAY        16900000
169100         DISPLAY 'IN 4200-GET-NEXT-DATE'                          16910000
169200         MOVE 'ATTEMPTING TO REFORMAT A DATE'                     16920000
169300                                     TO PV-OPERATION-MSG-1        16930000
169400         SET AC-4444-NON-ORA-ERROR   TO TRUE                      16940000
169500         SET PV-ERR-TYP-BAD-DATE-FMT TO TRUE                      16950000
169600         SET PS-INVALID-DATE-FMT     TO TRUE                      16960000
169700         SET PS-CSV-ERROR-FOUND      TO TRUE                      16970000
169800         SET PS-CSV-RCD-ERROR-FOUND  TO TRUE                      16980000
169900         MOVE PV-DATE-CELL-ARRAY     TO PV-DATA-ITEM              16990000
170000         PERFORM 8300-BUILD-ERR-RECORD                            17000000
170100     END-IF.                                                      17010000
170200                                                                  17020000
1020ML     IF PS-CURRENT-EVENT-NO-OVERRIDE                              17021067
170300         PERFORM 6100-DATE-CONVERSION-ROUTINE                     17030067
1020ML     ELSE                                                         17031067
1020ML         PERFORM 6105-DATE-CONV-OVRD-ROUTINE                      17032069
1020ML     END-IF.                                                      17033067
170400                                                                  17040000
170500*4200-EXIT.  EXIT.                                                17050000
170600******************************************************************17060000
170700*   4300-EXPAND-EVNT-NM inserts spaces into Event names           17070000
170800*      Result:  'Event 1'   becomes 'Event   1'                   17080000
170900*       and     'Event 23a' becomes 'Event  23a'                  17090000
171000*      - this facilitates Event selection by the Actuals process  17100000
171100******************************************************************17110000
171200 4300-EXPAND-EVNT-NM.                                             17120000
171300     MOVE '4300-EXPAND-EVNT-NM           ' TO PV-PARAGRAPH-NAME.  17130000
171400     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          17140000
171500                                                                  17150000
171600     MOVE PV-CER-CLR-EVNT-NM(1:5)    TO PV-EVNT-ID-EXP-EVENT.     17160000
171700     COMPUTE PV-UC-B-LENGTH = FUNCTION LENGTH(PV-UC-B)            17170000
171800     PERFORM UNTIL PV-UC-B(PV-UC-B-LENGTH:1) NOT EQUAL SPACES     17180000
171900         SUBTRACT 1 FROM PV-UC-B-LENGTH                           17190000
172000     END-PERFORM.                                                 17200000
172100     IF PV-UC-B(PV-UC-B-LENGTH:1) NOT NUMERIC                     17210000
172200         MOVE PV-UC-B(1:PV-UC-B-LENGTH - 1) TO PV-EVNT-ID-EXP-ID  17220000
172300         MOVE PV-UC-B(PV-UC-B-LENGTH:1)   TO PV-EVNT-ID-EXP-ALPHA 17230000
172400     ELSE                                                         17240000
172500         MOVE PV-UC-B(1:PV-UC-B-LENGTH)   TO PV-EVNT-ID-EXP-ID    17250000
172600         MOVE SPACES                      TO PV-EVNT-ID-EXP-ALPHA 17260000
172700     END-IF.                                                      17270000
172800                                                                  17280000
172900     MOVE PV-EVNT-ID-EXP-EVENT TO UC-WHOLE-AREA.                  17290000
173000     PERFORM 4400-UC-AREA-CASE-TRANS.                             17300000
173100     MOVE UC-WHOLE-AREA TO PV-EVNT-ID-EXP-EVENT.                  17310000
173200                                                                  17320000
173300     IF PV-EVNT-ID-EXP-EVENT = 'EVENT'                            17330000
173400        MOVE 'Event' TO PV-EVNT-ID-EXP-EVENT.                     17340000
173500                                                                  17350000
173600     MOVE PV-EVNT-NAME-EXPANDED     TO PA905-CLR-EVNT-NM.         17360000
173700                                                                  17370000
173800*4300-EXIT.  EXIT.                                                17380000
173900******************************************************************17390000
174000*     UC AREA CASE TRANSLATE                                     *17400000
174100******************************************************************17410000
174200 4400-UC-AREA-CASE-TRANS.                                         17420000
174300      SET TABLE-LOW-INDEX, TABLE-HIGH-INDEX TO 1.                 17430000
174400      PERFORM 4500-UC-AREAS-INSPECT 26 TIMES.                     17440000
174500                                                                  17450000
174600*4400-EXIT.  EXIT.                                                17460000
174700******************************************************************17470000
174800*     PV UC AREA INSPECT                                         *17480000
174900******************************************************************17490000
175000 4500-UC-AREAS-INSPECT.                                           17500000
175100      INSPECT UC-AREA-ELEMENT                                     17510000
175200          REPLACING ALL TT-TRANS-TABLE-LOW-BITE(TABLE-LOW-INDEX)  17520000
175300                    BY TT-TRANS-TABLE-HIGH-BITE(TABLE-HIGH-INDEX).17530000
175400      SET TABLE-LOW-INDEX, TABLE-HIGH-INDEX UP BY 1.              17540000
175500                                                                  17550000
175600*4500-EXIT.  EXIT.                                                17560000
175700******************************************************************17570000
175800*     CONVERT ANY 10 CHARACTER LEFT JUSTIFIED STRING TO A        *17580000
175900*     10 CHARACTER RIGHT JUSTIFIED NUMBER.                       *17590000
176000******************************************************************17600000
176100 6000-CONVERT-TO-NUMBER.                                          17610000
176200     MOVE '6000-CONVERT-TO-NUMBER          ' TO PV-PARAGRAPH-NAME.17620000
176300     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          17630000
176400                                                                  17640000
176500*****TEST ONLY                                                    17650000
176600*    DISPLAY 'UNCONVERTED NUMBER>' PV-VA1-ELEMENT.                17660000
176700*****TEST ONLY                                                    17670000
176800     MOVE SPACES                   TO PV-VA2-ELEMENT.             17680000
176900                                                                  17690000
177000     PERFORM                                                      17700000
177100       VARYING PV-VA1ENDDEX FROM 20 BY -1                         17710000
177200         UNTIL PV-VA1-BYTE(PV-VA1ENDDEX) NOT = SPACE              17720000
177300                                                                  17730000
177400       MOVE ' '                    TO PV-SPACE                    17740000
177500                                                                  17750000
177600     END-PERFORM.                                                 17760000
177700                                                                  17770000
177800     SET PV-VA1BEGDEX              TO PV-VA1ENDDEX.               17780000
177900     SET PV-VA2ENDDEX              TO 20.                         17790000
178000                                                                  17800000
178100     PERFORM                                                      17810000
178200       VARYING PV-VA1CURDEX FROM PV-VA1BEGDEX BY -1               17820000
178300         UNTIL PV-VA1CURDEX        < 1                            17830000
178400            OR PV-VA1-BYTE(PV-VA1CURDEX) NOT NUMERIC              17840000
178500                                                                  17850000
178600       MOVE PV-VA1-BYTE(PV-VA1CURDEX) TO                          17860000
178700            PV-VA2-BYTE(PV-VA2ENDDEX)                             17870000
178800       SET PV-VA2ENDDEX            DOWN BY 1                      17880000
178900                                                                  17890000
179000     END-PERFORM.                                                 17900000
179100                                                                  17910000
179200     INSPECT PV-VA2-ELEMENT REPLACING ALL SPACES BY ZEROS.        17920000
179300*****TEST ONLY                                                    17930000
179400*    DISPLAY 'CONVERTED NUMBER>' PV-VA2-ELEMENT.                  17940000
179500*****TEST ONLY                                                    17950000
179600                                                                  17960000
179700*6000-EXIT.  EXIT.                                                17970000
179800******************************************************************17980000
179900*     DATE CONVERSION ROUTINE                                    *17990000
180000******************************************************************18000000
180100 6100-DATE-CONVERSION-ROUTINE.                                    18010000
180200     MOVE '6100-DATE-CONVERSION-ROUTINE    ' TO PV-PARAGRAPH-NAME.18020000
180300     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          18030000
180400                                                                  18040000
180500     SET PV-HOLD-INDEX-2 TO PV-DCEDEX2.                           18050000
180600     SET PV-HOLD-INDEX-1 TO PV-DCEDEX1.                           18060000
180700                                                                  18070000
180800     PERFORM 6150-CHECK-SLASHES-ONLY.                             18080000
180900     PERFORM 6160-CHECK-DASHES-ONLY.                              18090000
181000                                                                  18100000
181100     SET PV-DCEDEX2 TO PV-HOLD-INDEX-2.                           18110000
181200     SET PV-DCEDEX1 TO PV-HOLD-INDEX-1.                           18120000
181300                                                                  18130000
181400     IF (PV-SLASH-COUNT = 2 AND PV-DASH-COUNT = 0)                18140000
181500         PERFORM 6170-CONVERT-INVALID-DATE                        18150000
181600     ELSE                                                         18160000
181700***** CONVERT DAY PORTION OF DATE                                 18170000
181800        IF PV-DCA-ELEMENT(PV-DCEDEX2 + 2) = SPACE                 18180000
181900                                         OR '-'                   18190000
182000           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 1) TO PV-DCA-DA(2:1)  18200000
182100           MOVE '0'                            TO PV-DCA-DA(1:1)  18210000
182200        ELSE                                                      18220000
182300           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 1) TO PV-DCA-DA(1:1)  18230000
182400           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 2) TO PV-DCA-DA(2:1)  18240000
182500        END-IF                                                    18250000
182600                                                                  18260000
182700***** CONVERT MONTH PORTION OF DATE                               18270000
182800        IF PV-DCA-ELEMENT(PV-DCEDEX2 - 2) = SPACE                 18280000
182900                                         OR '/'                   18290000
183000                                         OR '-'                   18300000
183100           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 - 1) TO PV-DCA-MM(2:1)  18310000
183200           MOVE '0'                            TO PV-DCA-MM(1:1)  18320000
183300        ELSE                                                      18330000
183400           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 - 2) TO PV-DCA-MM(1:1)  18340000
183500           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 - 1) TO PV-DCA-MM(2:1)  18350000
183600        END-IF                                                    18360000
183700                                                                  18370000
183800***** ROLL YEAR LOGIC                                             18380000
      *****   FISCAL YEAR IS PASSED IN BUT A CALENDAR YEAR IS NEEDED.   18381055
      *****   THE LOGIC BELOW APPEARS TO INCREMENT THE FISCAL YEAR BY   18382055
      *****   CHECKING FOR CARRY OVERS ON NON FIRST MARKS(EX: DEC ->    18383055
      *****   MARCH FOR THE SECOND MARK) AND MONTHS THAT HAVE DIFFERENT 18384055
      *****   FISCAL THAN CALENDAR YEARS (EX: JAN 15 11 IS FALL 2010)   18385055
183900       IF PV-CLR-MKDN-CDE   = '1'                                 18390000
184000          IF PV-HOLD-MM-1   = '00'                                18400000
184100             MOVE PV-DCA-MM TO PV-HOLD-MM-1                       18410000
184200          END-IF                                                  18420000
184300          MOVE PV-DCA-YEAR-1  TO PV-DCA-YEAR-NUM                  18430055
184400          IF PS-EVNT-SEA-FALL                                     18440055
184500          AND PV-DCA-MM < '07'                                    18450055
184600             ADD  1              TO PV-DCA-YEAR-NUM               18460055
184700          END-IF                                                  18470055
184800          MOVE PV-DCA-MM            TO PV-HOLD-MM-1               18480055
185100*         DISPLAY 'PV-DCA-DATE 1 > ' PV-DCA-DATE                  18510000
185200       END-IF                                                     18520000
185300                                                                  18530000
185400       IF PV-CLR-MKDN-CDE   = '2'                                 18540000
185500          IF PV-HOLD-MM-2   = '00'                                18550000
185600             MOVE PV-DCA-MM TO PV-HOLD-MM-2                       18560000
185700          END-IF                                                  18570000
185800          MOVE PV-DCA-YEAR-2  TO PV-DCA-YEAR-NUM                  18580055
185900          IF PS-EVNT-SEA-FALL                                     18590055
186000          AND PV-DCA-MM < '08'                                    18600055
186100             IF PV-DCA-MM < '07'                                  18610055
186200             OR PV-HOLD-MM-1 NOT = '07'                           18620055
186300                ADD  1              TO PV-DCA-YEAR-NUM            18630055
186400             END-IF                                               18640055
186500          END-IF                                                  18650055
                MOVE PV-DCA-MM            TO PV-HOLD-MM-2               18651055
186600*         DISPLAY 'PV-DCA-DATE 2 > ' PV-DCA-DATE                  18660000
186700       END-IF                                                     18670000
186800                                                                  18680000
186900       IF PV-CLR-MKDN-CDE   = '3'                                 18690005
187000          IF PV-HOLD-MM-3   = '00'                                18700005
187100             MOVE PV-DCA-MM TO PV-HOLD-MM-3                       18710005
187200          END-IF                                                  18720000
187300          MOVE PV-DCA-YEAR-3  TO PV-DCA-YEAR-NUM                  18730055
187400          IF PS-EVNT-SEA-FALL                                     18740055
187500          AND PV-DCA-MM < '08'                                    18750055
187600             IF PV-DCA-MM < '07'                                  18760055
187700             OR PV-HOLD-MM-1 NOT = '07'                           18770055
187800                ADD  1              TO PV-DCA-YEAR-NUM            18780055
187900             END-IF                                               18790055
188000          END-IF                                                  18800055
                MOVE PV-DCA-MM            TO PV-HOLD-MM-3               18801055
188100*         DISPLAY 'PV-DCA-DATE 3 > ' PV-DCA-DATE                  18810005
188200       END-IF                                                     18820000
186800                                                                  18821005
186900       IF PV-CLR-MKDN-CDE   = '4'                                 18822005
187000          IF PV-HOLD-MM-4   = '00'                                18823005
187100             MOVE PV-DCA-MM TO PV-HOLD-MM-4                       18824005
187200          END-IF                                                  18825005
187300          MOVE PV-DCA-YEAR-4  TO PV-DCA-YEAR-NUM                  18826055
187400          IF PS-EVNT-SEA-FALL                                     18827055
187500          AND PV-DCA-MM < '08'                                    18828055
187600             IF PV-DCA-MM < '07'                                  18829055
187700             OR PV-HOLD-MM-1 NOT = '07'                           18829155
187800                ADD  1              TO PV-DCA-YEAR-NUM            18829255
187900             END-IF                                               18829355
188000          END-IF                                                  18829455
                MOVE PV-DCA-MM            TO PV-HOLD-MM-4               18829555
188100*         DISPLAY 'PV-DCA-DATE 4 > ' PV-DCA-DATE                  18829605
188200       END-IF                                                     18829705
186800                                                                  18829805
186900       IF PV-CLR-MKDN-CDE   = '5'                                 18829905
187000          IF PV-HOLD-MM-5   = '00'                                18830005
187100             MOVE PV-DCA-MM TO PV-HOLD-MM-5                       18830105
187200          END-IF                                                  18830205
187300          MOVE PV-DCA-YEAR-5  TO PV-DCA-YEAR-NUM                  18830355
187400          IF PS-EVNT-SEA-FALL                                     18830455
187500          AND PV-DCA-MM < '08'                                    18830555
187600             IF PV-DCA-MM < '07'                                  18830655
187700             OR PV-HOLD-MM-1 NOT = '07'                           18830755
187800                ADD  1              TO PV-DCA-YEAR-NUM            18830855
187900             END-IF                                               18830955
188000          END-IF                                                  18831055
                MOVE PV-DCA-MM            TO PV-HOLD-MM-5               18831155
188100*         DISPLAY 'PV-DCA-DATE 5 > ' PV-DCA-DATE                  18831205
188200       END-IF                                                     18831305
186800                                                                  18831405
186900       IF PV-CLR-MKDN-CDE   = '6'                                 18831505
187000          IF PV-HOLD-MM-6   = '00'                                18831605
187100             MOVE PV-DCA-MM TO PV-HOLD-MM-6                       18831705
187200          END-IF                                                  18831805
187300          MOVE PV-DCA-YEAR-6  TO PV-DCA-YEAR-NUM                  18831955
187400          IF PS-EVNT-SEA-FALL                                     18832055
187500          AND PV-DCA-MM < '08'                                    18832155
187600             IF PV-DCA-MM < '07'                                  18832255
187700             OR PV-HOLD-MM-1 NOT = '07'                           18832355
187800                ADD  1              TO PV-DCA-YEAR-NUM            18832455
187900             END-IF                                               18832555
188000          END-IF                                                  18832655
                MOVE PV-DCA-MM            TO PV-HOLD-MM-6               18832755
188100*         DISPLAY 'PV-DCA-DATE 6 > ' PV-DCA-DATE                  18832805
188200       END-IF                                                     18832905
188300                                                                  18833005
188400       IF PV-CLR-MKDN-CDE   = 'O'                                 18840000
188500          IF PV-HOLD-MM-O   = '00'                                18850000
188600             MOVE PV-DCA-MM TO PV-HOLD-MM-O                       18860000
188700          END-IF                                                  18870000
188800          MOVE PV-DCA-YEAR-O  TO PV-DCA-YEAR-NUM                  18880055
188900          IF PS-EVNT-SEA-FALL                                     18890055
189000          AND PV-DCA-MM < '08'                                    18900055
189100             IF PV-DCA-MM < '07'                                  18910055
189200             OR PV-HOLD-MM-1 NOT = '07'                           18920055
189300                ADD  1              TO PV-DCA-YEAR-NUM            18930055
189400             END-IF                                               18940055
189500          END-IF                                                  18950055
189600*         DISPLAY 'PV-DCA-DATE O > ' PV-DCA-DATE                  18960000
189700       END-IF                                                     18970000
189800       PERFORM 6300-VALIDATE-DATE-INPUT                           18980000
189900     END-IF.                                                      18990000
190000                                                                  19000000
190100*6100-EXIT.  EXIT.                                                19010000
1020ML******************************************************************19011067
1020ML*     DATE CONVERSION ROUTINE - OVERRIDE                         *19012067
1020ML*     The original program assumed no events would span more than*19012167
1020ML*     3 seasons so this method is an override for longer events  *19012267
1020ML*     This has risk of human error like 1/5, 1/4, 1/7 being made *19012367
1020ML*     into multiple years so this is only done for overrides     *19012467
1020ML******************************************************************19013067
1020ML 6105-DATE-CONV-OVRD-ROUTINE.                                     19014069
1020ML     MOVE '6105-DATE-CONV-OVRD-ROUTINE     ' TO PV-PARAGRAPH-NAME.19015069
1020ML     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          19016067
1020ML                                                                  19017067
1020ML     SET PV-HOLD-INDEX-2 TO PV-DCEDEX2.                           19018067
1020ML     SET PV-HOLD-INDEX-1 TO PV-DCEDEX1.                           19019067
1020ML                                                                  19019167
1020ML     PERFORM 6150-CHECK-SLASHES-ONLY.                             19019267
1020ML     PERFORM 6160-CHECK-DASHES-ONLY.                              19019367
1020ML                                                                  19019467
1020ML     SET PV-DCEDEX2 TO PV-HOLD-INDEX-2.                           19019567
1020ML     SET PV-DCEDEX1 TO PV-HOLD-INDEX-1.                           19019667
1020ML                                                                  19019767
1020ML     IF (PV-SLASH-COUNT = 2 AND PV-DASH-COUNT = 0)                19019867
1020ML         PERFORM 6170-CONVERT-INVALID-DATE                        19019967
1020ML     ELSE                                                         19020067
1020ML***** CONVERT DAY PORTION OF DATE                                 19020167
1020ML        IF PV-DCA-ELEMENT(PV-DCEDEX2 + 2) = SPACE                 19020267
1020ML                                         OR '-'                   19020367
1020ML           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 1) TO PV-DCA-DA(2:1)  19020467
1020ML           MOVE '0'                            TO PV-DCA-DA(1:1)  19020567
1020ML        ELSE                                                      19020667
1020ML           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 1) TO PV-DCA-DA(1:1)  19020767
1020ML           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 2) TO PV-DCA-DA(2:1)  19020867
1020ML        END-IF                                                    19020967
1020ML                                                                  19021067
1020ML***** CONVERT MONTH PORTION OF DATE                               19021167
1020ML        IF PV-DCA-ELEMENT(PV-DCEDEX2 - 2) = SPACE                 19021267
1020ML                                         OR '/'                   19021367
1020ML                                         OR '-'                   19021467
1020ML           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 - 1) TO PV-DCA-MM(2:1)  19021567
1020ML           MOVE '0'                            TO PV-DCA-MM(1:1)  19021667
1020ML        ELSE                                                      19021767
1020ML           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 - 2) TO PV-DCA-MM(1:1)  19021867
1020ML           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 - 1) TO PV-DCA-MM(2:1)  19021967
1020ML        END-IF                                                    19022067
1020ML                                                                  19022167
1020ML***** ROLL YEAR LOGIC                                             19022267
      *****   FISCAL YEAR IS PASSED IN BUT A CALENDAR YEAR IS NEEDED.   19022367
      *****   THE LOGIC BELOW APPEARS TO INCREMENT THE FISCAL YEAR BY   19022467
      *****   CHECKING FOR CARRY OVERS ON NON FIRST MARKS(EX: DEC ->    19022567
      *****   MARCH FOR THE SECOND MARK) AND MONTHS THAT HAVE DIFFERENT 19022667
      *****   FISCAL THAN CALENDAR YEARS (EX: JAN 15 11 IS FALL 2010)   19022767
1020ML       IF PV-CLR-MKDN-CDE   = '1'                                 19022867
1020ML          MOVE PV-DCA-YEAR-1  TO PV-DCA-YEAR-NUM                  19023267
1020ML          IF PS-EVNT-SEA-FALL                                     19023367
1020ML          AND PV-DCA-MM < '07'                                    19023467
1020ML             ADD  1              TO PV-DCA-YEAR-NUM               19023567
1020ML          END-IF                                                  19023667
1020ML          MOVE PV-DCA-MM       TO PV-PRIOR-MM                     19023767
1020ML          MOVE PV-DCA-YEAR-NUM TO PV-PRIOR-YEAR                   19023867
1020ML       ELSE                                                       19024067
1020ML          IF PV-DCA-MM < PV-PRIOR-MM                              19024167
1020ML             ADD  1              TO PV-PRIOR-YEAR                 19024267
1020ML          END-IF                                                  19024367
1020ML          MOVE PV-PRIOR-YEAR TO PV-DCA-YEAR-NUM                   19024467
1020ML          MOVE PV-DCA-MM TO PV-PRIOR-MM                           19024567
1020ML       END-IF                                                     19024667
1020ML                                                                  19024767
1020ML*      DISPLAY 'PV-DCA-DATE ' PV-CLR-MKDN-CDE                     19024867
1020ML*      DISPLAY 'PV-DCA-DATE ' PV-DCA-DATE                         19024967
1020ML                                                                  19025067
1020ML       PERFORM 6300-VALIDATE-DATE-INPUT                           19033567
1020ML     END-IF.                                                      19033667
1020ML                                                                  19033767
1020ML*6105-EXIT.  EXIT.                                                19033867
190200******************************************************************19033900
190300*     CHECK FOR SLASHES ONLY                                     *19034000
190400******************************************************************19040000
190500 6150-CHECK-SLASHES-ONLY.                                         19050000
190600     MOVE '6150-CHECK-SLASHES-ONLY       ' TO PV-PARAGRAPH-NAME.  19060000
190700                                                                  19070000
190800     MOVE ZEROS TO PV-SLASH-COUNT.                                19080000
190900                                                                  19090000
191000     SET PV-DCEDEX1                UP BY 1.                       19100000
191100     SET PS-VALID-DATE-FMT         TO TRUE.                       19110000
191200                                                                  19120000
191300     PERFORM                                                      19130000
191400      VARYING PV-DCEDEX2 FROM PV-DCEDEX1 BY -1                    19140000
191500        UNTIL PV-DCEDEX2              = 1                         19150000
191600                                                                  19160000
191700        IF PV-DCA-ELEMENT(PV-DCEDEX2) = '/'                       19170000
191800           ADD +1 TO PV-SLASH-COUNT                               19180000
191900        END-IF                                                    19190000
192000     END-PERFORM.                                                 19200000
192100                                                                  19210000
192200*6150-EXIT.  EXIT.                                                19220000
192300******************************************************************19230000
192400*     CHECK FOR DASHES ONLY                                      *19240000
192500******************************************************************19250000
192600 6160-CHECK-DASHES-ONLY.                                          19260000
192700     MOVE '6160-CHECK-DASHES-ONLY        ' TO PV-PARAGRAPH-NAME.  19270000
192800                                                                  19280000
192900     MOVE ZEROS TO PV-DASH-COUNT.                                 19290000
193000                                                                  19300000
193100     SET PV-DCEDEX1                UP BY 1.                       19310000
193200     SET PS-VALID-DATE-FMT         TO TRUE.                       19320000
193300                                                                  19330000
193400     PERFORM                                                      19340000
193500      VARYING PV-DCEDEX2 FROM PV-DCEDEX1 BY -1                    19350000
193600        UNTIL PV-DCEDEX2              = 1                         19360000
193700                                                                  19370000
193800        IF PV-DCA-ELEMENT(PV-DCEDEX2) = '-'                       19380000
193900           ADD +1 TO PV-DASH-COUNT                                19390000
194000        END-IF                                                    19400000
194100     END-PERFORM.                                                 19410000
194200                                                                  19420000
194300*6160-EXIT.  EXIT.                                                19430000
194400******************************************************************19440000
194500*     CONVERT INVALID DATE                                        19450000
194600******************************************************************19460000
194700 6170-CONVERT-INVALID-DATE.                                       19470000
194800     MOVE '6170-CONVERT-INVALID-DATE       ' TO PV-PARAGRAPH-NAME.19480000
194900     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          19490000
195000                                                                  19500000
195100***** CONVERT DAY PORTION OF DATE                                 19510000
195200     IF PV-DCA-ELEMENT(PV-DCEDEX2 - 2) = SPACE                    19520000
195300                                      OR '-'                      19530000
195400        MOVE PV-DCA-ELEMENT(PV-DCEDEX2 - 1) TO PV-DCA-DA(2:1)     19540000
195500        MOVE '0'                            TO PV-DCA-DA(1:1)     19550000
195600     ELSE                                                         19560000
195700        MOVE PV-DCA-ELEMENT(PV-DCEDEX2 - 2) TO PV-DCA-DA(1:1)     19570000
195800        MOVE PV-DCA-ELEMENT(PV-DCEDEX2 - 1) TO PV-DCA-DA(2:1)     19580000
195900     END-IF.                                                      19590000
196000                                                                  19600000
196100***** CONVERT MONTH PORTION OF DATE                               19610000
196200     IF PV-DCA-ELEMENT(PV-DCEDEX2 - 5) = SPACE                    19620000
196300*                                     OR '/'                      19630000
196400        MOVE PV-DCA-ELEMENT(PV-DCEDEX2 - 4) TO PV-DCA-MM(2:1)     19640000
196500        MOVE '0'                            TO PV-DCA-MM(1:1)     19650000
196600     ELSE                                                         19660000
196700        MOVE PV-DCA-ELEMENT(PV-DCEDEX2 - 5) TO PV-DCA-MM(1:1)     19670000
196800        MOVE PV-DCA-ELEMENT(PV-DCEDEX2 - 4) TO PV-DCA-MM(2:1)     19680000
196900     END-IF.                                                      19690000
197000                                                                  19700000
197100***** CONVERT YEAR PORTION OF DATE                                19710000
197200     IF PV-CLR-MKDN-CDE   = '1'                                   19720000
197300        MOVE PV-DCA-YEAR-1  TO PV-DCA-YEAR-NUM                    19730000
197400        IF PV-DCA-ELEMENT(PV-DCEDEX2 + 2) = SPACE                 19740000
197500                                         OR '-'                   19750000
197600           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 1) TO                 19760000
197700                                               PV-DCA-YEAR-POS4   19770000
197800        ELSE                                                      19780000
197900           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 1) TO PV-DCA-YEAR-POS319790000
198000           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 2) TO PV-DCA-YEAR-POS419800000
198100        END-IF                                                    19810000
198200     END-IF.                                                      19820000
198300                                                                  19830000
198400     IF PV-CLR-MKDN-CDE   = '2'                                   19840000
198500        MOVE PV-DCA-YEAR-2  TO PV-DCA-YEAR-NUM                    19850000
198600        IF PV-DCA-ELEMENT(PV-DCEDEX2 + 2) = SPACE                 19860000
198700                                         OR '-'                   19870000
198800           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 1) TO                 19880000
198900                                               PV-DCA-YEAR-POS4   19890000
199000        ELSE                                                      19900000
199100           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 1) TO PV-DCA-YEAR-POS319910000
199200           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 2) TO PV-DCA-YEAR-POS419920000
199300        END-IF                                                    19930000
199400     END-IF.                                                      19940000
199500                                                                  19950000
199600     IF PV-CLR-MKDN-CDE   = '3'                                   19960005
199700        MOVE PV-DCA-YEAR-3  TO PV-DCA-YEAR-NUM                    19970005
199800        IF PV-DCA-ELEMENT(PV-DCEDEX2 + 2) = SPACE                 19980000
199900                                         OR '-'                   19990000
200000           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 1) TO                 20000000
200100                                               PV-DCA-YEAR-POS4   20010000
200200        ELSE                                                      20020000
200300           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 1) TO PV-DCA-YEAR-POS320030000
200400           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 2) TO PV-DCA-YEAR-POS420040000
200500        END-IF                                                    20050000
200600     END-IF.                                                      20060000
200700                                                                  20070000
199600     IF PV-CLR-MKDN-CDE   = '4'                                   20071005
199700        MOVE PV-DCA-YEAR-4  TO PV-DCA-YEAR-NUM                    20072005
199800        IF PV-DCA-ELEMENT(PV-DCEDEX2 + 2) = SPACE                 20073005
199900                                         OR '-'                   20074005
200000           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 1) TO                 20075005
200100                                               PV-DCA-YEAR-POS4   20076005
200200        ELSE                                                      20077005
200300           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 1) TO PV-DCA-YEAR-POS320078005
200400           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 2) TO PV-DCA-YEAR-POS420079005
200500        END-IF                                                    20079105
200600     END-IF.                                                      20079205
200700                                                                  20079305
199600     IF PV-CLR-MKDN-CDE   = '5'                                   20079405
199700        MOVE PV-DCA-YEAR-5  TO PV-DCA-YEAR-NUM                    20079505
199800        IF PV-DCA-ELEMENT(PV-DCEDEX2 + 2) = SPACE                 20079605
199900                                         OR '-'                   20079705
200000           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 1) TO                 20079805
200100                                               PV-DCA-YEAR-POS4   20079905
200200        ELSE                                                      20080005
200300           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 1) TO PV-DCA-YEAR-POS320080105
200400           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 2) TO PV-DCA-YEAR-POS420080205
200500        END-IF                                                    20080305
200600     END-IF.                                                      20080405
200700                                                                  20080505
199600     IF PV-CLR-MKDN-CDE   = '6'                                   20080605
199700        MOVE PV-DCA-YEAR-6  TO PV-DCA-YEAR-NUM                    20080705
199800        IF PV-DCA-ELEMENT(PV-DCEDEX2 + 2) = SPACE                 20080805
199900                                         OR '-'                   20080905
200000           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 1) TO                 20081005
200100                                               PV-DCA-YEAR-POS4   20081105
200200        ELSE                                                      20081205
200300           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 1) TO PV-DCA-YEAR-POS320081305
200400           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 2) TO PV-DCA-YEAR-POS420081405
200500        END-IF                                                    20081505
200600     END-IF.                                                      20081605
200700                                                                  20081705
200800     IF PV-CLR-MKDN-CDE   = 'O'                                   20082005
200900        MOVE PV-DCA-YEAR-O  TO PV-DCA-YEAR-NUM                    20090000
201000        IF PV-DCA-ELEMENT(PV-DCEDEX2 + 2) = SPACE                 20100000
201100                                         OR '-'                   20110000
201200           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 1) TO                 20120000
201300                                               PV-DCA-YEAR-POS4   20130000
201400        ELSE                                                      20140000
201500           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 1) TO PV-DCA-YEAR-POS320150000
201600           MOVE PV-DCA-ELEMENT(PV-DCEDEX2 + 2) TO PV-DCA-YEAR-POS420160000
201700        END-IF                                                    20170000
201800     END-IF.                                                      20180000
201900                                                                  20190000
202000     PERFORM 6400-INVALID-DATE-INPUT.                             20200000
202100                                                                  20210000
202200*6170-EXIT.  EXIT.                                                20220000
202300******************************************************************20230000
202400*     OLD STYLE EVENT NAME DATE CONVERSION ROUTINE               *20240000
202500******************************************************************20250000
202600 6200-OLD-STYLE-EVNT-NAME.                                        20260000
202700     MOVE '6200-OLD-STYLE-EVNT-NAME        ' TO PV-PARAGRAPH-NAME.20270000
202800     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          20280000
202900                                                                  20290000
203000     MOVE  PV-EVNT-CSV-NM-OS-FY      TO  PV-EVNT-CSV-NM-FY.       20300000
203100     MOVE  PV-EVNT-CSV-NM-OS-MON     TO  PV-MONTH.                20310000
203200                                                                  20320000
203300     PERFORM 6250-GET-MONTH                                       20330000
203400            VARYING MTH-NDX FROM 1 BY 1                           20340000
203500            UNTIL MTH-NDX IS GREATER THAN 12.                     20350000
203600*                                                                 20360000
203700*    DISPLAY 'PV-EVNT-CSV-NM-OLD-STYLE > '                        20370000
203800*                                 PV-EVNT-CSV-NM-OLD-STYLE.       20380000
203900*    DISPLAY 'PV-EVNT-START-CAL-MN   > ' PV-EVNT-START-CAL-MN.    20390000
204000                                                                  20400000
204100*6200-EXIT.  EXIT.                                                20410000
204200******************************************************************20420000
204300* 6250-GET THE MONTH NAME...                                      20430000
204400******************************************************************20440000
204500 6250-GET-MONTH.                                                  20450000
204600                                                                  20460000
204700     IF PV-MONTH IS EQUAL TO PV-MTH-MON-ABBR(MTH-NDX)             20470000
204800         MOVE PV-MTH-CAL-MM (MTH-NDX) TO PV-EVNT-START-CAL-MN     20480000
204900         MOVE 99                      TO MTH-NDX.                 20490000
205000                                                                  20500000
205100*6250-EXIT.                                                       20510000
205200******************************************************************20520000
205300* 6300-VALIDATE-DATE-INPUT.                                       20530000
205400*     VALIDATE THE DATE INPUT BY CALLING THE KOHLS CALENDAR       20540000
205500*     ROUTINE AND CHECKING TO SEE WHETHER IT THROWS AN ERROR.     20550000
205600******************************************************************20560000
205700 6300-VALIDATE-DATE-INPUT.                                        20570000
205800                                                                  20580000
205900     MOVE '6300-VALIDATE-DATE-INPUT        ' TO PV-PARAGRAPH-NAME.20590000
206000     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          20600000
206100                                                                  20610000
206200     INITIALIZE DPG51 DPG52 DPG53                                 20620000
206300                DPG54 DPG55 DPG56.                                20630000
206400                                                                  20640000
206500     SET  DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                     20650000
206600     SET  DPG52-LK-DTE-ISO-FMT       TO TRUE.                     20660000
206700     MOVE PV-DCA-DATE                TO PV-DATE-TO-VALIDATE.      20670000
206800     MOVE PV-VALIDATE-DATE           TO DPG52-LK-DATE-INPUT.      20680000
206900                                                                  20690000
207000     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    20700000
207100                                             DPG54 DPG55 DPG56.   20710000
207200     EVALUATE TRUE                                                20720000
207300         WHEN DPG54-NO-ERROR                                      20730000
207400             CONTINUE                                             20740000
207400*            DISPLAY ' '                                          20741000
207500*            DISPLAY 'MARKDOWN DATE OK > ' PV-VALIDATE-DATE       20750000
207600         WHEN OTHER                                               20760000
207700             DISPLAY ' '                                          20770000
207800             DISPLAY '** INPUT DATE  = ' DPG52-LK-DATE-INPUT      20780000
207900             MOVE '6300-VALIDATE-DATE-INPUT'                      20790000
208000                                  TO PV-PARAGRAPH-NAME            20800000
208100             PERFORM 6400-INVALID-DATE-INPUT                      20810000
208200     END-EVALUATE.                                                20820000
208300                                                                  20830000
208400*6300-EXIT.                                                       20840000
208500******************************************************************20850000
208600*6400-INVALID-DATE-INPUT.                                         20860000
208700*     INVALID DATE INPUT FROM CALLING THE KOHLS CALENDAR          20870000
208800******************************************************************20880000
208900 6400-INVALID-DATE-INPUT.                                         20890000
209000                                                                  20900000
209100     MOVE '6400-INVALID-DATE-INPUT'    TO PV-PARAGRAPH-NAME.      20910000
209200                                                                  20920000
209300     IF PV-CLR-MKDN-CDE = '1'                                     20930000
209400         MOVE PV-UC-D                   TO PV-DATA-ITEM           20940000
209500         SET PV-ERR-TYP-BAD-DTE-FMT-MD1 TO TRUE                   20950000
209600         ADD +1 TO PV-MKDN1-COUNT                                 20960000
209700     ELSE                                                         20970000
209800     IF PV-CLR-MKDN-CDE = '2'                                     20980000
209900         MOVE PV-UC-E                   TO PV-DATA-ITEM           20990000
210000         SET PV-ERR-TYP-BAD-DTE-FMT-MD2 TO TRUE                   21000000
210100         DISPLAY 'INVALID MKDN 2 DATE ' PV-VALIDATE-DATE          21010000
210200         ADD +1 TO PV-MKDN2-COUNT                                 21020000
210300     ELSE                                                         21030000
210400     IF PV-CLR-MKDN-CDE = '3'                                     21040005
210500         MOVE PV-UC-F                   TO PV-DATA-ITEM           21050000
210600         SET PV-ERR-TYP-BAD-DTE-FMT-MD3 TO TRUE                   21060005
210700         DISPLAY 'INVALID 3RD MKDN DATE ' PV-VALIDATE-DATE        21070005
210800         ADD +1 TO PV-MKDN3-COUNT                                 21080005
210900     ELSE                                                         21090000
210400     IF PV-CLR-MKDN-CDE = '4'                                     21090105
210500         MOVE PV-UC-G                   TO PV-DATA-ITEM           21090205
210600         SET PV-ERR-TYP-BAD-DTE-FMT-MD4 TO TRUE                   21090305
210700         DISPLAY 'INVALID 4TH MKDN DATE ' PV-VALIDATE-DATE        21090405
210800         ADD +1 TO PV-MKDN4-COUNT                                 21090505
210900     ELSE                                                         21090605
210400     IF PV-CLR-MKDN-CDE = '5'                                     21091005
210500         MOVE PV-UC-H                   TO PV-DATA-ITEM           21092005
210600         SET PV-ERR-TYP-BAD-DTE-FMT-MD5 TO TRUE                   21093005
210700         DISPLAY 'INVALID 5TH MKDN DATE ' PV-VALIDATE-DATE        21094005
210800         ADD +1 TO PV-MKDN5-COUNT                                 21095005
210900     ELSE                                                         21096005
210400     IF PV-CLR-MKDN-CDE = '6'                                     21097005
210500         MOVE PV-UC-I                   TO PV-DATA-ITEM           21098005
210600         SET PV-ERR-TYP-BAD-DTE-FMT-MD6 TO TRUE                   21099005
210700         DISPLAY 'INVALID 6TH MKDN DATE ' PV-VALIDATE-DATE        21099105
210800         ADD +1 TO PV-MKDN6-COUNT                                 21099205
210900     ELSE                                                         21099305
211000     IF PV-CLR-MKDN-CDE = 'O'                                     21100000
211100         MOVE PV-UC-J                   TO PV-DATA-ITEM           21110005
211200         SET PV-ERR-TYP-BAD-DTE-FMT-MOS TO TRUE                   21120000
211300         DISPLAY 'INVALID MOS DATE ' PV-VALIDATE-DATE             21130000
211400         ADD +1 TO PV-MKDNO-COUNT                                 21140000
211500     END-IF.                                                      21150000
211600                                                                  21160000
211700     SET PS-CSV-ERROR-FOUND             TO TRUE.                  21170000
211800     SET PS-CSV-RCD-ERROR-FOUND         TO TRUE.                  21180000
211900     PERFORM 8300-BUILD-ERR-RECORD.                               21190000
212000                                                                  21200000
212100*6400-EXIT.                                                       21210000
215600******************************************************************21560000
215700*     GET CLR_EVNT_IDS FROM PET_CLR_EVNT                         *21570000
215800******************************************************************21580000
215900 7100-GET-CLR-EVNT-ID.                                            21590000
216000     MOVE '7100-GET-CLR-EVNT-ID            ' TO PV-PARAGRAPH-NAME.21600000
216100     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          21610000
216200                                                                  21620000
216300     MOVE ZEROS                    TO CLR-EVNT-ID IN PET00003.    21630000
216400                                                                  21640000
216500     PERFORM                                                      21650000
216600         WITH TEST AFTER                                          21660000
216700         VARYING PV-SQL-SUB                                       21670000
216800         FROM 1 BY 1                                              21680000
216900         UNTIL ( PV-SQL-SUB GREATER PC-MAX-RETRIES                21690000
217000                   OR  SQLCODE = 0                                21700000
217100                   OR  SQLCODE = +1403 )                          21710000
217200                                                                  21720000
217300         EXEC SQL                                                 21730000
217400            SELECT                                                21740000
217500                   CLR_EVNT_ID                                    21750000
217600                  ,CLR_EVNT_NM                                    21760000
217700                  ,LY_CLR_EVNT_ID                                 21770000
217800                  ,GUI_LOD_ID                                     21780000
217900              INTO                                                21790000
218000                   :PET00003.CLR-EVNT-ID                          21800000
218100                  ,:PET00003.CLR-EVNT-NM                          21810000
218200                  ,:PET00003.LY-CLR-EVNT-ID :PV-LY-CE-ID-NULL-IND 21820000
218300                  ,:PET00003.GUI-LOD-ID                           21830000
218400              FROM                                                21840000
218500                   PET_CLR_EVNT                                   21850064
218600             WHERE                                                21860000
218700                   GUI_LOD_ID      = :PET00003.GUI-LOD-ID         21870000
218800         END-EXEC                                                 21880000
218900                                                                  21890000
219000         EVALUATE TRUE                                            21900000
219100             WHEN SQLCODE = 0                                     21910000
219200                  SET PS-EXISTING-EVNT TO TRUE                    21920000
219300             WHEN SQLCODE = +1403                                 21930000
219400                  SET PS-NOT-EXISTING-EVNT TO TRUE                21940000
219500             WHEN SQLWARN0 NOT EQUAL SPACE                        21950000
219600             WHEN SQLCODE NOT EQUAL ZERO                          21960000
219700                  MOVE 'SELECT FROM PET_CLR_EVNT'                 21970000
219800                                     TO PV-ORA-OPERATION          21980000
219900                  PERFORM 9700-ORA-ERROR                          21990000
220000         END-EVALUATE                                             22000000
220100     END-PERFORM.                                                 22010000
220200                                                                  22020000
220300     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         22030000
220400        MOVE 'SELECT RETRIES EXCEEDED'                            22040000
220500                              TO  PV-ORA-OPERATION                22050000
220600        PERFORM 9700-ORA-ERROR                                    22060000
220700     END-IF.                                                      22070000
220800                                                                  22080000
220900*7100-EXIT.  EXIT.                                                22090000
221000******************************************************************22100000
221100*     GET CLR_EVNT_IDS FROM PET_CLR_EVNT FOR LY GUI-LOD-ID       *22110000
221200******************************************************************22120000
221300 7200-GET-LY-CLR-EVNT-ID.                                         22130000
221400     MOVE '7200-GET-LY-CLR-EVNT-ID         ' TO PV-PARAGRAPH-NAME.22140000
221500     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          22150000
221600                                                                  22160000
221700     MOVE ZEROS                     TO CLR-EVNT-ID IN PET00003.   22170000
221800                                                                  22180000
221900     PERFORM                                                      22190000
222000         WITH TEST AFTER                                          22200000
222100         VARYING PV-SQL-SUB                                       22210000
222200         FROM 1 BY 1                                              22220000
222300         UNTIL ( PV-SQL-SUB GREATER PC-MAX-RETRIES                22230000
222400                   OR  SQLCODE = 0                                22240000
222500                   OR  SQLCODE = +1403 )                          22250000
222600                                                                  22260000
222700         EXEC SQL                                                 22270000
222800            SELECT                                                22280000
222900                   CLR_EVNT_ID                                    22290000
223000                  ,CLR_EVNT_NM                                    22300000
223100              INTO                                                22310000
223200                   :PET00003.CLR-EVNT-ID                          22320000
223300                  ,:PET00003.CLR-EVNT-NM                          22330000
223400              FROM                                                22340000
223500                   PET_CLR_EVNT                                   22350064
223600             WHERE                                                22360000
223700                   GUI_LOD_ID      = :PV-LY-EVNT-GUI-LOD-ID       22370000
223800              AND  GUI_LOD_ID     <> :PET00003.GUI-LOD-ID         22380000
223900         END-EXEC                                                 22390000
224000                                                                  22400000
224100         EVALUATE TRUE                                            22410000
224200             WHEN SQLCODE = 0                                     22420000
224300                  SET PS-LY-EVNT-ID-FOUND TO TRUE                 22430000
224400                  MOVE CLR-EVNT-ID IN PET00003                    22440000
224500                                     TO PV-CER-LY-CLR-EVNT-ID     22450000
224600             WHEN SQLCODE = +1403                                 22460000
224700                  SET PS-NO-LY-EVNT-ID TO TRUE                    22470000
224800             WHEN SQLWARN0 NOT EQUAL SPACE                        22480000
224900             WHEN SQLCODE NOT EQUAL ZERO                          22490000
225000                  MOVE 'SELECT LY EVNT_ID FROM PET_CLR_EVNT'      22500000
225100                                     TO PV-ORA-OPERATION          22510000
225200                  PERFORM 9700-ORA-ERROR                          22520000
225300         END-EVALUATE                                             22530000
225400     END-PERFORM.                                                 22540000
225500                                                                  22550000
225600     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         22560000
225700        MOVE 'SELECT RETRIES EXCEEDED'                            22570000
225800                              TO  PV-ORA-OPERATION                22580000
225900        PERFORM 9700-ORA-ERROR                                    22590000
226000     END-IF.                                                      22600000
226100                                                                  22610000
226200*7200-EXIT.  EXIT.                                                22620000
226300******************************************************************22634000
226400*     SELECT EVENT DATE INFORMATION FROM TDTATTR                 *22640064
226500*     - NEW FORMAT EVENT NAME / DATE                             *22650000
226600******************************************************************22660000
226700 7300-GET-EVNT-CAL-DTE.                                           22670000
226800     MOVE '7300-GET-EVNT-CAL-DTE          ' TO PV-PARAGRAPH-NAME. 22680000
226900     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          22690000
227000                                                                  22700000
227100      EXEC SQL                                                    22710000
227200        SELECT                                                    22720000
227300            TO_CHAR(KY_DTE,'YYYY-MM-DD')                          22730072
227400           ,FSCL_YR_NBR                                           22740000
227500           ,FSCL_MN_NBR                                           22750000
227600           ,FSCL_WK_NBR                                           22760000
227700           ,DAY_OF_WK_NBR                                         22770000
227800           ,CAL_MN_NBR                                            22780000
227900           ,SEA_DESC                                              22790000
228000           ,TO_CHAR(SEA_END_DTE,'YYYY-MM-DD')                     22800072
228100        INTO :DTATTR-KY-DTE                                       22810000
228200            ,:DTATTR-FSCL-YR-NBR                                  22820000
228300            ,:DTATTR-FSCL-MN-NBR                                  22830000
228400            ,:DTATTR-FSCL-WK-NBR                                  22840000
228500            ,:DTATTR-DAY-OF-WK-NBR                                22850000
228600            ,:DTATTR-CAL-MN-NBR                                   22860000
228700            ,:DTATTR-SEA-DESC                                     22870000
228800            ,:DTATTR-SEA-END-DTE                                  22880000
228900        FROM TDTATTR                                              22890064
229000        WHERE FSCL_YR_NBR       = :DTATTR-FSCL-YR-NBR             22900000
229100          AND FSCL_WK_NBR       = :DTATTR-FSCL-WK-NBR             22910000
229200          AND DAY_OF_WK_NBR = '1'                                 22920000
229300      END-EXEC.                                                   22930000
229400                                                                  22940000
229500*7300-EXIT.  EXIT.                                                22950000
150200******************************************************************22951007
150300*   SELECT DATES FROM PET_CLR_MKDN_EVNT TO CHECK FOR UPDATE      *22952007
150400******************************************************************22953007
150500 7310-SLCT-CLR-MKDN-EVNT-DATA.                                    22954007
150600     MOVE '7310-SLCT-CLR-MKDN-EVNT-DATA    ' TO PV-PARAGRAPH-NAME.22955007
150700     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          22956007
150800                                                                  22957007
150900     MOVE SPACES TO PV-PET-CLR-FRST-EFF-DTE.                      22958007
151000     MOVE SPACES TO PV-PET-CLR-LAST-EFF-DTE.                      22959007
151200     PERFORM                                                      22959207
151300         WITH TEST AFTER                                          22959307
151400         VARYING PV-SQL-SUB                                       22959407
151500         FROM 1 BY 1                                              22959507
151600         UNTIL ( PV-SQL-SUB GREATER PC-MAX-RETRIES                22959607
151700                   OR  SQLCODE = 0                                22959707
151800                   OR  SQLCODE = +1403 )                          22959807
151900                                                                  22959907
152000         EXEC SQL                                                 22960007
152100            SELECT TO_CHAR(CLR_FRST_EFF_DTE,'YYYY-MM-DD')         22960172
152200                  ,TO_CHAR(CLR_LAST_EFF_DTE,'YYYY-MM-DD')         22960272
152400              INTO                                                22960407
152500                   :PV-PET-CLR-FRST-EFF-DTE                       22960507
152600                  ,:PV-PET-CLR-LAST-EFF-DTE                       22960607
152800              FROM                                                22960807
152900                   PET_CLR_MKDN_EVNT                              22960964
153000              WHERE                                               22961007
153100                   CLR_EVNT_ID         = :PET00003.CLR-EVNT-ID    22961107
153200               AND CLR_MKDN_CDE        = :PET00001.CLR-MKDN-CDE   22961209
153300         END-EXEC                                                 22961307
153400                                                                  22961407
153500         EVALUATE TRUE                                            22961507
153600             WHEN SQLCODE = 0                                     22961607
153700                  CONTINUE                                        22961718
219300             WHEN SQLCODE = +1403                                 22961818
                      MOVE '9999999999' TO PV-PET-CLR-FRST-EFF-DTE(1:10)22961918
153800             WHEN SQLWARN0 NOT EQUAL SPACE                        22962107
153900             WHEN SQLCODE NOT EQUAL ZERO                          22962207
154000                MOVE 'SELECT EVENT DATES FROM PET_CLR_MKDN_EVNT'  22962318
154100                                   TO PV-ORA-OPERATION            22962418
                      MOVE CLR-EVNT-ID IN PET00003 TO                   22962518
                                      PV-DISP-CLR-EVNT-ID               22962618
154200                DISPLAY 'EVENT ID > ' PV-DISP-CLR-EVNT-ID         22962718
154200                DISPLAY 'EVENT ID > ' CLR-EVNT-ID IN PET00003     22962818
154200                DISPLAY 'EVENT MARK ' CLR-MKDN-CDE IN PET00001    22962918
154300                PERFORM 9700-ORA-ERROR                            22963018
154400         END-EVALUATE                                             22963114
154500     END-PERFORM.                                                 22963214
154600                                                                  22963314
154700     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         22963414
154800        MOVE 'SELECT RETRIES EXCEEDED'                            22963514
154900                              TO  PV-ORA-OPERATION                22963614
155000        PERFORM 9700-ORA-ERROR                                    22963714
155100     END-IF.                                                      22963814
155200                                                                  22963914
155300*7310-EXIT.  EXIT.                                                22964014
229600******************************************************************22965000
229700*     SELECT EVENT DATE INFORMATION FROM TDTATTR                 *22970064
229800*     - OLD FORMAT EVENT NAME / DATE                             *22980000
229900******************************************************************22990000
230000 7350-SELECT-EVNT-CAL-DTE.                                        23000000
230100     MOVE '7350-SELECT-EVNT-CAL-DTE       ' TO PV-PARAGRAPH-NAME. 23010000
230200     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          23020000
230300                                                                  23030000
230400     EXEC SQL                                                     23040000
230500       SELECT                                                     23050000
230600           TO_CHAR(KY_DTE,'YYYY-MM-DD')                           23060072
230700          ,FSCL_YR_NBR                                            23070000
230800          ,FSCL_MN_NBR                                            23080000
230900          ,FSCL_WK_NBR                                            23090000
231000          ,DAY_OF_WK_NBR                                          23100000
231100          ,SEA_DESC                                               23110000
231200          ,TO_CHAR(SEA_END_DTE,'YYYY-MM-DD')                      23120072
231300       INTO :DTATTR-KY-DTE                                        23130000
231400           ,:DTATTR-FSCL-YR-NBR                                   23140000
231500           ,:DTATTR-FSCL-MN-NBR                                   23150000
231600           ,:DTATTR-FSCL-WK-NBR                                   23160000
231700           ,:DTATTR-DAY-OF-WK-NBR                                 23170000
231800           ,:DTATTR-SEA-DESC                                      23180000
231900           ,:DTATTR-SEA-END-DTE                                   23190000
232000       FROM TDTATTR                                               23200064
232100       WHERE FSCL_YR_NBR        = :DTATTR-FSCL-YR-NBR             23210000
232200         AND CAL_MN_NBR         = :DTATTR-CAL-MN-NBR              23220000
232300         AND WK_IN_MN_NBR       = :DTATTR-WK-IN-MN-NBR            23230000
232400         AND DAY_OF_WK_NBR = '1'                                  23240000
232500     END-EXEC.                                                    23250000
232600                                                                  23260000
232700*7350-EXIT.  EXIT.                                                23270000
232800******************************************************************23280000
232900*     GET INITIAL MAX CLR_EVNT_ID  FROM PET_CLR_EVNT             *23290000
233000******************************************************************23300000
233100 7400-GET-INIT-MAX-CLR-EVNT-ID.                                   23310000
233200     MOVE '7400-GET-INIT-MAX-CLR-EVNT-ID   ' TO PV-PARAGRAPH-NAME.23320000
233300     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          23330000
233400                                                                  23340000
233500     MOVE ZEROS                    TO CLR-EVNT-ID IN PET00003.    23350000
233600                                                                  23360000
233700     PERFORM                                                      23370000
233800         WITH TEST AFTER                                          23380000
233900         VARYING PV-SQL-SUB                                       23390000
234000         FROM 1 BY 1                                              23400000
234100         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 23410000
234200                   OR  SQLCODE = 0)                               23420000
234300                                                                  23430000
234400         EXEC SQL                                                 23440000
234500            SELECT MAX                                            23450000
234600                 ( CLR_EVNT_ID )                                  23460000
234700              INTO                                                23470000
234800                   :PET00003.CLR-EVNT-ID                          23480000
234900              FROM                                                23490000
235000                   PET_CLR_EVNT                                   23500064
235100         END-EXEC                                                 23510000
235200                                                                  23520000
235300         EVALUATE TRUE                                            23530000
235400             WHEN SQLCODE = 0                                     23540000
235500                  MOVE CLR-EVNT-ID IN PET00003                    23550000
235600                      TO PV-INIT-MAX-CLR-EVNT-ID                  23560000
235700             WHEN SQLWARN0 NOT EQUAL SPACE                        23570000
235800             WHEN SQLCODE NOT EQUAL ZERO                          23580000
235900                  MOVE 'SELECT MAX CLR_EVNT_ID FROM PET_CLR_EVNT' 23590000
236000                                     TO PV-ORA-OPERATION          23600000
236100                  PERFORM 9700-ORA-ERROR                          23610000
236200         END-EVALUATE                                             23620000
236300     END-PERFORM.                                                 23630000
236400                                                                  23640000
236500     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         23650000
236600        MOVE 'SELECT RETRIES EXCEEDED'                            23660000
236700                              TO  PV-ORA-OPERATION                23670000
236800        PERFORM 9700-ORA-ERROR                                    23680000
236900     END-IF.                                                      23690000
237000                                                                  23700000
237100*7400-EXIT.  EXIT.                                                23710000
237200******************************************************************23720000
237300*     SELECT EVENT DATE INFORMATION FROM TDTATTR                 *23730064
237400*     - NEW FORMAT EVENT NAME / DATE                             *23740000
237500******************************************************************23750000
237600 7500-GET-CURRENT-DTE-ATTR.                                       23760000
237700     MOVE '7500-GET-CURRENT-DTE-ATTR      ' TO PV-PARAGRAPH-NAME. 23770000
237800     IF PS-READY-TRACE DISPLAY PV-PARAGRAPH-NAME END-IF.          23780000
237900                                                                  23790000
238000          EXEC SQL                                                23800000
238100             SELECT DISTINCT                                      23810000
238200                 FSCL_YR_NBR                                      23820000
238300                ,FSCL_WK_NBR                                      23830000
238300                ,TO_CHAR(FSCL_WK_BEG_DTE,'YYYY-MM-DD')            23831072
238300                ,TO_CHAR(FSCL_WK_END_DTE,'YYYY-MM-DD')            23832072
238400                ,SEA_DESC                                         23840000
238500                ,TO_CHAR(SEA_END_DTE,'YYYY-MM-DD')                23850072
238600             INTO                                                 23860000
238700                 :DTATTR-FSCL-YR-NBR                              23870000
238800                ,:DTATTR-FSCL-WK-NBR                              23880000
                      ,:DTATTR-FSCL-WK-BEG-DTE                          23881032
                      ,:DTATTR-FSCL-WK-END-DTE                          23882032
238900                ,:DTATTR-SEA-DESC                                 23890000
239000                ,:DTATTR-SEA-END-DTE                              23900000
239100             FROM                                                 23910000
239200                 TDTATTR                                          23920064
239300             WHERE                                                23930000
239400                 KY_DTE = TO_DATE(:PV-DATE-TODAY,'YYYY-MM-DD')    23940072
239500          END-EXEC.                                               23950000
239600                                                                  23960000
239700          EVALUATE TRUE                                           23970000
239800            WHEN SQLCODE = 0                                      23980000
239900                 MOVE DTATTR-FSCL-YR-NBR TO PV-CRNT-FSCL-YR-NBR   23990000
240000                 MOVE DTATTR-FSCL-WK-NBR TO PV-CRNT-FSCL-WK-NBR   24000000
240000                 MOVE DTATTR-FSCL-WK-BEG-DTE TO                   24001032
                                         PV-CRNT-FSCL-WK-BEG-DTE        24002032
240000                 MOVE DTATTR-FSCL-WK-END-DTE TO                   24003032
                                         PV-CRNT-FSCL-WK-END-DTE        24004032
240100                 MOVE DTATTR-SEA-DESC    TO PV-CRNT-SEA-DESC      24010000
240200                 MOVE DTATTR-SEA-END-DTE TO PV-CRNT-SEA-END-DTE   24020000
240300            WHEN OTHER                                            24030000
240400                 DISPLAY ' '                                      24040000
240500                 MOVE 'SELECT FROM TDTATTR FOR FSCL YR & WK'      24050064
240600                                    TO PV-ORA-OPERATION           24060000
240700                 PERFORM 9700-ORA-ERROR                           24070000
240800          END-EVALUATE.                                           24080000
240900                                                                  24090000
241000*7500-EXIT.  EXIT.                                                24100000
241100******************************************************************24110000
241200*     WRITE VALIDATED EVENT DATA RECORD TO OUTPUT                *24120000
241300******************************************************************24130000
241400 8000-WRITE-EVNT-RECORD.                                          24140000
241500     MOVE '8000-WRITE-EVNT-RECORD          ' TO PV-PARAGRAPH-NAME.24150000
241600     IF PA905-CLR-EVNT-ACT-ADD                                    24160049
              WRITE VALIDATED-EVENT-INSERT-REC FROM                     24161050
                                   PA905-EVNT-CAL-VALID-REC             24162049
              ADD  1  TO  PV-EVNT-INS-RECS-OUT                          24163049
242000     ELSE                                                         24200049
241700        WRITE VALIDATED-EVENT-RECORD FROM                         24201049
241800                             PA905-EVNT-CAL-VALID-REC             24202049
241900        ADD  1  TO  PV-EVNT-RECS-OUT                              24203049
           END-IF.                                                      24204049
242100*8000-EXIT.  EXIT.                                                24210000
242200******************************************************************24220000
242300*     READ DATE CONTROL CARD FILE                                *24230000
242400******************************************************************24240000
242500 8100-READ-DTE-CNTL-FILE.                                         24250000
242600     MOVE '8100-READ-DTE-CNTL-FILE      ' TO PV-PARAGRAPH-NAME.   24260000
242700                                                                  24270000
242800     READ   DTE-CNTL-VALIDATE-FILE-IN                             24280000
242900       INTO PA025-DTE-CONTROL-CARD-RCD.                           24290000
243000                                                                  24300000
243100*8100-EXIT.  EXIT.                                                24310000
243200******************************************************************24320000
243300*     WRITE DATE CONTROL CARD RECORD                             *24330000
243400******************************************************************24340000
243500 8200-WRITE-DATE-CNTL-RECORD.                                     24350000
243600     MOVE '8200-WRITE-DATE-CNTL-RECORD     ' TO PV-PARAGRAPH-NAME.24360000
243700                                                                  24370000
243800     WRITE DTE-CNTL-VALIDATE-OUT-RCD                              24380000
243900      FROM PA025-DTE-CONTROL-CARD-RCD.                            24390000
244000                                                                  24400000
244100*8200-EXIT.  EXIT.                                                24410000
244200******************************************************************24420000
244300*     BUILD ERROR RECORD FOR OUTPUT                              *24430000
244400*     THIS IS PERFORMED WHEN AN INPUT RECORD RAISES AN ERROR     *24440000
244500******************************************************************24450000
244600 8300-BUILD-ERR-RECORD.                                           24460000
244700     MOVE '8300-BUILD-ERR-RECORD          ' TO PV-PARAGRAPH-NAME. 24470000
244800                                                                  24480000
244900     MOVE SPACES          TO PV-ERROR-MESSAGE.                    24490000
245000                                                                  24500000
245100     MOVE EVENT-RECORD    TO PV-ERROR-MESSAGE.                    24510000
245200                                                                  24520000
245300     PERFORM 8400-WRITE-ERR-RECORD.                               24530000
245400                                                                  24540000
245500     PERFORM 8500-BUILD-ERROR-EMAIL-RECORD.                       24550000
245600                                                                  24560000
245700*8300-EXIT.  EXIT.                                                24570000
245800******************************************************************24580000
245900*     WRITE ERROR RECORD TO OUTPUT                               *24590000
246000******************************************************************24600000
246100 8400-WRITE-ERR-RECORD.                                           24610000
246200     MOVE '8400-WRITE-ERR-RECORD          ' TO PV-PARAGRAPH-NAME. 24620000
246300                                                                  24630000
246400     WRITE EVENT-ERROR-RECORD    FROM PV-ERROR-RECORD.            24640000
246500                                                                  24650000
246600     ADD  1  TO  PV-ERR-RECS-OUT.                                 24660000
246700                                                                  24670000
246800*8400-EXIT.  EXIT.                                                24680000
246900******************************************************************24690000
247000* 8500-BUILD-ERROR-EMAIL-RECORD.                                  24700000
247100*      WRITE THE ERROR E-MAIL RECORD TO THE E-MAIL FILE           24710000
247200******************************************************************24720000
247300 8500-BUILD-ERROR-EMAIL-RECORD.                                   24730000
247400                                                                  24740000
247500     MOVE PC-EM-GUI-LOD-ID-TXT TO EM-GUI-LOD-ID-TXT.              24750000
247600     MOVE PC-EM-INPUT-ITEM-TXT TO EM-INPUT-ITEM-TXT.              24760000
247700                                                                  24770000
247800     MOVE PV-ERROR-TYPE        TO EM-MESSAGE-TYPE.                24780000
247900     MOVE PV-GUI-LOD-ID        TO EM-GUI-LOD-ID-X.                24790000
248000     MOVE PV-DATA-ITEM         TO EM-DATA-ITEM.                   24800000
248100                                                                  24810000
248200     PERFORM 8600-WRITE-ERROR-EMAIL-RECORD.                       24820000
248300                                                                  24830000
248400*8500-EXIT.  EXIT.                                                24840000
248500******************************************************************24850000
248600* 8600-WRITE-ERROR-EMAIL-RECORD.                                  24860000
248700*      WRITE THE ERROR E-MAIL RECORD TO THE E-MAIL FILE           24870000
248800******************************************************************24880000
248900 8600-WRITE-ERROR-EMAIL-RECORD.                                   24890000
249000                                                                  24900000
249100*    FIRST ERROR EMAIL RECORD                                     24910000
249200     IF  PV-ERR-EMAIL-RECS-OUT = 0                                24920000
249300         MOVE  '***** ERRORS FOUND IN EVENT CALENDAR CSV FILE: '  24930000
249400                     TO EVENT-CAL-CSV-ERROR-EMAIL-RCD             24940000
249500         WRITE EVENT-CAL-CSV-ERROR-EMAIL-RCD                      24950000
249600         STRING  'DATE: '          DELIMITED BY SIZE              24960000
249700                 DF-DISPLAY-DATE   DELIMITED BY SIZE              24970000
249800                 ' TIME: '         DELIMITED BY SIZE              24980000
249900                 DF-DISPLAY-TIME   DELIMITED BY SIZE              24990000
250000            INTO EVENT-CAL-CSV-ERROR-EMAIL-RCD                    25000000
250100         WRITE EVENT-CAL-CSV-ERROR-EMAIL-RCD                      25010000
250200         MOVE  ' '   TO EVENT-CAL-CSV-ERROR-EMAIL-RCD             25020000
250300         WRITE EVENT-CAL-CSV-ERROR-EMAIL-RCD                      25030000
250400     END-IF.                                                      25040000
250500                                                                  25050000
250600     MOVE  SPACES TO EVENT-CAL-CSV-ERROR-EMAIL-RCD                25060000
250700                                                                  25070000
250800     WRITE EVENT-CAL-CSV-ERROR-EMAIL-RCD                          25080000
250900                                   FROM EM-ERROR-EMAIL-RECORD.    25090000
251000                                                                  25100000
251100     ADD 1 TO PV-ERR-EMAIL-RECS-OUT.                              25110000
251200                                                                  25120000
251300*8600-EXIT.  EXIT.                                                25130000
248500******************************************************************25131043
248600* 8650-WRITE-CRITICAL-EMAIL.                                      25132044
248700*      WRITE THE CRITICAL E-MAIL RECORD TO THE E-MAIL FILE        25133043
248800******************************************************************25134043
248900 8650-WRITE-CRITICAL-EMAIL.                                       25135044
249000                                                                  25136043
249100*    FIRST ERROR EMAIL RECORD                                     25137043
249200     IF  PV-ERR-EMAIL-RECS-OUT = 0                                25138043
249300       MOVE  '**** VALIDATION SUCCESSFUL, THIS IS JUST A WARNING:'25139047
249400                     TO EVENT-CAL-CSV-ERROR-EMAIL-RCD             25139143
249500       WRITE EVENT-CAL-CSV-ERROR-EMAIL-RCD                        25139246
249600       STRING  'DATE: '          DELIMITED BY SIZE                25139346
249700               DF-DISPLAY-DATE   DELIMITED BY SIZE                25139446
249800               ' TIME: '         DELIMITED BY SIZE                25139546
249900               DF-DISPLAY-TIME   DELIMITED BY SIZE                25139646
250000          INTO EVENT-CAL-CSV-ERROR-EMAIL-RCD                      25139746
250100       WRITE EVENT-CAL-CSV-ERROR-EMAIL-RCD                        25139846
250200       MOVE  ' '   TO EVENT-CAL-CSV-ERROR-EMAIL-RCD               25139946
250300       WRITE EVENT-CAL-CSV-ERROR-EMAIL-RCD                        25140046
250400     END-IF.                                                      25140143
250500                                                                  25140243
250600     MOVE  SPACES TO EVENT-CAL-CSV-ERROR-EMAIL-RCD                25140343
250700                                                                  25140443
250800     WRITE EVENT-CAL-CSV-ERROR-EMAIL-RCD                          25140543
250900                                   FROM EM-ERROR-EMAIL-RECORD.    25140643
251000                                                                  25140743
251100     ADD 1 TO PV-ERR-EMAIL-RECS-OUT.                              25140843
251200                                                                  25140943
251300*8650-EXIT.  EXIT.                                                25141045
251400******************************************************************25142043
251500*     CLOSES ALL FILES AND DISPLAYS ANY NEEDED INFORMATION.      *25150000
251600******************************************************************25160000
251700 9000-WRAPUP.                                                     25170000
251800     MOVE '9000-WRAPUP                     ' TO PV-PARAGRAPH-NAME.25180000
251900                                                                  25190000
252000     PERFORM 9900-DISPLAY-TOTALS.                                 25200000
252100                                                                  25210000
252200     PERFORM 9990-GET-CURRENT.                                    25220000
252300                                                                  25230000
252400     DISPLAY '****************************************'.          25240000
252500     DISPLAY '**          PEKUT905 END              **'.          25250065
252600     DISPLAY '****************************************'.          25260000
252700     DISPLAY '**     END DATE ' DF-DISPLAY-DATE                   25270000
252800             '            **'.                                    25280000
252900     DISPLAY '**     END TIME ' DF-DISPLAY-TIME                   25290000
253000             '              **'.                                  25300000
253100     DISPLAY '****************************************'.          25310000
253200                                                                  25320000
253300     CLOSE EVENT-FILE                                             25330000
253400           DTE-CNTL-VALIDATE-FILE-IN                              25340000
253500           VALIDATED-EVENT-FILE                                   25350000
253600           EVENT-ERROR-FILE                                       25360000
253700           EVENT-CAL-CSV-ERROR-EMAIL-FILE                         25370000
253800           DTE-CNTL-VALIDATE-FILE-OUT.                            25380000
253900                                                                  25390000
254000*9000-EXIT.  EXIT.                                                25400000
254100***************************************************************** 25410000
254200*     ORA ABEND ROUTINE.                                        * 25420000
254300***************************************************************** 25430000
254400 9700-ORA-ERROR.                                                  25440000
254500                                                                  25450000
254600     EXEC SQL                                                     25460000
254700        ROLLBACK                                                  25470000
254800     END-EXEC.                                                    25480000
254900                                                                  25490000
255000     PERFORM 9900-DISPLAY-TOTALS.                                 25500000
255100     PERFORM 9990-GET-CURRENT.                                    25510000
255200                                                                  25520000
255300     SET AC-4013-ORA-ERROR         TO TRUE.                       25530000
255400     DISPLAY '** ABEND     **'.                                   25540000
255500     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                25550000
255600     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              25560000
255700     DISPLAY '** OPERATION ** = ' PV-ORA-OPERATION.               25570000
255800     DISPLAY '** TIME      ** = ' DF-DISPLAY-TIME.                25580000
255900                                                                  25590000
256000     COPY DPPD004.                                                25600000
256100     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         25610000
256200                                                                  25620000
256300*9700-EXIT.  EXIT.                                                25630000
256400******************************************************************25640000
256500*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                 *25650000
256600******************************************************************25660000
256700 9800-ABEND.                                                      25670000
256800                                                                  25680000
256900     PERFORM 9900-DISPLAY-TOTALS.                                 25690000
257000     PERFORM 9990-GET-CURRENT.                                    25700000
257100                                                                  25710000
257200     DISPLAY '** ABEND           **'.                             25720000
257300     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          25730000
257400     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        25740000
257500     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       25750000
257600     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       25760000
257700     DISPLAY '** TIME            ** = ' DF-DISPLAY-TIME.          25770000
257800                                                                  25780000
257900     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         25790000
258000******************************************************************25800000
258100*     DISPLAY END OF JOB TOTALS                                  *25810000
258200******************************************************************25820000
258300 9900-DISPLAY-TOTALS.                                             25830000
258400                                                                  25840000
258500     DISPLAY '****************************************'.          25850000
258600     DISPLAY '**     EOJ STATISTICS FOR PEKUT905    **'           25860065
258700     DISPLAY '****************************************'.          25870000
258800                                                                  25880000
258900     DISPLAY '** RECORDS READ ==========> '                       25890000
259000             PV-RECS-READ                                         25900000
259100             ' **'.                                               25910000
259200     DISPLAY '** EVENT RECORDS READ ====> '                       25920000
259300             PV-EVNT-RECS-READ                                    25930000
259400             ' **'.                                               25940000
259500     DISPLAY '** EVENT RECORDS OUT =====> '                       25950000
259600             PV-EVNT-RECS-OUT                                     25960000
259700             ' **'.                                               25970000
259500     DISPLAY '** EVENT INS RECORDS OUT =====> '                   25971049
259600             PV-EVNT-INS-RECS-OUT                                 25972049
259700             ' **'.                                               25973049
259800     DISPLAY '** ERROR RECORDS OUT =====> '                       25980000
259900             PV-ERR-RECS-OUT                                      25990000
260000             ' **'.                                               26000000
260100     DISPLAY '** ERROR E-MAIL RCDS OUT => '                       26010000
260200             PV-ERR-EMAIL-RECS-OUT                                26020000
260300             ' **'.                                               26030000
260400     DISPLAY '****************************************'.          26040000
260500                                                                  26050000
260600*9900-EXIT.  EXIT.                                                26060000
260700******************************************************************26070000
260800*     GET CURRENT DATE, TIME AND TIMESTAMP FROM ORA / SYSTEM     *26080000
260900******************************************************************26090000
261000 9990-GET-CURRENT.                                                26100000
261100                                                                  26110000
261200     MOVE FUNCTION CURRENT-DATE(1:16) TO DF-CURRENT-DATE-TIME.    26120000
261300                                                                  26130000
261400     MOVE DF-CURRENT-YR            TO DF-DD-YR.                   26140000
261500     MOVE DF-CURRENT-MO            TO DF-DD-MO.                   26150000
261600     MOVE DF-CURRENT-DY            TO DF-DD-DY.                   26160000
261700     MOVE DF-CURRENT-HR            TO DF-DT-HR.                   26170000
261800     MOVE DF-CURRENT-MIN           TO DF-DT-MIN.                  26180000
261900     MOVE DF-CURRENT-SEC           TO DF-DT-SEC.                  26190000
262000                                                                  26200000
262100*9990-EXIT.  EXIT.                                                26210000
