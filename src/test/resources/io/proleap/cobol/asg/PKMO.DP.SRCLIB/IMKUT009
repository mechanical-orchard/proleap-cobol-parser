       IDENTIFICATION DIVISION.                                                 
                                                                                
       PROGRAM-ID.         IMKUT009.                                            
       AUTHOR.             PAUL KEBER.                                  00040024
       INSTALLATION.       KOHLS DEPARTMENT STORES.                             
       DATE-WRITTEN.       09-07-99.                                            
       DATE-COMPILED.                                                           
                                                                                
      ******************************************************************        
      *        IMKUT009 - VSM PURGE CANDIDATES SELECTION               *        
      *                                                                *        
      *  THIS PROGRAM DETERMINES WHICH VENDOR STYLES CAN BE PURGED BY  *        
      *  FINDING TVNDSTL ROWS WITH EFFECTIVE END DATES OLDER THAN 60   *        
      *  DAYS BEFORE THE CURRENT DATE AND WHICH DON'T EXIST ON TSK.    *        
      *                                                                *        
      *  FOR THOSE ROWS WHICH MEET THESE CONDITIONS, ALL COLUMNS OF    *        
      *  THE TVNDSTL ROW ARE WRITTEN TO AN OUTPUT FILE WHICH WILL BE   *        
      *  USED AS A RELOAD FILE IF REQUIRED.  CORRESPONDING RECORDS     *        
      *  FROM TMDARVS, TUPC, AND TUPCPLS FOR EACH PURGE CANDIDATE ARE  *        
      *  ALSO WRITTEN TO SEPARATE OUTPUT FILES TO BE USED AS RELOAD    *        
      *  FILES IF REQUIRED.  THE TUPCPLS PURGE OUTPUT FILE WILL BE     *        
      *  USED AS INPUT TO A PURGE PROGRAM.                             *        
      *                                                                *        
      ******************************************************************        
      *  WR#20411  10/14/99  ADD NEW TUPCPLS FIELDS TO CURSOR AND FETCH*00220031
      ******************************************************************        
      *  WR#20411  11/04/99  ADD EFFECTIVE END DATE OR ACTIVE IND CHECK*00220031
      *  TO THE TMDARVS, TUPC, AND TUPCPLS CURSORS.                    *00220031
      ******************************************************************        
      *  WR#20411  11/23/99  P. KEBER   RCP PHASE 2 CHANGES TO ADD NEW *00220031
      *  TUPC FIELD REGN_PRIC_IND TO CURSOR AND FETCH.                 *00220031
      ******************************************************************        
      *  WR#20134  12/21/99  J. SHIFF   ELIMINATE MDSE-TYP-SEQ-NMB FROM*        
      *  TUPC IN BOTH TUPC CURSOR AND 7210-FETCH-TUPC.                          
      ******************************************************************        
      *  ECOMM      8/08/00  D.THEEL   REMOVED TUPC TRND, FBRCN, FNSH, *        
      *  AND PATRN SEQ NBR.  REMOVED TVNDSTL MLT_PRIC_PT_IND AND SLHTT *        
      *  SEQ NBR.  ADDED TUPC WEB ITM CDE AND TMDARVS TRND, FBRCN, FNSH*        
      *  SLHTT, AND SHIP RSTRC SEQ NBR.  MODIFIED ALL FILE LRECLS TO   *        
      *  REFLECT ABOVE CHANGES.                                        *        
      ******************************************************************        
      *  ECOMM     11/13/00  D.THEEL                                   *        
      *  ADDED NEW VSM TABLE TWEBITM.  MODIFIED TMDARVS FOR NEW COLUMNS*        
      *  RMS_STYL_ID, E_PROD_GP_NBR, AND E_PRD_GP_IND.                 *        
      *  MODIFIED TUPC LRECLS FOR REMOVAL OF TUPC WEB ITEM             *        
      *  CODE AND ABOVE TMDARVS COLS.                                  *        
      ******************************************************************        
      *  ECOMM     12/20/00  P. KEBER   E-COMM PHASE 2 SKU LEVEL CHGS  *00220031
      *  DECREASE SIZE OF OUT-TMDARVS-REC TO REMOVE SHIP_RSTRC_SEQ_NBR,*00220031
      *  E_PRD_GP_NBR AND E_PRD_GP_IND.  INCREASE SIZE OF              *        
      *  OUT-TWEBITM-REC TO HANDLE NEW FIELDS.                         *        
      ******************************************************************        
      *  ECOMM      3/5/01   D. THEEL                                  *00220031
      *  INCREASED SIZE OF OUT-TUPC-REC AND ADDED NEW TUPC COLUMN      *00220031
      *  TX_PRD_CDE_SEQ_NBR TO TUPC CURSOR.                            *        
      ******************************************************************        
      *  ECOMM      4/6/01   D. THEEL                                  *00220031
      *  INCREASED SIZE OF OUT-TUPC-REC AND ADDED NEW TUPC COLUMN      *00220031
      *  CUSTFACG_CLOR_DESC TO TUPC CURSOR.                            *        
      ******************************************************************        
      *  WR22746    12/12/01 D. THEEL                                  *00220031
      *  INCREASED SIZE OF OUT-TUPC-REC AND ADDED NEW TUPC COLUMN      *00220031
      *  INTR_UPC_DESC TO TUPC CURSOR.                                 *        
      ******************************************************************        
      *  WR22746    02/25/02 D. THEEL                                  *00220031
      *  MODIFIED 6000-SELECT-FROM-TSK TO INCLUDE TMDSEAR AND TMDARVS  *00220031
      *  SO WE ARE NOW LOOKING TO TSK TO SEE IF THE STYLE, ENT ID,     *        
      *  DEPT, SUBCLASS THAT WE FOUND INACTIVE FOR OVER 60 DAYS ON     *        
      *  TVNDSTL HAS ANY SKUS ON TSK.                                  *        
      ******************************************************************        
      *  WR23443    02/28/02 D. THEEL                                  *00220031
      *  INCREASE TWEBITM OUTPUT FILE LRECL, ADD NEW TWEBITM COLUMN    *00220031
      *  CRE_BY_USR_ID TO TWEBITM SELECT AND FETCH.                    *        
      ******************************************************************        
      *  WR23443    03/05/02 D. THEEL                                  *00220031
      *  INCREASE TMDARVS OUTPUT FILE LRECL, ADD NEW TMDARVS COLUMN    *00220031
      *  STYL_RECLS_IND TO TMDARVS SELECT AND FETCH.                   *        
      ******************************************************************        
      *  WR23443    03/08/02 P. KEBER                                  *00220031
      *  INCREASE TWEBITM OUTPUT FILE LRECL, ADD NEW TWEBITM COLUMN    *00220031
      *  WEB_ITM_DLTD_IND TO TWEBITM SELECT AND FETCH.                 *        
      ******************************************************************        
      *  WR23220    05/08/02 D. THEEL                                  *00220031
      *  INCREASE TMDARVS OUTPUT FILE LRECL, ADD NEW TMDARVS COLUMN    *00220031
      *  RTL_CLSN_SEQ_NBR TO TMDARVS SELECT AND FETCH.                 *        
      ******************************************************************        
      *  WR23749    05/28/02 D. THEEL                                  *00220031
      *  INCREASE TMDARVS OUTPUT FILE LRECL, ADD NEW TMDARVS COLS DEPT *00220031
      *  _NBR, MAJ_CL_NBR, AND SUB_CL_NBR.  ADDED AND TMDARVS.ACTV_IND *        
      *  = 'Y' TO 6000 SELECT COUNT.  THIS WILL FIX A PROBLEM WHERE    *        
      *  THE SAME STYLE EXISTS IN THE SAME DEPARTMENT AND SUBCLASS WITH*        
      *  THE SAME ENT ID WITH ONE ACTIVE AND ONE INACTIVE TMDARVS ROW  *        
      *  WITH DIFFERENT VS IDS.  THIS WILL ALLOW THE INACTIVE STYLE    *        
      *  TO BE DELETED IF THE TSK LONG VENDOR STYLE ROWS ARE FOR THE   *        
      *  ACTIVE STYLE.                                                 *        
      ******************************************************************        
      *  WR23861    08/07/02 D. THEEL                                  *00220031
      *  INCREASE TMDARVS OUTPUT FILE LRECL, ADD NEW TMDARVS COLUMN    *00220031
      *  ESL_SEQ_NBR TO TMDARVS SELECT AND FETCH.                      *        
      ******************************************************************        
      *  WR24363    11/19/02 P. KEBER                                  *00220031
      *  CHANGE LOGIC IN THE 6000-SELECT-FROM-TSK ROUTINE TO ACCESS    *        
      *  TSK BY JOINING TSKXREF VIA ITEM NUMBER AND SELECTING TSKXREF  *        
      *  BY DEPARTMENT, SUBCLASS NUMBER.                               *        
      ******************************************************************        
      *  WR25951    01/21/04 D. THEEL                                  *00220031
      *  ADDED NEW TMDARVS COLS AND INCREASED TMDARVS FILE LRECL.      *        
      ******************************************************************        
      *  WR26741    04/23/04 P. KEBER                                  *        
      *  ADDED NEW TMDARVS COL AND INCREASED TMDARVS FILE LRECL.       *        
      ******************************************************************        
      *  WR27400    08/26/04 D. THEEL                                  *        
      *  MODIFIED SQL DATE LOGIC FROM 60 TO 30 DAYS.                   *        
      ******************************************************************        
      *  WR29925    04/13/06 D. THEEL                                  *        
      *  MODIFIED SQL DATE LOGIC FROM 30 TO 20 DAYS.                   *        
      ******************************************************************        
      *  WR30723    07/05/06 D. THEEL                                  *        
      *  REMOVED TSKXREF WHERE CLAUSE CONDITION EXCLUDING SKUS IN '00' *        
      *  STATUS.                                                       *        
      ******************************************************************        
       ENVIRONMENT DIVISION.                                                    
                                                                                
       CONFIGURATION SECTION.                                                   
                                                                                
       SOURCE-COMPUTER.    IBM-3090.                                            
       OBJECT-COMPUTER.    IBM-3090.                                            
                                                                                
       INPUT-OUTPUT SECTION.                                                    
                                                                                
       FILE-CONTROL.                                                            
                                                                                
           SELECT OUT-TVNDSTL-FILE        ASSIGN TO OUT01.                      
           SELECT OUT-TMDARVS-FILE        ASSIGN TO OUT02.                      
           SELECT OUT-TUPC-FILE           ASSIGN TO OUT03.                      
           SELECT OUT-TUPCPLS-FILE        ASSIGN TO OUT04.                      
           SELECT OUT-TWEBITM-FILE        ASSIGN TO OUT05.                      
                                                                                
       DATA DIVISION.                                                           
                                                                                
       FILE SECTION.                                                            
                                                                                
       FD  OUT-TVNDSTL-FILE                                                     
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
       01  OUT-TVNDSTL-REC                  PIC  X(095).                        
                                                                                
       FD  OUT-TMDARVS-FILE                                                     
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
       01  OUT-TMDARVS-REC                  PIC  X(93).                         
                                                                                
       FD  OUT-TUPC-FILE                                                        
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
       01  OUT-TUPC-REC                     PIC  X(214).                        
                                                                                
       FD  OUT-TUPCPLS-FILE                                                     
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
       01  OUT-TUPCPLS-REC                  PIC  X(144).                        
                                                                                
       FD  OUT-TWEBITM-FILE                                                     
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
       01  OUT-TWEBITM-REC                  PIC  X(123).                        
                                                                                
       WORKING-STORAGE SECTION.                                                 
                                                                                
       01  ABEND-CODE                       PIC S9(04) COMP SYNC                
                                                       VALUE +0.                
                                                                                
       01  PROGRAM-ACCUMULATORS.                                                
           05  PA-TMDARVS-COUNT             PIC S9(09) COMP-3 VALUE +0.         
           05  PA-TUPC-COUNT                PIC S9(09) COMP-3 VALUE +0.         
           05  PA-TUPCPLS-COUNT             PIC S9(09) COMP-3 VALUE +0.         
           05  PA-TVNDSTL-COUNT             PIC S9(09) COMP-3 VALUE +0.         
           05  PA-TVNDSTL-DROPPED-COUNT     PIC S9(09) COMP-3 VALUE +0.         
           05  PA-TWEBITM-COUNT             PIC S9(09) COMP-3 VALUE +0.         
                                                                                
       01  PROGRAM-CONSTANTS.                                                   
           05  PC-MAX-RETRIES               PIC S9(04) COMP SYNC                
                                                       VALUE +3.                
           05  PC-TABLE-MAX                 PIC S9(09) COMP-3                   
                                                       VALUE +999.              
           05  PC-INT-UPC-ID                PIC  X(01) VALUE 'I'.               
           05  PC-RENUM-UPC-ID              PIC  X(01) VALUE 'R'.               
           05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'IMKUT009'.        
                                                                                
       01  PROGRAM-SWITCHES.                                                    
           05  PS-SKU-FOUND-SW              PIC X      VALUE 'N'.               
               88  PS-SKU-FOUND                        VALUE 'Y'.               
               88  PS-SKU-NOT-FOUND                    VALUE 'N'.               
           05  PS-END-OF-TMDARVS-CSR-SW     PIC X      VALUE 'N'.               
               88  PS-END-OF-TMDARVS-CSR               VALUE 'Y'.               
               88  PS-PROCESS-TMDARVS-CSR              VALUE 'N'.               
           05  PS-END-OF-TUPC-CSR-SW        PIC X      VALUE 'N'.               
               88  PS-END-OF-TUPC-CSR                  VALUE 'Y'.               
               88  PS-PROCESS-TUPC-CSR                 VALUE 'N'.               
           05  PS-END-OF-TUPCPLS-CSR-SW     PIC X      VALUE 'N'.               
               88  PS-END-OF-TUPCPLS-CSR               VALUE 'Y'.               
               88  PS-PROCESS-TUPCPLS-CSR              VALUE 'N'.               
           05  PS-END-OF-TVNDSTL-CSR-SW     PIC X      VALUE 'N'.               
               88  PS-END-OF-TVNDSTL-CSR               VALUE 'Y'.               
               88  PS-PROCESS-TVNDSTL-CSR              VALUE 'N'.               
           05  PS-END-OF-TWEBITM-CSR-SW     PIC X      VALUE 'N'.               
               88  PS-END-OF-TWEBITM-CSR               VALUE 'Y'.               
               88  PS-PROCESS-TWEBITM-CSR              VALUE 'N'.               
                                                                                
       01  PROGRAM-VARIABLES.                                                   
           05  PV-RECORD-COUNT              PIC S9(4)  VALUE 0 COMP.            
           05  PV-TSK-COUNT                 PIC S9(4)  VALUE 0 COMP.            
           05  PV-ENT-ID                    PIC  9(5)  VALUE ZERO.              
           05  PV-MEITGP-NBR                PIC  9(5)  VALUE ZERO.              
                                                                                
           05  PV-DB2-OPER-ATTEMPTED        PIC  X(30) VALUE SPACE.             
           05  PV-DISP-FIELD                PIC 9(16)  VALUE ZEROS.             
           05  PV-DISPLAY-FIELD11           PIC ZZZZZZZZZZZ-.                   
           05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACE.             
           05  PV-SQL-SUB                   PIC  9(03) VALUE ZERO.              
                                                                                
      *****************************************************************         
      * TUPCPLS PURGE FILE COPYBOOK                                             
      *****************************************************************         
                                                                                
           COPY IMRD007.                                                        
                                                                                
      *****************************************************************         
      * DB2 FORMATTED ERROR MESSAGE                                             
      *****************************************************************         
                                                                                
           COPY DPWS004.                                                        
                                                                                
      *****************************************************************         
      * DCLGEN FOR THE SKU TABLE                                                
      *****************************************************************         
                                                                                
           EXEC SQL                                                             
               INCLUDE TSK                                                      
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * DCLGEN FOR THE SKU CROSS REFERENCE TABLE                                
      *****************************************************************         
                                                                                
           EXEC SQL                                                             
               INCLUDE TSKXREF                                                  
           END-EXEC.                                                            
                                                                                
0202RM*****************************************************************         
0202RM* DCLGEN FOR THE TMDSEAR TABLE                                            
0202RM*****************************************************************         
0202RM                                                                          
0202RM     EXEC SQL                                                             
0202RM         INCLUDE TMDSEAR                                                  
0202RM     END-EXEC.                                                            
0202RM                                                                          
      *****************************************************************         
      * DCLGEN FOR THE MERCHANDISE AREA VENDOR STYLE TABLE                      
      *****************************************************************         
                                                                                
           EXEC SQL                                                             
               INCLUDE TMDARVS                                                  
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * DCLGEN FOR THE UPC TABLE                                                
      *****************************************************************         
                                                                                
           EXEC SQL                                                             
               INCLUDE TUPC                                                     
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * DCLGEN FOR THE UPC PHYSICAL LOCATION STORE TABLE                        
      *****************************************************************         
                                                                                
           EXEC SQL                                                             
               INCLUDE TUPCPLS                                                  
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * DCLGEN FOR THE VENDOR STYLE TABLE                                       
      *****************************************************************         
                                                                                
           EXEC SQL                                                             
               INCLUDE TVNDSTL                                                  
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * DCLGEN FOR THE WEB ITEM TABLE                                           
      *****************************************************************         
                                                                                
           EXEC SQL                                                             
               INCLUDE TWEBITM                                                  
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * TVNDSTL TABLE CURSOR                                                    
      *****************************************************************         
                                                                                
           EXEC SQL                                                             
               DECLARE TVNDSTL_CSR CURSOR FOR                                   
               SELECT VS_ID                                                     
                     ,ENT_ID                                                    
                     ,VS_NBR                                                    
                     ,EFF_BEG_DTE                                               
                     ,EFF_END_DTE                                               
                     ,COST_UM_CDE                                               
                     ,RTL_UM_CDE                                                
                     ,BYP_CAT_IND                                               
                     ,CRE_BY_USR_ID                                             
                     ,LAST_UPD_BY_USR_ID                                        
                     ,LAST_UPD_TMST                                             
               FROM   TVNDSTL                                                   
               WHERE  EFF_END_DTE < (CURRENT DATE - 20 DAYS)                    
               FOR FETCH ONLY                                                   
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * TMDARVS TABLE CURSOR                                                    
      *****************************************************************         
                                                                                
           EXEC SQL                                                             
               DECLARE TMDARVS_CSR CURSOR FOR                                   
               SELECT  SUB_CL_MDSEAR_ID                                         
                      ,VS_ID                                                    
                      ,ACTV_IND                                                 
                      ,VS_DESC                                                  
                      ,STKR_NBR                                                 
                      ,TKT_TYP_SEQ_NBR                                          
                      ,LBL_SEQ_NBR                                              
                      ,HNG_FOLD_SEQ_NBR                                         
                      ,KY_CLSN_SEQ_NBR                                          
                      ,FBRCN_SEQ_NBR                                            
                      ,FNSH_SEQ_NBR                                             
                      ,RMS_STYL_ID                                              
                      ,STYL_RECLS_IND                                           
                      ,RTL_CLSN_SEQ_NBR                                         
                      ,DEPT_NBR                                                 
                      ,MAJ_CL_NBR                                               
                      ,SUB_CL_NBR                                               
                      ,ESL_SEQ_NBR                                              
                      ,RPT_HIER_SEQ_NBR                                         
                      ,BDY_STYL_SEQ_NBR                                         
                      ,CONST_SEQ_NBR                                            
                      ,FUNC_SEQ_NBR                                             
                      ,GNDR_SEQ_NBR                                             
                      ,PATRN_SEQ_NBR                                            
                      ,SLHTT_SEQ_NBR                                            
                      ,CLLCTN_SEQ_NBR                                           
                      ,MAP_UNT_RTL_AMT                                          
               FROM   TMDARVS                                                   
               WHERE  VS_ID = :VNDSTL-VS-ID                                     
                 AND  ACTV_IND = 'N'                                            
               FOR FETCH ONLY                                                   
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * TUPC TABLE CURSOR                                                       
      *****************************************************************         
                                                                                
           EXEC SQL                                                             
               DECLARE TUPC_CSR CURSOR FOR                                      
               SELECT  UPC_ID                                                   
                      ,UPC_NBR                                                  
                      ,SUB_CL_MDSEAR_ID                                         
                      ,VS_ID                                                    
                      ,INTR_UPC_ID                                              
                      ,EFF_BEG_DTE                                              
                      ,EFF_END_DTE                                              
                      ,UPC_TYP_CDE                                              
                      ,KOHLS_SIZE_CDE                                           
                      ,NRF_SIZE_IND                                             
                      ,NRF_CLOR_CDE                                             
                      ,NRF_CLOR_IND                                             
                      ,CSTM_CLOR_DESC                                           
                      ,EDI_ORD_IND                                              
                      ,PREPK_IND                                                
                      ,GP_CDE                                                   
                      ,CERTD_IND                                                
                      ,CERTD_DTE                                                
                      ,RPLNMT_IND                                               
                      ,KY_ITM_IND                                               
                      ,UNT_COST_1ST_AMT                                         
                      ,UPC_SRC_CDE                                              
                      ,INNR_PK_QTY                                              
                      ,OUTR_PK_QTY                                              
                      ,SEA_SEQ_NBR                                              
                      ,CRE_BY_USR_ID                                            
                      ,LAST_UPD_BY_USR_ID                                       
                      ,LAST_UPD_TMST                                            
                      ,WD_UM_QTY                                                
                      ,DPTH_UM_QTY                                              
                      ,HT_UM_QTY                                                
                      ,SIZE_UM_CDE                                              
                      ,WT_UM_QTY                                                
                      ,WT_UM_CDE                                                
                      ,POG_IND                                                  
                      ,REGN_PRIC_IND                                            
                      ,TX_PRD_CDE_SEQ_NBR                                       
                      ,CUSTFACG_CLOR_DESC                                       
                      ,INTR_UPC_DESC                                            
               FROM   TUPC                                                      
               WHERE  VS_ID = :VNDSTL-VS-ID                                     
                 AND  EFF_END_DTE < (CURRENT DATE - 20 DAYS)                    
               FOR FETCH ONLY                                                   
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * TUPCPLS TABLE CURSOR                                                    
      *****************************************************************         
                                                                                
           EXEC SQL                                                             
               DECLARE TUPCPLS_CSR CURSOR FOR                                   
               SELECT  UPC_ID                                                   
                      ,OPERCO_NBR                                               
                      ,STR_NBR                                                  
                      ,EFF_BEG_TMST                                             
                      ,EFF_END_TMST                                             
                      ,UPC_STAT_CDE                                             
                      ,UNT_COST_AMT                                             
                      ,UNT_RTL_AMT                                              
                      ,MEITGP_NBR                                               
                      ,CRE_BY_USR_ID                                            
                      ,CRE_TMST                                                 
                      ,ITM_NBR                                                  
                      ,PLU_IND                                                  
                      ,UPC_STAT_CHG_DTE                                         
                      ,UNT_RTL_CHG_DTE                                          
               FROM   TUPCPLS                                                   
               WHERE  UPC_ID     = :UPC-UPC-ID                                  
                 AND  OPERCO_NBR = '03'                                         
                 AND  DATE(EFF_END_TMST) < (CURRENT DATE - 20 DAYS)             
               FOR FETCH ONLY                                                   
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * TWEBITM TABLE CURSOR                                                    
      *****************************************************************         
                                                                                
           EXEC SQL                                                             
               DECLARE TWEBITM_CSR CURSOR FOR                                   
               SELECT  INTR_UPC_ID                                              
                      ,EFF_BEG_TMST                                             
                      ,EFF_END_TMST                                             
                      ,ASRT_BEG_DTE                                             
                      ,ASRT_END_DTE                                             
                      ,STRG_AREA_SEQ_NBR                                        
                      ,SHIP_WD_QTY                                              
                      ,SHIP_DPTH_QTY                                            
                      ,SHIP_HT_QTY                                              
                      ,SHIP_WT_QTY                                              
                      ,SHIP_DIM_SRC_CDE                                         
                      ,PKG_SEQ_NBR                                              
                      ,SHIP_RSTRC_SEQ_NBR                                       
                      ,GFT_WRAP_AVL_IND                                         
                      ,PRD_GP_NBR                                               
                      ,PRD_GP_IND                                               
                      ,SHIP_SRCHG_FEE_AMT                                       
                      ,SHIP_SRVC_SEQ_NBR                                        
                      ,SHIP_GP_SEQ_NBR                                          
                      ,CRE_BY_USR_ID                                            
                      ,WEB_ITM_DLTD_IND                                         
               FROM   TWEBITM                                                   
               WHERE  INTR_UPC_ID  = :WEBITM-INTR-UPC-ID                        
                 AND  DATE(EFF_END_TMST) < (CURRENT DATE - 20 DAYS)             
               FOR FETCH ONLY                                                   
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      * SQL COMMUNICATIONS WORK AREA                                            
      ******************************************************************        
                                                                                
           EXEC SQL                                                             
               INCLUDE SQLCA                                                    
           END-EXEC.                                                            
                                                                                
                                                                                
       PROCEDURE DIVISION.                                                      
                                                                                
       0000-MAINLINE-PROCESSING.                                                
                                                                                
           PERFORM 1000-INITIALIZATION.                                         
                                                                                
           PERFORM 2000-PROCESS-TVNDSTL-CURSOR                                  
               UNTIL PS-END-OF-TVNDSTL-CSR.                                     
                                                                                
           PERFORM 9000-EOJ-ROUTINE.                                            
                                                                                
           STOP RUN.                                                            
                                                                                
                                                                                
      ******************************************************************        
      *    - OPEN THE TVNDSTL CURSOR                                   *        
      ******************************************************************        
       1000-INITIALIZATION.                                                     
                                                                                
           INITIALIZE DCLTVNDSTL                                                
                      DCLTMDARVS                                                
                      DCLTUPC                                                   
                      DCLTUPCPLS                                                
                      DCLTWEBITM.                                               
                                                                                
           OPEN OUTPUT OUT-TVNDSTL-FILE                                         
                       OUT-TMDARVS-FILE                                         
                       OUT-TUPC-FILE                                            
                       OUT-TUPCPLS-FILE                                         
                       OUT-TWEBITM-FILE.                                        
                                                                                
           PERFORM 7000-OPEN-TVNDSTL-CURSOR.                                    
           PERFORM 7010-FETCH-TVNDSTL-CURSOR.                                   
                                                                                
      ******************************************************************        
      *  FOR EACH TVNDSTL CURSOR ROW, DETERMINE IF ANY TSK RECORDS     *        
      *  EXIST FOR THE VENDOR STYLE.                                   *        
      *     - IF NONE EXIST, THE TVNDSTL ROW AND ITS ASSOCIATED TUPC,  *        
      *       TMDARVS, TUPCPLS, AND ANY TWEBITM ROWS ARE WRITTEN TO    *        
      *       THE OUTPUT PURGE FILES.                                  *        
      *     - IF TSK RECORDS EXIST, THE TVNDSTL ROW IS NOT ELIGIBLE    *        
      *       FOR PURGING.                                             *        
      *  FETCH THE NEXT ROW FROM THE TVNDSTL CURSOR                    *        
      ******************************************************************        
       2000-PROCESS-TVNDSTL-CURSOR.                                             
                                                                                
           PERFORM 6000-SELECT-FROM-TSK.                                        
                                                                                
           IF PV-TSK-COUNT EQUAL ZERO                                           
               PERFORM 8000-WRITE-TVNDSTL-RECORD                                
                                                                                
               SET PS-PROCESS-TMDARVS-CSR TO TRUE                               
               PERFORM 7100-OPEN-TMDARVS-CURSOR                                 
               PERFORM 7110-FETCH-TMDARVS-CURSOR                                
                   UNTIL PS-END-OF-TMDARVS-CSR                                  
               PERFORM 7120-CLOSE-TMDARVS-CURSOR                                
                                                                                
               SET PS-PROCESS-TUPC-CSR TO TRUE                                  
               PERFORM 7200-OPEN-TUPC-CURSOR                                    
               PERFORM 7210-FETCH-TUPC-CURSOR                                   
                   UNTIL PS-END-OF-TUPC-CSR                                     
               PERFORM 7220-CLOSE-TUPC-CURSOR                                   
           ELSE                                                                 
               ADD +1 TO PA-TVNDSTL-DROPPED-COUNT                               
           END-IF.                                                              
                                                                                
           PERFORM 7010-FETCH-TVNDSTL-CURSOR.                                   
                                                                                
                                                                                
      ******************************************************************        
      *  CHECK TO SEE IF THE VENDOR STYLE EXISTS ON TSK                *        
      ******************************************************************        
       6000-SELECT-FROM-TSK.                                                    
                                                                                
           PERFORM WITH TEST AFTER                                              
               VARYING PV-SQL-SUB FROM 1 BY 1                                   
               UNTIL  (PV-SQL-SUB > PC-MAX-RETRIES                              
                  OR   SQLCODE = 0)                                             
                                                                                
               EXEC SQL                                                         
                  SELECT COUNT(*)                                               
                  INTO :PV-TSK-COUNT                                            
                  FROM  TMDSEAR A                                               
202RM                  ,TMDARVS B                                               
202RM                  ,TSKXREF C                                               
202RM                  ,TSK     D                                               
                  WHERE A.OPERCO_NBR        = '03'                              
                    AND A.MDSELV_CDE        = 'SCL'                             
202RM               AND A.MDSEAR_DKEY       = B.SUB_CL_MDSEAR_ID                
                    AND D.LONG_VENDOR_STYLE = :VNDSTL-VS-NBR                    
                    AND D.ENT_ID            = :VNDSTL-ENT-ID                    
202RM               AND B.VS_ID             = :VNDSTL-VS-ID                     
                    AND B.ACTV_IND          = 'Y'                               
                    AND D.ITEM_NMBR         = C.ITM_NBR                         
202RM               AND A.DEPT_NBR = SUBSTR(DIGITS(B.DEPT_NBR),2,3)             
202RM               AND B.DEPT_NBR          = C.DEPT                            
202RM               AND A.SUB_CL_NBR = SUBSTR(DIGITS(B.SUB_CL_NBR),2,3)         
                    AND B.SUB_CL_NBR        = C.SUBCLASS                        
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN SQLCODE = -904                                          
                       CONTINUE                                                 
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                       MOVE '6000-SELECT-FROM-TSK'                              
                           TO PV-PARAGRAPH-NAME                                 
                       MOVE 'SELECT FROM TSK'                                   
                           TO PV-DB2-OPER-ATTEMPTED                             
                       PERFORM 9999-SQL-ABEND                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-SQL-SUB > PC-MAX-RETRIES                                      
               MOVE '6000-SELECT-FROM-TSK' TO PV-PARAGRAPH-NAME                 
               MOVE 'SELECT FROM TSK' TO PV-DB2-OPER-ATTEMPTED                  
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  OPEN THE TVNDSTL CURSOR                                       *        
      ******************************************************************        
       7000-OPEN-TVNDSTL-CURSOR.                                                
                                                                                
           PERFORM WITH TEST AFTER                                              
               VARYING PV-SQL-SUB FROM 1 BY 1                                   
               UNTIL  (PV-SQL-SUB > PC-MAX-RETRIES                              
                  OR   SQLCODE = 0)                                             
                                                                                
               EXEC SQL                                                         
                   OPEN TVNDSTL_CSR                                             
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = ZERO                                          
                       CONTINUE                                                 
                   WHEN SQLWARN0 NOT = SPACES                                   
                   WHEN SQLCODE < 0                                             
                   WHEN SQLCODE > 0                                             
                       MOVE '7000-OPEN-TVNDSTL-CURSOR'                          
                           TO PV-PARAGRAPH-NAME                                 
                       MOVE 'OPEN TVNDSTL CURSOR'                               
                           TO PV-DB2-OPER-ATTEMPTED                             
                       PERFORM 9999-SQL-ABEND                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-SQL-SUB > PC-MAX-RETRIES                                      
               MOVE '7000-OPEN-TVNDSTL-CURSOR' TO PV-PARAGRAPH-NAME             
               MOVE 'OPEN TVNDSTL CURSOR' TO PV-DB2-OPER-ATTEMPTED              
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  FETCH A TVNDSTL CURSOR ROW                                    *        
      ******************************************************************        
       7010-FETCH-TVNDSTL-CURSOR.                                               
                                                                                
           PERFORM WITH TEST AFTER                                              
               VARYING PV-SQL-SUB FROM 1 BY 1                                   
               UNTIL  (PV-SQL-SUB > PC-MAX-RETRIES                              
                  OR   SQLCODE = 0                                              
                  OR   SQLCODE = +100)                                          
                                                                                
               EXEC SQL                                                         
                   FETCH  TVNDSTL_CSR                                           
                   INTO  :VNDSTL-VS-ID                                          
                        ,:VNDSTL-ENT-ID                                         
                        ,:VNDSTL-VS-NBR                                         
                        ,:VNDSTL-EFF-BEG-DTE                                    
                        ,:VNDSTL-EFF-END-DTE                                    
                        ,:VNDSTL-COST-UM-CDE                                    
                        ,:VNDSTL-RTL-UM-CDE                                     
                        ,:VNDSTL-BYP-CAT-IND                                    
                        ,:VNDSTL-CRE-BY-USR-ID                                  
                        ,:VNDSTL-LAST-UPD-BY-USR-ID                             
                        ,:VNDSTL-LAST-UPD-TMST                                  
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +100                                          
                       SET PS-END-OF-TVNDSTL-CSR TO TRUE                        
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = 0                                             
                       CONTINUE                                                 
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                       MOVE '7010-FETCH-TVNDSTL-CURSOR'                         
                           TO PV-PARAGRAPH-NAME                                 
                       MOVE 'FETCH CURSOR'                                      
                           TO PV-DB2-OPER-ATTEMPTED                             
                       PERFORM 9999-SQL-ABEND                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-SQL-SUB > PC-MAX-RETRIES                                      
               MOVE '7010-FETCH-TVNDSTL-CURSOR' TO PV-PARAGRAPH-NAME            
               MOVE 'MAX RETRIES EXCEEDED' TO PV-DB2-OPER-ATTEMPTED             
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  CLOSE THE TVNDSTL CURSOR                                      *        
      ******************************************************************        
       7020-CLOSE-TVNDSTL-CURSOR.                                               
                                                                                
           PERFORM WITH TEST AFTER                                              
               VARYING PV-SQL-SUB FROM 1 BY 1                                   
               UNTIL  (PV-SQL-SUB > PC-MAX-RETRIES                              
                  OR   SQLCODE = 0                                              
                  OR   SQLCODE = +100)                                          
                                                                                
               EXEC SQL                                                         
                   CLOSE TVNDSTL_CSR                                            
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +100                                          
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = ZERO                                          
                       CONTINUE                                                 
                   WHEN SQLWARN0 NOT = SPACES                                   
                   WHEN SQLCODE < 0                                             
                   WHEN SQLCODE > 0                                             
                       MOVE '7020-CLOSE-TVNDSTL-CURSOR'                         
                           TO PV-PARAGRAPH-NAME                                 
                       MOVE 'CLOSE CURSOR'                                      
                           TO PV-DB2-OPER-ATTEMPTED                             
                       PERFORM 9999-SQL-ABEND                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-SQL-SUB > PC-MAX-RETRIES                                      
               MOVE '7020-CLOSE-TVNDSTL-CURSOR' TO PV-PARAGRAPH-NAME            
               MOVE 'CLOSE CURSOR' TO PV-DB2-OPER-ATTEMPTED                     
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  OPEN THE TMDARVS CURSOR                                       *        
      ******************************************************************        
       7100-OPEN-TMDARVS-CURSOR.                                                
                                                                                
           PERFORM WITH TEST AFTER                                              
               VARYING PV-SQL-SUB FROM 1 BY 1                                   
               UNTIL  (PV-SQL-SUB > PC-MAX-RETRIES                              
                  OR   SQLCODE = 0)                                             
                                                                                
               EXEC SQL                                                         
                   OPEN TMDARVS_CSR                                             
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = ZERO                                          
                       CONTINUE                                                 
                   WHEN SQLWARN0 NOT = SPACES                                   
                   WHEN SQLCODE < 0                                             
                   WHEN SQLCODE > 0                                             
                       MOVE '7100-OPEN-TMDARVS-CURSOR'                          
                           TO PV-PARAGRAPH-NAME                                 
                       MOVE 'OPEN TMDARVS CURSOR'                               
                           TO PV-DB2-OPER-ATTEMPTED                             
                       PERFORM 9999-SQL-ABEND                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-SQL-SUB > PC-MAX-RETRIES                                      
               MOVE '7100-OPEN-TMDARVS-CURSOR' TO PV-PARAGRAPH-NAME             
               MOVE 'OPEN TMDARVS CURSOR' TO PV-DB2-OPER-ATTEMPTED              
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  FETCH A TMDARVS CURSOR ROW                                    *        
      ******************************************************************        
       7110-FETCH-TMDARVS-CURSOR.                                               
                                                                                
           PERFORM WITH TEST AFTER                                              
               VARYING PV-SQL-SUB FROM 1 BY 1                                   
               UNTIL  (PV-SQL-SUB > PC-MAX-RETRIES                              
                  OR   SQLCODE = 0                                              
                  OR   SQLCODE = +100)                                          
                                                                                
               EXEC SQL                                                         
                   FETCH  TMDARVS_CSR                                           
                   INTO  :MDARVS-SUB-CL-MDSEAR-ID                               
                        ,:MDARVS-VS-ID                                          
                        ,:MDARVS-ACTV-IND                                       
                        ,:MDARVS-VS-DESC                                        
                        ,:MDARVS-STKR-NBR                                       
                        ,:MDARVS-TKT-TYP-SEQ-NBR                                
                        ,:MDARVS-LBL-SEQ-NBR                                    
                        ,:MDARVS-HNG-FOLD-SEQ-NBR                               
                        ,:MDARVS-KY-CLSN-SEQ-NBR                                
                        ,:MDARVS-FBRCN-SEQ-NBR                                  
                        ,:MDARVS-FNSH-SEQ-NBR                                   
                        ,:MDARVS-RMS-STYL-ID                                    
                        ,:MDARVS-STYL-RECLS-IND                                 
                        ,:MDARVS-RTL-CLSN-SEQ-NBR                               
                        ,:MDARVS-DEPT-NBR                                       
                        ,:MDARVS-MAJ-CL-NBR                                     
                        ,:MDARVS-SUB-CL-NBR                                     
                        ,:MDARVS-ESL-SEQ-NBR                                    
                        ,:MDARVS-RPT-HIER-SEQ-NBR                               
                        ,:MDARVS-BDY-STYL-SEQ-NBR                               
                        ,:MDARVS-CONST-SEQ-NBR                                  
                        ,:MDARVS-FUNC-SEQ-NBR                                   
                        ,:MDARVS-GNDR-SEQ-NBR                                   
                        ,:MDARVS-PATRN-SEQ-NBR                                  
                        ,:MDARVS-SLHTT-SEQ-NBR                                  
                        ,:MDARVS-CLLCTN-SEQ-NBR                                 
                        ,:MDARVS-MAP-UNT-RTL-AMT                                
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +100                                          
                       SET PS-END-OF-TMDARVS-CSR TO TRUE                        
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = 0                                             
                       PERFORM 8100-WRITE-TMDARVS-RECORD                        
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                       MOVE '7110-FETCH-TMDARVS-CURSOR'                         
                           TO PV-PARAGRAPH-NAME                                 
                       MOVE 'FETCH CURSOR'                                      
                           TO PV-DB2-OPER-ATTEMPTED                             
                       PERFORM 9999-SQL-ABEND                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-SQL-SUB > PC-MAX-RETRIES                                      
               MOVE '7110-FETCH-TMDARVS-CURSOR' TO PV-PARAGRAPH-NAME            
               MOVE 'MAX RETRIES EXCEEDED' TO PV-DB2-OPER-ATTEMPTED             
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  CLOSE THE TMDARVS CURSOR                                      *        
      ******************************************************************        
       7120-CLOSE-TMDARVS-CURSOR.                                               
                                                                                
           PERFORM WITH TEST AFTER                                              
               VARYING PV-SQL-SUB FROM 1 BY 1                                   
               UNTIL  (PV-SQL-SUB > PC-MAX-RETRIES                              
                  OR   SQLCODE = 0                                              
                  OR   SQLCODE = +100)                                          
                                                                                
               EXEC SQL                                                         
                   CLOSE TMDARVS_CSR                                            
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +100                                          
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = ZERO                                          
                       CONTINUE                                                 
                   WHEN SQLWARN0 NOT = SPACES                                   
                   WHEN SQLCODE < 0                                             
                   WHEN SQLCODE > 0                                             
                       MOVE '7120-CLOSE-TMDARVS-CURSOR'                         
                           TO PV-PARAGRAPH-NAME                                 
                       MOVE 'CLOSE CURSOR'                                      
                           TO PV-DB2-OPER-ATTEMPTED                             
                       PERFORM 9999-SQL-ABEND                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-SQL-SUB > PC-MAX-RETRIES                                      
               MOVE '7120-CLOSE-TMDARVS-CURSOR' TO PV-PARAGRAPH-NAME            
               MOVE 'CLOSE CURSOR' TO PV-DB2-OPER-ATTEMPTED                     
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  OPEN THE TUPC CURSOR                                          *        
      ******************************************************************        
       7200-OPEN-TUPC-CURSOR.                                                   
                                                                                
           PERFORM WITH TEST AFTER                                              
               VARYING PV-SQL-SUB FROM 1 BY 1                                   
               UNTIL  (PV-SQL-SUB > PC-MAX-RETRIES                              
                  OR   SQLCODE = 0)                                             
                                                                                
               EXEC SQL                                                         
                   OPEN TUPC_CSR                                                
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = ZERO                                          
                       CONTINUE                                                 
                   WHEN SQLWARN0 NOT = SPACES                                   
                   WHEN SQLCODE < 0                                             
                   WHEN SQLCODE > 0                                             
                       MOVE '7200-OPEN-TUPC-CURSOR'                             
                           TO PV-PARAGRAPH-NAME                                 
                       MOVE 'OPEN TUPC CURSOR'                                  
                           TO PV-DB2-OPER-ATTEMPTED                             
                       PERFORM 9999-SQL-ABEND                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-SQL-SUB > PC-MAX-RETRIES                                      
               MOVE '7200-OPEN-TUPC-CURSOR' TO PV-PARAGRAPH-NAME                
               MOVE 'OPEN TUPC CURSOR' TO PV-DB2-OPER-ATTEMPTED                 
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  FETCH A TUPC CURSOR ROW                                       *        
      ******************************************************************        
       7210-FETCH-TUPC-CURSOR.                                                  
                                                                                
           PERFORM WITH TEST AFTER                                              
               VARYING PV-SQL-SUB FROM 1 BY 1                                   
               UNTIL  (PV-SQL-SUB > PC-MAX-RETRIES                              
                  OR   SQLCODE = 0                                              
                  OR   SQLCODE = +100)                                          
                                                                                
               EXEC SQL                                                         
                   FETCH  TUPC_CSR                                              
                   INTO  :UPC-UPC-ID                                            
                        ,:UPC-UPC-NBR                                           
                        ,:UPC-SUB-CL-MDSEAR-ID                                  
                        ,:UPC-VS-ID                                             
                        ,:UPC-INTR-UPC-ID                                       
                        ,:UPC-EFF-BEG-DTE                                       
                        ,:UPC-EFF-END-DTE                                       
                        ,:UPC-UPC-TYP-CDE                                       
                        ,:UPC-KOHLS-SIZE-CDE                                    
                        ,:UPC-NRF-SIZE-IND                                      
                        ,:UPC-NRF-CLOR-CDE                                      
                        ,:UPC-NRF-CLOR-IND                                      
                        ,:UPC-CSTM-CLOR-DESC                                    
                        ,:UPC-EDI-ORD-IND                                       
                        ,:UPC-PREPK-IND                                         
                        ,:UPC-GP-CDE                                            
                        ,:UPC-CERTD-IND                                         
                        ,:UPC-CERTD-DTE                                         
                        ,:UPC-RPLNMT-IND                                        
                        ,:UPC-KY-ITM-IND                                        
                        ,:UPC-UNT-COST-1ST-AMT                                  
                        ,:UPC-UPC-SRC-CDE                                       
                        ,:UPC-INNR-PK-QTY                                       
                        ,:UPC-OUTR-PK-QTY                                       
                        ,:UPC-SEA-SEQ-NBR                                       
                        ,:UPC-CRE-BY-USR-ID                                     
                        ,:UPC-LAST-UPD-BY-USR-ID                                
                        ,:UPC-LAST-UPD-TMST                                     
                        ,:UPC-WD-UM-QTY                                         
                        ,:UPC-DPTH-UM-QTY                                       
                        ,:UPC-HT-UM-QTY                                         
                        ,:UPC-SIZE-UM-CDE                                       
                        ,:UPC-WT-UM-QTY                                         
                        ,:UPC-WT-UM-CDE                                         
                        ,:UPC-POG-IND                                           
                        ,:UPC-REGN-PRIC-IND                                     
                        ,:UPC-TX-PRD-CDE-SEQ-NBR                                
                        ,:UPC-CUSTFACG-CLOR-DESC                                
                        ,:UPC-INTR-UPC-DESC                                     
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +100                                          
                       SET PS-END-OF-TUPC-CSR TO TRUE                           
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = 0                                             
                       PERFORM 8200-WRITE-TUPC-RECORD                           
                       IF UPC-UPC-TYP-CDE EQUAL PC-INT-UPC-ID                   
                                             OR PC-RENUM-UPC-ID                 
                           SET PS-PROCESS-TUPCPLS-CSR TO TRUE                   
                           PERFORM 7300-OPEN-TUPCPLS-CURSOR                     
                           PERFORM 7310-FETCH-TUPCPLS-CURSOR                    
                               UNTIL PS-END-OF-TUPCPLS-CSR                      
                           PERFORM 7320-CLOSE-TUPCPLS-CURSOR                    
                       END-IF                                                   
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                       MOVE '7210-FETCH-TUPC-CURSOR'                            
                           TO PV-PARAGRAPH-NAME                                 
                       MOVE 'FETCH CURSOR'                                      
                           TO PV-DB2-OPER-ATTEMPTED                             
                       PERFORM 9999-SQL-ABEND                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-SQL-SUB > PC-MAX-RETRIES                                      
               MOVE '7210-FETCH-TUPC-CURSOR' TO PV-PARAGRAPH-NAME               
               MOVE 'MAX RETRIES EXCEEDED' TO PV-DB2-OPER-ATTEMPTED             
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  CLOSE THE TUPC CURSOR                                         *        
      ******************************************************************        
       7220-CLOSE-TUPC-CURSOR.                                                  
                                                                                
           PERFORM WITH TEST AFTER                                              
               VARYING PV-SQL-SUB FROM 1 BY 1                                   
               UNTIL  (PV-SQL-SUB > PC-MAX-RETRIES                              
                  OR   SQLCODE = 0                                              
                  OR   SQLCODE = +100)                                          
                                                                                
               EXEC SQL                                                         
                   CLOSE TUPC_CSR                                               
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +100                                          
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = ZERO                                          
                       CONTINUE                                                 
                   WHEN SQLWARN0 NOT = SPACES                                   
                   WHEN SQLCODE < 0                                             
                   WHEN SQLCODE > 0                                             
                       MOVE '7220-CLOSE-TUPC-CURSOR'                            
                           TO PV-PARAGRAPH-NAME                                 
                       MOVE 'CLOSE CURSOR'                                      
                           TO PV-DB2-OPER-ATTEMPTED                             
                       PERFORM 9999-SQL-ABEND                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-SQL-SUB > PC-MAX-RETRIES                                      
               MOVE '7220-CLOSE-TUPC-CURSOR' TO PV-PARAGRAPH-NAME               
               MOVE 'CLOSE CURSOR' TO PV-DB2-OPER-ATTEMPTED                     
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  OPEN THE TUPCPLS CURSOR                                       *        
      ******************************************************************        
       7300-OPEN-TUPCPLS-CURSOR.                                                
                                                                                
           PERFORM WITH TEST AFTER                                              
               VARYING PV-SQL-SUB FROM 1 BY 1                                   
               UNTIL  (PV-SQL-SUB > PC-MAX-RETRIES                              
                  OR   SQLCODE = 0)                                             
                                                                                
               EXEC SQL                                                         
                   OPEN TUPCPLS_CSR                                             
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = ZERO                                          
                       CONTINUE                                                 
                   WHEN SQLWARN0 NOT = SPACES                                   
                   WHEN SQLCODE < 0                                             
                   WHEN SQLCODE > 0                                             
                       MOVE '7300-OPEN-TUPCPLS-CURSOR'                          
                           TO PV-PARAGRAPH-NAME                                 
                       MOVE 'OPEN TUPCPLS CURSOR'                               
                           TO PV-DB2-OPER-ATTEMPTED                             
                       PERFORM 9999-SQL-ABEND                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-SQL-SUB > PC-MAX-RETRIES                                      
               MOVE '7300-OPEN-TUPCPLS-CURSOR' TO PV-PARAGRAPH-NAME             
               MOVE 'OPEN TUPCPLS CURSOR' TO PV-DB2-OPER-ATTEMPTED              
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  FETCH A TUPCPLS CURSOR ROW                                    *        
      ******************************************************************        
       7310-FETCH-TUPCPLS-CURSOR.                                               
                                                                                
           PERFORM WITH TEST AFTER                                              
               VARYING PV-SQL-SUB FROM 1 BY 1                                   
               UNTIL  (PV-SQL-SUB > PC-MAX-RETRIES                              
                  OR   SQLCODE = 0                                              
                  OR   SQLCODE = +100)                                          
                                                                                
               EXEC SQL                                                         
                   FETCH  TUPCPLS_CSR                                           
                   INTO  :UPCPLS-UPC-ID                                         
                        ,:UPCPLS-OPERCO-NBR                                     
                        ,:UPCPLS-STR-NBR                                        
                        ,:UPCPLS-EFF-BEG-TMST                                   
                        ,:UPCPLS-EFF-END-TMST                                   
                        ,:UPCPLS-UPC-STAT-CDE                                   
                        ,:UPCPLS-UNT-COST-AMT                                   
                        ,:UPCPLS-UNT-RTL-AMT                                    
                        ,:UPCPLS-MEITGP-NBR                                     
                        ,:UPCPLS-CRE-BY-USR-ID                                  
                        ,:UPCPLS-CRE-TMST                                       
                        ,:UPCPLS-ITM-NBR                                        
                        ,:UPCPLS-PLU-IND                                        
                        ,:UPCPLS-UPC-STAT-CHG-DTE                               
                        ,:UPCPLS-UNT-RTL-CHG-DTE                                
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +100                                          
                       SET PS-END-OF-TUPCPLS-CSR TO TRUE                        
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = 0                                             
                       MOVE VNDSTL-VS-ID TO IM007-VS-ID                         
                       MOVE DCLTUPCPLS TO IM007-TUPCPLS-DATA                    
                       PERFORM 8300-WRITE-TUPCPLS-RECORD                        
                       IF UPC-UPC-TYP-CDE EQUAL PC-INT-UPC-ID                   
                         SET PS-PROCESS-TWEBITM-CSR TO TRUE                     
                         MOVE UPC-INTR-UPC-ID TO WEBITM-INTR-UPC-ID             
                         PERFORM 7400-OPEN-TWEBITM-CURSOR                       
                         PERFORM 7410-FETCH-TWEBITM-CURSOR                      
                               UNTIL PS-END-OF-TWEBITM-CSR                      
                         PERFORM 7420-CLOSE-TWEBITM-CURSOR                      
                       END-IF                                                   
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                       MOVE '7310-FETCH-TUPCPLS-CURSOR'                         
                           TO PV-PARAGRAPH-NAME                                 
                       MOVE 'FETCH CURSOR'                                      
                           TO PV-DB2-OPER-ATTEMPTED                             
                       PERFORM 9999-SQL-ABEND                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-SQL-SUB > PC-MAX-RETRIES                                      
               MOVE '7310-FETCH-TUPCPLS-CURSOR' TO PV-PARAGRAPH-NAME            
               MOVE 'MAX RETRIES EXCEEDED' TO PV-DB2-OPER-ATTEMPTED             
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  CLOSE THE TUPCPLS CURSOR                                      *        
      ******************************************************************        
       7320-CLOSE-TUPCPLS-CURSOR.                                               
                                                                                
           PERFORM WITH TEST AFTER                                              
               VARYING PV-SQL-SUB FROM 1 BY 1                                   
               UNTIL  (PV-SQL-SUB > PC-MAX-RETRIES                              
                  OR   SQLCODE = 0                                              
                  OR   SQLCODE = +100)                                          
                                                                                
               EXEC SQL                                                         
                   CLOSE TUPCPLS_CSR                                            
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +100                                          
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = ZERO                                          
                       CONTINUE                                                 
                   WHEN SQLWARN0 NOT = SPACES                                   
                   WHEN SQLCODE < 0                                             
                   WHEN SQLCODE > 0                                             
                       MOVE '7320-CLOSE-TUPCPLS-CURSOR'                         
                           TO PV-PARAGRAPH-NAME                                 
                       MOVE 'CLOSE CURSOR'                                      
                           TO PV-DB2-OPER-ATTEMPTED                             
                       PERFORM 9999-SQL-ABEND                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-SQL-SUB > PC-MAX-RETRIES                                      
               MOVE '7320-CLOSE-TUPCPLS-CURSOR' TO PV-PARAGRAPH-NAME            
               MOVE 'CLOSE CURSOR' TO PV-DB2-OPER-ATTEMPTED                     
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
      ******************************************************************        
      *  OPEN THE TWEBITM CURSOR                                       *        
      ******************************************************************        
       7400-OPEN-TWEBITM-CURSOR.                                                
                                                                                
           PERFORM WITH TEST AFTER                                              
               VARYING PV-SQL-SUB FROM 1 BY 1                                   
               UNTIL  (PV-SQL-SUB > PC-MAX-RETRIES                              
                  OR   SQLCODE = 0)                                             
                                                                                
               EXEC SQL                                                         
                   OPEN TWEBITM_CSR                                             
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = ZERO                                          
                       CONTINUE                                                 
                   WHEN SQLWARN0 NOT = SPACES                                   
                   WHEN SQLCODE < 0                                             
                   WHEN SQLCODE > 0                                             
                       MOVE '7400-OPEN-TWEBITM-CURSOR'                          
                           TO PV-PARAGRAPH-NAME                                 
                       MOVE 'OPEN TWEBITM CURSOR'                               
                           TO PV-DB2-OPER-ATTEMPTED                             
                       PERFORM 9999-SQL-ABEND                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-SQL-SUB > PC-MAX-RETRIES                                      
               MOVE '7300-OPEN-TWEBITM-CURSOR' TO PV-PARAGRAPH-NAME             
               MOVE 'OPEN TWEBITM CURSOR' TO PV-DB2-OPER-ATTEMPTED              
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  FETCH A TWEBITM CURSOR ROW                                    *        
      ******************************************************************        
       7410-FETCH-TWEBITM-CURSOR.                                               
                                                                                
           PERFORM WITH TEST AFTER                                              
               VARYING PV-SQL-SUB FROM 1 BY 1                                   
               UNTIL  (PV-SQL-SUB > PC-MAX-RETRIES                              
                  OR   SQLCODE = 0                                              
                  OR   SQLCODE = +100)                                          
                                                                                
               EXEC SQL                                                         
                   FETCH  TWEBITM_CSR                                           
                   INTO  :WEBITM-INTR-UPC-ID                                    
                        ,:WEBITM-EFF-BEG-TMST                                   
                        ,:WEBITM-EFF-END-TMST                                   
                        ,:WEBITM-ASRT-BEG-DTE                                   
                        ,:WEBITM-ASRT-END-DTE                                   
                        ,:WEBITM-STRG-AREA-SEQ-NBR                              
                        ,:WEBITM-SHIP-WD-QTY                                    
                        ,:WEBITM-SHIP-DPTH-QTY                                  
                        ,:WEBITM-SHIP-HT-QTY                                    
                        ,:WEBITM-SHIP-WT-QTY                                    
                        ,:WEBITM-SHIP-DIM-SRC-CDE                               
                        ,:WEBITM-PKG-SEQ-NBR                                    
                        ,:WEBITM-SHIP-RSTRC-SEQ-NBR                             
                        ,:WEBITM-GFT-WRAP-AVL-IND                               
                        ,:WEBITM-PRD-GP-NBR                                     
                        ,:WEBITM-PRD-GP-IND                                     
                        ,:WEBITM-SHIP-SRCHG-FEE-AMT                             
                        ,:WEBITM-SHIP-SRVC-SEQ-NBR                              
                        ,:WEBITM-SHIP-GP-SEQ-NBR                                
                        ,:WEBITM-CRE-BY-USR-ID                                  
                        ,:WEBITM-WEB-ITM-DLTD-IND                               
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +100                                          
                       SET PS-END-OF-TWEBITM-CSR TO TRUE                        
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = 0                                             
                       PERFORM 8400-WRITE-TWEBITM-RECORD                        
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                       MOVE '7410-FETCH-TWEBITM-CURSOR'                         
                           TO PV-PARAGRAPH-NAME                                 
                       MOVE 'FETCH CURSOR'                                      
                           TO PV-DB2-OPER-ATTEMPTED                             
                       PERFORM 9999-SQL-ABEND                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-SQL-SUB > PC-MAX-RETRIES                                      
               MOVE '7410-FETCH-TWEBITM-CURSOR' TO PV-PARAGRAPH-NAME            
               MOVE 'MAX RETRIES EXCEEDED' TO PV-DB2-OPER-ATTEMPTED             
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  CLOSE THE TWEBITM CURSOR                                      *        
      ******************************************************************        
       7420-CLOSE-TWEBITM-CURSOR.                                               
                                                                                
           PERFORM WITH TEST AFTER                                              
               VARYING PV-SQL-SUB FROM 1 BY 1                                   
               UNTIL  (PV-SQL-SUB > PC-MAX-RETRIES                              
                  OR   SQLCODE = 0                                              
                  OR   SQLCODE = +100)                                          
                                                                                
               EXEC SQL                                                         
                   CLOSE TWEBITM_CSR                                            
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = +100                                          
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = ZERO                                          
                       CONTINUE                                                 
                   WHEN SQLWARN0 NOT = SPACES                                   
                   WHEN SQLCODE < 0                                             
                   WHEN SQLCODE > 0                                             
                       MOVE '7420-CLOSE-TWEBITM-CURSOR'                         
                           TO PV-PARAGRAPH-NAME                                 
                       MOVE 'CLOSE CURSOR'                                      
                           TO PV-DB2-OPER-ATTEMPTED                             
                       PERFORM 9999-SQL-ABEND                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
                                                                                
           IF  PV-SQL-SUB > PC-MAX-RETRIES                                      
               MOVE '7420-CLOSE-TWEBITM-CURSOR' TO PV-PARAGRAPH-NAME            
               MOVE 'CLOSE CURSOR' TO PV-DB2-OPER-ATTEMPTED                     
               PERFORM 9999-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
       8000-WRITE-TVNDSTL-RECORD.                                               
                                                                                
           WRITE OUT-TVNDSTL-REC                                                
               FROM DCLTVNDSTL.                                                 
           ADD +1 TO PA-TVNDSTL-COUNT.                                          
                                                                                
                                                                                
       8100-WRITE-TMDARVS-RECORD.                                               
                                                                                
           WRITE OUT-TMDARVS-REC                                                
               FROM DCLTMDARVS.                                                 
           ADD +1 TO PA-TMDARVS-COUNT.                                          
                                                                                
                                                                                
       8200-WRITE-TUPC-RECORD.                                                  
                                                                                
           WRITE OUT-TUPC-REC FROM DCLTUPC.                                     
           ADD +1 TO PA-TUPC-COUNT.                                             
                                                                                
                                                                                
       8300-WRITE-TUPCPLS-RECORD.                                               
                                                                                
           WRITE OUT-TUPCPLS-REC FROM IM007-TUPCPLS-PURGE-RECORD.               
           ADD +1 TO PA-TUPCPLS-COUNT.                                          
                                                                                
       8400-WRITE-TWEBITM-RECORD.                                               
                                                                                
           WRITE OUT-TWEBITM-REC FROM DCLTWEBITM.                               
           ADD +1 TO PA-TWEBITM-COUNT.                                          
                                                                                
                                                                                
      ******************************************************************        
      *    - CLOSE THE FILES PROCESSED BY PROGRAM                      *        
      *    - DISPLAY OUTPUT RECORD COUNTS                              *        
      ******************************************************************        
       9000-EOJ-ROUTINE.                                                        
                                                                                
           PERFORM 7020-CLOSE-TVNDSTL-CURSOR.                                   
                                                                                
           CLOSE OUT-TVNDSTL-FILE                                               
                 OUT-TMDARVS-FILE                                               
                 OUT-TUPC-FILE                                                  
                 OUT-TUPCPLS-FILE                                               
                 OUT-TWEBITM-FILE.                                              
           DISPLAY SPACE.                                                       
           DISPLAY '*** TVNDSTL RECS DROPPED BECAUSE OF TSK RECS = '            
               PA-TVNDSTL-DROPPED-COUNT.                                        
           DISPLAY '*** NUMBER OF TVNDSTL RECS WRITTEN = '                      
               PA-TVNDSTL-COUNT.                                                
           DISPLAY '*** NUMBER OF TMDARVS RECS WRITTEN = '                      
               PA-TMDARVS-COUNT.                                                
           DISPLAY '*** NUMBER OF TUPC    RECS WRITTEN = '                      
               PA-TUPC-COUNT.                                                   
           DISPLAY '*** NUMBER OF TUPCPLS RECS WRITTEN = '                      
               PA-TUPCPLS-COUNT.                                                
           DISPLAY '*** NUMBER OF TWEBITM RECS WRITTEN = '                      
               PA-TWEBITM-COUNT.                                                
           DISPLAY SPACE.                                                       
                                                                                
                                                                                
      ******************************************************************        
      * ABEND THE PROGRAM IN THE EVENT THAT AN SQL ERROR OR WARNING             
      * CODE OCCURS.                                                            
      ******************************************************************        
       9999-SQL-ABEND.                                                          
                                                                                
           DISPLAY '** ABEND     **'.                                           
           DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                        
           DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.                      
           DISPLAY '** OPERATION ** = ' PV-DB2-OPER-ATTEMPTED.                  
                                                                                
      *-----------------------------------------------------------------        
      * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-            
      * MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE                 
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE             
      * FORMAT.                                                                 
      *-----------------------------------------------------------------        
                                                                                
           COPY DPPD004.                                                        
                                                                                
           MOVE +4013 TO ABEND-CODE.                                            
           CALL 'ILBOABN0' USING ABEND-CODE.                                    
                                                                               
