000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    SUKCS586.                                         00040000
000500 AUTHOR.        DENISE HAHN.                                      00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  DECEMBER 2001.                                    00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    S586 - PO AUDIT EXCEPTION LIST                             * 00110000
001200*    SULRNKLT                                                   * 00120000
001300*    THIS PROGRAM DISPLAYS A LIST OF PURCHASE ORDERS THAT HAVE  * 00130000
001310*    AUDIT EXCEPTIONS                                           * 00131000
001700*---------------------------------------------------------------* 00170000
001500*    CHANGES                                                     *00171000
      *    MADE BY: SHOBHIT BAIJAL       PR#5148D                      *00172000
      *    DATE:    10/07/2013                                         *00173000
      *                                                                *00174000
      *    NEW AUDIT TYPES 'RF' AND 'QC' WERE ADDED SO THAT THEY CAN   *00175000
      *    BE DISPLAYED WHEN AND RFID OR QC EXCEPTION IS DEFINED.      *00176000
      *    CHANGES CAN BE FOUND WITH *SB 10/07/13                      *00177000
001600*----------------------------------------------------------------*00178000
273427*    CHANGES                                                     *00179009
273427*    MADE BY: BARB SCHULTZ         CHG0273427                    *00179109
273427*    DATE:    08/15/2022                                         *00179209
273427*                                                                *00179309
273427* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE    *00179409
273427* MAKING THE CALL DYNAMIC VS STATIC.                             *00179509
001130*                                                                 00179610
001110* CHANGED 01/09/2023    BY JEAN KURK       WR: CHG0278099         00179710
001120* CHANGE CALL OF DPKCS030 TO BE DYNAMIC                           00179810
001600*----------------------------------------------------------------*00179907
001800 EJECT                                                            00180000
001900 ENVIRONMENT DIVISION.                                            00190000
002000                                                                  00200000
002100 DATA DIVISION.                                                   00210000
002200                                                                  00220000
002300 WORKING-STORAGE SECTION.                                         00230000
002400                                                                  00240000
002500 01  DK-DB2-KEYS.                                                 00250000
002600     05  DK-PO-NBR                    PIC S9(09) COMP VALUE ZERO. 00260000
002610     05  DK-PO-LINE-NBR               PIC S9(09) COMP VALUE ZERO. 00261000
002620     05  DK-PREPACK-ID                PIC S9(04) COMP VALUE ZERO. 00262000
002630     05  DK-OPER-UNT-ID               PIC S9(04) COMP VALUE ZERO. 00263000
002640     05  DK-OPER-FROM                 PIC S9(04) COMP VALUE ZERO. 00264000
002650     05  DK-OPER-TO                   PIC S9(04) COMP VALUE ZERO. 00265000
002660     05  DK-AUDIT-TYPE                PIC X(01).                  00266000
002670     05  DK-SHIP-FROM-DATE            PIC X(10).                  00267000
002680     05  DK-SHIP-TO-DATE              PIC X(10).                  00268000
002700                                                                  00270000
002800                                                                  00280000
002900 01  PC-PROGRAM-CONSTANTS.                                        00290000
003000     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00300000
003100                                                    'SUK586  '.   00310000
003200     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00320000
003300                                                    'SUKM586 '.   00330000
003400     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00340000
003500                                                    'SUKCS586'.   00350000
003800     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00380000
003900     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00390000
004000     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00400000
004100     05  PC-LIST-FORMAT                 PIC  X(01)  VALUE '2'.    00410000
004200     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +13     00420000
004300                                                    COMP SYNC.    00430000
004400     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00440000
004500                                                    COMP SYNC.    00450000
004600     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00460000
004700                                                    +1000000      00470000
004800                                                    COMP-3.       00480000
004900     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00490000
005000                                                    COMP SYNC.    00500000
005100     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00510000
005200                                                    COMP-3.       00520000
005300     05  PC-A                           PIC  X(01)  VALUE  'A'.   00530000
005400     05  PC-X                           PIC  X(01)  VALUE  'X'.   00540000
005500     05  PC-DEFAULT                     PIC  X(06)  VALUE         00550000
005600                                                     'DEFALT'.    00560000
005700     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00570000
005800     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00580000
005900     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00590000
006000     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00600000
006100*MESSAGE DEFINITIONS                                              00610000
006200*----------------------------------------------------------------*00620000
006300*  SYSTEM MESSAGES                                               *00630000
006400*----------------------------------------------------------------*00640000
006500*   00005 - INVALID VALUE                                        *00650000
006600*   00008 - MUST BE NUMERIC                                      *00660000
006700*   00045 - INVALID FUNCTION KEY                                 *00670000
006800*   00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED  *00680000
006900*   00051 - NO END OF RANGE HAS BEEN SPECIFIED                   *00690000
007000*   00052 - END OF RANGE PRECEDES START OF RANGE                 *00700000
007100*   00053 - NO START OF RANGE HAS BEEN SPECIFIED                 *00710000
007200*   00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED   *00720000
007300*   00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED     *00730000
007400*   00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       *00740000
007500*   00069 - TOP OF LIST                                          *00750000
007600*   00070 - BOTTOM OF LIST                                       *00760000
007700*   00101 - VALUE MUST BE > ZERO AND  < 1,000,000                *00770000
007710*   00115 - DELETE SUCCESSFUL                                    *00771000
007800*   00279 - MORE ITEMS TO DISPLAY                                *00780000
007900*   00954 - PO/RECEIVER SEQUENCE NOT FOUND                       *00790000
008000*   00984 - DATABASE IS BUSY, TRY AGAIN IN A FEW MINUTES         *00800000
008100*   02234 - PRINT REQUEST HAS BEEN COMPLETED FOR SELECTED LINE(S)*00810000
008200*   02238 - PRINT PROBLEM, TRY AGAIN - LINES UP TO THIS POINT HAV*00820000
008300*   02479 - RECEIVER SEQUENCE NUMBER MUST BE GREATER THAN ZERO   *00830000
008400*   02679 - UNABLE TO RE-ACTIVATE, NO INACTIVE SMOOTHING EXISTS F*00840000
008500*   02680 - NUMBER OF CRTNS MUST EQUAL NBR OF CRTNS FROM ORIGINAL*00850000
008600*   02681 - RE-ACTIVATION SUCCESSFUL                             *00860000
008700*   02683 - VEND UCC128 DATA EXISTS - F2 TO CONFIRM SMOOTHING    *00870000
008800*   02684 - SMOOTHING HAS NOT OCCURRED, UNABLE TO PERFORM FUNCTIO*00880000
008900*   02688 - UNABLE TO PERFORM FUNCTION, CARTON INACTIVE          *00890000
009000*   02691 - ONE OR MORE STORE(S) SELECTED HAS NOT BEEN SMOOTHED  *00900000
009100*   02692 - INVALID STATUS FOR FUNCTION REQUESTED                *00910000
009200*   02693 - COMMUNICATION ERROR WHEN CREATING LABELS - CONTACT SU*00920000
009300*   02694 - DATABASE ERROR WHEN CREATING LABELS - CONTACT SUPERVI*00930000
009410*   02848 - UNABLE TO DELETE - RANK IS CURRENTLY ASSIGNED VND/DPT*00941000
009411*   02849 - F2 TP CONFIRM DELETE                                 *00941100
009420*   02855 - DEFAULT AUDIT RANK CANNOT BE DELETED                 *00942000
009500                                                                  00950000
009600     05  PC-TSYMSG-NUMBERS.                                       00960000
009700         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00970000
009800         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00980000
009810         10  PC-TSYMSG-00016            PIC  9(05)  VALUE 00016.  00981000
009900         10  PC-TSYMSG-00045            PIC  9(05)  VALUE 00045.  00990000
010000         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01000000
010100         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01010000
010200         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01020000
010300         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01030000
010400         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01040000
010500         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01050000
010600         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01060000
010620         10  PC-TSYMSG-00059            PIC  9(05)  VALUE 00059.  01062000
010700         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01070000
010710         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01071000
010900         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01090000
011000         10  PC-TSYMSG-00115            PIC  9(05)  VALUE 00115.  01100000
011100         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01110000
011110         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  01111000
011200         10  PC-TSYMSG-02178            PIC  9(05)  VALUE 02178.  01120000
011300         10  PC-TSYMSG-02816            PIC  9(05)  VALUE 02816.  01130000
011310         10  PC-TSYMSG-02848            PIC  9(05)  VALUE 02848.  01131000
011311         10  PC-TSYMSG-02849            PIC  9(05)  VALUE 02849.  01131100
011320         10  PC-TSYMSG-02855            PIC  9(05)  VALUE 02855.  01132000
011400         10  PC-TSYMSG-02866            PIC  9(05)  VALUE 02866.  01140000
011500         10  PC-TSYMSG-02867            PIC  9(05)  VALUE 02867.  01150000
011600         10  PC-TSYMSG-02892            PIC  9(05)  VALUE 02892.  01160000
011700*                                                                 01170000
011800 01  PS-PROGRAM-SWITCHES.                                         01180000
011900     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01190000
012000         88  PS-NO-ERROR                            VALUE 'Y'.    01200000
012100         88  PS-ERROR                               VALUE 'N'.    01210000
012200     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01220000
012300         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01230000
012400         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01240000
012500     05  PS-LIST-END-SW           PIC  X(01)  VALUE 'N'.          01250000
012600         88  PS-LIST-END                      VALUE 'Y'.          01260000
012700         88  PS-NO-LIST-END                   VALUE 'N'.          01270000
012800     05  PS-BLOCK-ERROR-SW        PIC  X(01)  VALUE 'Y'.          01280000
012900         88  PS-NO-BLOCK-ERROR                VALUE 'Y'.          01290000
013000         88  PS-BLOCK-ERROR                   VALUE 'N'.          01300000
013100     05  PS-ACCESS-SW                   PIC  X(01)  VALUE 'N'.    01310000
013200         88  PS-ACCESS-ALLOWED                      VALUE 'Y'.    01320000
013300         88  PS-ACCESS-NOT-ALLOWED                  VALUE 'N'.    01330000
013400     05  PS-VND-DEPT-RNKG-EXISTS-SW     PIC  X(01)  VALUE 'N'.    01340000
013500         88  PS-VND-DEPT-RNKG-EXISTS                VALUE 'Y'.    01350000
013600         88  PS-NO-VND-DEPT-RNKG-EXISTS             VALUE 'N'.    01360000
013700     05  PS-VND-RNKG-EXISTS-SW          PIC  X(01)  VALUE 'N'.    01370000
013800         88  PS-VND-RNKG-EXISTS                     VALUE 'Y'.    01380000
013900         88  PS-NO-VND-RNKG-EXISTS                  VALUE 'N'.    01390000
014000     05  PS-PO-AUD-REQ-EXISTS-SW        PIC  X(01)  VALUE 'N'.    01400000
014100         88  PS-PO-AUD-REQ-EXISTS                   VALUE 'Y'.    01410000
014200         88  PS-NO-PO-AUD-REQ-EXISTS                VALUE 'N'.    01420000
014300     05  PS-END-OF-PACK-TYP-CSR-SW      PIC  X(01)  VALUE 'N'.    01430000
014400         88  PS-END-OF-PACK-TYP-CSR                 VALUE 'Y'.    01440000
014500         88  PS-NOT-END-OF-PACK-TYP-CSR             VALUE 'N'.    01450000
014600     05  PS-PKGNG-TYP-CDE-BC-SW         PIC  X(01)  VALUE 'N'.    01460000
014700         88  PS-PKGNG-TYP-CDE-BC-YES                VALUE 'Y'.    01470000
014800         88  PS-PKGNG-TYP-CDE-BC-NO                 VALUE 'N'.    01480000
014900     05  PS-PKGNG-TYP-CDE-PP-SW         PIC  X(01)  VALUE 'N'.    01490000
015000         88  PS-PKGNG-TYP-CDE-PP-YES                VALUE 'Y'.    01500000
015100         88  PS-PKGNG-TYP-CDE-PP-NO                 VALUE 'N'.    01510000
015200     05  PS-PKGNG-TYP-CDE-PS-SW         PIC  X(01)  VALUE 'N'.    01520000
015300         88  PS-PKGNG-TYP-CDE-PS-YES                VALUE 'Y'.    01530000
015400         88  PS-PKGNG-TYP-CDE-PS-NO                 VALUE 'N'.    01540000
015500*                                                                 01550000
015600 01  DN-DB2-NULL-INDICATORS.                                      01560000
015700     05  DN-CRE-TM                  PIC S9(04) COMP VALUE ZEROES. 01570000
015800*                                                                 01580000
015900 01  PV-PROGRAM-VARIABLES.                                        01590000
016000     05  PV-SEL-TERM-ID                  PIC  X(04).              01600000
016100     05  PV-SEL-TASK-NUMBER              PIC  9(05).              01610000
016200     05  PV-SEL-SEQ                      PIC  9(01).              01620000
016300     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACE. 01630000
016400     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01640000
016500                                                     COMP SYNC.   01650000
016600     05  PV-SUB                         PIC S9(04)  VALUE +0      01660000
016700                                                    COMP SYNC.    01670000
016800     05  PV-DB2-CURRENT-DATE            PIC X(10).                01680000
016900     05  PV-PLND-INV-DTE-FUNC-QTY       PIC X(10).                01690000
017000     05  PV-DB2-CURRENT-TIMESTAMP       PIC X(26).                01700000
017100     05  PV-CURRENT-DATE                PIC X(10).                01710000
017200     05  PV-CURRENT-TIME                PIC  9(06).               01720000
017300     05  PV-NUMBER-OF-UPDATES           PIC S9(04)  VALUE +0      01730000
017400                                                    COMP-3.       01740000
017500     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01750000
017600                                                    COMP SYNC.    01760000
017700     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01770000
017800                                                    COMP-3.       01780000
017900     05  PV-COUNT                       PIC S9(09)  VALUE +0      01790000
018000                                                    COMP-3.       01800000
018100     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01810000
018200                                                    COMP-3.       01820000
018300     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01830000
018400                                                    COMP-3.       01840000
018500     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01850000
018600                                                    COMP-3.       01860000
018700     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01870000
018800                                                    COMP SYNC.    01880000
018900     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01890000
019000                                                    COMP SYNC.    01900000
019100     05  PV-ITEM                        PIC S9(04)  VALUE +0      01910000
019200                                                    COMP SYNC.    01920000
019300     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01930000
019400                                                    COMP SYNC.    01940000
019500     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01950000
019600                                                    COMP SYNC.    01960000
019700     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01970000
019800                                                    COMP SYNC.    01980000
019900     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01990000
020000                                                    COMP SYNC.    02000000
020100     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      02010000
020200                                                    COMP SYNC.    02020000
020300     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02030000
020400                                                    COMP SYNC.    02040000
020500     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02050000
020600                                                    COMP SYNC.    02060000
020700     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      02070000
020800                                                    COMP SYNC.    02080000
020900     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      02090000
021000                                                    COMP SYNC.    02100000
021100     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      02110000
021200                                                    COMP SYNC.    02120000
021300     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      02130000
021400                                                    COMP SYNC.    02140000
021500     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02150000
021600                                                    COMP-3.       02160000
021700*                                                                 02170000
021800     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      02180000
021900                                                    COMP-3.       02190000
022000     05  PV-ORIGINAL-BLOCK              PIC S9(04)  VALUE +0      02200000
022100                                                    COMP SYNC.    02210000
022200     05  PV-ITEMS-HOLD                  PIC S9(03)  COMP-3.       02220000
022300     05  PV-ITEMS-DIFF                  PIC S9(03)  COMP-3.       02230000
022400     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      02240000
022500                                                    COMP-3.       02250000
022510     05  PV-AUD-CRE-DATE              PIC X(10).                  02251000
022520     05  PV-AUD-LAST-UPD-DATE         PIC X(10).                  02252000
022530     05  PV-SHP-DONT-SHIP-BEF-DTE     PIC X(10).                  02253000
022540     05  PV-SHP-CAN-IFNOT-SHIP-DTE    PIC X(10).                  02254000
022550     05  PV-NULL-SHIP-IND             PIC S9(4) VALUE ZERO        02255000
022560                                                COMP SYNC.        02256000
022570     05  PV-NULL-CANC-IND             PIC S9(4) VALUE ZERO        02257000
022580                                                COMP SYNC.        02258000
022590     05  PV-DISP-4                    PIC 9(04).                  02259000
022600                                                                  02260000
022700******************************************************************02270000
022800**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **02280000
022900**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **02290000
023000**  APPLICATION-SPECIFIC COMMAREA.                              **02300000
023100******************************************************************02310000
023200 01  LQW-LIST-QUEUE-WORK-AREA.                                    02320000
023300     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02330000
023400     05  LQW-ITEM-ENTRIES               OCCURS 13 TIMES           02340000
023500                                        INDEXED BY LQW-IDX.       02350000
023600         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02360000
023700*                                                                 02370000
023800         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02380000
023900         10  LQW-SELECTED-SW            PIC  X(01).               02390000
024000             88  LQW-SELECT                         VALUE 'S'.    02400000
024100             88  LQW-DESELECT                       VALUE ' '.    02410000
024200             88  LQW-PRT                            VALUE 'P'.    02420000
024300         10  LQW-ACTION                 PIC  X(03).               02430000
024400         10  LQW-PO-NBR               PIC  9(09).                 02440000
024500         10  LQW-PO-LINE              PIC  9(04).                 02450000
024600         10  LQW-PREPACK-ID           PIC  9(04).                 02460000
024700         10  LQW-OPER-UNT-ID          PIC  9(04).                 02470000
024800         10  LQW-AUDIT-TYPE           PIC  X(03).                 02480000
024810         10  LQW-AUDIT-CRE-DATE       PIC  X(08).                 02481000
024820         10  LQW-AUDIT-UPD-DATE       PIC  X(08).                 02482000
024830         10  LQW-SHIP-DATE            PIC  X(08).                 02483000
024840         10  LQW-CANCEL-DATE          PIC  X(08).                 02484000
024850         10  LQW-USER-ID              PIC  X(08).                 02485000
024900                                                                  02490000
025000                                                                  02500000
025100     EJECT                                                        02510000
025200*---------------------------------------------------------------* 02520000
025300*  RECORD LAYOUT FOR THE MESSAGE SELECTION TEMP STORAGE QUEUE.  * 02530000
025400*---------------------------------------------------------------* 02540000
025500                                                                  02550000
025600     COPY SUWS022.                                                02560000
025700                                                                  02570000
026300/                                                                 02630000
026400*----------------------------------------------------------------*02640000
026500*  WORK AREA PASSED IN CALL TO DPKUT500                          *02650000
026600*----------------------------------------------------------------*02660000
026700     COPY DPWS500.                                                02670000
026800                                                                  02680000
026900*----------------------------------------------------------------*02690000
027000*    CURRENT DATE COPYBOOK.                                       02700000
027100*----------------------------------------------------------------*02710000
027200                                                                  02720000
027300     COPY DPWS017.                                                02730000
027400*----------------------------------------------------------------*02740000
027500*  SENDING/RECEIVING AREA FOR THE                                 02750000
027600*  PRINTER VALIDATION ROUTING (DPKCS060)                          02760000
027700*----------------------------------------------------------------*02770000
027800     COPY DPWS072.                                                02780000
027900                                                                  02790000
028000*---------------------------------------------------------------* 02800000
028100*    MAP LAYOUT                                                 * 02810000
028200*---------------------------------------------------------------* 02820000
028300                                                                  02830000
028400     COPY SUKM586.                                                02840000
028500*                                                                 02850000
028600 01  MR-OCCURS-LAYOUT                 REDEFINES  SUK586O.         02860000
028700     05  FILLER                       PIC X(042).                 02870000
028800     05  MR-SCROLL-AREA                 OCCURS 13 TIMES.          02880000
028900         10  MR-SELECTL               PIC S9(04) COMP.            02890000
029000         10  MR-SELECTA               PIC  X(01).                 02900000
029100         10  MR-SELECTC               PIC  X(01).                 02910000
029200         10  MR-SELECTH               PIC  X(01).                 02920000
029300         10  MR-SELECTI               PIC  X(01).                 02930000
029400                                                                  02940000
029500         10  MR-ACTIONL               PIC S9(04) COMP.            02950000
029600         10  MR-ACTIONA               PIC  X(01).                 02960000
029700         10  MR-ACTIONC               PIC  X(01).                 02970000
029800         10  MR-ACTIONH               PIC  X(01).                 02980000
029900         10  MR-ACTION                PIC  X(03).                 02990000
030000                                                                  03000000
030100         10  MR-PO-L                  PIC S9(04) COMP.            03010000
030200         10  MR-PO-A                  PIC  X(01).                 03020000
030300         10  MR-PO-C                  PIC  X(01).                 03030000
030400         10  MR-PO-H                  PIC  X(01).                 03040000
030500         10  MR-PO                    PIC  Z(09).                 03050000
030600                                                                  03060000
030700         10  MR-LINE-L                PIC S9(04) COMP.            03070000
030800         10  MR-LINE-A                PIC  X(01).                 03080000
030900         10  MR-LINE-C                PIC  X(01).                 03090000
031000         10  MR-LINE-H                PIC  X(01).                 03100000
031100         10  MR-LINE                  PIC  X(06).                 03110000
031200                                                                  03120000
031300         10  MR-OPER-L                PIC S9(04) COMP.            03130000
031400         10  MR-OPER-A                PIC  X(01).                 03140000
031500         10  MR-OPER-C                PIC  X(01).                 03150000
031600         10  MR-OPER-H                PIC  X(01).                 03160000
031700         10  MR-OPER                  PIC  Z(04).                 03170000
031800                                                                  03180000
031900         10  MR-TYPE-L                PIC S9(04) COMP.            03190000
032000         10  MR-TYPE-A                PIC  X(01).                 03200000
032100         10  MR-TYPE-C                PIC  X(01).                 03210000
032200         10  MR-TYPE-H                PIC  X(01).                 03220000
032300         10  MR-TYPE                  PIC  X(03).                 03230000
032400                                                                  03240000
032500         10  MR-CREATE-DATE-L         PIC S9(04) COMP.            03250000
032600         10  MR-CREATE-DATE-A         PIC  X(01).                 03260000
032700         10  MR-CREATE-DATE-C         PIC  X(01).                 03270000
032800         10  MR-CREATE-DATE-H         PIC  X(01).                 03280000
032900         10  MR-CREATE-DATE           PIC  X(08).                 03290000
033000                                                                  03300000
033010         10  MR-UPDATE-DATE-L         PIC S9(04) COMP.            03301000
033020         10  MR-UPDATE-DATE-A         PIC  X(01).                 03302000
033030         10  MR-UPDATE-DATE-C         PIC  X(01).                 03303000
033040         10  MR-UPDATE-DATE-H         PIC  X(01).                 03304000
033050         10  MR-UPDATE-DATE           PIC  X(08).                 03305000
033060                                                                  03306000
033070         10  MR-SHIP-DATE-L           PIC S9(04) COMP.            03307000
033080         10  MR-SHIP-DATE-A           PIC  X(01).                 03308000
033090         10  MR-SHIP-DATE-C           PIC  X(01).                 03309000
033091         10  MR-SHIP-DATE-H           PIC  X(01).                 03309100
033092         10  MR-SHIP-DATE             PIC  X(08).                 03309200
033093                                                                  03309300
033094         10  MR-CANCEL-DATE-L         PIC S9(04) COMP.            03309400
033095         10  MR-CANCEL-DATE-A         PIC  X(01).                 03309500
033096         10  MR-CANCEL-DATE-C         PIC  X(01).                 03309600
033097         10  MR-CANCEL-DATE-H         PIC  X(01).                 03309700
033098         10  MR-CANCEL-DATE           PIC  X(08).                 03309800
033099                                                                  03309900
033100         10  MR-USER-L                PIC S9(04) COMP.            03310000
033101         10  MR-USER-A                PIC  X(01).                 03310100
033102         10  MR-USER-C                PIC  X(01).                 03310200
033103         10  MR-USER-H                PIC  X(01).                 03310300
033104         10  MR-USER                  PIC  X(08).                 03310400
033105                                                                  03310500
033110     05  FILLER                         PIC  X(12).               03311000
033300                                                                  03330000
033400     EJECT                                                        03340000
033500/                                                                 03350000
034100*----------------------------------------------------------------*03410000
034200**  SECURITY SUBROUTINE PARAMETERS                                03420000
034300*----------------------------------------------------------------*03430000
034400     COPY DPWS008.                                                03440000
034500*---------------------------------------------------------------* 03450000
034600*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03460000
034700*---------------------------------------------------------------* 03470000
034800                                                                  03480000
034900     COPY DPWS015.                                                03490000
035000                                                                  03500000
035001*---------------------------------------------------------------* 03500100
035010*    NUMERIC EDIT LAYOUT.                                       * 03501000
035011*---------------------------------------------------------------* 03501100
035012                                                                  03501200
035020     COPY DPWS010I.                                               03502000
035030                                                                  03503000
035100*---------------------------------------------------------------* 03510000
035200*    FUNCTION KEYS COPYBOOK.                                    * 03520000
035300*---------------------------------------------------------------* 03530000
035400                                                                  03540000
035500     COPY DPWS016.                                                03550000
035600                                                                  03560000
036300*---------------------------------------------------------------* 03630000
036400*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * 03640010
036500*---------------------------------------------------------------* 03650000
036600                                                                  03660000
036700     COPY DPWS030.                                                03670000
036700     COPY DPWS930.                                                03671010
036800 EJECT                                                            03680000
036900*---------------------------------------------------------------* 03690000
037000*    STANDARD COMMAREA.                                         * 03700000
037100*---------------------------------------------------------------* 03710000
037200                                                                  03720000
037300     COPY DPWS020.                                                03730000
037400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03740000
037500                                                                  03750000
037600*---------------------------------------------------------------* 03760000
037700* INTER-APPLICATION COMMAREA.                                   * 03770000
037800*   SUWS020 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 03780000
037900*             SPEC SCREEN.                                      * 03790000
038000*   SUWS021 - IS THE INPUT  LAYOUT THAT WILL BE PASSED TO THE   * 03800000
038100*             ADD/UPDATE SCREEN.                                * 03810000
038200*---------------------------------------------------------------* 03820000
038300                                                                  03830000
038400         10  INTER-APPL-COMM-AREA       PIC X(200).               03840000
038500     COPY SUWS020.                                                03850000
038600     COPY SUWS021.                                                03860000
038700*---------------------------------------------------------------* 03870000
038800*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03880000
038900*---------------------------------------------------------------* 03890000
039000         10  ASC-SPECIFIC-COMMAREA.                               03900000
039100             15  ASC-LIST-KEYS.                                   03910000
039200                 20  ASC-AUDIT-RANK-KEY              PIC  X(06).  03920000
039300                 20  ASC-AUDIT-DESC-KEY              PIC  X(30).  03930000
039400             15  ASC-BLK-SUB                         PIC S9(04)   03940000
039500                                                          COMP    03950000
039600                                                          SYNC.   03960000
039700             15  ASC-ITEM-SUB                        PIC S9(04)   03970000
039800                                                          COMP    03980000
039900                                                          SYNC.   03990000
040000             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   04000000
040100                                                          COMP-3. 04010000
040200             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   04020000
040300                                                          COMP-3. 04030000
040400             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   04040000
040500                                                          COMP-3. 04050000
040600             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   04060000
040700                                                          COMP-3. 04070000
040800             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   04080000
040900                                                          COMP-3. 04090000
041000             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   04100000
041100                                                          COMP    04110000
041200                                                          SYNC.   04120000
041300             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   04130000
041400                                                          COMP-3. 04140000
041500             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   04150000
041600                                                          COMP-3. 04160000
041700             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  04170000
041800                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   04180000
041900                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   04190000
042000             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  04200000
042100                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   04210000
042200                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   04220000
042300             15  ASC-LIST-QUEUE-NAME.                             04230000
042400                 20  ASC-LIST-TERM-ID                PIC  X(04).  04240000
042500                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04250000
042600                                                          COMP-3. 04260000
042700                 20  ASC-LIST-SEQ                    PIC  9(01).  04270000
042800             15  ASC-SEL-QUEUE-NAME.                              04280000
042900                 20  ASC-SEL-TERM-ID          PIC  X(04).         04290000
043000                 20  ASC-SEL-TASK-NUMBER      PIC S9(05) COMP-3.  04300000
043100                 20  ASC-SEL-SEQ              PIC  9(01).         04310000
043200             15  ASC-SEL-QUEUE-NAME-IN.                           04320000
043300                 20  ASC-SEL-TERM-ID-IN       PIC  X(04).         04330000
043400                 20  ASC-SEL-TASK-NUMBER-IN   PIC S9(05) COMP-3.  04340000
043500                 20  ASC-SEL-SEQ-IN           PIC  9(01).         04350000
043600                                                                  04360000
043700             15  ASC-START-ITEM-REQUEST.                          04370000
043800                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04380000
043900*                                                                 04390000
044000             15  ASC-SEL-SUB                  PIC S9(4) COMP.     04400000
044100             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     04410000
044200             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          04420000
044300                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 04430000
044400             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  04440000
044500                                                                  04450000
044600                                                                  04460000
044700             15  ASC-FUNC01-RETURN-FLAG       PIC  X(1).          04470000
044800                 88  ASC-FUNC01-RETURN-NO   VALUE 'N'.            04480000
044900                 88  ASC-FUNC01-RETURN-YES  VALUE 'Y'.            04490000
045000                                                                  04500000
045100             15  ASC-FUNC02-RETURN-FLAG       PIC  X(1).          04510000
045200                 88  ASC-FUNC02-RETURN-NO   VALUE 'N'.            04520000
045300                 88  ASC-FUNC02-RETURN-YES  VALUE 'Y'.            04530000
045400                                                                  04540000
045500                                                                  04550000
045600             15  ASC-CONFIRM-TYPE-IND         PIC  X(01).         04560000
045700                 88  ASC-CONFIRM-UCC128          VALUE 'U'.       04570000
045800                 88  ASC-NO-CONFIRM-UCC128       VALUE 'N'.       04580000
045900                                                                  04590000
046000             15  ASC-CONFIRM-DELETE-SW        PIC  X(01).         04600000
046100                 88  ASC-CONFIRM-DELETE          VALUE 'I'.       04610000
046200                 88  ASC-NO-CONFIRM-DELETE       VALUE 'N'.       04620000
046300                                                                  04630000
046310                                                                  04631000
046311             15  ASC-CURSOR-SW                       PIC  X(03).  04631100
046312                 88  ASC-PO-CSR                      VALUE 'P-O'. 04631200
046313                 88  ASC-PO-OPER-CSR                 VALUE 'PAO'. 04631300
046314                 88  ASC-OPER-CSR                    VALUE 'O-A'. 04631400
046315             15  ASC-LIST-KEYS.                                   04631500
046316                 20  ASC-KEY-PO-NBR   PIC S9(09) COMP.            04631600
046317                 20  ASC-KEY-PO-LINE-NBR                          04631700
046318                                      PIC S9(09) COMP.            04631800
046319                 20  ASC-KEY-PREPACK-ID                           04631900
046320                                      PIC S9(04) COMP.            04632000
046321                 20  ASC-KEY-OPER-UNT-ID                          04632100
046322                                      PIC S9(04) COMP.            04632200
046323                 20  ASC-KEY-OPER-ALL                             04632300
046324                                      PIC X(03).                  04632400
046325                 20  ASC-KEY-AUDIT-TYPE                           04632500
046326                                      PIC X(01).                  04632600
046327                 20  ASC-KEY-AUDIT-TYPE-1                         04632700
046328                                      PIC X(01).                  04632800
046329                 20  ASC-KEY-AUDIT-TYPE-2                         04632900
046330                                      PIC X(01).                  04633000
      *SB 10/07/13 - BEGIN PR#5148D                                     04633100
046329                 20  ASC-KEY-AUDIT-TYPE-3                         04633200
046330                                      PIC X(01).                  04633300
046329                 20  ASC-KEY-AUDIT-TYPE-4                         04633400
046330                                      PIC X(01).                  04633500
      *SB 10/07/13 - END PR#5148D                                       04633600
046331                 20  ASC-KEY-SHIP-FROM-DATE                       04633700
046332                                      PIC X(10).                  04633800
046333                 20  ASC-KEY-SHIP-TO-DATE                         04633900
046334                                      PIC X(10).                  04634000
046340                                                                  04635000
046400             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                04640000
046500                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  04650000
046600                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   04660000
046700                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   04670000
046800                                                                  04680000
046900                 20  ASC-ITEM-ARRAY.                              04690000
047000                     25  ASC-ITEM-ENTRIES OCCURS 13 TIMES.        04700000
047100                         30  ASC-LIST-ITEM-NUMBER                 04710000
047200                                                     PIC S9(09)   04720000
047300                                                     COMP-3.      04730000
047400                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  04740000
047500                             88  ASC-VALID-SELECT    VALUE ' '    04750000
047600                                                           'S'    04760000
047700                                                           'B'    04770000
047800                                                           'E'.   04780000
047900                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   04790000
048000                             88  ASC-TEMP-SELECT     VALUE 'S'.   04800000
048100                             88  ASC-TEMP-BEGIN      VALUE 'B'.   04810000
048200                             88  ASC-TEMP-END        VALUE 'E'.   04820000
048300                         30  ASC-SELECTED-SW         PIC  X(01).  04830000
048400                             88  ASC-NO-SELECT       VALUE ' '.   04840000
048500                             88  ASC-SELECT          VALUE 'S'.   04850000
048600                             88  ASC-BEGIN           VALUE 'B'.   04860000
048700                             88  ASC-END             VALUE 'E'.   04870000
048800                         30  ASC-ACTION             PIC  X(03).   04880000
048900                         30  ASC-PO-NBR              PIC  9(09).  04890000
049000                         30  ASC-PO-LINE             PIC  9(04).  04900000
049100                         30  ASC-PREPACK-ID          PIC  9(04).  04910000
049200                         30  ASC-OPER-UNT-ID         PIC  9(04).  04920000
049300                         30  ASC-AUDIT-TYPE          PIC  X(03).  04930000
049310                         30  ASC-AUDIT-CRE-DATE      PIC  X(08).  04931000
049320                         30  ASC-AUDIT-UPD-DATE      PIC  X(08).  04932000
049330                         30  ASC-SHIP-DATE           PIC  X(08).  04933000
049340                         30  ASC-CANCEL-DATE         PIC  X(08).  04934000
049350                         30  ASC-USER-ID             PIC  X(08).  04935000
049400                                                                  04940000
049500     EJECT                                                        04950000
049600*---------------------------------------------------------------* 04960000
049700*    ABEND PROCESSING COPYBOOK.                                 * 04970000
049800*---------------------------------------------------------------* 04980000
049900                                                                  04990000
050000     COPY DPWS013.                                                05000000
050100                                                                  05010000
050200 EJECT                                                            05020000
050300*----------------------------------------------------------------*05030000
050400*    DB2 DCLGEN FOR THE PO AUDIT REQUEST TABLE                    05040000
050500*----------------------------------------------------------------*05050000
050600     EXEC SQL                                                     05060000
050700          INCLUDE SUT00014                                        05070000
050800     END-EXEC.                                                    05080000
050900                                                                  05090000
050910     EXEC SQL                                                     05091000
050920          INCLUDE TPLNSHP                                         05092000
050930     END-EXEC.                                                    05093000
055100*---------------------------------------------------------------* 05510000
055200*    DB2 AREA FOR COMMUNICATIONS                                * 05520000
055300*---------------------------------------------------------------* 05530000
055400     EXEC SQL                                                     05540000
055500          INCLUDE SQLCA                                           05550000
055600     END-EXEC.                                                    05560000
055700                                                                  05570000
055800******************************************************************05580000
055900*  CURSOR TO BUILD THE AUDIT EXCEPTION LIST FOR SPECIFIC PO     **05590000
056000******************************************************************05600000
056200                                                                  05620000
056300     EXEC SQL                                                     05630000
056400          DECLARE PO-CSR CURSOR FOR                               05640000
056500          SELECT A.PO_NBR                                         05650000
056600               , A.PO_LNE_NBR                                     05660000
056610               , A.PO_PREPK_ID                                    05661000
056620               , A.OPER_UNT_ID                                    05662000
056630               , A.AUD_TYP_CDE                                    05663000
056640               , CHAR(DATE(A.CRE_TMST),USA)                       05664000
056641               , CHAR(DATE(A.LAST_UPD_TMST),USA)                  05664100
056650               , A.LAST_UPD_BY_USR_ID                             05665000
056660               , CHAR(B.DONT_SHIP_BEF_DTE,USA)                    05666000
056670               , CHAR(B.CAN_IFNOT_SHIP_DTE,USA)                   05667000
056700          FROM   SUT_PO_AUD_EXC A                                 05670000
056710                                                                  05671000
056720          LEFT   OUTER JOIN                                       05672000
056730                 TPLNSHP B                                        05673000
056740             ON  A.PO_NBR    =  B.PO_NBR                          05674000
056750          WHERE  A.PO_NBR    =  :DK-PO-NBR                        05675000
056760            AND  A.AUD_TYP_CDE  IN  (:ASC-KEY-AUDIT-TYPE-1,       05676000
056770                                     :ASC-KEY-AUDIT-TYPE-2,       05677000
      *SB 10/07/13 - END PR#5148D                                       05677100
056770                                     :ASC-KEY-AUDIT-TYPE-3,       05677200
056770                                     :ASC-KEY-AUDIT-TYPE-4)       05677300
      *SB 10/07/13 - END PR#5148D                                       05677400
056780            AND  DATE(B.DONT_SHIP_BEF_DTE)  BETWEEN               05678000
056790                 :ASC-KEY-SHIP-FROM-DATE  AND                     05679000
056791                 :ASC-KEY-SHIP-TO-DATE                            05679100
056792            AND  B.VER_STATUS_CDE = 'A'                           05679200
056793                                                                  05679300
056800          ORDER BY A.OPER_UNT_ID                                  05680000
056810                  ,A.PO_NBR                                       05681000
056820                  ,A.PO_LNE_NBR                                   05682000
056830                  ,A.PO_PREPK_ID                                  05683000
056840                                                                  05684000
056900     END-EXEC.                                                    05690000
057000                                                                  05700000
057100                                                                  05710000
057210******************************************************************05721000
057220*  CURSOR TO BUILD THE AUDIT EXCEPTION LIST FOR SPECIFIC PO-OPER**05722000
057230******************************************************************05723000
057240                                                                  05724000
057250     EXEC SQL                                                     05725000
057260          DECLARE PO-OPER-CSR CURSOR FOR                          05726000
057270          SELECT A.PO_NBR                                         05727000
057280               , A.PO_LNE_NBR                                     05728000
057290               , A.PO_PREPK_ID                                    05729000
057291               , A.OPER_UNT_ID                                    05729100
057292               , A.AUD_TYP_CDE                                    05729200
057293               , CHAR(DATE(A.CRE_TMST),USA)                       05729300
057294               , CHAR(DATE(A.LAST_UPD_TMST),USA)                  05729400
057295               , A.LAST_UPD_BY_USR_ID                             05729500
057296               , CHAR(B.DONT_SHIP_BEF_DTE,USA)                    05729600
057297               , CHAR(B.CAN_IFNOT_SHIP_DTE,USA)                   05729700
057298          FROM   SUT_PO_AUD_EXC A                                 05729800
057299                                                                  05729900
057300          LEFT   OUTER JOIN                                       05730000
057301                 TPLNSHP B                                        05730100
057302             ON  A.PO_NBR    =  B.PO_NBR                          05730200
057303          WHERE  A.PO_NBR    =  :DK-PO-NBR                        05730300
057304            AND  A.OPER_UNT_ID BETWEEN                            05730400
057305                                     :DK-OPER-FROM  AND           05730500
057306                                     :DK-OPER-TO                  05730600
057307            AND  A.AUD_TYP_CDE  IN  (:ASC-KEY-AUDIT-TYPE-1,       05730700
057308                                     :ASC-KEY-AUDIT-TYPE-2,       05730800
      *SB 10/07/13 - END PR#5148D                                       05730900
057308                                     :ASC-KEY-AUDIT-TYPE-3,       05731000
057308                                     :ASC-KEY-AUDIT-TYPE-4)       05731100
      *SB 10/07/13 - END PR#5148D                                       05731200
057309            AND  DATE(B.DONT_SHIP_BEF_DTE)  BETWEEN               05731300
057310                 :ASC-KEY-SHIP-FROM-DATE  AND                     05731400
057311                 :ASC-KEY-SHIP-TO-DATE                            05731500
057312            AND  B.VER_STATUS_CDE = 'A'                           05731600
057313                                                                  05731700
057314          ORDER BY A.OPER_UNT_ID                                  05731800
057315                  ,A.PO_NBR                                       05731900
057316                  ,A.PO_LNE_NBR                                   05732000
057317                  ,A.PO_PREPK_ID                                  05732100
057318                                                                  05732200
057319     END-EXEC.                                                    05732300
057320                                                                  05732400
057330                                                                  05733000
057340******************************************************************05734000
057350*  CURSOR TO BUILD THE AUDIT EXCEPTION LIST FOR SPECIFIC OPER   **05735000
057360******************************************************************05736000
057370                                                                  05737000
057380     EXEC SQL                                                     05738000
057390          DECLARE OPER-CSR CURSOR FOR                             05739000
057400          SELECT A.PO_NBR                                         05740000
057500               , A.PO_LNE_NBR                                     05750000
057600               , A.PO_PREPK_ID                                    05760000
057700               , A.OPER_UNT_ID                                    05770000
057800               , A.AUD_TYP_CDE                                    05780000
057900               , CHAR(DATE(A.CRE_TMST),USA)                       05790000
058000               , CHAR(DATE(A.LAST_UPD_TMST),USA)                  05800000
058100               , A.LAST_UPD_BY_USR_ID                             05810000
058200               , CHAR(B.DONT_SHIP_BEF_DTE,USA)                    05820000
058300               , CHAR(B.CAN_IFNOT_SHIP_DTE,USA)                   05830000
058400          FROM   SUT_PO_AUD_EXC A                                 05840000
058410                                                                  05841000
058420          LEFT   OUTER JOIN                                       05842000
058430                 TPLNSHP B                                        05843000
058440             ON  A.PO_NBR    =  B.PO_NBR                          05844000
058450          WHERE                                                   05845000
058460                 A.OPER_UNT_ID BETWEEN                            05846000
058470                                     :DK-OPER-FROM  AND           05847000
058480                                     :DK-OPER-TO                  05848000
058490            AND  A.AUD_TYP_CDE  IN  (:ASC-KEY-AUDIT-TYPE-1,       05849000
058491                                     :ASC-KEY-AUDIT-TYPE-2,       05849100
      *SB 10/07/13 - END PR#5148D                                       05849200
058491                                     :ASC-KEY-AUDIT-TYPE-3,       05849300
058491                                     :ASC-KEY-AUDIT-TYPE-4)       05849400
      *SB 10/07/13 - END PR#5148D                                       05849500
058492            AND  DATE(B.DONT_SHIP_BEF_DTE)  BETWEEN               05849600
058493                 :ASC-KEY-SHIP-FROM-DATE  AND                     05849700
058494                 :ASC-KEY-SHIP-TO-DATE                            05849800
058495            AND  B.VER_STATUS_CDE = 'A'                           05849900
058496                                                                  05850000
058497          ORDER BY A.OPER_UNT_ID                                  05850100
058498                  ,A.PO_NBR                                       05850200
058499                  ,A.PO_LNE_NBR                                   05850300
058500                  ,A.PO_PREPK_ID                                  05850400
058501                                                                  05850500
058502     END-EXEC.                                                    05850600
058503                                                                  05850700
058504                                                                  05850800
058510*---------------------------------------------------------------* 05851000
058600                                                                  05860000
058700                                                                  05870000
058800 EJECT                                                            05880000
058900 LINKAGE SECTION.                                                 05890000
059000                                                                  05900000
059100 01  DFHCOMMAREA.                                                 05910000
059200     05  FILLER                         OCCURS  1 TO 4072 TIMES   05920000
059300                                        DEPENDING ON EIBCALEN.    05930000
059400         10  FILLER                     PIC X.                    05940000
059500                                                                  05950000
059600 EJECT                                                            05960000
059700 PROCEDURE DIVISION.                                              05970000
059800******************************************************************05980000
059900**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **05990000
060000**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **06000000
060100**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **06010000
060200******************************************************************06020000
060300 0000-MAIN-MODULE.                                                06030000
060400     INITIALIZE DP030-CICS-API-FIELDS.                            06040000
060500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       06050000
060600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          06060000
060700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         06070000
060800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       06080000
060900     MOVE LENGTH OF SUK586I        TO DP030-MAP-LENGTH (1).       06090000
061000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     06100000
061100     PERFORM 0001-CALL-CICS-ARCH-API.                             06110000
061200                                                                  06120000
061300     PERFORM 1000-CONTROL-PROCESSING                              06130000
061400                                                                  06140000
061500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06150000
061600     PERFORM 0001-CALL-CICS-ARCH-API.                             06160000
061700                                                                  06170000
061800******************************************************************06180000
061900**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **06190000
062000**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **06200000
062100******************************************************************06210000
062200 0001-CALL-CICS-ARCH-API.                                         06220000
062300*    CALL 'DPKCS030' USING DFHEIBLK                               06230010
062300     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      06231010
062400                           DFHCOMMAREA                            06240000
062500                           DP030-CICS-API-FIELDS                  06250000
062600                           DP020-STANDARD-COMMAREA                06260000
062700                           SUK586I.                               06270000
062800                                                                  06280000
062900     IF  DP030-RC-CALL-SUCCESSFUL                                 06290000
063000         CONTINUE                                                 06300000
063100     ELSE                                                         06310000
063200         SET DP013-NO-ROLLBACK                                    06320000
063300             DP013-XCTL-DISPLAY-RESTART                           06330000
063400             DP013-CICS-ABEND      TO TRUE                        06340000
063500         MOVE '0001-CALL-CICS-ARCH-API'                           06350000
063600                                   TO DP013-PARAGRAPH             06360000
063700*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX06370010
063800*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      06380010
063700         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O06381010
063800-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06382010
063900         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06390000
064000         PERFORM DP013-0000-PROCESS-ABEND                         06400000
064100     END-IF.                                                      06410000
064200*----------------------------------------------------------------*06420000
064300* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06430000
064400* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06440000
064500*                                                                *06450000
064600* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *06460000
064700*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *06470000
064800*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *06480000
064900*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *06490000
065000*----------------------------------------------------------------*06500000
065100                                                                  06510000
065200 1000-CONTROL-PROCESSING.                                         06520000
065300                                                                  06530000
065400     EVALUATE TRUE                                                06540000
065500         WHEN DP020-NEXT-ACT-INITIAL                              06550000
065600             INITIALIZE ASC-SPECIFIC-COMMAREA                     06560000
065700             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06570000
065800                                      ASC-SEL-TERM-ID             06580000
065900             MOVE DP020-SRC-TASK-NUMBER                           06590000
066000                                   TO ASC-LIST-TASK-NUMBER        06600000
066100                                      ASC-SEL-TASK-NUMBER         06610000
066200             MOVE PC-LIST-QUEUE-SEQ                               06620000
066300                                   TO ASC-LIST-SEQ                06630000
066400             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 06640000
066500             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06650000
066600***-----$TEMPLATE NOTE$-------------------------------------------06660000
066700*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,06670000
066800*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  06680000
066900*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.06690000
067000***---------------------------------------------------------------06700000
067100             PERFORM 4000-BUILD-INITIAL-PANEL                     06710000
067200                                                                  06720000
067300         WHEN DP020-NEXT-ACT-READ-MAP                             06730000
067400             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06740000
067500                                   TO PV-TOP-ITEM                 06750000
067600             PERFORM 2000-PROCESS-PANEL                           06760000
067700                                                                  06770000
067800         WHEN DP020-NEXT-ACT-RETURN                               06780000
067900            IF ASC-FUNC02-RETURN-YES                              06790000
068000               MOVE ASC-ITEM-AT-TOP-OF-PANEL                      06800000
068100                                     TO PV-TOP-ITEM               06810000
068200               MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL  06820000
068300               PERFORM 6000-REFRESH-PANEL-FROM-TEMP               06830000
068400               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN               06840000
068500            ELSE                                                  06850000
068600               PERFORM 2050-DELETE-LIST-QUEUE                     06860000
068700               PERFORM 4000-BUILD-INITIAL-PANEL                   06870000
068800            END-IF                                                06880000
068900         WHEN OTHER                                               06890000
069000             SET DP013-LOGIC-ABEND TO TRUE                        06900000
069100             SET DP013-NO-ROLLBACK TO TRUE                        06910000
069200             MOVE '1000-CONTROL-PROCESSING'                       06920000
069300                                   TO DP013-PARAGRAPH             06930000
069400             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06940000
069500                                   TO DP013-MESSAGE-TEXT(1)       06950000
069600             PERFORM DP013-0000-PROCESS-ABEND                     06960000
069700     END-EVALUATE.                                                06970000
069800                                                                  06980000
069900 EJECT                                                            06990000
070000*----------------------------------------------------------------*07000000
070100* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *07010000
070200* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *07020000
070300*----------------------------------------------------------------*07030000
070400                                                                  07040000
070500 1100-PROCESS-INTER-APPL-COMM.                                    07050000
070600                                                                  07060000
070700     SET PS-COMMAREA-VALID          TO TRUE.                      07070000
070800     MOVE SPACE                     TO ASC-START-ITEM-REQUEST.    07080000
070900                                                                  07090000
070910     EVALUATE DP020-INT-APPL-FORMAT-IND                           07091000
070920     WHEN '1'                                                     07092000
070930     MOVE SU020-PO-NBR                TO DK-PO-NBR                07093000
070940                                         ASC-KEY-PO-NBR           07094000
070950     MOVE SU020-PO-LINE-NBR           TO DK-PO-LINE-NBR           07095000
070960                                         ASC-KEY-PO-LINE-NBR      07096000
070970     MOVE SU020-PREPACK-ID            TO DK-PREPACK-ID            07097000
070980                                         ASC-KEY-PREPACK-ID       07098000
070990     MOVE SU020-OPER-UNT-ID           TO DK-OPER-UNT-ID           07099000
070991                                         ASC-KEY-OPER-UNT-ID      07099100
070992     MOVE SU020-OPER-ALL              TO ASC-KEY-OPER-ALL         07099200
070993     MOVE SU020-AUDIT-TYPE            TO DK-AUDIT-TYPE            07099300
070994                                         ASC-KEY-AUDIT-TYPE       07099400
070995     MOVE SU020-SHIP-FROM-DATE        TO DK-SHIP-FROM-DATE        07099500
070996                                         ASC-KEY-SHIP-FROM-DATE   07099600
070997     MOVE SU020-SHIP-TO-DATE          TO DK-SHIP-TO-DATE          07099700
070998                                         ASC-KEY-SHIP-TO-DATE     07099800
070999     WHEN '2'                                                     07099900
071000     MOVE SU021-PO-NBR                TO DK-PO-NBR                07100000
071010                                         ASC-KEY-PO-NBR           07101000
071020     MOVE SU021-PO-LINE-NBR           TO DK-PO-LINE-NBR           07102000
071030                                         ASC-KEY-PO-LINE-NBR      07103000
071040     MOVE SU021-PREPACK-ID            TO DK-PREPACK-ID            07104000
071050                                         ASC-KEY-PREPACK-ID       07105000
071060     MOVE SU021-OPER-UNT-ID           TO DK-OPER-UNT-ID           07106000
071070                                         ASC-KEY-OPER-UNT-ID      07107000
071080     MOVE SU021-OPER-ALL              TO ASC-KEY-OPER-ALL         07108000
071090     MOVE SU021-AUDIT-TYPE            TO DK-AUDIT-TYPE            07109000
071091                                         ASC-KEY-AUDIT-TYPE       07109100
071092     MOVE SU021-SHIP-FROM-DATE        TO DK-SHIP-FROM-DATE        07109200
071093                                         ASC-KEY-SHIP-FROM-DATE   07109300
071094     MOVE SU021-SHIP-TO-DATE          TO DK-SHIP-TO-DATE          07109400
071095                                         ASC-KEY-SHIP-TO-DATE     07109500
071096     END-EVALUATE.                                                07109600
071097                                                                  07109700
071100                                                                  07110000
071800*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*07180000
071900*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*07190000
072000*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*07200000
072100 1130-GET-NEXT-RECORD.                                            07210000
072200                                                                  07220000
072300     ADD +1                       TO ASC-SEL-SUB.                 07230000
072400                                                                  07240000
072500     IF  ASC-SEL-SUB > SU022-MAX-ITEMS                            07250000
072600         ADD +1                   TO ASC-SEL-ITEM                 07260000
072700         MOVE +1                  TO ASC-SEL-SUB                  07270000
072800     END-IF.                                                      07280000
072900                                                                  07290000
073000     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                07300000
073100         PERFORM 9100-READ-SEL-QUEUE                              07310000
073200         IF  SU022-ITEM (ASC-SEL-SUB) > ZERO                      07320000
073300                                                                  07330000
073400             SET SU022-INQ (ASC-SEL-SUB)                          07340000
073500                                  TO TRUE                         07350000
073600             PERFORM 9200-REWRITE-SEL-QUEUE                       07360000
073700         ELSE                                                     07370000
073800             SUBTRACT +1 FROM ASC-SEL-SUB                         07380000
073900             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             07390000
074000             SET DP020-MSG-INFORMATIONAL                          07400000
074100                 PS-LIST-END             TO TRUE                  07410000
074200         END-IF                                                   07420000
074300     ELSE                                                         07430000
074400         SUBTRACT +1 FROM ASC-SEL-ITEM                            07440000
074500         MOVE SU022-MAX-ITEMS     TO ASC-SEL-SUB                  07450000
074600         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             07460000
074700             SET DP020-MSG-INFORMATIONAL                          07470000
074800                 PS-LIST-END             TO TRUE                  07480000
074900     END-IF.                                                      07490000
075000                                                                  07500000
075100/                                                                 07510000
075200*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*07520000
075300*    GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING      *07530000
075400*    PROCESSED.                                                  *07540000
075500*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*07550000
075600                                                                  07560000
075700 1140-GET-PREV-RECORD.                                            07570000
075800                                                                  07580000
075900     SUBTRACT +1 FROM ASC-SEL-SUB.                                07590000
076000                                                                  07600000
076100     IF  ASC-SEL-SUB < +1                                         07610000
076200         SUBTRACT +1 FROM ASC-SEL-ITEM                            07620000
076300         MOVE SU022-MAX-ITEMS     TO ASC-SEL-SUB                  07630000
076400     END-IF.                                                      07640000
076500                                                                  07650000
076600     IF  ASC-SEL-ITEM > ZERO                                      07660000
076700         PERFORM 9100-READ-SEL-QUEUE                              07670000
076800         SET SU022-INQ (ASC-SEL-SUB)                              07680000
076900                                  TO TRUE                         07690000
077000         PERFORM 9200-REWRITE-SEL-QUEUE                           07700000
077100     ELSE                                                         07710000
077200         MOVE +1                  TO ASC-SEL-ITEM                 07720000
077300                                     ASC-SEL-SUB                  07730000
077400         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             07740000
077500             SET DP020-MSG-INFORMATIONAL                          07750000
077600                 PS-LIST-END             TO TRUE                  07760000
077700     END-IF.                                                      07770000
077800                                                                  07780000
077900                                                                  07790000
078000                                                                  07800000
078100*----------------------------------------------------------------*07810000
078200* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *07820000
078300* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *07830000
078400* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *07840000
078500* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *07850000
078600* FUNCTION KEYS CAN GET THIS FAR.                                *07860000
078700*----------------------------------------------------------------*07870000
078800                                                                  07880000
078900 2000-PROCESS-PANEL.                                              07890000
079000     EVALUATE TRUE                                                07900000
079100         WHEN DP020-SRC-AID = DP016-CLEAR                         07910000
079200             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07920000
079300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07930000
079400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07940000
079500                                                                  07950000
079600         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07960000
079700             SET ASC-NO-CONFIRM-DELETE TO TRUE                    07970000
079800             PERFORM 2050-DELETE-LIST-QUEUE                       07980000
079900             PERFORM 4000-BUILD-INITIAL-PANEL                     07990000
080000                                                                  08000000
080100         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    08010000
080200             PERFORM 2140-DESELECT-ALL-ITEMS                      08020000
080300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08030000
080400                                                                  08040000
080500         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  08050000
080600             PERFORM 2150-SELECT-ALL-ITEMS                        08060000
080700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08070000
080800                                                                  08080000
080900         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             08090000
081000           IF  ASC-USE-SELECTION-QUEUE                            08100000
081100               PERFORM 1130-GET-NEXT-RECORD                       08110000
081200               IF PS-LIST-END                                     08120000
081300                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN           08130000
081400                   SET PS-NO-LIST-END TO TRUE                     08140000
081500               ELSE                                               08150000
081600                   PERFORM 2050-DELETE-LIST-QUEUE                 08160000
081700                   PERFORM 3200-RESET-ATTRIBUTES                  08170000
081800                   PERFORM 4000-BUILD-INITIAL-PANEL               08180000
081900               END-IF                                             08190000
082000            ELSE                                                  08200000
082100               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN               08210000
082200*              --- BOTTOM OF LIST ---                             08220000
082300               MOVE PC-TSYMSG-00070                               08230000
082400                                 TO DP020-MSG-NUMBER              08240000
082500               SET DP020-MSG-INFORMATIONAL                        08250000
082600                                 TO TRUE                          08260000
082700           END-IF                                                 08270000
082800                                                                  08280000
082900         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             08290000
083000           IF  ASC-USE-SELECTION-QUEUE                            08300000
083100               PERFORM 1140-GET-PREV-RECORD                       08310000
083200               IF PS-LIST-END                                     08320000
083300                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN           08330000
083400                   SET PS-NO-LIST-END                             08340000
083500                                 TO TRUE                          08350000
083600               ELSE                                               08360000
083700                   PERFORM 2050-DELETE-LIST-QUEUE                 08370000
083800                   PERFORM 3200-RESET-ATTRIBUTES                  08380000
083900                   PERFORM 4000-BUILD-INITIAL-PANEL               08390000
084000               END-IF                                             08400000
084100           ELSE                                                   08410000
084200               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN               08420000
084300               MOVE PC-TSYMSG-00069                               08430000
084400                                 TO DP020-MSG-NUMBER              08440000
084500               SET DP020-MSG-INFORMATIONAL                        08450000
084600                                 TO TRUE                          08460000
084700           END-IF                                                 08470000
084800                                                                  08480000
084900         WHEN OTHER                                               08490000
085000             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 08500000
085100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08510000
085200             IF  PS-NO-ERROR                                      08520000
085300                 SET DP030-CONTINUE-GO                            08530000
085400                                 TO TRUE                          08540000
085500                 PERFORM 2100-CHECK-FUNCTION-KEY                  08550000
085600             ELSE                                                 08560000
085700                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08570000
085800                 SET DP030-OVERRIDE-GO                            08580000
085900                                 TO TRUE                          08590000
086000             END-IF                                               08600000
086100     END-EVALUATE.                                                08610000
086200 EJECT                                                            08620000
086300*----------------------------------------------------------------*08630000
086400*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *08640000
086500*----------------------------------------------------------------*08650000
086600 2050-DELETE-LIST-QUEUE.                                          08660000
086700                                                                  08670000
086800     EXEC CICS                                                    08680000
086900         DELETEQ TS                                               08690000
087000             QUEUE (ASC-LIST-QUEUE-NAME)                          08700000
087100             RESP  (PV-CICS-RESP)                                 08710000
087200     END-EXEC.                                                    08720000
087300                                                                  08730000
087400     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       08740000
087500        (PV-CICS-RESP = DFHRESP(QIDERR))                          08750000
087600         CONTINUE                                                 08760000
087700     ELSE                                                         08770000
087800         SET DP013-CICS-ABEND      TO TRUE                        08780000
087900         SET DP013-NO-ROLLBACK     TO TRUE                        08790000
088000                                                                  08800000
088100         MOVE '2050-DELETE-LIST-QUEUE'                            08810000
088200                                   TO DP013-PARAGRAPH             08820000
088300         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    08830000
088400                                   TO DP013-MESSAGE-TEXT (1)      08840000
088500         PERFORM DP013-0000-PROCESS-ABEND                         08850000
088600     END-IF.                                                      08860000
088700                                                                  08870000
088800     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  08880000
088900 EJECT                                                            08890000
089000*----------------------------------------------------------------*08900000
089100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*08910000
089200* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *08920000
089300* CICS ARCHITECTURE API.                                         *08930000
089400*----------------------------------------------------------------*08940000
089500***********************************                               08950000
089600* F13 - CTNRCLST    (LOCAL-FUNC-01)                               08960000
089700***********************************                               08970000
089800                                                                  08980000
089900 2100-CHECK-FUNCTION-KEY.                                         08990000
090000     SET SU021-UPDATE-TSQ TO TRUE.                                09000000
090100     EVALUATE TRUE                                                09010000
090200**F13=ADD RANK                                                    09020000
090300         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              09030000
090400              INITIALIZE SU021-INTER-APPL-COMMAREA                09040000
090500              MOVE +1        TO SU021-NUMBER-OF-SELECTED-ITEMS    09050000
090600                                                                  09060000
090700              PERFORM 5000-PREPARE-SEL-QUEUE                      09070000
090800              SET ASC-FUNC01-RETURN-YES TO TRUE                   09080000
090900                                                                  09090000
091000****F15=UPD RANK                                                  09100000
091100         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              09110000
091200             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              09120000
091300                 INITIALIZE SU021-INTER-APPL-COMMAREA             09130000
091400                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                09140000
091500                                TO SU021-NUMBER-OF-SELECTED-ITEMS 09150000
091600                                                                  09160000
091700                 PERFORM 5000-PREPARE-SEL-QUEUE                   09170000
091800                 SET ASC-FUNC02-RETURN-YES TO TRUE                09180000
091900             ELSE                                                 09190000
092000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             09200000
092100                 SET DP030-OVERRIDE-GO                            09210000
092200                                   TO TRUE                        09220000
092300                 MOVE PC-TSYMSG-00057                             09230000
092400                                   TO DP020-MSG-NUMBER            09240000
092500                 SET DP020-MSG-WARNING                            09250000
092600                                   TO TRUE                        09260000
092700             END-IF                                               09270000
092800                                                                  09280000
092900*F16=DEL RANK                                                     09290000
093000*F2=CONFIRM                                                       09300000
093100         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    09310000
093200              IF ASC-CONFIRM-DELETE                               09320000
093300                 PERFORM 4600-PROCESS-DELETE-FUNCTION             09330000
093400                     VARYING PV-ITEM  FROM 1 BY 1                 09340000
093500                     UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN    09350000
093600                     OR PS-ERROR                                  09360000
093700                   IF PS-NO-ERROR                                 09370000
093800                      PERFORM 2050-DELETE-LIST-QUEUE              09380000
093900                      PERFORM 4000-BUILD-INITIAL-PANEL            09390000
094000                      SET DP020-MSG-INFORMATIONAL  TO  TRUE       09400000
094100                        MOVE PC-TSYMSG-00115  TO DP020-MSG-NUMBER 09410000
094200                   ELSE                                           09420000
094300                        MOVE PC-TSYMSG-02848 TO DP020-MSG-NUMBER  09430000
094400                                                                  09440000
094500                        SET DP030-OVERRIDE-GO TO TRUE             09450000
094600                                                                  09460000
094700                        SET DP020-MSG-WARNING TO TRUE             09470000
094800                   END-IF                                         09480000
094900                   SET ASC-NO-CONFIRM-DELETE  TO TRUE             09490000
095000                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN           09500000
095100              ELSE                                                09510000
095200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             09520000
095300                 SET ASC-NO-CONFIRM-DELETE  TO TRUE               09530000
095400                 SET DP030-OVERRIDE-GO                            09540000
095500                                   TO TRUE                        09550000
095600                 MOVE PC-TSYMSG-00045                             09560000
095700                                   TO DP020-MSG-NUMBER            09570000
095800                 SET DP020-MSG-WARNING                            09580000
095900                                   TO TRUE                        09590000
096000              END-IF                                              09600000
096100                                                                  09610000
096200*                                                                 09620000
096300* F6 - FIRST PAGE                                                 09630000
096400*                                                                 09640000
096500         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  09650000
096600             MOVE +1               TO PV-TOP-ITEM                 09660000
096700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09670000
096800*                                                                 09680000
096900* F7 - PREVIOUS PAGE                                              09690000
097000*                                                                 09700000
097100         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   09710000
097200             PERFORM 2110-BROWSE-BACKWARD                         09720000
097300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09730000
097400*                                                                 09740000
097500* F8 - NEXT PAGE                                                  09750000
097600*                                                                 09760000
097700         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   09770000
097800             PERFORM 2120-BROWSE-FORWARD                          09780000
097900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09790000
098000*                                                                 09800000
098100* ENTER KEY                                                       09810000
098200*                                                                 09820000
098300         WHEN DP020-SRC-AID = DP016-ENTER                         09830000
098400             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   09840000
098500             IF  PS-ERROR                                         09850000
098600                 CONTINUE                                         09860000
098700             ELSE                                                 09870000
098800*                PERFORM 3200-RESET-ATTRIBUTES                    09880000
098900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             09890000
099000             END-IF                                               09900000
099100                                                                  09910000
099200         WHEN OTHER                                               09920000
099300             SET DP013-NO-ROLLBACK                                09930000
099400                 DP013-XCTL-DISPLAY-RESTART                       09940000
099500                 DP013-CICS-ABEND  TO TRUE                        09950000
099600             MOVE '2100-CHECK-FUNCTION-KEY'                       09960000
099700                                   TO DP013-PARAGRAPH             09970000
099800             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      09980000
099900                                   TO DP013-MESSAGE-TEXT (1)      09990000
100000             PERFORM DP013-0000-PROCESS-ABEND                     10000000
100100     END-EVALUATE.                                                10010000
100200*                                                                 10020000
100300*LMM                                                              10030000
100400*----------------------------------------------------------------*10040000
100500* CHECK TO SEE IF USER HAS RACF AUTHORIZATION FOR FUNTION        *10050000
100700*----------------------------------------------------------------*10070000
100800 2105-RACF-ACCESS.                                                10080000
100900                                                                  10090000
101000      SET DP008-RSRC-TYPE-FUNC           TO TRUE                  10100000
101100      SET DP008-ACCESS-TYPE-USE          TO TRUE                  10110000
101200                                                                  10120000
101300      EXEC CICS                                                   10130000
101400         LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                 10140000
101500              COMMAREA (DP008-SECURITY-COMMAREA)                  10150000
101600              LENGTH (DP008-SECURITY-COMMAREA-LENGTH)             10160000
101700      END-EXEC                                                    10170000
101800                                                                  10180000
101900      IF DP008-CALL-SUCCESSFUL                                    10190000
102000         IF DP008-ACCESS-ALLOWED                                  10200000
102100             SET PS-ACCESS-ALLOWED TO TRUE                        10210000
102200         ELSE                                                     10220000
102300             SET PS-ACCESS-NOT-ALLOWED TO TRUE                    10230000
102400         END-IF                                                   10240000
102500     ELSE                                                         10250000
102600         MOVE '2105-RACF-ACCESS'                                  10260000
102700                               TO DP013-PARAGRAPH                 10270000
102800          MOVE 'UNABLE TO ACCESS CICS'                            10280000
102900                               TO DP013-MESSAGE-TEXT (1)          10290000
103000          MOVE SQLCA                 TO DP013-SQLCA               10300000
103100          SET DP013-DB2-ABEND                                     10310000
103200              DP013-XCTL-DISPLAY-RESTART                          10320000
103300                               TO TRUE                            10330000
103400          PERFORM DP013-0000-PROCESS-ABEND                        10340000
103500      END-IF.                                                     10350000
103600                                                                  10360000
103700                                                                  10370000
103800*----------------------------------------------------------------*10380000
103900*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *10390000
104000*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *10400000
104100*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *10410000
104200*    MESSAGE.                                                    *10420000
104300*----------------------------------------------------------------*10430000
104400                                                                  10440000
104500 2110-BROWSE-BACKWARD.                                            10450000
104600     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    10460000
104700         GIVING PV-TOP-ITEM.                                      10470000
104800                                                                  10480000
104900     IF  ((PV-TOP-ITEM < +1)                                      10490000
105000       OR (PV-TOP-ITEM = +1))                                     10500000
105100         MOVE +1                   TO PV-TOP-ITEM                 10510000
105200*        -- TOP OF LIST --                                        10520000
105300         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            10530000
105400         SET DP020-MSG-INFORMATIONAL TO TRUE                      10540000
105500     END-IF.                                                      10550000
105600                                                                  10560000
105700 EJECT                                                            10570000
105800*----------------------------------------------------------------*10580000
105900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *10590000
106000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *10600000
106100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *10610000
106200*----------------------------------------------------------------*10620000
106300                                                                  10630000
106400 2120-BROWSE-FORWARD.                                             10640000
106500                                                                  10650000
106600     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              10660000
106700         GIVING PV-TOP-ITEM.                                      10670000
106800     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   10680000
106900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            10690000
107000                                   TO PV-TOP-ITEM                 10700000
107100*        -- BOTTOM OF LIST --                                     10710000
107200         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            10720000
107300         SET DP020-MSG-INFORMATIONAL                              10730000
107400                                   TO TRUE                        10740000
107500     ELSE                                                         10750000
107600         COMPUTE PV-BOTTOM-ITEM =                                 10760000
107700             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 10770000
107800         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            10780000
107900*            -- BOTTOM OF LIST --                                 10790000
108000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            10800000
108100             SET DP020-MSG-INFORMATIONAL                          10810000
108200                                   TO TRUE                        10820000
108300         END-IF                                                   10830000
108400     END-IF.                                                      10840000
108500 EJECT                                                            10850000
108600*----------------------------------------------------------------*10860000
108700*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *10870000
108800*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *10880000
108900*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *10890000
109000*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *10900000
109100*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *10910000
109200*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *10920000
109300*----------------------------------------------------------------*10930000
109400                                                                  10940000
109500 2130-CHECK-FOR-JUMP-BROWSE.                                      10950000
109600     SET PS-NO-ERROR               TO TRUE.                       10960000
109700     IF (ASC-START-ITEM-REQUEST = SPACE)                          10970000
109800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            10980000
109900                                   TO PV-TOP-ITEM                 10990000
110000     ELSE                                                         11000000
110100         MOVE ASC-START-ITEM-REQUEST                              11010000
110200                                   TO DP010I-UNEDITED-FIELD       11020000
110300         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       11030000
110400         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     11040000
110500         SET DP010I-NEGATIVE-NOT-ALLOWED                          11050000
110600                                   TO TRUE                        11060000
273427         CALL DP010I-NUMERIC-EDIT-ROUTINE                         11080009
273427              USING DP010I-NUMERIC-EDIT-AREA                      11081009
110800                                                                  11082007
110900         IF  NOT DP010I-ERROR-DETECTED                            11090000
111000             MOVE DP010I-NUMERIC-FIELD                            11100000
111100                                   TO  ASC-START-ITEM-REQUEST-N   11110000
111200             IF  ASC-START-ITEM-REQUEST-N > ZERO                  11120000
111300                 IF  ASC-START-ITEM-REQUEST-N >                   11130000
111400                                          ASC-NUMBER-OF-ITEMS-READ11140000
111500                     MOVE SPACE TO ASC-START-ITEM-REQUEST         11150000
111600                     COMPUTE PV-TOP-ITEM =                        11160000
111700                             ASC-NUMBER-OF-ITEMS-READ             11170000
111800                             - PC-ITEMS-PER-PANEL + 1             11180000
111900                     IF  PV-TOP-ITEM < +1                         11190000
112000                         MOVE +1   TO PV-TOP-ITEM                 11200000
112100                         MOVE PC-TSYMSG-00070                     11210000
112200                                   TO DP020-MSG-NUMBER            11220000
112300                         SET DP020-MSG-INFORMATIONAL              11230000
112400                                   TO TRUE                        11240000
112500                     END-IF                                       11250000
112600                 ELSE                                             11260000
112700                     MOVE ASC-START-ITEM-REQUEST-N                11270000
112800                                   TO PV-TOP-ITEM                 11280000
112900                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      11290000
113000                     COMPUTE PV-BOTTOM-ITEM =                     11300000
113100                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     11310000
113200                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ11320000
113300*                        -- BOTTOM OF LIST --                     11330000
113400                         MOVE PC-TSYMSG-00070                     11340000
113500                                   TO DP020-MSG-NUMBER            11350000
113600                         SET DP020-MSG-INFORMATIONAL              11360000
113700                                   TO TRUE                        11370000
113800                     END-IF                                       11380000
113900                 END-IF                                           11390000
114000             ELSE                                                 11400000
114100*                --- VALUE OUT OF RANGE ----                      11410000
114200                 MOVE PC-TSYMSG-00101                             11420000
114300                                   TO DP020-MSG-NUMBER            11430000
114400                 MOVE -1           TO ASTRTITL                    11440000
114500                 SET DP030-SET-CURSOR-APPL-1                      11450000
114600                                   TO TRUE                        11460000
114700                 MOVE DP015-REVERSE                               11470000
114800                                   TO ASTRTITH                    11480000
114900                 MOVE DP015-RED    TO ASTRTITC                    11490000
115000                 MOVE DP015-UNP-NUM-BRT-MDT                       11500000
115100                                   TO ASTRTITA                    11510000
115200                 SET DP020-MSG-FATAL                              11520000
115300                                   TO TRUE                        11530000
115400                 SET PS-ERROR      TO TRUE                        11540000
115500             END-IF                                               11550000
115600                                                                  11560000
115700         ELSE                                                     11570000
115800             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            11580000
115900             MOVE -1               TO ASTRTITL                    11590000
116000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  11600000
116100             MOVE DP015-REVERSE    TO ASTRTITH                    11610000
116200             MOVE DP015-RED        TO ASTRTITC                    11620000
116300             MOVE DP015-UNP-NUM-BRT-MDT                           11630000
116400                                   TO ASTRTITA                    11640000
116500             SET DP020-MSG-FATAL   TO TRUE                        11650000
116600             SET PS-ERROR          TO TRUE                        11660000
116700         END-IF                                                   11670000
116800     END-IF.                                                      11680000
116900 EJECT                                                            11690000
117000*----------------------------------------------------------------*11700000
117100*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *11710000
117200*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *11720000
117300*----------------------------------------------------------------*11730000
117400 2140-DESELECT-ALL-ITEMS.                                         11740000
117500     MOVE +1                       TO ASC-BLK-SUB.                11750000
117600                                                                  11760000
117700     PERFORM 2141-CLEAR-SELECTED-INDS                             11770000
117800         VARYING ASC-ITEM-SUB                                     11780000
117900         FROM 1 BY 1                                              11790000
118000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11800000
118100                                                                  11810000
118200     ADD +1                        TO ASC-BLK-SUB.                11820000
118300                                                                  11830000
118400     PERFORM 2141-CLEAR-SELECTED-INDS                             11840000
118500         VARYING ASC-ITEM-SUB                                     11850000
118600         FROM 1 BY 1                                              11860000
118700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11870000
118800                                                                  11880000
118900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11890000
119000                                   TO PV-LIST-ITEM-NUMBER.        11900000
119100                                                                  11910000
119200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11920000
119300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11930000
119400                                                                  11940000
119500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11950000
119600        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      11960000
119700         MOVE +1                   TO ASC-BLK-SUB                 11970000
119800                                                                  11980000
119900         PERFORM 5100-WRITE-TEMP-STORAGE                          11990000
120000                                                                  12000000
120100         MOVE +1                   TO PV-BLOCK-NUMBER             12010000
120200                                                                  12020000
120300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12030000
120400             PV-FIRST-BLOCK-IN-ARRAY - 1                          12040000
120500                                                                  12050000
120600         PERFORM                                                  12060000
120700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       12070000
120800                                                                  12080000
120900             PERFORM 4410-READ-TEMP-STORAGE                       12090000
121000                                                                  12100000
121100             PERFORM 2141-CLEAR-SELECTED-INDS                     12110000
121200                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 12120000
121300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12130000
121400                                                                  12140000
121500             PERFORM 5100-WRITE-TEMP-STORAGE                      12150000
121600                                                                  12160000
121700             ADD +1                TO PV-BLOCK-NUMBER             12170000
121800                                                                  12180000
121900         END-PERFORM                                              12190000
122000                                                                  12200000
122100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12210000
122200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12220000
122300                                                                  12230000
122400         PERFORM                                                  12240000
122500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12250000
122600                   ASC-HIGHEST-BLOCK-WRITTEN                      12260000
122700                                                                  12270000
122800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12280000
122900                                   TO PV-BLOCK-NUMBER             12290000
123000                                                                  12300000
123100             PERFORM 4410-READ-TEMP-STORAGE                       12310000
123200                                                                  12320000
123300             PERFORM 2141-CLEAR-SELECTED-INDS                     12330000
123400                 VARYING ASC-ITEM-SUB                             12340000
123500                 FROM 1 BY 1                                      12350000
123600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12360000
123700                                                                  12370000
123800             PERFORM 5100-WRITE-TEMP-STORAGE                      12380000
123900                                                                  12390000
124000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12400000
124100                                                                  12410000
124200         END-PERFORM                                              12420000
124300                                                                  12430000
124400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12440000
124500                                   TO PV-BLOCK-NUMBER             12450000
124600                                                                  12460000
124700         PERFORM 4410-READ-TEMP-STORAGE                           12470000
124800     END-IF.                                                      12480000
124900                                                                  12490000
125000                                                                  12500000
125100     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 12510000
125200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.12520000
125300     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  12530000
125400                                                                  12540000
125500*GB  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12550000
125600*3/23                                                             12560000
125700 EJECT                                                            12570000
125800*----------------------------------------------------------------*12580000
125900*    MARK EACH ITEM AS BEING NOT SELECTED.                       *12590000
126000*----------------------------------------------------------------*12600000
126100                                                                  12610000
126200 2141-CLEAR-SELECTED-INDS.                                        12620000
126300                                                                  12630000
126400     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           12640000
126500             NOT EQUAL ZERO                                       12650000
126600         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          12660000
126700             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          12670000
126800                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    12680000
126900                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12690000
127000                                   TO TRUE                        12700000
127100         END-IF                                                   12710000
127200     END-IF.                                                      12720000
127300                                                                  12730000
127400 EJECT                                                            12740000
127500*----------------------------------------------------------------*12750000
127600*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *12760000
127700*  FOR ALL ITEMS.                                                *12770000
127800*----------------------------------------------------------------*12780000
127900                                                                  12790000
128000 2150-SELECT-ALL-ITEMS.                                           12800000
128100                                                                  12810000
128200     MOVE +1                       TO ASC-BLK-SUB.                12820000
128300                                                                  12830000
128400     PERFORM 2151-SET-SELECTED-INDS                               12840000
128500         VARYING ASC-ITEM-SUB                                     12850000
128600         FROM 1 BY 1                                              12860000
128700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12870000
128800                                                                  12880000
128900     ADD +1                        TO ASC-BLK-SUB.                12890000
129000                                                                  12900000
129100     PERFORM 2151-SET-SELECTED-INDS                               12910000
129200         VARYING ASC-ITEM-SUB                                     12920000
129300         FROM 1 BY 1                                              12930000
129400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12940000
129500                                                                  12950000
129600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               12960000
129700                                   TO PV-LIST-ITEM-NUMBER.        12970000
129800                                                                  12980000
129900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            12990000
130000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    13000000
130100                                                                  13010000
130200*10/13/00- BEGIN                                                  13020000
130300     IF  PV-FIRST-BLOCK-IN-ARRAY  = +1                            13030000
130400         MOVE +1                   TO ASC-BLK-SUB                 13040000
130500                                                                  13050000
130600         PERFORM 5100-WRITE-TEMP-STORAGE                          13060000
130700         MOVE +2                   TO ASC-BLK-SUB                 13070000
130800         PERFORM 5100-WRITE-TEMP-STORAGE                          13080000
130900         MOVE +1                   TO ASC-BLK-SUB                 13090000
131000         MOVE +1                   TO PV-BLOCK-NUMBER             13100000
131100     END-IF.                                                      13110000
131200* 10/13/00 END                                                    13120000
131300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     13130000
131400        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    13140000
131500         MOVE +1                   TO ASC-BLK-SUB                 13150000
131600                                                                  13160000
131700         PERFORM 5100-WRITE-TEMP-STORAGE                          13170000
131800                                                                  13180000
131900         MOVE +1                   TO PV-BLOCK-NUMBER             13190000
132000                                                                  13200000
132100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13210000
132200             PV-FIRST-BLOCK-IN-ARRAY - 1                          13220000
132300                                                                  13230000
132400         PERFORM                                                  13240000
132500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       13250000
132600                                                                  13260000
132700             PERFORM 4410-READ-TEMP-STORAGE                       13270000
132800                                                                  13280000
132900             PERFORM 2151-SET-SELECTED-INDS                       13290000
133000                 VARYING ASC-ITEM-SUB                             13300000
133100                 FROM 1 BY 1                                      13310000
133200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13320000
133300                                                                  13330000
133400             PERFORM 5100-WRITE-TEMP-STORAGE                      13340000
133500                                                                  13350000
133600             ADD +1                TO PV-BLOCK-NUMBER             13360000
133700                                                                  13370000
133800         END-PERFORM                                              13380000
133900                                                                  13390000
134000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13400000
134100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13410000
134200                                                                  13420000
134300         PERFORM                                                  13430000
134400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13440000
134500                   ASC-HIGHEST-BLOCK-WRITTEN                      13450000
134600                                                                  13460000
134700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          13470000
134800                                   TO PV-BLOCK-NUMBER             13480000
134900                                                                  13490000
135000             PERFORM 4410-READ-TEMP-STORAGE                       13500000
135100                                                                  13510000
135200             PERFORM 2151-SET-SELECTED-INDS                       13520000
135300                 VARYING ASC-ITEM-SUB                             13530000
135400                 FROM 1 BY 1                                      13540000
135500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13550000
135600                                                                  13560000
135700             PERFORM 5100-WRITE-TEMP-STORAGE                      13570000
135800                                                                  13580000
135900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      13590000
136000                                                                  13600000
136100         END-PERFORM                                              13610000
136200                                                                  13620000
136300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             13630000
136400                                   TO PV-BLOCK-NUMBER             13640000
136500                                                                  13650000
136600         PERFORM 4410-READ-TEMP-STORAGE                           13660000
136700     END-IF.                                                      13670000
136800                                                                  13680000
136900                                                                  13690000
137000     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             13700000
137100                       ASC-NUMBER-OF-SELECTED-ITEMS.              13710000
137200                                                                  13720000
137300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        13730000
137400                                                                  13740000
137500 EJECT                                                            13750000
137600*----------------------------------------------------------------*13760000
137700*    MARK EACH ITEM AS BEING SELECTED.                           *13770000
137800*----------------------------------------------------------------*13780000
137900                                                                  13790000
138000 2151-SET-SELECTED-INDS.                                          13800000
138100                                                                  13810000
138200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           13820000
138300             NOT EQUAL ZERO                                       13830000
138400         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             13840000
138500             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             13850000
138600                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        13860000
138700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  13870000
138800                               TO  TRUE                           13880000
138900         END-IF                                                   13890000
139000     END-IF.                                                      13900000
139100                                                                  13910000
139200******************************************************************13920000
139300** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **13930000
139400** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **13940000
139500******************************************************************13950000
139600 2200-MOVE-SCREEN-TO-COMMAREA.                                    13960000
139700                                                                  13970000
139800     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             13980000
139900     MOVE +1                       TO PV-SUB.                     13990000
140000                                                                  14000000
140100     PERFORM 3100-SET-SUBSCRIPTS.                                 14010000
140200     IF  ASTRTITL > ZERO                                          14020000
140300         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          14030000
140400     ELSE                                                         14040000
140500         IF  ASTRTITF = DP015-ERASE-EOF                           14050000
140600             INITIALIZE ASC-START-ITEM-REQUEST                    14060000
140700         END-IF                                                   14070000
140800     END-IF.                                                      14080000
140900     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          14090000
141000         VARYING PV-SUB                                           14100000
141100         FROM 1 BY 1                                              14110000
141200         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      14120000
141300******************************************************************14130000
141400** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**14140000
141500******************************************************************14150000
141600 2210-MOVE-LINES-TO-COMMAREA.                                     14160000
141700     IF  MR-SELECTL (PV-SUB) > ZERO                               14170000
141800         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             14180000
141900         MOVE MR-SELECTI (PV-SUB)                                 14190000
142000                                   TO ASC-TEMP-SELECTED-SW        14200000
142100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      14210000
142200     ELSE                                                         14220000
142300         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                14230000
142400                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     14240000
142500                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        14250000
142600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      14260000
142700         END-IF                                                   14270000
142800     END-IF.                                                      14280000
142900                                                                  14290000
143000                                                                  14300000
143100     ADD +1                        TO ASC-ITEM-SUB.               14310000
143200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        14320000
143300         IF  ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     14330000
143400             COMPUTE PV-BLOCK-NUMBER  =                           14340000
143500                1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /         14350000
143600                    PC-ITEMS-PER-PANEL                            14360000
143700             PERFORM 5105-REWRITE-ASC-LISTQ                       14370000
143800         END-IF                                                   14380000
143900         ADD +1                    TO ASC-BLK-SUB                 14390000
144000         MOVE +1                   TO ASC-ITEM-SUB                14400000
144100     ELSE                                                         14410000
144200     IF  PV-SUB = ASC-ITEMS-DISPLAYED                             14420000
144300         IF  ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     14430000
144400             COMPUTE PV-BLOCK-NUMBER  =                           14440000
144500                1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /         14450000
144600                    PC-ITEMS-PER-PANEL                            14460000
144700             PERFORM 5105-REWRITE-ASC-LISTQ                       14470000
144800         END-IF                                                   14480000
144900     END-IF.                                                      14490000
145000*----------------------------------------------------------------*14500000
145100*                                                                 14510000
145200******************************************************************14520000
145300** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **14530000
145400** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **14540000
145500******************************************************************14550000
145600 3000-EDIT-DATA-IN-COMMAREA.                                      14560000
145700     SET PS-NO-ERROR               TO TRUE.                       14570000
145800     PERFORM 3200-RESET-ATTRIBUTES.                               14580000
145900     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     14590000
146000**                                                                14600000
146100* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              14610000
146200* EDITTING IS DONE FROM THE BOTTOM UP.                            14620000
146300**                                                                14630000
146400     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       14640000
146500         ASC-ITEMS-DISPLAYED - 1.                                 14650000
146600     PERFORM 3100-SET-SUBSCRIPTS.                                 14660000
146700                                                                  14670000
146800     IF  PS-NO-ERROR                                              14680000
146900         PERFORM 3005-EDIT-COMMAREA-BLOCKS                        14690000
147000     END-IF.                                                      14700000
147100                                                                  14710000
147200     IF  PS-NO-ERROR                                              14720000
147300         PERFORM 3400-CHECK-RANGE-SEQUENCE                        14730000
147400     END-IF.                                                      14740000
147500                                                                  14750000
147600     IF  ((PS-NO-ERROR)                                           14760000
147700       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   14770000
147800       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    14780000
147900             PERFORM 3500-MARK-RANGE-AS-SELECTED                  14790000
148000     END-IF.                                                      14800000
148100 EJECT                                                            14810000
148200                                                                  14820000
148300                                                                  14830000
148400*----------------------------------------------------------------*14840000
148500*   3005-EDIT-COMMAREA-BLOCKS                                    *14850000
148600*----------------------------------------------------------------*14860000
148700 3005-EDIT-COMMAREA-BLOCKS.                                       14870000
148800     MOVE +1                       TO PV-BLOCK-NUMBER.            14880000
148900     MOVE +1                       TO ASC-BLK-SUB.                14890000
149000     MOVE PC-ITEMS-PER-PANEL       TO ASC-ITEM-SUB.               14900000
149100                                                                  14910000
149200     COMPUTE PV-BLOCK-NUMBER  =                                   14920000
149300        1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /                 14930000
149400            PC-ITEMS-PER-PANEL.                                   14940000
149500                                                                  14950000
149600     MOVE  PV-BLOCK-NUMBER         TO PV-ORIGINAL-BLOCK.          14960000
149700                                                                  14970000
149800     PERFORM                                                      14980000
149900       UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN          14990000
150000          OR PS-ERROR                                             15000000
150100          OR PS-BLOCK-ERROR                                       15010000
150200                                                                  15020000
150300             COMPUTE PV-ITEMS-HOLD  =                             15030000
150400                     ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +        15040000
150500                     PC-ITEMS-PER-PANEL - 1                       15050000
150600                                                                  15060000
150700             IF  PV-ITEMS-HOLD  >  ASC-NUMBER-OF-ITEMS-READ       15070000
150800                 SUBTRACT  ASC-NUMBER-OF-ITEMS-READ               15080000
150900                     FROM  PV-ITEMS-HOLD                          15090000
151000                   GIVING  PV-ITEMS-DIFF                          15100000
151100                 SUBTRACT  PV-ITEMS-DIFF                          15110000
151200                     FROM  PC-ITEMS-PER-PANEL                     15120000
151300                   GIVING  PV-ITEMS-HOLD                          15130000
151400                     MOVE  PV-ITEMS-HOLD  TO  PV-SUB              15140000
151500                                              ASC-ITEM-SUB        15150000
151600                                              ASC-ITEMS-DISPLAYED 15160000
151700             ELSE                                                 15170000
151800                 MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB              15180000
151900                 MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB        15190000
152000             END-IF                                               15200000
152100                                                                  15210000
152200             PERFORM 3300-EDIT-SELECTIONS                         15220000
152300                     VARYING PV-SUB                               15230000
152400                        FROM PV-SUB BY -1                         15240000
152500                       UNTIL PV-SUB < +1                          15250000
152600                                                                  15260000
152700             MOVE +1               TO ASC-BLK-SUB                 15270000
152800                                                                  15280000
152900             PERFORM 5105-REWRITE-ASC-LISTQ                       15290000
153000                                                                  15300000
153100             MOVE +1                TO ASC-BLK-SUB                15310000
153200                                                                  15320000
153300             IF  PS-BLOCK-ERROR                                   15330000
153400                 SET  PS-ERROR     TO TRUE                        15340000
153500                 MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)        15350000
153600                                   TO PV-TOP-ITEM                 15360000
153700             ELSE                                                 15370000
153800                 ADD  +1           TO PV-BLOCK-NUMBER             15380000
153900                 IF  PV-BLOCK-NUMBER >                            15390000
154000                     ASC-HIGHEST-BLOCK-WRITTEN                    15400000
154100                     MOVE +2       TO ASC-BLK-SUB                 15410000
154200                     PERFORM 4410-READ-TEMP-STORAGE               15420000
154300                     MOVE +1       TO ASC-BLK-SUB                 15430000
154400                 ELSE                                             15440000
154500                     PERFORM 4410-READ-TEMP-STORAGE               15450000
154600                     ADD  +1        TO PV-BLOCK-NUMBER            15460000
154700                     MOVE +2        TO ASC-BLK-SUB                15470000
154800                     PERFORM 4410-READ-TEMP-STORAGE               15480000
154900                     SUBTRACT +1  FROM PV-BLOCK-NUMBER            15490000
155000                     MOVE +1        TO ASC-BLK-SUB                15500000
155100                 END-IF                                           15510000
155200             END-IF                                               15520000
155300     END-PERFORM.                                                 15530000
155400                                                                  15540000
155500     IF  PV-ORIGINAL-BLOCK  = +1    OR                            15550000
155600         PS-ERROR                   OR                            15560000
155700         PS-BLOCK-ERROR                                           15570000
155800         CONTINUE                                                 15580000
155900     ELSE                                                         15590000
156000         MOVE +1                 TO PV-BLOCK-NUMBER               15600000
156100         MOVE +1                 TO ASC-BLK-SUB                   15610000
156200         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  15620000
156300         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEMS-DISPLAYED           15630000
156400         PERFORM 4410-READ-TEMP-STORAGE                           15640000
156500                                                                  15650000
156600         PERFORM                                                  15660000
156700           UNTIL PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK              15670000
156800              OR PS-ERROR                                         15680000
156900              OR PS-BLOCK-ERROR                                   15690000
157000                                                                  15700000
157100                 COMPUTE PV-ITEMS-HOLD  =                         15710000
157200                         ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +    15720000
157300                         PC-ITEMS-PER-PANEL - 1                   15730000
157400                                                                  15740000
157500                 IF  PV-ITEMS-HOLD > ASC-NUMBER-OF-ITEMS-READ     15750000
157600                     SUBTRACT  ASC-NUMBER-OF-ITEMS-READ           15760000
157700                         FROM  PV-ITEMS-HOLD                      15770000
157800                       GIVING  PV-ITEMS-DIFF                      15780000
157900                     SUBTRACT  PV-ITEMS-DIFF                      15790000
158000                         FROM  PC-ITEMS-PER-PANEL                 15800000
158100                       GIVING  PV-ITEMS-HOLD                      15810000
158200                         MOVE  PV-ITEMS-HOLD TO PV-SUB            15820000
158300                                                ASC-ITEM-SUB      15830000
158400                                               ASC-ITEMS-DISPLAYED15840000
158500                 ELSE                                             15850000
158600                     MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB          15860000
158700                     MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB    15870000
158800                 END-IF                                           15880000
158900                                                                  15890000
159000                 PERFORM 3300-EDIT-SELECTIONS                     15900000
159100                         VARYING PV-SUB                           15910000
159200                            FROM PV-SUB BY -1                     15920000
159300                           UNTIL PV-SUB < +1                      15930000
159400                                                                  15940000
159500                 MOVE +1               TO ASC-BLK-SUB             15950000
159600                                                                  15960000
159700                 PERFORM 5105-REWRITE-ASC-LISTQ                   15970000
159800                                                                  15980000
159900                 MOVE +1                TO ASC-BLK-SUB            15990000
160000                                                                  16000000
160100                 IF  PS-BLOCK-ERROR                               16010000
160200                     SET  PS-ERROR     TO TRUE                    16020000
160300                     MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)    16030000
160400                                       TO PV-TOP-ITEM             16040000
160500                 ELSE                                             16050000
160600                     ADD  +1            TO PV-BLOCK-NUMBER        16060000
160700                     IF  PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK      16070000
160800                         MOVE +2        TO ASC-BLK-SUB            16080000
160900                         PERFORM 4410-READ-TEMP-STORAGE           16090000
161000                         MOVE +1        TO ASC-BLK-SUB            16100000
161100                     ELSE                                         16110000
161200                         PERFORM 4410-READ-TEMP-STORAGE           16120000
161300                         ADD  +1        TO PV-BLOCK-NUMBER        16130000
161400                         MOVE +2        TO ASC-BLK-SUB            16140000
161500                         PERFORM 4410-READ-TEMP-STORAGE           16150000
161600                         SUBTRACT +1  FROM PV-BLOCK-NUMBER        16160000
161700                         MOVE +1        TO ASC-BLK-SUB            16170000
161800                     END-IF                                       16180000
161900                 END-IF                                           16190000
162000     END-PERFORM.                                                 16200000
162100*----------------------------------------------------------------*16210000
162200*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *16220000
162300*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*16230000
162400*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *16240000
162500*                                                                *16250000
162600*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *16260000
162700*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *16270000
162800*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *16280000
162900*    US IN THE 2ND BLOCK OF THE ARRAY.                           *16290000
163000*----------------------------------------------------------------*16300000
163100                                                                  16310000
163200 3100-SET-SUBSCRIPTS.                                             16320000
163300                                                                  16330000
163400     COMPUTE ASC-ITEM-SUB =                                       16340000
163500         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        16350000
163600                                                                  16360000
163700     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         16370000
163800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            16380000
163900                                                                  16390000
164000         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               16400000
164100     ELSE                                                         16410000
164200         MOVE +1                     TO ASC-BLK-SUB               16420000
164300     END-IF.                                                      16430000
164400******************************************************************16440000
164500** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **16450000
164600******************************************************************16460000
164700                                                                  16470000
164800 3200-RESET-ATTRIBUTES.                                           16480000
164900     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   16490000
165000     MOVE DP015-GREEN              TO ASTRTITC.                   16500000
165100     MOVE DP015-UNDERLINE          TO ASTRTITH.                   16510000
165200                                                                  16520000
165300     PERFORM                                                      16530000
165400         VARYING PV-SUB                                           16540000
165500         FROM 1 BY 1                                              16550000
165600         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        16560000
165700           MOVE DP015-UNP-ALP-NOR-OFF                             16570000
165800                                     TO MR-SELECTA (PV-SUB)       16580000
165900           MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)       16590000
166000           MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)       16600000
166010           MOVE DP015-ASK-NOR-OFF    TO MR-PO-A  (PV-SUB)         16601000
166030                                        MR-LINE-A  (PV-SUB)       16603000
166040                                        MR-OPER-A  (PV-SUB)       16604000
166050                                        MR-TYPE-A  (PV-SUB)       16605000
166060                                        MR-CREATE-DATE-A (PV-SUB) 16606000
166070                                        MR-UPDATE-DATE-A (PV-SUB) 16607000
166080                                        MR-SHIP-DATE-A  (PV-SUB)  16608000
166090                                        MR-CANCEL-DATE-A (PV-SUB) 16609000
166091                                        MR-USER-A  (PV-SUB)       16609100
166100     END-PERFORM.                                                 16610000
166200******************************************************************16620000
166300** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **16630000
166400** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **16640000
166500** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **16650000
166600** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **16660000
166700******************************************************************16670000
166800 3300-EDIT-SELECTIONS.                                            16680000
166900     EVALUATE TRUE                                                16690000
167000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     16700000
167100             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         16710000
167200                 CONTINUE                                         16720000
167300         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         16730000
167400             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        16740000
167500                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   16750000
167600                 MOVE ASC-TEMP-SELECTED-SW                        16760000
167700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16770000
167800                                TO ASC-SELECTED-SW                16780000
167900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16790000
168000             END-IF                                               16800000
168100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     16810000
168200                 = SPACE                                          16820000
168300             EVALUATE TRUE                                        16830000
168400                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       16840000
168500                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS16850000
168600                     MOVE SPACE TO ASC-SELECTED-SW                16860000
168700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16870000
168800                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        16880000
168900                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    16890000
169000                     MOVE SPACE TO ASC-SELECTED-SW                16900000
169100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16910000
169200                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          16920000
169300                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      16930000
169400                     MOVE SPACE TO ASC-SELECTED-SW                16940000
169500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16950000
169600             END-EVALUATE                                         16960000
169700         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           16970000
169800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            16980000
169900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    16990000
170000             END-IF                                               17000000
170100             PERFORM 3310-EDIT-RANGE                              17010000
170200         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             17020000
170300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            17030000
170400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    17040000
170500             END-IF                                               17050000
170600             PERFORM 3310-EDIT-RANGE                              17060000
170700         WHEN OTHER                                               17070000
170800             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           17080000
170900             SET DP020-MSG-FATAL    TO TRUE                       17090000
171000             MOVE -1                TO MR-SELECTL (PV-SUB)        17100000
171100             SET DP030-SET-CURSOR-APPL-1                          17110000
171200                                    TO TRUE                       17120000
171300             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        17130000
171400             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        17140000
171500             SET PS-ERROR TO TRUE                                 17150000
171600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            17160000
171700                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     17170000
171800                 MOVE SPACE         TO ASC-SELECTED-SW            17180000
171900                                        (ASC-BLK-SUB ASC-ITEM-SUB)17190000
172000             END-IF                                               17200000
172100     END-EVALUATE.                                                17210000
172200                                                                  17220000
172210* UPDATE PO AUDIT EXCEPTION                                       17221000
172300*    IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                    17230000
172310*      IF DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)                  17231000
172400*        MOVE 'SUAUDPOU' TO DP008-FUNCTION-NAME                   17240000
172500*        PERFORM 2105-RACF-ACCESS                                 17250000
172600*          IF  PS-ACCESS-NOT-ALLOWED                              17260000
172700*               SET  PS-ERROR                                     17270000
172800*                    DP020-MSG-FATAL TO TRUE                      17280000
172900*               MOVE PC-TSYMSG-02867 TO DP020-MSG-NUMBER          17290000
173000*               MOVE -1              TO MR-SELECTL (PV-SUB)       17300000
173100*               SET  DP030-SET-CURSOR-APPL-1 TO TRUE              17310000
173200*               SET  DP030-OVERRIDE-GO TO TRUE                    17320000
173300*               SET PS-BLOCK-ERROR   TO TRUE                      17330000
173400*          END-IF                                                 17340000
173410*      END-IF                                                     17341000
173500*    END-IF                                                       17350000
173600                                                                  17360000
173610* ADD PO AUDIT EXCEPTION                                          17361000
173620     IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                    17362000
173630       IF DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                  17363000
173640         MOVE 'SUAUDPOA' TO DP008-FUNCTION-NAME                   17364000
173650         PERFORM 2105-RACF-ACCESS                                 17365000
173660           IF  PS-ACCESS-NOT-ALLOWED                              17366000
173670                SET  PS-ERROR                                     17367000
173680                     DP020-MSG-FATAL TO TRUE                      17368000
173690                MOVE PC-TSYMSG-02866 TO DP020-MSG-NUMBER          17369000
173691                MOVE -1              TO MR-SELECTL (PV-SUB)       17369100
173692                SET  DP030-SET-CURSOR-APPL-1 TO TRUE              17369200
173693                SET  DP030-OVERRIDE-GO TO TRUE                    17369300
173694                SET PS-BLOCK-ERROR   TO TRUE                      17369400
173695           END-IF                                                 17369500
173696       END-IF                                                     17369600
173697     END-IF                                                       17369700
173698                                                                  17369800
173699* DELETE PO AUDIT EXCEPTION                                       17369900
173700     IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                    17370000
173701       IF DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)                  17370100
173702         MOVE 'SUAUDPOU' TO DP008-FUNCTION-NAME                   17370200
173703         PERFORM 2105-RACF-ACCESS                                 17370300
173704           IF  PS-ACCESS-NOT-ALLOWED                              17370400
173705                SET  PS-ERROR                                     17370500
173706                     DP020-MSG-FATAL TO TRUE                      17370600
173707                MOVE PC-TSYMSG-02867 TO DP020-MSG-NUMBER          17370700
173708                MOVE -1              TO MR-SELECTL (PV-SUB)       17370800
173709                SET  DP030-SET-CURSOR-APPL-1 TO TRUE              17370900
173710                SET  DP030-OVERRIDE-GO TO TRUE                    17371000
173711                SET PS-BLOCK-ERROR   TO TRUE                      17371100
173712           END-IF                                                 17371200
173713       END-IF                                                     17371300
173714     END-IF                                                       17371400
173715                                                                  17371500
173720     IF PS-NO-ERROR                                               17372000
173800         IF DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)                17380000
173900            IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)             17390000
175000                SET ASC-CONFIRM-DELETE TO TRUE                    17500000
175100                SET  PS-ERROR                                     17510000
175200                     DP020-MSG-INFORMATIONAL TO TRUE              17520000
175300                MOVE PC-TSYMSG-02849 TO DP020-MSG-NUMBER          17530000
175400                MOVE -1              TO MR-SELECTL (PV-SUB)       17540000
175500                SET  DP030-SET-CURSOR-APPL-1 TO TRUE              17550000
175600                SET PS-BLOCK-ERROR   TO TRUE                      17560000
175800            END-IF                                                17580000
175900         END-IF                                                   17590000
176000     END-IF                                                       17600000
176100                                                                  17610000
176200                                                                  17620000
176300                                                                  17630000
176400     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 17640000
176500     SUBTRACT +1 FROM ASC-ITEM-SUB.                               17650000
176600     IF  ASC-ITEM-SUB < 1                                         17660000
176700         SUBTRACT +1 FROM ASC-BLK-SUB                             17670000
176800         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                17680000
176900     END-IF.                                                      17690000
177000******************************************************************17700000
177100** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **17710000
177200** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **17720000
177300** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**17730000
177400** THE ENDING.                                                  **17740000
177500******************************************************************17750000
177600 3310-EDIT-RANGE.                                                 17760000
177700     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                17770000
177800         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   17780000
177900             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)17790000
178000                                   TO ASC-SELECTED-SW             17800000
178100                                        (ASC-BLK-SUB ASC-ITEM-SUB)17810000
178200             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 17820000
178300         ELSE                                                     17830000
178400             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     17840000
178500                 CONTINUE                                         17850000
178600             ELSE                                                 17860000
178700*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        17870000
178800                 MOVE PC-TSYMSG-00054                             17880000
178900                                   TO DP020-MSG-NUMBER            17890000
179000                 SET DP020-MSG-FATAL                              17900000
179100                                   TO TRUE                        17910000
179200                 MOVE -1           TO MR-SELECTL (PV-SUB)         17920000
179300                 SET DP030-SET-CURSOR-APPL-1                      17930000
179400                                   TO TRUE                        17940000
179500                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         17950000
179600                 MOVE DP015-UNDERLINE                             17960000
179700                                   TO MR-SELECTH (PV-SUB)         17970000
179800                 SET PS-ERROR      TO TRUE                        17980000
179900             END-IF                                               17990000
180000         END-IF                                                   18000000
180100     ELSE                                                         18010000
180200         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     18020000
180300             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 18030000
180400                                   TO ASC-SELECTED-SW             18040000
180500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   18050000
180600             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   18060000
180700         ELSE                                                     18070000
180800             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       18080000
180900                 CONTINUE                                         18090000
181000             ELSE                                                 18100000
181100*                -- ONLY ONE END-OF-RANGE ALLOWED --              18110000
181200                 MOVE PC-TSYMSG-00055                             18120000
181300                                   TO DP020-MSG-NUMBER            18130000
181400                 SET DP020-MSG-FATAL                              18140000
181500                                   TO TRUE                        18150000
181600                 MOVE -1           TO MR-SELECTL (PV-SUB)         18160000
181700                 SET DP030-SET-CURSOR-APPL-1                      18170000
181800                                   TO TRUE                        18180000
181900                 SET PS-ERROR      TO TRUE                        18190000
182000             END-IF                                               18200000
182100         END-IF                                                   18210000
182200     END-IF.                                                      18220000
182300                                                                  18230000
182400******************************************************************18240000
182500** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **18250000
182600** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **18260000
182700******************************************************************18270000
182800 3400-CHECK-RANGE-SEQUENCE.                                       18280000
182900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       18290000
183000       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      18300000
183100       AND  ASC-START-OF-SELECTED-RANGE >                         18310000
183200                                         ASC-END-OF-SELECTED-RANGE18320000
183300*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                18330000
183400         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 18340000
183500         SET DP020-MSG-FATAL TO TRUE                              18350000
183600         SET PS-ERROR TO TRUE                                     18360000
183700         PERFORM 3410-POSITION-AT-ERROR                           18370000
183800     END-IF.                                                      18380000
183900******************************************************************18390000
184000** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **18400000
184100** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **18410000
184200** SHOULD BE POSITIONED ON A RANGE ERROR.                       **18420000
184300******************************************************************18430000
184400 3410-POSITION-AT-ERROR.                                          18440000
184500     SET DP030-SET-CURSOR-APPL-1                                  18450000
184600                                   TO TRUE.                       18460000
184700     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 18470000
184800                    - PV-TOP-ITEM + 1.                            18480000
184900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18490000
185000         CONTINUE                                                 18500000
185100     ELSE                                                         18510000
185200         MOVE -1                   TO MR-SELECTL (PV-SUB)         18520000
185300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18530000
185400         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         18540000
185500     END-IF.                                                      18550000
185600                                                                  18560000
185700     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   18570000
185800                    - PV-TOP-ITEM + 1.                            18580000
185900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18590000
186000         CONTINUE                                                 18600000
186100     ELSE                                                         18610000
186200         MOVE -1                   TO MR-SELECTL (PV-SUB)         18620000
186300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18630000
186400         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         18640000
186500     END-IF.                                                      18650000
186600 EJECT                                                            18660000
186700*----------------------------------------------------------------*18670000
186800*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *18680000
186900*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *18690000
187000*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *18700000
187100*----------------------------------------------------------------*18710000
187200                                                                  18720000
187300 3500-MARK-RANGE-AS-SELECTED.                                     18730000
187400     MOVE +1                       TO  ASC-BLK-SUB.               18740000
187500     PERFORM 3510-MARK-SELECTED-INDS                              18750000
187600         VARYING ASC-ITEM-SUB                                     18760000
187700         FROM 1 BY 1                                              18770000
187800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 18780000
187900                                                                  18790000
188000     ADD +1                        TO ASC-BLK-SUB.                18800000
188100     PERFORM 3510-MARK-SELECTED-INDS                              18810000
188200         VARYING ASC-ITEM-SUB                                     18820000
188300         FROM 1 BY 1                                              18830000
188400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 18840000
188500                                                                  18850000
188600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               18860000
188700                                   TO  PV-LIST-ITEM-NUMBER.       18870000
188800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            18880000
188900         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         18890000
189000               PC-ITEMS-PER-PANEL).                               18900000
189100                                                                  18910000
189200     MOVE ASC-START-OF-SELECTED-RANGE                             18920000
189300                                   TO PV-START-OF-SELECTED-RANGE. 18930000
189400     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            18940000
189500         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  18950000
189600               PC-ITEMS-PER-PANEL).                               18960000
189700                                                                  18970000
189800     MOVE ASC-END-OF-SELECTED-RANGE                               18980000
189900                                   TO  PV-END-OF-SELECTED-RANGE.  18990000
190000     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             19000000
190100         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    19010000
190200               PC-ITEMS-PER-PANEL).                               19020000
190300     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             19030000
190400         PV-FIRST-BLOCK-IN-ARRAY + 1.                             19040000
190500                                                                  19050000
190600     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    19060000
190700        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        19070000
190800         MOVE +1                   TO ASC-BLK-SUB                 19080000
190900         PERFORM 5100-WRITE-TEMP-STORAGE                          19090000
191000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         19100000
191100             PV-FIRST-BLOCK-IN-ARRAY - 1                          19110000
191200                                                                  19120000
191300         PERFORM                                                  19130000
191400             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      19140000
191500                   PV-PREV-BLOCK-IN-ARRAY                         19150000
191600             MOVE PV-FIRST-BLOCK-IN-RANGE                         19160000
191700                                   TO PV-BLOCK-NUMBER             19170000
191800             PERFORM 4410-READ-TEMP-STORAGE                       19180000
191900             PERFORM 3510-MARK-SELECTED-INDS                      19190000
192000                 VARYING ASC-ITEM-SUB                             19200000
192100                 FROM 1 BY 1                                      19210000
192200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19220000
192300             PERFORM 5100-WRITE-TEMP-STORAGE                      19230000
192400             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     19240000
192500         END-PERFORM                                              19250000
192600                                                                  19260000
192700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         19270000
192800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     19280000
192900         PERFORM                                                  19290000
193000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       19300000
193100                   PV-LAST-BLOCK-IN-RANGE                         19310000
193200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          19320000
193300                                   TO PV-BLOCK-NUMBER             19330000
193400             PERFORM 4410-READ-TEMP-STORAGE                       19340000
193500             PERFORM 3510-MARK-SELECTED-INDS                      19350000
193600                 VARYING ASC-ITEM-SUB                             19360000
193700                 FROM 1 BY 1                                      19370000
193800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19380000
193900             PERFORM 5100-WRITE-TEMP-STORAGE                      19390000
194000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      19400000
194100         END-PERFORM                                              19410000
194200                                                                  19420000
194300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             19430000
194400                                   TO PV-BLOCK-NUMBER             19440000
194500         PERFORM 4410-READ-TEMP-STORAGE                           19450000
194600     END-IF.                                                      19460000
194700                                                                  19470000
194800     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 19480000
194900                                      ASC-END-OF-SELECTED-RANGE.  19490000
195000                                                                  19500000
195100 EJECT                                                            19510000
195200*----------------------------------------------------------------*19520000
195300* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *19530000
195400*----------------------------------------------------------------*19540000
195500                                                                  19550000
195600 3510-MARK-SELECTED-INDS.                                         19560000
195700                                                                  19570000
195800     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         19580000
195900                                ASC-ITEM-SUB) >                   19590000
196000         ASC-START-OF-SELECTED-RANGE)                             19600000
196100     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         19610000
196200                                ASC-ITEM-SUB) =                   19620000
196300         ASC-START-OF-SELECTED-RANGE)                             19630000
196400                                                                  19640000
196500         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     19650000
196600                                    ASC-ITEM-SUB) <               19660000
196700             ASC-END-OF-SELECTED-RANGE)                           19670000
196800         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     19680000
196900                                    ASC-ITEM-SUB) =               19690000
197000             ASC-END-OF-SELECTED-RANGE)                           19700000
197100                                                                  19710000
197200             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          19720000
197300                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   19730000
197400                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   19740000
197500                               TO TRUE                            19750000
197600                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              19760000
197700                               TO TRUE                            19770000
197800                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    19780000
197900             END-IF                                               19790000
198000         END-IF                                                   19800000
198100     END-IF.                                                      19810000
198200                                                                  19820000
198300 EJECT                                                            19830000
198400                                                                  19840000
198500*----------------------------------------------------------------*19850000
198600*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *19860000
198700*    INITIALIZE ALL COUNTERS AND FLAGS.                          *19870000
198800*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *19880000
198900*    DISPLAY THE PANEL TO USER.                                  *19890000
199000*----------------------------------------------------------------*19900000
199100                                                                  19910000
199200 4000-BUILD-INITIAL-PANEL.                                        19920000
199300                                                                  19930000
199400     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            19940000
199500                                 ASC-BLOCK-ENTRIES (2).           19950000
199600     MOVE +1                 TO ASC-BLK-SUB.                      19960000
199700     SET ASC-ITEMS-LEFT-ON-DB                                     19970000
199800                             TO TRUE.                             19980000
199900                                                                  19990000
200000     MOVE +0                 TO ASC-ITEM-SUB                      20000000
200100                                ASC-NUMBER-OF-ITEMS-READ          20010000
200200                                ASC-NUMBER-OF-SELECTED-ITEMS      20020000
200300                                ASC-HIGHEST-BLOCK-WRITTEN         20030000
200400                                ASC-START-OF-SELECTED-RANGE       20040000
200500                                ASC-END-OF-SELECTED-RANGE         20050000
200600                                ASC-ITEM-AT-TOP-OF-PANEL.         20060000
200700                                                                  20070000
200701     PERFORM 4100-PREPARE-CURSOR.                                 20070100
200710                                                                  20071000
200720     IF PS-NO-ERROR                                               20072000
200730         PERFORM 7000-OPEN-CURSOR                                 20073000
200731     END-IF.                                                      20073100
200732                                                                  20073200
200733     IF PS-NO-ERROR                                               20073300
200734         PERFORM 4300-READ-ITEMS-FROM-DB                          20073400
200740         PERFORM 7010-FETCH                                       20074000
200750     END-IF                                                       20075000
200760                                                                  20076000
201300                                                                  20130000
201400     MOVE +1                   TO  PV-TOP-ITEM.                   20140000
201500     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          20150000
201600*        SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    20160000
201700         SET DP020-MSG-FATAL   TO  TRUE                           20170000
201800         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               20180000
201801*        PERFORM VARYING PV-SUB FROM 1 BY 1                       20180100
201802*             UNTIL PV-SUB > 13                                   20180200
201810*            MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)       20181000
201811*            MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)       20181100
201812*            MOVE SPACE              TO MR-SELECTI (PV-SUB)       20181200
201820*        END-PERFORM                                              20182000
201900     ELSE                                                         20190000
202000         MOVE -1               TO MR-SELECTL (1)                  20200000
202100         SET DP030-SET-CURSOR-APPL-1                              20210000
202200                               TO TRUE                            20220000
202300         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     20230000
202400     END-IF.                                                      20240000
202500                                                                  20250000
202510*----------------------------------------------------------------*20251000
202520*    SET UP THE HOST VARIABLES.                                  *20252000
202530*----------------------------------------------------------------*20253000
202540                                                                  20254000
202550 4100-PREPARE-CURSOR.                                             20255000
202560                                                                  20256000
202570     EVALUATE TRUE                                                20257000
202580         WHEN ASC-KEY-PO-NBR > ZERO                               20258000
202590              AND ASC-KEY-OPER-UNT-ID > ZERO                      20259000
202591             MOVE ASC-KEY-PO-NBR      TO DK-PO-NBR                20259100
202592             SET ASC-PO-OPER-CSR      TO TRUE                     20259200
202593                                                                  20259300
202594         WHEN ASC-KEY-PO-NBR > ZERO                               20259400
202595             SET ASC-PO-CSR           TO TRUE                     20259500
202596                                                                  20259600
202597         WHEN ASC-KEY-OPER-UNT-ID > ZERO                          20259700
202598             SET ASC-OPER-CSR         TO TRUE                     20259800
202599         WHEN OTHER                                               20259900
202600             SET PS-ERROR                                         20260000
202601                 ASC-NO-ITEMS-LEFT-ON-DB                          20260100
202602                 DP020-NEXT-ACT-APPL-ERROR                        20260200
202603                 DP020-MSG-FATAL      TO TRUE                     20260300
202604             MOVE PC-TSYMSG-02892     TO DP020-MSG-NUMBER         20260400
202605     END-EVALUATE.                                                20260500
202606                                                                  20260600
202607     MOVE ASC-KEY-PO-NBR              TO DK-PO-NBR                20260700
202608                                                                  20260800
202609     IF ASC-KEY-OPER-ALL = 'ALL'                                  20260900
202610         MOVE ZERO                    TO DK-OPER-FROM             20261000
202611         MOVE 9999                    TO DK-OPER-TO               20261100
202612     ELSE                                                         20261200
202613         MOVE ASC-KEY-OPER-UNT-ID     TO DK-OPER-FROM             20261300
202614                                         DK-OPER-TO               20261400
202615     END-IF                                                       20261500
202616                                                                  20261600
202617     IF ASC-KEY-AUDIT-TYPE = 'B'                                  20261700
202618         MOVE 'A'                     TO ASC-KEY-AUDIT-TYPE-1     20261800
202619         MOVE 'N'                     TO ASC-KEY-AUDIT-TYPE-2     20261900
      *SB 10/07/13 - BEGIN PR#5148D                                     20262000
202619         MOVE 'R'                     TO ASC-KEY-AUDIT-TYPE-3     20262100
202619         MOVE 'Q'                     TO ASC-KEY-AUDIT-TYPE-4     20262200
      *SB 10/07/13 - END PR#5148D                                       20262300
202620     ELSE                                                         20262400
202621         MOVE ASC-KEY-AUDIT-TYPE      TO ASC-KEY-AUDIT-TYPE-1     20262500
202622                                         ASC-KEY-AUDIT-TYPE-2     20262600
      *SB 10/07/13 - BEGIN PR#5148D                                     20262700
202622                                         ASC-KEY-AUDIT-TYPE-3     20262800
202622                                         ASC-KEY-AUDIT-TYPE-4     20262900
      *SB 10/07/13 - END PR#5148D                                       20263000
202623     END-IF.                                                      20263100
202624/                                                                 20264000
210300                                                                  21030000
210400                                                                  21040000
220300*----------------------------------------------------------------*22030000
220400*  DELETE THE SUT PO AUDIT PARM TABLE                             22040000
220500*----------------------------------------------------------------*22050000
220600 4200-DELETE-PO-AUDIT-EXCPT.                                      22060000
220700                                                                  22070000
220800     EXEC SQL                                                     22080000
220900         DELETE                                                   22090000
221000         FROM SUT_PO_AUD_EXC                                      22100000
221100         WHERE                                                    22110000
221200             PO_NBR                   = :SUT00014-PO-NBR          22120000
221300         AND PO_LNE_NBR               = :SUT00014-PO-LNE-NBR      22130000
221400         AND PO_PREPK_ID              = :SUT00014-PO-PREPK-ID     22140000
221500         AND OPER_UNT_ID              = :SUT00014-OPER-UNT-ID     22150000
221600     END-EXEC                                                     22160000
221700                                                                  22170000
221800     EVALUATE TRUE                                                22180000
221900         WHEN SQLCODE = ZERO                                      22190000
222000         WHEN SQLCODE = +100                                      22200000
222100             CONTINUE                                             22210000
222200         WHEN SQLCODE = -904                                      22220000
222300         WHEN SQLCODE = -911                                      22230000
222400         WHEN SQLCODE = -913                                      22240000
222500             PERFORM 9900-SOFT-ABORT                              22250000
222600         WHEN SQLWARN0 NOT = SPACES                               22260000
222700         WHEN SQLCODE < ZERO                                      22270000
222800         WHEN SQLCODE > ZERO                                      22280000
222900             MOVE '7100-DELETE-AUDIT'                             22290000
223000                               TO DP013-PARAGRAPH                 22300000
223100             MOVE 'CLOSE CURSOR '                                 22310000
223200                               TO DP013-MESSAGE-TEXT (1)          22320000
223210             MOVE SQLCA        TO DP013-SQLCA                     22321000
223220             MOVE 'SU_PO_AUD_EXC'  TO DP013-DB2-TABLE-NAME (1)    22322000
223230             SET DP013-DB2-ABEND                                  22323000
223240                 DP013-XCTL-DISPLAY-RESTART TO TRUE               22324000
223250             PERFORM DP013-0000-PROCESS-ABEND                     22325000
223260     END-EVALUATE.                                                22326000
223270                                                                  22327000
223300                                                                  22330000
229900*----------------------------------------------------------------*22990000
230000*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *23000000
230100*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *23010000
230200*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *23020000
230300*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *23030000
230400*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *23040000
230500*                                                                *23050000
230600*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *23060000
230700*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *23070000
230800*    UPON INITIALIZATION.                                        *23080000
230900*----------------------------------------------------------------*23090000
231000                                                                  23100000
231100 4300-READ-ITEMS-FROM-DB.                                         23110000
231200                                                                  23120000
231300     PERFORM                                                      23130000
231400         VARYING PV-READ-COUNT                                    23140000
231500         FROM 1 BY 1                                              23150000
231600         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    23160000
231700            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         23170000
231800                                                                  23180000
231810         PERFORM 7010-FETCH                                       23181000
232000                                                                  23200000
232100         IF  ASC-ITEMS-LEFT-ON-DB                                 23210000
232200                                                                  23220000
233000             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                23300000
233100                 ADD +1            TO ASC-ITEM-SUB                23310000
233200             ELSE                                                 23320000
233300                 ADD +1            TO ASC-BLK-SUB                 23330000
233400                 MOVE +1           TO ASC-ITEM-SUB                23340000
233500                                                                  23350000
233600                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         23360000
233700                     MOVE +1       TO ASC-BLK-SUB                 23370000
233800                     SET ASC-BLOCK-MODIFIED (1)                   23380000
233900                                   TO TRUE                        23390000
234000                     PERFORM 5100-WRITE-TEMP-STORAGE              23400000
234100                     MOVE ASC-BLOCK-ENTRIES                       23410000
234200                               (PC-MAX-BLOCKS-IN-ARRAY)           23420000
234300                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 23430000
234400                     ADD +1        TO ASC-BLK-SUB                 23440000
234500                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   23450000
234600                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      23460000
234700                                   TO TRUE                        23470000
234800                 END-IF                                           23480000
234900             END-IF                                               23490000
235000                                                                  23500000
235100                                                                  23510000
235200             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    23520000
235300             MOVE ASC-NUMBER-OF-ITEMS-READ                        23530000
235400                                   TO ASC-LIST-ITEM-NUMBER        23540000
235500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23550000
235600             MOVE SPACES                 TO  ASC-ACTION           23560000
235700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23570000
235800*                                                                 23580000
235900             MOVE ASC-NUMBER-OF-ITEMS-READ                        23590000
235910                                      TO ASC-LIST-ITEM-NUMBER     23591000
236000                                        (ASC-BLK-SUB ASC-ITEM-SUB)23600000
236200             MOVE SUT00014-PO-NBR                                 23620000
236210                                      TO ASC-PO-NBR               23621000
236300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23630000
236500             MOVE SUT00014-PO-LNE-NBR                             23650000
236510                                      TO ASC-PO-LINE              23651000
236600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23660000
236800             MOVE SUT00014-PO-PREPK-ID                            23680000
236810                                      TO ASC-PREPACK-ID           23681000
236900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23690000
237100             MOVE SUT00014-OPER-UNT-ID                            23710000
237110                                      TO ASC-OPER-UNT-ID          23711000
237200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23720000
237400             EVALUATE SUT00014-AUD-TYP-CDE                        23740000
237500                 WHEN 'A'                                         23750000
237600                      MOVE '100'      TO ASC-AUDIT-TYPE           23760000
237700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23770000
237710                 WHEN 'N'                                         23771000
237720                      MOVE 'NO '      TO ASC-AUDIT-TYPE           23772000
237730                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23773000
      *SB 10/07/13 - BEGIN PR#5148D                                     23773100
237710                 WHEN 'R'                                         23773200
237720                      MOVE 'RF '      TO ASC-AUDIT-TYPE           23773300
237730                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23773400
237710                 WHEN 'Q'                                         23773500
237720                      MOVE 'QC '      TO ASC-AUDIT-TYPE           23773600
237730                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23773700
      *SB 10/07/13 - END PR#5148D                                       23773800
237740             END-EVALUATE                                         23774000
237760             IF  PV-AUD-CRE-DATE = '09/09/9999'                   23776000
237770                 MOVE SPACES          TO ASC-AUDIT-CRE-DATE       23777000
237780                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23778000
237790             ELSE                                                 23779000
237791                 STRING PV-AUD-CRE-DATE (1:6)                     23779100
237792                        PV-AUD-CRE-DATE (9:2)                     23779200
237793                                         DELIMITED BY SIZE        23779300
237794                                    INTO ASC-AUDIT-CRE-DATE       23779400
237795                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23779500
237796             END-IF                                               23779600
237797                                                                  23779700
237798             IF  PV-AUD-LAST-UPD-DATE = '09/09/9999'              23779800
237799                 MOVE SPACES          TO ASC-AUDIT-UPD-DATE       23779900
237800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23780000
237801             ELSE                                                 23780100
237802                 STRING PV-AUD-LAST-UPD-DATE (1:6)                23780200
237803                        PV-AUD-LAST-UPD-DATE (9:2)                23780300
237804                                         DELIMITED BY SIZE        23780400
237805                                    INTO ASC-AUDIT-UPD-DATE       23780500
237806                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23780600
237807             END-IF                                               23780700
237809             IF  PV-SHP-DONT-SHIP-BEF-DTE = '09/09/9999'          23780900
237810                 MOVE SPACES          TO ASC-SHIP-DATE            23781000
237811                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23781100
237812             ELSE                                                 23781200
237813                 STRING PV-SHP-DONT-SHIP-BEF-DTE (1:6)            23781300
237814                        PV-SHP-DONT-SHIP-BEF-DTE (9:2)            23781400
237815                                         DELIMITED BY SIZE        23781500
237816                                    INTO ASC-SHIP-DATE            23781600
237817                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23781700
237818             END-IF                                               23781800
237820             IF  PV-SHP-CAN-IFNOT-SHIP-DTE = '09/09/9999'         23782000
237821                 MOVE SPACES          TO ASC-CANCEL-DATE          23782100
237822                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23782200
237823             ELSE                                                 23782300
237824                 STRING PV-SHP-CAN-IFNOT-SHIP-DTE (1:6)           23782400
237825                        PV-SHP-CAN-IFNOT-SHIP-DTE (9:2)           23782500
237826                                         DELIMITED BY SIZE        23782600
237827                                    INTO ASC-CANCEL-DATE          23782700
237828                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23782800
237829             END-IF                                               23782900
237830                                                                  23783000
237831             MOVE SUT00014-LAST-UPD-BY-USR-ID                     23783100
237832                                      TO ASC-USER-ID              23783200
237833                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23783300
237840         END-IF                                                   23784000
237900     END-PERFORM.                                                 23790000
238000                                                                  23800000
238100     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          23810000
238200         MOVE +1               TO ASC-BLK-SUB                     23820000
238300         PERFORM 5100-WRITE-TEMP-STORAGE                          23830000
238400         ADD +1                TO ASC-BLK-SUB                     23840000
238500         PERFORM 5100-WRITE-TEMP-STORAGE                          23850000
238600                                                                  23860000
238700         MOVE 1                TO ASC-BLK-SUB                     23870000
238800                                  PV-BLOCK-NUMBER                 23880000
238900         PERFORM 4410-READ-TEMP-STORAGE                           23890000
239000         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             23900000
239100             MOVE 2            TO ASC-BLK-SUB                     23910000
239200                                  PV-BLOCK-NUMBER                 23920000
239300             PERFORM 4410-READ-TEMP-STORAGE                       23930000
239400         END-IF                                                   23940000
239500     END-IF.                                                      23950000
239600                                                                  23960000
239700                                                                  23970000
243100*----------------------------------------------------------------*24310000
243200* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *24320000
243300*----------------------------------------------------------------*24330000
243400                                                                  24340000
243500 4400-MOVE-COMMAREA-TO-SCREEN.                                    24350000
243600     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             24360000
243700         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          24370000
243800         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          24380000
243900             MOVE +1    TO ASC-BLK-SUB                            24390000
244000             PERFORM 5100-WRITE-TEMP-STORAGE                      24400000
244100             ADD +1     TO ASC-BLK-SUB                            24410000
244200             PERFORM 5100-WRITE-TEMP-STORAGE                      24420000
244300             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             24430000
244400                 GIVING PV-BLOCK-NUMBER                           24440000
244500                 REMAINDER PV-REMAINDER                           24450000
244600             IF  PV-REMAINDER > ZERO                              24460000
244700                 ADD +1 TO PV-BLOCK-NUMBER                        24470000
244800             END-IF                                               24480000
244900             MOVE +1    TO ASC-BLK-SUB                            24490000
245000             PERFORM 4410-READ-TEMP-STORAGE                       24500000
245100             ADD +1     TO ASC-BLK-SUB                            24510000
245200                           PV-BLOCK-NUMBER                        24520000
245300             PERFORM 4410-READ-TEMP-STORAGE                       24530000
245400     END-IF.                                                      24540000
245500     MOVE +1            TO ASC-BLK-SUB.                           24550000
245600     COMPUTE ASC-ITEM-SUB =                                       24560000
245700         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              24570000
245800         + PC-ITEMS-PER-PANEL).                                   24580000
245900                                                                  24590000
246000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        24600000
246100         ADD +1         TO ASC-BLK-SUB                            24610000
246200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            24620000
246300     END-IF.                                                      24630000
246400                                                                  24640000
246500     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           24650000
246600         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                24660000
246700     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        24670000
246800     PERFORM 4420-FORMAT-LIST-LINES                               24680000
246900         VARYING PV-SUB                                           24690000
247000         FROM PC-ITEMS-PER-PANEL BY -1                            24700000
247100         UNTIL PV-SUB < +1.                                       24710000
247200                                                                  24720000
247300     COMPUTE ASC-ITEMS-DISPLAYED =                                24730000
247400         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          24740000
247500     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    24750000
247600                                      ASTRTITO.                   24760000
247700     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    24770000
247800     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    24780000
247900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            24790000
248000                                   TO ASELITO.                    24800000
248100                                                                  24810000
248200     IF  DP020-MSG-NUMBER-X = SPACE                               24820000
248300         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  24830000
248400*            --- MORE ITEMS TO DISPLAY ----                       24840000
248500             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            24850000
248600             SET DP020-MSG-INFORMATIONAL TO TRUE                  24860000
248700         END-IF                                                   24870000
248800     END-IF.                                                      24880000
248900*----------------------------------------------------------------*24890000
249000*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *24900000
249100*----------------------------------------------------------------*24910000
249200                                                                  24920000
249300 4410-READ-TEMP-STORAGE.                                          24930000
249400                                                                  24940000
249500     EXEC CICS                                                    24950000
249600         READQ TS                                                 24960000
249700             QUEUE (ASC-LIST-QUEUE-NAME)                          24970000
249800             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24980000
249900             ITEM  (PV-BLOCK-NUMBER)                              24990000
250000             RESP  (PV-CICS-RESP)                                 25000000
250100     END-EXEC.                                                    25010000
250200     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       25020000
250300       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     25030000
250400         CONTINUE                                                 25040000
250500     ELSE                                                         25050000
250600         SET DP013-CICS-ABEND     TO TRUE                         25060000
250700         SET DP013-NO-ROLLBACK    TO TRUE                         25070000
250800         MOVE '4410-READ-TEMP-STORAGE'                            25080000
250900                                  TO DP013-PARAGRAPH              25090000
251000         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      25100000
251100                                  TO DP013-MESSAGE-TEXT(1)        25110000
251200         PERFORM DP013-0000-PROCESS-ABEND                         25120000
251300     END-IF.                                                      25130000
251400                                                                  25140000
251500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             25150000
251600                                                                  25160000
251700     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         25170000
251800         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               25180000
251900     END-IF.                                                      25190000
252000 EJECT                                                            25200000
252100*----------------------------------------------------------------*25210000
252200*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *25220000
252300*----------------------------------------------------------------*25230000
252400                                                                  25240000
252500 4420-FORMAT-LIST-LINES.                                          25250000
252600     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      25260000
252700         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                25270000
252800         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           25280000
252900                                    MR-PO-A  (PV-SUB)             25290000
253000                                    MR-LINE-A  (PV-SUB)           25300000
253100                                    MR-OPER-A  (PV-SUB)           25310000
253200                                    MR-TYPE-A  (PV-SUB)           25320000
253300                                    MR-CREATE-DATE-A  (PV-SUB)    25330000
253400                                    MR-UPDATE-DATE-A (PV-SUB)     25340000
253500                                    MR-SHIP-DATE-A  (PV-SUB)      25350000
253600                                    MR-CANCEL-DATE-A  (PV-SUB)    25360000
253610                                    MR-USER-A  (PV-SUB)           25361000
253620         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           25362000
253630         MOVE SPACE              TO MR-SELECTI (PV-SUB)           25363000
253640                                    MR-ACTION (PV-SUB)            25364000
253700     ELSE                                                         25370000
253800         PERFORM 4420A-FILL-SCREEN                                25380000
254600                                                                  25460000
254700         IF  DP030-SET-CURSOR-TRAILER                             25470000
254800             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)25480000
254900                 > SPACE)                                         25490000
255000               OR (PV-SUB = 1))                                   25500000
255100                SET DP030-SET-CURSOR-APPL-1 TO TRUE               25510000
255200                MOVE -1          TO MR-SELECTL (PV-SUB)           25520000
255300             END-IF                                               25530000
255400         END-IF                                                   25540000
255500                                                                  25550000
255600         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           25560000
255800             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           25580000
255900                                 TO MR-ACTION (PV-SUB)            25590000
255910         ELSE                                                     25591000
256000             IF ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES    25600000
256100                 MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)       25610000
256200                                     TO MR-ACTION (PV-SUB)        25620000
256400             END-IF                                               25640000
257600         END-IF                                                   25760000
257700     END-IF.                                                      25770000
257800     SUBTRACT +1 FROM ASC-ITEM-SUB                                25780000
257900     IF  ASC-ITEM-SUB < + 1                                       25790000
258000         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  25800000
258100         MOVE +1                 TO ASC-BLK-SUB                   25810000
258200     END-IF.                                                      25820000
258201                                                                  25820100
258202                                                                  25820200
258210 4420A-FILL-SCREEN.                                               25821000
258220     IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)          25822000
258230                                                   > SPACE        25823000
258240         MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     25824000
258250                                 TO MR-SELECTI (PV-SUB)           25825000
258260     ELSE                                                         25826000
258270         MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)          25827000
258280                                 TO MR-SELECTI (PV-SUB)           25828000
258290     END-IF                                                       25829000
258291                                                                  25829100
258292     MOVE ASC-PO-NBR (ASC-BLK-SUB ASC-ITEM-SUB)                   25829200
258293                                      TO MR-PO   (PV-SUB)         25829300
258294     EVALUATE TRUE                                                25829400
258295     WHEN ASC-PO-LINE (ASC-BLK-SUB ASC-ITEM-SUB) > ZERO           25829500
258296         MOVE ASC-PO-LINE (ASC-BLK-SUB ASC-ITEM-SUB)              25829600
258297                                      TO PV-DISP-4                25829700
258298          STRING 'L-' PV-DISP-4                                   25829800
258299                 DELIMITED BY SIZE  INTO MR-LINE (PV-SUB)         25829900
258300     WHEN ASC-PREPACK-ID (ASC-BLK-SUB ASC-ITEM-SUB) > ZERO        25830000
258301          MOVE ASC-PREPACK-ID (ASC-BLK-SUB ASC-ITEM-SUB)          25830100
258302                                      TO PV-DISP-4                25830200
258303          STRING 'P-' PV-DISP-4                                   25830300
258304                 DELIMITED BY SIZE  INTO MR-LINE (PV-SUB)         25830400
258305     WHEN OTHER                                                   25830500
258306          MOVE SPACES                 TO MR-LINE (PV-SUB)         25830600
258307     END-EVALUATE                                                 25830700
258308                                                                  25830800
258309     MOVE ASC-OPER-UNT-ID (ASC-BLK-SUB ASC-ITEM-SUB)              25830900
258310                                      TO MR-OPER (PV-SUB)         25831000
258311                                                                  25831100
258312     MOVE ASC-AUDIT-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)               25831200
258313                                      TO MR-TYPE (PV-SUB)         25831300
258314                                                                  25831400
258315     MOVE ASC-AUDIT-CRE-DATE (ASC-BLK-SUB ASC-ITEM-SUB)           25831500
258316                                      TO MR-CREATE-DATE (PV-SUB)  25831600
258317                                                                  25831700
258318     MOVE ASC-AUDIT-UPD-DATE (ASC-BLK-SUB ASC-ITEM-SUB)           25831800
258319                                      TO MR-UPDATE-DATE (PV-SUB)  25831900
258320                                                                  25832000
258321     MOVE ASC-SHIP-DATE (ASC-BLK-SUB ASC-ITEM-SUB)                25832100
258322                                      TO MR-SHIP-DATE (PV-SUB)    25832200
258323                                                                  25832300
258324     MOVE ASC-CANCEL-DATE (ASC-BLK-SUB ASC-ITEM-SUB)              25832400
258325                                      TO MR-CANCEL-DATE (PV-SUB)  25832500
258326                                                                  25832600
258327     MOVE ASC-USER-ID (ASC-BLK-SUB ASC-ITEM-SUB)                  25832700
258328                                      TO MR-USER (PV-SUB).        25832800
258329                                                                  25832900
258330                                                                  25833000
258340******************************************************************25834000
258400** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **25840000
258500** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **25850000
258600** ISSUE A WARNING.                                             **25860000
258700******************************************************************25870000
258800 4430-CHECK-FOR-BEGIN-AND-END.                                    25880000
258900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       25890000
259000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     25900000
259100*            -- NO END-OF-RANGE SPECFIED ---                      25910000
259200             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            25920000
259300             SET DP020-MSG-WARNING TO TRUE                        25930000
259400             PERFORM 4431-POSITION-AT-WARNING                     25940000
259500         END-IF                                                   25950000
259600     ELSE                                                         25960000
259700         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     25970000
259800*            -- NO BEGINNING-OF-RANGE SPECFIED ---                25980000
259900             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            25990000
260000             SET DP020-MSG-WARNING TO TRUE                        26000000
260100             PERFORM 4431-POSITION-AT-WARNING                     26010000
260200         END-IF                                                   26020000
260300     END-IF.                                                      26030000
260400******************************************************************26040000
260500** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **26050000
260600** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **26060000
260700** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **26070000
260800** POSITION THE CURSOR THERE.                                   **26080000
260900******************************************************************26090000
261000 4431-POSITION-AT-WARNING.                                        26100000
261100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 26110000
261200                    - PV-TOP-ITEM + 1.                            26120000
261300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      26130000
261400         CONTINUE                                                 26140000
261500     ELSE                                                         26150000
261600         SET DP030-SET-CURSOR-APPL-1                              26160000
261700                                   TO TRUE                        26170000
261800         MOVE -1                   TO MR-SELECTL (PV-SUB)         26180000
261900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         26190000
262000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         26200000
262100     END-IF.                                                      26210000
262200                                                                  26220000
262300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   26230000
262400                    - PV-TOP-ITEM + 1.                            26240000
262500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      26250000
262600         CONTINUE                                                 26260000
262700     ELSE                                                         26270000
262800         SET DP030-SET-CURSOR-APPL-1                              26280000
262900                                   TO TRUE                        26290000
263000         MOVE -1                   TO MR-SELECTL (PV-SUB)         26300000
263100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         26310000
263200         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         26320000
263300     END-IF.                                                      26330000
263400 EJECT                                                            26340000
263500*----------------------------------------------------------------*26350000
263600*  DELETE FUNCTION FUNCTION                                       26360000
263700*----------------------------------------------------------------*26370000
263800 4600-PROCESS-DELETE-FUNCTION.                                    26380000
263900                                                                  26390000
264000                                                                  26400000
264100     MOVE +1                       TO ASC-BLK-SUB.                26410000
264200     PERFORM 5100-WRITE-TEMP-STORAGE.                             26420000
264300     ADD +1                        TO ASC-BLK-SUB.                26430000
264400     PERFORM 5100-WRITE-TEMP-STORAGE.                             26440000
264500                                                                  26450000
264600     PERFORM 6112-READ-LIST-QUEUE.                                26460000
264700                                                                  26470000
264800     SET  LQW-IDX  TO   1.                                        26480000
264900                                                                  26490000
265000       IF PV-CICS-RESP = DFHRESP (NORMAL)                         26500000
265100         PERFORM                                                  26510000
265200         VARYING LQW-IDX  FROM 1 BY 1                             26520000
265300         UNTIL   LQW-IDX > PC-ITEMS-PER-PANEL                     26530000
265400            OR   LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO            26540000
265500            OR   PS-ERROR                                         26550000
265600             IF  LQW-SELECT (LQW-IDX)                             26560000
265700                 PERFORM 4605-PROCESS-SELECTED-LINES              26570000
265800             END-IF                                               26580000
265900         END-PERFORM                                              26590000
266000       END-IF.                                                    26600000
266100                                                                  26610000
266200     MOVE PV-ITEM      TO PV-SAVE-ITEM.                           26620000
266300     PERFORM 6111-WRITE-LIST-QUEUE.                               26630000
266400                                                                  26640000
266500     MOVE +1                     TO  ASC-BLK-SUB.                 26650000
266600     PERFORM 4410-READ-TEMP-STORAGE.                              26660000
266700                                                                  26670000
266800     ADD +1                      TO  ASC-BLK-SUB                  26680000
266900                                     PV-BLOCK-NUMBER.             26690000
267000                                                                  26700000
267100     PERFORM 4410-READ-TEMP-STORAGE.                              26710000
267200                                                                  26720000
267300*----------------------------------------------------------------*26730000
267400*                                                                 26740000
267500*----------------------------------------------------------------*26750000
267600 4605-PROCESS-SELECTED-LINES.                                     26760000
267700                                                                  26770000
267800     PERFORM 4620-PROCESS-LINES.                                  26780000
267900                                                                  26790000
268000     IF  PS-NO-ERROR                                              26800000
268100         SET  LQW-DESELECT (LQW-IDX) TO TRUE                      26810000
268200         MOVE PC-DEL      TO LQW-ACTION (LQW-IDX)                 26820000
268300                                                                  26830000
268400         SUBTRACT  1                                              26840000
268500             FROM  ASC-NUMBER-OF-SELECTED-ITEMS                   26850000
268600         MOVE LQW-SELECTED-SW (LQW-IDX)                           26860000
268700                              TO LQW-TEMP-SELECTED-SW (LQW-IDX)   26870000
268800     END-IF.                                                      26880000
268900                                                                  26890000
269000                                                                  26900000
269100*----------------------------------------------------------------*26910000
269200*                                                                 26920000
269300*                                                                 26930000
269400*----------------------------------------------------------------*26940000
269500 4620-PROCESS-LINES.                                              26950000
269600                                                                  26960000
269700                                                                  26970000
269800     IF  PS-NO-ERROR                                              26980000
269810         MOVE LQW-PO-NBR (LQW-IDX)       TO SUT00014-PO-NBR       26981000
269820         MOVE LQW-PO-LINE (LQW-IDX)      TO SUT00014-PO-LNE-NBR   26982000
269830         MOVE LQW-PREPACK-ID (LQW-IDX)   TO SUT00014-PO-PREPK-ID  26983000
269840         MOVE LQW-OPER-UNT-ID (LQW-IDX)  TO SUT00014-OPER-UNT-ID  26984000
270000                                                                  27000000
270100******************************************************************27010000
270200* PROCESS SELECTED LINES BASED ON FUNCTION SELECTED               27020000
270300* FUNC-03 (DELETE)                                                27030000
270400*  --DELETE SELECTED AUDIT RANK, ONLY IF THERE ARE NO             27040000
270500*       VENDORS OR VENDOR/DEPARTMENTS THAT HAVE THE SELECTED      27050000
270600*       AUDIT RANK/PKING TYPE CLASSIFICATION                      27060000
270700*       --OR--                                                    27070000
270800*       IF THERE IS AN ENTRY IN THE AUDIT REQUEST TABLE           27080000
270900******************************************************************27090000
271000                                                                  27100000
271100                                                                  27110000
271200         IF  LQW-SELECT (LQW-IDX)                                 27120000
271300             IF ASC-CONFIRM-DELETE                                27130000
272200                   PERFORM 4200-DELETE-PO-AUDIT-EXCPT             27220000
272600         END-IF                                                   27260000
272610     END-IF.                                                      27261000
272700                                                                  27270000
272800                                                                  27280000
273000*----------------------------------------------------------------*27300000
273100* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *27310000
273200* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *27320000
273300* FOR THE SELECTED ITEMS QUEUE.                                  *27330000
273400*                                                                *27340000
273500* DETERMINE WHICH COPYBOOK WILL BE USED TO PREPARE THE SELECTION *27350000
273600* QUEUE BASED ON THE FUNCTION SELECTED (FUCN02 AND FUNC03 GO TO  *27360000
273700* RC LISTS WHICH USE A DIFFERENT COPYBOOK                        *27370000
273800*                                                                *27380000
273900* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *27390000
274000* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *27400000
274100* THE ARRAY IS FULL.                                             *27410000
274200*----------------------------------------------------------------*27420000
274300                                                                  27430000
274400 5000-PREPARE-SEL-QUEUE.                                          27440000
274500                                                                  27450000
274600     MOVE +1                   TO  ASC-BLK-SUB.                   27460000
274700     PERFORM 5100-WRITE-TEMP-STORAGE.                             27470000
274800     ADD +1                    TO  ASC-BLK-SUB.                   27480000
274900     PERFORM 5100-WRITE-TEMP-STORAGE.                             27490000
275000     MOVE ASC-SEL-QUEUE-NAME     TO  SU021-SEL-QUEUE-NAME         27500000
275100                                                                  27510000
275200     PERFORM 6010-DELETE-SEL-QUEUE.                               27520000
275300                                                                  27530000
275400     SET ASC-UPDATE-TSQ        TO  TRUE.                          27540000
275500     SET SU022-IDX         TO  1                                  27550000
275600     MOVE ZERO             TO SU021-NUMBER-OF-TS-ITEMS            27560000
275700     INITIALIZE SU022-SELECTED-ITEM-ARRAY                         27570000
275800                                                                  27580000
275900     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           27590000
276000       VARYING PV-ITEM FROM 1 BY 1                                27600000
276100         UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN                27610000
276200                                                                  27620000
276300                                                                  27630000
276400       IF SU022-IDX > 1                                           27640000
276500           PERFORM 5205-WRITE-SEL-QUEUE                           27650000
276600           ADD +1 TO SU021-NUMBER-OF-TS-ITEMS                     27660000
276700       END-IF.                                                    27670000
276800 EJECT                                                            27680000
276900                                                                  27690000
288200*----------------------------------------------------------------*28820000
288300*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *28830000
288400*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *28840000
288500*----------------------------------------------------------------*28850000
288600                                                                  28860000
288700 5100-WRITE-TEMP-STORAGE.                                         28870000
288800     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     28880000
288900                                   TO PV-LIST-ITEM-NUMBER.        28890000
289000     COMPUTE PV-BLOCK-NUMBER =                                    28900000
289100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    28910000
289200                                                                  28920000
289300     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             28930000
289400     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             28940000
289500         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      28950000
289600             PERFORM 5105-REWRITE-ASC-LISTQ                       28960000
289700         END-IF                                                   28970000
289800     ELSE                                                         28980000
289900         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       28990000
290000         ASC-HIGHEST-BLOCK-WRITTEN + 1                            29000000
290100         PERFORM 5110-WRITE-ASC-LISTQ                             29010000
290200         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   29020000
290300     END-IF.                                                      29030000
290400                                                                  29040000
290500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             29050000
290600******************************************************************29060000
290700** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **29070000
290800** SPECIFIC COMMAREA.                                           **29080000
290900******************************************************************29090000
291000 5105-REWRITE-ASC-LISTQ.                                          29100000
291100     EXEC CICS                                                    29110000
291200         WRITEQ TS                                                29120000
291300             QUEUE (ASC-LIST-QUEUE-NAME)                          29130000
291400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               29140000
291500             ITEM  (PV-BLOCK-NUMBER)                              29150000
291600             REWRITE                                              29160000
291700             RESP  (PV-CICS-RESP)                                 29170000
291800     END-EXEC.                                                    29180000
291900                                                                  29190000
292000     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           29200000
292100         CONTINUE                                                 29210000
292200     ELSE                                                         29220000
292300         SET DP013-CICS-ABEND            TO TRUE                  29230000
292400         SET DP013-NO-ROLLBACK           TO TRUE                  29240000
292500         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       29250000
292600         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     29260000
292700                                         TO DP013-MESSAGE-TEXT(1) 29270000
292800         PERFORM DP013-0000-PROCESS-ABEND                         29280000
292900     END-IF.                                                      29290000
293000                                                                  29300000
293100******************************************************************29310000
293200** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **29320000
293300** SPECIFIC COMMAREA.                                           **29330000
293400******************************************************************29340000
293500 5110-WRITE-ASC-LISTQ.                                            29350000
293600     EXEC CICS                                                    29360000
293700         WRITEQ TS                                                29370000
293800             QUEUE (ASC-LIST-QUEUE-NAME)                          29380000
293900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               29390000
294000             ITEM  (PV-BLOCK-NUMBER)                              29400000
294100             RESP  (PV-CICS-RESP)                                 29410000
294200     END-EXEC.                                                    29420000
294300     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      29430000
294400         SET DP013-CICS-ABEND      TO TRUE                        29440000
294500         SET DP013-NO-ROLLBACK     TO TRUE                        29450000
294600         MOVE '5110-WRITE-ASC-LISTQ'                              29460000
294700                                   TO DP013-PARAGRAPH             29470000
294800         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           29480000
294900                                   TO DP013-MESSAGE-TEXT(1)       29490000
295000         PERFORM DP013-0000-PROCESS-ABEND                         29500000
295100     END-IF.                                                      29510000
295200 EJECT                                                            29520000
295300*----------------------------------------------------------------*29530000
295400* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *29540000
295500* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *29550000
295600*----------------------------------------------------------------*29560000
295700                                                                  29570000
295800 5200-FILL-SEL-QUEUE-RECORD.                                      29580000
295900                                                                  29590000
296000     PERFORM 6112-READ-LIST-QUEUE.                                29600000
296100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       29610000
296200         PERFORM                                                  29620000
296300         VARYING LQW-IDX                                          29630000
296400         FROM 1 BY 1                                              29640000
296500         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            29650000
296600           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          29660000
296700                                                                  29670000
296800             IF  LQW-SELECT (LQW-IDX)                             29680000
296900                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              29690000
297000                                   TO SU022-ITEM (SU022-IDX)      29700000
297100                 MOVE SPACE        TO SU022-ACTION-SW (SU022-IDX) 29710000
297200*              LOAD SELECTIONS TO SEL-QUEUE                       29720000
297300                 MOVE LQW-PO-NBR (LQW-IDX)                        29730000
297400                                      TO SU022-PO-NBR             29740000
297500                                         (SU022-IDX)              29750000
297600                 MOVE LQW-PO-LINE (LQW-IDX)                       29760000
297700                                      TO SU022-PO-LNE-NBR         29770000
297800                                         (SU022-IDX)              29780000
297900                 MOVE LQW-PREPACK-ID (LQW-IDX)                    29790000
298000                                      TO SU022-PREPACK-ID         29800000
298100                                         (SU022-IDX)              29810000
298200                 MOVE LQW-OPER-UNT-ID (LQW-IDX)                   29820000
298300                                      TO SU022-OPER-UNT-ID        29830000
298310                                         (SU022-IDX)              29831000
298320                 EVALUATE LQW-AUDIT-TYPE (LQW-IDX)                29832000
298330                     WHEN '100'                                   29833000
298340                         MOVE 'A'     TO SU022-AUDIT-TYPE         29834000
298350                                         (SU022-IDX)              29835000
298360                                                                  29836000
298370                     WHEN 'NO '                                   29837000
298380                         MOVE 'N'     TO SU022-AUDIT-TYPE         29838000
298390                                         (SU022-IDX)              29839000
      *SB 10/07/13 - BEGIN PR#5148D                                     29839100
298370                     WHEN 'RF '                                   29839200
298380                         MOVE 'R'     TO SU022-AUDIT-TYPE         29839300
298390                                         (SU022-IDX)              29839400
298370                     WHEN 'QC '                                   29839500
298380                         MOVE 'Q'     TO SU022-AUDIT-TYPE         29839600
298390                                         (SU022-IDX)              29839700
      *SB 10/07/13 - END PR#5148D                                       29839800
298391                 END-EVALUATE                                     29839900
298392                 SET SU022-IDX UP BY 1                            29840000
298393                 IF  SU022-IDX > SU022-MAX-ITEMS                  29840100
298394                     PERFORM 5205-WRITE-SEL-QUEUE                 29840200
298395                     ADD +1        TO SU021-NUMBER-OF-TS-ITEMS    29840300
298396                     INITIALIZE SU022-SELECTED-ITEM-ARRAY         29840400
298397                     SET SU022-IDX TO  1                          29840500
298398                 END-IF                                           29840600
298399             END-IF                                               29840700
298400         END-PERFORM                                              29841000
298500     END-IF.                                                      29850000
298600                                                                  29860000
298700*----------------------------------------------------------------*29870000
298800*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *29880000
298900*----------------------------------------------------------------*29890000
299000                                                                  29900000
299100 5205-WRITE-SEL-QUEUE.                                            29910000
299200                                                                  29920000
299300     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            29930000
299400                                   TO SU022-SELECTED-ITEMS.       29940000
299500                                                                  29950000
299600     EXEC CICS                                                    29960000
299700          WRITEQ TS                                               29970000
299800              QUEUE (ASC-SEL-QUEUE-NAME)                          29980000
299900              FROM  (SU022-SELECT-RECORD)                         29990000
300000              ITEM  (PV-SEL-QUEUE-ITEM)                           30000000
300100              RESP  (PV-CICS-RESP)                                30010000
300200     END-EXEC.                                                    30020000
300300                                                                  30030000
300400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          30040000
300500         CONTINUE                                                 30050000
300600     ELSE                                                         30060000
300700         SET DP013-CICS-ABEND      TO TRUE                        30070000
300800         SET DP013-NO-ROLLBACK     TO TRUE                        30080000
300900         MOVE '5205-WRITE-SEL-QUEUE'                              30090000
301000                                   TO DP013-PARAGRAPH             30100000
301100         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          30110000
301200                                   TO DP013-MESSAGE-TEXT(1)       30120000
301300         PERFORM DP013-0000-PROCESS-ABEND                         30130000
301400     END-IF.                                                      30140000
301500******************************************************************30150000
301600 6000-REFRESH-PANEL-FROM-TEMP.                                    30160000
301700     IF  ASC-UPDATE-TSQ                                           30170000
301800         SET ASC-NO-TSQ-UPDATE TO TRUE                            30180000
301900         MOVE ZERO                 TO PV-SAVE-ITEM                30190000
302000                                      PV-SEL-QUEUE-ITEM           30200000
302100         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        30210000
302200                                   TO PV-HOLD-SELECTED-ITEMS      30220000
302300         MOVE +1                   TO PV-ITEMS-PROCESSED          30230000
302400         PERFORM 6100-UPDATE-TSQ                                  30240000
302500           UNTIL PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS      30250000
302600                                                                  30260000
302700         SET ASC-FUNC02-RETURN-NO TO TRUE                         30270000
302800                                                                  30280000
302900                                                                  30290000
303000         INITIALIZE ASC-BLOCK-ENTRIES (1)                         30300000
303100                    ASC-BLOCK-ENTRIES (2)                         30310000
303200     END-IF.                                                      30320000
303300                                                                  30330000
303400*----------------------------------------------------------------*30340000
303500*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *30350000
303600*----------------------------------------------------------------*30360000
303700 6010-DELETE-SEL-QUEUE.                                           30370000
303800                                                                  30380000
303900     EXEC CICS                                                    30390000
304000         DELETEQ TS                                               30400000
304100             QUEUE (ASC-SEL-QUEUE-NAME)                           30410000
304200             RESP  (PV-CICS-RESP)                                 30420000
304300     END-EXEC.                                                    30430000
304400     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      30440000
304500        (PV-CICS-RESP = DFHRESP(QIDERR)))                         30450000
304600         CONTINUE                                                 30460000
304700     ELSE                                                         30470000
304800         SET DP013-CICS-ABEND TO TRUE                             30480000
304900         SET DP013-NO-ROLLBACK TO TRUE                            30490000
305000         MOVE '6010-DELETE-SEL-QUEUE'                             30500000
305100                        TO DP013-PARAGRAPH                        30510000
305200         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         30520000
305300                        TO DP013-MESSAGE-TEXT (1)                 30530000
305400         PERFORM DP013-0000-PROCESS-ABEND                         30540000
305500     END-IF.                                                      30550000
305600                                                                  30560000
305700 EJECT                                                            30570000
305800*----------------------------------------------------------------*30580000
305900*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *30590000
306000*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *30600000
306100*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *30610000
306200*    THE TEMP QUEUE.                                             *30620000
306300*----------------------------------------------------------------*30630000
306400                                                                  30640000
306500 6100-UPDATE-TSQ.                                                 30650000
306600                                                                  30660000
306700     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             30670000
306800     PERFORM 6105-READ-SEL-QUEUE.                                 30680000
306900     PERFORM                                                      30690000
307000         VARYING SU022-IDX                                        30700000
307100         FROM 1 BY 1                                              30710000
307200         UNTIL ((PV-ITEMS-PROCESSED >                             30720000
307300                              PV-HOLD-SELECTED-ITEMS)             30730000
307400         OR (SU022-IDX GREATER THAN SU022-MAX-ITEMS))             30740000
307500         IF  SU022-ACTION-SW (SU022-IDX) > SPACE                  30750000
307600             PERFORM 6110-PROCESS-ITEMS                           30760000
307700         END-IF                                                   30770000
307800         ADD +1                TO PV-ITEMS-PROCESSED              30780000
307900     END-PERFORM.                                                 30790000
308000     PERFORM 6111-WRITE-LIST-QUEUE.                               30800000
308100*----------------------------------------------------------------*30810000
308200*    READ THE LIST QUEUE RECORD.                                 *30820000
308300*----------------------------------------------------------------*30830000
308400                                                                  30840000
308500 6105-READ-SEL-QUEUE.                                             30850000
308600                                                                  30860000
308700     EXEC CICS                                                    30870000
308800          READQ TS                                                30880000
308900              QUEUE (ASC-SEL-QUEUE-NAME)                          30890000
309000              INTO  (SU022-SELECT-RECORD)                         30900000
309100              ITEM  (PV-SEL-QUEUE-ITEM)                           30910000
309200              RESP  (PV-CICS-RESP)                                30920000
309300     END-EXEC.                                                    30930000
309400*                                                                 30940000
309500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          30950000
309600         CONTINUE                                                 30960000
309700     ELSE                                                         30970000
309800         SET DP013-CICS-ABEND      TO  TRUE                       30980000
309900         SET DP013-NO-ROLLBACK     TO  TRUE                       30990000
310000         MOVE '6105-READ-SEL-QUEUE'                               31000000
310100                                   TO  DP013-PARAGRAPH            31010000
310200         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           31020000
310300                                   TO  DP013-MESSAGE-TEXT(1)      31030000
310400         PERFORM DP013-0000-PROCESS-ABEND                         31040000
310500     END-IF.                                                      31050000
310600 EJECT                                                            31060000
310700*----------------------------------------------------------------*31070000
310800*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*31080000
310900*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*31090000
311000*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *31100000
311100*----------------------------------------------------------------*31110000
311200                                                                  31120000
311300 6110-PROCESS-ITEMS.                                              31130000
311400                                                                  31140000
311500     COMPUTE PV-ITEM = 1 + ((SU022-ITEM (SU022-IDX) - 1)          31150000
311600                     / PC-ITEMS-PER-PANEL).                       31160000
311700                                                                  31170000
311800     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           31180000
311900         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          31190000
312000             PERFORM 6111-WRITE-LIST-QUEUE                        31200000
312100         END-IF                                                   31210000
312200         MOVE PV-ITEM          TO PV-SAVE-ITEM                    31220000
312300                                                                  31230000
312400         PERFORM 6112-READ-LIST-QUEUE                             31240000
312500         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               31250000
312600             CONTINUE                                             31260000
312700         END-IF                                                   31270000
312800     END-IF.                                                      31280000
312900                                                                  31290000
313000     COMPUTE PV-SUB = (SU022-ITEM (SU022-IDX)                     31300000
313100                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              31310000
313200     SET LQW-DESELECT (PV-SUB) TO    TRUE                         31320000
313300     MOVE LQW-SELECTED-SW (PV-SUB)                                31330000
313400                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  31340000
313500     EVALUATE TRUE                                                31350000
313600         WHEN SU022-INQ (SU022-IDX)                               31360000
313700              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             31370000
313800                                                                  31380000
313900         WHEN SU022-UPD (SU022-IDX)                               31390000
314000              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             31400000
314100                                                                  31410000
314200         WHEN SU022-DEL (SU022-IDX)                               31420000
314300              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             31430000
314400                                                                  31440000
314500         WHEN SU022-ERR (SU022-IDX)                               31450000
314600              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             31460000
314700     END-EVALUATE.                                                31470000
314701                                                                  31470100
314702     PERFORM 6120-GET-AUDIT-TYPE.                                 31470200
314703                                                                  31470300
315900     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                31590000
316000                                                                  31600000
316100*----------------------------------------------------------------*31610000
316200*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *31620000
316300*----------------------------------------------------------------*31630000
316400                                                                  31640000
316500 6111-WRITE-LIST-QUEUE.                                           31650000
316600                                                                  31660000
316700     EXEC CICS                                                    31670000
316800         WRITEQ TS                                                31680000
316900             QUEUE (ASC-LIST-QUEUE-NAME)                          31690000
317000             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     31700000
317100             ITEM  (PV-SAVE-ITEM)                                 31710000
317200             REWRITE                                              31720000
317300             RESP  (PV-CICS-RESP)                                 31730000
317400     END-EXEC.                                                    31740000
317500*                                                                 31750000
317600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          31760000
317700         CONTINUE                                                 31770000
317800     ELSE                                                         31780000
317900         SET DP013-CICS-ABEND  TO  TRUE                           31790000
318000         SET DP013-NO-ROLLBACK TO  TRUE                           31800000
318100         MOVE '6111-WRITE-LIST-QUEUE'                             31810000
318200                               TO  DP013-PARAGRAPH                31820000
318300         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  31830000
318400                               TO  DP013-MESSAGE-TEXT(1)          31840000
318500         PERFORM DP013-0000-PROCESS-ABEND                         31850000
318600     END-IF.                                                      31860000
318700                                                                  31870000
318800 EJECT                                                            31880000
318900*----------------------------------------------------------------*31890000
319000*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*31900000
319100*----------------------------------------------------------------*31910000
319200                                                                  31920000
319300 6112-READ-LIST-QUEUE.                                            31930000
319400                                                                  31940000
319500     EXEC CICS                                                    31950000
319600         READQ TS                                                 31960000
319700             QUEUE (ASC-LIST-QUEUE-NAME)                          31970000
319800             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     31980000
319900             ITEM  (PV-ITEM)                                      31990000
320000             RESP  (PV-CICS-RESP)                                 32000000
320100     END-EXEC.                                                    32010000
320200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          32020000
320300         CONTINUE                                                 32030000
320400     ELSE                                                         32040000
320500         SET DP013-CICS-ABEND        TO TRUE                      32050000
320600         SET DP013-NO-ROLLBACK       TO TRUE                      32060000
320700         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           32070000
320800         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    32080000
320900                                     TO DP013-MESSAGE-TEXT(1)     32090000
321000         PERFORM DP013-0000-PROCESS-ABEND                         32100000
321100     END-IF.                                                      32110000
321200                                                                  32120000
321300*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 32130000
321301 7000-OPEN-CURSOR.                                                32130100
321302                                                                  32130200
321303     EVALUATE TRUE                                                32130300
321304         WHEN ASC-PO-CSR                                          32130400
321305             MOVE 'CURSOR:  PO-CSR'                               32130500
321306                                   TO DP013-MESSAGE-TEXT (2)      32130600
321307             EXEC SQL                                             32130700
321308                 OPEN PO-CSR                                      32130800
321309             END-EXEC                                             32130900
321310                                                                  32131000
321311         WHEN ASC-PO-OPER-CSR                                     32131100
321312             MOVE 'CURSOR:  PO-OPER-CSR'                          32131200
321313                                   TO DP013-MESSAGE-TEXT (2)      32131300
321314             EXEC SQL                                             32131400
321315                 OPEN PO-OPER-CSR                                 32131500
321316             END-EXEC                                             32131600
321317                                                                  32131700
321318         WHEN ASC-OPER-CSR                                        32131800
321319             MOVE 'CURSOR:  OPER-CSR'                             32131900
321320                                   TO DP013-MESSAGE-TEXT (2)      32132000
321321             EXEC SQL                                             32132100
321322                 OPEN OPER-CSR                                    32132200
321323             END-EXEC                                             32132300
321324                                                                  32132400
321325     END-EVALUATE.                                                32132500
321326                                                                  32132600
321327     EVALUATE TRUE                                                32132700
321328         WHEN SQLCODE = ZERO                                      32132800
321329             CONTINUE                                             32132900
321330         WHEN SQLCODE = -904                                      32133000
321331         WHEN SQLCODE = -911                                      32133100
321332         WHEN SQLCODE = -913                                      32133200
321333             PERFORM 9900-SOFT-ABORT                              32133300
321334         WHEN SQLWARN0 NOT = SPACES                               32133400
321335         WHEN SQLCODE < ZERO                                      32133500
321336         WHEN SQLCODE > ZERO                                      32133600
321337             MOVE '7000-OPEN-CURSOR'                              32133700
321338                                   TO DP013-PARAGRAPH             32133800
321339             MOVE 'OPEN AUDIT CURSOR - '                          32133900
321340                                   TO DP013-MESSAGE-TEXT (1)      32134000
321341             MOVE SQLCA            TO DP013-SQLCA                 32134100
321342             MOVE 'SU_PO_AUD_EXC'                                 32134200
321343                                   TO DP013-DB2-TABLE-NAME (1)    32134300
321344             SET DP013-DB2-ABEND                                  32134400
321345                 DP013-XCTL-DISPLAY-RESTART TO TRUE               32134500
321346             PERFORM DP013-0000-PROCESS-ABEND                     32134600
321347     END-EVALUATE.                                                32134700
321348                                                                  32134800
321349******************************************************************32134900
321350* GET AUDIT TYPE AFTER RETURN FROM UPDATE SCREEN                 *32135000
321351*                                                                *32135100
321352******************************************************************32135200
321353 6120-GET-AUDIT-TYPE.                                             32135300
321354                                                                  32135400
321355     MOVE SU022-PO-NBR (SU022-IDX)       TO  SUT00014-PO-NBR.     32135500
321356     MOVE SU022-PO-LNE-NBR (SU022-IDX)   TO  SUT00014-PO-LNE-NBR. 32135600
321357     MOVE SU022-PREPACK-ID (SU022-IDX)   TO  SUT00014-PO-PREPK-ID.32135700
321358     MOVE SU022-OPER-UNT-ID (SU022-IDX)  TO  SUT00014-OPER-UNT-ID.32135800
321359                                                                  32135900
321360     EXEC SQL                                                     32136000
321361         SELECT AUD_TYP_CDE                                       32136100
321362               ,CHAR(DATE(LAST_UPD_TMST),USA)                     32136200
321363               ,LAST_UPD_BY_USR_ID                                32136300
321364         INTO :SUT00014-AUD-TYP-CDE                               32136400
321365             ,:PV-AUD-LAST-UPD-DATE                               32136500
321366             ,:SUT00014-LAST-UPD-BY-USR-ID                        32136600
321367         FROM SUT_PO_AUD_EXC                                      32136700
321368         WHERE                                                    32136800
321369             PO_NBR                   = :SUT00014-PO-NBR          32136900
321370         AND PO_LNE_NBR               = :SUT00014-PO-LNE-NBR      32137000
321371         AND PO_PREPK_ID              = :SUT00014-PO-PREPK-ID     32137100
321372         AND OPER_UNT_ID              = :SUT00014-OPER-UNT-ID     32137200
321373     END-EXEC                                                     32137300
321374                                                                  32137400
321375     EVALUATE TRUE                                                32137500
321376         WHEN SQLCODE = ZERO                                      32137600
321377              EVALUATE SUT00014-AUD-TYP-CDE                       32137700
321378                  WHEN 'A'                                        32137800
321379                       MOVE '100'  TO LQW-AUDIT-TYPE (PV-SUB)     32137900
321380                  WHEN 'N'                                        32138000
321381                       MOVE 'NO '  TO LQW-AUDIT-TYPE (PV-SUB)     32138100
      *SB 10/07/13 - BEGIN PR#5148D                                     32138200
321380                  WHEN 'R'                                        32138300
321381                       MOVE 'RF '  TO LQW-AUDIT-TYPE (PV-SUB)     32138400
321380                  WHEN 'Q'                                        32138500
321381                       MOVE 'QC '  TO LQW-AUDIT-TYPE (PV-SUB)     32138600
      *SB 10/07/13 - END PR#5148D                                       32138700
321382              END-EVALUATE                                        32138800
321383              MOVE  SUT00014-LAST-UPD-BY-USR-ID                   32138900
321384                                   TO LQW-USER-ID (PV-SUB)        32139000
321385             IF  PV-AUD-LAST-UPD-DATE = '09/09/9999'              32139100
321386                 MOVE SPACES       TO LQW-AUDIT-UPD-DATE (PV-SUB) 32139200
321388             ELSE                                                 32139300
321389              STRING PV-AUD-LAST-UPD-DATE (1:6)                   32139400
321390                     PV-AUD-LAST-UPD-DATE (9:2)                   32139500
321391                                      DELIMITED BY SIZE           32139600
321392                                 INTO LQW-AUDIT-UPD-DATE (PV-SUB) 32139700
321393             END-IF                                               32139800
321394         WHEN SQLCODE = +100                                      32139900
321395              MOVE '   '           TO LQW-AUDIT-TYPE (PV-SUB)     32140000
321396              MOVE PC-DEL          TO LQW-ACTION (PV-SUB)         32140100
321397         WHEN SQLCODE = -904                                      32140200
321398         WHEN SQLCODE = -911                                      32140300
321399         WHEN SQLCODE = -913                                      32140400
321400             PERFORM 9900-SOFT-ABORT                              32140500
321401         WHEN SQLWARN0 NOT = SPACES                               32140600
321402         WHEN SQLCODE < ZERO                                      32140700
321403         WHEN SQLCODE > ZERO                                      32140800
321404             MOVE '6120-GET-AUDIT-TYPE'                           32140900
321405                               TO DP013-PARAGRAPH                 32141000
321406             MOVE 'SELECT AUDIT TYPE AFTER UPDATE'                32141100
321407                               TO DP013-MESSAGE-TEXT (1)          32141200
321408             MOVE SQLCA        TO DP013-SQLCA                     32141300
321409             MOVE 'SU_PO_AUD_EXC'  TO DP013-DB2-TABLE-NAME (1)    32141400
321410             SET DP013-DB2-ABEND                                  32141500
321411                 DP013-XCTL-DISPLAY-RESTART TO TRUE               32141600
321412             PERFORM DP013-0000-PROCESS-ABEND                     32141700
321413     END-EVALUATE.                                                32141800
321414                                                                  32141900
321415                                                                  32142000
321416******************************************************************32142100
321417*                                                                 32142200
321418******************************************************************32142300
321419 7010-FETCH.                                                      32142400
321420                                                                  32142500
321421     EVALUATE TRUE                                                32142600
321422         WHEN ASC-PO-CSR                                          32142700
321423             EXEC SQL                                             32142800
321424                 FETCH PO-CSR                                     32142900
321425                 INTO                                             32143000
321426                    :SUT00014-PO-NBR                              32143100
321427                 ,  :SUT00014-PO-LNE-NBR                          32143200
321428                 ,  :SUT00014-PO-PREPK-ID                         32143300
321429                 ,  :SUT00014-OPER-UNT-ID                         32143400
321430                 ,  :SUT00014-AUD-TYP-CDE                         32143500
321431                 ,  :PV-AUD-CRE-DATE                              32143600
321432                 ,  :PV-AUD-LAST-UPD-DATE                         32143700
321433                 ,  :SUT00014-LAST-UPD-BY-USR-ID                  32143800
321434                 ,  :PV-SHP-DONT-SHIP-BEF-DTE  :PV-NULL-SHIP-IND  32143900
321435                 ,  :PV-SHP-CAN-IFNOT-SHIP-DTE :PV-NULL-CANC-IND  32144000
321436             END-EXEC                                             32144100
321437                                                                  32144200
321438         WHEN ASC-PO-OPER-CSR                                     32144300
321439             EXEC SQL                                             32144400
321440                 FETCH PO-OPER-CSR                                32144500
321441                 INTO                                             32144600
321442                    :SUT00014-PO-NBR                              32144700
321443                 ,  :SUT00014-PO-LNE-NBR                          32144800
321444                 ,  :SUT00014-PO-PREPK-ID                         32144900
321445                 ,  :SUT00014-OPER-UNT-ID                         32145000
321446                 ,  :SUT00014-AUD-TYP-CDE                         32145100
321447                 ,  :PV-AUD-CRE-DATE                              32145200
321448                 ,  :PV-AUD-LAST-UPD-DATE                         32145300
321449                 ,  :SUT00014-LAST-UPD-BY-USR-ID                  32145400
321450                 ,  :PV-SHP-DONT-SHIP-BEF-DTE  :PV-NULL-SHIP-IND  32145500
321451                 ,  :PV-SHP-CAN-IFNOT-SHIP-DTE :PV-NULL-CANC-IND  32145600
321452             END-EXEC                                             32145700
321453                                                                  32145800
321454         WHEN ASC-OPER-CSR                                        32145900
321455             EXEC SQL                                             32146000
321456                 FETCH OPER-CSR                                   32146100
321457                 INTO                                             32146200
321458                    :SUT00014-PO-NBR                              32146300
321459                 ,  :SUT00014-PO-LNE-NBR                          32146400
321460                 ,  :SUT00014-PO-PREPK-ID                         32146500
321461                 ,  :SUT00014-OPER-UNT-ID                         32146600
321462                 ,  :SUT00014-AUD-TYP-CDE                         32146700
321463                 ,  :PV-AUD-CRE-DATE                              32146800
321464                 ,  :PV-AUD-LAST-UPD-DATE                         32146900
321465                 ,  :SUT00014-LAST-UPD-BY-USR-ID                  32147000
321466                 ,  :PV-SHP-DONT-SHIP-BEF-DTE  :PV-NULL-SHIP-IND  32147100
321467                 ,  :PV-SHP-CAN-IFNOT-SHIP-DTE :PV-NULL-CANC-IND  32147200
321468             END-EXEC                                             32147300
321469                                                                  32147400
321470     END-EVALUATE.                                                32147500
321471                                                                  32147600
321472     EVALUATE TRUE                                                32147700
321473         WHEN SQLCODE = ZERO                                      32147800
321474             IF PV-NULL-SHIP-IND = -1                             32147900
321475                 MOVE SPACES          TO PV-SHP-DONT-SHIP-BEF-DTE 32148000
321476             END-IF                                               32148100
321477             IF PV-NULL-CANC-IND = -1                             32148200
321478                 MOVE SPACES          TO PV-SHP-CAN-IFNOT-SHIP-DTE32148300
321479             END-IF                                               32148400
321480         WHEN SQLCODE = +100                                      32148500
321481             SET ASC-NO-ITEMS-LEFT-ON-DB                          32148600
321482                                      TO TRUE                     32148700
321483         WHEN SQLCODE = -904                                      32148800
321484         WHEN SQLCODE = -911                                      32148900
321485         WHEN SQLCODE = -913                                      32149000
321486             PERFORM 9900-SOFT-ABORT                              32149100
321487         WHEN SQLWARN0 NOT = SPACE                                32149200
321488         WHEN SQLCODE NOT = ZERO                                  32149300
321489              MOVE '7010-FETCH-CURSOR'                            32149400
321490                               TO DP013-PARAGRAPH                 32149500
321491              MOVE 'FETCH CURSOR'                                 32149600
321492                               TO DP013-MESSAGE-TEXT (1)          32149700
321493              MOVE 'SU_PO_AUD_EXC'  TO DP013-DB2-TABLE-NAME (2)   32149800
321494              MOVE SQLCA       TO DP013-SQLCA                     32149900
321495              SET DP013-DB2-ABEND                                 32150000
321496                               TO TRUE                            32150100
321497              PERFORM DP013-0000-PROCESS-ABEND                    32150200
321498     END-EVALUATE.                                                32150300
321499                                                                  32150400
321500 7020-CLOSE-CURSOR.                                               32150500
321501     EVALUATE TRUE                                                32150600
321502         WHEN ASC-PO-CSR                                          32150700
321503             EXEC SQL                                             32150800
321504                CLOSE PO-CSR                                      32150900
321505             END-EXEC                                             32151000
321506                                                                  32151100
321507         WHEN ASC-PO-OPER-CSR                                     32151200
321508             EXEC SQL                                             32151300
321509                CLOSE PO-OPER-CSR                                 32151400
321510             END-EXEC                                             32151500
321511                                                                  32151600
321512         WHEN ASC-OPER-CSR                                        32151700
321513             EXEC SQL                                             32151800
321514                CLOSE OPER-CSR                                    32151900
321515             END-EXEC                                             32152000
321516     END-EVALUATE.                                                32152100
321517                                                                  32152200
321518     EVALUATE TRUE                                                32152300
321519         WHEN SQLCODE = ZERO                                      32152400
321520             CONTINUE                                             32152500
321521         WHEN SQLCODE = -904                                      32152600
321522         WHEN SQLCODE = -911                                      32152700
321523         WHEN SQLCODE = -913                                      32152800
321524             PERFORM 9900-SOFT-ABORT                              32152900
321525         WHEN SQLWARN0 NOT = SPACES                               32153000
321526         WHEN SQLCODE < ZERO                                      32153100
321527         WHEN SQLCODE > ZERO                                      32153200
321528             MOVE '7020-CLOSE-CURSOR'                             32153300
321529                               TO DP013-PARAGRAPH                 32153400
321530             MOVE 'CLOSE CURSOR '                                 32153500
321531                               TO DP013-MESSAGE-TEXT (1)          32153600
321532             MOVE SQLCA        TO DP013-SQLCA                     32153700
321533             MOVE 'SU_PO_AUD_EXC'  TO DP013-DB2-TABLE-NAME (1)    32153800
321534             SET DP013-DB2-ABEND                                  32153900
321535                 DP013-XCTL-DISPLAY-RESTART TO TRUE               32154000
321536             PERFORM DP013-0000-PROCESS-ABEND                     32154100
321537     END-EVALUATE.                                                32154200
321538                                                                  32154300
321539*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 32154400
321540 9100-READ-SEL-QUEUE.                                             32154500
321550     EXEC CICS                                                    32155000
321600         READQ TS                                                 32160000
321700             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        32170000
321800             INTO  (SU022-SELECT-RECORD)                          32180000
321900             ITEM  (ASC-SEL-ITEM)                                 32190000
322000             RESP  (PV-CICS-RESP)                                 32200000
322100     END-EXEC.                                                    32210000
322200     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        32220000
322300         CONTINUE                                                 32230000
322400     ELSE                                                         32240000
322500         SET DP013-LOGIC-ABEND                                    32250000
322600             DP013-NO-ROLLBACK   TO   TRUE                        32260000
322700         MOVE '9100-READ-SEL-QUEUE'                               32270000
322800                                 TO   DP013-PARAGRAPH             32280000
322900         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   32290000
323000                                 TO   DP013-MESSAGE-TEXT (1)      32300000
323100         PERFORM DP013-0000-PROCESS-ABEND                         32310000
323200     END-IF.                                                      32320000
323300                                                                  32330000
323400                                                                  32340000
323500*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*32350000
323600* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *32360000
323700*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 32370000
323800 9200-REWRITE-SEL-QUEUE.                                          32380000
323900                                                                  32390000
324000     EXEC CICS                                                    32400000
324100          WRITEQ TS                                               32410000
324200              QUEUE  (ASC-SEL-QUEUE-NAME-IN)                      32420000
324300              FROM   (SU022-SELECT-RECORD)                        32430000
324400              ITEM   (ASC-SEL-ITEM)                               32440000
324500              RESP   (PV-CICS-RESP)                               32450000
324600              REWRITE                                             32460000
324700     END-EXEC.                                                    32470000
324800                                                                  32480000
324900     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   32490000
325000         SET DP013-CICS-ABEND                                     32500000
325100             DP013-NO-ROLLBACK     TO TRUE                        32510000
325200         MOVE '9200-REWRITE-SEL-QUEUE'                            32520000
325300                                   TO DP013-PARAGRAPH             32530000
325400         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   32540000
325500                                   TO DP013-MESSAGE-TEXT (1)      32550000
325600         PERFORM DP013-0000-PROCESS-ABEND                         32560000
325700     END-IF.                                                      32570000
325800                                                                  32580000
325900                                                                  32590000
325910 9900-SOFT-ABORT.                                                 32591000
325920     SET PS-ERROR         TO TRUE.                                32592000
325930     SET DP020-MSG-FATAL  TO TRUE.                                32593000
325940     MOVE 'THROUGH SOFT-ABORT PARA'                               32594000
325950                            TO DP013-MESSAGE-TEXT (1)             32595000
325960     MOVE PC-TSYMSG-00551 TO DP020-MSG-NUMBER.                    32596000
325991                                                                  32599100
325992     MOVE 'PROGRAM EXIT CALL' TO DP013-MESSAGE-TEXT (1).          32599200
325993     PERFORM 0001-CALL-CICS-ARCH-API.                             32599300
325994                                                                  32599400
326000*----------------------------------------------------------------*32600000
326100*    CURRENT SYSTEM DATE/TIME MODULE                              32610000
326200*----------------------------------------------------------------*32620000
326300                                                                  32630000
326400     COPY DPPD017.                                                32640000
326500                                                                  32650000
326600*----------------------------------------------------------------*32660000
326700*    ABEND PROCESSOR MODULE                                      *32670000
326800*----------------------------------------------------------------*32680000
326900                                                                  32690000
327000     COPY DPPD013.                                                32700000
327100                                                                  32710000
