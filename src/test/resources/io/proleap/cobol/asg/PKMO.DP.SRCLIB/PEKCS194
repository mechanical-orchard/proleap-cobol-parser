000100*-----------------------*                                         00010020
000200 IDENTIFICATION DIVISION.                                         00020020
000300*-----------------------*                                         00030020
000400 PROGRAM-ID.    PEKCS194.                                         00040020
000500 AUTHOR.        AMY REILAND.                                      00050020
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060020
000700 DATE-WRITTEN.  08-07-93.                                         00070020
000800 DATE-COMPILED.                                                   00080020
000900*---------------------------------------------------------------* 00090020
001000*    Q194 - DETAIL INQUIRY LIST PROGRAM                         * 00100020
001100*                                                               * 00110020
001200*    THIS PROGRAM GENERATES A LIST OF DETAIL ASSOCIATED WITH    * 00120020
001300*    A PARTICULAR STR/DOCUMENT.  THE DOCUMENT WILL BE SENT FROM * 00130020
001400*    THE HEADER INQUIRY PROGRAM.                                * 00140020
001500*    FROM THIS DETAIL LIST, THE USER CAN GO TO THE STORE SKU    * 00150020
001600*    INQUIRY SCREEN.  THE USER WILL ONLY BE ALLOWED TO SELECT   * 00160020
001700*    THOSE SKUS WHICH ARE FULL SKUS (HAVE A DEPT,CLASS AND SEQ).* 00170020
001800*---------------------------------------------------------------* 00180020
001900* 10/16/02 - TODD C. MICHALEK       - WR NO 21568               * 00190020
002000*    - ADD THE SKU CROSS-REFERENCE TABLE TO CONVERT THE         * 00200020
002100*      DEPARTMENT/CLASS/SEQUENCE NUMBER TO THE 8 DIGIT          * 00210020
002200*      NON-INTELLIGENT SKU.  PASS THE NON-INTELLIGENT SKU       * 00220020
002300*      (ASC-SKU) TO FASHION SALES INQUIRY.                      * 00230020
002400*---------------------------------------------------------------* 00240020
002500* 10/28/02 - TODD C. MICHALEK       - WR NO 21568               * 00250020
002600*    - DON'T PROCESS 4320-SELECT-XREF-SKU FOR DUMMY SKUS        * 00260020
002700*      (SKU SEQ = '000')                                        * 00270020
002800*---------------------------------------------------------------* 00280020
002900* 12/13/02 - TODD C. MICHALEK       - WR NO P000511221          * 00290020
003000*    - ON HISTORICAL INQUIRY, IF A PREVIOUSLY ENTERED           * 00300020
003100*      DEPT/CLASS/SEQ CANNOT BE FOUND IN THE TSKXREF TABLE      * 00310020
003200*      (IMPLYING A SKU DELETION HAS TAKEN PLACE ON THE SKU),    * 00320020
003300*      PASS THE DEPT/CLASS/SEQ ON TO FASHION SALES.  IF THE SKU * 00330020
003400*      DOES NOT EXIST IN FASHION, A "SKU-DOES NOT EXIST" ERROR  * 00340020
003500*      WILL BE RETURNED.                                        * 00350020
003600*---------------------------------------------------------------* 00360020
003700*---------------------------------------------------------------* 00370020
003800* 02/03/03 - SUKUMAR, IGSI          - WR NO W24472              * 00380020
003900*    - FOR NI-SKU CONVERSION, 3 DIGIT SEQUENCE NUMBER IS        * 00390020
004000*      REPLACED BY 8 DIGIT SKU NUMBER.                          * 00400020
004100*    - THE  PARAGRAPH 4320-SELECT-XREF-SKU  IS NO LONGER        * 00410020
004200*      REQUIRED.                                                * 00420020
004300*---------------------------------------------------------------* 00430020
004400* DATE  01/05/2005                                              * 00440020
004500*  CHANGE MADE:                                                 * 00450020
004600*    - CHANGED ALL STORE NUMBER LENGTH REFERENCES FROM 3 TO 4   * 00460020
004700*      DIGITS IN LENGTH AND ADDED A 4 DIGIT NUMERIC STORE       * 00470020
004800*      NUMBER FIELD(S)                                          * 00480020
004900*    - CHANGED THE FILLER REDEFINES DP020-VARIABLE-COMMAREA     * 00490020
005000*      FILLER LENGTH AND THE APPROPRIATE MNEMONIC LENGTH        * 00500020
005100*    - REMOVED THE OPERCO_NBR FIELD FROM ALL IN-STORE PERM TABLE* 00510020
005200*      CALLS                                                    * 00520020
005300*  MADE BY: TODD C. MICHALEK        IR #: WR27559               * 00530020
005400*---------------------------------------------------------------* 00540020
005500*---------------------------------------------------------------* 00550020
005600* DATE  02/29/2012                                              * 00560020
005700*  CHANGE MADE:                                                 * 00570020
005800*    - EXPAND AMOUNT FIELD FROM 4 DIGIT TO 5 DIGITS             * 00580020
005900*  MADE BY: JALAJ KUMAR             IR #: SR3403                * 00590020
006000*---------------------------------------------------------------* 00600020
006010* 09/14/2021 - GERMAN BANDA - CHG0261678                          00601023
006020* DESCRIPTION: CHANGE CALL OF DPKUT100 TO                         00602021
006030*              CALL DP010I-NUMERIC-EDIT-ROUTINE                   00603021
006040*              MAKING THE CALL DYNAMIC VS STATIC                  00604021
006050*---------------------------------------------------------------* 00605021
CICS  *  CHANGED 10/18/2022    BY BARB SCHULTZ    WR: CHG0276658        00605126
CICS  *                                                                 00605224
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL     00605327
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.      00605424
CICS  *---------------------------------------------------------------* 00606025
006100 ENVIRONMENT DIVISION.                                            00610020
006200                                                                  00620020
006300 DATA DIVISION.                                                   00630020
006400                                                                  00640020
006500 WORKING-STORAGE SECTION.                                         00650020
006600                                                                  00660020
006700 01  DK-DB2-KEYS.                                                 00670020
006800     15  DK-DOCUMENT-NUMBER             PIC S9(07)  VALUE +0      00680020
006900                                                    COMP-3.       00690020
007000     15  DK-OPERATING-COMPANY           PIC  X(02)  VALUE SPACE.  00700020
007100     15  DK-STORE-NUMBER                PIC S9(04)  VALUE ZEROS   00710020
007200                                                    COMP.         00720020
007300                                                                  00730020
007400 01  PC-PROGRAM-CONSTANTS.                                        00740020
007500     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00750020
007600                                                    'PE194A  '.   00760020
007700     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00770020
007800                                                    'PEKM194 '.   00780020
007900     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00790020
008000                                                    'PEKCS194'.   00800020
008100     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00810020
008200     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00820020
008300     05  PC-HEADER-INQ-FORMAT           PIC  X(01)  VALUE '3'.    00830020
008400     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00840020
008500     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +10     00850020
008600                                                    COMP SYNC.    00860020
008700     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00870020
008800     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00880020
008900                                                    COMP SYNC.    00890020
009000     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00900020
009100                                                    +1000000      00910020
009200                                                    COMP-3.       00920020
009300     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00930020
009400                                                    COMP SYNC.    00940020
009500     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00950020
009600                                                    COMP-3.       00960020
009700     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00970020
009800     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00980020
009900*                                                                 00990020
010000     05  PC-TSYMSG-NUMBERS.                                       01000020
010100         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01010020
010200         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  01020020
010300         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01030020
010400         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01040020
010500         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01050020
010600         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01060020
010700         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01070020
010800         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01080020
010900         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01090020
011000         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01100020
011100         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01110020
011200         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01120020
011300         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01130020
011400         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  01140020
011500*                                                                 01150020
011600 01  PS-PROGRAM-SWITCHES.                                         01160020
011700     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01170020
011800         88  PS-NO-ERROR                            VALUE 'Y'.    01180020
011900         88  PS-ERROR                               VALUE 'N'.    01190020
012000     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01200020
012100         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01210020
012200         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01220020
012300*                                                                 01230020
012400 01  PV-PROGRAM-VARIABLES.                                        01240020
012500     05  PV-SKU-9                       PIC S9(08).               01250020
012600     05  PV-SKU-X REDEFINES PV-SKU-9    PIC  X(08).               01260020
012700     05  PV-DEPT                        PIC  9(04).               01270020
012800     05  PV-CL                          PIC  9(04).               01280020
012900     05  PV-ACTL-PR-CHG-AMT             PIC S9(07)V99             01290020
013000                                                    VALUE +0      01300020
013100                                                    COMP-3.       01310020
013200     05  PV-ACTL-PR-CHG-QTY             PIC S9(09)  VALUE +0      01320020
013300                                                    COMP.         01330020
013400     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01340020
013500                                                    COMP SYNC.    01350020
013600     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01360020
013700                                                    COMP-3.       01370020
013800     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01380020
013900                                                    COMP SYNC.    01390020
014000     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01400020
014100                                                    COMP SYNC.    01410020
014200     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01420020
014300                                                    COMP SYNC.    01430020
014400     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01440020
014500                                                    COMP SYNC.    01450020
014600     05  PV-FULL-CLASS-NBR.                                       01460020
014700         10  FILLER                     PIC  X(02)  VALUE SPACES. 01470020
014800         10  PV-HOLD-CLASS              PIC  X(02)  VALUE SPACES. 01480020
014900     05  PV-FULL-CLASS-NBR-9 REDEFINES                            01490020
015000                    PV-FULL-CLASS-NBR   PIC  9(04).               01500020
015100     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01510020
015200                                                    COMP SYNC.    01520020
015300     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01530020
015400                                                    COMP-3.       01540020
015500     05  PV-ITEM                        PIC S9(04)  VALUE +0      01550020
015600                                                    COMP SYNC.    01560020
015700     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01570020
015800                                                    COMP-3.       01580020
015900     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01590020
016000                                                    COMP-3.       01600020
016100     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01610020
016200                                                    COMP SYNC.    01620020
016300     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01630020
016400                                                    COMP SYNC.    01640020
016500     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01650020
016600                                                    COMP SYNC.    01660020
016700     05  PV-NUMBER-OF-ITEMS-SELECTED    PIC S9(09)  VALUE +0      01670020
016800                                                    COMP-3.       01680020
016900     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01690020
017000                                                    COMP SYNC.    01700020
017100     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01710020
017200                                                    COMP-3.       01720020
017300     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01730020
017400                                                    COMP SYNC.    01740020
017500     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01750020
017600                                                    COMP SYNC.    01760020
017700     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01770020
017800                                                    COMP SYNC.    01780020
017900     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01790020
018000                                                    COMP SYNC.    01800020
018100     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01810020
018200                                                    COMP SYNC.    01820020
018300     05  PV-SUB                         PIC S9(04)  VALUE +0      01830020
018400                                                    COMP SYNC.    01840020
018500     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01850020
018600                                                    COMP-3.       01860020
018700     05  PV-TOT-ACTL-PR-CHG-AMT         PIC Z,ZZZ,ZZZ.99-.        01870020
018800*---------------------------------------------------------------* 01880020
018900*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 01890020
019000*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 01900020
019100*   APPLICATION-SPECIFIC COMMAREA.                              * 01910020
019200*---------------------------------------------------------------* 01920020
019300 01  LQW-LIST-QUEUE-WORK-AREA.                                    01930020
019400     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01940020
019500     05  LQW-ITEM-ENTRIES               OCCURS 10 TIMES           01950020
019600                                        INDEXED BY LQW-IDX.       01960020
019700         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01970020
019800         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01980020
019900         10  LQW-SELECTED-SW            PIC  X(01).               01990020
020000             88  LQW-SELECT                         VALUE 'S'.    02000020
020100             88  LQW-DESELECT                       VALUE ' '.    02010020
020200         10  LQW-ACTION                 PIC  X(03).               02020020
020300         10  LQW-DEPT-NUMBER            PIC  X(03).               02030020
020400         10  LQW-CLASS-NUMBER           PIC  X(02).               02040020
020500         10  LQW-UPC                    PIC  9(13).               02050020
020600         10  LQW-ORIG-PRICE             PIC  9(05)V99.            02060020
020700         10  LQW-NEW-PRICE              PIC  9(05)V99.            02070020
020800         10  LQW-PRICE-DIFF             PIC  9(05)V99.            02080020
020900         10  LQW-QUANTITY               PIC  9(06).               02090020
021000         10  LQW-SKU                    PIC  X(08).               02100020
021100*---------------------------------------------------------------* 02110020
021200*  RECORD LAYOUT FOR THE SKU SELECTION TEMP STORAGE QUEUE.      * 02120020
021300*---------------------------------------------------------------* 02130020
021400     COPY FSWS002.                                                02140020
021500*---------------------------------------------------------------* 02150020
021600*    MAP LAYOUT                                                 * 02160020
021700*---------------------------------------------------------------* 02170020
021800     COPY PEKM194.                                                02180020
021900*                                                                 02190020
022000 01  MR-OCCURS-LAYOUT                   REDEFINES  PE194AO.       02200020
022100     05  FILLER                         PIC X(120).               02210020
022200     05  MR-SCROLL-AREA                 OCCURS 10 TIMES.          02220020
022300         10  MR-SELECTL                 PIC S9(04) COMP.          02230020
022400         10  MR-SELECTA                 PIC  X(01).               02240020
022500         10  MR-SELECTC                 PIC  X(01).               02250020
022600         10  MR-SELECTH                 PIC  X(01).               02260020
022700         10  MR-SELECTI                 PIC  X(01).               02270020
022800                                                                  02280020
022900         10  MR-ACTIONL                 PIC S9(04) COMP.          02290020
023000         10  MR-ACTIONA                 PIC  X(01).               02300020
023100         10  MR-ACTIONC                 PIC  X(01).               02310020
023200         10  MR-ACTIONH                 PIC  X(01).               02320020
023300         10  MR-ACTION                  PIC  X(03).               02330020
023400                                                                  02340020
023500         10  MR-DEPTL                   PIC S9(04) COMP.          02350020
023600         10  MR-DEPTA                   PIC  X(01).               02360020
023700         10  MR-DEPTC                   PIC  X(01).               02370020
023800         10  MR-DEPTH                   PIC  X(01).               02380020
023900         10  MR-DEPT                    PIC  X(03).               02390020
024000                                                                  02400020
024100         10  MR-CLASSL                  PIC S9(04) COMP.          02410020
024200         10  MR-CLASSA                  PIC  X(01).               02420020
024300         10  MR-CLASSC                  PIC  X(01).               02430020
024400         10  MR-CLASSH                  PIC  X(01).               02440020
024500         10  MR-CLASS                   PIC  X(02).               02450020
024600                                                                  02460020
024700         10  MR-SKUL                    PIC S9(04) COMP.          02470020
024800         10  MR-SKUA                    PIC  X(01).               02480020
024900         10  MR-SKUC                    PIC  X(01).               02490020
025000         10  MR-SKUH                    PIC  X(01).               02500020
025100         10  MR-SKU                     PIC  X(08).               02510020
025200         10  MR-UPCL                    PIC S9(04) COMP.          02520020
025300         10  MR-UPCA                    PIC  X(01).               02530020
025400         10  MR-UPCC                    PIC  X(01).               02540020
025500         10  MR-UPCH                    PIC  X(01).               02550020
025600         10  MR-UPC                     PIC  X(13).               02560020
025700                                                                  02570020
025800         10  MR-ORIG-PRICEL             PIC S9(04) COMP.          02580020
025900         10  MR-ORIG-PRICEA             PIC  X(01).               02590020
026000         10  MR-ORIG-PRICEC             PIC  X(01).               02600020
026100         10  MR-ORIG-PRICEH             PIC  X(01).               02610020
026200         10  MR-ORIG-PRICE-X.                                     02620020
026300             15  MR-ORIG-PRICE          PIC ZZZZZ.99.             02630020
026400                                                                  02640020
026500         10  MR-NEW-PRICEL              PIC S9(04) COMP.          02650020
026600         10  MR-NEW-PRICEA              PIC  X(01).               02660020
026700         10  MR-NEW-PRICEC              PIC  X(01).               02670020
026800         10  MR-NEW-PRICEH              PIC  X(01).               02680020
026900         10  MR-NEW-PRICE-X.                                      02690020
027000             15  MR-NEW-PRICE           PIC ZZZZZ.99.             02700020
027100                                                                  02710020
027200         10  MR-PRICE-DIFFL             PIC S9(04) COMP.          02720020
027300         10  MR-PRICE-DIFFA             PIC  X(01).               02730020
027400         10  MR-PRICE-DIFFC             PIC  X(01).               02740020
027500         10  MR-PRICE-DIFFH             PIC  X(01).               02750020
027600         10  MR-PRICE-DIFF-X.                                     02760020
027700             15  MR-PRICE-DIFF          PIC ZZZZZ.99.             02770020
027800                                                                  02780020
027900         10  MR-QUANTITYL               PIC S9(04) COMP.          02790020
028000         10  MR-QUANTITYA               PIC  X(01).               02800020
028100         10  MR-QUANTITYC               PIC  X(01).               02810020
028200         10  MR-QUANTITYH               PIC  X(01).               02820020
028300         10  MR-QUANTITY-X.                                       02830020
028400             15  MR-QUANTITY            PIC ZZZ,ZZ9.              02840020
028500*---------------------------------------------------------------* 02850020
028600*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02860020
028700*---------------------------------------------------------------* 02870020
028800     COPY DPWS015.                                                02880020
028900*---------------------------------------------------------------* 02890020
029000*    FUNCTION KEYS COPYBOOK.                                    * 02900020
029100*---------------------------------------------------------------* 02910020
029200     COPY DPWS016.                                                02920020
029300*---------------------------------------------------------------* 02930020
029400*    NUMERIC EDIT LAYOUT.                                       * 02940020
029500*---------------------------------------------------------------* 02950020
029600     COPY DPWS010I.                                               02960020
029700*---------------------------------------------------------------* 02970020
029800*    PERM PRICE CHANGE CONSTANTS AND WORK AREAS                 * 02980020
029900*---------------------------------------------------------------* 02990020
030000     COPY PEWS049.                                                03000020
030100*---------------------------------------------------------------* 03010020
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 03020024
030300*---------------------------------------------------------------* 03030020
030400     COPY DPWS030.                                                03040020
CICS       COPY DPWS930.                                                03041024
030500*---------------------------------------------------------------* 03050020
030600*    STANDARD COMMAREA.                                         * 03060020
030700*---------------------------------------------------------------* 03070020
030800     COPY DPWS020.                                                03080020
030900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03090020
031000*---------------------------------------------------------------* 03100020
031100* INTER-APPLICATION COMMAREA.                                   * 03110020
031200*   PEWS068 - IS THE INPUT LAYOUT WHEN COMING FROM THE HEADER   * 03120020
031300*             INQUIRY SCREEN.                                   * 03130020
031400*---------------------------------------------------------------* 03140020
031500         10  INTER-APPL-COMMAREA        PIC X(200).               03150020
031600     COPY PEWS068.                                                03160020
031700*---------------------------------------------------------------* 03170020
031800*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03180020
031900*---------------------------------------------------------------* 03190020
032000         10  ASC-SPECIFIC-COMMAREA.                               03200020
032100             15  ASC-LIST-KEYS.                                   03210020
032200                 20  ASC-KEY-STORE-NUMBER            PIC  X(04).  03220020
032300                 20  FILLER REDEFINES ASC-KEY-STORE-NUMBER.       03230020
032400                     25  ASC-KEY-STORE-NUMBER-N      PIC  9(04).  03240020
032500                 20  ASC-KEY-STORE-NAME              PIC  X(25).  03250020
032600                 20  ASC-KEY-DOCUMENT-NUMBER         PIC  X(07).  03260020
032700             15  ASC-ACTL-PR-CHG-QTY                 PIC  9(07).  03270020
032800             15  ASC-ACTL-PR-CHG-AMT                 PIC          03280020
032900                                                    S9(07)V99.    03290020
033000             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03300020
033100                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03310020
033200                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03320020
033300                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03330020
033400                                                                  03340020
033500                 20  ASC-ITEM-ARRAY.                              03350020
033600                     25  ASC-ITEM-ENTRIES OCCURS 10 TIMES.        03360020
033700                         30  ASC-LIST-ITEM-NUMBER                 03370020
033800                                                     PIC S9(09)   03380020
033900                                                     COMP-3.      03390020
034000                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03400020
034100                             88  ASC-VALID-SELECT    VALUE ' '    03410020
034200                                                           'S'    03420020
034300                                                           'B'    03430020
034400                                                           'E'.   03440020
034500                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03450020
034600                             88  ASC-TEMP-SELECT     VALUE 'S'.   03460020
034700                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03470020
034800                             88  ASC-TEMP-END        VALUE 'E'.   03480020
034900                             88  ASC-TEMP-PROTECTED  VALUE 'P'.   03490020
035000                         30  ASC-SELECTED-SW         PIC  X(01).  03500020
035100                             88  ASC-NO-SELECT       VALUE ' '.   03510020
035200                             88  ASC-SELECT          VALUE 'S'.   03520020
035300                             88  ASC-BEGIN           VALUE 'B'.   03530020
035400                             88  ASC-END             VALUE 'E'.   03540020
035500                             88  ASC-PROTECTED       VALUE 'P'.   03550020
035600                         30  ASC-ACTION              PIC  X(03).  03560020
035700                         30  ASC-DEPT-NUMBER         PIC  X(03).  03570020
035800                         30  ASC-CLASS-NUMBER        PIC  X(02).  03580020
035900                         30  ASC-UPC                 PIC  9(13).  03590020
036000                         30  ASC-ORIG-PRICE          PIC          03600020
036100                                                     9(05)V99.    03610020
036200                         30  ASC-NEW-PRICE           PIC          03620020
036300                                                     9(05)V99.    03630020
036400                         30  ASC-PRICE-DIFF          PIC          03640020
036500                                                     9(05)V99.    03650020
036600                         30  ASC-QUANTITY            PIC  9(06).  03660020
036700                         30  ASC-SKU                 PIC  X(08).  03670020
036800                                                                  03680020
036900             15  ASC-HISTORY-CSR-SW                  PIC  X(01).  03690020
037000                 88  ASC-HISTORY-CSR                 VALUE 'Y'.   03700020
037100                 88  ASC-NOT-HISTORY-CSR             VALUE 'N'.   03710020
037200             15  ASC-BLK-SUB                         PIC S9(04)   03720020
037300                                                          COMP    03730020
037400                                                          SYNC.   03740020
037500             15  ASC-ITEM-SUB                        PIC S9(04)   03750020
037600                                                          COMP    03760020
037700                                                          SYNC.   03770020
037800             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03780020
037900                                                          COMP-3. 03790020
038000             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03800020
038100                                                          COMP-3. 03810020
038200             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03820020
038300                                                          COMP-3. 03830020
038400             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03840020
038500                                                          COMP-3. 03850020
038600             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03860020
038700                                                          COMP-3. 03870020
038800             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03880020
038900                                                          COMP    03890020
039000                                                          SYNC.   03900020
039100             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03910020
039200                                                          COMP-3. 03920020
039300             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03930020
039400                                                          COMP-3. 03940020
039500             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03950020
039600                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03960020
039700                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03970020
039800             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03980020
039900                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03990020
040000                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   04000020
040100             15  ASC-LIST-QUEUE-NAME.                             04010020
040200                 20  ASC-LIST-TERM-ID                PIC  X(04).  04020020
040300                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04030020
040400                                                          COMP-3. 04040020
040500                 20  ASC-LIST-SEQ                    PIC  9(01).  04050020
040600             15  ASC-SEL-QUEUE-NAME.                              04060020
040700                 20  ASC-SEL-TERM-ID                 PIC  X(04).  04070020
040800                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   04080020
040900                                                          COMP-3. 04090020
041000                 20  ASC-SEL-SEQ                     PIC  9(01).  04100020
041100                                                                  04110020
041200             15  ASC-START-ITEM-REQUEST.                          04120020
041300                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04130020
041400         10  FILLER                                  PIC X(1432). 04140020
041500*---------------------------------------------------------------* 04150020
041600*   FSWS000 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 04160020
041700*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION     * 04170020
041800*             TO THE FASHION SALES INQUIRY.                     * 04180020
041900*---------------------------------------------------------------* 04190020
042000     COPY FSWS000.                                                04200020
042100*---------------------------------------------------------------* 04210020
042200*    ABEND PROCESSING COPYBOOK.                                 * 04220020
042300*---------------------------------------------------------------* 04230020
042400     COPY DPWS013.                                                04240020
042500*---------------------------------------------------------------* 04250020
042600*    DB2 AREA FOR CURRENT IN-STORE DETAIL INFO                  * 04260020
042700*---------------------------------------------------------------* 04270020
042800     EXEC SQL                                                     04280020
042900          INCLUDE TSPPCDT                                         04290020
043000     END-EXEC.                                                    04300020
043100*---------------------------------------------------------------* 04310020
043200*    DB2 AREA FOR HISTORY IN-STORE DETAIL INFO                  * 04320020
043300*---------------------------------------------------------------* 04330020
043400     EXEC SQL                                                     04340020
043500          INCLUDE TSPCDTH                                         04350020
043600     END-EXEC.                                                    04360020
043700*---------------------------------------------------------------* 04370020
043800*    DB2 AREA FOR COMMUNICATIONS                                * 04380020
043900*---------------------------------------------------------------* 04390020
044000     EXEC SQL                                                     04400020
044100          INCLUDE SQLCA                                           04410020
044200     END-EXEC.                                                    04420020
044300*---------------------------------------------------------------* 04430020
044400*    CURRENT DETAIL CURSOR WHEN DETAIL LINES ARE REQUESTED      * 04440020
044500*---------------------------------------------------------------* 04450020
044600     EXEC SQL                                                     04460020
044700          DECLARE CURRENT-DTL-CSR CURSOR                          04470020
044800          FOR SELECT                                              04480020
044900                DEPT_NBR                                          04490020
045000              , SUB_CL_NBR                                        04500020
045100              , SKU_NBR                                           04510020
045200              , ROW_NBR                                           04520020
045300              , ACTL_PR_CHG_QTY                                   04530020
045400              , OLD_PR                                            04540020
045500              , NEW_PR                                            04550020
045600              , ACTL_PR_CHG_AMT                                   04560020
045700              , UPC_NBR                                           04570020
045800          FROM  TSPPCDT                                           04580020
045900          WHERE (DEST_LOC_NBR  = :SPPCDT-DEST-LOC-NBR             04590020
046000            AND  DOC_NBR       = :SPPCDT-DOC-NBR)                 04600020
046100          ORDER BY                                                04610020
046200                ROW_NBR                                           04620020
046300     END-EXEC.                                                    04630020
046400*---------------------------------------------------------------* 04640020
046500*    HISTORY DETAIL CURSOR WHEN DETAIL LINES ARE REQUESTED      * 04650020
046600*---------------------------------------------------------------* 04660020
046700     EXEC SQL                                                     04670020
046800          DECLARE HISTORY-DTL-CSR CURSOR                          04680020
046900          FOR SELECT                                              04690020
047000                DEPT_NBR                                          04700020
047100              , SUB_CL_NBR                                        04710020
047200              , SKU_NBR                                           04720020
047300              , ROW_NBR                                           04730020
047400              , ACTL_PR_CHG_QTY                                   04740020
047500              , OLD_PR                                            04750020
047600              , NEW_PR                                            04760020
047700              , ACTL_PR_CHG_AMT                                   04770020
047800              , UPC_NBR                                           04780020
047900          FROM  TSPCDTH                                           04790020
048000          WHERE (DEST_LOC_NBR  = :SPCDTH-DEST-LOC-NBR             04800020
048100            AND  DOC_NBR       = :SPCDTH-DOC-NBR)                 04810020
048200          ORDER BY                                                04820020
048300                ROW_NBR                                           04830020
048400     END-EXEC.                                                    04840020
048500 LINKAGE SECTION.                                                 04850020
048600                                                                  04860020
048700 01  DFHCOMMAREA.                                                 04870020
048800     05  FILLER                         OCCURS  1 TO 4072 TIMES   04880020
048900                                        DEPENDING ON EIBCALEN.    04890020
049000         10  FILLER                     PIC X.                    04900020
049100                                                                  04910020
049200 EJECT                                                            04920020
049300 PROCEDURE DIVISION.                                              04930020
049400*---------------------------------------------------------------* 04940020
049500*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 04950020
049600*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 04960020
049700*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 04970020
049800*---------------------------------------------------------------* 04980020
049900 0000-MAIN-MODULE.                                                04990020
050000     INITIALIZE DP030-CICS-API-FIELDS.                            05000020
050100     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05010020
050200     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05020020
050300     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05030020
050400     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05040020
050500     MOVE LENGTH OF PE194AI        TO DP030-MAP-LENGTH (1).       05050020
050600     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05060020
050700     PERFORM 0001-CALL-CICS-ARCH-API.                             05070020
050800*                                                                 05080020
050900     PERFORM 1000-CONTROL-PROCESSING                              05090020
051000*                                                                 05100020
051100     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05110020
051200     PERFORM 0001-CALL-CICS-ARCH-API.                             05120020
051300*---------------------------------------------------------------* 05130020
051400*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 05140020
051500*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 05150020
051600*---------------------------------------------------------------* 05160020
051700 0001-CALL-CICS-ARCH-API.                                         05170020
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05180024
051900                                    DFHCOMMAREA                   05190024
052000                                    DP030-CICS-API-FIELDS         05200024
052100                                    DP020-STANDARD-COMMAREA       05210024
052200                                    PE194AI.                      05220024
052300*                                                                 05230020
052400     IF  DP030-RC-CALL-SUCCESSFUL                                 05240020
052500         CONTINUE                                                 05250020
052600     ELSE                                                         05260020
052700         SET DP013-NO-ROLLBACK                                    05270020
052800             DP013-XCTL-DISPLAY-RESTART                           05280020
052900             DP013-CICS-ABEND      TO TRUE                        05290020
053000         MOVE '0001-CALL-CICS-ARCH-API'                           05300020
053100                                   TO DP013-PARAGRAPH             05310020
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05320024
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05330024
053400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05340020
053500         PERFORM DP013-0000-PROCESS-ABEND                         05350020
053600     END-IF.                                                      05360020
053700*----------------------------------------------------------------*05370020
053800* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05380020
053900* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05390020
054000*                                                                *05400020
054100* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05410020
054200*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05420020
054300*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05430020
054400*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05440020
054500*----------------------------------------------------------------*05450020
054600                                                                  05460020
054700 1000-CONTROL-PROCESSING.                                         05470020
054800                                                                  05480020
054900     MOVE DP020-OPERATING-COMPANY  TO DK-OPERATING-COMPANY.       05490020
055000     EVALUATE TRUE                                                05500020
055100         WHEN DP020-NEXT-ACT-INITIAL                              05510020
055200             INITIALIZE ASC-SPECIFIC-COMMAREA                     05520020
055300             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05530020
055400                                      ASC-SEL-TERM-ID             05540020
055500             MOVE DP020-SRC-TASK-NUMBER                           05550020
055600                                   TO ASC-LIST-TASK-NUMBER        05560020
055700                                      ASC-SEL-TASK-NUMBER         05570020
055800             MOVE PC-LIST-QUEUE-SEQ                               05580020
055900                                   TO ASC-LIST-SEQ                05590020
056000             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05600020
056100             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05610020
056200***-----$TEMPLATE NOTE$-------------------------------------------05620020
056300*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,05630020
056400*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  05640020
056500*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.05650020
056600***---------------------------------------------------------------05660020
056700             IF  PS-COMMAREA-NOT-VALID                            05670020
056800                 MOVE PC-TSYMSG-99901                             05680020
056900                                   TO DP020-MSG-NUMBER            05690020
057000                 SET DP020-MSG-FATAL                              05700020
057100                                   TO TRUE                        05710020
057200                 SET DP020-NEXT-ACT-APPL-ERROR                    05720020
057300                                   TO TRUE                        05730020
057400             ELSE                                                 05740020
057500                 PERFORM 4000-BUILD-INITIAL-PANEL                 05750020
057600             END-IF                                               05760020
057700                                                                  05770020
057800         WHEN DP020-NEXT-ACT-READ-MAP                             05780020
057900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05790020
058000                                   TO PV-TOP-ITEM                 05800020
058100             PERFORM 2000-PROCESS-PANEL                           05810020
058200                                                                  05820020
058300         WHEN DP020-NEXT-ACT-RETURN                               05830020
058400             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05840020
058500                                   TO PV-TOP-ITEM                 05850020
058600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05860020
058700             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05870020
058800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05880020
058900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05890020
059000                                                                  05900020
059100         WHEN OTHER                                               05910020
059200             SET DP013-LOGIC-ABEND TO TRUE                        05920020
059300             SET DP013-NO-ROLLBACK TO TRUE                        05930020
059400             MOVE '1000-CONTROL-PROCESSING'                       05940020
059500                                   TO DP013-PARAGRAPH             05950020
059600             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05960020
059700                                   TO DP013-MESSAGE-TEXT(1)       05970020
059800             PERFORM DP013-0000-PROCESS-ABEND                     05980020
059900     END-EVALUATE.                                                05990020
060000*----------------------------------------------------------------*06000020
060100* MOVE THE DATA PASSED THROUGH INTER-APPL COMMAREA TO THE APPL   *06010020
060200* SPECIFIC COMMAREA.                                             *06020020
060300*----------------------------------------------------------------*06030020
060400                                                                  06040020
060500 1100-PROCESS-INTER-APPL-COMM.                                    06050020
060600                                                                  06060020
060700     SET PS-COMMAREA-VALID         TO TRUE.                       06070020
060800     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06080020
060900     IF  DP020-INT-APPL-FORMAT-IND = PC-HEADER-INQ-FORMAT         06090020
061000         MOVE PE068-STORE-NUMBER   TO ASC-KEY-STORE-NUMBER-N      06100020
061100                                      DK-STORE-NUMBER             06110020
061200         MOVE PE068-STORE-NAME     TO ASC-KEY-STORE-NAME          06120020
061300         MOVE PE068-DOCUMENT-NUMBER                               06130020
061400                                   TO ASC-KEY-DOCUMENT-NUMBER     06140020
061500                                      DK-DOCUMENT-NUMBER          06150020
061600         MOVE PE068-HISTORY-SW     TO ASC-HISTORY-CSR-SW          06160020
061700     END-IF.                                                      06170020
061800*----------------------------------------------------------------*06180020
061900* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06190020
062000* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06200020
062100* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06210020
062200* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06220020
062300* FUNCTION KEYS CAN GET THIS FAR.                                *06230020
062400*----------------------------------------------------------------*06240020
062500 2000-PROCESS-PANEL.                                              06250020
062600     EVALUATE TRUE                                                06260020
062700         WHEN DP020-SRC-AID = DP016-CLEAR                         06270020
062800             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06280020
062900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06290020
063000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06300020
063100                                                                  06310020
063200         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06320020
063300             MOVE ASC-KEY-STORE-NUMBER-N                          06330020
063400                                   TO DK-STORE-NUMBER             06340020
063500             MOVE ASC-KEY-DOCUMENT-NUMBER                         06350020
063600                                   TO DK-DOCUMENT-NUMBER          06360020
063700             PERFORM 2050-DELETE-LIST-QUEUE                       06370020
063800             PERFORM 4000-BUILD-INITIAL-PANEL                     06380020
063900                                                                  06390020
064000         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    06400020
064100             PERFORM 2140-DESELECT-ALL-ITEMS                      06410020
064200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06420020
064300                                                                  06430020
064400         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  06440020
064500             PERFORM 2150-SELECT-ALL-ITEMS                        06450020
064600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06460020
064700                                                                  06470020
064800         WHEN DP020-SRC-AID = DP016-ENTER                         06480020
064900             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06490020
065000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06500020
065100             IF  PS-NO-ERROR                                      06510020
065200                 PERFORM 2130-CHECK-FOR-JUMP-BROWSE               06520020
065300             END-IF                                               06530020
065400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06540020
065500                                                                  06550020
065600         WHEN OTHER                                               06560020
065700             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06570020
065800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06580020
065900             IF  PS-NO-ERROR                                      06590020
066000                 SET DP030-CONTINUE-GO                            06600020
066100                                   TO TRUE                        06610020
066200                 PERFORM 2100-CHECK-FUNCTION-KEY                  06620020
066300             ELSE                                                 06630020
066400                 SET DP030-OVERRIDE-GO                            06640020
066500                                   TO TRUE                        06650020
066600             END-IF                                               06660020
066700     END-EVALUATE.                                                06670020
066800*----------------------------------------------------------------*06680020
066900*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06690020
067000*----------------------------------------------------------------*06700020
067100 2050-DELETE-LIST-QUEUE.                                          06710020
067200                                                                  06720020
067300     EXEC CICS                                                    06730020
067400         DELETEQ TS                                               06740020
067500             QUEUE (ASC-LIST-QUEUE-NAME)                          06750020
067600             RESP  (PV-CICS-RESP)                                 06760020
067700     END-EXEC.                                                    06770020
067800                                                                  06780020
067900     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06790020
068000        (PV-CICS-RESP = DFHRESP(QIDERR))                          06800020
068100         CONTINUE                                                 06810020
068200     ELSE                                                         06820020
068300         SET DP013-CICS-ABEND      TO TRUE                        06830020
068400         SET DP013-NO-ROLLBACK     TO TRUE                        06840020
068500                                                                  06850020
068600         MOVE '2050-DELETE-LIST-QUEUE'                            06860020
068700                                   TO DP013-PARAGRAPH             06870020
068800         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06880020
068900                                   TO DP013-MESSAGE-TEXT (1)      06890020
069000         PERFORM DP013-0000-PROCESS-ABEND                         06900020
069100     END-IF.                                                      06910020
069200                                                                  06920020
069300     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06930020
069400*----------------------------------------------------------------*06940020
069500* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06950020
069600* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06960020
069700* CICS ARCHITECTURE API.                                         *06970020
069800*----------------------------------------------------------------*06980020
069900 2100-CHECK-FUNCTION-KEY.                                         06990020
070000     EVALUATE TRUE                                                07000020
070100         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  07010020
070200             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              07020020
070300                 INITIALIZE CA-FASHION-SALES-COMMAREA             07030020
070400                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                07040020
070500                                   TO                             07050020
070600                                   CA-NUMBER-OF-SELECTED-ITEMS    07060020
070700                 PERFORM 5000-PREPARE-SEL-QUEUE                   07070020
070800             ELSE                                                 07080020
070900                 SET DP030-OVERRIDE-GO                            07090020
071000                                   TO TRUE                        07100020
071100                 MOVE PC-TSYMSG-00057                             07110020
071200                                   TO DP020-MSG-NUMBER            07120020
071300                 SET DP020-MSG-WARNING                            07130020
071400                                   TO TRUE                        07140020
071500             END-IF                                               07150020
071600                                                                  07160020
071700         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07170020
071800             MOVE +1               TO PV-TOP-ITEM                 07180020
071900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07190020
072000                                                                  07200020
072100         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07210020
072200             PERFORM 2110-BROWSE-BACKWARD                         07220020
072300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07230020
072400                                                                  07240020
072500         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07250020
072600             PERFORM 2120-BROWSE-FORWARD                          07260020
072700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07270020
072800                                                                  07280020
072900         WHEN OTHER                                               07290020
073000             SET DP013-NO-ROLLBACK                                07300020
073100                 DP013-XCTL-DISPLAY-RESTART                       07310020
073200                 DP013-CICS-ABEND  TO TRUE                        07320020
073300             MOVE '2100-CHECK-FUNCTION-KEY'                       07330020
073400                                   TO DP013-PARAGRAPH             07340020
073500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07350020
073600                                   TO DP013-MESSAGE-TEXT (1)      07360020
073700             PERFORM DP013-0000-PROCESS-ABEND                     07370020
073800     END-EVALUATE.                                                07380020
073900*----------------------------------------------------------------*07390020
074000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07400020
074100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07410020
074200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07420020
074300*    MESSAGE.                                                    *07430020
074400*----------------------------------------------------------------*07440020
074500 2110-BROWSE-BACKWARD.                                            07450020
074600     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07460020
074700         GIVING PV-TOP-ITEM.                                      07470020
074800*                                                                 07480020
074900     IF  ((PV-TOP-ITEM < +1)                                      07490020
075000       OR (PV-TOP-ITEM = +1))                                     07500020
075100         MOVE +1                   TO PV-TOP-ITEM                 07510020
075200*        -- TOP OF LIST --                                        07520020
075300         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07530020
075400         SET DP020-MSG-INFORMATIONAL TO TRUE                      07540020
075500     END-IF.                                                      07550020
075600*----------------------------------------------------------------*07560020
075700*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07570020
075800*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07580020
075900*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07590020
076000*----------------------------------------------------------------*07600020
076100 2120-BROWSE-FORWARD.                                             07610020
076200                                                                  07620020
076300     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07630020
076400         GIVING PV-TOP-ITEM.                                      07640020
076500     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07650020
076600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07660020
076700                                   TO PV-TOP-ITEM                 07670020
076800*        -- BOTTOM OF LIST --                                     07680020
076900         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07690020
077000         SET DP020-MSG-INFORMATIONAL                              07700020
077100                                   TO TRUE                        07710020
077200     ELSE                                                         07720020
077300         COMPUTE PV-BOTTOM-ITEM =                                 07730020
077400             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07740020
077500         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07750020
077600*            -- BOTTOM OF LIST --                                 07760020
077700             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07770020
077800             SET DP020-MSG-INFORMATIONAL                          07780020
077900                                   TO TRUE                        07790020
078000         END-IF                                                   07800020
078100     END-IF.                                                      07810020
078200*----------------------------------------------------------------*07820020
078300*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07830020
078400*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07840020
078500*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07850020
078600*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *07860020
078700*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07870020
078800*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *07880020
078900*----------------------------------------------------------------*07890020
079000 2130-CHECK-FOR-JUMP-BROWSE.                                      07900020
079100     SET PS-NO-ERROR               TO TRUE.                       07910020
079200     IF (ASC-START-ITEM-REQUEST = SPACE)                          07920020
079300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07930020
079400                                   TO PV-TOP-ITEM                 07940020
079500     ELSE                                                         07950020
079600         MOVE ASC-START-ITEM-REQUEST                              07960020
079700                                   TO DP010I-UNEDITED-FIELD       07970020
079800         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       07980020
079900         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     07990020
080000         SET DP010I-NEGATIVE-NOT-ALLOWED                          08000020
080100                                   TO TRUE                        08010020
080210         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08021022
080220                         USING DP010I-NUMERIC-EDIT-AREA           08022022
080300                                                                  08030020
080400         IF  NOT DP010I-ERROR-DETECTED                            08040020
080500             MOVE DP010I-NUMERIC-FIELD                            08050020
080600                                   TO  ASC-START-ITEM-REQUEST-N   08060020
080700             IF  ASC-START-ITEM-REQUEST-N > ZERO                  08070020
080800                 IF  ASC-START-ITEM-REQUEST-N >                   08080020
080900                                   ASC-NUMBER-OF-ITEMS-READ       08090020
081000                     MOVE SPACE TO ASC-START-ITEM-REQUEST         08100020
081100                     COMPUTE PV-TOP-ITEM =                        08110020
081200                             ASC-NUMBER-OF-ITEMS-READ             08120020
081300                             - PC-ITEMS-PER-PANEL + 1             08130020
081400                     IF  PV-TOP-ITEM < +1                         08140020
081500                         MOVE +1   TO PV-TOP-ITEM                 08150020
081600                         MOVE PC-TSYMSG-00070                     08160020
081700                                   TO DP020-MSG-NUMBER            08170020
081800                         SET DP020-MSG-INFORMATIONAL              08180020
081900                                   TO TRUE                        08190020
082000                     END-IF                                       08200020
082100                 ELSE                                             08210020
082200                     MOVE ASC-START-ITEM-REQUEST-N                08220020
082300                                   TO PV-TOP-ITEM                 08230020
082400                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      08240020
082500                     COMPUTE PV-BOTTOM-ITEM =                     08250020
082600                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08260020
082700                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08270020
082800*                        -- BOTTOM OF LIST --                     08280020
082900                         MOVE PC-TSYMSG-00070                     08290020
083000                                   TO DP020-MSG-NUMBER            08300020
083100                         SET DP020-MSG-INFORMATIONAL              08310020
083200                                   TO TRUE                        08320020
083300                     END-IF                                       08330020
083400                 END-IF                                           08340020
083500             ELSE                                                 08350020
083600*                --- VALUE OUT OF RANGE ----                      08360020
083700                 MOVE PC-TSYMSG-00101                             08370020
083800                                   TO DP020-MSG-NUMBER            08380020
083900                 MOVE -1           TO ASTRTITL                    08390020
084000                 SET DP030-SET-CURSOR-APPL-1                      08400020
084100                                   TO TRUE                        08410020
084200                 MOVE DP015-REVERSE                               08420020
084300                                   TO ASTRTITH                    08430020
084400                 MOVE DP015-RED    TO ASTRTITC                    08440020
084500                 MOVE DP015-UNP-NUM-BRT-MDT                       08450020
084600                                   TO ASTRTITA                    08460020
084700                 SET DP020-MSG-FATAL                              08470020
084800                                   TO TRUE                        08480020
084900                 SET PS-ERROR      TO TRUE                        08490020
085000             END-IF                                               08500020
085100                                                                  08510020
085200         ELSE                                                     08520020
085300             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08530020
085400             MOVE -1               TO ASTRTITL                    08540020
085500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08550020
085600             MOVE DP015-REVERSE    TO ASTRTITH                    08560020
085700             MOVE DP015-RED        TO ASTRTITC                    08570020
085800             MOVE DP015-UNP-NUM-BRT-MDT                           08580020
085900                                   TO ASTRTITA                    08590020
086000             SET DP020-MSG-FATAL   TO TRUE                        08600020
086100             SET PS-ERROR          TO TRUE                        08610020
086200         END-IF                                                   08620020
086300     END-IF.                                                      08630020
086400*----------------------------------------------------------------*08640020
086500*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *08650020
086600*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *08660020
086700*----------------------------------------------------------------*08670020
086800 2140-DESELECT-ALL-ITEMS.                                         08680020
086900     MOVE +1                       TO ASC-BLK-SUB.                08690020
087000                                                                  08700020
087100     PERFORM 2141-CLEAR-SELECTED-INDS                             08710020
087200         VARYING ASC-ITEM-SUB                                     08720020
087300         FROM 1 BY 1                                              08730020
087400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08740020
087500                                                                  08750020
087600     ADD +1                        TO ASC-BLK-SUB.                08760020
087700                                                                  08770020
087800     PERFORM 2141-CLEAR-SELECTED-INDS                             08780020
087900         VARYING ASC-ITEM-SUB                                     08790020
088000         FROM 1 BY 1                                              08800020
088100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08810020
088200                                                                  08820020
088300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               08830020
088400                                   TO PV-LIST-ITEM-NUMBER.        08840020
088500                                                                  08850020
088600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            08860020
088700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    08870020
088800                                                                  08880020
088900     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     08890020
089000        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      08900020
089100         MOVE +1                   TO ASC-BLK-SUB                 08910020
089200                                                                  08920020
089300         PERFORM 5100-WRITE-TEMP-STORAGE                          08930020
089400                                                                  08940020
089500         MOVE +1                   TO PV-BLOCK-NUMBER             08950020
089600                                                                  08960020
089700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         08970020
089800             PV-FIRST-BLOCK-IN-ARRAY - 1                          08980020
089900                                                                  08990020
090000         PERFORM                                                  09000020
090100             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09010020
090200                                                                  09020020
090300             PERFORM 4410-READ-TEMP-STORAGE                       09030020
090400                                                                  09040020
090500             PERFORM 2141-CLEAR-SELECTED-INDS                     09050020
090600                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 09060020
090700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09070020
090800                                                                  09080020
090900             PERFORM 5100-WRITE-TEMP-STORAGE                      09090020
091000                                                                  09100020
091100             ADD +1                TO PV-BLOCK-NUMBER             09110020
091200                                                                  09120020
091300         END-PERFORM                                              09130020
091400                                                                  09140020
091500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09150020
091600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09160020
091700                                                                  09170020
091800         PERFORM                                                  09180020
091900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09190020
092000                   ASC-HIGHEST-BLOCK-WRITTEN                      09200020
092100                                                                  09210020
092200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09220020
092300                                   TO PV-BLOCK-NUMBER             09230020
092400                                                                  09240020
092500             PERFORM 4410-READ-TEMP-STORAGE                       09250020
092600                                                                  09260020
092700             PERFORM 2141-CLEAR-SELECTED-INDS                     09270020
092800                 VARYING ASC-ITEM-SUB                             09280020
092900                 FROM 1 BY 1                                      09290020
093000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09300020
093100                                                                  09310020
093200             PERFORM 5100-WRITE-TEMP-STORAGE                      09320020
093300                                                                  09330020
093400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09340020
093500                                                                  09350020
093600         END-PERFORM                                              09360020
093700                                                                  09370020
093800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             09380020
093900                                   TO PV-BLOCK-NUMBER             09390020
094000                                                                  09400020
094100         PERFORM 4410-READ-TEMP-STORAGE                           09410020
094200     END-IF.                                                      09420020
094300                                                                  09430020
094400                                                                  09440020
094500     MOVE +0                       TO                             09450020
094600                                     ASC-NUMBER-OF-SELECTED-ITEMS 09460020
094700                                     ASC-START-OF-SELECTED-RANGE  09470020
094800                                     ASC-END-OF-SELECTED-RANGE.   09480020
094900                                                                  09490020
095000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09500020
095100*----------------------------------------------------------------*09510020
095200*    MARK EACH ITEM AS BEING NOT SELECTED.                       *09520020
095300*----------------------------------------------------------------*09530020
095400 2141-CLEAR-SELECTED-INDS.                                        09540020
095500                                                                  09550020
095600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09560020
095700             NOT EQUAL ZERO                                       09570020
095800         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09580020
095900         AND NOT ASC-PROTECTED(ASC-BLK-SUB ASC-ITEM-SUB)          09590020
096000             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09600020
096100                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    09610020
096200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  09620020
096300                                   TO TRUE                        09630020
096400         END-IF                                                   09640020
096500     END-IF.                                                      09650020
096600*----------------------------------------------------------------*09660020
096700*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTION SWITCH *09670020
096800*  FOR ALL ITEMS.                                                *09680020
096900*----------------------------------------------------------------*09690020
097000 2150-SELECT-ALL-ITEMS.                                           09700020
097100                                                                  09710020
097200     MOVE +1                       TO ASC-BLK-SUB.                09720020
097300     MOVE +0                       TO PV-NUMBER-OF-ITEMS-SELECTED.09730020
097400                                                                  09740020
097500     PERFORM 2151-SET-SELECTED-INDS                               09750020
097600         VARYING ASC-ITEM-SUB                                     09760020
097700         FROM 1 BY 1                                              09770020
097800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09780020
097900                                                                  09790020
098000     ADD +1                        TO ASC-BLK-SUB.                09800020
098100                                                                  09810020
098200     PERFORM 2151-SET-SELECTED-INDS                               09820020
098300         VARYING ASC-ITEM-SUB                                     09830020
098400         FROM 1 BY 1                                              09840020
098500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09850020
098600                                                                  09860020
098700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09870020
098800                                   TO PV-LIST-ITEM-NUMBER.        09880020
098900                                                                  09890020
099000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09900020
099100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09910020
099200                                                                  09920020
099300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09930020
099400        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    09940020
099500         MOVE +1                   TO ASC-BLK-SUB                 09950020
099600                                                                  09960020
099700         PERFORM 5100-WRITE-TEMP-STORAGE                          09970020
099800                                                                  09980020
099900         MOVE +1                   TO PV-BLOCK-NUMBER             09990020
100000                                                                  10000020
100100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10010020
100200             PV-FIRST-BLOCK-IN-ARRAY - 1                          10020020
100300                                                                  10030020
100400         PERFORM                                                  10040020
100500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10050020
100600                                                                  10060020
100700             PERFORM 4410-READ-TEMP-STORAGE                       10070020
100800                                                                  10080020
100900             PERFORM 2151-SET-SELECTED-INDS                       10090020
101000                 VARYING ASC-ITEM-SUB                             10100020
101100                 FROM 1 BY 1                                      10110020
101200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10120020
101300                                                                  10130020
101400             PERFORM 5100-WRITE-TEMP-STORAGE                      10140020
101500                                                                  10150020
101600             ADD +1                TO PV-BLOCK-NUMBER             10160020
101700                                                                  10170020
101800         END-PERFORM                                              10180020
101900                                                                  10190020
102000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10200020
102100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10210020
102200                                                                  10220020
102300         PERFORM                                                  10230020
102400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10240020
102500                   ASC-HIGHEST-BLOCK-WRITTEN                      10250020
102600                                                                  10260020
102700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10270020
102800                                   TO PV-BLOCK-NUMBER             10280020
102900                                                                  10290020
103000             PERFORM 4410-READ-TEMP-STORAGE                       10300020
103100                                                                  10310020
103200             PERFORM 2151-SET-SELECTED-INDS                       10320020
103300                 VARYING ASC-ITEM-SUB                             10330020
103400                 FROM 1 BY 1                                      10340020
103500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10350020
103600                                                                  10360020
103700             PERFORM 5100-WRITE-TEMP-STORAGE                      10370020
103800                                                                  10380020
103900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10390020
104000                                                                  10400020
104100         END-PERFORM                                              10410020
104200                                                                  10420020
104300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10430020
104400                                   TO PV-BLOCK-NUMBER             10440020
104500                                                                  10450020
104600         PERFORM 4410-READ-TEMP-STORAGE                           10460020
104700     END-IF.                                                      10470020
104800                                                                  10480020
104900                                                                  10490020
105000     MOVE PV-NUMBER-OF-ITEMS-SELECTED                             10500020
105100                                   TO                             10510020
105200                                   ASC-NUMBER-OF-SELECTED-ITEMS.  10520020
105300                                                                  10530020
105400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10540020
105500*----------------------------------------------------------------*10550020
105600*    MARK EACH ITEM AS BEING SELECTED.                           *10560020
105700*----------------------------------------------------------------*10570020
105800 2151-SET-SELECTED-INDS.                                          10580020
105900                                                                  10590020
106000     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10600020
106100             NOT EQUAL ZERO                                       10610020
106200         IF (NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10620020
106300         AND NOT ASC-PROTECTED(ASC-BLK-SUB ASC-ITEM-SUB))         10630020
106400             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10640020
106500                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        10650020
106600                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10660020
106700                                   TO  TRUE                       10670020
106800             ADD +1                TO PV-NUMBER-OF-ITEMS-SELECTED 10680020
106900         END-IF                                                   10690020
107000     END-IF.                                                      10700020
107100*----------------------------------------------------------------*10710020
107200*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *10720020
107300*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *10730020
107400*----------------------------------------------------------------*10740020
107500 2200-MOVE-SCREEN-TO-COMMAREA.                                    10750020
107600                                                                  10760020
107700     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             10770020
107800     MOVE +1                       TO PV-SUB.                     10780020
107900*                                                                 10790020
108000     PERFORM 3100-SET-SUBSCRIPTS.                                 10800020
108100     IF  ASTRTITL > ZERO                                          10810020
108200         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      10820020
108300     ELSE                                                         10830020
108400         IF  ASTRTITF = DP015-ERASE-EOF                           10840020
108500             INITIALIZE ASC-START-ITEM-REQUEST                    10850020
108600         END-IF                                                   10860020
108700     END-IF.                                                      10870020
108800     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          10880020
108900         VARYING PV-SUB                                           10890020
109000         FROM 1 BY 1                                              10900020
109100         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      10910020
109200*----------------------------------------------------------------*10920020
109300*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *10930020
109400*----------------------------------------------------------------*10940020
109500 2210-MOVE-LINES-TO-COMMAREA.                                     10950020
109600     IF  MR-SELECTL (PV-SUB) > ZERO                               10960020
109700         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             10970020
109800         MOVE MR-SELECTI (PV-SUB)                                 10980020
109900                                   TO ASC-TEMP-SELECTED-SW        10990020
110000                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11000020
110100     ELSE                                                         11010020
110200         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                11020020
110300                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     11030020
110400                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        11040020
110500                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11050020
110600         END-IF                                                   11060020
110700     END-IF.                                                      11070020
110800     ADD +1                        TO ASC-ITEM-SUB.               11080020
110900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        11090020
111000         ADD +1                    TO ASC-BLK-SUB                 11100020
111100         MOVE +1                   TO ASC-ITEM-SUB                11110020
111200     END-IF.                                                      11120020
111300*----------------------------------------------------------------*11130020
111400*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *11140020
111500*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *11150020
111600*----------------------------------------------------------------*11160020
111700 3000-EDIT-DATA-IN-COMMAREA.                                      11170020
111800     SET PS-NO-ERROR               TO TRUE.                       11180020
111900     PERFORM 3200-RESET-ATTRIBUTES.                               11190020
112000     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     11200020
112100**                                                                11210020
112200* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              11220020
112300* EDITTING IS DONE FROM THE BOTTOM UP.                            11230020
112400**                                                                11240020
112500     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       11250020
112600         ASC-ITEMS-DISPLAYED - 1.                                 11260020
112700     PERFORM 3100-SET-SUBSCRIPTS.                                 11270020
112800     PERFORM 3300-EDIT-SELECTIONS                                 11280020
112900         VARYING PV-SUB                                           11290020
113000         FROM PV-SUB BY -1                                        11300020
113100         UNTIL PV-SUB < +1                                        11310020
113200*                                                                 11320020
113300     IF  PS-NO-ERROR                                              11330020
113400         PERFORM 3400-CHECK-RANGE-SEQUENCE                        11340020
113500     END-IF.                                                      11350020
113600*                                                                 11360020
113700     IF  ((PS-NO-ERROR)                                           11370020
113800       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   11380020
113900       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    11390020
114000             PERFORM 3500-MARK-RANGE-AS-SELECTED                  11400020
114100     END-IF.                                                      11410020
114200*----------------------------------------------------------------*11420020
114300*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *11430020
114400*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*11440020
114500*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *11450020
114600*                                                                *11460020
114700*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *11470020
114800*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *11480020
114900*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *11490020
115000*    US IN THE 2ND BLOCK OF THE ARRAY.                           *11500020
115100*----------------------------------------------------------------*11510020
115200 3100-SET-SUBSCRIPTS.                                             11520020
115300                                                                  11530020
115400     COMPUTE ASC-ITEM-SUB =                                       11540020
115500         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        11550020
115600                                                                  11560020
115700     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         11570020
115800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            11580020
115900                                                                  11590020
116000         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               11600020
116100     ELSE                                                         11610020
116200         MOVE +1                     TO ASC-BLK-SUB               11620020
116300     END-IF.                                                      11630020
116400*----------------------------------------------------------------*11640020
116500*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *11650020
116600*----------------------------------------------------------------*11660020
116700 3200-RESET-ATTRIBUTES.                                           11670020
116800     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   11680020
116900     MOVE DP015-GREEN              TO ASTRTITC.                   11690020
117000     MOVE DP015-UNDERLINE          TO ASTRTITH.                   11700020
117100*                                                                 11710020
117200     PERFORM                                                      11720020
117300         VARYING PV-SUB                                           11730020
117400         FROM 1 BY 1                                              11740020
117500         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        11750020
117600         MOVE DP015-UNP-ALP-NOR-OFF                               11760020
117700                                   TO MR-SELECTA (PV-SUB)         11770020
117800         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         11780020
117900         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         11790020
118000     END-PERFORM.                                                 11800020
118100*----------------------------------------------------------------*11810020
118200*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *11820020
118300*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *11830020
118400*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *11840020
118500*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *11850020
118600*----------------------------------------------------------------*11860020
118700 3300-EDIT-SELECTIONS.                                            11870020
118800     EVALUATE TRUE                                                11880020
118900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     11890020
119000             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         11900020
119100                 CONTINUE                                         11910020
119200                                                                  11920020
119300         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         11930020
119400             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        11940020
119500                 EVALUATE TRUE                                    11950020
119600                     WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)    11960020
119700                         MOVE ZERO TO ASC-START-OF-SELECTED-RANGE 11970020
119800                     WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)      11980020
119900                         MOVE ZERO TO ASC-END-OF-SELECTED-RANGE   11990020
120000                 END-EVALUATE                                     12000020
120100                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   12010020
120200                 MOVE ASC-TEMP-SELECTED-SW                        12020020
120300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12030020
120400                                TO ASC-SELECTED-SW                12040020
120500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12050020
120600             END-IF                                               12060020
120700                                                                  12070020
120800         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12080020
120900                 = SPACE                                          12090020
121000             EVALUATE TRUE                                        12100020
121100                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       12110020
121200                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS12120020
121300                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        12130020
121400                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    12140020
121500                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          12150020
121600                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      12160020
121700             END-EVALUATE                                         12170020
121800             MOVE SPACE         TO ASC-SELECTED-SW                12180020
121900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12190020
122000                                                                  12200020
122100         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           12210020
122200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12220020
122300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12230020
122400             END-IF                                               12240020
122500             PERFORM 3310-EDIT-RANGE                              12250020
122600                                                                  12260020
122700         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             12270020
122800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12280020
122900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12290020
123000             END-IF                                               12300020
123100             PERFORM 3310-EDIT-RANGE                              12310020
123200                                                                  12320020
123300         WHEN OTHER                                               12330020
123400             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            12340020
123500             SET DP020-MSG-FATAL   TO TRUE                        12350020
123600             MOVE -1               TO MR-SELECTL (PV-SUB)         12360020
123700             SET DP030-SET-CURSOR-APPL-1                          12370020
123800                                   TO TRUE                        12380020
123900             MOVE DP015-RED        TO MR-SELECTC (PV-SUB)         12390020
124000             MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB)         12400020
124100             SET PS-ERROR TO TRUE                                 12410020
124200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12420020
124300                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     12430020
124400                 MOVE SPACE        TO ASC-SELECTED-SW             12440020
124500                                        (ASC-BLK-SUB ASC-ITEM-SUB)12450020
124600             END-IF                                               12460020
124700     END-EVALUATE.                                                12470020
124800                                                                  12480020
124900     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 12490020
125000     SUBTRACT +1 FROM ASC-ITEM-SUB.                               12500020
125100     IF  ASC-ITEM-SUB < 1                                         12510020
125200         SUBTRACT +1 FROM ASC-BLK-SUB                             12520020
125300         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                12530020
125400     END-IF.                                                      12540020
125500*----------------------------------------------------------------*12550020
125600*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *12560020
125700*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *12570020
125800*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *12580020
125900*  THE ENDING.                                                   *12590020
126000*----------------------------------------------------------------*12600020
126100 3310-EDIT-RANGE.                                                 12610020
126200     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                12620020
126300         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   12630020
126400             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)12640020
126500                                   TO ASC-SELECTED-SW             12650020
126600                                        (ASC-BLK-SUB ASC-ITEM-SUB)12660020
126700             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 12670020
126800         ELSE                                                     12680020
126900             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     12690020
127000                 CONTINUE                                         12700020
127100             ELSE                                                 12710020
127200*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        12720020
127300                 MOVE PC-TSYMSG-00054                             12730020
127400                                   TO DP020-MSG-NUMBER            12740020
127500                 SET DP020-MSG-FATAL                              12750020
127600                                   TO TRUE                        12760020
127700                 MOVE -1           TO MR-SELECTL (PV-SUB)         12770020
127800                 SET DP030-SET-CURSOR-APPL-1                      12780020
127900                                   TO TRUE                        12790020
128000                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         12800020
128100                 MOVE DP015-UNDERLINE                             12810020
128200                                   TO MR-SELECTH (PV-SUB)         12820020
128300                 SET PS-ERROR      TO TRUE                        12830020
128400             END-IF                                               12840020
128500         END-IF                                                   12850020
128600     ELSE                                                         12860020
128700         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     12870020
128800             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 12880020
128900                                   TO ASC-SELECTED-SW             12890020
129000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12900020
129100             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   12910020
129200         ELSE                                                     12920020
129300             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       12930020
129400                 CONTINUE                                         12940020
129500             ELSE                                                 12950020
129600*                -- ONLY ONE END-OF-RANGE ALLOWED --              12960020
129700                 MOVE PC-TSYMSG-00055                             12970020
129800                                   TO DP020-MSG-NUMBER            12980020
129900                 SET DP020-MSG-FATAL                              12990020
130000                                   TO TRUE                        13000020
130100                 MOVE -1           TO MR-SELECTL (PV-SUB)         13010020
130200                 SET DP030-SET-CURSOR-APPL-1                      13020020
130300                                   TO TRUE                        13030020
130400                 SET PS-ERROR      TO TRUE                        13040020
130500             END-IF                                               13050020
130600         END-IF                                                   13060020
130700     END-IF.                                                      13070020
130800*----------------------------------------------------------------*13080020
130900*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *13090020
131000*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *13100020
131100*----------------------------------------------------------------*13110020
131200 3400-CHECK-RANGE-SEQUENCE.                                       13120020
131300     IF (ASC-START-OF-SELECTED-RANGE > ZERO                       13130020
131400       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      13140020
131500       AND  ASC-START-OF-SELECTED-RANGE >                         13150020
131600                                        ASC-END-OF-SELECTED-RANGE)13160020
131700*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                13170020
131800         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 13180020
131900         SET DP020-MSG-FATAL TO TRUE                              13190020
132000         SET PS-ERROR TO TRUE                                     13200020
132100         PERFORM 3410-POSITION-AT-ERROR                           13210020
132200     END-IF.                                                      13220020
132300*----------------------------------------------------------------*13230020
132400*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *13240020
132500*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *13250020
132600*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *13260020
132700*----------------------------------------------------------------*13270020
132800 3410-POSITION-AT-ERROR.                                          13280020
132900     SET DP030-SET-CURSOR-APPL-1                                  13290020
133000                                   TO TRUE.                       13300020
133100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 13310020
133200                    - PV-TOP-ITEM + 1.                            13320020
133300     IF (PV-SUB < +1                                              13330020
133400      OR PV-SUB > PC-ITEMS-PER-PANEL)                             13340020
133500         CONTINUE                                                 13350020
133600     ELSE                                                         13360020
133700         MOVE -1                   TO MR-SELECTL (PV-SUB)         13370020
133800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         13380020
133900         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         13390020
134000     END-IF.                                                      13400020
134100*                                                                 13410020
134200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   13420020
134300                    - PV-TOP-ITEM + 1.                            13430020
134400     IF (PV-SUB < +1                                              13440020
134500      OR PV-SUB > PC-ITEMS-PER-PANEL)                             13450020
134600         CONTINUE                                                 13460020
134700     ELSE                                                         13470020
134800         MOVE -1                   TO MR-SELECTL (PV-SUB)         13480020
134900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         13490020
135000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         13500020
135100     END-IF.                                                      13510020
135200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 13520020
135300                                      ASC-END-OF-SELECTED-RANGE.  13530020
135400*----------------------------------------------------------------*13540020
135500*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *13550020
135600*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *13560020
135700*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *13570020
135800*----------------------------------------------------------------*13580020
135900 3500-MARK-RANGE-AS-SELECTED.                                     13590020
136000     MOVE +1                       TO  ASC-BLK-SUB.               13600020
136100     PERFORM 3510-MARK-SELECTED-INDS                              13610020
136200         VARYING ASC-ITEM-SUB                                     13620020
136300         FROM 1 BY 1                                              13630020
136400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13640020
136500                                                                  13650020
136600     ADD +1                        TO ASC-BLK-SUB.                13660020
136700     PERFORM 3510-MARK-SELECTED-INDS                              13670020
136800         VARYING ASC-ITEM-SUB                                     13680020
136900         FROM 1 BY 1                                              13690020
137000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13700020
137100                                                                  13710020
137200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               13720020
137300                                   TO  PV-LIST-ITEM-NUMBER.       13730020
137400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13740020
137500         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         13750020
137600               PC-ITEMS-PER-PANEL).                               13760020
137700                                                                  13770020
137800     MOVE ASC-START-OF-SELECTED-RANGE                             13780020
137900                                   TO PV-START-OF-SELECTED-RANGE. 13790020
138000     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            13800020
138100         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  13810020
138200               PC-ITEMS-PER-PANEL).                               13820020
138300                                                                  13830020
138400     MOVE ASC-END-OF-SELECTED-RANGE                               13840020
138500                                   TO  PV-END-OF-SELECTED-RANGE.  13850020
138600     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             13860020
138700         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    13870020
138800               PC-ITEMS-PER-PANEL).                               13880020
138900     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             13890020
139000         PV-FIRST-BLOCK-IN-ARRAY + 1.                             13900020
139100                                                                  13910020
139200     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    13920020
139300        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        13930020
139400         MOVE +1                   TO ASC-BLK-SUB                 13940020
139500         PERFORM 5100-WRITE-TEMP-STORAGE                          13950020
139600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13960020
139700             PV-FIRST-BLOCK-IN-ARRAY - 1                          13970020
139800                                                                  13980020
139900         PERFORM                                                  13990020
140000             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      14000020
140100                   PV-PREV-BLOCK-IN-ARRAY                         14010020
140200             MOVE PV-FIRST-BLOCK-IN-RANGE                         14020020
140300                                   TO PV-BLOCK-NUMBER             14030020
140400             PERFORM 4410-READ-TEMP-STORAGE                       14040020
140500             PERFORM 3510-MARK-SELECTED-INDS                      14050020
140600                 VARYING ASC-ITEM-SUB                             14060020
140700                 FROM 1 BY 1                                      14070020
140800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14080020
140900             PERFORM 5100-WRITE-TEMP-STORAGE                      14090020
141000             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     14100020
141100         END-PERFORM                                              14110020
141200                                                                  14120020
141300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         14130020
141400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     14140020
141500         PERFORM                                                  14150020
141600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       14160020
141700                   PV-LAST-BLOCK-IN-RANGE                         14170020
141800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          14180020
141900                                   TO PV-BLOCK-NUMBER             14190020
142000             PERFORM 4410-READ-TEMP-STORAGE                       14200020
142100             PERFORM 3510-MARK-SELECTED-INDS                      14210020
142200                 VARYING ASC-ITEM-SUB                             14220020
142300                 FROM 1 BY 1                                      14230020
142400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14240020
142500             PERFORM 5100-WRITE-TEMP-STORAGE                      14250020
142600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      14260020
142700         END-PERFORM                                              14270020
142800                                                                  14280020
142900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             14290020
143000                                   TO PV-BLOCK-NUMBER             14300020
143100         PERFORM 4410-READ-TEMP-STORAGE                           14310020
143200     END-IF.                                                      14320020
143300                                                                  14330020
143400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 14340020
143500                                      ASC-END-OF-SELECTED-RANGE.  14350020
143600*----------------------------------------------------------------*14360020
143700* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *14370020
143800*----------------------------------------------------------------*14380020
143900 3510-MARK-SELECTED-INDS.                                         14390020
144000                                                                  14400020
144100     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         14410020
144200                                ASC-ITEM-SUB) >                   14420020
144300         ASC-START-OF-SELECTED-RANGE)                             14430020
144400     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         14440020
144500                                ASC-ITEM-SUB) =                   14450020
144600         ASC-START-OF-SELECTED-RANGE)                             14460020
144700                                                                  14470020
144800         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14480020
144900                                    ASC-ITEM-SUB) <               14490020
145000             ASC-END-OF-SELECTED-RANGE)                           14500020
145100         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     14510020
145200                                    ASC-ITEM-SUB) =               14520020
145300             ASC-END-OF-SELECTED-RANGE)                           14530020
145400                                                                  14540020
145500             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          14550020
145600             AND NOT ASC-PROTECTED(ASC-BLK-SUB ASC-ITEM-SUB)      14560020
145700                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   14570020
145800                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   14580020
145900                                   TO TRUE                        14590020
146000                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              14600020
146100                                   TO TRUE                        14610020
146200                 ADD +1            TO                             14620020
146300                                   ASC-NUMBER-OF-SELECTED-ITEMS   14630020
146400             END-IF                                               14640020
146500         END-IF                                                   14650020
146600     END-IF.                                                      14660020
146700*----------------------------------------------------------------*14670020
146800*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *14680020
146900*    INITIALIZE ALL COUNTERS AND FLAGS.                          *14690020
147000*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *14700020
147100*    DISPLAY THE PANEL TO USER.                                  *14710020
147200*----------------------------------------------------------------*14720020
147300 4000-BUILD-INITIAL-PANEL.                                        14730020
147400                                                                  14740020
147500     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            14750020
147600                                 ASC-BLOCK-ENTRIES (2).           14760020
147700     MOVE +1                 TO ASC-BLK-SUB.                      14770020
147800     SET ASC-ITEMS-LEFT-ON-DB                                     14780020
147900                             TO TRUE.                             14790020
148000                                                                  14800020
148100     MOVE +0                 TO ASC-ITEM-SUB                      14810020
148200                                ASC-NUMBER-OF-ITEMS-READ          14820020
148300                                ASC-NUMBER-OF-SELECTED-ITEMS      14830020
148400                                ASC-HIGHEST-BLOCK-WRITTEN         14840020
148500                                ASC-START-OF-SELECTED-RANGE       14850020
148600                                ASC-END-OF-SELECTED-RANGE         14860020
148700                                ASC-ITEM-AT-TOP-OF-PANEL.         14870020
148800                                                                  14880020
148900     PERFORM 4010-OPEN-CURSOR.                                    14890020
149000                                                                  14900020
149100     PERFORM 4300-READ-ITEMS-FROM-DB.                             14910020
149200                                                                  14920020
149300     PERFORM 4020-CLOSE-CURSOR.                                   14930020
149400                                                                  14940020
149500     MOVE +1                   TO  PV-TOP-ITEM.                   14950020
149600     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          14960020
149700         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    14970020
149800         SET DP020-MSG-FATAL   TO  TRUE                           14980020
149900         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               14990020
150000     ELSE                                                         15000020
150100         PERFORM 4005-SUM-QTY-AND-AMT                             15010020
150200         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     15020020
150300     END-IF.                                                      15030020
150400*----------------------------------------------------------------*15040020
150500* SUM QTY AND AMT                                                *15050020
150600*   SUM THE DETAIL LINES TO GET A TOTAL QTY AND AMT              *15060020
150700*----------------------------------------------------------------*15070020
150800 4005-SUM-QTY-AND-AMT.                                            15080020
150900     IF ASC-NOT-HISTORY-CSR                                       15090020
151000         EXEC SQL                                                 15100020
151100             SELECT SUM(ACTL_PR_CHG_QTY),                         15110020
151200                    SUM(ACTL_PR_CHG_AMT)                          15120020
151300             INTO :PV-ACTL-PR-CHG-QTY,                            15130020
151400                  :PV-ACTL-PR-CHG-AMT                             15140020
151500             FROM TSPPCDT                                         15150020
151600             WHERE DEST_LOC_NBR = :DK-STORE-NUMBER                15160020
151700               AND DOC_NBR      = :DK-DOCUMENT-NUMBER             15170020
151800         END-EXEC                                                 15180020
151900     ELSE                                                         15190020
152000         EXEC SQL                                                 15200020
152100             SELECT SUM(ACTL_PR_CHG_QTY),                         15210020
152200                    SUM(ACTL_PR_CHG_AMT)                          15220020
152300             INTO :PV-ACTL-PR-CHG-QTY,                            15230020
152400                  :PV-ACTL-PR-CHG-AMT                             15240020
152500             FROM TSPCDTH                                         15250020
152600             WHERE DEST_LOC_NBR = :DK-STORE-NUMBER                15260020
152700               AND DOC_NBR      = :DK-DOCUMENT-NUMBER             15270020
152800         END-EXEC                                                 15280020
152900     END-IF.                                                      15290020
153000     EVALUATE TRUE                                                15300020
153100         WHEN SQLCODE = 0                                         15310020
153200             MOVE PV-ACTL-PR-CHG-QTY                              15320020
153300                             TO ASC-ACTL-PR-CHG-QTY               15330020
153400             MOVE PV-ACTL-PR-CHG-AMT                              15340020
153500                             TO ASC-ACTL-PR-CHG-AMT               15350020
153600         WHEN SQLCODE = +100                                      15360020
153700             MOVE ZERO       TO ASC-ACTL-PR-CHG-QTY               15370020
153800                                ASC-ACTL-PR-CHG-AMT               15380020
153900         WHEN OTHER                                               15390020
154000             MOVE '4005-SUM-QTY-AND-AMT'                          15400020
154100                             TO DP013-PARAGRAPH                   15410020
154200             MOVE 'SUM DETAIL QTY AND AMT - '                     15420020
154300                             TO DP013-MESSAGE-TEXT (1)            15430020
154400             MOVE SQLCA      TO DP013-SQLCA                       15440020
154500             SET DP013-DB2-ABEND                                  15450020
154600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15460020
154700             PERFORM DP013-0000-PROCESS-ABEND                     15470020
154800     END-EVALUATE.                                                15480020
154900*----------------------------------------------------------------*15490020
155000* OPEN THE DETAIL CURSOR.                                        *15500020
155100*   IN THIS PARTICULAR APPLICATION ONE OF 2 DIFFERENT CURSORS    *15510020
155200*   WILL BE OPENED DEPENDING ON IF THE DOCUMENT IS CURRENT OR    *15520020
155300*   HISTORY.                                                     *15530020
155400*----------------------------------------------------------------*15540020
155500 4010-OPEN-CURSOR.                                                15550020
155600     PERFORM                                                      15560020
155700         WITH TEST AFTER                                          15570020
155800         VARYING PV-RETRY-COUNTER                                 15580020
155900         FROM 1 BY 1                                              15590020
156000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15600020
156100                   OR (SQLCODE = ZERO))                           15610020
156200         EVALUATE TRUE                                            15620020
156300             WHEN ASC-NOT-HISTORY-CSR                             15630020
156400                 MOVE 'CURSOR:  CURRENT-DTL-CSR'                  15640020
156500                                   TO DP013-MESSAGE-TEXT (2)      15650020
156600                 MOVE 'TSPPCDT '   TO DP013-DB2-TABLE-NAME (1)    15660020
156700                 MOVE DK-STORE-NUMBER       TO SPPCDT-DEST-LOC-NBR15670020
156800                 MOVE DK-DOCUMENT-NUMBER    TO SPPCDT-DOC-NBR     15680020
156900                 EXEC SQL                                         15690020
157000                      OPEN CURRENT-DTL-CSR                        15700020
157100                 END-EXEC                                         15710020
157200                                                                  15720020
157300             WHEN ASC-HISTORY-CSR                                 15730020
157400                 MOVE 'CURSOR:  HISTORY-DTL-CSR'                  15740020
157500                                   TO DP013-MESSAGE-TEXT (2)      15750020
157600                 MOVE 'TSPCDTH '   TO DP013-DB2-TABLE-NAME (1)    15760020
157700                 MOVE DK-STORE-NUMBER       TO SPCDTH-DEST-LOC-NBR15770020
157800                 MOVE DK-DOCUMENT-NUMBER    TO SPCDTH-DOC-NBR     15780020
157900                 EXEC SQL                                         15790020
158000                      OPEN HISTORY-DTL-CSR                        15800020
158100                 END-EXEC                                         15810020
158200                                                                  15820020
158300         END-EVALUATE                                             15830020
158400                                                                  15840020
158500         EVALUATE TRUE                                            15850020
158600             WHEN SQLCODE = ZERO                                  15860020
158700             WHEN SQLCODE = -904                                  15870020
158800             WHEN SQLCODE = -913                                  15880020
158900                 CONTINUE                                         15890020
159000             WHEN SQLWARN0 NOT = SPACES                           15900020
159100             WHEN SQLCODE < ZERO                                  15910020
159200             WHEN SQLCODE > ZERO                                  15920020
159300                 MOVE '4010-OPEN-CURSOR'                          15930020
159400                                   TO DP013-PARAGRAPH             15940020
159500                 MOVE 'OPEN DETAIL CURSOR - '                     15950020
159600                                   TO DP013-MESSAGE-TEXT (1)      15960020
159700                 MOVE SQLCA        TO DP013-SQLCA                 15970020
159800                 SET DP013-DB2-ABEND                              15980020
159900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15990020
160000                 PERFORM DP013-0000-PROCESS-ABEND                 16000020
160100         END-EVALUATE                                             16010020
160200     END-PERFORM.                                                 16020020
160300*                                                                 16030020
160400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16040020
160500         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             16050020
160600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   16060020
160700                                   TO DP013-MESSAGE-TEXT (1)      16070020
160800         MOVE SQLCA                TO DP013-SQLCA                 16080020
160900         SET DP013-DB2-ABEND                                      16090020
161000             DP013-XCTL-DISPLAY-RESTART                           16100020
161100                                   TO TRUE                        16110020
161200         PERFORM DP013-0000-PROCESS-ABEND                         16120020
161300     END-IF.                                                      16130020
161400*----------------------------------------------------------------*16140020
161500* CLOSE THE DETAIL CURSOR.                                       *16150020
161600*   IN THIS PARTICULAR APPLICATION ONE OF 2 DIFFERENT CURSORS    *16160020
161700*   WILL BE CLOSED DEPENDING ON IF THE DOCUMENT IS CURRENT OR    *16170020
161800*   HISTORY.                                                     *16180020
161900*----------------------------------------------------------------*16190020
162000 4020-CLOSE-CURSOR.                                               16200020
162100     EVALUATE TRUE                                                16210020
162200         WHEN ASC-NOT-HISTORY-CSR                                 16220020
162300             EXEC SQL                                             16230020
162400                 CLOSE CURRENT-DTL-CSR                            16240020
162500             END-EXEC                                             16250020
162600             MOVE 'TSPPCDT '   TO DP013-DB2-TABLE-NAME (1)        16260020
162700                                                                  16270020
162800         WHEN ASC-HISTORY-CSR                                     16280020
162900             EXEC SQL                                             16290020
163000                 CLOSE HISTORY-DTL-CSR                            16300020
163100             END-EXEC                                             16310020
163200             MOVE 'TSPCDTH '   TO DP013-DB2-TABLE-NAME (1)        16320020
163300     END-EVALUATE.                                                16330020
163400*                                                                 16340020
163500     EVALUATE TRUE                                                16350020
163600         WHEN SQLCODE = ZERO                                      16360020
163700             CONTINUE                                             16370020
163800         WHEN SQLWARN0 NOT = SPACES                               16380020
163900         WHEN SQLCODE < ZERO                                      16390020
164000         WHEN SQLCODE > ZERO                                      16400020
164100             MOVE '4020-CLOSE-CURSOR'                             16410020
164200                               TO DP013-PARAGRAPH                 16420020
164300             MOVE 'CLOSE DOCUMENT DETAIL CURSOR'                  16430020
164400                               TO DP013-MESSAGE-TEXT (1)          16440020
164500             MOVE SQLCA        TO DP013-SQLCA                     16450020
164600             SET DP013-DB2-ABEND                                  16460020
164700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16470020
164800             PERFORM DP013-0000-PROCESS-ABEND                     16480020
164900     END-EVALUATE.                                                16490020
165000*----------------------------------------------------------------*16500020
165100*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *16510020
165200*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *16520020
165300*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *16530020
165400*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *16540020
165500*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *16550020
165600*                                                                *16560020
165700*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *16570020
165800*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *16580020
165900*    UPON INITIALIZATION.                                        *16590020
166000*----------------------------------------------------------------*16600020
166100 4300-READ-ITEMS-FROM-DB.                                         16610020
166200                                                                  16620020
166300     PERFORM                                                      16630020
166400         VARYING PV-READ-COUNT                                    16640020
166500         FROM 1 BY 1                                              16650020
166600         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    16660020
166700            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         16670020
166800                                                                  16680020
166900         PERFORM 4310-FETCH                                       16690020
167000                                                                  16700020
167100         IF  ASC-ITEMS-LEFT-ON-DB                                 16710020
167200             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                16720020
167300                 ADD +1            TO ASC-ITEM-SUB                16730020
167400             ELSE                                                 16740020
167500                 ADD +1            TO ASC-BLK-SUB                 16750020
167600                 MOVE +1           TO ASC-ITEM-SUB                16760020
167700                                                                  16770020
167800                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         16780020
167900                     MOVE +1       TO ASC-BLK-SUB                 16790020
168000                     SET ASC-BLOCK-MODIFIED (1)                   16800020
168100                                   TO TRUE                        16810020
168200                     PERFORM 5100-WRITE-TEMP-STORAGE              16820020
168300                     MOVE ASC-BLOCK-ENTRIES                       16830020
168400                               (PC-MAX-BLOCKS-IN-ARRAY)           16840020
168500                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 16850020
168600                     ADD +1        TO ASC-BLK-SUB                 16860020
168700                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   16870020
168800                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      16880020
168900                                   TO TRUE                        16890020
169000                 END-IF                                           16900020
169100             END-IF                                               16910020
169200             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    16920020
169300             MOVE ASC-NUMBER-OF-ITEMS-READ                        16930020
169400                                   TO ASC-LIST-ITEM-NUMBER        16940020
169500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16950020
169600             MOVE SPPCDT-DEPT-NBR       TO PV-DEPT                16960020
169700             MOVE PV-DEPT(2:3)     TO ASC-DEPT-NUMBER             16970020
169800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16980020
169900             MOVE PV-HOLD-CLASS    TO ASC-CLASS-NUMBER            16990020
170000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17000020
170100             MOVE SPPCDT-SKU-NBR   TO ASC-SKU                     17010020
170200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17020020
170300             MOVE SPPCDT-UPC-NBR   TO ASC-UPC                     17030020
170400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17040020
170500             MOVE SPPCDT-OLD-PR    TO ASC-ORIG-PRICE              17050020
170600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17060020
170700             MOVE SPPCDT-NEW-PR    TO ASC-NEW-PRICE               17070020
170800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17080020
170900             COMPUTE ASC-PRICE-DIFF   (ASC-BLK-SUB ASC-ITEM-SUB)  17090020
171000                    = (ASC-ORIG-PRICE (ASC-BLK-SUB ASC-ITEM-SUB)  17100020
171100                     - ASC-NEW-PRICE (ASC-BLK-SUB ASC-ITEM-SUB))  17110020
171200             MOVE SPPCDT-ACTL-PR-CHG-QTY                          17120020
171300                                   TO ASC-QUANTITY                17130020
171400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17140020
171500             MOVE ASC-SKU (ASC-BLK-SUB ASC-ITEM-SUB) TO PV-SKU-X  17150020
171600             IF PV-SKU-X (6:3) = ZEROS                            17160020
171700                 SET ASC-TEMP-PROTECTED (ASC-BLK-SUB ASC-ITEM-SUB)17170020
171800                     ASC-PROTECTED (ASC-BLK-SUB ASC-ITEM-SUB)     17180020
171900                                 TO TRUE                          17190020
172000             END-IF                                               17200020
172100         END-IF                                                   17210020
172200     END-PERFORM.                                                 17220020
172300                                                                  17230020
172400     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          17240020
172500         MOVE +1               TO ASC-BLK-SUB                     17250020
172600         PERFORM 5100-WRITE-TEMP-STORAGE                          17260020
172700         ADD +1                TO ASC-BLK-SUB                     17270020
172800         PERFORM 5100-WRITE-TEMP-STORAGE                          17280020
172900                                                                  17290020
173000         MOVE 1                TO ASC-BLK-SUB                     17300020
173100                                  PV-BLOCK-NUMBER                 17310020
173200         PERFORM 4410-READ-TEMP-STORAGE                           17320020
173300         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             17330020
173400             MOVE 2            TO ASC-BLK-SUB                     17340020
173500                                  PV-BLOCK-NUMBER                 17350020
173600             PERFORM 4410-READ-TEMP-STORAGE                       17360020
173700         END-IF                                                   17370020
173800     END-IF.                                                      17380020
173900*----------------------------------------------------------------*17390020
174000*    FETCH THE MESSAGE CURSOR.                                   *17400020
174100*----------------------------------------------------------------*17410020
174200 4310-FETCH.                                                      17420020
174300                                                                  17430020
174400     EVALUATE TRUE                                                17440020
174500         WHEN ASC-NOT-HISTORY-CSR                                 17450020
174600              EXEC SQL                                            17460020
174700                   FETCH CURRENT-DTL-CSR                          17470020
174800                   INTO  :SPPCDT-DEPT-NBR                         17480020
174900                       , :SPPCDT-SUB-CL-NBR                       17490020
175000                       , :SPPCDT-SKU-NBR                          17500020
175100                       , :SPPCDT-ROW-NBR                          17510020
175200                       , :SPPCDT-ACTL-PR-CHG-QTY                  17520020
175300                       , :SPPCDT-OLD-PR                           17530020
175400                       , :SPPCDT-NEW-PR                           17540020
175500                       , :SPPCDT-ACTL-PR-CHG-AMT                  17550020
175600                       , :SPPCDT-UPC-NBR                          17560020
175700              END-EXEC                                            17570020
175800                                                                  17580020
175900         WHEN ASC-HISTORY-CSR                                     17590020
176000              EXEC SQL                                            17600020
176100                   FETCH HISTORY-DTL-CSR                          17610020
176200                   INTO  :SPPCDT-DEPT-NBR                         17620020
176300                       , :SPPCDT-SUB-CL-NBR                       17630020
176400                       , :SPPCDT-SKU-NBR                          17640020
176500                       , :SPPCDT-ROW-NBR                          17650020
176600                       , :SPPCDT-ACTL-PR-CHG-QTY                  17660020
176700                       , :SPPCDT-OLD-PR                           17670020
176800                       , :SPPCDT-NEW-PR                           17680020
176900                       , :SPPCDT-ACTL-PR-CHG-AMT                  17690020
177000                       , :SPPCDT-UPC-NBR                          17700020
177100              END-EXEC                                            17710020
177200     END-EVALUATE.                                                17720020
177300                                                                  17730020
177400     EVALUATE TRUE                                                17740020
177500         WHEN SQLCODE = ZERO                                      17750020
177600              MOVE SPPCDT-SUB-CL-NBR                              17760020
177700                               TO PV-FULL-CLASS-NBR-9             17770020
177800              MOVE SPPCDT-SKU-NBR TO PV-SKU-9                     17780020
177900              IF PV-SKU-9(6:3) = ZEROS                            17790020
178000                 CONTINUE                                         17800020
178100              END-IF                                              17810020
178200         WHEN SQLCODE = +100                                      17820020
178300              SET ASC-NO-ITEMS-LEFT-ON-DB                         17830020
178400                               TO TRUE                            17840020
178500         WHEN SQLWARN0 NOT = SPACE                                17850020
178600         WHEN SQLCODE NOT = ZERO                                  17860020
178700              MOVE '4310-FETCH-CURSOR'                            17870020
178800                               TO DP013-PARAGRAPH                 17880020
178900              MOVE 'FETCH DOCUMENT DETAIL CURSOR'                 17890020
179000                               TO DP013-MESSAGE-TEXT (1)          17900020
179100              MOVE SQLCA       TO DP013-SQLCA                     17910020
179200              SET DP013-DB2-ABEND                                 17920020
179300                               TO TRUE                            17930020
179400              PERFORM DP013-0000-PROCESS-ABEND                    17940020
179500     END-EVALUATE.                                                17950020
179600*----------------------------------------------------------------*17960020
179700* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *17970020
179800*----------------------------------------------------------------*17980020
179900                                                                  17990020
180000 4400-MOVE-COMMAREA-TO-SCREEN.                                    18000020
180100     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             18010020
180200         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          18020020
180300         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          18030020
180400             MOVE +1    TO ASC-BLK-SUB                            18040020
180500             PERFORM 5100-WRITE-TEMP-STORAGE                      18050020
180600             ADD +1     TO ASC-BLK-SUB                            18060020
180700             PERFORM 5100-WRITE-TEMP-STORAGE                      18070020
180800             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             18080020
180900                 GIVING PV-BLOCK-NUMBER                           18090020
181000                 REMAINDER PV-REMAINDER                           18100020
181100             IF  PV-REMAINDER > ZERO                              18110020
181200                 ADD +1 TO PV-BLOCK-NUMBER                        18120020
181300             END-IF                                               18130020
181400             MOVE +1    TO ASC-BLK-SUB                            18140020
181500             PERFORM 4410-READ-TEMP-STORAGE                       18150020
181600             ADD +1     TO ASC-BLK-SUB                            18160020
181700                           PV-BLOCK-NUMBER                        18170020
181800             PERFORM 4410-READ-TEMP-STORAGE                       18180020
181900     END-IF.                                                      18190020
182000     MOVE +1            TO ASC-BLK-SUB.                           18200020
182100     COMPUTE ASC-ITEM-SUB =                                       18210020
182200         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              18220020
182300         + PC-ITEMS-PER-PANEL).                                   18230020
182400*                                                                 18240020
182500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        18250020
182600         ADD +1         TO ASC-BLK-SUB                            18260020
182700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            18270020
182800     END-IF.                                                      18280020
182900*                                                                 18290020
183000     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           18300020
183100         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                18310020
183200     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        18320020
183300     PERFORM 4420-FORMAT-LIST-LINES                               18330020
183400         VARYING PV-SUB                                           18340020
183500         FROM PC-ITEMS-PER-PANEL BY -1                            18350020
183600         UNTIL PV-SUB < +1.                                       18360020
183700*                                                                 18370020
183800     COMPUTE ASC-ITEMS-DISPLAYED =                                18380020
183900         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          18390020
184000     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    18400020
184100                                      ASTRTITO.                   18410020
184200     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    18420020
184300     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    18430020
184400     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            18440020
184500                                   TO ASELITO.                    18450020
184600     MOVE ASC-KEY-STORE-NUMBER     TO ASTRNO.                     18460020
184700     MOVE ASC-KEY-STORE-NAME       TO ASTRNMO.                    18470020
184800     MOVE ASC-KEY-DOCUMENT-NUMBER  TO ADOCNO.                     18480020
184900     MOVE ASC-ACTL-PR-CHG-AMT      TO PV-TOT-ACTL-PR-CHG-AMT.     18490020
185000     MOVE PV-TOT-ACTL-PR-CHG-AMT   TO APRCHGO.                    18500020
185100     MOVE ASC-ACTL-PR-CHG-QTY      TO AQTYO.                      18510020
185200                                                                  18520020
185300     IF  DP020-MSG-NUMBER-X = SPACE                               18530020
185400         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  18540020
185500*            --- MORE ITEMS TO DISPLAY ----                       18550020
185600             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            18560020
185700             SET DP020-MSG-INFORMATIONAL TO TRUE                  18570020
185800         END-IF                                                   18580020
185900     END-IF.                                                      18590020
186000*----------------------------------------------------------------*18600020
186100*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *18610020
186200*----------------------------------------------------------------*18620020
186300 4410-READ-TEMP-STORAGE.                                          18630020
186400                                                                  18640020
186500     EXEC CICS                                                    18650020
186600         READQ TS                                                 18660020
186700             QUEUE (ASC-LIST-QUEUE-NAME)                          18670020
186800             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               18680020
186900             ITEM  (PV-BLOCK-NUMBER)                              18690020
187000             RESP  (PV-CICS-RESP)                                 18700020
187100     END-EXEC.                                                    18710020
187200                                                                  18720020
187300     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       18730020
187400       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     18740020
187500         CONTINUE                                                 18750020
187600     ELSE                                                         18760020
187700         SET DP013-CICS-ABEND     TO TRUE                         18770020
187800         SET DP013-NO-ROLLBACK    TO TRUE                         18780020
187900         MOVE '4410-READ-TEMP-STORAGE'                            18790020
188000                                  TO DP013-PARAGRAPH              18800020
188100         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      18810020
188200                                  TO DP013-MESSAGE-TEXT(1)        18820020
188300         PERFORM DP013-0000-PROCESS-ABEND                         18830020
188400     END-IF.                                                      18840020
188500                                                                  18850020
188600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             18860020
188700*                                                                 18870020
188800     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         18880020
188900         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               18890020
189000     END-IF.                                                      18900020
189100*----------------------------------------------------------------*18910020
189200*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *18920020
189300*----------------------------------------------------------------*18930020
189400 4420-FORMAT-LIST-LINES.                                          18940020
189500     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      18950020
189600         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                18960020
189700         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           18970020
189800         MOVE SPACE              TO MR-SELECTI (PV-SUB)           18980020
189900                                    MR-ACTION (PV-SUB)            18990020
190000                                    MR-DEPT (PV-SUB)              19000020
190100                                    MR-CLASS (PV-SUB)             19010020
190200                                    MR-SKU (PV-SUB)               19020020
190300                                    MR-UPC (PV-SUB)               19030020
190400                                    MR-ORIG-PRICE-X (PV-SUB)      19040020
190500                                    MR-NEW-PRICE-X (PV-SUB)       19050020
190600                                    MR-PRICE-DIFF-X (PV-SUB)      19060020
190700                                    MR-QUANTITY-X (PV-SUB)        19070020
190800     ELSE                                                         19080020
190900         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      19090020
191000                                                   > SPACE        19100020
191100             IF ASC-TEMP-PROTECTED (ASC-BLK-SUB ASC-ITEM-SUB)     19110020
191200                 MOVE DP015-ASK-DRK-OFF                           19120020
191300                                 TO MR-SELECTA  (PV-SUB)          19130020
191400                 MOVE SPACE      TO MR-SELECTI  (PV-SUB)          19140020
191500             ELSE                                                 19150020
191600                 MOVE ASC-TEMP-SELECTED-SW                        19160020
191700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19170020
191800                                 TO MR-SELECTI (PV-SUB)           19180020
191900                 MOVE -1         TO MR-SELECTL (PV-SUB)           19190020
192000                 SET DP030-SET-CURSOR-APPL-1                      19200020
192100                                 TO TRUE                          19210020
192200         ELSE                                                     19220020
192300             IF ASC-PROTECTED (ASC-BLK-SUB ASC-ITEM-SUB)          19230020
192400                 MOVE DP015-ASK-DRK-OFF                           19240020
192500                                 TO MR-SELECTA  (PV-SUB)          19250020
192600                 MOVE SPACE      TO MR-SELECTI  (PV-SUB)          19260020
192700             ELSE                                                 19270020
192800                 MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)  19280020
192900                                 TO MR-SELECTI (PV-SUB)           19290020
193000                 MOVE -1         TO MR-SELECTL (PV-SUB)           19300020
193100                 SET DP030-SET-CURSOR-APPL-1                      19310020
193200                                 TO TRUE                          19320020
193300             END-IF                                               19330020
193400         END-IF                                                   19340020
193500*                                                                 19350020
193600         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           19360020
193700             MOVE ASC-ACTION       (ASC-BLK-SUB ASC-ITEM-SUB)     19370020
193800                                 TO MR-ACTION (PV-SUB)            19380020
193900             MOVE ASC-DEPT-NUMBER  (ASC-BLK-SUB ASC-ITEM-SUB)     19390020
194000                                 TO MR-DEPT (PV-SUB)              19400020
194100             MOVE ASC-CLASS-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)     19410020
194200                                 TO MR-CLASS (PV-SUB)             19420020
194300             MOVE ASC-SKU          (ASC-BLK-SUB ASC-ITEM-SUB)     19430020
194400                                 TO MR-SKU (PV-SUB)               19440020
194500             MOVE ASC-UPC          (ASC-BLK-SUB ASC-ITEM-SUB)     19450020
194600                                 TO MR-UPC (PV-SUB)               19460020
194700             MOVE ASC-ORIG-PRICE   (ASC-BLK-SUB ASC-ITEM-SUB)     19470020
194800                                 TO MR-ORIG-PRICE (PV-SUB)        19480020
194900             MOVE ASC-NEW-PRICE    (ASC-BLK-SUB ASC-ITEM-SUB)     19490020
195000                                 TO MR-NEW-PRICE (PV-SUB)         19500020
195100             MOVE ASC-PRICE-DIFF   (ASC-BLK-SUB ASC-ITEM-SUB)     19510020
195200                                 TO MR-PRICE-DIFF (PV-SUB)        19520020
195300             MOVE ASC-QUANTITY     (ASC-BLK-SUB ASC-ITEM-SUB)     19530020
195400                                 TO MR-QUANTITY (PV-SUB)          19540020
195500         END-IF                                                   19550020
195600     END-IF.                                                      19560020
195700     SUBTRACT +1 FROM ASC-ITEM-SUB                                19570020
195800     IF  ASC-ITEM-SUB < + 1                                       19580020
195900         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  19590020
196000         MOVE +1                 TO ASC-BLK-SUB                   19600020
196100     END-IF.                                                      19610020
196200*----------------------------------------------------------------*19620020
196300*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *19630020
196400*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *19640020
196500*  ISSUE A WARNING.                                              *19650020
196600*----------------------------------------------------------------*19660020
196700 4430-CHECK-FOR-BEGIN-AND-END.                                    19670020
196800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       19680020
196900         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     19690020
197000*            -- NO END-OF-RANGE SPECFIED ---                      19700020
197100             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            19710020
197200             SET DP020-MSG-WARNING TO TRUE                        19720020
197300             PERFORM 4431-POSITION-AT-WARNING                     19730020
197400         END-IF                                                   19740020
197500     ELSE                                                         19750020
197600         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     19760020
197700*            -- NO BEGINNING-OF-RANGE SPECFIED ---                19770020
197800             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            19780020
197900             SET DP020-MSG-WARNING TO TRUE                        19790020
198000             PERFORM 4431-POSITION-AT-WARNING                     19800020
198100         END-IF                                                   19810020
198200     END-IF.                                                      19820020
198300*----------------------------------------------------------------*19830020
198400*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *19840020
198500*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *19850020
198600*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *19860020
198700*  POSITION THE CURSOR THERE.                                    *19870020
198800*----------------------------------------------------------------*19880020
198900 4431-POSITION-AT-WARNING.                                        19890020
199000     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 19900020
199100                    - PV-TOP-ITEM + 1.                            19910020
199200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      19920020
199300         CONTINUE                                                 19930020
199400     ELSE                                                         19940020
199500         SET DP030-SET-CURSOR-APPL-1                              19950020
199600                                   TO TRUE                        19960020
199700         MOVE -1                   TO MR-SELECTL (PV-SUB)         19970020
199800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19980020
199900         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         19990020
200000     END-IF.                                                      20000020
200100*                                                                 20010020
200200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   20020020
200300                    - PV-TOP-ITEM + 1.                            20030020
200400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20040020
200500         CONTINUE                                                 20050020
200600     ELSE                                                         20060020
200700         SET DP030-SET-CURSOR-APPL-1                              20070020
200800                                   TO TRUE                        20080020
200900         MOVE -1                   TO MR-SELECTL (PV-SUB)         20090020
201000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         20100020
201100         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         20110020
201200     END-IF.                                                      20120020
201300*----------------------------------------------------------------*20130020
201400* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *20140020
201500* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *20150020
201600* FOR THE SELECTED ITEMS QUEUE.                                  *20160020
201700*                                                                *20170020
201800* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *20180020
201900* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *20190020
202000* THE ARRAY IS FULL.                                             *20200020
202100*----------------------------------------------------------------*20210020
202200 5000-PREPARE-SEL-QUEUE.                                          20220020
202300                                                                  20230020
202400     MOVE +1                   TO  ASC-BLK-SUB.                   20240020
202500     PERFORM 5100-WRITE-TEMP-STORAGE.                             20250020
202600     ADD +1                    TO  ASC-BLK-SUB.                   20260020
202700     PERFORM 5100-WRITE-TEMP-STORAGE.                             20270020
202800                                                                  20280020
202900     MOVE ASC-SEL-QUEUE-NAME   TO  CA-SEL-QUEUE-NAME.             20290020
203000     PERFORM 6010-DELETE-SEL-QUEUE.                               20300020
203100                                                                  20310020
203200     SET ASC-UPDATE-TSQ        TO  TRUE.                          20320020
203300                                                                  20330020
203400     SET FS002-IDX             TO  1.                             20340020
203500     MOVE ZERO                 TO CA-NUMBER-OF-TS-ITEMS.          20350020
203600     INITIALIZE FS002-SELECTED-ITEM-ARRAY.                        20360020
203700                                                                  20370020
203800     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           20380020
203900             VARYING PV-ITEM                                      20390020
204000             FROM 1 BY 1                                          20400020
204100             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     20410020
204200                                                                  20420020
204300     IF  FS002-IDX > 1                                            20430020
204400         PERFORM 5205-WRITE-SEL-QUEUE                             20440020
204500         ADD +1                TO CA-NUMBER-OF-TS-ITEMS           20450020
204600     END-IF.                                                      20460020
204700*----------------------------------------------------------------*20470020
204800*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *20480020
204900*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *20490020
205000*----------------------------------------------------------------*20500020
205100 5100-WRITE-TEMP-STORAGE.                                         20510020
205200     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     20520020
205300                                   TO PV-LIST-ITEM-NUMBER.        20530020
205400     COMPUTE PV-BLOCK-NUMBER =                                    20540020
205500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    20550020
205600                                                                  20560020
205700     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             20570020
205800     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             20580020
205900         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      20590020
206000             PERFORM 5105-REWRITE-ASC-LISTQ                       20600020
206100         END-IF                                                   20610020
206200     ELSE                                                         20620020
206300         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       20630020
206400         ASC-HIGHEST-BLOCK-WRITTEN + 1                            20640020
206500         PERFORM 5110-WRITE-ASC-LISTQ                             20650020
206600         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   20660020
206700     END-IF.                                                      20670020
206800                                                                  20680020
206900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             20690020
207000*----------------------------------------------------------------*20700020
207100*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *20710020
207200*  SPECIFIC COMMAREA.                                            *20720020
207300*----------------------------------------------------------------*20730020
207400 5105-REWRITE-ASC-LISTQ.                                          20740020
207500     EXEC CICS                                                    20750020
207600         WRITEQ TS                                                20760020
207700             QUEUE (ASC-LIST-QUEUE-NAME)                          20770020
207800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20780020
207900             ITEM  (PV-BLOCK-NUMBER)                              20790020
208000             REWRITE                                              20800020
208100             RESP  (PV-CICS-RESP)                                 20810020
208200     END-EXEC.                                                    20820020
208300                                                                  20830020
208400     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           20840020
208500         CONTINUE                                                 20850020
208600     ELSE                                                         20860020
208700         SET DP013-CICS-ABEND            TO TRUE                  20870020
208800         SET DP013-NO-ROLLBACK           TO TRUE                  20880020
208900         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       20890020
209000         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     20900020
209100                                         TO DP013-MESSAGE-TEXT(1) 20910020
209200         PERFORM DP013-0000-PROCESS-ABEND                         20920020
209300     END-IF.                                                      20930020
209400*----------------------------------------------------------------*20940020
209500*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *20950020
209600*  SPECIFIC COMMAREA.                                            *20960020
209700*----------------------------------------------------------------*20970020
209800 5110-WRITE-ASC-LISTQ.                                            20980020
209900     EXEC CICS                                                    20990020
210000         WRITEQ TS                                                21000020
210100             QUEUE (ASC-LIST-QUEUE-NAME)                          21010020
210200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21020020
210300             ITEM  (PV-BLOCK-NUMBER)                              21030020
210400             RESP  (PV-CICS-RESP)                                 21040020
210500     END-EXEC.                                                    21050020
210600     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      21060020
210700         SET DP013-CICS-ABEND      TO TRUE                        21070020
210800         SET DP013-NO-ROLLBACK     TO TRUE                        21080020
210900         MOVE '5110-WRITE-ASC-LISTQ'                              21090020
211000                                   TO DP013-PARAGRAPH             21100020
211100         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           21110020
211200                                   TO DP013-MESSAGE-TEXT(1)       21120020
211300         PERFORM DP013-0000-PROCESS-ABEND                         21130020
211400     END-IF.                                                      21140020
211500*----------------------------------------------------------------*21150020
211600* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *21160020
211700* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *21170020
211800*----------------------------------------------------------------*21180020
211900 5200-FILL-SEL-QUEUE-RECORD.                                      21190020
212000                                                                  21200020
212100     PERFORM 6112-READ-LIST-QUEUE.                                21210020
212200                                                                  21220020
212300     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       21230020
212400         PERFORM                                                  21240020
212500         VARYING LQW-IDX                                          21250020
212600         FROM 1 BY 1                                              21260020
212700         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            21270020
212800           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          21280020
212900                                                                  21290020
213000             IF  LQW-SELECT (LQW-IDX)                             21300020
213100                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              21310020
213200                                   TO FS002-ITEM (FS002-IDX)      21320020
213300                 MOVE LQW-DEPT-NUMBER (LQW-IDX)                   21330020
213400                                   TO FS002-DEPT-NMBR (FS002-IDX) 21340020
213500                 MOVE LQW-CLASS-NUMBER (LQW-IDX)                  21350020
213600                                   TO FS002-CLASS-NMBR (FS002-IDX)21360020
213700                 MOVE LQW-SKU (LQW-IDX)                           21370020
213800                                   TO FS002-SKU-NMBR (FS002-IDX)  21380020
213900                 MOVE ASC-KEY-STORE-NUMBER                        21390020
214000                                   TO FS002-STORE-NMBR (FS002-IDX)21400020
214100                 MOVE SPACE        TO FS002-ACTION-SW (FS002-IDX) 21410020
214200                 SET FS002-IDX UP BY 1                            21420020
214300                 IF  FS002-IDX > FS002-MAX-ITEMS                  21430020
214400                     PERFORM 5205-WRITE-SEL-QUEUE                 21440020
214500                     ADD +1        TO CA-NUMBER-OF-TS-ITEMS       21450020
214600                     INITIALIZE FS002-SELECTED-ITEM-ARRAY         21460020
214700                     SET FS002-IDX TO  1                          21470020
214800                 END-IF                                           21480020
214900             END-IF                                               21490020
215000         END-PERFORM                                              21500020
215100     END-IF.                                                      21510020
215200*----------------------------------------------------------------*21520020
215300*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *21530020
215400*----------------------------------------------------------------*21540020
215500 5205-WRITE-SEL-QUEUE.                                            21550020
215600                                                                  21560020
215700     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            21570020
215800                                   TO FS002-SELECTED-ITEMS.       21580020
215900                                                                  21590020
216000     EXEC CICS                                                    21600020
216100          WRITEQ TS                                               21610020
216200              QUEUE (ASC-SEL-QUEUE-NAME)                          21620020
216300              FROM  (FS002-TS-SEL-REC)                            21630020
216400              ITEM  (PV-SEL-QUEUE-ITEM)                           21640020
216500              RESP  (PV-CICS-RESP)                                21650020
216600     END-EXEC.                                                    21660020
216700                                                                  21670020
216800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          21680020
216900         CONTINUE                                                 21690020
217000     ELSE                                                         21700020
217100         SET DP013-CICS-ABEND      TO TRUE                        21710020
217200         SET DP013-NO-ROLLBACK     TO TRUE                        21720020
217300         MOVE '5205-WRITE-SEL-QUEUE'                              21730020
217400                                   TO DP013-PARAGRAPH             21740020
217500         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          21750020
217600                                   TO DP013-MESSAGE-TEXT(1)       21760020
217700         PERFORM DP013-0000-PROCESS-ABEND                         21770020
217800     END-IF.                                                      21780020
217900*----------------------------------------------------------------*21790020
218000*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *21800020
218100*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *21810020
218200*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *21820020
218300*  THE USER.                                                     *21830020
218400*----------------------------------------------------------------*21840020
218500 6000-REFRESH-PANEL-FROM-TEMP.                                    21850020
218600     IF  ASC-UPDATE-TSQ                                           21860020
218700         SET ASC-NO-TSQ-UPDATE TO TRUE                            21870020
218800         MOVE ZERO                 TO PV-SAVE-ITEM                21880020
218900                                      PV-SEL-QUEUE-ITEM           21890020
219000         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        21900020
219100                                   TO PV-HOLD-SELECTED-ITEMS      21910020
219200         PERFORM 6100-UPDATE-TSQ                                  21920020
219300             UNTIL PV-ITEMS-PROCESSED >                           21930020
219400                                     ASC-NUMBER-OF-SELECTED-ITEMS 21940020
219500         PERFORM 6010-DELETE-SEL-QUEUE                            21950020
219600         INITIALIZE ASC-BLOCK-ENTRIES (1)                         21960020
219700                    ASC-BLOCK-ENTRIES (2)                         21970020
219800         DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 21980020
219900             GIVING PV-BLOCK-NUMBER                               21990020
220000             REMAINDER  PV-REMAINDER                              22000020
220100         IF PV-REMAINDER > ZERO                                   22010020
220200             ADD +1        TO PV-BLOCK-NUMBER                     22020020
220300         END-IF                                                   22030020
220400         MOVE +1           TO ASC-BLK-SUB                         22040020
220500         PERFORM 4410-READ-TEMP-STORAGE                           22050020
220600         ADD +1            TO ASC-BLK-SUB                         22060020
220700                              PV-BLOCK-NUMBER                     22070020
220800         PERFORM 4410-READ-TEMP-STORAGE                           22080020
220900     END-IF.                                                      22090020
221000*----------------------------------------------------------------*22100020
221100*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *22110020
221200*----------------------------------------------------------------*22120020
221300 6010-DELETE-SEL-QUEUE.                                           22130020
221400                                                                  22140020
221500     EXEC CICS                                                    22150020
221600         DELETEQ TS                                               22160020
221700             QUEUE (ASC-SEL-QUEUE-NAME)                           22170020
221800             RESP  (PV-CICS-RESP)                                 22180020
221900     END-EXEC.                                                    22190020
222000*                                                                 22200020
222100     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      22210020
222200        (PV-CICS-RESP = DFHRESP(QIDERR)))                         22220020
222300         CONTINUE                                                 22230020
222400     ELSE                                                         22240020
222500         SET DP013-CICS-ABEND TO TRUE                             22250020
222600         SET DP013-NO-ROLLBACK TO TRUE                            22260020
222700         MOVE '6010-DELETE-SEL-QUEUE'                             22270020
222800                        TO DP013-PARAGRAPH                        22280020
222900         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         22290020
223000                        TO DP013-MESSAGE-TEXT (1)                 22300020
223100         PERFORM DP013-0000-PROCESS-ABEND                         22310020
223200     END-IF.                                                      22320020
223300*----------------------------------------------------------------*22330020
223400*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *22340020
223500*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *22350020
223600*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *22360020
223700*    THE TEMP QUEUE.                                             *22370020
223800*----------------------------------------------------------------*22380020
223900 6100-UPDATE-TSQ.                                                 22390020
224000                                                                  22400020
224100     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             22410020
224200     PERFORM 6105-READ-SEL-QUEUE.                                 22420020
224300     PERFORM                                                      22430020
224400         VARYING FS002-IDX                                        22440020
224500         FROM 1 BY 1                                              22450020
224600         UNTIL ((PV-ITEMS-PROCESSED >                             22460020
224700                              PV-HOLD-SELECTED-ITEMS)             22470020
224800         OR (FS002-IDX GREATER THAN FS002-MAX-ITEMS))             22480020
224900         IF  FS002-ACTION-SW (FS002-IDX) > SPACE                  22490020
225000             PERFORM 6110-PROCESS-ITEMS                           22500020
225100         END-IF                                                   22510020
225200         ADD +1                TO PV-ITEMS-PROCESSED              22520020
225300     END-PERFORM.                                                 22530020
225400     PERFORM 6111-WRITE-LIST-QUEUE.                               22540020
225500*----------------------------------------------------------------*22550020
225600*    READ THE LIST QUEUE RECORD.                                 *22560020
225700*----------------------------------------------------------------*22570020
225800 6105-READ-SEL-QUEUE.                                             22580020
225900                                                                  22590020
226000     EXEC CICS                                                    22600020
226100          READQ TS                                                22610020
226200              QUEUE (ASC-SEL-QUEUE-NAME)                          22620020
226300              INTO  (FS002-TS-SEL-REC)                            22630020
226400              ITEM  (PV-SEL-QUEUE-ITEM)                           22640020
226500              RESP  (PV-CICS-RESP)                                22650020
226600     END-EXEC.                                                    22660020
226700*                                                                 22670020
226800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22680020
226900         CONTINUE                                                 22690020
227000     ELSE                                                         22700020
227100         SET DP013-CICS-ABEND      TO  TRUE                       22710020
227200         SET DP013-NO-ROLLBACK     TO  TRUE                       22720020
227300         MOVE '6105-READ-SEL-QUEUE'                               22730020
227400                                   TO  DP013-PARAGRAPH            22740020
227500         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           22750020
227600                                   TO  DP013-MESSAGE-TEXT(1)      22760020
227700         PERFORM DP013-0000-PROCESS-ABEND                         22770020
227800     END-IF.                                                      22780020
227900*----------------------------------------------------------------*22790020
228000*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*22800020
228100*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*22810020
228200*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *22820020
228300*----------------------------------------------------------------*22830020
228400 6110-PROCESS-ITEMS.                                              22840020
228500                                                                  22850020
228600     COMPUTE PV-ITEM = 1 + ((FS002-ITEM (FS002-IDX) - 1)          22860020
228700                     / PC-ITEMS-PER-PANEL).                       22870020
228800                                                                  22880020
228900     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           22890020
229000         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          22900020
229100             PERFORM 6111-WRITE-LIST-QUEUE                        22910020
229200         END-IF                                                   22920020
229300         MOVE PV-ITEM          TO PV-SAVE-ITEM                    22930020
229400                                                                  22940020
229500         PERFORM 6112-READ-LIST-QUEUE                             22950020
229600         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               22960020
229700             CONTINUE                                             22970020
229800         END-IF                                                   22980020
229900     END-IF.                                                      22990020
230000                                                                  23000020
230100     COMPUTE PV-SUB = (FS002-ITEM (FS002-IDX)                     23010020
230200                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              23020020
230300     SET LQW-DESELECT (PV-SUB) TO    TRUE                         23030020
230400     MOVE LQW-SELECTED-SW (PV-SUB)                                23040020
230500                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  23050020
230600     EVALUATE TRUE                                                23060020
230700         WHEN FS002-INQ (FS002-IDX)                               23070020
230800              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             23080020
230900                                                                  23090020
231000         WHEN FS002-UPD (FS002-IDX)                               23100020
231100              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             23110020
231200                                                                  23120020
231300         WHEN FS002-DEL (FS002-IDX)                               23130020
231400              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             23140020
231500                                                                  23150020
231600         WHEN FS002-ERR (FS002-IDX)                               23160020
231700              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             23170020
231800     END-EVALUATE.                                                23180020
231900                                                                  23190020
232000     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                23200020
232100*----------------------------------------------------------------*23210020
232200*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *23220020
232300*----------------------------------------------------------------*23230020
232400 6111-WRITE-LIST-QUEUE.                                           23240020
232500                                                                  23250020
232600     EXEC CICS                                                    23260020
232700         WRITEQ TS                                                23270020
232800             QUEUE (ASC-LIST-QUEUE-NAME)                          23280020
232900             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     23290020
233000             ITEM  (PV-SAVE-ITEM)                                 23300020
233100             REWRITE                                              23310020
233200             RESP  (PV-CICS-RESP)                                 23320020
233300     END-EXEC.                                                    23330020
233400*                                                                 23340020
233500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23350020
233600         CONTINUE                                                 23360020
233700     ELSE                                                         23370020
233800         SET DP013-CICS-ABEND  TO  TRUE                           23380020
233900         SET DP013-NO-ROLLBACK TO  TRUE                           23390020
234000         MOVE '6111-WRITE-LIST-QUEUE'                             23400020
234100                               TO  DP013-PARAGRAPH                23410020
234200         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  23420020
234300                               TO  DP013-MESSAGE-TEXT(1)          23430020
234400         PERFORM DP013-0000-PROCESS-ABEND                         23440020
234500     END-IF.                                                      23450020
234600*----------------------------------------------------------------*23460020
234700*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*23470020
234800*----------------------------------------------------------------*23480020
234900 6112-READ-LIST-QUEUE.                                            23490020
235000                                                                  23500020
235100     EXEC CICS                                                    23510020
235200         READQ TS                                                 23520020
235300             QUEUE (ASC-LIST-QUEUE-NAME)                          23530020
235400             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     23540020
235500             ITEM  (PV-ITEM)                                      23550020
235600             RESP  (PV-CICS-RESP)                                 23560020
235700     END-EXEC.                                                    23570020
235800*                                                                 23580020
235900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23590020
236000         CONTINUE                                                 23600020
236100     ELSE                                                         23610020
236200         SET DP013-CICS-ABEND        TO TRUE                      23620020
236300         SET DP013-NO-ROLLBACK       TO TRUE                      23630020
236400         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           23640020
236500         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    23650020
236600                                     TO DP013-MESSAGE-TEXT(1)     23660020
236700         PERFORM DP013-0000-PROCESS-ABEND                         23670020
236800     END-IF.                                                      23680020
236900*----------------------------------------------------------------*23690020
237000*    ABEND PROCESSOR MODULE                                      *23700020
237100*----------------------------------------------------------------*23710020
237200     COPY DPPD013.                                                23720020
