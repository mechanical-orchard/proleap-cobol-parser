000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.    TRKUP091.                                         00050000
000600 AUTHOR.        DENISE HAHN.                                      00060000
000700 INSTALLATION.  KOHLS.                                            00070000
000800 DATE-WRITTEN   JANUARY 2021                                      00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  THIS PROGRAM IS USED TO INBOUND TRIPS THAT ARE NOT IN A        00120001
001210*  'DE','DP','ET' STATUS > X DAYS AND HAVE NO SHIPMENTS ATTACHED. 00121001
001300*  INPUT FILE CREATED BY TRKUT091 CONTAINING THE TRIPS THAT NEED  00130001
001400*  TO BE DELETED.                                                 00140001
001420*                                                                 00142000
001421*  THIS PROGRAM WILL TAKE THE TRIP FILE AND CREATE                00142101
001422*  DE (DELETED) & ET (END TRIP) INSERT SQL STATEMENTS FOR         00142201
001423*  TTRIPST.                                                       00142301
001424*                                                                 00142400
001425*  TVEHICL WILL ALSO BE CLEANED UP.                               00142501
001426******************************************************************00142601
001427******************************************************************00142701
001428 ENVIRONMENT DIVISION.                                            00142801
001429******************************************************************00142901
001430                                                                  00143001
001431 CONFIGURATION SECTION.                                           00143101
001440                                                                  00144000
001450 SOURCE-COMPUTER.        IBM-3090.                                00145000
001460 OBJECT-COMPUTER.        IBM-3090.                                00146000
001470                                                                  00147000
001480 INPUT-OUTPUT SECTION.                                            00148000
001490                                                                  00149000
001500 FILE-CONTROL.                                                    00150000
001600                                                                  00160000
001700     SELECT TRIP-FILE                                             00170000
001800         ASSIGN TO INP01.                                         00180000
001900                                                                  00190000
002300******************************************************************00230000
002400 DATA DIVISION.                                                   00240000
002500******************************************************************00250000
002600                                                                  00260000
002700 FILE SECTION.                                                    00270000
002800                                                                  00280000
002900 FD  TRIP-FILE                                                    00290000
003000     RECORDING MODE IS F                                          00300000
003100     LABEL RECORDS ARE STANDARD                                   00310000
003200     BLOCK CONTAINS 0 RECORDS.                                    00320000
003300*                                                                 00330000
003400 01  TRIP-RECORD.                                                 00340000
003500     05  FILLER                  PIC X(125).                      00350000
003600                                                                  00360000
004600*                                                                 00460000
004700******************************************************************00470000
004800 WORKING-STORAGE SECTION.                                         00480000
004900******************************************************************00490000
005000*                                                                 00500000
005100******************************************************************00510000
005200*  TRIP FILE                                                      00520000
005300******************************************************************00530000
005400     COPY TRRD074.                                                00540000
005500*                                                                 00550000
006100*                                                                 00610000
006200 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00620000
006300                                                   COMP SYNC.     00630000
006400                                                                  00640000
006500 01  PC-PROGRAM-CONSTANTS.                                        00650000
006600     05  PC-TRKUP091                 PIC X(08) VALUE 'TRKUP091'.  00660000
006610                                                                  00661000
006620 01  PS-PROGRAM-SWITCHES.                                         00662000
006630     05  PS-EOF-TRIP-SW              PIC  X(01)    VALUE 'N'.     00663000
006640         88  PS-EOF-TRIP                           VALUE 'Y'.     00664000
006650         88  PS-MORE-TRIP                          VALUE 'N'.     00665000
006690                                                                  00669000
006700 01  DK-DB2-KEYS.                                                 00670000
006800     05  DK-TRIP-ID                  PIC  S9(9) COMP VALUE ZEROES.00680000
006900                                                                  00690000
007000 01  PROGRAM-VARIABLES.                                           00700000
007100     05  PV-DISP-OPER-UNT            PIC  9(04).                  00710000
007110     05  PV-DISP-TRIP-ID             PIC  9(09).                  00711000
007130     05  PV-TRIP-COUNT               PIC  9(09).                  00713004
007140     05  PV-TTRIPST-CNT              PIC  9(09).                  00714000
007142     05  PV-COMMIT-CNT               PIC  9(09).                  00714200
007144                                                                  00714405
007145     05  PV-NULL-IND-1               PIC S9(04)  VALUE ZEROS      00714500
007146                                                 COMP SYNC.       00714600
007147     05  PV-NULL-IND-2               PIC S9(04)  VALUE ZEROS      00714700
007148                                                 COMP SYNC.       00714800
007149     05  PV-DISP-TRIP                PIC  Z(10)  VALUE ZEROS.     00714900
007150     05  PV-DISP-OPER                PIC  Z(03)  VALUE ZERO.      00715000
007160                                                                  00716000
007170     05  PV-ITEM-NBR                 PIC  9(15)    VALUE ZERO.    00717000
007190     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  00719000
007200     05  PV-VEHICL-COUNT             PIC S9(09)    VALUE ZERO.    00720000
007202     05  PV-READ-COUNTER             PIC S9(09)    VALUE ZERO     00720200
007203                                                   COMP SYNC.     00720300
007204     05  PV-WRITE-COUNTER            PIC S9(09)    VALUE ZERO     00720400
007205                                                   COMP SYNC.     00720500
007206     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             00720600
007207                                                                  00720700
007208     05  PV-DB2-COUNT                PIC S9(09)    VALUE ZERO     00720800
007209                                                   COMP-3.        00720900
007210     05  PV-TMST-HOLD                PIC X(26).                   00721000
007211     05  PV-TMST-HOLD-R REDEFINES PV-TMST-HOLD.                   00721100
007212         10  PV-TMST-DATE            PIC X(10).                   00721200
007213         10  PV-TMST-TIME            PIC X(16).                   00721300
007214             88 PV-DE-TIME      VALUE '-00.01.00.000000'.         00721402
007215             88 PV-ET-TIME      VALUE '-00.02.00.000000'.         00721500
007216                                                                  00721600
007217 01  PV-ABEND-FIELDS.                                             00721700
007218     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'TRKUP091'.00721800
007219     05  PV-ABEND-CODE               PIC S9(04)  VALUE +0         00721900
007220                                                 COMP SYNC.       00722000
007221     05  PV-PARAGRAPH-NAME           PIC  X(30)  VALUE SPACES.    00722100
007222     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)  VALUE SPACES.    00722200
007223     05  PV-ABEND-PARAGRAPH          PIC  X(30)  VALUE SPACES.    00722300
007224     05  PV-ABEND-OPERATION          PIC  X(30)  VALUE SPACES.    00722400
007225     05  PV-DB2-OPER-ATTEMPTED       PIC  X(30)  VALUE SPACES.    00722500
007226     05  PV-DB2-OPERATION-MESSAGE-1  PIC  X(79)  VALUE SPACES.    00722600
007227     05  PV-DB2-OPERATION-MESSAGE-2  PIC  X(79)  VALUE SPACES.    00722700
007228     05  PV-DB2-OPERATION-MESSAGE-3  PIC  X(79)  VALUE SPACES.    00722800
007229     05  PV-DB2-OPERATION-MESSAGE-4  PIC  X(79)  VALUE SPACES.    00722900
007230     05  PV-SQLCODE                  PIC -Z(03)  VALUE ZERO.      00723000
007232                                                                  00723200
007233                                                                  00723300
007234***************************************************************** 00723400
007235*    SQL ABEND ROUTINE WORKING STORAGE                          * 00723500
007236***************************************************************** 00723600
007237     COPY DPWS004.                                                00723700
007238                                                                  00723800
007239                                                                  00723903
007240***************************************************************** 00724003
007241*                                                               * 00724103
007242***************************************************************** 00724203
007243     EXEC SQL                                                     00724303
007244        INCLUDE TTRIPST                                           00724403
007250     END-EXEC.                                                    00725000
007260                                                                  00726000
007270                                                                  00727003
007280***************************************************************** 00728003
007290*                                                               * 00729003
007300***************************************************************** 00730003
007310     EXEC SQL                                                     00731003
007320        INCLUDE TVEHICL                                           00732003
007330     END-EXEC.                                                    00733003
007340                                                                  00734003
007350                                                                  00735003
007400***************************************************************** 00740000
007500*   DB2 SQL COMMUNICATION AREA                                  * 00750000
007600***************************************************************** 00760000
007700     EXEC SQL                                                     00770000
007800          INCLUDE SQLCA                                           00780000
007900     END-EXEC.                                                    00790000
008000                                                                  00800000
008100                                                                  00810000
008200******************************************************************00820000
008300 PROCEDURE DIVISION.                                              00830000
008400******************************************************************00840000
008500                                                                  00850000
008600 0000-PROGRAM-MAINLINE.                                           00860000
008700******************************************************************00870000
008800* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     00880000
008900*      PROGRAM.                                                   00890000
009000******************************************************************00900000
009001                                                                  00900109
009010     DISPLAY '************************************************'   00901009
009020     DISPLAY '** TRKUP091'                                        00902009
009030     DISPLAY '** '                                                00903009
009100                                                                  00910000
009200     PERFORM 1000-INITIALIZE.                                     00920000
009300                                                                  00930000
009400     IF PS-MORE-TRIP                                              00940000
009500         PERFORM 2000-PROCESS-TRIP                                00950000
009600            UNTIL PS-EOF-TRIP                                     00960000
009700     END-IF.                                                      00970000
009800                                                                  00980000
010600     PERFORM 9000-EOJ-ROUTINE.                                    01060000
010700                                                                  01070000
010800     STOP RUN.                                                    01080000
010900                                                                  01090000
010910 1000-INITIALIZE.                                                 01091000
010920******************************************************************01092000
010930*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    01093000
010940*    -- OPEN FILES                                                01094000
010950******************************************************************01095000
010960                                                                  01096000
010970     OPEN INPUT TRIP-FILE.                                        01097001
010990                                                                  01099000
011000 2000-PROCESS-TRIP.                                               01100000
011100******************************************************************01110000
011200*  PROCESS THE TRIP FILE.                                         01120000
011300******************************************************************01130000
011400                                                                  01140000
011500     PERFORM 8000-READ-TRIP.                                      01150000
011600                                                                  01160000
011700     IF PS-EOF-TRIP                                               01170000
011800         CONTINUE                                                 01180000
011900     ELSE                                                         01190000
012100         MOVE TR074-TRIP-ID        TO TRIPST-TRIP-ID              01210005
012200         MOVE 'DE'                 TO TRIPST-TRIP-STATUS-CDE      01220005
012300         MOVE TR074-NEW-STATUS-DTE TO TRIPST-STATUS-DTE           01230005
012310         MOVE '00:01:00'           TO TRIPST-STATUS-TME           01231005
012320         MOVE PC-TRKUP091          TO TRIPST-STATUS-UID           01232005
012330         MOVE TR074-OPER-UNT-ID    TO TRIPST-OPER-UNT-ID          01233005
012340         MOVE 1                    TO TRIPST-FCLTY-ID             01234005
012350         MOVE SPACES               TO TRIPST-FCLTY-AREA-ID        01235005
012360         MOVE TR074-NEW-STATUS-DTE TO PV-TMST-DATE                01236005
012370         SET  PV-DE-TIME           TO TRUE                        01237005
012380         MOVE PV-TMST-HOLD         TO TRIPST-CRE-TMST             01238005
012390                                                                  01239000
012400         PERFORM 8200-INSERT-TTRIPST                              01240005
012500                                                                  01250001
012600         MOVE TR074-TRIP-ID        TO TRIPST-TRIP-ID              01260005
012700         MOVE 'ET'                 TO TRIPST-TRIP-STATUS-CDE      01270005
012800         MOVE TR074-NEW-STATUS-DTE TO TRIPST-STATUS-DTE           01280005
012900         MOVE '00:02:00'           TO TRIPST-STATUS-TME           01290005
013000         MOVE PC-TRKUP091          TO TRIPST-STATUS-UID           01300005
013100         MOVE TR074-OPER-UNT-ID    TO TRIPST-OPER-UNT-ID          01310005
013200         MOVE 1                    TO TRIPST-FCLTY-ID             01320005
013210         MOVE SPACES               TO TRIPST-FCLTY-AREA-ID        01321005
013220         MOVE TR074-NEW-STATUS-DTE TO PV-TMST-DATE                01322005
013230         SET  PV-ET-TIME           TO TRUE                        01323005
013240         MOVE PV-TMST-HOLD         TO TRIPST-CRE-TMST             01324005
013241                                                                  01324100
013242         PERFORM 8200-INSERT-TTRIPST                              01324205
013243                                                                  01324300
013265         PERFORM 8300-UPDATE-TVEHICL                              01326505
013266                                                                  01326600
013269     END-IF.                                                      01326900
013270                                                                  01327000
013280     IF  PV-COMMIT-CNT > 49                                       01328002
013290         PERFORM 8500-COMMIT                                      01329000
013300         MOVE ZEROES TO PV-COMMIT-CNT                             01330000
013310     END-IF.                                                      01331000
013320                                                                  01332000
013321                                                                  01332102
013322******************************************************************01332202
013323*  READ THE TRIP DATA                                             01332302
013324******************************************************************01332402
013325 8000-READ-TRIP.                                                  01332502
013326                                                                  01332602
013330     READ TRIP-FILE                                               01333002
013331          INTO  TR074-RECORD                                      01333102
013332          AT END                                                  01333202
013333             SET PS-EOF-TRIP TO TRUE.                             01333302
013334                                                                  01333402
013335     IF  PS-EOF-TRIP                                              01333502
013336         DISPLAY ' '                                              01333602
013337         CONTINUE                                                 01333702
013338     ELSE                                                         01333802
013339         ADD +1 TO PV-TRIP-COUNT                                  01333902
013340                                                                  01334002
013341         MOVE TR074-TRIP-ID     TO PV-DISP-TRIP-ID                01334102
013342         MOVE TR074-OPER-UNT-ID TO PV-DISP-OPER-UNT               01334202
013343         DISPLAY  'TTRIPST: '                                     01334302
013344                  TR074-OWNER-SCAC-ID   '/'                       01334402
013345                  TR074-VEH-NBR         ' '                       01334502
013346                  PV-DISP-TRIP-ID       ' '                       01334602
013347                  TR074-TRIP-STATUS-CDE ' '                       01334702
013348                  TR074-TRIP-STATUS-DTE ' '                       01334802
013349                  TR074-TRIP-STATUS-TME ' '                       01334902
013350                  TR074-TRIP-STATUS-UID ' '                       01335002
013351                  PV-DISP-OPER-UNT                                01335102
013352     END-IF.                                                      01335202
013353                                                                  01335302
013360                                                                  01336000
015102******************************************************************01510200
015103* TTRIPST INSERTS                                                 01510300
015104******************************************************************01510400
015105 8200-INSERT-TTRIPST.                                             01510500
015106                                                                  01510600
015107     EXEC SQL                                                     01510700
015108          INSERT                                                  01510800
015109            INTO TTRIPST                                          01510910
015110                ( TRIP_ID                                         01511000
015120                , TRIP_STATUS_CDE                                 01512000
015130                , STATUS_DTE                                      01513000
015140                , STATUS_TME                                      01514000
015150                , STATUS_UID                                      01515000
015160                , OPER_UNT_ID                                     01516000
015170                , FCLTY_ID                                        01517000
015180                , FCLTY_AREA_ID                                   01518000
015190                , CRE_TMST)                                       01519000
015200          VALUES                                                  01520000
015300                (:TRIPST-TRIP-ID                                  01530000
015400                ,:TRIPST-TRIP-STATUS-CDE                          01540000
015500                ,:TRIPST-STATUS-DTE                               01550000
015600                ,:TRIPST-STATUS-TME                               01560000
015700                ,:TRIPST-STATUS-UID                               01570000
015800                ,:TRIPST-OPER-UNT-ID                              01580000
015900                ,:TRIPST-FCLTY-ID                                 01590000
016000                ,:TRIPST-FCLTY-AREA-ID                            01600000
016100                , CURRENT TIMESTAMP                               01610000
016200                )                                                 01620000
016300     END-EXEC.                                                    01630000
016400                                                                  01640000
016500     EVALUATE TRUE                                                01650000
016600         WHEN SQLCODE = ZERO                                      01660000
016700         WHEN SQLCODE = -803                                      01670000
016800              ADD +1 TO PV-TTRIPST-CNT                            01680000
017000                                                                  01700000
017100         WHEN OTHER                                               01710000
017110              STRING  VEHICL-OWNER-SCAC-ID '-'                    01711007
017120                      VEHICL-VEH-NBR                              01712007
017121                      '  TRIP STATUS: '                           01712108
017122                     TRIPST-TRIP-STATUS-CDE DELIMITED BY SIZE     01712207
017130                               INTO PV-DB2-OPERATION-MESSAGE-1    01713007
017200             MOVE '8200-WRITE-TTRIPST-SQL'                        01720000
017300                                       TO PV-PARAGRAPH-NAME       01730007
017400             MOVE 'INSERT TTRIPST'     TO PV-ABEND-OPERATION      01740000
017500             PERFORM 9900-DB2-ABEND                               01750000
017600     END-EVALUATE.                                                01760000
017700                                                                  01770000
017800                                                                  01780000
017900                                                                  01790000
017901******************************************************************01790102
017902*                                                                *01790202
017903******************************************************************01790302
017910 8300-UPDATE-TVEHICL.                                             01791002
018000                                                                  01800000
018010     MOVE TR074-OWNER-SCAC-ID TO VEHICL-OWNER-SCAC-ID             01801007
018011     MOVE TR074-VEH-NBR       TO VEHICL-VEH-NBR                   01801107
018013     MOVE 'TRKUP091'          TO VEHICL-LAST-UPD-UID              01801302
018020     MOVE 'ET'                TO VEHICL-CURR-STATUS-CDE           01802002
018030     MOVE SPACES              TO VEHICL-USAGE-CDE                 01803002
018090                                                                  01809002
018091     EXEC SQL                                                     01809102
018092         UPDATE TVEHICL                                           01809210
018093            SET LAST_UPD_DTE     =  CURRENT DATE                  01809302
018094               ,LAST_UPD_TME     =  CURRENT TIME                  01809402
018095               ,LAST_UPD_UID     = :VEHICL-LAST-UPD-UID           01809502
018096               ,CURR_STATUS_DTE  =  CURRENT DATE                  01809602
018097               ,CURR_STATUS_TME  =  CURRENT TIME                  01809702
018098               ,CURR_STATUS_CDE  = :VEHICL-CURR-STATUS-CDE        01809802
018099               ,USAGE_CDE        = :VEHICL-USAGE-CDE              01809902
018100               ,CURR_TRIP_ID     =  NULL                          01810002
018110         WHERE VEH_NBR           = :VEHICL-VEH-NBR                01811002
018120           AND OWNER_SCAC_ID     = :VEHICL-OWNER-SCAC-ID          01812002
018130     END-EXEC                                                     01813002
018140                                                                  01814002
018150     EVALUATE TRUE                                                01815002
018160         WHEN SQLCODE = +0                                        01816002
018170              ADD 1  TO  PV-COMMIT-CNT                            01817002
018191         WHEN OTHER                                               01819102
018192              DISPLAY 'VEHICLE NUMBER ' VEHICL-VEH-NBR            01819207
018193              DISPLAY 'SCAC ID ' VEHICL-OWNER-SCAC-ID             01819305
018194              STRING  VEHICL-OWNER-SCAC-ID '-'                    01819407
018195                      VEHICL-VEH-NBR        DELIMITED BY SIZE     01819507
018196                               INTO PV-DB2-OPERATION-MESSAGE-1    01819607
018197              MOVE '7000-UPDATE-TVEHICL  ' TO PV-PARAGRAPH-NAME   01819705
018198              MOVE 'UPDATE TVEHICL TABLE' TO PV-DB2-OPER-ATTEMPTED01819805
018199              PERFORM 9900-DB2-ABEND                              01819905
018200     END-EVALUATE.                                                01820002
018210                                                                  01821002
018300                                                                  01830002
020525******************************************************************02052500
020526*  COMMIT                                                         02052600
020527******************************************************************02052700
020528 8500-COMMIT.                                                     02052800
020529                                                                  02052900
020530     EXEC SQL                                                     02053000
020531         COMMIT                                                   02053100
020532     END-EXEC.                                                    02053200
020533                                                                  02053300
020534     DISPLAY ' '.                                                 02053400
020535     DISPLAY 'COMMIT'                                             02053500
020536     DISPLAY ' '.                                                 02053600
020537                                                                  02053700
020538                                                                  02053800
020539******************************************************************02053900
020540*  CLOSE OUTPUT FILE.                                             02054000
020541******************************************************************02054100
020542 9000-EOJ-ROUTINE.                                                02054200
020543     CLOSE TRIP-FILE.                                             02054305
020545                                                                  02054500
020546     DISPLAY 'TRKUP091 COUNTS'.                                   02054600
020547     DISPLAY ' '.                                                 02054700
020548     MOVE PV-TRIP-COUNT           TO PV-DISPLAY-COUNT             02054800
020549     DISPLAY 'TOTAL TRIP CNT:   '    PV-DISPLAY-COUNT.            02054900
020550     MOVE PV-TTRIPST-CNT          TO PV-DISPLAY-COUNT             02055000
020560     DISPLAY 'TTRIPST INSERTS:  '    PV-DISPLAY-COUNT.            02056000
020570     DISPLAY ' '.                                                 02057000
020580                                                                  02058000
021000                                                                  02100000
021100***********************************************************       02110000
021200*                                                         *       02120000
021300***********************************************************       02130000
021400 9900-DB2-ABEND.                                                  02140000
021500                                                                  02150000
021600     MOVE SQLCODE TO PV-SQLCODE.                                  02160000
021700     DISPLAY '*** DB2 ERROR '.                                    02170000
021800     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       02180000
021900     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 02190000
022000     DISPLAY '*** PARAGRAPH = ' PV-PARAGRAPH-NAME.                02200008
022100     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               02210000
022200     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       02220000
022300     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       02230000
022400     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       02240000
022500                                                                  02250000
022600     COPY DPPD004.                                                02260000
022700                                                                  02270000
022800     IF SQLCODE NOT = -911                                        02280000
022900         EXEC SQL                                                 02290000
023000              ROLLBACK                                            02300000
023100         END-EXEC                                                 02310000
023200     END-IF.                                                      02320000
023300                                                                  02330000
023400     MOVE +4013                  TO PV-ABEND-CODE.                02340000
023500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02350000
023600                                                                  02360000
