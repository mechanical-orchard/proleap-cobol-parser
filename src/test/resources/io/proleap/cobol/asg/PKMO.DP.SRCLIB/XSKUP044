000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.    XSKUP044.                                         00020001
000300 AUTHOR.        BARB ERTL.                                        00030001
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040001
000500 DATE-WRITTEN.  10/29/2002.                                       00050001
000600 DATE-COMPILED.                                                   00060001
000700******************************************************************00070001
000800**      WH MESSAGE TO POPULATE XST_LOC AND XST_LOC_ATTR TABLES    00080006
000900******************************************************************00090001
001000**THIS IS A CALLED MODULE FOR LOCATION TABLES.  THIS PROGRAM      00100001
001100**     WILL PERFORM UPDATES/INSERTS/DELETES FOR THE XST_LOC       00110001
001200**     TABLE.                                                     00120001
001300**     IT DOES THE FOLLOWING WITH THESE RETURN CODES:             00130001
001400**     0000 - END PROGRAM                                         00140001
001500**    -0530 - END PROGRAM                                         00150001
001600**    -0803 - END PROGRAM                                         00160001
001700**    -0911 - RETRY INSERT UP TO 5 TIMES AND THEN END PROGRAM     00170001
001800******************************************************************00180001
001900 ENVIRONMENT DIVISION.                                            00190001
002000 CONFIGURATION SECTION.                                           00200001
002100 SOURCE-COMPUTER.  IBM-3090.                                      00210001
002200 OBJECT-COMPUTER.  IBM-3090.                                      00220001
002300 DATA DIVISION.                                                   00230001
002400                                                                  00240001
002500 WORKING-STORAGE SECTION.                                         00250001
002600******************************************************************00260001
002700**PROGRAM SWITCHES                                                00270001
002800******************************************************************00280001
002900 01  PS-PROGRAM-SWITCHES.                                         00290001
003000     05  PS-PROCESS-CONTINUE-SW      PIC X(01)  VALUE 'Y'.        00300001
003100         88  PS-PROCESS-CONTINUE                VALUE 'Y'.        00310001
003200         88  PS-PROCESS-COMPLETE                VALUE 'N'.        00320001
003300******************************************************************00330001
003400**PROGRAM CONSTANTS                                               00340001
003500******************************************************************00350001
003600 01  PC-PROGRAM-CONSTANTS.                                        00360001
003700     05  PC-RETRY-MAX              PIC 9(01)  VALUE 5.            00370004
003800     05  PC-DIST-CTR               PIC X(02)  VALUE 'DC'.         00380004
003900     05  PC-DEFAULT-DATE           PIC X(10)  VALUE '9999-09-09'. 00390004
004000******************************************************************00400001
004100**PROGRAM VARIABLES                                               00410001
004200******************************************************************00420001
004300 01  PV-PROGRAM-VARIABLES.                                        00430001
004400     05  PV-RETRY-COUNTER               PIC  9(01)  VALUE ZEROS.  00440001
004500******************************************************************00450001
004600**COPYBOOKS                                                       00460001
004700******************************************************************00470001
004800***DB2 MESSAGE AREA                                               00480001
004900     COPY SQLCA2.                                                 00490008
005000***MESSAGE COPYBOOK                                               00500001
005100     COPY HORD100.                                                00510008
005200******************************************************************00520001
005300**TABLE INCLUSIONS                                                00530001
005400******************************************************************00540001
005500***DB2 COMMUNICATIONS AREA                                        00550001
005600     EXEC SQL                                                     00560001
005700          INCLUDE SQLCA                                           00570001
005800     END-EXEC.                                                    00580001
005900* ------------------------------------------------------------- * 00590001
006000*  SQL AND COBOL DECLARATIONS FOR LOCATION TABLE (XST_LOC)        00600001
006100* ------------------------------------------------------------- * 00610001
006200     EXEC SQL                                                     00620001
006300         INCLUDE XST00001                                         00630001
006400     END-EXEC.                                                    00640001
006500                                                                  00650001
006600* ------------------------------------------------------------- * 00660006
006700*  SQL AND COBOL DECLARATIONS FOR LOCATION ATTRIBUTE TABLE        00670006
006800*  (XST_LOC_ATTR)                                                 00680006
006900* ------------------------------------------------------------- * 00690006
007000     EXEC SQL                                                     00700006
007100         INCLUDE XST00025                                         00710006
007200     END-EXEC.                                                    00720006
007300                                                                  00730006
007400 LINKAGE SECTION.                                                 00740001
007500******************************************************************00750001
007600**LINKAGE VARIABLES                                               00760001
007700******************************************************************00770001
007800 01  LV-LINKAGE-VARIABLES.                                        00780002
007900     05  LV-HORD100-RECORD               PIC X(500).              00790002
008000     05  LV-RETURN-CODE                  PIC S9(04).              00800002
008100                                                                  00810002
008200 PROCEDURE DIVISION USING LV-LINKAGE-VARIABLES.                   00820002
008300******************************************************************00830001
008400 0000-MAINLINE.                                                   00840001
008500                                                                  00850001
008600      PERFORM 1000-INITIALIZATION.                                00860001
008700      PERFORM 2000-PROCESS-MESSAGE.                               00870001
008800      PERFORM 9999-WRAPUP.                                        00880001
008900                                                                  00890001
009000***************************************************************** 00900001
009100**INITIALIZATION AREA - ALL MOVES TO UPDATE/INSERT                00910001
009200***************************************************************** 00920001
009300 1000-INITIALIZATION.                                             00930001
009400                                                                  00940001
009500     INITIALIZE PV-RETRY-COUNTER.                                 00950001
009600     SET PS-PROCESS-CONTINUE TO TRUE.                             00960007
009700                                                                  00970001
009800     MOVE LV-HORD100-RECORD          TO HORD100-RECORD.           00980001
009900                                                                  00990001
010000     INITIALIZE DCLXST00001.                                      01000001
010100                                                                  01010001
010200     MOVE HO100-WH                  TO XST00001-LOC-NBR           01020006
010300                                       XST00025-LOC-NBR.          01030006
010400     MOVE PC-DIST-CTR               TO XST00001-LOC-TYP-CDE.      01040001
010500     MOVE HO100-WH-NAME             TO XST00001-LOC-NM.           01050001
010600     MOVE HO100-WH-ADD1             TO XST00001-LNE-1-ADDR.       01060001
010700     MOVE HO100-WH-ADD2             TO XST00001-LNE-2-ADDR.       01070001
010800     MOVE HO100-WH-CITY             TO XST00001-CTY-NM.           01080001
010900     MOVE HO100-WH-STATE-1-2        TO XST00001-ST-CDE.           01090001
011000     MOVE HO100-WH-PCODE            TO XST00001-ZIP-10-CDE.       01100001
011100     MOVE PC-DEFAULT-DATE           TO XST00001-OPN-DTE           01110004
011200                                       XST00001-CLO-DTE.          01120004
011300                                                                  01130001
011400***************************************************************** 01140001
011500**MAIN PROGRAM LOGIC - READS ACTION TYPE ON HORD100 RECORD        01150001
011600***************************************************************** 01160001
011700 2000-PROCESS-MESSAGE.                                            01170001
011800                                                                  01180001
011900     EVALUATE TRUE                                                01190001
012000        WHEN HO100-ACTN-TYP-INSERT                                01200001
012100             PERFORM 2100-INSERT-DATA                             01210001
012200             PERFORM 2400-INSERT-LOC-ATTR                         01220006
012300                                                                  01230001
012400        WHEN HO100-ACTN-TYP-UPDATE                                01240001
012500             PERFORM 2200-UPDATE-DATA                             01250001
012600                                                                  01260001
012700        WHEN HO100-ACTN-TYP-DELETE                                01270001
012800            PERFORM 2300-DELETE-DATA                              01280001
012900     END-EVALUATE.                                                01290001
013000                                                                  01300001
013100***************************************************************** 01310001
013200**INSERT ACTION TYPE                                              01320001
013300***************************************************************** 01330001
013400 2100-INSERT-DATA.                                                01340001
013500                                                                  01350001
013600     PERFORM                                                      01360001
013700         WITH TEST AFTER                                          01370001
013800         VARYING PV-RETRY-COUNTER                                 01380001
013900         FROM 1 BY 1                                              01390001
014000         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    01400001
014100            OR SQLCODE = 0                                        01410001
014200            OR PS-PROCESS-COMPLETE                                01420001
014300                                                                  01430001
014400        EXEC SQL                                                  01440001
014500          INSERT INTO XST_LOC                                     01450001
014600              (LOC_NBR                                            01460001
014700             , LOC_TYP_CDE                                        01470001
014800             , LOC_NM                                             01480001
014900             , LOC_5_ABBR_NM                                      01490001
015000             , LOC_10_ABBR_NM                                     01500001
015100             , LNE_1_ADDR                                         01510001
015200             , LNE_2_ADDR                                         01520001
015300             , CTY_NM                                             01530001
015400             , ST_CDE                                             01540001
015500             , ZIP_10_CDE                                         01550001
015600             , OPN_DTE                                            01560001
015700             , CLO_DTE                                            01570001
015800             , LAST_UPD_TMST)                                     01580001
015900     VALUES                                                       01590001
016000            ( : XST00001-LOC-NBR                                  01600001
016100            , : XST00001-LOC-TYP-CDE                              01610001
016200            , : XST00001-LOC-NM                                   01620001
016300            , : XST00001-LOC-5-ABBR-NM                            01630001
016400            , : XST00001-LOC-10-ABBR-NM                           01640001
016500            , : XST00001-LNE-1-ADDR                               01650001
016600            , : XST00001-LNE-2-ADDR                               01660001
016700            , : XST00001-CTY-NM                                   01670001
016800            , : XST00001-ST-CDE                                   01680001
016900            , : XST00001-ZIP-10-CDE                               01690001
017000            , : XST00001-OPN-DTE                                  01700001
017100            , : XST00001-CLO-DTE                                  01710001
017200            , CURRENT TIMESTAMP)                                  01720001
017300        END-EXEC                                                  01730001
017400                                                                  01740001
017500         EVALUATE TRUE                                            01750001
017600             WHEN SQLCODE = -911                                  01760001
017700             WHEN SQLCODE = -913                                  01770001
017800             WHEN SQLCODE = 0                                     01780001
017900                 CONTINUE                                         01790001
018000             WHEN SQLWARN0 NOT = SPACE                            01800001
018100             WHEN SQLCODE NOT =  ZERO                             01810001
018200                 SET PS-PROCESS-COMPLETE TO TRUE                  01820001
018300         END-EVALUATE                                             01830001
018400     END-PERFORM.                                                 01840001
018500                                                                  01850001
018600******************************************************************01860001
018700**UPDATE ACTION TYPE                                              01870001
018800******************************************************************01880001
018900 2200-UPDATE-DATA.                                                01890001
019000                                                                  01900001
019100     PERFORM                                                      01910001
019200         WITH TEST AFTER                                          01920001
019300         VARYING PV-RETRY-COUNTER                                 01930001
019400         FROM 1 BY 1                                              01940001
019500         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    01950001
019600            OR SQLCODE = 0                                        01960001
019700            OR PS-PROCESS-COMPLETE                                01970001
019800                                                                  01980001
019900        EXEC SQL                                                  01990001
020000          UPDATE XST_LOC                                          02000001
020100          SET LOC_NM             = : XST00001-LOC-NM              02010008
020200             ,LNE_1_ADDR         = : XST00001-LNE-1-ADDR          02020001
020300             ,LNE_2_ADDR         = : XST00001-LNE-2-ADDR          02030001
020400             ,CTY_NM             = : XST00001-CTY-NM              02040001
020500             ,ST_CDE             = : XST00001-ST-CDE              02050001
020600             ,ZIP_10_CDE         = : XST00001-ZIP-10-CDE          02060001
020700             ,LAST_UPD_TMST      = CURRENT TIMESTAMP              02070001
020800              WHERE  (LOC_NBR = : XST00001-LOC-NBR)               02080001
020900           END-EXEC                                               02090001
021000                                                                  02100001
021100         EVALUATE TRUE                                            02110001
021200             WHEN SQLCODE = -911                                  02120001
021300             WHEN SQLCODE = -913                                  02130001
021400             WHEN SQLCODE = 0                                     02140001
021500                 CONTINUE                                         02150001
021600             WHEN SQLWARN0 NOT = SPACE                            02160001
021700             WHEN SQLCODE NOT =  ZERO                             02170001
021800                 SET PS-PROCESS-COMPLETE TO TRUE                  02180001
021900         END-EVALUATE                                             02190001
022000     END-PERFORM.                                                 02200001
022100                                                                  02210001
022200     SET PS-PROCESS-COMPLETE     TO TRUE.                         02220001
022300                                                                  02230001
022400******************************************************************02240001
022500**DELETE TYPE ACTION                                              02250001
022600******************************************************************02260001
022700 2300-DELETE-DATA.                                                02270001
022800                                                                  02280001
022900     PERFORM                                                      02290001
023000         WITH TEST AFTER                                          02300001
023100         VARYING PV-RETRY-COUNTER                                 02310001
023200         FROM 1 BY 1                                              02320001
023300         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    02330001
023400            OR SQLCODE = 0                                        02340001
023500            OR PS-PROCESS-COMPLETE                                02350001
023600                                                                  02360001
023700           EXEC SQL                                               02370001
023800               DELETE FROM XST_LOC                                02380001
023900             WHERE  (LOC_NBR = :XST00001-LOC-NBR)                 02390001
024000           END-EXEC                                               02400001
024100                                                                  02410001
024200         EVALUATE TRUE                                            02420001
024300             WHEN SQLCODE = -911                                  02430001
024400             WHEN SQLCODE = -913                                  02440001
024500             WHEN SQLCODE = 0                                     02450001
024600                 CONTINUE                                         02460001
024700             WHEN SQLWARN0 NOT = SPACE                            02470001
024800             WHEN SQLCODE NOT =  ZERO                             02480001
024900                 SET PS-PROCESS-COMPLETE TO TRUE                  02490001
025000         END-EVALUATE                                             02500001
025100     END-PERFORM.                                                 02510001
025200                                                                  02520001
025300     SET PS-PROCESS-COMPLETE     TO TRUE.                         02530001
025400                                                                  02540001
025500***************************************************************** 02550006
025600**INSERT LOC-ATTR DATA                                            02560006
025700***************************************************************** 02570006
025800 2400-INSERT-LOC-ATTR.                                            02580006
025900                                                                  02590006
026000     PERFORM                                                      02600006
026100         WITH TEST AFTER                                          02610006
026200         VARYING PV-RETRY-COUNTER                                 02620006
026300         FROM 1 BY 1                                              02630006
026400         UNTIL PV-RETRY-COUNTER > PC-RETRY-MAX                    02640006
026500            OR SQLCODE = 0                                        02650006
026600            OR PS-PROCESS-COMPLETE                                02660006
026700                                                                  02670006
026800        EXEC SQL                                                  02680006
026900          INSERT INTO XST_LOC_ATTR                                02690006
027000              (LOC_NBR)                                           02700006
027100     VALUES                                                       02710006
027200            ( : XST00025-LOC-NBR)                                 02720006
027300        END-EXEC                                                  02730006
027400                                                                  02740006
027500         EVALUATE TRUE                                            02750006
027600             WHEN SQLCODE = -911                                  02760006
027700             WHEN SQLCODE = -913                                  02770006
027800             WHEN SQLCODE = 0                                     02780006
027900                 CONTINUE                                         02790006
028000             WHEN SQLWARN0 NOT = SPACE                            02800006
028100             WHEN SQLCODE NOT =  ZERO                             02810006
028200                 SET PS-PROCESS-COMPLETE TO TRUE                  02820006
028300         END-EVALUATE                                             02830006
028400     END-PERFORM.                                                 02840006
028500                                                                  02850006
028600     SET PS-PROCESS-COMPLETE     TO TRUE.                         02860006
028700                                                                  02870006
028800******************************************************************02880001
028900**PASS SQLCODE TO CALLING AND EXIT PROGRAM                        02890001
029000******************************************************************02900001
029100 9999-WRAPUP.                                                     02910001
029200                                                                  02920001
029300     MOVE SQLCODE       TO LV-RETURN-CODE.                        02930001
029400                                                                  02940001
029500     EXIT PROGRAM.                                                02950001
