000100 IDENTIFICATION DIVISION.                                         00010000
000200 TITLE 'MANIFESTING - CLOSE A TRAILER'                            00020000
000300                                                                  00030000
000400 PROGRAM-ID.             PCKRF877.                                00040000
000500 AUTHOR.                 DENNIS STEFFEN.                          00050000
000600 INSTALLATION.           KOHLS.                                   00060000
000700 DATE-WRITTEN.           MAY 2001.                                00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000 ENVIRONMENT DIVISION.                                            00100000
001100 DATA DIVISION.                                                   00110000
001200                                                                  00120000
001300 WORKING-STORAGE SECTION.                                         00130000
001400                                                                  00140000
001500 01  PC-PROGRAM-CONSTANTS.                                        00150000
001600     05  PC-TRANID                    PIC X(04) VALUE 'E877'.     00160000
001700     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'PCKRF877'. 00170000
001800     05  PC-DUMMY-TIMESTAMP           PIC X(26) VALUE             00180000
001900            '9999-09-09-09.09.09.999999'.                         00190000
002000     05  PC-MUST-BE-NUM-MSG           PIC X(19) VALUE             00200000
002100                                           'MUST BE NUMERIC    '. 00210000
002110     05  PC-DLX                       PIC X(03) VALUE 'DLX'.      00211055
002120     05  PC-DLSHPI                    PIC X(06) VALUE 'DLSHPI'.   00212055
002130     05  PC-Y                         PIC X(01) VALUE 'Y'.        00213055
002140     05  PC-SHIPPING                  PIC X(08) VALUE 'SHIPPING'. 00214055
002150     05  PC-TRAILER-CLOSE             PIC X(13) VALUE             00215055
002160         'TRAILER CLOSE'.                                         00216055
002170***CHG0159686 START                                               00217055
002180     05  PC-MAX-RETRIES               PIC S9(04) VALUE  +03       00218055
002190                                                 COMP.            00219055
002191***CHG0159686 END                                                 00219155
002192     05  PV-CICS-MSG-AREA2            PIC X(100) VALUE SPACES.    00219215
002193     05  PV-ERROR-MESSAGE             PIC X(45) VALUE SPACES.     00219315
002194     05  PV-CURRENT-TIMESTAMP         PIC X(26) VALUE SPACES.     00219416
002195                                                                  00219555
002196                                                                  00219655
002197* ERROR MESSAGES (THESE MESSAGES WILL BE TRUNCATED TO 18 BYTES    00219755
002198* BECAUSE THE TRAILER SEAL OF 20 BYTES OVERFLOWS INTO THE LAST    00219855
002199* LINE OF THE SCREEN).                                            00219955
002200     05  PC-UNRECOGNIZED-PF-KEY-MSG   PIC X(19) VALUE             00220055
002300                                           'UNRECOGNIZED PFKEY '. 00230055
002400     05  PC-ENTER-THROUGH-MENU-MSG    PIC X(19) VALUE             00240055
002410                                           'ENTER THROUGH MENU '. 00241055
002420     05  PC-TRANS-UNAVAILABLE-MSG     PIC X(19) VALUE             00242055
002430                                           'TRANS NOT AVAILABLE'. 00243055
002440***CHG0159686 START                                               00244055
002450     05  PC-TRL-CANNOT-BE-CLOSED-MSG  PIC X(19) VALUE             00245055
002460                                           'TRAILER NOT OPEN   '. 00246055
002470***CHG0159686 END                                                 00247055
002480                                                                  00248055
002490 01  DK-DB2-KEYS.                                                 00249055
002500     05  DK-TRLR-SEAL-ID              PIC X(20)  VALUE SPACES.    00250055
002600                                                                  00260055
002700 01  PS-PROGRAM-SWITCHES.                                         00270055
002800     05  PS-ERROR-SW                  PIC X(01)  VALUE 'N'.       00280055
002900         88  PS-ERRORS-YES                        VALUE 'Y'.      00290055
003000         88  PS-ERRORS-NO                         VALUE 'N'.      00300055
003100     05  PS-VALID-INPUT-SW            PIC  X(01)  VALUE 'N'.      00310055
003200         88  PS-VALID-INPUT                       VALUE 'Y'.      00320055
003300         88  PS-INVALID-INPUT                     VALUE 'N'.      00330055
003400     05  PS-XCTL-SW                   PIC X(04)   VALUE SPACES.   00340055
003500         88  PS-XCTL-E871                       VALUE 'E871'.     00350055
003600     05  PS-TCNTRID-SW                PIC X(01) VALUE 'N'.        00360055
003700         88  PS-TSUOBTS-YES                       VALUE 'Y'.      00370055
003800         88  PS-TSUOBTS-NO                        VALUE 'N'.      00380055
003900     05  PS-DOOR-GROUP-FOUND-SW       PIC X(01) VALUE 'N'.        00390055
003910         88  PS-DOOR-GROUP-FOUND-YES            VALUE 'Y'.        00391055
003920         88  PS-DOOR-GROUP-FOUND-NO             VALUE 'N'.        00392055
003921                                                                  00392155
003922***CHG0159686 START                                               00392204
003923     05  PS-TSUOBTS-TRIP-SW           PIC X(01) VALUE 'N'.        00392304
003924         88  PS-TSUOBTS-TRIP-YES                  VALUE 'Y'.      00392404
003925         88  PS-TSUOBTS-TRIP-NO                   VALUE 'N'.      00392504
003926***CHG0159686 END                                                 00392604
003927     05  PS-CONVYR-CUTOFF-SW          PIC X(01) VALUE 'Y'.        00392760
003928         88  PS-CONVYR-CUTOFF-YES                 VALUE 'Y'.      00392860
003929         88  PS-CONVYR-CUTOFF-NO                  VALUE 'N'.      00392960
003930 01  PV-PROGRAM-VARIABLES.                                        00393055
003931     05  PV-DB2-COUNT                 PIC S9(03) COMP-3.          00393155
003932     05  PV-COMMAREA-LENGTH           PIC S9(04)  VALUE +0        00393255
003933                                                     COMP SYNC.   00393355
003940     05  PV-MESSAGE-AREA              PIC  X(19)  VALUE SPACE.    00394055
003950     05  PV-CICS-RESPONSE             PIC S9(09)  VALUE ZEROS     00395055
003960                                                     COMP SYNC.   00396055
003970     05  PV-TRANSFER-PROGRAM          PIC  X(08)  VALUE SPACE.    00397055
003980                                                                  00398055
003990     05  PV-SUB                       PIC S9(4) COMP              00399055
004000                                                VALUE ZERO.       00400055
004100     05  PV-COUNT                     PIC S9(4) COMP              00410055
004200                                                VALUE ZERO.       00420055
004300                                                                  00430055
004400 01  PV-LOG-MSG.                                                  00440055
004500     05  FILLER                       PIC X(12) VALUE             00450055
004600         ' E877 ERROR '.                                          00460055
004700     05  FILLER                       PIC X(06) VALUE             00470055
004800         'USER= '.                                                00480055
004900     05  PV-USER-ID                   PIC X(08) VALUE SPACES.     00490055
005000     05  FILLER                       PIC X(10) VALUE             00500055
005100         ' SQLCODE= '.                                            00510055
005200     05  PV-SQLCODE                   PIC -9(03).                 00520055
005300     05  FILLER                       PIC X(06) VALUE             00530055
005400         ' ERR= '.                                                00540055
005500     05  PV-ERROR-NBR                 PIC 9(03) VALUE ZERO.       00550055
005600     05  FILLER                       PIC X(07) VALUE             00560055
005700         ' DOOR= '.                                               00570055
005800     05  PV-DISPLAY-DOOR              PIC X(04) VALUE ZEROES.     00580055
005900/                                                                 00590055
006000 01  PV-EDITING-FIELDS.                                           00600055
006100     05  PV-SCREEN-DOOR               PIC X(04).                  00610055
006200     05  PV-SCREEN-DEST               PIC X(04).                  00620055
006300     05  PV-SCREEN-SERIAL-NBR         PIC X(09).                  00630055
006400                                                                  00640055
006500 01  PV-DISPLAY-FIELDS.                                           00650055
006600     05  PV-DISPLAY-DOOR-ID           PIC  X(04)  VALUE SPACE.    00660055
006700     05  PV-DISPLAY-OPER              PIC  9(04)  VALUE ZEROES.   00670055
006800     05  PV-DISPLAY-DEST              PIC  9(04)  VALUE ZEROES.   00680055
006900     05  PV-DISPLAY-SEQ-NBR           PIC  9(11)  VALUE ZEROES.   00690055
007000     05  PV-DISPLAY-SRL-NBR           PIC  9(09)  VALUE ZEROES.   00700055
007100     05  PV-DISPLAY-SCAC              PIC  X(04)  VALUE SPACES.   00710055
007200     05  PV-DISPLAY-TRLR-ID           PIC  X(12)  VALUE ZEROES.   00720055
007300     05  PV-DISPLAY-TRIP              PIC  9(09)  VALUE ZEROES.   00730055
007400                                                                  00740055
007500     05  PV-DISPLAY-KEY-NBR-SEQ-NBR   PIC  9(09)  VALUE 0.        00750055
007600     05  PV-DISPLAY-NEED-QTY          PIC  9(09)  VALUE 0.        00760055
007700     05  PV-DISPLAY-NXT-NBR-SEQ-NBR   PIC  9(09)  VALUE 0.        00770055
007800     05  PV-DISPLAY-AREA              PIC  X(01)  VALUE SPACE.    00780055
007900***CHG0159686 START                                               00790055
008000     05  PV-DISP-SQLCODE              PIC  S9(9).                 00800055
008100     05  PV-RETRY-COUNTER             PIC  S9(04) VALUE ZERO      00810055
008200                                                  COMP SYNC.      00820055
008201***CHG0159686 END                                                 00820155
008202                                                                  00820204
008203 01  CA-COMMAREA.                                                 00820304
008204     COPY PCWS233.                                                00820404
008205     05  CA-PRIVATE-COMMAREA          PIC X(100).                 00820504
008206     05  CA-REDEFINED-COMMAREA REDEFINES CA-PRIVATE-COMMAREA.     00820604
008207         10  CA-CURR-SEAL             PIC X(20).                  00820704
008208/                                                                 00820804
008209*  MAP LAYOUT                                                     00820955
008210     COPY PCKM877.                                                00821055
008220                                                                  00822055
008230* HELP SCREEN COMMAREA                                            00823055
008240     COPY PCWS192.                                                00824055
008250* HELP SCREEN WORK AREA                                           00825055
008260     COPY PCWS188.                                                00826055
008270* COMM AREA USED TO SUMMARIZE TRAILER WHEN CLOSED                 00827055
008280     COPY PCWS047.                                                00828055
008290* COMM AREA USED TO PASS TRAILER AUDIT DATA                       00829055
008300     COPY PCWS045.                                                00830055
008400*         USED WHEN CALLING DLKUP001 TO SECURE NEXT SEQUENCE #    00840055
008500     COPY DLWS001.                                                00850055
008600*                                                                 00860055
008700     COPY DLWS011.                                                00870055
008800*         USED WHEN CALLING DLKCS410                              00880055
008900     COPY DLWS016.                                                00890055
008910*         USED WHEN CALLING XLKUP033 TO INSERT BUSINESS EVENTS    00891055
008920     COPY XLWS072.                                                00892055
008930     COPY PCWS242.                                                00893055
008940/                                                                 00894055
008950     COPY DPWS010I.                                               00895055
008960*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   00896055
008970     COPY DPWS015.                                                00897055
008980                                                                  00898055
008990*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      00899055
009000     COPY DFHAID.                                                 00900055
009100                                                                  00910055
009200*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               00920055
009300     COPY DPWS013.                                                00930055
009400                                                                  00940055
009500/                                                                 00950055
009600*    OUTBOUND TRAILER STATUS                                      00960055
009700     EXEC SQL                                                     00970055
009800         INCLUDE TSUOBTS                                          00980055
009900     END-EXEC.                                                    00990055
010000                                                                  01000055
010100     EXEC SQL                                                     01010055
010200         INCLUDE SUT00006                                         01020055
010300     END-EXEC.                                                    01030055
010400                                                                  01040055
010500*    DOOR GROUP TEMPLATE                                          01050055
010600     EXEC SQL                                                     01060055
010610         INCLUDE DLT00000                                         01061055
010620     END-EXEC.                                                    01062055
010630                                                                  01063055
010631*    DOOR GROUP                                                   01063155
010632     EXEC SQL                                                     01063255
010633         INCLUDE DLT00001                                         01063355
010634     END-EXEC.                                                    01063455
010635                                                                  01063555
010636*                                                                 01063655
010637     EXEC SQL                                                     01063755
010638         INCLUDE TKRPRPM                                          01063855
010639     END-EXEC.                                                    01063955
010640                                                                  01064055
010641     EXEC SQL                                                     01064156
010642         INCLUDE TSUCDOT                                          01064256
010643     END-EXEC.                                                    01064356
010644                                                                  01064456
010650     EXEC SQL                                                     01065055
010660         INCLUDE SQLCA                                            01066055
010670     END-EXEC.                                                    01067055
010680                                                                  01068055
010690 LINKAGE SECTION.                                                 01069055
010700 01  DFHCOMMAREA.                                                 01070055
010800     05  FILLER                         OCCURS  1 TO 4072 TIMES   01080055
010900                                      DEPENDING ON EIBCALEN.      01090055
011000         10  FILLER                   PIC X.                      01100055
011100/                                                                 01110055
011200 PROCEDURE DIVISION.                                              01120055
011300 0000-PROGRAM-MAINLINE.                                           01130055
011400                                                                  01140055
011500     INITIALIZE CA-COMMAREA                                       01150055
011600     MOVE DFHCOMMAREA                 TO CA-COMMAREA              01160055
011700                                                                  01170055
011800     EVALUATE TRUE                                                01180055
011900         WHEN EIBCALEN = ZERO                                     01190055
012000             MOVE PC-ENTER-THROUGH-MENU-MSG                       01200055
012100                                      TO PV-MESSAGE-AREA          01210055
012200             PERFORM 8110-RETURN                                  01220055
012300                                                                  01230055
012400         WHEN EIBTRNID = 'Z278'                                   01240055
012500*            RETURNING FROM F1 HELP INFO SCREEN                   01250055
012600             MOVE DFHCOMMAREA         TO PC192-COMMAREA           01260055
012700             MOVE PC192-HOST-SAVE-AREA                            01270055
012800                                      TO CA-COMMAREA              01280055
012900             SET PC233-PROCESS-SCREEN TO TRUE                     01290055
013000             MOVE PC192-HOST-SAVE-MAP TO PC877AO                  01300055
013100             MOVE -1                  TO ASEALL                   01310055
013200             PERFORM 8000-SEND-MAP                                01320055
013300             PERFORM 8100-RETURN-TRANID                           01330055
013400                                                                  01340055
013500         WHEN PC233-INITIALIZE-SCREEN                             01350055
013600         WHEN EIBAID = DFHCLEAR                                   01360055
013700             SET PC233-PROCESS-SCREEN TO TRUE                     01370055
013800             PERFORM 1000-INITIALIZE                              01380055
013900             PERFORM 8000-SEND-MAP                                01390055
014000             PERFORM 8100-RETURN-TRANID                           01400055
014100*                                                                 01410055
014200         WHEN EIBAID = DFHENTER                                   01420055
014300             PERFORM 8020-RECEIVE-MAP                             01430055
014400             IF  PC233-TRLR-SEALED                                01440055
014500                 CONTINUE                                         01450055
014600             ELSE                                                 01460055
014700                 PERFORM 2100-EDIT-INPUT                          01470055
014800             END-IF                                               01480055
014900                                                                  01490055
015000*            PCKRF875 OPENS THE TRAILER FOR AUDIT                 01500055
015100             IF  PC233-TRLR-SEALED                                01510055
015200                 IF PC233-ROOT-PROGRAM = 'PCKRF892'               01520055
015300                    INITIALIZE PC045-COMMAREA-REC                 01530055
015400                    MOVE PC233-HOST-SAVE-AREA                     01540055
015500                                           TO PC045-COMMAREA-REC  01550055
015600                     IF PC045-CLOSE-AUDIT-KEEP                    01560055
015610                        MOVE PC233-ROOT-PROGRAM                   01561055
015611                                         TO PV-TRANSFER-PROGRAM   01561155
015612                     ELSE                                         01561255
015613                        MOVE 'PCKRF875'                           01561355
015614                                         TO PV-TRANSFER-PROGRAM   01561455
015615                     END-IF                                       01561555
015616                 ELSE                                             01561655
015617                     MOVE PC233-MENU-PROGRAM                      01561755
015618                                  TO PV-TRANSFER-PROGRAM          01561855
015619                 END-IF                                           01561955
015620                 PERFORM 8200-XCTL                                01562055
015621             ELSE                                                 01562155
015622             IF PS-VALID-INPUT                                    01562255
015623                     PERFORM 2000-PROCESS                         01562355
015624                     MOVE '** TRAILER CLOSED **'                  01562455
015625                                      TO AMSGLNO                  01562555
015626                     SET  PC233-TRLR-SEALED  TO  TRUE             01562655
015627                     PERFORM 8010-SEND-DATA-ONLY                  01562755
015628                     PERFORM 8100-RETURN-TRANID                   01562855
015629             ELSE                                                 01562955
015630                 PERFORM 8010-SEND-DATA-ONLY                      01563055
015640                 PERFORM 8100-RETURN-TRANID                       01564055
015650             END-IF                                               01565055
015660             END-IF                                               01566055
015670                                                                  01567055
015680         WHEN EIBAID = DFHPF3                                     01568055
015690             MOVE PC233-ROOT-PROGRAM  TO PV-TRANSFER-PROGRAM      01569055
015700             PERFORM 8200-XCTL                                    01570055
015800*                                                                 01580055
015900                                                                  01590055
016000         WHEN EIBAID = DFHPF9                                     01600055
016100             MOVE 'PCKRF743'          TO PV-TRANSFER-PROGRAM      01610055
016200             PERFORM 8200-XCTL                                    01620055
016300                                                                  01630055
016400         WHEN PC233-UPDATE-CONFIRMED                              01640055
016500             PERFORM 2000-PROCESS                                 01650055
016600             MOVE PC233-DOOR-ID       TO ADOORO                   01660055
016700             MOVE PC233-TRIP-ID       TO ATRIPO                   01670055
016800             MOVE PC233-SERIAL-NBR    TO ASERIALO                 01680055
016900             MOVE PC233-STR-NBR       TO ADESTO                   01690055
017000             MOVE PC233-OWNER-SCAC-ID TO ASCACO                   01700055
017100             MOVE PC233-TRAILER       TO ATRLRO                   01710055
017200             MOVE -1                  TO ASEALL                   01720055
017300             MOVE '** TRAILER CLOSED **'                          01730055
017400                                      TO AMSGLNO                  01740055
017500                                                                  01750055
017600*** SUMMARIZE TRAILER CONTENTENTS WHEN TRAILER IS CLOSED          01760055
017700             PERFORM 8300-START-SUKCS574                          01770055
017800                                                                  01780055
017900             PERFORM 8000-SEND-MAP                                01790055
018000             PERFORM 8100-RETURN-TRANID                           01800055
018100                                                                  01810055
018200         WHEN EIBAID = DFHPF1                                     01820055
018300             PERFORM 8020-RECEIVE-MAP                             01830055
018400             MOVE PC877AO             TO PC192-HOST-SAVE-MAP      01840055
018500             PERFORM 1200-HELP-SCREEN                             01850055
018600                                                                  01860055
018700         WHEN OTHER                                               01870055
018800             PERFORM 8020-RECEIVE-MAP                             01880055
018900             MOVE -1                  TO ASEALL                   01890055
019000             MOVE PC-UNRECOGNIZED-PF-KEY-MSG                      01900055
019100                                      TO AMSGLNO                  01910055
019200             PERFORM 8000-SEND-MAP                                01920055
019300             PERFORM 8100-RETURN-TRANID                           01930055
019400     END-EVALUATE.                                                01940055
019500                                                                  01950055
019600     GOBACK.                                                      01960055
019700                                                                  01970055
019800 1000-INITIALIZE.                                                 01980055
019900                                                                  01990055
020000     MOVE PC233-DOOR-ID               TO ADOORO                   02000055
020100     MOVE PC233-TRIP-ID               TO ATRIPO                   02010055
020200     MOVE PC233-SERIAL-NBR            TO ASERIALO                 02020055
020300     MOVE PC233-STR-NBR               TO ADESTO                   02030055
020400     MOVE PC233-OWNER-SCAC-ID         TO ASCACO                   02040055
020500     MOVE PC233-TRAILER               TO ATRLRO                   02050055
020600     MOVE -1                          TO ASEALL                   02060055
020700                                                                  02070055
020800     MOVE ' ENTER TO CLOSE     '      TO AMSGLNO                  02080055
020900                                                                  02090055
021000     INITIALIZE CA-REDEFINED-COMMAREA                             02100055
021100     MOVE PC-TRANID                   TO PC233-TRAN-ID            02110055
021200                                                                  02120055
021300     MOVE PC233-USER-ID               TO PV-USER-ID.              02130055
021400                                                                  02140055
021500*    MOVE PC-CURRENT-PROGRAM-NAME     TO PC233-LAST-PROGRAM.      02150055
021600                                                                  02160055
021700 1200-HELP-SCREEN.                                                02170055
021800     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      02180055
021900     MOVE PC-CURRENT-PROGRAM-NAME     TO PC192-PROGRAM-NAME       02190055
022000     COPY PCPD188.                                                02200055
022100     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      02210055
022200     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA     02220055
022300     PERFORM 8220-XCTL-TO-HELP.                                   02230055
022400                                                                  02240055
022500/                                                                 02250055
022600 2000-PROCESS.                                                    02260055
022700     PERFORM 7000-SELECT-TSUOBTS.                                 02270055
022800* IF THE MOST CURRENT TRIP STATUS IS 'CLOSED AT DC'               02280055
022900* WE DON'T WANT TO CREATE ANOTHER ONE                             02290055
022910*                                                                 02291062
022911* IN 7600-SELECT-TSUCDOT CHECK TO SEE IF THERE IS A CONVEYOR      02291162
022920* CUTOFF THAT HAS NOT BEEN SET.  IF THERE IS,XCTL TO THE          02292062
022930* CUTOFF SCREEN SO THE END DIVERT TMST CAN BE SET                 02293062
023000     IF SUOBTS-TRIP-STAT-CDE = 'DC'                               02300055
023100         CONTINUE                                                 02310055
023200     ELSE                                                         02320055
023201*GB 3/25/22                                                       02320162
023210         PERFORM 7600-SELECT-TSUCDOT                              02321060
023220         IF PS-CONVYR-CUTOFF-NO                                   02322060
023221            MOVE 'PCKRF873'  TO PV-TRANSFER-PROGRAM               02322160
023222            MOVE 'PCKRF877'  TO PC233-NEXT-PROGRAM                02322260
023223            PERFORM 8200-XCTL                                     02322360
023230         END-IF                                                   02323060
023240                                                                  02324060
023300         PERFORM 3000-MANAGE-ASSIGNMENTS                          02330055
023400         PERFORM 8400-GET-TIMESTAMP                               02340055
023500***CHG0159686 START                                               02350055
023600         PERFORM 7050-GET-TSUOBTS-TRIP-STATUS                     02360055
023700         IF PS-TSUOBTS-TRIP-YES                                   02370055
023800***CHG0159686 END                                                 02380055
023900             PERFORM 7100-INSERT-TSUOBTS                          02390055
024000             PERFORM 7400-INSERT-WRKR-AUD                         02400055
024100             IF PC233-P4-INTERFACE-YES                            02410055
024200              PERFORM 4900-CALL-XLKUP033                          02420055
024300             END-IF                                               02430055
024400***CHG0159686 START                                               02440055
024500         ELSE                                                     02450055
024600             MOVE PC-TRL-CANNOT-BE-CLOSED-MSG TO AMSGLNO          02460055
024700             PERFORM 8000-SEND-MAP                                02470055
024800             PERFORM 8100-RETURN-TRANID                           02480055
024801***CHG0159686 END                                                 02480155
024802     END-IF.                                                      02480224
024803                                                                  02480324
024804     PERFORM 8300-START-SUKCS574.                                 02480406
024805     PERFORM 7500-INSERT-WRKR-AUD-SUM.                            02480555
024806                                                                  02480655
024807/                                                                 02480700
024808 2100-EDIT-INPUT.                                                 02480800
024809                                                                  02480900
024810     SET PS-ERRORS-NO                                             02481000
024820         PS-VALID-INPUT               TO TRUE                     02482000
024830     MOVE SPACES                      TO AMSGLNO                  02483055
024840                                                                  02484055
024850     IF  ASEALL > ZERO                                            02485055
024860         MOVE ASEALI TO PC233-SEAL-ID                             02486055
024870     ELSE                                                         02487055
024880         IF ASEALA = DP015-ERASE-EOF                              02488055
024890             MOVE SPACES TO PC233-SEAL-ID                         02489055
024900         END-IF                                                   02490055
025000     END-IF.                                                      02500055
025100     PERFORM 2110-EDIT-SEAL.                                      02510055
025200                                                                  02520055
025300 2110-EDIT-SEAL.                                                  02530055
025400     IF PC233-SEAL-ID = SPACES                                    02540055
025500         MOVE 'SEAL NBR REQUIRED'     TO AMSGLNO                  02550055
025600         MOVE -1                      TO ASEALL                   02560055
025700         SET PS-INVALID-INPUT         TO TRUE                     02570055
025800     ELSE                                                         02580055
025900         MOVE  PC233-SEAL-ID  TO  DK-TRLR-SEAL-ID                 02590055
026000         PERFORM 7010-CK-DUPL-SEAL                                02600055
026100     END-IF.                                                      02610055
026200                                                                  02620055
026300****************************************************************  02630055
026400*    DETERMINES WHETHER INTERFACING OF MANAGING OF ASSIGNMENTS *  02640055
026500*    NEEDS TO BE DONE.                                         *  02650055
026510****************************************************************  02651055
026520 3000-MANAGE-ASSIGNMENTS.                                         02652055
026530                                                                  02653055
026540     EVALUATE TRUE                                                02654055
026550         WHEN PC233-P4-INTERFACE-YES                              02655055
026560              PERFORM 3100-FIND-DOOR-GROUP                        02656055
026570                                                                  02657055
026580         WHEN PC233-P4-INTERFACE-NO                               02658055
026590              CONTINUE                                            02659055
026591                                                                  02659155
026592         WHEN OTHER                                               02659255
026593              PERFORM 3200-SELECT-TKRPRPM-DLSHPI                  02659355
026594                                                                  02659455
026595              IF PC233-P4-INTERFACE-YES                           02659555
026596                 PERFORM 3100-FIND-DOOR-GROUP                     02659655
026597              END-IF                                              02659755
026598                                                                  02659855
026599     END-EVALUATE.                                                02659955
026600                                                                  02660055
026601****************************************************************  02660155
026602*    PC233-DOOR-ID IS THE DOOR NUMBER THAT THEY ARE WORKING AT.*  02660255
026603*    (A) IF IT IS EQUAL TO THE PC233-P4-DOOR-ID, THEN WE       *  02660355
026604*        ARE DONE BECAUSE AN ASSIGNMENT HAS ALREADY BEEN       *  02660455
026605*        ESTABLISHED.                                          *  02660555
026606*                                                              *  02660655
026607*    (B) IF THE DOOR-ID IS NOT EQUAL, THEN WE NEED TO FIND     *  02660755
026608*        DOOR GROUP FOR THE NEW DOOR. PERFORM 3400-            *  02660855
026609*        (1) IF THE DOOR GROUP IS THE SAME FOR THIS DOOR       *  02660955
026610*            THEN FIND THE CURRENT ACTIVE ASSIGNMENT AND       *  02661015
026620*            FINISH UP.                                        *  02662015
026621*        (2) ELSE THIS IS A NEW DOOR GROUP SO ESTABLISH A      *  02662155
026622*            ASSIGNMENT.                                       *  02662215
026623*                                                              *  02662315
026624*                                                              *  02662415
026625****************************************************************  02662515
026626 3100-FIND-DOOR-GROUP.                                            02662615
026627                                                                  02662715
026628     IF PC233-P4-DOOR-ID = PC233-DOOR-ID                          02662825
026629                                                                  02662925
026630        INITIALIZE DL001-ASGMT-COMMAREA                           02663025
026631                                                                  02663125
026632        MOVE PC233-ASGMT-STRT-DTE    TO DL001-KEY-START-DTE       02663226
026633        MOVE PC233-ASGMT-NBR-TXT     TO DL001-KEY-NBR-TXT         02663325
026634        MOVE PC233-ASGMT-NBR-SEQ-NBR TO DL001-KEY-NBR-SEQ-NBR     02663425
026635        PERFORM 4000-CALL-DLKUP001                                02663525
026636        MOVE '1' TO PV-DISPLAY-AREA                               02663655
026637**??    PERFORM 3150-DISPLAY-INFORMATION                          02663755
026638        IF DL001-ASGMT-CLOSED-RETURN                              02663833
026639             PERFORM 3600-CALL-DLKCS410                           02663933
026640**??         PERFORM 3650-DISPLAY-INFORMATION                     02664055
026641        END-IF                                                    02664133
026642     ELSE                                                         02664225
026643        PERFORM 3400-DETERMINE-DOOR-GROUP                         02664325
026644                                                                  02664425
026645        IF PS-DOOR-GROUP-FOUND-YES                                02664525
026646           IF DLT00001-DOOR-GP-NBR =                              02664630
026647                                    PC233-P4-DOOR-GP-NBR          02664730
026648              MOVE PC233-DOOR-ID TO PC233-P4-DOOR-ID              02664825
026649              MOVE '4' TO PV-DISPLAY-AREA                         02664955
026650              PERFORM 3120-FIND-ACTIVE-ASSIGNMENT                 02665055
026660           ELSE                                                   02666025
026661              MOVE '2' TO PV-DISPLAY-AREA                         02666155
026662              PERFORM 3600-CALL-DLKCS410                          02666225
026663**??          PERFORM 3650-DISPLAY-INFORMATION                    02666355
026664              INITIALIZE DL001-ASGMT-COMMAREA                     02666425
026665                                                                  02666525
026666              MOVE DL016-ESO-ASGMT-START-DTE   TO                 02666625
026667                                            DL001-KEY-START-DTE   02666725
026668              MOVE DL016-ESO-ASGMT-NBR-TXT     TO                 02666825
026669                                            DL001-KEY-NBR-TXT     02666925
026670              MOVE DL016-ESO-ASGMT-NBR-SEQ-NBR TO                 02667025
026671                                            DL001-KEY-NBR-SEQ-NBR 02667125
026672              PERFORM 4000-CALL-DLKUP001                          02667225
026673              MOVE '3' TO PV-DISPLAY-AREA                         02667355
026674**??          PERFORM 3150-DISPLAY-INFORMATION                    02667455
026675              IF DL001-ASGMT-CLOSED-RETURN                        02667525
026676                 PERFORM 3600-CALL-DLKCS410                       02667625
026677**??             PERFORM 3650-DISPLAY-INFORMATION                 02667755
026678              END-IF                                              02667825
026679              MOVE PC233-DOOR-ID TO PC233-P4-DOOR-ID              02667925
026680              MOVE DLT00001-DOOR-GP-NBR TO                        02668030
026681                                    PC233-P4-DOOR-GP-NBR          02668130
026682           END-IF                                                 02668225
026683        END-IF                                                    02668325
026684     END-IF.                                                      02668425
026685                                                                  02668525
026686****************************************************************  02668625
026687*                                                              *  02668725
026688*                                                              *  02668825
026689****************************************************************  02668955
026690                                                                  02669025
026700 3120-FIND-ACTIVE-ASSIGNMENT.                                     02670055
026800                                                                  02680055
026900     INITIALIZE DL001-ASGMT-COMMAREA.                             02690055
027000                                                                  02700055
027100     MOVE PC233-ASGMT-STRT-DTE    TO DL001-KEY-START-DTE.         02710055
027200     MOVE PC233-ASGMT-NBR-TXT     TO DL001-KEY-NBR-TXT.           02720055
027300     MOVE PC233-ASGMT-NBR-SEQ-NBR TO DL001-KEY-NBR-SEQ-NBR.       02730055
027400                                                                  02740055
027500     PERFORM 4000-CALL-DLKUP001.                                  02750055
027600                                                                  02760055
027700**?? PERFORM 3150-DISPLAY-INFORMATION.                            02770055
027800                                                                  02780055
027900     IF DL001-ASGMT-CLOSED-RETURN                                 02790055
028000        PERFORM 3600-CALL-DLKCS410                                02800055
028100**??    PERFORM 3650-DISPLAY-INFORMATION                          02810055
028200     END-IF.                                                      02820055
028201                                                                  02820155
028202****************************************************************  02820225
028203*    TEMPORARY TO SOLVE PROBLEM WITH PCT00012 ROWS WITH 0      *  02820325
028204*        SEQUENCE NUMBERS.                                     *  02820425
028205****************************************************************  02820555
028206 3150-DISPLAY-INFORMATION.                                        02820655
028207                                                                  02820755
028208     MOVE DL001-KEY-NBR-SEQ-NBR TO PV-DISPLAY-KEY-NBR-SEQ-NBR.    02820855
028209     MOVE DL001-NBR-OF-NBRS-NEED-QTY TO PV-DISPLAY-NEED-QTY.      02820955
028210     MOVE DL001-NXT-NBR-SEQ-NBR TO PV-DISPLAY-NXT-NBR-SEQ-NBR.    02821055
028220     MOVE DL001-SEQ-START-NBR   TO PV-DISPLAY-SEQ-NBR.            02822055
028230                                                                  02823055
028240     INITIALIZE PV-CICS-MSG-AREA2.                                02824055
028250     STRING ' PCKRF877-'                                          02825055
028260            '-' PV-DISPLAY-AREA                                   02826055
028270            '-' PV-DISPLAY-KEY-NBR-SEQ-NBR                        02827055
028280            '-' PV-DISPLAY-NEED-QTY                               02828055
028290            '-' DL001-COMMIT-CDE                                  02829055
028300            '-' DL001-NEXT-ASGMT-PRCS-CDE                         02830055
028400            '---' DL001-RETURN-CODE                               02840055
028500            '-' DL001-ASGMT-FOUND-CODE                            02850055
028600            '-' PV-DISPLAY-NXT-NBR-SEQ-NBR                        02860055
028700            '-' PV-DISPLAY-SEQ-NBR                                02870055
028800             DELIMITED BY SIZE                                    02880055
028900             INTO PV-CICS-MSG-AREA2.                              02890055
029000     PERFORM 999A-WRITE-CSSL-MSG.                                 02900055
029001                                                                  02900155
029002                                                                  02900225
029003****************************************************************  02900325
029004*    DETERMINES WHETHER INTERFACING OF MANAGING OF ASSIGNMENTS *  02900425
029005*    NEEDS TO BE DONE.                                         *  02900525
029006****************************************************************  02900625
029007 3200-SELECT-TKRPRPM-DLSHPI.                                      02900725
029008                                                                  02900825
029009     EXEC SQL                                                     02900925
029010       SELECT                                                     02901025
029011               FUNC_TXT                                           02901125
029012         INTO                                                     02901225
029013              :KRPRPM-FUNC-TXT                                    02901325
029014         FROM  TKRPRPM                                            02901425
029015        WHERE  LOC_ID            = :PC233-OPER-UNT-ID             02901525
029016          AND  INTFC_SYS_CDE     = :PC-DLX                        02901625
029017          AND  SYS_PRC_FUNC_CDE  = :PC-DLSHPI                     02901725
029018                                                                  02901825
029019     END-EXEC.                                                    02901925
029020                                                                  02902025
029021     EVALUATE TRUE                                                02902125
029022         WHEN SQLCODE = ZERO                                      02902225
029023              IF KRPRPM-FUNC-TXT = 'Y'                            02902325
029024                 SET PC233-P4-INTERFACE-YES TO TRUE               02902425
029025              ELSE                                                02902525
029026                 SET PC233-P4-INTERFACE-NO  TO TRUE               02902625
029027              END-IF                                              02902725
029028         WHEN SQLCODE = +100                                      02902825
029029              SET PC233-P4-INTERFACE-NO  TO TRUE                  02902925
029030         WHEN SQLCODE = -904                                      02903025
029031         WHEN SQLCODE = -913                                      02903125
029032         WHEN SQLCODE = -911                                      02903225
029033              MOVE 16                  TO PV-ERROR-NBR            02903325
029034              PERFORM 9903-WRITE-CICS-LOG                         02903425
029035              PERFORM 9000-SOFT-ABORT                             02903525
029036         WHEN SQLWARN0 NOT = SPACES                               02903625
029037         WHEN SQLCODE NOT EQUAL ZERO                              02903725
029038              SET PC233-P4-INTERFACE-NO  TO TRUE                  02903825
029039              MOVE PC233-OPER-UNT-ID      TO PV-DISPLAY-OPER      02903925
029040              MOVE PC233-DOOR-ID          TO PV-DISPLAY-DOOR-ID   02904025
029041              MOVE PC233-STR-NBR          TO PV-DISPLAY-DEST      02904125
029042              MOVE PC233-SERIAL-NBR       TO PV-DISPLAY-SRL-NBR   02904225
029043              MOVE PC233-OWNER-SCAC-ID    TO PV-DISPLAY-SCAC      02904325
029044              MOVE PC233-TRIP-ID          TO PV-DISPLAY-TRIP      02904425
029045              STRING  ' OPER-'               DELIMITED BY SIZE    02904525
029046                      PV-DISPLAY-OPER        DELIMITED BY SIZE    02904625
029047                      '  DOOR-'              DELIMITED BY SIZE    02904725
029048                      PV-DISPLAY-DOOR-ID     DELIMITED BY SIZE    02904825
029049                      '  DEST-'              DELIMITED BY SIZE    02904925
029050                      PV-DISPLAY-DEST        DELIMITED BY SIZE    02905025
029051                                        INTO                      02905125
029052                                        PC233-MESSAGE-TEXT(2)     02905225
029053             STRING   ' TRLR SRL#-'          DELIMITED BY SIZE    02905325
029054                      PV-DISPLAY-SRL-NBR     DELIMITED BY SIZE    02905425
029055                      '   SCAC-'             DELIMITED BY SIZE    02905525
029056                      PV-DISPLAY-SCAC        DELIMITED BY SIZE    02905625
029057                      '   TRIP-'             DELIMITED BY SIZE    02905725
029058                      PV-DISPLAY-TRIP        DELIMITED BY SIZE    02905825
029059                                        INTO                      02905925
029060                                        PC233-MESSAGE-TEXT(3)     02906025
029061                                                                  02906125
029062             MOVE 17                  TO PV-ERROR-NBR             02906225
029063                                         PC233-ERROR-NBR          02906325
029064             PERFORM 9903-WRITE-CICS-LOG                          02906425
029065             MOVE '3200-SELECT-TKRPRPM-DLSHPI'                    02906525
029066                                      TO PC233-PARAGRAPH          02906625
029067             STRING PC-CURRENT-PROGRAM-NAME                       02906725
029068                    ' - LOOKUP LABOR INTERFACING'                 02906825
029069                     DELIMITED BY SIZE                            02906925
029070                     INTO PC233-MESSAGE-TEXT(1)                   02907025
029071             MOVE SQLCA               TO PC233-SQLCA              02907125
029072             MOVE 'TKRPRPM'           TO PC233-DB2-TABLE-NAME(1)  02907225
029073             SET PC233-ABEND          TO TRUE                     02907325
029074             MOVE 99                  TO PC233-PGM-MSG-NBR        02907425
029075             PERFORM 8210-XCTL-ERROR-SCREEN                       02907525
029076     END-EVALUATE.                                                02907625
029077                                                                  02907725
029078****************************************************************  02907825
029079*    FIND THE DOOR GROUP FOR THE DOOR.                         *  02907925
029080*         IN CICS TO FIND THESE RELATIONSHIP, KEY IN DLMENU    *  02908025
029081*         THEN SELECT DLLSDTMP - SHIP DOOR GROUPING            *  02908125
029082*         FINALLY SELECT THE TEMPLATE YOU WANT AND PRESS F14.  *  02908225
029083****************************************************************  02908325
029084 3400-DETERMINE-DOOR-GROUP.                                       02908425
029085                                                                  02908525
029086     EXEC SQL                                                     02908625
029087       SELECT                                                     02908725
029088               GP.DOOR_GP_NBR                                     02908830
029089         INTO                                                     02908925
029090              :DLT00001-DOOR-GP-NBR                               02909030
029091         FROM  DLT_DOOR_GP      GP                                02909125
029092              ,DLT_DOOR_GP_TMPL TMPL                              02909225
029093                                                                  02909325
029094        WHERE  TMPL.DC_NBR        = :PC233-OPER-UNT-ID            02909425
029095          AND  GP.DOOR_ID         = :PC233-DOOR-ID                02909525
029096          AND  GP.DOOR_GP_TMPL_ID = TMPL.DOOR_GP_TMPL_ID          02909625
029097          AND  TMPL.ACTV_IND      = :PC-Y                         02909725
029098                                                                  02909825
029099     END-EXEC.                                                    02909925
029100                                                                  02910025
029101     EVALUATE TRUE                                                02910125
029102         WHEN SQLCODE = ZERO                                      02910225
029103              SET PS-DOOR-GROUP-FOUND-YES TO TRUE                 02910325
029104         WHEN SQLCODE = -904                                      02910425
029105         WHEN SQLCODE = -913                                      02910525
029106         WHEN SQLCODE = -911                                      02910625
029107              MOVE 16                  TO PV-ERROR-NBR            02910725
029108              PERFORM 9903-WRITE-CICS-LOG                         02910825
029109              PERFORM 9000-SOFT-ABORT                             02910925
029110         WHEN SQLWARN0 NOT = SPACES                               02911025
029111         WHEN SQLCODE NOT EQUAL ZERO                              02911125
029112              SET PS-DOOR-GROUP-FOUND-NO  TO TRUE                 02911225
029113              MOVE PC233-OPER-UNT-ID      TO PV-DISPLAY-OPER      02911325
029114              MOVE PC233-DOOR-ID          TO PV-DISPLAY-DOOR-ID   02911425
029115              MOVE PC233-STR-NBR          TO PV-DISPLAY-DEST      02911525
029116              MOVE PC233-SERIAL-NBR       TO PV-DISPLAY-SRL-NBR   02911625
029117              MOVE PC233-OWNER-SCAC-ID    TO PV-DISPLAY-SCAC      02911725
029118              MOVE PC233-TRIP-ID          TO PV-DISPLAY-TRIP      02911825
029119              STRING  ' OPER-'               DELIMITED BY SIZE    02911925
029120                      PV-DISPLAY-OPER        DELIMITED BY SIZE    02912025
029121                      '  DOOR-'              DELIMITED BY SIZE    02912125
029122                      PV-DISPLAY-DOOR-ID     DELIMITED BY SIZE    02912225
029123                      '  DEST-'              DELIMITED BY SIZE    02912325
029124                      PV-DISPLAY-DEST        DELIMITED BY SIZE    02912425
029125                                        INTO                      02912525
029126                                        PC233-MESSAGE-TEXT(2)     02912625
029127             STRING   ' TRLR SRL#-'          DELIMITED BY SIZE    02912725
029128                      PV-DISPLAY-SRL-NBR     DELIMITED BY SIZE    02912825
029129                      '   SCAC-'             DELIMITED BY SIZE    02912925
029130                      PV-DISPLAY-SCAC        DELIMITED BY SIZE    02913025
029131                      '   TRIP-'             DELIMITED BY SIZE    02913125
029132                      PV-DISPLAY-TRIP        DELIMITED BY SIZE    02913225
029133                                        INTO                      02913325
029134                                        PC233-MESSAGE-TEXT(3)     02913425
029135                                                                  02913525
029136             MOVE 17                  TO PV-ERROR-NBR             02913625
029137                                         PC233-ERROR-NBR          02913725
029138             PERFORM 9903-WRITE-CICS-LOG                          02913825
029139             MOVE '3400-DETERMINE-DOOR-NUMBER'                    02913925
029140                                      TO PC233-PARAGRAPH          02914025
029141             MOVE 'PCKRF877 - FIND DOOR NUMBER        '           02914129
029142                                      TO PC233-MESSAGE-TEXT(1)    02914225
029143             MOVE SQLCA               TO PC233-SQLCA              02914325
029144             MOVE 'DLT_DOOR_GP'       TO PC233-DB2-TABLE-NAME(1)  02914425
029145             MOVE 'DLT_DOOR_GP_TMPL'  TO PC233-DB2-TABLE-NAME(2)  02914525
029146             SET PC233-ABEND          TO TRUE                     02914625
029147             MOVE 99                  TO PC233-PGM-MSG-NBR        02914725
029148             PERFORM 8210-XCTL-ERROR-SCREEN                       02914825
029149     END-EVALUATE.                                                02914925
029150                                                                  02915025
029151****************************************************************  02915125
029152*                                                              *  02915225
029153*                                                              *  02915325
029154****************************************************************  02915425
029155 3600-CALL-DLKCS410.                                              02915525
029156                                                                  02915625
029157     INITIALIZE  DL016-PGM-COMMAREA.                              02915725
029158     SET DL016-ESTABLISH-ASGMT TO TRUE.                           02915825
029159     SET DL016-COMMIT-UPDATE   TO TRUE.                           02915925
029160                                                                  02916025
029161     MOVE PC-CURRENT-PROGRAM-NAME TO DL016-CALLING-PGM-NM.        02916125
029162     MOVE PC233-USER-ID TO DL016-SIGN-ON-USR-ID.                  02916225
029163                                                                  02916325
029164     SET  DL011-AN-SHIP-WRK-TYP TO TRUE.                          02916425
029165     MOVE DL011-KEY-ASGMT-NBR-WRK-TYP TO DL016-ASGMT-NBR-WRK-TYP. 02916525
029166                                                                  02916625
029167     SET  DL011-SHIP-WRK-TYP TO TRUE.                             02916725
029168     MOVE DL011-KEY-WK-TYP TO DL016-EAI-WK-TYP-DESC.              02916825
029169                                                                  02916925
029170     MOVE DLT00001-DOOR-GP-NBR TO                                 02917030
029171                                   DL011-SD-WRK-AREA-DOOR-GROUP.  02917125
029172     MOVE DL011-SHIP-DOORGRP-WRK-AREA TO DL016-EAI-WK-AREA-DESC.  02917225
029173                                                                  02917325
029174     MOVE PC233-OPER-UNT-ID TO DL016-EAI-DC-NBR.                  02917425
029175     MOVE PC233-USER-ID     TO DL016-EAI-CRE-BY-USR-ID.           02917525
029176     SET  DL016-EAI-USR-IS-UNKNOWN TO TRUE.                       02917625
029177                                                                  02917725
029178     MOVE LENGTH OF DL016-PGM-COMMAREA                            02917825
029179                                      TO PV-COMMAREA-LENGTH.      02917925
029180                                                                  02918025
029181     EXEC CICS LINK                                               02918125
029182         PROGRAM  (DL016-USER-PGM)                                02918225
029183         COMMAREA (DL016-PGM-COMMAREA)                            02918325
029184         LENGTH   (PV-COMMAREA-LENGTH)                            02918425
029185         RESP     (PV-CICS-RESPONSE)                              02918525
029186     END-EXEC.                                                    02918625
029187                                                                  02918725
029188     IF  PV-CICS-RESPONSE = DFHRESP (NORMAL)                      02918825
029189                                                                  02918925
029190     EVALUATE TRUE                                                02919025
029191         WHEN DL016-SUCCESSFUL                                    02919125
029192              MOVE DL016-ESO-ASGMT-START-DTE TO                   02919225
029193                             PC233-ASGMT-STRT-DTE                 02919325
029194              MOVE DL016-ESO-ASGMT-NBR-TXT   TO                   02919425
029195                             PC233-ASGMT-NBR-TXT                  02919525
029196              MOVE DL016-ESO-ASGMT-NBR-SEQ-NBR TO                 02919625
029197                             PC233-ASGMT-NBR-SEQ-NBR              02919725
029198                                                                  02919825
029199         WHEN DL016-SQL-ERROR                                     02919925
029200              STRING ' DLKCS410 SQL ERROR FOR USER ID-'           02920025
029201                      PC233-USER-ID                               02920125
029202                      DELIMITED BY SIZE                           02920225
029203                      INTO PV-ERROR-MESSAGE                       02920325
029204                                                                  02920425
029205              PERFORM 3700-FORMAT-ERROR-MESSAGE                   02920525
029206                                                                  02920625
029207         WHEN DL016-CALLED-MODULE-FAILURE                         02920725
029208              STRING ' DLKCS410 CALLED MODULE FAILURE FOR '       02920825
029209                      PC233-USER-ID                               02920925
029210                      DELIMITED BY SIZE                           02921025
029211                      INTO PV-ERROR-MESSAGE                       02921125
029212                                                                  02921225
029213              PERFORM 3700-FORMAT-ERROR-MESSAGE                   02921325
029214                                                                  02921425
029215         WHEN DL016-INVALID-ACCESS                                02921525
029216              STRING ' DLKCS410 INVALID ACCESS FAILURE FOR '      02921625
029217                      PC233-USER-ID                               02921725
029218                      DELIMITED BY SIZE                           02921825
029219                      INTO PV-ERROR-MESSAGE                       02921925
029220                                                                  02922025
029221              PERFORM 3700-FORMAT-ERROR-MESSAGE                   02922125
029222                                                                  02922225
029223         WHEN OTHER                                               02922325
029224              STRING ' DLKCS410 OTHER TYPE FAILURE FOR '          02922425
029225                      PC233-USER-ID                               02922525
029226                      DELIMITED BY SIZE                           02922625
029227                      INTO PV-ERROR-MESSAGE                       02922725
029228                                                                  02922825
029229              PERFORM 3700-FORMAT-ERROR-MESSAGE                   02922925
029230                                                                  02923025
029231     END-EVALUATE                                                 02923125
029232     ELSE                                                         02923225
029233         MOVE '3600-CALL-DLKCS410' TO PC233-PARAGRAPH             02923325
029234         MOVE PV-CICS-RESPONSE     TO PC233-MESSAGE-TEXT (1)      02923425
029235         MOVE 'BAD RETURN FROM DLKCS410' TO                       02923525
029236                                      PC233-MESSAGE-TEXT (2)      02923625
029237         MOVE 2                    TO PC233-ERROR-NBR             02923725
029238         SET PC233-ABEND           TO TRUE                        02923825
029239         MOVE 99                   TO PC233-PGM-MSG-NBR           02923925
029240         PERFORM 8210-XCTL-ERROR-SCREEN                           02924025
029241     END-IF.                                                      02924125
029242                                                                  02924225
029243****************************************************************  02924325
029244*    TEMPORARY TO SOLVE PROBLEM WITH PCT00012 ROWS WITH 0      *  02924425
029245*        SEQUENCE NUMBERS.                                     *  02924525
029246****************************************************************  02924655
029247 3650-DISPLAY-INFORMATION.                                        02924755
029248                                                                  02924855
029249     MOVE DL016-ESO-ASGMT-NBR-SEQ-NBR TO                          02924955
029250                              PV-DISPLAY-KEY-NBR-SEQ-NBR.         02925055
029260     MOVE DL016-EAI-DC-NBR TO PV-DISPLAY-NEED-QTY.                02926055
029270     INITIALIZE PV-CICS-MSG-AREA2.                                02927055
029280     STRING ' PCKRF877-'                                          02928055
029290            '-' PV-DISPLAY-AREA                                   02929055
029300            '-' DL016-PROCESS-CDE                                 02930055
029400            '-' DL016-COMMIT-CDE                                  02940055
029500            '-' DL016-SIGN-ON-USR-ID                              02950055
029600            '-' DL016-ASGMT-NBR-WRK-TYP                           02960055
029700            '-' DL016-EAI-WK-TYP-DESC                             02970055
029800            '-' DL016-EAI-WK-AREA-DESC                            02980055
029900            '-' PV-DISPLAY-NEED-QTY                               02990055
030000            '---' DL016-RETURN-CODE                               03000055
030100            '-' DL016-ESO-ASGMT-PROCESS-SW                        03010055
030200            '-' DL016-ESO-EMP-PROCESS-SW                          03020055
030300            '-' PV-DISPLAY-KEY-NBR-SEQ-NBR                        03030055
030400             DELIMITED BY SIZE                                    03040055
030500             INTO PV-CICS-MSG-AREA2.                              03050055
030501     PERFORM 999A-WRITE-CSSL-MSG.                                 03050155
030502                                                                  03050225
030503****************************************************************  03050325
030504*                                                              *  03050425
030505*                                                              *  03050525
030506****************************************************************  03050625
030507 3700-FORMAT-ERROR-MESSAGE.                                       03050725
030508                                                                  03050825
030509     MOVE DL016-ASGMT-SQLCODE    TO PV-SQLCODE.                   03050925
030510     MOVE PC233-OPER-UNT-ID      TO PV-DISPLAY-OPER.              03051025
030511                                                                  03051125
030512     INITIALIZE PV-CICS-MSG-AREA2.                                03051225
030513     STRING ' PCKRF877-3700- '                                    03051329
030514             PV-DISPLAY-OPER   '-'                                03051425
030515             PV-ERROR-MESSAGE                                     03051525
030516            ' SQLCODE=' PV-SQLCODE                                03051625
030517             DELIMITED BY SIZE                                    03051725
030518             INTO PV-CICS-MSG-AREA2.                              03051825
030519     PERFORM 999A-WRITE-CSSL-MSG.                                 03051925
030520                                                                  03052025
030521     INITIALIZE PV-CICS-MSG-AREA2.                                03052125
030522     STRING ' PCKRF877-' DL016-USER-PGM                           03052229
030523            ' -- ' DL016-CALL-MOD-FAIL-SQL-PARA                   03052325
030524            ' -- ' DL016-CALL-MOD-FAIL-NM                         03052425
030525            ' -- ' DL016-CALL-MOD-FAIL-ERR-CDE                    03052525
030526             DELIMITED BY SIZE                                    03052625
030527             INTO PV-CICS-MSG-AREA2.                              03052725
030528     PERFORM 999A-WRITE-CSSL-MSG.                                 03052825
030529                                                                  03052925
030530****************************************************************  03053025
030531*                                                              *  03053125
030532*                                                              *  03053225
030533****************************************************************  03053325
030534 4000-CALL-DLKUP001.                                              03053425
030535                                                                  03053525
030536     SET DL001-BY-ASGMT-KEY                                       03053625
030537         DL001-COMMIT-UPDATE                                      03053725
030538         DL001-FIND-NEXT-ASGMT    TO TRUE.                        03053825
030539                                                                  03053925
030540     MOVE +1 TO DL001-NBR-OF-NBRS-NEED-QTY.                       03054025
030541                                                                  03054125
030542     SET DL001-FIND-NEXT-ASGMT    TO TRUE.                        03054225
030543                                                                  03054325
030544     MOVE PC-CURRENT-PROGRAM-NAME TO DL001-ORIG-CALLING-PGM-NM.   03054425
030545                                                                  03054525
030546     CALL DL001-USER-PGM USING DFHEIBLK                           03054625
030547                              DL001-COMMAREA                      03054725
030548                              DL001-ASGMT-COMMAREA.               03054825
030549                                                                  03054925
030550     EVALUATE TRUE                                                03055025
030551         WHEN DL001-SUCCESSFUL                                    03055125
030552              IF DL001-ASGMT-NEXT-USED                            03055234
030553                 MOVE DL001-NXT-START-DTE                         03055334
030554                               TO PC233-ASGMT-STRT-DTE            03055434
030555                 MOVE DL001-NXT-NBR-TXT                           03055534
030556                               TO PC233-ASGMT-NBR-TXT             03055634
030557                 MOVE DL001-NXT-NBR-SEQ-NBR                       03055734
030558                               TO PC233-ASGMT-NBR-SEQ-NBR         03055834
030559              END-IF                                              03055934
030560                                                                  03056025
030561         WHEN DL001-ASGMT-CLOSED-RETURN                           03056125
030562              CONTINUE                                            03056225
030563                                                                  03056325
030564         WHEN OTHER                                               03056425
030565              MOVE DL001-ASGMT-SQLCODE TO  PV-SQLCODE             03056525
030566              INITIALIZE PV-CICS-MSG-AREA2                        03056625
030567              STRING ' PCKRF877-4000- '                           03056729
030568                     'SQLCODE=' PV-SQLCODE                        03056825
030569                     ' - RETURN CODE=' DL001-RETURN-CODE          03056925
030570                      DELIMITED BY SIZE                           03057025
030571                      INTO PV-CICS-MSG-AREA2                      03057125
030572              MOVE LENGTH OF PV-CICS-MSG-AREA2                    03057225
030573                                             TO PV-COMMAREA-LENGTH03057325
030574              PERFORM 999A-WRITE-CSSL-MSG                         03057425
030575                                                                  03057525
030576              INITIALIZE PV-CICS-MSG-AREA2                        03057625
030577              STRING ' PCKRF877-' DL001-USER-PGM                  03057729
030578                      ' -- ' DL001-SQL-ERROR-PARA                 03057825
030579                      ' -- ' DL001-CALL-MOD-FAIL-NM               03057925
030580                      ' -- ' DL001-CALL-MOD-FAIL-ERR-CDE          03058025
030581                       DELIMITED BY SIZE                          03058125
030582                       INTO PV-CICS-MSG-AREA2                     03058225
030583              MOVE LENGTH OF PV-CICS-MSG-AREA2                    03058325
030584                                             TO PV-COMMAREA-LENGTH03058425
030585              PERFORM 999A-WRITE-CSSL-MSG                         03058525
030586                                                                  03058625
030587     END-EVALUATE.                                                03058725
030588                                                                  03058825
030589                                                                  03058925
030590****************************************************************  03059025
030591*                                                              *  03059125
030592*                                                              *  03059225
030593****************************************************************  03059325
030594 4900-CALL-XLKUP033.                                              03059425
030595                                                                  03059525
030596     INITIALIZE XL072-EAI-EXPORT-COMMAREA.                        03059625
030597                                                                  03059725
030598     SET  XL072-PC-APP-ID TO TRUE.                                03059825
030599     MOVE PC-SHIPPING       TO XL072-EVNT-OBJ-TXT.                03059925
030600     MOVE PC-TRAILER-CLOSE  TO XL072-EVNT-OBJ-ACTN-TXT.           03060025
030601     MOVE PC233-USER-ID     TO XL072-CRE-BY-USR-ID.               03060125
030602     MOVE PC-CURRENT-PROGRAM-NAME TO XL072-CRE-PGM-NM.            03060225
030603     MOVE PC233-TRIP-ID     TO XL072-EVNT-KY-1-NBR.               03060325
030604     MOVE PC233-OPER-UNT-ID TO XL072-EVNT-KY-2-NBR.               03060425
030605     MOVE PC233-P4-DOOR-GP-NBR TO XL072-EVNT-KY-3-NBR.            03060530
030606     MOVE PC233-P4-DOOR-ID  TO XL072-EVNT-KY-1-TXT.               03060625
030607     MOVE PV-CURRENT-TIMESTAMP TO XL072-EVNT-KY-1-TMST.           03060725
030608                                                                  03060825
030609     INITIALIZE PC242-DTL-TXT-AREA.                               03060925
030610                                                                  03061025
030611     SET PC242-CLOSE-OTBND-TRLR TO TRUE.                          03061125
030612     MOVE PC233-ASGMT-STRT-DTE                                    03061225
030613                               TO PC242-AH-ASGMT-STRT-DTE.        03061325
030614     MOVE PC233-ASGMT-NBR-TXT                                     03061425
030615                               TO PC242-AH-ASGMT-NBR-TXT.         03061525
030616     MOVE PC233-ASGMT-NBR-SEQ-NBR                                 03061625
030617                               TO PC242-AH-ASGMT-NBR-SEQ-NBR.     03061725
030618     MOVE DL001-SEQ-START-NBR                                     03061825
030619                               TO PC242-AH-ASGMT-SEQ-DTL-NBR.     03061927
030620                                                                  03062025
030621                                                                  03062125
030622     SET  XL072-PCWS242-COPYBOOK   TO TRUE.                       03062225
030623     SET  XL072-COMMIT-UPDATE      TO TRUE.                       03062325
030624     MOVE PC242-DTL-TXT-AREA       TO XL072-DTL-TXT.              03062425
030625                                                                  03062525
030626     CALL XL072-USER-PGM USING DFHEIBLK                           03062625
030627                              XL072-COMMAREA                      03062725
030628                              XL072-EAI-EXPORT-COMMAREA.          03062825
030629                                                                  03062925
030630     EVALUATE TRUE                                                03063025
030631         WHEN XL072-SUCCESSFUL                                    03063125
030632              CONTINUE                                            03063225
030633         WHEN OTHER                                               03063325
030634              MOVE PC233-OPER-UNT-ID TO  PV-DISPLAY-OPER          03063425
030635              MOVE PC233-ASGMT-NBR-SEQ-NBR TO PV-DISPLAY-SEQ-NBR  03063531
030636              MOVE XL072-EAI-DB-SQLCODE                           03063625
030637                                     TO  PV-SQLCODE               03063725
030638              INITIALIZE PV-CICS-MSG-AREA2                        03063825
030639              STRING ' PCKRF877-4900- '                           03063929
030640                      PV-DISPLAY-OPER   '-'                       03064025
030641                      PC233-ASGMT-STRT-DTE  ' - '                 03064125
030642                      PC233-ASGMT-NBR-TXT   ' - '                 03064225
030643                      PC233-USER-ID ' - '                         03064325
030644                     'SQLCODE=' PV-SQLCODE                        03064425
030645                     ' - RETURN CODE=' XL072-RETURN-CODE          03064525
030646                                                DELIMITED BY SIZE 03064625
030647                                           INTO PV-CICS-MSG-AREA2 03064725
030648              MOVE LENGTH OF PV-CICS-MSG-AREA2                    03064825
030649                                             TO PV-COMMAREA-LENGTH03064925
030650              PERFORM 999A-WRITE-CSSL-MSG                         03065025
030651                                                                  03065118
030652              INITIALIZE PV-CICS-MSG-AREA2                        03065218
030653              STRING ' PCKRF877-' XL072-USER-PGM                  03065329
030654                      ' -- ' XL072-SQL-ERROR-PARA                 03065418
030655                      ' -- ' XL072-CALL-MOD-FAIL-NM               03065518
030656                      ' -- ' XL072-CALL-MOD-FAIL-ERR-CDE          03065618
030657                                                DELIMITED BY SIZE 03065718
030658                                           INTO PV-CICS-MSG-AREA2 03065818
030659              MOVE LENGTH OF PV-CICS-MSG-AREA2                    03065923
030660                                             TO PV-COMMAREA-LENGTH03066018
030661              PERFORM 999A-WRITE-CSSL-MSG                         03066123
030662                                                                  03066218
030663              INITIALIZE PV-CICS-MSG-AREA2                        03066318
030664              STRING ' PCKRF877-' XL072-USER-PGM                  03066429
030665                      ' -- ' XL072-SQLCA                          03066518
030666                                                DELIMITED BY SIZE 03066618
030667                                           INTO PV-CICS-MSG-AREA2 03066718
030668              MOVE LENGTH OF PV-CICS-MSG-AREA2                    03066823
030669                                             TO PV-COMMAREA-LENGTH03066918
030670              PERFORM 999A-WRITE-CSSL-MSG                         03067023
030671                                                                  03067118
030672              MOVE 3                   TO PV-ERROR-NBR            03067223
030673                                          PC233-ERROR-NBR         03067323
030674              PERFORM 9903-WRITE-CICS-LOG                         03067423
030675              MOVE '4900-CALL-XLKUP033' TO PC233-PARAGRAPH        03067523
030676              MOVE 'PCKRF877 - CHECK TRAILER EXISTENCE'           03067629
030677                                       TO PC233-MESSAGE-TEXT(1)   03067723
030678              MOVE SQLCA               TO PC233-SQLCA             03067823
030679              SET PC233-ABEND          TO TRUE                    03067923
030680              MOVE 99                  TO PC233-PGM-MSG-NBR       03068023
030681              PERFORM 8210-XCTL-ERROR-SCREEN                      03068123
030682                                                                  03068218
030683     END-EVALUATE.                                                03068318
030684                                                                  03068418
030685/                                                                 03068518
030686 7000-SELECT-TSUOBTS.                                             03068618
030687                                                                  03068718
030688     EXEC SQL                                                     03068818
030689         SELECT                                                   03068900
030690             OTBND_TRIP_ID                                        03069000
030691            ,OTBND_STAT_TMST                                      03069100
030692            ,TRIP_STAT_CDE                                        03069200
030693            ,STAT_OPER_UNT_ID                                     03069300
030694            ,OTBND_STAT_USR_ID                                    03069400
030695            ,DOOR_ID                                              03069500
030696            ,TRLR_SEAL_ID                                         03069600
030697            ,SHIP_SCAC_CDE                                        03069700
030698            ,SHIP_DRV_LAST_NM                                     03069800
030699            ,SHIP_DRV_FRST_NM                                     03069900
030700            ,SHIP_DRV_ID                                          03070000
030701            ,TRLR_PRKG_LOC_DESC                                   03070100
030702            ,TRLR_PRKG_SLOT_NBR                                   03070200
030703            ,FINCL_POST_TMST                                      03070300
030704         INTO                                                     03070400
030705             :SUOBTS-OTBND-TRIP-ID                                03070500
030706         ,   :SUOBTS-OTBND-STAT-TMST                              03070600
030707         ,   :SUOBTS-TRIP-STAT-CDE                                03070700
030708         ,   :SUOBTS-STAT-OPER-UNT-ID                             03070800
030709         ,   :SUOBTS-OTBND-STAT-USR-ID                            03070900
030710         ,   :SUOBTS-DOOR-ID                                      03071000
030711         ,   :SUOBTS-TRLR-SEAL-ID                                 03071100
030712         ,   :SUOBTS-SHIP-SCAC-CDE                                03071200
030713         ,   :SUOBTS-SHIP-DRV-LAST-NM                             03071300
030714         ,   :SUOBTS-SHIP-DRV-FRST-NM                             03071400
030715         ,   :SUOBTS-SHIP-DRV-ID                                  03071500
030716         ,   :SUOBTS-TRLR-PRKG-LOC-DESC                           03071600
030717         ,   :SUOBTS-TRLR-PRKG-SLOT-NBR                           03071700
030718         ,   :SUOBTS-FINCL-POST-TMST                              03071800
030719         FROM                                                     03071900
030720            TSUOBTS OBTS                                          03072000
030721         WHERE OBTS.OTBND_TRIP_ID    = :PC233-TRIP-ID             03072100
030722           AND OBTS.OTBND_STAT_TMST  =                            03072200
030723           ( SELECT                                               03072300
030724                 MAX(OBTS1.OTBND_STAT_TMST)                       03072400
030725                 FROM                                             03072500
030726                 TSUOBTS OBTS1                                    03072600
030727                 WHERE OBTS1.OTBND_TRIP_ID = OBTS.OTBND_TRIP_ID   03072755
030728            )                                                     03072855
030729     END-EXEC.                                                    03072955
030730                                                                  03073055
030740     EVALUATE TRUE                                                03074055
030750         WHEN SQLCODE = ZERO                                      03075055
030760             CONTINUE                                             03076055
030770         WHEN SQLCODE = +100                                      03077055
030780         WHEN SQLCODE = -904                                      03078055
030790         WHEN SQLCODE = -913                                      03079055
030800         WHEN SQLCODE = -911                                      03080055
030900             MOVE 1                   TO PV-ERROR-NBR             03090055
031000             PERFORM 9903-WRITE-CICS-LOG                          03100055
031100             PERFORM 9000-SOFT-ABORT                              03110055
031200         WHEN SQLWARN0 NOT = SPACES                               03120055
031300         WHEN SQLCODE NOT EQUAL ZERO                              03130055
031400             MOVE 2                   TO PV-ERROR-NBR             03140055
031500                                         PC233-ERROR-NBR          03150055
031600             PERFORM 9903-WRITE-CICS-LOG                          03160055
031700             MOVE '7000-SELECT-TSUOBTS'                           03170055
031800                                      TO PC233-PARAGRAPH          03180055
031900             MOVE 'PCKRF877 - SELECT OUTBOUND TRIP'               03190055
032000                                      TO PC233-MESSAGE-TEXT(1)    03200055
032100             MOVE SQLCA               TO PC233-SQLCA              03210055
032200             MOVE 'TSUOBTS'           TO PC233-DB2-TABLE-NAME(1)  03220055
032300             SET PC233-ABEND          TO TRUE                     03230055
032400             MOVE 99                  TO PC233-PGM-MSG-NBR        03240055
032500             PERFORM 8210-XCTL-ERROR-SCREEN                       03250055
032600     END-EVALUATE.                                                03260055
032700                                                                  03270055
032701                                                                  03270155
032702***CHG0159686 START                                               03270218
032703 7050-GET-TSUOBTS-TRIP-STATUS.                                    03270318
032704                                                                  03270418
032705     SET PS-TSUOBTS-TRIP-NO           TO TRUE.                    03270518
032706     PERFORM                                                      03270618
032707         WITH TEST AFTER                                          03270755
032708         VARYING PV-RETRY-COUNTER                                 03270855
032709         FROM 1 BY 1                                              03270955
032710         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               03271055
032720            OR  (SQLCODE = +100)                                  03272055
032721            OR  (SQLCODE = +0))                                   03272155
032722     EXEC SQL                                                     03272218
032723         SELECT                                                   03272300
032724             1                                                    03272400
032725         INTO                                                     03272555
032726             :PV-COUNT                                            03272655
032727         FROM                                                     03272700
032728            TSUOBTS OBTS                                          03272800
032729         WHERE OBTS.OTBND_TRIP_ID    = :SUOBTS-OTBND-TRIP-ID      03272900
032730           AND OBTS.TRIP_STAT_CDE    IN ('DO','AO','AK')          03273000
032731           AND OBTS.OTBND_STAT_TMST  =                            03273100
032732           ( SELECT                                               03273200
032733                 MAX(OBTS1.OTBND_STAT_TMST)                       03273300
032734                 FROM                                             03273400
032735                 TSUOBTS OBTS1                                    03273500
032736                 WHERE OBTS1.OTBND_TRIP_ID = OBTS.OTBND_TRIP_ID   03273600
032737            )                                                     03273700
032738     END-EXEC                                                     03273800
032739                                                                  03273900
032740     MOVE SQLCODE                     TO PV-DISP-SQLCODE          03274000
032741     EVALUATE TRUE                                                03274100
032742         WHEN SQLCODE = ZERO                                      03274200
032743             CONTINUE                                             03274300
032744             SET PS-TSUOBTS-TRIP-YES  TO TRUE                     03274400
032745         WHEN SQLCODE = +100                                      03274500
032746             MOVE 1                   TO PV-ERROR-NBR             03274600
032747         WHEN SQLCODE = -904                                      03274755
032748         WHEN SQLCODE = -911                                      03274855
032749         WHEN SQLCODE = -913                                      03274955
032750                 DISPLAY '7050-GET-TSUOBTS-TRIP-STATUS'           03275055
032751                 DISPLAY 'DEADLOCK IN TSUOBTS =' PV-DISP-SQLCODE  03275155
032752         WHEN SQLWARN0 NOT = SPACES                               03275200
032753         WHEN SQLCODE NOT EQUAL ZERO                              03275300
032754             MOVE 2                   TO PV-ERROR-NBR             03275400
032755                                         PC233-ERROR-NBR          03275500
032756             PERFORM 9903-WRITE-CICS-LOG                          03275600
032757             MOVE '7050-SELECT-TSUOBTS'                           03275700
032758                                      TO PC233-PARAGRAPH          03275855
032759             MOVE 'PCKRF877 - SELECT OUTBOUND TRIP'               03275955
032760                                      TO PC233-MESSAGE-TEXT(1)    03276055
032770             MOVE SQLCA               TO PC233-SQLCA              03277055
032780             MOVE 'TSUOBTS'           TO PC233-DB2-TABLE-NAME(1)  03278055
032790             SET PC233-ABEND          TO TRUE                     03279055
032800             MOVE 99                  TO PC233-PGM-MSG-NBR        03280055
032900             PERFORM 8210-XCTL-ERROR-SCREEN                       03290055
033000     END-EVALUATE                                                 03300055
033100     END-PERFORM.                                                 03310055
033200                                                                  03320055
033201     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        03320155
033202             MOVE 3                   TO PV-ERROR-NBR             03320200
033203                                         PC233-ERROR-NBR          03320300
033204             PERFORM 9903-WRITE-CICS-LOG                          03320400
033205             MOVE '7050-SELECT-TSUOBTS'                           03320500
033206                                      TO PC233-PARAGRAPH          03320600
033207             MOVE 'PCKRF877 - SELECT OUTBOUND TRIP'               03320700
033208                                      TO PC233-MESSAGE-TEXT(1)    03320800
033209             MOVE SQLCA               TO PC233-SQLCA              03320900
033210             MOVE 'TSUOBTS'           TO PC233-DB2-TABLE-NAME(1)  03321000
033220             SET PC233-ABEND          TO TRUE                     03322055
033230             MOVE 99                  TO PC233-PGM-MSG-NBR        03323055
033240             PERFORM 8210-XCTL-ERROR-SCREEN                       03324055
033250     END-IF.                                                      03325055
033260***CHG0159686 END                                                 03326055
033270******************************************************************03327055
033280* CHECK IF SEAL ID BEING ENTERED IS ALREADY BEING USED.          *03328055
033290******************************************************************03329055
033300 7010-CK-DUPL-SEAL.                                               03330055
033400                                                                  03340055
033500     EXEC SQL                                                     03350055
033600         SELECT                                                   03360055
033700             TRLR_SEAL_ID                                         03370055
033800         INTO                                                     03380055
033900             :SUOBTS-TRLR-SEAL-ID                                 03390055
034000         FROM                                                     03400055
034100            TSUOBTS                                               03410055
034200         WHERE TRLR_SEAL_ID          = :DK-TRLR-SEAL-ID           03420055
034300     END-EXEC.                                                    03430055
034400                                                                  03440055
034500     EVALUATE TRUE                                                03450055
034600         WHEN SQLCODE = ZERO                                      03460055
034700         WHEN SQLCODE = -811                                      03470055
034800              MOVE 'DUPLICATE SEAL ID '    TO AMSGLNO             03480055
034900              MOVE -1                      TO ASEALL              03490055
035000              SET PS-INVALID-INPUT         TO TRUE                03500055
035100         WHEN SQLCODE = +100                                      03510055
035200             CONTINUE                                             03520055
035300         WHEN SQLCODE = -904                                      03530055
035400         WHEN SQLCODE = -913                                      03540055
035500         WHEN SQLCODE = -911                                      03550055
035600             MOVE 1                   TO PV-ERROR-NBR             03560055
035700             PERFORM 9903-WRITE-CICS-LOG                          03570055
035800             PERFORM 9000-SOFT-ABORT                              03580055
035900         WHEN SQLWARN0 NOT = SPACES                               03590055
036000         WHEN SQLCODE NOT EQUAL ZERO                              03600055
036100             MOVE 2                   TO PV-ERROR-NBR             03610055
036200                                         PC233-ERROR-NBR          03620055
036300             PERFORM 9903-WRITE-CICS-LOG                          03630055
036400             MOVE '7010-CK-DUPL-SEAL  '                           03640055
036500                                      TO PC233-PARAGRAPH          03650055
036600             MOVE 'PCKRF877 - CHECK DUPLICATE SEAL ID'            03660055
036700                                      TO PC233-MESSAGE-TEXT(1)    03670055
036800             MOVE SQLCA               TO PC233-SQLCA              03680055
036900             MOVE 'TSUOBTS'           TO PC233-DB2-TABLE-NAME(1)  03690055
037000             SET PC233-ABEND          TO TRUE                     03700055
037100             MOVE 99                  TO PC233-PGM-MSG-NBR        03710055
037200             PERFORM 8210-XCTL-ERROR-SCREEN                       03720055
037300     END-EVALUATE.                                                03730055
037400                                                                  03740055
037500                                                                  03750055
037600                                                                  03760055
037700                                                                  03770055
037800******************************************************************03780055
037900*                                                                *03790055
038000******************************************************************03800055
038100 7100-INSERT-TSUOBTS.                                             03810055
038200                                                                  03820055
038300     EXEC SQL                                                     03830055
038400       INSERT INTO TSUOBTS                                        03840055
038500           ( OTBND_TRIP_ID                                        03850055
038600            ,OTBND_STAT_TMST                                      03860055
038700            ,TRIP_STAT_CDE                                        03870055
038800            ,STAT_OPER_UNT_ID                                     03880055
038900            ,OTBND_STAT_USR_ID                                    03890055
039000            ,DOOR_ID                                              03900055
039100            ,TRLR_SEAL_ID                                         03910055
039200            ,SHIP_SCAC_CDE                                        03920055
039300            ,SHIP_DRV_LAST_NM                                     03930055
039400            ,SHIP_DRV_FRST_NM                                     03940055
039500            ,SHIP_DRV_ID                                          03950055
039600            ,TRLR_PRKG_LOC_DESC                                   03960055
039700            ,TRLR_PRKG_SLOT_NBR                                   03970055
039800            ,FINCL_POST_TMST                                      03980055
039900            ,CPCTY_PCT                                            03990055
040000            ,UNUSD_PLLT_QTY                                       04000055
040100            ,LOD_BR_QTY                                           04010055
040200           )                                                      04020055
040300       VALUES                                                     04030055
040400         (                                                        04040055
040500             :SUOBTS-OTBND-TRIP-ID                                04050055
040600         ,   :PV-CURRENT-TIMESTAMP                                04060055
040700         ,   'DC'                                                 04070055
040800         ,   :SUOBTS-STAT-OPER-UNT-ID                             04080055
040900         ,   :PC233-USER-ID                                       04090055
041000         ,   :SUOBTS-DOOR-ID                                      04100055
041100         ,   :PC233-SEAL-ID                                       04110055
041200         ,   :SUOBTS-SHIP-SCAC-CDE                                04120055
041300         ,   :SUOBTS-SHIP-DRV-LAST-NM                             04130055
041400         ,   :SUOBTS-SHIP-DRV-FRST-NM                             04140055
041500         ,   :SUOBTS-SHIP-DRV-ID                                  04150055
041600         ,   :SUOBTS-TRLR-PRKG-LOC-DESC                           04160055
041700         ,   :SUOBTS-TRLR-PRKG-SLOT-NBR                           04170055
041800         ,   :SUOBTS-FINCL-POST-TMST                              04180055
041900         ,   0                                                    04190055
042000         ,   0                                                    04200055
042100         ,   0                                                    04210055
042200         )                                                        04220055
042300     END-EXEC.                                                    04230055
042400                                                                  04240055
042500     EVALUATE TRUE                                                04250055
042600         WHEN SQLCODE = ZERO                                      04260055
042700         WHEN SQLCODE = +100                                      04270055
042800             CONTINUE                                             04280055
042900         WHEN SQLCODE = -904                                      04290055
043000         WHEN SQLCODE = -913                                      04300055
043100         WHEN SQLCODE = -911                                      04310055
043200             MOVE 5                   TO PV-ERROR-NBR             04320055
043300             PERFORM 9903-WRITE-CICS-LOG                          04330055
043400             PERFORM 9000-SOFT-ABORT                              04340055
043500         WHEN SQLWARN0 NOT = SPACES                               04350055
043600         WHEN SQLCODE NOT EQUAL ZERO                              04360055
043700             MOVE 6                   TO PV-ERROR-NBR             04370055
043800                                         PC233-ERROR-NBR          04380055
043900             PERFORM 9903-WRITE-CICS-LOG                          04390055
044000             MOVE '7100-INSERT-TSUOBTS'                           04400055
044100                                      TO PC233-PARAGRAPH          04410055
044200             MOVE 'PCKRF877 - CREATE OPEN TRAILER TRIP STATUS'    04420055
044300                                      TO PC233-MESSAGE-TEXT(1)    04430055
044400             MOVE SQLCA               TO PC233-SQLCA              04440055
044500             MOVE 'TSUOBTS'           TO PC233-DB2-TABLE-NAME(1)  04450055
044600             SET PC233-ABEND          TO TRUE                     04460055
044700             MOVE 99                  TO PC233-PGM-MSG-NBR        04470055
044800             PERFORM 8210-XCTL-ERROR-SCREEN                       04480055
044900     END-EVALUATE.                                                04490055
045000/                                                                 04500055
045100                                                                  04510055
045200 7400-INSERT-WRKR-AUD.                                            04520055
045300     EXEC SQL                                                     04530055
045400         INSERT INTO SUT_TRIP_WRKR_AUD                            04540055
045500             (                                                    04550055
045600               OTBND_TRIP_ID                                      04560055
045700             , USR_ID                                             04570055
045800             , CRE_TMST                                           04580055
045900             , CRE_BY_PGM_NM                                      04590055
046000                 )                                                04600055
046100                                                                  04610055
046200             VALUES                                               04620055
046300                                                                  04630055
046400                 (                                                04640055
046500                 :PC233-TRIP-ID                                   04650055
046600             ,   :PC233-USER-ID                                   04660055
046700             ,   CURRENT TIMESTAMP                                04670055
046710             ,   :PC-CURRENT-PROGRAM-NAME                         04671055
046720                 )                                                04672055
046730     END-EXEC.                                                    04673055
046740                                                                  04674055
046750     EVALUATE TRUE                                                04675055
046760         WHEN SQLCODE = ZERO                                      04676055
046770             CONTINUE                                             04677055
046780         WHEN SQLCODE = -904                                      04678055
046790         WHEN SQLCODE = -913                                      04679055
046800         WHEN SQLCODE = -911                                      04680055
046801             MOVE 12                  TO PV-ERROR-NBR             04680155
046802             PERFORM 9903-WRITE-CICS-LOG                          04680255
046803             PERFORM 9000-SOFT-ABORT                              04680355
046804         WHEN SQLWARN0 NOT = SPACES                               04680455
046805         WHEN SQLCODE NOT EQUAL ZERO                              04680555
046806              MOVE PC233-OPER-UNT-ID      TO PV-DISPLAY-OPER      04680655
046807              MOVE PC233-DOOR-ID          TO PV-DISPLAY-DOOR-ID   04680755
046808              MOVE PC233-STR-NBR          TO PV-DISPLAY-DEST      04680855
046809              MOVE PC233-SERIAL-NBR       TO PV-DISPLAY-SRL-NBR   04680955
046810              MOVE PC233-OWNER-SCAC-ID    TO PV-DISPLAY-SCAC      04681055
046811              MOVE PC233-TRIP-ID          TO PV-DISPLAY-TRIP      04681155
046812              STRING  ' OPER-'               DELIMITED BY SIZE    04681255
046813                      PV-DISPLAY-OPER        DELIMITED BY SIZE    04681355
046814                      '  DOOR-'              DELIMITED BY SIZE    04681455
046815                      PV-DISPLAY-DOOR-ID     DELIMITED BY SIZE    04681555
046816                      '  DEST-'              DELIMITED BY SIZE    04681655
046817                      PV-DISPLAY-DEST        DELIMITED BY SIZE    04681755
046818                                        INTO                      04681855
046819                                        PC233-MESSAGE-TEXT(2)     04681955
046820             STRING   ' TRLR SRL#-'          DELIMITED BY SIZE    04682055
046821                      PV-DISPLAY-SRL-NBR     DELIMITED BY SIZE    04682155
046822                      '   SCAC-'             DELIMITED BY SIZE    04682255
046823                      PV-DISPLAY-SCAC        DELIMITED BY SIZE    04682355
046824                      '   TRIP-'             DELIMITED BY SIZE    04682455
046825                      PV-DISPLAY-TRIP        DELIMITED BY SIZE    04682555
046826                                        INTO                      04682655
046827                                        PC233-MESSAGE-TEXT(3)     04682755
046828                                                                  04682855
046829             MOVE 13                  TO PV-ERROR-NBR             04682955
046830                                         PC233-ERROR-NBR          04683055
046831             PERFORM 9903-WRITE-CICS-LOG                          04683155
046832             MOVE '7400-INSERT-WRKR-AUD'                          04683255
046833                                      TO PC233-PARAGRAPH          04683355
046834             MOVE 'PCKRF877 - INSERT WORKER AUDIT'                04683455
046835                                      TO PC233-MESSAGE-TEXT(1)    04683555
046836             MOVE SQLCA               TO PC233-SQLCA              04683655
046837             MOVE 'SUT00006'          TO PC233-DB2-TABLE-NAME(1)  04683755
046838             SET PC233-ABEND          TO TRUE                     04683855
046839             MOVE 99                  TO PC233-PGM-MSG-NBR        04683955
046840             PERFORM 8210-XCTL-ERROR-SCREEN                       04684055
046850     END-EVALUATE.                                                04685055
046860                                                                  04686055
046870                                                                  04687055
046880* TRIP WORKER AUDIT - AFTER TRAILER SUMMARY REQUEST               04688055
046881                                                                  04688155
046882 7500-INSERT-WRKR-AUD-SUM.                                        04688207
046883     EXEC SQL                                                     04688307
046884         INSERT INTO SUT_TRIP_WRKR_AUD                            04688407
046885             (                                                    04688507
046886               OTBND_TRIP_ID                                      04688607
046887             , USR_ID                                             04688707
046888             , CRE_TMST                                           04688807
046889             , CRE_BY_PGM_NM                                      04688907
046890                 )                                                04689007
046891                                                                  04689107
046892             VALUES                                               04689207
046893                                                                  04689307
046894                 (                                                04689407
046895                 :PC233-TRIP-ID                                   04689507
046896             ,   :PC233-USER-ID                                   04689607
046897             ,   CURRENT TIMESTAMP                                04689707
046898             ,   'PCKR877A'                                       04689855
046899                 )                                                04689907
046900     END-EXEC.                                                    04690007
046901                                                                  04690107
046902     EVALUATE TRUE                                                04690207
046903         WHEN SQLCODE = ZERO                                      04690307
046904             CONTINUE                                             04690407
046905         WHEN SQLCODE = -904                                      04690507
046906         WHEN SQLCODE = -913                                      04690607
046907         WHEN SQLCODE = -911                                      04690707
046908             MOVE 12                  TO PV-ERROR-NBR             04690807
046909             PERFORM 9903-WRITE-CICS-LOG                          04690907
046910             PERFORM 9000-SOFT-ABORT                              04691007
046911         WHEN SQLWARN0 NOT = SPACES                               04691107
046912         WHEN SQLCODE NOT EQUAL ZERO                              04691207
046913              MOVE PC233-OPER-UNT-ID      TO PV-DISPLAY-OPER      04691307
046914              MOVE PC233-DOOR-ID          TO PV-DISPLAY-DOOR-ID   04691407
046915              MOVE PC233-STR-NBR          TO PV-DISPLAY-DEST      04691507
046916              MOVE PC233-SERIAL-NBR       TO PV-DISPLAY-SRL-NBR   04691607
046917              MOVE PC233-OWNER-SCAC-ID    TO PV-DISPLAY-SCAC      04691707
046918              MOVE PC233-TRIP-ID          TO PV-DISPLAY-TRIP      04691807
046919              STRING  ' OPER-'               DELIMITED BY SIZE    04691907
046920                      PV-DISPLAY-OPER        DELIMITED BY SIZE    04692007
046921                      '  DOOR-'              DELIMITED BY SIZE    04692107
046922                      PV-DISPLAY-DOOR-ID     DELIMITED BY SIZE    04692207
046923                      '  DEST-'              DELIMITED BY SIZE    04692307
046924                      PV-DISPLAY-DEST        DELIMITED BY SIZE    04692407
046925                                        INTO                      04692507
046926                                        PC233-MESSAGE-TEXT(2)     04692607
046927             STRING   ' TRLR SRL#-'          DELIMITED BY SIZE    04692707
046928                      PV-DISPLAY-SRL-NBR     DELIMITED BY SIZE    04692807
046929                      '   SCAC-'             DELIMITED BY SIZE    04692907
046930                      PV-DISPLAY-SCAC        DELIMITED BY SIZE    04693007
046931                      '   TRIP-'             DELIMITED BY SIZE    04693107
046932                      PV-DISPLAY-TRIP        DELIMITED BY SIZE    04693207
046933                                        INTO                      04693307
046934                                        PC233-MESSAGE-TEXT(3)     04693407
046935                                                                  04693507
046936             MOVE 13                  TO PV-ERROR-NBR             04693607
046937                                         PC233-ERROR-NBR          04693707
046938             PERFORM 9903-WRITE-CICS-LOG                          04693807
046939             MOVE '7500-INSERT-WRKR-AUD-SUM'                      04693907
046940                                      TO PC233-PARAGRAPH          04694007
046941             MOVE 'PCKRF877-WRKR AUDIT AFTER SUMM'                04694107
046942                                      TO PC233-MESSAGE-TEXT(1)    04694207
046943             MOVE SQLCA               TO PC233-SQLCA              04694307
046944             MOVE 'SUT00006'          TO PC233-DB2-TABLE-NAME(1)  04694407
046945             SET PC233-ABEND          TO TRUE                     04694507
046946             MOVE 99                  TO PC233-PGM-MSG-NBR        04694607
046947             PERFORM 8210-XCTL-ERROR-SCREEN                       04694707
046948     END-EVALUATE.                                                04694807
046949                                                                  04694956
046950* CHECK TSUCDOT END TIMESTAMP UPDATED FOR DC CLOSED TRAILER       04695056
046951                                                                  04695156
046952 7600-SELECT-TSUCDOT.                                             04695256
046953     MOVE PC233-TRIP-ID          TO SUCDOT-OTBND-TRIP-ID.         04695356
046954     MOVE PC233-OPER-UNT-ID      TO SUCDOT-OPER-UNT-ID.           04695456
046955     MOVE PC233-DOOR-ID          TO SUCDOT-DOOR-ID.               04695556
046956                                                                  04695656
046957     EXEC SQL                                                     04695756
046958         SELECT A.STRT_DIVERT_TMST                                04695857
046959         INTO  :SUCDOT-STRT-DIVERT-TMST                           04695956
046960         FROM TSUCDOT A                                           04696056
046961         WHERE A.OTBND_TRIP_ID   = :SUCDOT-OTBND-TRIP-ID          04696156
046962         AND   A.OPER_UNT_ID     = :SUCDOT-OPER-UNT-ID            04696256
046963         AND   A.DOOR_ID         = :SUCDOT-DOOR-ID                04696356
046964         AND   A.END_DIVERT_TMST = :PC-DUMMY-TIMESTAMP            04696456
046973                                                                  04697356
046974     END-EXEC.                                                    04697456
046975                                                                  04697556
046976     EVALUATE TRUE                                                04697656
046977         WHEN SQLCODE = ZERO                                      04697756
046978         WHEN SQLCODE = -811                                      04697861
046979              SET PS-CONVYR-CUTOFF-NO TO TRUE                     04697961
046980         WHEN SQLCODE = +100                                      04698061
046981              SET PS-CONVYR-CUTOFF-YES TO TRUE                    04698161
046982         WHEN SQLCODE = -904                                      04698256
046983         WHEN SQLCODE = -913                                      04698356
046984         WHEN SQLCODE = -911                                      04698456
046985             MOVE 18                  TO PV-ERROR-NBR             04698556
046986             PERFORM 9903-WRITE-CICS-LOG                          04698656
046987             PERFORM 9000-SOFT-ABORT                              04698756
046988         WHEN SQLWARN0 NOT = SPACES                               04698856
046989         WHEN SQLCODE NOT EQUAL ZERO                              04698956
046990              MOVE PC233-OPER-UNT-ID      TO PV-DISPLAY-OPER      04699056
046991              MOVE PC233-DOOR-ID          TO PV-DISPLAY-DOOR-ID   04699156
046992              MOVE PC233-STR-NBR          TO PV-DISPLAY-DEST      04699256
046993              MOVE PC233-SERIAL-NBR       TO PV-DISPLAY-SRL-NBR   04699356
046994              MOVE PC233-OWNER-SCAC-ID    TO PV-DISPLAY-SCAC      04699456
046995              MOVE PC233-TRIP-ID          TO PV-DISPLAY-TRIP      04699556
046996              STRING  ' OPER-'               DELIMITED BY SIZE    04699656
046997                      PV-DISPLAY-OPER        DELIMITED BY SIZE    04699756
046998                      '  DOOR-'              DELIMITED BY SIZE    04699856
046999                      PV-DISPLAY-DOOR-ID     DELIMITED BY SIZE    04699956
047000                      '  DEST-'              DELIMITED BY SIZE    04700056
047001                      PV-DISPLAY-DEST        DELIMITED BY SIZE    04700156
047002                                        INTO                      04700256
047003                                        PC233-MESSAGE-TEXT(2)     04700356
047004             STRING   ' TRLR SRL#-'          DELIMITED BY SIZE    04700456
047005                      PV-DISPLAY-SRL-NBR     DELIMITED BY SIZE    04700556
047006                      '   SCAC-'             DELIMITED BY SIZE    04700656
047007                      PV-DISPLAY-SCAC        DELIMITED BY SIZE    04700756
047008                      '   TRIP-'             DELIMITED BY SIZE    04700856
047009                      PV-DISPLAY-TRIP        DELIMITED BY SIZE    04700956
047010                                        INTO                      04701056
047011                                        PC233-MESSAGE-TEXT(3)     04701156
047012                                                                  04701256
047013             MOVE 19                  TO PV-ERROR-NBR             04701356
047014                                         PC233-ERROR-NBR          04701456
047015             PERFORM 9903-WRITE-CICS-LOG                          04701556
047016             MOVE '7600-SELECT-TSUCDOT '                          04701656
047017                                      TO PC233-PARAGRAPH          04701756
047018             MOVE 'PCKRF877-CHECK END TMST SET   '                04701856
047019                                      TO PC233-MESSAGE-TEXT(1)    04701956
047020             MOVE SQLCA               TO PC233-SQLCA              04702056
047021             MOVE 'TSUCDOT '          TO PC233-DB2-TABLE-NAME(1)  04702156
047022             SET PC233-ABEND          TO TRUE                     04702256
047023             MOVE 99                  TO PC233-PGM-MSG-NBR        04702356
047024             PERFORM 8210-XCTL-ERROR-SCREEN                       04702456
047025     END-EVALUATE.                                                04702556
047026/                                                                 04702656
047099/                                                                 04709956
047100 8000-SEND-MAP.                                                   04710056
047101                                                                  04710156
047102     EXEC CICS                                                    04710256
047103         SEND MAP       ('PC877A')                                04710356
047104              MAPSET    ('PCKM877')                               04710456
047105              ERASE                                               04710556
047110              CURSOR                                              04711056
047200              RESP      (PV-CICS-RESPONSE)                        04720055
047300     END-EXEC.                                                    04730055
047400                                                                  04740055
047500     EVALUATE TRUE                                                04750055
047600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 04760055
047700             CONTINUE                                             04770055
047800         WHEN OTHER                                               04780055
047900             MOVE '8000-SEND-MAP'     TO DP013-PARAGRAPH          04790055
048000             MOVE 'PCKRF877 - UNABLE TO SEND MAP'                 04800055
048100                                      TO DP013-MESSAGE-TEXT (1)   04810055
048200             SET DP013-CICS-ABEND                                 04820055
048300                 DP013-ROLLBACK       TO TRUE                     04830055
048400             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               04840055
048500     END-EVALUATE.                                                04850055
048600                                                                  04860055
048700 8010-SEND-DATA-ONLY.                                             04870055
048800                                                                  04880055
048900     EXEC CICS                                                    04890055
049000         SEND MAP       ('PC877A')                                04900055
049100              MAPSET    ('PCKM877')                               04910055
049200              CURSOR                                              04920055
049300              DATAONLY                                            04930055
049400              RESP      (PV-CICS-RESPONSE)                        04940055
049500     END-EXEC.                                                    04950055
049600                                                                  04960055
049700     EVALUATE TRUE                                                04970055
049800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 04980055
049900             CONTINUE                                             04990055
050000         WHEN OTHER                                               05000055
050100             MOVE '8010-SEND-DATA-ONLY'                           05010055
050200                                      TO DP013-PARAGRAPH          05020055
050300             MOVE 'PCKRF877 - UNABLE TO SEND DATA'                05030055
050400                                      TO DP013-MESSAGE-TEXT (1)   05040055
050500             SET DP013-CICS-ABEND                                 05050055
050600                 DP013-ROLLBACK       TO TRUE                     05060055
050700             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               05070055
050800     END-EVALUATE.                                                05080055
050900                                                                  05090055
051000 8020-RECEIVE-MAP.                                                05100055
051100                                                                  05110055
051200     EXEC CICS                                                    05120055
051300         RECEIVE MAP    ('PC877A')                                05130055
051400                 MAPSET ('PCKM877')                               05140055
051500                 RESP   (PV-CICS-RESPONSE)                        05150055
051600     END-EXEC.                                                    05160055
051700                                                                  05170055
051800     EVALUATE TRUE                                                05180055
051900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05190055
052000             CONTINUE                                             05200055
052100         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                05210055
052200             CONTINUE                                             05220055
052300         WHEN OTHER                                               05230055
052400            MOVE '8020-RECEIVE-MAP'   TO DP013-PARAGRAPH          05240055
052500            MOVE 'PCKRF877 - UNABLE TO RECEIVE MAP'               05250055
052600                                      TO DP013-MESSAGE-TEXT (1)   05260055
052700            SET DP013-LOGIC-ABEND     TO TRUE                     05270055
052800            SET DP013-ROLLBACK        TO TRUE                     05280055
052900            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                05290055
053000     END-EVALUATE.                                                05300055
053100                                                                  05310055
053200 8100-RETURN-TRANID.                                              05320055
053300                                                                  05330055
053400     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       05340055
053500     EXEC CICS                                                    05350055
053600         RETURN TRANSID  (PC-TRANID)                              05360055
053700                COMMAREA (CA-COMMAREA)                            05370055
053800                LENGTH   (PV-COMMAREA-LENGTH)                     05380055
053900                RESP     (PV-CICS-RESPONSE)                       05390055
054000     END-EXEC.                                                    05400055
054100                                                                  05410055
054200     EVALUATE TRUE                                                05420055
054300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05430055
054400             CONTINUE                                             05440055
054500         WHEN OTHER                                               05450055
054600             MOVE '8100-RETURN-TRANIND'                           05460055
054700                                      TO DP013-PARAGRAPH          05470055
054800             MOVE 'PCKRF877 - UNABLE TO RETURN TO TRANID'         05480055
054900                 TO DP013-MESSAGE-TEXT (1)                        05490055
055000             SET DP013-CICS-ABEND     TO TRUE                     05500055
055100             SET DP013-ROLLBACK       TO TRUE                     05510055
055200             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               05520055
055300     END-EVALUATE.                                                05530055
055400                                                                  05540055
055500 8110-RETURN.                                                     05550055
055600                                                                  05560055
055700     EXEC CICS                                                    05570055
055800         SEND FROM (PV-MESSAGE-AREA)                              05580055
055900              LENGTH (19)                                         05590055
056000              ERASE                                               05600055
056100     END-EXEC.                                                    05610055
056200                                                                  05620055
056300     EXEC CICS                                                    05630055
056400         RETURN                                                   05640055
056500     END-EXEC.                                                    05650055
056600                                                                  05660055
056700 8200-XCTL.                                                       05670055
056800     SET PC233-INITIALIZE-SCREEN      TO TRUE.                    05680055
056900     MOVE PC-CURRENT-PROGRAM-NAME     TO PC233-LAST-PROGRAM.      05690055
057000     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       05700055
057100                                                                  05710055
057200     EXEC CICS                                                    05720055
057300         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    05730055
057400               COMMAREA  (CA-COMMAREA)                            05740055
057500               LENGTH    (PV-COMMAREA-LENGTH)                     05750055
057600               RESP      (PV-CICS-RESPONSE)                       05760055
057700     END-EXEC.                                                    05770055
057800                                                                  05780055
057900     EVALUATE TRUE                                                05790055
058000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 05800055
058100             CONTINUE                                             05810055
058200         WHEN OTHER                                               05820055
058300             MOVE '8200-XCTL'                                     05830055
058400                                      TO DP013-PARAGRAPH          05840055
058500             MOVE 'PCKRF877 - UNABLE TO XCTL TO PROGRAM: '        05850055
058600                                      TO DP013-MESSAGE-TEXT (1)   05860055
058700             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   05870055
058800             SET DP013-CICS-ABEND                                 05880055
058900                 DP013-ROLLBACK       TO TRUE                     05890055
059000             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               05900055
059100             MOVE PC-TRANS-UNAVAILABLE-MSG                        05910055
059200                                      TO AMSGLNO                  05920055
059300             SET PC233-PROCESS-SCREEN TO TRUE                     05930055
059400             MOVE -1                  TO ASEALL                   05940055
059500             PERFORM 8000-SEND-MAP                                05950055
059600             PERFORM 8100-RETURN-TRANID                           05960055
059700     END-EVALUATE.                                                05970055
059800                                                                  05980055
059900 8210-XCTL-ERROR-SCREEN.                                          05990055
060000     IF PC233-ABEND                                               06000055
060100         CONTINUE                                                 06010055
060200     ELSE                                                         06020055
060300         SET PC233-INITIALIZE-SCREEN  TO TRUE                     06030055
060400     END-IF                                                       06040055
060500                                                                  06050055
060600     IF PC233-PGM-MSG-NBR = ZERO                                  06060055
060700         MOVE 2                       TO PC233-PGM-MSG-NBR        06070055
060800     END-IF                                                       06080055
060900                                                                  06090055
061000     MOVE DFHEIBLK                    TO PC233-DFHEIBLK.          06100055
061100     MOVE PC-CURRENT-PROGRAM-NAME     TO PC233-LAST-PROGRAM.      06110055
061200     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       06120055
061300     MOVE 'PCKRF871'                  TO PV-TRANSFER-PROGRAM      06130055
061400                                                                  06140055
061500     EXEC CICS                                                    06150055
061600         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    06160055
061700               COMMAREA  (CA-COMMAREA)                            06170055
061800               LENGTH    (PV-COMMAREA-LENGTH)                     06180055
061900               RESP      (PV-CICS-RESPONSE)                       06190055
062000     END-EXEC.                                                    06200055
062100                                                                  06210055
062200     EVALUATE TRUE                                                06220055
062300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06230055
062400             CONTINUE                                             06240055
062500         WHEN OTHER                                               06250055
062600             MOVE '8200-XCTL'                                     06260055
062700                                      TO DP013-PARAGRAPH          06270055
062800             MOVE 'PCKRF877 - UNABLE TO XCTL TO PROGRAM: '        06280055
062900                                      TO DP013-MESSAGE-TEXT (1)   06290055
063000             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   06300055
063100             SET DP013-CICS-ABEND                                 06310055
063200                 DP013-ROLLBACK       TO TRUE                     06320055
063300             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               06330055
063400             MOVE PC-TRANS-UNAVAILABLE-MSG                        06340055
063500                                      TO AMSGLNO                  06350055
063600             SET PC233-PROCESS-SCREEN TO TRUE                     06360055
063700             MOVE -1                  TO ASEALL                   06370055
063800             PERFORM 8000-SEND-MAP                                06380055
063900             PERFORM 8100-RETURN-TRANID                           06390055
064000     END-EVALUATE.                                                06400055
064100                                                                  06410055
064200*                                                                 06420055
064300 8220-XCTL-TO-HELP.                                               06430055
064400                                                                  06440055
064500     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH       06450055
064600                                                                  06460055
064700     EXEC CICS                                                    06470055
064800         XCTL                                                     06480055
064900             PROGRAM   (PV-TRANSFER-PROGRAM)                      06490055
065000             COMMAREA  (PC192-COMMAREA)                           06500055
065100             LENGTH    (PV-COMMAREA-LENGTH)                       06510055
065200             RESP      (PV-CICS-RESPONSE)                         06520055
065300     END-EXEC.                                                    06530055
065400                                                                  06540055
065500     EVALUATE TRUE                                                06550055
065600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06560055
065700              CONTINUE                                            06570055
065800         WHEN OTHER                                               06580055
065900             MOVE '8220-XCTL-TO-HELP' TO DP013-PARAGRAPH          06590055
066000             MOVE 'PCKRF877 - UNABLE TO XCTL TO PROGRAM: '        06600055
066100                                      TO DP013-MESSAGE-TEXT (1)   06610055
066200             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   06620055
066300             SET DP013-CICS-ABEND                                 06630055
066400                 DP013-ROLLBACK       TO TRUE                     06640055
066500             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               06650055
066600             MOVE PC-TRANS-UNAVAILABLE-MSG                        06660055
066700                                      TO AMSGLNO                  06670055
066800             SET PC233-PROCESS-SCREEN TO TRUE                     06680055
066900             MOVE -1                  TO ASEALL                   06690055
067000             PERFORM 8000-SEND-MAP                                06700055
067100             PERFORM 8100-RETURN-TRANID                           06710055
067200     END-EVALUATE.                                                06720055
067300                                                                  06730055
067400                                                                  06740055
067500 8300-START-SUKCS574.                                             06750055
067600                                                                  06760055
067610     INITIALIZE PC047-COMMAREA.                                   06761055
067620     MOVE PC233-OPER-UNT-ID           TO PC047-OPER-UNT-ID.       06762055
067630     MOVE PC233-DOOR-ID               TO PC047-DOOR-ID.           06763055
067640     MOVE PC233-STR-NBR               TO PC047-DEST-OPER-UNT-ID.  06764055
067650     MOVE PC233-TRIP-ID               TO PC047-OTBND-TRIP-ID.     06765055
067660     MOVE PC233-DOOR-TYPE-CDE         TO PC047-DOOR-TYPE-CDE.     06766055
067670                                                                  06767055
067680     MOVE LENGTH OF PC047-COMMAREA    TO PV-COMMAREA-LENGTH.      06768055
067690                                                                  06769055
067691     EXEC CICS                                                    06769155
067692         START                                                    06769255
067693             TRANSID   ('S574')                                   06769355
067694             FROM      (PC047-COMMAREA)                           06769455
067695             LENGTH    (PV-COMMAREA-LENGTH)                       06769555
067696     END-EXEC.                                                    06769655
067697                                                                  06769755
067698****************************************************************  06769855
067699*    RETRIEVE THE CURRENT TIMESTAMP TO USE WHEN UPDATING ROWS. *  06769955
067700*                                                              *  06770055
067701****************************************************************  06770155
067702                                                                  06770255
067703 8400-GET-TIMESTAMP.                                              06770355
067704                                                                  06770455
067705     EXEC SQL                                                     06770555
067706                                                                  06770655
067707         SET :PV-CURRENT-TIMESTAMP  = CURRENT TIMESTAMP           06770755
067708                                                                  06770855
067709     END-EXEC.                                                    06770955
067710                                                                  06771055
067720                                                                  06772055
067730 9000-SOFT-ABORT.                                                 06773055
067740                                                                  06774055
067750     EXEC CICS                                                    06775055
067760         SYNCPOINT ROLLBACK                                       06776055
067770     END-EXEC                                                     06777055
067780                                                                  06778055
067790     MOVE 1                           TO PC233-PGM-MSG-NBR        06779055
067800     MOVE SQLCODE                     TO PC233-SQLCODE            06780055
067900     PERFORM 8210-XCTL-ERROR-SCREEN.                              06790055
068000                                                                  06800055
068100                                                                  06810055
068200 9903-WRITE-CICS-LOG.                                             06820055
068300                                                                  06830055
068400     MOVE SQLCODE                     TO PV-SQLCODE               06840055
068500                                                                  06850055
068600     EXEC CICS                                                    06860055
068700         WRITEQ TD                                                06870055
068800             QUEUE  ('CSSL')                                      06880055
068900             FROM   (PV-LOG-MSG)                                  06890055
069000             RESP   (PV-CICS-RESPONSE)                            06900055
069100     END-EXEC.                                                    06910055
069200                                                                  06920055
069300 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  06930055
069400                                                                  06940055
069500     MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.           06950055
069600     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          06960055
069700     INITIALIZE DP013-SRC-TASK-NUMBER                             06970055
069800                DP013-STACK.                                      06980055
069900     SET DP013-LINK-RETURN            TO TRUE.                    06990055
070000                                                                  07000055
070100     EXEC CICS                                                    07010055
070200         LINK                                                     07020055
070300             PROGRAM   (DP013-NAME)                               07030055
070400             COMMAREA  (DP013-PARAMETERS)                         07040055
070500             LENGTH    (DP013-LENGTH)                             07050055
070600     END-EXEC.                                                    07060055
070700                                                                  07070055
070800 999A-WRITE-CSSL-MSG.                                             07080055
070900                                                                  07090055
071000     MOVE LENGTH OF PV-CICS-MSG-AREA2 TO PV-COMMAREA-LENGTH.      07100055
071100                                                                  07110055
071200     EXEC CICS                                                    07120055
071300         WRITEQ TD                                                07130055
071400             QUEUE  ('CSSL')                                      07140055
071500             FROM   (PV-CICS-MSG-AREA2)                           07150055
071600           LENGTH   (PV-COMMAREA-LENGTH)                          07160055
071700             RESP   (PV-CICS-RESPONSE)                            07170055
071800     END-EXEC.                                                    07180055
071900                                                                  07190055
