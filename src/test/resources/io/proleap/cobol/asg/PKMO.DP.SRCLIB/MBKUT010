00001 *************************                                         03/13/92
00002  IDENTIFICATION DIVISION.                                         MBKUT010
00003 *************************                                            LV002
00004  PROGRAM-ID.    MBKUT010.                                         MBKUT010
00005  AUTHOR.        MIKE FURLICK.                                     MBKUT010
00006  DATE-WRITTEN.  NOVEMBER 25, 1991.                                MBKUT010
00007                                                                   MBKUT010
00008 ***************************************************************** MBKUT010
00009 *                                                               * MBKUT010
00010 *    THIS IS THE MONTHLY MBS "PURGE" PROGRAM.  BASED UPON A     * MBKUT010
00011 *    CONTROL RECORD, "OBSOLETE" ROWS ARE DELETED FROM TAPLAVL,  * MBKUT010
00012 *    TRSPBAR, TMDSEDP, TMDSECL, AND TMDSEAR.                    * MBKUT010
00013 *                                                               * MBKUT010
00014 *    THE CONTROL RECORD CONTAINS FOUR VARIABLES; COMPANY,       * MBKUT010
00015 *    TMDSEAR PURGE DAYS, TRSPBAR PURGE DAYS, AND TAPLAVL PURGE  * MBKUT010
00016 *    DAYS.                                                      * MBKUT010
00017 *                                                               * MBKUT010
00018 *    DELETION BASED UPON THE TMDSEAR CRITERIA CAN POTENTIALLY   * MBKUT010
00019 *    DELETE ROWS FROM ALL TABLES PREVIOUSLY LISTED.  FOR        * MBKUT010
00020 *    TRSPBAR AND TAPLAVL PURGE DATE CRITERION, ONLY THOSE       * MBKUT010
00021 *    TABLES WILL HAVE ROWS DELETED.                             * MBKUT010
00022 *                                                               * MBKUT010
00023 ***************************************************************** MBKUT010
00024 *    06/16/98  DOUG DOUGLAS   STRATAGEM     WR#: 6041           * MBKUT010
00024 *              - UPGRADE FOR Y2K                                * MBKUT010
00024 *              - REPLACE ++INCLUDES WITH COPY'S (STANDARDS)     * MBKUT010
00024 ***************************************************************** MBKUT010
00024 *    09/11/23  BOB MCASEY                  CHG#: CHG0293406               
00024 *              - UPDATED COMMIT LOGIC IN 3000-PURGE-APLAVL-GLOBAL         
00024 *                TO COMMIT EVERY 100000.  MODIFIED END OF JOB             
00024 *                DISPLAYS.                                                
00024 ***************************************************************** MBKUT010
00024                                                                   MBKUT010
00025  ENVIRONMENT DIVISION.                                            MBKUT010
00026  CONFIGURATION SECTION.                                           MBKUT010
00027  SOURCE-COMPUTER. IBM-3090.                                       MBKUT010
00028  OBJECT-COMPUTER. IBM-3090.                                       MBKUT010
00029                                                                   MBKUT010
00030  INPUT-OUTPUT SECTION.                                            MBKUT010
00031  FILE-CONTROL.                                                    MBKUT010
00032      SELECT CONTROL-FILE                                          MBKUT010
00033          ASSIGN TO INP01.                                         MBKUT010
00034  DATA DIVISION.                                                   MBKUT010
00035  FILE SECTION.                                                    MBKUT010
00036                                                                   MBKUT010
00037                                                                   MBKUT010
00038  FD  CONTROL-FILE                                                 MBKUT010
00039      RECORDING MODE IS F                                          MBKUT010
00040      BLOCK CONTAINS 0 CHARACTERS                                  MBKUT010
00041      LABEL RECORDS ARE STANDARD.                                  MBKUT010
00042                                                                   MBKUT010
00043  01  CONTROL-RECORD                PIC X(80).                     MBKUT010
00044  EJECT                                                            MBKUT010
00045  WORKING-STORAGE SECTION.                                         MBKUT010
00046                                                                   MBKUT010
00047  01  PC-PROGRAM-CONSTANTS.                                        MBKUT010
00048      05  PC-GMM                    PIC X(03)  VALUE 'GMM'.           CL**2
00049      05  PC-DMM                    PIC X(03)  VALUE 'DMM'.           CL**2
00050      05  PC-BYR                    PIC X(03)  VALUE 'BYR'.           CL**2
00051      05  PC-GMA                    PIC X(03)  VALUE 'GMA'.           CL**2
00052      05  PC-DMA                    PIC X(03)  VALUE 'DMA'.        MBKUT010
00053      05  PC-DPT                    PIC X(03)  VALUE 'DPT'.        MBKUT010
00054      05  PC-SCL                    PIC X(03)  VALUE 'SCL'.        MBKUT010
00055      05  PC-MAX-RETRIES            PIC S9(3)  VALUE +3            MBKUT010
00056                                               COMP-3.             MBKUT010
           05  PC-COMMIT-MAX             PIC S9(3)  VALUE +49           MBKUT010
00058                                               COMP-3.             MBKUT010
00059                                                                   MBKUT010
00060  01  PS-PROGRAM-SWITCHES.                                         MBKUT010
00061      05  PS-DATA-SW                PIC X      VALUE 'N'.          MBKUT010
00062          88  PS-END-OF-DATA                   VALUE 'Y'.          MBKUT010
00063          88  PS-NOT-END-OF-DATA               VALUE 'N'.          MBKUT010
0923RM     05  PS-END-OF-APLAVL-PURGE-SW PIC X(01)  VALUE 'N'.                  
0923RM         88  PS-END-OF-APLAVL-PURGE           VALUE 'Y'.          MBKUT010
00064                                                                   MBKUT010
00065  01  PV-PROGRAM-VARIABLES.                                        MBKUT010
00066      05  PV-MDSEAR-COUNT           PIC S9(9)  VALUE ZERO          MBKUT010
00067                                               COMP-3.             MBKUT010
00068      05  PV-MDSECL-COUNT           PIC S9(9)  VALUE ZERO          MBKUT010
00069                                               COMP-3.             MBKUT010
00070      05  PV-MDSEDP-COUNT           PIC S9(9)  VALUE ZERO          MBKUT010
00071                                               COMP-3.             MBKUT010
00072      05  PV-RSPBAR-COUNT           PIC S9(9)  VALUE ZERO          MBKUT010
00073                                               COMP-3.             MBKUT010
00074      05  PV-APLAVL-COUNT           PIC S9(9)  VALUE ZERO          MBKUT010
00075                                               COMP-3.             MBKUT010
00076      05  PV-DB2-COUNT              PIC S9(9)  VALUE ZERO          MBKUT010
00077                                               COMP-3.             MBKUT010
00078      05  PV-COMMIT-COUNT           PIC S9(3)  VALUE ZERO          MBKUT010
00079                                               COMP-3.             MBKUT010
00080      05  PV-COMMITS-ISSUED         PIC S9(9)  VALUE ZERO          MBKUT010
00081                                               COMP-3.             MBKUT010
00082      05  PV-STORE-DAYS             PIC 9(9)   VALUE ZERO.         MBKUT010
00082      05  PV-STORE-TITLE            PIC X(20)  VALUE SPACE.        MBKUT010
00082      05  PV-PARAGRAPH-NAME         PIC X(30)  VALUE SPACE.        MBKUT010
00082      05  PV-DATE-TITLE             PIC X(20)  VALUE SPACE.        MBKUT010
00083      05  PV-DB2-OPER-ATTEMPTED     PIC X(30)  VALUE SPACE.        MBKUT010
00084      05  PV-SQL-SUB                PIC S9(4)  VALUE ZERO          MBKUT010
00085                                               COMP.               MBKUT010
00086      05  PV-TIME                   PIC X(8).                      MBKUT010
00087      05  PV-CURRENT-DATE.                                         MBKUT010
00088          10  PV-CD-YY              PIC XX.                        MBKUT010
00089          10  PV-CD-MM              PIC XX.                        MBKUT010
00090          10  PV-CD-DD              PIC XX.                        MBKUT010
00091                                                                   MBKUT010
00092  01  PV-RETURNED-DATE              PIC X(10)  VALUE SPACES.       MBKUT010
00091                                                                   MBKUT010
00092  01  PV-APLAVL-PURGE-DATE          PIC X(10)  VALUE SPACES.       MBKUT010
00093  01  FILLER  REDEFINES  PV-APLAVL-PURGE-DATE.                     MBKUT010
00094      05  PV-AP-CC                  PIC X(02).                     MBKUT010
00095      05  PV-AP-YY                  PIC X(02).                     MBKUT010
00096      05  FILLER                    PIC X.                         MBKUT010
00097          88  PV-AP-DASH1                      VALUE '-'.          MBKUT010
00098      05  PV-AP-MM                  PIC X(02).                     MBKUT010
00099      05  FILLER                    PIC X.                         MBKUT010
00100          88  PV-AP-DASH2                      VALUE '-'.          MBKUT010
00101      05  PV-AP-DD                  PIC X(02).                     MBKUT010
00102                                                                   MBKUT010
00103  01  PV-RSPBAR-PURGE-DATE          PIC X(10)  VALUE SPACES.       MBKUT010
00104  01  FILLER  REDEFINES  PV-RSPBAR-PURGE-DATE.                     MBKUT010
00105      05  PV-RP-CC                  PIC X(02).                     MBKUT010
00106      05  PV-RP-YY                  PIC X(02).                     MBKUT010
00107      05  FILLER                    PIC X.                         MBKUT010
00108          88  PV-RP-DASH1                      VALUE '-'.          MBKUT010
00109      05  PV-RP-MM                  PIC X(02).                     MBKUT010
00110      05  FILLER                    PIC X.                         MBKUT010
00111          88  PV-RP-DASH2                      VALUE '-'.          MBKUT010
00112      05  PV-RP-DD                  PIC X(02).                     MBKUT010
00113                                                                   MBKUT010
00114  01  PV-MDSEAR-PURGE-DATE          PIC X(10)  VALUE SPACES.       MBKUT010
00115  01  FILLER  REDEFINES  PV-MDSEAR-PURGE-DATE.                     MBKUT010
00116      05  PV-MP-CC                  PIC X(02).                     MBKUT010
00117      05  PV-MP-YY                  PIC X(02).                     MBKUT010
00118      05  FILLER                    PIC X.                         MBKUT010
00119          88  PV-MP-DASH1                      VALUE '-'.          MBKUT010
00120      05  PV-MP-MM                  PIC X(02).                     MBKUT010
00121      05  FILLER                    PIC X.                         MBKUT010
00122          88  PV-MP-DASH2                      VALUE '-'.          MBKUT010
00123      05  PV-MP-DD                  PIC X(02).                     MBKUT010
00124                                                                   MBKUT010
00125  01  ABEND-CODE                    PIC S9(4)  VALUE ZERO          MBKUT010
00126                                               COMP.               MBKUT010
00127      88  ABEND-4001                           VALUE 4001.         MBKUT010
00128      88  ABEND-4002                           VALUE 4002.         MBKUT010
00129      88  ABEND-4003                           VALUE 4003.         MBKUT010
00130      88  ABEND-4004                           VALUE 4004.         MBKUT010
00131      88  ABEND-4005                           VALUE 4005.         MBKUT010
00132      88  ABEND-4006                           VALUE 4006.         MBKUT010
00133      88  ABEND-4013                           VALUE 4013.         MBKUT010
00134                                                                   MBKUT010
00135 *    CONTROL RECORD LAYOUT.                                       MBKUT010
00136                                                                   MBKUT010
00137  01  PV-CONTROL-RECORD.                                           MBKUT010
00138      05  PV-CR-ID                  PIC X(09)  VALUE SPACES.       MBKUT010
00139          88  PV-GOOD-CONTROL-RECORD           VALUE 'MBKUT010'.   MBKUT010
00140      05  FILLER                    PIC X(08)  VALUE SPACES.       MBKUT010
00141      05  PV-CR-COMPANY             PIC X(02)  VALUE SPACES.       MBKUT010
00142      05  FILLER                    PIC X(07)  VALUE SPACES.       MBKUT010
00143      05  PV-CR-MDSEAR-DAYS         PIC 9(03)  VALUE ZERO.         MBKUT010
00144      05  FILLER                    PIC X(08)  VALUE SPACES.       MBKUT010
00145      05  PV-CR-RSPBAR-DAYS         PIC 9(03)  VALUE ZERO.         MBKUT010
00146      05  FILLER                    PIC X(06)  VALUE SPACES.       MBKUT010
00147      05  PV-CR-APLAVL-DAYS         PIC 9(03)  VALUE ZERO.         MBKUT010
00148      05  FILLER                    PIC X(29)  VALUE SPACES.       MBKUT010
00149                                                                   MBKUT010
00150 *    DATE VALIDATION/CONVERSION WORK AREA.                        MBKUT010
00151                                                                   MBKUT010
00152      COPY DPWS500.                                                MBKUT010
00153                                                                   MBKUT010
00154      EJECT                                                        MBKUT010
00155                                                                   MBKUT010
00156 *    MDSEAR DCLGEN                                                MBKUT010
00157                                                                   MBKUT010
00158      EXEC SQL                                                     MBKUT010
00159          INCLUDE TMDSEAR                                          MBKUT010
00160      END-EXEC.                                                    MBKUT010
00161                                                                   MBKUT010
00162 *    MDSECL DCLGEN                                                MBKUT010
00163                                                                   MBKUT010
00164      EXEC SQL                                                     MBKUT010
00165          INCLUDE TMDSECL                                          MBKUT010
00166      END-EXEC.                                                    MBKUT010
00167                                                                   MBKUT010
00168 *    MDSEDP DCLGEN                                                MBKUT010
00169                                                                   MBKUT010
00170      EXEC SQL                                                     MBKUT010
00171          INCLUDE TMDSEDP                                          MBKUT010
00172      END-EXEC.                                                    MBKUT010
00173                                                                   MBKUT010
00174 *    RSPBAR DCLGEN                                                MBKUT010
00175                                                                   MBKUT010
00176      EXEC SQL                                                     MBKUT010
00177          INCLUDE TRSPBAR                                          MBKUT010
00178      END-EXEC.                                                    MBKUT010
00179                                                                   MBKUT010
00180 *    APLAVL DCLGEN                                                MBKUT010
00181                                                                   MBKUT010
00182      EXEC SQL                                                     MBKUT010
00183          INCLUDE TAPLAVL                                          MBKUT010
00184      END-EXEC.                                                    MBKUT010
00185                                                                   MBKUT010
00186 *    SQL COMMUNICATIONS AREA DCLGEN                               MBKUT010
00187                                                                   MBKUT010
00188      EXEC SQL                                                     MBKUT010
00189          INCLUDE SQLCA                                            MBKUT010
00190      END-EXEC.                                                    MBKUT010
00191                                                                   MBKUT010
00192 *    ERROR MESSAGE AREA FOR DB2                                   MBKUT010
00193                                                                   MBKUT010
00194      COPY DPWS004.                                                MBKUT010
00195                                                                   MBKUT010
00196 *    CURSOR DECLARATION FOR MDSEAR.                               MBKUT010
00197                                                                   MBKUT010
00198      EXEC SQL                                                     MBKUT010
00199          DECLARE MERCH-LIST CURSOR                                MBKUT010
00200              FOR SELECT                                           MBKUT010
00201                          GMA_NBR                                  MBKUT010
00202                       ,  DMA_NBR                                  MBKUT010
00203                       ,  DEPT_NBR                                 MBKUT010
00204                       ,  MAJ_CL_NBR                               MBKUT010
00205                       ,  SUB_CL_NBR                               MBKUT010
00206                       ,  MDSELV_CDE                               MBKUT010
00207                       ,  MDSEAR_DKEY                              MBKUT010
00208                       ,  LIST_SEQ_NBR                             MBKUT010
00209          FROM                                                     MBKUT010
00210               TMDSEAR                                             MBKUT010
00211             WHERE                                                 MBKUT010
00212                       (OPERCO_NBR      =  :PV-CR-COMPANY          MBKUT010
00213               AND      END_DTE         <  :PV-MDSEAR-PURGE-DATE)  MBKUT010
00214      END-EXEC.                                                    MBKUT010
00215  EJECT                                                            MBKUT010
00216  PROCEDURE DIVISION.                                              MBKUT010
00217                                                                   MBKUT010
00218      PERFORM 1000-MAINLINE.                                       MBKUT010
00219      GOBACK.                                                      MBKUT010
00220  1000-MAINLINE.                                                   MBKUT010
00221                                                                   MBKUT010
00222      PERFORM 2000-PROCESS-CONTROL-RECORD.                         MBKUT010
0923RM     MOVE 'N' TO PS-END-OF-APLAVL-PURGE-SW.                               
00223      PERFORM 3000-PURGE-APLAVL-GLOBAL                             MBKUT010
0923RM               UNTIL PS-END-OF-APLAVL-PURGE.                              
00224      PERFORM 4000-PURGE-RSPBAR-GLOBAL.                            MBKUT010
00225      PERFORM 5000-PROCESS-MDSEAR-CURSOR.                          MBKUT010
00226      PERFORM 9000-DISPLAY-TOTALS.                                 MBKUT010
00227                                                                   MBKUT010
00228  EJECT                                                            MBKUT010
00229 *---------------------------------------------------------------* MBKUT010
00230 *                                                               * MBKUT010
00231 *    THIS ROUTINE VALIDATES THE CONTROL RECORD AND CREATES THE  * MBKUT010
00232 *    DB2 DATES NEEDED FOR THE PURGE PROCESS.  FOR ANY ERRORS    * MBKUT010
00233 *    DETECTED, THE COMMON ABEND ROUTINE WILL CAUSE THIS PROGRAM * MBKUT010
00234 *    TO ABEND.                                                  * MBKUT010
00235 *                                                               * MBKUT010
00236 *---------------------------------------------------------------* MBKUT010
00237                                                                   MBKUT010
00238  2000-PROCESS-CONTROL-RECORD.                                     MBKUT010
00239                                                                   MBKUT010
00240      OPEN INPUT CONTROL-FILE.                                     MBKUT010
00241      READ CONTROL-FILE INTO PV-CONTROL-RECORD.                    MBKUT010
00242      DISPLAY '* ' PV-CONTROL-RECORD ' *'.                         MBKUT010
00243                                                                   MBKUT010
00244      IF  PV-GOOD-CONTROL-RECORD                                   MBKUT010
00245          CONTINUE                                                 MBKUT010
00246      ELSE                                                         MBKUT010
00247          DISPLAY '* * * * * * * * * * * * * * * * *'              MBKUT010
00248          DISPLAY '*    ***MBKUT010 ABEND***       *'              MBKUT010
00249          DISPLAY '*                               *'              MBKUT010
00250          DISPLAY '*   INVALID CONTROL RECORD      *'              MBKUT010
00251          DISPLAY '*                               *'              MBKUT010
00252          DISPLAY '* * * * * * * * * * * * * * * * *'              MBKUT010
00253          SET ABEND-4001        TO  TRUE                           MBKUT010
00254          CALL 'ILBOABN0'    USING  ABEND-CODE                     MBKUT010
00255      END-IF.                                                      MBKUT010
00256                                                                   MBKUT010
00257      IF  PV-CR-MDSEAR-DAYS NUMERIC                                MBKUT010
00258          CONTINUE                                                 MBKUT010
00259      ELSE                                                         MBKUT010
00260          DISPLAY '* * * * * * * * * * * * * * * * *'              MBKUT010
00261          DISPLAY '*    ***MBKUT010 ABEND***       *'              MBKUT010
00262          DISPLAY '*                               *'              MBKUT010
00263          DISPLAY '*   INVALID MERCH DAYS:         *'              MBKUT010
00264          DISPLAY '*                               *'              MBKUT010
00265          DISPLAY '* MERCH DAYS = '                                MBKUT010
00266                  PV-CR-MDSEAR-DAYS                                MBKUT010
00267                  '              *'                                MBKUT010
00268          DISPLAY '*                               *'              MBKUT010
00269          DISPLAY '* * * * * * * * * * * * * * * * *'              MBKUT010
00270          SET ABEND-4002        TO  TRUE                           MBKUT010
00271          CALL 'ILBOABN0'    USING  ABEND-CODE                     MBKUT010
00272      END-IF.                                                      MBKUT010
00273                                                                   MBKUT010
00274      IF  PV-CR-RSPBAR-DAYS NUMERIC                                MBKUT010
00275          CONTINUE                                                 MBKUT010
00276      ELSE                                                         MBKUT010
00277          DISPLAY '* * * * * * * * * * * * * * * * *'              MBKUT010
00278          DISPLAY '*    ***MBKUT010 ABEND***       *'              MBKUT010
00279          DISPLAY '*                               *'              MBKUT010
00280          DISPLAY '*   INVALID RESPBL DAYS:        *'              MBKUT010
00281          DISPLAY '*                               *'              MBKUT010
00282          DISPLAY '* RESPBL DAYS = '                               MBKUT010
00283                  PV-CR-RSPBAR-DAYS                                MBKUT010
00284                  '             *'                                 MBKUT010
00285          DISPLAY '*                               *'              MBKUT010
00286          DISPLAY '* * * * * * * * * * * * * * * * *'              MBKUT010
00287          SET ABEND-4003        TO  TRUE                           MBKUT010
00288          CALL 'ILBOABN0'    USING  ABEND-CODE                     MBKUT010
00289      END-IF.                                                      MBKUT010
00290                                                                   MBKUT010
00291      IF  PV-CR-APLAVL-DAYS NUMERIC                                MBKUT010
00292          CONTINUE                                                 MBKUT010
00293      ELSE                                                         MBKUT010
00294          DISPLAY '* * * * * * * * * * * * * * * * *'              MBKUT010
00295          DISPLAY '*    ***MBKUT010 ABEND***       *'              MBKUT010
00296          DISPLAY '*                               *'              MBKUT010
00297          DISPLAY '*      INVALID APPL DAYS:       *'              MBKUT010
00298          DISPLAY '*                               *'              MBKUT010
00299          DISPLAY '* APPL DAYS = '                                 MBKUT010
00300                  PV-CR-APLAVL-DAYS                                MBKUT010
00301                  '               *'                               MBKUT010
00302          DISPLAY '*                               *'              MBKUT010
00303          DISPLAY '* * * * * * * * * * * * * * * * *'              MBKUT010
00304          SET ABEND-4004        TO  TRUE                           MBKUT010
00305          CALL 'ILBOABN0'    USING  ABEND-CODE                     MBKUT010
00306      END-IF.                                                      MBKUT010
00307                                                                   MBKUT010
00308      IF (PV-CR-APLAVL-DAYS IS LESS THAN PV-CR-MDSEAR-DAYS         MBKUT010
00309      OR  PV-CR-RSPBAR-DAYS IS LESS THAN PV-CR-MDSEAR-DAYS)        MBKUT010
00310          DISPLAY '* * * * * * * * * * * * * * * * *'              MBKUT010
00311          DISPLAY '*    ***MBKUT010 ABEND***       *'              MBKUT010
00312          DISPLAY '*                               *'              MBKUT010
00313          DISPLAY '*  MERCH DAYS IS GREATER THAN   *'              MBKUT010
00314          DISPLAY '*  APPL AND/OR RESPBL DAYS:     *'              MBKUT010
00315          DISPLAY '*                               *'              MBKUT010
00316          DISPLAY '* MERCH DAYS = '                                MBKUT010
00317                  PV-CR-MDSEAR-DAYS                                MBKUT010
00318                  '              *'                                MBKUT010
00319          DISPLAY '* RESPBL DAYS = '                               MBKUT010
00320                  PV-CR-RSPBAR-DAYS                                MBKUT010
00321                  '             *'                                 MBKUT010
00322          DISPLAY '* APPL DAYS = '                                 MBKUT010
00323                  PV-CR-APLAVL-DAYS                                MBKUT010
00324                  '               *'                               MBKUT010
00325          DISPLAY '*                               *'              MBKUT010
00326          DISPLAY '* * * * * * * * * * * * * * * * *'              MBKUT010
00327          SET ABEND-4005        TO  TRUE                           MBKUT010
00328          CALL 'ILBOABN0'    USING  ABEND-CODE                     MBKUT010
00329      END-IF.                                                      MBKUT010
00330      CLOSE CONTROL-FILE.                                          MBKUT010
00331                                                                   MBKUT010
00332 **************************************************************    MBKUT010
00332 *    CONTROL RECORD VALIDATION PASSED, NOW, SET UP THE            MBKUT010
00333 *    DB2 FORMAT FOR THE PURGE DAYS CRITERION.                     MBKUT010
00332 **************************************************************    MBKUT010
00334                                                                   MBKUT010
00335      ACCEPT PV-CURRENT-DATE  FROM  DATE.                          MBKUT010
00334                                                                   MBKUT010
00336      DISPLAY '**********************************'.                MBKUT010
00337      DISPLAY '* CURRENT DATE      = '                             MBKUT010
00337               PV-CURRENT-DATE '     *'.                           MBKUT010
00339      DISPLAY '*                                *'.                MBKUT010
00338                                                                   MBKUT010
00345      MOVE  PV-CR-MDSEAR-DAYS   TO PV-STORE-DAYS.                  MBKUT010
00345      MOVE 'PV-CR-MDSEAR-DAYS'  TO PV-DATE-TITLE.                  MBKUT010
00347                                                                   MBKUT010
00348      PERFORM 2100-CALL-CALENDAR-ROUTINE.                          MBKUT010
00349      MOVE PV-RETURNED-DATE     TO PV-MDSEAR-PURGE-DATE.           MBKUT010
00355      DISPLAY '*                                *'.                MBKUT010
00356      DISPLAY '* MDSEAR PURGE DATE = '                             MBKUT010
00357              PV-MDSEAR-PURGE-DATE ' *'.                           MBKUT010
00358                                                                   MBKUT010
00359                                                                   MBKUT010
00345      MOVE 'PV-CR-RSPBAR-DAYS'  TO PV-DATE-TITLE.                  MBKUT010
00364      MOVE  PV-CR-RSPBAR-DAYS   TO PV-STORE-DAYS.                  MBKUT010
00359                                                                   MBKUT010
00348      PERFORM 2100-CALL-CALENDAR-ROUTINE.                          MBKUT010
00349      MOVE PV-RETURNED-DATE     TO PV-RSPBAR-PURGE-DATE.           MBKUT010
00374      DISPLAY '*                                *'.                MBKUT010
00375      DISPLAY '* RSPBAR PURGE DATE = '                             MBKUT010
00376              PV-RSPBAR-PURGE-DATE ' *'.                           MBKUT010
00377                                                                   MBKUT010
00345      MOVE 'PV-CR-APLAVL-DAYS'  TO PV-DATE-TITLE.                  MBKUT010
00383      MOVE  PV-CR-APLAVL-DAYS   TO PV-STORE-DAYS.                  MBKUT010
00385                                                                   MBKUT010
00348      PERFORM 2100-CALL-CALENDAR-ROUTINE.                          MBKUT010
00349      MOVE PV-RETURNED-DATE     TO PV-APLAVL-PURGE-DATE.           MBKUT010
00374      DISPLAY '*                                *'.                MBKUT010
00375      DISPLAY '* APLAVL PURGE DATE = '                             MBKUT010
00376              PV-APLAVL-PURGE-DATE ' *'.                           MBKUT010
00377                                                                   MBKUT010
00399  EJECT                                                            MBKUT010
00400 *---------------------------------------------------------------* MBKUT010
00401 *                                                               * MBKUT010
00402 *    CALL THE DATE SUBROUTINE TO ADJUST THE DATE (SUBTRACT THE  * MBKUT010
00403 *    CONTROL CARD DAYS) AND OBTAIN THE CENTURY FOR THE NEW DATE.* MBKUT010
00404 *                                                               * MBKUT010
00405 *---------------------------------------------------------------* MBKUT010
00406                                                                   MBKUT010
00407  2100-CALL-CALENDAR-ROUTINE.                                      MBKUT010
00408                                                                   MBKUT010
           INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.                 
                                                                                
           SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                              
           SET DPG51-DECREMENT-DATE       TO TRUE.                              
           MOVE PV-STORE-DAYS             TO DPG51-INCR-DECR-DAYS-9.            
           MOVE PV-CD-MM                  TO DPG52-GREG-DATE-MO-X.              
           MOVE PV-CD-DD                  TO DPG52-GREG-DATE-DY-X.              
           MOVE PV-CD-YY                  TO DPG52-GREG-DATE-YR-X.              
           SET DPG52-LK-DTE-GREG          TO TRUE.                              
                                                                                
           CALL  DP500-KOHLS-CALENDAR-ROUTINE                                   
                 USING DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.                
                                                                                
           IF DPG54-SEVERE-ERROR OR DPG54-WARNING-ERROR                         
              DISPLAY '* * * * * * * * * * * * * * * * *'                       
              DISPLAY '*    ***MBKUT010 ABEND***       *'                       
              DISPLAY '*                               *'                       
              DISPLAY '*                               *'                       
              DISPLAY '*  INVALID RETURN FROM DPKUT500 *'                       
              DISPLAY '* * * * * * * * * * * * * * * * *'                       
              DISPLAY 'ERROR IND.:  '      DPG54-ERROR-IND                      
              DISPLAY 'DATE IND.:   '      DPG54-DATE-VALID-IND                 
              DISPLAY 'ERROR MSG:   '      DPG54-ERROR-MESSAGE                  
              DISPLAY 'DATE TITLE:  '      PV-DATE-TITLE                        
              DISPLAY 'DATE:        '      PV-CURRENT-DATE                      
              DISPLAY 'DAYS:        '      PV-STORE-DAYS                        
              SET ABEND-4002            TO  TRUE                                
              CALL 'ILBOABN0'        USING  ABEND-CODE                          
           ELSE                                                                 
              MOVE DPG55-DB2-ISO-DATE-FMT TO PV-RETURNED-DATE                   
              DISPLAY PV-DATE-TITLE ' **** '                                    
                      PV-STORE-DAYS ' **** '                                    
                      PV-RETURNED-DATE                                          
           END-IF.                                                              
00425                                                                   MBKUT010
00426  EJECT                                                            MBKUT010
00427 *--------------------------------------------------------------*  MBKUT010
00428 *                                                              *  MBKUT010
00429 *    HERE WE DELETE THE APPLICABLE ROWS IN THE APLAVL TABLE.   *  MBKUT010
00430 *    DISPLAY THE TOTAL NUMBER OF ROWS DELETED UPON SUCCESSFUL  *  MBKUT010
00431 *    COMPLETION OF THE SQL STATEMENT.                          *  MBKUT010
00432 *                                                              *  MBKUT010
00433 *--------------------------------------------------------------*  MBKUT010
00434                                                                   MBKUT010
00435  3000-PURGE-APLAVL-GLOBAL.                                        MBKUT010
00436                                                                   MBKUT010
0923RM**   PERFORM                                                      MBKUT010
0923RM**       WITH TEST AFTER                                          MBKUT010
0923RM**       VARYING PV-SQL-SUB                                       MBKUT010
0923RM**       FROM 1 BY 1                                              MBKUT010
0923RM**       UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       MBKUT010
0923RM**                 OR SQLCODE = 0                                 MBKUT010
0923RM**                 OR SQLCODE = +100)                             MBKUT010
00444                                                                   MBKUT010
00445          EXEC SQL                                                 MBKUT010
00446               DELETE                                              MBKUT010
00447               FROM                                                MBKUT010
00448                    TAPLAVL                                        MBKUT010
00449               WHERE                                               MBKUT010
00450                    OPERCO_NBR      =  :PV-CR-COMPANY              MBKUT010
00451                AND MDSEAR_END_DTE  <  :PV-APLAVL-PURGE-DATE       MBKUT010
0923RM              FETCH FIRST 100000 ROWS ONLY                                
00452          END-EXEC                                                 MBKUT010
00453                                                                   MBKUT010
00454          EVALUATE TRUE                                                    
00455              WHEN SQLCODE = -904                                  MBKUT010
00456              WHEN SQLCODE = -911                                  MBKUT010
00457              WHEN SQLCODE = +100                                  MBKUT010
                   WHEN SQLCODE = 0                                     MBKUT010
00459                  CONTINUE                                         MBKUT010
00460              WHEN SQLWARN NOT = SPACES                            MBKUT010
00461              WHEN SQLCODE NOT = ZERO                              MBKUT010
00462                  MOVE '3000-PURGE-APLAVL-GLOBAL'                  MBKUT010
00463                                TO  PV-PARAGRAPH-NAME              MBKUT010
00464                  MOVE 'DELETE FOR APLAVL - GLOBAL'                MBKUT010
00465                                TO  PV-DB2-OPER-ATTEMPTED          MBKUT010
00466                  PERFORM 9900-SQL-ABEND                           MBKUT010
00467          END-EVALUATE.                                            MBKUT010
00468***   END-PERFORM.                                                 MBKUT010
00469                                                                   MBKUT010
0923RM**   IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        MBKUT010
0923RM**       MOVE '3000-PURGE-APLAVL-GLOBAL'                          MBKUT010
0923RM**                             TO  PV-PARAGRAPH-NAME              MBKUT010
0923RM**       MOVE 'DELETE RETRIES EXCEEDED'                           MBKUT010
0923RM**                             TO  PV-DB2-OPER-ATTEMPTED          MBKUT010
0923RM**       PERFORM 9900-SQL-ABEND                                   MBKUT010
0923RM**   END-IF.                                                      MBKUT010
00477                                                                   MBKUT010
0923RM     IF SQLERRD(3) = 0                                                    
0923RM         SET PS-END-OF-APLAVL-PURGE TO TRUE                               
0923RM     ELSE                                                                 
0923RM         ADD SQLERRD(3)        TO  PV-APLAVL-COUNT                MBKUT010
0923RM         PERFORM 5600-COMMIT                                              
0923RM     END-IF.                                                              
                                                                                
0923RM*        DISPLAY '* * * * * * * * * * * * * * * * *'              MBKUT010
0923RM*        DISPLAY '*                               *'              MBKUT010
0923RM*        DISPLAY '* '                                             MBKUT010
0923RM*                SQLERRD(3)                                       MBKUT010
0923RM*                ' APLAVL ROWS DELETED *'                         MBKUT010
0923RM*        DISPLAY '*                               *'              MBKUT010
0923RM*        DISPLAY '* * * * * * * * * * * * * * * * *'              MBKUT010
00485                                                                   MBKUT010
00486  EJECT                                                            MBKUT010
00487 *--------------------------------------------------------------*  MBKUT010
00488 *                                                              *  MBKUT010
00489 *    HERE WE DELETE THE APPLICABLE ROWS IN THE RSPBAR TABLE.   *  MBKUT010
00490 *    DISPLAY THE TOTAL NUMBER OF ROWS DELETED UPON SUCCESSFUL  *  MBKUT010
00491 *    COMPLETION OF THE SQL STATEMENT.                          *  MBKUT010
00492 *                                                              *  MBKUT010
00493 *--------------------------------------------------------------*  MBKUT010
00494                                                                   MBKUT010
00495  4000-PURGE-RSPBAR-GLOBAL.                                        MBKUT010
00496                                                                   MBKUT010
00497      PERFORM                                                      MBKUT010
00498          WITH TEST AFTER                                          MBKUT010
00499          VARYING PV-SQL-SUB                                       MBKUT010
00500          FROM 1 BY 1                                              MBKUT010
00501          UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       MBKUT010
00502                    OR SQLCODE = 0                                 MBKUT010
00503                    OR SQLCODE = +100)                             MBKUT010
00504                                                                   MBKUT010
00505          EXEC SQL                                                 MBKUT010
00506               DELETE                                              MBKUT010
00507               FROM                                                MBKUT010
00508                    TRSPBAR                                        MBKUT010
00509               WHERE                                               MBKUT010
00510                    (OPERCO_NBR      =  :PV-CR-COMPANY                CL**2
00511                AND  WORKER_END_DTE  <  :PV-RSPBAR-PURGE-DATE         CL**2
00512                AND (RSPLVL_CDE     ^=  :PC-GMM                       CL**2
00513                AND  RSPLVL_CDE     ^=  :PC-DMM                       CL**2
00514                AND  RSPLVL_CDE     ^=  :PC-BYR))                     CL**2
00515          END-EXEC                                                 MBKUT010
00516                                                                   MBKUT010
00517          EVALUATE TRUE                                            MBKUT010
00518              WHEN SQLCODE = -904                                  MBKUT010
00519              WHEN SQLCODE = -911                                  MBKUT010
00520              WHEN SQLCODE = +100                                  MBKUT010
00521              WHEN SQLCODE = 0                                     MBKUT010
00522                  CONTINUE                                         MBKUT010
00523              WHEN SQLWARN NOT = SPACES                            MBKUT010
00524              WHEN SQLCODE NOT = ZERO                              MBKUT010
00525                  MOVE '4000-PURGE-RSPBAR-GLOBAL'                  MBKUT010
00526                                TO  PV-PARAGRAPH-NAME              MBKUT010
00527                  MOVE 'DELETE FOR TRSPBAR - GLOBAL'               MBKUT010
00528                                TO  PV-DB2-OPER-ATTEMPTED          MBKUT010
00529                  PERFORM 9900-SQL-ABEND                           MBKUT010
00530          END-EVALUATE                                             MBKUT010
00531      END-PERFORM.                                                 MBKUT010
00532                                                                   MBKUT010
00533      IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        MBKUT010
00534          MOVE '4000-PURGE-RSPBAR-GLOBAL'                          MBKUT010
00535                                TO  PV-PARAGRAPH-NAME              MBKUT010
00536          MOVE 'DELETE RETRIES EXCEEDED'                           MBKUT010
00537                                TO  PV-DB2-OPER-ATTEMPTED          MBKUT010
00538          PERFORM 9900-SQL-ABEND                                   MBKUT010
00539      END-IF.                                                      MBKUT010
                                                                                
0923RM     ADD SQLERRD(3)        TO  PV-RSPBAR-COUNT.                           
00540                                                                   MBKUT010
0923RM*    DISPLAY '* * * * * * * * * * * * * * * * *'.                 MBKUT010
0923RM*    DISPLAY '*                               *'.                 MBKUT010
0923RM*    DISPLAY '* '                                                 MBKUT010
0923RM*            SQLERRD(3)                                           MBKUT010
0923RM*            ' RSPBAR ROWS DELETED *'.                            MBKUT010
0923RM*    DISPLAY '*                               *'.                 MBKUT010
0923RM*    DISPLAY '* * * * * * * * * * * * * * * * *'.                 MBKUT010
00548                                                                   MBKUT010
00549  EJECT                                                            MBKUT010
00550 *--------------------------------------------------------------*  MBKUT010
00551 *                                                              *  MBKUT010
00552 *    PROCESS THE OPEN, FETCH, AND CLOSE FROM HERE.             *  MBKUT010
00553 *                                                              *  MBKUT010
00554 *--------------------------------------------------------------*  MBKUT010
00555                                                                   MBKUT010
00556  5000-PROCESS-MDSEAR-CURSOR.                                      MBKUT010
00557                                                                   MBKUT010
00558      PERFORM 5100-OPEN-MDSEAR-CURSOR.                             MBKUT010
00559      SET PS-NOT-END-OF-DATA    TO  TRUE.                          MBKUT010
00560      PERFORM 5200-RETRIEVE-CURSOR UNTIL PS-END-OF-DATA.           MBKUT010
00561      PERFORM 5300-CLOSE-MDSEAR-CURSOR.                            MBKUT010
00562                                                                   MBKUT010
00563  EJECT                                                            MBKUT010
00564 *--------------------------------------------------------------*  MBKUT010
00565 *                                                              *  MBKUT010
00566 *    HERE WE ONLY OPEN THE CURSOR.                             *  MBKUT010
00567 *                                                              *  MBKUT010
00568 *--------------------------------------------------------------*  MBKUT010
00569                                                                   MBKUT010
00570  5100-OPEN-MDSEAR-CURSOR.                                         MBKUT010
00571                                                                   MBKUT010
00572      PERFORM                                                      MBKUT010
00573          WITH TEST AFTER                                          MBKUT010
00574          VARYING PV-SQL-SUB                                       MBKUT010
00575          FROM 1 BY 1                                              MBKUT010
00576          UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       MBKUT010
00577                    OR SQLCODE = 0                                 MBKUT010
00578                    OR SQLCODE = +100)                             MBKUT010
00579          EXEC SQL                                                 MBKUT010
00580              OPEN MERCH-LIST                                      MBKUT010
00581          END-EXEC                                                 MBKUT010
00582          EVALUATE TRUE                                            MBKUT010
00583              WHEN SQLCODE = -904                                  MBKUT010
00584              WHEN SQLCODE = -911                                  MBKUT010
00585              WHEN SQLCODE = +100                                  MBKUT010
00586              WHEN SQLCODE = 0                                     MBKUT010
00587                  CONTINUE                                         MBKUT010
00588              WHEN SQLWARN NOT = SPACES                            MBKUT010
00589              WHEN SQLCODE NOT = ZERO                              MBKUT010
00590                  MOVE '5100-OPEN-MDSEAR-CURSOR'                   MBKUT010
00591                                TO  PV-PARAGRAPH-NAME              MBKUT010
00592                  MOVE 'OPEN ON MDSEAR CURSOR'                     MBKUT010
00593                                TO  PV-DB2-OPER-ATTEMPTED          MBKUT010
00594                  PERFORM 9900-SQL-ABEND                           MBKUT010
00595          END-EVALUATE                                             MBKUT010
00596      END-PERFORM.                                                 MBKUT010
00597                                                                   MBKUT010
00598      IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        MBKUT010
00599          MOVE '5100-OPEN-MDSEAR-CURSOR'                           MBKUT010
00600                                TO  PV-PARAGRAPH-NAME              MBKUT010
00601          MOVE 'OPEN RETRIES EXCEEDED'                             MBKUT010
00602                                TO  PV-DB2-OPER-ATTEMPTED          MBKUT010
00603          PERFORM 9900-SQL-ABEND                                   MBKUT010
00604      END-IF.                                                      MBKUT010
00605                                                                   MBKUT010
00606  EJECT                                                            MBKUT010
00607 *--------------------------------------------------------------*  MBKUT010
00608 *                                                              *  MBKUT010
00609 *    THIS ROUTINE INVOKES RETRIEVE A ROW AND PERFORMS THE      *  MBKUT010
00610 *    5400 AND 5500 ROUTINES WHICH CONTAIN THE LOGIC TO DELETE  *  MBKUT010
00611 *    APPLICABLE ROWS.                                          *  MBKUT010
00612 *                                                              *  MBKUT010
00613 *--------------------------------------------------------------*  MBKUT010
00614                                                                   MBKUT010
00615  5200-RETRIEVE-CURSOR.                                            MBKUT010
00616                                                                   MBKUT010
00617      PERFORM                                                      MBKUT010
00618          WITH TEST AFTER                                          MBKUT010
00619          VARYING PV-SQL-SUB                                       MBKUT010
00620          FROM 1 BY 1                                              MBKUT010
00621          UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       MBKUT010
00622                    OR SQLCODE = 0                                 MBKUT010
00623                    OR SQLCODE = +100)                             MBKUT010
00624                                                                   MBKUT010
00625          EXEC SQL                                                 MBKUT010
00626              FETCH                                                MBKUT010
00627                    MERCH-LIST                                     MBKUT010
00628               INTO                                                MBKUT010
00629                    :MDSEAR-GMA-NBR                                MBKUT010
00630                  , :MDSEAR-DMA-NBR                                MBKUT010
00631                  , :MDSEAR-DEPT-NBR                               MBKUT010
00632                  , :MDSEAR-MAJ-CL-NBR                             MBKUT010
00633                  , :MDSEAR-SUB-CL-NBR                             MBKUT010
00634                  , :MDSEAR-MDSELV-CDE                             MBKUT010
00635                  , :MDSEAR-DKEY                                   MBKUT010
00636                  , :MDSEAR-LIST-SEQ-NBR                           MBKUT010
00637          END-EXEC                                                 MBKUT010
00638                                                                   MBKUT010
00639          EVALUATE TRUE                                            MBKUT010
00640              WHEN SQLCODE = -904                                  MBKUT010
00641              WHEN SQLCODE = -911                                  MBKUT010
00642              WHEN SQLCODE = +100                                  MBKUT010
00643              WHEN SQLCODE = 0                                     MBKUT010
00644                  CONTINUE                                         MBKUT010
00645              WHEN SQLWARN NOT = SPACES                            MBKUT010
00646              WHEN SQLCODE NOT = ZERO                              MBKUT010
00647                  MOVE '5200-RETRIEVE-CURSOR'                      MBKUT010
00648                                TO  PV-PARAGRAPH-NAME              MBKUT010
00649                  MOVE 'FETCH MERCH-LIST CURSOR'                   MBKUT010
00650                                TO  PV-DB2-OPER-ATTEMPTED          MBKUT010
00651                  PERFORM 9900-SQL-ABEND                           MBKUT010
00652          END-EVALUATE                                             MBKUT010
00653      END-PERFORM.                                                 MBKUT010
00654                                                                   MBKUT010
00655      IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        MBKUT010
00656          MOVE '5200-RETRIEVE-CURSOR'                              MBKUT010
00657                                TO  PV-PARAGRAPH-NAME              MBKUT010
00658          MOVE 'FETCH RETRIES EXCEEDED'                            MBKUT010
00659                                TO  PV-DB2-OPER-ATTEMPTED          MBKUT010
00660          PERFORM 9900-SQL-ABEND                                   MBKUT010
00661      END-IF.                                                      MBKUT010
00662                                                                   MBKUT010
00663      IF  SQLCODE EQUAL ZERO                                       MBKUT010
00664          PERFORM 5500-DELETE-LOGIC                                MBKUT010
00665          ADD 1                 TO  PV-COMMIT-COUNT                MBKUT010
00666          IF  PV-COMMIT-COUNT GREATER THAN PC-COMMIT-MAX           MBKUT010
00667              PERFORM 5300-CLOSE-MDSEAR-CURSOR                     MBKUT010
00668              PERFORM 5600-COMMIT                                  MBKUT010
00669              PERFORM 5100-OPEN-MDSEAR-CURSOR                      MBKUT010
00670              MOVE ZERO         TO  PV-COMMIT-COUNT                MBKUT010
00671          END-IF                                                   MBKUT010
00672      ELSE                                                         MBKUT010
00673          SET PS-END-OF-DATA    TO  TRUE                           MBKUT010
00674      END-IF.                                                      MBKUT010
00675                                                                   MBKUT010
00676  EJECT                                                            MBKUT010
00677 *--------------------------------------------------------------*  MBKUT010
00678 *                                                              *  MBKUT010
00679 *    CLOSE THE MERCH-LIST CURSOR.                              *  MBKUT010
00680 *                                                              *  MBKUT010
00681 *--------------------------------------------------------------*  MBKUT010
00682                                                                   MBKUT010
00683  5300-CLOSE-MDSEAR-CURSOR.                                        MBKUT010
00684                                                                   MBKUT010
00685      PERFORM                                                      MBKUT010
00686          WITH TEST AFTER                                          MBKUT010
00687          VARYING PV-SQL-SUB                                       MBKUT010
00688          FROM 1 BY 1                                              MBKUT010
00689          UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       MBKUT010
00690                    OR SQLCODE = 0)                                MBKUT010
00691          EXEC SQL                                                 MBKUT010
00692             CLOSE MERCH-LIST                                      MBKUT010
00693          END-EXEC                                                 MBKUT010
00694          EVALUATE TRUE                                            MBKUT010
00695              WHEN SQLCODE = -904                                  MBKUT010
00696              WHEN SQLCODE = -911                                  MBKUT010
00697              WHEN SQLCODE = 0                                     MBKUT010
00698                  CONTINUE                                         MBKUT010
00699              WHEN SQLWARN NOT = SPACES                            MBKUT010
00700              WHEN SQLCODE NOT = ZERO                              MBKUT010
00701                  MOVE '5300-CLOSE-MDSEAR-CURSOR'                  MBKUT010
00702                                TO  PV-PARAGRAPH-NAME              MBKUT010
00703                  MOVE 'CLOSE ON MDSEAR CURSOR'                    MBKUT010
00704                                TO  PV-DB2-OPER-ATTEMPTED          MBKUT010
00705                  PERFORM 9900-SQL-ABEND                           MBKUT010
00706          END-EVALUATE                                             MBKUT010
00707      END-PERFORM.                                                 MBKUT010
00708                                                                   MBKUT010
00709      IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        MBKUT010
00710          MOVE '5300-CLOSE-MDSEAR-CURSOR'                          MBKUT010
00711                                TO  PV-PARAGRAPH-NAME              MBKUT010
00712          MOVE 'CLOSE RETRIES EXCEEDED'                            MBKUT010
00713                                TO  PV-DB2-OPER-ATTEMPTED          MBKUT010
00714          PERFORM 9900-SQL-ABEND                                   MBKUT010
00715      END-IF.                                                      MBKUT010
00716                                                                   MBKUT010
00717  EJECT                                                            MBKUT010
00718 *--------------------------------------------------------------*  MBKUT010
00719 *                                                              *  MBKUT010
00720 *    FINALLY, WE REACH THE PARAGRAPH THAT CONTROLS THE ACTUAL  *  MBKUT010
00721 *    DELETE PROCESS, BY ROW, FOR THE APPLICABLE TABLES.        *  MBKUT010
00722 *                                                              *  MBKUT010
00723 *--------------------------------------------------------------*  MBKUT010
00724                                                                   MBKUT010
00725  5500-DELETE-LOGIC.                                               MBKUT010
00726                                                                   MBKUT010
00727      IF (MDSEAR-MDSELV-CDE EQUAL PC-GMA                           MBKUT010
00728      OR  PC-DMA                                                   MBKUT010
00729      OR  PC-DPT)                                                  MBKUT010
00730          PERFORM 5510-DELETE-RSPBAR                               MBKUT010
00731      END-IF.                                                      MBKUT010
00732                                                                   MBKUT010
00733      IF  MDSEAR-MDSELV-CDE EQUAL PC-DPT                           MBKUT010
00734          PERFORM 5520-DELETE-MDSEDP                               MBKUT010
00735      END-IF.                                                      MBKUT010
00736                                                                   MBKUT010
00737      IF  MDSEAR-MDSELV-CDE EQUAL PC-SCL                           MBKUT010
00738          PERFORM 5530-DELETE-MDSECL                               MBKUT010
00739      END-IF.                                                      MBKUT010
00740                                                                   MBKUT010
00741      PERFORM 5540-DELETE-APLAVL-ACTIVE.                           MBKUT010
00742                                                                   MBKUT010
00743      PERFORM 5560-DELETE-MDSEAR.                                  MBKUT010
00744                                                                   MBKUT010
00745  EJECT                                                            MBKUT010
00746 *--------------------------------------------------------------*  MBKUT010
00747 *                                                              *  MBKUT010
00748 *    DELETE THE RSPBAR ROWS THAT MATCH THE DATALESS KEY AND    *  MBKUT010
00749 *    MEET THE DATE CRITERION.                                  *  MBKUT010
00750 *                                                              *  MBKUT010
00751 *--------------------------------------------------------------*  MBKUT010
00752                                                                   MBKUT010
00753  5510-DELETE-RSPBAR.                                              MBKUT010
00754                                                                   MBKUT010
00755      PERFORM                                                      MBKUT010
00756          WITH TEST AFTER                                          MBKUT010
00757          VARYING PV-SQL-SUB                                       MBKUT010
00758          FROM 1 BY 1                                              MBKUT010
00759          UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       MBKUT010
00760                    OR SQLCODE = 0                                 MBKUT010
00761                    OR SQLCODE = +100)                             MBKUT010
00762                                                                   MBKUT010
00763          EXEC SQL                                                 MBKUT010
00764               DELETE                                              MBKUT010
00765               FROM                                                MBKUT010
00766                    TRSPBAR                                        MBKUT010
00767               WHERE                                               MBKUT010
00768                    OPERCO_NBR      =  :PV-CR-COMPANY              MBKUT010
00769                AND MDSEAR_DKEY     =  :MDSEAR-DKEY                MBKUT010
00770                AND WORKER_END_DTE  <  :PV-MDSEAR-PURGE-DATE       MBKUT010
00771          END-EXEC                                                 MBKUT010
00772                                                                   MBKUT010
00773          EVALUATE TRUE                                            MBKUT010
00774              WHEN SQLCODE = -904                                  MBKUT010
00775              WHEN SQLCODE = -911                                  MBKUT010
00776              WHEN SQLCODE = +100                                  MBKUT010
00777              WHEN SQLCODE = 0                                     MBKUT010
00778                  CONTINUE                                         MBKUT010
00779              WHEN SQLWARN NOT = SPACES                            MBKUT010
00780              WHEN SQLCODE NOT = ZERO                              MBKUT010
00781                  MOVE '5510-DELETE-RSPBAR'                        MBKUT010
00782                                TO  PV-PARAGRAPH-NAME              MBKUT010
00783                  MOVE 'DELETE FOR RSPBAR'                         MBKUT010
00784                                TO  PV-DB2-OPER-ATTEMPTED          MBKUT010
00785                  PERFORM 9900-SQL-ABEND                           MBKUT010
00786          END-EVALUATE                                             MBKUT010
00787      END-PERFORM.                                                 MBKUT010
00788                                                                   MBKUT010
00789      IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        MBKUT010
00790          MOVE '5510-DELETE-RSPBAR'                                MBKUT010
00791                                TO  PV-PARAGRAPH-NAME              MBKUT010
00792          MOVE 'DELETE RETRIES EXCEEDED'                           MBKUT010
00793                                TO  PV-DB2-OPER-ATTEMPTED          MBKUT010
00794          PERFORM 9900-SQL-ABEND                                   MBKUT010
00795      END-IF.                                                      MBKUT010
00796                                                                   MBKUT010
00797      IF  SQLCODE EQUAL ZERO                                       MBKUT010
00798          ADD SQLERRD(3)        TO  PV-RSPBAR-COUNT                MBKUT010
00799      END-IF.                                                      MBKUT010
00800                                                                   MBKUT010
00801  EJECT                                                            MBKUT010
00802 *--------------------------------------------------------------*  MBKUT010
00803 *                                                              *  MBKUT010
00804 *    DELETE THE RSPBAR ROWS THAT MATCH THE DATALESS KEY.       *  MBKUT010
00805 *                                                              *  MBKUT010
00806 *--------------------------------------------------------------*  MBKUT010
00807                                                                   MBKUT010
00808  5520-DELETE-MDSEDP.                                              MBKUT010
00809                                                                   MBKUT010
00810      PERFORM                                                      MBKUT010
00811          WITH TEST AFTER                                          MBKUT010
00812          VARYING PV-SQL-SUB                                       MBKUT010
00813          FROM 1 BY 1                                              MBKUT010
00814          UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       MBKUT010
00815                    OR SQLCODE = 0                                 MBKUT010
00816                    OR SQLCODE = +100)                             MBKUT010
00817                                                                   MBKUT010
00818          EXEC SQL                                                 MBKUT010
00819               DELETE                                              MBKUT010
00820               FROM                                                MBKUT010
00821                    TMDSEDP                                        MBKUT010
00822               WHERE                                               MBKUT010
00823                    MDSEAR_DKEY     =  :MDSEAR-DKEY                MBKUT010
00824          END-EXEC                                                 MBKUT010
00825                                                                   MBKUT010
00826          EVALUATE TRUE                                            MBKUT010
00827              WHEN SQLCODE = -904                                  MBKUT010
00828              WHEN SQLCODE = -911                                  MBKUT010
00829              WHEN SQLCODE = +100                                  MBKUT010
00830              WHEN SQLCODE = 0                                     MBKUT010
00831                  CONTINUE                                         MBKUT010
00832              WHEN SQLWARN NOT = SPACES                            MBKUT010
00833              WHEN SQLCODE NOT = ZERO                              MBKUT010
00834                  MOVE '5520-DELETE-MDSEDP'                        MBKUT010
00835                                TO  PV-PARAGRAPH-NAME              MBKUT010
00836                  MOVE 'DELETE FOR MDSEDP'                         MBKUT010
00837                                TO  PV-DB2-OPER-ATTEMPTED          MBKUT010
00838                  PERFORM 9900-SQL-ABEND                           MBKUT010
00839          END-EVALUATE                                             MBKUT010
00840      END-PERFORM.                                                 MBKUT010
00841                                                                   MBKUT010
00842      IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        MBKUT010
00843          MOVE '5520-DELETE-MDSEDP'                                MBKUT010
00844                                TO  PV-PARAGRAPH-NAME              MBKUT010
00845          MOVE 'DELETE RETRIES EXCEEDED'                           MBKUT010
00846                                TO  PV-DB2-OPER-ATTEMPTED          MBKUT010
00847          PERFORM 9900-SQL-ABEND                                   MBKUT010
00848      END-IF.                                                      MBKUT010
00849                                                                   MBKUT010
00850      IF  SQLCODE EQUAL ZERO                                       MBKUT010
00851          ADD SQLERRD(3)        TO  PV-MDSEDP-COUNT                MBKUT010
00852      END-IF.                                                      MBKUT010
00853                                                                   MBKUT010
00854  EJECT                                                            MBKUT010
00855 *--------------------------------------------------------------*  MBKUT010
00856 *                                                              *  MBKUT010
00857 *    DELETE THE MDSECL ROWS THAT MATCH THE DATALESS KEY.       *  MBKUT010
00858 *                                                              *  MBKUT010
00859 *--------------------------------------------------------------*  MBKUT010
00860                                                                   MBKUT010
00861  5530-DELETE-MDSECL.                                              MBKUT010
00862                                                                   MBKUT010
00863      PERFORM                                                      MBKUT010
00864          WITH TEST AFTER                                          MBKUT010
00865          VARYING PV-SQL-SUB                                       MBKUT010
00866          FROM 1 BY 1                                              MBKUT010
00867          UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       MBKUT010
00868                    OR SQLCODE = 0                                 MBKUT010
00869                    OR SQLCODE = +100)                             MBKUT010
00870                                                                   MBKUT010
00871          EXEC SQL                                                 MBKUT010
00872               DELETE                                              MBKUT010
00873               FROM                                                MBKUT010
00874                    TMDSECL                                        MBKUT010
00875               WHERE                                               MBKUT010
00876                    MDSEAR_DKEY     =  :MDSEAR-DKEY                MBKUT010
00877          END-EXEC                                                 MBKUT010
00878                                                                   MBKUT010
00879          EVALUATE TRUE                                            MBKUT010
00880              WHEN SQLCODE = -904                                  MBKUT010
00881              WHEN SQLCODE = -911                                  MBKUT010
00882              WHEN SQLCODE = +100                                  MBKUT010
00883              WHEN SQLCODE = 0                                     MBKUT010
00884                  CONTINUE                                         MBKUT010
00885              WHEN SQLWARN NOT = SPACES                            MBKUT010
00886              WHEN SQLCODE NOT = ZERO                              MBKUT010
00887                  MOVE '5530-DELETE-MDSECL'                        MBKUT010
00888                                TO  PV-PARAGRAPH-NAME              MBKUT010
00889                  MOVE 'DELETE FOR MDSECL'                         MBKUT010
00890                                TO  PV-DB2-OPER-ATTEMPTED          MBKUT010
00891                  PERFORM 9900-SQL-ABEND                           MBKUT010
00892          END-EVALUATE                                             MBKUT010
00893      END-PERFORM.                                                 MBKUT010
00894                                                                   MBKUT010
00895      IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        MBKUT010
00896          MOVE '5530-DELETE-MDSECL'                                MBKUT010
00897                                TO  PV-PARAGRAPH-NAME              MBKUT010
00898          MOVE 'DELETE RETRIES EXCEEDED'                           MBKUT010
00899                                TO  PV-DB2-OPER-ATTEMPTED          MBKUT010
00900          PERFORM 9900-SQL-ABEND                                   MBKUT010
00901      END-IF.                                                      MBKUT010
00902                                                                   MBKUT010
00903      IF  SQLCODE EQUAL ZERO                                       MBKUT010
00904          ADD SQLERRD(3)        TO  PV-MDSECL-COUNT                MBKUT010
00905      END-IF.                                                      MBKUT010
00906                                                                   MBKUT010
00907  EJECT                                                            MBKUT010
00908 *--------------------------------------------------------------*  MBKUT010
00909 *                                                              *  MBKUT010
00910 *    DELETE THE APLAVL ROWS THAT MATCH THE DATALESS KEY AND    *  MBKUT010
00911 *    MEET THE DATE CRITERION.  THERE ARE SOME ACTIVE ROWS      *  MBKUT010
00912 *    ON THE TABLE, THEREFORE, DELETE ONLY THOSE THAT ARE       *  MBKUT010
00913 *    INACTIVE.                                                 *  MBKUT010
00914 *                                                              *  MBKUT010
00915 *--------------------------------------------------------------*  MBKUT010
00916                                                                   MBKUT010
00917  5540-DELETE-APLAVL-ACTIVE.                                       MBKUT010
00918                                                                   MBKUT010
00919      PERFORM                                                      MBKUT010
00920          WITH TEST AFTER                                          MBKUT010
00921          VARYING PV-SQL-SUB                                       MBKUT010
00922          FROM 1 BY 1                                              MBKUT010
00923          UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       MBKUT010
00924                    OR SQLCODE = 0                                 MBKUT010
00925                    OR SQLCODE = +100)                             MBKUT010
00926                                                                   MBKUT010
00927          EXEC SQL                                                 MBKUT010
00928               DELETE                                              MBKUT010
00929               FROM                                                MBKUT010
00930                    TAPLAVL                                        MBKUT010
00931               WHERE                                               MBKUT010
00932                    MDSEAR_DKEY     =  :MDSEAR-DKEY                MBKUT010
00933                AND MDSEAR_END_DTE  <  :PV-MDSEAR-PURGE-DATE       MBKUT010
00934          END-EXEC                                                 MBKUT010
00935                                                                   MBKUT010
00936          EVALUATE TRUE                                            MBKUT010
00937              WHEN SQLCODE = -904                                  MBKUT010
00938              WHEN SQLCODE = -911                                  MBKUT010
00939              WHEN SQLCODE = +100                                  MBKUT010
00940              WHEN SQLCODE = 0                                     MBKUT010
00941                  CONTINUE                                         MBKUT010
00942              WHEN SQLWARN NOT = SPACES                            MBKUT010
00943              WHEN SQLCODE NOT = ZERO                              MBKUT010
00944                  MOVE '5540-DELETE-APLAVL-ACTIVE'                 MBKUT010
00945                                TO  PV-PARAGRAPH-NAME              MBKUT010
00946                  MOVE 'DELETE FOR APLAVL'                         MBKUT010
00947                                TO  PV-DB2-OPER-ATTEMPTED          MBKUT010
00948                  PERFORM 9900-SQL-ABEND                           MBKUT010
00949          END-EVALUATE                                             MBKUT010
00950      END-PERFORM.                                                 MBKUT010
00951                                                                   MBKUT010
00952      IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        MBKUT010
00953          MOVE '5540-DELETE-APLAVL-ACTIVE'                         MBKUT010
00954                                TO  PV-PARAGRAPH-NAME              MBKUT010
00955          MOVE 'DELETE RETRIES EXCEEDED'                           MBKUT010
00956                                TO  PV-DB2-OPER-ATTEMPTED          MBKUT010
00957          PERFORM 9900-SQL-ABEND                                   MBKUT010
00958      END-IF.                                                      MBKUT010
00959                                                                   MBKUT010
00960      IF  SQLCODE EQUAL ZERO                                       MBKUT010
00961          ADD SQLERRD(3)        TO  PV-APLAVL-COUNT                MBKUT010
00962      END-IF.                                                      MBKUT010
00963                                                                   MBKUT010
00964  EJECT                                                            MBKUT010
00965 *--------------------------------------------------------------*  MBKUT010
00966 *                                                              *  MBKUT010
00967 *    DELETE THE APLAVL ROWS THAT MATCH THE DATALESS KEY.       *  MBKUT010
00968 *    ONLY INACTIVE ROWS EXIST, THEREFORE, NO DATE CRITERION    *  MBKUT010
00969 *    IS REQUIRED.                                              *  MBKUT010
00970 *                                                              *  MBKUT010
00971 *--------------------------------------------------------------*  MBKUT010
00972                                                                   MBKUT010
00973  5550-DELETE-APLAVL-INACTIVE.                                     MBKUT010
00974                                                                   MBKUT010
00975      PERFORM                                                      MBKUT010
00976          WITH TEST AFTER                                          MBKUT010
00977          VARYING PV-SQL-SUB                                       MBKUT010
00978          FROM 1 BY 1                                              MBKUT010
00979          UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       MBKUT010
00980                    OR SQLCODE = 0                                 MBKUT010
00981                    OR SQLCODE = +100)                             MBKUT010
00982                                                                   MBKUT010
00983          EXEC SQL                                                 MBKUT010
00984               DELETE                                              MBKUT010
00985               FROM                                                MBKUT010
00986                    TAPLAVL                                        MBKUT010
00987               WHERE                                               MBKUT010
00988                    MDSEAR_DKEY     =  :MDSEAR-DKEY                MBKUT010
00989          END-EXEC                                                 MBKUT010
00990                                                                   MBKUT010
00991          EVALUATE TRUE                                            MBKUT010
00992              WHEN SQLCODE = -904                                  MBKUT010
00993              WHEN SQLCODE = -911                                  MBKUT010
00994              WHEN SQLCODE = +100                                  MBKUT010
00995              WHEN SQLCODE = 0                                     MBKUT010
00996                  CONTINUE                                         MBKUT010
00997              WHEN SQLWARN NOT = SPACES                            MBKUT010
00998              WHEN SQLCODE NOT = ZERO                              MBKUT010
00999                  MOVE '5550-DELETE-APLAVL-INACTIVE'               MBKUT010
01000                                TO  PV-PARAGRAPH-NAME              MBKUT010
01001                  MOVE 'DELETE FOR APLAVL'                         MBKUT010
01002                                TO  PV-DB2-OPER-ATTEMPTED          MBKUT010
01003                  PERFORM 9900-SQL-ABEND                           MBKUT010
01004          END-EVALUATE                                             MBKUT010
01005      END-PERFORM.                                                 MBKUT010
01006                                                                   MBKUT010
01007      IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        MBKUT010
01008          MOVE '5550-DELETE-APLAVL-INACTIVE'                       MBKUT010
01009                                TO  PV-PARAGRAPH-NAME              MBKUT010
01010          MOVE 'DELETE RETRIES EXCEEDED'                           MBKUT010
01011                                TO  PV-DB2-OPER-ATTEMPTED          MBKUT010
01012          PERFORM 9900-SQL-ABEND                                   MBKUT010
01013      END-IF.                                                      MBKUT010
01014                                                                   MBKUT010
01015      IF  SQLCODE EQUAL ZERO                                       MBKUT010
01016          ADD SQLERRD(3)        TO  PV-APLAVL-COUNT                MBKUT010
01017      END-IF.                                                      MBKUT010
01018                                                                   MBKUT010
01019  EJECT                                                            MBKUT010
01020 *--------------------------------------------------------------*  MBKUT010
01021 *                                                              *  MBKUT010
01022 *    DELETE THE MDSEAR ROWS THAT MATCH THE DATALESS KEY.       *  MBKUT010
01023 *    ALSO, THE DATE CRITERION IS REQUIRED.                     *  MBKUT010
01024 *                                                              *  MBKUT010
01025 *--------------------------------------------------------------*  MBKUT010
01026                                                                   MBKUT010
01027  5560-DELETE-MDSEAR.                                              MBKUT010
01028                                                                   MBKUT010
01029      PERFORM                                                      MBKUT010
01030          WITH TEST AFTER                                          MBKUT010
01031          VARYING PV-SQL-SUB                                       MBKUT010
01032          FROM 1 BY 1                                              MBKUT010
01033          UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       MBKUT010
01034                    OR SQLCODE = 0                                 MBKUT010
01035                    OR SQLCODE = +100)                             MBKUT010
01036                                                                   MBKUT010
01037          EXEC SQL                                                 MBKUT010
01038               DELETE                                              MBKUT010
01039               FROM                                                MBKUT010
01040                    TMDSEAR                                        MBKUT010
01041               WHERE                                               MBKUT010
01042                    MDSEAR_DKEY     =  :MDSEAR-DKEY                MBKUT010
01043                AND END_DTE         <  :PV-MDSEAR-PURGE-DATE       MBKUT010
01044          END-EXEC                                                 MBKUT010
01045                                                                   MBKUT010
01046          EVALUATE TRUE                                            MBKUT010
01047              WHEN SQLCODE = -904                                  MBKUT010
01048              WHEN SQLCODE = -911                                  MBKUT010
01049              WHEN SQLCODE = +100                                  MBKUT010
01050              WHEN SQLCODE = 0                                     MBKUT010
01051                  CONTINUE                                         MBKUT010
01052              WHEN SQLWARN NOT = SPACES                            MBKUT010
01053              WHEN SQLCODE NOT = ZERO                              MBKUT010
01054                  MOVE '5560-DELETE-MDSEAR'                        MBKUT010
01055                                TO  PV-PARAGRAPH-NAME              MBKUT010
01056                  MOVE 'DELETE FOR MDSEAR'                         MBKUT010
01057                                TO  PV-DB2-OPER-ATTEMPTED          MBKUT010
01058                  PERFORM 9900-SQL-ABEND                           MBKUT010
01059          END-EVALUATE                                             MBKUT010
01060      END-PERFORM.                                                 MBKUT010
01061                                                                   MBKUT010
01062      IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        MBKUT010
01063          MOVE '5560-DELETE-MDSEAR'                                MBKUT010
01064                                TO  PV-PARAGRAPH-NAME              MBKUT010
01065          MOVE 'DELETE RETRIES EXCEEDED'                           MBKUT010
01066                                TO  PV-DB2-OPER-ATTEMPTED          MBKUT010
01067          PERFORM 9900-SQL-ABEND                                   MBKUT010
01068      END-IF.                                                      MBKUT010
01069                                                                   MBKUT010
01070      IF  SQLCODE EQUAL ZERO                                       MBKUT010
01071          ADD SQLERRD(3)        TO  PV-MDSEAR-COUNT                MBKUT010
01072      END-IF.                                                      MBKUT010
01073                                                                   MBKUT010
01074  EJECT                                                            MBKUT010
01075 *--------------------------------------------------------------*  MBKUT010
01076 *                                                              *  MBKUT010
01077 *    COMMIT THE CHANGES EVERY PC-COMMIT MAX UPDATES.           *  MBKUT010
01078 *                                                              *  MBKUT010
01079 *--------------------------------------------------------------*  MBKUT010
01080                                                                   MBKUT010
01081  5600-COMMIT.                                                     MBKUT010
01082                                                                   MBKUT010
01083      PERFORM                                                      MBKUT010
01084          WITH TEST AFTER                                          MBKUT010
01085          VARYING PV-SQL-SUB                                       MBKUT010
01086          FROM 1 BY 1                                              MBKUT010
01087          UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                       MBKUT010
01088                    OR SQLCODE = 0)                                MBKUT010
01089                                                                   MBKUT010
01090          EXEC SQL                                                 MBKUT010
01091             COMMIT                                                MBKUT010
01092          END-EXEC                                                 MBKUT010
01093                                                                   MBKUT010
01094          EVALUATE TRUE                                            MBKUT010
01095              WHEN SQLCODE = -904                                  MBKUT010
01096              WHEN SQLCODE = -911                                  MBKUT010
01097              WHEN SQLCODE = 0                                     MBKUT010
01098                  CONTINUE                                         MBKUT010
01099              WHEN SQLWARN NOT = SPACES                            MBKUT010
01100              WHEN SQLCODE NOT = ZERO                              MBKUT010
01101                  MOVE '5600-COMMIT'                               MBKUT010
01102                                TO  PV-PARAGRAPH-NAME              MBKUT010
01103                  MOVE 'COMMIT FOR MDSEAR'                         MBKUT010
01104                                TO  PV-DB2-OPER-ATTEMPTED          MBKUT010
01105                  PERFORM 9900-SQL-ABEND                           MBKUT010
01106          END-EVALUATE                                             MBKUT010
01107      END-PERFORM.                                                 MBKUT010
01108                                                                   MBKUT010
01109      IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        MBKUT010
01110          MOVE '5600-COMMIT'                                       MBKUT010
01111                                TO  PV-PARAGRAPH-NAME              MBKUT010
01112          MOVE 'COMMIT RETRIES EXCEEDED'                           MBKUT010
01113                                TO  PV-DB2-OPER-ATTEMPTED          MBKUT010
01114          PERFORM 9900-SQL-ABEND                                   MBKUT010
01115      END-IF.                                                      MBKUT010
01116                                                                   MBKUT010
01117      ADD 1                     TO  PV-COMMITS-ISSUED.             MBKUT010
0923RM*    DISPLAY '* '.                                                MBKUT010
0923RM*    DISPLAY '* COMMIT ISSUED FOR '                               MBKUT010
0923RM*            DCLTMDSEAR.                                          MBKUT010
01121                                                                   MBKUT010
                                                                                
01123 *--------------------------------------------------------------*  MBKUT010
01124 *                                                              *  MBKUT010
01125 *    DISPLAY THE NUMBER OF ROWS DELETED VIA CURSOR PROCESSING. *  MBKUT010
01126 *                                                              *  MBKUT010
01127 *--------------------------------------------------------------*  MBKUT010
01128                                                                   MBKUT010
01129  9000-DISPLAY-TOTALS.                                             MBKUT010
01130                                                                   MBKUT010
01131      DISPLAY ' '.                                                 MBKUT010
01132      DISPLAY '* * * * * * * * * * * * * * *'.                     MBKUT010
01133      DISPLAY '*                           *'.                     MBKUT010
01134      DISPLAY '*   CURSOR ROWS DELETED:    *'.                     MBKUT010
01135      DISPLAY '*                           *'.                     MBKUT010
01136      DISPLAY '*  '                                                MBKUT010
01137              PV-MDSEAR-COUNT                                      MBKUT010
01138              ' MDSEAR ROWS    *'.                                 MBKUT010
01139      DISPLAY '*  '                                                MBKUT010
01140              PV-MDSECL-COUNT                                      MBKUT010
01141              ' MDSECL ROWS    *'.                                 MBKUT010
01142      DISPLAY '*  '                                                MBKUT010
01143              PV-MDSEDP-COUNT                                      MBKUT010
01144              ' MDSEDP ROWS    *'.                                 MBKUT010
01145      DISPLAY '*  '                                                MBKUT010
01146              PV-APLAVL-COUNT                                      MBKUT010
01147              ' APLAVL ROWS    *'.                                 MBKUT010
01148      DISPLAY '*  '                                                MBKUT010
01149              PV-RSPBAR-COUNT                                      MBKUT010
01150              ' RSPBAR ROWS    *'.                                 MBKUT010
01151      DISPLAY '*                           *'.                     MBKUT010
01152      DISPLAY '*  '                                                MBKUT010
01153              PV-COMMITS-ISSUED                                    MBKUT010
01154              ' COMMITS ISSUED *'.                                 MBKUT010
01155      DISPLAY '* * * * * * * * * * * * * * *'.                     MBKUT010
01156                                                                   MBKUT010
01157  EJECT                                                            MBKUT010
01158 *--------------------------------------------------------------*  MBKUT010
01159 *                                                              *  MBKUT010
01160 *    THIS ROUTINE FORCES AN ABEND DUE TO A DB2 PROBLEM.        *  MBKUT010
01161 *                                                              *  MBKUT010
01162 *--------------------------------------------------------------*  MBKUT010
01163                                                                   MBKUT010
01164  9900-SQL-ABEND.                                                  MBKUT010
01165                                                                   MBKUT010
01166      SET ABEND-4013             TO TRUE.                          MBKUT010
01167      DISPLAY '**  ABEND     **'.                                  MBKUT010
01168      DISPLAY '**  PROGRAM   **  =  MBKUT010'.                     MBKUT010
01169      DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            MBKUT010
01170      DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.        MBKUT010
01171                                                                   MBKUT010
01172 *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         MBKUT010
01173 *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        MBKUT010
01174                                                                   MBKUT010
01175      COPY DPPD004.                                                MBKUT010
01176                                                                   MBKUT010
01177      CALL 'ILBOABN0'  USING ABEND-CODE.                           MBKUT010
