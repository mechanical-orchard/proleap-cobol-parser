       IDENTIFICATION DIVISION.                                         00010001
       PROGRAM-ID.    TFKUT008.                                         00020003
       AUTHOR.        CHERI PARMLEY.                                    00030001
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040001
       DATE-WRITTEN.  07-12-2011.                                       00050001
       DATE-COMPILED.                                                   00060001
      ******************************************************************00070001
      **  GENCO WILL PASS BACK TO THE FAST TRANSFER SYSTEM A POSITIVE   00080001
      **  RECEIPT FILE WHICH SHALL ONLY CHANGE THE TRANSFER STATUS TO   00090001
      **  'POSITIVELY RECEIVED' AND WILL NOT TAKE ANY DISCREPANCIES     00100001
      **  FROM THE GENCO SYSTEM. THIS PGM WILL PROCESS FILE AND CREATE  00110001
      **  A FILE WHICH WILL THEN BE INPUT INTO THE CHECKPOINT/RESTART   00120001
      **  PROCESS. IT WILL THEN DO INSERTS TO THE TRANSFER TABLES.      00130001
      **  THREE OTHER OUTPUT FILES WILL BE CREATED FOR REPORTING.       00140001
      **  1. POSITIVELY RECEIVED FILE                                   00150001
      **  2. ERROR FILE - TRANSFERS NOT EXISTING OR ALREADY POSITIVELY  00160001
      **     RECEIVED OR DUPLICATES FROM THE INPUT FILE                 00170083
      **  3. MIS-DIRECTS - RECEIVED AT ANOTHER LOCATION FROM ORIGINAL   00180055
      ******************************************************************00190001
      **07/12/2011 CHANGED BY:  CHERI PARMLEY     WR#40189              00200001
      **           DESCRIPTION: INITIAL WRITE                           00210001
      ******************************************************************00220001
022812**02/28/2012 CHANGED BY:  CHERI PARMLEY     PR#3403               00221099
022812**           DESCRIPTION: COMPILE ONLY CHANGES TO TTFITEM TABLE   00222099
      ******************************************************************00223099
       ENVIRONMENT DIVISION.                                            00230001
       CONFIGURATION SECTION.                                           00240001
       SOURCE-COMPUTER.  IBM-3090.                                      00250001
       OBJECT-COMPUTER.  IBM-3090.                                      00260001
       INPUT-OUTPUT SECTION.                                            00270001
       FILE-CONTROL.                                                    00280001
                                                                        00290001
           SELECT CONTROL-CARD-DTE                                      00300001
                  ASSIGN TO INP01.                                      00310025
           SELECT GENCO-TRANS-FILE                                      00320025
                  ASSIGN TO INP02.                                      00330025
           SELECT POSITIVE-FILE                                         00340002
                  ASSIGN TO OUT01.                                      00350002
           SELECT ERROR-FILE                                            00360002
                  ASSIGN TO OUT02.                                      00370002
           SELECT MISDIRECT-FILE                                        00380002
                  ASSIGN TO OUT03.                                      00390002
           SELECT TRANS-INSERT-FILE                                     00400012
                  ASSIGN TO OUT04.                                      00410002
                                                                        00420001
       DATA DIVISION.                                                   00430001
       FILE SECTION.                                                    00440001
                                                                        00450001
       FD  CONTROL-CARD-DTE                                             00460001
           RECORDING MODE F                                             00470001
           LABEL RECORDS ARE STANDARD                                   00480001
           RECORD CONTAINS 80 CHARACTERS                                00490001
           BLOCK CONTAINS 0 RECORDS                                     00500001
           DATA RECORD IS CNTRL-CARD-DTE-REC.                           00510001
       01  CNTRL-CARD-DTE-REC   PIC  X(80).                             00520001
                                                                        00530001
       FD  GENCO-TRANS-FILE                                             00540012
           RECORDING MODE IS F                                          00550001
           LABEL RECORDS ARE STANDARD                                   00560001
           RECORD CONTAINS 150 CHARACTERS                               00570001
           BLOCK CONTAINS 0 RECORDS                                     00580001
           DATA RECORD IS TRANSFER-REC-IN.                              00590001
       01  TRANSFER-REC-IN                 PIC X(150).                  00600001
                                                                        00610001
018400 FD  POSITIVE-FILE                                                00620002
018500     RECORDING MODE F                                             00630002
018600     BLOCK CONTAINS 0 RECORDS                                     00640002
018700     LABEL RECORDS ARE OMITTED                                    00650002
018800     DATA RECORD IS POSITIVE-REC.                                 00660002
018900 01  POSITIVE-REC                     PIC X(200).                 00670002
                                                                        00680001
018400 FD  ERROR-FILE                                                   00690002
018500     RECORDING MODE F                                             00700002
018600     BLOCK CONTAINS 0 RECORDS                                     00710002
018700     LABEL RECORDS ARE OMITTED                                    00720002
018800     DATA RECORD IS ERROR-REC.                                    00730002
018900 01  ERROR-REC                        PIC X(200).                 00740002
                                                                        00750002
018400 FD  MISDIRECT-FILE                                               00760002
018500     RECORDING MODE F                                             00770002
018600     BLOCK CONTAINS 0 RECORDS                                     00780002
018700     LABEL RECORDS ARE OMITTED                                    00790002
018800     DATA RECORD IS MISDIRECT-REC.                                00800002
018900 01  MISDIRECT-REC                    PIC X(200).                 00810002
                                                                        00820002
018400 FD  TRANS-INSERT-FILE                                            00830002
018500     RECORDING MODE F                                             00840002
018600     BLOCK CONTAINS 0 RECORDS                                     00850002
018700     LABEL RECORDS ARE OMITTED                                    00860002
018800     DATA RECORD IS TRANS-INSERT-REC.                             00870012
018900 01  TRANS-INSERT-REC                 PIC X(130).                 00880002
                                                                        00890002
       WORKING-STORAGE SECTION.                                         00900001
      ******************************************************************00910001
      **PROGRAM SWITCHES                                                00920001
      ******************************************************************00930001
       01  PS-PROGRAM-SWITCHES.                                         00940001
           05  PS-END-OF-TRANS-FILE-SW     PIC X(01)    VALUE 'N'.      00950003
               88 PS-END-OF-TRANS-FILE                  VALUE 'Y'.      00960003
               88 PS-NOT-END-OF-TRANS-FILE              VALUE 'N'.      00970003
022500     05  PS-END-OF-CNTL-CRD-SW       PIC X(01).                   00980003
022600         88  PS-END-OF-CNTL-CRD-FILE              VALUE 'Y'.      00990003
022700         88  PS-NOT-END-OF-CNTL-CRD-FILE          VALUE 'N'.      01000003
           05  PS-TRANSFER-FOUND-SW        PIC X(01).                   01010003
               88  PS-TRANSFER-FOUND                    VALUE 'Y'.      01020003
               88  PS-TRANSFER-NOT-FOUND                VALUE 'N'.      01030003
           05  PS-TRANSFER-READY-SW        PIC X(01).                   01040007
               88  PS-TRANS-READY-TO-PROCESS            VALUE 'Y'.      01050008
               88  PS-TRANS-NOT-READY-TO-PROCESS        VALUE 'N'.      01060008
           05  PS-IS-MISDIRECT-TRANS-SW    PIC X(01).                   01070008
               88  PS-MISDIRECT                         VALUE 'Y'.      01080008
               88  PS-NOT-MISDIRECT                     VALUE 'N'.      01090008
           05  PS-XFER-ITMS-IND                PIC  X(01)  VALUE 'N'.   01100008
               88  PS-MORE-XFER-ITMS                       VALUE 'N'.   01110008
               88  PS-END-OF-XFER-ITMS                     VALUE 'Y'.   01120008
           05  PS-IS-UPC-FOUND                 PIC  X(01)  VALUE 'N'.   01130008
               88  PS-UPC-FOUND                            VALUE 'Y'.   01140008
               88  PS-UPC-NOT-FOUND                        VALUE 'N'.   01150008
           05  PS-IS-STAT-FOUND                PIC  X(01)  VALUE 'N'.   01160059
               88  PS-STAT-FOUND                           VALUE 'Y'.   01170059
               88  PS-STAT-NOT-FOUND                       VALUE 'N'.   01180059
      ******************************************************************01190003
      **TIME FIELDS                                                     01200003
      ******************************************************************01210003
       01  SD-TIME-STAMP                   PIC  X(26)  VALUE SPACES.    01220003
       01  FILLER REDEFINES SD-TIME-STAMP.                              01230003
           05  SD-CURR-DTE                 PIC  X(10).                  01240003
           05  FILLER                      PIC  X(01).                  01250003
           05  SD-HOUR                     PIC  X(02).                  01260003
           05  FILLER                      PIC  X(01).                  01270003
           05  SD-MINUTE                   PIC  X(02).                  01280003
           05  FILLER                      PIC  X(01).                  01290003
           05  SD-SECOND                   PIC  X(02).                  01300003
           05  FILLER                      PIC  X(01).                  01310003
           05  SD-MICROSEC                 PIC  X(06).                  01320003
      ******************************************************************01330001
      **PROGRAM VARIABLES                                               01340001
      ******************************************************************01350001
       01  PV-PROGRAM-VARIABLES.                                        01360001
           05  PV-CUR-RTL-AMT                  PIC S9(7)V9(2) COMP-3.   01370008
           05  PV-SKU-NBR                      PIC 9(08) VALUE ZERO.    01380010
           05  PV-DEPT-NBR                     PIC 9(04) VALUE ZERO.    01390010
           05  PV-SUB-CL-NBR                   PIC 9(02) VALUE ZERO.    01400010
           05  PV-TYP-DESC                     PIC X(20) VALUE SPACES.  01410029
           05  PV-HOLD-STR-NBR                 PIC 9(04) VALUE ZEROES.  01420061
           05  PV-HOLD-XFER-DKEY               PIC 9(10) VALUE ZEROES.  01430061
           05  PV-HOLD-TRANSFER.                                        01440082
               10  PV-HOLD-XFER-NBR-STR        PIC 9(04) VALUE ZEROES.  01450082
               10  PV-HOLD-XFER-NBR-SEQ        PIC 9(06) VALUE ZEROES.  01460082
           05  PV-TF064-TRANSFER.                                       01470082
               10  PV-TF064-XFER-NBR-STR       PIC 9(04) VALUE ZEROES.  01480082
               10  PV-TF064-XFER-NBR-SEQ       PIC 9(06) VALUE ZEROES.  01490082
           05  PV-HOLD-UPC-NBR.                                         01491099
               10  PV-KOHLS-UPC-DIGITS        PIC X(04).                01492099
               10  PV-KOHLS-DEPT              PIC X(03).                01493099
               10  PV-KOHLS-CL.                                         01494099
                   15  PV-KOHLS-CL-1          PIC X(01).                01495099
                   15  PV-KOHLS-CL-2          PIC X(01).                01496099
               10  PV-KOHLS-CL-9 REDEFINES PV-KOHLS-CL                  01497099
                                              PIC 9(02).                01498099
               10  PV-KOHLS-DUMMY-SKU         PIC X(03).                01499099
               10  PV-KOHLS-CHECKDIGIT        PIC X(01).                01499199
           05  PV-HOLD-UPC-NBR-9 REDEFINES PV-HOLD-UPC-NBR              01499299
                                              PIC 9(13).                01499399
                                                                        01501008
       01  DK-DB2-KEYS.                                                 01510003
           05  DK-STORE-NBR              PIC S9(04) COMP  VALUE +0.     01520003
           05  DK-FR-STR-NBR             PIC S9(04) COMP  VALUE +0.     01530003
           05  DK-XFER-SEQ-NBR           PIC S9(06) COMP  VALUE +0.     01540045
           05  DK-XFER-DKEY-ID           PIC S9(09) COMP  VALUE +0.     01550046
      ******************************************************************01560008
      **PROGRAM CONSTANTS                                               01570008
      ******************************************************************01580008
       01  PC-PROGRAM-CONSTANTS.                                        01590008
           05  PC-CALLBACK                 PIC  9(02)  VALUE 02.        01600038
           05  PC-ENTER-MTHD               PIC  9(02)  VALUE 02.        01610038
           05  PC-POSITIVE-RCVD            PIC  X(02)  VALUE 'PR'.      01620038
           05  PC-RLOG                     PIC  X(04)  VALUE 'RLOG'.    01630038
           05  PC-N                        PIC  X(01)  VALUE 'N'.       01640038
           05  PC-Y                        PIC  X(01)  VALUE 'Y'.       01650011
           05  PC-SEQ-NBR                  PIC  9(01)  VALUE  1.        01660038
           05  PC-CLEARANCE-STATUS         PIC  9(02)  VALUE 30.        01670011
           05  PC-COMPLETED                PIC  X(02)  VALUE 'CM'.      01680012
           05  PC-INTERMEDIATELY-RECEIVED  PIC  X(02)  VALUE 'IR'.      01690012
           05  PC-ASSUMPTIVELY-RECEIVED    PIC  X(02)  VALUE 'AR'.      01700013
           05  PC-POSITIVE-RECEIPT         PIC  X(02)  VALUE 'PR'.      01710012
           05  PC-ITRC                     PIC  X(04)  VALUE 'ITRC'.    01720038
           05  PC-RCPT                     PIC  X(04)  VALUE 'RCPT'.    01730038
           05  PC-STAT                     PIC  X(04)  VALUE 'STAT'.    01740038
           05  PC-NEGATIVE                 PIC  X(01)  VALUE '-'.       01750073
      ******************************************************************01760001
      **PROGRAM ACCUMULATORS                                            01770001
      ******************************************************************01780001
       01  PA-PROGRAM-COUNT.                                            01790001
           05  PA-RECORDS-READ             PIC  9(09) VALUE ZEROS.      01800043
           05  PA-ROWS-INSERTED            PIC  9(09) VALUE ZEROS.      01810043
           05  PA-TRANS-INSERTS            PIC  9(09) VALUE ZEROS.      01820043
      ******************************************************************01830001
      **ABEND INFORMATION                                               01840001
      ******************************************************************01850001
       01  ABEND-CODE                  PIC S9(04)  VALUE +0 COMP SYNC.  01860001
           88  AC-OPEN-FILE-ERROR                  VALUE +4005.         01870001
           88  AC-DB2-ERROR                        VALUE +4013.         01880001
      ******************************************************************01890001
      **PROGRAM VARIABLES                                               01900001
      ******************************************************************01910001
       01  PV-PROGRAM-VARIABLES.                                        01920001
           05  PV-PARA-NAME           PIC X(30) VALUE SPACES.           01930013
           05  PV-PROGRAM-NAME             PIC X(08) VALUE 'TFKUT008'.  01940002
           05  PV-ABEND-NOTE               PIC X(40) VALUE SPACES.      01950012
      ******************************************************************01960001
      **COPYBOOKS                                                       01970001
      ******************************************************************01980001
      ***CALENDAR ROUTINE COPYBOOK                                      01990001
           COPY DPWS500.                                                02000001
      ***SQLCA ROUTINE                                                  02010001
           COPY DPWS004.                                                02020001
      ***DB2 MESSAGE AREA                                               02030001
           COPY SQLCA2.                                                 02040001
      *----------------------------------------------------------       02050002
      * TRANSFER CONTROL CARD DATE - INPUT                              02060002
      *----------------------------------------------------------       02070002
           COPY TFRD069.                                                02080002
                                                                        02090002
      *----------------------------------------------------------       02100003
      * GENCO TRANSFER FILE        - INPUT                              02110003
      *----------------------------------------------------------       02120003
           COPY TFRD064.                                                02130003
                                                                        02140003
      *----------------------------------------------------------       02150003
      * POSITIVE RECEIPT FILE      - OUTPUT                             02160003
      *----------------------------------------------------------       02170003
           COPY TFRD065.                                                02180003
                                                                        02190003
      *----------------------------------------------------------       02200003
      * ERROR FILE                 - OUTPUT                             02210003
      *----------------------------------------------------------       02220003
           COPY TFRD066.                                                02230003
                                                                        02240003
      *----------------------------------------------------------       02250003
      * MISDIRECT FILE             - OUTPUT                             02260003
      *----------------------------------------------------------       02270003
           COPY TFRD067.                                                02280003
                                                                        02290003
      *----------------------------------------------------------       02300003
      * TRANSFER INSERT FILE       - OUTPUT                             02310003
      *----------------------------------------------------------       02320003
           COPY TFRD068.                                                02330003
                                                                        02340003
      ******************************************************************02350001
      **TABLE INCLUSIONS                                                02360001
      ******************************************************************02370001
      ***SQL COMM AREA                                                  02380001
           EXEC SQL                                                     02390001
               INCLUDE SQLCA                                            02400001
           END-EXEC.                                                    02410001
      *----------------------------------------------------------       02420003
      * TRANSFER MASTER - TTFMSTR                                       02430003
      *----------------------------------------------------------       02440003
           EXEC SQL                                                     02450003
               INCLUDE TTFMSTR                                          02460003
           END-EXEC.                                                    02470003
      *----------------------------------------------------------       02480002
      * RECEIPT TABLE  - TTFRCPT                                        02490002
      *----------------------------------------------------------       02500002
           EXEC SQL                                                     02510001
               INCLUDE TTFRCPT                                          02520002
           END-EXEC.                                                    02530001
      *----------------------------------------------------------       02540002
      * ITEM    TABLE  - TTFITEM                                        02550003
      *----------------------------------------------------------       02560002
           EXEC SQL                                                     02570002
               INCLUDE TTFITEM                                          02580003
           END-EXEC.                                                    02590002
      *----------------------------------------------------------       02600003
      * STATUS  TABLE  - TTFSTAT                                        02610003
      *----------------------------------------------------------       02620003
           EXEC SQL                                                     02630003
               INCLUDE TTFSTAT                                          02640003
           END-EXEC.                                                    02650003
      *----------------------------------------------------------       02660017
      * STATUS DESC  TABLE  - TTFSTCD                                   02670017
      *----------------------------------------------------------       02680017
           EXEC SQL                                                     02690017
               INCLUDE TTFSTCD                                          02700018
           END-EXEC.                                                    02710017
      *----------------------------------------------------------       02720004
      * TRANSFER TYPE TABLE - TTFTYCD                                   02730004
      *----------------------------------------------------------       02740004
           EXEC SQL                                                     02750004
               INCLUDE TTFTYCD                                          02760004
           END-EXEC.                                                    02770004
      *----------------------------------------------------------       02780003
      * SKU     TABLE  - XST_SKU                                        02790003
      *----------------------------------------------------------       02800003
           EXEC SQL                                                     02810003
               INCLUDE XST00008                                         02820011
           END-EXEC.                                                    02830003
      *----------------------------------------------------------       02840003
      * SKU LOC TABLE  - XST_SKU_LOC                                    02850003
      *----------------------------------------------------------       02860003
           EXEC SQL                                                     02870003
               INCLUDE XST00010                                         02880011
           END-EXEC.                                                    02890003
      *----------------------------------------------------------       02900003
      * UPC     TABLE  - XST_UPC                                        02910003
      *----------------------------------------------------------       02920003
           EXEC SQL                                                     02930003
               INCLUDE XST00012                                         02940011
           END-EXEC.                                                    02950003
                                                                        02960001
      *----------------------------------------------------------       03040083
      * SKU CROSS REFERENCE TABLE                                       03050083
      *----------------------------------------------------------       03060083
           EXEC SQL                                                     03070083
               INCLUDE TSKXREF                                          03080084
           END-EXEC.                                                    03090083
                                                                        03100083
      *---------------------------------------------------------------* 03110008
      *    CURSOR FOR TRANSFER ITEMS                                  * 03120008
      *---------------------------------------------------------------* 03130008
           EXEC SQL                                                     03140008
               DECLARE XFER_ITM_CSR CURSOR FOR                          03150008
                   SELECT  XFER_LNE_NBR                                 03160008
                          ,ITM_NBR                                      03170008
                          ,XFER_PRIC_AMT                                03180008
                          ,XFER_QTY                                     03190008
                          ,KOHLS_UPC_NBR                                03200008
                          ,SCN_UPC_NBR                                  03201099
                     FROM  TTFITEM                                      03210008
                    WHERE  (XFER_DKEY_ID  =  :DK-XFER-DKEY-ID)          03220008
                 ORDER BY  XFER_LNE_NBR                                 03230008
                 WITH UR                                                03240008
           END-EXEC.                                                    03250008
       PROCEDURE DIVISION.                                              03260001
      ******************************************************************03270001
       0000-MAIN-LINE.                                                  03280001
                                                                        03290001
           PERFORM 1000-INITIALIZATION.                                 03300001
           PERFORM 2000-PROCESS-INPUT-FILE                              03310001
                   UNTIL PS-END-OF-TRANS-FILE.                          03320003
           PERFORM 9200-WRAPUP.                                         03330058
           GOBACK.                                                      03340001
                                                                        03350001
      ******************************************************************03360001
      **INITIALIZATION                                                  03370001
      ******************************************************************03380001
       1000-INITIALIZATION.                                             03390001
                                                                        03400001
           OPEN INPUT CONTROL-CARD-DTE                                  03410002
                      GENCO-TRANS-FILE                                  03420012
                OUTPUT POSITIVE-FILE                                    03430002
                       ERROR-FILE                                       03440002
                       MISDIRECT-FILE                                   03450003
                       TRANS-INSERT-FILE.                               03460012
                                                                        03470001
           PERFORM 1100-GET-TIMESTAMP.                                  03480001
                                                                        03490001
071200     PERFORM 1200-READ-CURR-DTE-CARD.                             03500003
071300     PERFORM 1300-DATE-ROUTINE.                                   03510003
071400                                                                  03520003
063005     PERFORM 4000-READ-INPUT-FILE.                                03530003
                                                                        03540061
                                                                        03550061
      **********************************************************        03560001
      **RETRIEVE DB2 TIMESTAMP                                          03570001
      **********************************************************        03580001
       1100-GET-TIMESTAMP.                                              03590001
                                                                        03600001
           EXEC SQL                                                     03610001
                SET :SD-TIME-STAMP = CURRENT TIMESTAMP                  03620001
           END-EXEC.                                                    03630001
                                                                        03640001
           IF SQLCODE NOT EQUAL ZERO                                    03650001
               MOVE '1100-GET-TIMESTAMP' TO PV-PARA-NAME                03660003
               MOVE 'UNSUCCESSFUL TIME RETRIEVAL' TO PV-ABEND-NOTE      03670014
               PERFORM 9100-DB2-ABEND                                   03680003
           END-IF.                                                      03690001
                                                                        03700001
072500*----------------------------------------------------------       03710003
072700*     READ CONTROL CARD TFRD069.                                  03720003
072900*----------------------------------------------------------       03730003
073000 1200-READ-CURR-DTE-CARD.                                         03740003
073100                                                                  03750003
073200     READ CONTROL-CARD-DTE                                        03760012
073300                          INTO TF069-CC-CONTROL-CARD              03770012
073400       AT END                                                     03780003
073500          SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                    03790003
073600                                                                  03800003
073700     IF PS-END-OF-CNTL-CRD-FILE                                   03810003
073800       DISPLAY ' '                                                03820003
073900       DISPLAY '** ABEND     **'                                  03830003
074000       DISPLAY '** PROGRAM   **  = ' PV-PROGRAM-NAME              03840012
074100       DISPLAY '** PARAGRAPH **  = 1200-READ-CURR-DTE-CARD'       03850003
074200       DISPLAY '** CONTROL FILE IS EMPTY  '                       03860003
074300       DISPLAY ' '                                                03870003
074400       MOVE +4003 TO ABEND-CODE                                   03880003
074500       CALL 'ILBOABN0' USING ABEND-CODE                           03890003
074600     ELSE                                                         03900003
074700       DISPLAY '** CURRENT TRANSFER DATE CONTROL CARD  **'        03910003
074800       DISPLAY '** TFCC011       **  = ' TF069-CC-CRNT-DTE        03920003
074900       DISPLAY ' '                                                03930003
075000     END-IF.                                                      03940003
075100                                                                  03950003
                                                                        03960022
268140*----------------------------------------------------------       03970003
268200* DATE ROUTINE TO SET UP THE PROCESS DATE IN                      03980003
268300* CCYYMMDD FORMAT.                                                03990003
268400*----------------------------------------------------------       04000003
268500 1300-DATE-ROUTINE.                                               04010003
268600                                                                  04020003
268700     INITIALIZE DPG51 DPG52 DPG53                                 04030003
268800                DPG54 DPG55 DPG56.                                04040003
268900                                                                  04050003
269000     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      04060003
269100     SET DPG52-LK-DTE-ISO           TO TRUE.                      04070057
           MOVE TF069-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE.        04080058
269300                                                                  04090003
269400     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    04100003
269500                                             DPG54 DPG55 DPG56.   04110003
269600                                                                  04120003
269700     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  04130003
269800       DISPLAY '** ABEND **'                                      04140003
269900       DISPLAY '** PROGRAM = TFKUT008'                            04150003
270000       DISPLAY 'DATE = ' TF069-CC-CRNT-DTE                        04160003
270100       DISPLAY DPG54-ERROR-MESSAGE                                04170003
270200       MOVE 4019 TO ABEND-CODE                                    04180003
270300       CALL 'ILBOABN0' USING ABEND-CODE                           04190003
270400     END-IF.                                                      04200003
270500                                                                  04210003
      **********************************************************        04220001
      **PROCESS INPUT FILE                                              04230001
      **********************************************************        04240001
       2000-PROCESS-INPUT-FILE.                                         04250001
                                                                        04260001
           IF PV-TF064-TRANSFER  NOT = PV-HOLD-TRANSFER                 04290094
              PERFORM 3000-GET-TRANSFER-MSTR                            04300067
              PERFORM 3010-PROCESS-TRANSFER                             04310067
           ELSE                                                         04320067
              MOVE 'DUPLICATE'  TO TF066-ERROR-REASON                   04330067
              PERFORM 4999-BUILD-RECORD                                 04340067
              PERFORM 5000-WRITE-ERROR-FILE                             04350067
           END-IF.                                                      04360067
                                                                        04370067
           MOVE TF064-ACTUAL-STR-NBR TO PV-HOLD-STR-NBR.                04381091
           MOVE TF064-XFER-DKEY      TO PV-HOLD-XFER-DKEY.              04390092
           MOVE TF064-XFER-NBR-STR   TO PV-HOLD-XFER-NBR-STR.           04400092
           MOVE TF064-XFER-NBR-SEQ   TO PV-HOLD-XFER-NBR-SEQ.           04410092
                                                                        04420061
           PERFORM 4000-READ-INPUT-FILE.                                04430067
                                                                        04440001
      **********************************************************        04450008
      **GET NECESSARY INFO FROM THE TTFMSTR TABLE                       04460008
      **********************************************************        04470008
       3000-GET-TRANSFER-MSTR.                                          04480008
                                                                        04490003
           MOVE TF064-XFER-NBR-STR            TO DK-FR-STR-NBR.         04500003
           MOVE TF064-XFER-NBR-SEQ            TO DK-XFER-SEQ-NBR.       04510003
                                                                        04520003
           EXEC SQL                                                     04530003
               SELECT A.XFER_DKEY_ID                                    04540016
                     ,A.XFER_TYP_CDE                                    04550016
                     ,TO_STR_NBR                                        04560003
                     ,CMPT_XFER_BEG_TMST                                04570008
                     ,CMPT_XFER_END_TMST                                04580008
                     ,CLBK_NBR                                          04590008
                     ,B.TYP_1ST_LNE_DESC                                04600008
               INTO   :TFMSTR-XFER-DKEY-ID                              04610008
                     ,:TFMSTR-XFER-TYP-CDE                              04620008
                     ,:TFMSTR-TO-STR-NBR                                04630008
                     ,:TFMSTR-CMPT-XFER-BEG-TMST                        04640008
                     ,:TFMSTR-CMPT-XFER-END-TMST                        04650008
                     ,:TFMSTR-CLBK-NBR                                  04660016
                     ,:PV-TYP-DESC                                      04670040
                FROM  TTFMSTR A                                         04680008
                     ,TTFTYCD B                                         04690008
               WHERE  (FR_STR_NBR      =  :DK-FR-STR-NBR                04700008
                 AND   XFER_SEQ_NBR    =  :DK-XFER-SEQ-NBR)             04710008
                 AND   A.XFER_TYP_CDE    =  B.XFER_TYP_CDE              04720008
           END-EXEC.                                                    04730013
                                                                        04740008
           EVALUATE TRUE                                                04750013
               WHEN SQLCODE = ZERO                                      04760008
                  SET PS-TRANSFER-FOUND      TO TRUE                    04770008
               WHEN SQLCODE = +100                                      04780008
                  SET PS-TRANSFER-NOT-FOUND  TO TRUE                    04790008
               WHEN OTHER                                               04800008
                   MOVE '3000-GET-TRANSFER' TO PV-PARA-NAME             04810008
                   MOVE 'UNSUCCESSFUL TRANS RETRIEVAL' TO PV-ABEND-NOTE 04820014
                   PERFORM 9100-DB2-ABEND                               04830008
           END-EVALUATE.                                                04840014
                                                                        04850003
      ******************************************************************04860008
      **IF TRANSFER FOUND CONTINUE ELSE ERROR                           04870008
      ******************************************************************04880008
       3010-PROCESS-TRANSFER.                                           04890012
                                                                        04900008
           EVALUATE TRUE                                                04910019
              WHEN PS-TRANSFER-FOUND                                    04920003
                   INITIALIZE TFSTAT-XFER-STAT-CDE                      04930059
                   PERFORM 4010-CHECK-TRANSFER-STAT                     04940007
                   IF PS-STAT-FOUND                                     04950059
                       PERFORM 4020-SELECT-CURRENT-STATUS               04960059
                   END-IF                                               04970059
                   PERFORM 4030-EVALUATE-STATUS                         04980059
                   EVALUATE TRUE                                        04990020
                       WHEN PS-TRANS-READY-TO-PROCESS                   05000008
                           PERFORM 4100-CHECK-FOR-MISDIRECT             05010008
                           PERFORM 4200-INSERT-RCPT-FILE                05020008
                           PERFORM 4300-PROCESS-ITEMS                   05030008
                           PERFORM 4400-INSERT-STAT-FILE                05040008
                           PERFORM 4500-CREATE-POSITIVE-FILE            05050008
                       WHEN PS-TRANS-NOT-READY-TO-PROCESS               05060008
                           PERFORM 4999-BUILD-RECORD                    05070008
                           PERFORM 5000-WRITE-ERROR-FILE                05080008
                   END-EVALUATE                                         05090008
              WHEN PS-TRANSFER-NOT-FOUND                                05100004
                   PERFORM 4900-GET-TRANSFER-DESC                       05110012
      *            INITIALIZE VALUES THAT ARE NOT AVAILABLE             05120058
                   MOVE SPACE                TO TF066-CREATE-DTE        05130058
                                                TF066-1ST-RCVD-DTE      05140058
                                                TF066-2ND-RCVD-DTE      05150058
                                                TF066-CALLBK-NBR        05160058
                   MOVE 'NOT FOUND'          TO TF066-ERROR-REASON      05170058
                   PERFORM 5000-WRITE-ERROR-FILE                        05180003
           END-EVALUATE.                                                05190012
                                                                        05200003
      ******************************************************************05210001
      **READ INPUT FILE                                                 05220001
      ******************************************************************05230001
       4000-READ-INPUT-FILE.                                            05240001
                                                                        05250001
           READ GENCO-TRANS-FILE INTO TF064-RECEIVED-XFER-RECORD        05260012
                AT END                                                  05270001
                   SET PS-END-OF-TRANS-FILE TO TRUE                     05280003
           END-READ.                                                    05290001
                                                                        05300001
           IF  PS-NOT-END-OF-TRANS-FILE                                 05310048
               ADD +1                      TO PA-RECORDS-READ           05320048
                                                                        05480064
              MOVE TF064-XFER-NBR-STR  TO PV-TF064-XFER-NBR-STR         05490082
              MOVE TF064-XFER-NBR-SEQ  TO PV-TF064-XFER-NBR-SEQ         05500082
                                                                        05510082
           END-IF.                                                      05520048
                                                                        05530001
                                                                        05540061
      ******************************************************************05550008
      **GET TRANSFER STATUS MAX TIMESTAMP                               05560008
      ******************************************************************05570008
       4010-CHECK-TRANSFER-STAT.                                        05580007
           MOVE TF064-XFER-DKEY TO TFMSTR-XFER-DKEY-ID                  05590032
                                   DK-XFER-DKEY-ID.                     05600031
                                                                        05610007
           EXEC SQL                                                     05620007
               SELECT  MAX(XFER_STAT_TMST)                              05630007
                 INTO  :TFSTAT-XFER-STAT-TMST                           05640007
                 FROM  TTFSTAT                                          05650007
                WHERE  (XFER_DKEY_ID  =  :TFMSTR-XFER-DKEY-ID)          05660007
                WITH UR                                                 05670007
           END-EXEC.                                                    05680007
                                                                        05690007
           EVALUATE SQLCODE                                             05700007
               WHEN ZERO                                                05710007
                   SET PS-STAT-FOUND TO TRUE                            05720059
               WHEN -305                                                05730051
                   SET PS-STAT-NOT-FOUND TO TRUE                        05740059
               WHEN OTHER                                               05750007
                   MOVE '4010-CHECK-TRANSFER-STAT' TO PV-PARA-NAME      05760007
                   MOVE 'UNSUCCESSFUL RETRIEVAL' TO PV-ABEND-NOTE       05770014
                   PERFORM 9100-DB2-ABEND                               05780007
           END-EVALUATE.                                                05790007
                                                                        05800007
      ******************************************************************05810008
      **GET TRANSFER STATUS USING MAX TIMESTAMP                         05820008
      ******************************************************************05830008
       4020-SELECT-CURRENT-STATUS.                                      05840007
                                                                        05850007
           EXEC SQL                                                     05860007
               SELECT  A.XFER_STAT_CDE                                  05870016
                      ,B.XFER_STAT_DESC                                 05880016
                 INTO  :TFSTAT-XFER-STAT-CDE                            05890016
                      ,:TFSTCD-XFER-STAT-DESC                           05900016
                 FROM  TTFSTAT  A                                       05910016
                      ,TTFSTCD  B                                       05920016
                WHERE  (A.XFER_DKEY_ID     =  :TFMSTR-XFER-DKEY-ID      05930016
                  AND   XFER_STAT_TMST     =  :TFSTAT-XFER-STAT-TMST    05940016
                  AND   A.XFER_STAT_CDE    =  B.XFER_STAT_CDE)          05950016
                WITH UR                                                 05960007
           END-EXEC.                                                    05970007
                                                                        05980007
           EVALUATE SQLCODE                                             05990007
               WHEN ZERO                                                06000007
                   CONTINUE                                             06010007
               WHEN +100                                                06020051
                   MOVE SPACE TO TFSTAT-XFER-STAT-CDE                   06030059
               WHEN OTHER                                               06040007
                   MOVE '4020-SELECT-CURRENT-STAT' TO PV-PARA-NAME      06050007
                   MOVE 'UNSUCCESSFUL RETRIEVAL' TO PV-ABEND-NOTE       06060014
                   PERFORM 9100-DB2-ABEND                               06070007
           END-EVALUATE.                                                06080007
                                                                        06090007
      ******************************************************************06100008
      **EVALUATE STATUS FOR FURTHER PROCESSING                          06110008
      ******************************************************************06120008
       4030-EVALUATE-STATUS.                                            06130008
           EVALUATE TFSTAT-XFER-STAT-CDE                                06140007
               WHEN PC-COMPLETED                                        06150007
               WHEN PC-INTERMEDIATELY-RECEIVED                          06160007
               WHEN PC-ASSUMPTIVELY-RECEIVED                            06170007
                   SET PS-TRANS-READY-TO-PROCESS TO TRUE                06180008
               WHEN PC-POSITIVE-RECEIPT                                 06191099
                   SET PS-TRANS-NOT-READY-TO-PROCESS TO TRUE            06200099
                   MOVE 'PREV RCVD'          TO TF066-ERROR-REASON      06210099
               WHEN OTHER                                               06220008
                   SET PS-TRANS-NOT-READY-TO-PROCESS TO TRUE            06230008
                   MOVE 'OTHER    '          TO TF066-ERROR-REASON      06240053
           END-EVALUATE.                                                06250008
      ******************************************************************06260008
      **CHECK IF TRANSFER LOCATION IS DIFFERENT FROM ORIGINAL           06270008
      ******************************************************************06280008
       4100-CHECK-FOR-MISDIRECT.                                        06290008
           IF TF064-ACTUAL-STR-NBR IS NOT = TF064-TO-STR-NBR            06300008
               SET PS-MISDIRECT     TO TRUE                             06310072
           ELSE                                                         06320072
               SET PS-NOT-MISDIRECT TO TRUE                             06330072
           END-IF.                                                      06340008
                                                                        06350008
      ******************************************************************06360008
      **WRITE RECORD FOR RCPT TABLE - TTFRCPT                           06370008
      ******************************************************************06380008
        4200-INSERT-RCPT-FILE.                                          06390008
           MOVE SPACE                 TO TF068-TRANSFER-REC.            06400037
           MOVE PC-RCPT               TO TF068-TABLE-TO-UPD.            06410038
           MOVE TF064-XFER-DKEY       TO TF068-DKEY-ID.                 06420034
           MOVE TF064-CMPLD-XFER-TMST TO TF068-RCV-XFER-BEG-TMST        06430049
                                         TF068-RCV-XFER-END-TMST.       06430189
                                                                        06430290
                                                                        06441090
           MOVE PC-ENTER-MTHD         TO TF068-ENTR-MTHD-TYP-CDE        06450078
                                         TF068-RCPT-MTHD-CDE.           06460078
           MOVE TF064-ACTUAL-STR-NBR  TO TF068-STR-NBR.                 06470034
           MOVE PC-RLOG               TO TF068-RCV-BY-USER-ID.          06480034
           MOVE PC-N                  TO TF068-STR-OVRRID-IND           06490034
                                         TF068-RCVG-PROB-IND.           06500034
           MOVE TF064-CMPLD-XFER-USR-ID(1:1) TO                         06510034
                                         TF068-RCVR-INIT-1ST-NM.        06520034
           MOVE TF064-CMPLD-XFER-USR-ID(2:7) TO                         06530034
                                         TF068-RCVR-LAST-NM.            06540034
           WRITE TRANS-INSERT-REC FROM TF068-TRANSFER-REC               06550034
              INVALID KEY                                               06560034
              DISPLAY 'TFKUT008 - ***********************************'  06570034
              DISPLAY 'TFKUT008 - INVALID KEY ON WRITE TO OUT04 FILE'   06580034
              DISPLAY 'TFKUT008 - TF068-TRANSFER-REC                '   06590034
              DISPLAY 'TFKUT008 - ***********************************'  06600034
              PERFORM 9000-ABEND.                                       06610034
                                                                        06620008
           ADD +1 TO PA-TRANS-INSERTS.                                  06630043
                                                                        06640043
      *----------------------------------------------------------------*06650008
      *  OPEN THE TRANSFER ITEM CURSOR.                                *06660008
      *----------------------------------------------------------------*06670008
       4300-PROCESS-ITEMS.                                              06680008
           PERFORM 6010-OPEN-XFER-ITM-CSR.                              06690008
           PERFORM 6050-FETCH-XFER-ITM-CSR.                             06700008
                                                                        06710008
           SET PS-MORE-XFER-ITMS TO TRUE.                               06720035
           PERFORM 6100-INSERT-XFER-ITM-RCPTS                           06730008
               UNTIL PS-END-OF-XFER-ITMS.                               06740008
                                                                        06750008
           PERFORM 6060-CLOSE-XFER-ITM-CSR.                             06760083
                                                                        06770008
      ******************************************************************06780008
      **WRITE RECORD FOR STAT TABLE - TTFSTAT                           06790008
      ******************************************************************06800008
        4400-INSERT-STAT-FILE.                                          06810008
           MOVE SPACE                 TO TF068-TRANSFER-REC.            06820037
           MOVE PC-STAT               TO TF068-TABLE-TO-UPD3.           06830038
           MOVE TF064-XFER-DKEY       TO TF068-DKEY-ID3.                06840034
           MOVE TF064-CMPLD-XFER-TMST TO TF068-XFER-STAT-TMST.          06850049
           MOVE PC-POSITIVE-RCVD      TO TF068-XFER-STAT-CDE.           06860034
           WRITE TRANS-INSERT-REC FROM TF068-TRANSFER-REC3              06870034
              INVALID KEY                                               06880034
              DISPLAY 'TFKUT008 - ***********************************'  06890034
              DISPLAY 'TFKUT008 - INVALID KEY ON WRITE TO OUT04 FILE'   06900034
              DISPLAY 'TFKUT008 - TF068-TRANSFER-REC3               '   06910034
              DISPLAY 'TFKUT008 - ***********************************'  06920034
              PERFORM 9000-ABEND.                                       06930034
                                                                        06940008
      ******************************************************************06950008
      **BUILD AND WRITE THE POSITIVE RECEIPT FILE                       06960008
      ******************************************************************06970008
       4500-CREATE-POSITIVE-FILE.                                       06980034
           MOVE TF069-CC-CRNT-DTE            TO TF065-TRANSFER-DATE.    06990058
           MOVE TF064-XFER-DKEY              TO TF065-TRANSFER-DKEY-ID. 07000041
           MOVE TF064-XFER-NBR-STR           TO TF065-TRANSFER-NBR-STR. 07010041
           MOVE TF064-XFER-NBR-SEQ           TO TF065-TRANSFER-NBR-SEQ. 07020041
           MOVE PV-TYP-DESC                 TO TF065-TRANSFER-TYPE-DESC.07030041
           MOVE TF064-ACTUAL-STR-NBR         TO TF065-TO-STR-NBR.       07040041
           MOVE TF064-EXCPT-UNITS            TO TF065-TOTAL-QTY.        07050041
           MOVE TF064-EXCPT-RTL-AMT-SIGN     TO TF065-AMT-SIGN.         07060041
           MOVE TF064-EXCPT-RTL-AMT          TO TF065-TOTAL-RETAIL.     07070041
           MOVE TF064-CMPLD-XFER-USR-ID(1:1) TO TF065-RCVD-BY-1ST-INIT. 07080008
           MOVE TF064-CMPLD-XFER-USR-ID(2:7) TO TF065-RCVD-BY-LAST-NAME.07090008
           MOVE TFMSTR-CMPT-XFER-BEG-TMST(1:10) TO                      07100008
                                           TF065-CREATE-DTE.            07110014
           MOVE TF064-CMPLD-XFER-TMST(1:10) TO                          07120014
                                           TF065-RECVD-DTE.             07130041
           EVALUATE TF064-XFER-TYP-CDE                                  07140041
              WHEN PC-CALLBACK                                          07150041
                  MOVE TFMSTR-CLBK-NBR TO TF065-CALLBK-NBR              07160041
              WHEN OTHER                                                07170041
                  MOVE SPACE           TO TF065-CALLBK-NBR              07180041
           END-EVALUATE.                                                07190041
                                                                        07200041
           WRITE POSITIVE-REC FROM TF065-POSITIVE-RECVD-REC             07210008
               INVALID KEY                                              07220011
               DISPLAY 'TFKUT008 - ***********************************' 07230011
               DISPLAY 'TFKUT008 - INVALID KEY ON WRITE TO OUT01 FILE'  07240011
               DISPLAY 'TFKUT008 - ***********************************' 07250011
               PERFORM 9000-ABEND.                                      07260011
                                                                        07270008
      ******************************************************************07280008
      **GET TRANSFER TYPE DESC                                          07290008
      ******************************************************************07300008
       4900-GET-TRANSFER-DESC.                                          07310008
                                                                        07320008
           MOVE TF064-XFER-TYP-CDE            TO TFTYCD-XFER-TYP-CDE.   07330008
                                                                        07340008
           EXEC SQL                                                     07350008
               SELECT TYP_1ST_LNE_DESC                                  07360008
               INTO   :TFTYCD-TYP-1ST-LNE-DESC                          07370008
                FROM  TTFTYCD                                           07380008
               WHERE   XFER_TYP_CDE    =  :TFTYCD-XFER-TYP-CDE          07390008
           END-EXEC.                                                    07400012
                                                                        07410008
           EVALUATE TRUE                                                07420012
              WHEN SQLCODE = ZERO                                       07430008
                   MOVE TFTYCD-TYP-1ST-LNE-DESC TO PV-TYP-DESC          07440058
              WHEN OTHER                                                07450008
                   MOVE 'NOTFOUND'              TO PV-TYP-DESC          07460058
           END-EVALUATE.                                                07470058
                                                                        07480008
      ******************************************************************07490008
      **BUILD VARIABLES DEPENDING ON ERROR                              07500008
      ******************************************************************07510008
       4999-BUILD-RECORD.                                               07520008
           MOVE TFMSTR-CMPT-XFER-BEG-TMST(1:10) TO                      07530008
                                           TF066-CREATE-DTE.            07540014
           MOVE TFSTAT-XFER-STAT-TMST    (1:10) TO                      07550088
                                           TF066-1ST-RCVD-DTE.          07560058
           MOVE TF064-CMPLD-XFER-TMST (1:10) TO                         07570014
                                           TF066-2ND-RCVD-DTE.          07580058
           IF TF064-XFER-TYP-CDE = PC-CALLBACK                          07590008
              MOVE TFMSTR-CLBK-NBR TO TF066-CALLBK-NBR                  07600008
           ELSE                                                         07610008
              MOVE SPACE           TO TF066-CALLBK-NBR                  07620008
           END-IF.                                                      07630008
                                                                        07640008
      ******************************************************************07650008
      **BUILD AND WRITE OUT ERROR FILE                                  07660008
      ******************************************************************07670008
       5000-WRITE-ERROR-FILE.                                           07680008
           MOVE TF069-CC-CRNT-DTE        TO TF066-TRANSFER-DATE.        07690058
           MOVE TF064-XFER-DKEY          TO TF066-TRANSFER-DKEY-ID.     07700041
           MOVE TF064-XFER-NBR-STR       TO TF066-TRANSFER-NBR-STR.     07710041
           MOVE TF064-XFER-NBR-SEQ       TO TF066-TRANSFER-NBR-SEQ.     07720041
           MOVE PV-TYP-DESC              TO TF066-TRANSFER-TYPE-DESC.   07730041
           MOVE TF064-ACTUAL-STR-NBR     TO TF066-TO-STR-NBR.           07740071
           MOVE TF064-EXCPT-UNITS        TO TF066-TOTAL-QTY.            07750041
           MOVE TF064-EXCPT-RTL-AMT-SIGN TO TF066-AMT-SIGN.             07760008
           MOVE TF064-EXCPT-RTL-AMT      TO TF066-TOTAL-RETAIL.         07770008
           MOVE TF064-CMPLD-XFER-USR-ID(1:1) TO TF066-RCVD-BY-1ST-INIT. 07780008
           MOVE TF064-CMPLD-XFER-USR-ID(2:7) TO TF066-RCVD-BY-LAST-NAME.07790008
           WRITE  ERROR-REC FROM TF066-RECVD-ERROR-REC                  07800008
               INVALID KEY                                              07810011
               DISPLAY 'TFKUT008 - ***********************************' 07820011
               DISPLAY 'TFKUT008 - INVALID KEY ON WRITE TO OUT02 FILE'  07830011
               DISPLAY 'TFKUT008 - ***********************************' 07840011
               PERFORM 9000-ABEND.                                      07850011
                                                                        07860008
      ******************************************************************07870008
      **OPEN ITEMS CURSOR                                               07880008
      ******************************************************************07890008
       6010-OPEN-XFER-ITM-CSR.                                          07900008
           EXEC SQL                                                     07910008
               OPEN XFER_ITM_CSR                                        07920008
           END-EXEC.                                                    07930008
                                                                        07940008
           EVALUATE TRUE                                                07950008
               WHEN SQLCODE = ZERO                                      07960008
                   CONTINUE                                             07970008
               WHEN SQLWARN0 NOT = SPACES                               07980008
               WHEN SQLCODE < ZERO                                      07990008
               WHEN SQLCODE > ZERO                                      08000008
                   MOVE '6010-OPEN-XFER-ITM-CSR  ' TO PV-PARA-NAME      08010008
                   MOVE 'UNSUCCESSFUL OPEN CSR ' TO PV-ABEND-NOTE       08020014
                   PERFORM 9100-DB2-ABEND                               08030008
           END-EVALUATE.                                                08040008
      *                                                                 08050008
      *----------------------------------------------------------------*08060083
      *  READ A ROW FROM THE TRANSFER ITEM TABLE.                      *08070083
      *----------------------------------------------------------------*08080083
       6050-FETCH-XFER-ITM-CSR.                                         08090083
                                                                        08100083
           INITIALIZE DCLTTFITEM.                                       08110083
                                                                        08120083
           EXEC SQL                                                     08130083
               FETCH  XFER_ITM_CSR                                      08140083
                INTO  :TFITEM-XFER-LNE-NBR,                             08150083
                      :TFITEM-ITM-NBR,                                  08160083
                      :TFITEM-XFER-PRIC-AMT,                            08170083
                      :TFITEM-XFER-QTY,                                 08180083
                      :TFITEM-KOHLS-UPC-NBR,                            08190099
                      :TFITEM-SCN-UPC-NBR                               08191099
           END-EXEC                                                     08200083
                                                                        08210083
           EVALUATE TRUE                                                08220083
               WHEN SQLCODE = ZERO                                      08230083
                   CONTINUE                                             08240083
               WHEN SQLCODE = +100                                      08250083
                   SET PS-END-OF-XFER-ITMS   TO TRUE                    08260083
               WHEN SQLWARN0 NOT = SPACES                               08270083
               WHEN SQLCODE < ZERO                                      08280083
               WHEN SQLCODE > ZERO                                      08290083
                 MOVE '6050-FETCH-XFER-ITM-CSR ' TO PV-PARA-NAME        08300083
                 MOVE 'UNSUCCESSFUL OPEN CSR ' TO PV-ABEND-NOTE         08310083
                 PERFORM 9100-DB2-ABEND                                 08320083
           END-EVALUATE.                                                08330083
                                                                        08340083
      *----------------------------------------------------------------*08350083
      * CLOSE THE TRANSFER ITEM CURSOR.                                *08360083
      *----------------------------------------------------------------*08370083
       6060-CLOSE-XFER-ITM-CSR.                                         08380083
           EXEC SQL                                                     08390083
               CLOSE XFER_ITM_CSR                                       08400083
           END-EXEC.                                                    08410083
                                                                        08420083
           EVALUATE TRUE                                                08430083
               WHEN SQLCODE = ZERO                                      08440083
                   CONTINUE                                             08450083
               WHEN SQLWARN0 NOT = SPACES                               08460083
               WHEN SQLCODE < ZERO                                      08470083
               WHEN SQLCODE > ZERO                                      08480083
                   MOVE '6060-OPEN-XFER-ITM-CSR  ' TO PV-PARA-NAME      08490083
                   MOVE 'UNSUCCESSFUL OPEN CSR ' TO PV-ABEND-NOTE       08500083
                   PERFORM 9100-DB2-ABEND                               08510083
           END-EVALUATE.                                                08520083
                                                                        08530083
      *----------------------------------------------------------------*08540008
      *  SET UP DATA TO BE INSERTED INTO THE ITEM RECEIPT TABLE        *08550008
      *----------------------------------------------------------------*08560008
       6100-INSERT-XFER-ITM-RCPTS.                                      08570008
                                                                        08572086
           IF TFITEM-ITM-NBR  =  ZEROS                                  08580008
               MOVE ZEROS                 TO  PV-CUR-RTL-AMT            08590008
               MOVE TFITEM-SCN-UPC-NBR    TO  PV-HOLD-UPC-NBR-9         08591099
               MOVE PV-KOHLS-DEPT         TO  PV-DEPT-NBR               08592099
                                              PV-SKU-NBR(1:3)           08592199
               MOVE PV-KOHLS-CL-9         TO  PV-SUB-CL-NBR             08593099
               MOVE PV-KOHLS-CL           TO  PV-SKU-NBR(4:2)           08595099
               MOVE PV-KOHLS-DUMMY-SKU    TO  PV-SKU-NBR(6:3)           08596099
           ELSE                                                         08600008
               PERFORM 6500-SELECT-CUR-UNT-RTL-AMT                      08610008
               EVALUATE TRUE                                            08620058
                   WHEN PS-UPC-FOUND                                    08630058
                       MOVE XST00008-UNT-RTL-AMT  TO PV-CUR-RTL-AMT     08640058
                       MOVE XST00010-SKU-NBR      TO PV-SKU-NBR         08650087
                       PERFORM 6510-SELECT-DEPT-SUB                     08671087
                       IF XST00010-REGN-PRIC-IND = PC-Y                 08680058
                          MOVE TF064-XFER-NBR-STR TO DK-STORE-NBR       08690058
                          PERFORM 6700-CHECK-REGN-PRC                   08700058
                          IF XST00008-LOC-SKU-STAT-CDE =                08710058
                                               PC-CLEARANCE-STATUS      08720058
                             MOVE XST00008-UNT-RTL-AMT TO PV-CUR-RTL-AMT08730058
                          END-IF                                        08740058
                       END-IF                                           08750058
                   WHEN PS-UPC-NOT-FOUND                                08760058
                       MOVE ZEROES           TO PV-CUR-RTL-AMT          08770058
                       PERFORM 6510-SELECT-DEPT-SUB                     08780083
               END-EVALUATE                                             08790058
           END-IF.                                                      08800008
                                                                        08810008
           PERFORM 6600-INSERT-ITRC-FILE.                               08820008
                                                                        08830008
           EVALUATE TRUE                                                08840069
               WHEN PS-MISDIRECT                                        08850069
                 PERFORM 6800-WRITE-MISDIRECT-FILE                      08860069
           END-EVALUATE.                                                08870069
                                                                        08880008
           PERFORM 6050-FETCH-XFER-ITM-CSR.                             08890008
      *----------------------------------------------------------------*08900008
      *  GET THE CURRENT RETAIL PRICE FOR THE ITEM.                    *08910008
      *----------------------------------------------------------------*08920008
       6500-SELECT-CUR-UNT-RTL-AMT.                                     08930008
           INITIALIZE DCLXST00008                                       08940008
                      DCLXST00010.                                      08950092
                                                                        08970010
           EXEC SQL                                                     08980021
               SELECT  B.UNT_RTL_AMT                                    08990021
                      ,B.INTR_UPC_ID                                    09000021
                      ,C.REGN_PRIC_IND                                  09010021
                      ,C.SKU_NBR                                        09020021
                 INTO  :XST00008-UNT-RTL-AMT                            09050021
                      ,:XST00008-INTR-UPC-ID                            09060021
                      ,:XST00010-REGN-PRIC-IND                          09070021
                      ,:XST00010-SKU-NBR                                09080021
                 FROM  XST_UPC     A                                    09110021
                      ,XST_SKU_LOC B                                    09120021
                      ,XST_SKU     C                                    09130021
            WHERE  (A.UPC_NBR            =  :TFITEM-KOHLS-UPC-NBR       09150021
              AND   A.LAST_ACTN_CDE     IN ('A', 'U')                   09160021
              AND   A.INTR_UPC_ID        = B.INTR_UPC_ID                09170021
              AND   B.LOC_NBR            = 0                            09180021
              AND   B.END_TMST          IS NULL                         09190021
              AND   B.LOC_SKU_STAT_CDE NOT IN ('98')                    09200021
              AND   A.INTR_UPC_ID        = C.INTR_UPC_ID)               09210093
           END-EXEC.                                                    09230021
                                                                        09240010
           EVALUATE TRUE                                                09250021
               WHEN SQLCODE = ZERO                                      09260021
                   SET PS-UPC-FOUND TO TRUE                             09270021
               WHEN SQLCODE = +100                                      09280021
                   SET PS-UPC-NOT-FOUND TO TRUE                         09290021
               WHEN OTHER                                               09300021
                   MOVE '7150-SELECT-CUR-UNT-RTL ' TO PV-PARA-NAME      09310021
                   MOVE 'UNSUCCESSFUL SELECT   ' TO PV-ABEND-NOTE       09320021
                   PERFORM 9100-DB2-ABEND                               09330021
           END-EVALUATE.                                                09340021
                                                                        09350008
                                                                        09360008
      *----------------------------------------------------------------*09370083
      *  GET THE DEPT AND SUBCLASS FROM CROSS REFERENCE TABLE          *09380083
      *----------------------------------------------------------------*09390083
       6510-SELECT-DEPT-SUB.                                            09400083
           INITIALIZE DCLTSKXREF.                                       09410083
                                                                        09420083
           EXEC SQL                                                     09430083
               SELECT  DEPT                                             09440083
                      ,SUBCLASS                                         09450083
                 INTO  :SKXREF-DEPT                                     09460083
                      ,:SKXREF-SUBCLASS                                 09470083
                 FROM  TSKXREF                                          09480083
                WHERE  ITM_NBR  =  :TFITEM-ITM-NBR                      09490083
           END-EXEC.                                                    09500083
                                                                        09510083
           EVALUATE TRUE                                                09520083
               WHEN SQLCODE = ZERO                                      09530083
                   MOVE SKXREF-DEPT           TO PV-DEPT-NBR            09540083
                   MOVE SKXREF-SUBCLASS       TO PV-SUB-CL-NBR          09550085
               WHEN SQLCODE = +100                                      09560083
                   MOVE ZERO                  TO PV-DEPT-NBR            09570083
                                                 PV-SUB-CL-NBR          09580083
               WHEN OTHER                                               09590083
                   MOVE '6510-SELECT-DEPT-SUB ' TO PV-PARA-NAME         09600083
                   MOVE 'UNSUCCESSFUL SELECT   ' TO PV-ABEND-NOTE       09610083
                   PERFORM 9100-DB2-ABEND                               09620083
           END-EVALUATE.                                                09630083
                                                                        09640083
      ******************************************************************09650008
      **WRITE RECORD FOR ITRC TABLE - TTFITRC                           09660008
      ******************************************************************09670008
       6600-INSERT-ITRC-FILE.                                           09680011
           MOVE SPACE                 TO TF068-TRANSFER-REC.            09690037
           MOVE PC-ITRC               TO TF068-TABLE-TO-UPD2.           09700038
           MOVE TF064-XFER-DKEY       TO TF068-DKEY-ID2.                09710011
           MOVE TFITEM-XFER-LNE-NBR   TO TF068-XFER-LNE-NBR.            09720011
           MOVE PC-SEQ-NBR            TO TF068-LNE-SEQ-NBR.             09730011
           MOVE TFITEM-XFER-QTY       TO TF068-XFER-QTY.                09740011
           MOVE TFITEM-XFER-PRIC-AMT  TO TF068-XFER-PRIC-AMT.           09750011
           MOVE PV-CUR-RTL-AMT        TO TF068-RTL-PRIC-AMT.            09760011
           MOVE PC-N                  TO TF068-XFER-ITM-DSCRP-IND.      09770011
           MOVE TF064-CMPLD-XFER-TMST TO TF068-RCPT-TMST.               09780054
           WRITE TRANS-INSERT-REC FROM TF068-TRANSFER-REC2              09790011
               INVALID KEY                                              09800011
               DISPLAY 'TFKUT008 - ***********************************' 09810011
               DISPLAY 'TFKUT008 - INVALID KEY ON WRITE TO OUT04 FILE'  09820011
               DISPLAY 'TFKUT008 - TF068-TRANSFER-REC2               '  09830011
               DISPLAY 'TFKUT008 - ***********************************' 09840011
               PERFORM 9000-ABEND.                                      09850011
      *----------------------------------------------------------------*09860011
      * GET RETAIL AMT                                                 *09870058
      *----------------------------------------------------------------*09880011
       6700-CHECK-REGN-PRC.                                             09890011
           EXEC SQL                                                     09900011
               SELECT  LOC_SKU_STAT_CDE,                                09910011
                       UNT_RTL_AMT                                      09920011
                 INTO :XST00008-LOC-SKU-STAT-CDE,                       09930011
                      :XST00008-UNT-RTL-AMT                             09940011
                 FROM  XST_SKU_LOC A                                    09950011
                WHERE  A.INTR_UPC_ID  = :XST00008-INTR-UPC-ID           09960011
                  AND  A.LOC_NBR      = :DK-STORE-NBR                   09970011
                  AND  A.BEG_TMST    <= CURRENT TIMESTAMP               09980011
                  AND  (A.END_TMST    > CURRENT TIMESTAMP               09990011
                  OR  A.END_TMST IS NULL)                               10000011
           END-EXEC.                                                    10010011
                                                                        10020011
           EVALUATE TRUE                                                10030011
               WHEN SQLCODE = ZERO                                      10040011
                       CONTINUE                                         10050011
               WHEN SQLCODE = +100                                      10060011
                   CONTINUE                                             10070011
               WHEN OTHER                                               10080011
                   MOVE '6600-CHECK-REGN-PRC     ' TO PV-PARA-NAME      10090011
                   MOVE 'UNSUCCESSFUL SELECT   ' TO PV-ABEND-NOTE       10100014
                   PERFORM 9100-DB2-ABEND                               10110011
           END-EVALUATE.                                                10120011
                                                                        10130011
                                                                        10140035
      ******************************************************************10150011
      **  MOVE AND WRITE MIS-DIRECT FILE                                10160058
      ******************************************************************10170011
       6800-WRITE-MISDIRECT-FILE.                                       10180011
           MOVE TF069-CC-CRNT-DTE        TO TF067-TRANSFER-DATE.        10190058
           MOVE TF064-XFER-DKEY          TO TF067-TRANSFER-DKEY-ID.     10200011
           MOVE TF064-XFER-NBR-STR       TO TF067-TRANSFER-NBR-STR.     10210011
           MOVE TF064-XFER-NBR-SEQ       TO TF067-TRANSFER-NBR-SEQ.     10220011
           MOVE PV-TYP-DESC              TO TF067-TRANSFER-TYPE-DESC.   10230011
           MOVE TF064-TO-STR-NBR         TO TF067-ORIG-TO-LOC.          10240011
           MOVE TF064-ACTUAL-STR-NBR     TO TF067-ACTUAL-TO-LOC.        10250011
           IF TFITEM-XFER-PRIC-AMT < 0                                  10260076
              MOVE PC-NEGATIVE           TO TF067-AMT-SIGN              10270074
           ELSE                                                         10280074
              MOVE SPACE                 TO TF067-AMT-SIGN              10290074
           END-IF.                                                      10300074
           MOVE TFITEM-XFER-QTY          TO TF067-TOTAL-QTY.            10310073
           MOVE TFITEM-XFER-PRIC-AMT     TO TF067-TOTAL-RETAIL.         10320073
           MOVE PV-SKU-NBR               TO TF067-SKU.                  10330011
           MOVE PV-DEPT-NBR              TO TF067-DEPT-NBR.             10340011
           MOVE PV-SUB-CL-NBR            TO TF067-SUB.                  10350011
           MOVE TFMSTR-CMPT-XFER-BEG-TMST(1:10) TO                      10360011
                                         TF067-CREATE-DTE.              10370011
           MOVE TF064-CMPLD-XFER-TMST(1:10) TO                          10380014
                                         TF067-RCVD-DTE.                10390011
           WRITE  MISDIRECT-REC FROM TF067-TRANS-MISDIRECT-REC          10400042
               INVALID KEY                                              10410011
               DISPLAY 'TFKUT008 - ***********************************' 10420011
               DISPLAY 'TFKUT008 - INVALID KEY ON WRITE TO OUT03 FILE'  10430011
               DISPLAY 'TFKUT008 - ***********************************' 10440011
               PERFORM 9000-ABEND.                                      10450011
                                                                        10460061
      **********************************************************        10470001
      **ABEND ROUTINE                                                   10480001
      **********************************************************        10490001
       9000-ABEND.                                                      10500001
                                                                        10510001
           PERFORM 9200-WRAPUP.                                         10520058
                                                                        10530044
           DISPLAY '** ABEND     **'.                                   10540001
           DISPLAY '** PROGRAM   ** = ' PV-PROGRAM-NAME.                10550001
           DISPLAY '** PARAGRAPH ** = ' PV-PARA-NAME.                   10560013
      ******************************************************************10570001
      * COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     10580001
      * TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      10590001
      ******************************************************************10600001
           COPY DPPD004.                                                10610001
           CALL 'ILBOABN0' USING ABEND-CODE.                            10620001
                                                                        10630001
      ******************************************************************10640003
       9100-DB2-ABEND.                                                  10650003
      ******************************************************************10660003
                                                                        10670003
           MOVE SQLCODE TO SQLCODE2.                                    10680003
           MOVE SQLERRD(3) TO SQLERRD3.                                 10690003
                                                                        10700003
           PERFORM 9200-WRAPUP.                                         10710058
                                                                        10720003
           DISPLAY '**************************************************' 10730003
           DISPLAY '** ABEND IN PROGRAM ' PV-PROGRAM-NAME               10740011
           DISPLAY '** PARAGRAPH        ' PV-PARA-NAME                  10750013
           DISPLAY '** ' PV-ABEND-NOTE                                  10760003
           DISPLAY '** SQL ERROR      = ' SQLCODE2.                     10770003
           DISPLAY '** SQLERRM        = ' SQLERRM.                      10780003
           DISPLAY '**************************************************'.10790003
                                                                        10800003
      *----------------------------------------------------------------*10810003
      *  THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   10820003
      *  MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        10830003
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     10840003
      *  FORMAT.                                                        10850003
      *----------------------------------------------------------------*10860003
           COPY DPPD004.                                                10870003
                                                                        10880003
           CALL 'DSNTIAR' USING SQLCA                                   10890003
                                DP004-FORMATTED-MESSAGE                 10900003
                                DP004-ERROR-LINE-LENGTH.                10910003
                                                                        10920003
           DISPLAY DP004-ASTERISK-LINE.                                 10930003
                                                                        10940003
           PERFORM                                                      10950003
              VARYING DP004-MSG-IDX                                     10960003
              FROM 1 BY 1                                               10970003
              UNTIL DP004-MSG-IDX > DP004-MAX-MESSAGE-LINES             10980003
                  DISPLAY '**'                                          10990003
                          DP004-MESSAGE-LINE (DP004-MSG-IDX)            11000003
                          ' **'                                         11010003
           END-PERFORM.                                                 11020003
                                                                        11030003
           DISPLAY DP004-ASTERISK-LINE.                                 11040003
                                                                        11050003
           IF SQLCODE NOT = -911                                        11060003
               EXEC SQL                                                 11070003
                   COMMIT                                               11080003
               END-EXEC                                                 11090003
           END-IF.                                                      11100003
                                                                        11110003
           SET AC-DB2-ERROR TO TRUE.                                    11120003
                                                                        11130003
           CALL 'ILBOABN0' USING ABEND-CODE.                            11140003
                                                                        11150003
      ******************************************************************11160058
      **END OF JOB                                                      11170058
      ******************************************************************11180058
       9200-WRAPUP.                                                     11190058
                                                                        11200058
           CLOSE CONTROL-CARD-DTE                                       11210058
                 GENCO-TRANS-FILE                                       11220058
                 POSITIVE-FILE                                          11230058
                 ERROR-FILE                                             11240058
                 MISDIRECT-FILE                                         11250058
                 TRANS-INSERT-FILE.                                     11260058
                                                                        11270058
           DISPLAY '*************************************************'. 11280058
           DISPLAY '* PROGRAM.................: ' PV-PROGRAM-NAME.      11290058
           DISPLAY '* RUN DATE/TIME...........: ' SD-TIME-STAMP.        11300058
           DISPLAY '*************************************************'. 11310058
           DISPLAY '* RECORDS READ.........: '                          11320058
                                          PA-RECORDS-READ.              11330058
           DISPLAY '* RECORDS FOR INSERT...: '                          11340058
                                          PA-TRANS-INSERTS.             11350058
           DISPLAY '*************************************************'. 11360058
                                                                        11370058
           IF PA-TRANS-INSERTS = ZERO                                   11380058
               DISPLAY '*----------------------------'                  11390058
               DISPLAY '*** NO RECORDS FOR INSERT ***'                  11400058
               DISPLAY '*----------------------------'                  11410058
               MOVE 0004 TO RETURN-CODE                                 11420058
           END-IF.                                                      11430058
