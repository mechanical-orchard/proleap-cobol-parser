000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.              TRKUT092.                               00020000
000300 AUTHOR.                  DENISE HAHN.                            00030000
000400 DATE-WRITTEN.            FEBRUARY 2021.                          00040000
000500 DATE-COMPILED.                                                   00050000
000600                                                                  00060000
000700******************************************************************00070000
000800* THIS PROGRAM WILL EXTRACT DATA FROM TVEHICL WHERE THE CURRENT  *00080000
000810* TRIP STATUS ON TVEHICL IS NOT (DP, DE, ET).  THE TRIP HAS      *00081000
000811* SHIPMENTS ATTACHED, BUT THE TSHPTPO ROWS HAVE PO'S THAT DO NOT *00081100
000820* EXIST.                                                         *00082000
000830*                                                                *00083000
000840* EXTRACT WILL BE USED BY TRKUP092 TO INSERT DE & ET ROWS INTO   *00084000
000850* TSHIPST & TTRIPST                                              *00085000
000860******************************************************************00086000
000870 ENVIRONMENT DIVISION.                                            00087000
000880 CONFIGURATION SECTION.                                           00088000
000890                                                                  00089000
000900 INPUT-OUTPUT SECTION.                                            00090000
000910 FILE-CONTROL.                                                    00091000
000920                                                                  00092000
000921     SELECT TRIP-FILE                                             00092100
000922        ASSIGN TO OUT01.                                          00092200
000923                                                                  00092300
000924     SELECT SHPMT-FILE                                            00092400
000925        ASSIGN TO OUT02.                                          00092500
000926                                                                  00092600
000927 DATA DIVISION.                                                   00092700
000928 FILE SECTION.                                                    00092800
000929                                                                  00092900
000930 FD  TRIP-FILE                                                    00093000
000940     RECORDING MODE IS F                                          00094000
000950     LABEL RECORDS ARE STANDARD                                   00095000
000960     RECORD CONTAINS 125 CHARACTERS                               00096000
000970     DATA RECORD IS TRIP-RECORD.                                  00097000
000980                                                                  00098000
000990 01  TRIP-RECORD                 PIC X(125).                      00099000
001000                                                                  00100000
001100                                                                  00110000
001200 FD  SHPMT-FILE                                                   00120000
001300     RECORDING MODE IS F                                          00130000
001400     LABEL RECORDS ARE STANDARD                                   00140000
001500     RECORD CONTAINS 100 CHARACTERS                               00150000
001600     DATA RECORD IS SHPMT-RECORD.                                 00160000
001700                                                                  00170000
001800 01  SHPMT-RECORD                PIC X(100).                      00180000
001900                                                                  00190000
002000                                                                  00200000
002010 WORKING-STORAGE SECTION.                                         00201000
002020                                                                  00202000
002030                                                                  00203000
002040 01  PROGRAM-SWITCHES.                                            00204000
002050     05  PS-END-OF-TRIP-CSR-SW       PIC  X(01)  VALUE 'N'.       00205000
002060         88  PS-END-OF-TRIP-CSR-YES              VALUE 'Y'.       00206000
002070         88  PS-END-OF-TRIP-CSR-NO               VALUE 'N'.       00207000
002080     05  PS-END-OF-SHPMT-CSR-SW      PIC  X(01)  VALUE 'N'.       00208000
002090         88  PS-END-OF-SHPMT-CSR-YES             VALUE 'Y'.       00209000
002100         88  PS-END-OF-SHPMT-CSR-NO              VALUE 'N'.       00210000
002200     05  PS-ERROR-SW                 PIC  X(01)  VALUE 'N'.       00220000
002300         88  PS-ERROR-YES                        VALUE 'Y'.       00230000
002400         88  PS-ERROR-NO                         VALUE 'N'.       00240000
002500                                                                  00250000
002600 01  PV-ABEND-FIELDS.                                             00260000
002700     05  PV-ABEND-PROGRAM             PIC X(8)   VALUE 'TRKUT092'.00270000
002800     05  PV-ABEND-CODE               PIC S9(04)  VALUE +0         00280000
002900                                                 COMP SYNC.       00290000
003000     05  PV-PARAGRAPH-NAME           PIC  X(30)  VALUE SPACES.    00300000
003100     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)  VALUE SPACES.    00310000
003200     05  PV-ABEND-PARAGRAPH          PIC  X(30)  VALUE SPACES.    00320000
003300     05  PV-ABEND-OPERATION          PIC  X(30)  VALUE SPACES.    00330000
003400     05  PV-DB2-OPER-ATTEMPTED       PIC  X(30)  VALUE SPACES.    00340000
003500     05  PV-DB2-OPERATION-MESSAGE-1  PIC  X(79)  VALUE SPACES.    00350000
003600     05  PV-DB2-OPERATION-MESSAGE-2  PIC  X(79)  VALUE SPACES.    00360000
003700     05  PV-DB2-OPERATION-MESSAGE-3  PIC  X(79)  VALUE SPACES.    00370000
003800     05  PV-DB2-OPERATION-MESSAGE-4  PIC  X(79)  VALUE SPACES.    00380000
003900     05  PV-SQLCODE                  PIC -Z(03)  VALUE ZERO.      00390000
004000     05  PV-NEW-STATUS-DTE           PIC  X(10)  VALUE SPACES.    00400000
004010     05  PV-DAYS-BACK-DISP           PIC  Z(09)  VALUE ZEROES.    00401002
004020     05  PV-DAYS-BACK                PIC S9(09)  VALUE ZEROES     00402002
004030                                                 COMP.            00403002
004040     05  PV-CURRENT-DATE             PIC  X(10)  VALUE SPACES.    00404002
004050     05  PV-CHECK-DATE               PIC  X(10)  VALUE SPACES.    00405002
004100                                                                  00410000
004200                                                                  00420000
004300 01  DK-DB2-KEYS.                                                 00430000
004400     05  DK-TRIP-ID                  PIC  S9(9) COMP VALUE ZEROES.00440000
004500 01  PROGRAM-VARIABLES.                                           00450000
004600     05  PV-TRIP-COUNT               PIC  9(09).                  00460000
004700     05  PV-SHPMT-COUNT              PIC S9(09)  VALUE ZEROES     00470000
004800                                                 COMP.            00480000
004900     05  PV-NULL-IND-1               PIC S9(04)  VALUE ZEROS      00490000
005000                                                 COMP SYNC.       00500000
005100     05  PV-NULL-IND-2               PIC S9(04)  VALUE ZEROS      00510000
005200                                                 COMP SYNC.       00520000
005300     05  PV-DISP-TRIP                PIC  Z(10)  VALUE ZEROS.     00530000
005400     05  PV-DISP-OPER                PIC  Z(03)  VALUE ZERO.      00540000
005500                                                                  00550000
005600 01  ABEND-CODE                PIC S9(04)  VALUE +0 COMP SYNC.    00560000
005610     88 ABEND-4013                         VALUE +4013.           00561000
005620                                                                  00562000
005630***************************************************************** 00563000
005640*    TRIP FILE LAYOUT                                           * 00564000
005650***************************************************************** 00565000
005660     COPY TRRD074.                                                00566000
005670                                                                  00567000
005680***************************************************************** 00568000
005690*    SHPMT FILE LAYOUT                                          * 00569000
005700***************************************************************** 00570000
005800     COPY TRRD075.                                                00580000
005900                                                                  00590000
005910***************************************************************** 00591000
005920*    SQL ABEND ROUTINE WORKING STORAGE                          * 00592000
005930***************************************************************** 00593000
005940     COPY DPWS004.                                                00594000
005950                                                                  00595000
005960     EXEC SQL                                                     00596000
005970        INCLUDE TVEHICL                                           00597000
005980     END-EXEC.                                                    00598000
005990                                                                  00599000
006000     EXEC SQL                                                     00600000
006100        INCLUDE TTRIPST                                           00610000
006200     END-EXEC.                                                    00620000
006300                                                                  00630000
006400     EXEC SQL                                                     00640000
006500        INCLUDE TTRSTYP                                           00650000
006600     END-EXEC.                                                    00660000
006700                                                                  00670000
007200     EXEC SQL                                                     00720000
007300        INCLUDE TSHIPMT                                           00730000
007400     END-EXEC.                                                    00740000
007500                                                                  00750000
007600     EXEC SQL                                                     00760000
007700        INCLUDE TSHIPST                                           00770000
007800     END-EXEC.                                                    00780000
007900                                                                  00790000
007910     EXEC SQL                                                     00791026
007920        INCLUDE TSHPTPO                                           00792026
007930     END-EXEC.                                                    00793026
007940                                                                  00794026
008000     EXEC SQL                                                     00800000
008100        INCLUDE TSHSTYP                                           00810000
008200     END-EXEC.                                                    00820000
008210                                                                  00821000
008211     EXEC SQL                                                     00821100
008212        INCLUDE TPURCHS                                           00821200
008213     END-EXEC.                                                    00821300
008214                                                                  00821400
008215     EXEC SQL                                                     00821503
008216        INCLUDE TKRPRPM                                           00821603
008217     END-EXEC.                                                    00821703
008218                                                                  00821803
008219******************************************************************00821900
008220* CURSOR WILL SELECT ANY TRIP WITH A CURRENT STATUS NOT          *00822000
008221* DP (DEPARTED) ET (END TRIP) OR DE (DELETED)                    *00822100
008222* AND STATUS DATE X DAYS OLD (PARM TRIPG2)                       *00822201
008223*                                                                *00822300
008224* WHERE THERE ARE SHIPMENTS ATTACHED WITH RECEIVER = 0           *00822400
008225* AND THE PO ON THE SHIPMENT DOES NOT EXIST.                     *00822500
008226*                                                                *00822600
008227******************************************************************00822700
008228                                                                  00822800
008229     EXEC SQL                                                     00822900
008230        DECLARE TRIP_CSR CURSOR FOR                               00823000
008240         SELECT DISTINCT                                          00824013
008241                A.OWNER_SCAC_ID                                   00824100
008250              , A.VEH_NBR                                         00825000
008260              , A.CURR_TRIP_ID                                    00826000
008270              , B.TRIP_STATUS_CDE                                 00827000
008280              , B.STATUS_DTE                                      00828006
008290              , B.STATUS_TME                                      00829000
008300              , B.STATUS_UID                                      00830000
008400              , B.OPER_UNT_ID                                     00840000
008500              , B.STATUS_DTE + 1 DAY AS NEW_STATUS_DTE            00850000
008600           FROM TVEHICL A                                         00860025
008700              , TTRIPST B                                         00870025
008800              , TTRSTYP C                                         00880000
009000          WHERE NOT A.CURR_TRIP_ID IS NULL                        00900000
009100          AND A.CURR_STATUS_DTE <=                                00910002
009101                             CURRENT DATE - :PV-DAYS-BACK DAYS    00910102
009110          AND A.CURR_TRIP_ID     =  B.TRIP_ID                     00911000
009120          AND B.TRIP_STATUS_CDE  =  C.TRIP_STATUS_CDE             00912000
009130          AND C.PRTY_CDE IN                                       00913000
009140              (SELECT MAX(CC.PRTY_CDE)                            00914000
009150                 FROM TTRIPST BB                                  00915025
009160                    , TTRSTYP CC                                  00916000
009161                WHERE B.TRIP_ID          =  BB.TRIP_ID            00916100
009162                  AND BB.TRIP_STATUS_CDE = CC.TRIP_STATUS_CDE)    00916200
009164          AND B.STATUS_DTE      <=                                00916402
009165                             CURRENT DATE - :PV-DAYS-BACK DAYS    00916502
009166          AND NOT B.TRIP_STATUS_CDE IN ('DP','ET','DE')           00916600
009170          AND NOT A.CURR_TRIP_ID IN                               00917000
009171              (SELECT                                             00917117
009172                      A2.CURR_TRIP_ID                             00917200
009173                 FROM TVEHICL A2                                  00917325
009176                    , TSHIPMT D2                                  00917625
009177                    , TSHPTPO E2                                  00917725
009178                WHERE NOT A2.CURR_TRIP_ID IS NULL                 00917800
009194                  AND A2.CURR_TRIP_ID  =  D2.TRIP_ID              00919400
009195                  AND D2.SHIPT_ID      =  E2.SHIPT_ID             00919500
009197                  AND E2.PO_NBR IN                                00919720
009198                      (SELECT DISTINCT F2.PO_NBR                  00919820
009199                         FROM TPURCHS F2                          00919925
009200                        WHERE F2.VER_STATUS_CDE = 'A'             00920020
009201                          AND NOT F2.STATUS_CDE IN ('CA','CM')    00920120
009202                          AND E2.PO_NBR =  F2.PO_NBR              00920220
009203                      )                                           00920320
009204              )                                                   00920400
009231        ORDER BY B.OPER_UNT_ID                                    00923119
009240              , B.STATUS_DTE                                      00924019
009250              , B.STATUS_TME                                      00925019
009268         WITH UR                                                  00926800
009269     END-EXEC.                                                    00926900
009270                                                                  00927000
009271                                                                  00927100
009272     EXEC SQL                                                     00927200
009273        DECLARE SHPMT_CSR CURSOR FOR                              00927300
009274         SELECT DISTINCT                                          00927408
009275                A.TRIP_ID                                         00927513
009276              , B.SHIPT_ID                                        00927608
009277              , B.SHIPT_STATUS_CDE                                00927708
009278              , B.STATUS_DTE                                      00927808
009279              , B.STATUS_TME                                      00927908
009280              , B.STATUS_DTE + 1 DAY AS NEW_STATUS_DTE            00928008
009281           FROM TSHIPMT A                                         00928125
009282              , TSHIPST B                                         00928225
009290              , TSHSTYP F                                         00929000
009300         WHERE A.TRIP_ID  =  :DK-TRIP-ID                          00930000
009400           AND A.SHIPT_ID  =  B.SHIPT_ID                          00940000
009500           AND B.SHIPT_STATUS_CDE  =  F.SHIPT_STATUS_CDE          00950007
009600           AND F.PRTY_CDE IN                                      00960007
010000               (SELECT MAX(G.PRTY_CDE)                            01000007
010100                  FROM TSHIPST D                                  01010025
010110                     , TSHSTYP G                                  01011007
010200                 WHERE B.SHIPT_ID  =  D.SHIPT_ID                  01020000
010210                   AND D.SHIPT_STATUS_CDE = G.SHIPT_STATUS_CDE    01021007
010223               )                                                  01022300
010225           AND NOT B.SHIPT_STATUS_CDE IN ('DE','ET')              01022500
010234        ORDER BY B.SHIPT_ID                                       01023419
010236               , B.STATUS_DTE                                     01023619
010237               , B.STATUS_TME                                     01023719
010238         WITH UR                                                  01023800
010239     END-EXEC.                                                    01023900
010240                                                                  01024000
010241                                                                  01024100
010242*   DB2 SQL COMMUNICATION AREA                                    01024200
010250     EXEC SQL                                                     01025000
010260          INCLUDE SQLCA                                           01026000
010270     END-EXEC.                                                    01027000
010280                                                                  01028000
010290                                                                  01029000
010300******************************************************************01030000
010400 PROCEDURE DIVISION.                                              01040000
010500******************************************************************01050000
010600* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     01060000
010700*      PROGRAM.                                                   01070000
010800******************************************************************01080000
010900 0000-PROGRAM-MAINLINE.                                           01090000
010910                                                                  01091002
010920     DISPLAY '************************************************'   01092002
010930     DISPLAY '** TRKUT092'                                        01093002
010940     DISPLAY '** '                                                01094002
011000                                                                  01100000
011100     OPEN OUTPUT TRIP-FILE                                        01110000
011200                 SHPMT-FILE.                                      01120000
011201                                                                  01120102
011210     PERFORM 0100-GET-DAYS-BACK.                                  01121002
011220     MOVE PV-DAYS-BACK  TO  PV-DAYS-BACK-DISP                     01122002
011230     DISPLAY '** PARM TRIPRG:  '  PV-DAYS-BACK-DISP               01123002
011240     DISPLAY '** CURRENT DATE: '  PV-CURRENT-DATE                 01124002
011250     DISPLAY '** EXTRACT DATE: '  PV-CHECK-DATE                   01125002
011260     DISPLAY '** '.                                               01126002
011300                                                                  01130000
011400     PERFORM 8000-OPEN-TRIP-CSR.                                  01140002
011500     PERFORM 8010-FETCH-TRIP-CSR.                                 01150002
011600                                                                  01160000
011700     PERFORM 2000-PROCESS-TRIP                                    01170000
011800       UNTIL PS-END-OF-TRIP-CSR-YES.                              01180000
011900                                                                  01190000
012000     PERFORM 8020-CLOSE-TRIP-CSR.                                 01200000
012100                                                                  01210000
012200     DISPLAY '************************************************'   01220000
012300     DISPLAY '** TRKUT092'                                        01230000
012400     DISPLAY '** '                                                01240000
012500     DISPLAY '** TRIP COUNT:  ' PV-TRIP-COUNT                     01250000
012600     DISPLAY '** SHPMT COUNT: ' PV-SHPMT-COUNT                    01260000
012700     DISPLAY '************************************************'   01270000
012800                                                                  01280000
012900     CLOSE TRIP-FILE                                              01290000
013000           SHPMT-FILE.                                            01300000
013100                                                                  01310000
013200     STOP RUN.                                                    01320000
013300                                                                  01330000
013310***********************************************************       01331002
013320*                                                         *       01332002
013330***********************************************************       01333002
013340 0100-GET-DAYS-BACK.                                              01334002
013350                                                                  01335002
013360     EXEC SQL                                                     01336002
013370        SELECT FUNC_QTY                                           01337002
013380             , CURRENT DATE                                       01338002
013390             , CURRENT DATE - FUNC_QTY DAYS                       01339002
013391          INTO :PV-DAYS-BACK                                      01339102
013392             , :PV-CURRENT-DATE                                   01339202
013393             , :PV-CHECK-DATE                                     01339302
013394          FROM TKRPRPM                                            01339402
013395         WHERE LOC_ID             =  90                           01339502
013396           AND INTFC_SYS_CDE      = 'KHL'                         01339602
013397           AND SYS_PRC_FUNC_CDE   = 'TRIPG2'                      01339702
013398           AND FUNC_PRC_STAT_CDE  = 'AC'                          01339802
013399           AND FUNC_BEG_TMST     <= CURRENT TIMESTAMP             01339902
013400           AND FUNC_END_TMST     >= CURRENT TIMESTAMP             01340002
013401     END-EXEC.                                                    01340102
013402                                                                  01340202
013403     EVALUATE TRUE                                                01340302
013404         WHEN SQLCODE = ZERO                                      01340402
013405              CONTINUE                                            01340502
013406                                                                  01340602
013407         WHEN SQLCODE = +100                                      01340702
013408              MOVE 1000         TO  PV-DAYS-BACK                  01340802
013409         WHEN OTHER                                               01340902
013410             MOVE '0100-GET-DAYS-BACK '                           01341002
013411                                       TO PV-ABEND-PARAGRAPH      01341102
013412             MOVE 'CHECK DAYS BACK'    TO PV-ABEND-OPERATION      01341202
013413             PERFORM 9900-DB2-ABEND                               01341302
013414     END-EVALUATE.                                                01341402
013415                                                                  01341502
013416                                                                  01341602
013420***********************************************************       01342000
013500*                                                         *       01350000
013600***********************************************************       01360000
013700 2000-PROCESS-TRIP.                                               01370000
013800                                                                  01380000
013900     PERFORM 3000-WRITE-TRIP-RECORD.                              01390000
014000                                                                  01400000
014100     SET  PS-END-OF-SHPMT-CSR-NO  TO  TRUE.                       01410000
014200                                                                  01420000
014300     MOVE  VEHICL-CURR-TRIP-ID  TO  DK-TRIP-ID.                   01430005
014400                                                                  01440000
014500     PERFORM 8030-OPEN-SHPMT-CSR                                  01450000
014600     PERFORM 8040-FETCH-SHPMT-CSR                                 01460000
014700                                                                  01470000
014800     PERFORM 2100-PROCESS-SHPMT                                   01480000
014900       UNTIL PS-END-OF-SHPMT-CSR-YES.                             01490000
015000                                                                  01500000
015100     PERFORM 8050-CLOSE-SHPMT-CSR.                                01510000
015200                                                                  01520000
015300     PERFORM 8010-FETCH-TRIP-CSR.                                 01530000
015400                                                                  01540000
015500                                                                  01550000
015600***********************************************************       01560000
015700*                                                         *       01570000
015800***********************************************************       01580000
015900 2100-PROCESS-SHPMT.                                              01590000
016000                                                                  01600000
016100     PERFORM 3100-WRITE-SHPMT-RECORD.                             01610000
016110                                                                  01611000
016111     PERFORM 8040-FETCH-SHPMT-CSR.                                01611100
016112                                                                  01611200
016113                                                                  01611300
016114***********************************************************       01611400
016115*                                                         *       01611500
016116***********************************************************       01611600
016117 3000-WRITE-TRIP-RECORD.                                          01611700
016118                                                                  01611800
016119     INITIALIZE  TR074-RECORD.                                    01611900
016120     MOVE VEHICL-OWNER-SCAC-ID     TO TR074-OWNER-SCAC-ID.        01612002
016130     MOVE VEHICL-VEH-NBR           TO TR074-VEH-NBR.              01613002
016140     MOVE VEHICL-CURR-TRIP-ID      TO TR074-TRIP-ID.              01614002
016150     MOVE TRIPST-TRIP-STATUS-CDE   TO TR074-TRIP-STATUS-CDE.      01615000
016160     MOVE TRIPST-STATUS-DTE        TO TR074-TRIP-STATUS-DTE.      01616000
016170     MOVE TRIPST-STATUS-TME        TO TR074-TRIP-STATUS-TME.      01617000
016180     MOVE TRIPST-STATUS-UID        TO TR074-TRIP-STATUS-UID.      01618000
016190     MOVE TRIPST-OPER-UNT-ID       TO TR074-OPER-UNT-ID.          01619000
016200     MOVE TRIPST-FCLTY-ID          TO TR074-FCLTY-ID.             01620000
016300     MOVE VEHICL-CURR-STATUS-CDE   TO TR074-VEH-STATUS-CDE.       01630000
016400     MOVE VEHICL-CURR-TRIP-ID      TO TR074-VEH-TRIP-ID.          01640000
016500                                                                  01650000
016600     MOVE PV-NEW-STATUS-DTE        TO TR074-NEW-STATUS-DTE.       01660000
016700                                                                  01670000
016800     WRITE TRIP-RECORD                                            01680000
016900      FROM TR074-RECORD.                                          01690000
017000                                                                  01700000
017100     MOVE  TR074-OPER-UNT-ID TO PV-DISP-OPER.                     01710000
017200     MOVE  TR074-TRIP-ID     TO PV-DISP-TRIP.                     01720000
017300                                                                  01730000
017400     DISPLAY 'OPER: '           PV-DISP-OPER                      01740000
017500             '  TRIP: '         PV-DISP-TRIP                      01750000
017600             '   '              TR074-OWNER-SCAC-ID               01760000
017700             '/'                TR074-VEH-NBR                     01770000
017800             '  ST: '           TR074-TRIP-STATUS-CDE             01780000
017900             '  '               TR074-TRIP-STATUS-DTE             01790000
018000             ' @ '              TR074-TRIP-STATUS-TME             01800000
018100             '  '               TR074-TRIP-STATUS-UID             01810000
018200             '  NEW DTE:'       TR074-NEW-STATUS-DTE.             01820000
018300                                                                  01830000
018400     ADD +1                      TO PV-TRIP-COUNT.                01840000
018500                                                                  01850000
018600                                                                  01860000
018700***********************************************************       01870000
018800*                                                         *       01880000
018900***********************************************************       01890000
019000 3100-WRITE-SHPMT-RECORD.                                         01900000
019100                                                                  01910000
019200     INITIALIZE  TR075-RECORD.                                    01920000
019300     MOVE SHIPMT-TRIP-ID           TO TR075-TRIP-ID.              01930000
019400     MOVE SHIPMT-SHIPT-ID          TO TR075-SHIPT-ID.             01940000
019500     MOVE SHIPST-SHIPT-STATUS-CDE  TO TR075-SHIPT-STATUS-CDE.     01950000
019600     MOVE SHIPST-STATUS-DTE        TO TR075-STATUS-DTE.           01960000
019700     MOVE SHIPST-STATUS-TME        TO TR075-STATUS-TME.           01970000
019800                                                                  01980000
019900     MOVE PV-NEW-STATUS-DTE        TO TR075-NEW-STATUS-DTE.       01990000
020000                                                                  02000000
020100     WRITE SHPMT-RECORD                                           02010000
020200      FROM TR075-RECORD.                                          02020000
020300                                                                  02030000
020400     ADD +1                      TO PV-SHPMT-COUNT.               02040000
020500                                                                  02050000
020600                                                                  02060000
020700***********************************************************       02070000
020800*                                                         *       02080000
020900***********************************************************       02090000
021000 8000-OPEN-TRIP-CSR.                                              02100000
021100                                                                  02110000
021200     EXEC SQL                                                     02120000
021300        OPEN TRIP_CSR                                             02130000
021400     END-EXEC.                                                    02140000
021500                                                                  02150000
021600     EVALUATE TRUE                                                02160000
021700         WHEN SQLCODE = ZERO                                      02170000
021800             CONTINUE                                             02180000
021900         WHEN OTHER                                               02190000
022000             MOVE '8000-OPEN-TRIP-CSR'                            02200000
022100                                       TO PV-ABEND-PARAGRAPH      02210000
022200             MOVE 'OPEN TRIP CURSOR'   TO PV-ABEND-OPERATION      02220000
022300             PERFORM 9900-DB2-ABEND                               02230000
022400     END-EVALUATE.                                                02240000
022500                                                                  02250000
022600                                                                  02260000
022700***********************************************************       02270000
022800*                                                         *       02280000
022900***********************************************************       02290000
023000 8010-FETCH-TRIP-CSR.                                             02300000
023100                                                                  02310000
023200     EXEC SQL                                                     02320000
023300        FETCH TRIP_CSR                                            02330000
023400        INTO :VEHICL-OWNER-SCAC-ID                                02340002
023500           , :VEHICL-VEH-NBR                                      02350002
023600           , :VEHICL-CURR-TRIP-ID                                 02360002
023700           , :TRIPST-TRIP-STATUS-CDE                              02370000
023900           , :TRIPST-STATUS-DTE                                   02390000
024000           , :TRIPST-STATUS-TME                                   02400000
024100           , :TRIPST-STATUS-UID                                   02410000
024110           , :TRIPST-OPER-UNT-ID                                  02411006
024200           , :PV-NEW-STATUS-DTE                                   02420000
024300     END-EXEC.                                                    02430000
024400                                                                  02440000
024500     EVALUATE TRUE                                                02450000
024600         WHEN SQLCODE = ZERO                                      02460000
024700                                                                  02470000
024800             MOVE SPACES  TO  VEHICL-CURR-STATUS-CDE              02480000
025000                                                                  02500000
025100         WHEN SQLCODE = +100                                      02510000
025200             SET  PS-END-OF-TRIP-CSR-YES  TO TRUE                 02520000
025300         WHEN OTHER                                               02530000
025400             MOVE '8010-FETCH-TRIP-CSR'                           02540000
025500                                       TO PV-ABEND-PARAGRAPH      02550000
025600             MOVE 'FETCH TRIP CSR'     TO PV-ABEND-OPERATION      02560000
025700             PERFORM 9900-DB2-ABEND                               02570000
025800     END-EVALUATE.                                                02580000
025900                                                                  02590000
026000                                                                  02600000
026100***********************************************************       02610000
026200*                                                         *       02620000
026300***********************************************************       02630000
026400 8020-CLOSE-TRIP-CSR.                                             02640000
026500                                                                  02650000
026600     EXEC SQL                                                     02660000
026700        CLOSE TRIP_CSR                                            02670000
026800     END-EXEC.                                                    02680000
026900                                                                  02690000
027000     EVALUATE TRUE                                                02700000
027100         WHEN SQLCODE = ZERO                                      02710000
027200             CONTINUE                                             02720000
027300         WHEN OTHER                                               02730000
027400             MOVE '8020-CLOSE-TRIP-CSR'                           02740000
027500                                       TO PV-ABEND-PARAGRAPH      02750000
027600             MOVE 'CLOSE TRIP CSR'     TO PV-ABEND-OPERATION      02760000
027700             PERFORM 9900-DB2-ABEND                               02770000
027800     END-EVALUATE.                                                02780000
027900                                                                  02790000
028000                                                                  02800000
028100***********************************************************       02810000
028200*                                                         *       02820000
028300***********************************************************       02830000
028400 8030-OPEN-SHPMT-CSR.                                             02840000
028410                                                                  02841000
028420     EXEC SQL                                                     02842000
028421        OPEN SHPMT_CSR                                            02842100
028422     END-EXEC.                                                    02842200
028423                                                                  02842300
028424     EVALUATE TRUE                                                02842400
028425         WHEN SQLCODE = ZERO                                      02842500
028426             CONTINUE                                             02842600
028427         WHEN OTHER                                               02842700
028428             MOVE '8030-OPEN-SHPMT-CSR'                           02842800
028429                                       TO PV-ABEND-PARAGRAPH      02842900
028430             MOVE 'OPEN TRIP CURSOR'   TO PV-ABEND-OPERATION      02843000
028431             PERFORM 9900-DB2-ABEND                               02843100
028432     END-EVALUATE.                                                02843200
028433                                                                  02843300
028434                                                                  02843400
028435***********************************************************       02843500
028436*                                                         *       02843600
028437***********************************************************       02843700
028438 8040-FETCH-SHPMT-CSR.                                            02843800
028439                                                                  02843900
028440     EXEC SQL                                                     02844000
028450        FETCH SHPMT_CSR                                           02845000
028451        INTO :SHIPMT-TRIP-ID                                      02845100
028452           , :SHIPMT-SHIPT-ID                                     02845200
028453           , :SHIPST-SHIPT-STATUS-CDE                             02845300
028454           , :SHIPST-STATUS-DTE                                   02845400
028455           , :SHIPST-STATUS-TME                                   02845500
028456           , :PV-NEW-STATUS-DTE                                   02845600
028457     END-EXEC.                                                    02845700
028458                                                                  02845800
028459     EVALUATE TRUE                                                02845900
028460         WHEN SQLCODE = ZERO                                      02846000
028461             CONTINUE                                             02846100
028462         WHEN SQLCODE = +100                                      02846200
028463             SET  PS-END-OF-SHPMT-CSR-YES  TO TRUE                02846300
028464         WHEN OTHER                                               02846400
028465             MOVE '8040-FETCH-SHPMT-CSR'                          02846500
028466                                       TO PV-ABEND-PARAGRAPH      02846600
028467             MOVE 'FETCH SHPMT CSR'    TO PV-ABEND-OPERATION      02846700
028468             PERFORM 9900-DB2-ABEND                               02846800
028469     END-EVALUATE.                                                02846900
028470                                                                  02847000
028471                                                                  02847100
028472***********************************************************       02847200
028473*                                                         *       02847300
028474***********************************************************       02847400
028475 8050-CLOSE-SHPMT-CSR.                                            02847500
028476                                                                  02847600
028477     EXEC SQL                                                     02847700
028478        CLOSE SHPMT_CSR                                           02847800
028479     END-EXEC.                                                    02847900
028480                                                                  02848000
028481     EVALUATE TRUE                                                02848100
028482         WHEN SQLCODE = ZERO                                      02848200
028483             CONTINUE                                             02848300
028484         WHEN OTHER                                               02848400
028485             MOVE '8050-CLOSE-TRIP-CSR'                           02848500
028486                                       TO PV-ABEND-PARAGRAPH      02848600
028487             MOVE 'CLOSE SHPMT CSR'    TO PV-ABEND-OPERATION      02848700
028488             PERFORM 9900-DB2-ABEND                               02848800
028489     END-EVALUATE.                                                02848900
028490                                                                  02849000
028491                                                                  02849100
028492                                                                  02849200
028493                                                                  02849300
028494***********************************************************       02849400
028495*                                                         *       02849500
028496***********************************************************       02849600
028497 9900-DB2-ABEND.                                                  02849700
028498                                                                  02849800
028499     MOVE SQLCODE TO PV-SQLCODE.                                  02849900
028500     DISPLAY '*** DB2 ERROR '.                                    02850000
028600     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       02860000
028700     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 02870000
028800     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               02880000
028900     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               02890000
029000     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       02900000
029100     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       02910000
029200     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       02920000
029300                                                                  02930000
029400     COPY DPPD004.                                                02940000
029500                                                                  02950000
029510     IF SQLCODE NOT = -911                                        02951000
029520         EXEC SQL                                                 02952000
029530              ROLLBACK                                            02953000
029540         END-EXEC                                                 02954000
029550     END-IF.                                                      02955000
029560                                                                  02956000
029570     MOVE +4013                  TO PV-ABEND-CODE.                02957000
029580     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02958000
029590                                                                  02959000
