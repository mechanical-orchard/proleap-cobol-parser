000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.   RVKRP025                                           00050099
000600 AUTHOR.       AL PETERS.                                         00060002
000700 INSTALLATION. KOHLS DEPARTMENT STORES.                           00070000
000800 DATE-WRITTEN. MAY 2007.                                          00080081
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  GENCO INVENTORY:   PROGRAM WILL READ THE GENCO INVENTORY       00120081
      *                     ERROR FILE AND CREATE A REPORT OF ALL       00130099
001220*                     INVENTORY ERRORS ALONG WITH A FINAL TOTAL   00140099
001230*                     OF ALL QUANTITY, COST AND RETAIL AMOUNTS.   00150099
W40134******************************************************************00160099
W40134*  CHANGE LOG.                                                    00170099
W40134*  DATE         CHANGED BY      DESC                              00180099
W40134*  -----------  --------------  ----------------------------------00190099
W40134*  10/30/2011   C. STRODTHOFF - GENCO / RTV UPGRADE. ADD RTV LOC  00200099
W40134*                               TO REPORT. FIX MAINLINE LOGIC     00210099
W40134*                               ERRORS AND COMPILER ERRORS.       00220099
W40134*                               PRJ ID 3219 - WR40134.            00230099
W40134******************************************************************00240099
001300******************************************************************00250000
018800 ENVIRONMENT DIVISION.                                            00260000
018900******************************************************************00270000
019000                                                                  00280000
019100 CONFIGURATION SECTION.                                           00290000
019200                                                                  00300000
019300 SOURCE-COMPUTER.        IBM-3090.                                00310000
019400 OBJECT-COMPUTER.        IBM-3090.                                00320000
019500                                                                  00330000
019600 INPUT-OUTPUT SECTION.                                            00340000
019700                                                                  00350000
019800 FILE-CONTROL.                                                    00360000
019900                                                                  00370000
020000     SELECT RVK-ERR-FILE                                          00380099
020100         ASSIGN TO INP01.                                         00390000
020200                                                                  00400000
020540     SELECT ERROR-REPORT                                          00410044
020550         ASSIGN TO RPT01.                                         00420044
020600******************************************************************00430000
020700 DATA DIVISION.                                                   00440000
020800******************************************************************00450000
020900                                                                  00460000
021000 FILE SECTION.                                                    00470000
021100                                                                  00480000
021900 FD  RVK-ERR-FILE                                                 00490099
022000     RECORDING MODE IS F                                          00500000
022100     LABEL RECORDS ARE STANDARD                                   00510000
022200     BLOCK CONTAINS 0 RECORDS.                                    00520000
022300                                                                  00530000
022400 01  RVK-ERR-RECORD                   PIC X(150).                 00540099
022401                                                                  00550001
022470                                                                  00560001
022480 FD  ERROR-REPORT                                                 00570044
022490     RECORDING MODE IS F                                          00580042
022491     LABEL RECORDS ARE STANDARD                                   00590042
022492     BLOCK CONTAINS 0 RECORDS.                                    00600042
022493                                                                  00610042
022494 01  ERROR-RPT-RECORD                 PIC X(132).                 00620042
                                                                        00630099
022500******************************************************************00640000
022600 WORKING-STORAGE SECTION.                                         00650000
022700******************************************************************00660000
022800                                                                  00670000
037800******************************************************************00680000
037900* INPUT LAYOUT - RV025-INVENTORY-ERROR-INPUT-RECORD.              00690099
038000******************************************************************00700000
038100     COPY RVRD025.                                                00710099
038200                                                                  00720000
037800******************************************************************00730099
038210* STANDARD REPORT HEADER FOR A 132 COLUMN REPORT                  00740099
037800******************************************************************00750099
038220     COPY DPWS132.                                                00760042
038230                                                                  00770042
039880******************************************************************00780017
039900*  DB2 FORMATTED MESSAGE AREA                                     00790000
040000******************************************************************00800000
040100     COPY DPWS004.                                                00810000
041700                                                                  00820000
041750                                                                  00830019
041800 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00840000
041900                                                   COMP SYNC.     00850000
041940***  PROGRAM ACCUMULATORS                                         00860042
042000 01  PA-PROGRAM-ACCUMULATORS.                                     00870000
042100     05  PA-TOTALS.                                               00880000
042200         10 PA-TOT-RECS-READ          PIC S9(09) VALUE +0 COMP-3. 00890000
W40134*        10 PA-TOT-ERR-RECS-READ      PIC S9(09) VALUE +0 COMP-3. 00900099
W40134*        10 PA-TOT-ERR-WRITTEN        PIC S9(09) VALUE +0 COMP-3. 00910099
043501                                                                  00920043
043515                                                                  00930045
044701***  TYPE TOTALS                                                  00940099
044702         10 PA-TOTAL-QTY           PIC 9(09)  VALUE ZERO.         00950099
044703         10 PA-TOTAL-COST-AMT      PIC S9(09)V99 VALUE +0 COMP-3. 00960099
044704         10 PA-TOTAL-RETAIL-AMT    PIC S9(09)V99 VALUE +0 COMP-3. 00970099
044708                                                                  00980048
044710***  PROGRAM SWITCHES                                             00990042
044800 01  PS-PROGRAM-SWITCHES.                                         01000042
045500     05  PS-END-OF-ERR-INPUT-SW        PIC  X(01)    VALUE 'N'.   01010099
045600         88  PS-END-OF-ERR-INPUT-YES                 VALUE 'Y'.   01020099
045700         88  PS-END-OF-ERR-INPUT-NO                  VALUE 'N'.   01030099
                                                                        01040099
045800     05  PS-QTY-SW                     PIC  X(01)    VALUE 'N'.   01050099
045900         88  PS-QTY-YES                              VALUE 'Y'.   01060099
046000         88  PS-QTY-NO                               VALUE 'N'.   01070099
006700                                                                  01080067
045800     05  PS-ERROR-SW                   PIC  X(01)    VALUE 'N'.   01090099
045900         88  PS-ERROR-YES                            VALUE 'Y'.   01100099
046000         88  PS-ERROR-NO                             VALUE 'N'.   01110099
                                                                        01120099
062300***  PROGRAM CONSTANTS                                            01130042
062410 01  PC-PROGRAM-CONSTANTS.                                        01140042
062420     05  PC-MAX-REPORT-LINES         PIC 9(02)  VALUE 55.         01150042
062500     05  PC-CURRENT-PROGRAM-NAME     PIC X(08)  VALUE 'RVKRP025'. 01160099
066000     05  PC-SPACE                    PIC X(01)  VALUE ' '.        01170000
024100     05  PC-SYSTEM-DATE              PIC 9(06)  VALUE ZERO.       01180099
                                                                        01190099
066600                                                                  01200000
                                                                        01210081
066610***  PROGRAM VARIABLES                                            01220042
066700 01  PV-PROGRAM-VARIABLES.                                        01230017
066810                                                                  01240017
           05  PV-BOL-A                    PIC X(15).                   01250099
           05  PV-BOL-N REDEFINES PV-BOL-A                              01260099
                                           PIC 9(15).                   01270099
                                                                        01280099
066820     05  PV-PAGE-COUNT               PIC 9(05) VALUE 0.           01290042
066821     05  PV-REPT-LINE-COUNT          PIC 9(02) VALUE 0.           01300042
           05  PV-REC-WRITTEN              PIC 9(09) VALUE 0.           01310050
                                                                        01320099
069000                                                                  01330018
071800 01  PV-ABEND-VARIABLES.                                          01340000
071900     05  PV-ABEND-CODE              PIC S9(04) VALUE +0 COMP SYNC.01350000
073900                                                                  01360042
074000***  SYSTEM DATE VARIABLES                                        01370042
074100 01  SD-SYSTEM-DATE.                                              01380042
074200     05  SD-SYSTEM-CCYY              PIC  9(04)  VALUE ZEROS.     01390042
074300     05  SD-SYSTEM-MONTH             PIC  9(02)  VALUE ZEROS.     01400042
074400     05  SD-SYSTEM-DAY               PIC  9(02)  VALUE ZEROS.     01410042
074500                                                                  01420042
074510***  SYSTEM TIME VARIABLES                                        01430042
074520 01  ST-SYSTEM-TIME.                                              01440042
074530     05  ST-SYSTEM-HOUR              PIC  9(02)  VALUE ZEROS.     01450042
074540     05  ST-SYSTEM-MINUTE            PIC  9(02)  VALUE ZEROS.     01460042
074550                                                                  01470042
074600***  REPORT HEADING AND DETAIL LINES                              01480042
074700 01  PH2-PAGE-HEADING-2.                                          01490042
074800     05  FILLER                          PIC  X(50)  VALUE SPACE. 01500099
074900     05  FILLER                          PIC  X(30)  VALUE        01510099
075000         'ERRORS ON GENCO INVENTORY FILE'.                        01520099
                                                                        01530081
W40134 01  PH2-HEADER-LINE-02.                                          01540099
W40134     05  FILLER                          PIC X(17)                01550099
W40134         VALUE 'RTV LOCATION  :  '.                               01560099
W40134     05  HL02-RTV-LOC-NBR                PIC 9999  VALUE ZEROES.  01570099
W40134     05  FILLER                          PIC X(02) VALUE SPACES.  01580099
W40134     05  HL02-RTV-LOC-NM                 PIC X(10) VALUE SPACES.  01590099
W40134                                                                  01600099
075910 01  DH1-DETAIL-HEADING-1.                                        01610042
075920     05  FILLER                          PIC  X(15)  VALUE SPACE. 01620099
075930     05  FILLER                          PIC  X(06)  VALUE        01630099
075940         'RETURN'.                                                01640099
075950     05  FILLER                          PIC  X(07)  VALUE SPACE. 01650081
075960     05  FILLER                          PIC  X(03)  VALUE        01660099
075970         'SUB'.                                                   01670099
076007                                                                  01680042
076008 01  DH2-DETAIL-HEADING-2.                                        01690042
076013     05  FILLER                          PIC  X(14)  VALUE        01700099
076014         'BILL OF LADING'.                                        01710099
076015     05  FILLER                          PIC  X(02)  VALUE SPACE. 01720099
076016     05  FILLER                          PIC  X(04)  VALUE        01730082
076017         'TYPE'.                                                  01740082
076015     05  FILLER                          PIC  X(02)  VALUE SPACE. 01750082
076016     05  FILLER                          PIC  X(04)  VALUE        01760042
076017         'DEPT'.                                                  01770042
076018     05  FILLER                          PIC  X(01)  VALUE SPACE. 01780099
076019     05  FILLER                          PIC  X(05)  VALUE        01790099
076020         'CLASS'.                                                 01800099
076021     05  FILLER                          PIC  X(02)  VALUE SPACE. 01810099
076022     05  FILLER                          PIC  X(03)  VALUE        01820099
076023         'SKU'.                                                   01830099
076024     05  FILLER                          PIC  X(06)  VALUE SPACE. 01840099
076025     05  FILLER                          PIC  X(11)  VALUE        01850099
076026         'COST AMOUNT'.                                           01860099
076027     05  FILLER                          PIC  X(06)  VALUE SPACE. 01870099
076028     05  FILLER                          PIC  X(13)  VALUE        01880099
076029         'RETAIL AMOUNT'.                                         01890099
076030     05  FILLER                          PIC  X(17)  VALUE SPACE. 01900099
076033     05  FILLER                          PIC  X(13)  VALUE        01910099
076034         'ERROR MESSAGE'.                                         01920099
076035     05  FILLER                          PIC  X(13)  VALUE SPACE. 01930099
076036     05  FILLER                          PIC  X(11)  VALUE        01940099
076037         'ERROR VALUE'.                                           01950099
076038                                                                  01960042
076039 01  DH3-DETAIL-HEADING-3.                                        01970042
076040     05  FILLER                          PIC  X(132) VALUE        01980042
076041                                                       ALL '-'.   01990042
076042 01  DL1-DETAIL-LINE.                                             02000043
076044     05  DL1-BOL                         PIC  Z(14)9.             02010099
076046     05  FILLER                          PIC  X(04)  VALUE SPACE. 02020099
076047     05  DL1-RETURN-TYPE                 PIC  X(01).              02030042
076048     05  FILLER                          PIC  X(03)  VALUE SPACE. 02040082
076049     05  DL1-DEPT                        PIC  X(03).              02050045
076050     05  FILLER                          PIC  X(03)  VALUE SPACE. 02060099
076051     05  DL1-SUB-CL                      PIC  X(02).              02070099
076052     05  FILLER                          PIC  X(02)  VALUE SPACE. 02080099
076053     05  DL1-SKU                         PIC  X(08).              02090099
076054     05  FILLER                          PIC  X(02)  VALUE SPACE. 02100045
076059     05  DL1-COST-AMT                    PIC  ZZZ,ZZZ,ZZZ.ZZ-.    02110099
076060     05  FILLER                          PIC  X(02)  VALUE SPACE. 02120082
076061     05  DL1-RETAIL-AMT                  PIC  ZZZ,ZZZ,ZZZ.ZZ-.    02130099
076060     05  FILLER                          PIC  X(03)  VALUE SPACE. 02140099
076061     05  DL1-ERROR-MSG                   PIC  X(35).              02150099
076060     05  FILLER                          PIC  X(02)  VALUE SPACE. 02160099
076061     05  DL1-ERROR-VALUE                 PIC  X(15).              02170099
076062                                                                  02180042
076084 01  TL1-TOTAL-LINE.                                              02190099
076086     05  FILLER                          PIC  X(07)  VALUE        02200099
076087         'TOTALS:'.                                               02210099
076088     05  FILLER                          PIC  X(05)  VALUE SPACE. 02220099
076089     05  FILLER                          PIC  X(09)  VALUE        02230099
076110         'UNIT QTY='.                                             02240099
076120     05  FILLER                          PIC  X(01)  VALUE SPACE. 02250099
076130     05  TL1-TOT-QTY                     PIC  ZZZ,ZZZ,ZZZ.        02260099
076150     05  FILLER                          PIC  X(10)  VALUE SPACE. 02270099
           05  TL1-TOT-COST                    PIC  ZZZ,ZZZ,ZZZ.99-.    02280099
076151     05  FILLER                          PIC  X(02)  VALUE SPACE. 02290099
076152     05  TL1-TOT-RETAIL                  PIC  ZZZ,ZZZ,ZZZ.99-.    02300099
076160                                                                  02310042
076196 01  BLANK-LINE.                                                  02320042
076197     05  FILLER                          PIC  X(132) VALUE SPACE. 02330042
076198                                                                  02340042
076199 01  END-OF-REPORT-LINE.                                          02350042
076200     05  FILLER                          PIC  X(54)  VALUE SPACE. 02360042
076201     05  FILLER                          PIC  X(25)  VALUE        02370042
076202         '***** END OF REPORT *****'.                             02380042
076203     05  FILLER                          PIC  X(53)  VALUE SPACE. 02390042
076204                                                                  02400042
076205 01  PV-NO-ERROR-LINE.                                            02410042
076206     05  FILLER                          PIC  X(43)  VALUE SPACE. 02420042
076207     05  FILLER                          PIC  X(47)  VALUE        02430042
076208         '******** THERE ARE NO ERRORS TO REPORT ********'.       02440042
076209     05  FILLER                          PIC  X(42)  VALUE SPACE. 02450042
076210                                                                  02460042
076211******************************************************************02470000
076212 LINKAGE SECTION.                                                 02480000
076220******************************************************************02490000
076300                                                                  02500000
076400******************************************************************02510000
076500 PROCEDURE DIVISION.                                              02520000
076600******************************************************************02530000
076700******************************************************************02540000
076800*  MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM.        02550099
076900******************************************************************02560000
077000 0000-PROGRAM-MAINLINE.                                           02570000
077100                                                                  02580000
W40134     DISPLAY '************ START OF RVKRP025 ****************'    02590099
077300     PERFORM 1000-INITIALIZE.                                     02600000
077400                                                                  02610000
W40134*    PROCESS INPUT FILES TO EOF                                   02620099
W40134     PERFORM 2000-PROCESS-ERR-FILE                                02630099
W40134       UNTIL PS-END-OF-ERR-INPUT-YES.                             02640099
W40134                                                                  02650099
W40134     PERFORM 8000-EOJ-ROUTINE.                                    02660099
W40134                                                                  02670099
W40134     DISPLAY '************  END OF RVKRP025  ****************'.   02680099
W40134                                                                  02690099
W40134 0000-PROGRAM-MAINLINE-EXIT.                                      02700099
W40134     GOBACK.                                                      02710099
080900                                                                  02720000
081000******************************************************************02730000
081100* INITIALIZE VARIABLES.                                           02740000
081200* OPEN FILES.                                                     02750003
      * CREATE REPORT DATE                                              02760099
081500* DO A PRIME READ FOR THE DETAIL FILE                             02770082
081700******************************************************************02780000
081800 1000-INITIALIZE.                                                 02790000
081900                                                                  02800000
082000     INITIALIZE   PA-PROGRAM-ACCUMULATORS.                        02810099
083500                                                                  02820008
083600     OPEN INPUT  RVK-ERR-FILE.                                    02830099
083701                                                                  02840001
083710     OPEN OUTPUT ERROR-REPORT.                                    02850099
                                                                        02860099
083800     ACCEPT PC-SYSTEM-DATE FROM DATE.                             02870099
                                                                        02880099
083900     MOVE FUNCTION CURRENT-DATE (1:8) TO SD-SYSTEM-DATE.          02890042
084000     MOVE FUNCTION CURRENT-DATE (9:6) TO ST-SYSTEM-TIME.          02900042
084100                                                                  02910042
084200     MOVE SD-SYSTEM-CCYY   TO DP132-RUN-YEAR.                     02920099
084300     MOVE SD-SYSTEM-MONTH  TO DP132-RUN-MONTH.                    02930099
084400     MOVE SD-SYSTEM-DAY    TO DP132-RUN-DAY.                      02940099
084500                                                                  02950042
084600     MOVE ST-SYSTEM-HOUR   TO DP132-RUN-HOUR.                     02960042
084700     MOVE ST-SYSTEM-MINUTE TO DP132-RUN-MINUTE.                   02970042
084800                                                                  02980042
084900     MOVE 'RVKRP025'       TO DP132-PROGRAM-NAME.                 02990099
085000     MOVE 1                TO DP132-REPORT-NUMBER.                03000042
085100                                                                  03010042
085500**PRIME READ OF ERR FILE                                          03020099
085600     PERFORM 6000-READ-RVK-ERR-FILE.                              03030099
085700                                                                  03040099
W40134     PERFORM 4000-WRITE-PAGE-HEADING.                             03050099
W40134                                                                  03060099
W40134**WHEN THERE IS 1 INPUT RECORD WITH RECORD-TYPE-IND = '0', THIS   03070099
W40134**INDICATES NO ERRORS WERE FOUND. RTV LOC# AND NAME ARE PASSED IN.03080099
W40134**READ ERROR FILE ONCE MORE TO DETERMINE EOF AND SET SWITCH.      03090099
W40134     IF RV025-RECORD-TYPE-IND = '0'                               03100099
W40134         ADD -1  TO PA-TOT-RECS-READ                              03110099
W40134         PERFORM 6000-READ-RVK-ERR-FILE                           03120099
W40134     END-IF.                                                      03130099
W40134                                                                  03140099
W40134     IF PS-END-OF-ERR-INPUT-YES                                   03150099
W40134        DISPLAY ' '                                               03160099
W40134        DISPLAY '****    NO RECORDS ON ERROR INPUT FILE     ****' 03170099
W40134        DISPLAY ' '                                               03180099
W40134        WRITE ERROR-RPT-RECORD                                    03190099
W40134            FROM PV-NO-ERROR-LINE                                 03200099
W40134            AFTER ADVANCING 1 LINE                                03210099
W40134     END-IF.                                                      03220099
W40134                                                                  03230099
                                                                        03240099
092700******************************************************************03250000
094900** PROCESS THE ERROR FILE                                         03260099
095000******************************************************************03270000
095100 2000-PROCESS-ERR-FILE.                                           03280099
095200                                                                  03290000
096834     PERFORM 6050-VALIDATE-UNIT-QTY.                              03300099
096837     PERFORM 4400-BUILD-DETAIL-LINE.                              03310099
096838     PERFORM 4100-WRITE-REPORT.                                   03320099
096840                                                                  03330045
096843     IF PS-END-OF-ERR-INPUT-NO                                    03340099
096844        PERFORM 6000-READ-RVK-ERR-FILE                            03350099
096845     END-IF.                                                      03360085
096860                                                                  03370004
096870******************************************************************03380042
096880*** WRITE THE PAGE HEADINGS                                       03390099
096890***   - WRITE HEADING TO THE REPORT.                              03400042
096900***   - EXECUTES WHEN PAGE BREAK OCCURS.                          03410042
097000******************************************************************03420042
097100 4000-WRITE-PAGE-HEADING.                                         03430042
097200     ADD  1             TO PV-PAGE-COUNT.                         03440042
097300     MOVE PV-PAGE-COUNT TO DP132-PAGE-NUMBER.                     03450042
097400                                                                  03460042
097500     WRITE ERROR-RPT-RECORD                                       03470042
097600         FROM DP132-STANDRD-HEADER-132-COLS                       03480042
097700         AFTER ADVANCING PAGE.                                    03490042
097800                                                                  03500042
097900     WRITE ERROR-RPT-RECORD                                       03510042
098000         FROM PH2-PAGE-HEADING-2                                  03520042
098100         AFTER ADVANCING 1 LINES.                                 03530042
098200                                                                  03540042
W40134     IF RV025-LOC-NBR IS NUMERIC                                  03550099
W40134         MOVE RV025-LOC-NBR    TO  HL02-RTV-LOC-NBR               03560099
W40134     ELSE                                                         03570099
W40134         MOVE +0               TO  HL02-RTV-LOC-NBR               03580099
W40134     END-IF.                                                      03590099
W40134     MOVE RV025-LOC-10-ABBR-NM TO  HL02-RTV-LOC-NM.               03600099
W40134     WRITE ERROR-RPT-RECORD                                       03610099
W40134         FROM PH2-HEADER-LINE-02                                  03620099
W40134         AFTER ADVANCING 1 LINES.                                 03630099
W40134                                                                  03640099
099500     WRITE ERROR-RPT-RECORD                                       03650042
099600         FROM BLANK-LINE                                          03660042
099700         AFTER ADVANCING 1 LINES.                                 03670042
099800                                                                  03680042
099900     WRITE ERROR-RPT-RECORD                                       03690042
100000         FROM DH1-DETAIL-HEADING-1                                03700042
100100         AFTER ADVANCING 1 LINES.                                 03710042
100200                                                                  03720042
100300     WRITE ERROR-RPT-RECORD                                       03730042
100400         FROM DH2-DETAIL-HEADING-2                                03740042
100500         AFTER ADVANCING 1 LINES.                                 03750042
100600                                                                  03760042
100300     WRITE ERROR-RPT-RECORD                                       03770064
100400         FROM DH3-DETAIL-HEADING-3                                03780064
100500         AFTER ADVANCING 1 LINES.                                 03790064
100600                                                                  03800064
101100     WRITE ERROR-RPT-RECORD                                       03810042
101200         FROM BLANK-LINE                                          03820042
101300         AFTER ADVANCING 1 LINES.                                 03830042
101400                                                                  03840042
101500     MOVE  6 TO PV-REPT-LINE-COUNT.                               03850042
101600                                                                  03860042
102400                                                                  03870042
102500******************************************************************03880042
102600*** WRITE THE REPORT                                              03890099
102700***   - WRITE DETAIL LINES TO THE REPORT.                         03900042
102800******************************************************************03910042
102810                                                                  03920042
102900 4100-WRITE-REPORT.                                               03930047
103000     IF  PV-REPT-LINE-COUNT > PC-MAX-REPORT-LINES                 03940042
103100         PERFORM 4000-WRITE-PAGE-HEADING                          03950042
103200     END-IF.                                                      03960042
103300                                                                  03970042
           IF RV025-UNT-QTY = 1                                         03980099
103600         WRITE ERROR-RPT-RECORD                                   03990099
103700             FROM DL1-DETAIL-LINE                                 04000099
103800             AFTER ADVANCING 2 LINES                              04010099
105500         ADD 2 TO PV-REPT-LINE-COUNT                              04020099
105510         ADD 1 TO PV-REC-WRITTEN                                  04030099
           ELSE                                                         04040099
               WRITE ERROR-RPT-RECORD                                   04050099
                   FROM DL1-DETAIL-LINE                                 04060099
                   AFTER ADVANCING 1 LINE                               04070099
               ADD 1 TO PV-REPT-LINE-COUNT                              04080099
               ADD 1 TO PV-REC-WRITTEN                                  04090099
           END-IF.                                                      04100099
105511                                                                  04110045
105520     INITIALIZE DL1-DETAIL-LINE.                                  04120045
108100                                                                  04130042
353400******************************************************************04140062
353401* BUILD DETAIL LINE                                               04150062
353410******************************************************************04160062
353411 4400-BUILD-DETAIL-LINE.                                          04170062
                                                                        04180085
           IF RV025-UNT-QTY > ZERO                                      04190099
               MOVE RV025-BL-NBR (24:15)       TO PV-BOL-A              04200099
               MOVE PV-BOL-N                   TO DL1-BOL               04210099
               MOVE RV025-RETURN-TYPE          TO DL1-RETURN-TYPE       04220099
               MOVE RV025-DEPT                 TO DL1-DEPT              04230099
               MOVE RV025-SUB-CLASS            TO DL1-SUB-CL            04240099
               MOVE RV025-SKU-NBR              TO DL1-SKU               04250099
               MOVE RV025-COST-AMT             TO DL1-COST-AMT          04260099
               MOVE RV025-RTL-AMT              TO DL1-RETAIL-AMT        04270099
               MOVE RV025-ERROR-MSG            TO DL1-ERROR-MSG         04280099
               MOVE RV025-ERROR-VALUE          TO DL1-ERROR-VALUE       04290099
           ELSE                                                         04300099
               MOVE RV025-SKU-NBR              TO DL1-SKU               04310099
               MOVE RV025-ERROR-MSG            TO DL1-ERROR-MSG         04320099
               MOVE RV025-ERROR-VALUE          TO DL1-ERROR-VALUE       04330099
           END-IF.                                                      04340099
           SET PS-ERROR-YES                TO TRUE.                     04350099
                                                                        04360099
108200******************************************************************04370047
108300*** WRITE THE FINAL TOTALS                                        04380099
108400***   - BUILD AND WRITE TOTALS AND FINAL TOTALS TO THE REPORT.    04390047
108500******************************************************************04400047
108600                                                                  04410047
108700 4500-WRITE-FINAL-TOTALS.                                         04420047
108701     IF  PV-REPT-LINE-COUNT > PC-MAX-REPORT-LINES                 04430048
108702         PERFORM 4000-WRITE-PAGE-HEADING                          04440048
108703     END-IF.                                                      04450048
108704                                                                  04460048
108711*** BUILD AND PRINT TOTALS                                        04470099
108720     MOVE PA-TOTAL-QTY          TO TL1-TOT-QTY.                   04480099
108730     MOVE PA-TOTAL-COST-AMT     TO TL1-TOT-COST.                  04490099
108740     MOVE PA-TOTAL-RETAIL-AMT   TO TL1-TOT-RETAIL.                04500099
108750                                                                  04510048
108800     IF  PV-REPT-LINE-COUNT > PC-MAX-REPORT-LINES                 04520047
108900         PERFORM 4000-WRITE-PAGE-HEADING                          04530047
109000     END-IF.                                                      04540047
109100                                                                  04550047
109200     WRITE ERROR-RPT-RECORD                                       04560047
109300         FROM TL1-TOTAL-LINE                                      04570099
109400         AFTER ADVANCING 4 LINES.                                 04580099
109500     ADD 4 TO PV-REPT-LINE-COUNT                                  04590099
109600     ADD 1 TO PV-REC-WRITTEN.                                     04600047
113010                                                                  04610048
224900******************************************************************04620000
225000* READ THE RVK ERROR FILE                                        *04630099
225100******************************************************************04640000
225200 6000-READ-RVK-ERR-FILE.                                          04650099
                                                                        04660088
225400     READ RVK-ERR-FILE                                            04670099
225500         INTO RV025-GENCO-INV-ERROR-RCD                           04680099
225600         AT END                                                   04690000
225700           SET PS-END-OF-ERR-INPUT-YES TO TRUE.                   04700099
225800                                                                  04710000
225900     IF PS-END-OF-ERR-INPUT-NO                                    04720099
W40134        ADD +1  TO PA-TOT-RECS-READ                               04730099
226200     END-IF.                                                      04740000
226300                                                                  04750000
226400******************************************************************04760019
226500* VALIDATE UNIT QTY FIELD TO DETERMINE ERROR ROW TYPE            *04770099
      *     VALUE = 1 MEANS FIRST ERROR MESSAGE, ACCUMULATE TOTALS     *04780099
      *     VALUE = 0 MEANS SUBSEQUENT ERROR MESSAGE ROWS              *04790099
      *               DO NOT ACCUMULATE TOTALS                         *04800099
      *     CONTROL BREAK IS BASED ON VALUE IN UNIT QTY FIELD BEING    *04810099
      *     '1' FOR NEW BREAK SHOW EVERYTHING ON DETAIL RECORD         *04820099
      *     '0' FOR CURRENT BREAK, SHOW ONLY SKU NUMBER ALONG WITH     *04830099
      *         ERROR INFORMATION.                                     *04840099
226600******************************************************************04850019
226700 6050-VALIDATE-UNIT-QTY.                                          04860099
226800                                                                  04870019
226900     IF RV025-UNT-QTY > ZERO                                      04880099
               ADD +1                 TO PA-TOTAL-QTY                   04890099
227000         ADD RV025-RTL-AMT      TO PA-TOTAL-RETAIL-AMT            04900099
               ADD RV025-COST-AMT     TO PA-TOTAL-COST-AMT              04910099
227020     END-IF.                                                      04920099
227300                                                                  04930019
353460******************************************************************04940045
353500* DISPLAY SUMMARY STATS AND CLOSE FILES.                          04950003
353800******************************************************************04960000
353900 8000-EOJ-ROUTINE.                                                04970000
W40134*    IF ANY ERRORS PRINTED THEN SET RETURN CODE 4095              04980099
W40134*    WHICH TRIGGERS EMAIL NOTIFICATION TO IS-LOGISTICS            04990099
W40134                                                                  05000099
W40134     IF PS-ERROR-YES                                              05010099
W40134         MOVE 4095 TO RETURN-CODE                                 05020099
W40134     END-IF.                                                      05030099
W40134                                                                  05040099
354000     PERFORM 4500-WRITE-FINAL-TOTALS.                             05050099
355100                                                                  05060000
W40134     WRITE ERROR-RPT-RECORD                                       05070099
W40134         FROM END-OF-REPORT-LINE                                  05080099
W40134         AFTER ADVANCING 3 LINES.                                 05090099
W40134                                                                  05100099
355300     CLOSE RVK-ERR-FILE                                           05110099
355320           ERROR-REPORT.                                          05120099
355400                                                                  05130000
355500     DISPLAY '***********************************************'.   05140000
355600     DISPLAY '**    * RVKRP025 SUMMARY STATISTICS *        **'.   05150099
355700     DISPLAY '**                                           **'.   05160000
355800     DISPLAY '**  ---------------------------------        **'.   05170088
W40134     DISPLAY '**  GENCO ERROR INVENTORY DETAIL FILE        **'.   05180099
356000     DISPLAY '**  ---------------------------------        **'.   05190088
W40134     DISPLAY '** TOT RECS READ       :' PA-TOT-RECS-READ          05200099
W40134                                              '            **'.   05210099
W40134*    DISPLAY '** TOT ERR RECS READ   :' PA-TOT-ERR-RECS-READ.     05220099
W40134*    DISPLAY '** TOT ERR RECS WRITTEN:' PA-TOT-ERR-WRITTEN.       05230099
358900     DISPLAY '***********************************************'.   05240000
359000                                                                  05250000
367020******************************************************************05260000
367100*                       END OF PROGRAM                            05270000
367200******************************************************************05280000
