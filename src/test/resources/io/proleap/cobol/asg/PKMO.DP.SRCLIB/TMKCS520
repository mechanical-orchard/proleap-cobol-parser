000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    TMKCS520.                                         00020000
000300 AUTHOR.        LOUIE CRISOSTOMO.                                 00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  04-05-94.                                         00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800*    E232 - TROUBLE CENTRAL PROCESSING                            00080000
000900*                                                                 00090000
001000*    THIS IS A CALLED ROUTINE USED TO DETERMINE                   00100000
001100*    HOW A TROUBLE WILL BE PROCESSED                              00110000
001200*                                                                 00120000
001300******************************************************************00130000
001310*                                                                 00131027
001320*********************************************************         00132028
001330* *   IF ANY CHANGES ARE MADE TO THIS PROGRAM         * *         00133028
001340* *   BE SURE TO CHECK THE BATCH PROGRAM (TMKUP520)   * *         00134028
001350* *   TO SEE IF THE SAME CHANGE SHOULD BE MADE        * *         00135028
001360*********************************************************         00136028
001370*                                                                 00137028
001400 ENVIRONMENT DIVISION.                                            00140000
001500 CONFIGURATION SECTION.                                           00150000
001600 SOURCE-COMPUTER.        IBM-3090.                                00160000
001700 OBJECT-COMPUTER.        IBM-3090.                                00170000
001800 DATA DIVISION.                                                   00180000
001900 WORKING-STORAGE SECTION.                                         00190000
002000                                                                  00200000
002100 01  PC-PROGRAM-CONSTANTS.                                        00210000
002200     05  PC-N                         PIC X(01) VALUE 'N'.        00220000
002300     05  PC-Y                         PIC X(01) VALUE 'Y'.        00230000
002400     05  PC-I                         PIC X(01) VALUE 'I'.        00240000
002500     05  PC-R                         PIC X(01) VALUE 'R'.        00250000
002600     05  PC-A                         PIC X(01) VALUE 'A'.        00260000
002700     05  PC-C                         PIC X(01) VALUE 'C'.        00270000
002800     05  PC-U                         PIC X(01) VALUE 'U'.        00280000
002900     05  PC-600                       PIC S9(4) VALUE +600        00290000
003000                                                COMP.             00300000
003100     05  PC-502                       PIC S9(4) VALUE +502        00310000
003200                                                COMP.             00320000
003300     05  PC-509                       PIC S9(4) VALUE +509        00330000
003400                                                COMP.             00340000
003500     05  PC-543                       PIC S9(4) VALUE +543        00350000
003600                                                COMP.             00360000
003700     05  PC-MAX-RETRIES               PIC S9(4) VALUE +3          00370000
003800                                                COMP SYNC.        00380000
003900     05  PC-RCKCS234                  PIC X(08) VALUE             00390000
004000                                                'RCKCS234'.       00400000
004100     05  PC-RCKCS232                  PIC X(08) VALUE             00410000
004200                                                'RCKCS232'.       00420000
004300     05  PC-RCKCS233                  PIC X(08) VALUE             00430000
004400                                                'RCKCS233'.       00440000
004500     05  PC-RCKCS808                  PIC X(08) VALUE             00450000
004600                                                'RCKCS808'.       00460000
004700     05  PC-TMKCS521                  PIC X(08) VALUE             00470000
004800                                                'TMKCS521'.       00480000
004900     05  PV-PRORATE                   PIC X(08).                  00490000
004910* JAK 05/2007 - ADD PROGRAM CONSTANTS                             00491028
004920     05  PC-WMS-CONTROL-MOD           PIC X(8)  VALUE  'WSKCS305'.00492015
004930* JAK 05/2007 - END                                               00493013
005000                                                                  00500000
005100 01  PS-PROGRAM-SWITCHES.                                         00510000
005200     05  PS-DONE-SW                   PIC  X    VALUE 'N'.        00520000
005300         88  PS-NOT-DONE                        VALUE 'N'.        00530000
005400         88  PS-DONE                            VALUE 'Y'.        00540000
005500     05  PS-RECORD-SW                 PIC  X    VALUE 'N'.        00550000
005600         88  PS-NO-MORE-RECORD                  VALUE 'N'.        00560000
005700         88  PS-MORE-RECORD                     VALUE 'Y'.        00570000
005800     05  PS-RECORD-FOUND-SW           PIC  X    VALUE 'N'.        00580000
005900         88  PS-RECORD-NOT-FOUND                VALUE 'N'.        00590000
006000         88  PS-RECORD-FOUND                    VALUE 'Y'.        00600000
006100     05  PS-ACK-SW                    PIC  X    VALUE 'N'.        00610000
006200         88  PS-ACK                             VALUE 'Y'.        00620000
006300         88  PS-NOT-ACK                         VALUE 'N'.        00630000
006400     05  PS-NEW-PRORATION-SW          PIC  X    VALUE 'N'.        00640000
006500         88  PS-NEW-PRORATION-ON                VALUE 'Y'.        00650000
006600         88  PS-NEW-PRORATION-OFF               VALUE 'N'.        00660000
006610* JAK 05/2007 - ADD SWITCHES                                      00661013
006620     05  PS-ASNS-TO-WMS-SW            PIC X(01) VALUE 'N'.        00662013
006630         88  PS-ASNS-TO-WMS-YES                 VALUE 'Y'.        00663013
006640         88  PS-ASNS-TO-WMS-NO                  VALUE 'N'.        00664013
006650     05  PS-DISTRO-TRBL-SW            PIC X(01) VALUE 'N'.        00665013
006660         88  PS-DISTRO-TRBL-YES                 VALUE 'Y'.        00666013
006670         88  PS-DISTRO-TRBL-NO                  VALUE 'N'.        00667013
006680* JAK 05/2007 - END                                               00668013
006700                                                                  00670000
006800 01  PV-PROGRAM-VARIABLES.                                        00680000
006900     05  PV-RETRY-COUNTER             PIC S9(4) VALUE ZERO        00690000
007000                                                COMP SYNC.        00700000
007100     05  PV-TEMP-COMP-X4.                                         00710000
007200         10  PV-TEMP-COMP             PIC S9(9) COMP.             00720000
007300     05  PV-EIBDATE.                                              00730000
007400         10  PV-EIBDATE-N             PIC 9(5).                   00740000
007500         10  FILLER                   PIC X(5).                   00750000
007600     05  PV-DB2-COUNT                 PIC S9(09)  VALUE ZERO      00760000
007700                                              COMP-3.             00770000
007800     05  PV-DB2-ACK-COUNT             PIC S9(09)  VALUE ZERO      00780000
007900                                              COMP-3.             00790000
008000     05  PV-NULL-IND                  PIC S9(4) VALUE ZERO        00800000
008100                                                COMP SYNC.        00810000
008200     05  PV-COUNT                     PIC S9(9) VALUE +0 COMP.    00820000
008210* JAK 05/2007 - ADD PROGRAM VARIABLES                             00821013
008220     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     00822013
008230                                                     COMP SYNC.   00823013
008240     05  PV-SQL-CNT                     PIC S9(04)   VALUE +0     00824013
008250                                                    COMP.         00825013
008260* JAK 05/2007 - END                                               00826013
008270*                                                                 00827013
008300                                                                  00830000
008400 01  PRV-PROGRAM-RETURN-VARIABLES.                                00840000
008500     05  PRV-00                       PIC X(42) VALUE             00850000
008600         '00PROGRAM CALL WAS SUCCESSFUL             '.            00860000
008700     05  PRV-03                       PIC X(42) VALUE             00870000
008800         '03BUYER DECISION PENDING                  '.            00880000
008900     05  PRV-40                       PIC X(42) VALUE             00890000
009000         '40TROUBLE RECORD ALREADY IN PROCESS       '.            00900000
009100     05  PRV-41                       PIC X(42) VALUE             00910000
009200         '41TROUBLE RECORD ALREADY RESOLVED         '.            00920000
009300     05  PRV-42                       PIC X(42) VALUE             00930000
009400         '42TROUBLE RECORD ALREADY ACKNOWLEDGED     '.            00940000
009500     05  PRV-43                       PIC X(42) VALUE             00950000
009600         '43TROUBLE RECORD NOT YET RESOLVED         '.            00960000
009700     05  PRV-44                       PIC X(42) VALUE             00970000
009800         '44RECORD NOT FOUND - TTRBNTF IN-PROC UPDT '.            00980000
009900     05  PRV-45                       PIC X(42) VALUE             00990000
010000         '45RECORD NOT FOUND - TTRBNTF RESPOND UPDT '.            01000000
010100     05  PRV-46                       PIC X(42) VALUE             01010000
010200         '46RECORD NOT FOUND - TTRBNTF ACKNWLG UPDT '.            01020000
010300     05  PRV-47                       PIC X(42) VALUE             01030000
010400         '47RECORD NOT FOUND - TTRBNTF RESOLVE UPDT '.            01040000
010500     05  PRV-48                       PIC X(42) VALUE             01050000
010600         '48DB2-ERROR - TTRBNTF SELECT              '.            01060000
010700     05  PRV-49                       PIC X(42) VALUE             01070000
010800         '49DB2-ERROR - TRECITM CURSOR              '.            01080000
010900     05  PRV-4A                       PIC X(42) VALUE             01090000
011000         '4AINVALID TM500-PROCESS-IND               '.            01100000
011100     05  PRV-4B                       PIC X(42) VALUE             01110000
011200         '4BINVALID TM500-LEVEL-IND                 '.            01120000
011300     05  PRV-4C                       PIC X(42) VALUE             01130000
011400         '4CDB2-ERROR - IN-PROC-CSR OPEN            '.            01140000
011500     05  PRV-4D                       PIC X(42) VALUE             01150000
011600         '4DDB2-ERROR - IN-PROC-CSR FETCH           '.            01160000
011700     05  PRV-4E                       PIC X(42) VALUE             01170000
011800         '4EDB2-ERROR - IN-PROC-CSR CLOSE           '.            01180000
011900     05  PRV-4F                       PIC X(42) VALUE             01190000
012000         '4FDB2-ERROR - IN-PROC-LINE/PACK-CSR OPEN  '.            01200000
012100     05  PRV-4G                       PIC X(42) VALUE             01210000
012200         '4GDB2-ERROR - IN-PROC-LINE/PACK-CSR FETCH '.            01220000
012300     05  PRV-4H                       PIC X(42) VALUE             01230000
012400         '4HDB2-ERROR - IN-PROC-LINE/PACK-CSR CLOSE '.            01240000
012500     05  PRV-4I                       PIC X(42) VALUE             01250000
012600         '4IDB2-ERROR - RESPOND-CSR OPEN            '.            01260000
012700     05  PRV-4J                       PIC X(42) VALUE             01270000
012800         '4JDB2-ERROR - RESPOND-CSR FETCH           '.            01280000
012900     05  PRV-4K                       PIC X(42) VALUE             01290000
013000         '4KDB2-ERROR - RESPOND-CSR CLOSE           '.            01300000
013100     05  PRV-4L                       PIC X(42) VALUE             01310000
013200         '4LDB2-ERROR - RESPOND-LINE/PACK-CSR OPEN  '.            01320000
013300     05  PRV-4M                       PIC X(42) VALUE             01330000
013400         '4MDB2-ERROR - RESPOND-LINE/PACK-CSR FETCH '.            01340000
013500     05  PRV-4N                       PIC X(42) VALUE             01350000
013600         '4NDB2-ERROR - RESPOND-LINE/PACK-CSR CLOSE '.            01360000
013700     05  PRV-4O                       PIC X(42) VALUE             01370000
013800         '4ODB2-ERROR - ACKNWLG-CSR OPEN            '.            01380000
013900     05  PRV-4P                       PIC X(42) VALUE             01390000
014000         '4PDB2-ERROR - ACKNWLG-CSR FETCH           '.            01400000
014100     05  PRV-4Q                       PIC X(42) VALUE             01410000
014200         '4QDB2-ERROR - ACKNWLG-CSR CLOSE           '.            01420000
014300     05  PRV-4R                       PIC X(42) VALUE             01430000
014400         '4RDB2-ERROR - ACKNWLG-LINE/PACK-CSR OPEN  '.            01440000
014500     05  PRV-4S                       PIC X(42) VALUE             01450000
014600         '4SDB2-ERROR - ACKNWLG-LINE/PACK-CSR FETCH '.            01460000
014700     05  PRV-4T                       PIC X(42) VALUE             01470000
014800         '4TDB2-ERROR - ACKNWLG-LINE/PACK-CSR CLOSE '.            01480000
014900     05  PRV-4U                       PIC X(42) VALUE             01490000
015000         '4UDB2-ERROR - RESOLVE-CSR OPEN            '.            01500000
015100     05  PRV-4V                       PIC X(42) VALUE             01510000
015200         '4VDB2-ERROR - RESOLVE-CSR FETCH           '.            01520000
015300     05  PRV-4W                       PIC X(42) VALUE             01530000
015400         '4WDB2-ERROR - RESOLVE-CSR CLOSE           '.            01540000
015500     05  PRV-4X                       PIC X(42) VALUE             01550000
015600         '4XDB2-ERROR - RESOLVE-LINE/PACK-CSR       '.            01560000
015700     05  PRV-4Y                       PIC X(42) VALUE             01570000
015800         '4YDB2-ERROR - RESOLVE-LINE/PACK-CSR FETCH '.            01580000
015900     05  PRV-4Z                       PIC X(42) VALUE             01590000
016000         '4ZDB2-ERROR - RESOLVE-LINE/PACK-CSR CLOSE '.            01600000
016100                                                                  01610000
016200******************************************************************01620000
016300*    COPYBOOK AREA                                                01630000
016400******************************************************************01640000
016500     COPY TMWS500.                                                01650000
016501                                                                  01650113
016510* JAK 05/2007 - ADD COPYBOOK FOR SHIPPING CONTROL MODULE          01651013
016520     COPY WSWS001.                                                01652013
016530                                                                  01653013
016700******************************************************************01670000
016800*    DB2 SQL COMMUNICATION AREA                                   01680000
016900******************************************************************01690000
017000     EXEC SQL                                                     01700000
017100          INCLUDE SQLCA                                           01710000
017200     END-EXEC.                                                    01720000
017300                                                                  01730000
017400******************************************************************01740000
017500*    DB2 DCLGEN FOR PARM TABLE                                    01750000
017600******************************************************************01760000
017700     EXEC SQL                                                     01770000
017800          INCLUDE TKRPRPM                                         01780000
017900     END-EXEC.                                                    01790000
018000                                                                  01800000
018100******************************************************************01810000
018200*    DB2 DCLGEN FOR ALLOCATION TABLE                              01820000
018300******************************************************************01830000
018400     EXEC SQL                                                     01840000
018500          INCLUDE TALLPLN                                         01850000
018600     END-EXEC.                                                    01860000
018700                                                                  01870000
018800******************************************************************01880002
018900*    DB2 DCLGEN FOR PURCHASE ORDER TABLE                          01890003
019000******************************************************************01900003
019100     EXEC SQL                                                     01910003
019200          INCLUDE TPURCHS                                         01920003
019300     END-EXEC.                                                    01930003
019400                                                                  01940003
019500******************************************************************01950000
019600*    DB2 DCLGEN FOR TROUBLE NOTIFY TABLE                          01960000
019700******************************************************************01970000
019800     EXEC SQL                                                     01980000
019900          INCLUDE TTRBNTF                                         01990000
020000     END-EXEC.                                                    02000000
020100                                                                  02010000
020200******************************************************************02020000
020300*    DB2 DCLGEN FOR RECEIPT ITEM TABLE                            02030000
020400******************************************************************02040000
020500     EXEC SQL                                                     02050000
020600          INCLUDE TRECITM                                         02060000
020700     END-EXEC.                                                    02070000
020800                                                                  02080000
020810* JAK 05/2007 - ADD TABLES FOR WMS CODE                           02081013
020890******************************************************************02089013
020891*    DB2 DCLGEN FOR SHIPMENT TABLE                                02089113
020892******************************************************************02089213
020893     EXEC SQL                                                     02089313
020894          INCLUDE TSHIPMT                                         02089413
020895     END-EXEC.                                                    02089513
020896                                                                  02089613
020897******************************************************************02089713
020898*    DB2 DCLGEN FOR SHIPMENT PO TABLE                             02089813
020899******************************************************************02089913
020900     EXEC SQL                                                     02090013
020901          INCLUDE TSHPTPO                                         02090113
020902     END-EXEC.                                                    02090213
020903                                                                  02090313
020904******************************************************************02090413
020905*    DB2 DCLGEN FOR RECEIPT DISTRIBUTION TABLE                    02090513
020906******************************************************************02090613
020907     EXEC SQL                                                     02090713
020908          INCLUDE TRECDIS                                         02090813
020909     END-EXEC.                                                    02090913
020910                                                                  02091013
020911******************************************************************02091118
020912*    DB2 DCLGEN FOR RECEIPT RECEIVER TABLE                        02091218
020913******************************************************************02091318
020914     EXEC SQL                                                     02091418
020915          INCLUDE TRECEIV                                         02091518
020916     END-EXEC.                                                    02091618
020917                                                                  02091718
020918* JAK 05/2007 - END                                               02091813
020920******************************************************************02092000
021000*    IN-PROC TROUBLE NOTIFY CURSOR                                02100000
021100******************************************************************02110000
021200     EXEC SQL                                                     02120000
021300          DECLARE IN-PROC-CSR CURSOR FOR                          02130000
021400          SELECT NOTIF_NBR                                        02140000
021500               , RESOLVED_IND                                     02150000
021600               , RTV_IND                                          02160000
021700            FROM TTRBNTF                                          02170000
021800           WHERE OPER_UNT_ID  = :TM500-OPER-UNT-ID                02180000
021900             AND FCLTY_ID     = :TM500-FCLTY-ID                   02190000
022000             AND PO_NBR       = :TM500-PO-NBR                     02200000
022100             AND PO_LNE_NBR   = :TM500-PO-LNE-NBR                 02210000
022200             AND REC_SEQ_NBR  = :TM500-REC-SEQ-NBR                02220000
022300             AND TRBL_RSN_CDE = :TM500-TRBL-RSN-CDE               02230000
022400             AND RESOLVED_IND IN (:PC-N, :PC-I)                   02240000
022500           ORDER BY NOTIF_NBR                                     02250000
022600     END-EXEC.                                                    02260000
022700                                                                  02270000
022800******************************************************************02280000
022900*    IN-PROC TROUBLE NOTIFY CURSOR                                02290000
023000******************************************************************02300000
023100     EXEC SQL                                                     02310000
023200          DECLARE IN-PROC-PACK-CSR CURSOR FOR                     02320000
023300          SELECT NOTIF_NBR                                        02330000
023400               , RESOLVED_IND                                     02340000
023500               , RTV_IND                                          02350000
023600            FROM TTRBNTF                                          02360000
023700           WHERE OPER_UNT_ID  = :TM500-OPER-UNT-ID                02370000
023800             AND FCLTY_ID     = :TM500-FCLTY-ID                   02380000
023900             AND PO_NBR       = :TM500-PO-NBR                     02390000
024000             AND PREPK_ID     = :TM500-PREPK-ID                   02400000
024100             AND REC_SEQ_NBR  = :TM500-REC-SEQ-NBR                02410000
024200             AND TRBL_RSN_CDE = :TM500-TRBL-RSN-CDE               02420000
024300             AND RESOLVED_IND IN (:PC-N, :PC-I)                   02430000
024400           ORDER BY NOTIF_NBR                                     02440000
024500     END-EXEC.                                                    02450000
024600                                                                  02460000
024700******************************************************************02470000
024800*    IN-PROC ALL TROUBLE NOTIFY CURSOR                            02480000
024900******************************************************************02490000
025000     EXEC SQL                                                     02500000
025100          DECLARE IN-PROC-ALL-CSR CURSOR FOR                      02510000
025200          SELECT NOTIF_NBR                                        02520000
025300               , RESOLVED_IND                                     02530000
025400               , RTV_IND                                          02540000
025500            FROM TTRBNTF                                          02550000
025600           WHERE OPER_UNT_ID  = :TM500-OPER-UNT-ID                02560000
025700             AND FCLTY_ID     = :TM500-FCLTY-ID                   02570000
025800             AND PO_NBR       = :TM500-PO-NBR                     02580000
025900             AND REC_SEQ_NBR  = :TM500-REC-SEQ-NBR                02590000
026000             AND TRBL_RSN_CDE = :TM500-TRBL-RSN-CDE               02600000
026100             AND RESOLVED_IND IN (:PC-N, :PC-I)                   02610000
026200           ORDER BY NOTIF_NBR                                     02620000
026300     END-EXEC.                                                    02630000
026400                                                                  02640000
026500******************************************************************02650000
026600*    RESPOND TROUBLE NOTIFY CURSOR                                02660000
026700******************************************************************02670000
026800     EXEC SQL                                                     02680000
026900          DECLARE RESPOND-CSR CURSOR FOR                          02690000
027000          SELECT NOTIF_NBR                                        02700000
027100               , RESOLVED_IND                                     02710000
027200               , RTV_IND                                          02720000
027300            FROM TTRBNTF                                          02730000
027400           WHERE OPER_UNT_ID  = :TM500-OPER-UNT-ID                02740000
027500             AND FCLTY_ID     = :TM500-FCLTY-ID                   02750000
027600             AND PO_NBR       = :TM500-PO-NBR                     02760000
027700             AND PO_LNE_NBR   = :TM500-PO-LNE-NBR                 02770000
027800             AND REC_SEQ_NBR  = :TM500-REC-SEQ-NBR                02780000
027900             AND TRBL_RSN_CDE = :TM500-TRBL-RSN-CDE               02790000
028000             AND RESOLVED_IND IN (:PC-N, :PC-I)                   02800000
028100           ORDER BY NOTIF_NBR                                     02810000
028200     END-EXEC.                                                    02820000
028300                                                                  02830000
028400******************************************************************02840000
028500*    RESPOND TROUBLE NOTIFY CURSOR                                02850000
028600******************************************************************02860000
028700     EXEC SQL                                                     02870000
028800          DECLARE RESPOND-PACK-CSR CURSOR FOR                     02880000
028900          SELECT NOTIF_NBR                                        02890000
029000               , RESOLVED_IND                                     02900000
029100               , RTV_IND                                          02910000
029200            FROM TTRBNTF                                          02920000
029300           WHERE OPER_UNT_ID  = :TM500-OPER-UNT-ID                02930000
029400             AND FCLTY_ID     = :TM500-FCLTY-ID                   02940000
029500             AND PO_NBR       = :TM500-PO-NBR                     02950000
029600             AND PREPK_ID     = :TM500-PREPK-ID                   02960000
029700             AND REC_SEQ_NBR  = :TM500-REC-SEQ-NBR                02970000
029800             AND TRBL_RSN_CDE = :TM500-TRBL-RSN-CDE               02980000
029900             AND RESOLVED_IND IN (:PC-N, :PC-I)                   02990000
030000           ORDER BY NOTIF_NBR                                     03000000
030100     END-EXEC.                                                    03010000
030200                                                                  03020000
030300******************************************************************03030000
030400*    RESPOND ALL TROUBLE NOTIFY CURSOR                            03040000
030500******************************************************************03050000
030600     EXEC SQL                                                     03060000
030700          DECLARE RESPOND-ALL-CSR CURSOR FOR                      03070000
030800          SELECT NOTIF_NBR                                        03080000
030900               , RESOLVED_IND                                     03090000
031000               , RTV_IND                                          03100000
031100            FROM TTRBNTF                                          03110000
031200           WHERE OPER_UNT_ID  = :TM500-OPER-UNT-ID                03120000
031300             AND FCLTY_ID     = :TM500-FCLTY-ID                   03130000
031400             AND PO_NBR       = :TM500-PO-NBR                     03140000
031500             AND REC_SEQ_NBR  = :TM500-REC-SEQ-NBR                03150000
031600             AND TRBL_RSN_CDE = :TM500-TRBL-RSN-CDE               03160000
031700             AND RESOLVED_IND IN (:PC-N, :PC-I)                   03170000
031800           ORDER BY NOTIF_NBR                                     03180000
031900     END-EXEC.                                                    03190000
032000                                                                  03200000
032100******************************************************************03210000
032200*    RESOLVE AUTO MULTIPLE TROUBLE CURSOR                         03220000
032300******************************************************************03230000
032400     EXEC SQL                                                     03240000
032500          DECLARE AUTO-ALL-CSR CURSOR FOR                         03250000
032600          SELECT ORD_LNE_NBR                                      03260000
032700                ,PREPK_ID                                         03270000
032800            FROM TRECITM                                          03280000
032900           WHERE OPER_UNT_ID     = :TM500-OPER-UNT-ID             03290000
033000             AND FCLTY_ID        = :TM500-FCLTY-ID                03300000
033100             AND ORD_NBR         = :TM500-PO-NBR                  03310000
033200             AND REC_SEQ_NBR     = :TM500-REC-SEQ-NBR             03320000
033300             AND VER_STATUS_CDE  = :PC-A                          03330000
033400           ORDER BY ORD_LNE_NBR                                   03340000
033500     END-EXEC.                                                    03350000
033600                                                                  03360000
033700                                                                  03370000
033800******************************************************************03380000
033900*    RESOLVE AUTO PACK TROUBLE CURSOR                             03390000
034000******************************************************************03400000
034100     EXEC SQL                                                     03410000
034200          DECLARE AUTO-PACK-CSR CURSOR FOR                        03420000
034300          SELECT PREPK_ID                                         03430000
034400            FROM TRECITM                                          03440000
034500           WHERE OPER_UNT_ID     = :TM500-OPER-UNT-ID             03450000
034600             AND FCLTY_ID        = :TM500-FCLTY-ID                03460000
034700             AND ORD_NBR         = :TM500-PO-NBR                  03470000
034800             AND REC_SEQ_NBR     = :TM500-REC-SEQ-NBR             03480000
034900             AND VER_STATUS_CDE  = :PC-A                          03490000
035000           ORDER BY ORD_LNE_NBR                                   03500000
035100     END-EXEC.                                                    03510000
035200                                                                  03520000
035300******************************************************************03530000
035400*    RESOLVE TROUBLE NOTIFY CURSOR                                03540000
035500******************************************************************03550000
035600     EXEC SQL                                                     03560000
035700          DECLARE RESOLVE-CSR CURSOR FOR                          03570000
035800          SELECT NOTIF_NBR                                        03580000
035900               , RESOLVED_IND                                     03590000
036000               , RTV_IND                                          03600000
036100            FROM TTRBNTF                                          03610000
036200           WHERE OPER_UNT_ID  = :TM500-OPER-UNT-ID                03620000
036300             AND FCLTY_ID     = :TM500-FCLTY-ID                   03630000
036400             AND PO_NBR       = :TM500-PO-NBR                     03640000
036500             AND PO_LNE_NBR   = :TM500-PO-LNE-NBR                 03650000
036600             AND REC_SEQ_NBR  = :TM500-REC-SEQ-NBR                03660000
036700             AND TRBL_RSN_CDE = :TM500-TRBL-RSN-CDE               03670000
036800             AND RESOLVED_IND IN (:PC-N, :PC-I)                   03680000
036900           ORDER BY NOTIF_NBR                                     03690000
037000     END-EXEC.                                                    03700000
037100                                                                  03710000
037200******************************************************************03720000
037300*    RESOLVE TROUBLE NOTIFY CURSOR                                03730000
037400******************************************************************03740000
037500     EXEC SQL                                                     03750000
037600          DECLARE RESOLVE-PACK-CSR CURSOR FOR                     03760000
037700          SELECT NOTIF_NBR                                        03770000
037800               , RESOLVED_IND                                     03780000
037900               , RTV_IND                                          03790000
038000            FROM TTRBNTF                                          03800000
038100           WHERE OPER_UNT_ID  = :TM500-OPER-UNT-ID                03810000
038200             AND FCLTY_ID     = :TM500-FCLTY-ID                   03820000
038300             AND PO_NBR       = :TM500-PO-NBR                     03830000
038400             AND PREPK_ID     = :TM500-PREPK-ID                   03840000
038500             AND REC_SEQ_NBR  = :TM500-REC-SEQ-NBR                03850000
038600             AND TRBL_RSN_CDE = :TM500-TRBL-RSN-CDE               03860000
038700             AND RESOLVED_IND IN (:PC-N, :PC-I)                   03870000
038800           ORDER BY NOTIF_NBR                                     03880000
038900     END-EXEC.                                                    03890000
039000                                                                  03900000
039100******************************************************************03910000
039200*    RESOLVE MULTIPLE TROUBLE NOTIFY CURSOR                       03920000
039300******************************************************************03930000
039400     EXEC SQL                                                     03940000
039500          DECLARE RESOLVE-ALL-CSR CURSOR FOR                      03950000
039600          SELECT PO_LNE_NBR                                       03960000
039700               , PREPK_ID                                         03970000
039800               , NOTIF_NBR                                        03980000
039900               , RESOLVED_IND                                     03990000
040000               , RTV_IND                                          04000000
040100            FROM TTRBNTF                                          04010000
040200           WHERE OPER_UNT_ID  = :TM500-OPER-UNT-ID                04020000
040300             AND FCLTY_ID     = :TM500-FCLTY-ID                   04030000
040400             AND PO_NBR       = :TM500-PO-NBR                     04040000
040500             AND REC_SEQ_NBR  = :TM500-REC-SEQ-NBR                04050000
040600             AND TRBL_RSN_CDE = :TM500-TRBL-RSN-CDE               04060000
040700             AND RESOLVED_IND IN (:PC-N, :PC-I)                   04070000
040800           ORDER BY PO_LNE_NBR                                    04080000
040900                  , NOTIF_NBR                                     04090000
041000     END-EXEC.                                                    04100000
041100                                                                  04110000
041200******************************************************************04120000
041300*    ACKNWLG MULTIPLE TROUBLE NOTIFY CURSOR                       04130000
041400******************************************************************04140000
041500     EXEC SQL                                                     04150000
041600          DECLARE ACKNWLG-ALL-CSR CURSOR FOR                      04160000
041700          SELECT PO_LNE_NBR                                       04170000
041800               , PREPK_ID                                         04180000
041900               , NOTIF_NBR                                        04190000
042000               , RESOLVED_IND                                     04200000
042100               , RTV_IND                                          04210000
042200            FROM TTRBNTF                                          04220000
042300           WHERE OPER_UNT_ID  = :TM500-OPER-UNT-ID                04230000
042400             AND FCLTY_ID     = :TM500-FCLTY-ID                   04240000
042500             AND PO_NBR       = :TM500-PO-NBR                     04250000
042600             AND REC_SEQ_NBR  = :TM500-REC-SEQ-NBR                04260000
042700             AND TRBL_RSN_CDE = :TM500-TRBL-RSN-CDE               04270000
042800             AND RESOLVED_IND = :PC-R                             04280000
042900           ORDER BY PO_LNE_NBR                                    04290000
043000     END-EXEC.                                                    04300000
043100                                                                  04310000
043200 LINKAGE SECTION.                                                 04320000
043300                                                                  04330000
043400 01  DFHCOMMAREA.                                                 04340000
043500     05  FILLER                       OCCURS 1 TO 600 TIMES       04350000
043600                                      DEPENDING ON EIBCALEN.      04360000
043700         10  FILLER                   PIC X.                      04370000
043800                                                                  04380000
043900                                                                  04390000
044000 PROCEDURE DIVISION.                                              04400000
044100                                                                  04410000
044200 0000-MAIN-MODULE.                                                04420000
044300                                                                  04430000
044400     PERFORM 1000-INITIAL-PROCESS.                                04440000
044500                                                                  04450000
044600     IF PS-NOT-DONE                                               04460000
044700         PERFORM 2000-MAIN-PROCESS                                04470000
044800     END-IF.                                                      04480000
044900                                                                  04490000
044910*JAK 05/2007 - ADD CODE FOR WMOS INTERFACE                        04491013
044920     SET TM500-ASN-SENT-TO-WMS-NO    TO TRUE                      04492017
044921     IF TM500-REDISTRO-YES                                        04492117
044922         IF TM500-CALL-SUCCESSFUL                                 04492217
044930         OR TM500-DUPLICATE-TROUBLE                               04493013
044940         OR TM500-DIDNT-ALLOC-DUE-TO-TRBL                         04494013
044950         OR TM500-TTRBNTF-UPDATE-NOT-FND                          04495013
044960         OR TM500-PREPACK-ERROR                                   04496013
044970             PERFORM 6010-SELECT-TRECEIV                          04497018
044971             PERFORM 6000-CHECK-ASNDWN                            04497118
044980             IF PS-ASNS-TO-WMS-YES                                04498013
044990                AND PS-NOT-DONE                                   04499013
044992*                PERFORM 6020-CHECK-TRECDIS                       04499226
044993*                IF PS-DISTRO-TRBL-NO                             04499326
044994                     PERFORM 6030-GET-TRIP-ID                     04499413
044995                     IF PS-NOT-DONE                               04499513
044996                         PERFORM 6040-CALL-WMS-MODULE             04499613
044997                     END-IF                                       04499713
044998*                END-IF                                           04499826
044999             END-IF                                               04499913
045000         END-IF                                                   04500013
045001     END-IF.                                                      04500113
045002*JAK 05/2007 - END                                                04500213
045003                                                                  04500313
045004                                                                  04500413
045010     MOVE TM500-FIELDS TO DFHCOMMAREA.                            04501000
045100                                                                  04510000
045200     GOBACK.                                                      04520000
045300                                                                  04530000
045400                                                                  04540000
045500 1000-INITIAL-PROCESS.                                            04550000
045600                                                                  04560000
045700     INITIALIZE TM500-FIELDS.                                     04570000
045800                                                                  04580000
045900     IF EIBCALEN = 0                                              04590000
046000         SET PS-DONE      TO TRUE                                 04600000
046100     ELSE                                                         04610000
046200         MOVE DFHCOMMAREA TO TM500-FIELDS                         04620000
046300         MOVE PRV-00      TO TM500-RETURN-DATA                    04630000
046400                                                                  04640000
046500     END-IF.                                                      04650000
046600                                                                  04660000
046700     IF PS-NOT-DONE                                               04670000
046800         PERFORM 1100-CHECK-PRORATION-TYPE                        04680000
046900     END-IF.                                                      04690000
047000                                                                  04700000
047100******************************************************************04710000
047200* CHECK DB2 PARM TABLES TO DETERMINE IF PRORATION SIMPLIFICATION *04720000
047300* (NEW PRORATION) SHOULD BE USED.                                *04730000
047400******************************************************************04740000
047500 1100-CHECK-PRORATION-TYPE.                                       04750000
047600                                                                  04760000
047700     EXEC SQL                                                     04770000
047800         SELECT FUNC_TXT                                          04780000
047900           INTO :KRPRPM-FUNC-TXT                                  04790000
048000           FROM TKRPRPM                                           04800000
048100          WHERE INTFC_SYS_CDE      =  'PRO'                       04810000
048200            AND SYS_PRC_FUNC_CDE   =  'RCPROV'                    04820000
048300            AND FUNC_PRC_STAT_CDE  =  'AC'                        04830000
048400            AND (CURRENT DATE BETWEEN DATE(FUNC_BEG_TMST)         04840000
048500            AND                       DATE(FUNC_END_TMST))        04850000
048600     END-EXEC.                                                    04860000
048700                                                                  04870000
048800     EVALUATE SQLCODE                                             04880000
048900       WHEN +0                                                    04890000
049000           MOVE KRPRPM-FUNC-TXT TO PV-PRORATE                     04900000
049100           IF KRPRPM-FUNC-TXT > SPACES                            04910000
049200               SET PS-NEW-PRORATION-ON  TO TRUE                   04920000
049300           ELSE                                                   04930000
049400               SET PS-NEW-PRORATION-OFF TO TRUE                   04940000
049500           END-IF                                                 04950000
049600                                                                  04960000
049700       WHEN OTHER                                                 04970000
049800           SET PS-NEW-PRORATION-OFF TO TRUE                       04980000
049900     END-EVALUATE.                                                04990000
050000                                                                  05000000
050100     IF PS-NEW-PRORATION-ON                                       05010000
050200         MOVE ZEROES TO PV-COUNT                                  05020000
050300         PERFORM 1110-CHECK-TALLPLN                               05030000
050400     END-IF.                                                      05040000
050500                                                                  05050000
050600******************************************************************05060000
050700 1110-CHECK-TALLPLN.                                              05070000
050800                                                                  05080000
050900     EXEC SQL                                                     05090000
051000         SELECT COUNT(*)                                          05100000
051100           INTO :PV-COUNT                                         05110000
051200           FROM TALLPLN                                           05120000
051300          WHERE PO_NBR       =  :TM500-PO-NBR                     05130000
051400            AND DEST_NBR     =  :TM500-OPER-UNT-ID                05140000
051500            AND STATUS_CDE   =  'AC'                              05150000
051600            AND (SHTG_PRRT_OPT_CDE = 'X'                          05160000
051700             OR  OVRG_PRRT_OPT_CDE = 'X')                         05170000
051800     END-EXEC.                                                    05180000
051900                                                                  05190000
052000     EVALUATE SQLCODE                                             05200000
052100       WHEN +0                                                    05210000
052200           IF PV-COUNT > ZEROES                                   05220000
052300               SET PS-NEW-PRORATION-OFF TO TRUE                   05230000
052400           ELSE                                                   05240000
052500               MOVE ZEROES TO PV-COUNT                            05250000
052600               PERFORM 1111-CHECK-NEW-PROR-METHOD                 05260000
052700           END-IF                                                 05270000
052800                                                                  05280000
052900       WHEN OTHER                                                 05290000
053000           SET  PS-DONE TO TRUE                                   05300000
053100           MOVE SQLCA   TO TM500-SQLCA                            05310000
053200           MOVE SQLCODE TO TM500-SQLCODE                          05320000
053300*          MOVE PRV-4Z  TO TM500-RETURN-DATA                      05330000
053400           MOVE PRV-4X  TO TM500-RETURN-DATA                      05340000
053500     END-EVALUATE.                                                05350000
053600                                                                  05360000
053700*10/27/2003*******************************************************05370003
053800* SPLIT CREATE DATE LOGIC WAS INSTALLED FOR DEALING WITH          05380003
053900* THE TRANSITION FROM OLD PRORATION TO NEW PRORATION.             05390003
054000* THERE WERE 3 PHASES TO THE INSTALLATION:                        05400003
054100*  - DEPT 218 AND 318 WAS INSTALLED ON 2003-10-21.                05410003
054200*    (NEW ALLOCATIONS INSTALLED AFTER THIS DATE WENT THE NEW PATH)05420003
054300*  - THE NEXT DEPTS WERE INSTALLED ON 2003-10-28.                 05430003
054400*    (NEW ALLOCATIONS INSTALLED AFTER THIS DATE WENT THE NEW PATH)05440003
054500*  - THE FULL INSTALL WAS ON 2003-10-30.                          05450003
054600******************************************************************05460003
054700 1111-CHECK-NEW-PROR-METHOD.                                      05470000
054800                                                                  05480000
054900     EXEC SQL                                                     05490008
055000         SELECT COUNT(*)                                          05500008
055100           INTO :PV-COUNT                                         05510008
055200           FROM TALLPLN A, TPURCHS P                              05520008
055300          WHERE A.PO_NBR           = :TM500-PO-NBR                05530008
055400            AND A.DEST_NBR         = :TM500-OPER-UNT-ID           05540008
055500            AND A.STATUS_CDE       = 'AC'                         05550008
055600            AND SHTG_PRRT_OPT_CDE IN ('R','F','S')                05560008
055700            AND OVRG_PRRT_OPT_CDE IN ('R','F','S')                05570008
055800            AND P.PO_NBR           = :TM500-PO-NBR                05580008
055900            AND P.VER_STATUS_CDE   = 'A'                          05590008
056000*JPL        AND P.DEPT_NBR        IN ('218','318',                05600009
056100*JPL                                  '053','156',                05610009
056200*JPL                                  '252','253',                05620009
056300*JPL                                  '254','353')                05630009
056400     END-EXEC.                                                    05640008
057800                                                                  05780006
057900     EVALUATE SQLCODE                                             05790000
058000       WHEN +0                                                    05800000
058100           IF PV-COUNT > ZERO                                     05810000
058200               SET PS-NEW-PRORATION-ON  TO TRUE                   05820000
058300           ELSE                                                   05830000
058400               SET PS-NEW-PRORATION-OFF TO TRUE                   05840000
058500           END-IF                                                 05850000
058600                                                                  05860000
058700       WHEN OTHER                                                 05870000
058800           SET  PS-DONE TO TRUE                                   05880000
058900           MOVE SQLCA   TO TM500-SQLCA                            05890000
059000           MOVE SQLCODE TO TM500-SQLCODE                          05900000
059100           MOVE PRV-4X  TO TM500-RETURN-DATA                      05910000
059200     END-EVALUATE.                                                05920000
059300                                                                  05930003
059400******************************************************************05940003
059500 2000-MAIN-PROCESS.                                               05950000
059600******************************************************************05960000
059700******************************************************************05970000
059800                                                                  05980000
059900     EVALUATE TRUE                                                05990000
060000         WHEN TM500-CREATE-AUTO                                   06000000
060100              PERFORM 2100-CREATE-AUTO                            06010000
060200                                                                  06020000
060300         WHEN TM500-PREPACK-EDIT-ONLY                             06030000
060400             IF PS-NEW-PRORATION-ON                               06040000
060500                 PERFORM 5001-CHECK-PACK-TROUBLE                  06050000
060600             ELSE                                                 06060000
060700                 PERFORM 5000-CHECK-PACK-TROUBLE                  06070000
060800             END-IF                                               06080000
060900                                                                  06090000
061000         WHEN TM500-CREATE-MANUAL                                 06100000
061100              PERFORM 2200-CREATE-MANUAL                          06110000
061200                                                                  06120000
061300         WHEN TM500-IN-PROCESS                                    06130000
061400              PERFORM 2300-IN-PROCESS                             06140000
061500                                                                  06150000
061600         WHEN TM500-RESPOND                                       06160000
061700              PERFORM 2400-RESPOND                                06170000
061800                                                                  06180000
061900         WHEN TM500-RESOLVE-AUTO                                  06190000
062100              PERFORM 2500-RESOLVE-AUTO                           06210000
062200                                                                  06220000
062300         WHEN TM500-RESOLVE-MANUAL                                06230000
062400              PERFORM 2600-RESOLVE-MANUAL                         06240000
062500                                                                  06250000
062600         WHEN TM500-ACKNOWLEDGE                                   06260000
062700              PERFORM 2700-ACKNOWLEDGE                            06270000
062800                                                                  06280000
062900         WHEN TM500-UPDATE-NOTIF                                  06290000
063000              PERFORM 2800-UPDATE-NOTIF                           06300000
063100                                                                  06310000
063110         WHEN TM500-RESOLVE-SPECIFIC                              06311010
063120              PERFORM 2900-RESOLVE-SPECIFIC                       06312010
063130                                                                  06313010
063200         WHEN OTHER                                               06320000
063300              SET  PS-DONE TO TRUE                                06330000
063400              MOVE SPACES  TO TM500-SQLCA                         06340000
063500              MOVE ZEROES  TO TM500-SQLCODE                       06350000
063600              MOVE PRV-4A  TO TM500-RETURN-DATA                   06360000
063700     END-EVALUATE.                                                06370000
063800                                                                  06380000
063900******************************************************************06390000
064000 2100-CREATE-AUTO.                                                06400000
064100******************************************************************06410000
064200                                                                  06420000
064300     EVALUATE TRUE                                                06430000
064400         WHEN TM500-PO-LEVEL                                      06440000
064500             PERFORM 3000-CHECK-HEADER-TROUBLE                    06450000
064600         WHEN TM500-LINE-LEVEL                                    06460000
064700             IF PS-NEW-PRORATION-ON                               06470000
064800                 PERFORM 4001-CHECK-LINE-TROUBLE                  06480000
064900             ELSE                                                 06490000
065000                 PERFORM 4000-CHECK-LINE-TROUBLE                  06500000
065100             END-IF                                               06510000
065200         WHEN TM500-PACK-LEVEL                                    06520000
065300             IF PS-NEW-PRORATION-ON                               06530000
065400                 PERFORM 5001-CHECK-PACK-TROUBLE                  06540000
065500             ELSE                                                 06550000
065600                 PERFORM 5000-CHECK-PACK-TROUBLE                  06560000
065700             END-IF                                               06570000
065800         WHEN OTHER                                               06580000
065900              SET  PS-DONE TO TRUE                                06590000
066000              MOVE SPACES  TO TM500-SQLCA                         06600000
066100              MOVE ZEROES  TO TM500-SQLCODE                       06610000
066200              MOVE PRV-4B  TO TM500-RETURN-DATA                   06620000
066300     END-EVALUATE.                                                06630000
066400                                                                  06640000
066500                                                                  06650000
066600 2200-CREATE-MANUAL.                                              06660000
066700******************************************************************06670000
066800******************************************************************06680000
066900                                                                  06690000
067000     MOVE PC-C TO TM500-CRUD-IND.                                 06700000
067100     PERFORM 9000-CREATE-TROUBLE-RECORD.                          06710000
067200                                                                  06720000
067300                                                                  06730000
067400 2300-IN-PROCESS.                                                 06740000
067500******************************************************************06750000
067600******************************************************************06760000
067700                                                                  06770000
067800     EVALUATE TRUE                                                06780000
067900         WHEN TM500-PO-LEVEL                                      06790000
068000              PERFORM 2310-IN-PROC-CSR                            06800000
068100                                                                  06810000
068200         WHEN TM500-LINE-LEVEL                                    06820000
068300              IF TM500-PO-LNE-NBR > ZEROES                        06830000
068400                  PERFORM 2310-IN-PROC-CSR                        06840000
068500              ELSE                                                06850000
068600                  PERFORM 2320-IN-PROC-ALL-CSR                    06860000
068700              END-IF                                              06870000
068800                                                                  06880000
068900         WHEN TM500-PACK-LEVEL                                    06890000
069000              IF TM500-PREPK-ID > ZEROES                          06900000
069100                  PERFORM 2330-IN-PROC-PACK-CSR                   06910000
069200              ELSE                                                06920000
069300                  PERFORM 2320-IN-PROC-ALL-CSR                    06930000
069400              END-IF                                              06940000
069500                                                                  06950000
069600         WHEN OTHER                                               06960000
069700              SET  PS-DONE TO TRUE                                06970000
069800              MOVE SPACES  TO TM500-SQLCA                         06980000
069900              MOVE ZEROES  TO TM500-SQLCODE                       06990000
070000              MOVE PRV-4B  TO TM500-RETURN-DATA                   07000000
070100     END-EVALUATE.                                                07010000
070200                                                                  07020000
070300                                                                  07030000
070400 2310-IN-PROC-CSR.                                                07040000
070500******************************************************************07050000
070600******************************************************************07060000
070700                                                                  07070000
070800     SET PS-MORE-RECORD TO TRUE.                                  07080000
070900                                                                  07090000
071000     PERFORM 2311-OPEN-IN-PROC-CSR.                               07100000
071100                                                                  07110000
071200     IF PS-NOT-DONE                                               07120000
071300         PERFORM 2312-FETCH-IN-PROC-CSR                           07130000
071400     END-IF.                                                      07140000
071500                                                                  07150000
071600     IF PS-NO-MORE-RECORD                                         07160000
071700         SET PS-DONE TO TRUE                                      07170000
071800         MOVE PRV-44 TO TM500-RETURN-DATA                         07180000
071900     ELSE                                                         07190000
072000         PERFORM 2313-PROCESS-IN-PROC-CSR                         07200000
072100           UNTIL PS-NO-MORE-RECORD OR PS-DONE                     07210000
072200     END-IF.                                                      07220000
072300                                                                  07230000
072400     PERFORM 2314-CLOSE-IN-PROC-CSR.                              07240000
072500                                                                  07250000
072600                                                                  07260000
072700 2311-OPEN-IN-PROC-CSR.                                           07270000
072800******************************************************************07280000
072900******************************************************************07290000
073000                                                                  07300000
073100     EXEC SQL                                                     07310000
073200          OPEN IN-PROC-CSR                                        07320000
073300     END-EXEC.                                                    07330000
073400                                                                  07340000
073500     IF SQLCODE NOT = +0                                          07350000
073600         SET PS-DONE  TO TRUE                                     07360000
073700         MOVE SQLCA   TO TM500-SQLCA                              07370000
073800         MOVE SQLCODE TO TM500-SQLCODE                            07380000
073900         MOVE PRV-4C  TO TM500-RETURN-DATA                        07390000
074000     END-IF.                                                      07400000
074100                                                                  07410000
074200                                                                  07420000
074300 2312-FETCH-IN-PROC-CSR.                                          07430000
074400******************************************************************07440000
074500******************************************************************07450000
074600                                                                  07460000
074700     EXEC SQL                                                     07470000
074800          FETCH IN-PROC-CSR                                       07480000
074900           INTO :TRBNTF-NOTIF-NBR                                 07490000
075000              , :TRBNTF-RESOLVED-IND                              07500000
075100              , :TRBNTF-RTV-IND                                   07510000
075200     END-EXEC.                                                    07520000
075300                                                                  07530000
075400     EVALUATE TRUE                                                07540000
075500         WHEN SQLCODE = +0                                        07550000
075600              CONTINUE                                            07560000
075700                                                                  07570000
075800         WHEN SQLCODE = +100                                      07580000
075900              SET PS-NO-MORE-RECORD TO TRUE                       07590000
076000                                                                  07600000
076100         WHEN OTHER                                               07610000
076200              SET PS-DONE  TO TRUE                                07620000
076300              MOVE SQLCA   TO TM500-SQLCA                         07630000
076400              MOVE SQLCODE TO TM500-SQLCODE                       07640000
076500              MOVE PRV-4D  TO TM500-RETURN-DATA                   07650000
076600     END-EVALUATE.                                                07660000
076700                                                                  07670000
076800                                                                  07680000
076900 2313-PROCESS-IN-PROC-CSR.                                        07690000
077000******************************************************************07700000
077100******************************************************************07710000
077200                                                                  07720000
077300     MOVE PC-U                TO TM500-CRUD-IND.                  07730000
077400     MOVE TRBNTF-NOTIF-NBR    TO TM500-NOTIF-NBR.                 07740000
077500     MOVE TRBNTF-RESOLVED-IND TO TM500-RESOLVED-IND.              07750000
077600     MOVE TRBNTF-RTV-IND      TO TM500-RTV-SW                     07760000
077700     PERFORM 9000-CREATE-TROUBLE-RECORD.                          07770000
077800                                                                  07780000
077900     IF PS-NOT-DONE                                               07790000
078000         PERFORM 2312-FETCH-IN-PROC-CSR                           07800000
078100     END-IF.                                                      07810000
078200                                                                  07820000
078300                                                                  07830000
078400 2314-CLOSE-IN-PROC-CSR.                                          07840000
078500******************************************************************07850000
078600******************************************************************07860000
078700                                                                  07870000
078800     EXEC SQL                                                     07880000
078900          CLOSE IN-PROC-CSR                                       07890000
079000     END-EXEC.                                                    07900000
079100                                                                  07910000
079200     IF SQLCODE = +100                                            07920000
079300         CONTINUE                                                 07930000
079400     ELSE                                                         07940000
079500        IF SQLCODE NOT = +0                                       07950000
079600            SET PS-DONE TO TRUE                                   07960000
079700            MOVE SQLCA TO TM500-SQLCA                             07970000
079800            MOVE SQLCODE TO TM500-SQLCODE                         07980000
079900            MOVE PRV-4E TO TM500-RETURN-DATA                      07990000
080000        END-IF.                                                   08000000
080100                                                                  08010000
080200                                                                  08020000
080300 2320-IN-PROC-ALL-CSR.                                            08030000
080400******************************************************************08040000
080500******************************************************************08050000
080600                                                                  08060000
080700     SET PS-MORE-RECORD TO TRUE.                                  08070000
080800                                                                  08080000
080900     PERFORM 2321-OPEN-IN-PROC-ALL-CSR.                           08090000
081000                                                                  08100000
081100     IF PS-NOT-DONE                                               08110000
081200         PERFORM 2322-FETCH-IN-PROC-ALL-CSR                       08120000
081300     END-IF.                                                      08130000
081400                                                                  08140000
081500     IF PS-NO-MORE-RECORD                                         08150000
081600         SET PS-DONE TO TRUE                                      08160000
081700         MOVE PRV-44 TO TM500-RETURN-DATA                         08170000
081800     ELSE                                                         08180000
081900         PERFORM 2323-PROCESS-IN-PROC-ALL-CSR                     08190000
082000           UNTIL PS-NO-MORE-RECORD OR PS-DONE                     08200000
082100     END-IF.                                                      08210000
082200                                                                  08220000
082300     PERFORM 2324-CLOSE-IN-PROC-ALL-CSR.                          08230000
082400                                                                  08240000
082500                                                                  08250000
082600 2321-OPEN-IN-PROC-ALL-CSR.                                       08260000
082700******************************************************************08270000
082800******************************************************************08280000
082900                                                                  08290000
083000     EXEC SQL                                                     08300000
083100          OPEN IN-PROC-ALL-CSR                                    08310000
083200     END-EXEC.                                                    08320000
083300                                                                  08330000
083400     IF SQLCODE NOT = +0                                          08340000
083500         SET PS-DONE  TO TRUE                                     08350000
083600         MOVE SQLCA   TO TM500-SQLCA                              08360000
083700         MOVE SQLCODE TO TM500-SQLCODE                            08370000
083800         MOVE PRV-4F  TO TM500-RETURN-DATA                        08380000
083900     END-IF.                                                      08390000
084000                                                                  08400000
084100                                                                  08410000
084200 2322-FETCH-IN-PROC-ALL-CSR.                                      08420000
084300******************************************************************08430000
084400******************************************************************08440000
084500                                                                  08450000
084600     EXEC SQL                                                     08460000
084700          FETCH IN-PROC-ALL-CSR                                   08470000
084800           INTO :TRBNTF-NOTIF-NBR                                 08480000
084900              , :TRBNTF-RESOLVED-IND                              08490000
085000              , :TRBNTF-RTV-IND                                   08500000
085100     END-EXEC.                                                    08510000
085200                                                                  08520000
085300     EVALUATE TRUE                                                08530000
085400         WHEN SQLCODE = +0                                        08540000
085500              CONTINUE                                            08550000
085600                                                                  08560000
085700         WHEN SQLCODE = +100                                      08570000
085800              SET PS-NO-MORE-RECORD TO TRUE                       08580000
085900                                                                  08590000
086000         WHEN OTHER                                               08600000
086100              SET PS-DONE  TO TRUE                                08610000
086200              MOVE SQLCA   TO TM500-SQLCA                         08620000
086300              MOVE SQLCODE TO TM500-SQLCODE                       08630000
086400              MOVE PRV-4G  TO TM500-RETURN-DATA                   08640000
086500     END-EVALUATE.                                                08650000
086600                                                                  08660000
086700                                                                  08670000
086800 2323-PROCESS-IN-PROC-ALL-CSR.                                    08680000
086900******************************************************************08690000
087000******************************************************************08700000
087100                                                                  08710000
087200     MOVE PC-U                TO TM500-CRUD-IND.                  08720000
087300     MOVE TRBNTF-NOTIF-NBR    TO TM500-NOTIF-NBR.                 08730000
087400     MOVE TRBNTF-RESOLVED-IND TO TM500-RESOLVED-IND.              08740000
087500     MOVE TRBNTF-RTV-IND      TO TM500-RTV-SW                     08750000
087600     PERFORM 9000-CREATE-TROUBLE-RECORD.                          08760000
087700                                                                  08770000
087800     IF PS-NOT-DONE                                               08780000
087900         PERFORM 2322-FETCH-IN-PROC-ALL-CSR                       08790000
088000     END-IF.                                                      08800000
088100                                                                  08810000
088200                                                                  08820000
088300 2324-CLOSE-IN-PROC-ALL-CSR.                                      08830000
088400******************************************************************08840000
088500******************************************************************08850000
088600                                                                  08860000
088700     EXEC SQL                                                     08870000
088800          CLOSE IN-PROC-ALL-CSR                                   08880000
088900     END-EXEC.                                                    08890000
089000                                                                  08900000
089100     IF SQLCODE = +100                                            08910000
089200         CONTINUE                                                 08920000
089300     ELSE                                                         08930000
089400        IF SQLCODE NOT = +0                                       08940000
089500            SET PS-DONE TO TRUE                                   08950000
089600            MOVE SQLCA TO TM500-SQLCA                             08960000
089700            MOVE SQLCODE TO TM500-SQLCODE                         08970000
089800            MOVE PRV-4H TO TM500-RETURN-DATA                      08980000
089900        END-IF.                                                   08990000
090000                                                                  09000000
090100 2330-IN-PROC-PACK-CSR.                                           09010000
090200******************************************************************09020000
090300******************************************************************09030000
090400                                                                  09040000
090500     SET PS-MORE-RECORD TO TRUE.                                  09050000
090600                                                                  09060000
090700     PERFORM 2331-OPEN-IN-PROC-PACK-CSR.                          09070000
090800                                                                  09080000
090900     IF PS-NOT-DONE                                               09090000
091000         PERFORM 2332-FETCH-IN-PROC-PACK-CSR                      09100000
091100     END-IF.                                                      09110000
091200                                                                  09120000
091300     IF PS-NO-MORE-RECORD                                         09130000
091400         SET PS-DONE TO TRUE                                      09140000
091500         MOVE PRV-44 TO TM500-RETURN-DATA                         09150000
091600     ELSE                                                         09160000
091700         PERFORM 2333-PROCESS-IN-PROC-PACK-CSR                    09170000
091800           UNTIL PS-NO-MORE-RECORD OR PS-DONE                     09180000
091900     END-IF.                                                      09190000
092000                                                                  09200000
092100     PERFORM 2334-CLOSE-IN-PROC-PACK-CSR.                         09210000
092200                                                                  09220000
092300 2331-OPEN-IN-PROC-PACK-CSR.                                      09230000
092400******************************************************************09240000
092500******************************************************************09250000
092600                                                                  09260000
092700     EXEC SQL                                                     09270000
092800          OPEN IN-PROC-PACK-CSR                                   09280000
092900     END-EXEC.                                                    09290000
093000                                                                  09300000
093100     IF SQLCODE NOT = +0                                          09310000
093200         SET PS-DONE  TO TRUE                                     09320000
093300         MOVE SQLCA   TO TM500-SQLCA                              09330000
093400         MOVE SQLCODE TO TM500-SQLCODE                            09340000
093500         MOVE PRV-4F  TO TM500-RETURN-DATA                        09350000
093600     END-IF.                                                      09360000
093700                                                                  09370000
093800                                                                  09380000
093900 2332-FETCH-IN-PROC-PACK-CSR.                                     09390000
094000******************************************************************09400000
094100******************************************************************09410000
094200                                                                  09420000
094300     EXEC SQL                                                     09430000
094400          FETCH IN-PROC-PACK-CSR                                  09440000
094500           INTO :TRBNTF-NOTIF-NBR                                 09450000
094600              , :TRBNTF-RESOLVED-IND                              09460000
094700              , :TRBNTF-RTV-IND                                   09470000
094800     END-EXEC.                                                    09480000
094900                                                                  09490000
095000     EVALUATE TRUE                                                09500000
095100         WHEN SQLCODE = +0                                        09510000
095200              CONTINUE                                            09520000
095300                                                                  09530000
095400         WHEN SQLCODE = +100                                      09540000
095500              SET PS-NO-MORE-RECORD TO TRUE                       09550000
095600                                                                  09560000
095700         WHEN OTHER                                               09570000
095800              SET PS-DONE  TO TRUE                                09580000
095900              MOVE SQLCA   TO TM500-SQLCA                         09590000
096000              MOVE SQLCODE TO TM500-SQLCODE                       09600000
096100              MOVE PRV-4G  TO TM500-RETURN-DATA                   09610000
096200     END-EVALUATE.                                                09620000
096300                                                                  09630000
096400                                                                  09640000
096500 2333-PROCESS-IN-PROC-PACK-CSR.                                   09650000
096600******************************************************************09660000
096700******************************************************************09670000
096800                                                                  09680000
096900     MOVE PC-U                TO TM500-CRUD-IND.                  09690000
097000     MOVE TRBNTF-NOTIF-NBR    TO TM500-NOTIF-NBR.                 09700000
097100     MOVE TRBNTF-RESOLVED-IND TO TM500-RESOLVED-IND.              09710000
097200     MOVE TRBNTF-RTV-IND      TO TM500-RTV-SW                     09720000
097300     PERFORM 9000-CREATE-TROUBLE-RECORD.                          09730000
097400                                                                  09740000
097500     IF PS-NOT-DONE                                               09750000
097600         PERFORM 2332-FETCH-IN-PROC-PACK-CSR                      09760000
097700     END-IF.                                                      09770000
097800                                                                  09780000
097900                                                                  09790000
098000 2334-CLOSE-IN-PROC-PACK-CSR.                                     09800000
098100******************************************************************09810000
098200******************************************************************09820000
098300                                                                  09830000
098400     EXEC SQL                                                     09840000
098500          CLOSE IN-PROC-PACK-CSR                                  09850000
098600     END-EXEC.                                                    09860000
098700                                                                  09870000
098800     IF SQLCODE = +100                                            09880000
098900         CONTINUE                                                 09890000
099000     ELSE                                                         09900000
099100        IF SQLCODE NOT = +0                                       09910000
099200            SET PS-DONE TO TRUE                                   09920000
099300            MOVE SQLCA TO TM500-SQLCA                             09930000
099400            MOVE SQLCODE TO TM500-SQLCODE                         09940000
099500            MOVE PRV-4H TO TM500-RETURN-DATA                      09950000
099600        END-IF.                                                   09960000
099700                                                                  09970000
099800                                                                  09980000
099900 2400-RESPOND.                                                    09990000
100000******************************************************************10000000
100100******************************************************************10010000
100200                                                                  10020000
100300     EVALUATE TRUE                                                10030000
100400         WHEN TM500-PO-LEVEL                                      10040000
100500              PERFORM 2410-RESPOND-CSR                            10050000
100600                                                                  10060000
100700         WHEN TM500-LINE-LEVEL                                    10070000
100800              IF TM500-PO-LNE-NBR > ZEROES                        10080000
100900                  PERFORM 2410-RESPOND-CSR                        10090000
101000              ELSE                                                10100000
101100                  PERFORM 2420-RESPOND-ALL-CSR                    10110000
101200              END-IF                                              10120000
101300                                                                  10130000
101400         WHEN TM500-PACK-LEVEL                                    10140000
101500              IF TM500-PREPK-ID > ZEROES                          10150000
101600                  PERFORM 2430-RESPOND-PACK-CSR                   10160000
101700              ELSE                                                10170000
101800                  PERFORM 2420-RESPOND-ALL-CSR                    10180000
101900              END-IF                                              10190000
102000                                                                  10200000
102100         WHEN OTHER                                               10210000
102200              SET  PS-DONE TO TRUE                                10220000
102300              MOVE SPACES  TO TM500-SQLCA                         10230000
102400              MOVE ZEROES  TO TM500-SQLCODE                       10240000
102500              MOVE PRV-4B  TO TM500-RETURN-DATA                   10250000
102600     END-EVALUATE.                                                10260000
102700                                                                  10270000
102800                                                                  10280000
102900 2410-RESPOND-CSR.                                                10290000
103000******************************************************************10300000
103100******************************************************************10310000
103200                                                                  10320000
103300     SET PS-MORE-RECORD TO TRUE.                                  10330000
103400                                                                  10340000
103500     PERFORM 2411-OPEN-RESPOND-CSR.                               10350000
103600                                                                  10360000
103700     IF PS-NOT-DONE                                               10370000
103800         PERFORM 2412-FETCH-RESPOND-CSR                           10380000
103900     END-IF.                                                      10390000
104000                                                                  10400000
104100     IF PS-NO-MORE-RECORD                                         10410000
104200         SET PS-DONE TO TRUE                                      10420000
104300         MOVE PRV-45 TO TM500-RETURN-DATA                         10430000
104400     ELSE                                                         10440000
104500         PERFORM 2413-PROCESS-RESPOND-CSR                         10450000
104600           UNTIL PS-NO-MORE-RECORD OR PS-DONE                     10460000
104700     END-IF.                                                      10470000
104800                                                                  10480000
104900     PERFORM 2414-CLOSE-RESPOND-CSR.                              10490000
105000                                                                  10500000
105100                                                                  10510000
105200 2411-OPEN-RESPOND-CSR.                                           10520000
105300******************************************************************10530000
105400******************************************************************10540000
105500                                                                  10550000
105600     EXEC SQL                                                     10560000
105700          OPEN RESPOND-CSR                                        10570000
105800     END-EXEC.                                                    10580000
105900                                                                  10590000
106000     IF SQLCODE NOT = +0                                          10600000
106100         SET PS-DONE  TO TRUE                                     10610000
106200         MOVE SQLCA   TO TM500-SQLCA                              10620000
106300         MOVE SQLCODE TO TM500-SQLCODE                            10630000
106400         MOVE PRV-4I  TO TM500-RETURN-DATA                        10640000
106500     END-IF.                                                      10650000
106600                                                                  10660000
106700                                                                  10670000
106800 2412-FETCH-RESPOND-CSR.                                          10680000
106900******************************************************************10690000
107000******************************************************************10700000
107100                                                                  10710000
107200     EXEC SQL                                                     10720000
107300          FETCH RESPOND-CSR                                       10730000
107400           INTO :TRBNTF-NOTIF-NBR                                 10740000
107500              , :TRBNTF-RESOLVED-IND                              10750000
107600              , :TRBNTF-RTV-IND                                   10760000
107700     END-EXEC.                                                    10770000
107800                                                                  10780000
107900     EVALUATE TRUE                                                10790000
108000         WHEN SQLCODE = +0                                        10800000
108100              CONTINUE                                            10810000
108200                                                                  10820000
108300         WHEN SQLCODE = +100                                      10830000
108400              SET PS-NO-MORE-RECORD TO TRUE                       10840000
108500                                                                  10850000
108600         WHEN OTHER                                               10860000
108700              SET PS-DONE  TO TRUE                                10870000
108800              MOVE SQLCA   TO TM500-SQLCA                         10880000
108900              MOVE SQLCODE TO TM500-SQLCODE                       10890000
109000              MOVE PRV-4J  TO TM500-RETURN-DATA                   10900000
109100     END-EVALUATE.                                                10910000
109200                                                                  10920000
109300                                                                  10930000
109400 2413-PROCESS-RESPOND-CSR.                                        10940000
109500******************************************************************10950000
109600******************************************************************10960000
109700                                                                  10970000
109800     MOVE PC-U                TO TM500-CRUD-IND.                  10980000
109900     MOVE TRBNTF-NOTIF-NBR    TO TM500-NOTIF-NBR.                 10990000
110000     MOVE TRBNTF-RESOLVED-IND TO TM500-RESOLVED-IND.              11000000
110100     IF TM500-TRBL-RSN-CDE  = PC-502 OR PC-509                    11010000
110200         CONTINUE                                                 11020000
110300     ELSE                                                         11030000
110400         MOVE TRBNTF-RTV-IND  TO TM500-RTV-SW                     11040000
110500     END-IF.                                                      11050000
110600                                                                  11060000
110700     PERFORM 9000-CREATE-TROUBLE-RECORD.                          11070000
110800                                                                  11080000
110900     IF PS-NOT-DONE                                               11090000
111000         PERFORM 2412-FETCH-RESPOND-CSR                           11100000
111100     END-IF.                                                      11110000
111200                                                                  11120000
111300                                                                  11130000
111400 2414-CLOSE-RESPOND-CSR.                                          11140000
111500******************************************************************11150000
111600******************************************************************11160000
111700                                                                  11170000
111800     EXEC SQL                                                     11180000
111900          CLOSE RESPOND-CSR                                       11190000
112000     END-EXEC.                                                    11200000
112100                                                                  11210000
112200     IF SQLCODE = +100                                            11220000
112300         CONTINUE                                                 11230000
112400     ELSE                                                         11240000
112500        IF SQLCODE NOT = +0                                       11250000
112600            SET PS-DONE TO TRUE                                   11260000
112700            MOVE SQLCA TO TM500-SQLCA                             11270000
112800            MOVE SQLCODE TO TM500-SQLCODE                         11280000
112900            MOVE PRV-4K TO TM500-RETURN-DATA                      11290000
113000        END-IF.                                                   11300000
113100                                                                  11310000
113200                                                                  11320000
113300 2420-RESPOND-ALL-CSR.                                            11330000
113400******************************************************************11340000
113500******************************************************************11350000
113600                                                                  11360000
113700     SET PS-MORE-RECORD TO TRUE.                                  11370000
113800                                                                  11380000
113900     PERFORM 2421-OPEN-RESPOND-ALL-CSR.                           11390000
114000                                                                  11400000
114100     IF PS-NOT-DONE                                               11410000
114200         PERFORM 2422-FETCH-RESPOND-ALL-CSR                       11420000
114300     END-IF.                                                      11430000
114400                                                                  11440000
114500     IF PS-NO-MORE-RECORD                                         11450000
114600         SET PS-DONE TO TRUE                                      11460000
114700         MOVE PRV-45 TO TM500-RETURN-DATA                         11470000
114800     ELSE                                                         11480000
114900         PERFORM 2423-PROCESS-RESPOND-ALL-CSR                     11490000
115000           UNTIL PS-NO-MORE-RECORD OR PS-DONE                     11500000
115100     END-IF.                                                      11510000
115200                                                                  11520000
115300     PERFORM 2424-CLOSE-RESPOND-ALL-CSR.                          11530000
115400                                                                  11540000
115500                                                                  11550000
115600 2421-OPEN-RESPOND-ALL-CSR.                                       11560000
115700******************************************************************11570000
115800******************************************************************11580000
115900                                                                  11590000
116000     EXEC SQL                                                     11600000
116100          OPEN RESPOND-ALL-CSR                                    11610000
116200     END-EXEC.                                                    11620000
116300                                                                  11630000
116400     IF SQLCODE NOT = +0                                          11640000
116500         SET PS-DONE  TO TRUE                                     11650000
116600         MOVE SQLCA   TO TM500-SQLCA                              11660000
116700         MOVE SQLCODE TO TM500-SQLCODE                            11670000
116800         MOVE PRV-4L  TO TM500-RETURN-DATA                        11680000
116900     END-IF.                                                      11690000
117000                                                                  11700000
117100                                                                  11710000
117200 2422-FETCH-RESPOND-ALL-CSR.                                      11720000
117300******************************************************************11730000
117400******************************************************************11740000
117500                                                                  11750000
117600     EXEC SQL                                                     11760000
117700          FETCH RESPOND-ALL-CSR                                   11770000
117800           INTO :TRBNTF-NOTIF-NBR                                 11780000
117900              , :TRBNTF-RESOLVED-IND                              11790000
118000              , :TRBNTF-RTV-IND                                   11800000
118100     END-EXEC.                                                    11810000
118200                                                                  11820000
118300     EVALUATE TRUE                                                11830000
118400         WHEN SQLCODE = +0                                        11840000
118500              CONTINUE                                            11850000
118600                                                                  11860000
118700         WHEN SQLCODE = +100                                      11870000
118800              SET PS-NO-MORE-RECORD TO TRUE                       11880000
118900                                                                  11890000
119000         WHEN OTHER                                               11900000
119100              SET PS-DONE  TO TRUE                                11910000
119200              MOVE SQLCA   TO TM500-SQLCA                         11920000
119300              MOVE SQLCODE TO TM500-SQLCODE                       11930000
119400              MOVE PRV-4M  TO TM500-RETURN-DATA                   11940000
119500     END-EVALUATE.                                                11950000
119600                                                                  11960000
119700                                                                  11970000
119800 2423-PROCESS-RESPOND-ALL-CSR.                                    11980000
119900******************************************************************11990000
120000******************************************************************12000000
120100                                                                  12010000
120200     MOVE PC-U                TO TM500-CRUD-IND.                  12020000
120300     MOVE TRBNTF-NOTIF-NBR    TO TM500-NOTIF-NBR.                 12030000
120400     MOVE TRBNTF-RESOLVED-IND TO TM500-RESOLVED-IND.              12040000
120500                                                                  12050000
120600     IF TM500-TRBL-RSN-CDE  = PC-502 OR PC-509                    12060000
120700         CONTINUE                                                 12070000
120800     ELSE                                                         12080000
120900         MOVE TRBNTF-RTV-IND  TO TM500-RTV-SW                     12090000
121000     END-IF.                                                      12100000
121100                                                                  12110000
121200     PERFORM 9000-CREATE-TROUBLE-RECORD.                          12120000
121300                                                                  12130000
121400     IF PS-NOT-DONE                                               12140000
121500         PERFORM 2422-FETCH-RESPOND-ALL-CSR                       12150000
121600     END-IF.                                                      12160000
121700                                                                  12170000
121800                                                                  12180000
121900 2424-CLOSE-RESPOND-ALL-CSR.                                      12190000
122000******************************************************************12200000
122100******************************************************************12210000
122200                                                                  12220000
122300     EXEC SQL                                                     12230000
122400          CLOSE RESPOND-ALL-CSR                                   12240000
122500     END-EXEC.                                                    12250000
122600                                                                  12260000
122700     IF SQLCODE = +100                                            12270000
122800        CONTINUE                                                  12280000
122900     ELSE                                                         12290000
123000        IF SQLCODE NOT = +0                                       12300000
123100            SET PS-DONE TO TRUE                                   12310000
123200            MOVE SQLCA TO TM500-SQLCA                             12320000
123300            MOVE SQLCODE TO TM500-SQLCODE                         12330000
123400            MOVE PRV-4N TO TM500-RETURN-DATA                      12340000
123500        END-IF.                                                   12350000
123600                                                                  12360000
123700                                                                  12370000
123800 2430-RESPOND-PACK-CSR.                                           12380000
123900******************************************************************12390000
124000******************************************************************12400000
124100                                                                  12410000
124200     SET PS-MORE-RECORD TO TRUE.                                  12420000
124300                                                                  12430000
124400     PERFORM 2431-OPEN-RESPOND-PACK-CSR.                          12440000
124500                                                                  12450000
124600     IF PS-NOT-DONE                                               12460000
124700         PERFORM 2432-FETCH-RESPOND-PACK-CSR                      12470000
124800     END-IF.                                                      12480000
124900                                                                  12490000
125000     IF PS-NO-MORE-RECORD                                         12500000
125100         SET PS-DONE TO TRUE                                      12510000
125200         MOVE PRV-45 TO TM500-RETURN-DATA                         12520000
125300     ELSE                                                         12530000
125400         PERFORM 2433-PROCESS-RESPOND-PACK-CSR                    12540000
125500           UNTIL PS-NO-MORE-RECORD OR PS-DONE                     12550000
125600     END-IF.                                                      12560000
125700                                                                  12570000
125800     PERFORM 2434-CLOSE-RESPOND-PACK-CSR.                         12580000
125900                                                                  12590000
126000                                                                  12600000
126100 2431-OPEN-RESPOND-PACK-CSR.                                      12610000
126200******************************************************************12620000
126300******************************************************************12630000
126400                                                                  12640000
126500     EXEC SQL                                                     12650000
126600          OPEN RESPOND-PACK-CSR                                   12660000
126700     END-EXEC.                                                    12670000
126800                                                                  12680000
126900     IF SQLCODE NOT = +0                                          12690000
127000         SET PS-DONE  TO TRUE                                     12700000
127100         MOVE SQLCA   TO TM500-SQLCA                              12710000
127200         MOVE SQLCODE TO TM500-SQLCODE                            12720000
127300         MOVE PRV-4L  TO TM500-RETURN-DATA                        12730000
127400     END-IF.                                                      12740000
127500                                                                  12750000
127600                                                                  12760000
127700 2432-FETCH-RESPOND-PACK-CSR.                                     12770000
127800******************************************************************12780000
127900******************************************************************12790000
128000                                                                  12800000
128100     EXEC SQL                                                     12810000
128200          FETCH RESPOND-PACK-CSR                                  12820000
128300           INTO :TRBNTF-NOTIF-NBR                                 12830000
128400              , :TRBNTF-RESOLVED-IND                              12840000
128500              , :TRBNTF-RTV-IND                                   12850000
128600     END-EXEC.                                                    12860000
128700                                                                  12870000
128800     EVALUATE TRUE                                                12880000
128900         WHEN SQLCODE = +0                                        12890000
129000              CONTINUE                                            12900000
129100                                                                  12910000
129200         WHEN SQLCODE = +100                                      12920000
129300              SET PS-NO-MORE-RECORD TO TRUE                       12930000
129400                                                                  12940000
129500         WHEN OTHER                                               12950000
129600              SET PS-DONE  TO TRUE                                12960000
129700              MOVE SQLCA   TO TM500-SQLCA                         12970000
129800              MOVE SQLCODE TO TM500-SQLCODE                       12980000
129900              MOVE PRV-4M  TO TM500-RETURN-DATA                   12990000
130000     END-EVALUATE.                                                13000000
130100                                                                  13010000
130200                                                                  13020000
130300 2433-PROCESS-RESPOND-PACK-CSR.                                   13030000
130400******************************************************************13040000
130500******************************************************************13050000
130600                                                                  13060000
130700     MOVE PC-U                TO TM500-CRUD-IND.                  13070000
130800     MOVE TRBNTF-NOTIF-NBR    TO TM500-NOTIF-NBR.                 13080000
130900     MOVE TRBNTF-RESOLVED-IND TO TM500-RESOLVED-IND.              13090000
131000                                                                  13100000
131100     IF TM500-TRBL-RSN-CDE  = PC-502 OR PC-509                    13110000
131200         CONTINUE                                                 13120000
131300     ELSE                                                         13130000
131400         MOVE TRBNTF-RTV-IND  TO TM500-RTV-SW                     13140000
131500     END-IF.                                                      13150000
131600                                                                  13160000
131700     PERFORM 9000-CREATE-TROUBLE-RECORD.                          13170000
131800                                                                  13180000
131900     IF PS-NOT-DONE                                               13190000
132000         PERFORM 2432-FETCH-RESPOND-PACK-CSR                      13200000
132100     END-IF.                                                      13210000
132200                                                                  13220000
132300                                                                  13230000
132400 2434-CLOSE-RESPOND-PACK-CSR.                                     13240000
132500******************************************************************13250000
132600******************************************************************13260000
132700                                                                  13270000
132800     EXEC SQL                                                     13280000
132900          CLOSE RESPOND-PACK-CSR                                  13290000
133000     END-EXEC.                                                    13300000
133100                                                                  13310000
133200     IF SQLCODE = +100                                            13320000
133300        CONTINUE                                                  13330000
133400     ELSE                                                         13340000
133500        IF SQLCODE NOT = +0                                       13350000
133600            SET PS-DONE TO TRUE                                   13360000
133700            MOVE SQLCA TO TM500-SQLCA                             13370000
133800            MOVE SQLCODE TO TM500-SQLCODE                         13380000
133900            MOVE PRV-4N TO TM500-RETURN-DATA                      13390000
134000        END-IF.                                                   13400000
134100                                                                  13410000
134200 2500-RESOLVE-AUTO.                                               13420000
134300******************************************************************13430000
134400******************************************************************13440000
134500                                                                  13450000
134600*  CHECK TO SEE IF A LATE TROUBLE WAS ALREADY RESOLVED BY DOING   13460000
134700*  THE RESOLVE-MANUAL ROUTINE IF THE USER ENTERED A 'N'           13470000
134800*  IN THE RTV FIELD ON TMKCS505.                                  13480000
134900                                                                  13490000
134910*KBW                                                              13491011
135000*    IF TM500-TRBL-RSN-CDE = PC-509 AND                           13500011
135100*       TM500-RTV-SW = PC-N                                       13510011
135200*           PERFORM 2600-RESOLVE-MANUAL.                          13520011
135300                                                                  13530000
135400     IF PS-NOT-DONE                                               13540000
135500                                                                  13550000
135600        EVALUATE TRUE                                             13560000
135700            WHEN TM500-PO-LEVEL                                   13570000
135800                 PERFORM 3000-CHECK-HEADER-TROUBLE                13580000
135900                                                                  13590000
136000            WHEN TM500-LINE-LEVEL                                 13600000
136100                 IF TM500-PO-LNE-NBR > ZEROES                     13610000
136200                     PERFORM 4000-CHECK-LINE-TROUBLE              13620000
136300                 ELSE                                             13630000
136400                     PERFORM 2510-AUTO-ALL-CSR                    13640000
136500                 END-IF                                           13650000
136600                                                                  13660000
136700            WHEN TM500-PACK-LEVEL                                 13670000
136800                 IF TM500-PREPK-ID   > ZEROES                     13680000
136900                     PERFORM 5000-CHECK-PACK-TROUBLE              13690000
137000                 ELSE                                             13700000
137100                     PERFORM 2510-AUTO-ALL-CSR                    13710000
137200                 END-IF                                           13720000
137300                                                                  13730000
137400            WHEN OTHER                                            13740000
137500                 SET PS-DONE TO TRUE                              13750000
137600                 MOVE SPACES TO TM500-SQLCA                       13760000
137700                 MOVE ZEROES TO TM500-SQLCODE                     13770000
137800                 MOVE PRV-4B TO TM500-RETURN-DATA                 13780000
137900        END-EVALUATE.                                             13790000
138000                                                                  13800000
138100                                                                  13810000
138200 2510-AUTO-ALL-CSR.                                               13820000
138300******************************************************************13830000
138400******************************************************************13840000
138500                                                                  13850000
138600     SET PS-MORE-RECORD TO TRUE.                                  13860000
138700                                                                  13870000
138800     PERFORM 2511-OPEN-AUTO-ALL-CSR.                              13880000
138900                                                                  13890000
139000     IF PS-NOT-DONE                                               13900000
139100         PERFORM 2512-FETCH-AUTO-ALL-CSR                          13910000
139200     END-IF.                                                      13920000
139300                                                                  13930000
139400     IF PS-NO-MORE-RECORD                                         13940000
139500         SET PS-DONE TO TRUE                                      13950000
139600         MOVE PRV-49 TO TM500-RETURN-DATA                         13960000
139700     ELSE                                                         13970000
139800         PERFORM 2513-PROCESS-AUTO-ALL-CSR                        13980000
139900           UNTIL PS-NO-MORE-RECORD OR PS-DONE                     13990000
140000     END-IF.                                                      14000000
140100                                                                  14010000
140200     PERFORM 2514-CLOSE-AUTO-ALL-CSR.                             14020000
140300                                                                  14030000
140400                                                                  14040000
140500 2511-OPEN-AUTO-ALL-CSR.                                          14050000
140600******************************************************************14060000
140700******************************************************************14070000
140800                                                                  14080000
140900     EXEC SQL                                                     14090000
141000          OPEN AUTO-ALL-CSR                                       14100000
141100     END-EXEC.                                                    14110000
141200                                                                  14120000
141300     IF SQLCODE NOT = +0                                          14130000
141400         SET PS-DONE  TO TRUE                                     14140000
141500         MOVE SQLCA   TO TM500-SQLCA                              14150000
141600         MOVE SQLCODE TO TM500-SQLCODE                            14160000
141700         MOVE PRV-4X  TO TM500-RETURN-DATA                        14170000
141800     END-IF.                                                      14180000
141900                                                                  14190000
142000                                                                  14200000
142100 2512-FETCH-AUTO-ALL-CSR.                                         14210000
142200******************************************************************14220000
142300******************************************************************14230000
142400                                                                  14240000
142500     EXEC SQL                                                     14250000
142600          FETCH AUTO-ALL-CSR                                      14260000
142700           INTO :RECITM-ORD-LNE-NBR                               14270000
142800               ,:RECITM-PREPK-ID                                  14280000
142900     END-EXEC.                                                    14290000
143000                                                                  14300000
143100     EVALUATE TRUE                                                14310000
143200         WHEN SQLCODE = +0                                        14320000
143300              CONTINUE                                            14330000
143400                                                                  14340000
143500         WHEN SQLCODE = +100                                      14350000
143600              SET PS-NO-MORE-RECORD TO TRUE                       14360000
143700                                                                  14370000
143800         WHEN OTHER                                               14380000
143900              SET PS-DONE  TO TRUE                                14390000
144000              MOVE SQLCA   TO TM500-SQLCA                         14400000
144100              MOVE SQLCODE TO TM500-SQLCODE                       14410000
144200*             MOVE PRV-4Y  TO TM500-RETURN-DATA                   14420000
144300              MOVE PRV-4X  TO TM500-RETURN-DATA                   14430000
144400     END-EVALUATE.                                                14440000
144500                                                                  14450000
144600                                                                  14460000
144700 2513-PROCESS-AUTO-ALL-CSR.                                       14470000
144800******************************************************************14480000
144900******************************************************************14490000
145000                                                                  14500000
145100     IF TM500-LINE-LEVEL                                          14510000
145200            MOVE RECITM-ORD-LNE-NBR TO TM500-PO-LNE-NBR           14520000
145300            PERFORM 4000-CHECK-LINE-TROUBLE                       14530000
145400     ELSE                                                         14540000
145500           IF TM500-PACK-LEVEL                                    14550000
145600               MOVE RECITM-PREPK-ID TO TM500-PREPK-ID             14560000
145700               PERFORM 5000-CHECK-PACK-TROUBLE                    14570000
145800           END-IF                                                 14580000
145900     END-IF.                                                      14590000
146000                                                                  14600000
146100     IF PS-NOT-DONE                                               14610000
146200         PERFORM 2512-FETCH-AUTO-ALL-CSR                          14620000
146300     END-IF.                                                      14630000
146400                                                                  14640000
146500                                                                  14650000
146600 2514-CLOSE-AUTO-ALL-CSR.                                         14660000
146700******************************************************************14670000
146800******************************************************************14680000
146900                                                                  14690000
147000     EXEC SQL                                                     14700000
147100          CLOSE AUTO-ALL-CSR                                      14710000
147200     END-EXEC.                                                    14720000
147300                                                                  14730000
147400     IF SQLCODE NOT = +0                                          14740000
147500         SET PS-DONE  TO TRUE                                     14750000
147600         MOVE SQLCA   TO TM500-SQLCA                              14760000
147700         MOVE SQLCODE TO TM500-SQLCODE                            14770000
147800*        MOVE PRV-4Z  TO TM500-RETURN-DATA                        14780000
147900         MOVE PRV-4X  TO TM500-RETURN-DATA                        14790000
148000     END-IF.                                                      14800000
148100                                                                  14810000
148200                                                                  14820000
148300                                                                  14830000
148400 2600-RESOLVE-MANUAL.                                             14840000
148500******************************************************************14850000
148600******************************************************************14860000
148700                                                                  14870000
148800     EVALUATE TRUE                                                14880000
148900         WHEN TM500-PO-LEVEL                                      14890000
149000              PERFORM 2610-RESOLVE-CSR                            14900000
149100                                                                  14910000
149200         WHEN TM500-LINE-LEVEL                                    14920000
149300              IF TM500-PO-LNE-NBR > ZEROES                        14930000
149400                  PERFORM 2610-RESOLVE-CSR                        14940000
149500              ELSE                                                14950000
149600                  PERFORM 2620-RESOLVE-ALL-CSR                    14960000
149700              END-IF                                              14970000
149800                                                                  14980000
149900         WHEN TM500-PACK-LEVEL                                    14990000
150000              IF TM500-PREPK-ID > ZEROES                          15000000
150100                  PERFORM 2630-RESOLVE-PACK-CSR                   15010000
150200              ELSE                                                15020000
150300                  PERFORM 2620-RESOLVE-ALL-CSR                    15030000
150400              END-IF                                              15040000
150500                                                                  15050000
150600         WHEN OTHER                                               15060000
150700              SET  PS-DONE TO TRUE                                15070000
150800              MOVE SPACES  TO TM500-SQLCA                         15080000
150900              MOVE ZEROES  TO TM500-SQLCODE                       15090000
151000              MOVE PRV-4B  TO TM500-RETURN-DATA                   15100000
151100     END-EVALUATE.                                                15110000
151200                                                                  15120000
151300                                                                  15130000
151400 2610-RESOLVE-CSR.                                                15140000
151500******************************************************************15150000
151600******************************************************************15160000
151700                                                                  15170000
151800     SET PS-MORE-RECORD TO TRUE.                                  15180000
151900                                                                  15190000
152000     PERFORM 2611-OPEN-RESOLVE-CSR.                               15200000
152100                                                                  15210000
152200     IF PS-NOT-DONE                                               15220000
152300         PERFORM 2612-FETCH-RESOLVE-CSR                           15230000
152400     END-IF.                                                      15240000
152500                                                                  15250000
152600* TM500-RTV-SW IS WHAT THE USER ENTERED ON THE SCREEN             15260000
152700*                                                                 15270000
152800                                                                  15280000
152900     EVALUATE TRUE                                                15290000
153000     WHEN PS-NO-MORE-RECORD                                       15300000
153100         SET PS-DONE TO TRUE                                      15310000
153200         MOVE PRV-47 TO TM500-RETURN-DATA                         15320000
153300*    WHEN TM500-TRBL-RSN-CDE = PC-509 AND                         15330011
153400*          TM500-RTV-SW = PC-N                                    15340011
153500*             CONTINUE                                            15350011
153600     WHEN (TM500-TRBL-RSN-CDE = PC-509 OR PC-502 OR PC-543)       15360000
153700             AND TM500-DC-ACCESS                                  15370000
153800             AND (TRBNTF-RTV-IND = PC-N OR SPACE)                 15380000
153900             MOVE PRV-03 TO TM500-RETURN-DATA                     15390000
154000             SET PS-DONE TO TRUE                                  15400000
154100     WHEN OTHER                                                   15410000
154200           PERFORM 2613-PROCESS-RESOLVE-CSR                       15420000
154300           UNTIL PS-NO-MORE-RECORD OR PS-DONE                     15430000
154400     END-EVALUATE.                                                15440000
154500                                                                  15450000
154600                                                                  15460000
154700     PERFORM 2614-CLOSE-RESOLVE-CSR.                              15470000
154800                                                                  15480000
154900 2611-OPEN-RESOLVE-CSR.                                           15490000
155000******************************************************************15500000
155100******************************************************************15510000
155200                                                                  15520000
155300     EXEC SQL                                                     15530000
155400          OPEN RESOLVE-CSR                                        15540000
155500     END-EXEC.                                                    15550000
155600                                                                  15560000
155700     IF SQLCODE NOT = +0                                          15570000
155800         SET PS-DONE  TO TRUE                                     15580000
155900         MOVE SQLCA   TO TM500-SQLCA                              15590000
156000         MOVE SQLCODE TO TM500-SQLCODE                            15600000
156100         MOVE PRV-4U  TO TM500-RETURN-DATA                        15610000
156200     END-IF.                                                      15620000
156300                                                                  15630000
156400                                                                  15640000
156500 2612-FETCH-RESOLVE-CSR.                                          15650000
156600******************************************************************15660000
156700******************************************************************15670000
156800                                                                  15680000
156900     EXEC SQL                                                     15690000
157000          FETCH RESOLVE-CSR                                       15700000
157100           INTO :TRBNTF-NOTIF-NBR                                 15710000
157200              , :TRBNTF-RESOLVED-IND                              15720000
157300              , :TRBNTF-RTV-IND                                   15730000
157400     END-EXEC.                                                    15740000
157500                                                                  15750000
157600     EVALUATE TRUE                                                15760000
157700         WHEN SQLCODE = +0                                        15770000
157800              CONTINUE                                            15780000
157900                                                                  15790000
158000         WHEN SQLCODE = +100                                      15800000
158100              SET PS-NO-MORE-RECORD TO TRUE                       15810000
158200                                                                  15820000
158300         WHEN OTHER                                               15830000
158400              SET PS-DONE  TO TRUE                                15840000
158500              MOVE SQLCA   TO TM500-SQLCA                         15850000
158600              MOVE SQLCODE TO TM500-SQLCODE                       15860000
158700              MOVE PRV-4V  TO TM500-RETURN-DATA                   15870000
158800     END-EVALUATE.                                                15880000
158900                                                                  15890000
159000                                                                  15900000
159100 2613-PROCESS-RESOLVE-CSR.                                        15910000
159200******************************************************************15920000
159300******************************************************************15930000
159400                                                                  15940000
159500     MOVE PC-U                TO TM500-CRUD-IND.                  15950000
159600     MOVE TRBNTF-NOTIF-NBR    TO TM500-NOTIF-NBR.                 15960000
159700     MOVE TRBNTF-RESOLVED-IND TO TM500-RESOLVED-IND.              15970000
159800                                                                  15980000
159900     IF TM500-TRBL-RSN-CDE  = PC-502 OR PC-509                    15990000
160000         CONTINUE                                                 16000000
160100     ELSE                                                         16010000
160200         MOVE TRBNTF-RTV-IND  TO TM500-RTV-SW                     16020000
160300     END-IF.                                                      16030000
160400                                                                  16040000
160500     PERFORM 9000-CREATE-TROUBLE-RECORD.                          16050000
160600                                                                  16060000
160700     IF PS-NOT-DONE                                               16070000
160800         PERFORM 2612-FETCH-RESOLVE-CSR                           16080000
160900     END-IF.                                                      16090000
161000                                                                  16100000
161100                                                                  16110000
161200 2614-CLOSE-RESOLVE-CSR.                                          16120000
161300******************************************************************16130000
161400******************************************************************16140000
161500                                                                  16150000
161600     EXEC SQL                                                     16160000
161700          CLOSE RESOLVE-CSR                                       16170000
161800     END-EXEC.                                                    16180000
161900                                                                  16190000
162000     IF SQLCODE = +100                                            16200000
162100         CONTINUE                                                 16210000
162200     ELSE                                                         16220000
162300        IF SQLCODE NOT = +0                                       16230000
162400            SET PS-DONE TO TRUE                                   16240000
162500            MOVE SQLCA TO TM500-SQLCA                             16250000
162600            MOVE SQLCODE TO TM500-SQLCODE                         16260000
162700            MOVE PRV-4W TO TM500-RETURN-DATA                      16270000
162800        END-IF.                                                   16280000
162900                                                                  16290000
163000                                                                  16300000
163100 2620-RESOLVE-ALL-CSR.                                            16310000
163200******************************************************************16320000
163300******************************************************************16330000
163400                                                                  16340000
163500     SET PS-MORE-RECORD TO TRUE.                                  16350000
163600                                                                  16360000
163700     PERFORM 2621-OPEN-RESOLVE-ALL-CSR.                           16370000
163800                                                                  16380000
163900     IF PS-NOT-DONE                                               16390000
164000         PERFORM 2622-FETCH-RESOLVE-ALL-CSR                       16400000
164100     END-IF.                                                      16410000
164200                                                                  16420000
164300     IF PS-NO-MORE-RECORD                                         16430000
164400         SET PS-DONE TO TRUE                                      16440000
164500         MOVE PRV-47 TO TM500-RETURN-DATA                         16450000
164600     ELSE                                                         16460000
164700         PERFORM 2623-PROCESS-RESOLVE-ALL-CSR                     16470000
164800           UNTIL PS-NO-MORE-RECORD OR PS-DONE                     16480000
164900     END-IF.                                                      16490000
165000                                                                  16500000
165100     PERFORM 2624-CLOSE-RESOLVE-ALL-CSR.                          16510000
165200                                                                  16520000
165300                                                                  16530000
165400 2621-OPEN-RESOLVE-ALL-CSR.                                       16540000
165500******************************************************************16550000
165600******************************************************************16560000
165700                                                                  16570000
165800     EXEC SQL                                                     16580000
165900          OPEN RESOLVE-ALL-CSR                                    16590000
166000     END-EXEC.                                                    16600000
166100                                                                  16610000
166200     IF SQLCODE NOT = +0                                          16620000
166300         SET PS-DONE  TO TRUE                                     16630000
166400         MOVE SQLCA   TO TM500-SQLCA                              16640000
166500         MOVE SQLCODE TO TM500-SQLCODE                            16650000
166600         MOVE PRV-4X  TO TM500-RETURN-DATA                        16660000
166700     END-IF.                                                      16670000
166800                                                                  16680000
166900                                                                  16690000
167000 2622-FETCH-RESOLVE-ALL-CSR.                                      16700000
167100******************************************************************16710000
167200******************************************************************16720000
167300                                                                  16730000
167400     EXEC SQL                                                     16740000
167500          FETCH RESOLVE-ALL-CSR                                   16750000
167600           INTO :TRBNTF-PO-LNE-NBR                                16760000
167700              , :TRBNTF-PREPK-ID                                  16770000
167800              , :TRBNTF-NOTIF-NBR                                 16780000
167900              , :TRBNTF-RESOLVED-IND                              16790000
168000              , :TRBNTF-RTV-IND                                   16800000
168100     END-EXEC.                                                    16810000
168200                                                                  16820000
168300     EVALUATE TRUE                                                16830000
168400         WHEN SQLCODE = +0                                        16840000
168500              CONTINUE                                            16850000
168600                                                                  16860000
168700         WHEN SQLCODE = +100                                      16870000
168800              SET PS-NO-MORE-RECORD TO TRUE                       16880000
168900                                                                  16890000
169000         WHEN OTHER                                               16900000
169100              SET PS-DONE  TO TRUE                                16910000
169200              MOVE SQLCA   TO TM500-SQLCA                         16920000
169300              MOVE SQLCODE TO TM500-SQLCODE                       16930000
169400*             MOVE PRV-4Y  TO TM500-RETURN-DATA                   16940000
169500              MOVE PRV-4X  TO TM500-RETURN-DATA                   16950000
169600     END-EVALUATE.                                                16960000
169700                                                                  16970000
169800                                                                  16980000
169900 2623-PROCESS-RESOLVE-ALL-CSR.                                    16990000
170000******************************************************************17000000
170100******************************************************************17010000
170200                                                                  17020000
170300     MOVE PC-U                TO TM500-CRUD-IND.                  17030000
170400     MOVE TRBNTF-NOTIF-NBR    TO TM500-NOTIF-NBR.                 17040000
170500     MOVE TRBNTF-RESOLVED-IND TO TM500-RESOLVED-IND.              17050000
170600                                                                  17060000
170700     IF TM500-TRBL-RSN-CDE  = PC-502 OR PC-509                    17070000
170800         CONTINUE                                                 17080000
170900     ELSE                                                         17090000
171000         MOVE TRBNTF-RTV-IND  TO TM500-RTV-SW                     17100000
171100     END-IF.                                                      17110000
171200                                                                  17120000
171300     PERFORM 9000-CREATE-TROUBLE-RECORD.                          17130000
171400                                                                  17140000
171500     IF PS-NOT-DONE                                               17150000
171600         PERFORM 2622-FETCH-RESOLVE-ALL-CSR                       17160000
171700     END-IF.                                                      17170000
171800                                                                  17180000
171900 2624-CLOSE-RESOLVE-ALL-CSR.                                      17190000
172000******************************************************************17200000
172100******************************************************************17210000
172200                                                                  17220000
172300     EXEC SQL                                                     17230000
172400          CLOSE RESOLVE-ALL-CSR                                   17240000
172500     END-EXEC.                                                    17250000
172600                                                                  17260000
172700     IF SQLCODE = +100                                            17270000
172800         CONTINUE                                                 17280000
172900     ELSE                                                         17290000
173000        IF SQLCODE NOT = +0                                       17300000
173100            SET PS-DONE TO TRUE                                   17310000
173200            MOVE SQLCA TO TM500-SQLCA                             17320000
173300            MOVE SQLCODE TO TM500-SQLCODE                         17330000
173400*           MOVE PRV-4Z TO TM500-RETURN-DATA                      17340000
173500            MOVE PRV-4X TO TM500-RETURN-DATA                      17350000
173600        END-IF.                                                   17360000
173700                                                                  17370000
173800                                                                  17380000
173900 2630-RESOLVE-PACK-CSR.                                           17390000
174000******************************************************************17400000
174100******************************************************************17410000
174200                                                                  17420000
174300     SET PS-MORE-RECORD TO TRUE.                                  17430000
174400                                                                  17440000
174500     PERFORM 2631-OPEN-RESOLVE-PACK-CSR.                          17450000
174600                                                                  17460000
174700     IF PS-NOT-DONE                                               17470000
174800         PERFORM 2632-FETCH-RESOLVE-PACK-CSR                      17480000
174900     END-IF.                                                      17490000
175000                                                                  17500000
175100     IF PS-NO-MORE-RECORD                                         17510000
175200         SET PS-DONE TO TRUE                                      17520000
175300         MOVE PRV-47 TO TM500-RETURN-DATA                         17530000
175400     ELSE                                                         17540000
175500         PERFORM 2633-PROCESS-RESOLVE-PACK-CSR                    17550000
175600           UNTIL PS-NO-MORE-RECORD OR PS-DONE                     17560000
175700     END-IF.                                                      17570000
175800                                                                  17580000
175900     PERFORM 2634-CLOSE-RESOLVE-PACK-CSR.                         17590000
176000                                                                  17600000
176100                                                                  17610000
176200 2631-OPEN-RESOLVE-PACK-CSR.                                      17620000
176300******************************************************************17630000
176400******************************************************************17640000
176500                                                                  17650000
176600     EXEC SQL                                                     17660000
176700          OPEN RESOLVE-PACK-CSR                                   17670000
176800     END-EXEC.                                                    17680000
176900                                                                  17690000
177000     IF SQLCODE NOT = +0                                          17700000
177100         SET PS-DONE  TO TRUE                                     17710000
177200         MOVE SQLCA   TO TM500-SQLCA                              17720000
177300         MOVE SQLCODE TO TM500-SQLCODE                            17730000
177400         MOVE PRV-4X  TO TM500-RETURN-DATA                        17740000
177500     END-IF.                                                      17750000
177600                                                                  17760000
177700                                                                  17770000
177800 2632-FETCH-RESOLVE-PACK-CSR.                                     17780000
177900******************************************************************17790000
178000******************************************************************17800000
178100                                                                  17810000
178200     EXEC SQL                                                     17820000
178300          FETCH RESOLVE-PACK-CSR                                  17830000
178400           INTO :TRBNTF-NOTIF-NBR                                 17840000
178500              , :TRBNTF-RESOLVED-IND                              17850000
178600              , :TRBNTF-RTV-IND                                   17860000
178700     END-EXEC.                                                    17870000
178800                                                                  17880000
178900     EVALUATE TRUE                                                17890000
179000         WHEN SQLCODE = +0                                        17900000
179100              CONTINUE                                            17910000
179200                                                                  17920000
179300         WHEN SQLCODE = +100                                      17930000
179400              SET PS-NO-MORE-RECORD TO TRUE                       17940000
179500                                                                  17950000
179600         WHEN OTHER                                               17960000
179700              SET PS-DONE  TO TRUE                                17970000
179800              MOVE SQLCA   TO TM500-SQLCA                         17980000
179900              MOVE SQLCODE TO TM500-SQLCODE                       17990000
180000*             MOVE PRV-4Y  TO TM500-RETURN-DATA                   18000000
180100              MOVE PRV-4X  TO TM500-RETURN-DATA                   18010000
180200     END-EVALUATE.                                                18020000
180300                                                                  18030000
180400                                                                  18040000
180500 2633-PROCESS-RESOLVE-PACK-CSR.                                   18050000
180600******************************************************************18060000
180700******************************************************************18070000
180800                                                                  18080000
180900     MOVE PC-U                TO TM500-CRUD-IND.                  18090000
181000     MOVE TRBNTF-NOTIF-NBR    TO TM500-NOTIF-NBR.                 18100000
181100     MOVE TRBNTF-RESOLVED-IND TO TM500-RESOLVED-IND.              18110000
181200                                                                  18120000
181300     IF TM500-TRBL-RSN-CDE  = PC-502 OR PC-509                    18130000
181400         CONTINUE                                                 18140000
181500     ELSE                                                         18150000
181600         MOVE TRBNTF-RTV-IND  TO TM500-RTV-SW                     18160000
181700     END-IF.                                                      18170000
181800                                                                  18180000
181900     PERFORM 9000-CREATE-TROUBLE-RECORD.                          18190000
182000                                                                  18200000
182100     IF PS-NOT-DONE                                               18210000
182200         PERFORM 2632-FETCH-RESOLVE-PACK-CSR                      18220000
182300     END-IF.                                                      18230000
182400                                                                  18240000
182500 2634-CLOSE-RESOLVE-PACK-CSR.                                     18250000
182600******************************************************************18260000
182700******************************************************************18270000
182800                                                                  18280000
182900     EXEC SQL                                                     18290000
183000          CLOSE RESOLVE-PACK-CSR                                  18300000
183100     END-EXEC.                                                    18310000
183200                                                                  18320000
183300     IF SQLCODE = +100                                            18330000
183400         CONTINUE                                                 18340000
183500     ELSE                                                         18350000
183600        IF SQLCODE NOT = +0                                       18360000
183700            SET PS-DONE TO TRUE                                   18370000
183800            MOVE SQLCA TO TM500-SQLCA                             18380000
183900            MOVE SQLCODE TO TM500-SQLCODE                         18390000
184000*           MOVE PRV-4Z TO TM500-RETURN-DATA                      18400000
184100            MOVE PRV-4X TO TM500-RETURN-DATA                      18410000
184200        END-IF.                                                   18420000
184300                                                                  18430000
184400/                                                                 18440000
184500 2700-ACKNOWLEDGE.                                                18450000
184600                                                                  18460000
184700     IF TM500-LINE-LEVEL OR TM500-PO-LEVEL                        18470000
184800     IF TM500-PO-LNE-NBR > ZEROES                                 18480000
184900         PERFORM 2705-COUNT-TROUBLES                              18490000
185000             IF PV-DB2-COUNT > ZERO                               18500000
185100                 PERFORM 2707-COUNT-TRBL-AGAIN                    18510000
185200                 IF PV-DB2-ACK-COUNT > ZERO                       18520000
185300*********TROUBLE RECORD ALREADY ACKNOWLEDGED                      18530000
185400                     SET PS-DONE TO TRUE                          18540000
185500                     MOVE PRV-42 TO TM500-RETURN-DATA             18550000
185600                 ELSE                                             18560000
185700                     PERFORM 2710-ACKNWLG-ONE-ONLY                18570000
185800             ELSE                                                 18580000
185900*********TROUBLE RECORD NOT YET RESOLVED                          18590000
186000                 SET PS-DONE TO TRUE                              18600000
186100                 MOVE PRV-43 TO TM500-RETURN-DATA                 18610000
186200     ELSE                                                         18620000
186300         PERFORM 2720-ACKNWLG-ALL-CSR                             18630000
186400     END-IF                                                       18640000
186500     END-IF.                                                      18650000
186600                                                                  18660000
186700     IF TM500-PACK-LEVEL                                          18670000
186800     IF TM500-PREPK-ID > ZEROES                                   18680000
186900         PERFORM 2705-COUNT-TROUBLES                              18690000
187000             IF PV-DB2-COUNT > ZERO                               18700000
187100                 PERFORM 2707-COUNT-TRBL-AGAIN                    18710000
187200                 IF PV-DB2-ACK-COUNT > ZERO                       18720000
187300*********TROUBLE RECORD ALREADY ACKNOWLEDGED                      18730000
187400                     SET PS-DONE TO TRUE                          18740000
187500                     MOVE PRV-42 TO TM500-RETURN-DATA             18750000
187600                 ELSE                                             18760000
187700                     PERFORM 2710-ACKNWLG-ONE-ONLY                18770000
187800             ELSE                                                 18780000
187900*********TROUBLE RECORD NOT YET RESOLVED                          18790000
188000                 SET PS-DONE TO TRUE                              18800000
188100                 MOVE PRV-43 TO TM500-RETURN-DATA                 18810000
188200     ELSE                                                         18820000
188300         PERFORM 2720-ACKNWLG-ALL-CSR                             18830000
188400     END-IF                                                       18840000
188500     END-IF.                                                      18850000
188600                                                                  18860000
188700 2705-COUNT-TROUBLES.                                             18870000
188800     MOVE ZERO                TO PV-DB2-COUNT                     18880000
188900     EXEC SQL                                                     18890000
189000          SELECT COUNT(*)                                         18900000
189100            INTO :PV-DB2-COUNT                                    18910000
189200            FROM TTRBNTF                                          18920000
189300           WHERE NOTIF_NBR    = :TM500-NOTIF-NBR                  18930000
189400             AND RESOLVED_IND IN (:PC-R, :PC-A)                   18940000
189500     END-EXEC.                                                    18950000
189600                                                                  18960000
189700     IF SQLCODE = ZERO OR +100 OR -305                            18970000
189800         CONTINUE                                                 18980000
189900     ELSE                                                         18990000
190000        IF SQLCODE NOT = +0                                       19000000
190100            SET PS-DONE TO TRUE                                   19010000
190200            MOVE SQLCA TO TM500-SQLCA                             19020000
190300            MOVE SQLCODE TO TM500-SQLCODE                         19030000
190400            MOVE PRV-4Q TO TM500-RETURN-DATA                      19040000
190500        END-IF.                                                   19050000
190600                                                                  19060000
190700                                                                  19070000
190800 2707-COUNT-TRBL-AGAIN.                                           19080000
190900     MOVE ZERO                TO PV-DB2-ACK-COUNT                 19090000
191000     EXEC SQL                                                     19100000
191100          SELECT COUNT(*)                                         19110000
191200            INTO :PV-DB2-ACK-COUNT                                19120000
191300            FROM TTRBNTF                                          19130000
191400           WHERE NOTIF_NBR    = :TM500-NOTIF-NBR                  19140000
191500             AND RESOLVED_IND = :PC-A                             19150000
191600     END-EXEC.                                                    19160000
191700                                                                  19170000
191800     EVALUATE SQLCODE                                             19180000
191900        WHEN +0                                                   19190000
192000        WHEN +100                                                 19200000
192100        WHEN -305                                                 19210000
192200            CONTINUE                                              19220000
192300        WHEN OTHER                                                19230000
192400            SET PS-DONE TO TRUE                                   19240000
192500            MOVE SQLCA TO TM500-SQLCA                             19250000
192600            MOVE SQLCODE TO TM500-SQLCODE                         19260000
192700            MOVE PRV-4Q TO TM500-RETURN-DATA                      19270000
192800     END-EVALUATE.                                                19280000
192900                                                                  19290000
193000                                                                  19300000
193100 2710-ACKNWLG-ONE-ONLY.                                           19310000
193200******************************************************************19320000
193300******************************************************************19330000
193400                                                                  19340000
193500     MOVE PC-U                    TO TM500-CRUD-IND               19350000
193600     MOVE TRBNTF-RESOLVED-IND TO TM500-RESOLVED-IND               19360000
193700     PERFORM 9000-CREATE-TROUBLE-RECORD.                          19370000
193800                                                                  19380000
193900                                                                  19390000
194000 2720-ACKNWLG-ALL-CSR.                                            19400000
194100******************************************************************19410000
194200******************************************************************19420000
194300                                                                  19430000
194400     SET PS-MORE-RECORD TO TRUE.                                  19440000
194500                                                                  19450000
194600     PERFORM 2721-OPEN-ACKNWLG-ALL-CSR.                           19460000
194700                                                                  19470000
194800     IF PS-NOT-DONE                                               19480000
194900         PERFORM 2722-FETCH-ACKNWLG-ALL-CSR                       19490000
195000     END-IF.                                                      19500000
195100                                                                  19510000
195200     IF PS-NO-MORE-RECORD                                         19520000
195300         SET PS-DONE TO TRUE                                      19530000
195400         MOVE PRV-43 TO TM500-RETURN-DATA                         19540000
195500     ELSE                                                         19550000
195600         PERFORM 2723-PROCESS-ACKNWLG-ALL-CSR                     19560000
195700           UNTIL PS-NO-MORE-RECORD OR PS-DONE                     19570000
195800     END-IF.                                                      19580000
195900                                                                  19590000
196000     PERFORM 2724-CLOSE-ACKNWLG-ALL-CSR.                          19600000
196100                                                                  19610000
196200                                                                  19620000
196300 2721-OPEN-ACKNWLG-ALL-CSR.                                       19630000
196400******************************************************************19640000
196500******************************************************************19650000
196600                                                                  19660000
196700     EXEC SQL                                                     19670000
196800          OPEN ACKNWLG-ALL-CSR                                    19680000
196900     END-EXEC.                                                    19690000
197000                                                                  19700000
197100     IF SQLCODE NOT = +0                                          19710000
197200         SET PS-DONE  TO TRUE                                     19720000
197300         MOVE SQLCA   TO TM500-SQLCA                              19730000
197400         MOVE SQLCODE TO TM500-SQLCODE                            19740000
197500         MOVE PRV-4R  TO TM500-RETURN-DATA                        19750000
197600     END-IF.                                                      19760000
197700                                                                  19770000
197800                                                                  19780000
197900 2722-FETCH-ACKNWLG-ALL-CSR.                                      19790000
198000******************************************************************19800000
198100******************************************************************19810000
198200                                                                  19820000
198300     EXEC SQL                                                     19830000
198400          FETCH ACKNWLG-ALL-CSR                                   19840000
198500           INTO :TRBNTF-PO-LNE-NBR                                19850000
198600              , :TRBNTF-PREPK-ID                                  19860000
198700              , :TRBNTF-NOTIF-NBR                                 19870000
198800              , :TRBNTF-RESOLVED-IND                              19880000
198900              , :TRBNTF-RTV-IND                                   19890000
199000     END-EXEC.                                                    19900000
199100                                                                  19910000
199200     EVALUATE TRUE                                                19920000
199300         WHEN SQLCODE = +0                                        19930000
199400             CONTINUE                                             19940000
199500                                                                  19950000
199600         WHEN SQLCODE = +100                                      19960000
199700              SET PS-NO-MORE-RECORD TO TRUE                       19970000
199800                                                                  19980000
199900         WHEN OTHER                                               19990000
200000              SET PS-DONE  TO TRUE                                20000000
200100              MOVE SQLCA   TO TM500-SQLCA                         20010000
200200              MOVE SQLCODE TO TM500-SQLCODE                       20020000
200300              MOVE PRV-4S  TO TM500-RETURN-DATA                   20030000
200400     END-EVALUATE.                                                20040000
200500                                                                  20050000
200600                                                                  20060000
200700 2723-PROCESS-ACKNWLG-ALL-CSR.                                    20070000
200800******************************************************************20080000
200900******************************************************************20090000
201000                                                                  20100000
201100     MOVE PC-U                TO TM500-CRUD-IND.                  20110000
201200     MOVE TRBNTF-NOTIF-NBR    TO TM500-NOTIF-NBR.                 20120000
201300     MOVE TRBNTF-RESOLVED-IND TO TM500-RESOLVED-IND.              20130000
201400     MOVE TRBNTF-RTV-IND      TO TM500-RTV-SW.                    20140000
201500     PERFORM 9000-CREATE-TROUBLE-RECORD.                          20150000
201600                                                                  20160000
201700     IF PS-NOT-DONE                                               20170000
201800         PERFORM 2722-FETCH-ACKNWLG-ALL-CSR                       20180000
201900     END-IF.                                                      20190000
202000                                                                  20200000
202100 2724-CLOSE-ACKNWLG-ALL-CSR.                                      20210000
202200******************************************************************20220000
202300******************************************************************20230000
202400                                                                  20240000
202500     EXEC SQL                                                     20250000
202600          CLOSE ACKNWLG-ALL-CSR                                   20260000
202700     END-EXEC.                                                    20270000
202800                                                                  20280000
202900     IF SQLCODE = +100                                            20290000
203000         CONTINUE                                                 20300000
203100     ELSE                                                         20310000
203200        IF SQLCODE NOT = +0                                       20320000
203300            SET PS-DONE TO TRUE                                   20330000
203400            MOVE SQLCA TO TM500-SQLCA                             20340000
203500            MOVE SQLCODE TO TM500-SQLCODE                         20350000
203600            MOVE PRV-4T TO TM500-RETURN-DATA                      20360000
203700        END-IF.                                                   20370000
203800/                                                                 20380000
203900 2800-UPDATE-NOTIF.                                               20390000
204000******************************************************************20400000
204100******************************************************************20410000
204200                                                                  20420000
204300     MOVE PC-U TO TM500-CRUD-IND.                                 20430000
204400     PERFORM 9000-CREATE-TROUBLE-RECORD.                          20440000
204500                                                                  20450000
204510 2900-RESOLVE-SPECIFIC.                                           20451010
204520******************************************************************20452010
204530******************************************************************20453010
204540                                                                  20454010
204560     PERFORM 9000-CREATE-TROUBLE-RECORD.                          20456010
204570                                                                  20457010
204580                                                                  20458010
204600/                                                                 20460000
204700 3000-CHECK-HEADER-TROUBLE.                                       20470000
204800******************************************************************20480000
204900******************************************************************20490000
205000                                                                  20500000
205100     EXEC CICS                                                    20510000
205200         LINK PROGRAM  (PC-RCKCS234)                              20520000
205300              COMMAREA (TM500-FIELDS)                             20530000
205400              LENGTH   (PC-600)                                   20540000
205500     END-EXEC.                                                    20550000
205600                                                                  20560000
205700     EVALUATE TRUE                                                20570000
205800         WHEN TM500-CALL-SUCCESSFUL                               20580000
205900         WHEN TM500-DUPLICATE-TROUBLE                             20590000
206000         WHEN TM500-TTRBNTF-UPDATE-NOT-FND                        20600000
206100         WHEN TM500-TPURCHS-SELECT-NOT-FND                        20610000
206200         WHEN TM500-SHIPPING-WINDOW-ERROR                         20620000
206300              CONTINUE                                            20630000
206400                                                                  20640000
206500         WHEN OTHER                                               20650000
206600              SET PS-DONE TO TRUE                                 20660000
206700     END-EVALUATE.                                                20670000
206800                                                                  20680000
206900*  NOT SET IN RCKCS234:                                           20690000
207000*    TM500-DUPLICATE-TROUBLE                                      20700000
207100*    TM500-TTRBNTF-UPDATE-NOT-FND                                 20710000
207200                                                                  20720000
207300 4000-CHECK-LINE-TROUBLE.                                         20730000
207400******************************************************************20740000
207500******************************************************************20750000
207600                                                                  20760000
207700     EXEC CICS                                                    20770000
207800         LINK PROGRAM  (PC-RCKCS232)                              20780000
207900              COMMAREA (TM500-FIELDS)                             20790000
208000              LENGTH   (PC-600)                                   20800000
208100     END-EXEC.                                                    20810000
208200                                                                  20820000
208300     EVALUATE TRUE                                                20830000
208400         WHEN TM500-CALL-SUCCESSFUL                               20840000
208500         WHEN TM500-DUPLICATE-TROUBLE                             20850000
208600         WHEN TM500-TTRBNTF-UPDATE-NOT-FND                        20860000
208700         WHEN TM500-DIDNT-ALLOC-DUE-TO-TRBL                       20870000
208800              CONTINUE                                            20880000
208900                                                                  20890000
209000         WHEN OTHER                                               20900000
209100              SET PS-DONE TO TRUE                                 20910000
209200     END-EVALUATE.                                                20920000
209300                                                                  20930000
209400*  NOT SET IN RCKCS232                                            20940000
209500*    TM500-DUPLICATE-TROUBLE                                      20950000
209600*    TM500-TTRBNTF-UPDATE-NOT-FND                                 20960000
209700                                                                  20970000
209800******************************************************************20980000
209900 4001-CHECK-LINE-TROUBLE.                                         20990000
210000                                                                  21000000
210100     EXEC CICS                                                    21010000
210200         LINK PROGRAM  (PV-PRORATE)                               21020000
210300              COMMAREA (TM500-FIELDS)                             21030000
210400              LENGTH   (PC-600)                                   21040000
210500     END-EXEC.                                                    21050000
210600                                                                  21060000
210700     EVALUATE TRUE                                                21070000
210800       WHEN TM500-CALL-SUCCESSFUL                                 21080000
210900       WHEN TM500-DUPLICATE-TROUBLE                               21090000
211000       WHEN TM500-TTRBNTF-UPDATE-NOT-FND                          21100000
211100       WHEN TM500-DIDNT-ALLOC-DUE-TO-TRBL                         21110000
211200           CONTINUE                                               21120000
211300                                                                  21130000
211400       WHEN OTHER                                                 21140000
211500           SET PS-DONE TO TRUE                                    21150000
211600     END-EVALUATE.                                                21160000
211700                                                                  21170000
211800                                                                  21180000
211900 5000-CHECK-PACK-TROUBLE.                                         21190000
212000                                                                  21200000
212100     EXEC CICS                                                    21210000
212200         LINK PROGRAM  (PC-RCKCS808)                              21220000
212300              COMMAREA (TM500-FIELDS)                             21230000
212400              LENGTH   (PC-600)                                   21240000
212500     END-EXEC.                                                    21250000
212600                                                                  21260000
212700     EVALUATE TRUE                                                21270000
212800         WHEN TM500-CALL-SUCCESSFUL                               21280000
212900         WHEN TM500-DUPLICATE-TROUBLE                             21290000
213000         WHEN TM500-TTRBNTF-UPDATE-NOT-FND                        21300000
213100         WHEN TM500-DIDNT-ALLOC-DUE-TO-TRBL                       21310000
213200         WHEN TM500-PREPACK-ERROR                                 21320000
213300              CONTINUE                                            21330000
213400                                                                  21340000
213500         WHEN OTHER                                               21350000
213600              SET PS-DONE TO TRUE                                 21360000
213700     END-EVALUATE.                                                21370000
213800                                                                  21380000
213900******************************************************************21390000
214000 5001-CHECK-PACK-TROUBLE.                                         21400000
214100                                                                  21410000
214200     EXEC CICS                                                    21420000
214300         LINK PROGRAM  (PV-PRORATE)                               21430000
214400              COMMAREA (TM500-FIELDS)                             21440000
214500              LENGTH   (PC-600)                                   21450000
214600     END-EXEC.                                                    21460000
214700                                                                  21470000
214800     EVALUATE TRUE                                                21480000
214900       WHEN TM500-CALL-SUCCESSFUL                                 21490000
215000       WHEN TM500-DUPLICATE-TROUBLE                               21500000
215100       WHEN TM500-TTRBNTF-UPDATE-NOT-FND                          21510000
215200       WHEN TM500-DIDNT-ALLOC-DUE-TO-TRBL                         21520000
215300       WHEN TM500-PREPACK-ERROR                                   21530000
215400           CONTINUE                                               21540000
215500                                                                  21550000
215600       WHEN OTHER                                                 21560000
215700           SET PS-DONE TO TRUE                                    21570000
215800     END-EVALUATE.                                                21580000
215900                                                                  21590000
215910* JAK 05/2007 - ADD CODE TO CALL SHIPMENT CONTROL MODULE          21591013
215920******************************************************************21592013
215930*  THIS PARAGRAPH CHECKS TO SEE IF THE DC IS DOWNLOADING TO WMS   21593016
215940******************************************************************21594013
215950 6000-CHECK-ASNDWN.                                               21595013
215960                                                                  21596013
215970     MOVE RECEIV-CURR-OPER-UNT-ID  TO KRPRPM-LOC-ID.              21597024
215980                                                                  21598013
215990     EXEC SQL                                                     21599013
215991          SELECT   FUNC_TXT                                       21599113
215992            INTO  :KRPRPM-FUNC-TXT                                21599213
215993            FROM                                                  21599313
215994                  TKRPRPM                                         21599413
215995            WHERE                                                 21599513
215996                  LOC_ID            = :KRPRPM-LOC-ID              21599613
215997              AND SYS_PRC_FUNC_CDE  = 'ASNDWN'                    21599713
215998              AND FUNC_PRC_STAT_CDE = 'AC'                        21599813
215999              AND INTFC_SYS_CDE     = 'KHL'                       21599913
216000              AND FUNC_TXT          = 'Y'                         21600013
216001              AND FUNC_BEG_TMST    < CURRENT TIMESTAMP            21600113
216002     END-EXEC.                                                    21600213
216003                                                                  21600313
216004     EVALUATE TRUE                                                21600413
216005         WHEN SQLCODE = ZERO                                      21600513
216006              SET PS-ASNS-TO-WMS-YES    TO TRUE                   21600613
216007         WHEN SQLCODE = +100                                      21600713
216008              SET PS-ASNS-TO-WMS-NO     TO TRUE                   21600813
216009         WHEN SQLWARN0 NOT = SPACES                               21600913
216010         WHEN SQLCODE  NOT = ZERO                                 21601013
216011             SET  PS-DONE TO TRUE                                 21601113
216012             MOVE SQLCA   TO TM500-SQLCA                          21601213
216013             MOVE SQLCODE TO TM500-SQLCODE                        21601313
216014             MOVE PRV-4X  TO TM500-RETURN-DATA                    21601414
216015     END-EVALUATE.                                                21601513
216016                                                                  21601613
216017******************************************************************21601718
216018*  THIS PARAGRAPH GETS THE CURRENT OPER ID FOR THE PO/RCVR        21601818
216019******************************************************************21601918
216020 6010-SELECT-TRECEIV.                                             21602018
216021                                                                  21602118
216022     MOVE TM500-PO-NBR       TO RECEIV-ORD-NBR.                   21602218
216023     MOVE TM500-REC-SEQ-NBR  TO RECEIV-REC-SEQ-NBR.               21602318
216024                                                                  21602418
216025     EXEC SQL                                                     21602518
216026          SELECT   CURR_OPER_UNT_ID                               21602624
216027            INTO  :RECEIV-CURR-OPER-UNT-ID                        21602724
216028            FROM                                                  21602818
216029                  TRECEIV                                         21602918
216030            WHERE                                                 21603018
216031                  ORD_NBR           = :RECEIV-ORD-NBR             21603118
216032              AND REC_SEQ_NBR       = :RECEIV-REC-SEQ-NBR         21603218
216033              AND VER_STATUS_CDE    = 'A'                         21603318
216034     END-EXEC.                                                    21603418
216036                                                                  21603618
216051     EVALUATE TRUE                                                21605118
216052         WHEN SQLCODE = ZERO                                      21605218
216053         WHEN SQLCODE = -811                                      21605320
216054              CONTINUE                                            21605420
216055         WHEN SQLCODE = +100                                      21605520
216056              MOVE ZERO              TO RECEIV-CURR-OPER-UNT-ID   21605624
216057         WHEN SQLWARN0 NOT = SPACES                               21605720
216058         WHEN SQLCODE  NOT = ZERO                                 21605820
216059             SET  PS-DONE TO TRUE                                 21605920
216060             MOVE SQLCA   TO TM500-SQLCA                          21606020
216061             MOVE SQLCODE TO TM500-SQLCODE                        21606120
216062             MOVE PRV-4X  TO TM500-RETURN-DATA                    21606220
216063     END-EVALUATE.                                                21606320
216064                                                                  21606420
216065******************************************************************21606520
216066*  THIS PARAGRAPH CHECKS TO SEE IF THE TRECDIS ROWS EXIST.        21606620
216067******************************************************************21606720
216068 6020-CHECK-TRECDIS.                                              21606820
216069                                                                  21606920
216070     MOVE 0 TO PV-SQL-CNT.                                        21607020
216071                                                                  21607120
216072     EXEC SQL                                                     21607220
216073         SELECT COUNT(*)                                          21607320
216074           INTO :PV-SQL-CNT                                       21607420
216075           FROM TRECDIS                                           21607520
216076          WHERE ORD_NBR        = :TM500-PO-NBR                    21607620
216077            AND ORD_LNE_NBR    = :TM500-PO-LNE-NBR                21607720
216078            AND REC_SEQ_NBR    = :TM500-REC-SEQ-NBR               21607820
216079            AND OPER_UNT_ID    = :TM500-OPER-UNT-ID               21607920
216080            AND FCLTY_ID       = :TM500-FCLTY-ID                  21608020
216082     END-EXEC.                                                    21608220
216083                                                                  21608320
216084     EVALUATE TRUE                                                21608420
216085         WHEN SQLCODE = ZERO                                      21608520
216086             IF PV-SQL-CNT = 0                                    21608620
216087                 SET PS-DISTRO-TRBL-YES TO TRUE                   21608720
216088             ELSE                                                 21608820
216089                 SET PS-DISTRO-TRBL-NO  TO TRUE                   21608920
216090             END-IF                                               21609020
216091         WHEN SQLCODE = +100                                      21609120
216092                 SET PS-DISTRO-TRBL-YES TO TRUE                   21609220
216093                                                                  21609320
216094         WHEN SQLCODE = -904                                      21609420
216095         WHEN SQLCODE = -911                                      21609520
216096         WHEN SQLCODE = -913                                      21609620
216097             CONTINUE                                             21609720
216098                                                                  21609820
216099         WHEN SQLWARN0 NOT = SPACES                               21609920
216100         WHEN SQLCODE  NOT = ZERO                                 21610020
216101             SET  PS-DONE TO TRUE                                 21610120
216102             MOVE SQLCA   TO TM500-SQLCA                          21610220
216103             MOVE SQLCODE TO TM500-SQLCODE                        21610320
216104             MOVE PRV-4X  TO TM500-RETURN-DATA                    21610420
216105     END-EVALUATE.                                                21610520
216106                                                                  21610620
216107******************************************************************21610720
216108*  THIS PARAGRAPH GETS THE TRIP-ID FROM THE PO/RCVR.              21610820
216109******************************************************************21610920
216110 6030-GET-TRIP-ID.                                                21611020
216111                                                                  21611120
216112     EXEC SQL                                                     21611220
216113         SELECT A.TRIP_ID                                         21611320
216114           INTO :SHIPMT-TRIP-ID                                   21611420
216115           FROM TSHIPMT   A                                       21611520
216116              , TSHPTPO   B                                       21611620
216117          WHERE B.PO_NBR         = :TM500-PO-NBR                  21611720
216118            AND B.REC_SEQ_NBR    = :TM500-REC-SEQ-NBR             21611820
216119            AND A.SHIPT_ID       = B.SHIPT_ID                     21611920
216120            AND B.PRIM_SHIPT_IND = 'Y'                            21612025
216121     END-EXEC.                                                    21612125
216122                                                                  21612225
216123     EVALUATE TRUE                                                21612325
216124         WHEN SQLCODE = ZERO                                      21612425
216125             CONTINUE                                             21612525
216126         WHEN SQLCODE = -904                                      21612625
216127         WHEN SQLCODE = -911                                      21612725
216128         WHEN SQLCODE = -913                                      21612825
216129             CONTINUE                                             21612925
216130                                                                  21613025
216131         WHEN SQLWARN0 NOT = SPACES                               21613125
216132         WHEN SQLCODE  NOT = ZERO                                 21613225
216133             SET  PS-DONE TO TRUE                                 21613325
216134             MOVE SQLCA   TO TM500-SQLCA                          21613425
216135             MOVE SQLCODE TO TM500-SQLCODE                        21613525
216136             MOVE PRV-4X  TO TM500-RETURN-DATA                    21613625
216137     END-EVALUATE.                                                21613725
216138                                                                  21613825
216139*----------------------------------------------------------       21613925
216140* LINK TO WMS VENDOR SHIPMENT CONTROL MODULE (WSKCS305) USING     21614025
216141*  COPYBOOK WSWS001.                                              21614125
216142*----------------------------------------------------------------*21614225
216143 6040-CALL-WMS-MODULE.                                            21614325
216144                                                                  21614425
216151     SET WS001-PKSLIP-INACTIVE      TO TRUE.                      21615125
216152     MOVE SHIPMT-TRIP-ID            TO WS001-TRIP-ID.             21615225
216153     MOVE TM500-OPER-UNT-ID         TO WS001-OPER-UNT-ID.         21615325
216154     MOVE SPACES                    TO WS001-USER-ID.             21615425
216155     MOVE TM500-PO-NBR              TO WS001-PO-NBR.              21615525
216156     MOVE TM500-PO-LNE-NBR          TO WS001-PO-LNE-NBR.          21615625
216157     MOVE TM500-REC-SEQ-NBR         TO WS001-RCVR-NBR.            21615725
216158     MOVE TM500-PREPK-ID            TO WS001-PREPK-ID.            21615825
216159     MOVE ZEROS                     TO WS001-SKU-NBR.             21615925
216160     MOVE ZEROS                     TO WS001-KOHLS-SHIPT-ID.      21616025
216161     MOVE 'RC'                      TO WS001-SHIPMENT-SOURCE.     21616125
216162     MOVE SPACES                    TO WS001-DTL-ASN-LEVEL-IND.   21616225
216163     MOVE EIBTASKN                  TO WS001-SRC-TASK-NUMBER.     21616325
216164     MOVE 'TMKCS520'                TO WS001-CALLING-PROGRAM-NAME.21616425
216165                                                                  21616525
216166     MOVE LENGTH OF WS001-FIELDS    TO PV-COMMAREA-LENGTH.        21616625
216167                                                                  21616725
216168     EXEC CICS                                                    21616825
216169         LINK PROGRAM  (PC-WMS-CONTROL-MOD)                       21616925
216170              COMMAREA (WS001-FIELDS)                             21617025
216171              LENGTH   (PV-COMMAREA-LENGTH)                       21617125
216172     END-EXEC.                                                    21617225
216173                                                                  21617325
216174     EVALUATE TRUE                                                21617425
216175         WHEN WS001-SUCCESSFUL                                    21617525
216176              SET TM500-ASN-SENT-TO-WMS-YES   TO TRUE             21617625
216177                                                                  21617725
216178         WHEN OTHER                                               21617825
216179             SET  PS-DONE TO TRUE                                 21617925
216180             MOVE SQLCA   TO TM500-SQLCA                          21618025
216181             MOVE SQLCODE TO TM500-SQLCODE                        21618125
216182             MOVE PRV-4X  TO TM500-RETURN-DATA                    21618225
216183                                                                  21618325
216184     END-EVALUATE.                                                21618425
216185                                                                  21618525
216186* JAK 05/2007 - END                                               21618625
216187                                                                  21618725
216188 9000-CREATE-TROUBLE-RECORD.                                      21618825
216190******************************************************************21619000
216200*    THIS PARAGRAPH CALLS PROGRAM TMKCS521 THAT CREATES TROUBLE   21620000
216300*    RECORDS IN TABLE TTRBNTF.                                    21630000
216400******************************************************************21640000
216500                                                                  21650000
216600     EXEC CICS                                                    21660000
216700         LINK PROGRAM  (PC-TMKCS521)                              21670000
216800              COMMAREA (TM500-FIELDS)                             21680000
216900              LENGTH   (PC-600)                                   21690000
217000     END-EXEC.                                                    21700000
217100                                                                  21710000
217200     EVALUATE TRUE                                                21720000
217300         WHEN TM500-CALL-SUCCESSFUL                               21730000
217400         WHEN TM500-DUPLICATE-TROUBLE                             21740000
217500         WHEN TM500-TTRBNTF-UPDATE-NOT-FND                        21750000
217600         WHEN TM500-TPURCHS-SELECT-NOT-FND                        21760000
217700              CONTINUE                                            21770000
217800                                                                  21780000
217900         WHEN OTHER                                               21790000
218000              SET PS-DONE TO TRUE                                 21800000
218100     END-EVALUATE.                                                21810000
218200*  NOT SET IN TMKCS521:                                           21820000
218300* TM500-TTRBNTF-UPDATE-NOT-FND                                    21830000
218400* TM500-TPURCHS-SELECT-NOT-FND                                    21840000
218500                                                                  21850000
