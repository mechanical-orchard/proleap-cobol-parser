000100****************************************************************  00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300****************************************************************  00030001
000400 PROGRAM-ID.    RCKUT116.                                         00040005
000500 AUTHOR.        RON KRIER                                         00050001
000600 DATE-WRITTEN.  JANUARY, 2002.                                    00060001
000700                                                                  00070001
000800****************************************************************  00080001
000900* THIS PROGRAM WILL EXTRACT VERIFIED RECEIVERS FOR A CERTAIN      00090021
001000* TIME PERIOD.  THE OUTPUT FILE FROM THIS PROGRAM WILL BE         00100021
001100* PASSED ONTO RCKRP033 TO CREATE THE RECEIVER VERIFICATION        00110021
001110* SUMMARY.                                                        00111021
001200****************************************************************  00120001
001300                                                                  00130001
001400****************************************************************  00140001
001500 ENVIRONMENT DIVISION.                                            00150001
001600****************************************************************  00160001
001700                                                                  00170001
001800****************************************************************  00180001
001900 INPUT-OUTPUT SECTION.                                            00190001
002000****************************************************************  00200001
002100                                                                  00210001
002200****************************************************************  00220001
002300 FILE-CONTROL.                                                    00230001
002400****************************************************************  00240001
002500     SELECT INPUT-FILE                                            00250001
002600         ASSIGN TO INP01.                                         00260001
002700                                                                  00270001
002800     SELECT OUTPUT-FILE                                           00280001
002900         ASSIGN TO OUT01.                                         00290001
003000                                                                  00300001
003100****************************************************************  00310001
003200 DATA DIVISION.                                                   00320001
003300****************************************************************  00330001
003400                                                                  00340001
003500****************************************************************  00350001
003600 FILE SECTION.                                                    00360001
003700****************************************************************  00370001
003800                                                                  00380001
003900 FD  INPUT-FILE                                                   00390001
004000     RECORDING MODE IS F                                          00400001
004100     BLOCK CONTAINS 0 RECORDS                                     00410001
004200     DATA RECORD IS INPUT-RECORD.                                 00420016
004300 01  INPUT-RECORD                        PIC  X(60).              00430011
004400                                                                  00440001
004500 FD  OUTPUT-FILE                                                  00450001
004600     RECORDING MODE IS F                                          00460001
004700     BLOCK CONTAINS 0 RECORDS                                     00470001
004800     DATA RECORD IS OUTPUT-RECORD.                                00480001
004900 01  OUTPUT-RECORD                       PIC  X(250).             00490017
005000                                                                  00500001
005100                                                                  00510001
005200/                                                                 00520001
005300 WORKING-STORAGE SECTION.                                         00530001
005400                                                                  00540001
005500*  TOTAL LENGTH OF 60                                             00550011
005600 01  IR-INPUT-RECORD.                                             00560004
005700     05  IR-ORD-NBR                      PIC  S9(9) COMP.         00570001
005800     05  IR-REC-SEQ-NBR                  PIC  S9(9) COMP.         00580001
005900     05  IR-ORD-LNE-NBR                  PIC  S9(9) COMP.         00590001
006000     05  IR-OPER-UNT-ID                  PIC  S9(4) COMP.         00600001
006100     05  IR-CRE-OPER-UNT-ID              PIC  S9(4) COMP.         00610001
006200     05  IR-CURR-OPER-UNT-ID             PIC  S9(4) COMP.         00620001
006300     05  IR-PO-VER-NBR                   PIC  S9(9) COMP.         00630001
006400     05  IR-PACK-BY-ST-IND               PIC   X(1).              00640001
006500     05  IR-PKGNG-CDE                    PIC   X(1).              00650001
006600     05  IR-EXPTED-CART-CNT              PIC  S9(4) COMP.         00660001
006700     05  IR-ACTL-CART-CNT                PIC  S9(4) COMP.         00670001
006800     05  IR-VERFYD-TMST                  PIC   X(26).             00680001
006900                                                                  00690001
007000*  TOTAL LENGTH OF 250                                            00700011
007100 01  OR-OUTPUT-RECORD.                                            00710006
007200     05  OR-ORD-NBR                      PIC  S9(9) COMP.         00720006
007300     05  OR-REC-SEQ-NBR                  PIC  S9(9) COMP.         00730006
007400     05  OR-OPER-UNT-ID                  PIC  S9(4) COMP.         00740006
007500     05  OR-PACK-BY-ST-IND               PIC   X(1).              00750006
007600     05  OR-PKGNG-CDE                    PIC   X(1).              00760006
007700     05  OR-EXPTED-CART-CNT              PIC  S9(18) COMP-3.      00770006
007800     05  OR-ACTL-CART-CNT                PIC  S9(18) COMP-3.      00780006
007900     05  OR-DIFF-CART-CNT                PIC  S9(18) COMP-3.      00790006
008000     05  OR-VERFYD-DATE.                                          00800006
008100         10  OR-VERFYD-DATE-YYYY         PIC   X(4).              00810006
008200         10  OR-VERFYD-DATE-DASH1        PIC   X(1).              00820006
008300         10  OR-VERFYD-DATE-MM           PIC   X(2).              00830006
008400         10  OR-VERFYD-DATE-DASH2        PIC   X(1).              00840006
008500         10  OR-VERFYD-DATE-DD           PIC   X(2).              00850006
008600     05  OR-CRE-OPER-UNT-ID              PIC  S9(4) COMP.         00860006
008700     05  OR-CURR-OPER-UNT-ID             PIC  S9(4) COMP.         00870006
008800     05  OR-EXPTED-ITM-QTY               PIC  S9(17) COMP-3.      00880006
008900     05  OR-EXPTED-EXT-RETAIL            PIC  S9(15)V99           00890006
009000                                                     COMP-3.      00900006
009100     05  OR-VERIFY-ITM-QTY               PIC  S9(17) COMP-3.      00910006
009200     05  OR-VERIFY-EXT-RETAIL            PIC  S9(15)V99           00920006
009300                                                     COMP-3.      00930006
009400     05  OR-AP-VERIFY-ITM-QTY            PIC  S9(17) COMP-3.      00940006
009500     05  OR-AP-VERIFY-EXT-RETAIL         PIC  S9(15)V99           00950006
009600                                                     COMP-3.      00960006
009700     05  OR-DIFF-ITM-QTY                 PIC  S9(17) COMP-3.      00970006
009800     05  OR-DIFF-EXT-RETAIL              PIC  S9(15)V99           00980006
009900                                                     COMP-3.      00990006
010000     05  OR-VERFYD-TMST                  PIC   X(26).             01000006
010100     05  OR-NBR-OF-LINES                 PIC  S9(11) COMP-3.      01010006
010200     05  OR-NBR-OF-LINES-SHORT-UNITS     PIC  S9(11) COMP-3.      01020006
010300     05  OR-NBR-OF-LINES-OVER-UNITS      PIC  S9(11) COMP-3.      01030006
010400     05  OR-NBR-LINES-VRFY-RTL-SHORT     PIC  S9(11) COMP-3.      01040008
010600     05  OR-NBR-LINES-VRFY-RTL-OVER      PIC  S9(11) COMP-3.      01060008
010800     05  OR-NBR-OF-RCVRS                 PIC  S9(7)  COMP-3.      01080006
010900     05  OR-NBR-OF-RCVRS-SHORT-CRTNS     PIC  S9(7)  COMP-3.      01090006
011000     05  OR-NBR-OF-RCVRS-OVER-CRTNS      PIC  S9(7)  COMP-3.      01100006
011010     05  OR-NBR-OF-RCVRS-SHORT-UNITS     PIC  S9(7)  COMP-3.      01101006
011020     05  OR-NBR-OF-RCVRS-OVER-UNITS      PIC  S9(7)  COMP-3.      01102006
011021     05  OR-NBR-OF-RCVRS-SHORT-RTL       PIC  S9(7)  COMP-3.      01102106
011022     05  OR-NBR-OF-RCVRS-OVER-RTL        PIC  S9(7)  COMP-3.      01102206
011030     05  FILLER                          PIC   X(38).             01103009
011200                                                                  01120001
011300 01  ABEND-CODE                          PIC S9(04)  VALUE ZERO   01130001
011400                                                     COMP SYNC.   01140001
011500                                                                  01150001
011600 01  PV-PROGRAM-VARIABLES.                                        01160001
011610     05  PV-NULL-IND-1                  PIC S9(04)  VALUE +0      01161007
011620                                                    COMP.         01162007
011630     05  PV-NULL-IND-2                  PIC S9(04)  VALUE +0      01163007
011640                                                    COMP.         01164007
011650     05  PV-NULL-IND-3                  PIC S9(04)  VALUE +0      01165007
011660                                                    COMP.         01166007
011700     05  PV-PREV-ORD-NBR                 PIC  S9(9) COMP.         01170001
011800     05  PV-PREV-REC-SEQ-NBR             PIC  S9(9) COMP.         01180001
011900     05  PV-NUMBER-READS                 PIC S9(09)  VALUE ZERO   01190001
012000                                                     COMP-3.      01200001
012100     05  PV-NUMBER-READS-DISP            PIC S9(09)  VALUE ZERO   01210001
012200                                                     COMP-3.      01220001
012300     05  PV-NUMBER-WRITES                PIC S9(09)  VALUE ZERO   01230001
012400                                                     COMP-3.      01240001
012500     05  PV-NUMBER-WRITES-DISP           PIC S9(09)  VALUE ZERO   01250001
012600                                                     COMP-3.      01260001
012610     05  PV-VENDOR-ROW-NOT-FOUND         PIC S9(09)  VALUE ZERO   01261023
012620                                                     COMP-3.      01262023
012700     05  PV-START-DATE                   PIC  X(10).              01270001
012800     05  PV-END-DATE                     PIC  X(10).              01280001
012900     05  PV-TMST                         PIC  X(26)  VALUE SPACE. 01290001
013000     05  FILLER  REDEFINES  PV-TMST.                              01300001
013100         10  PV-DATE.                                             01310001
013200             15  PV-TMST-DATE.                                    01320001
013300                 20  PV-TMST-DATE-YY     PIC  X(04).              01330001
013400             15  PV-SLASH1               PIC  X(01).              01340001
013500             15  PV-TMST-DATE-MM         PIC  X(02).              01350001
013600             15  PV-SLASH2               PIC  X(01).              01360001
013700             15  PV-TMST-DATE-DD         PIC  X(02).              01370001
013800         10  FILLER                      PIC  X(16).              01380001
013900     05  PV-ABEND-PARAGRAPH              PIC  X(30)  VALUE SPACE. 01390001
014000     05  PV-DB2-OPERATION-ATTEMPTED      PIC  X(30)  VALUE SPACE. 01400001
014100     05  PV-DISPLAY-FIELD                PIC  9(09)  VALUE ZEROS. 01410001
014200     05  PV-START1.                                               01420001
014300         10  PV-START-DATE1              PIC  X(10).              01430001
014400         10  PV-START-TIME1              PIC  X(16)  VALUE        01440001
014500                   '-00.00.00.000000'.                            01450001
014600     05  PV-START-TMST1 REDEFINES PV-START1 PIC X(26).            01460001
014700                                                                  01470001
014800     05  PV-END1.                                                 01480001
014900         10  PV-END-DATE1                 PIC  X(10).             01490001
015000         10  PV-END-TIME1                 PIC  X(16)  VALUE       01500001
015100                   '-23.59.59.999999'.                            01510001
015200     05  PV-END-TMST1 REDEFINES PV-END1    PIC  X(26).            01520001
015300                                                                  01530001
015400     05  PV-START2.                                               01540001
015500         10  PV-START-DATE2              PIC  X(10).              01550001
015600         10  PV-START-TIME2              PIC  X(16)  VALUE        01560001
015700                   '-00.00.00.000000'.                            01570001
015800     05  PV-START-TMST2 REDEFINES PV-START2 PIC X(26).            01580001
015900                                                                  01590001
016000     05  PV-END2.                                                 01600001
016100         10  PV-END-DATE2                 PIC  X(10).             01610001
016200         10  PV-END-TIME2                 PIC  X(16)  VALUE       01620001
016300                   '-23.59.59.999999'.                            01630001
016400     05  PV-END-TMST2 REDEFINES PV-END2    PIC  X(26).            01640001
016500     05  PV-EXPTED-EXT-RETAIL            PIC  S9(15)V99           01650001
016600                                                     COMP-3.      01660001
016700     05  PV-VERIFY-EXT-RETAIL            PIC  S9(15)V99           01670001
016800                                                     COMP-3.      01680001
016900     05  PV-AP-VERIFY-EXT-RETAIL         PIC  S9(15)V99           01690001
017000                                                     COMP-3.      01700001
017100     05  PV-DIFF-EXT-RETAIL              PIC  S9(15)V99           01710006
017200                                                     COMP-3.      01720006
017300     05  PV-EXPTED-ITM-QTY               PIC  S9(17) COMP-3.      01730001
017400     05  PV-VERIFY-ITM-QTY               PIC  S9(17) COMP-3.      01740001
017500     05  PV-AP-VERIFY-ITM-QTY            PIC  S9(17) COMP-3.      01750001
017600     05  PV-DIFF-ITM-QTY                 PIC  S9(17) COMP-3.      01760006
017700                                                                  01770001
017701     05  PV-FISCAL-YEAR                  PIC   X(04).             01770114
017702     05  PV-FISCAL-MONTH                 PIC   X(02).             01770214
017703                                                                  01770314
017704     05  PV-ENT-ID                       PIC  S9(09) COMP.        01770429
017705     05  PV-ENT-NAME                     PIC   X(30).             01770529
017706     05  PV-P12MN-SLSRNK-NBR             PIC  S9(04) COMP.        01770629
017707                                                                  01770729
017708 01  PV-ABEND-FIELDS.                                             01770829
017709     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         01770929
017710                                                 COMP SYNC.       01771029
017711     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'RCKUT116'.01771129
017712     05  PV-ABEND-OPERATION           PIC  X(51) VALUE SPACES.    01771229
017713     05  PV-ABEND-STRUCTURE-1         PIC  X(8)  VALUE SPACES.    01771329
017714     05  PV-ABEND-STRUCTURE-2         PIC  X(8)  VALUE SPACES.    01771429
017715     05  PV-ABEND-STRUCTURE-3         PIC  X(8)  VALUE SPACES.    01771529
017716     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01771629
017717     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01771729
017718     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01771829
017719                                                                  01771929
017720                                                                  01772029
017721 01  CC-CONTROL-CARD.                                             01772129
017722     05  CC-CONSTANT                 PIC  X(07)      VALUE SPACE. 01772229
017730     05  FILLER                      PIC  X(01)      VALUE SPACE. 01773011
017740     05  CC-OVERRIDE-IND             PIC  X(01).                  01774011
017750         88  CC-OVERRIDE-YES                         VALUE 'Y'.   01775011
017760         88  CC-OVERRIDE-NO                          VALUE 'N'.   01776011
017770     05  CC-FISCAL-YY                PIC  X(04).                  01777011
017780     05  CC-FISCAL-MM                PIC  X(02).                  01778011
017790     05  FILLER                      PIC  X(65)      VALUE SPACE. 01779011
017791                                                                  01779111
017800 01  PC-PROGRAM-CONSTANTS.                                        01780001
017900     05  PC-N                            PIC  X(01)  VALUE 'N'.   01790001
018000     05  PC-IP                           PIC  X(02)  VALUE 'IP'.  01800001
018100     05  PC-CM                           PIC  X(02)  VALUE 'CM'.  01810001
018200     05  PC-VE                           PIC  X(02)  VALUE 'VE'.  01820001
018300     05  PC-DC                           PIC  X(02)  VALUE 'DC'.  01830001
018400     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        01840001
018500         'RCKUT116'.                                              01850005
018600     05  PC-REPORT-NBR                   PIC  9(01)    VALUE 1.   01860001
018700     05  PC-PGM-DPKUT500                 PIC  X(08)  VALUE        01870001
018800         'DPKUT500'.                                              01880001
018900                                                                  01890001
019000 01  DK-DB2-KEYS.                                                 01900001
019100     05  DK-ORD-NBR                      PIC S9(09)  VALUE ZEROS  01910001
019200                                                     COMP.        01920001
019300     05  DK-ORD-LNE-NBR                  PIC S9(09)  VALUE ZEROS  01930001
019400                                                     COMP.        01940001
019500     05  DK-REC-SEQ-NBR                  PIC S9(09)  VALUE ZEROS  01950001
019600                                                     COMP.        01960001
019700     05  DK-VER-NBR                      PIC S9(09)  VALUE ZEROS  01970001
019800                                                     COMP.        01980001
019900     05  DK-APP-PL-LNE-NBR               PIC S9(04)  VALUE ZEROS  01990001
020000                                                     COMP.        02000001
020100                                                                  02010001
020200 01  PS-PROGRAM-SWITCHES.                                         02020001
020300     05  PS-END-OF-INPUT-SW              PIC  X(01)  VALUE 'N'.   02030001
020400         88  PS-END-OF-INPUT                         VALUE 'Y'.   02040001
020500     05  PS-GOOD-RECDIS-SW               PIC  X(01)  VALUE 'N'.   02050001
020600         88  PS-GOOD-RECDIS-READ                     VALUE 'Y'.   02060001
020700         88  PS-BAD-RECDIS-READ                      VALUE 'N'.   02070001
020800     05  PS-GOOD-PURITM-SW               PIC  X(01)  VALUE 'N'.   02080001
020900         88  PS-GOOD-PURITM-READ                     VALUE 'Y'.   02090001
021000         88  PS-BAD-PURITM-READ                      VALUE 'N'.   02100001
021100                                                                  02110001
021110******************************************************************02111013
021120*  COPY BOOK FOR INPUT RECORD                                     02112011
021130*                                                                 02113011
021140     COPY RCRD061.                                                02114031
021150                                                                  02115011
021160******************************************************************02116013
021170*  COPY BOOK FOR OUTPUT RECORD                                    02117011
021180*                                                                 02118011
021190     COPY RCRD062.                                                02119031
021191                                                                  02119111
021200*                                                                 02120001
021300*  COPY BOOK FOR DB2 FORMATTED MESSAGE AREA                       02130001
021400*                                                                 02140001
021500     COPY DPWS004.                                                02150031
021600                                                                  02160001
021700*                                                                 02170001
021800*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE RECEIVER           02180001
021900*  DISTRIBUTION TABLE                                             02190001
022000*                                                                 02200001
022100     EXEC SQL                                                     02210001
022200          INCLUDE TRECDIS                                         02220001
022300     END-EXEC.                                                    02230001
022400*                                                                 02240001
022500*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE PURCHASE ORDER     02250001
022600*  ITEM TABLE                                                     02260001
022700*                                                                 02270001
022800     EXEC SQL                                                     02280001
022900          INCLUDE TPURITM                                         02290001
023000     END-EXEC.                                                    02300001
023100                                                                  02310001
023110******************************************************************02311011
023120*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE COMPANY CONTROL    02312011
023130*  TABLE                                                          02313011
023140******************************************************************02314011
023150     EXEC SQL                                                     02315011
023160          INCLUDE TCOCNTL                                         02316011
023170     END-EXEC.                                                    02317011
023180*                                                                 02318011
023190******************************************************************02319011
023191*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE DATE ATTRIBUTE     02319111
023192*  TABLE                                                          02319211
023193******************************************************************02319311
023194     EXEC SQL                                                     02319411
023195          INCLUDE TDTATTR                                         02319511
023196     END-EXEC.                                                    02319611
023197*                                                                 02319711
023198******************************************************************02319824
023199*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE PURCHASE ORDER     02319924
023200*  TABLE                                                          02320024
023201******************************************************************02320124
023202     EXEC SQL                                                     02320224
023203          INCLUDE TPURCHS                                         02320324
023204     END-EXEC.                                                    02320424
023205*                                                                 02320524
023214******************************************************************02321424
023215*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE VENDOR NAME(ENTITY)02321524
023216*  TABLE                                                          02321624
023217******************************************************************02321724
023218     EXEC SQL                                                     02321824
023219          INCLUDE TENTNME                                         02321924
023220     END-EXEC.                                                    02322024
023221*                                                                 02322124
023222******************************************************************02322224
023223*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE VENDOR TABLE       02322324
023225******************************************************************02322524
023226     EXEC SQL                                                     02322624
023227          INCLUDE TEXTENT                                         02322724
023228     END-EXEC.                                                    02322824
023229*                                                                 02322924
023230******************************************************************02323024
023300*                                                                 02330001
023400*  COMMUNICATION AREAS FOR DB2                                    02340001
023500*                                                                 02350001
023600     EXEC SQL                                                     02360001
023700         INCLUDE SQLCA                                            02370001
023800     END-EXEC.                                                    02380001
023810*                                                                 02381011
023820     COPY SQLCA2.                                                 02382011
023900*                                                                 02390011
024100******************************************************************02410001
024200 PROCEDURE DIVISION.                                              02420001
024300******************************************************************02430001
024400                                                                  02440001
024500 0000-MAINLINE.                                                   02450001
024600                                                                  02460001
024700     OPEN INPUT  INPUT-FILE.                                      02470001
024800     OPEN OUTPUT OUTPUT-FILE.                                     02480001
024900                                                                  02490001
024910     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           02491014
024920     PERFORM 1100-VALIDATE-CONTROL-CARD.                          02492014
024930                                                                  02493014
025000     PERFORM 6000-READ-INPUT.                                     02500001
025100                                                                  02510001
025210     MOVE RC061-ORD-NBR   TO                                      02521013
025300          PV-PREV-ORD-NBR.                                        02530001
025410     MOVE RC061-REC-SEQ-NBR  TO                                   02541013
025500          PV-PREV-REC-SEQ-NBR.                                    02550001
025600     MOVE ZEROS                   TO                              02560001
025700          PV-EXPTED-EXT-RETAIL                                    02570001
025800          PV-VERIFY-EXT-RETAIL                                    02580001
025900          PV-AP-VERIFY-EXT-RETAIL                                 02590001
026000          PV-EXPTED-ITM-QTY                                       02600001
026100          PV-VERIFY-ITM-QTY                                       02610001
026200          PV-AP-VERIFY-ITM-QTY.                                   02620001
026300                                                                  02630001
026410     INITIALIZE RCRD062-RCVR-LNE-EXTRACT.                         02641014
026500                                                                  02650001
026701     MOVE RC061-ORD-NBR           TO                              02670113
026710          RC062-ORD-NBR                                           02671013
026800          DK-ORD-NBR.                                             02680001
026910     MOVE RC061-REC-SEQ-NBR       TO                              02691013
027010          RC062-REC-SEQ-NBR                                       02701013
027100          DK-REC-SEQ-NBR.                                         02710001
027200     MOVE PV-FISCAL-YEAR          TO                              02720014
027210          RC062-FISCAL-YYYY                                       02721014
027300     MOVE PV-FISCAL-MONTH         TO                              02730014
027301          RC062-FISCAL-MM                                         02730114
027310     MOVE RC061-OPER-UNT-ID       TO                              02731013
027320          RC062-OPER-UNT-ID.                                      02732013
027400*    MOVE IR-PACK-BY-ST-IND       TO                              02740013
027500*         OR-PACK-BY-ST-IND.                                      02750013
027510*    MOVE RC061-PACK-BY-ST-IND    TO                              02751014
027520*         RC062-PACK-BY-ST-IND.                                   02752014
027530                                                                  02753014
027610     IF  RC061-PACK-BY-ST-IND = 'Y'                               02761013
027700         MOVE 'Z' TO RC062-PKGNG-CDE                              02770014
027800     ELSE                                                         02780001
028010         MOVE RC061-PKGNG-CDE         TO                          02801013
028020              RC062-PKGNG-CDE                                     02802013
028100     END-IF.                                                      02810001
028310     MOVE RC061-EXPTED-CART-CNT   TO                              02831013
028320          RC062-EXPTED-CART-CNT.                                  02832014
028510     MOVE RC061-ACTL-CART-CNT     TO                              02851013
028520          RC062-ACTL-CART-CNT.                                    02852013
028601                                                                  02860114
028610     MOVE RC061-VERFYD-DATE       TO                              02861018
028700          PV-TMST.                                                02870019
028820                                                                  02882014
028900     MOVE PV-TMST-DATE-YY         TO                              02890001
029010          RC062-VERFYD-DATE-YYYY.                                 02901013
029100     MOVE PV-TMST-DATE-MM         TO                              02910001
029210          RC062-VERFYD-DATE-MM.                                   02921013
029300     MOVE PV-TMST-DATE-DD         TO                              02930001
029410          RC062-VERFYD-DATE-DD.                                   02941013
029500     MOVE '-'                     TO                              02950001
029710          RC062-VERFYD-DATE-DASH1                                 02971013
029720          RC062-VERFYD-DATE-DASH2.                                02972014
029910     MOVE RC061-CRE-OPER-UNT-ID   TO                              02991013
029920          RC062-CRE-OPER-UNT-ID.                                  02992013
030110     MOVE RC061-CURR-OPER-UNT-ID TO                               03011013
030120          RC062-CURR-OPER-UNT-ID.                                 03012013
030200     MOVE +1                  TO                                  03020006
030310          RC062-NBR-RCVR.                                         03031014
030610     SUBTRACT RC061-EXPTED-CART-CNT FROM                          03061013
030620              RC061-ACTL-CART-CNT GIVING                          03062013
030630              RC062-DIFF-CART-CNT.                                03063013
030710     IF  RC062-DIFF-CART-CNT < 0                                  03071013
030800         MOVE +1              TO                                  03080006
030910              RC062-NBR-RCVR-SHRT-CRTNS                           03091014
031000     ELSE                                                         03100006
031110         IF  RC062-DIFF-CART-CNT > 0                              03111013
031200             MOVE +1              TO                              03120006
031310               RC062-NBR-RCVR-OVR-CRTNS                           03131014
031400         END-IF                                                   03140006
031500     END-IF.                                                      03150006
031510     PERFORM 7500-SELECT-TPURCHS.                                 03151028
031520     MOVE PV-ENT-ID           TO RC062-ENT-ID.                    03152029
031530     MOVE PV-ENT-NAME         TO RC062-ENT-NAME.                  03153029
031540     MOVE PV-P12MN-SLSRNK-NBR TO RC062-P12MN-SLSRNK-NBR.          03154029
031600                                                                  03160001
031700     PERFORM 2200-PROCESS-FILE                                    03170001
031800       UNTIL  PS-END-OF-INPUT.                                    03180001
031900                                                                  03190002
031921     IF  RC062-DIFF-ITM-QTY < 0                                   03192113
031922         MOVE +1 TO RC062-NBR-RCVR-SHRT-UNITS                     03192214
031930     ELSE                                                         03193006
031951         IF  RC062-DIFF-ITM-QTY > 0                               03195114
031952             MOVE +1 TO RC062-NBR-RCVR-OVR-UNITS                  03195214
031960         END-IF                                                   03196006
031970     END-IF.                                                      03197006
031991     IF  RC062-DIFF-EXT-RETAIL < 0                                03199114
031992         MOVE +1 TO RC062-NBR-RCVR-SHRT-RTL                       03199214
031993     ELSE                                                         03199314
031996         IF  RC062-DIFF-EXT-RETAIL > 0                            03199614
031997             MOVE +1 TO RC062-NBR-RCVR-OVR-RTL                    03199714
031998         END-IF                                                   03199814
031999     END-IF.                                                      03199914
032000                                                                  03200030
032001     PERFORM 7500-SELECT-TPURCHS.                                 03200130
032010     MOVE PV-ENT-ID           TO RC062-ENT-ID.                    03201030
032020     MOVE PV-ENT-NAME         TO RC062-ENT-NAME.                  03202030
032030     MOVE PV-P12MN-SLSRNK-NBR TO RC062-P12MN-SLSRNK-NBR.          03203030
032040                                                                  03204030
032100     WRITE OUTPUT-RECORD                                          03210002
032110      FROM RCRD062-RCVR-LNE-EXTRACT.                              03211014
032200     ADD +1 TO PV-NUMBER-WRITES                                   03220002
032300               PV-NUMBER-WRITES-DISP.                             03230002
032400                                                                  03240001
032500     MOVE PV-NUMBER-READS  TO                                     03250001
032600          PV-DISPLAY-FIELD.                                       03260001
032700                                                                  03270001
032800     DISPLAY 'NUMBER OF RECORDS READ:  ' PV-DISPLAY-FIELD.        03280001
032900                                                                  03290001
033000     MOVE PV-NUMBER-WRITES TO                                     03300001
033100          PV-DISPLAY-FIELD.                                       03310001
033200                                                                  03320001
033300     DISPLAY 'NUMBER OF RECORDS WRITTEN:  ' PV-DISPLAY-FIELD.     03330001
033400                                                                  03340001
033410     MOVE PV-VENDOR-ROW-NOT-FOUND TO                              03341023
033420          PV-DISPLAY-FIELD.                                       03342023
033430                                                                  03343023
033440     DISPLAY 'NUMBER VENDOR ROWS NOT FOUND: ' PV-DISPLAY-FIELD.   03344023
033450                                                                  03345023
033500     CLOSE INPUT-FILE                                             03350001
033600           OUTPUT-FILE.                                           03360001
033700                                                                  03370001
033800     GOBACK.                                                      03380001
033900                                                                  03390001
033910******************************************************************03391014
033920*  VALIDATE THE CONTROL CARD.                                     03392014
033930******************************************************************03393014
033940 1100-VALIDATE-CONTROL-CARD.                                      03394014
033950     IF  CC-CONSTANT = 'CONTROL'                                  03395014
033960         CONTINUE                                                 03396014
033970     ELSE                                                         03397014
033980         DISPLAY '** ABEND **'                                    03398014
033990         DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME     03399014
033991         DISPLAY '** PARAGRAPH ** = 1100-VALIDATE-CONTROL-CARD'   03399114
033992         DISPLAY '** CONTROL CONSTANT INVALID'                    03399214
033993         DISPLAY '** CONTROL CONSTANT = ' CC-CONSTANT             03399314
033994         DISPLAY '** CHANGE TO CONTROL'                           03399414
033995         MOVE +4003              TO ABEND-CODE                    03399514
033996         CALL 'ILBOABN0' USING ABEND-CODE                         03399614
033997     END-IF.                                                      03399714
033998                                                                  03399814
033999     IF  CC-OVERRIDE-NO                                           03399914
034000         PERFORM 7200-SELECT-TCOCNTL                              03400014
034001         PERFORM 7300-SELECT-TDTATTR                              03400114
034002     ELSE                                                         03400214
034003         PERFORM 7400-SELECT-TDTATTR.                             03400314
034004                                                                  03400414
034005     DISPLAY '** FISCAL YEAR = ' PV-FISCAL-YEAR                   03400514
034006     DISPLAY '** FISCAL MONTH = ' PV-FISCAL-MONTH.                03400614
034021                                                                  03402114
034030 2200-PROCESS-FILE.                                               03403001
034100                                                                  03410001
034210     IF  PV-PREV-ORD-NBR IS EQUAL TO RC061-ORD-NBR                03421014
034310     AND PV-PREV-REC-SEQ-NBR IS EQUAL TO RC061-REC-SEQ-NBR        03431014
034410         MOVE RC061-ORD-LNE-NBR       TO                          03441014
034500              DK-ORD-LNE-NBR                                      03450001
034600              DK-APP-PL-LNE-NBR                                   03460001
034710         MOVE RC061-PO-VER-NBR        TO                          03471014
034800              DK-VER-NBR                                          03480001
034900         PERFORM 2300-PROCESS-RECORD                              03490001
035000         PERFORM 6000-READ-INPUT                                  03500001
035100     ELSE                                                         03510001
035112         IF  RC062-DIFF-ITM-QTY < 0                               03511214
035120             MOVE +1 TO RC062-NBR-RCVR-SHRT-UNITS                 03512014
035130         ELSE                                                     03513006
035151             IF  RC062-DIFF-ITM-QTY > 0                           03515114
035152                 MOVE +1 TO RC062-NBR-RCVR-OVR-UNITS              03515214
035160             END-IF                                               03516006
035170         END-IF                                                   03517006
035191         IF  RC062-DIFF-EXT-RETAIL < 0                            03519114
035192             MOVE +1 TO RC062-NBR-RCVR-SHRT-RTL                   03519214
035193         ELSE                                                     03519314
035196             IF  RC062-DIFF-EXT-RETAIL > 0                        03519614
035197                 MOVE +1 TO RC062-NBR-RCVR-OVR-RTL                03519714
035198             END-IF                                               03519814
035199         END-IF                                                   03519914
035300         WRITE OUTPUT-RECORD                                      03530001
035310          FROM RCRD062-RCVR-LNE-EXTRACT                           03531014
035400         ADD +1 TO PV-NUMBER-WRITES                               03540001
035500                   PV-NUMBER-WRITES-DISP                          03550001
035600         IF  PV-NUMBER-WRITES-DISP > 9999                         03560001
035700             MOVE PV-NUMBER-WRITES TO                             03570001
035800                  PV-DISPLAY-FIELD                                03580001
035900             DISPLAY 'NUMBER OF RECORDS WRITTEN:  '               03590001
036000                      PV-DISPLAY-FIELD                            03600001
036100             MOVE ZEROS TO PV-NUMBER-WRITES-DISP                  03610001
036200         END-IF                                                   03620001
036300         INITIALIZE RCRD062-RCVR-LNE-EXTRACT                      03630028
036301         IF  PV-PREV-ORD-NBR IS EQUAL TO RC061-ORD-NBR            03630128
036302            CONTINUE                                              03630228
036303         ELSE                                                     03630328
036304            PERFORM 7500-SELECT-TPURCHS                           03630428
036305         END-IF                                                   03630528
036310         MOVE PV-ENT-ID           TO RC062-ENT-ID                 03631029
036311         MOVE PV-ENT-NAME         TO RC062-ENT-NAME               03631129
036312         MOVE PV-P12MN-SLSRNK-NBR TO RC062-P12MN-SLSRNK-NBR       03631229
036313                                                                  03631329
036320         MOVE RC061-ORD-NBR   TO                                  03632029
036400              PV-PREV-ORD-NBR                                     03640001
036510         MOVE RC061-REC-SEQ-NBR  TO                               03651014
036600              PV-PREV-REC-SEQ-NBR                                 03660001
036700         MOVE ZEROS                   TO                          03670001
036800              PV-EXPTED-EXT-RETAIL                                03680001
036900              PV-VERIFY-EXT-RETAIL                                03690001
037000              PV-AP-VERIFY-EXT-RETAIL                             03700001
037100              PV-EXPTED-ITM-QTY                                   03710001
037200              PV-VERIFY-ITM-QTY                                   03720001
037300              PV-AP-VERIFY-ITM-QTY                                03730001
037610         MOVE RC061-ORD-NBR           TO                          03761014
037620              RC062-ORD-NBR                                       03762014
037700              DK-ORD-NBR                                          03770004
037910         MOVE RC061-REC-SEQ-NBR       TO                          03791014
037920              RC062-REC-SEQ-NBR                                   03792014
038000              DK-REC-SEQ-NBR                                      03800001
038010         MOVE PV-FISCAL-YEAR          TO                          03801014
038020              RC062-FISCAL-YYYY                                   03802014
038030         MOVE PV-FISCAL-MONTH         TO                          03803014
038040              RC062-FISCAL-MM                                     03804014
038210         MOVE RC061-OPER-UNT-ID       TO                          03821014
038220              RC062-OPER-UNT-ID                                   03822014
038430                                                                  03843014
038610         IF  RC061-PACK-BY-ST-IND = 'Y'                           03861014
038620             MOVE 'Z' TO RC062-PKGNG-CDE                          03862014
038700         ELSE                                                     03870001
038910             MOVE RC061-PKGNG-CDE         TO                      03891014
038920                  RC062-PKGNG-CDE                                 03892014
039000         END-IF                                                   03900001
039210         MOVE RC061-EXPTED-CART-CNT   TO                          03921014
039220              RC062-EXPTED-CART-CNT                               03922014
039410         MOVE RC061-ACTL-CART-CNT     TO                          03941014
039420              RC062-ACTL-CART-CNT                                 03942014
039701                                                                  03970114
039710         MOVE RC061-VERFYD-DATE       TO                          03971018
039720              PV-TMST                                             03972018
039740                                                                  03974014
039800         MOVE PV-TMST-DATE-YY         TO                          03980014
039920              RC062-VERFYD-DATE-YYYY                              03992014
040000         MOVE PV-TMST-DATE-MM         TO                          04000014
040120              RC062-VERFYD-DATE-MM                                04012014
040200         MOVE PV-TMST-DATE-DD         TO                          04020001
040310              RC062-VERFYD-DATE-DD                                04031014
040400         MOVE '-'                     TO                          04040001
040610              RC062-VERFYD-DATE-DASH1                             04061014
040620              RC062-VERFYD-DATE-DASH2                             04062014
040810         MOVE RC061-CRE-OPER-UNT-ID      TO                       04081014
040820              RC062-CRE-OPER-UNT-ID                               04082014
041010         MOVE RC061-CURR-OPER-UNT-ID TO                           04101014
041020              RC062-CURR-OPER-UNT-ID                              04102014
041100         MOVE +1                  TO                              04110006
041210              RC062-NBR-RCVR                                      04121014
041510         SUBTRACT RC061-EXPTED-CART-CNT FROM                      04151014
041520                  RC061-ACTL-CART-CNT GIVING                      04152014
041530                  RC062-DIFF-CART-CNT                             04153014
041610         IF  RC062-DIFF-CART-CNT < 0                              04161014
041700             MOVE +1              TO                              04170006
041810                  RC062-NBR-RCVR-SHRT-CRTNS                       04181014
041900         ELSE                                                     04190006
042010             IF  RC062-DIFF-CART-CNT > 0                          04201014
042100                 MOVE +1              TO                          04210006
042210                      RC062-NBR-RCVR-OVR-CRTNS                    04221014
042300             END-IF                                               04230006
042400         END-IF                                                   04240006
042500     END-IF.                                                      04250001
042600                                                                  04260001
042700                                                                  04270001
042800******************************************************************04280001
042900*  GETS THE UNITS AND EXTENDED RETAIL VALUE FOR EACH OF THE       04290001
043000*  PO RECEIVER LINES                                              04300001
043100******************************************************************04310001
043200 2300-PROCESS-RECORD.                                             04320001
043300                                                                  04330001
043400     SET PS-BAD-RECDIS-READ TO TRUE.                              04340001
043500     SET PS-BAD-PURITM-READ TO TRUE.                              04350001
043600                                                                  04360001
043700     PERFORM 3000-SUM-RECDIS.                                     04370001
043800                                                                  04380001
043900     PERFORM 3100-GET-RETAIL.                                     04390001
044000                                                                  04400002
044100     COMPUTE PV-EXPTED-EXT-RETAIL =                               04410002
044200             RECDIS-EXPTED-ITM-QTY *                              04420002
044300             PURITM-UNT-RTL-PR-AMT.                               04430002
044400     ADD PV-EXPTED-EXT-RETAIL TO                                  04440002
044510         RC062-EXPTED-EXT-RETAIL.                                 04451014
044600     COMPUTE PV-VERIFY-EXT-RETAIL =                               04460002
044700             RECDIS-VERIFY-ITM-QTY *                              04470002
044800             PURITM-UNT-RTL-PR-AMT.                               04480002
044900     ADD PV-VERIFY-EXT-RETAIL TO                                  04490002
045010         RC062-VERIFY-EXT-RETAIL.                                 04501014
045100     COMPUTE PV-AP-VERIFY-EXT-RETAIL =                            04510002
045200             RECDIS-AP-VERIFY-ITM-QTY *                           04520002
045300             PURITM-UNT-RTL-PR-AMT.                               04530002
045400     ADD PV-AP-VERIFY-EXT-RETAIL TO                               04540002
045510         RC062-AP-VERIFY-EXT-RETAIL.                              04551014
045600     ADD RECDIS-EXPTED-ITM-QTY TO                                 04560002
045710         RC062-EXPTED-ITM-QTY.                                    04571014
045800     ADD RECDIS-VERIFY-ITM-QTY TO                                 04580002
045910         RC062-VERIFY-ITM-QTY.                                    04591014
046000     ADD RECDIS-AP-VERIFY-ITM-QTY TO                              04600002
046110         RC062-AP-VERIFY-ITM-QTY.                                 04611014
046210     ADD +1 TO RC062-NBR-LINE.                                    04621014
046300     SUBTRACT PV-EXPTED-EXT-RETAIL FROM                           04630006
046400              PV-AP-VERIFY-EXT-RETAIL GIVING                      04640006
046500              PV-DIFF-EXT-RETAIL.                                 04650006
046510     ADD PV-DIFF-EXT-RETAIL TO                                    04651006
046530         RC062-DIFF-EXT-RETAIL.                                   04653014
046600     IF  PV-DIFF-EXT-RETAIL < 0                                   04660006
046710         ADD +1 TO RC062-NBR-LINE-VRFY-RTL-SHRT                   04671014
046800     ELSE                                                         04680006
046900         IF  PV-DIFF-EXT-RETAIL > 0                               04690006
047010             ADD +1 TO RC062-NBR-LINE-VRFY-RTL-OVR                04701014
047100         END-IF                                                   04710006
047200     END-IF.                                                      04720006
047300     SUBTRACT RECDIS-EXPTED-ITM-QTY FROM                          04730006
047400              RECDIS-AP-VERIFY-ITM-QTY GIVING                     04740006
047500              PV-DIFF-ITM-QTY.                                    04750006
047501     ADD PV-DIFF-ITM-QTY TO                                       04750106
047504         RC062-DIFF-ITM-QTY.                                      04750414
047510     IF  PV-DIFF-ITM-QTY < 0                                      04751006
047521         ADD +1 TO RC062-NBR-LINE-SHRT-UNITS                      04752114
047530     ELSE                                                         04753006
047540         IF  PV-DIFF-ITM-QTY > 0                                  04754006
047551             ADD +1 TO RC062-NBR-LINE-OVR-UNITS                   04755114
047560         END-IF                                                   04756006
047570     END-IF.                                                      04757006
047600                                                                  04760006
047700 3000-SUM-RECDIS.                                                 04770006
047800                                                                  04780001
047900     MOVE '3000-SUM-RECDIS'                                       04790001
048000         TO PV-ABEND-PARAGRAPH.                                   04800001
048100     MOVE 'SELECT THE TRECDIS TABLE'                              04810001
048200         TO PV-DB2-OPERATION-ATTEMPTED.                           04820001
048210                                                                  04821007
048220     INITIALIZE RECDIS-EXPTED-ITM-QTY                             04822007
048230                RECDIS-VERIFY-ITM-QTY                             04823007
048240                RECDIS-AP-VERIFY-ITM-QTY.                         04824007
048300                                                                  04830001
048400     EXEC SQL                                                     04840001
048500          SELECT SUM(EXPTED_ITM_QTY)                              04850001
048600               , SUM(VERIFY_ITM_QTY)                              04860001
048700               , SUM(AP_VERIFY_ITM_QTY)                           04870001
048800           INTO  :RECDIS-EXPTED-ITM-QTY    :PV-NULL-IND-1,        04880007
048900                 :RECDIS-VERIFY-ITM-QTY    :PV-NULL-IND-2,        04890007
049000                 :RECDIS-AP-VERIFY-ITM-QTY :PV-NULL-IND-3         04900007
049100            FROM TRECDIS                                          04910001
049200           WHERE ORD_NBR             = :DK-ORD-NBR                04920001
049300             AND ORD_LNE_NBR         = :DK-ORD-LNE-NBR            04930001
049400             AND REC_SEQ_NBR         = :DK-REC-SEQ-NBR            04940001
049500           WITH UR                                                04950002
049600     END-EXEC.                                                    04960001
049700                                                                  04970001
049800     EVALUATE TRUE                                                04980001
049900         WHEN SQLCODE = ZERO                                      04990001
050000             SET PS-GOOD-RECDIS-READ TO TRUE                      05000002
050100         WHEN SQLCODE = +100                                      05010001
050200             SET PS-GOOD-RECDIS-READ TO TRUE                      05020002
050300             MOVE ZEROS TO RECDIS-EXPTED-ITM-QTY                  05030001
050400                           RECDIS-VERIFY-ITM-QTY                  05040001
050500                           RECDIS-AP-VERIFY-ITM-QTY               05050001
050600         WHEN SQLWARN0 NOT = SPACE                                05060001
050700         WHEN SQLCODE < ZERO                                      05070001
050800         WHEN SQLCODE > ZERO                                      05080001
050900             PERFORM 9100-SQL-ABEND                               05090001
051000     END-EVALUATE.                                                05100001
051100                                                                  05110001
051200 3100-GET-RETAIL.                                                 05120001
051300                                                                  05130001
051400     MOVE '3100-GET-RETAIL'                                       05140001
051500         TO PV-ABEND-PARAGRAPH.                                   05150001
051600     MOVE 'SELECT THE TPURITM TABLE'                              05160001
051700         TO PV-DB2-OPERATION-ATTEMPTED.                           05170001
051800                                                                  05180001
051900     EXEC SQL                                                     05190001
052000          SELECT UNT_RTL_PR_AMT                                   05200002
052100           INTO  :PURITM-UNT-RTL-PR-AMT                           05210002
052200          FROM TPURITM                                            05220002
052300          WHERE PO_NBR         = :DK-ORD-NBR                      05230004
052400            AND APP_PO_LNE_NBR = :DK-APP-PL-LNE-NBR               05240004
052500            AND VER_NBR        = :DK-VER-NBR                      05250004
052600           WITH UR                                                05260002
052700     END-EXEC.                                                    05270001
052800                                                                  05280001
052900     EVALUATE TRUE                                                05290001
053000         WHEN SQLCODE = ZERO                                      05300001
053100             SET PS-GOOD-PURITM-READ TO TRUE                      05310002
053200         WHEN SQLCODE = +100                                      05320001
053300             SET PS-GOOD-PURITM-READ TO TRUE                      05330002
053400             MOVE ZEROS TO PURITM-UNT-RTL-PR-AMT                  05340002
053500         WHEN SQLWARN0 NOT = SPACE                                05350001
053600         WHEN SQLCODE < ZERO                                      05360001
053700         WHEN SQLCODE > ZERO                                      05370001
053800             PERFORM 9100-SQL-ABEND                               05380001
053900     END-EVALUATE.                                                05390001
054000                                                                  05400001
054100                                                                  05410001
054200 6000-READ-INPUT.                                                 05420001
054300                                                                  05430001
054400*    READ INPUT-FILE INTO IR-INPUT-RECORD                         05440013
054410     READ INPUT-FILE INTO RCRD061-RCVR-LNE-EXTRACT                05441013
054500         AT END                                                   05450001
054600            SET PS-END-OF-INPUT TO TRUE.                          05460001
054700                                                                  05470002
054800     IF  PS-END-OF-INPUT                                          05480002
054900         CONTINUE                                                 05490002
055000     ELSE                                                         05500002
055100         ADD +1 TO PV-NUMBER-READS                                05510002
055200                   PV-NUMBER-READS-DISP                           05520002
055300         IF  PV-NUMBER-READS-DISP > 150000                        05530002
055400             MOVE PV-NUMBER-READS TO                              05540002
055500                  PV-DISPLAY-FIELD                                05550002
055600             DISPLAY 'NUMBER OF RECORDS READ:  '                  05560002
055700                      PV-DISPLAY-FIELD                            05570002
055800             MOVE ZEROS TO PV-NUMBER-READS-DISP                   05580004
055900         END-IF                                                   05590002
056000     END-IF.                                                      05600002
056100                                                                  05610001
056101******************************************************************05610114
056102 7200-SELECT-TCOCNTL.                                             05610214
056103******************************************************************05610314
056104*                                                                 05610414
056105     EXEC SQL                                                     05610514
056106         SELECT                                                   05610614
056107                (BTCH_PRC_DTE - 14 DAYS)                          05610714
056108         INTO  :COCNTL-BTCH-PRC-DTE                               05610814
056109         FROM TCOCNTL                                             05610914
056110         WHERE OPER_UNT_ID = 90                                   05611014
056111     END-EXEC.                                                    05611114
056112                                                                  05611214
056113     EVALUATE TRUE                                                05611314
056114         WHEN SQLCODE = +0                                        05611414
056115         WHEN SQLCODE = +100                                      05611514
056116         WHEN SQLCODE = -811                                      05611614
056117             CONTINUE                                             05611714
056118         WHEN SQLCODE < ZERO                                      05611814
056119             MOVE '7200-SELECT-TCOCNTL'                           05611914
056120                                     TO PV-ABEND-PARAGRAPH        05612014
056121             MOVE 'SELECT'         TO PV-DB2-OPERATION-ATTEMPTED  05612114
056122             PERFORM 9100-SQL-ABEND                               05612214
056123         WHEN SQLCODE > ZERO                                      05612314
056124         WHEN SQLWARN0 NOT = SPACES                               05612414
056125             MOVE '7200-SELECT-TCOCNTL'                           05612514
056126                                      TO PV-ABEND-PARAGRAPH       05612614
056127             MOVE 'SELECT'         TO PV-DB2-OPERATION-ATTEMPTED  05612714
056128             PERFORM 9300-SQL-WARNING                             05612814
056129     END-EVALUATE.                                                05612914
056130/                                                                 05613014
056131******************************************************************05613114
056132 7300-SELECT-TDTATTR.                                             05613214
056133******************************************************************05613314
056134*                                                                 05613414
056135     EXEC SQL                                                     05613514
056136         SELECT                                                   05613614
056137                 FSCL_YR_NBR                                      05613714
056138               , FSCL_MN_NBR                                      05613814
056139               , FSCL_MN_BEG_DTE                                  05613914
056140               , FSCL_MN_END_DTE                                  05614014
056141               , FSCL_MN_BEG_DTE - 1 DAY                          05614114
056142               , FSCL_MN_END_DTE + 1 DAY                          05614214
056143         INTO   :PV-FISCAL-YEAR                                   05614314
056144               ,:PV-FISCAL-MONTH                                  05614414
056145               ,:DTATTR-FSCL-MN-BEG-DTE                           05614514
056146               ,:DTATTR-FSCL-MN-END-DTE                           05614614
056147               ,:PV-START-DATE2                                   05614714
056148               ,:PV-END-DATE2                                     05614814
056149         FROM TDTATTR                                             05614914
056150         WHERE KY_DTE  = :COCNTL-BTCH-PRC-DTE                     05615014
056151     END-EXEC.                                                    05615114
056152                                                                  05615214
056153     EVALUATE TRUE                                                05615314
056154         WHEN SQLCODE = +0                                        05615414
056155             CONTINUE                                             05615514
056156         WHEN SQLCODE = +100                                      05615614
056157         WHEN SQLCODE = -811                                      05615714
056158         WHEN SQLCODE < ZERO                                      05615814
056159             MOVE '7300-SELECT-TDTATTR'                           05615914
056160                                      TO PV-ABEND-PARAGRAPH       05616014
056161             MOVE 'SELECT'          TO PV-DB2-OPERATION-ATTEMPTED 05616114
056162             PERFORM 9100-SQL-ABEND                               05616214
056163         WHEN SQLCODE > ZERO                                      05616314
056164         WHEN SQLWARN0 NOT = SPACES                               05616414
056165             MOVE '7300-SELECT-TDTATTR'                           05616514
056166                                      TO PV-ABEND-PARAGRAPH       05616614
056167             MOVE 'SELECT'          TO PV-DB2-OPERATION-ATTEMPTED 05616714
056168             PERFORM 9300-SQL-WARNING                             05616814
056169     END-EVALUATE.                                                05616914
056170/                                                                 05617014
056171******************************************************************05617114
056172 7400-SELECT-TDTATTR.                                             05617214
056173******************************************************************05617314
056174*                                                                 05617414
056175     EXEC SQL                                                     05617514
056176         SELECT                                                   05617614
056177                 FSCL_MN_BEG_DTE                                  05617714
056178               , FSCL_MN_END_DTE                                  05617814
056179               , FSCL_MN_BEG_DTE - 1 DAY                          05617914
056180               , FSCL_MN_END_DTE + 1 DAY                          05618014
056181         INTO   :DTATTR-FSCL-MN-BEG-DTE                           05618114
056182               ,:DTATTR-FSCL-MN-END-DTE                           05618214
056183               ,:PV-START-DATE2                                   05618314
056184               ,:PV-END-DATE2                                     05618414
056185         FROM TDTATTR                                             05618514
056186         WHERE FSCL_YR_NBR = :CC-FISCAL-YY                        05618614
056187           AND FSCL_MN_NBR = :CC-FISCAL-MM                        05618714
056188     END-EXEC.                                                    05618814
056189                                                                  05618914
056190     EVALUATE TRUE                                                05619014
056191         WHEN SQLCODE = +0                                        05619114
056192         WHEN SQLCODE = -811                                      05619220
056193             MOVE CC-FISCAL-YY      TO  PV-FISCAL-YEAR            05619320
056194             MOVE CC-FISCAL-MM      TO  PV-FISCAL-MONTH           05619420
056195         WHEN SQLCODE = +100                                      05619520
056196             MOVE '7400-SELECT-TDTATTR'                           05619620
056197                                      TO PV-ABEND-PARAGRAPH       05619720
056198             MOVE 'BAD CONTROL CARD' TO PV-DB2-OPERATION-ATTEMPTED05619820
056199             PERFORM 9100-SQL-ABEND                               05619920
056200         WHEN SQLCODE < ZERO                                      05620020
056201             MOVE '7400-SELECT-TDTATTR'                           05620120
056202                                      TO PV-ABEND-PARAGRAPH       05620220
056203             MOVE 'SELECT'           TO PV-DB2-OPERATION-ATTEMPTED05620320
056204             PERFORM 9100-SQL-ABEND                               05620420
056205         WHEN SQLCODE > ZERO                                      05620520
056206         WHEN SQLWARN0 NOT = SPACES                               05620620
056207             MOVE '7400-SELECT-TDTATTR'                           05620720
056208                                      TO PV-ABEND-PARAGRAPH       05620820
056209             MOVE 'SELECT'           TO PV-DB2-OPERATION-ATTEMPTED05620920
056210             PERFORM 9300-SQL-WARNING                             05621020
056211     END-EVALUATE.                                                05621120
056212/                                                                 05621220
056213******************************************************************05621322
056214 7500-SELECT-TPURCHS.                                             05621422
056215******************************************************************05621522
056216*                                                                 05621622
056217     EXEC SQL                                                     05621722
056218         SELECT                                                   05621822
056219                 A.ENT_ID                                         05621922
056220               , B.ENT_NAME_DESC                                  05622022
056221               , C.P12MN_SLSRNK_NBR                               05622122
056225         INTO   :PURCHS-ENT-ID                                    05622522
056226               ,:ENTNME-ENT-NAME-DESC                             05622622
056227               ,:EXTENT-P12MN-SLSRNK-NBR                          05622722
056231         FROM TPURCHS A                                           05623122
056232            , TENTNME B                                           05623222
056233            , TEXTENT C                                           05623322
056235         WHERE A.PO_NBR     =  :RC061-ORD-NBR                     05623528
056236           AND A.VER_STATUS_CDE = 'A'                             05623627
056237           AND A.ENT_ID     = B.ENT_ID                            05623727
056238           AND B.TYPE_CDE   = '01'                                05623827
056239           AND A.ENT_ID     = C.ENT_ID                            05623927
056240     END-EXEC.                                                    05624027
056241                                                                  05624127
056242     EVALUATE TRUE                                                05624227
056243         WHEN SQLCODE = +0                                        05624327
056244             MOVE PURCHS-ENT-ID        TO PV-ENT-ID               05624429
056245             MOVE ENTNME-ENT-NAME-DESC TO PV-ENT-NAME             05624529
056246             MOVE EXTENT-P12MN-SLSRNK-NBR                         05624627
056247                                       TO PV-P12MN-SLSRNK-NBR     05624729
056248         WHEN SQLCODE = +100                                      05624827
056249             MOVE ZERO                 TO PV-ENT-ID               05624929
056250             MOVE 'UNKNOWN'            TO PV-ENT-NAME             05625029
056251             MOVE ZERO                 TO PV-P12MN-SLSRNK-NBR     05625129
056252             ADD +1                    TO PV-VENDOR-ROW-NOT-FOUND 05625227
056253         WHEN SQLCODE < ZERO                                      05625322
056254             MOVE '7500-SELECT-TPURCHS'                           05625423
056255                                      TO PV-ABEND-PARAGRAPH       05625522
056256             MOVE 'SELECT'          TO PV-DB2-OPERATION-ATTEMPTED 05625622
056257             PERFORM 9100-SQL-ABEND                               05625722
056258         WHEN SQLCODE > ZERO                                      05625822
056259         WHEN SQLWARN0 NOT = SPACES                               05625922
056260             MOVE '7500-SELECT-TPURCHS'                           05626023
056261                                      TO PV-ABEND-PARAGRAPH       05626122
056262             MOVE 'SELECT'          TO PV-DB2-OPERATION-ATTEMPTED 05626222
056263             PERFORM 9300-SQL-WARNING                             05626322
056264     END-EVALUATE.                                                05626422
056265/                                                                 05626522
056266                                                                  05626622
056270 9100-SQL-ABEND.                                                  05627022
056300******************************************************************05630001
056400*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    05640001
056500*  ERROR OR WARNING CODE OCCURS.                                  05650001
056600******************************************************************05660001
056700     DISPLAY '9100-SQL-ABEND'.                                    05670001
056800     DISPLAY '** ABEND     **'.                                   05680001
056900     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        05690001
057000     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             05700001
057100     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     05710001
057200                                                                  05720001
057300******************************************************************05730001
057400* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    05740001
057500* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         05750001
057600* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     05760001
057700* FORMAT.                                                         05770001
057800******************************************************************05780001
057900     COPY DPPD004.                                                05790031
058000                                                                  05800001
058100     MOVE +4013                  TO ABEND-CODE.                   05810001
058200     CALL 'ILBOABN0' USING ABEND-CODE.                            05820001
058300*9100-EXIT.                                                       05830001
058400                                                                  05840001
058500******************************************************************05850014
058600 9300-SQL-WARNING.                                                05860014
058700******************************************************************05870014
058800                                                                  05880014
058900     DISPLAY '9300-SQL-WARNING'.                                  05890014
059000     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        05900014
059100     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             05910014
059200     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED      05920014
059300                                                                  05930014
059400     MOVE SQLCODE                     TO SQLCODE2.                05940014
059500     MOVE SQLERRD(3)                  TO SQLERRD3.                05950014
059600     DISPLAY '** ABEND **       ** = SQLWARNING'.                 05960014
059700     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  05970014
059800     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  05980014
059900     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                  05990014
060000     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                  06000014
060100     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                  06010014
060200     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                  06020014
060300     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                  06030014
060400     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                  06040014
060500     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                  06050014
060600     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                  06060014
060700                                                                  06070014
060800     MOVE +4013                       TO PV-ABEND-CODE.           06080014
060900     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         06090014
061000*                                                                 06100014
