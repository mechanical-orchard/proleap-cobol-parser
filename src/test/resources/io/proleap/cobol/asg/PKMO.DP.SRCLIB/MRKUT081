000100*************************                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*************************                                         00030000
000400 PROGRAM-ID.      MRKUT081.                                       00040000
000500 AUTHOR.          JO ELLEN UHRMAN.                                00050000
000600 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00060000
000700 DATE-WRITTEN.    03/18/98.                                       00070000
000800 DATE-COMPILED.                                                   00080000
      *                                                                 00080177
      ***************************************************************** 00081077
      ** CHANGES MADE                                                   00082077
      ** 06/98   BY:SUZANNE MEYER.   STRUCTURED PROGRAM TO ALLOW FOR    00083077
      ** MULTIPLE VIEW MANAGEMENT.CORRECTED ABEND ROUTINE & WINDOWING   00084077
000900***************************************************************** 00090000
218479** CHANGES MADE                                                   00090184
218479** 02/19   BY: JIM ARENDT     BECAUSE OF THE DELOITTE REFACTOR    00090284
218479** PROJECT, NEEDED TO BREAK OUTPUT FILE OUT02 INTO TWO SEPERATE   00090384
218479** OUTPUT FILES OUT02 AND OUT03.                                  00090584
218479***************************************************************** 00090684
001000* MRKUT081 WILL READ THE CALENDAR ROUTINE TO RETREIVE THE CURRENT 00100039
001100* FISCAL WEEK NUMBER AND CALCULATE THE WEEK NUMBER CORRESPONDING  00110039
001200* TO IT FROM 2 YEARS (PV-BUSINESS-DAYS) BACK.                     00120039
001300*                                                                 00130039
001400* THIS PROGRAM CONTAINS 1 INPUT FILE, 2 OUTPUT FILES, AND 1       00140048
001500* CONTROL CARD                                                    00150048
001600*                                                                 00160039
001700* INPUT-REC WHICH IS ASSIGNED TO INP01 ** THIS FILE CONTAINS THE  00170039
001800*        TRAN CODE, DB ID, AND VIEW ID.                           00180039
001900*                                                                 00190039
002000* DATE-REC WHICH IS ASSIGNED TO OUT01 ** THIS FILE IS THE OUTPUT  00200039
002100*        FILE                                                     00210039
002200*                                                                 00220048
002300* DELETE-REC WHICH IS ASSIGNED TO OUT01 ** THIS FILE IS THE       00230048
002400*        OUTPUT FILE                                              00240048
002500*                                                                 00250039
002600* CC-CONTROL-CARD-DATE IS THE CONTROL CARD THAT IS PASSED IN THE  00260040
002700* PROGRAM. THIS DATE IS ADDED TO THE DPG52-LK-DATE-INPUT TO       00270040
002800* DETERMINE THE DATE THAT WILL APPEAR ON THE OUTPUT FILE.         00280040
002900***************************************************************** 00290000
003000*                                                                 00300000
003100 ENVIRONMENT DIVISION.                                            00310000
003200 CONFIGURATION SECTION.                                           00320000
003300 SOURCE-COMPUTER. IBM-3090.                                       00330000
003400 OBJECT-COMPUTER. IBM-3090.                                       00340000
003500 INPUT-OUTPUT SECTION.                                            00350000
003600                                                                  00360000
003700 FILE-CONTROL.                                                    00370000
003800                                                                  00380000
003900     SELECT INPUT-FILE                                            00390004
004000         ASSIGN                       TO INP01.                   00400004
004100                                                                  00410004
004200     SELECT DATE-FILE                                             00420000
004300         ASSIGN                       TO OUT01.                   00430000
004400                                                                  00440004
004500     SELECT DELETE-FILE                                           00450042
004600         ASSIGN                       TO OUT02.                   00460042
004700                                                                  00470078
218479     SELECT DELETE-FILE2                                          00471084
218479         ASSIGN                       TO OUT03.                   00472084
004700*                                                                 00473078
004800***************                                                   00480000
004900 DATA DIVISION.                                                   00490000
005000***************                                                   00500000
005100*                                                                 00510000
005200 FILE SECTION.                                                    00520000
005300                                                                  00530000
005400 FD  INPUT-FILE                                                   00540004
005500     RECORDING MODE F                                             00550004
005600     BLOCK CONTAINS 0 RECORDS                                     00560004
005700     RECORD CONTAINS 80 CHARACTERS                                00570023
005800     LABEL RECORDS ARE OMITTED                                    00580004
005900     DATA RECORD IS INPUT-REC.                                    00590007
006000                                                                  00600004
006100 01  INPUT-REC                    PIC X(80).                      00610004
006200                                                                  00620004
006300 FD  DATE-FILE                                                    00630000
006400     RECORDING MODE F                                             00640000
006500     BLOCK CONTAINS 0 RECORDS                                     00650000
006600     RECORD CONTAINS 80 CHARACTERS                                00660041
006700     LABEL RECORDS ARE OMITTED                                    00670000
006800     DATA RECORD IS DATE-REC.                                     00680000
006900                                                                  00690000
007000 01  DATE-REC                     PIC X(80).                      00700041
007100                                                                  00710004
007200 FD  DELETE-FILE                                                  00720042
007300     RECORDING MODE F                                             00730042
007400     BLOCK CONTAINS 0 RECORDS                                     00740042
007500     RECORD CONTAINS 80 CHARACTERS                                00750042
007600     LABEL RECORDS ARE OMITTED                                    00760042
007700     DATA RECORD IS DELETE-REC.                                   00770042
007800                                                                  00780042
007900 01  DELETE-REC                   PIC X(80).                      00790042
007100                                                                  00791078
218479 FD  DELETE-FILE2                                                 00792084
218479     RECORDING MODE F                                             00793084
218479     BLOCK CONTAINS 0 RECORDS                                     00794084
218479     RECORD CONTAINS 80 CHARACTERS                                00795084
218479     LABEL RECORDS ARE OMITTED                                    00796084
218479     DATA RECORD IS DELETE-REC2.                                  00797084
218479                                                                  00798084
218479 01  DELETE-REC2                  PIC X(80).                      00799084
008000*                                                                 00800000
008100*************************                                         00810000
008200 WORKING-STORAGE SECTION.                                         00820000
008300*************************                                         00830000
008400*                                                                 00840000
008500**************************************************                00850000
008600** STANDARD HEADER LINE - KOHLS 132 COL                           00860000
008700**************************************************                00870000
008800                                                                  00880000
008900     COPY DPWS132O.                                               00890000
009000                                                                  00900000
009100**************************************************                00910000
009200** COPY BOOK FOR THE CALENDAR ROUTINE                             00920001
009300**************************************************                00930000
009400                                                                  00940000
009500     COPY DPWS500.                                                00950000
009600                                                                  00960000
009700**************************************************                00970000
009800* INCLUDE MRRD029- CONTAINS MR029 PARAMETERS                      00980001
009900**************************************************                00990000
010000                                                                  01000000
010100     COPY MRRD029.                                                01010001
010200                                                                  01020000
010300*************************************************                 01030005
010400* INCLUDE SQL COMMUNICATION AREA2                                 01040005
010500*************************************************                 01050005
010600                                                                  01060005
010700     COPY SQLCA2.                                                 01070022
010800                                                                  01080005
010900*************************************************                 01090000
011000* PROGRAM VARIABLES                                               01100000
011100*************************************************                 01110000
011200                                                                  01120000
011300 01 SD-SYSTEM-TIME.                                               01130000
011400    05 SD-SYS-HR                 PIC 9(02)       VALUE ZEROS.     01140000
011500    05 SD-SYS-MIN                PIC 9(02)       VALUE ZEROS.     01150000
011600                                                                  01160000
011700 01 SD-SYSTEM-DATE.                                               01170000
011800    05 SD-SYSTEM-YEAR            PIC 9(02)       VALUE ZEROS.     01180000
011900    05 SD-SYSTEM-MONTH           PIC 9(02)       VALUE ZEROS.     01190000
012000    05 SD-SYSTEM-DAY             PIC 9(02)       VALUE ZEROS.     01200000
012100                                                                  01210002
012200 01 PV-MISC-FIELDS.                                               01220002
012300    05 PGM-LOCATION              PIC X(04)       VALUE SPACES.    01230050
012400    05 PV-ABEND-PARAGRAPH        PIC X(30)       VALUE SPACES.    01240050
012500    05 PV-BUSINESS-DAYS          PIC X(05)       VALUE '00737'.   01250052
012600    05 PV-DELETE-DAYS            PIC X(05)       VALUE '00760'.   01260050
012700                                                                  01270003
012800 01 CC-CONTROL-CARD.                                              01280003
012900    05 CC-CONTROL-CARD-DATE.                                      01290036
013000       10 CC-CENT                PIC 9(02)       VALUE ZEROS.     01300050
013100       10 CC-YEAR                PIC 9(02)       VALUE ZEROS.     01310050
013200       10 FILLER                 PIC X(01)       VALUE '-'.       01320050
013300       10 CC-MONTH               PIC 9(02)       VALUE ZEROS.     01330050
013400       10 FILLER                 PIC X(01)       VALUE '-'.       01340050
013500       10 CC-DAY                 PIC 9(02)       VALUE ZEROS.     01350050
013600                                                                  01360036
013700 01 PV-DELETE-DATE.                                               01370042
218479    05 PV-DELETE-TABLE           PIC X(20).                       01380084
218479    05 FILLER                    PIC X(17)       VALUE            01392084
218479       ' WHERE FSCL_YR = '.                                       01393084
014000    05 PV-DELETE-CC              PIC 9(02)       VALUE ZEROS.     01400044
014100    05 PV-DELETE-YEAR            PIC 9(02)       VALUE ZEROS.     01410044
014200    05 FILLER                    PIC X(19)       VALUE            01420046
014300            ' AND FSCL_WK_NBR > '.                                01430056
014400    05 PV-DELETE-WEEK            PIC 9(02)       VALUE ZEROS.     01440042
014600                                                                  01460042
014610 01 PV-DELETE-DATE2.                                              01470053
218479    05 PV-DELETE-TABLE2          PIC X(20).                       01471084
218479    05 FILLER                    PIC X(17)       VALUE            01480084
218479       ' WHERE FSCL_YR > '.                                       01490184
014640    05 PV-DELETE-CC2             PIC 9(02)       VALUE ZEROS.     01500054
014650    05 PV-DELETE-YEAR2           PIC 9(02)       VALUE ZEROS.     01510054
014670                                                                  01530053
014700 01 INPUT-RECORD.                                                 01540009
014800    05 PV-INPUT-FILE-MISC.                                        01550005
014900       10 PV-TRAN-CODE           PIC X(04)       VALUE SPACES.    01560050
015000       10 PV-DB-ID               PIC X(30)       VALUE SPACES.    01570050
015100       10 FILLER                 PIC X(01)       VALUE SPACES.    01580050
015200       10 PV-VIEW-ID             PIC X(30)       VALUE SPACES.    01590050
015300       10 FILLER                 PIC X(15)       VALUE SPACES.    01600050
015400                                                                  01610003
015500* PROGRAM ABEND CODES                                             01620000
015600 01 PV-ABEND-CODE                PIC S9(04)      VALUE +0         01630050
015700                                                  COMP SYNC.      01640050
015800    88 ABEND-4013-DB2-ERROR                      VALUE +4013.     01650050
015900                                                                  01660000
016000 01 PC-PROGRAM-CONSTANTS.                                         01670008
016100    05  PC-F2                    PIC X(02)       VALUE 'F2'.      01680050
                                                                        01681061
          05  PC-Y                     PIC X           VALUE 'Y'.       01682061
218479    05  PC-TABLE-LINE            PIC X(20)       VALUE            01682184
218479        '    DB2PDBA.TWKSKSL '.                                   01683084
016200                                                                  01690008
016300 01 PS-PROGRAM-SWITCHES.                                          01700000
016400    05 PS-FISCAL-DATE-WEEK-SW    PIC X(01)       VALUE 'N'.       01710050
016500       88 PS-NOT-FISCAL-DATE-WEEK                VALUE 'N'.       01720050
016600       88 PS-FISCAL-DATE-WEEK                    VALUE 'Y'.       01730050
                                                                        01731060
          05 PS-EOF-CC-FILE            PIC X(01)       VALUE 'N'.       01732060
             88 EOF-CC-IS-REACHED                      VALUE 'Y'.       01733060
016700                                                                  01740000
016800 01 SQLCA.                                                        01750038
016900    05 SQLCAID                   PIC X(8).                        01760050
017000    05 SQLCABC                   PIC S9(9) COMPUTATIONAL.         01770050
017100    05 SQLCODE                   PIC S9(9) COMPUTATIONAL.         01780050
017200    05 SQLERRM.                                                   01790041
017300       49 SQLERRML               PIC S9(4) COMPUTATIONAL.         01800050
017400       49 SQLERRMC               PIC X(70).                       01810050
017500    05 SQLERRP                   PIC X(8).                        01820050
017600    05 SQLERRD OCCURS 6 TIMES                                     01830041
017700                                 PIC S9(9) COMPUTATIONAL.         01840050
017800    05 SQLWARN.                                                   01850041
017900       10 SQLWARN0               PIC X(1).                        01860050
018000       10 SQLWARN1               PIC X(1).                        01870050
018100       10 SQLWARN2               PIC X(1).                        01880050
018200       10 SQLWARN3               PIC X(1).                        01890050
018300       10 SQLWARN4               PIC X(1).                        01900050
018400       10 SQLWARN5               PIC X(1).                        01910050
018500       10 SQLWARN6               PIC X(1).                        01920050
018600       10 SQLWARN7               PIC X(1).                        01930050
018700    05 SQLEXT                    PIC X(8).                        01940050
018800*                                                                 01950000
018900********************                                              01960000
019000 PROCEDURE DIVISION.                                              01970000
019100********************                                              01980000
019200*                                                                 01990000
019300                                                                  02000000
019400 A000-PROGRAM-MAINLINE.                                           02010000
019500     PERFORM A100-INITIALIZATION.                                 02020000
           PERFORM B050-PROCESS-LOOP UNTIL EOF-CC-IS-REACHED.           02030068
           PERFORM F050-FINAL-PROCESSING.                               02040076
020100     GOBACK.                                                      02080000
020200                                                                  02090000
020300****************************************************************  02100000
020400* A100-INITIALIZATION OPEN FILES AND ACCEPT CONTROL CARD DATE     02110062
020600****************************************************************  02130000
020700                                                                  02140000
020800 A100-INITIALIZATION.                                             02150000
020900                                                                  02160000
021000     MOVE 'A100'                 TO PGM-LOCATION.                 02170002
021100     MOVE 'A110-INITIALIZATION'                                   02180002
021200                                 TO PV-ABEND-PARAGRAPH.           02190002
021300                                                                  02200002
021400     OPEN INPUT  INPUT-FILE.                                      02210004
021500     OPEN OUTPUT DATE-FILE.                                       02220004
021600     OPEN OUTPUT DELETE-FILE                                      02230078
218479          OUTPUT DELETE-FILE2.                                    02231084
021700                                                                  02240000
021800     ACCEPT CC-CONTROL-CARD-DATE FROM SYSIN.                      02250009
                                                                        02251069
022800     PERFORM A105-READ-INPUT-FILE.                                02350069
                                                                        02360074
023100****************************************************************  02380004
023200* A105-READ-INPUT-FILE                                            02390005
023300****************************************************************  02400004
023400                                                                  02410004
023500 A105-READ-INPUT-FILE.                                            02420004
024700                                                                  02421060
024800     MOVE 'A105'                 TO PGM-LOCATION.                 02422060
024900     MOVE 'A105-READ-INPUT-FILE '                                 02423060
025000                                 TO PV-ABEND-PARAGRAPH.           02424060
025100                                                                  02425060
023600     READ INPUT-FILE INTO INPUT-RECORD                            02430012
023700         AT END                                                   02440004
                  MOVE PC-Y   TO PS-EOF-CC-FILE.                        02441060
024100                                                                  02442068
024200******************************************************************02443068
024300* B050-PROCESS-LOOP                                               02444068
024400******************************************************************02445068
024500                                                                  02446068
024600 B050-PROCESS-LOOP.                                               02447068
024800     MOVE 'B100'                 TO PGM-LOCATION.                 02448068
024900     MOVE 'B100-FISCAL-DATE-WEEK'                                 02449068
025000                                 TO PV-ABEND-PARAGRAPH.           02450068
025100                                                                  02460068
024100                                                                  02480004
019600     PERFORM B100-FISCAL-DATE-WEEK.                               02483068
                                                                        02483171
019700     PERFORM C100-FISCAL-DATE-2YRS-PRIOR.                         02484068
                                                                        02484171
019800     PERFORM C200-GET-DELETE-DATE.                                02485068
                                                                        02485171
019900     PERFORM E600-WRITE-FILE.                                     02486068
                                                                        02486171
           IF NOT EOF-CC-IS-REACHED                                     02486271
              PERFORM A105-READ-INPUT-FILE.                             02487071
                                                                        02488071
024200******************************************************************02490000
024300* B100-FISCAL-DATE-WEEK                                           02500003
024400******************************************************************02510000
024500                                                                  02520000
024600 B100-FISCAL-DATE-WEEK.                                           02530003
024700                                                                  02540000
024800     MOVE 'B100'                 TO PGM-LOCATION.                 02550003
024900     MOVE 'B100-FISCAL-DATE-WEEK'                                 02560003
025000                                 TO PV-ABEND-PARAGRAPH.           02570002
025100                                                                  02580002
025200     MOVE SPACES TO DPG51-INCREMENT-DECREMENT-FLAG.               02590002
025300     MOVE PC-F2  TO DPG51-CALENDAR-TYPE.                          02600002
025400     SET DPG52-LK-DTE-ISO-FMT      TO TRUE.                       02610000
025500     SET PS-FISCAL-DATE-WEEK       TO TRUE.                       02620003
025600     MOVE CC-CONTROL-CARD-DATE TO DPG52-LK-DATE-INPUT.            02630013
025700                                                                  02640000
025800     CALL  DP500-KOHLS-CALENDAR-ROUTINE USING DPG51               02650000
025900                                              DPG52               02660000
026000                                              DPG53               02670000
026100                                              DPG54               02680000
026200                                              DPG55               02690000
026300                                              DPG56.              02700000
026400                                                                  02710000
026500     EVALUATE TRUE                                                02720000
026600         WHEN DPG54-SEVERE-ERROR                                  02730000
026700              DISPLAY ' '                                         02740002
026800              DISPLAY 'SERVERE ERROR IN CALENDAR ROUTINE   '      02750002
026900              DISPLAY DPG54-ERROR-MESSAGE                         02760002
027000              DISPLAY 'INPUT DATE: ' DPG52-LK-DATE-INPUT          02770002
                    MOVE +4013 TO PV-ABEND-CODE                         02771067
027100              CALL 'ILBOABN0'  USING PV-ABEND-CODE                02780078
027200         WHEN DPG54-WARNING-ERROR                                 02790000
027300              DISPLAY ' '                                         02800000
027400              DISPLAY 'WARNING ERROR IN CALENDAR ROUTINE   '      02810002
027500              DISPLAY DPG54-ERROR-MESSAGE                         02820000
027600         WHEN DPG54-NO-ERROR                                      02830000
027700              CONTINUE                                            02840002
027800     END-EVALUATE.                                                02850000
                                                                        02860074
028100     PERFORM D100-POPULATE-FIELDS.                                02880003
028200                                                                  02890003
028300******************************************************************02900002
028400* C100-FISCAL-DATE-2YRS-PRIOR                                     02910002
028500******************************************************************02920002
028600                                                                  02930002
028700 C100-FISCAL-DATE-2YRS-PRIOR.                                     02940002
028800                                                                  02950002
028900     MOVE 'C100'                 TO PGM-LOCATION.                 02960042
029000     MOVE 'FISCAL-DATE-2YRS-PRIOR'                                02970002
029100                                 TO PV-ABEND-PARAGRAPH.           02980002
029200                                                                  02990002
029300     SET DPG51-DECREMENT-DATE      TO TRUE.                       03000002
029400     MOVE PV-BUSINESS-DAYS TO DPG51-INCR-DECR-DAYS-X.             03010026
029500     MOVE PC-F2  TO DPG51-CALENDAR-TYPE.                          03020002
029600     SET DPG52-LK-DTE-ISO-FMT      TO TRUE.                       03030002
029700     MOVE CC-CONTROL-CARD-DATE TO DPG52-LK-DATE-INPUT.            03040009
029800                                                                  03050002
029900     CALL  DP500-KOHLS-CALENDAR-ROUTINE USING DPG51               03060002
030000                                              DPG52               03070002
030100                                              DPG53               03080002
030200                                              DPG54               03090002
030300                                              DPG55               03100002
030400                                              DPG56.              03110002
030500                                                                  03120002
030600     EVALUATE TRUE                                                03130002
030700         WHEN DPG54-SEVERE-ERROR                                  03140002
030800              DISPLAY ' '                                         03150002
030900              DISPLAY 'SERVERE ERROR IN CALENDAR ROUTINE   '      03160002
031000              DISPLAY DPG54-ERROR-MESSAGE                         03170002
031100              DISPLAY 'INPUT DATE: ' DPG52-LK-DATE-INPUT          03180002
                    MOVE +4013 TO PV-ABEND-CODE                         03181067
031200              CALL 'ILBOABN0'  USING PV-ABEND-CODE                03190078
031300         WHEN DPG54-WARNING-ERROR                                 03200002
031400              DISPLAY ' '                                         03210002
031500              DISPLAY 'WARNING ERROR IN CALENDAR ROUTINE   '      03220002
031600              DISPLAY DPG54-ERROR-MESSAGE                         03230002
031700         WHEN DPG54-NO-ERROR                                      03240002
031800              CONTINUE                                            03250002
031900     END-EVALUATE.                                                03260002
                                                                        03270074
032200     PERFORM D100-POPULATE-FIELDS.                                03290003
032300                                                                  03300003
032400******************************************************************03310042
032500* C200-GET-DELETE-DATE                                            03320042
032600******************************************************************03330042
032700                                                                  03340042
032800 C200-GET-DELETE-DATE.                                            03350042
032900                                                                  03360042
033000     MOVE 'C200'                 TO PGM-LOCATION.                 03370042
033100     MOVE 'GET-DELETE-DATE       '                                03380042
033200                                 TO PV-ABEND-PARAGRAPH.           03390042
033300                                                                  03400042
033400     SET DPG51-DECREMENT-DATE      TO TRUE.                       03410042
033500     MOVE PV-DELETE-DAYS   TO DPG51-INCR-DECR-DAYS-X.             03420042
033600     MOVE PC-F2  TO DPG51-CALENDAR-TYPE.                          03430042
033700     SET DPG52-LK-DTE-ISO-FMT      TO TRUE.                       03440042
033800     MOVE CC-CONTROL-CARD-DATE TO DPG52-LK-DATE-INPUT.            03450042
033900                                                                  03460042
034000     CALL  DP500-KOHLS-CALENDAR-ROUTINE USING DPG51               03470042
034100                                              DPG52               03480042
034200                                              DPG53               03490042
034300                                              DPG54               03500042
034400                                              DPG55               03510042
034500                                              DPG56.              03520042
034600                                                                  03530042
034700     EVALUATE TRUE                                                03540042
034800         WHEN DPG54-SEVERE-ERROR                                  03550042
034900              DISPLAY ' '                                         03560042
035000              DISPLAY 'SERVERE ERROR IN CALENDAR ROUTINE   '      03570042
035100              DISPLAY DPG54-ERROR-MESSAGE                         03580042
035200              DISPLAY 'INPUT DATE: ' DPG52-LK-DATE-INPUT          03590042
                    MOVE +4013 TO PV-ABEND-CODE                         03591067
035300              CALL 'ILBOABN0'  USING PV-ABEND-CODE                03600078
035400         WHEN DPG54-WARNING-ERROR                                 03610042
035500              DISPLAY ' '                                         03620042
035600              DISPLAY 'WARNING ERROR IN CALENDAR ROUTINE   '      03630042
035700              DISPLAY DPG54-ERROR-MESSAGE                         03640042
035800         WHEN DPG54-NO-ERROR                                      03650042
035900              CONTINUE                                            03660042
036000     END-EVALUATE.                                                03670042
036100                                                                  03680042
036200     MOVE DPG56-FISCAL-YEAR-NBR TO PV-DELETE-YEAR.                03690042
                                                                        03690173
           IF PV-DELETE-YEAR > 90                                       03691073
              MOVE 19 TO PV-DELETE-CC                                   03692073
           ELSE                                                         03693073
              MOVE 20 TO PV-DELETE-CC.                                  03694073
                                                                        03695073
036210     MOVE DPG56-FISCAL-YEAR-NBR TO PV-DELETE-YEAR2.               03700054
                                                                        03701073
           IF PV-DELETE-YEAR2 > 90                                      03702073
              MOVE 19 TO PV-DELETE-CC2                                  03703073
           ELSE                                                         03704073
              MOVE 20 TO PV-DELETE-CC2.                                 03705073
                                                                        03706074
036400     MOVE DPG56-FISCAL-WEEK-NBR TO PV-DELETE-WEEK.                03720042
036500                                                                  03730042
038600******************************************************************03960002
038700* D100-POPULATE-FIELDS                                            03970002
038800******************************************************************03980002
038900                                                                  03990002
039000 D100-POPULATE-FIELDS.                                            04000002
039100                                                                  04010002
039200     MOVE 'D100'                   TO PGM-LOCATION.               04020002
039300     MOVE 'E100-POPULATE-FIELDS '  TO PV-ABEND-PARAGRAPH.         04030002
039400                                                                  04040002
039500                                                                  04050002
039600     IF PS-FISCAL-DATE-WEEK                                       04060003
                                                                        04061060
039700        MOVE DPG56-FISCAL-YEAR-NBR TO MR029-LAST-PERIOD-YY        04070003
039800        MOVE DPG56-FISCAL-WEEK-NBR TO MR029-LAST-PERIOD-WW        04080003
                                                                        04081073
              IF DPG56-FISCAL-YEAR-NBR > 90                             04082073
                 MOVE 19 TO MR029-LAST-PERIOD-CC                        04083073
              ELSE                                                      04084073
                 MOVE 20 TO MR029-LAST-PERIOD-CC                        04085073
              END-IF                                                    04086073
                                                                        04090160
023800        MOVE PV-TRAN-CODE             TO MR029-TRAN-CODE          04091073
023900        MOVE PV-DB-ID                 TO MR029-DB-ID              04092073
024000        MOVE PV-VIEW-ID               TO MR029-VIEW-ID            04093073
                                                                        04094073
039900        SET PS-NOT-FISCAL-DATE-WEEK TO TRUE                       04095073
                                                                        04096073
040000     ELSE                                                         04100003
                                                                        04101060
040100        MOVE DPG56-FISCAL-YEAR-NBR TO MR029-FIRST-PERIOD-YY       04110003
040200        MOVE DPG56-FISCAL-WEEK-NBR TO MR029-FIRST-PERIOD-WW       04120003
                                                                        04120173
              IF DPG56-FISCAL-YEAR-NBR > 90                             04120273
                 MOVE 19 TO MR029-FIRST-PERIOD-CC                       04120373
              ELSE                                                      04120473
                 MOVE 20 TO MR029-FIRST-PERIOD-CC                       04120573
              END-IF                                                    04120673
                                                                        04120860
023800        MOVE PV-TRAN-CODE             TO MR029-TRAN-CODE          04121073
023900        MOVE PV-DB-ID                 TO MR029-DB-ID              04122073
024000        MOVE PV-VIEW-ID               TO MR029-VIEW-ID            04123073
                                                                        04124073
040300     END-IF.                                                      04130003
040400                                                                  04140003
040500                                                                  04150003
040600******************************************************************04160002
040700* E600-WRITE-FILE                                                 04170002
040800******************************************************************04180002
040900                                                                  04190002
041000 E600-WRITE-FILE.                                                 04200002
041100                                                                  04210002
041200     MOVE 'E600'                   TO PGM-LOCATION.               04220002
041300     MOVE 'E600-WRITE-FILE      '  TO PV-ABEND-PARAGRAPH.         04230002
041400                                                                  04240002
041500     WRITE DATE-REC        FROM MR029-PARAMETERS.                 04250003
041700                                                                  04280002
041800 E600-X. EXIT.                                                    04290002
041900                                                                  04291076
042000******************************************************************04292076
042100* F050-FINAL WRITE AND CLOSE FILES                                04293076
042200******************************************************************04294076
042300                                                                  04295076
042400 F050-FINAL-PROCESSING.                                           04296076
042500                                                                  04297076
042600     MOVE 'F050'                 TO PGM-LOCATION.                 04298076
042700     MOVE 'FINAL-PROCESSING   '                                   04299076
042800                                 TO PV-ABEND-PARAGRAPH.           04299176
                                                                        04299276
218479     MOVE PC-TABLE-LINE          TO PV-DELETE-TABLE               04299384
218479                                    PV-DELETE-TABLE2.             04299484
041600     WRITE DELETE-REC      FROM PV-DELETE-DATE.                   04299576
218479     WRITE DELETE-REC2     FROM PV-DELETE-DATE2.                  04299784
                                                                        04299878
020000     PERFORM F100-CLOSE-FILE.                                     04299978
042900                                                                  04300078
041900                                                                  04301042
042000******************************************************************04310000
042100* F100-CLOSE-FILE WILL CLOSE THE FILE.                            04320040
042200******************************************************************04330000
042300                                                                  04340000
042400 F100-CLOSE-FILE.                                                 04350040
042500                                                                  04360002
042600     MOVE 'F100'                 TO PGM-LOCATION.                 04370040
042700     MOVE 'F100-CLOSE-FILE  '                                     04380040
042800                                 TO PV-ABEND-PARAGRAPH.           04390002
042900                                                                  04400002
                                                                        04403075
043000     CLOSE INPUT-FILE.                                            04410004
043100     CLOSE DATE-FILE.                                             04420004
043200     CLOSE DELETE-FILE                                            04430078
218479           DELETE-FILE2.                                          04431084
043300                                                                  04440000
043400******************************************************************04450000
043500* Z100-SQL WARNING OR ERROR PROCESSING.                           04460000
043600******************************************************************04470000
043700                                                                  04480000
043800 Z100-SQL-ERROR.                                                  04490000
043900     MOVE SQLCODE    TO SQLCODE2.                                 04500000
044000     MOVE SQLERRD(3) TO SQLERRD3.                                 04510000
044100     DISPLAY '** ABEND **       ** = SQLERROR'.                   04520000
044200     DISPLAY '** PROGRAM        ** = MRKUT081'.                   04530000
044300     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  04540000
044400     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  04550000
044500     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   04560000
044600     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  04570000
044700     MOVE +4013 TO PV-ABEND-CODE.                                 04580000
044800     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         04590000
044900                                                                  04600000
