000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     APKUP039.                                        00020000
000300 AUTHOR.         M WILKINSON.                                     00030000
000400*DATE-WRITTEN.   NOV 20, 1996.                                    00040000
000500*DATE-COMPILED.                                                   00050000
000600****************************************************************  00060000
000700* COBOL 2 WITH SQL                                             *  00070000
000800*--------------------------------------------------------------*  00080000
000900*    EXTRACT RECEIVING FOR BATCH MATCH PROGRAM                 *  00090000
001000*--------------------------------------------------------------*  00100000
001100* INPUT:                                                       *  00110000
001200* 1. AP CONTROL TABLE                            (TAPCNTL)     *  00120000
001300* 2. RECEIVING DISTRIBUTION TABLE                (TRECDIS)     *  00130000
001400* 3. RECEIVING ITEM TABLE                        (TRECITM)     *  00140000
001500* 4. PURCHASE ORDER TABLE                        (TPURCHS)     *  00150000
001600* 5. PURCHASE ORDER ITEM TABLE                   (TPURITM)     *  00160000
001700* 6. NON-INVOICED RECEIPT TABLE                  (TNINREC)     *  00170000
001800* 7. CHECKPOINT RESTART CONTROL TABLE            (TCKRSTCNTL)  *  00180000
001900* 8. CHECKPOINT RESTART INFORMATION TABLE        (TCKRSTINF)   *  00190000
002000* 9. SELECTED FASHION POSTED RECEIVING FILE      (TRECEIV)     *  00200000
002100*                                                              *  00210000
002200* OUTPUT:                                                      *  00220000
002300* 1. RECEIVING SUMMED BY RECEIVER SEQUENCE       (TOUTAPB)     *  00230000
002400* 2. RECEIVING DETAILS FOR DETAIL ENTRY REPORT   (TOUTAP6)     *  00240000
002500* 3. IMPORT PURCHASE ORDER RECEIVING RECORDS     (TOUTAPC)     *  00250000
002600* 4. RECEIVING UPDATE KEY RECORDS                (TOUTAPD)     *  00260000
002700*--------------------------------------------------------------***00270000
002800* CHANGE LOG:                                                    *00280000
002900*                                                                *00290000
003000* 11/20/96  INITIAL VERSION                                      *00300000
003100*  2/18/97  CKUNSTM   MODIFIED NINREC_CSR LOGIC TO SELECT        *00310000
003200*              STATUS_CDE  = ' '   INSTEAD OF                    *00320000
003300*              STATUS_CDE NOT IN ('M', 'J')                      *00330000
003400*  8/25/97  CKUNSTM   MODIFICATIONS WERE MADE TO ACCOMODATE      *00340000
003500*   WR4164     THE NEW IMPORT INVOICES.                          *00350000
003600*              MODIFIED AP0061 RECORD LENGTH                     *00360000
003700*              ADDED TPURCHS AS INPUT, TOUTAPC AS OUTPUT         *00370000
003800*              MODIFIED B200-, B400-, R300-, & W100-             *00380000
003900*              MODIFIED PURITM_CSR & ADDED R400- AND W500-.      *00390000
004000*              ADDED COUNTERS FOR RECOVERY                       *00400000
004100*              REMOVED APRD020 COPYBOOK ISN'T NEEDED.            *00410000
004200* 11/17/97  MBESKE                                               *00420000
004300*   WR4164     ADDED CODE TO RETRIEVE THE DEPT NUMBER FROM       *00430000
004400*              TPURCHS AND TO MOVE IT TO THE AP032 LAYOUT        *00440000
004500*              (R500 AND W500 PARA MODIFIED).  REMOVED THE       *00450000
004600*              CHECK FOR IMPORT POS WHEN DOING THE CALCULA-      *00460000
004700*              TION IN THE W100 PARAGRAPH.                       *00470000
004800* 12/10/97  NANCY EILBES                                         *00480000
004900*   WR4164     ADDED CODE TO RETRIEVE THE CLASS NUMBER FROM      *00490000
005000*              TPURITM AND TO MOVE IT TO THE AP032 LAYOUT.       *00500000
005100*                                                                *00510000
005200* 02/03/98   ROBIN BERNOSKI              WR/IR #: WR5703         *00520000
005300*            - REPLACED ++INCLUDES WITH COPY STATEMENTS.         *00530000
005400*                                                                *00540000
005500* 04/17/00   ROBIN BERNOSKI              WR/IR #:                *00550000
005600*            PERFORMANCE TUNING.  COMBINED THE RECDIS_CSR        *00560000
005700*            AND THE PURITM_CSR TO FORM THE MAIN RECEIVER        *00570000
005800*            CURSOR.                                             *00580000
005900*                                                                *00590000
006000* 06/02/00   ROBIN BERNOSKI              PITS# #: 20704          *00600000
006100*            MODIFIED CHECKPOINT RESTART DUE TO ABEND.           *00610000
006200*                                                                *00620000
006300* 09/31/00   ROBIN BERNOSKI              WR/IR #:                *00630000
006400*            ADDED 'IF' AND 'IE' AS ACCEPTABLE PO TYPE           *00640000
006500*            CODES.                                              *00650000
006600*                                                                *00660000
006700* DATE  06/20/2002                                               *00670000
006800*     CHANGE MADE:  MOVED OLD VERSION OF PROGRAM BACK INTO       *00680000
006810*     PRODUCTION.                                                *00681000
006820*     MADE BY: KEVIN CATLIN            WR/IR #: WR23500          *00682000
006830*                                                                *00683000
006840* DATE  02/16/2005                                               *00684000
006850*     CHANGE MADE:  CHANGED PIC ON PV-REC-TOT-COST-AMT TO HAVE   *00685000
006860*     3 DIGITS AFTER THE DECIMAL POINT.  ALSO CHANGED FIELD IN   *00686000
006870*     APRD021 COPYBOOK TO HAVE 3 DIGITS AFTER THE DECIMAL POINT. *00687000
006880*     THESE CHANGES WERE NEEDED TO HELP ROUND RECEIPT COSTS      *00688000
006890*     RATHER THAN TRUNCATING THEM.                               *00689000
006891*     MADE BY: NANCY EILBES            WR/IR #: WR28327          *00689100
006892*                                                                *00689200
006893* DATE  03/11/2007                                               *00689300
006894*     CHANGE MADE: MATCH BY DC -- ALTERED THE SELECT STATEMENT   *00689400
006895*     IN THE RECEIVING_CSR TO INCLUDE RD.OPER_UNT_ID.  ALSO      *00689500
006896*     ALTERED THE SELECT STATEMENT IN THE NINREC_CSR TO INCLUDE  *00689600
006897*     DC_NBR.  IN PARAGRAPHS W100-INSERT-AP021-RECV-SEQ AND      *00689700
006898*     W300-INSERT-AP271-ENTRY MOVED THE RECDIS-OPER-UNT-ID FIELD *00689800
006899*     TO THE AP021-DC-NBR AND AP271-DC-NBR FIELDS RESPECTIVELY.  *00689900
006900*     IN PARAGRAPHS W150-INSERT-AP021 AND W350-INSERT-AP271-ENTRY*00690000
006901*     MOVED THE NINREC-DC-NBR FIELD TO THE AP021-DC-NBR AND      *00690100
006902*     AP271-DC-NBR FIELDS RESPECTIVELY.  IN THE RECEIV-PROCESS   *00690200
006903*     PORTION OF PARAGRAPH W400-INSERT-AP024-KEYS, CHANGED MOVING*00690300
006904*     ZERO TO AP024-SRT-STORE-NBR TO MOVE AP061-OPER-UNT-ID      *00690400
006905*     INSTEAD.  ALSO MOVED THE AP061-OPER-UNT-ID TO THE          *00690500
006906*     AP024-RC-DC-NBR FIELD.                                      00690600
006907*     MADE BY: KRYSTEN LEARY           WR/IR #: WR21578          *00690700
006908*                                                                *00690800
006909* DATE  05/01/2007                                               *00690900
006910*     MODIFIED LOGIC TO NOT INSERT RECORDS ON THE TOUTAPC TABLE  *00691000
006911*     WHEN THE ITEM QUANTITY = ZEROES OR WHEN THE UNIT COST AMT  *00691100
006912*     AND THE PRD FIRST COST AMOUNT BOTH = ZEROES. THIS DATA     *00691200
006913*     DOESN'T NEED TO BE USED DOWNSTREAM IN THE JOBS IN THIS     *00691300
006914*     SITUATION.                                                 *00691400
006915*     MADE BY: MICHELE RINDFLEISCH     WR/IR #: PM01007493       *00691500
006916*                                                                *00691600
006924* DATE  02/04/2008                                               *00692400
006925*     APRD024 WAS MODIFIED TO HAVE THE NEW FIELD AP024-DC-NBR,   *00692501
006926*     REMOVING THE EXISTING AP024-RC-DC-NBR FIELD.  W400 WAS     *00692601
006927*     MODIFIED TO USE THAT AS THE DC NUMBER LOADED WITH EITHER   *00692701
006928*     THE RECEIV OR NINREC DC NUMBER ACCORDING TO THE RECORD     *00692801
006929*     BEING PROCESSED.                                           *00692901
006930*     IN PARAGRAPH W300- REPLACED PURITM-UNT-COST-AMT WITH       *00693000
006931*     PURITM-PRD-1ST-COST-AMT FOR THE PRIVATE LABEL ACCOUNTING   *00693100
006932*     PROJECT                                                    *00693200
006933*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR32664          *00693300
006934*                                                                *00693402
006935* DATE  11/14/2014                                               *00693503
006936*      RECOMPILED THE  PROGRAM. CHANGES WERE MADE TO APRD271     *00693603
006937*      COPYBOOK.                                                 *00693703
006938*      MADE BY: COGNIZANT              WR/IR: CHG0094517         *00693803
006939*                                                                *00693907
006940* DATE  08/10/2017                                               *00694007
006941*      MODIFIED THE RECEIVING_CSR AS RECOMMENDED BY DBA TO       *00694107
006942*      IMPROVE DB2 ACCESS PATH AND REDUCE CPU TIME AND RUN TIME. *00694207
006943*      MADE BY: NANCY EILBES           WR/IR: CHG0175051         *00694307
006944*                                                                *00694408
006945* DATE  06/09/2020                                               *00694508
006946*      MODIFIED W100-INSERT-AP021-RECV-SEQ TO MOVE THE VERIFYED  *00694608
006947*      DATE TO THE RECEIPT DATE FIELD IN PLACE OF THE RECEIPT    *00694708
006948*      DATE.  THIS CHANGE WAS NEEDED DURING THE PERIOD WHEN THE  *00694808
006949*      DCS REOPENED AFTER THE COVID-19 SHUTDOWN AND PROCESSED    *00694908
006950*      RECEIPTS THAT HAD ARRIVED 3 MONTHS EARLIER.  BUSINESS     *00695008
006951*      REQUESTED THAT THE VERIFYED DATE BE USED IN THE DUE DATE  *00695108
006952*      CALCULATION LOGIC INSTEAD OF THE ARRIVAL DATE.            *00695208
006953*      MADE BY: NANCY EILBES           WR/IR: CHG0244923         *00695309
006944*                                                                *00695410
006945* DATE  05/16/2022                                               *00695510
006946*      CHANGE WHERE COMMIT CHECKPOINT IS TAKEN - NEED TO COMMIT  *00695610
006947*      MORE OFTEN.                                               *00695710
006953*      MADE BY: JEAN KURK              WR/IR: CHG0269869         *00696310
006954******************************************************************00696408
006955                                                                  00696508
006956 ENVIRONMENT DIVISION.                                            00696608
006957 INPUT-OUTPUT SECTION.                                            00696708
006960                                                                  00696800
006970 FILE-CONTROL.                                                    00697000
006980                                                                  00698000
006990     SELECT RECEIPT-FILE       ASSIGN    TO UT-S-INP01.           00699000
007000                                                                  00700000
007100 DATA DIVISION.                                                   00710000
007200 FILE SECTION.                                                    00720000
007300                                                                  00730000
007400 FD  RECEIPT-FILE                                                 00740000
007500         LABEL RECORDS  ARE STANDARD                              00750000
007600         RECORDING MODE IS  F                                     00760000
007700         DATA RECORD    IS  RECEIPT-RECORD.                       00770000
007800 01  RECEIPT-RECORD                PIC X(092).                    00780000
007900                                                                  00790000
008000 WORKING-STORAGE SECTION.                                         00800000
008100                                                                  00810000
008200 01  FILLER                        PIC X(25) VALUE                00820000
008300                             'WS FOR APKUP039 BEGINS==>'.         00830000
008400                                                                  00840000
008500*--------------------------------------------------------------*  00850000
008600* ABEND AREA                                                   *  00860000
008700*--------------------------------------------------------------*  00870000
008800 01  ABEND-CODE                    PIC S9(4) COMP SYNC            00880000
008900                                             VALUE ZEROS.         00890000
009000     88 AP-EMPTY-FILE              VALUE +4005.                   00900000
009100     88 AP-DB2-ERROR               VALUE +4013.                   00910000
009200                                                                  00920000
009300 01  PROGRAM-CONSTANTS.                                           00930000
009400     05  PC-RETRY-MAX            PIC S9(04)  VALUE +3  COMP.      00940000
009500     05  PC-IN-PROCESS-CODE       PIC X(01)     VALUE '9'.        00950000
009600     05  PC-RUN-COMPLETE-CODE     PIC X(01)     VALUE '0'.        00960000
009700                                                                  00970000
009800 01  PV-ABEND-FIELDS.                                             00980000
009900     05  PV-ABEND-PROGRAM             PIC X(8)  VALUE 'APKUP039'. 00990000
010000     05  PV-ABEND-SQLCODE             PIC X(4)  VALUE SPACES.     01000000
010100     05  PV-ABEND-PARAGRAPH           PIC X(50) VALUE SPACES.     01010000
010200     05  PV-ABEND-OPERATION           PIC X(50) VALUE SPACES.     01020000
010300     05  PV-ABEND-STRUCTURE-1         PIC X(8)  VALUE SPACES.     01030000
010400     05  PV-ABEND-STRUCTURE-2         PIC X(8)  VALUE SPACES.     01040000
010500     05  PV-ABEND-STRUCTURE-3         PIC X(8)  VALUE SPACES.     01050000
010600     05  PV-ABEND-STRUCTURE-4         PIC X(8)  VALUE SPACES.     01060000
010700     05  PV-ABEND-STATUS              PIC XX    VALUE SPACES.     01070000
010800                                                                  01080000
010900 01  PV-RECORD-CNTS-PER-COMMIT.                                   01090000
011000     05  PV-RECEIPT-IN-REC-CNT-C      PIC S9(07) COMP-3 VALUE +0. 01100000
011100     05  PV-RECDIS-INPUT-CNT-C        PIC S9(07) COMP-3 VALUE +0. 01110000
011200     05  PV-NINREC-INPUT-CNT-C        PIC S9(07) COMP-3 VALUE +0. 01120000
011300                                                                  01130000
011400     05  PV-DETAIL-RECV-SEQ-CNT-C     PIC S9(07) COMP-3 VALUE +0. 01140000
011500     05  PV-DETAIL-ENTRY-REC-CNT-C    PIC S9(07) COMP-3 VALUE +0. 01150000
011600     05  PV-DETAIL-IMPRT-REC-CNT-C    PIC S9(07) COMP-3 VALUE +0. 01160000
011700     05  PV-UPDATE-KEYS-REC-CNT-C     PIC S9(07) COMP-3 VALUE +0. 01170000
011800                                                                  01180000
011900 01  PV-RECORD-CNTS.                                              01190000
012000     05  PV-RECEIPT-IN-REC-CNT        PIC S9(09) COMP-3 VALUE +0. 01200000
012100     05  PV-RECDIS-INPUT-CNT          PIC S9(09) COMP-3 VALUE +0. 01210000
012200     05  PV-NINREC-INPUT-CNT          PIC S9(09) COMP-3 VALUE +0. 01220000
012300                                                                  01230000
012400     05  PV-DETAIL-RECV-SEQ-CNT       PIC S9(09) COMP-3 VALUE +0. 01240000
012500     05  PV-DETAIL-ENTRY-REC-CNT      PIC S9(09) COMP-3 VALUE +0. 01250000
012600     05  PV-DETAIL-IMPRT-REC-CNT      PIC S9(09) COMP-3 VALUE +0. 01260000
012700     05  PV-UPDATE-KEYS-REC-CNT       PIC S9(09) COMP-3 VALUE +0. 01270000
012800                                                                  01280000
012900 01  PV-WORK-AREA.                                                01290000
013000     05  PV-PROGRAM-NAME         PIC X(08)     VALUE 'APKUP039'.  01300000
013100                                                                  01310000
013200     05  PV-SAVED-PO                  PIC S9(09) COMP VALUE +0.   01320000
013300     05  PV-PO-BEING-PROCESSED        PIC S9(09) COMP VALUE +0.   01330000
013400     05  PV-UNIT-COST-TO-USE          PIC S9(07)V999 COMP-3       01340000
013500                                                      VALUE +0.   01350000
013600     05  PV-CKPT-STAT-CODE            PIC X(01)     VALUE SPACE.  01360000
013700     05  PV-RETRY-COUNT          PIC S9(04)   VALUE ZEROS         01370000
013800                                              COMP.               01380000
013900     05  PV-REC-TOT-COST-AMT     PIC S9(10)V999 VALUE ZEROS       01390000
014000                                             COMP-3.              01400000
014010     05  PV-REC-TOT-1ST-COST-AMT PIC S9(10)V999 VALUE ZEROS       01401000
014020                                             COMP-3.              01402000
014030                                                                  01403000
014040 01  PV-SWITCHES.                                                 01404000
014050     05  END-OF-RECEIVING-CSR-SW PIC X(01) VALUE 'N'.             01405000
014060         88  NOT-END-OF-RECEIVING-CSR      VALUE 'N'.             01406000
014070         88  END-OF-RECEIVING-CSR          VALUE 'Y'.             01407000
014080     05  END-OF-RECEIPT-IN-SW    PIC X(01) VALUE 'N'.             01408000
014090         88  NOT-END-OF-RECEIPT-INPUT      VALUE 'N'.             01409000
014100         88  END-OF-RECEIPT-INPUT          VALUE 'Y'.             01410000
014200     05  END-OF-NINRECS-SW       PIC X(01) VALUE 'N'.             01420000
014300         88  END-OF-NINRECS                VALUE 'Y'.             01430000
014400         88  NOT-END-OF-NINRECS            VALUE 'N'.             01440000
014500     05  TYPE-OF-UPD-PROCESS-SW  PIC X(02) VALUE '  '.            01450000
014600         88  RECEIV-PROCESS                VALUE 'RC'.            01460000
014700         88  RECDIS-PROCESS                VALUE 'RD'.            01470000
014800         88  NINREC-PROCESS                VALUE 'NR'.            01480000
014900     05  FIRST-READ-SW           PIC X(01) VALUE 'Y'.             01490000
015000         88  FIRST-READ                    VALUE 'Y'.             01500000
015100         88  NOT-FIRST-READ                VALUE 'N'.             01510000
015200                                                                  01520000
015300     05  PS-RUN-TYPE-SW           PIC  X(01)    VALUE ' '.        01530000
015400         88  NORMAL-RUN                         VALUE '0'.        01540000
015500         88  RESTART-RUN                        VALUE '9'.        01550000
015600                                                                  01560000
015700 01  CKPT-RESTART-INFO.                                           01570000
015800     05  CR-PO-NBR                PIC 9(09)     VALUE ZEROS.      01580000
015900     05  CR-RECEIPT-IN-REC-CNT    PIC S9(09)        VALUE +0.     01590000
016000     05  CR-RECEIV-INPUT-CNT      PIC S9(09)        VALUE +0.     01600000
016100     05  CR-NINREC-INPUT-CNT      PIC S9(09)        VALUE +0.     01610000
016200                                                                  01620000
016300     05  CR-DTL-RECV-SEQ-CNT      PIC S9(09)        VALUE +0.     01630000
016400     05  CR-DETAIL-ENTRY-REC-CNT  PIC S9(09)        VALUE +0.     01640000
016500     05  CR-UPDATE-KEYS-REC-CNT   PIC S9(09)        VALUE +0.     01650000
016600     05  CR-DETAIL-IMPRT-REC-CNT  PIC S9(09)        VALUE +0.     01660000
016700                                                                  01670000
016800 01  CKPT-RESTART-TMST.                                           01680000
016900     05  CR-CURR-TMST             PIC X(26)     VALUE SPACES.     01690000
017000     05  CR-NEXT-TMST             PIC X(26)     VALUE SPACES.     01700000
017100                                                                  01710000
017200 01  FILLER                      PIC X(35)  VALUE                 01720000
017300     'BEGINNING OF APRD061  INPUT FILE **'.                       01730000
017400     COPY APRD061.                                                01740000
017500                                                                  01750000
017600 01  FILLER                      PIC X(35)  VALUE                 01760000
017700     'BEGINNING OF AP021 OUTPUT FILE   **'.                       01770000
017800     COPY APRD021.                                                01780000
017900                                                                  01790000
018000 01  FILLER                      PIC X(35)  VALUE                 01800000
018100     'BEGINNING OF AP271 OUTPUT FILE   **'.                       01810000
018200     COPY APRD271.                                                01820000
018300                                                                  01830000
018400 01  FILLER                      PIC X(35)  VALUE                 01840000
018500     'BEGINNING OF AP032 OUTPUT FILE   **'.                       01850000
018600     COPY APRD032.                                                01860000
018700                                                                  01870000
018800 01  FILLER                      PIC X(35)  VALUE                 01880000
018900     'BEGINNING OF AP024 OUTPUT FILE   **'.                       01890000
019000     COPY APRD024.                                                01900000
019100                                                                  01910000
019200*--------------------------------------------------------------*  01920000
019300* SQLCA FORMATTED MESSAGE AREA                                 *  01930000
019400*--------------------------------------------------------------*  01940000
019500     COPY DPWS004.                                                01950000
019600                                                                  01960000
019700*--------------------------------------------------------------*  01970000
019800* WORKING STORAGE AREA FOR DPKUT500, DATE MANIPULATION ROUTINE *  01980000
019900*--------------------------------------------------------------*  01990000
020000     COPY DPWS500.                                                02000000
020100 01  FILLER                      PIC X(35)  VALUE                 02010000
020200     'END OF AP WORK RECORD AREA       **'.                       02020000
020300                                                                  02030000
020400*--------------------------------------------------------------*  02040000
020500* COMMUNICATIONS AREA FOR DB2                                  *  02050000
020600*--------------------------------------------------------------*  02060000
020700     COPY SQLCA2.                                                 02070000
020800                                                                  02080000
020900     EXEC SQL                                                     02090000
021000          INCLUDE SQLCA                                           02100000
021100     END-EXEC.                                                    02110000
021200                                                                  02120000
021300*--------------------------------------------------------------*  02130000
021400* AP CONTROL TABLE                                             *  02140000
021500*--------------------------------------------------------------*  02150000
021600     EXEC SQL                                                     02160000
021700          INCLUDE TAPCNTL                                         02170000
021800     END-EXEC.                                                    02180000
021900                                                                  02190000
022000*--------------------------------------------------------------*  02200000
022100* RECEIVING DISTRIBUTION TABLE                                 *  02210000
022200*--------------------------------------------------------------*  02220000
022300     EXEC SQL                                                     02230000
022400          INCLUDE TRECDIS                                         02240000
022500     END-EXEC.                                                    02250000
022600                                                                  02260000
022700*--------------------------------------------------------------*  02270000
022710* RECEIVING ITEM TABLE                                         *  02271000
022720*--------------------------------------------------------------*  02272000
022730     EXEC SQL                                                     02273000
022740          INCLUDE TRECITM                                         02274000
022750     END-EXEC.                                                    02275000
022760                                                                  02276000
022770*--------------------------------------------------------------*  02277000
022780* PURCHASE ORDER TABLE                                         *  02278000
022790*--------------------------------------------------------------*  02279000
022800     EXEC SQL                                                     02280000
022900          INCLUDE TPURCHS                                         02290000
023000     END-EXEC.                                                    02300000
023100                                                                  02310000
023200*--------------------------------------------------------------*  02320000
023300* PURCHASE ORDER ITEM TABLE                                    *  02330000
023400*--------------------------------------------------------------*  02340000
023500     EXEC SQL                                                     02350000
023600          INCLUDE TPURITM                                         02360000
023700     END-EXEC.                                                    02370000
023800                                                                  02380000
023900*--------------------------------------------------------------*  02390000
023910* NON-INVOICED RECEIPTS TABLE                                  *  02391000
023920*--------------------------------------------------------------*  02392000
023930     EXEC SQL                                                     02393000
023940          INCLUDE TNINREC                                         02394000
023950     END-EXEC.                                                    02395000
023960                                                                  02396000
023970*--------------------------------------------------------------*  02397000
023980* DETAIL ENTRY REPORT RECORDS                                  *  02398000
023990*--------------------------------------------------------------*  02399000
024000     EXEC SQL                                                     02400000
024100          INCLUDE TOUTAP6                                         02410000
024200     END-EXEC.                                                    02420000
024300                                                                  02430000
024400*--------------------------------------------------------------*  02440000
024500* RECEIVING SUMMED BY RECEIVER                                 *  02450000
024600*--------------------------------------------------------------*  02460000
024700     EXEC SQL                                                     02470000
024800          INCLUDE TOUTAPB                                         02480000
024900     END-EXEC.                                                    02490000
025000                                                                  02500000
025100*--------------------------------------------------------------*  02510000
025110* IMPORT PURCHASE ORDER RECEIVING RECORDS                      *  02511000
025120*--------------------------------------------------------------*  02512000
025130     EXEC SQL                                                     02513000
025140          INCLUDE TOUTAPC                                         02514000
025150     END-EXEC.                                                    02515000
025160                                                                  02516000
025170*--------------------------------------------------------------*  02517000
025180* RECEIVING KEYS FOR UPDATE                                    *  02518000
025190*--------------------------------------------------------------*  02519000
025200     EXEC SQL                                                     02520000
025300          INCLUDE TOUTAPD                                         02530000
025400     END-EXEC.                                                    02540000
025500                                                                  02550000
025600*--------------------------------------------------------------*  02560000
025700* CHECKPOINT RESTART CONTROL TABLE                             *  02570000
025800*--------------------------------------------------------------*  02580000
025900         EXEC SQL                                                 02590000
026000             INCLUDE TCKRSTCN                                     02600000
026100         END-EXEC.                                                02610000
026200                                                                  02620000
026300*--------------------------------------------------------------*  02630000
026400* CHECKPOINT RESTART INFORMATION TABLE                         *  02640000
026500*--------------------------------------------------------------*  02650000
026600         EXEC SQL                                                 02660000
026700             INCLUDE TCKRSTIN                                     02670000
026800         END-EXEC.                                                02680000
026900                                                                  02690000
027000*--------------------------------------------------------------*  02700000
027010* RECEIVING_CSR: TRECITM-TRECDIS-TPURITM JOIN                  *  02701000
027020*--------------------------------------------------------------*  02702000
027030     EXEC SQL                                                     02703000
027040       DECLARE RECEIVING_CSR   CURSOR FOR                         02704000
027050         SELECT                                                   02705000
027060               RD.CRE_TMST                                        02706000
027070             , RD.AP_VERIFY_ITM_QTY                               02707000
027080             , RD.STR_NBR                                         02708000
027090             , RD.STR_FCLTY_ID                                    02709000
027100             , RD.ORD_LNE_NBR                                     02710000
027200             , PI.APP_PO_LNE_NBR                                  02720000
027300             , PI.UNT_COST_AMT                                    02730000
027400             , PI.PRD_1ST_COST_AMT                                02740000
027500             , PI.CL_NBR                                          02750000
027600             , (RD.AP_VERIFY_ITM_QTY * PI.UNT_COST_AMT)           02760000
027700             , (RD.AP_VERIFY_ITM_QTY * PI.PRD_1ST_COST_AMT)       02770000
027800*               AS REC_TOT_COST_AMT                               02780000
027900             , RD.OPER_UNT_ID                                     02790000
028000          FROM                                                    02800005
028100               TRECDIS RD                                         02810000
028200             , TRECITM RI                                         02820000
028300             , TPURITM PI                                         02830000
028310         WHERE RI.ORD_NBR + 0       = :PV-PO-BEING-PROCESSED      02831005
028320           AND RI.REC_SEQ_NBR + 0   = :AP061-REC-SEQ-NBR          02832005
028330           AND RI.OPER_UNT_ID + 0   = :AP061-OPER-UNT-ID          02833005
028340           AND RI.FCLTY_ID + 0      = :AP061-FCLTY-ID             02834005
028350           AND PI.PO_NBR            = :PV-PO-BEING-PROCESSED      02835005
028360           AND PI.PO_NBR            = PI.PO_NBR                   02836005
028370           AND PI.VER_NBR           = PI.VER_NBR                  02837005
028380           AND PI.PO_LNE_NBR        = PI.PO_LNE_NBR               02838005
028400***REMOVED FOLLOWING 3 CONDITIONS AND REPLACED WITH ABOVE PER DBA 02840007
028410***      WHERE                                                    02841007
028500***            RI.ORD_NBR         = :PV-PO-BEING-PROCESSED        02850005
028600***        AND RI.REC_SEQ_NBR     = :AP061-REC-SEQ-NBR            02860005
028700***        AND RI.OPER_UNT_ID     = :AP061-OPER-UNT-ID            02870005
028800           AND RI.FCLTY_ID        = :AP061-FCLTY-ID               02880000
028900           AND RI.VER_STATUS_CDE  = 'A'                           02890000
029000           AND RI.ORD_NBR         = RD.ORD_NBR                    02900000
029100           AND RI.ORD_LNE_NBR     = RD.ORD_LNE_NBR                02910000
029200           AND RI.REC_SEQ_NBR     = RD.REC_SEQ_NBR                02920000
029300           AND RI.OPER_UNT_ID     = RD.OPER_UNT_ID                02930000
029400           AND RI.FCLTY_ID        = RD.FCLTY_ID                   02940000
029500           AND RD.VER_STATUS_CDE  = 'A'                           02950000
029600           AND RD.ORD_NBR         = PI.PO_NBR                     02960000
029700           AND RI.PO_VER_NBR      = PI.VER_NBR                    02970000
029800           AND RD.ORD_LNE_NBR     = PI.APP_PO_LNE_NBR             02980000
029900           AND RD.AP_PRC_CDE      = ' '                           02990000
030000         FOR FETCH ONLY                                           03000000
030100     END-EXEC.                                                    03010000
030200                                                                  03020000
030300*--------------------------------------------------------------*  03030000
030400* NINREC_CSR: GETS ALL OF THE DATA NEEDED                      *  03040000
030500*--------------------------------------------------------------*  03050000
030600     EXEC SQL        DECLARE NINREC_CSR CURSOR FOR                03060000
030700         SELECT                                                   03070000
030800             PO_NBR                                               03080000
030900           , PO_LNE_NBR                                           03090000
031000           , NON_INVC_SEQ_NBR                                     03100000
031100           , STR_NBR                                              03110000
031200           , NON_INVC_UNT_QTY                                     03120000
031300           , UNT_COST_AMT                                         03130000
031400           , REC_TMST                                             03140000
031500           , DC_NBR                                               03150000
031600         FROM                                                     03160000
031700             TNINREC                                              03170000
031800         WHERE                                                    03180000
031900               STATUS_CDE  = ' '                                  03190000
032000         ORDER BY                                                 03200000
032100               PO_NBR                                             03210000
032200             , PO_LNE_NBR                                         03220000
032300     END-EXEC.                                                    03230000
032400                                                                  03240000
032500 01  FILLER                        PIC X(25) VALUE                03250000
032600          '<====PV FOR APKUP039 ENDS'.                            03260000
032700                                                                  03270000
032800*---------------------------*                                     03280000
032900 PROCEDURE DIVISION.                                              03290000
033000*---------------------------*                                     03300000
033100 A100-MAINLINE.                                                   03310000
033200                                                                  03320000
033300     PERFORM H100-HOUSEKEEPING.                                   03330000
033400     PERFORM B100-PROCESSING                                      03340000
033500        UNTIL END-OF-RECEIPT-INPUT.                               03350000
033600     PERFORM D100-CHECKPOINT-COMMIT.                              03360000
033700                                                                  03370000
033800     SET NOT-END-OF-NINRECS TO TRUE.                              03380000
033900     PERFORM Y200-OPEN-NINREC-CSR.                                03390000
034000     PERFORM R300-FETCH-NINREC-CSR.                               03400000
034100                                                                  03410000
034200     PERFORM B300-PROCESS-NINRECS                                 03420000
034300        UNTIL END-OF-NINRECS.                                     03430000
034400                                                                  03440000
034500     PERFORM Y400-CLOSE-NINREC-CSR.                               03450000
034600     PERFORM Z900-END-OF-JOB.                                     03460000
034700     GOBACK.                                                      03470000
034800                                                                  03480000
034900*--------------------------------------------------------------*  03490000
035000* PROCESSED EACH RECEIVING PURCHASE ORDER                      *  03500000
035100*--------------------------------------------------------------*  03510000
035200 B100-PROCESSING.                                                 03520000
035300                                                                  03530000
035400     MOVE 'B100-PROCESSING  '    TO PV-ABEND-PARAGRAPH.           03540000
035500                                                                  03550000
035700     PERFORM D100-CHECKPOINT-COMMIT.                              03551010
035600     IF AP061-ORD-NBR NOT = PV-PO-BEING-PROCESSED                 03560000
035700*       PERFORM D100-CHECKPOINT-COMMIT                            03570010
035800        MOVE AP061-ORD-NBR TO PV-PO-BEING-PROCESSED               03580000
035900                                                                  03590000
036000        IF FIRST-READ                                             03600000
036100           PERFORM W400-INSERT-AP024-KEYS                         03610000
036200           SET NOT-FIRST-READ TO TRUE                             03620000
036300        END-IF                                                    03630000
036400                                                                  03640000
036500        PERFORM R400-GET-PO-DATA                                  03650000
036600     END-IF.                                                      03660000
036700                                                                  03670000
036800     MOVE 'N' TO END-OF-RECEIVING-CSR-SW.                         03680000
036900     PERFORM Y100-OPEN-RECEIVING-CSR.                             03690000
037000     PERFORM R200-FETCH-RECEIVING-CSR.                            03700000
037100     PERFORM B200-PROCESS-RECDIS                                  03710000
037200        UNTIL END-OF-RECEIVING-CSR                                03720000
037300     PERFORM Y300-CLOSE-RECEIVING-CSR.                            03730000
037400     PERFORM R100-READ-RECEIPTS.                                  03740000
037500                                                                  03750000
037600     IF NOT-END-OF-RECEIPT-INPUT                                  03760000
037700        PERFORM W400-INSERT-AP024-KEYS                            03770000
037800     END-IF.                                                      03780000
037900                                                                  03790000
038000*--------------------------------------------------------------*  03800000
038100* PROCESS RECEIPTS CURSOR                                      *  03810000
038200*--------------------------------------------------------------*  03820000
038300 B200-PROCESS-RECDIS.                                             03830000
038400                                                                  03840000
038500     MOVE 'B200-PROCESS-RECDIS' TO PV-ABEND-PARAGRAPH.            03850000
038600                                                                  03860000
038700     PERFORM W100-INSERT-AP021-RECV-SEQ.                          03870000
038800     IF PURCHS-PO-TYP-CDE = 'IM' OR 'IE' OR 'IF'                  03880000
038900        IF RECDIS-AP-VERIFY-ITM-QTY = 0                           03890000
039000          OR                                                      03900000
039100            ((PURITM-UNT-COST-AMT = 0) AND                        03910000
039200             (PURITM-PRD-1ST-COST-AMT = 0))                       03920000
039300          CONTINUE                                                03930000
039400        ELSE                                                      03940000
039500          PERFORM W500-INSERT-AP032-IMPORT                        03950000
039600        END-IF                                                    03960000
039700     END-IF.                                                      03970000
039800                                                                  03980000
039900     ADD 1 TO PV-RECDIS-INPUT-CNT.                                03990000
040000     SET RECDIS-PROCESS TO TRUE.                                  04000000
040100     PERFORM W400-INSERT-AP024-KEYS.                              04010000
040200     PERFORM W300-INSERT-AP271-ENTRY.                             04020000
040300                                                                  04030000
040400     PERFORM R200-FETCH-RECEIVING-CSR.                            04040000
040500                                                                  04050000
040600*--------------------------------------------------------------*  04060000
040700* PROCESS NINREC CURSOR                                        *  04070000
040800*--------------------------------------------------------------*  04080000
040900 B300-PROCESS-NINRECS.                                            04090000
041000                                                                  04100000
041100     MOVE 'B300-PROCESS-NINR' TO PV-ABEND-PARAGRAPH.              04110000
041200                                                                  04120000
041300     PERFORM W150-INSERT-AP021-NINR-SEQ.                          04130000
041400     SET NINREC-PROCESS TO TRUE.                                  04140000
041500     PERFORM W400-INSERT-AP024-KEYS.                              04150000
041600     PERFORM W350-INSERT-AP271-ENTRY.                             04160000
041700     PERFORM R300-FETCH-NINREC-CSR.                               04170000
041800                                                                  04180000
041900*--------------------------------------------------------------*  04190000
042000* DO THE CHECKPOINT RESTART AND THE COMMIT                     *  04200000
042100*--------------------------------------------------------------*  04210000
042200 D100-CHECKPOINT-COMMIT.                                          04220000
042300                                                                  04230000
042400     MOVE 'D100-CHECKPOINT-COMMIT' TO PV-ABEND-PARAGRAPH.         04240000
042500                                                                  04250000
042600     EXEC SQL                                                     04260000
042700       SET :CR-CURR-TMST = CURRENT TIMESTAMP                      04270011
042800     END-EXEC.                                                    04280000
042900                                                                  04290000
043000     EVALUATE TRUE                                                04300000
043100         WHEN SQLCODE = ZERO                                      04310000
043200              CONTINUE                                            04320000
043300        WHEN SQLWARN0 NOT = SPACES                                04330000
043400        WHEN SQLCODE  NOT = ZERO                                  04340000
043500            MOVE 'UNSUCCESSFUL SET TMST'                          04350000
043600                                TO PV-ABEND-OPERATION             04360000
043700            MOVE SPACES         TO PV-ABEND-STRUCTURE-1           04370000
043800            PERFORM Z999-DB2-ABEND                                04380000
043900     END-EVALUATE.                                                04390000
044000                                                                  04400000
044100     IF CR-CURR-TMST > CR-NEXT-TMST                               04410000
044200        MOVE PC-IN-PROCESS-CODE      TO PV-CKPT-STAT-CODE         04420000
044300        PERFORM U100-UPDATE-TCKRSTCNTL                            04430000
044400        PERFORM U200-UPDATE-TCKRSTINF                             04440000
044500        PERFORM U300-COMMIT                                       04450000
044600                                                                  04460000
044700        EXEC SQL                                                  04470000
044800*        SELECT (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)     04480011
044800         SELECT (CURRENT TIMESTAMP + .5 SECONDS)                  04481011
044900          INTO :CR-NEXT-TMST                                      04490000
045000          FROM TCKRSTCNTL                                         04500000
045100          WHERE PLAN_NAME = :PV-PROGRAM-NAME                      04510000
045200        END-EXEC                                                  04520000
045300                                                                  04530000
045400          EVALUATE TRUE                                           04540000
045500              WHEN SQLCODE = ZERO                                 04550000
045600                   CONTINUE                                       04560000
045700          WHEN SQLWARN0 NOT = SPACES                              04570000
045800          WHEN SQLCODE  NOT = ZERO                                04580000
045900              MOVE 'UNSUCCESSFUL NEXT TMST'                       04590000
046000                                  TO PV-ABEND-OPERATION           04600000
046100              MOVE SPACES         TO PV-ABEND-STRUCTURE-1         04610000
046200              PERFORM Z999-DB2-ABEND                              04620000
046300       END-EVALUATE                                               04630000
046400     END-IF.                                                      04640000
046500                                                                  04650000
046600*--------------------------------------------------------------*  04660000
046700* GET THE RESTART INFO                                         *  04670000
046800*--------------------------------------------------------------*  04680000
046900 D200-CHECKPOINT-RESTART.                                         04690000
047000                                                                  04700000
047100     MOVE 'D200-CHECKPOINT-RESTART' TO PV-ABEND-PARAGRAPH.        04710000
047200                                                                  04720000
047300     PERFORM R600-GET-CHECKPOINT-INFO.                            04730000
047400     MOVE TCKRSTINF-WORK-STRG-DESC-TEXT TO CKPT-RESTART-INFO.     04740000
047500                                                                  04750000
047600     PERFORM R100-READ-RECEIPTS                                   04760000
047700        WITH TEST AFTER                                           04770000
047800             UNTIL   (END-OF-RECEIPT-INPUT)     OR                04780000
047900             (AP061-ORD-NBR    > CR-PO-NBR).                      04790000
048000                                                                  04800000
048100     DISPLAY '***********************************************'.   04810000
048200     DISPLAY '** APKUP039 CHECKPOINT RESTART **'                  04820000
048300     DISPLAY '** PO NUMBER ON RESTART = '  AP061-ORD-NBR.         04830000
048400     DISPLAY '***********************************************'.   04840000
048500                                                                  04850000
048600     MOVE ZEROS                   TO PV-RECEIPT-IN-REC-CNT-C      04860000
048700                                     PV-RECDIS-INPUT-CNT-C        04870000
048800                                     PV-NINREC-INPUT-CNT-C        04880000
048900                                     PV-DETAIL-RECV-SEQ-CNT-C     04890000
049000                                     PV-DETAIL-ENTRY-REC-CNT-C    04900000
049100                                     PV-DETAIL-IMPRT-REC-CNT-C    04910000
049200                                     PV-UPDATE-KEYS-REC-CNT-C.    04920000
049300                                                                  04930000
049400     MOVE CR-PO-NBR               TO PV-PO-BEING-PROCESSED.       04940000
049500     MOVE CR-RECEIPT-IN-REC-CNT   TO PV-RECEIPT-IN-REC-CNT.       04950000
049600     MOVE CR-RECEIV-INPUT-CNT     TO PV-RECDIS-INPUT-CNT.         04960000
049700     MOVE CR-NINREC-INPUT-CNT     TO PV-NINREC-INPUT-CNT.         04970000
049800     MOVE CR-DTL-RECV-SEQ-CNT     TO PV-DETAIL-RECV-SEQ-CNT.      04980000
049900     MOVE CR-DETAIL-ENTRY-REC-CNT TO PV-DETAIL-ENTRY-REC-CNT.     04990000
050000     MOVE CR-UPDATE-KEYS-REC-CNT  TO PV-UPDATE-KEYS-REC-CNT.      05000000
050100     MOVE CR-DETAIL-IMPRT-REC-CNT TO PV-DETAIL-IMPRT-REC-CNT.     05010000
050200                                                                  05020000
050300*--------------------------------------------------------------*  05030000
050400* OPEN FILES AND GET THE BATCH PROCESS DATE                    *  05040000
050500*--------------------------------------------------------------*  05050000
050600 H100-HOUSEKEEPING.                                               05060000
050700                                                                  05070000
050800     MOVE 'H100-HOUSEKEEPING' TO PV-ABEND-PARAGRAPH.              05080000
050900                                                                  05090000
051000     OPEN  INPUT   RECEIPT-FILE.                                  05100000
051100     SET NOT-END-OF-RECEIPT-INPUT TO TRUE.                        05110000
051200                                                                  05120000
051300     INITIALIZE DCLTRECDIS                                        05130000
051400                DCLTRECITM                                        05140000
051500                DCLTPURITM                                        05150000
051600                DCLTNINREC                                        05160000
051700                DCLTOUTAP6                                        05170000
051800                DCLTOUTAPB                                        05180000
051900                DCLTOUTAPD.                                       05190000
052000                                                                  05200000
052100*READ  THE AP CONTROL RECORD                                      05210000
052200     INITIALIZE DCLTAPCNTL.                                       05220000
052300     PERFORM S100-GET-BATCH-PROCESS-DATE.                         05230000
052400                                                                  05240000
052500     PERFORM R500-GET-CHECKPOINT-CNTL.                            05250000
052600     MOVE PV-CKPT-STAT-CODE TO PS-RUN-TYPE-SW.                    05260000
052700                                                                  05270000
052800     IF RESTART-RUN                                               05280000
052900        PERFORM D200-CHECKPOINT-RESTART                           05290000
053000     ELSE                                                         05300000
053100        PERFORM R100-READ-RECEIPTS                                05310000
053200     END-IF.                                                      05320000
053300                                                                  05330000
053400*--------------------------------------------------------------*  05340000
053500* READ SELECTED INVOICE FILE                                   *  05350000
053600*--------------------------------------------------------------*  05360000
053700 R100-READ-RECEIPTS.                                              05370000
053800                                                                  05380000
053900     MOVE 'R100-READ-RECEIPTS  ' TO PV-ABEND-PARAGRAPH.           05390000
054000                                                                  05400000
054100     IF NOT-END-OF-RECEIPT-INPUT                                  05410000
054200        READ RECEIPT-FILE INTO AP061-RECORD                       05420000
054300          AT END  SET END-OF-RECEIPT-INPUT TO TRUE.               05430000
054400                                                                  05440000
054500     IF NOT-END-OF-RECEIPT-INPUT                                  05450000
054600        ADD 1 TO PV-RECEIPT-IN-REC-CNT-C                          05460000
054700        SET RECEIV-PROCESS TO TRUE                                05470000
054800     END-IF.                                                      05480000
054900                                                                  05490000
055000*--------------------------------------------------------------*  05500000
055100* RETRIEVES THE RECEIVING INFORMATION FROM THE TRECDIS,        *  05510000
055200* TRECITM, AND TPURITM TABLES.                                 *  05520000
055300*--------------------------------------------------------------*  05530000
055400 R200-FETCH-RECEIVING-CSR.                                        05540000
055500                                                                  05550000
055600     MOVE 'R200-FETCH-RECEIVING-CSR' TO PV-ABEND-PARAGRAPH.       05560000
055700                                                                  05570000
055800     EXEC SQL                                                     05580000
055900         FETCH RECEIVING_CSR                                      05590000
056000          INTO :RECDIS-CRE-TMST                                   05600000
056100             , :RECDIS-AP-VERIFY-ITM-QTY                          05610000
056200             , :RECDIS-STR-NBR                                    05620000
056300             , :RECDIS-STR-FCLTY-ID                               05630000
056400             , :RECDIS-ORD-LNE-NBR                                05640000
056500             , :PURITM-APP-PO-LNE-NBR                             05650000
056600             , :PURITM-UNT-COST-AMT                               05660000
056700             , :PURITM-PRD-1ST-COST-AMT                           05670000
056800             , :PURITM-CL-NBR                                     05680000
056900             , :PV-REC-TOT-COST-AMT                               05690000
057000             , :PV-REC-TOT-1ST-COST-AMT                           05700000
057100             , :RECDIS-OPER-UNT-ID                                05710000
057200     END-EXEC.                                                    05720000
057300                                                                  05730000
057400     EVALUATE TRUE                                                05740000
057500         WHEN SQLCODE = ZERO                                      05750000
057600              CONTINUE                                            05760000
057700                                                                  05770000
057800         WHEN SQLCODE = +100                                      05780000
057900              SET END-OF-RECEIVING-CSR TO TRUE                    05790000
058000                                                                  05800000
058100         WHEN SQLWARN0 NOT = SPACES                               05810000
058200         WHEN SQLCODE  NOT = ZERO                                 05820000
058300             MOVE 'UNSUCCESSFUL FETCH WITH RECEIVING CURSOR'      05830000
058400                                 TO PV-ABEND-OPERATION            05840000
058500             MOVE 'TRECDIS'      TO PV-ABEND-STRUCTURE-1          05850000
058600             MOVE 'TRECITM'      TO PV-ABEND-STRUCTURE-2          05860000
058700             MOVE 'TPURITM'      TO PV-ABEND-STRUCTURE-3          05870000
058800             MOVE SPACES         TO PV-ABEND-STRUCTURE-4          05880000
058900             PERFORM Z999-DB2-ABEND                               05890000
059000     END-EVALUATE.                                                05900000
059100                                                                  05910000
059200*--------------------------------------------------------------*  05920000
059300* RETRIEVES THE NINREC INFORMATION FROM THE TNINREC TABLE      *  05930000
059400*--------------------------------------------------------------*  05940000
059500 R300-FETCH-NINREC-CSR.                                           05950000
059600                                                                  05960000
059700     MOVE 'R300-FETCH-NINR-B' TO PV-ABEND-PARAGRAPH.              05970000
059800                                                                  05980000
059900     INITIALIZE DCLTNINREC.                                       05990000
060000                                                                  06000000
060100     EXEC SQL                                                     06010000
060200         FETCH NINREC_CSR                                         06020000
060300         INTO                                                     06030000
060400             :NINREC-PO-NBR                                       06040000
060500           , :NINREC-PO-LNE-NBR                                   06050000
060600           , :NINREC-NON-INVC-SEQ-NBR                             06060000
060700           , :NINREC-STR-NBR                                      06070000
060800           , :NINREC-NON-INVC-UNT-QTY                             06080000
060900           , :NINREC-UNT-COST-AMT                                 06090000
061000           , :NINREC-REC-TMST                                     06100000
061100           , :NINREC-DC-NBR                                       06110000
061200     END-EXEC.                                                    06120000
061300                                                                  06130000
061400     EVALUATE TRUE                                                06140000
061500         WHEN SQLCODE = ZERO                                      06150000
061600              ADD 1 TO PV-NINREC-INPUT-CNT                        06160000
061700                                                                  06170000
061800         WHEN SQLCODE = +100                                      06180000
061900              SET END-OF-NINRECS  TO TRUE                         06190000
062000                                                                  06200000
062100         WHEN SQLWARN0 NOT = SPACES                               06210000
062200         WHEN SQLCODE  NOT = ZERO                                 06220000
062300             MOVE 'UNSUCCESSFUL FETCH WITH TNINREC'               06230000
062400                                 TO PV-ABEND-OPERATION            06240000
062500             MOVE 'TNINREC'      TO PV-ABEND-STRUCTURE-1          06250000
062600             MOVE SPACES         TO PV-ABEND-STRUCTURE-2          06260000
062700                                    PV-ABEND-STRUCTURE-3          06270000
062800                                    PV-ABEND-STRUCTURE-4          06280000
062900             PERFORM Z999-DB2-ABEND                               06290000
063000     END-EVALUATE.                                                06300000
063100                                                                  06310000
063200*--------------------------------------------------------------*  06320000
063300* SELECT TPURCHS DATA FOR PO BEING PROCESSED.                  *  06330000
063400*--------------------------------------------------------------*  06340000
063500 R400-GET-PO-DATA.                                                06350000
063600                                                                  06360000
063700     MOVE 'R400-GET-PO-DATA' TO PV-ABEND-PARAGRAPH.               06370000
063800                                                                  06380000
063900     PERFORM WITH TEST AFTER                                      06390000
064000             VARYING PV-RETRY-COUNT FROM 1 BY 1                   06400000
064100             UNTIL   PV-RETRY-COUNT > PC-RETRY-MAX OR             06410000
064200                     SQLCODE = ZERO                               06420000
064300                                                                  06430000
064400             EXEC SQL                                             06440000
064500              SELECT PO_TYP_CDE                                   06450000
064600                    ,DEPT_NBR                                     06460000
064700               INTO :PURCHS-PO-TYP-CDE                            06470000
064800                   ,:PURCHS-DEPT-NBR                              06480000
064900               FROM TPURCHS                                       06490000
065000               WHERE PO_NBR = :PV-PO-BEING-PROCESSED              06500000
065100                AND  VER_STATUS_CDE = 'A'                         06510000
065200             END-EXEC                                             06520000
065300                                                                  06530000
065400             EVALUATE TRUE                                        06540000
065500                 WHEN SQLCODE = ZERO                              06550000
065600                 WHEN SQLCODE = -904                              06560000
065700                 WHEN SQLCODE = -913                              06570000
065800                      CONTINUE                                    06580000
065900                                                                  06590000
066000                 WHEN SQLWARN0 NOT = SPACES                       06600000
066100                 WHEN SQLCODE  NOT = ZERO                         06610000
066200                     DISPLAY 'PO IN ERROR = '                     06620000
066300                                            PV-PO-BEING-PROCESSED 06630000
066400                     MOVE 'UNSUCCESSFUL SELECT            '       06640000
066500                                         TO PV-ABEND-OPERATION    06650000
066600                     MOVE 'TPURCHS   '   TO PV-ABEND-STRUCTURE-1  06660000
066700                     MOVE SPACES         TO PV-ABEND-STRUCTURE-2  06670000
066800                                            PV-ABEND-STRUCTURE-3  06680000
066900                                            PV-ABEND-STRUCTURE-4  06690000
067000                     PERFORM Z999-DB2-ABEND                       06700000
067100             END-EVALUATE                                         06710000
067200     END-PERFORM.                                                 06720000
067300                                                                  06730000
067400     IF PV-RETRY-COUNT > PC-RETRY-MAX                             06740000
067500        MOVE 'MAX RETRIES EXCEEDED ON SELECT '                    06750000
067600                            TO PV-ABEND-OPERATION                 06760000
067700        MOVE 'TPURCHS   '   TO PV-ABEND-STRUCTURE-1               06770000
067800        MOVE SPACES         TO PV-ABEND-STRUCTURE-2               06780000
067900                               PV-ABEND-STRUCTURE-3               06790000
068000                               PV-ABEND-STRUCTURE-4               06800000
068100        PERFORM Z999-DB2-ABEND                                    06810000
068200     END-IF.                                                      06820000
068300                                                                  06830000
068400*--------------------------------------------------------------*  06840000
068500* SELECT CHECKPOINT RESTART CONTROL INFO.                      *  06850000
068600*--------------------------------------------------------------*  06860000
068700 R500-GET-CHECKPOINT-CNTL.                                        06870000
068800                                                                  06880000
068900     MOVE 'R500-GET-CHECKPOINT-CNTL' TO PV-ABEND-PARAGRAPH.       06890000
069000                                                                  06900000
069100     PERFORM WITH TEST AFTER                                      06910000
069200             VARYING PV-RETRY-COUNT FROM 1 BY 1                   06920000
069300             UNTIL   PV-RETRY-COUNT > PC-RETRY-MAX OR             06930000
069400                     SQLCODE = ZERO                               06940000
069500                                                                  06950000
069600             EXEC SQL                                             06960000
069700              SELECT CKPT_STAT_CODE                               06970000
069800               INTO :PV-CKPT-STAT-CODE                            06980000
069900               FROM TCKRSTCNTL                                    06990000
070000               WHERE PLAN_NAME = :PV-PROGRAM-NAME                 07000000
070100             END-EXEC                                             07010000
070200                                                                  07020000
070300             EVALUATE TRUE                                        07030000
070400                 WHEN SQLCODE = ZERO                              07040000
070500                 WHEN SQLCODE = -904                              07050000
070600                 WHEN SQLCODE = -913                              07060000
070700                      CONTINUE                                    07070000
070800                                                                  07080000
070900                 WHEN SQLWARN0 NOT = SPACES                       07090000
071000                 WHEN SQLCODE  NOT = ZERO                         07100000
071100                     MOVE 'UNSUCCESSFUL SELECT            '       07110000
071200                                         TO PV-ABEND-OPERATION    07120000
071300                     MOVE 'TCKRSTCNTL'   TO PV-ABEND-STRUCTURE-1  07130000
071400                     MOVE SPACES         TO PV-ABEND-STRUCTURE-2  07140000
071500                                            PV-ABEND-STRUCTURE-3  07150000
071600                                            PV-ABEND-STRUCTURE-4  07160000
071700                     PERFORM Z999-DB2-ABEND                       07170000
071800             END-EVALUATE                                         07180000
071900     END-PERFORM.                                                 07190000
072000                                                                  07200000
072100     IF PV-RETRY-COUNT > PC-RETRY-MAX                             07210000
072200        MOVE 'MAX RETRIES EXCEEDED ON SELECT '                    07220000
072300                            TO PV-ABEND-OPERATION                 07230000
072400        MOVE 'TCKRSTCNTL'   TO PV-ABEND-STRUCTURE-1               07240000
072500        MOVE SPACES         TO PV-ABEND-STRUCTURE-2               07250000
072600                               PV-ABEND-STRUCTURE-3               07260000
072700                               PV-ABEND-STRUCTURE-4               07270000
072800        PERFORM Z999-DB2-ABEND                                    07280000
072900     END-IF.                                                      07290000
073000                                                                  07300000
073100*--------------------------------------------------------------*  07310000
073200* SELECT CHECKPOINT RESTART WORKING STORAGE DESCRIPTION INFO   *  07320000
073300*--------------------------------------------------------------*  07330000
073400 R600-GET-CHECKPOINT-INFO.                                        07340000
073500                                                                  07350000
073600     MOVE 'R600-GET-CHECKPOINT-INFO' TO PV-ABEND-PARAGRAPH.       07360000
073700                                                                  07370000
073800     PERFORM WITH TEST AFTER                                      07380000
073900             VARYING PV-RETRY-COUNT FROM 1 BY 1                   07390000
074000             UNTIL   PV-RETRY-COUNT > PC-RETRY-MAX OR             07400000
074100                     SQLCODE = ZERO                               07410000
074200                                                                  07420000
074300             EXEC SQL                                             07430000
074400              SELECT WORK_STRG_DESC                               07440000
074500               INTO :TCKRSTINF-WORK-STRG-DESC                     07450000
074600               FROM TCKRSTINF                                     07460000
074700               WHERE PLAN_NAME = :PV-PROGRAM-NAME                 07470000
074800             END-EXEC                                             07480000
074900                                                                  07490000
075000             EVALUATE TRUE                                        07500000
075100                 WHEN SQLCODE = ZERO                              07510000
075200                 WHEN SQLCODE = -904                              07520000
075300                 WHEN SQLCODE = -913                              07530000
075400                      CONTINUE                                    07540000
075500                                                                  07550000
075600                 WHEN SQLWARN0 NOT = SPACES                       07560000
075700                 WHEN SQLCODE  NOT = ZERO                         07570000
075800                     MOVE 'UNSUCCESSFUL SELECT'                   07580000
075900                                         TO PV-ABEND-OPERATION    07590000
076000                     MOVE 'TCKRSTINF'    TO PV-ABEND-STRUCTURE-1  07600000
076100                     MOVE SPACES         TO PV-ABEND-STRUCTURE-2  07610000
076200                                            PV-ABEND-STRUCTURE-3  07620000
076300                                            PV-ABEND-STRUCTURE-4  07630000
076400                     PERFORM Z999-DB2-ABEND                       07640000
076500             END-EVALUATE                                         07650000
076600     END-PERFORM.                                                 07660000
076700                                                                  07670000
076800     IF PV-RETRY-COUNT > PC-RETRY-MAX                             07680000
076900        MOVE 'MAX RETRIES EXCEEDED ON SELECT '                    07690000
077000                            TO PV-ABEND-OPERATION                 07700000
077100        MOVE 'TCKRSTINF '   TO PV-ABEND-STRUCTURE-1               07710000
077200        MOVE SPACES         TO PV-ABEND-STRUCTURE-2               07720000
077300                               PV-ABEND-STRUCTURE-3               07730000
077400                               PV-ABEND-STRUCTURE-4               07740000
077500         PERFORM Z999-DB2-ABEND                                   07750000
077600     END-IF.                                                      07760000
077700                                                                  07770000
077800*--------------------------------------------------------------*  07780000
077900* SELECT BATCH PROCESS DATE FROM AP CONTROL TABLE.             *  07790000
078000*--------------------------------------------------------------*  07800000
078100 S100-GET-BATCH-PROCESS-DATE.                                     07810000
078200                                                                  07820000
078300     EXEC SQL                                                     07830000
078400         SELECT BTCH_PRC_DTE                                      07840000
078500           INTO :APCNTL-BTCH-PRC-DTE                              07850000
078600           FROM TAPCNTL                                           07860000
078700     END-EXEC.                                                    07870000
078800                                                                  07880000
078900     EVALUATE TRUE                                                07890000
079000         WHEN SQLCODE = ZERO                                      07900000
079100              CONTINUE                                            07910000
079200                                                                  07920000
079300         WHEN SQLWARN0 = SPACES                                   07930000
079400         WHEN SQLCODE NOT = ZERO                                  07940000
079500           MOVE 'H100- '              TO PV-ABEND-PARAGRAPH       07950000
079600           MOVE 'UNSUCCESSFUL SELECT' TO PV-ABEND-OPERATION       07960000
079700           MOVE 'TAPCNTL'             TO PV-ABEND-STRUCTURE-1     07970000
079800           MOVE SPACES                TO PV-ABEND-STRUCTURE-2     07980000
079900           PERFORM Z999-DB2-ABEND                                 07990000
080000     END-EVALUATE.                                                08000000
080100                                                                  08010000
080200*--------------------------------------------------------------*  08020000
080300* UPDATES THE CHECKPOINT RESTART CONTROL TABLE.  THE STATUS    *  08030000
080400* CODE IS SET TO '9' (RUN IN PROGRESS) OR '0' (RUN COMPLETE).  *  08040000
080500*--------------------------------------------------------------*  08050000
080600 U100-UPDATE-TCKRSTCNTL.                                          08060000
080700                                                                  08070000
080800     MOVE 'U100-UPDATE-TCKRSTCNTL' TO PV-ABEND-PARAGRAPH.         08080000
080900                                                                  08090000
081000     PERFORM WITH TEST AFTER                                      08100000
081100             VARYING PV-RETRY-COUNT FROM 1 BY 1                   08110000
081200             UNTIL   PV-RETRY-COUNT > PC-RETRY-MAX OR             08120000
081300                     SQLCODE = ZERO                               08130000
081400                                                                  08140000
081500             EXEC SQL                                             08150000
081600                 UPDATE TCKRSTCNTL                                08160000
081700                 SET CKPT_STAT_CODE = :PV-CKPT-STAT-CODE          08170000
081800                 WHERE PLAN_NAME      = :PV-PROGRAM-NAME          08180000
081900             END-EXEC                                             08190000
082000                                                                  08200000
082100             EVALUATE TRUE                                        08210000
082200                 WHEN SQLCODE = ZERO                              08220000
082300                 WHEN SQLCODE = -904                              08230000
082400                 WHEN SQLCODE = -913                              08240000
082500                      CONTINUE                                    08250000
082600                                                                  08260000
082700                 WHEN SQLWARN0 NOT = SPACES                       08270000
082800                 WHEN SQLCODE  NOT = ZERO                         08280000
082900                     MOVE 'UNSUCCESSFUL UPDATE            '       08290000
083000                                         TO PV-ABEND-OPERATION    08300000
083100                     MOVE 'TCKRSTCNTL'   TO PV-ABEND-STRUCTURE-1  08310000
083200                     MOVE SPACES         TO PV-ABEND-STRUCTURE-2  08320000
083300                                            PV-ABEND-STRUCTURE-3  08330000
083400                                            PV-ABEND-STRUCTURE-4  08340000
083500                     PERFORM Z999-DB2-ABEND                       08350000
083600             END-EVALUATE                                         08360000
083700     END-PERFORM.                                                 08370000
083800                                                                  08380000
083900     IF PV-RETRY-COUNT > PC-RETRY-MAX                             08390000
084000        MOVE 'MAX RETRIES EXCEEDED ON UPDATE '                    08400000
084100                            TO PV-ABEND-OPERATION                 08410000
084200        MOVE 'TCKRSTCNTL'   TO PV-ABEND-STRUCTURE-1               08420000
084300        MOVE SPACES         TO PV-ABEND-STRUCTURE-2               08430000
084400                               PV-ABEND-STRUCTURE-3               08440000
084500                               PV-ABEND-STRUCTURE-4               08450000
084600         PERFORM Z999-DB2-ABEND                                   08460000
084700     END-IF.                                                      08470000
084800                                                                  08480000
084900*--------------------------------------------------------------*  08490000
085000* UPDATES THE CHECKPOINT RESTART INFO TABLE.  THE WORKING      *  08500000
085100* STORAGE DESCRIPTION FIELD IS UPDATED WITH THE LAST COMMITED  *  08510000
085200* PO STORE NUMBER COMBINATION.                                 *  08520000
085300*--------------------------------------------------------------*  08530000
085400 U200-UPDATE-TCKRSTINF.                                           08540000
085500                                                                  08550000
085600     MOVE 'U200-UPDATE-TCKRSTINF' TO PV-ABEND-PARAGRAPH.          08560000
085700                                                                  08570000
085800     MOVE PV-PO-BEING-PROCESSED   TO CR-PO-NBR.                   08580000
085900                                                                  08590000
086000     PERFORM U250-COMPUTE-CNTS.                                   08600000
086100                                                                  08610000
086200     MOVE PV-RECEIPT-IN-REC-CNT   TO CR-RECEIPT-IN-REC-CNT.       08620000
086300     MOVE PV-RECDIS-INPUT-CNT     TO CR-RECEIV-INPUT-CNT.         08630000
086400     MOVE PV-NINREC-INPUT-CNT     TO CR-NINREC-INPUT-CNT.         08640000
086500     MOVE PV-DETAIL-RECV-SEQ-CNT  TO CR-DTL-RECV-SEQ-CNT.         08650000
086600     MOVE PV-DETAIL-ENTRY-REC-CNT TO CR-DETAIL-ENTRY-REC-CNT.     08660000
086700     MOVE PV-DETAIL-IMPRT-REC-CNT TO CR-DETAIL-IMPRT-REC-CNT.     08670000
086800     MOVE PV-UPDATE-KEYS-REC-CNT  TO CR-UPDATE-KEYS-REC-CNT.      08680000
086900                                                                  08690000
087000     MOVE CKPT-RESTART-INFO   TO TCKRSTINF-WORK-STRG-DESC-TEXT.   08700000
087100     MOVE 4022                TO TCKRSTINF-WORK-STRG-DESC-LEN.    08710000
087200                                                                  08720000
087300     PERFORM WITH TEST AFTER                                      08730000
087400             VARYING PV-RETRY-COUNT FROM 1 BY 1                   08740000
087500             UNTIL   PV-RETRY-COUNT > PC-RETRY-MAX OR             08750000
087600                     SQLCODE = ZERO                               08760000
087700                                                                  08770000
087800             EXEC SQL                                             08780000
087900                 UPDATE TCKRSTINF                                 08790000
088000                 SET WORK_STRG_DESC   = :TCKRSTINF-WORK-STRG-DESC 08800000
088100                 WHERE PLAN_NAME      = :PV-PROGRAM-NAME          08810000
088200             END-EXEC                                             08820000
088300                                                                  08830000
088400             EVALUATE TRUE                                        08840000
088500                 WHEN SQLCODE = ZERO                              08850000
088600                 WHEN SQLCODE = -904                              08860000
088700                 WHEN SQLCODE = -913                              08870000
088800                      CONTINUE                                    08880000
088900                                                                  08890000
089000                 WHEN SQLWARN0 NOT = SPACES                       08900000
089100                 WHEN SQLCODE  NOT = ZERO                         08910000
089200                     MOVE 'UNSUCCESSFUL UPDATE            '       08920000
089300                                         TO PV-ABEND-OPERATION    08930000
089400                     MOVE 'TCKRSTINF '   TO PV-ABEND-STRUCTURE-1  08940000
089500                     MOVE SPACES         TO PV-ABEND-STRUCTURE-2  08950000
089600                                            PV-ABEND-STRUCTURE-3  08960000
089700                                            PV-ABEND-STRUCTURE-4  08970000
089800                     PERFORM Z999-DB2-ABEND                       08980000
089900             END-EVALUATE                                         08990000
090000     END-PERFORM.                                                 09000000
090100                                                                  09010000
090200     IF PV-RETRY-COUNT > PC-RETRY-MAX                             09020000
090300        MOVE 'MAX RETRIES EXCEEDED ON UPDATE '                    09030000
090400                            TO PV-ABEND-OPERATION                 09040000
090500        MOVE 'TCKRSTINF '   TO PV-ABEND-STRUCTURE-1               09050000
090600        MOVE SPACES         TO PV-ABEND-STRUCTURE-2               09060000
090700                               PV-ABEND-STRUCTURE-3               09070000
090800                               PV-ABEND-STRUCTURE-4               09080000
090900         PERFORM Z999-DB2-ABEND                                   09090000
091000     END-IF.                                                      09100000
091100                                                                  09110000
091200     MOVE ZEROS               TO PV-RECEIPT-IN-REC-CNT-C          09120000
091300                                 PV-RECDIS-INPUT-CNT-C            09130000
091400                                 PV-NINREC-INPUT-CNT-C            09140000
091500                                 PV-DETAIL-RECV-SEQ-CNT-C         09150000
091600                                 PV-DETAIL-ENTRY-REC-CNT-C        09160000
091700                                 PV-DETAIL-IMPRT-REC-CNT-C        09170000
091800                                 PV-UPDATE-KEYS-REC-CNT-C.        09180000
091900                                                                  09190000
092000*--------------------------------------------------------------*  09200000
092100* COMPUTE THE RECORD COUNTS                                    *  09210000
092200*--------------------------------------------------------------*  09220000
092300 U250-COMPUTE-CNTS.                                               09230000
092400                                                                  09240000
092500     COMPUTE PV-RECEIPT-IN-REC-CNT                                09250000
092600        =    PV-RECEIPT-IN-REC-CNT                                09260000
092700        +    PV-RECEIPT-IN-REC-CNT-C.                             09270000
092800     COMPUTE PV-RECDIS-INPUT-CNT                                  09280000
092900        =    PV-RECDIS-INPUT-CNT                                  09290000
093000        +    PV-RECDIS-INPUT-CNT-C.                               09300000
093100     COMPUTE PV-NINREC-INPUT-CNT                                  09310000
093200        =    PV-NINREC-INPUT-CNT                                  09320000
093300        +    PV-NINREC-INPUT-CNT-C.                               09330000
093400                                                                  09340000
093500     COMPUTE PV-DETAIL-RECV-SEQ-CNT                               09350000
093600        =    PV-DETAIL-RECV-SEQ-CNT                               09360000
093700        +    PV-DETAIL-RECV-SEQ-CNT-C.                            09370000
093800     COMPUTE PV-DETAIL-ENTRY-REC-CNT                              09380000
093900        =    PV-DETAIL-ENTRY-REC-CNT                              09390000
094000        +    PV-DETAIL-ENTRY-REC-CNT-C.                           09400000
094100     COMPUTE PV-DETAIL-IMPRT-REC-CNT                              09410000
094200        =    PV-DETAIL-IMPRT-REC-CNT                              09420000
094300        +    PV-DETAIL-IMPRT-REC-CNT-C.                           09430000
094400     COMPUTE PV-UPDATE-KEYS-REC-CNT                               09440000
094500        =    PV-UPDATE-KEYS-REC-CNT                               09450000
094600        +    PV-UPDATE-KEYS-REC-CNT-C.                            09460000
094700                                                                  09470000
094800*--------------------------------------------------------------*  09480000
094900* ISSUES AN SQL COMMIT WORK AFTER A LUW HAS BEEN COMPLETED.    *  09490000
095000*--------------------------------------------------------------*  09500000
095100 U300-COMMIT.                                                     09510000
095200                                                                  09520000
095300     MOVE 'U300-COMMIT'    TO PV-ABEND-PARAGRAPH.                 09530000
095400                                                                  09540000
095500     EXEC SQL                                                     09550000
095600         COMMIT                                                   09560000
095700     END-EXEC.                                                    09570000
095800                                                                  09580000
095900     EVALUATE TRUE                                                09590000
096000         WHEN SQLCODE = ZEROS                                     09600000
096100             CONTINUE                                             09610000
096200         WHEN OTHER                                               09620000
096300             MOVE 'UNSUCCESSFUL COMMIT' TO PV-ABEND-OPERATION     09630000
096400             MOVE SPACES         TO PV-ABEND-STRUCTURE-1          09640000
096500             PERFORM Z999-DB2-ABEND                               09650000
096600     END-EVALUATE.                                                09660000
096700                                                                  09670000
096800*--------------------------------------------------------------*  09680000
096900* INSERT RECEIVING RECORD                                      *  09690000
097000*--------------------------------------------------------------*  09700000
097100 W100-INSERT-AP021-RECV-SEQ.                                      09710000
097200                                                                  09720000
097300     MOVE 'W100-INSERT-AP021'    TO PV-ABEND-PARAGRAPH.           09730000
097400                                                                  09740000
097500     MOVE SPACES                   TO AP021-RECORD.               09750000
097600     MOVE SPACES                   TO AP021-VENDOR-NAME.          09760000
097700     MOVE ZEROS                    TO AP021-VENDOR-NBR.           09770000
097800     MOVE PV-PO-BEING-PROCESSED    TO AP021-PO-NBR.               09780000
097900     MOVE RECDIS-STR-NBR           TO AP021-STR-NBR.              09790000
098000     MOVE AP061-REC-SEQ-NBR        TO AP021-REC-SEQ-NBR.          09800000
098001                                                                  09800108
098010*** CHANGED TO USE VERIFY DATE INSTEAD OF RECEIPT DATE DURING     09801008
098020*** POST COVID-19 PROCESSING WHEN THE DCS REOPENED AND WERE       09802008
098030*** VERIFYING GOODS THAT HAD ARRIVED 3 MONTHS EARLIER.            09803008
098100     MOVE AP061-VERFYD-TMST(1:10)  TO AP021-REC-DATE.             09810008
098110**   MOVE AP061-REC-TMST(1:10)     TO AP021-REC-DATE.             09811008
098120                                                                  09812008
098200     MOVE RECDIS-AP-VERIFY-ITM-QTY TO AP021-REC-TOT-QTY.          09820000
098300     MOVE RECDIS-OPER-UNT-ID       TO AP021-DC-NBR.               09830000
098400                                                                  09840000
098500     IF  PURCHS-PO-TYP-CDE = 'IM' OR 'IE' OR 'IF'                 09850000
098600         MOVE PV-REC-TOT-COST-AMT TO AP021-REC-TOT-COST-AMT       09860000
098700     ELSE                                                         09870000
098710         MOVE PV-REC-TOT-1ST-COST-AMT TO AP021-REC-TOT-COST-AMT   09871000
098720     END-IF.                                                      09872000
098730                                                                  09873000
098740     SET AP021-TYP-RCV TO TRUE.                                   09874000
098750     MOVE AP021-RECORD TO OUTAPB-RCVGSUM-RCVR-ODR.                09875000
098760                                                                  09876000
098770     EXEC SQL                                                     09877000
098780          INSERT INTO TOUTAPB                                     09878006
098790                  (RCVGSUM_RCVR_ODR)                              09879000
098800          VALUES  (:OUTAPB-RCVGSUM-RCVR-ODR)                      09880000
098900     END-EXEC.                                                    09890000
099000                                                                  09900000
099100     EVALUATE TRUE                                                09910000
099200         WHEN SQLCODE = ZERO                                      09920000
099300              CONTINUE                                            09930000
099400         WHEN SQLWARN0 NOT = SPACES                               09940000
099500         WHEN SQLCODE  NOT = ZERO                                 09950000
099600             MOVE 'UNSUCCESFUL INSERT ' TO PV-ABEND-OPERATION     09960000
099700             MOVE 'TOUTAPB'             TO PV-ABEND-STRUCTURE-1   09970000
099800             PERFORM Z999-DB2-ABEND                               09980000
099900     END-EVALUATE.                                                09990000
100000                                                                  10000000
100100     ADD 1 TO PV-DETAIL-RECV-SEQ-CNT-C.                           10010000
100200                                                                  10020000
100300*--------------------------------------------------------------*  10030000
100400* INSERT RECEIVING NON-INVOICED RECORD                         *  10040000
100500*--------------------------------------------------------------*  10050000
100600 W150-INSERT-AP021-NINR-SEQ.                                      10060000
100700                                                                  10070000
100800     MOVE 'W150-INSERT-AP021'     TO PV-ABEND-PARAGRAPH.          10080000
100900                                                                  10090000
101000     MOVE SPACES                  TO AP021-RECORD.                10100000
101100     MOVE SPACES                  TO AP021-VENDOR-NAME.           10110000
101200     MOVE ZEROS                   TO AP021-VENDOR-NBR.            10120000
101300     MOVE NINREC-PO-NBR           TO AP021-PO-NBR.                10130000
101400     MOVE NINREC-STR-NBR          TO AP021-STR-NBR.               10140000
101500     MOVE NINREC-NON-INVC-SEQ-NBR TO AP021-REC-SEQ-NBR.           10150000
101600     MOVE NINREC-REC-TMST(1:10)   TO AP021-REC-DATE.              10160000
101700     COMPUTE AP021-REC-TOT-COST-AMT                               10170000
101800        =    NINREC-NON-INVC-UNT-QTY                              10180000
101900        *    NINREC-UNT-COST-AMT.                                 10190000
102000     MOVE NINREC-NON-INVC-UNT-QTY TO AP021-REC-TOT-QTY.           10200000
102100     MOVE NINREC-DC-NBR           TO AP021-DC-NBR.                10210000
102200     SET AP021-TYP-NIR            TO TRUE.                        10220000
102300     MOVE AP021-RECORD            TO OUTAPB-RCVGSUM-RCVR-ODR.     10230000
102400                                                                  10240000
102500     EXEC SQL                                                     10250000
102600          INSERT INTO TOUTAPB                                     10260006
102700                  (RCVGSUM_RCVR_ODR)                              10270000
102800          VALUES  (:OUTAPB-RCVGSUM-RCVR-ODR)                      10280000
102900     END-EXEC.                                                    10290000
103000                                                                  10300000
103100     EVALUATE TRUE                                                10310000
103200         WHEN SQLCODE = ZERO                                      10320000
103300              CONTINUE                                            10330000
103400         WHEN SQLWARN0 NOT = SPACES                               10340000
103500         WHEN SQLCODE  NOT = ZERO                                 10350000
103600             MOVE 'UNSUCCESFUL INSERT ' TO PV-ABEND-OPERATION     10360000
103700             MOVE 'TOUTAPB'             TO PV-ABEND-STRUCTURE-1   10370000
103800             MOVE SPACES                TO PV-ABEND-STRUCTURE-2   10380000
103900                                           PV-ABEND-STRUCTURE-3   10390000
104000                                           PV-ABEND-STRUCTURE-4   10400000
104100             PERFORM Z999-DB2-ABEND                               10410000
104200     END-EVALUATE.                                                10420000
104300                                                                  10430000
104400     ADD 1 TO PV-DETAIL-RECV-SEQ-CNT-C.                           10440000
104500                                                                  10450000
104600*--------------------------------------------------------------*  10460000
104700* INSERT DETAIL ENTRY RECORD                                   *  10470000
104800*--------------------------------------------------------------*  10480000
104900 W300-INSERT-AP271-ENTRY.                                         10490000
105000                                                                  10500000
105100     MOVE 'W300-INSERT-AP271'     TO PV-ABEND-PARAGRAPH.          10510000
105200                                                                  10520000
105300     MOVE SPACES                  TO   AP271-RECORD.              10530000
105400     INITIALIZE                        AP271-SORT-AREA.           10540000
105500     SET PO-LINE-REC              TO   TRUE.                      10550000
105600                                                                  10560000
105700     MOVE SPACES                  TO   AP271-VENDOR-NAME.         10570000
105800     MOVE PV-PO-BEING-PROCESSED   TO   AP271-PURCHASE-ORDER.      10580000
105900     MOVE RECDIS-STR-NBR          TO   AP271-STORE-NUMBER.        10590000
106000     MOVE RECDIS-ORD-LNE-NBR      TO   AP271-APP-PO-LINE-NBR.     10600000
106100     MOVE RECDIS-AP-VERIFY-ITM-QTY TO  AP271-RCVD-UNIT-QTY.       10610000
106200                                                                  10620000
106300     IF  PURCHS-PO-TYP-CDE = 'IM' OR 'IE' OR 'IF'                 10630000
106400         MOVE PURITM-UNT-COST-AMT TO AP271-RCVD-UNIT-COST         10640000
106500     ELSE                                                         10650000
106600         MOVE PURITM-PRD-1ST-COST-AMT TO AP271-RCVD-UNIT-COST     10660000
106700     END-IF.                                                      10670000
106800                                                                  10680000
106900     MOVE RECDIS-OPER-UNT-ID      TO   AP271-DC-NBR.              10690000
107000     MOVE AP271-RECORD            TO OUTAP6-DTL-ENTR-RPT-ODR.     10700000
107100                                                                  10710000
107200     EXEC SQL                                                     10720000
107300          INSERT INTO TOUTAP6                                     10730006
107400                  (DTL_ENTR_RPT_ODR)                              10740000
107500          VALUES  (:OUTAP6-DTL-ENTR-RPT-ODR)                      10750000
107600     END-EXEC.                                                    10760000
107610                                                                  10761000
107620     EVALUATE TRUE                                                10762000
107630         WHEN SQLCODE = ZERO                                      10763000
107640              CONTINUE                                            10764000
107650         WHEN SQLWARN0 NOT = SPACES                               10765000
107660         WHEN SQLCODE  NOT = ZERO                                 10766000
107670             MOVE 'UNSUCCESFUL INSERT ' TO PV-ABEND-OPERATION     10767000
107680             MOVE 'TOUTAP6'             TO PV-ABEND-STRUCTURE-1   10768000
107690             MOVE SPACES                TO PV-ABEND-STRUCTURE-2   10769000
107700                                           PV-ABEND-STRUCTURE-3   10770000
107800                                           PV-ABEND-STRUCTURE-4   10780000
107900             PERFORM Z999-DB2-ABEND                               10790000
108000     END-EVALUATE.                                                10800000
108100                                                                  10810000
108200     ADD 1 TO PV-DETAIL-ENTRY-REC-CNT-C.                          10820000
108300                                                                  10830000
108400*--------------------------------------------------------------*  10840000
108500* INSERT DETAIL ENTRY RECORD                                   *  10850000
108600*--------------------------------------------------------------*  10860000
108700 W350-INSERT-AP271-ENTRY.                                         10870000
108800                                                                  10880000
108900     MOVE 'W350-INSERT-AP271'    TO PV-ABEND-PARAGRAPH.           10890000
109000                                                                  10900000
109100     MOVE SPACES                 TO   AP271-RECORD.               10910000
109200     INITIALIZE                       AP271-SORT-AREA.            10920000
109300     SET PO-LINE-REC             TO   TRUE.                       10930000
109400                                                                  10940000
109500     MOVE SPACES                 TO   AP271-VENDOR-NAME.          10950000
109600     MOVE NINREC-PO-NBR          TO   AP271-PURCHASE-ORDER.       10960000
109700     MOVE NINREC-STR-NBR         TO   AP271-STORE-NUMBER.         10970000
109800     MOVE NINREC-PO-LNE-NBR      TO   AP271-APP-PO-LINE-NBR.      10980000
109900     MOVE NINREC-NON-INVC-UNT-QTY                                 10990000
110000                                 TO   AP271-RCVD-UNIT-QTY.        11000000
110100     MOVE NINREC-UNT-COST-AMT    TO   AP271-RCVD-UNIT-COST.       11010000
110200     MOVE NINREC-DC-NBR          TO   AP271-DC-NBR.               11020000
110300     MOVE AP271-RECORD           TO OUTAP6-DTL-ENTR-RPT-ODR.      11030000
110400                                                                  11040000
110500     EXEC SQL                                                     11050000
110600          INSERT INTO TOUTAP6                                     11060006
110700                  (DTL_ENTR_RPT_ODR)                              11070000
110800          VALUES  (:OUTAP6-DTL-ENTR-RPT-ODR)                      11080000
110900     END-EXEC.                                                    11090000
111000                                                                  11100000
111100     EVALUATE TRUE                                                11110000
111200         WHEN SQLCODE = ZERO                                      11120000
111300              CONTINUE                                            11130000
111400         WHEN SQLWARN0 NOT = SPACES                               11140000
111500         WHEN SQLCODE  NOT = ZERO                                 11150000
111600             MOVE 'UNSUCCESFUL INSERT ' TO PV-ABEND-OPERATION     11160000
111700             MOVE 'TOUTAP6'             TO PV-ABEND-STRUCTURE-1   11170000
111800             MOVE SPACES                TO PV-ABEND-STRUCTURE-2   11180000
111900                                           PV-ABEND-STRUCTURE-3   11190000
112000                                           PV-ABEND-STRUCTURE-4   11200000
112100             PERFORM Z999-DB2-ABEND                               11210000
112200     END-EVALUATE.                                                11220000
112300                                                                  11230000
112400     ADD 1 TO PV-DETAIL-ENTRY-REC-CNT-C.                          11240000
112500                                                                  11250000
112600*--------------------------------------------------------------*  11260000
112700* INSERT RECEIVING KEY RECORD                                  *  11270000
112800*--------------------------------------------------------------*  11280000
112900 W400-INSERT-AP024-KEYS.                                          11290000
113000                                                                  11300000
113100     MOVE 'W400-INSERT-AP024-KEYS' TO PV-ABEND-PARAGRAPH.         11310000
113200                                                                  11320000
113300     MOVE SPACES                   TO AP024-RECORD.               11330000
113400*    MOVE PV-PO-BEING-PROCESSED    TO AP024-SRT-PURCHASE-ORDER.   11340000
113500     MOVE AP061-ORD-NBR            TO AP024-SRT-PURCHASE-ORDER.   11350000
113600     MOVE APCNTL-BTCH-PRC-DTE      TO AP024-AP-PRC-DTE.           11360000
113700                                                                  11370000
113800     IF RECEIV-PROCESS                                            11380000
113900        SET AP024-TRECEIV-UPDATE    TO TRUE                       11390000
114000*       MOVE PV-PO-BEING-PROCESSED  TO AP024-RC-PURCHASE-ORDER    11400000
114100        MOVE AP061-ORD-NBR          TO AP024-RC-PURCHASE-ORDER    11410000
114200        MOVE AP061-OPER-UNT-ID      TO AP024-SRT-STORE-NBR        11420000
114300                                       AP024-DC-NBR               11430000
114400        MOVE AP061-REC-SEQ-NBR      TO AP024-RC-RECVR-SEQ-NBR     11440000
114500        MOVE AP061-CRE-TMST         TO AP024-RC-CRE-TMST          11450000
114600     ELSE                                                         11460000
114700        IF RECDIS-PROCESS                                         11470000
114800           SET AP024-TRECDIS-UPDATE TO TRUE                       11480000
114900           MOVE PV-PO-BEING-PROCESSED TO AP024-RD-PURCHASE-ORDER  11490000
115000           MOVE RECDIS-ORD-LNE-NBR  TO AP024-RD-PO-LNE-NBR        11500000
115100           MOVE AP061-REC-SEQ-NBR   TO AP024-RD-REC-SEQ-NBR       11510000
115200           MOVE AP061-OPER-UNT-ID   TO AP024-RD-OPER-UNIT-ID      11520000
115300                                       AP024-DC-NBR               11530000
115400           MOVE AP061-FCLTY-ID      TO AP024-RD-FACILITY-ID       11540000
115500           MOVE RECDIS-STR-NBR      TO AP024-RD-STORE-NBR         11550000
115600                                       AP024-SRT-STORE-NBR        11560000
115700           MOVE RECDIS-STR-FCLTY-ID TO AP024-RD-STORE-FCLTY-ID    11570000
115800           MOVE RECDIS-CRE-TMST     TO AP024-RD-CRE-TMST          11580000
115810        ELSE                                                      11581000
115820           IF NINREC-PROCESS                                      11582000
115830              SET AP024-TNINREC-UPDATE TO TRUE                    11583000
115840              MOVE NINREC-PO-NBR    TO AP024-SRT-PURCHASE-ORDER   11584000
115850                                       AP024-NR-PURCHASE-ORDER    11585000
115860              MOVE NINREC-STR-NBR   TO AP024-SRT-STORE-NBR        11586000
115870              MOVE NINREC-PO-LNE-NBR                              11587000
115880                                    TO AP024-NR-PO-LNE-NBR        11588000
115890              MOVE NINREC-NON-INVC-SEQ-NBR                        11589000
115900                                    TO AP024-NR-NINVC-SEQ-NBR     11590000
116000              MOVE NINREC-DC-NBR    TO AP024-DC-NBR               11600000
116100           END-IF                                                 11610000
116200        END-IF                                                    11620000
116300     END-IF.                                                      11630000
116400     MOVE AP024-RECORD           TO OUTAPD-RCVG-UPD-KYS-ODR.      11640000
116500                                                                  11650000
116600     EXEC SQL                                                     11660000
116700          INSERT INTO TOUTAPD                                     11670006
116800                  (RCVG_UPD_KYS_ODR)                              11680000
116900          VALUES  (:OUTAPD-RCVG-UPD-KYS-ODR)                      11690000
117000     END-EXEC.                                                    11700000
117100                                                                  11710000
117200     EVALUATE TRUE                                                11720000
117300         WHEN SQLCODE = ZERO                                      11730000
117400              CONTINUE                                            11740000
117500         WHEN SQLWARN0 NOT = SPACES                               11750000
117600         WHEN SQLCODE  NOT = ZERO                                 11760000
117700             MOVE 'UNSUCCESFUL INSERT ' TO PV-ABEND-OPERATION     11770000
117800             MOVE 'TOUTAPD'             TO PV-ABEND-STRUCTURE-1   11780000
117900             MOVE SPACES                TO PV-ABEND-STRUCTURE-2   11790000
118000                                           PV-ABEND-STRUCTURE-3   11800000
118100                                           PV-ABEND-STRUCTURE-4   11810000
118200             PERFORM Z999-DB2-ABEND                               11820000
118300     END-EVALUATE.                                                11830000
118400                                                                  11840000
118500     ADD 1 TO PV-UPDATE-KEYS-REC-CNT-C.                           11850000
118600                                                                  11860000
118700*--------------------------------------------------------------*  11870000
118800* FORMAT AND INSERT THE AP032 RECORD TO THE TOUTAPC TABLE.     *  11880000
118900*--------------------------------------------------------------*  11890000
119000 W500-INSERT-AP032-IMPORT.                                        11900000
119100                                                                  11910000
119200     MOVE 'W500-INSERT-AP032'    TO PV-ABEND-PARAGRAPH.           11920000
119300                                                                  11930000
119400     MOVE SPACES                 TO AP032-RECORD.                 11940000
119500                                                                  11950000
119600     MOVE PV-PO-BEING-PROCESSED  TO AP032-PO-NBR.                 11960000
119700     MOVE PURITM-APP-PO-LNE-NBR  TO AP032-PO-LNE-NBR.             11970000
119800     MOVE PURITM-CL-NBR          TO AP032-CL-NBR.                 11980000
119900     MOVE PURCHS-PO-TYP-CDE      TO AP032-PO-TYP-CDE.             11990000
120000     MOVE PURCHS-DEPT-NBR        TO AP032-DEPT-NBR.               12000000
120100     MOVE AP061-REC-SEQ-NBR      TO AP032-REC-SEQ-NBR.            12010000
120200     MOVE RECDIS-STR-NBR         TO AP032-STR-NBR.                12020000
120300     MOVE AP061-AP-RVRSL-IND     TO AP032-REC-RVRSL-IND.          12030000
120400     MOVE AP061-VERFYD-TMST(1:10)                                 12040000
120500                                 TO AP032-VERFYD-DATE.            12050000
120600     MOVE RECDIS-AP-VERIFY-ITM-QTY                                12060000
120700                                 TO AP032-REC-UNT-QTY.            12070000
120800     MOVE PURITM-UNT-COST-AMT    TO AP032-REC-ELC-COST-AMT.       12080000
120900     MOVE PURITM-PRD-1ST-COST-AMT                                 12090000
121000                                 TO AP032-REC-1ST-COST-AMT.       12100000
121100     MOVE AP032-RECORD           TO OUTAPC-IMPRT-PO-RCVG-ODR.     12110000
121200                                                                  12120000
121300     EXEC SQL                                                     12130000
121400          INSERT INTO TOUTAPC                                     12140006
121500                  (IMPRT_PO_RCVG_ODR)                             12150000
121600          VALUES  (:OUTAPC-IMPRT-PO-RCVG-ODR)                     12160000
121700     END-EXEC.                                                    12170000
121800                                                                  12180000
121900     EVALUATE TRUE                                                12190000
122000         WHEN SQLCODE = ZERO                                      12200000
122100              CONTINUE                                            12210000
122200         WHEN SQLWARN0 NOT = SPACES                               12220000
122300         WHEN SQLCODE  NOT = ZERO                                 12230000
122400             DISPLAY 'PO IN ERROR = ' PV-PO-BEING-PROCESSED       12240000
122500             MOVE 'UNSUCCESFUL INSERT ' TO PV-ABEND-OPERATION     12250000
122600             MOVE 'TOUTAPC'             TO PV-ABEND-STRUCTURE-1   12260000
122700             MOVE SPACES                TO PV-ABEND-STRUCTURE-2   12270000
122800                                           PV-ABEND-STRUCTURE-3   12280000
122900                                           PV-ABEND-STRUCTURE-4   12290000
123000             PERFORM Z999-DB2-ABEND                               12300000
123100     END-EVALUATE.                                                12310000
123200                                                                  12320000
123300     ADD 1 TO PV-DETAIL-IMPRT-REC-CNT-C.                          12330000
123400                                                                  12340000
123500*--------------------------------------------------------------*  12350000
123600* OPEN RECEIVING CURSOR                                        *  12360000
123700*--------------------------------------------------------------*  12370000
123800 Y100-OPEN-RECEIVING-CSR.                                         12380000
123900                                                                  12390000
124000     MOVE 'Y100-OPEN-RECEIVING-CSR' TO PV-ABEND-PARAGRAPH.        12400000
124100                                                                  12410000
124200     EXEC SQL                                                     12420000
124300         OPEN RECEIVING_CSR                                       12430000
124400     END-EXEC.                                                    12440000
124500                                                                  12450000
124600     EVALUATE TRUE                                                12460000
124700         WHEN SQLCODE = ZERO                                      12470000
124800              CONTINUE                                            12480000
124900                                                                  12490000
125000         WHEN SQLWARN0 NOT = SPACES                               12500000
125100         WHEN SQLCODE  NOT = ZERO                                 12510000
125200             MOVE 'UNSUCCESSFUL OPEN ON RECEIVING CSR'            12520000
125300                                 TO PV-ABEND-OPERATION            12530000
125400             MOVE 'TRECDIS'      TO PV-ABEND-STRUCTURE-1          12540000
125500             MOVE 'TRECITM'      TO PV-ABEND-STRUCTURE-2          12550000
125600             MOVE 'TPURITM'      TO PV-ABEND-STRUCTURE-3          12560000
125700             MOVE SPACES         TO PV-ABEND-STRUCTURE-4          12570000
125800             PERFORM Z999-DB2-ABEND                               12580000
125900     END-EVALUATE.                                                12590000
126000                                                                  12600000
126100*--------------------------------------------------------------*  12610000
126200* OPEN NINREC CURSOR                                           *  12620000
126300*--------------------------------------------------------------*  12630000
126400 Y200-OPEN-NINREC-CSR.                                            12640000
126500                                                                  12650000
126600     MOVE 'Y200-OPEN-NINREC-BUL' TO PV-ABEND-PARAGRAPH.           12660000
126700                                                                  12670000
126800     EXEC SQL                                                     12680000
126900         OPEN NINREC_CSR                                          12690000
127000     END-EXEC.                                                    12700000
127100                                                                  12710000
127200     EVALUATE TRUE                                                12720000
127300         WHEN SQLCODE = ZERO                                      12730000
127400              CONTINUE                                            12740000
127500                                                                  12750000
127600         WHEN SQLWARN0 NOT = SPACES                               12760000
127700         WHEN SQLCODE  NOT = ZERO                                 12770000
127800             MOVE 'UNSUCCESSFUL OPEN ON TNINREC'                  12780000
127900                                 TO PV-ABEND-OPERATION            12790000
128000             MOVE 'TNINREC'      TO PV-ABEND-STRUCTURE-1          12800000
128100             MOVE SPACES         TO PV-ABEND-STRUCTURE-2          12810000
128200                                    PV-ABEND-STRUCTURE-3          12820000
128300                                    PV-ABEND-STRUCTURE-4          12830000
128400             PERFORM Z999-DB2-ABEND                               12840000
128500     END-EVALUATE.                                                12850000
128600                                                                  12860000
128700*--------------------------------------------------------------*  12870000
128800* CLOSES THE RECEIVING CURSOR                                  *  12880000
128900*--------------------------------------------------------------*  12890000
129000 Y300-CLOSE-RECEIVING-CSR.                                        12900000
129100                                                                  12910000
129200     MOVE 'Y300-CLOSE-RECEIVING-CSR' TO PV-ABEND-PARAGRAPH.       12920000
129300                                                                  12930000
129400     EXEC SQL                                                     12940000
129500         CLOSE RECEIVING_CSR                                      12950000
129600     END-EXEC.                                                    12960000
129700                                                                  12970000
129800     EVALUATE TRUE                                                12980000
129900         WHEN SQLCODE = ZERO                                      12990000
130000              CONTINUE                                            13000000
130100                                                                  13010000
130200         WHEN SQLWARN0 NOT = SPACES                               13020000
130300         WHEN SQLCODE  NOT = ZERO                                 13030000
130400             MOVE 'UNSUCCESSFUL CLOSE ON RECEIVING CURSOR'        13040000
130500                                 TO PV-ABEND-OPERATION            13050000
130600             MOVE 'TRECDIS'      TO PV-ABEND-STRUCTURE-1          13060000
130700             MOVE 'TRECITM'      TO PV-ABEND-STRUCTURE-2          13070000
130800             MOVE 'TPURITM'      TO PV-ABEND-STRUCTURE-3          13080000
130900             MOVE SPACES         TO PV-ABEND-STRUCTURE-4          13090000
131000             PERFORM Z999-DB2-ABEND                               13100000
131100     END-EVALUATE.                                                13110000
131200                                                                  13120000
131300*--------------------------------------------------------------*  13130000
131400* CLOSES THE NINREC CURSOR                                     *  13140000
131500*--------------------------------------------------------------*  13150000
131600 Y400-CLOSE-NINREC-CSR.                                           13160000
131700                                                                  13170000
131800     MOVE 'Y400-CLOSE-NINREC-CSR' TO PV-ABEND-PARAGRAPH.          13180000
131900                                                                  13190000
132000     EXEC SQL                                                     13200000
132100         CLOSE NINREC_CSR                                         13210000
132200     END-EXEC.                                                    13220000
132300                                                                  13230000
132400     EVALUATE TRUE                                                13240000
132500         WHEN SQLCODE = ZERO                                      13250000
132600              CONTINUE                                            13260000
132700                                                                  13270000
132800         WHEN SQLWARN0 NOT = SPACES                               13280000
132900         WHEN SQLCODE  NOT = ZERO                                 13290000
133000             MOVE 'UNSUCCESSFUL CLOSE ON TNINREC'                 13300000
133100                                 TO PV-ABEND-OPERATION            13310000
133200             MOVE 'TNINREC'      TO PV-ABEND-STRUCTURE-1          13320000
133300             MOVE SPACES         TO PV-ABEND-STRUCTURE-2          13330000
133400                                    PV-ABEND-STRUCTURE-3          13340000
133500                                    PV-ABEND-STRUCTURE-4          13350000
133600             PERFORM Z999-DB2-ABEND                               13360000
133700     END-EVALUATE.                                                13370000
133800                                                                  13380000
133900*--------------------------------------------------------------*  13390000
134000* CLOSE ALL FILES AND REPORT NECESSARY TOTALS                  *  13400000
134100*--------------------------------------------------------------*  13410000
134200 Z900-END-OF-JOB.                                                 13420000
134300                                                                  13430000
134400     MOVE 'Z900-END-OF-JOB  ' TO PV-ABEND-PARAGRAPH.              13440000
134500                                                                  13450000
134600     MOVE PC-RUN-COMPLETE-CODE TO PV-CKPT-STAT-CODE.              13460000
134700     PERFORM U100-UPDATE-TCKRSTCNTL.                              13470000
134800     PERFORM U250-COMPUTE-CNTS.                                   13480000
134900                                                                  13490000
135000     PERFORM U300-COMMIT.                                         13500000
135100                                                                  13510000
135200     DISPLAY '************************************************'.  13520000
135300     DISPLAY 'TOTAL RECEIVE  RECORDS READ    = '                  13530000
135400              PV-RECEIPT-IN-REC-CNT.                              13540000
135500     DISPLAY 'TOTAL RECDIS ROWS FETCHED      = '                  13550000
135600              PV-RECDIS-INPUT-CNT.                                13560000
135700     DISPLAY 'TOTAL NINRECS ROWS FETCHED     = '                  13570000
135800              PV-NINREC-INPUT-CNT.                                13580000
135900     DISPLAY '************************************************'.  13590000
136000     DISPLAY 'TOTAL RECEIVER SEQ RECORDS     = '                  13600000
136100              PV-DETAIL-RECV-SEQ-CNT.                             13610000
136200     DISPLAY 'TOTAL DETAIL ENTRY RECORDS     = '                  13620000
136300              PV-DETAIL-ENTRY-REC-CNT.                            13630000
136400     DISPLAY 'TOTAL DETAIL IMPORT RECORDS    = '                  13640000
136500              PV-DETAIL-IMPRT-REC-CNT.                            13650000
136600     DISPLAY 'TOTAL UPDATE KEYS RECORDS      = '                  13660000
136700              PV-UPDATE-KEYS-REC-CNT.                             13670000
136800     DISPLAY '************************************************'.  13680000
136900                                                                  13690000
137000     CLOSE RECEIPT-FILE.                                          13700000
137100                                                                  13710000
137200     IF   END-OF-RECEIPT-INPUT                                    13720000
137300          DISPLAY ' PROGRAM APKUP039 ENDS NORMALLY '              13730000
137400     ELSE                                                         13740000
137500          DISPLAY ' PROGRAM APKUP039 ENDS ABNORMALLY '            13750000
137600     END-IF.                                                      13760000
137700                                                                  13770000
137800*--------------------------------------------------------------*  13780000
137900* PROCESS DB2 ABENDS                                           *  13790000
138000*--------------------------------------------------------------*  13800000
138100 Z999-DB2-ABEND.                                                  13810000
138200                                                                  13820000
138300     DISPLAY '*** DB2 ERROR '.                                    13830000
138400     DISPLAY '*** SQL CODE = '  PV-ABEND-SQLCODE.                 13840000
138500     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 13850000
138600     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               13860000
138700     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               13870000
138800     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             13880000
138900     IF PV-ABEND-STRUCTURE-2 > SPACES                             13890000
139000         DISPLAY '*** TABLE 2   = ' PV-ABEND-STRUCTURE-2.         13900000
139100     IF PV-ABEND-STRUCTURE-3 > SPACES                             13910000
139200         DISPLAY '*** TABLE 3   = ' PV-ABEND-STRUCTURE-3.         13920000
139300     IF PV-ABEND-STRUCTURE-4 > SPACES                             13930000
139400         DISPLAY '*** TABLE 4   = ' PV-ABEND-STRUCTURE-4.         13940000
139500                                                                  13950000
139600     COPY DPPD004.                                                13960000
139700                                                                  13970000
139800     MOVE +4013                    TO ABEND-CODE.                 13980000
139900                                                                  13990000
140000     CALL 'ILBOABN0' USING ABEND-CODE.                            14000000
