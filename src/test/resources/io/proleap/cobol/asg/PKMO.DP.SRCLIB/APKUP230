000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     APKUP230.                                        00020000
000300 AUTHOR.         MARY KING.                                       00030000
000400 DATE-WRITTEN.   08/01/1995.                                      00040000
000500 DATE-COMPILED.                                                   00050000
000600******************************************************************00060000
000700*    COBOL 2 WITH SQL                                            *00070000
000800*                                                                *00080000
000900*    AUTOMATIC RECONCILIATION                                    *00090000
001000*                                                                *00100000
001100*   THIS PROGRAM READS TPOSTRR FOR ROWS INSERTED BY BATCH        *00110000
001200*   MATCH, APKUP250.  FOR EACH PO/STORE COMBINATION              *00120000
001300*   RETRIEVED, THE VENDOR/DEPARTMENT IS CHECKED TO ENSURE        *00130000
001400*   THAT IT IS ONE THAT MAY BE AUTOMATICALLY RECONCILED.         *00140000
001500*   IF SO, THE RECEIPT AND INVOICE DATA IS LOADED INTO           *00150000
001600*   INTERNAL TABLES.  CONDITIONS ARE CHECKED TO VERIFY THAT      *00160000
001700*   THERE IS NOTHING PREVENTING THE PO/STORE FROM AUTOMATIC      *00170000
001800*   RECONCILIATION.  IF IT CAN BE AUTOMATICALLY RECONCILED       *00180000
001900*   PROCESSING OCCURS THAT IS SIMILAR TO THE ONLINE              *00190000
002000*   RECONCILATION PROCESS IN APKCS330:  REMAINDER INVOICES,      *00200000
002100*   NON-INVOICED RECEIPTS, AND PRICE CLAIMS ARE CREATED AS       *00210000
002200*   NECESSARY; STATUSES ARE SET TO RELEASED ON THE INVOICE       *00220000
002300*   AND RECEIVER TABLES; AUDIT TABLE INSERTS ARE DONE; AND       *00230000
002400*   TPOSTRR IS UPDATED FOR FUTURE PROCESSING.                    *00240000
002500*   IF THE PO/STORE MUST BE BYPASSED, A ROW IS WRITTEN TO        *00250000
002600*   THE REPORT TABLE AND TPOSTRR IS UPDATED TO SHOW THAT         *00260000
002700*   THE PO/STORE WAS BYPASSED.                                   *00270000
002800*                                                                *00280000
002900* INPUT:                                                         *00290000
003000*  1. RELEASED PO/STORES TABLE         (TPOSTRR)                 *00300000
003100*  2. AP CONTROL TABLE                 (TAPCNTL)                 *00310000
003200*  3. VENDOR AGREEMENT TABLE           (TVNDAGR)                 *00320000
003300*  4. PURCHASE TABLE                   (TPURCHS)                 *00330000
003400*  5. PURCHASE AGREEMENT TABLE         (TPOAGMT)                 *00340000
003600*  6. INVOICE PAYMENT TABLE            (TINVCTM)                 *00360099
003700*  7. INVOICE TABLE                    (TINVOIC)                 *00370099
003800*  8. MERCHANDISE INVOICE TABLE        (TMDINVC)                 *00380099
003900*  9. ALLOWANCE/CHARGE TABLE           (TALCHRG)                 *00390099
004000* 10. PAYMENT REQUEST ITEM TABLE       (TPREQIT)                 *00400099
004100* 11. MERCHANDISE ITEM TABLE           (TMIITEM)                 *00410099
004200* 12. RECEIVER TABLE                   (TRECEIV)                 *00420060
004300* 13. RECEIPT ITEM TABLE               (TRECITM)                 *00430060
004400* 14. RECEIVER DISTRIBUTION TABLE      (TRECDIS)                 *00440060
004500* 15. PURCHASE ORDER ITEM TABLE        (TPURITM)                 *00450060
004600* 16. NON-INVOICED RECEIPT TABLE       (TNINREC)                 *00460060
004700* 17. PRICE CLAIM ADJUSTMENTS TABLE    (TPRCCLM)                 *00470060
004800* 18. EXTERNAL ENTERPRISE TABLE        (TEXTENT)                 *00480060
004900* 19. EXTERNAL ENTERPRISE NAME TABLE   (TENTNME)                 *00490060
004910* 20. VENDOR CAPABILITY VND_VNT_CPBL   (VNT0001)                 *00491099
004920* 21. MERCHANDSE AREA TABLE            (TMDSEAR)                 *00492099
004930* 22. PAYMENT TERM TYP TABLE           (TPAYTRM)                 *00493099
005000*                                                                *00500000
005100* OUTPUT:                                                        *00510000
005200*                                                                *00520000
005300*  INSERTS -                                                     *00530000
005400*  1. INVOICE TABLE                    (TINVOIC)                 *00540058
005500*  2. MERCHANDISE INVOICE TABLE        (TMDINVC)                 *00550058
005600*  3. INVOICE PAYMENT TABLE            (TINVCTM)                 *00560058
005700*  4. ALLOWANCE/CHARGE TABLE           (TALCHRG)                 *00570058
005800*  5. PAYMENT REQUEST ITEM TABLE       (TPREQIT)                 *00580058
005900*  6. MERCHANDISE ITEM TABLE           (TMIITEM)                 *00590058
006000*  7. NON-INVOICED RECEIPT TABLE       (TNINREC)                 *00600060
006100*  8. PRICE CLAIM ADJUSTMENTS TABLE    (TPRCCLM)                 *00610060
006200*  9. POS REQUIRING MANUAL RECON TABLE (TOUTAP5)   (APRD270)     *00620060
006300*                                                                *00630000
006400*  UPDATES -                                                     *00640000
006500*  1. RELEASED PO/STORES TABLE         (TPOSTRR)                 *00650000
006600*  2. INVOICE TABLE                    (TINVOIC)                 *00660000
006700*  3. RECEIVER TABLE                   (TRECEIV)                 *00670000
006800*  4. RECEIVER DISTRIBUTION TABLE      (TRECDIS)                 *00680000
006900*  5. NON-INVOICED RECEIPT TABLE       (TNINREC)                 *00690000
007000*                                                                *00700000
007100******************************************************************00710000
007200*   CHANGES:                                                     *00720000
007300*                                                                *00730000
007400*  01/29/96 MARY KING                                            *00740000
007500*           ADDED LOGIC TO PREVENT AUTOMATIC RECONCILIATION      *00750000
007600*           IF A REMAINDER INVOICE IS ONE OF THE INVOICES        *00760000
007700*           BROUGHT INTO THE PROCESS AND A REMAINDER WILL        *00770000
007800*           BE CREATED OUT OF THE PROCESS.                       *00780000
007900*                                                                *00790000
008000*  05/14/96 MARY KING                                            *00800000
008100*           DUE DATE CALCULATION CHANGES:                        *00810000
008200*          -CHANGED THE INTERNAL INVOICE TABLE TO USE THE        *00820000
008300*           COPYBOOK APWS008 TO BE CONSISTENT WITH THE           *00830000
008400*           INVOICE EXTRACT AND BATCH MATCH PROGRAMS.            *00840000
008500*          -ONCE AN INVOICE IS RELEASED, THE DUE DATE SOURCE     *00850000
008600*           CODE IS CHECKED TO SEE IF IT HAS A VALUE OF 'X'      *00860000
008700*           (EXCEPTION).  IF SO, THE INPUT INVOICE FILE IS       *00870000
008800*           READ LOOKING FOR A MATCHING PO/STR/INVC ID AND       *00880000
008900*           THE DATA FROM THE INPUT RECORD IS WRITTEN TO         *00890000
009000*           THE OUTPUT TABLE (TOUTAP8).                          *00900000
009100*          -ADDED AN ORDER BY INVOICE ID TO THE INVOICE          *00910000
009200*           CURSOR FOR MATCHING UP TO THE INPUT FILE.            *00920000
009300*          -REMOVED RETRY LOGIC FROM MANY OF THE DB2 CALLS.      *00930000
009400*                                                                *00940000
009500*  06/02/97                                                       00950000
009600*           CHANGED THE INSERT TO TNINREC TO USE THE APCNTL-     *00960000
009700*           BTCH-CNTL-PRC-DTE IN THE NINREC-REC-TMST.  THE       *00970000
009800*           REST OF THE TIMESTAMP WILL BE SET TO 22:00.          *00980000
009900*           IF THE JOB RUNS AFTER MIDNIGHT WE WANT THE REC-      *00990000
010000*           TTMST TO REFLECT THE DAY THE PROCESSING WAS FOR.     *01000000
010100*          BY:  MIKE BESKE                  WR/PIT #: 85595      *01010000
010200*                                                                *01020000
010300* 08/25/97                                                        01030000
010400*          MODIFIED THE LOGIC WHICH INSERTS ROWS TO TINVOIC TO   *01040000
010500*          PUT VALUES IN THE 2 NEW COLS AS FOLLOWS: INVOIC-PPD-  *01050000
010600*          RVRSL-IND WILL BE SET TO "N" AND INVOIC-INVC-NET-COST-*01060000
010700*          AMT WILL GET THE SAME VALUE AS THE INVOIC-GRO-COST-AMT*01070000
010800*          MODIFIED THE LOGIC WHICH INSERTS ROWS TO TMDINVC TO   *01080000
010900*          INITIALIZE THE NEW COL MDINVC-IMPRT-CHRG-PRC-CDE TO   *01090000
011000*          SPACES.                                               *01100000
011100*          BY:  MIKE BESKE                   WR/PIT 4164         *01110000
011200*                                                                *01120000
011300* 08/25/97                                                       *01130000
011400*          IN THE PREQIT_CSR, THE COLUMNS SELECTED IN THE SECOND *01140000
011500*          HALF OF THE UNION WERE CHANGED.  INSTEAD OF SELECTING *01150000
011600*          THE PAYT_REQ_LNE_NBR, THE VALUE OF ZERO IS SELECTED   *01160000
011700*          FOR BOTH TIMES THAT COLUMN IS SELECTED.               *01170000
011800*          BY:  MIKE BESKE                   WR/PIT 4164         *01180000
011900*                                                                *01190000
012000* 10/02/97                                                       *01200000
012100*          INCREASED THE SIZE OF THE EXCLUDED VENDORS TABLE      *01210000
012200*          FROM 100 TO 500.                                      *01220000
012300*          BY:  MARY KING                    WR/PIT 118546       *01230000
012400*                                                                *01240000
012500* 10/23/97 RECOMPILED DUE TO CHANGES IN APWS008 COPYBOOK         *01250000
012600*          BY:  CHRIS BOEHNLEIN              WR/PIT 4164         *01260000
012700*                                                                *01270000
012800* 10/28/97 CHANGED THE INITIAL VALUE TO SPACE ON PPD-RVRSL-IND ON*01280000
012900*          INSERTS TO TINVOIC.                                   *01290000
013000*          BY:  NANCY EILBES                 WR/PIT 4164         *01300000
013100*                                                                *01310000
013200* 01/16/98 RECOMPILED DUE TO ADDITIONAL FIELD IN COPYBOOKS       *01320000
013300*          APRD060 AND APWS008.                                  *01330000
013400*          BY:  MARK BURNSIDE                WR# 4164            *01340000
013500*                                                                *01350000
013600* 05/05/98  ADDED THE PROCESSING NECESSARY TO MAINTAIN AP        *01360000
013700*           PROCESS CODE ON ALL INVOICES.  THIS CODE WAS         *01370000
013800*           NEEDED BECAUSE THE STATUS CODE IS NO LONGER          *01380000
013900*           SUFFICIENT TO INDICATE IF THE INVOICES FOR A PO      *01390000
014000*           HAVE BEEN JOURNALIZED.  THE LOGIC HAS BEEN MODIFIED  *01400000
014100*           TO INSERT ROWS INTO TINVOIC AND PLACE VALUES IN THE  *01410000
014200*           TWO NEW COLUMNS:                                     *01420000
014300*               - AP-PRC-CDE                                     *01430000
014400*               - AP-PRC-DTE                                     *01440000
014500*          BY:  ROBIN BERNOSKI               WR# 4164            *01450000
014600*                                                                *01460000
014700* 07/20/2000                                                     *01470000
014800*            INSERTED CODE INTO PARAGRAPH G100-                  *01480000
014900*            MOVE THE PAYTRM-DISCOUNT-DAYS-QTY INTO THE          *01490000
015000*            INVCTM-NET-DUE-DAY-QTY FIELD IF THE                 *01500000
015100*            PAYTRM-DISCOUNT-DAYS-QTY IS GREATER THAN ZERO.  IF  *01510000
015200*            THAT CONDITION IS TRUE ZERO IS MOVED TO THE         *01520000
015300*            INVCTM-DISC-DUE-DAY-QTY FIELD, ELSE A STRAIGHT      *01530000
015400*            MOVE OF THESE FIELDS OCCURS BETWEEN THE PAYTRM TABLE*01540000
015500*            AND THE INVCTM TABLE LAYOUT.                        *01550000
015600*            BY:  MARK BURNSIDE                WR/PIT            *01560000
015700*                                                                *01570000
015800* 08/29/2000 ADDED CODE TO PROCESS THE ADVERTISING ALLOWANCE     *01580000
015900*            PERCENT AND AMOUNT SEPARATLY FROM THE REGULAR WEIGHT*01590000
016000*            -ED DISCOUNT PERCENT AND AMOUNT.                    *01600000
016100*            ADDED CODE TO SELECT ADDITIONAL EXTENDED DAYS FROM  *01610000
016200*            THE TPOAGMT TABLE IF THEY EXIST AS PART OF THE MARK *01620000
016300*            OUT OF STOCK ENHANCEMENTS.                          *01630000
016400*            BY:  MIKE BESKE                   WR: 20224         *01640000
016500*                                                                *01650000
016600* 06/17/2002 ARK PO PROJECT PHASE 1.  ELIMINATE ALL REFERENCES   *01660000
016700*            TO INIT_INVC_ID.   SEPARATLY FROM THE REGULAR WEIGHT*01670000
016800*            -ED DISCOUNT PERCENT AND AMOUNT.                    *01680000
016900*            ADDED CODE TO SELECT ADDITIONAL EXTENDED DAYS FROM  *01690000
017000*            BY:  KEVIN CATLIN                 WR: 23500         *01700000
017100*                                                                *01710000
017200* 06/25/02 RECOMPILE FROM PRODUCTION TO PICK UP CHANGES TO       *01720000
017300*          COPYBOOKS APPD052 AND APWS052.                        *01730000
017400*          BY:  KEVIN CATLIN                 WR#: 23839          *01740000
017500*                                                                *01750000
017600* 08/05/2002 COLBY HANGER EXPENSE PROCESSING.  RECOMPILE FROM    *01760000
017700*            PRODUCTION TO INCORPORATE COPYBOOK CHANGES.         *01770000
017800*        BY: KEVIN CATLIN                   WR#: 23254           *01780000
017900*                                                                *01790000
018000* 09/09/2002 ARK PO PROJECT PHASE 2.  REPLACE REFERENCES TO      *01800000
018100*            PAYT_REQ_SEQ_NBR WITH THE NEW INDEX OF PO_NBR AND   *01810000
018200*            INVC_ID.  CURSORS MODIFIED ARE DISCOUNT_CSR AND     *01820000
018300*            ADVERT_CSR.  PARAGRAPHS MODIFIED ARE F300, G100,    *01830000
018400*            R730, U230, U240, AND U600.                         *01840000
018500*        BY: KEVIN CATLIN                   WR#: 23500           *01850000
018600*                                                                *01860000
018700* 11/04/2002 MODIFIED ALL OF THE AMOUNT FIELDS FROM 9(7)V99      *01870000
018800*            TO S9(9)V99 COMP-3 IN COPYBOOK APWS052.THIS WAS DONE*01880000
018900*            TO CORRECT A DISCOUNT BALANCING ISSUE.              *01890000
019000*        BY: MIKE BESKE                     WR#: 23750           *01900000
019100*                                                                *01910000
019200* 02/05/2003                                                     *01920000
019300*    CHANGE MADE: ARKPO PHASE3 PROJECT.                          *01930000
019400*    UPDATED THE PROGRAM TITLE TO MATCH THE SPEC TITLE.          *01940000
019500*    UPDATED THE INPUT FILENAME IN THE PROGRAM COMMENT BLOCK &   *01950000
019600*    ALL COPYBOOKS USED IN THIS PROGRAM.                         *01960000
019700* MADE BY:  MIKE BESKE                          WR#: 23500       *01970000
019800*                                                                *01980000
019900* DATE  03/25/2003                                               *01990000
020000*     CHANGE MADE: RECOMPILE FROM PRODUCTION TO PICK UP CHANGE   *02000000
020100*     TO COPYBOOK APWS052.                                       *02010000
020200*     MADE BY: KEVIN CATLIN            WR/IR #: WR24481          *02020000
020300*                                                                *02030000
020400* DATE  08/27/2003                                               *02040000
020500*     CHANGE MADE: INCREASE NUMBER OF TRIES FOR UNIQUE PAYT-REC- *02050000
020600*     SEQ-NBR.                                                   *02060000
020700*     MADE BY: L SCHALLHORN            WR/IR #: P000579797       *02070000
020800*                                                                *02080000
020900* DATE  01/30/2004                                               *02090000
021000*     CHANGE MADE: RECOMPILE FROM PRODUCTION TO PICK UP CHANGE   *02100000
021100*     TO COPYBOOKS APWS052 AND APPD052. THIS INVOLVES THE VENDOR *02110000
021200*     INSURANCE EXCEPTION OF NOT CHARGING BACK THE VENDOR FOR    *02120000
021300*     INSURANCE CHARGE CODES: 'INS' AND '445'.  THE VENDORS ARE  *02130000
021400*     ANDEL JEWELRY '117498121' AND CITIZEN WATCH '078822863'.   *02140000
021500*     MADE BY: MIKE BESKE              WR/IR #: P000628860       *02150000
021600*                                                                *02160000
021700* DATE  06/28/2004                                               *02170000
021800*     CHANGE MADE: IN PARAGRAPH D400, CHANGED THE POPULATION OF  *02180000
021900*     THE IA-ENTRY-DATE ON THE INTERNAL INVOICE TABLE.  IT       *02190000
022000*     SHOULD BE POPULATED WITH INVOIC-CRE-DTE, NOT THE           *02200000
022100*     PAYREQ-ENTR-DTE (WHICH IS THE CURRENT DATE).  THIS WILL    *02210000
022200*     NOW BE CORRECTLY REFLECTED ON THE PO'S REQUIRING MANUAL    *02220000
022300*     RECONCILIATION REPORTS.                                    *02230000
022400*     MADE BY: KEVIN CATLIN            WR/IR #: P000663857       *02240000
022500*                                                                *02250000
022600* DATE  04/13/2005                                               *02260000
022700*     CHANGE MADE: ADDED CODE TO PROCESS OFF-INVOICE CO-OP       *02270000
022800*     ADVERTISING ALLOWANCES SO THAT THEY ARE NOT ROLLED IN WITH *02280000
022900*     OTHER OFF-INVOICE ALLOWANCES.  CODE WAS ADDED AS FOLLOWS:  *02290000
023000*     PARA C600- ADDED CODE TO CALCULATE WEIGHTED COOP PERCENT;  *02300000
023100*     PARA D600- ADDED CODE TO ACCUMULATE THE COOP ALLOWANCE AMT *02310000
023200*                AND SUBTRACT THE COOP ALLOWANCE AMT FROM THE    *02320000
023300*                ACCUMULATED DISCOUNTED COST AMT;                *02330000
023400*     PARA F300- ADDED CODE TO INSERT THE COOP DATA INTO TALCHRG *02340000
023500*                WHEN THE WEIGHTED COOP PERCENT > 0.             *02350000
023600*     MADE BY: MIKE BESKE              WR/IR #: WR28651          *02360000
023700*                                                                *02370000
023800* DATE  08/24/2005                                               *02380000
023900*     CHANGE MADE: BROADCAST CALCULATION CHANGES.                *02390000
024000*     REMOVED THE DECLARE FOR THE ADVERT_CSR CURSOR AND THE CODE *02400000
024100*     IN PARAGRAPHS R705-, Y900-, AND Y910- RELATING TO IT.      *02410000
024200*     CHANGED THE WHERE CLAUSE OF THE DISCOUNT_CSR CURSOR TO     *02420000
024300*     EXCLUDE THE CONDITION ALW_CHRG_CDE NOT IN ('ADV').         *02430000
024400*     ALTERED THE CALCULATION OF THE PV-WEIGHTED-ADV-PCT TO BE   *02440000
024500*     DIVIDED BY THE TOTAL GROSS COST IN PARAGRAPH C600-.        *02450000
024600*     ADDED LOGIC TO PARAGRAPH D600- TO INCLUDE                  *02460000
024700*     APPD052-ADV-DISC-AMT IN THE CALCULATION OF THE DISCOUNTED  *02470000
024800*     COST AMOUNT.  ALL OF THESE CHANGES WERE MADE TO CALCULATE  *02480000
024900*     BROADCAST OFF INVOICE FROM GROSS COST RATHER THAN FROM NET *02490000
025000*     COST.                                                      *02500000
025100*     MADE BY: KRYSTEN LEARY           WR/IR #: WR29100          *02510000
025200*                                                                *02520000
025300* DATE  05/25/2006                                               *02530000
025400*     CHANGE MADE: VENDOR ALLOWANCE CHANGES - MAINTAIN           *02540000
025500*                  INDIVIDUALITY OF OFF-INVOICE ALLOWANCES.      *02550000
025600*     ADDED WORK FIELDS FOR WEIGHTED DISCOUNT PERCENTS AND       *02560000
025700*     INDIVIDUAL ALLOWANCE AMOUNTS.  IN PARAGRAPH C600- ADDED    *02570000
025800*     CODE TO CALCULATE THE NEW WEIGHTED DISCOUNT PERCENTAGES.   *02580000
025900*     IN PARAGRAPH D600- ADDED CODE TO ACCUMULATE THE NEW        *02590000
026000*     WEIGHTED DISCOUNT PERCENTAGES.  IN PARAGRAPH F300- SETUP   *02600000
026100*     THE PV-WEIGHTED-DISC-PCT AND THE CALL TO INSERT IT TO      *02610000
026200*     TALCHRG.  ADDED SETUP FOR NEW WEIGHTED DISCOUNT PERCENTS   *02620000
026300*     AND CALLS TO INSERT TO TALCHRG.                            *02630000
026400*     MADE BY: ROLF NOHE               WR/IR #: WR30028          *02640000
026500*                                                                *02650000
026600* DATE  06/27/2006                                               *02660000
026700*     CHANGE MADE: MATCH BY DC -- REMOVED ALL LOGIC RELATED TO   *02670000
026800*     THE DUE DATE EXCEPTION REPORT RECORDS.  THIS INCLUDED THE  *02680000
026900*     DDX-DUE-DATE-EXCEPTIONS WORKING STORAGE RECORD DEFINITION, *02690000
027000*     THE TOUTAP8 TABLE DEFINITION, THE DUE DATE EXCEPTION INPUT *02700000
027100*     FILE, AND THE PARAGRAPHS U810-INSERT-DUE-DATE-EXCEPTION,   *02710000
027200*     R310-READ-INVOICE-FILE, AND E600-PREPARE-DUE-DATE-X.       *02720000
027300*     MADE BY: KRYSTEN LEARY           WR/IR #: WR21578          *02730000
027400*                                                                *02740000
027500* DATE  10/26/2006                                               *02750000
027600*     CHANGE MADE: MATCH BY DC -- INCREASED THE SIZE OF THE      *02760000
027700*     TRECEIV-TABLE INTERNAL TABLE TO BE 250 FROM 50.  REMOVED   *02770000
027800*     LOGIC FROM PARAGRAPHS C100-LOAD-RECEIPTS AND               *02780000
027900*     C200-LOAD-NINREC THAT BYPASSES LOADING THE RECORD INTO THE *02790000
028000*     INTERNAL TABLES WHEN A UNIT QUANTITY IS FOUND WITH NO UNIT *02800000
028100*     COST.  THIS WILL ELIMINATE THE RCV-ZERO-COST 88 LEVEL OF   *02810000
028200*     THE PV-BYPASS-REASON-CODE AND THE '06' CODE IN THE         *02820000
028300*     RETRIEVE-INVOICES 88 LEVEL.                                *02830000
028400*     MADE BY: KRYSTEN LEARY           WR/IR #: WR31317          *02840000
028500*                                                                *02850000
028600* DATE  11/30/2006                                               *02860000
028700*     CHANGE MADE:                                               *02870000
028800*     MODIFIED E100 TO NOW ALLOW THE RECEIVER UNIT COST AMOUNT   *02880000
028900*     WITH THE VALUE OF 0 TO BE INCLUDED IN DETERMINATING IF THE *02890000
029000*     COST DIFFERENCE IS WITHIN THE SET PERCENTAGE FROM TAPCNTL. *02900000
029100*     MADE BY: MICHELE RINDFLEISCH     WR/IR #: PM00956406       *02910000
029200*                                                                *02920000
029210* DATE  02/22/2007                                               *02921079
029220*     CHANGE MADE: ADDED CODE THAT WILL LOOP THE CALCULATION OF  *02922079
029230*     THE PAYT-REQ-SEQ-NBR SIMILAR TO WHAT IS FOUND IN APKUP202  *02923079
029240*     AND APKUP225.  THIS IS BEING DONE TO REDUCE THE NUMBER OF  *02924079
029250*     -803 SQL ERROR CONDITIONS THAT CAN ABEND THIS PROGRAM.     *02925079
029260*     MOD PARAS G150-, U210-                                     *02926079
029270*     MADE BY: MIKE BESKE              WR/IR #: WR21578          *02927079
029280*                                                                *02928079
029300* DATE  03/11/2007                                               *02930079
029400*     CHANGE MADE: MATCH BY DC -- ADDED THE FIELDS DK-DC-NBR,    *02940049
029500*     DK-DC-NBR-LOW, DK-DC-NBR-HIGH, AND DK-MTCH-LVL-CDE TO      *02950049
029600*     TO WORKING STORAGE.  MADE THE FOLLOWING CHANGES TO THE     *02960049
029700*     TINVOIC_CSR, PREQIT_NULL_PO_CSR, AND POSTRR_CSR CURSORS:   *02970056
029800*        A) TINVOIC_CSR -- ADDED LOGIC IN THE WHERE CLAUSE TO    *02980045
029900*           INCLUDE MTCH_LVL_CDE = DK-MTCH-LVL-CDE AND DC_NBR    *02990045
030000*           BETWEEN DK-DC-NBR-LOW AND DK-DC-NBR-HIGH.  ALSO      *03000045
030100*           ADDED DC_NBR AND MTCH_LVL_CDE TO THE SELECT AND      *03010045
030200*           FETCH STATEMENTS.                                    *03020045
030300*        B) PREQIT_NULL_PO_CSR -- REPLACED THE STR_NBR           *03030045
030400*           CONDITION IN THE WHERE CLAUSE WITH                   *03040000
030500*           I.MTCH_LVL_CDE = DK-MTCH-LVL-CDE.                    *03050000
030600*        C) POSTRR_CSR -- INCLUDED MTCH_LVL_CDE IN THE SELECT    *03060007
030700*           AND FETCH STATEMENTS.                                *03070000
030800*     CREATED THE FOLLOWING NEW CURSORS:                         *03080007
030900*        A) TRECEIV_CSR -- SIMILAR TO THE TRECDIS_CSR CURSOR     *03090007
031000*           EXCEPT ALL STORE COMPARISON LOGIC HAS BEEN REPLACED  *03100045
031100*           WITH DC COMPARISON LOGIC IN THE WHERE CLAUSE.        *03110045
031200*        B) TNINREC_DC_CSR -- SIMILAR TO THE TNINREC_CSR CURSOR  *03120007
031300*           EXCEPT ALL STORE COMPARISON LOGIC HAS BEEN REPLACED  *03130007
031400*           WITH DC COMPARISON LOGIC IN THE WHERE CLAUSE.        *03140007
031500*     IN PARAGRAPH B200-PROCESS-POS, ADDED LOGIC TO POPULATE THE *03150007
031600*     DK-MTCH-LVL-CDE, DK-DC-NBR, AND PV-SAVE-DC-NBR FIELDS BASED*03160080
031610*     ON THE MATCH LEVEL.  CHANGED THE COMPARISON LOGIC FROM     *03161080
031620*     STORE TO MATCH LEVEL IN PARAGRAPHS C100-LOAD-RECEIPTS,     *03162080
031630*     C200-LOAD-NINREC, AND D700-RECONCILE.  IN PARAGRAPH        *03163080
031700*     D400-ADD-TO-INVOIC-TABLE, MOVED THE INVOIC-DC-NBR AND      *03170080
031800*     INVOIC-MTCH-LVL-CDE TO THE CORRESPONDING INTERNAL ARRAY    *03180080
031810*     FIELDS.  INCLUDED THE IA-DC-NBR(IA-SUB) AND DK-MTCH-LVL-CDE*03181080
031900*     IN POPULATING THE APRD270 COPYBOOK ALONG WITH REPLACING    *03190080
032000*     DK-STR-NBR WITH IA-STR-NBR(IA-SUB) IN PARAGRAPH            *03200080
032100*     D800-PREPARE-INVOICE-DETAIL.  IN PARAGRAPH                 *03210080
032200*     G100-ADD-REM-INVC-HEADER, POPULATED THE INVOIC-STR-NBR WITH*03220080
032300*     THE POSTRR-STR-NBR FIELD; THE INVOIC-DC-NBR WITH THE       *03230080
032400*     PV-SAVE-DC-NBR FIELD; AND THE INVOIC-MTCH-LVL-CDE WITH THE *03240080
032500*     DK-MTCH-LVL-CDE.  REPLACED ALL INSTANCES OF DK-STR-NBR WITH*03250080
032600*     POSTRR-STR-NBR IN PARAGRAPHS E500-CREATE-PRCCLM AND        *03260080
032700*     E200-CREATE-NINREC.  INCLUDED DC_NBR AND MTCH_LVL_CDE IN   *03270080
032800*     THE INSERT STATMENT OF PARAGRAPH U210-INSERT-TINVOIC.      *03280080
032900*     ALSO INCLUDED THE MTCH_LVL_CDE IN THE WHERE LOGIC OF THE   *03290080
033000*     UPDATE STATEMENT IN PARAGRAPHS U950-UPDATE-TPOSTRR AND     *03300080
033100*     U960-BYPASS-POSTRR.                                        *03310080
033700*     CHANGED LOGIC IN THE PROGRAM TO ALLOW FOR ZERO QUANTITY OR *03370059
033800*     ZERO UNIT COST RECEIVERS TO AUTO RECONCILE.  IN PARAGRAPH  *03380059
033900*     E100-UPDATE-PO-LNE-TABLE, INCLUDED A CHECK ON THE RECEIVER *03390059
034000*     QUANTITY AMOUNT BEING GREATER THAN ZERO.  IF TRUE, THE UNIT*03400059
034100*     COST DIFFERENCE COMPARISON WOULD NOT BE PERFORMED.  IN     *03410059
034200*     PARAGRAPH F100-CHECK-COST-DIFF-PCT, ADDED CODE TO ONLY     *03420059
034300*     PERFORM THE COST DIFFERENCE COMPARISON WHEN THE RECEIVER   *03430059
034400*     UNIT COST IS GREATER THAN ZERO.                            *03440059
034500*     LASTLY, REMOVED ALL REFERENCES OF TABLE TPAYREQ FROM THE   *03450059
034600*     PROGRAM (INCLUDED DELETING THE PARAGRAPH                   *03460059
034700*     U200-INSERT-TPAYREQ) AND REPLACED ALL INSTANCES OF         *03470059
034800*     PAYREQ-PAYT-REQ-SEQ-NBR WITH INVOIC-PAYT-REQ-SEQ-NBR.      *03480060
034900*     ALSO REMOVED ALL REFERENCES OF TABLE TAUDINC FROM THE      *03490060
035000*     PROGRAM (INCLUDED DELETING THE PARAGRAPHS                  *03500060
035100*     E400-CREATE-AUDIT-ROW AND U600-INSERT-AUDIT-ROW).          *03510060
035200*     MADE BY: KRYSTEN LEARY           WR/IR #: WR21578          *03520000
035300*                                                                *03530086
035400* DATE  03/26/2007                                               *03540081
035500*     CHANGE MADE:                                               *03550081
035600*     MODIFIED PREQIT_NULL_PO_CSR TO FETCH ONLY STORE OR DC      *03560081
035700*     THIS WAS DONE TO FIX A DIRECT STORE COST MISMATCH ISSUE    *03570081
035900*     MADE BY: GREG WISIALOWSKI        WR/IR #: PM00999409       *03590082
035910*                                                                *03591086
035920* DATE  02/04/2008                                               *03592089
035930*     CHANGE MADE:                                               *03593084
035940*     MODIFIED PARAGRAPHS D210-, R400- AND R450- TO REPLACE      *03594084
035941*     PURITM-UNT-COST-AMT WITH PURITM-PRD-1ST-COST-AMT IN ORDER  *03594184
035950*     TO CONTINUE TO PROCESS DOMESTIC POS WITH THE INITIAL COST  *03595084
035951*     OF THE PRODUCT. ALSO MODIFIED TRECDIS & TRECEIV CURSORS TO *03595186
035952*     REPLACE P.UNT_COST_AMT WITH P.PRD_1ST_COST_AMT.            *03595286
035960*     MADE BY: IRMA NAVA               WR/IR #: WR32664          *03596084
036000*                                                                *03600081
036010* DATE  06/07/2010                                               *03601098
036020*     CHANGE MADE:                                               *03602090
036040*     MODIFIED THIS PROGRAM TO CHANGE THE BUSINESS RULE THAT POS *03604098
036041*     WHERE THERE WERE MULTIPLE INVOICE UNIT COSTS FOR THE SAME  *03604198
036050*     LINE COULD NOT BE AUTOMATICALLY RECONCILED.  NEW LOGIC WAS *03605098
036051*     INSERTED TO HANDLE THE PROCESSING OF THE MULTIPLE UNIT     *03605198
036060*     COSTS, MOST OF WHICH WAS CLONED FROM APKCS330, ONLINE      *03606098
036061*     RECONCILIATION.  MODIFIED PARAGRAPHS D500-, E100- AND F100-*03606198
036070*     TO REPLACE LOGIC THAT HANDLED BYPASSING POS WITH THIS      *03607098
036071*     SCENARIO WITH LOGIC TO FACILITATE THE MULITPLE UNIT COSTS. *03607198
036072*     ADDED THE INVC_ITM_CSR AND THE OPEN/CLOSE/FETCH PARAGRAPHS *03607298
036073*     NEEDED TO PROCESS IT.  ADDED PARAGRAPHS E150, F400, F500   *03607398
036074*     AND F600 TO PROCESS THE MULTIPLE UNIT COSTS.  CHANGES BEGUN*03607498
036075*     BY GREG WISIALOWSKI IN MARCH, 2009.  FINAL CHANGES AND     *03607598
036076*     TESTING COMPLETED IN MAY, 2010.                            *03607698
036089*     MADE BY: NANCY EILBES            WR/IR #: WR31316          *03608998
036090*                                                                *03609090
036092* DATE 12/17/2015                                                *03609299
036093*     CHANGE MADE: RECOMPILED TO INCLUDE CHANGES TO APWS008      *03609399
036094*     TO INCREASE THE INVOICE ARRAY TO 8000 ENTRIES.             *03609499
036095*     MADE BY: NANCY EILBES            WR/IR #: CHG0130416       *03609599
036096*                                                                *03609699
036097* DATE 12/01/2016                                                *03609799
036098*     CHANGE MADE: RECOMPILED TO INCLUDE CHANGES TO APWS008      *03609899
036099*     TO INCREASE THE INVOICE ARRAY TO 50000 ENTRIES.            *03609999
036100*     MADE BY: NANCY EILBES            WR/IR #: CHG0157916       *03610099
036101*                                                                *03610199
036102* DATE 03/02/2020                                                *03610299
036103*     CHANGE MADE: ADDED SQLCODE 100 CONDITION IN PARA           *03610399
036104*     U960-BYPASS-POSTRR TO AVOID THE FAILURE WHEN PO/STR IS     *03610499
036105*     NOT FOUND IN THE TABLE TPOSTRR.                            *03610599
036106*     MADE BY: SARVESWARAN N S KANNAN  WR/IR #: CHG0240639       *03610699
036107*     CHANGE TAG: C40639                                         *03610799
036108*                                                                *03610899
036109* DATE 03/02/2020                                                *03610999
036110*     CHANGE MADE: ADDED SQLCODE 100 CONDITION IN PARA           *03611099
036111*     U950-UPDATE-TPOSTRR TO AVOID THE FAILURE WHEN PO/STR IS    *03611199
036112*     NOT FOUND IN THE TABLE TPOSTRR.                            *03611299
036113*     MADE BY: SARVESWARAN N S KANNAN  WR/IR #: CHG0240639       *03611399
036114*     CHANGE TAG: C40639                                         *03611499
036115*                                                                *03611599
036116* DATE 05/11/2021                                                *03611699
036117*     CHANGE MADE: ADD A NEW INDICATOR FOR SEPHORA VENDORS       *03611799
036118*     MADE BY: JEAN KURK               CHG0256545                *03611899
036119*                                                                *03611999
036120* DATE 04/06/2023                                                *03612099
036121*     CHANGE MADE: FIX DUPLICATE REMAINDER INVOICE NUMBERS FOR   *03612199
036122*                  SAME VENDOR ISSUE                             *03612299
036123*     MADE BY: JEAN KURK               CHG0286435                *03612399
036124*                                                                *03612499
036125* DATE 05/24/2023                                                *03612599
036126*     CHANGE MADE: CHANGED BUSINESS RULES TO ALLOW UP TO 50000   *03612699
036127*     PRICE CLAIMS TO BE GENERATED - SAME AS ONLINE RECON. ALSO  *03612799
036128*     ADDED LOGIC TO SKIP THE UNIT COST DISCREPANCY RULE IN      *03612899
036129*     F100-CHECK-COST-DIF-PCT FOR POS WITH TYPE CD.              *03612999
036130*     MADE BY: NANCY EILBES            WR/IR #: CHG0288986       *03613099
036131*                                                                *03613199
036132* DATE  01/03/2024                                               *03613299
036133*     CHANGE MADE: ADDED LOGIC TO LOOK FOR INCOMPLETE RECEIVERS  *03613399
036134*     ON POS THAT ARE BEING BYPASSED AND SENT TO THE MANUAL RECON*03613499
036135*     REPORT.  INCREASED LENGTH OF TABLE TOUTAP5 TO ACCOMMODATE  *03613599
036136*     THE NEW INDICATOR IN COPYBOOK APRD270.                     *03613699
036137*     MADE BY: NANCY EILBES            WR/IR #: CHG0297757       *03613799
036140******************************************************************03614099
036200                                                                  03620007
036300 ENVIRONMENT DIVISION.                                            03630000
036400 CONFIGURATION SECTION.                                           03640000
036500 SOURCE-COMPUTER.    IBM-3090.                                    03650000
036600 OBJECT-COMPUTER.    IBM-3090.                                    03660000
036700                                                                  03670000
036800 INPUT-OUTPUT SECTION.                                            03680000
036900 FILE-CONTROL.                                                    03690000
037000 DATA DIVISION.                                                   03700000
037100 FILE SECTION.                                                    03710000
037200                                                                  03720000
037300 WORKING-STORAGE SECTION.                                         03730000
037400                                                                  03740000
037500 01  PV-PROGRAM-VARIABLES.                                        03750000
037600     05  FILLER                      PIC  X(30)  VALUE            03760000
037700         '** BEGINING OF APKUP230 W/S **'.                        03770000
037800     05  PV-PROGRAM-NAME             PIC  X(08)  VALUE 'APKUP230'.03780000
037900     05  PV-CURRENT-PARAGRAPH        PIC  X(35)  VALUE SPACE.     03790000
038000                                                                  03800000
038100     05  PV-PO-NBR                      PIC 9(09)  VALUE ZERO.    03810000
038200     05  PV-SAVE-DC-NBR                 PIC 9(05)  VALUE ZEROS.   03820070
038300                                                                  03830000
038400     05  PV-RANDOM-KEY                  PIC 9(09)  VALUE ZERO.    03840000
038500     05  FILLER  REDEFINES PV-RANDOM-KEY.                         03850000
038600         10  PV-RANDOM-KEY-NANOSEC-1    PIC X(03).                03860000
038700         10  PV-RANDOM-KEY-NANOSEC-2    PIC X(03).                03870000
038800         10  PV-RANDOM-KEY-MINUTE       PIC X(02).                03880000
038900         10  PV-RANDOM-KEY-SECOND       PIC X(01).                03890000
039000                                                                  03900000
039100     05  PV-RANDOM-KEY-INT              PIC S9(9)    VALUE ZERO   03910000
039200                                                     COMP.        03920000
039300     05  PV-DECIMAL-8                   PIC S9(10)V9(8)           03930000
039400                                        VALUE ZEROS  COMP-3.      03940000
039500     05  PV-BYPASS-REASON-CODE          PIC  X(02)  VALUE SPACE.  03950000
039600         88  MANUAL-VEND-DEPT                       VALUE '01'.   03960000
039700         88  TOO-MANY-RECEIV                        VALUE '02'.   03970000
039800         88  TOO-MANY-RECDIS                        VALUE '03'.   03980000
039900         88  TOO-MANY-NINREC                        VALUE '04'.   03990000
040000         88  TOO-MANY-INVOIC                        VALUE '05'.   04000000
040100*        88  RCV-ZERO-COST                          VALUE '06'.   04010000
040200         88  OVER-SHORT                             VALUE '07'.   04020000
040300*        88  MULT-INVC-COST                         VALUE '08'.   04030090
040400         88  COST-DIF-OVER-LIMIT                    VALUE '09'.   04040000
040500         88  TOO-MANY-PRCCLM                        VALUE '10'.   04050000
040600         88  NO-INVOICE-DETAIL                      VALUE '11'.   04060000
040700         88  REMAINDER-IN-OUT                       VALUE '12'.   04070000
040800         88  RETRIEVE-INVOICES                      VALUES        04080000
040900                                        '01', '02', '03', '04'.   04090000
041000                                                                  04100000
041100     05  PV-REMAINDER-FIELDS.                                     04110000
041200         10  PV-PAYT-REQ-SEQ-NBR-X.                               04120000
041300             15  FILLER                 PIC X(1)     VALUE 'R'.   04130000
041400             15  PV-PAYT-REQ-SEQ-NBR-9  PIC 9(9)     VALUE ZERO.  04140000
041500         10  PV-REMAINDER-TOT-COST      PIC S9(11)V99             04150000
041600                                        VALUE ZEROS  COMP-3.      04160000
041700         10  PV-REMAINDER-INVC-QTY      PIC S9(9)    VALUE ZERO   04170000
041800                                                     COMP-3.      04180000
041900         10  PV-REMAINDER-INVC-DTE      PIC X(10)    VALUE SPACE. 04190000
042000         10  PV-HOLD-IND                PIC X(1)     VALUE SPACE. 04200000
042100                                                                  04210000
042200     05  PV-INVOICE-FIELDS.                                       04220000
042300         10  PV-NULL-LNE-NBR-IND        PIC X        VALUE SPACE. 04230000
042400             88  PV-PO-LNE-NBR-NOT-NULL              VALUE '1'.   04240000
042500             88  PV-PO-LNE-NBR-IS-NULL               VALUE '2'.   04250000
042600         10  PV-APP-LNE-NBR             PIC S9(9)    VALUE ZEROS  04260000
042700                                                     COMP.        04270000
042800         10  PV-KEY-LNE-NBR             PIC S9(9)    VALUE ZEROS  04280000
042900                                                     COMP.        04290000
043000         10  PV-QTY                     PIC S9(9)    VALUE ZEROS  04300000
043100                                                     COMP.        04310000
043200         10  PV-UNT-COST-AMT            PIC S9(7)V9(3)            04320000
043300                                        VALUE ZEROS  COMP-3.      04330000
043400         10  PV-PAYT-REQ-SEQ-NBR        PIC S9(9)    VALUE ZEROS  04340000
043500                                                     COMP.        04350000
043600         10  PV-CSR-NULL-LNE-NBR-IND    PIC X        VALUE SPACE. 04360000
043700         10  PV-CSR-APP-LNE-NBR         PIC S9(9)    VALUE ZEROS  04370000
043800                                                     COMP.        04380000
043900         10  PV-CSR-KEY-LNE-NBR         PIC S9(9)    VALUE ZEROS  04390000
044000                                                     COMP.        04400000
044100         10  PV-CSR-QTY                 PIC S9(9)    VALUE ZEROS  04410000
044200                                                     COMP.        04420000
044300         10  PV-CSR-UNT-COST-AMT        PIC S9(7)V9(3)            04430000
044400                                        VALUE ZEROS  COMP-3.      04440000
044500         10  PV-CSR-PAYT-REQ-SEQ-NBR    PIC S9(9)    VALUE ZEROS  04450000
044600                                                     COMP.        04460000
044700                                                                  04470000
044800     05  PV-PRCCLM-FIELDS.                                        04480000
044900         10  PV-PRCCLM-DIFFERENCE       PIC S9(7)V9(3)            04490000
045000                                         VALUE ZEROS COMP-3.      04500000
045100         10  PV-UNT-COST-DIF            PIC S9(7)V9(3)            04510000
045200                                         VALUE ZEROS COMP-3.      04520000
045300         10  PV-COST-PCT-AMT            PIC S9(11)V9(3)           04530000
045400                                         VALUE ZEROS COMP-3.      04540000
045500                                                                  04550000
045600     05  PV-DISCOUNT-FIELDS.                                      04560000
045700         10  PV-TOTAL-GROSS-COST        PIC S9(9)V99 VALUE ZEROS  04570000
045800                                                     COMP-3.      04580000
045900         10  PV-TOTAL-DISCOUNT-AMT      PIC S9(9)V99 VALUE ZEROS  04590000
046000                                                     COMP-3.      04600000
046100         10  PV-WEIGHTED-DISC-PCT       PIC SV9(04)  VALUE ZEROS  04610000
046200                                                     COMP-3.      04620000
046300         10  PV-WEIGHTED-COOP-PCT       PIC SV9(04)  VALUE ZEROS  04630000
046400                                                     COMP-3.      04640000
046500         10  PV-WEIGHTED-NSD-PCT        PIC SV9(04)  VALUE ZEROS  04650000
046600                                                     COMP-3.      04660000
046700         10  PV-WEIGHTED-MOS-PCT        PIC SV9(04)  VALUE ZEROS  04670000
046800                                                     COMP-3.      04680000
046900         10  PV-WEIGHTED-TRD-PCT        PIC SV9(04)  VALUE ZEROS  04690000
047000                                                     COMP-3.      04700000
047100         10  PV-WEIGHTED-MSC-PCT        PIC SV9(04)  VALUE ZEROS  04710000
047200                                                     COMP-3.      04720000
047300         10  PV-WEIGHTED-ALW-PCT        PIC SV9(04)  VALUE ZEROS  04730000
047400                                                     COMP-3.      04740000
047500                                                                  04750000
047600     05  PV-DISCOUNT-COST-FIELDS.                                 04760000
047700         10  PV-ADV-DISC-AMT            PIC S9(9)V99 VALUE ZEROS  04770000
047800                                                     COMP-3.      04780000
047900         10  PV-DISCOUNTED-COST-AMT                               04790000
048000                                        PIC S9(9)V99 VALUE ZEROS  04800000
048100                                                     COMP-3.      04810000
048200         10  PV-TOTAL-DISCOUNTED-COST-AMT                         04820000
048300                                        PIC S9(9)V99 VALUE ZEROS  04830000
048400                                                     COMP-3.      04840000
048500         10  PV-COOP-ALLOW-AMT          PIC S9(9)V99 VALUE ZEROS  04850000
048600                                                     COMP-3.      04860000
048700         10  PV-WEIGHTED-ADV-PCT        PIC SV9(04)  VALUE ZEROS  04870000
048800                                                     COMP-3.      04880000
048900         10  PV-NEW-STORE-AMT           PIC S9(9)V99 VALUE ZEROS  04890000
049000                                                     COMP-3.      04900000
049100         10  PV-MOS-DISCOUNT-AMT        PIC S9(9)V99 VALUE ZEROS  04910000
049200                                                     COMP-3.      04920000
049300         10  PV-TRADE-DISCOUNT-AMT      PIC S9(9)V99 VALUE ZEROS  04930000
049400                                                     COMP-3.      04940000
049500         10  PV-MISC-DISCOUNT-AMT       PIC S9(9)V99 VALUE ZEROS  04950000
049600                                                     COMP-3.      04960000
049700         10  PV-PRFT-ASST-COOP-AMT      PIC S9(9)V99 VALUE ZEROS  04970000
049800                                                     COMP-3.      04980000
049900                                                                  04990000
050000     05  PV-DISC-PAY-DAY-QTY            PIC  S9(4) COMP.          05000000
050100                                                                  05010000
050200     05  PV-NULL-INDICATORS.                                      05020000
050300         10  MIITEM-PO-LNE-NBR-NN       PIC S9(4)    VALUE ZEROS  05030000
050400                                                     COMP.        05040000
050500         10  MIITEM-VER-NBR-NN          PIC S9(4)    VALUE ZEROS  05050000
050600                                                     COMP.        05060000
050700                                                                  05070000
050800     05  PV-COUNTERS.                                             05080000
050900         10  PV-READ-COUNT              PIC S9(09)   VALUE ZERO   05090000
051000                                                     COMP-3.      05100000
051100         10  PV-RETRY-COUNTER           PIC S9(04)   VALUE ZERO   05110000
051200                                                     COMP SYNC.   05120000
051300         10  WS-INSERT-INVC-RETRY-COUNTER                         05130075
051400                                        PIC S9(4) COMP VALUE ZERO.05140075
051500         10  WS-DISPLAY-RETRY-COUNTER                             05150075
051600                                        PIC 9(9)  VALUE ZEROS.    05160075
051700         10  PV-PO-COUNT                PIC S9(09)   VALUE ZERO   05170000
051800                                                     COMP-3.      05180000
051900         10  PV-POS-RECONCILED          PIC S9(09)   VALUE ZERO   05190000
052000                                                     COMP-3.      05200000
052100         10  PV-POS-BYPASSED            PIC S9(09)   VALUE ZERO   05210000
052200                                                     COMP-3.      05220000
052300         10  PV-INVOICE-COUNT           PIC S9(09)   VALUE ZERO   05230000
052400                                                     COMP-3.      05240000
052410         10  PV-RCV-INCOMPLETE-COUNT    PIC S9(09)  VALUE +0      05241099
052420                                                    COMP-3.       05242099
052500                                                                  05250000
052600     05  PV-REC-TMST                    PIC X(26).                05260000
052700     05  PV-REC-TMST-RED REDEFINES PV-REC-TMST.                   05270000
052800         10  PV-REC-TMST-DATE           PIC X(10).                05280000
052900         10  PV-REC-TMST-TIME           PIC X(16).                05290000
052910     05  PV-INVC-SUM-QTY                PIC S9(9) COMP.           05291090
052920     05  PV-PRCCLM-QTY-SUMMED           PIC S9(9) COMP.           05292090
052930     05  PV-PO-LNE-NBR                  PIC S9(9) COMP.           05293090
052940     05  PV-RI-ITEM-QTY-MAX             PIC S9(9)     COMP-3.     05294090
053000                                                                  05300000
053100 01  CURR-TIMESTAMP                     PIC  X(26)   VALUE SPACES.05310000
053200 01  FILLER REDEFINES CURR-TIMESTAMP.                             05320000
053300     05  CURR-TMST-DATE.                                          05330000
053400         10  CURR-TMST-CENT             PIC  9(02).               05340000
053500         10  CURR-TMST-YEAR             PIC  9(02).               05350000
053600         10  FILLER                     PIC  X(01).               05360000
053700         10  CURR-TMST-MONTH            PIC  9(02).               05370000
053800         10  FILLER                     PIC  X(01).               05380000
053900         10  CURR-TMST-DAY              PIC  9(02).               05390000
054000     05  FILLER                         PIC  X(16).               05400000
054100 01  CURR-DATE                          PIC  X(10).               05410000
054200 01  KEY-TIMESTAMP                      PIC  X(26)   VALUE SPACES.05420000
054300 01  FILLER  REDEFINES KEY-TIMESTAMP.                             05430000
054400     05  FILLER                         PIC  X(14).               05440000
054500     05  KEY-MINUTE                     PIC  X(02).               05450000
054600     05  FILLER                         PIC  X(02).               05460000
054700     05  KEY-SECOND                     PIC  X(01).               05470000
054800     05  FILLER                         PIC  X(01).               05480000
054900     05  KEY-NANOSEC-1                  PIC  X(03).               05490000
055000     05  KEY-NANOSEC-2                  PIC  X(03).               05500000
055100                                                                  05510000
055200 01  DK-DB2-KEYS.                                                 05520000
055300     05  DK-PO-NBR                    PIC S9(09)     VALUE +0     05530000
055400                                                     COMP.        05540000
055500     05  DK-STR-NBR                   PIC S9(04)     VALUE +0     05550000
055600                                                     COMP.        05560000
055700     05  DK-STR-NBR-LOW               PIC S9(04)     VALUE +0     05570000
055800                                                     COMP.        05580000
055900     05  DK-STR-NBR-HIGH              PIC S9(04)     VALUE +0     05590000
056000                                                     COMP.        05600000
056100     05  DK-PAYT-REQ-SEQ-NBR          PIC S9(09)     VALUE +0     05610000
056200                                                     COMP.        05620000
056300     05  DK-DC-NBR                    PIC S9(04)     VALUE +0     05630042
056400                                                     COMP.        05640042
056500     05  DK-DC-NBR-LOW                PIC S9(04)     VALUE +0     05650026
056600                                                     COMP.        05660026
056700     05  DK-DC-NBR-HIGH               PIC S9(04)     VALUE +0     05670026
056800                                                     COMP.        05680026
056900     05  DK-MTCH-LVL-CDE              PIC X(01)      VALUE SPACE. 05690026
057000                                                                  05700003
057100 01  PC-PROGRAM-CONSTANTS.                                        05710000
057200     05  PC-NULL-DATE                   PIC  X(26)   VALUE        05720000
057300        '9999-09-09'.                                             05730000
057400     05  PC-NULL-TIMESTAMP              PIC  X(26)   VALUE        05740000
057500        '9999-09-09-09.09.09.999999'.                             05750000
057600     05  PC-MAX-ITEMS                   PIC S9(09)   VALUE        05760000
057700                                                    +1000000      05770000
057800                                                     COMP-3.      05780000
057900     05  PC-MAX-RETRIES                 PIC S9(03)   VALUE +12    05790000
058000                                                     COMP-3.      05800000
058100                                                                  05810000
058200 01  PS-PROGRAM-SWITCHES.                                         05820000
058300     05  PS-BYPASS-PO-SW                PIC  X(01)   VALUE 'Y'.   05830000
058400         88  PROCESS-PO                              VALUE 'Y'.   05840000
058500         88  BYPASS-PO                               VALUE 'N'.   05850000
058600     05  PS-ERRORS-FOUND-SW             PIC  X(01)   VALUE 'Y'.   05860000
058700         88  NO-ERRORS-FOUND                         VALUE 'Y'.   05870000
058800         88  ERRORS-FOUND                            VALUE 'N'.   05880000
058900     05  PS-ITEMS-LEFT-ON-DB-SW       PIC  X         VALUE 'Y'.   05890000
059000         88  NO-ITEMS-LEFT-ON-DB                     VALUE 'N'.   05900000
059100         88  ITEMS-LEFT-ON-DB                        VALUE 'Y'.   05910000
059110     05  PS-INVC-ITEM-SW              PIC  X         VALUE 'Y'.   05911090
059120         88  MORE-INVC-ITEMS                         VALUE 'Y'.   05912090
059130         88  NO-MORE-INVC-ITEMS                      VALUE 'N'.   05913090
059140     05  PS-PRCCLM-AMT-SUMMED-SW      PIC  X         VALUE 'Y'.   05914090
059150         88  AMT-NOT-SUMMED                          VALUE 'Y'.   05915090
059160         88  AMT-SUMMED                              VALUE 'N'.   05916090
059200     05  PS-ALLOWANCES-SWITCH         PIC  X         VALUE 'N'.   05920000
059300         88  OUT-OF-ALLOWANCES                       VALUE 'Y'.   05930000
059400         88  MORE-ALLOWANCES                         VALUE 'N'.   05940000
059500     05  PS-ALLOWANCES-SWITCH         PIC  X         VALUE 'N'.   05950000
059600         88  OUT-OF-ADVERT-ALLWS                     VALUE 'Y'.   05960000
059700         88  MORE-ADVERT-ALLWS                       VALUE 'N'.   05970000
059800     05  PS-OUT-OF-VENDORS-SW         PIC  X         VALUE 'M'.   05980000
059900         88  OUT-OF-VENDORS                          VALUE 'O'.   05990000
060000         88  MORE-VENDORS                            VALUE 'M'.   06000000
060100     05  PS-OUT-OF-POS-SW             PIC  X         VALUE 'M'.   06010000
060200         88  OUT-OF-POS                              VALUE 'O'.   06020000
060300         88  MORE-POS                                VALUE 'M'.   06030000
060400     05  PS-FIRSTTIME-SW              PIC  X         VALUE 'Y'.   06040000
060500         88  FIRSTTIME                               VALUE 'Y'.   06050000
060600         88  NOT-FIRSTTIME                           VALUE 'N'.   06060000
060700     05  PS-RI-INVC-CREATED-SW        PIC  X         VALUE 'Y'.   06070000
060800         88  RI-INVC-CREATED                         VALUE 'Y'.   06080000
060900         88  RI-INVC-NOT-CREATED                     VALUE 'N'.   06090000
061000     05  PS-INPUT-REMAINDER-SW        PIC  X         VALUE 'N'.   06100000
061100         88  NO-INPUT-REMAINDER                      VALUE 'N'.   06110000
061200         88  INPUT-REMAINDER                         VALUE 'Y'.   06120000
061300     05  PS-QTY-SHORTAGE-SW           PIC  X         VALUE 'N'.   06130000
061400         88  QTY-NO-SHORTAGE                         VALUE 'N'.   06140000
061500         88  QTY-SHORTAGE                            VALUE 'Y'.   06150000
061600     05  PS-QTY-OVERAGE-SW            PIC  X         VALUE 'N'.   06160000
061700         88  QTY-NO-OVERAGE                          VALUE 'N'.   06170000
061800         88  QTY-OVERAGE                             VALUE 'Y'.   06180000
061900     05  PS-NEW-RC-STATUS-SW          PIC X          VALUE 'N'.   06190000
062000         88  NEW-RC-STATUS                           VALUE 'Y'.   06200000
062100         88  NOT-NEW-RC-STATUS                       VALUE 'N'.   06210000
062110     05  PS-RECV-COMPLETE-IND         PIC X          VALUE 'N'.   06211099
062120         88  RECV-INCOMPLETE                         VALUE 'Y'.   06212099
062130         88  RECV-COMPLETE                           VALUE 'N'.   06213099
062200     05  INSERT-SUCCESSFUL-SW         PIC X(01)      VALUE 'N'.   06220074
062300         88  INSERT-SUCCESSFUL                       VALUE 'Y'.   06230074
062400         88  INSERT-NOT-SUCCESSFUL                   VALUE 'N'.   06240074
062500                                                                  06250007
062600 01  EV-IDX-MAX                           PIC S9(04) VALUE 500    06260000
062700                                                     COMP SYNC.   06270000
062800 01  EXCL-VENDOR-TABLE.                                           06280000
062900     05  EXCL-VENDOR-ENTRIES                                      06290000
063000         OCCURS 500 TIMES                                         06300000
063100         INDEXED BY EV-IDX.                                       06310000
063200         10  T-EV-ENT-ID                  PIC  S9(9) COMP.        06320000
063300         10  T-EV-DEPT-NBR                PIC   X(3).             06330000
063400                                                                  06340007
063500*--------------------------------------------------------------*  06350007
063600* THE PO LINE TABLE IS SET UP SUCH THAT THE OCCURRENCE NUMBER  *  06360007
063700* WILL MATCH THE APP-PO-LNE-NBR.  THE LAST OCCURRENCE WILL BE  *  06370007
063800* RESERVED FOR UNMATCHED PO LINES ON THE INVOICE.              *  06380007
063900*--------------------------------------------------------------*  06390007
064000 01  PO-LINE-TABLE.                                               06400000
064100     05  PO-LINE-ENTRIES                                          06410000
064200         OCCURS 1000 TIMES                                        06420000
064300         INDEXED BY PO-IDX.                                       06430000
064400         10  T-PAYT-REQ-SEQ-NBR           PIC  S9(9) COMP.        06440000
064500         10  T-APP-PO-LNE-NBR             PIC  S9(9) COMP.        06450000
064600         10  T-KEY-PO-LNE-NBR             PIC  S9(9) COMP.        06460000
064700         10  T-INVC-QTY                   PIC  S9(9) COMP.        06470000
064800         10  T-INVC-UNT-COST-AMT          PIC  S9(7)V9(3)  COMP-3.06480000
064900         10  T-RECV-QTY                   PIC  S9(9) COMP.        06490000
065000         10  T-RECV-UNT-COST-AMT          PIC  S9(7)V9(3)  COMP-3.06500000
065100         10  T-PRCCLM-QTY                 PIC  S9(9) COMP.        06510000
065200         10  T-QTY-DIF-SW                 PIC  X(01).             06520000
065300             88  T-QTY-MATCH                         VALUE 'M'.   06530000
065400             88  T-QTY-OVER                          VALUE 'O'.   06540000
065500             88  T-QTY-SHORT                         VALUE 'S'.   06550000
065510         10  T-MULT-INVC-SW               PIC  X(01).             06551090
065600     05  PC-BLANK-PO-LINE-TABLE-ENTRY.                            06560000
065700         10  PC-PAYT-REQ-SEQ-NBR          PIC  S9(9) COMP.        06570000
065800         10  PC-APP-PO-LNE-NBR            PIC  S9(9) COMP.        06580000
065900         10  PC-KEY-PO-LNE-NBR            PIC  S9(9) COMP.        06590000
066000         10  PC-INVC-QTY                  PIC  S9(9) COMP.        06600000
066100         10  PC-INVC-UNT-COST             PIC  S9(7)V9(3)  COMP-3.06610000
066200         10  PC-RECV-QTY                  PIC  S9(9) COMP.        06620000
066300         10  PC-RECV-UNT-COST             PIC  S9(7)V9(3)  COMP-3.06630000
066400         10  PC-PRCCLM-QTY                PIC  S9(9) COMP.        06640000
066500         10  PC-QTY-DIF-SW                PIC  X(01).             06650000
066510         10  PC-MULT-INVC-SW              PIC  X(01).             06651090
066600                                                                  06660007
066700*--------------------------------------------------------------*  06670007
066800* COPYBOOK OF A WORKING STORAGE AREA CONTAINING INVOICE DATA   *  06680007
066900*--------------------------------------------------------------*  06690007
067000     COPY APWS008.                                                06700000
067100                                                                  06710007
067200 01  TRECEIV-TABLE.                                               06720000
067300     05  TRECEIV-ENTRY                                            06730000
067400         OCCURS 250 TIMES                                         06740000
067500         INDEXED BY RC-IDX.                                       06750000
067600         10  T-ORD-NBR                    PIC  S9(9) COMP.        06760000
067700         10  T-REC-SEQ-NBR                PIC  S9(9) COMP.        06770000
067800         10  T-CRE-TMST                   PIC  X(26).             06780000
067900     05  PV-TRECEIV-KEY.                                          06790000
068000         10  PV-ORD-NBR                   PIC  S9(9) COMP.        06800000
068100         10  PV-REC-SEQ-NBR               PIC  S9(9) COMP.        06810000
068200         10  PV-CRE-TMST                  PIC  X(26).             06820000
068300                                                                  06830000
068400 01  TRECDIS-TABLE.                                               06840000
068500     05  TRECDIS-ENTRY                                            06850000
068600         OCCURS 9999 TIMES                                        06860000
068700         INDEXED BY RD-IDX.                                       06870000
068800         10  T-RD-ORD-NBR                 PIC  S9(9) COMP.        06880000
068900         10  T-RD-ORD-LNE-NBR             PIC  S9(9) COMP.        06890000
069000         10  T-RD-REC-SEQ-NBR             PIC  S9(9) COMP.        06900000
069100         10  T-RD-OPER-UNT-ID             PIC  S9(4) COMP.        06910000
069200         10  T-RD-FCLTY-ID                PIC  S9(4) COMP.        06920000
069300         10  T-RD-STR-NBR                 PIC  S9(4) COMP.        06930000
069400         10  T-RD-STR-FCLTY-ID            PIC  S9(4) COMP.        06940000
069500         10  T-RD-CRE-TMST                PIC  X(26).             06950000
069600     05  PV-TRECDIS-KEY.                                          06960000
069700         10  PV-RD-ORD-NBR                PIC  S9(9) COMP.        06970000
069800         10  PV-RD-ORD-LNE-NBR            PIC  S9(9) COMP.        06980000
069900         10  PV-RD-REC-SEQ-NBR            PIC  S9(9) COMP.        06990000
070000         10  PV-RD-OPER-UNT-ID            PIC  S9(4) COMP.        07000000
070100         10  PV-RD-FCLTY-ID               PIC  S9(4) COMP.        07010000
070200         10  PV-RD-STR-NBR                PIC  S9(4) COMP.        07020000
070300         10  PV-RD-STR-FCLTY-ID           PIC  S9(4) COMP.        07030000
070400         10  PV-RD-CRE-TMST               PIC  X(26).             07040000
070500                                                                  07050007
070600 01  TNINREC-TABLE.                                               07060000
070700     05  TNINREC-ENTRY                                            07070000
070800         OCCURS 999 TIMES                                         07080000
070900         INDEXED BY NI-IDX.                                       07090000
071000         10  T-NI-PO-LNE-NBR            PIC S9(9)    COMP.        07100000
071100         10  T-NI-NON-INVC-SEQ-NBR      PIC S9(9)    COMP.        07110000
071200     05  PV-TNINREC-KEY.                                          07120000
071300         10  PV-NI-PO-LNE-NBR           PIC S9(9)    COMP.        07130000
071400         10  PV-NI-NON-INVC-SEQ-NBR     PIC S9(9)    COMP.        07140000
071410                                                                  07141099
071430 01  PV-PRCCLM-MAX                      PIC S9(05) VALUE +50000.  07143099
071440                                                                  07144099
071600 01  TPRCCLM-TABLE.                                               07160000
071700     05  TPRCCLM-ENTRY                                            07170000
071800         OCCURS 50000 TIMES                                       07180099
071900         INDEXED BY PR-IDX.                                       07190000
072000         10  T-PR-DOC-TYP-CDE           PIC X(02).                07200000
072100         10  T-PR-INVC-ID               PIC X(22).                07210000
072200         10  T-PR-PO-LINE-NBR           PIC S9(9)    COMP.        07220000
072300         10  T-PR-UNIT-QTY              PIC S9(07)   COMP-3.      07230000
072400         10  T-PR-UNIT-COST             PIC S9(9)V999 COMP-3.     07240000
072500         10  T-PR-ADJ-COST              PIC S9(9)V999 COMP-3.     07250000
072600                                                                  07260007
072700*--------------------------------------------------------------*  07270007
072800* WORKING STORAGE AREA FOR APPD052, DISCOUNT CALCULATION.      *  07280007
072900*--------------------------------------------------------------*  07290007
073000     COPY APWS052.                                                07300000
073100                                                                  07310007
073200*--------------------------------------------------------------*  07320007
073300* RECORD LAYOUT FOR INPUT INVOICE FILE                         *  07330007
073400*--------------------------------------------------------------*  07340007
073500     COPY APRD060.                                                07350000
073600                                                                  07360007
073700*--------------------------------------------------------------*  07370007
073800* RECORD LAYOUT FOR POS REQUIRING MANUAL RECONCILIATION        *  07380007
073900*--------------------------------------------------------------*  07390007
074000     COPY APRD270.                                                07400000
074100                                                                  07410007
074200*--------------------------------------------------------------*  07420007
074300* COMMUNICATIONS AREA2 FOR DB2                                 *  07430007
074400*--------------------------------------------------------------*  07440007
074500     COPY SQLCA2.                                                 07450000
074600                                                                  07460000
074700     EXEC SQL                                                     07470000
074800          INCLUDE SQLCA                                           07480000
074900     END-EXEC.                                                    07490000
075000                                                                  07500007
075100*--------------------------------------------------------------*  07510007
075200* PO/STORES TABLE                                              *  07520007
075300*--------------------------------------------------------------*  07530007
075400     EXEC SQL                                                     07540000
075500          INCLUDE TPOSTRR                                         07550000
075600     END-EXEC.                                                    07560000
075700                                                                  07570007
075800*--------------------------------------------------------------*  07580007
075900* AP CONTROL TABLE                                             *  07590007
076000*--------------------------------------------------------------*  07600007
076100     EXEC SQL                                                     07610000
076200          INCLUDE TAPCNTL                                         07620000
076300     END-EXEC.                                                    07630000
076400                                                                  07640007
076500*--------------------------------------------------------------*  07650007
076600* DB2 DCLGEN FOR VENDOR AGREEMENT TABLE                        *  07660007
076700*--------------------------------------------------------------*  07670007
076800     EXEC SQL                                                     07680000
076900          INCLUDE TVNDAGR                                         07690000
077000     END-EXEC.                                                    07700000
077100                                                                  07710007
077200*--------------------------------------------------------------*  07720007
077300* PURCHASE TABLE                                               *  07730007
077400*--------------------------------------------------------------*  07740007
077500     EXEC SQL                                                     07750000
077600          INCLUDE TPURCHS                                         07760000
077700     END-EXEC.                                                    07770000
077800                                                                  07780007
077900*--------------------------------------------------------------*  07790007
078000* PURCHASE ORDER AGREEMENT TABLE                               *  07800007
078100*--------------------------------------------------------------*  07810007
078200     EXEC SQL                                                     07820000
078300          INCLUDE TPOAGMT                                         07830000
078400     END-EXEC.                                                    07840000
078500                                                                  07850007
078600*--------------------------------------------------------------*  07860007
078700* PAYMENT TERMS TABLE                                          *  07870007
078800*--------------------------------------------------------------*  07880007
078900     EXEC SQL                                                     07890000
079000          INCLUDE TPAYTRM                                         07900000
079100     END-EXEC.                                                    07910000
079200                                                                  07920007
079300*--------------------------------------------------------------*  07930007
079400* INVOICE PAYMENT TERMS TABLE                                  *  07940007
079500*--------------------------------------------------------------*  07950007
079600     EXEC SQL                                                     07960000
079700          INCLUDE TINVCTM                                         07970000
079800     END-EXEC.                                                    07980000
079900                                                                  07990007
080000*--------------------------------------------------------------*  08000007
080100* INVOICE TABLE                                                *  08010007
080200*--------------------------------------------------------------*  08020007
080300     EXEC SQL                                                     08030000
080400          INCLUDE TINVOIC                                         08040000
080500     END-EXEC.                                                    08050000
080600                                                                  08060007
080700*--------------------------------------------------------------*  08070007
080800* MERCHANDISE INVOICE TABLE                                    *  08080007
080900*--------------------------------------------------------------*  08090007
081000     EXEC SQL                                                     08100000
081100          INCLUDE TMDINVC                                         08110000
081200     END-EXEC.                                                    08120000
081300                                                                  08130007
081400*--------------------------------------------------------------*  08140007
081500* ALLOWANCE/CHARGE TABLE                                       *  08150007
081600*--------------------------------------------------------------*  08160007
081700     EXEC SQL                                                     08170000
081800          INCLUDE TALCHRG                                         08180000
081900     END-EXEC.                                                    08190000
082000                                                                  08200007
082100*--------------------------------------------------------------*  08210007
082200* PAYMENT REQUEST ITEM TABLE                                   *  08220007
082300*--------------------------------------------------------------*  08230007
082400     EXEC SQL                                                     08240000
082500          INCLUDE TPREQIT                                         08250000
082600     END-EXEC.                                                    08260000
082700                                                                  08270007
082800*--------------------------------------------------------------*  08280007
082900* MERCHANDISE ITEM TABLE                                       *  08290007
083000*--------------------------------------------------------------*  08300007
083100     EXEC SQL                                                     08310000
083200          INCLUDE TMIITEM                                         08320000
083300     END-EXEC.                                                    08330000
083400                                                                  08340007
083500*--------------------------------------------------------------*  08350007
083600* RECEIVER TABLE                                               *  08360007
083700*--------------------------------------------------------------*  08370007
083800     EXEC SQL                                                     08380000
083900          INCLUDE TRECEIV                                         08390000
084000     END-EXEC.                                                    08400000
084100                                                                  08410007
084200*--------------------------------------------------------------*  08420007
084300* RECEIPT ITEM TABLE                                           *  08430007
084400*--------------------------------------------------------------*  08440007
084500     EXEC SQL                                                     08450000
084600          INCLUDE TRECITM                                         08460000
084700     END-EXEC.                                                    08470000
084800                                                                  08480007
084900*--------------------------------------------------------------*  08490007
085000* RECEIPT DISTRIBUTION TABLE                                   *  08500007
085100*--------------------------------------------------------------*  08510007
085200     EXEC SQL                                                     08520000
085300          INCLUDE TRECDIS                                         08530000
085400     END-EXEC.                                                    08540000
085500                                                                  08550007
085600*--------------------------------------------------------------*  08560007
085700* PURCHASE ORDER ITEMS TABLE                                   *  08570007
085800*--------------------------------------------------------------*  08580007
085900     EXEC SQL                                                     08590000
086000          INCLUDE TPURITM                                         08600000
086100     END-EXEC.                                                    08610000
086200                                                                  08620007
086300*--------------------------------------------------------------*  08630007
086400* NON-INVOICED RECEIPT TABLE                                   *  08640007
086500*--------------------------------------------------------------*  08650007
086600     EXEC SQL                                                     08660000
086700          INCLUDE TNINREC                                         08670000
086800     END-EXEC.                                                    08680000
086900                                                                  08690007
087000*--------------------------------------------------------------*  08700007
087100* PRICE CLAIM ADJUSTMENTS TABLE                                *  08710007
087200*--------------------------------------------------------------*  08720007
087300     EXEC SQL                                                     08730000
087400          INCLUDE TPRCCLM                                         08740000
087500     END-EXEC.                                                    08750000
087600                                                                  08760007
087700*--------------------------------------------------------------*  08770007
087800* EXTERNAL ENTERPRISE TABLE                                    *  08780007
087900*--------------------------------------------------------------*  08790007
088000     EXEC SQL                                                     08800000
088100          INCLUDE TEXTENT                                         08810000
088200     END-EXEC.                                                    08820000
088300                                                                  08830007
088400*--------------------------------------------------------------*  08840007
088500* EXTERNAL ENTERPRISE NAME TABLE                               *  08850007
088600*--------------------------------------------------------------*  08860007
088700     EXEC SQL                                                     08870000
088800          INCLUDE TENTNME                                         08880000
088900     END-EXEC.                                                    08890000
089000                                                                  08900007
089100*--------------------------------------------------------------*  08910007
089200* POS REQUIRING MANUAL RECONCILIATION REPORT TABLE             *  08920007
089300*--------------------------------------------------------------*  08930007
089400     EXEC SQL                                                     08940000
089500          INCLUDE TOUTAP5                                         08950000
089600     END-EXEC.                                                    08960000
089700                                                                  08970007
089701*--------------------------------------------------------------*  08970199
089702* VENDOR CAPABILITY TABLE - VNT_VND_CPBL                       *  08970299
089703*--------------------------------------------------------------*  08970399
089704     EXEC SQL                                                     08970499
089705          INCLUDE VNT00001                                        08970599
089706     END-EXEC.                                                    08970699
089707                                                                  08970799
089708*--------------------------------------------------------------*  08970899
089709* MERCHANDISE AREA TABLE                                       *  08970999
089710*--------------------------------------------------------------*  08971099
089711     EXEC SQL                                                     08971199
089712          INCLUDE TMDSEAR                                         08971299
089713     END-EXEC.                                                    08971399
089714                                                                  08971499
089715*--------------------------------------------------------------*  08971599
089720* COPYBOOK FOR SEPHORA LOGIC                                   *  08972099
089730*--------------------------------------------------------------*  08973099
089740     COPY APWS021.                                                08974099
089750                                                                  08975099
089800*--------------------------------------------------------------*  08980007
089900* EXCL_VENDOR_CSR RETRIEVES VENDORS FROM TVNDAGR WHICH ARE     *  08990007
090000* CURRENTLY SET UP AS REQUIRING MANUAL RECONCILIATION.         *  09000007
090100*--------------------------------------------------------------*  09010007
090200     EXEC SQL                                                     09020000
090300       DECLARE EXCL_VENDOR_CSR CURSOR FOR                         09030000
090400         SELECT                                                   09040000
090500             ENT_ID                                               09050000
090600            ,DEPT_NBR                                             09060000
090700          FROM TVNDAGR                                            09070000
090800          WHERE AGRMT_TYP_ID = '6'                                09080000
090900          AND   TYP_CDE      = 4                                  09090000
091000          AND   EFFECTIVE_DATE  <= :APCNTL-BTCH-PRC-DTE           09100000
091100          AND   EXPIRATION_DATE >  :APCNTL-BTCH-PRC-DTE           09110000
091200     END-EXEC.                                                    09120000
091300                                                                  09130000
091400*--------------------------------------------------------------*  09140007
091500* POSTRR_CSR GETS ALL THE POS THAT ARE SET UP FOR THE AUTOMATIC*  09150007
091600* RECONCILIATION PROCESS.                                      *  09160007
091700* (NOTE: THE 'WITH HOLD' CLAUSE ALLOWS THE CURSOR TO REMAIN    *  09170007
091800*  OPEN WHEN THE COMMIT IS PERFORMED.)                         *  09180007
091900*--------------------------------------------------------------*  09190007
092000     EXEC SQL                                                     09200007
092100       DECLARE POSTRR_CSR CURSOR WITH HOLD FOR                    09210007
092200         SELECT                                                   09220000
092300             PO_NBR                                               09230000
092400            ,STR_NBR                                              09240000
092500            ,MTCH_LVL_CDE                                         09250000
092600          FROM TPOSTRR                                            09260000
092700          WHERE STATUS_CDE  = 'A'                                 09270000
092800          AND   CRE_PRC_CDE = 'A'                                 09280000
092900          ORDER BY PO_NBR, STR_NBR                                09290000
093000     END-EXEC.                                                    09300000
093100                                                                  09310007
093200*--------------------------------------------------------------*  09320007
093300* RETRIEVE THE HEADER LEVEL INVOICES FOR THE PURCHASE ORDER    *  09330007
093400*--------------------------------------------------------------*  09340007
093500     EXEC SQL                                                     09350000
093600          DECLARE TINVOIC_CSR CURSOR FOR                          09360000
093700             SELECT    PAYT_REQ_SEQ_NBR                           09370000
093800                      ,INVC_ID                                    09380000
093900                      ,STR_NBR                                    09390000
094000                      ,INVC_TYP_CDE                               09400000
094100                      ,STATUS_CDE                                 09410000
094200                      ,HOLD_IND                                   09420000
094300                      ,GRO_COST_AMT                               09430000
094400                      ,INVC_DTE                                   09440000
094500                      ,ENTR_MTHD_CDE                              09450000
094600                      ,STATUS_CHG_TMST                            09460000
094700                      ,CALC_DUE_DTE                               09470000
094800                      ,DUE_DTE_SRC_CDE                            09480000
094900                      ,CRE_DTE                                    09490000
095000                      ,DC_NBR                                     09500000
095100                      ,MTCH_LVL_CDE                               09510000
095200             FROM      TINVOIC                                    09520000
095300             WHERE     PO_NBR        = :DK-PO-NBR                 09530000
095400             AND       STATUS_CDE    = 'RC'                       09540000
095500             AND       INVC_TYP_CDE  IN ('MI','RI')               09550000
095600             AND       MTCH_LVL_CDE  = :DK-MTCH-LVL-CDE           09560002
095700             AND       STR_NBR BETWEEN :DK-STR-NBR-LOW            09570026
095800                                   AND :DK-STR-NBR-HIGH           09580026
095900             AND       DC_NBR BETWEEN  :DK-DC-NBR-LOW             09590026
096000                                  AND  :DK-DC-NBR-HIGH            09600026
096100          ORDER BY INVC_ID                                        09610000
096200     END-EXEC.                                                    09620000
096300                                                                  09630007
096400*--------------------------------------------------------------*  09640007
096500* OPEN A CURSOR TO RETRIEVE THE RECEIVER ITEMS FOR THE POS     *  09650007
096600* THAT HAVE BEEN VERIFIED AND NOT PREVIOUSLY MATCHED.          *  09660007
096700*--------------------------------------------------------------*  09670007
096800     EXEC SQL                                                     09680007
096900       DECLARE TRECDIS_CSR CURSOR FOR                             09690007
097000             SELECT R.ORD_NBR                                     09700000
097100                   ,R.REC_SEQ_NBR                                 09710000
097200                   ,R.CRE_TMST                                    09720000
097300                   ,D.ORD_LNE_NBR                                 09730000
097400                   ,D.OPER_UNT_ID                                 09740000
097500                   ,D.FCLTY_ID                                    09750000
097600                   ,D.STR_NBR                                     09760000
097700                   ,D.STR_FCLTY_ID                                09770000
097800                   ,D.CRE_TMST                                    09780000
097900                   ,D.AP_VERIFY_ITM_QTY                           09790000
098010                   ,P.PRD_1ST_COST_AMT                            09801085
098100             FROM   TRECEIV R                                     09810000
098200                   ,TRECITM I                                     09820000
098300                   ,TRECDIS D                                     09830000
098400                   ,TPURITM P                                     09840000
098500             WHERE  R.ORD_NBR         = :DK-PO-NBR                09850000
098600             AND    R.STATUS_CDE      = 'VE'                      09860000
098700             AND    R.AP_PRC_CDE      = ' '                       09870000
098800             AND    R.FS_POST_TMST NOT IN                         09880000
098900                                 ('9999-09-09-09.09.09.999999')   09890000
099000             AND    R.ORD_NBR         = I.ORD_NBR                 09900000
099100             AND    R.ORD_NBR         = D.ORD_NBR                 09910000
099200             AND    R.ORD_NBR         = P.PO_NBR                  09920000
099300             AND    R.VER_STATUS_CDE  = 'A'                       09930000
099400             AND    I.VER_STATUS_CDE  = 'A'                       09940000
099500             AND    D.VER_STATUS_CDE  = 'A'                       09950000
099600             AND    D.AP_PRC_CDE      = ' '                       09960000
099700             AND    R.REC_SEQ_NBR     = I.REC_SEQ_NBR             09970000
099800             AND    R.REC_SEQ_NBR     = D.REC_SEQ_NBR             09980000
099900             AND    D.STR_NBR   BETWEEN :DK-STR-NBR-LOW           09990000
100000                                    AND :DK-STR-NBR-HIGH          10000000
100100             AND    I.OPER_UNT_ID     = D.OPER_UNT_ID             10010000
100200             AND    I.FCLTY_ID        = D.FCLTY_ID                10020000
100300             AND    I.ORD_LNE_NBR     = D.ORD_LNE_NBR             10030000
100400             AND    I.ORD_LNE_NBR     = P.APP_PO_LNE_NBR          10040000
100500             AND    I.PO_VER_NBR      = P.VER_NBR                 10050000
100600     END-EXEC.                                                    10060000
100700                                                                  10070007
100800*---------------------------------------------------------------* 10080003
100900* OPEN A CURSOR TO RETRIEVE THE RECEIVER ITEMS FOR THE POS THAT * 10090007
101000* HAVE BEEN VERIFIED AND NOT PREVIOUSLY MATCHED.                * 10100007
101100*---------------------------------------------------------------* 10110003
101200     EXEC SQL                                                     10120003
101300          DECLARE TRECEIV_CSR CURSOR FOR                          10130003
101400             SELECT R.ORD_NBR                                     10140003
101500                   ,R.REC_SEQ_NBR                                 10150003
101600                   ,R.CRE_TMST                                    10160003
101700                   ,D.ORD_LNE_NBR                                 10170003
101800                   ,D.OPER_UNT_ID                                 10180003
101900                   ,D.FCLTY_ID                                    10190003
102000                   ,D.STR_NBR                                     10200003
102100                   ,D.STR_FCLTY_ID                                10210003
102200                   ,D.CRE_TMST                                    10220003
102300                   ,D.AP_VERIFY_ITM_QTY                           10230003
102410                   ,P.PRD_1ST_COST_AMT                            10241085
102500             FROM   TRECEIV R                                     10250003
102600                   ,TRECITM I                                     10260003
102700                   ,TRECDIS D                                     10270003
102800                   ,TPURITM P                                     10280003
102900             WHERE  R.ORD_NBR           = :DK-PO-NBR              10290035
103000             AND    R.STATUS_CDE        = 'VE'                    10300035
103100             AND    R.AP_PRC_CDE        = ' '                     10310035
103200             AND    R.FS_POST_TMST NOT IN                         10320003
103300                                 ('9999-09-09-09.09.09.999999')   10330003
103400             AND    R.ORD_NBR           = I.ORD_NBR               10340035
103500             AND    R.ORD_NBR           = D.ORD_NBR               10350035
103600             AND    R.ORD_NBR           = P.PO_NBR                10360035
103700             AND    R.VER_STATUS_CDE    = 'A'                     10370035
103800             AND    I.VER_STATUS_CDE    = 'A'                     10380035
103900             AND    D.VER_STATUS_CDE    = 'A'                     10390035
104000             AND    D.AP_PRC_CDE        = ' '                     10400035
104100             AND    R.REC_SEQ_NBR       = I.REC_SEQ_NBR           10410035
104200             AND    R.REC_SEQ_NBR       = D.REC_SEQ_NBR           10420035
104300             AND    I.OPER_UNT_ID BETWEEN :DK-DC-NBR-LOW          10430035
104400                                      AND :DK-DC-NBR-HIGH         10440035
104500             AND    I.OPER_UNT_ID       = D.OPER_UNT_ID           10450035
104600             AND    I.FCLTY_ID          = D.FCLTY_ID              10460035
104700             AND    I.ORD_LNE_NBR       = D.ORD_LNE_NBR           10470035
104800             AND    I.ORD_LNE_NBR       = P.APP_PO_LNE_NBR        10480035
104900             AND    I.PO_VER_NBR        = P.VER_NBR               10490035
105000     END-EXEC.                                                    10500003
105100                                                                  10510007
105200*--------------------------------------------------------------*  10520007
105300* OPEN A CURSOR TO RETRIEVE THE NON-INVOICED RECEIPTS FOR THE  *  10530007
105400* POS THAT HAVE NOT BEEN PREVIOUSLY MATCHED.                   *  10540007
105500*--------------------------------------------------------------*  10550007
105600     EXEC SQL                                                     10560000
105700          DECLARE TNINREC_CSR CURSOR FOR                          10570000
105800             SELECT PO_LNE_NBR                                    10580000
105900                   ,NON_INVC_SEQ_NBR                              10590000
106000                   ,NON_INVC_UNT_QTY                              10600000
106100                   ,UNT_COST_AMT                                  10610000
106200             FROM   TNINREC                                       10620000
106300             WHERE  PO_NBR          = :DK-PO-NBR                  10630000
106400             AND    STR_NBR      BETWEEN :DK-STR-NBR-LOW          10640006
106500                                     AND :DK-STR-NBR-HIGH         10650006
106600             AND    STATUS_CDE      = ' '                         10660000
106700     END-EXEC.                                                    10670000
106800                                                                  10680006
106900*--------------------------------------------------------------*  10690007
107000* OPEN A CURSOR TO RETRIEVE THE NON-INVOICED RECEIPTS FOR THE  *  10700007
107100* POS THAT HAVE NOT BEEN PREVIOUSLY MATCHED.                   *  10710007
107200*--------------------------------------------------------------*  10720007
107300     EXEC SQL                                                     10730006
107400          DECLARE TNINREC_DC_CSR CURSOR FOR                       10740006
107500             SELECT PO_LNE_NBR                                    10750006
107600                   ,NON_INVC_SEQ_NBR                              10760006
107700                   ,NON_INVC_UNT_QTY                              10770006
107800                   ,UNT_COST_AMT                                  10780006
107900             FROM   TNINREC                                       10790006
108000             WHERE  PO_NBR       = :DK-PO-NBR                     10800035
108100             AND    DC_NBR BETWEEN :DK-DC-NBR-LOW                 10810035
108200                               AND :DK-DC-NBR-HIGH                10820035
108300             AND    STATUS_CDE   = ' '                            10830035
108400     END-EXEC.                                                    10840006
108500                                                                  10850007
108600*--------------------------------------------------------------*  10860007
108700* OPEN A CURSOR TO RETRIEVE ALL THE INVOICE ITEMS FOR THE      *  10870007
108800* INVOICES FOR THE PO/STORE.  THE FIRST SELECT RETRIEVES ALL   *  10880007
108900* INVOICE ITEMS FOR THE PO/STR THAT ARE LINKED TO A PO LINE.   *  10890007
109000* THE SECOND SELECT RETRIEVES ALL INVOICE ITEMS FOR THE        *  10900007
109100* PO/STR THAT ARE NOT LINKED TO A PO LINE.                     *  10910007
109200*--------------------------------------------------------------*  10920007
109300     EXEC SQL                                                     10930000
109400          DECLARE TPREQIT_CSR CURSOR FOR                          10940000
109500             SELECT '1'                                           10950000
109600                   ,P.APP_PO_LNE_NBR                              10960000
109700                   ,P.PO_LNE_NBR                                  10970000
109800                   ,Q.PAY_REQ_LNE_QTY                             10980000
109900                   ,Q.UNT_COST_AMT                                10990000
110000                   ,Q.PAYT_REQ_SEQ_NBR                            11000000
110100             FROM   TPREQIT Q                                     11010000
110200                   ,TMIITEM M                                     11020000
110300                   ,TPURITM P                                     11030000
110400             WHERE  Q.PAYT_REQ_SEQ_NBR  = :DK-PAYT-REQ-SEQ-NBR    11040000
110500             AND    Q.PAYT_REQ_SEQ_NBR  = M.PAYT_REQ_SEQ_NBR      11050000
110600             AND    Q.PAYT_REQ_LNE_NBR  = M.PAYT_REQ_LNE_NBR      11060000
110700             AND    P.PO_NBR            = :DK-PO-NBR              11070000
110800             AND    P.VER_STATUS_CDE    = 'A'                     11080000
110900             AND    M.PO_LNE_NBR        = P.PO_LNE_NBR            11090000
111000             AND    M.PO_LNE_NBR        IS NOT NULL               11100000
111100                                                                  11110000
111200             UNION ALL                                            11120000
111300                                                                  11130000
111400             SELECT '2'                                           11140000
111500                   ,0                                             11150000
111600                   ,0                                             11160000
111700                   ,Q.PAY_REQ_LNE_QTY                             11170000
111800                   ,Q.UNT_COST_AMT                                11180000
111900                   ,Q.PAYT_REQ_SEQ_NBR                            11190000
112000             FROM   TPREQIT Q                                     11200000
112100                   ,TMIITEM M                                     11210000
112200             WHERE  Q.PAYT_REQ_SEQ_NBR  = :DK-PAYT-REQ-SEQ-NBR    11220000
112300             AND    Q.PAYT_REQ_SEQ_NBR  = M.PAYT_REQ_SEQ_NBR      11230000
112400             AND    Q.PAYT_REQ_LNE_NBR  = M.PAYT_REQ_LNE_NBR      11240000
112500             AND    M.PO_NBR            = :DK-PO-NBR              11250000
112600             AND    M.PO_LNE_NBR        IS NULL                   11260000
112700                                                                  11270000
112800            ORDER BY 1, 3, 6                                      11280000
112900     END-EXEC.                                                    11290000
113000                                                                  11300007
113100*--     ATTENTION    ATTENTION   ATTENTION!!!!!!!                 11310000
113200*--   THE ORDER BY CLAUSE ON PREQIT_NULL_PO_CSR IS NOT REALLY     11320000
113300*--   NEEDED; BUT IS **REQUIRED** TO FORCE DB2 TO CREATE THE      11330000
113400*--   RESULT TABLE WHEN OPENNING THE CURSOR INSTEAD OF            11340000
113500*--   DYNAMICALLY DETERMINING THE NEXT ROW AT FETCH TIME.         11350000
113600*--   IF THE ORDER BY IS REMOVED THE PROGRAM COULD GO INTO A      11360000
113700*--   LOOP BY INSERTING A REMAINDER INVOICE ITEM, THEN FETCHING   11370000
113800*--   THE ROW IT JUST INSERTED AND THINKING IT SHOULD BE USED TO  11380000
113900*--   INSERT ANOTHER ROW.                                         11390000
114000     EXEC SQL                                                     11400000
114100          DECLARE PREQIT_NULL_PO_CSR CURSOR FOR                   11410000
114200             SELECT Q.PAYT_REQ_SEQ_NBR                            11420000
114300                   ,Q.PAYT_REQ_LNE_NBR                            11430000
114400                   ,PAY_REQ_LNE_QTY                               11440000
114500                   ,UNT_COST_AMT                                  11450000
114600             FROM   TINVOIC I                                     11460000
114700                   ,TPREQIT Q                                     11470000
114800                   ,TMIITEM M                                     11480000
114900             WHERE  I.PAYT_REQ_SEQ_NBR  = Q.PAYT_REQ_SEQ_NBR      11490000
115000             AND    I.PAYT_REQ_SEQ_NBR  = M.PAYT_REQ_SEQ_NBR      11500000
115100             AND    Q.PAYT_REQ_SEQ_NBR  = M.PAYT_REQ_SEQ_NBR      11510000
115200             AND    Q.PAYT_REQ_LNE_NBR  = M.PAYT_REQ_LNE_NBR      11520000
115300             AND    I.PO_NBR            = :DK-PO-NBR              11530000
115400             AND    I.STATUS_CDE        IN ('EN','RC','OB','IB')  11540000
115500             AND    I.INVC_TYP_CDE      IN ('MI','RI')            11550000
115600             AND    I.MTCH_LVL_CDE      = :DK-MTCH-LVL-CDE        11560000
115610             AND    I.STR_NBR     BETWEEN :DK-STR-NBR-LOW         11561081
115620                                      AND :DK-STR-NBR-HIGH        11562081
115630             AND    I.DC_NBR      BETWEEN :DK-DC-NBR-LOW          11563081
115640                                     AND  :DK-DC-NBR-HIGH         11564081
115700             AND    M.PO_LNE_NBR        IS NULL                   11570000
115800             ORDER BY 3                                           11580000
115900     END-EXEC.                                                    11590000
116000                                                                  11600007
116010     EXEC SQL                                                     11601090
116020          DECLARE INVC_ITEM_CSR CURSOR FOR                        11602090
116030             SELECT SUM(PAY_REQ_LNE_QTY)                          11603090
116040                   ,UNT_COST_AMT                                  11604090
116050             FROM   TINVOIC B                                     11605090
116060                   ,TPREQIT C                                     11606090
116070                   ,TMIITEM D                                     11607090
116080             WHERE  B.PAYT_REQ_SEQ_NBR   = C.PAYT_REQ_SEQ_NBR     11608090
116090             AND    B.PAYT_REQ_SEQ_NBR   = D.PAYT_REQ_SEQ_NBR     11609090
116091             AND    C.PAYT_REQ_SEQ_NBR   = D.PAYT_REQ_SEQ_NBR     11609190
116092             AND    C.PAYT_REQ_LNE_NBR   = D.PAYT_REQ_LNE_NBR     11609290
116093             AND    B.PO_NBR             = :DK-PO-NBR             11609390
116094             AND    B.STATUS_CDE        IN ('EN','RC','OB','IB')  11609490
116095             AND    B.INVC_TYP_CDE      IN ('MI','RI')            11609590
116096             AND    B.STR_NBR      BETWEEN :DK-STR-NBR-LOW        11609690
116097                                       AND :DK-STR-NBR-HIGH       11609790
116098             AND    B.DC_NBR       BETWEEN :DK-DC-NBR-LOW         11609890
116099                                       AND :DK-DC-NBR-HIGH        11609990
116100             AND    B.MTCH_LVL_CDE       = :DK-MTCH-LVL-CDE       11610090
116101             AND    D.PO_LNE_NBR         = :PV-PO-LNE-NBR         11610190
116102             GROUP BY UNT_COST_AMT                                11610290
116103             ORDER BY UNT_COST_AMT                                11610390
116104     END-EXEC.                                                    11610490
116105/                                                                 11610590
116110*--------------------------------------------------------------*  11611007
116200* DISCOUNT_CSR RETRIEVES ALLOWANCES ASSOCIATED WITH AN INVOICE *  11620007
116300*--------------------------------------------------------------*  11630007
116400     EXEC SQL                                                     11640000
116500       DECLARE DISCOUNT_CSR CURSOR FOR                            11650000
116600         SELECT                                                   11660000
116700              ALW_CHRG_TYP_CDE                                    11670000
116800             ,ALW_CHRG_CDE                                        11680000
116900             ,ALW_CHRG_PCT                                        11690000
117000             ,ALW_CHRG_AMT                                        11700000
117100         FROM                                                     11710000
117200             TALCHRG                                              11720000
117300         WHERE PO_NBR           = :DK-PO-NBR                      11730000
117400           AND INVC_ID          = :ALCHRG-INVC-ID                 11740000
117500           AND ALW_CHRG_TYP_CDE = 'A'                             11750000
117600*          AND ALW_CHRG_CDE NOT IN ('ADV')                        11760000
117700     END-EXEC.                                                    11770000
117800                                                                  11780007
117900*--------------------------------------------------------------*  11790007
118000* ADVERT_CSR RETRIEVES ADVERTISING ALLOWANCES ASSOCIATED WITH  *  11800007
118100* AN INVOICE.                                                  *  11810007
118200*--------------------------------------------------------------*  11820007
118300*    EXEC SQL *      DECLARE ADVERT_CSR CURSOR FOR                11830007
118400*        SELECT                                                   11840000
118500*             ALW_CHRG_TYP_CDE                                    11850000
118600*            ,ALW_CHRG_CDE                                        11860000
118700*            ,ALW_CHRG_PCT                                        11870000
118800*            ,ALW_CHRG_AMT                                        11880000
118900*        FROM                                                     11890000
119000*            TALCHRG                                              11900000
119100*        WHERE PO_NBR           = :DK-PO-NBR                      11910000
119200*          AND INVC_ID          = :ALCHRG-INVC-ID                 11920000
119300*          AND ALW_CHRG_TYP_CDE = 'A'                             11930000
119400*          AND ALW_CHRG_CDE     = 'ADV'                           11940000
119500*    END-EXEC.                                                    11950000
119600*EJECT                                                            11960000
119700                                                                  11970007
119800*--------------------------------------------------------------*  11980007
119900* ABEND DATA AREAS                                             *  11990007
120000*--------------------------------------------------------------*  12000007
120100 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          12010000
120200                                             COMP SYNC.           12020000
120300     88  AC-TABLE-OVERFLOW                   VALUE +4004.         12030000
120400     88  AC-MISSING-INVOICE-REC              VALUE +4008.         12040000
120500     88  AC-DB2-ERROR                        VALUE +4013.         12050000
120600                                                                  12060000
120700                                                                  12070000
120800 01  ABEND-AREAS.                                                 12080000
120900     05  AA-ABEND-LIT            PIC  X(40)  VALUE                12090000
121000             '*****       ABEND'.                                 12100000
121100     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                12110000
121200             '*****   PROGRAM: APKUP230'.                         12120000
121300     05  AA-PARAGRAPH-LIT.                                        12130000
121400         10  FILLER              PIC  X(17)  VALUE                12140000
121500             '***** PARAGRAPH: '.                                 12150000
121600         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        12160000
121700     05  AA-MESSAGE-LINE.                                         12170000
121800         10  FILLER              PIC  X(06)  VALUE '*****'.       12180000
121900         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        12190000
122000     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                12200000
122100             '*****    DB2 ERROR'.                                12210000
122200     05  AA-DB2-OPERATION-LIT.                                    12220000
122300         10  FILLER              PIC  X(17)  VALUE                12230000
122400             '***** OPERATION: '.                                 12240000
122500         10  AA-DB2-OPERATION.                                    12250000
122600             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        12260000
122700             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        12270000
122800     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        12280000
122900     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        12290000
123000     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        12300000
123100     05  AA-DB2-TABLE-4          PIC  X(08)  VALUE SPACES.        12310000
123200     05  AA-DB2-TABLE-5          PIC  X(08)  VALUE SPACES.        12320000
123300     05  AA-PO-NBR               PIC  X(09)  VALUE SPACES.        12330000
123400     05  AA-STR-NBR              PIC  X(04)  VALUE SPACES.        12340000
123500                                                                  12350000
123600*--------------------------------------------------------------*  12360007
123700* SQLCA FORMATTED MESSAGE AREA                                 *  12370007
123800*--------------------------------------------------------------*  12380007
123900     COPY DPWS004.                                                12390000
124000                                                                  12400007
124100*--------------------------*                                      12410007
124200 PROCEDURE DIVISION.                                              12420000
124300*--------------------------*                                      12430007
124400 A100-MAIN.                                                       12440000
124500                                                                  12450000
124600     MOVE 'A100-MAIN' TO PV-CURRENT-PARAGRAPH.                    12460000
124700                                                                  12470000
124800     PERFORM B100-INITIALIZE.                                     12480000
124900     IF OUT-OF-POS                                                12490000
125000         DISPLAY 'THERE ARE NO POS TO PROCESS'                    12500000
125100     ELSE                                                         12510000
125200         PERFORM B200-PROCESS-POS                                 12520000
125300             UNTIL OUT-OF-POS                                     12530000
125400     END-IF.                                                      12540000
125500     PERFORM B300-END-PROGRAM.                                    12550000
125600     GOBACK.                                                      12560000
125700                                                                  12570007
125800*--------------------------------------------------------------*  12580007
125900* INITIALIZE WS, SET DATE AND TIME VARIABLES, LOAD THE         *  12590007
126000* EXCLUDED VENDOR TABLE, RETRIEVE THE COST CONTROL PERCENT,    *  12600007
126100* AND READ THE FIRST PO/STORE TO BE PROCESSED.                 *  12610007
126200*--------------------------------------------------------------*  12620007
126300 B100-INITIALIZE.                                                 12630000
126400                                                                  12640000
126500     INITIALIZE DCLTPOSTRR                                        12650000
126600                DCLTAPCNTL                                        12660000
126700                DCLTVNDAGR                                        12670000
126800                DCLTPURCHS                                        12680000
126900                DCLTPOAGMT                                        12690000
127000                DCLTPAYTRM                                        12700000
127100                DCLTINVCTM                                        12710000
127200                DCLTINVOIC                                        12720000
127300                DCLTMDINVC                                        12730000
127400                DCLTALCHRG                                        12740000
127500                DCLTPREQIT                                        12750000
127600                DCLTMIITEM                                        12760000
127700                DCLTRECEIV                                        12770000
127800                DCLTRECITM                                        12780000
127900                DCLTRECDIS                                        12790000
128000                DCLTPURITM                                        12800000
128100                DCLTNINREC                                        12810000
128200                DCLTPRCCLM                                        12820000
128300                DCLTEXTENT                                        12830000
128400                DCLTENTNME                                        12840000
128410                DCLTMDSEAR                                        12841099
128510                EXCL-VENDOR-TABLE                                 12851099
128600                PO-LINE-TABLE                                     12860000
128700                PC-BLANK-PO-LINE-TABLE-ENTRY                      12870000
128800                IA-INVOICE-ARRAY                                  12880000
128900                TRECEIV-TABLE                                     12890000
129000                TRECDIS-TABLE                                     12900000
129100                TNINREC-TABLE                                     12910000
129200                TPRCCLM-TABLE.                                    12920000
129300                                                                  12930000
129400     PERFORM R110-SELECT-CNTL-DATA.                               12940000
129500                                                                  12950000
129510*    GET SEPHORA DATA                                             12951099
129520     MOVE PV-PROGRAM-NAME      TO SA-PROGRAM-NAME.                12952099
129530     PERFORM S100-GET-SEPHORA-DEPT.                               12953099
129540                                                                  12954099
129600     SET EV-IDX TO +1.                                            12960000
129700     PERFORM Y100-OPEN-EXCL-VENDOR-CSR.                           12970000
129800     PERFORM R100-FETCH-EXCL-VENDORS                              12980000
129900         UNTIL OUT-OF-VENDORS.                                    12990000
130000     PERFORM Y110-CLOSE-EXCL-VENDOR-CSR.                          13000000
130100                                                                  13010000
130200     PERFORM Y200-OPEN-POSTRR-CSR.                                13020000
130300     PERFORM R200-FETCH-POSTRR.                                   13030000
130400                                                                  13040007
130500*--------------------------------------------------------------*  13050007
130600* CONTROLS THE PROCESSING OF EACH PO/STORE SET UP AS 'A'       *  13060007
130700* (AUTOMATIC RECONCILIATION) ON TPOSTRR.                       *  13070007
130800*--------------------------------------------------------------*  13080007
130900 B200-PROCESS-POS.                                                13090000
131000                                                                  13100000
131100     MOVE POSTRR-PO-NBR        TO DK-PO-NBR.                      13110000
131200     MOVE POSTRR-MTCH-LVL-CDE  TO DK-MTCH-LVL-CDE.                13120000
131300     IF POSTRR-MTCH-LVL-CDE = 'P'                                 13130003
131400        MOVE +0               TO DK-STR-NBR-LOW                   13140053
131500                                 DK-DC-NBR-LOW                    13150053
131600                                 PV-SAVE-DC-NBR                   13160070
131700        MOVE +9999            TO DK-STR-NBR-HIGH                  13170053
131800                                 DK-DC-NBR-HIGH                   13180053
131900        MOVE POSTRR-STR-NBR   TO DK-STR-NBR                       13190053
132000     ELSE                                                         13200003
132100        IF POSTRR-MTCH-LVL-CDE = 'S'                              13210003
132200           MOVE POSTRR-STR-NBR TO DK-STR-NBR-LOW                  13220003
132300                                  DK-STR-NBR-HIGH                 13230003
132400                                  DK-STR-NBR                      13240003
132500           MOVE +0             TO DK-DC-NBR-LOW                   13250026
132600           MOVE +9999          TO DK-DC-NBR-HIGH                  13260026
132700        ELSE                                                      13270003
132800           MOVE POSTRR-STR-NBR TO DK-DC-NBR-LOW                   13280026
132900                                  DK-DC-NBR-HIGH                  13290026
133000                                  DK-DC-NBR                       13300042
133100                                  PV-SAVE-DC-NBR                  13310070
133200           MOVE +0             TO DK-STR-NBR-LOW                  13320026
133300           MOVE +9999          TO DK-STR-NBR-HIGH                 13330026
133400        END-IF                                                    13340003
133500     END-IF.                                                      13350003
133600                                                                  13360000
133700     EXEC SQL                                                     13370000
133800         SET :CURR-TIMESTAMP       = CURRENT TIMESTAMP            13380000
133900     END-EXEC.                                                    13390000
134000     MOVE CURR-TMST-DATE TO CURR-DATE.                            13400000
134100                                                                  13410000
134200     PERFORM R210-SELECT-VENDOR.                                  13420000
134300                                                                  13430000
134400*-- SEE IF THE VENDOR/DEPARTMENT FOR THE PO/STR HAS BEEN SET UP   13440000
134500*-- AS MANUAL RECONCILIATION ONLY.                                13450000
134600     SET EV-IDX TO 1.                                             13460000
134700     SEARCH EXCL-VENDOR-ENTRIES                                   13470000
134800         VARYING EV-IDX                                           13480000
134900         AT END CONTINUE                                          13490000
135000         WHEN T-EV-ENT-ID   (EV-IDX) = 0                          13500000
135100                CONTINUE                                          13510000
135200         WHEN T-EV-ENT-ID   (EV-IDX) = PURCHS-ENT-ID              13520000
135300          AND T-EV-DEPT-NBR (EV-IDX) = PURCHS-DEPT-NBR            13530000
135400            SET BYPASS-PO                                         13540000
135500                MANUAL-VEND-DEPT TO TRUE                          13550000
135600     END-SEARCH.                                                  13560000
135700                                                                  13570000
135800     PERFORM R220-GET-VENDOR-INFO.                                13580000
135900                                                                  13590000
136000     IF PROCESS-PO                                                13600000
136100        IF DK-MTCH-LVL-CDE = 'P' OR 'S'                           13610006
136200           PERFORM Y400-OPEN-TRECDIS-CSR                          13620006
136300           PERFORM C100-LOAD-RECEIPTS                             13630006
136400           PERFORM Y410-CLOSE-TRECDIS-CSR                         13640006
136500        ELSE                                                      13650006
136600           PERFORM Y415-OPEN-TRECEIV-CSR                          13660006
136700           PERFORM C100-LOAD-RECEIPTS                             13670006
136800           PERFORM Y420-CLOSE-TRECEIV-CSR                         13680006
136900        END-IF                                                    13690006
137000     END-IF.                                                      13700000
137100                                                                  13710000
137200     IF PROCESS-PO                                                13720000
137300        IF DK-MTCH-LVL-CDE = 'P' OR 'S'                           13730006
137400           PERFORM Y500-OPEN-TNINREC-CSR                          13740006
137500           PERFORM C200-LOAD-NINREC                               13750006
137600           PERFORM Y510-CLOSE-TNINREC-CSR                         13760006
137700        ELSE                                                      13770006
137800           PERFORM Y505-OPEN-TNINREC-DC-CSR                       13780006
137900           PERFORM C200-LOAD-NINREC                               13790006
138000           PERFORM Y515-CLOSE-TNINREC-DC-CSR                      13800006
138100        END-IF                                                    13810006
138200     END-IF.                                                      13820000
138300                                                                  13830000
138400     IF PROCESS-PO                                                13840000
138500     OR (BYPASS-PO AND RETRIEVE-INVOICES)                         13850000
138600         PERFORM Y300-OPEN-TINVOIC-CSR                            13860000
138700         PERFORM C300-LOAD-INVOICES                               13870000
138800         PERFORM Y310-CLOSE-TINVOIC-CSR                           13880000
138900     END-IF.                                                      13890000
139000                                                                  13900000
139100     IF PROCESS-PO                                                13910000
139200         MOVE 1 TO IA-SUB                                         13920000
139300         PERFORM C400-LOAD-PREQIT                                 13930000
139400             UNTIL IA-SUB > IA-SUB-LIMIT                          13940000
139500                OR IA-PAYT-REQ-SEQ-NBR (IA-SUB) = +0              13950000
139600                OR BYPASS-PO                                      13960000
139700     END-IF.                                                      13970000
139800                                                                  13980000
139900     IF PROCESS-PO                                                13990000
140000        IF QTY-SHORTAGE                                           14000000
140100           IF INPUT-REMAINDER                                     14010000
140200              SET BYPASS-PO                                       14020000
140300                  REMAINDER-IN-OUT  TO TRUE                       14030000
140400           ELSE                                                   14040000
140500              PERFORM C500-CHECK-FOR-OVER-SHORT                   14050000
140600           END-IF                                                 14060000
140700        END-IF                                                    14070000
140800     END-IF.                                                      14080000
140900                                                                  14090000
141000     IF PROCESS-PO                                                14100000
141100         PERFORM C600-PAY-RELEASE                                 14110000
141200     ELSE                                                         14120000
141300         PERFORM C700-PREPARE-BYPASS-ROWS                         14130000
141400         PERFORM U960-BYPASS-POSTRR                               14140000
141500     END-IF.                                                      14150000
141600                                                                  14160000
141700     PERFORM Z100-COMMIT.                                         14170000
141800                                                                  14180000
141900     INITIALIZE PO-LINE-TABLE                                     14190000
142000                PC-BLANK-PO-LINE-TABLE-ENTRY                      14200000
142100                PV-BYPASS-REASON-CODE                             14210000
142200                PV-REMAINDER-FIELDS                               14220000
142300                PV-INVOICE-FIELDS                                 14230000
142400                PV-PRCCLM-FIELDS                                  14240000
142500                PV-DISCOUNT-FIELDS                                14250000
142600                PV-DISCOUNT-COST-FIELDS                           14260000
142700                IA-INVOICE-ARRAY                                  14270000
142800                TRECEIV-TABLE                                     14280000
142900                TRECDIS-TABLE                                     14290000
143000                TPRCCLM-TABLE                                     14300000
143100                TNINREC-TABLE.                                    14310000
143200                                                                  14320000
143300     SET PROCESS-PO                                               14330000
143400         NO-ERRORS-FOUND                                          14340000
143500         FIRSTTIME                                                14350000
143600         RI-INVC-CREATED                                          14360000
143700         NO-INPUT-REMAINDER                                       14370000
143800         QTY-NO-SHORTAGE                                          14380000
143900         QTY-NO-OVERAGE   TO TRUE.                                14390000
144000                                                                  14400000
144100     PERFORM R200-FETCH-POSTRR.                                   14410000
144200                                                                  14420007
144300*--------------------------------------------------------------*  14430007
144400* DISPLAYS COUNT OF POS AND CLOSES POSTRR CURSOR               *  14440007
144500*--------------------------------------------------------------*  14450007
144600 B300-END-PROGRAM.                                                14460000
144700                                                                  14470000
144800     DISPLAY 'POS RECONCILED = ' PV-POS-RECONCILED.               14480000
144900     DISPLAY 'POS BYPASSED   = ' PV-POS-BYPASSED.                 14490000
145000     DISPLAY 'TOTAL POS      = ' PV-PO-COUNT.                     14500000
145100                                                                  14510000
145200     PERFORM Y210-CLOSE-POSTRR-CSR.                               14520000
145300                                                                  14530007
145400*--------------------------------------------------------------*  14540007
145500* LOADS RECDIS AND RECEIV DATA INTO INTERNAL RECDIS, RECEIV,   *  14550007
145600* AND PO LINE TABLES.                                          *  14560007
145700*--------------------------------------------------------------*  14570007
145800 C100-LOAD-RECEIPTS.                                              14580000
145900                                                                  14590000
146000     SET ITEMS-LEFT-ON-DB TO TRUE.                                14600000
146100                                                                  14610000
146200     PERFORM                                                      14620000
146300         VARYING PV-READ-COUNT FROM 1 BY 1                        14630000
146400         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    14640000
146500            OR (NO-ITEMS-LEFT-ON-DB))                             14650000
146600                                                                  14660000
146700         IF DK-MTCH-LVL-CDE = 'S' OR 'P'                          14670003
146800            PERFORM R400-FETCH-TRECDIS                            14680003
146900         ELSE                                                     14690003
147000            PERFORM R450-FETCH-TRECEIV                            14700003
147100         END-IF                                                   14710003
147200                                                                  14720000
147300*   IF THERE IS A COST OF ZERO WITH A QTY OF 1 OR MORE, AUTO RECON14730000
147400*   WOULD CHOOSE ZERO AS THE LOWEST COST TO BE USED FOR CREATING  14740000
147500*   PRICE CLAIMS.  THE PO/STORE REQUIRES MANUAL INTERVENTION TO   14750000
147600*   VERIFY THAT THIS IS THE CORRECT ACTION SO IT MUST BE BYPASSED.14760000
147700         IF  ITEMS-LEFT-ON-DB                                     14770000
147800*            IF RECDIS-AP-VERIFY-ITM-QTY > 0                      14780000
147910*            AND PURITM-PRD-1ST-COST-AMT = 0                      14791084
148000*                SET BYPASS-PO                                    14800000
148100*                    RCV-ZERO-COST                                14810000
148200*                    ERRORS-FOUND                                 14820000
148300*                    NO-ITEMS-LEFT-ON-DB TO TRUE                  14830000
148400*            END-IF                                               14840000
148500                                                                  14850000
148600             IF NO-ERRORS-FOUND                                   14860000
148700                                                                  14870000
148800                 IF DK-MTCH-LVL-CDE = 'P' OR 'D'                  14880000
148900                    PERFORM D100-ADD-TO-RECEIV-TABLE              14890011
149000                 ELSE                                             14900000
149100                    PERFORM D200-ADD-TO-RECDIS-TABLE              14910011
149200                 END-IF                                           14920000
149300                                                                  14930000
149400                 IF NO-ERRORS-FOUND                               14940000
149500                     PERFORM D210-ADD-RD-TO-PO-LNE-TABLE          14950000
149600                 END-IF                                           14960000
149700             END-IF                                               14970000
149800         END-IF                                                   14980000
149900     END-PERFORM.                                                 14990000
150000                                                                  15000007
150100*--------------------------------------------------------------*  15010007
150200* LOADS NINREC INTO INTERNAL NINREC AND PO LINE TABLES.        *  15020007
150300*--------------------------------------------------------------*  15030007
150400 C200-LOAD-NINREC.                                                15040000
150500                                                                  15050000
150600     SET ITEMS-LEFT-ON-DB TO TRUE.                                15060000
150700                                                                  15070000
150800     PERFORM                                                      15080000
150900         VARYING PV-READ-COUNT FROM 1 BY 1                        15090000
151000         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    15100000
151100            OR (NO-ITEMS-LEFT-ON-DB))                             15110000
151200                                                                  15120000
151300         IF DK-MTCH-LVL-CDE = 'P' OR 'S'                          15130006
151400            PERFORM R500-FETCH-TNINREC                            15140006
151500         ELSE                                                     15150006
151600            PERFORM R550-FETCH-TNINREC-DC                         15160006
151700         END-IF                                                   15170006
151800                                                                  15180000
151900*-- LOWEST COST WOULD BE ZERO AND WOULD BE USED BY AUTO RECON FOR 15190000
152000*-- PRICE CLAIM CREATION, SO THE PO REQUIRES MANUAL INTERVENTION. 15200000
152100         IF  ITEMS-LEFT-ON-DB                                     15210000
152200*            IF NINREC-NON-INVC-UNT-QTY > 0                       15220000
152300*            AND NINREC-UNT-COST-AMT = 0                          15230000
152400*                SET BYPASS-PO                                    15240000
152500*                    RCV-ZERO-COST                                15250000
152600*                    ERRORS-FOUND                                 15260000
152700*                    NO-ITEMS-LEFT-ON-DB TO TRUE                  15270000
152800*                                                                 15280000
152900*            ELSE                                                 15290000
153000                 PERFORM D300-ADD-TO-NINREC-TABLE                 15300000
153100                 IF NO-ERRORS-FOUND                               15310000
153200                     PERFORM D310-ADD-NR-TO-PO-LNE-TABLE          15320000
153300                 END-IF                                           15330000
153400*            END-IF                                               15340000
153500         END-IF                                                   15350000
153600     END-PERFORM.                                                 15360000
153700                                                                  15370007
153800*--------------------------------------------------------------*  15380007
153900* LOADS INVOIC INTO THE INTERNAL INVOIC TABLE.                 *  15390007
154000*--------------------------------------------------------------*  15400007
154100 C300-LOAD-INVOICES.                                              15410000
154200                                                                  15420000
154300     SET ITEMS-LEFT-ON-DB TO TRUE.                                15430000
154400     MOVE 1 TO IA-SUB.                                            15440000
154500     SET PR-IDX TO +1.                                            15450000
154600                                                                  15460000
154700     PERFORM                                                      15470000
154800         VARYING PV-READ-COUNT FROM 1 BY 1                        15480000
154900         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    15490000
155000            OR (NO-ITEMS-LEFT-ON-DB))                             15500000
155100                                                                  15510000
155200         PERFORM R300-FETCH-TINVOIC                               15520000
155300                                                                  15530000
155400         IF  ITEMS-LEFT-ON-DB                                     15540000
155500             PERFORM D400-ADD-TO-INVOICE-TABLE                    15550000
155600         END-IF                                                   15560000
155700     END-PERFORM.                                                 15570000
155800                                                                  15580007
155900*--------------------------------------------------------------*  15590007
156000* FOR EACH INVOICE LOADED ON THE INTERNAL INVOICE TABLE,       *  15600007
156100* RETRIEVES AND PROCESSES THE PREQIT DATA.                     *  15610007
156200*--------------------------------------------------------------*  15620007
156300 C400-LOAD-PREQIT.                                                15630000
156400                                                                  15640023
156500     SET ITEMS-LEFT-ON-DB TO TRUE.                                15650000
156600     SET FIRSTTIME        TO TRUE.                                15660000
156700                                                                  15670000
156800     MOVE IA-PAYT-REQ-SEQ-NBR (IA-SUB) TO DK-PAYT-REQ-SEQ-NBR.    15680000
156900     PERFORM Y600-OPEN-TPREQIT-CSR.                               15690000
157000     PERFORM R600-FETCH-TPREQIT.                                  15700000
157100     IF NO-ITEMS-LEFT-ON-DB                                       15710000
157200         SET BYPASS-PO                                            15720000
157300             NO-INVOICE-DETAIL TO TRUE                            15730000
157400     END-IF.                                                      15740000
157500                                                                  15750000
157600     IF PROCESS-PO                                                15760000
157700         PERFORM                                                  15770000
157800             VARYING PV-READ-COUNT FROM 2 BY 1                    15780000
157900             UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                15790000
158000                OR (NO-ITEMS-LEFT-ON-DB))                         15800000
158100                                                                  15810000
158200             PERFORM D500-PROCESS-TPREQIT-ROWS                    15820000
158300             PERFORM R600-FETCH-TPREQIT                           15830000
158400         END-PERFORM                                              15840000
158500     END-IF.                                                      15850000
158600                                                                  15860000
158700     IF PROCESS-PO                                                15870000
158800         PERFORM D500-PROCESS-TPREQIT-ROWS                        15880000
158900     END-IF.                                                      15890000
159000                                                                  15900000
159100     PERFORM Y610-CLOSE-TPREQIT-CSR.                              15910000
159200     ADD 1 TO IA-SUB.                                             15920000
159300                                                                  15930007
159400*--------------------------------------------------------------*  15940007
159500* SEARCHES THE INTERNAL PO LINE TABLE TO SEE IF ANY OVERAGES   *  15950007
159600* HAVE BEEN INDICATED.  IF BOTH OVERAGES AND SHORTAGES EXIST   *  15960007
159700* FOR A PO/STORE, IT CANNOT BE AUTOMATICALLY RECONCILED.       *  15970007
159800*--------------------------------------------------------------*  15980007
159900 C500-CHECK-FOR-OVER-SHORT.                                       15990000
160000                                                                  16000000
160100     SET PO-IDX TO 1.                                             16010000
160200     SEARCH PO-LINE-ENTRIES                                       16020000
160300         VARYING PO-IDX                                           16030000
160400         AT END CONTINUE                                          16040000
160500         WHEN T-QTY-OVER (PO-IDX)                                 16050000
160600            SET QTY-OVERAGE TO TRUE                               16060000
160700     END-SEARCH.                                                  16070000
160800                                                                  16080000
160900     IF QTY-OVERAGE AND QTY-SHORTAGE                              16090000
161000         SET BYPASS-PO                                            16100000
161100             OVER-SHORT  TO TRUE                                  16110000
161200     END-IF.                                                      16120000
161300                                                                  16130007
161400*--------------------------------------------------------------*  16140007
161500* ONCE ALL THE AUTOMATIC RECONCILATION EDITS HAVE BEEN PASSED, *  16150007
161600* THE PO/STORE CAN BE PAY RELEASED.  DISCOUNT AMOUNTS ARE      *  16160007
161700* ACCUMULATED, THE WEIGHTED DISCOUNT PERCENT IS CALCULATED,    *  16170007
161800* NECESSARY VENDOR INFORMATION IS RETRIEVED, AND RECONCILIATION*  16180007
161900* PROCESSING IS PERFORMED.                                     *  16190007
162000*--------------------------------------------------------------*  16200007
162100 C600-PAY-RELEASE.                                                16210000
162200                                                                  16220000
162300     MOVE 1 TO IA-SUB.                                            16230000
162400     PERFORM D600-ACCUM-DISC-AMTS                                 16240000
162500         UNTIL IA-SUB > IA-SUB-LIMIT                              16250000
162600            OR IA-PAYT-REQ-SEQ-NBR (IA-SUB) = +0.                 16260000
162700                                                                  16270000
162800     IF PV-TOTAL-GROSS-COST NOT = ZERO                            16280000
162900         DIVIDE PV-TOTAL-DISCOUNT-AMT BY PV-TOTAL-GROSS-COST      16290000
163000             GIVING PV-WEIGHTED-DISC-PCT ROUNDED                  16300000
163100         DIVIDE PV-COOP-ALLOW-AMT     BY PV-TOTAL-GROSS-COST      16310000
163200             GIVING PV-WEIGHTED-COOP-PCT ROUNDED                  16320000
163300         DIVIDE PV-ADV-DISC-AMT       BY PV-TOTAL-GROSS-COST      16330000
163400             GIVING PV-WEIGHTED-ADV-PCT ROUNDED                   16340000
163500         DIVIDE PV-NEW-STORE-AMT      BY PV-TOTAL-GROSS-COST      16350000
163600             GIVING PV-WEIGHTED-NSD-PCT ROUNDED                   16360000
163700         DIVIDE PV-TRADE-DISCOUNT-AMT BY PV-TOTAL-GROSS-COST      16370000
163800             GIVING PV-WEIGHTED-TRD-PCT ROUNDED                   16380000
163900         DIVIDE PV-MOS-DISCOUNT-AMT   BY PV-TOTAL-GROSS-COST      16390000
164000             GIVING PV-WEIGHTED-MOS-PCT ROUNDED                   16400000
164100         DIVIDE PV-MISC-DISCOUNT-AMT  BY PV-TOTAL-GROSS-COST      16410000
164200             GIVING PV-WEIGHTED-MSC-PCT ROUNDED                   16420000
164300         DIVIDE PV-PRFT-ASST-COOP-AMT BY PV-TOTAL-GROSS-COST      16430000
164400             GIVING PV-WEIGHTED-ALW-PCT ROUNDED                   16440000
164500     ELSE                                                         16450000
164600         MOVE ZERO TO PV-WEIGHTED-DISC-PCT                        16460000
164700                      PV-WEIGHTED-COOP-PCT                        16470000
164800                      PV-WEIGHTED-ADV-PCT                         16480000
164900                      PV-WEIGHTED-NSD-PCT                         16490000
165000                      PV-WEIGHTED-MOS-PCT                         16500000
165100                      PV-WEIGHTED-TRD-PCT                         16510000
165200                      PV-WEIGHTED-MSC-PCT                         16520000
165300                      PV-WEIGHTED-ALW-PCT                         16530000
165400     END-IF.                                                      16540000
165500                                                                  16550000
165600*    IF PV-TOTAL-DISCOUNTED-COST-AMT NOT = ZERO                   16560000
165700*        DIVIDE PV-ADV-DISC-AMT BY PV-TOTAL-DISCOUNTED-COST-AMT   16570000
165800*            GIVING PV-WEIGHTED-ADV-PCT ROUNDED                   16580000
165900*    ELSE                                                         16590000
166000*        MOVE ZERO TO PV-WEIGHTED-ADV-PCT                         16600000
166100*    END-IF.                                                      16610000
166200                                                                  16620000
166300*  IF ANY OF THE INVOICES ARE ON HOLD, ANY REMAINDER HEADER       16630000
166400*  CREATED WILL NEED TO BE PUT ON HOLD AS WELL                    16640000
166500     MOVE 'N' TO PV-HOLD-IND.                                     16650000
166600     PERFORM VARYING IA-SUB FROM +1 BY +1                         16660000
166700         UNTIL IA-PAYT-REQ-SEQ-NBR (IA-SUB) = ZERO                16670000
166800            OR IA-SUB > IA-SUB-LIMIT                              16680000
166900            OR PV-HOLD-IND = 'Y'                                  16690000
167000               IF IA-HOLD-IND (IA-SUB)= 'Y'                       16700000
167100                   MOVE 'Y'    TO PV-HOLD-IND                     16710000
167200               END-IF                                             16720000
167300     END-PERFORM.                                                 16730000
167400                                                                  16740000
167500     PERFORM D700-RECONCILE.                                      16750000
167600                                                                  16760007
167700*--------------------------------------------------------------*  16770007
167800* FOR THE PO/STORE BEING BYPASSED, PREPARE ROWS TO BE INSERTED *  16780007
167900* FOR THE MANUAL AND WORKING 'POS REQUIRING MANUAL RECONCIL-   *  16790007
168000* ATION' REPORTS.                                              *  16800007
168100*--------------------------------------------------------------*  16810007
168200 C700-PREPARE-BYPASS-ROWS.                                        16820000
168300                                                                  16830000
168310     MOVE PURCHS-ENT-ID      TO PV-ENT-ID.                        16831099
168311     MOVE PURCHS-DEPT-NBR    TO PV-DEPT-NBR.                      16831199
168320     PERFORM S500-CHECK-FOR-SEPHORA.                              16832099
168330                                                                  16833099
168400     MOVE +0                 TO PV-INVOICE-COUNT.                 16840000
168500     SET NOT-NEW-RC-STATUS   TO TRUE.                             16850000
168600     MOVE SPACES             TO AP270-RECORD.                     16860000
168700     MOVE 01                 TO AP270-REPORT.                     16870000
168800     MOVE 1                  TO IA-SUB.                           16880000
168900     PERFORM D800-PREPARE-INVOICE-DETAIL                          16890000
169000         UNTIL IA-PAYT-REQ-SEQ-NBR (IA-SUB) = ZERO                16900000
169100            OR IA-SUB > IA-SUB-LIMIT                              16910000
169200     PERFORM D810-PREPARE-HEADER.                                 16920000
169300                                                                  16930000
169400     MOVE 1                  TO IA-SUB.                           16940000
169500     IF NEW-RC-STATUS                                             16950000
169600         MOVE +0             TO PV-INVOICE-COUNT                  16960000
169700         MOVE SPACES         TO AP270-RECORD                      16970000
169800         MOVE 02             TO AP270-REPORT                      16980000
169900         PERFORM D800-PREPARE-INVOICE-DETAIL                      16990000
170000             UNTIL IA-PAYT-REQ-SEQ-NBR (IA-SUB) = ZERO            17000000
170100                OR IA-SUB > IA-SUB-LIMIT                          17010000
170200         PERFORM D810-PREPARE-HEADER                              17020000
170300     END-IF.                                                      17030000
170400                                                                  17040007
170500*--------------------------------------------------------------*  17050007
170600* FOR THE PO/STORE BEING PROCESSED, TRECEIV DATA IS ADDED TO   *  17060007
170700* THE INTERNAL RECEIV TABLE.                                   *  17070007
170800*--------------------------------------------------------------*  17080007
170900 D100-ADD-TO-RECEIV-TABLE.                                        17090000
171000                                                                  17100000
171100     MOVE RECEIV-ORD-NBR     TO PV-ORD-NBR.                       17110000
171200     MOVE RECEIV-REC-SEQ-NBR TO PV-REC-SEQ-NBR.                   17120000
171300     MOVE RECEIV-CRE-TMST    TO PV-CRE-TMST.                      17130000
171400                                                                  17140000
171500     SET RC-IDX TO +1.                                            17150000
171600                                                                  17160000
171700     SEARCH TRECEIV-ENTRY                                         17170000
171800         AT END                                                   17180000
171900             SET BYPASS-PO                                        17190000
172000                 TOO-MANY-RECEIV                                  17200000
172100                 ERRORS-FOUND                                     17210000
172200                 NO-ITEMS-LEFT-ON-DB TO TRUE                      17220000
172300                                                                  17230000
172400             WHEN (TRECEIV-ENTRY  (RC-IDX) = PV-TRECEIV-KEY       17240000
172500               OR  T-CRE-TMST     (RC-IDX) = SPACES)              17250000
172600                 NEXT SENTENCE                                    17260000
172700     END-SEARCH.                                                  17270000
172800                                                                  17280000
172900     IF NO-ERRORS-FOUND                                           17290000
173000         IF T-CRE-TMST (RC-IDX) = SPACES                          17300000
173100             MOVE PV-TRECEIV-KEY TO TRECEIV-ENTRY (RC-IDX)        17310000
173200         END-IF                                                   17320000
173300     END-IF.                                                      17330000
173400                                                                  17340007
173500*--------------------------------------------------------------*  17350007
173600* FOR THE PO/STORE BEING PROCESSED, TRECDIS DATA IS ADDED TO   *  17360007
173700* THE INTERNAL RECDIS TABLE.                                   *  17370007
173800*--------------------------------------------------------------*  17380007
173900 D200-ADD-TO-RECDIS-TABLE.                                        17390017
174000                                                                  17400000
174100     MOVE DK-PO-NBR               TO PV-RD-ORD-NBR.               17410000
174200     MOVE RECDIS-ORD-LNE-NBR      TO PV-RD-ORD-LNE-NBR.           17420000
174300     MOVE RECEIV-REC-SEQ-NBR      TO PV-RD-REC-SEQ-NBR.           17430000
174400     MOVE RECDIS-OPER-UNT-ID      TO PV-RD-OPER-UNT-ID.           17440000
174500     MOVE RECDIS-FCLTY-ID         TO PV-RD-FCLTY-ID.              17450000
174600     MOVE RECDIS-STR-NBR          TO PV-RD-STR-NBR.               17460000
174700     MOVE RECDIS-STR-FCLTY-ID     TO PV-RD-STR-FCLTY-ID.          17470000
174800     MOVE RECDIS-CRE-TMST         TO PV-RD-CRE-TMST.              17480000
174900                                                                  17490000
175000     SET RD-IDX TO +1.                                            17500000
175100                                                                  17510000
175200     SEARCH TRECDIS-ENTRY                                         17520000
175300         AT END                                                   17530000
175400             SET BYPASS-PO                                        17540000
175500                 TOO-MANY-RECDIS                                  17550000
175600                 ERRORS-FOUND                                     17560000
175700                 NO-ITEMS-LEFT-ON-DB TO TRUE                      17570000
175800                                                                  17580000
175900             WHEN (TRECDIS-ENTRY  (RD-IDX) = PV-TRECDIS-KEY       17590000
176000               OR  T-RD-CRE-TMST  (RD-IDX) = SPACES)              17600000
176100                   NEXT SENTENCE                                  17610051
176200     END-SEARCH.                                                  17620000
176300                                                                  17630000
176400     IF NO-ERRORS-FOUND                                           17640000
176500         IF T-RD-CRE-TMST (RD-IDX) = SPACES                       17650000
176600             MOVE PV-TRECDIS-KEY TO TRECDIS-ENTRY (RD-IDX)        17660000
176700         END-IF                                                   17670000
176800     END-IF.                                                      17680000
176900                                                                  17690007
177000*--------------------------------------------------------------*  17700007
177100* FOR THE PO/STORE BEING PROCESSED, TRECDIS DATA IS ADDED TO   *  17710007
177200* THE INTERNAL PO LINE TABLE.                                  *  17720007
177300*--------------------------------------------------------------*  17730007
177400 D210-ADD-RD-TO-PO-LNE-TABLE.                                     17740000
177500                                                                  17750014
177600     SET PO-IDX                    TO RECDIS-ORD-LNE-NBR.         17760000
177700     MOVE RECDIS-ORD-LNE-NBR       TO T-APP-PO-LNE-NBR (PO-IDX).  17770000
177800     ADD RECDIS-AP-VERIFY-ITM-QTY  TO T-RECV-QTY       (PO-IDX)   17780000
177900                                      T-PRCCLM-QTY     (PO-IDX).  17790000
178000     IF T-RECV-QTY (PO-IDX) > 0                                   17800000
178100         SET T-QTY-OVER (PO-IDX)   TO TRUE                        17810000
178200     END-IF.                                                      17820000
178300                                                                  17830000
178400     IF (T-RECV-UNT-COST-AMT (PO-IDX) = +0 OR                     17840000
178510         T-RECV-UNT-COST-AMT (PO-IDX) > PURITM-PRD-1ST-COST-AMT)  17851084
178600*-->         ** USE THE LOWEST UNIT COST **                       17860000
178710         MOVE PURITM-PRD-1ST-COST-AMT                             17871084
178720           TO T-RECV-UNT-COST-AMT (PO-IDX)                        17872084
178800     END-IF.                                                      17880000
178900                                                                  17890007
179000*--------------------------------------------------------------*  17900007
179100* FOR THE PO/STORE BEING PROCESSED, TNINREC DATA IS ADDED TO   *  17910007
179200* THE INTERNAL NINREC TABLE.                                   *  17920007
179300*--------------------------------------------------------------*  17930007
179400 D300-ADD-TO-NINREC-TABLE.                                        17940000
179500                                                                  17950000
179600     MOVE NINREC-PO-LNE-NBR       TO PV-NI-PO-LNE-NBR.            17960000
179700     MOVE NINREC-NON-INVC-SEQ-NBR TO PV-NI-NON-INVC-SEQ-NBR.      17970000
179800                                                                  17980000
179900     SET NI-IDX TO +1.                                            17990000
180000                                                                  18000000
180100     SEARCH TNINREC-ENTRY                                         18010000
180200         AT END                                                   18020000
180300             SET BYPASS-PO                                        18030000
180400                 TOO-MANY-NINREC                                  18040000
180500                 ERRORS-FOUND                                     18050000
180600                 NO-ITEMS-LEFT-ON-DB TO TRUE                      18060000
180700                                                                  18070000
180800             WHEN (TNINREC-ENTRY  (NI-IDX) = PV-TNINREC-KEY       18080000
180900               OR  T-NI-NON-INVC-SEQ-NBR (NI-IDX) = +0)           18090000
181000                 NEXT SENTENCE                                    18100000
181100     END-SEARCH.                                                  18110000
181200                                                                  18120000
181300     IF NO-ERRORS-FOUND                                           18130000
181400         IF T-NI-NON-INVC-SEQ-NBR (NI-IDX) = +0                   18140000
181500             MOVE PV-TNINREC-KEY TO TNINREC-ENTRY (NI-IDX)        18150000
181600         END-IF                                                   18160000
181700     END-IF.                                                      18170000
181800                                                                  18180007
181900*--------------------------------------------------------------*  18190007
182000* FOR THE PO/STORE BEING PROCESSED, TNINREC DATA IS ADDED TO   *  18200007
182100* THE INTERNAL PO LINE TABLE.                                  *  18210007
182200*--------------------------------------------------------------*  18220007
182300 D310-ADD-NR-TO-PO-LNE-TABLE.                                     18230000
182400                                                                  18240000
182500     SET PO-IDX                    TO NINREC-PO-LNE-NBR.          18250000
182600                                                                  18260000
182700     MOVE NINREC-PO-LNE-NBR        TO T-APP-PO-LNE-NBR (PO-IDX).  18270000
182800     ADD NINREC-NON-INVC-UNT-QTY   TO T-RECV-QTY       (PO-IDX)   18280000
182900                                      T-PRCCLM-QTY     (PO-IDX).  18290000
183000     IF T-RECV-QTY (PO-IDX) > 0                                   18300000
183100         SET T-QTY-OVER (PO-IDX)   TO TRUE                        18310000
183200     END-IF.                                                      18320000
183300                                                                  18330000
183400     IF (T-RECV-UNT-COST-AMT (PO-IDX) = +0 OR                     18340000
183500         T-RECV-UNT-COST-AMT (PO-IDX) > NINREC-UNT-COST-AMT)      18350000
183600*-->         ** USE THE LOWEST UNIT COST **                       18360000
183700         MOVE NINREC-UNT-COST-AMT TO T-RECV-UNT-COST-AMT (PO-IDX) 18370000
183800     END-IF.                                                      18380000
183900                                                                  18390007
184000*--------------------------------------------------------------*  18400007
184100* FOR THE PO/STORE BEING PROCESSED, TINVOIC DATA IS ADDED TO   *  18410007
184200* THE INTERNAL INVOIC TABLE.                                   *  18420007
184300*--------------------------------------------------------------*  18430007
184400 D400-ADD-TO-INVOICE-TABLE.                                       18440000
184500                                                                  18450000
184600     IF IA-SUB > IA-SUB-LIMIT                                     18460000
184700         SET BYPASS-PO                                            18470000
184800             TOO-MANY-INVOIC                                      18480000
184900             NO-ITEMS-LEFT-ON-DB  TO TRUE                         18490000
185000                                                                  18500000
185100     ELSE                                                         18510000
185200         MOVE INVOIC-STR-NBR          TO IA-STR-NBR       (IA-SUB)18520000
185300         MOVE INVOIC-INVC-ID          TO IA-INVOICE-ID    (IA-SUB)18530000
185400                                                                  18540000
185500         IF INVOIC-INVC-TYP-CDE = 'RI'                            18550000
185600             SET INPUT-REMAINDER      TO TRUE                     18560000
185700         END-IF                                                   18570000
185800         MOVE INVOIC-INVC-TYP-CDE     TO IA-INVOICE-TYPE  (IA-SUB)18580000
185900                                                                  18590000
186000         MOVE INVOIC-STATUS-CDE       TO IA-INVOICE-STATUS(IA-SUB)18600000
186100         MOVE INVOIC-STATUS-CHG-TMST (1:10)                       18610000
186200                                  TO IA-STATUS-CHG-DATE   (IA-SUB)18620000
186300                                                                  18630000
186400         MOVE INVOIC-ENTR-MTHD-CDE    TO IA-ENTRY-METHOD  (IA-SUB)18640000
186500         MOVE INVOIC-GRO-COST-AMT     TO IA-GROSS-COST-AMT(IA-SUB)18650000
186600         MOVE INVOIC-PAYT-REQ-SEQ-NBR                             18660000
186700                                  TO IA-PAYT-REQ-SEQ-NBR  (IA-SUB)18670000
186800         MOVE INVOIC-CRE-DTE          TO IA-ENTRY-DATE    (IA-SUB)18680000
186900                                                                  18690000
187000         MOVE INVOIC-CALC-DUE-DTE (1:2)  TO IA-DUE-CENT   (IA-SUB)18700051
187100         MOVE INVOIC-CALC-DUE-DTE (3:2)  TO IA-DUE-YEAR   (IA-SUB)18710051
187200         MOVE INVOIC-CALC-DUE-DTE (6:2)  TO IA-DUE-MONTH  (IA-SUB)18720051
187300         MOVE INVOIC-CALC-DUE-DTE (9:2)  TO IA-DUE-DAY    (IA-SUB)18730051
187400                                                                  18740000
187500         MOVE INVOIC-DUE-DTE-SRC-CDE                              18750000
187600                                  TO IA-DUE-DTE-SRC-CDE   (IA-SUB)18760000
187700         MOVE INVOIC-HOLD-IND         TO IA-HOLD-IND      (IA-SUB)18770000
187800         MOVE INVOIC-MTCH-LVL-CDE     TO IA-MTCH-LVL-CDE(IA-SUB)  18780000
187900         MOVE INVOIC-DC-NBR           TO IA-DC-NBR(IA-SUB)        18790073
188000         IF IA-MTCH-LVL-CDE(IA-SUB) = 'S'                         18800072
188100            MOVE INVOIC-DC-NBR        TO PV-SAVE-DC-NBR           18810072
188200         END-IF                                                   18820072
188300                                                                  18830000
188400         MOVE SPACES                                              18840000
188500                                  TO IA-INVOICE-DATE      (IA-SUB)18850000
188600                                     IA-DTL-ENTR-IND      (IA-SUB)18860000
188700                                     IA-ENTER-USERID      (IA-SUB)18870000
188800                                     IA-CUTOFF-DATE       (IA-SUB)18880000
188900                                     IA-TERMS-SEL-CDE     (IA-SUB)18890000
189000                                     IA-EOM-INDICATOR     (IA-SUB)18900000
189100                                     IA-PAYMENT-DUE-SW    (IA-SUB)18910000
189200                                     IA-INVOICE-INCL-SW   (IA-SUB)18920000
189300                                                                  18930000
189400         MOVE ZEROS                                               18940000
189500                                  TO IA-TOT-INVOICE-QTY   (IA-SUB)18950000
189600                                     IA-TERMS-DISC-PCT    (IA-SUB)18960000
189700                                     IA-TERMS-DUE-DAY-QTY (IA-SUB)18970000
189800                                     IA-TERMS-EXT-DAY-QTY (IA-SUB)18980000
189900                                                                  18990000
190000         EVALUATE TRUE                                            19000000
190100             WHEN PV-REMAINDER-INVC-DTE = SPACES                  19010000
190200                 MOVE INVOIC-INVC-DTE TO PV-REMAINDER-INVC-DTE    19020000
190300             WHEN INVOIC-INVC-DTE > PV-REMAINDER-INVC-DTE         19030000
190400                 MOVE INVOIC-INVC-DTE TO PV-REMAINDER-INVC-DTE    19040000
190500             WHEN OTHER                                           19050000
190600                 CONTINUE                                         19060000
190700         END-EVALUATE                                             19070000
190800                                                                  19080000
190900         ADD 1 TO IA-SUB                                          19090000
191000     END-IF.                                                      19100000
191100                                                                  19110007
191200*--------------------------------------------------------------*  19120007
191300* FOR THE PO/STORE BEING PROCESSED, QTY FROM PREQIT IS ROLLED  *  19130007
191400* UP FOR EACH KEY PO LINE NUMBER BEFORE BEING ADDED TO THE     *  19140007
191500* INTERNAL PO LINE TABLE.                                      *  19150007
191600*--------------------------------------------------------------*  19160007
191700 D500-PROCESS-TPREQIT-ROWS.                                       19170000
191800                                                                  19180000
191900     IF FIRSTTIME                                                 19190000
192000         IF  ITEMS-LEFT-ON-DB                                     19200000
192100             MOVE PV-CSR-NULL-LNE-NBR-IND TO PV-NULL-LNE-NBR-IND  19210000
192200             MOVE PV-CSR-KEY-LNE-NBR      TO PV-KEY-LNE-NBR       19220000
192300             MOVE PV-CSR-APP-LNE-NBR      TO PV-APP-LNE-NBR       19230000
192400             MOVE PV-CSR-QTY              TO PV-QTY               19240000
192500             MOVE PV-CSR-UNT-COST-AMT     TO PV-UNT-COST-AMT      19250000
192600             MOVE PV-CSR-PAYT-REQ-SEQ-NBR TO PV-PAYT-REQ-SEQ-NBR  19260000
192700         END-IF                                                   19270000
192800         SET NOT-FIRSTTIME    TO TRUE                             19280000
192900     ELSE                                                         19290000
193000                                                                  19300000
193100         IF ITEMS-LEFT-ON-DB                                      19310000
193200             IF  PV-CSR-KEY-LNE-NBR      = PV-KEY-LNE-NBR         19320097
193400             AND PV-CSR-UNT-COST-AMT     = PV-UNT-COST-AMT        19340097
193500             AND PV-CSR-PAYT-REQ-SEQ-NBR = PV-PAYT-REQ-SEQ-NBR    19350097
194200                 ADD  PV-CSR-QTY          TO PV-QTY               19420097
194400                                                                  19440000
194500             ELSE                                                 19450000
194600                 PERFORM E100-UPDATE-PO-LNE-TABLE                 19460000
194610                 IF  PV-CSR-KEY-LNE-NBR NOT  = PV-KEY-LNE-NBR     19461097
194620                     PERFORM E150-CHECK-FOR-SHORTAGE              19462097
194630                 END-IF                                           19463097
194700                 MOVE PV-CSR-NULL-LNE-NBR-IND                     19470000
194800                                          TO PV-NULL-LNE-NBR-IND  19480000
194900                 MOVE PV-CSR-APP-LNE-NBR      TO PV-APP-LNE-NBR   19490000
195000                 MOVE PV-CSR-KEY-LNE-NBR      TO PV-KEY-LNE-NBR   19500000
195100                 MOVE PV-CSR-QTY              TO PV-QTY           19510000
195200                 MOVE PV-CSR-UNT-COST-AMT     TO PV-UNT-COST-AMT  19520000
195300                 MOVE PV-CSR-PAYT-REQ-SEQ-NBR                     19530000
195400                                          TO PV-PAYT-REQ-SEQ-NBR  19540000
195500             END-IF                                               19550000
195600                                                                  19560000
195700         ELSE                                                     19570000
195800             PERFORM E100-UPDATE-PO-LNE-TABLE                     19580000
195810             PERFORM E150-CHECK-FOR-SHORTAGE                      19581097
195900             INITIALIZE PV-KEY-LNE-NBR                            19590000
196000                        PV-QTY                                    19600000
196100                        PV-UNT-COST-AMT                           19610000
196200         END-IF                                                   19620000
196300     END-IF.                                                      19630000
196400                                                                  19640007
196500*--------------------------------------------------------------*  19650007
196600* READ THROUGH THE INTERNAL INVOIC TABLE, RETRIEVE ALL         *  19660007
196700* ASSOCIATED ALLOWANCES, AND THE TERMS DISCOUNT.  FROM THIS    *  19670007
196800* INFORMATION THE TOTAL DISCOUNT AMOUNT IS CALCULATED.         *  19680007
196900*--------------------------------------------------------------*  19690007
197000 D600-ACCUM-DISC-AMTS.                                            19700000
197100                                                                  19710000
197200     MOVE IA-PAYT-REQ-SEQ-NBR (IA-SUB) TO DK-PAYT-REQ-SEQ-NBR.    19720000
197300     ADD IA-GROSS-COST-AMT (IA-SUB)    TO PV-TOTAL-GROSS-COST.    19730000
197400     MOVE IA-GROSS-COST-AMT (IA-SUB)   TO PV-DISCOUNTED-COST-AMT. 19740000
197500     MOVE IA-INVOICE-ID  (IA-SUB)      TO ALCHRG-INVC-ID          19750000
197600                                          INVCTM-INVC-ID          19760000
197700                                          MDINVC-INVC-ID.         19770000
197800     SET MORE-ALLOWANCES               TO TRUE.                   19780000
197900     PERFORM Y700-OPEN-DISCOUNT-CSR.                              19790000
198000                                                                  19800000
198100*----- FOR EACH INVOICE GET ALL ASSOCIATED ALLOWANCES             19810000
198200     PERFORM WITH TEST BEFORE                                     19820000
198300         UNTIL OUT-OF-ALLOWANCES                                  19830000
198400                                                                  19840000
198500         PERFORM R700-FETCH-DISCOUNT                              19850000
198600         IF MORE-ALLOWANCES                                       19860000
198700             INITIALIZE APPD052-VARIABLES                         19870000
198800             MOVE IA-GROSS-COST-AMT (IA-SUB)                      19880000
198900                         TO APPD052-GROSS-INVOICE-COST            19890000
199000             PERFORM CALC-ALW-CHRG                                19900000
199100             ADD APPD052-COOP-ADV-ALLOW-AMT                       19910000
199200                         TO PV-COOP-ALLOW-AMT                     19920000
199300             ADD APPD052-ADV-DISC-AMT                             19930000
199400                         TO PV-ADV-DISC-AMT                       19940000
199500             ADD APPD052-NEW-STORE-AMT                            19950000
199600                         TO PV-NEW-STORE-AMT                      19960000
199700             ADD APPD052-TRADE-AMT                                19970000
199800                         TO PV-TRADE-DISCOUNT-AMT                 19980000
199900             ADD APPD052-MOS-DISC-AMT                             19990000
200000                         TO PV-MOS-DISCOUNT-AMT                   20000000
200100             ADD APPD052-MISC-DISC-AMT                            20010000
200200                         TO PV-MISC-DISCOUNT-AMT                  20020000
200300             ADD APPD052-PRFT-ASST-COOP-AMT                       20030000
200400                         TO PV-PRFT-ASST-COOP-AMT                 20040000
200500*            COMPUTE PV-DISCOUNTED-COST-AMT =                     20050000
200600*               PV-DISCOUNTED-COST-AMT - APPD052-ALLOWANCE-AMT    20060000
200700*               - APPD052-COOP-ADV-ALLOW-AMT                      20070000
200800*               - APPD052-ADV-DISC-AMT                            20080000
200900         END-IF                                                   20090000
201000     END-PERFORM.                                                 20100000
201100     PERFORM Y710-CLOSE-DISCOUNT-CSR.                             20110000
201200                                                                  20120000
201300     ADD PV-DISCOUNTED-COST-AMT TO PV-TOTAL-DISCOUNTED-COST-AMT.  20130000
201400                                                                  20140000
201500*    SET MORE-ADVERT-ALLWS             TO TRUE.                   20150000
201600*    PERFORM Y900-OPEN-ADVERTISING-CSR.                           20160000
201700*----- FOR EACH INVOICE GET ALL ASSOCIATED ADVERTISING ALLOWANCES 20170000
201800*    PERFORM WITH TEST BEFORE                                     20180000
201900*        UNTIL OUT-OF-ADVERT-ALLWS                                20190000
202000*                                                                 20200000
202100*        PERFORM R705-FETCH-ADVERT-ALLWS                          20210000
202200*        IF MORE-ADVERT-ALLWS                                     20220000
202300*            INITIALIZE APPD052-VARIABLES                         20230000
202400*            MOVE PV-DISCOUNTED-COST-AMT                          20240000
202500*                        TO APPD052-GROSS-INVOICE-COST            20250000
202600*            PERFORM CALC-ALW-CHRG                                20260000
202700*            ADD APPD052-ADV-DISC-AMT TO PV-ADV-DISC-AMT          20270000
202800*        END-IF                                                   20280000
202900*    END-PERFORM.                                                 20290000
203000*    PERFORM Y910-CLOSE-ADVERTISING-CSR.                          20300000
203100                                                                  20310000
203200     PERFORM R710-SELECT-TERM-SEL-CDE.                            20320000
203300                                                                  20330000
203400     IF MDINVC-TERM-SEL-CDE = 'P'                                 20340000
203500*------ PO TERMS ARE INDICATED                                    20350000
203600         PERFORM R720-GET-PO-DISC-PCT                             20360000
203700         COMPUTE PV-DECIMAL-8 =                                   20370000
203800                 PAYTRM-DISCOUNT-PCT * IA-GROSS-COST-AMT (IA-SUB) 20380000
203900         COMPUTE PV-TOTAL-DISCOUNT-AMT ROUNDED                    20390000
204000               = PV-TOTAL-DISCOUNT-AMT                            20400000
204100               + PV-DECIMAL-8                                     20410000
204200     ELSE                                                         20420000
204300*----- INVOICE TERMS ARE INDICATED (MDINVC-TERM-SEL-CDE = 'I')    20430000
204400         PERFORM R730-GET-INVOICE-DISC-PCT                        20440000
204500         COMPUTE PV-DECIMAL-8 =                                   20450000
204600                 INVCTM-DISC-PCT * IA-GROSS-COST-AMT (IA-SUB)     20460000
204700         COMPUTE PV-TOTAL-DISCOUNT-AMT ROUNDED                    20470000
204800               = PV-TOTAL-DISCOUNT-AMT                            20480000
204900               + PV-DECIMAL-8                                     20490000
205000     END-IF.                                                      20500000
205100                                                                  20510000
205200     ADD 1 TO IA-SUB.                                             20520000
205300                                                                  20530000
205400     COPY APPD052.                                                20540000
205500 EJECT                                                            20550000
205600*----------------------------------------------------------------*20560000
205700*  READ THROUGH THE INTERNAL PO LINE TABLE.  FOR EACH LINE DO    *20570000
205800*  THE FOLLOWING:                                                *20580000
205900*   - CREATE NON-INVOICED RECEIPTS WHEN THERE IS AN OVERAGE      *20590000
206000*   - CREATE REMAINDER INVOICE ITEMS WHEN THERE IS A SHORTAGE    *20600000
206100*   - IF A REMAINDER INVOICE IS CREATED, ADJUST THE DISCOUNT     *20610000
206200*     AMOUNT, UPDATE GROSS COST AND QTY, AND ADD THE APPROPRIATE *20620000
206300*     AUDIT TABLE ROWS                                           *20630000
206400*   - UPDATE TRECEIV (FOR BULK) OR TRECDIS (FOR BY STORE) TO A   *20640000
206500*     MATCHED STATUS                                             *20650000
206600*   - UPDATE TNINREC TO A MATCHED STATUS                         *20660000
206700*   - UPDATE TINVOIC TO A RELEASED STATUS AND ADD THE APPROPRI-  *20670000
206800*     ATE AUDIT TABLE ROWS                                       *20680000
206900*   - CREATE PRICE CLAIMS WHEN THERE IS A COST PRICE DIFFERENCE  *20690000
207000*   - UPDATE TPOSTRR STATUS TO BE PROCESSED THROUGH OPEN TO PAY  *20700000
207100*     AND CLASS DISTRIBUTION                                     *20710000
207200*   - IF THE DUE DATE SOURCE IS 'X' (EXCEPTION) WRITE OUT THE    *20720000
207300*     RECORDS FROM THE INPUT INVOICE EXCEPTION FILE TO THE DUE   *20730000
207400*     DUE DATE EXCEPTION REPORT OUTPUT TABLE                     *20740000
207500*----------------------------------------------------------------*20750000
207600 D700-RECONCILE.                                                  20760000
207700                                                                  20770000
207800     INITIALIZE PC-BLANK-PO-LINE-TABLE-ENTRY.                     20780000
207900                                                                  20790000
208000     SET RI-INVC-NOT-CREATED TO TRUE.                             20800000
208100     MOVE 1 TO IA-SUB.                                            20810039
208200                                                                  20820000
208300     PERFORM VARYING PO-IDX FROM +1 BY +1                         20830000
208400         UNTIL PO-IDX = +1000                                     20840000
208500         IF PO-LINE-ENTRIES (PO-IDX) =                            20850000
208600               PC-BLANK-PO-LINE-TABLE-ENTRY                       20860000
208700             CONTINUE                                             20870000
208800         ELSE                                                     20880000
208900             IF T-QTY-OVER (PO-IDX)                               20890000
209000                  PERFORM E200-CREATE-TNINREC                     20900000
209100             END-IF                                               20910000
209200             IF T-QTY-SHORT (PO-IDX)                              20920000
209300                  PERFORM F300-PROCESS-REMAINDER-INVOICE          20930000
209400             END-IF                                               20940000
209500         END-IF                                                   20950000
209600     END-PERFORM.                                                 20960000
209700                                                                  20970000
209800     IF T-PAYT-REQ-SEQ-NBR (1000) > +0                            20980000
209900         PERFORM E300-NULL-LNE-NBR-PROCESSING                     20990000
210000     END-IF.                                                      21000000
210100                                                                  21010000
210200     IF RI-INVC-CREATED                                           21020000
210300*--  ADJUST THE DISCOUNT AMT TAKEN BY THE REMAINDER AMOUNT        21030000
210400         COMPUTE PV-DECIMAL-8 =                                   21040000
210500                (PV-REMAINDER-TOT-COST * PV-WEIGHTED-DISC-PCT)    21050000
210600         COMPUTE PV-TOTAL-DISCOUNT-AMT ROUNDED                    21060000
210700               = PV-TOTAL-DISCOUNT-AMT                            21070000
210800               - PV-DECIMAL-8                                     21080000
210900                                                                  21090000
211000         MOVE PV-REMAINDER-TOT-COST   TO INVOIC-GRO-COST-AMT      21100000
211100                                         INVOIC-INVC-NET-COST-AMT 21110000
211200         PERFORM U500-UPDATE-TINVOIC-COST                         21120000
211300                                                                  21130000
211400         MOVE PV-REMAINDER-INVC-QTY   TO MDINVC-TOT-INVC-PC-QTY   21140000
211500         PERFORM U510-UPDATE-TMDINVC-QTY                          21150000
211600     END-IF.                                                      21160000
211700                                                                  21170000
211800     IF DK-MTCH-LVL-CDE = 'P' OR 'D'                              21180000
211900                                                                  21190000
212000         PERFORM VARYING RC-IDX FROM +1 BY +1                     21200000
212100             UNTIL T-CRE-TMST (RC-IDX) = SPACES OR                21210000
212200                   RC-IDX > +250                                  21220000
212300             PERFORM U700-UPDATE-TRECEIV                          21230000
212400         END-PERFORM                                              21240000
212500                                                                  21250000
212600     ELSE                                                         21260000
212700                                                                  21270000
212800         PERFORM VARYING RD-IDX FROM +1 BY +1                     21280000
212900             UNTIL T-RD-CRE-TMST (RD-IDX) = SPACES OR             21290000
213000                   RD-IDX > +9999                                 21300000
213100             PERFORM U710-UPDATE-TRECDIS                          21310000
213200         END-PERFORM                                              21320000
213300                                                                  21330000
213400     END-IF.                                                      21340000
213500                                                                  21350000
213600     PERFORM VARYING NI-IDX FROM +1 BY +1                         21360000
213700         UNTIL T-NI-NON-INVC-SEQ-NBR (NI-IDX) = +0  OR            21370000
213800               NI-IDX > +999                                      21380000
213900         PERFORM U720-UPDATE-TNINREC                              21390000
214000     END-PERFORM.                                                 21400000
214100                                                                  21410000
214200     PERFORM VARYING IA-SUB FROM +1 BY +1                         21420000
214300         UNTIL IA-PAYT-REQ-SEQ-NBR (IA-SUB) = ZERO                21430000
214400            OR IA-SUB > IA-SUB-LIMIT                              21440000
214500                                                                  21450000
214600           PERFORM U800-UPDATE-TINVOIC                            21460000
214700     END-PERFORM.                                                 21470000
214800                                                                  21480000
214900     MOVE 1 TO IA-SUB.                                            21490043
215000     PERFORM E500-CREATE-PRCCLM                                   21500000
215100         VARYING PR-IDX FROM +1 BY +1                             21510000
215200             UNTIL T-PR-INVC-ID (PR-IDX) = SPACES OR              21520000
215300                   PR-IDX > PV-PRCCLM-MAX.                        21530099
215400                                                                  21540000
215500     MOVE PV-WEIGHTED-DISC-PCT     TO POSTRR-WEIGHTED-DISC-PCT.   21550000
215600     MOVE PV-TOTAL-DISCOUNT-AMT    TO POSTRR-TOTAL-DISC-AMT.      21560000
215700     MOVE CURR-TIMESTAMP           TO POSTRR-PAYT-RLSE-TMST.      21570000
215800     PERFORM U950-UPDATE-TPOSTRR.                                 21580000
215900                                                                  21590007
216000*--------------------------------------------------------------*  21600007
216100* FORMATS THE INVOICE ROW FOR THE MANUAL RECON REPORT          *  21610007
216200*--------------------------------------------------------------*  21620007
216300 D800-PREPARE-INVOICE-DETAIL.                                     21630000
216400                                                                  21640000
216500     MOVE ENTNME-ENT-NAME-DESC   TO   AP270-VENDOR-NAME.          21650000
216600     MOVE EXTENT-DUN-NBR         TO   AP270-VENDOR-NUMBER.        21660000
216700     MOVE DK-PO-NBR              TO   AP270-PO-NBR.               21670000
216701                                                                  21670199
216702     PERFORM S200-GET-RCV-INCOMPLETE.                             21670299
216703                                                                  21670399
216710     IF PS-SEPHORA-ALL                                            21671099
216720         SET AP270-SEPHORA-VND   TO   TRUE                        21672099
216722     ELSE                                                         21672299
216723         SET AP270-NOT-SEPHORA-VND TO TRUE                        21672399
216730     END-IF.                                                      21673099
216800                                                                  21680000
216900     MOVE IA-ENTRY-MONTH (IA-SUB)                                 21690000
217000                                 TO   AP270-ENTRY-MONTH.          21700000
217100     MOVE IA-ENTRY-DAY (IA-SUB)  TO   AP270-ENTRY-DAY.            21710000
217200     MOVE IA-ENTRY-YEAR(IA-SUB)  TO   AP270-ENTRY-YEAR.           21720000
217300                                                                  21730000
217400     MOVE IA-INVOICE-ID (IA-SUB) TO   AP270-INVOICE-NUMBER.       21740000
217500     MOVE IA-STR-NBR (IA-SUB)    TO   AP270-STORE-NUMBER.         21750043
217600     MOVE IA-DC-NBR (IA-SUB)     TO   AP270-DC-NBR.               21760043
217700     MOVE DK-MTCH-LVL-CDE        TO   AP270-MTCH-LVL-CDE.         21770000
217800     MOVE PV-BYPASS-REASON-CODE  TO   AP270-REASON-CODE.          21780000
217900                                                                  21790000
218000     MOVE IA-ENTRY-METHOD (IA-SUB)                                21800000
218100                                 TO   AP270-INVOICE-ENTRY-METHOD. 21810000
218200     MOVE IA-GROSS-COST-AMT (IA-SUB)                              21820000
218300                                 TO   AP270-GROSS-INVOICE-AMT.    21830000
218400                                                                  21840000
218500     MOVE SPACE                  TO   AP270-FIRST-TIME-RC.        21850000
218600                                                                  21860000
218700     IF IA-STATUS-CHG-DATE (IA-SUB) = APCNTL-BTCH-PRC-DTE         21870000
218800        SET NEW-RC-STATUS        TO   TRUE                        21880000
218900        MOVE 'Y'                 TO   AP270-FIRST-TIME-RC         21890000
219000     ELSE                                                         21900000
219100        MOVE SPACE               TO   AP270-FIRST-TIME-RC         21910000
219200     END-IF.                                                      21920000
219300                                                                  21930000
219310     MOVE PS-RECV-COMPLETE-IND   TO   AP270-RCV-INCOMP-IND.       21931099
219320                                                                  21932099
219400     MOVE AP270-RECORD           TO   OUTAP5-MANL-RECNCL-ODR.     21940000
219500     PERFORM W100-INSERT-RPT-ROW.                                 21950000
219600                                                                  21960000
219700     ADD 1                       TO IA-SUB.                       21970000
219800     ADD 1                       TO PV-INVOICE-COUNT.             21980000
219900                                                                  21990007
220000*--------------------------------------------------------------*  22000007
220100* FORMATS THE KEY AREA AND THE PO AREA FOR MANUAL RECONS       *  22010007
220200*--------------------------------------------------------------*  22020007
220300 D810-PREPARE-HEADER.                                             22030000
220400                                                                  22040000
220500     MOVE LOW-VALUES             TO   AP270-HEADER.               22050000
220600                                                                  22060000
220700     MOVE PV-BYPASS-REASON-CODE  TO   AP270-REASON-CODE.          22070000
220800     MOVE SPACE                  TO   AP270-DATA-HEADER.          22080000
220900     MOVE PV-INVOICE-COUNT       TO   AP270-INVOICE-COUNT.        22090000
221000                                                                  22100000
221100     MOVE AP270-RECORD           TO   OUTAP5-MANL-RECNCL-ODR.     22110000
221200     PERFORM W100-INSERT-RPT-ROW.                                 22120000
221300                                                                  22130007
221400*--------------------------------------------------------------*  22140007
221500* ADDS INVOICE ITEM INFORMATION TO THE INTERNAL PO LINE TABLE  *  22150007
221600*--------------------------------------------------------------*  22160007
221700 E100-UPDATE-PO-LNE-TABLE.                                        22170000
221800                                                                  22180000
221900     IF PV-PO-LNE-NBR-NOT-NULL                                    22190000
222000         SET PO-IDX TO PV-APP-LNE-NBR                             22200000
222100     ELSE                                                         22210000
222200         SET PO-IDX TO +1000                                      22220000
222300     END-IF.                                                      22230000
222400                                                                  22240000
222500     MOVE PV-PAYT-REQ-SEQ-NBR    TO T-PAYT-REQ-SEQ-NBR(PO-IDX).   22250000
222600     IF PV-PO-LNE-NBR-NOT-NULL                                    22260000
222700         MOVE PV-APP-LNE-NBR     TO T-APP-PO-LNE-NBR (PO-IDX)     22270000
222800         MOVE PV-KEY-LNE-NBR     TO T-KEY-PO-LNE-NBR (PO-IDX)     22280000
222900     ELSE                                                         22290000
223000         MOVE +0                 TO T-APP-PO-LNE-NBR (PO-IDX)     22300000
223100                                    T-KEY-PO-LNE-NBR (PO-IDX)     22310000
223200     END-IF.                                                      22320000
223300     ADD  PV-QTY                 TO T-INVC-QTY       (PO-IDX).    22330000
223400                                                                  22340051
224700     IF T-INVC-UNT-COST-AMT (PO-IDX) = +0                         22470000
224800         MOVE PV-UNT-COST-AMT   TO T-INVC-UNT-COST-AMT (PO-IDX)   22480000
224900     ELSE                                                         22490000
224910         IF T-INVC-UNT-COST-AMT (PO-IDX) > +0 AND                 22491091
224920           (T-INVC-UNT-COST-AMT (PO-IDX) NOT =                    22492091
224930            PV-UNT-COST-AMT)                                      22493091
224940             MOVE 'Y'            TO T-MULT-INVC-SW(PO-IDX)        22494091
224950         END-IF                                                   22495091
225000*        IF PV-UNT-COST-AMT NOT = T-INVC-UNT-COST-AMT (PO-IDX)    22500091
225100*-- AUTO RECONCILIATION DOES NOT HANDLE MULTIPLE UNIT COSTS       22510000
225200*            SET BYPASS-PO                                        22520091
225300*                MULT-INVC-COST                                   22530091
225400*                NO-ITEMS-LEFT-ON-DB  TO TRUE                     22540091
225500*        END-IF                                                   22550091
225600     END-IF.                                                      22560000
225700                                                                  22570000
225800*----- IF THE INVOICE QTY IS GREATER THAN ZERO, IF A RECEIVER COST22580000
225900*----- EXISTS, AND IF THE RECEIVER AND INVOICE COSTS ARE UNEQUAL, 22590000
226000*----- SEE IF THE COST DIFFERENCE IS WITHIN THE SET PERCENTAGE    22600000
226100     IF (T-INVC-QTY (PO-IDX) = 0) OR                              22610031
226200        (T-RECV-QTY (PO-IDX) = 0)                                 22620031
226300         CONTINUE                                                 22630000
226400     ELSE                                                         22640000
226500         IF T-RECV-UNT-COST-AMT (PO-IDX) NOT = PV-UNT-COST-AMT    22650099
226600* -- BYPASS THE COST DIFFERENCE RULE FOR PO TYPES OF CD.          22660099
226601* -- WE STILL WANT THE PRICE CLAIMS CREATED, BUT NOT LIMITED      22660199
226602            IF PURCHS-PO-TYP-CDE  = 'CD'                          22660299
226610               CONTINUE                                           22661099
226620            ELSE                                                  22662099
226700               PERFORM F100-CHECK-COST-DIF-PCT                    22670099
226800            END-IF                                                22680099
226900* -- A ROW IS A CANDIDATE FOR TPRCCLM ONLY IF ITS INVC & RECV     22690000
227000* -- QTYS ARE > ZERO, AND ITS UNIT COSTS DIFFER                   22700000
227100            IF NO-ERRORS-FOUND                                    22710046
227200               IF (T-INVC-QTY   (PO-IDX) > +0    AND              22720046
227300                   T-RECV-QTY   (PO-IDX) > +0    AND              22730046
227400                   T-PRCCLM-QTY (PO-IDX) > +0    AND              22740046
227500                   PV-UNT-COST-AMT                                22750091
227600                   NOT = T-RECV-UNT-COST-AMT (PO-IDX))            22760046
227700                      PERFORM F200-ADD-TO-TPRCCLM-TABLE           22770046
227800               END-IF                                             22780046
227900            END-IF                                                22790046
228000         END-IF                                                   22800046
228100     END-IF.                                                      22810000
228200                                                                  22820007
228201*--------------------------------------------------------------*  22820197
228202* PREPARES FIELDS TO BE INSERTED TO TNINREC                    *  22820297
228203*--------------------------------------------------------------*  22820397
228204 E150-CHECK-FOR-SHORTAGE.                                         22820497
228206                                                                  22820697
228210*----- CHECK FOR QTY DIFFERENCES                                  22821097
228220     IF T-INVC-QTY (PO-IDX) = T-RECV-QTY (PO-IDX)                 22822097
228230         SET T-QTY-MATCH (PO-IDX)  TO TRUE                        22823097
228240     ELSE                                                         22824097
228250     IF T-INVC-QTY (PO-IDX) > T-RECV-QTY (PO-IDX)                 22825097
228260         SET T-QTY-SHORT (PO-IDX)  TO TRUE                        22826097
228270         SET QTY-SHORTAGE          TO TRUE                        22827097
228280     ELSE                                                         22828097
228290*----- FLAG WAS ALREADY SET TO 'OVER' WHEN RECEIVING LOADED       22829097
228291         CONTINUE                                                 22829197
228292     END-IF.                                                      22829297
228293                                                                  22829397
228300*--------------------------------------------------------------*  22830007
228400* PREPARES FIELDS TO BE INSERTED TO TNINREC                    *  22840007
228500*--------------------------------------------------------------*  22850007
228600 E200-CREATE-TNINREC.                                             22860000
228700                                                                  22870000
228800     INITIALIZE DCLTNINREC.                                       22880000
228900                                                                  22890000
229000     MOVE DK-PO-NBR                    TO NINREC-PO-NBR.          22900000
229100     MOVE T-APP-PO-LNE-NBR (PO-IDX)    TO NINREC-PO-LNE-NBR.      22910000
229200     MOVE POSTRR-STR-NBR               TO NINREC-STR-NBR.         22920070
229300     COMPUTE NINREC-NON-INVC-UNT-QTY =                            22930000
229400            T-RECV-QTY (PO-IDX) - T-INVC-QTY (PO-IDX).            22940000
229500     MOVE T-RECV-UNT-COST-AMT (PO-IDX) TO NINREC-UNT-COST-AMT.    22950000
229600     MOVE PC-NULL-TIMESTAMP            TO NINREC-PAYT-RLSE-TMST.  22960000
229700     MOVE ' '                          TO NINREC-STATUS-CDE.      22970000
229800     MOVE PC-NULL-DATE                 TO NINREC-PAYT-DTE.        22980000
229900     MOVE APCNTL-BTCH-PRC-DTE          TO PV-REC-TMST-DATE.       22990000
230000     MOVE '-22.00.00.000000'           TO PV-REC-TMST-TIME.       23000000
230100     MOVE PV-REC-TMST                  TO NINREC-REC-TMST.        23010000
230200     MOVE PV-WEIGHTED-DISC-PCT         TO NINREC-ORIG-DISC-PCT.   23020000
230300     MOVE PV-SAVE-DC-NBR               TO NINREC-DC-NBR           23030070
230400                                                                  23040000
230500     PERFORM U100-INSERT-TNINREC.                                 23050000
230600                                                                  23060007
230700*--------------------------------------------------------------*  23070007
230800* PROCESSES UNMATCHED INVOICE LINES, CREATING REMAINDER INVOICE*  23080007
230900* ITEMS FOR EACH UNMATCHED LINE.                               *  23090007
231000*--------------------------------------------------------------*  23100007
231100 E300-NULL-LNE-NBR-PROCESSING.                                    23110000
231200                                                                  23120000
231300     MOVE T-PAYT-REQ-SEQ-NBR (1000) TO DK-PAYT-REQ-SEQ-NBR.       23130000
231400                                                                  23140000
231500     PERFORM Y800-OPEN-NULL-LNE-NBR-CSR.                          23150000
231600                                                                  23160000
231700     SET ITEMS-LEFT-ON-DB TO TRUE.                                23170000
231800                                                                  23180000
231900     PERFORM                                                      23190000
232000         VARYING PV-READ-COUNT FROM 1 BY 1                        23200000
232100         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    23210000
232200            OR (NO-ITEMS-LEFT-ON-DB))                             23220000
232300                                                                  23230000
232400         PERFORM R800-FETCH-PREQIT-NULL                           23240000
232500                                                                  23250000
232600         IF  ITEMS-LEFT-ON-DB                                     23260000
232700             PERFORM F300-PROCESS-REMAINDER-INVOICE               23270000
232800         END-IF                                                   23280000
232900     END-PERFORM.                                                 23290000
233000                                                                  23300000
233100     PERFORM Y810-CLOSE-NULL-LNE-NBR-CSR.                         23310000
233200                                                                  23320007
233300*--------------------------------------------------------------*  23330007
233400* PREPARES FIELDS TO BE INSERTED INTO THE TPRCCLM TABLE AND    *  23340007
233500* ADJUSTS THE TOTAL DISCOUNT AMOUNT                            *  23350007
233600*--------------------------------------------------------------*  23360007
233700 E500-CREATE-PRCCLM.                                              23370000
233800                                                                  23380000
233900     INITIALIZE DCLTPRCCLM.                                       23390000
234000                                                                  23400000
234100     MOVE DK-PO-NBR                   TO PRCCLM-PO-NBR.           23410000
234200     MOVE POSTRR-STR-NBR              TO PRCCLM-STR-NBR.          23420070
234300     MOVE T-PR-INVC-ID     (PR-IDX)   TO PRCCLM-INVC-ID.          23430000
234400     MOVE T-PR-PO-LINE-NBR (PR-IDX)   TO PRCCLM-PO-LNE-NBR.       23440000
234500     MOVE T-PR-DOC-TYP-CDE (PR-IDX)   TO PRCCLM-DOC-TYP-CDE.      23450000
234600     MOVE T-PR-UNIT-QTY    (PR-IDX)   TO PRCCLM-UNT-QTY.          23460000
234700     MOVE T-PR-UNIT-COST   (PR-IDX)   TO PRCCLM-UNT-COST-AMT.     23470000
234800     MOVE T-PR-ADJ-COST    (PR-IDX)   TO PRCCLM-ADJ-COST-AMT.     23480000
234900     MOVE CURR-TIMESTAMP              TO PRCCLM-PAYT-RLSE-TMST.   23490000
235000                                                                  23500000
235100     PERFORM R950-GET-PRCCLM-SEQ-NBR.                             23510000
235200                                                                  23520000
235300     PERFORM U900-INSERT-TPRCCLM.                                 23530000
235400                                                                  23540000
235500**   PRICE CLAIMS SHOULD NOT BE CONSIDERED PART OF THE DISCOUNT   23550000
235600**   AMOUNT.  THEREFORE, SUBTRACT THE AMOUNT OF THE PRICE CLAIM   23560000
235700**   FROM THE TOTAL DISCOUNT IF THE PRICE CLAIM IS A DEBIT TO     23570000
235800**   PAYMENT HISTORY.  SIMILIAR LOGIC WILL OCCUR IN APKUP254,     23580033
235900**   CLASS DISTRIBUTION, FOR PURCHASE JOURNAL DEBITS.             23590000
236000                                                                  23600000
236100     IF PRCCLM-DOC-TYP-CDE    = 'DM'                              23610000
236200                                                                  23620000
236300         SUBTRACT PRCCLM-UNT-COST-AMT FROM PRCCLM-ADJ-COST-AMT    23630000
236400                  GIVING PV-PRCCLM-DIFFERENCE                     23640000
236500         IF PV-PRCCLM-DIFFERENCE < 0                              23650000
236600             COMPUTE PV-PRCCLM-DIFFERENCE                         23660000
236700                     = PV-PRCCLM-DIFFERENCE * -1                  23670000
236800         END-IF                                                   23680000
236900                                                                  23690000
237000         COMPUTE PV-DECIMAL-8 =                                   23700000
237100                 ((PV-PRCCLM-DIFFERENCE * PRCCLM-UNT-QTY)         23710000
237200                 * PV-WEIGHTED-DISC-PCT)                          23720000
237300         COMPUTE PV-TOTAL-DISCOUNT-AMT ROUNDED                    23730000
237400               = PV-TOTAL-DISCOUNT-AMT                            23740000
237500               - PV-DECIMAL-8                                     23750000
237600     END-IF.                                                      23760000
237700                                                                  23770007
237800*--------------------------------------------------------------*  23780007
237900* FIRST THE ABSOLUTE VALUE OF THE COST DIFFERENCE IS           *  23790007
238000* DETERMINED.  THEN THE PERCENTAGE FROM TAPCNTL IS APPLIED     *  23800007
238100* TO EACH UNIT COST.  IF THE ABSOLUTE VALUE OF THE COST        *  23810007
238200* DIFFERENCE IS GREATER THAN OR EQUAL TO THE COST PERCENT      *  23820007
238300* AMOUNT, THE PO/STORE CANNOT BE RECONCILED AUTOMATICALLY.     *  23830007
238400*--------------------------------------------------------------*  23840007
238500 F100-CHECK-COST-DIF-PCT.                                         23850000
238600                                                                  23860000
238700     IF T-RECV-UNT-COST-AMT (PO-IDX) > 0                          23870046
238800        SUBTRACT T-RECV-UNT-COST-AMT (PO-IDX)                     23880046
238900            FROM PV-UNT-COST-AMT                                  23890096
238910**          FROM T-INVC-UNT-COST-AMT (PO-IDX)                     23891096
239000          GIVING PV-UNT-COST-DIF                                  23900046
239100                                                                  23910000
239200        IF PV-UNT-COST-DIF < 0                                    23920046
239300           COMPUTE PV-UNT-COST-DIF = PV-UNT-COST-DIF * -1         23930046
239400        END-IF                                                    23940046
239500                                                                  23950000
239600        COMPUTE PV-DECIMAL-8                                      23960046
239700           = APCNTL-COST-CNTL-PCT                                 23970046
239800           / 100                                                  23980046
239900                                                                  23990000
240000        COMPUTE PV-COST-PCT-AMT ROUNDED                           24000046
240100           = T-RECV-UNT-COST-AMT (PO-IDX)                         24010046
240200           * PV-DECIMAL-8                                         24020047
240300                                                                  24030000
240400        IF PV-UNT-COST-DIF >= PV-COST-PCT-AMT                     24040046
240500           SET BYPASS-PO                                          24050046
240600               COST-DIF-OVER-LIMIT                                24060046
240700               ERRORS-FOUND                                       24070046
240800               NO-ITEMS-LEFT-ON-DB TO TRUE                        24080046
240900        END-IF                                                    24090046
241000                                                                  24100000
241100        COMPUTE PV-COST-PCT-AMT ROUNDED                           24110046
241200           = PV-UNT-COST-AMT                                      24120096
241210**         = T-INVC-UNT-COST-AMT (PO-IDX)                         24121096
241300           * PV-DECIMAL-8                                         24130046
241400                                                                  24140013
241500        IF PV-UNT-COST-DIF >= PV-COST-PCT-AMT                     24150046
241600           SET BYPASS-PO                                          24160046
241700               COST-DIF-OVER-LIMIT                                24170046
241800               ERRORS-FOUND                                       24180046
241900               NO-ITEMS-LEFT-ON-DB TO TRUE                        24190046
242000        END-IF                                                    24200046
242100     END-IF.                                                      24210046
242200                                                                  24220007
242300*--------------------------------------------------------------*  24230007
242400* LOADS THE INTERNAL PRICE CLAIM TABLE                         *  24240007
242410* INCREASED LIMIT TO 50000 MAY 2023.                           *  24241099
242500*--------------------------------------------------------------*  24250007
242600 F200-ADD-TO-TPRCCLM-TABLE.                                       24260000
242700                                                                  24270000
242800     IF PR-IDX > PV-PRCCLM-MAX                                    24280099
242900         SET BYPASS-PO                                            24290000
243000             TOO-MANY-PRCCLM                                      24300000
243100             ERRORS-FOUND                                         24310000
243200             NO-ITEMS-LEFT-ON-DB TO TRUE                          24320000
243300     ELSE                                                         24330000
243400                                                                  24340000
243500         MOVE IA-INVOICE-ID (IA-SUB) TO T-PR-INVC-ID    (PR-IDX)  24350000
243600         MOVE T-APP-PO-LNE-NBR (PO-IDX)                           24360000
243700                                    TO T-PR-PO-LINE-NBR (PR-IDX)  24370000
243800                                                                  24380000
243900*  COMPARE INVC QTY TO TOT QTY FOR PRICE CLAIMS.  IF INVC QTY IS  24390000
244000*  LESS, USE IT AS THE QTY TO CREATE THE PRICE CLAIM.  OTHERWISE, 24400000
244100*  USE TOT PRICE CLAIM QTY.  IF THE TOT PRICE CLAIM QTY IS MORE   24410000
244200*  THAN THE INVOICE QTY, SUBTRACT THE INVOICE QTY FROM THE PRICE  24420000
244300*  CLAIM QTY TO REFLECT QTY FOR WHICH THE PRICE CLAIM WAS CREATED.24430000
244400*  IF THE TOT PRICE CLAIM QTY IS THE SAME OR LESS THAN THE INVOICE24440000
244500*  QTY, THEN ALL THE PRICE CLAIM QTY HAS BEEN USED UP, SO SET IT  24450000
244600*  TO ZEROS.                                                      24460000
244700         IF PV-QTY  < T-PRCCLM-QTY (PO-IDX)                       24470000
244800             MOVE PV-QTY            TO T-PR-UNIT-QTY  (PR-IDX)    24480000
244900         ELSE                                                     24490000
245000             MOVE T-PRCCLM-QTY (PO-IDX)                           24500000
245100                                    TO T-PR-UNIT-QTY  (PR-IDX)    24510000
245200         END-IF                                                   24520000
245300         IF T-PRCCLM-QTY (PO-IDX) > PV-QTY                        24530000
245400             SUBTRACT PV-QTY    FROM T-PRCCLM-QTY   (PO-IDX)      24540000
245500         ELSE                                                     24550000
245600             MOVE ZEROS           TO T-PRCCLM-QTY   (PO-IDX)      24560000
245700         END-IF                                                   24570000
245800                                                                  24580000
245900         MOVE PV-UNT-COST-AMT     TO T-PR-UNIT-COST (PR-IDX)      24590000
246000         MOVE T-RECV-UNT-COST-AMT (PO-IDX)                        24600000
246100                                  TO T-PR-ADJ-COST  (PR-IDX)      24610000
246200                                                                  24620000
246300*----- USE LOWEST COST.  NOTE THAT SINCE THE LOWEST COST IS ALWAYS24630000
246400*----- USED, CREDIT PRICE CLAIMS (CM AND CP) WILL NOT BE CREATED  24640000
246500*----- IN AUTOMATIC RECONCILIATION.                               24650000
246600         IF T-RECV-UNT-COST-AMT (PO-IDX)                          24660000
246700                       < PV-UNT-COST-AMT                          24670096
246710**                     < T-INVC-UNT-COST-AMT (PO-IDX)             24671096
246800             MOVE 'DM'            TO T-PR-DOC-TYP-CDE (PR-IDX)    24680000
246900         ELSE                                                     24690000
247000             MOVE 'DP'            TO T-PR-DOC-TYP-CDE (PR-IDX)    24700000
247100         END-IF                                                   24710000
247200                                                                  24720000
247300         SET PR-IDX UP BY +1                                      24730000
247400     END-IF.                                                      24740000
247500                                                                  24750007
247600*--------------------------------------------------------------*  24760007
247700* IF A REMAINDER INVOICE HAS NOT YET BEEN CREATED FOR THE PO/  *  24770007
247800* STORE, REMAINDER INVOICE HEADER ROWS ARE CREATED AND THE     *  24780007
247900* ALCHRG TABLE IS UPDATED IF THERE IS A DISCOUNT ASSOCIATED.   *  24790007
248000* INVOICE ITEMS ARE THEN CREATED.                              *  24800007
248100*--------------------------------------------------------------*  24810007
248200 F300-PROCESS-REMAINDER-INVOICE.                                  24820000
248300                                                                  24830000
248400     IF RI-INVC-NOT-CREATED                                       24840000
248500         PERFORM G100-ADD-REM-INVC-HEADER                         24850000
248600                                                                  24860000
248700         IF PV-WEIGHTED-ADV-PCT > 0                               24870000
248800             MOVE INVOIC-PO-NBR        TO ALCHRG-PO-NBR           24880000
248900             MOVE INVOIC-INVC-ID       TO ALCHRG-INVC-ID          24890000
249000             ADD  +1                   TO ALCHRG-ALW-CHRG-SEQ-NBR 24900000
249100             MOVE 'A'                  TO ALCHRG-ALW-CHRG-TYP-CDE 24910000
249200             MOVE 'ADV'                TO ALCHRG-ALW-CHRG-CDE     24920000
249300             MOVE SPACES               TO ALCHRG-ALW-CHRG-SER-CDE 24930000
249400             MOVE PV-WEIGHTED-ADV-PCT  TO ALCHRG-ALW-CHRG-PCT     24940000
249500             MOVE +0                   TO ALCHRG-ALW-CHRG-AMT     24950000
249600             PERFORM U240-INSERT-TALCHRG                          24960000
249700         END-IF                                                   24970000
249800                                                                  24980000
249900         IF PV-WEIGHTED-COOP-PCT > 0                              24990000
250000             MOVE INVOIC-PO-NBR        TO ALCHRG-PO-NBR           25000000
250100             MOVE INVOIC-INVC-ID       TO ALCHRG-INVC-ID          25010000
250200             ADD  +1                   TO ALCHRG-ALW-CHRG-SEQ-NBR 25020000
250300             MOVE 'A'                  TO ALCHRG-ALW-CHRG-TYP-CDE 25030000
250400             MOVE 'COP'                TO ALCHRG-ALW-CHRG-CDE     25040000
250500             MOVE SPACES               TO ALCHRG-ALW-CHRG-SER-CDE 25050000
250600             MOVE PV-WEIGHTED-COOP-PCT TO ALCHRG-ALW-CHRG-PCT     25060000
250700             MOVE +0                   TO ALCHRG-ALW-CHRG-AMT     25070000
250800             PERFORM U240-INSERT-TALCHRG                          25080000
250900         END-IF                                                   25090000
251000                                                                  25100000
251100         IF PV-WEIGHTED-NSD-PCT > 0                               25110000
251200             MOVE INVOIC-PO-NBR        TO ALCHRG-PO-NBR           25120000
251300             MOVE INVOIC-INVC-ID       TO ALCHRG-INVC-ID          25130000
251400             ADD  +1                   TO ALCHRG-ALW-CHRG-SEQ-NBR 25140000
251500             MOVE 'A'                  TO ALCHRG-ALW-CHRG-TYP-CDE 25150000
251600             MOVE 'NSD'                TO ALCHRG-ALW-CHRG-CDE     25160000
251700             MOVE SPACES               TO ALCHRG-ALW-CHRG-SER-CDE 25170000
251800             MOVE PV-WEIGHTED-NSD-PCT  TO ALCHRG-ALW-CHRG-PCT     25180000
251900             MOVE +0                   TO ALCHRG-ALW-CHRG-AMT     25190000
252000             PERFORM U240-INSERT-TALCHRG                          25200000
252100         END-IF                                                   25210000
252200                                                                  25220000
252300         IF PV-WEIGHTED-MOS-PCT > 0                               25230000
252400             MOVE INVOIC-PO-NBR        TO ALCHRG-PO-NBR           25240000
252500             MOVE INVOIC-INVC-ID       TO ALCHRG-INVC-ID          25250000
252600             ADD  +1                   TO ALCHRG-ALW-CHRG-SEQ-NBR 25260000
252700             MOVE 'A'                  TO ALCHRG-ALW-CHRG-TYP-CDE 25270000
252800             MOVE 'MOS'                TO ALCHRG-ALW-CHRG-CDE     25280000
252900             MOVE SPACES               TO ALCHRG-ALW-CHRG-SER-CDE 25290000
253000             MOVE PV-WEIGHTED-MOS-PCT  TO ALCHRG-ALW-CHRG-PCT     25300000
253100             MOVE +0                   TO ALCHRG-ALW-CHRG-AMT     25310000
253200             PERFORM U240-INSERT-TALCHRG                          25320000
253300         END-IF                                                   25330000
253400                                                                  25340000
253500         IF PV-WEIGHTED-TRD-PCT > 0                               25350000
253600             MOVE INVOIC-PO-NBR        TO ALCHRG-PO-NBR           25360000
253700             MOVE INVOIC-INVC-ID       TO ALCHRG-INVC-ID          25370000
253800             ADD  +1                   TO ALCHRG-ALW-CHRG-SEQ-NBR 25380000
253900             MOVE 'A'                  TO ALCHRG-ALW-CHRG-TYP-CDE 25390000
254000             MOVE 'TRD'                TO ALCHRG-ALW-CHRG-CDE     25400000
254100             MOVE SPACES               TO ALCHRG-ALW-CHRG-SER-CDE 25410000
254200             MOVE PV-WEIGHTED-TRD-PCT  TO ALCHRG-ALW-CHRG-PCT     25420000
254300             MOVE +0                   TO ALCHRG-ALW-CHRG-AMT     25430000
254400             PERFORM U240-INSERT-TALCHRG                          25440000
254500         END-IF                                                   25450000
254600                                                                  25460000
254700         IF PV-WEIGHTED-MSC-PCT > 0                               25470000
254800             MOVE INVOIC-PO-NBR        TO ALCHRG-PO-NBR           25480000
254900             MOVE INVOIC-INVC-ID       TO ALCHRG-INVC-ID          25490000
255000             ADD  +1                   TO ALCHRG-ALW-CHRG-SEQ-NBR 25500000
255100             MOVE 'A'                  TO ALCHRG-ALW-CHRG-TYP-CDE 25510000
255200             MOVE 'DAS'                TO ALCHRG-ALW-CHRG-CDE     25520000
255300             MOVE SPACES               TO ALCHRG-ALW-CHRG-SER-CDE 25530000
255400             MOVE PV-WEIGHTED-MSC-PCT  TO ALCHRG-ALW-CHRG-PCT     25540000
255500             MOVE +0                   TO ALCHRG-ALW-CHRG-AMT     25550000
255600             PERFORM U240-INSERT-TALCHRG                          25560000
255700         END-IF                                                   25570000
255800                                                                  25580000
255900         IF PV-WEIGHTED-ALW-PCT > 0                               25590000
256000             MOVE INVOIC-PO-NBR        TO ALCHRG-PO-NBR           25600000
256100             MOVE INVOIC-INVC-ID       TO ALCHRG-INVC-ID          25610000
256200             ADD  +1                   TO ALCHRG-ALW-CHRG-SEQ-NBR 25620000
256300             MOVE 'A'                  TO ALCHRG-ALW-CHRG-TYP-CDE 25630000
256400             MOVE 'ALW'                TO ALCHRG-ALW-CHRG-CDE     25640000
256500             MOVE SPACES               TO ALCHRG-ALW-CHRG-SER-CDE 25650000
256600             MOVE PV-WEIGHTED-ALW-PCT  TO ALCHRG-ALW-CHRG-PCT     25660000
256700             MOVE +0                   TO ALCHRG-ALW-CHRG-AMT     25670000
256800             PERFORM U240-INSERT-TALCHRG                          25680000
256900         END-IF                                                   25690000
257000                                                                  25700000
257100         SET RI-INVC-CREATED TO TRUE                              25710000
257200         MOVE +0 TO PV-REMAINDER-INVC-QTY                         25720000
257300                    PV-REMAINDER-TOT-COST                         25730000
257400     END-IF.                                                      25740000
257500                                                                  25750000
257600                                                                  25760000
257700*    FOR THE REMAINDER INVOICE, USE THE DIFFERENCE BETWEEN THE    25770000
257800*    INVOICE QTY AND THE RECEIVED QTY STORED ON THE INTERNAL TBL. 25780000
257900*    THE NULL PO LINE (PO-IDX = +1000) USES THE VALUES FOUND ON   25790000
258000*    THE TPREQIT TABLE ITSELF.                                    25800000
258100                                                                  25810000
258110     COMPUTE PV-RI-ITEM-QTY-MAX =                                 25811091
258120         T-INVC-QTY(PO-IDX) - T-RECV-QTY(PO-IDX).                 25812091
258130                                                                  25813091
258200*    IF PO-IDX < +1000                                            25820091
258300*        SUBTRACT T-RECV-QTY (PO-IDX) FROM T-INVC-QTY (PO-IDX)    25830091
258400*            GIVING PREQIT-PAY-REQ-LNE-QTY                        25840091
258500*        MOVE T-INVC-UNT-COST-AMT (PO-IDX) TO PREQIT-UNT-COST-AMT 25850091
258600*        PERFORM G200-CREATE-RI-ITEM                              25860091
258700*                                                                 25870091
258800*    ELSE                                                         25880091
258900*        PERFORM G200-CREATE-RI-ITEM                              25890091
259000*    END-IF.                                                      25900091
259001                                                                  25900191
259010     IF PO-IDX = +1000                                            25901091
259020         PERFORM G200-CREATE-RI-ITEM                              25902091
259070     ELSE                                                         25907091
259080         IF T-MULT-INVC-SW(PO-IDX) = 'Y'                          25908091
259081            MOVE T-KEY-PO-LNE-NBR(PO-IDX) TO PV-PO-LNE-NBR        25908191
259082            SET MORE-INVC-ITEMS TO TRUE                           25908291
259083            PERFORM Y900-OPEN-INVC-ITEM-CSR                       25908391
259084            PERFORM R920-FETCH-INVC-ITEM                          25908491
259085            PERFORM F400-PROCESS-MULTI-UCOST-ITEMS                25908591
259086                    UNTIL PV-RI-ITEM-QTY-MAX <= 0                 25908691
259087                       OR NO-MORE-INVC-ITEMS                      25908791
259088            PERFORM Y910-CLOSE-INVC-ITEM-CSR                      25908891
259089         ELSE                                                     25908991
259090            PERFORM F500-PROCESS-SINGLE-UCOST-ITEM                25909091
259091         END-IF                                                   25909191
259092     END-IF.                                                      25909291
259100                                                                  25910007
259110*----------------------------------------------------------------*25911091
259120*    - IF THE INVOICE AND RECEIVER COSTS ARE THE SAME AND THE    *25912091
259130*      TOTAL INVOICE QTY IS MORE THAN THE REMAINING REMAINDER    *25913091
259140*      INVOICE QTY, USE THE REMAINING REMAINDER INVOICE QTY TO   *25914091
259150*      CREATE THE REMAINDER INVOICE AND SET THE REAMINING        *25915091
259160*      REMAINDER INVOICE QTY TO ZERO.                            *25916091
259170*    - IF THE INVOICE AND RECEIVER COSTS ARE THE SAME AND THE    *25917091
259180*      TOTAL INVOICE QTY IS THE SAME AS OR LESS THAN THE         *25918091
259190*      REMAINING REMAINDER INVOICE QTY, USE THE TOTAL INVOICE    *25919091
259191*      QTY TO CREATE THE REMAINDER INVOICE AND DECREMENT THE     *25919191
259192*      REMAINING REMAINDER INVOICE QTY BY THE TOTAL INVOICE QTY. *25919291
259193*    - IF THE INVOICE AND RECEIVER COSTS ARE NOT THE SAME,       *25919391
259194*      THEN WE NEED TO SEE IF ANY OF THE INVOICE QTY AT THIS     *25919491
259195*      COST HAS BEEN USED FOR PRICE CLAIMS.  THE TOTAL PRICE     *25919591
259196*      CLAIM QTY IS CALCULATED IN F400.  IF THE TOTAL INVOICE    *25919691
259197*      QTY IS MORE THAN THE CALCULATED TOTAL PRICE CLAIM QTY,    *25919791
259198*      THEN SUBTRACT THE CALCULATED TOTAL PRICE CLAIM QTY FROM   *25919891
259199*      THE TOTAL INVOICE QTY TO GET THE QTY TO USE FOR THE       *25919991
259200*      REMAINDER INVOICE.  THEN:                                 *25920091
259201*      . IF THE REMAINDER INVOICE QTY TO BE USED IS MORE THAN    *25920191
259202*        THE REMAINING REMAINDER INVOICE QTY, USE THE REMAINING  *25920291
259203*        THE REMAINDER INVOICE QTY INSTEAD AND SET THE REMAINING *25920391
259204*        REMAINDER INVOICE QTY TO ZERO.                          *25920491
259205*      . IF THE REMAINDER INVOICE QTY TO BE USED IS THE SAME AS  *25920591
259206*        OR MORE THAN THE REMAINING REMAINDER INVOICE QTY,       *25920691
259207*        DECREMENT THE REMAINING REMAINDER INVOICE QTY BY THE    *25920791
259208*        REMAINDER INVOICE QTY TO BE USED.                       *25920891
259209*----------------------------------------------------------------*25920991
259210 F400-PROCESS-MULTI-UCOST-ITEMS.                                  25921091
259212                                                                  25921291
259213     IF PREQIT-UNT-COST-AMT = T-RECV-UNT-COST-AMT(PO-IDX)         25921391
259214         IF PV-INVC-SUM-QTY > PV-RI-ITEM-QTY-MAX                  25921491
259215             MOVE PV-RI-ITEM-QTY-MAX TO PREQIT-PAY-REQ-LNE-QTY    25921591
259216             MOVE ZERO               TO PV-RI-ITEM-QTY-MAX        25921691
259217         ELSE                                                     25921791
259218             MOVE PV-INVC-SUM-QTY    TO PREQIT-PAY-REQ-LNE-QTY    25921891
259219             SUBTRACT PREQIT-PAY-REQ-LNE-QTY                      25921991
259220                                   FROM PV-RI-ITEM-QTY-MAX        25922091
259221         END-IF                                                   25922191
259222         PERFORM G200-CREATE-RI-ITEM                              25922291
259223     ELSE                                                         25922391
259224         MOVE ZERO                   TO PV-PRCCLM-QTY-SUMMED      25922491
259225         SET AMT-NOT-SUMMED          TO TRUE                      25922591
259226         PERFORM F600-SUM-PRCCLM-AMT                              25922691
259227             VARYING PR-IDX FROM 1 BY 1                           25922791
259228               UNTIL AMT-SUMMED                                   25922891
259229                  OR PR-IDX > PV-PRCCLM-MAX                       25922999
259230         IF PV-INVC-SUM-QTY > PV-PRCCLM-QTY-SUMMED                25923091
259231             SUBTRACT PV-PRCCLM-QTY-SUMMED FROM PV-INVC-SUM-QTY   25923191
259232                 GIVING PREQIT-PAY-REQ-LNE-QTY                    25923291
259233             IF PREQIT-PAY-REQ-LNE-QTY > PV-RI-ITEM-QTY-MAX       25923391
259234                 MOVE PV-RI-ITEM-QTY-MAX                          25923491
259235                       TO PREQIT-PAY-REQ-LNE-QTY                  25923591
259236                 MOVE ZERO           TO PV-RI-ITEM-QTY-MAX        25923691
259237             ELSE                                                 25923791
259238                 SUBTRACT PREQIT-PAY-REQ-LNE-QTY                  25923891
259239                                   FROM PV-RI-ITEM-QTY-MAX        25923991
259240             END-IF                                               25924091
259241             PERFORM G200-CREATE-RI-ITEM                          25924191
259242         ELSE                                                     25924291
259243             CONTINUE                                             25924391
259244         END-IF                                                   25924491
259245     END-IF.                                                      25924591
259246                                                                  25924691
259247     PERFORM R920-FETCH-INVC-ITEM.                                25924791
259248/                                                                 25924891
259249*----------------------------------------------------------------*25924991
259250*    FOR INVOICES THAT HAVE A SINGLE UNIT COST, THERE IS NO NEED *25925091
259251*    TO CHECK THE INVOICE DB2 TABLES BECAUSE THE SINGLE UNIT     *25925191
259252*    COST IS STORED ON THE INTERNAL TABLE.  ALSO, THERE IS NO    *25925291
259253*    NEED TO CHECK THE PRICE CLAIMS CREATED BECAUSE PRICE        *25925391
259254*    CALIMS WOULD ONLY HAVE BEEN CREATED FOR THE RECEIVED QTY    *25925491
259255*    WHICH IS NOT PART OF THE QTY FOR WHICH THE REMAINDER        *25925591
259256*    INVOICE IS CREATED.                                         *25925691
259257*    TO CREATE THE REMAINDER INVOICE, USE THE DIFFERENCE BETWEEN *25925791
259258*    THE INVOICE QTY AND THE RECEIVED QTY STORED ON THE INTERNAL *25925891
259259*    TABLE.                                                      *25925991
259260*----------------------------------------------------------------*25926091
259261 F500-PROCESS-SINGLE-UCOST-ITEM.                                  25926191
259263                                                                  25926391
259264     SUBTRACT T-RECV-QTY(PO-IDX) FROM T-INVC-QTY(PO-IDX)          25926491
259265         GIVING PREQIT-PAY-REQ-LNE-QTY.                           25926591
259266                                                                  25926691
259267     MOVE T-INVC-UNT-COST-AMT(PO-IDX) TO PREQIT-UNT-COST-AMT.     25926791
259268                                                                  25926891
259269     PERFORM G200-CREATE-RI-ITEM.                                 25926991
259270/                                                                 25927091
259271*----------------------------------------------------------------*25927191
259272*    TOTALS THE PRICE CLAIM QTY FOR A SPECIFIC INVOICE/PO LINE   *25927291
259273*    COMBINATION AS FOLLOWS:                                     *25927391
259274*    IF THE DOC TYPE IN THE TABLE IS SPACES, WE HAVE REACHED     *25927491
259275*    THE END OF THE PRICE CLAIM ENTRIES AND ARE DONE TOTALLING.  *25927591
259276*    OTHERWISE, IF THE PRICE CLAIM PO LINE NUMBER MATCHES THE    *25927691
259277*    APPROVED PO LINE NUMBER AND THE PRICE CLAIM UNIT COST IS    *25927791
259278*    THE SAME AS THE INVOICE UNIT COST, ADD THE PRICE CLAIM QTY  *25927891
259279*    TO THE TOTAL PRICE CLAIM QTY.                               *25927991
259280*----------------------------------------------------------------*25928091
259281 F600-SUM-PRCCLM-AMT.                                             25928191
259283                                                                  25928391
259284     IF T-PR-DOC-TYP-CDE(PR-IDX) = SPACES                         25928491
259285         SET AMT-SUMMED TO TRUE                                   25928591
259286     ELSE                                                         25928691
259287         IF T-PR-PO-LINE-NBR(PR-IDX) = T-APP-PO-LNE-NBR(PO-IDX)   25928791
259288         AND T-PR-UNIT-COST(PR-IDX)  = PREQIT-UNT-COST-AMT        25928891
259289             COMPUTE PV-PRCCLM-QTY-SUMMED =                       25928991
259290                 PV-PRCCLM-QTY-SUMMED +                           25929091
259291                 T-PR-UNIT-QTY(PR-IDX)                            25929191
259292         END-IF                                                   25929291
259293     END-IF.                                                      25929391
259294                                                                  25929491
259295/                                                                 25929591
259296*--------------------------------------------------------------*  25929607
259300* REMAINDER INVOICE HEADER ROWS ARE PREPARED AND ADDED TO      *  25930007
259400* TINVOIC, TMDINVC, AND TINVCTM.                               *  25940058
259500*--------------------------------------------------------------*  25950007
259600 G100-ADD-REM-INVC-HEADER.                                        25960000
259700                                                                  25970000
259800     INITIALIZE DCLTINVOIC.                                       25980061
259900*    PERFORM G150-GET-CURRENT-TIMESTAMP.                          25990099
260000                                                                  26000058
260100     MOVE DK-PO-NBR               TO INVOIC-PO-NBR.               26010000
260200*    MOVE INVOIC-PAYT-REQ-SEQ-NBR TO PV-PAYT-REQ-SEQ-NBR-9.       26020099
260300*    MOVE PV-PAYT-REQ-SEQ-NBR-X   TO INVOIC-INVC-ID.              26030099
260400     MOVE 'RI'                    TO INVOIC-INVC-TYP-CDE.         26040000
260500     MOVE 'MN'                    TO INVOIC-ENTR-MTHD-CDE.        26050000
260600     MOVE PV-PROGRAM-NAME         TO INVOIC-CRE-BY-USR-ID.        26060000
260700     MOVE 'N'                     TO INVOIC-SPLIT-TERMS-IND       26070000
260800     MOVE 'Y'                     TO INVOIC-DTL-ENTR-IND.         26080000
260900     MOVE 0                       TO INVOIC-INVC-CART-CT.         26090000
261000     MOVE CURR-DATE               TO INVOIC-CRE-DTE.              26100000
261100     MOVE SPACE                   TO INVOIC-PPD-RVRSL-IND.        26110000
261200     MOVE PV-REMAINDER-INVC-DTE   TO INVOIC-INVC-DTE.             26120000
261300     MOVE EXTENT-DUN-NBR          TO INVOIC-RMIT-VND-ID.          26130000
261400     MOVE POSTRR-STR-NBR          TO INVOIC-STR-NBR.              26140070
261500     MOVE PV-SAVE-DC-NBR          TO INVOIC-DC-NBR.               26150070
261600     MOVE DK-MTCH-LVL-CDE         TO INVOIC-MTCH-LVL-CDE.         26160000
261700     MOVE PV-HOLD-IND             TO INVOIC-HOLD-IND.             26170000
261800     MOVE SPACE                   TO INVOIC-DUE-DTE-SRC-CDE.      26180000
261900     MOVE '0001-01-01'            TO INVOIC-CALC-DUE-DTE.         26190000
262000     MOVE PC-NULL-DATE            TO INVOIC-PAYT-DTE.             26200000
262100     MOVE '9999-09-09'            TO INVOIC-AP-PRC-DTE.           26210000
262200     MOVE SPACE                   TO INVOIC-AP-PRC-CDE.           26220000
262300     MOVE PC-NULL-TIMESTAMP       TO INVOIC-PAYT-RLSE-TMST.       26230000
262400     MOVE 'EN'                    TO INVOIC-STATUS-CDE.           26240000
262500     PERFORM U210-INSERT-TINVOIC.                                 26250000
262600                                                                  26260000
262700     INITIALIZE DCLTMDINVC.                                       26270000
262800     MOVE DK-PO-NBR               TO MDINVC-PO-NBR.               26280000
262900     MOVE PV-PAYT-REQ-SEQ-NBR-X   TO MDINVC-INVC-ID.              26290000
263000     MOVE +1                      TO MDINVC-VEND-FRGT-PCT.        26300000
263100     MOVE 'I'                     TO MDINVC-TERM-SEL-CDE.         26310000
263200     MOVE SPACES                  TO MDINVC-IMPRT-CHRG-PRC-CDE.   26320000
263300     MOVE INVOIC-PAYT-REQ-SEQ-NBR TO MDINVC-PAYT-REQ-SEQ-NBR.     26330058
263400     PERFORM U220-INSERT-TMDINVC.                                 26340000
263500                                                                  26350000
263600     INITIALIZE DCLTINVCTM                                        26360000
263700                DCLTPOAGMT                                        26370000
263800                DCLTPAYTRM.                                       26380000
263900     PERFORM R900-GET-PO-TERMS-DATA.                              26390000
264000                                                                  26400000
264100     MOVE DK-PO-NBR                TO INVCTM-PO-NBR.              26410000
264200     MOVE PV-PAYT-REQ-SEQ-NBR-X    TO INVCTM-INVC-ID.             26420000
264300     MOVE +1                       TO INVCTM-TERM-SEQ-NBR.        26430000
264400     IF PAYTRM-DUE-DAY-FR-DTE-TXT = 'EOM'                         26440000
264500         MOVE '02'                 TO INVCTM-TERM-TYP-CDE         26450000
264600     ELSE                                                         26460000
264700         MOVE '01'                 TO INVCTM-TERM-TYP-CDE         26470000
264800     END-IF.                                                      26480000
264900     MOVE '03'                     TO INVCTM-TERM-BASIS-DTE-CDE.  26490000
265000     MOVE '9999-09-09'             TO INVCTM-EFF-DTE.             26500000
265100     MOVE '9999-09-09'             TO INVCTM-DISC-DUE-DTE.        26510000
265200     MOVE '9999-09-09'             TO INVCTM-NET-DUE-DTE.         26520000
265300     MOVE PV-WEIGHTED-DISC-PCT     TO INVCTM-DISC-PCT.            26530000
265400     IF PAYTRM-DISCOUNT-DAYS-QTY > 0                              26540000
265500         MOVE PAYTRM-DISCOUNT-DAYS-QTY TO INVCTM-DISC-DUE-DAY-QTY 26550000
265600         MOVE 0                        TO INVCTM-NET-DUE-DAY-QTY  26560000
265700     ELSE                                                         26570000
265800         MOVE PAYTRM-DISCOUNT-DAYS-QTY TO INVCTM-DISC-DUE-DAY-QTY 26580000
265900         MOVE PAYTRM-DUE-DAY-QTY       TO INVCTM-NET-DUE-DAY-QTY  26590000
266000     END-IF.                                                      26600000
266100     MOVE POAGMT-DISC-PAY-DAY-QTY  TO INVCTM-EXTD-DAYS-QTY.       26610000
266200     PERFORM U230-INSERT-TINVCTM.                                 26620000
266300                                                                  26630007
266400*--------------------------------------------------------------*  26640058
266500* GET THE CURRENT DATE/TIME                                    *  26650058
266600*--------------------------------------------------------------*  26660058
266700 G150-GET-CURRENT-TIMESTAMP.                                      26670058
266800                                                                  26680058
266900     MOVE 'G150-GET-CURRENT-TIMESTAMP' TO PV-CURRENT-PARAGRAPH.   26690074
267000                                                                  26700074
267100     PERFORM WITH TEST AFTER                                      26710074
267200             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 26720074
267300             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         26730074
267400                     SQLCODE = ZERO                               26740074
267500                                                                  26750074
267600             EXEC SQL                                             26760074
267700                  SET :KEY-TIMESTAMP = CURRENT TIMESTAMP          26770074
267800             END-EXEC                                             26780074
267900                                                                  26790058
268000             EVALUATE TRUE                                        26800074
268100               WHEN SQLCODE = ZERO                                26810077
268200               WHEN SQLCODE = -904                                26820077
268300               WHEN SQLCODE = -913                                26830077
268400                 CONTINUE                                         26840077
268600               WHEN SQLWARN0 NOT = SPACES                         26860077
268700               WHEN SQLCODE  NOT = ZERO                           26870077
268800                 MOVE PV-CURRENT-PARAGRAPH TO AA-PARAGRAPH-NAME   26880077
269000                 MOVE 'UNSUCCESSFUL SET TIMESTAMP'                26900077
269100                                           TO AA-DB2-OPERATION    26910077
269200                 MOVE '       '            TO AA-DB2-TABLE-1      26920077
269300                 PERFORM Z998-DB2-ABEND                           26930077
269400             END-EVALUATE                                         26940074
269500     END-PERFORM.                                                 26950074
269600                                                                  26960074
269700     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         26970074
269800        MOVE PV-CURRENT-PARAGRAPH  TO AA-PARAGRAPH-NAME           26980077
270000        MOVE 'MAX RETRIES EXCEEDED ON SET TIMESTAMP'              27000077
270100                                   TO AA-DB2-OPERATION            27010077
270200        PERFORM Z998-DB2-ABEND                                    27020077
270300     END-IF.                                                      27030074
270400                                                                  27040074
270500     EVALUATE TRUE                                                27050074
270600       WHEN SQLCODE = ZEROS                                       27060077
270700         MOVE KEY-NANOSEC-2     TO PV-RANDOM-KEY-NANOSEC-1        27070074
270800         MOVE KEY-NANOSEC-1     TO PV-RANDOM-KEY-NANOSEC-2        27080074
270900         MOVE KEY-MINUTE        TO PV-RANDOM-KEY-MINUTE           27090074
271000         MOVE KEY-SECOND        TO PV-RANDOM-KEY-SECOND           27100074
271100         MOVE PV-RANDOM-KEY     TO PV-RANDOM-KEY-INT              27110074
271200         MOVE PV-RANDOM-KEY-INT TO INVOIC-PAYT-REQ-SEQ-NBR        27120074
271300                                                                  27130074
271400       WHEN SQLCODE NOT = ZEROS                                   27140077
271500         MOVE PV-CURRENT-PARAGRAPH         TO AA-PARAGRAPH-NAME   27150077
271700         MOVE 'UNSUCCESSFUL SET TIMESTAMP' TO AA-DB2-OPERATION    27170077
271900         MOVE '        '                   TO AA-DB2-TABLE-1      27190077
272000         PERFORM Z998-DB2-ABEND                                   27200077
272100     END-EVALUATE.                                                27210074
272110                                                                  27211077
272200*--------------------------------------------------------------*  27220074
272300* REMAINDER INVOICE ITEM ROWS ARE PREPARED AND ADDED TO        *  27230074
272400* TPREQIT AND TMIITEM AND THE GORSS COST IS ACCUMULATED.       *  27240074
272500*--------------------------------------------------------------*  27250074
272600 G200-CREATE-RI-ITEM.                                             27260074
272700                                                                  27270074
272800     MOVE INVOIC-PAYT-REQ-SEQ-NBR  TO PREQIT-PAYT-REQ-SEQ-NBR.    27280074
272900     MOVE 'EA'                     TO PREQIT-QTY-UNT-OF-MSMT.     27290074
273000     PERFORM U300-INSERT-TPREQIT.                                 27300074
273100                                                                  27310074
273200     INITIALIZE DCLTMIITEM.                                       27320074
273300     MOVE INVOIC-PAYT-REQ-SEQ-NBR  TO MIITEM-PAYT-REQ-SEQ-NBR.    27330074
273400     MOVE PREQIT-PAYT-REQ-LNE-NBR  TO MIITEM-PAYT-REQ-LNE-NBR.    27340074
273500     MOVE 'I'                      TO MIITEM-UNT-COST-SEL-CDE.    27350074
273600     MOVE DK-PO-NBR                TO MIITEM-PO-NBR.              27360074
273700     MOVE T-KEY-PO-LNE-NBR(PO-IDX) TO MIITEM-PO-LNE-NBR.          27370074
273800     IF T-KEY-PO-LNE-NBR(PO-IDX) = +0                             27380074
273900         MOVE -1                   TO MIITEM-PO-LNE-NBR-NN        27390074
274000     ELSE                                                         27400074
274100         MOVE +1                   TO MIITEM-PO-LNE-NBR-NN        27410074
274200     END-IF                                                       27420074
274300     MOVE -1                       TO MIITEM-VER-NBR-NN.          27430074
274400     PERFORM U400-INSERT-TMIITEM.                                 27440074
274500                                                                  27450074
274600     ADD PREQIT-PAY-REQ-LNE-QTY TO PV-REMAINDER-INVC-QTY.         27460074
274700     COMPUTE PV-REMAINDER-TOT-COST ROUNDED                        27470074
274800       = PV-REMAINDER-TOT-COST                                    27480074
274900       + (PREQIT-PAY-REQ-LNE-QTY * PREQIT-UNT-COST-AMT).          27490074
275000                                                                  27500074
275100*--------------------------------------------------------------*  27510074
275200* RETRIEVES ALL VENDORS SPECIFIED TO BE EXCLUDED FROM THE      *  27520074
275300* AUTOMATIC RECONCILIATION PROCESS.                            *  27530074
275400* --  A NOT FOUND CONDITION RESULTS IN THE OUT OF VENDORS      *  27540074
275500*     SWITCH BEING SET.                                        *  27550074
275600*--------------------------------------------------------------*  27560074
275700 R100-FETCH-EXCL-VENDORS.                                         27570074
275800                                                                  27580074
275900     MOVE 'R100-FETCH-EXCL-VENDORS' TO PV-CURRENT-PARAGRAPH.      27590074
276000                                                                  27600074
276100     EXEC SQL                                                     27610074
276200         FETCH EXCL_VENDOR_CSR                                    27620074
276300         INTO :VNDAGR-ENT-ID                                      27630074
276400             ,:VNDAGR-DEPT-NBR                                    27640074
276500     END-EXEC.                                                    27650074
276600                                                                  27660074
276700     EVALUATE TRUE                                                27670074
276800         WHEN SQLCODE = ZERO                                      27680074
276900           IF EV-IDX > EV-IDX-MAX                                 27690074
277000               MOVE 'R100-FETCH-EXCL-VENDORS'                     27700074
277100                                      TO AA-PARAGRAPH-NAME        27710074
277200               MOVE 'EXCLUDED VENDOR TABLE OVERFLOW'              27720074
277300                    TO AA-MESSAGE                                 27730074
277400               SET AC-TABLE-OVERFLOW TO TRUE                      27740074
277500               PERFORM Z999-ABEND                                 27750074
277600           END-IF                                                 27760074
277700           MOVE VNDAGR-ENT-ID   TO T-EV-ENT-ID (EV-IDX)           27770074
277800           MOVE VNDAGR-DEPT-NBR TO T-EV-DEPT-NBR (EV-IDX)         27780074
277900           SET EV-IDX UP BY 1                                     27790074
278000                                                                  27800074
278100         WHEN SQLCODE = +100                                      27810074
278200             SET OUT-OF-VENDORS TO TRUE                           27820074
278300                                                                  27830074
278400         WHEN SQLWARN0 NOT = SPACES                               27840074
278500         WHEN SQLCODE  NOT = ZERO                                 27850074
278600             MOVE PV-CURRENT-PARAGRAPH                            27860074
278700                                 TO AA-PARAGRAPH-NAME             27870074
278800             MOVE 'UNSUCCESSFUL FETCH WITH VNDAGR_CSR'            27880074
278900                                 TO AA-DB2-OPERATION              27890074
279000             MOVE 'TVNDAGR'      TO AA-DB2-TABLE-1                27900074
279100             PERFORM Z998-DB2-ABEND                               27910074
279200     END-EVALUATE.                                                27920074
279300                                                                  27930074
279400*--------------------------------------------------------------*  27940074
279500* RETRIEVES THE COST CONTROL PERCENT AND PROCESS DATE          *  27950074
279600*--------------------------------------------------------------*  27960074
279700 R110-SELECT-CNTL-DATA.                                           27970074
279800                                                                  27980074
279900     MOVE 'R110-SELECT-CNTL-DATA' TO PV-CURRENT-PARAGRAPH.        27990074
280000                                                                  28000074
280100     EXEC SQL                                                     28010074
280200         SELECT COST_CNTL_PCT                                     28020074
280300               ,BTCH_PRC_DTE                                      28030074
280400         INTO  :APCNTL-COST-CNTL-PCT                              28040074
280500              ,:APCNTL-BTCH-PRC-DTE                               28050074
280600         FROM TAPCNTL                                             28060074
280700     END-EXEC.                                                    28070074
280800                                                                  28080074
280900     EVALUATE TRUE                                                28090074
281000         WHEN SQLCODE = ZERO                                      28100074
281100             CONTINUE                                             28110074
281200                                                                  28120074
281300         WHEN SQLWARN0 NOT = SPACES                               28130074
281400         WHEN SQLCODE  NOT = ZERO                                 28140074
281500             MOVE PV-CURRENT-PARAGRAPH                            28150074
281600                                 TO AA-PARAGRAPH-NAME             28160074
281700             MOVE 'UNSUCCESSFUL SELECT ON TAPCNTL'                28170074
281800                                 TO AA-DB2-OPERATION              28180074
281900             MOVE 'TAPCNTL'      TO AA-DB2-TABLE-1                28190074
282000             PERFORM Z998-DB2-ABEND                               28200074
282100     END-EVALUATE.                                                28210074
282200                                                                  28220074
282300*--------------------------------------------------------------*  28230074
282400* RETRIEVES THE PO/STORES TO BE PROCESSED                      *  28240074
282500* --  A NOT FOUND CONDITION RESULTS IN THE OUT OF POS          *  28250074
282600*     SWITCH BEING SET                                         *  28260074
282700*--------------------------------------------------------------*  28270074
282800 R200-FETCH-POSTRR.                                               28280074
282900                                                                  28290074
283000     MOVE 'R200-FETCH-POSTRR' TO PV-CURRENT-PARAGRAPH.            28300074
283100                                                                  28310074
283200     EXEC SQL                                                     28320074
283300         FETCH POSTRR_CSR                                         28330074
283400         INTO :POSTRR-PO-NBR                                      28340074
283500             ,:POSTRR-STR-NBR                                     28350074
283600             ,:POSTRR-MTCH-LVL-CDE                                28360074
283700     END-EXEC.                                                    28370074
283800                                                                  28380074
283900     EVALUATE TRUE                                                28390074
284000         WHEN SQLCODE = ZERO                                      28400074
284100              ADD 1 TO PV-PO-COUNT                                28410074
284200                                                                  28420074
284300         WHEN SQLCODE = +100                                      28430074
284400              SET OUT-OF-POS TO TRUE                              28440074
284500                                                                  28450074
284600         WHEN SQLWARN0 NOT = SPACES                               28460074
284700         WHEN SQLCODE  NOT = ZERO                                 28470074
284800             MOVE PV-CURRENT-PARAGRAPH                            28480074
284900                                 TO AA-PARAGRAPH-NAME             28490074
285000             MOVE 'UNSUCCESSFUL FETCH WITH POSTRR_CSR'            28500074
285100                                 TO AA-DB2-OPERATION              28510074
285200             MOVE 'TPOSTRR'      TO AA-DB2-TABLE-1                28520074
285300             PERFORM Z998-DB2-ABEND                               28530074
285400     END-EVALUATE.                                                28540074
285500                                                                  28550074
285600*--------------------------------------------------------------*  28560074
285700* RETRIEVES THE VENDOR, DEPT AND PO TYPE FOR THE PO IN PROCESS *  28570099
285800* --  A NOT FOUND CONDITION RESULTS IN AN ABEND SINCE A ROW    *  28580074
285900*     MUST EXIST ON TPURCHS IN ORDER FOR A PO TO BE FED        *  28590074
286000*     INTO AUTOMATIC RECONCILIATION                            *  28600074
286100*--------------------------------------------------------------*  28610074
286200 R210-SELECT-VENDOR.                                              28620074
286300                                                                  28630074
286400     MOVE 'R210-SELECT-VENDOR' TO PV-CURRENT-PARAGRAPH.           28640074
286500                                                                  28650074
286600     EXEC SQL                                                     28660074
286700         SELECT ENT_ID                                            28670074
286800               ,DEPT_NBR                                          28680074
286810               ,PO_TYP_CDE                                        28681099
286900         INTO  :PURCHS-ENT-ID                                     28690074
287000              ,:PURCHS-DEPT-NBR                                   28700074
287010              ,:PURCHS-PO-TYP-CDE                                 28701099
287100         FROM TPURCHS                                             28710074
287200         WHERE PO_NBR         = :DK-PO-NBR                        28720074
287300           AND VER_STATUS_CDE = 'A'                               28730074
287400     END-EXEC.                                                    28740074
287500                                                                  28750074
287600     EVALUATE TRUE                                                28760074
287700         WHEN SQLCODE = ZERO                                      28770074
287800             CONTINUE                                             28780074
287900                                                                  28790074
288000         WHEN SQLWARN0 NOT = SPACES                               28800074
288100         WHEN SQLCODE  NOT = ZERO                                 28810074
288200             MOVE PV-CURRENT-PARAGRAPH                            28820074
288300                                 TO AA-PARAGRAPH-NAME             28830074
288400             MOVE 'UNSUCCESSFUL SELECT ON TPURCHS'                28840074
288500                                 TO AA-DB2-OPERATION              28850074
288600             MOVE 'TPURCHS'      TO AA-DB2-TABLE-1                28860074
288700             PERFORM Z998-DB2-ABEND                               28870074
288800     END-EVALUATE.                                                28880074
288900                                                                  28890074
289000*--------------------------------------------------------------*  28900074
289100* RETRIEVES VENDOR INFORMATION FOR THE PO.                     *  28910074
289200* --  A NOT FOUND CONDITION RESULTS IN AN ABEND SINCE THERE    *  28920074
289300*     MUST ALWAYS BE A VENDOR ASSOCIATED WITH A PO.            *  28930074
289400*--------------------------------------------------------------*  28940074
289500 R220-GET-VENDOR-INFO.                                            28950074
289600                                                                  28960074
289700     MOVE 'R220-GET-VENDOR-INFO' TO PV-CURRENT-PARAGRAPH.         28970074
289800                                                                  28980074
289900         EXEC SQL                                                 28990074
290000             SELECT     E.DUN_NBR                                 29000074
290100                       ,N.ENT_NAME_DESC                           29010074
290200               INTO    :EXTENT-DUN-NBR                            29020074
290300                      ,:ENTNME-ENT-NAME-DESC                      29030074
290400               FROM    TEXTENT E                                  29040074
290500                      ,TENTNME N                                  29050074
290600              WHERE    E.ENT_ID   = :PURCHS-ENT-ID                29060074
290700                AND    N.ENT_ID   = :PURCHS-ENT-ID                29070074
290800                AND    N.TYPE_CDE = '01'                          29080074
290900         END-EXEC.                                                29090074
291000                                                                  29100074
291100     EVALUATE TRUE                                                29110074
291200         WHEN SQLCODE = ZERO                                      29120074
291300             CONTINUE                                             29130074
291400                                                                  29140074
291500         WHEN SQLWARN0 NOT = SPACES                               29150074
291600         WHEN SQLCODE  NOT = ZERO                                 29160074
291700             MOVE PV-CURRENT-PARAGRAPH                            29170074
291800                                 TO AA-PARAGRAPH-NAME             29180074
291900             MOVE 'UNSUCCESSFUL SELECT: DUN NBR'                  29190074
292000                                 TO AA-DB2-OPERATION              29200074
292100             MOVE 'TEXTENT'      TO AA-DB2-TABLE-1                29210074
292200             MOVE 'TPURCHS'      TO AA-DB2-TABLE-2                29220074
292300             MOVE 'TENTNME'      TO AA-DB2-TABLE-3                29230074
292400             PERFORM Z998-DB2-ABEND                               29240074
292500     END-EVALUATE.                                                29250074
292600                                                                  29260074
292700*--------------------------------------------------------------*  29270074
292800* RETRIEVES THE INVOICES ASSOCIATED WITH THE PO/STORE.         *  29280074
292900* --  A NOT FOUND CONDITION RESULTS IN THE NO ITEMS LEFT ON    *  29290074
293000*     DB SWITCH BEING SET.                                     *  29300074
293100*--------------------------------------------------------------*  29310074
293200 R300-FETCH-TINVOIC.                                              29320074
293300                                                                  29330099
293400     MOVE 'R300-FETCH-TINVOIC' TO PV-CURRENT-PARAGRAPH.           29340074
293500                                                                  29350074
293600     EXEC SQL                                                     29360074
293700         FETCH TINVOIC_CSR                                        29370074
293800          INTO  :INVOIC-PAYT-REQ-SEQ-NBR                          29380074
293900               ,:INVOIC-INVC-ID                                   29390074
294000               ,:INVOIC-STR-NBR                                   29400074
294100               ,:INVOIC-INVC-TYP-CDE                              29410074
294200               ,:INVOIC-STATUS-CDE                                29420074
294300               ,:INVOIC-HOLD-IND                                  29430074
294400               ,:INVOIC-GRO-COST-AMT                              29440074
294500               ,:INVOIC-INVC-DTE                                  29450074
294600               ,:INVOIC-ENTR-MTHD-CDE                             29460074
294700               ,:INVOIC-STATUS-CHG-TMST                           29470074
294800               ,:INVOIC-CALC-DUE-DTE                              29480074
294900               ,:INVOIC-DUE-DTE-SRC-CDE                           29490074
295000               ,:INVOIC-CRE-DTE                                   29500074
295100               ,:INVOIC-DC-NBR                                    29510074
295200               ,:INVOIC-MTCH-LVL-CDE                              29520074
295300     END-EXEC.                                                    29530074
295400                                                                  29540074
295500     EVALUATE TRUE                                                29550074
295600         WHEN SQLCODE = +0                                        29560074
295700              CONTINUE                                            29570074
295800         WHEN SQLCODE = +100                                      29580074
295900              SET NO-ITEMS-LEFT-ON-DB TO TRUE                     29590074
296000         WHEN SQLWARN0 NOT = SPACES                               29600074
296100         WHEN SQLCODE  NOT = ZERO                                 29610074
296200             MOVE PV-CURRENT-PARAGRAPH                            29620074
296300                                 TO AA-PARAGRAPH-NAME             29630074
296400             MOVE 'UNSUCCESSFUL FETCH WITH TINVOIC_CSR'           29640074
296500                                 TO AA-DB2-OPERATION              29650074
296600             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                29660074
296700             PERFORM Z998-DB2-ABEND                               29670074
296800     END-EVALUATE.                                                29680074
296900                                                                  29690074
297000*--------------------------------------------------------------*  29700074
297100* RETRIEVES THE RECDIS ROWS ASSOCIATED WITH THE PO/STORE.      *  29710074
297200* --  A NOT FOUND CONDITION RESULTS IN THE NO ITEMS LEFT ON    *  29720074
297300*     DB SWITCH BEING SET.                                     *  29730074
297400*--------------------------------------------------------------*  29740074
297500 R400-FETCH-TRECDIS.                                              29750074
297600                                                                  29760074
297700     MOVE 'R400-FETCH-TRECDIS' TO PV-CURRENT-PARAGRAPH.           29770074
297800                                                                  29780074
297900     EXEC SQL                                                     29790074
298000         FETCH TRECDIS_CSR                                        29800074
298100          INTO :RECEIV-ORD-NBR                                    29810074
298200              ,:RECEIV-REC-SEQ-NBR                                29820074
298300              ,:RECEIV-CRE-TMST                                   29830074
298400              ,:RECDIS-ORD-LNE-NBR                                29840074
298500              ,:RECDIS-OPER-UNT-ID                                29850074
298600              ,:RECDIS-FCLTY-ID                                   29860074
298700              ,:RECDIS-STR-NBR                                    29870074
298800              ,:RECDIS-STR-FCLTY-ID                               29880074
298900              ,:RECDIS-CRE-TMST                                   29890074
299000              ,:RECDIS-AP-VERIFY-ITM-QTY                          29900074
299110              ,:PURITM-PRD-1ST-COST-AMT                           29911084
299200     END-EXEC.                                                    29920074
299300                                                                  29930074
299400     EVALUATE TRUE                                                29940074
299500         WHEN SQLCODE = +0                                        29950074
299600              CONTINUE                                            29960074
299700         WHEN SQLCODE = +100                                      29970074
299800              SET NO-ITEMS-LEFT-ON-DB TO TRUE                     29980074
299900         WHEN SQLWARN0 NOT = SPACES                               29990074
300000         WHEN SQLCODE  NOT = ZERO                                 30000074
300100             MOVE PV-CURRENT-PARAGRAPH                            30010074
300200                                 TO AA-PARAGRAPH-NAME             30020074
300300             MOVE 'UNSUCCESSFUL FETCH WITH TRECDIS_CSR'           30030074
300400                                 TO AA-DB2-OPERATION              30040074
300500             MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                30050074
300600             MOVE 'TRECITM'      TO AA-DB2-TABLE-2                30060074
300700             MOVE 'TRECDIS'      TO AA-DB2-TABLE-3                30070074
300800             MOVE 'TPURITM'      TO AA-DB2-TABLE-4                30080074
300900             PERFORM Z998-DB2-ABEND                               30090074
301000     END-EVALUATE.                                                30100074
301100                                                                  30110074
301200*--------------------------------------------------------------*  30120074
301300* RETRIEVES THE RECEIV ROWS ASSOCIATED WITH THE DC.            *  30130074
301400* --  A NOT FOUND CONDITION RESULTS IN THE NO ITEMS LEFT ON    *  30140074
301500*     DB SWITCH BEING SET.                                     *  30150074
301600*--------------------------------------------------------------*  30160074
301700 R450-FETCH-TRECEIV.                                              30170074
301800                                                                  30180074
301900     MOVE 'R450-FETCH-TRECEIV' TO PV-CURRENT-PARAGRAPH.           30190074
302000                                                                  30200074
302100     EXEC SQL                                                     30210074
302200         FETCH TRECEIV_CSR                                        30220074
302300          INTO :RECEIV-ORD-NBR                                    30230074
302400              ,:RECEIV-REC-SEQ-NBR                                30240074
302500              ,:RECEIV-CRE-TMST                                   30250074
302600              ,:RECDIS-ORD-LNE-NBR                                30260074
302700              ,:RECDIS-OPER-UNT-ID                                30270074
302800              ,:RECDIS-FCLTY-ID                                   30280074
302900              ,:RECDIS-STR-NBR                                    30290074
303000              ,:RECDIS-STR-FCLTY-ID                               30300074
303100              ,:RECDIS-CRE-TMST                                   30310074
303200              ,:RECDIS-AP-VERIFY-ITM-QTY                          30320074
303310              ,:PURITM-PRD-1ST-COST-AMT                           30331084
303400     END-EXEC.                                                    30340074
303500                                                                  30350074
303600     EVALUATE TRUE                                                30360074
303700         WHEN SQLCODE = +0                                        30370074
303800              CONTINUE                                            30380074
303900                                                                  30390074
304000         WHEN SQLCODE = +100                                      30400074
304100              SET NO-ITEMS-LEFT-ON-DB TO TRUE                     30410074
304200                                                                  30420074
304300         WHEN SQLWARN0 NOT = SPACES                               30430074
304400         WHEN SQLCODE  NOT = ZERO                                 30440074
304500             MOVE PV-CURRENT-PARAGRAPH                            30450074
304600                                 TO AA-PARAGRAPH-NAME             30460074
304700             MOVE 'UNSUCCESSFUL FETCH WITH TRECEIV_CSR'           30470074
304800                                 TO AA-DB2-OPERATION              30480074
304900             MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                30490074
305000             MOVE 'TRECITM'      TO AA-DB2-TABLE-2                30500074
305100             MOVE 'TRECDIS'      TO AA-DB2-TABLE-3                30510074
305200             MOVE 'TPURITM'      TO AA-DB2-TABLE-4                30520074
305300             PERFORM Z998-DB2-ABEND                               30530074
305400     END-EVALUATE.                                                30540074
305500                                                                  30550074
305600*--------------------------------------------------------------*  30560074
305700* RETRIEVES THE NINREC ROWS ASSOCIATED WITH THE PO/STORE.      *  30570074
305800* --  A NOT FOUND CONDITION RESULTS IN THE NO ITEMS LEFT ON    *  30580074
305900*     DB SWITCH BEING SET.                                     *  30590074
306000*--------------------------------------------------------------*  30600074
306100 R500-FETCH-TNINREC.                                              30610074
306200                                                                  30620074
306300     MOVE 'R500-FETCH-TNINREC' TO PV-CURRENT-PARAGRAPH.           30630074
306400                                                                  30640074
306500     EXEC SQL                                                     30650074
306600         FETCH TNINREC_CSR                                        30660074
306700          INTO :NINREC-PO-LNE-NBR                                 30670074
306800              ,:NINREC-NON-INVC-SEQ-NBR                           30680074
306900              ,:NINREC-NON-INVC-UNT-QTY                           30690074
307000              ,:NINREC-UNT-COST-AMT                               30700074
307100     END-EXEC.                                                    30710074
307200                                                                  30720074
307300     EVALUATE TRUE                                                30730074
307400         WHEN SQLCODE = +0                                        30740074
307500              CONTINUE                                            30750074
307600                                                                  30760074
307700         WHEN SQLCODE = +100                                      30770074
307800              SET NO-ITEMS-LEFT-ON-DB TO TRUE                     30780074
307900                                                                  30790074
308000         WHEN SQLWARN0 NOT = SPACES                               30800074
308100         WHEN SQLCODE  NOT = ZERO                                 30810074
308200             MOVE PV-CURRENT-PARAGRAPH                            30820074
308300                                 TO AA-PARAGRAPH-NAME             30830074
308400             MOVE 'UNSUCCESSFUL FETCH WITH TNINREC_CSR'           30840074
308500                                 TO AA-DB2-OPERATION              30850074
308600             MOVE 'TNINREC'      TO AA-DB2-TABLE-1                30860074
308700             PERFORM Z998-DB2-ABEND                               30870074
308800     END-EVALUATE.                                                30880074
308900                                                                  30890074
309000*--------------------------------------------------------------*  30900074
309100* RETRIEVES THE NINREC ROWS ASSOCIATED WITH THE PO/STORE.      *  30910074
309200* --  A NOT FOUND CONDITION RESULTS IN THE NO ITEMS LEFT ON    *  30920074
309300*     DB SWITCH BEING SET.                                     *  30930074
309400*--------------------------------------------------------------*  30940074
309500 R550-FETCH-TNINREC-DC.                                           30950074
309600                                                                  30960074
309700     MOVE 'R550-FETCH-TNINREC-DC' TO PV-CURRENT-PARAGRAPH.        30970074
309800                                                                  30980074
309900     EXEC SQL                                                     30990074
310000         FETCH TNINREC_DC_CSR                                     31000074
310100          INTO :NINREC-PO-LNE-NBR                                 31010074
310200              ,:NINREC-NON-INVC-SEQ-NBR                           31020074
310300              ,:NINREC-NON-INVC-UNT-QTY                           31030074
310400              ,:NINREC-UNT-COST-AMT                               31040074
310500     END-EXEC.                                                    31050074
310600                                                                  31060074
310700     EVALUATE TRUE                                                31070074
310800         WHEN SQLCODE = +0                                        31080074
310900              CONTINUE                                            31090074
311000                                                                  31100074
311100         WHEN SQLCODE = +100                                      31110074
311200              SET NO-ITEMS-LEFT-ON-DB TO TRUE                     31120074
311300                                                                  31130074
311400         WHEN SQLWARN0 NOT = SPACES                               31140074
311500         WHEN SQLCODE  NOT = ZERO                                 31150074
311600             MOVE PV-CURRENT-PARAGRAPH                            31160074
311700                                 TO AA-PARAGRAPH-NAME             31170074
311800             MOVE 'UNSUCCESSFUL FETCH WITH TNINREC_DC_CSR'        31180074
311900                                 TO AA-DB2-OPERATION              31190074
312000             MOVE 'TNINREC'      TO AA-DB2-TABLE-1                31200074
312100             PERFORM Z998-DB2-ABEND                               31210074
312200     END-EVALUATE.                                                31220074
312300                                                                  31230074
312400*--------------------------------------------------------------*  31240074
312500* RETRIEVES THE PREQIT ROWS ASSOCIATED WITH THE PO/STORE.      *  31250074
312600* --  A NOT FOUND CONDITION RESULTS IN THE NO ITEMS LEFT ON    *  31260074
312700*     DB SWITCH BEING SET.                                     *  31270074
312800*--------------------------------------------------------------*  31280074
312900 R600-FETCH-TPREQIT.                                              31290074
313000                                                                  31300074
313100     MOVE 'R600-FETCH-TPREQIT' TO PV-CURRENT-PARAGRAPH.           31310074
313200                                                                  31320074
313300     EXEC SQL                                                     31330074
313400         FETCH TPREQIT_CSR                                        31340074
313500          INTO :PV-CSR-NULL-LNE-NBR-IND                           31350074
313600              ,:PV-CSR-APP-LNE-NBR                                31360074
313700              ,:PV-CSR-KEY-LNE-NBR                                31370074
313800              ,:PV-CSR-QTY                                        31380074
313900              ,:PV-CSR-UNT-COST-AMT                               31390074
314000              ,:PV-CSR-PAYT-REQ-SEQ-NBR                           31400074
314100     END-EXEC.                                                    31410074
314200                                                                  31420074
314300     EVALUATE TRUE                                                31430074
314400         WHEN SQLCODE = +0                                        31440074
314500              CONTINUE                                            31450074
314600         WHEN SQLCODE = +100                                      31460074
314700              SET NO-ITEMS-LEFT-ON-DB TO TRUE                     31470074
314800         WHEN SQLWARN0 NOT = SPACES                               31480074
314900         WHEN SQLCODE  NOT = ZERO                                 31490074
315000             MOVE PV-CURRENT-PARAGRAPH                            31500074
315100                                 TO AA-PARAGRAPH-NAME             31510074
315200             MOVE 'UNSUCCESSFUL FETCH WITH TPREQIT_CSR'           31520074
315300                                 TO AA-DB2-OPERATION              31530074
315400             MOVE 'TPREQIT'      TO AA-DB2-TABLE-1                31540074
315500             MOVE 'TMIITEM'      TO AA-DB2-TABLE-2                31550074
315600             MOVE 'TPURITM'      TO AA-DB2-TABLE-3                31560074
315700             PERFORM Z998-DB2-ABEND                               31570074
315800     END-EVALUATE.                                                31580074
315900                                                                  31590074
316000*--------------------------------------------------------------*  31600074
316100* RETRIEVES THE ASSOCIATED ALLOWANCES FOR AN INVOICE.          *  31610074
316200* --  A NOT FOUND CONDITION RESULTS IN THE OUT OF ALLOWANCES   *  31620074
316300*     SWITCH BEING SET.                                        *  31630074
316400*--------------------------------------------------------------*  31640074
316500 R700-FETCH-DISCOUNT.                                             31650074
316600                                                                  31660074
316700     MOVE 'R700-FETCH-DISCOUNT' TO PV-CURRENT-PARAGRAPH.          31670074
316800                                                                  31680074
316900     EXEC SQL                                                     31690074
317000         FETCH DISCOUNT_CSR                                       31700074
317100           INTO :ALCHRG-ALW-CHRG-TYP-CDE                          31710074
317200               ,:ALCHRG-ALW-CHRG-CDE                              31720074
317300               ,:ALCHRG-ALW-CHRG-PCT                              31730074
317400               ,:ALCHRG-ALW-CHRG-AMT                              31740074
317500     END-EXEC.                                                    31750074
317600                                                                  31760074
317700     EVALUATE TRUE                                                31770074
317800         WHEN SQLCODE = +0                                        31780074
317900              CONTINUE                                            31790074
318000                                                                  31800074
318100         WHEN SQLCODE = +100                                      31810074
318200              SET OUT-OF-ALLOWANCES TO TRUE                       31820074
318300                                                                  31830074
318400         WHEN SQLWARN0 NOT = SPACES                               31840074
318500         WHEN SQLCODE  NOT = ZERO                                 31850074
318600             MOVE PV-CURRENT-PARAGRAPH                            31860074
318700                                 TO AA-PARAGRAPH-NAME             31870074
318800             MOVE 'UNSUCCESSFUL FETCH WITH DISCOUNT_CSR'          31880074
318900                                 TO AA-DB2-OPERATION              31890074
319000             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                31900074
319100             PERFORM Z998-DB2-ABEND                               31910074
319200     END-EVALUATE.                                                31920074
319300                                                                  31930074
319400*--------------------------------------------------------------*  31940074
319500* RETRIEVES THE ASSOCIATED ALLOWANCES FOR AN INVOICE.          *  31950074
319600* --  A NOT FOUND CONDITION RESULTS IN THE OUT OF ALLOWANCES   *  31960074
319700*     SWITCH BEING SET.                                        *  31970074
319800*--------------------------------------------------------------*  31980074
319900*R705-FETCH-ADVERT-ALLWS.                                         31990074
320000*                                                                 32000074
320100*    MOVE 'R705-FETCH-ADVERT-ALLWS' TO PV-CURRENT-PARAGRAPH.      32010074
320200*                                                                 32020074
320300*    EXEC SQL                                                     32030074
320400*        FETCH ADVERT_CSR                                         32040074
320500*          INTO :ALCHRG-ALW-CHRG-TYP-CDE                          32050074
320600*              ,:ALCHRG-ALW-CHRG-CDE                              32060074
320700*              ,:ALCHRG-ALW-CHRG-PCT                              32070074
320800*              ,:ALCHRG-ALW-CHRG-AMT                              32080074
320900*    END-EXEC.                                                    32090074
321000*                                                                 32100074
321100*    EVALUATE TRUE                                                32110074
321200*        WHEN SQLCODE = +0                                        32120074
321300*             CONTINUE                                            32130074
321400*                                                                 32140074
321500*        WHEN SQLCODE = +100                                      32150074
321600*             SET OUT-OF-ADVERT-ALLWS TO TRUE                     32160074
321700*                                                                 32170074
321800*        WHEN SQLWARN0 NOT = SPACES                               32180074
321900*        WHEN SQLCODE  NOT = ZERO                                 32190074
322000*            MOVE PV-CURRENT-PARAGRAPH                            32200074
322100*                                TO AA-PARAGRAPH-NAME             32210074
322200*            MOVE 'UNSUCCESSFUL FETCH WITH ADVERT_CSR'            32220074
322300*                                TO AA-DB2-OPERATION              32230074
322400*            MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                32240074
322500*            PERFORM Z998-DB2-ABEND                               32250074
322600*    END-EVALUATE.                                                32260074
322700*EJECT                                                            32270074
322800                                                                  32280074
322900*--------------------------------------------------------------*  32290074
323000* RETRIEVES THE TERMS SELECTION CODE FROM MDINVC               *  32300074
323100* --  A NOT FOUND CONDITION RESULTS IN AN ABEND SINCE THERE    *  32310074
323200*     MUST ALWAYS BE A TERM SELECTION SET.                     *  32320074
323300*--------------------------------------------------------------*  32330074
323400 R710-SELECT-TERM-SEL-CDE.                                        32340074
323500                                                                  32350074
323600     MOVE 'R710-SELECT-TERM-SEL-CDE ' TO PV-CURRENT-PARAGRAPH.    32360074
323700                                                                  32370074
323800     EXEC SQL                                                     32380074
323900         SELECT TERM_SEL_CDE                                      32390074
324000         INTO  :MDINVC-TERM-SEL-CDE                               32400074
324100         FROM  TMDINVC                                            32410074
324200         WHERE PO_NBR  = :DK-PO-NBR                               32420074
324300           AND INVC_ID = :MDINVC-INVC-ID                          32430074
324400     END-EXEC.                                                    32440074
324500                                                                  32450074
324600     EVALUATE TRUE                                                32460074
324700         WHEN SQLCODE = ZERO                                      32470074
324800             CONTINUE                                             32480074
324900                                                                  32490074
325000         WHEN SQLWARN0 NOT = SPACES                               32500074
325100         WHEN SQLCODE  NOT = ZERO                                 32510074
325200             MOVE PV-CURRENT-PARAGRAPH                            32520074
325300                                 TO AA-PARAGRAPH-NAME             32530074
325400             MOVE 'UNSUCCESSFUL SELECT ON TMDINVC'                32540074
325500                                 TO AA-DB2-OPERATION              32550074
325600             MOVE 'TMDINVC'      TO AA-DB2-TABLE-1                32560074
325700             PERFORM Z998-DB2-ABEND                               32570074
325800     END-EVALUATE.                                                32580074
325900                                                                  32590074
326000*--------------------------------------------------------------*  32600074
326100* RETRIEVES THE TERMS DISCOUNT DATA FOR A PO WITH PO TERMS     *  32610074
326200* SPECIFIED.                                                   *  32620074
326300* --  A NOT FOUND CONDITION RESULTS IN AN ABEND SINCE THERE    *  32630074
326400*     MUST ALWAYS BE A TERMS SPECIFIED.                        *  32640074
326500*--------------------------------------------------------------*  32650074
326600 R720-GET-PO-DISC-PCT.                                            32660074
326700                                                                  32670074
326800     MOVE 'R720-GET-PO-DISC-PCT' TO PV-CURRENT-PARAGRAPH.         32680074
326900                                                                  32690074
327000     EXEC SQL                                                     32700074
327100         SELECT PT.DISCOUNT_PCT                                   32710074
327200         INTO :PAYTRM-DISCOUNT-PCT                                32720074
327300         FROM TPOAGMT PA                                          32730074
327400             ,TPAYTRM PT                                          32740074
327500         WHERE PA.PO_NBR         = :DK-PO-NBR                     32750074
327600           AND PA.PAYT_TERM_ID   = PT.PAY_TERM_ID                 32760074
327700           AND PA.AGRMT_TYP_ID   = '2'                            32770074
327800           AND PA.VER_STATUS_CDE = 'A'                            32780074
327900     END-EXEC.                                                    32790074
328000                                                                  32800074
328100     EVALUATE TRUE                                                32810074
328200         WHEN SQLCODE = ZERO                                      32820074
328300             CONTINUE                                             32830074
328400                                                                  32840074
328500         WHEN SQLWARN0 NOT = SPACES                               32850074
328600         WHEN SQLCODE  NOT = ZERO                                 32860074
328700             MOVE PV-CURRENT-PARAGRAPH                            32870074
328800                                 TO AA-PARAGRAPH-NAME             32880074
328900             MOVE 'UNSUCCESSFUL SELECT: PO DISC PCT'              32890074
329000                                 TO AA-DB2-OPERATION              32900074
329100             MOVE 'TPOAGMT'      TO AA-DB2-TABLE-1                32910074
329200             MOVE 'TPAYTRM'      TO AA-DB2-TABLE-2                32920074
329300             PERFORM Z998-DB2-ABEND                               32930074
329400     END-EVALUATE.                                                32940074
329500                                                                  32950074
329600*--------------------------------------------------------------*  32960074
329700* RETRIEVES THE TERMS DISCOUNT DATA FOR A PO WITH INVOICE      *  32970074
329800* TERMS SPECIFIED.                                             *  32980074
329900* --  A NOT FOUND CONDITION RESULTS IN AN ABEND SINCE THERE    *  32990074
330000*     MUST ALWAYS BE A TERMS SPECIFIED.                        *  33000074
330100*--------------------------------------------------------------*  33010074
330200 R730-GET-INVOICE-DISC-PCT.                                       33020074
330300                                                                  33030074
330400     MOVE 'R730-GET-INVOICE-DISC-PCT' TO PV-CURRENT-PARAGRAPH.    33040074
330500                                                                  33050074
330600     EXEC SQL                                                     33060074
330700         SELECT DISC_PCT                                          33070074
330800         INTO :INVCTM-DISC-PCT                                    33080074
330900         FROM TINVCTM                                             33090074
331000         WHERE PO_NBR        = :DK-PO-NBR                         33100074
331100           AND INVC_ID       = :INVCTM-INVC-ID                    33110074
331200           AND TERM_SEQ_NBR  = 1                                  33120074
331300     END-EXEC.                                                    33130074
331400                                                                  33140074
331500     EVALUATE TRUE                                                33150074
331600         WHEN SQLCODE = ZERO                                      33160074
331700             CONTINUE                                             33170074
331800                                                                  33180074
331900         WHEN SQLWARN0 NOT = SPACES                               33190074
332000         WHEN SQLCODE  NOT = ZERO                                 33200074
332100             MOVE PV-CURRENT-PARAGRAPH                            33210074
332200                                 TO AA-PARAGRAPH-NAME             33220074
332300             MOVE 'UNSUCCESSFUL SELECT: INVOICE DISC PCT'         33230074
332400                                 TO AA-DB2-OPERATION              33240074
332500             MOVE 'TINVCTM'      TO AA-DB2-TABLE-1                33250074
332600             PERFORM Z998-DB2-ABEND                               33260074
332700     END-EVALUATE.                                                33270074
332800                                                                  33280074
332900*--------------------------------------------------------------*  33290074
333000* RETRIEVES PREQIT NULL (UNMATCHED) LINE DATA FOR REMAINDERS   *  33300074
333100* --  A NOT FOUND CONDITION RESULTS IN THE NO ITEMS LEFT ON    *  33310074
333200*     DB SWITCH BEING SET.                                     *  33320074
333300*--------------------------------------------------------------*  33330074
333400 R800-FETCH-PREQIT-NULL.                                          33340074
333500                                                                  33350074
333600     MOVE 'R800-FETCH-PREQIT-NULL'    TO PV-CURRENT-PARAGRAPH.    33360074
333700                                                                  33370074
333800     EXEC SQL                                                     33380074
333900         FETCH PREQIT_NULL_PO_CSR                                 33390074
334000          INTO :PREQIT-PAYT-REQ-SEQ-NBR                           33400074
334100              ,:PREQIT-PAYT-REQ-LNE-NBR                           33410074
334200              ,:PREQIT-PAY-REQ-LNE-QTY                            33420074
334300              ,:PREQIT-UNT-COST-AMT                               33430074
334400     END-EXEC.                                                    33440074
334500                                                                  33450074
334600     EVALUATE TRUE                                                33460074
334700         WHEN SQLCODE = ZERO                                      33470074
334800             CONTINUE                                             33480074
334900                                                                  33490074
335000         WHEN SQLCODE = +100                                      33500074
335100              SET NO-ITEMS-LEFT-ON-DB TO TRUE                     33510074
335200                                                                  33520074
335300         WHEN SQLWARN0 NOT = SPACES                               33530074
335400         WHEN SQLCODE  NOT = ZERO                                 33540074
335500             MOVE PV-CURRENT-PARAGRAPH                            33550074
335600                                 TO AA-PARAGRAPH-NAME             33560074
335700             MOVE                                                 33570074
335800               'UNSUCCESSFUL SELECT: PREQIT_NULL_PO_CSR'          33580074
335900                                 TO AA-DB2-OPERATION              33590074
336000             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                33600074
336100             MOVE 'TPREQIT'      TO AA-DB2-TABLE-2                33610074
336200             MOVE 'TMIITEM'      TO AA-DB2-TABLE-3                33620074
336300             PERFORM Z998-DB2-ABEND                               33630074
336400     END-EVALUATE.                                                33640074
336500                                                                  33650074
336600*--------------------------------------------------------------*  33660074
336700* RETRIEVES PO TERMS DATA FOR USE IN CREATING REMAINDERS       *  33670074
336800* --  A NOT FOUND CONDITION RESULTS IN AN ABEND SINCE THERE    *  33680074
336900*     MUST ALWAYS BE PO TERMS ASSOCIATED WITH A PO.            *  33690074
337000*--------------------------------------------------------------*  33700074
337100 R900-GET-PO-TERMS-DATA.                                          33710074
337200                                                                  33720074
337300     MOVE 'R900-GET-PO-TERMS-DATA'    TO PV-CURRENT-PARAGRAPH.    33730074
337400                                                                  33740074
337500     EXEC SQL                                                     33750074
337600         SELECT                                                   33760074
337700             PA.DISC_PAY_DAY_QTY                                  33770074
337800            ,PT.DUE_DAY_QTY                                       33780074
337900            ,PT.DISCOUNT_DAYS_QTY                                 33790074
338000            ,PT.DUE_DAY_FR_DTE_TXT                                33800074
338100         INTO                                                     33810074
338200             :POAGMT-DISC-PAY-DAY-QTY                             33820074
338300            ,:PAYTRM-DUE-DAY-QTY                                  33830074
338400            ,:PAYTRM-DISCOUNT-DAYS-QTY                            33840074
338500            ,:PAYTRM-DUE-DAY-FR-DTE-TXT                           33850074
338600         FROM                                                     33860074
338700             TPOAGMT PA                                           33870074
338800            ,TPAYTRM PT                                           33880074
338900         WHERE PA.PO_NBR         = :DK-PO-NBR                     33890074
339000           AND PA.PAYT_TERM_ID   = PT.PAY_TERM_ID                 33900074
339100           AND PA.AGRMT_TYP_ID   = '2'                            33910074
339200           AND PA.VER_STATUS_CDE = 'A'                            33920074
339300     END-EXEC.                                                    33930074
339400                                                                  33940074
339500     EVALUATE TRUE                                                33950074
339600         WHEN SQLCODE = ZERO                                      33960074
339700             CONTINUE                                             33970074
339800                                                                  33980074
339900         WHEN SQLCODE = +100                                      33990074
340000              CONTINUE                                            34000074
340100                                                                  34010074
340200         WHEN SQLWARN0 NOT = SPACES                               34020074
340300         WHEN SQLCODE  NOT = ZERO                                 34030074
340400             MOVE PV-CURRENT-PARAGRAPH                            34040074
340500                                 TO AA-PARAGRAPH-NAME             34050074
340600             MOVE                                                 34060074
340700               'UNSUCCESSFUL SELECT: PO TERMS DATA'               34070074
340800                                 TO AA-DB2-OPERATION              34080074
340900             MOVE 'TPOAGMT'      TO AA-DB2-TABLE-1                34090074
341000             MOVE 'TPAYTRM'      TO AA-DB2-TABLE-2                34100074
341100             PERFORM Z998-DB2-ABEND                               34110074
341200     END-EVALUATE.                                                34120074
341300                                                                  34130074
341400     PERFORM R910-GET-ADDL-PO-TERMS-DATA.                         34140074
341500                                                                  34150074
341600                                                                  34160074
341700*--------------------------------------------------------------*  34170074
341800* RETRIEVES ADDITIONAL EXTENDED DAYS FROM THE TPOAGMT TABLE    *  34180074
341900* THAT ARE ADDED TO THE INITIAL EXTENDED DAYS FETCHED IN R900. *  34190074
342000*--------------------------------------------------------------*  34200074
342100 R910-GET-ADDL-PO-TERMS-DATA.                                     34210074
342200                                                                  34220074
342300     MOVE 'R910-GET-ADDL-PO-TERMS-DATA'  TO PV-CURRENT-PARAGRAPH. 34230074
342400                                                                  34240074
342500     MOVE ZERO TO PV-DISC-PAY-DAY-QTY.                            34250074
342600                                                                  34260074
342700     EXEC SQL                                                     34270074
342800         SELECT                                                   34280074
342900             PA.DISC_PAY_DAY_QTY                                  34290074
343000         INTO                                                     34300074
343100             :PV-DISC-PAY-DAY-QTY                                 34310074
343200         FROM                                                     34320074
343300             TPOAGMT PA                                           34330074
343400         WHERE PA.PO_NBR         = :DK-PO-NBR                     34340074
343500           AND PA.VER_STATUS_CDE = 'A'                            34350074
343600           AND PA.AGRMT_TYP_ID   = '5'                            34360074
343700           AND PA.TYP_CDE        =  1                             34370074
343800     END-EXEC.                                                    34380074
343900                                                                  34390074
344000     EVALUATE TRUE                                                34400074
344100         WHEN SQLCODE = ZERO                                      34410074
344200             ADD PV-DISC-PAY-DAY-QTY TO POAGMT-DISC-PAY-DAY-QTY   34420074
344300                                                                  34430074
344400         WHEN SQLCODE = +100                                      34440074
344500             CONTINUE                                             34450074
344600                                                                  34460074
344700         WHEN SQLWARN0 NOT = SPACES                               34470074
344800         WHEN SQLCODE  NOT = ZERO                                 34480074
344900             MOVE PV-CURRENT-PARAGRAPH                            34490074
345000                                 TO AA-PARAGRAPH-NAME             34500074
345100             MOVE                                                 34510074
345200               'UNSUCCESSFUL SELECT: PO TERMS DATA'               34520074
345300                                 TO AA-DB2-OPERATION              34530074
345400             MOVE 'TPOAGMT'      TO AA-DB2-TABLE-1                34540074
345500             MOVE SPACE          TO AA-DB2-TABLE-2                34550074
345600             PERFORM Z998-DB2-ABEND                               34560074
345700     END-EVALUATE.                                                34570074
345800                                                                  34580074
345810*----------------------------------------------------------------*34581091
345820*    FETCH TOTAL OF INVOICE ITEM QTY FOR EACH UNIT COST.         *34582091
345830*----------------------------------------------------------------*34583091
345840 R920-FETCH-INVC-ITEM.                                            34584091
345850                                                                  34585091
345860     EXEC SQL                                                     34586091
345870         FETCH INVC_ITEM_CSR                                      34587091
345880          INTO :PV-INVC-SUM-QTY                                   34588091
345890              ,:PREQIT-UNT-COST-AMT                               34589091
345891     END-EXEC.                                                    34589191
345892                                                                  34589291
345893     EVALUATE TRUE                                                34589391
345894         WHEN SQLCODE = +0                                        34589491
345895              CONTINUE                                            34589591
345896                                                                  34589691
345897         WHEN SQLCODE = +100                                      34589791
345898              SET NO-MORE-INVC-ITEMS  TO TRUE                     34589891
345899                                                                  34589991
345900         WHEN SQLWARN0 NOT = SPACE                                34590091
345901         WHEN SQLCODE < +0                                        34590191
345902         WHEN SQLCODE > +0                                        34590291
345903             MOVE PV-CURRENT-PARAGRAPH                            34590393
345904                                 TO AA-PARAGRAPH-NAME             34590493
345905             MOVE                                                 34590593
345906               'UNSUCCESSFUL FETCH: INVC_ITEM_CSR'                34590693
345907                                 TO AA-DB2-OPERATION              34590793
345908             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                34590893
345909             MOVE 'TPREQIT'      TO AA-DB2-TABLE-2                34590993
345910             MOVE 'TMIITEM'      TO AA-DB2-TABLE-3                34591093
345911             PERFORM Z998-DB2-ABEND                               34591193
345923     END-EVALUATE.                                                34592391
345924/                                                                 34592491
345930*--------------------------------------------------------------*  34593074
346000* RETRIEVES THE GREATEST PRICE CLAIM SEQUENCE NUMBER FOR THE   *  34600074
346100* COMBINATION OF PO/STORE/INVOICE ID/PO LINE NUMBER FOR USE    *  34610074
346200* IN GENERATING THE NEXT PRICE CLAIM SEQUENCE NUMBER FOR       *  34620074
346300* THE COMBINATION.                                             *  34630074
346400* --  A NOT FOUND CONDITION RESULTS IN THE SEQUENCE NUMBER     *  34640074
346500*     BEING SET TO +1.                                         *  34650074
346600*--------------------------------------------------------------*  34660074
346700 R950-GET-PRCCLM-SEQ-NBR.                                         34670074
346800                                                                  34680074
346900     MOVE 'R950-GET-PRCCLM-SEQ-NBR'   TO PV-CURRENT-PARAGRAPH.    34690074
347000                                                                  34700074
347100     EXEC SQL                                                     34710074
347200         SELECT MAX(PRCCLM_SEQ_NBR)                               34720074
347300         INTO :PRCCLM-PRCCLM-SEQ-NBR                              34730074
347400         FROM TPRCCLM                                             34740074
347500         WHERE PO_NBR       = :PRCCLM-PO-NBR                      34750074
347600           AND STR_NBR      = :PRCCLM-STR-NBR                     34760074
347700           AND INVC_ID      = :PRCCLM-INVC-ID                     34770074
347800           AND PO_LNE_NBR   = :PRCCLM-PO-LNE-NBR                  34780074
347900     END-EXEC.                                                    34790074
348000                                                                  34800074
348100     EVALUATE TRUE                                                34810074
348200         WHEN SQLCODE = ZERO                                      34820074
348300             ADD +1  TO PRCCLM-PRCCLM-SEQ-NBR                     34830074
348400                                                                  34840074
348500         WHEN SQLCODE = -305                                      34850074
348600             MOVE +1 TO PRCCLM-PRCCLM-SEQ-NBR                     34860074
348700                                                                  34870074
348800         WHEN SQLWARN0 NOT = SPACES                               34880074
348900         WHEN SQLCODE  NOT = ZERO                                 34890074
349000             MOVE PV-CURRENT-PARAGRAPH                            34900074
349100                                 TO AA-PARAGRAPH-NAME             34910074
349200             MOVE                                                 34920074
349300               'UNSUCCESSFUL SELECT: PRCCLM SEQ NBR'              34930074
349400                                 TO AA-DB2-OPERATION              34940074
349500             MOVE 'TPRCCLM'      TO AA-DB2-TABLE-1                34950074
349600             PERFORM Z998-DB2-ABEND                               34960074
349700     END-EVALUATE.                                                34970074
349800                                                                  34980074
349900*--------------------------------------------------------------*  34990074
350000* DETERMINES IF THERE ARE INCOMPLETE RECEIVERS FOR THE PO      *  35000099
350010* BEING SENT TO MANUAL RECON REPORT.                           *  35001099
350100*--------------------------------------------------------------*  35010074
350200 S200-GET-RCV-INCOMPLETE.                                         35020099
350300                                                                  35030074
350301     MOVE +0 TO PV-RCV-INCOMPLETE-COUNT                           35030199
350302                                                                  35030299
350303     EXEC SQL                                                     35030399
350304         SELECT COUNT(*)                                          35030499
350305           INTO :PV-RCV-INCOMPLETE-COUNT                          35030599
350306           FROM TRECEIV                                           35030699
350307          WHERE ORD_NBR        = :DK-PO-NBR                       35030799
350308            AND STATUS_CDE    ^= 'VE'                             35030899
350309            AND VER_STATUS_CDE = 'A'                              35030999
350310     END-EXEC.                                                    35031099
350311                                                                  35031199
350312     EVALUATE TRUE                                                35031299
350313         WHEN PV-RCV-INCOMPLETE-COUNT = +0                        35031399
350314             MOVE 'N'         TO PS-RECV-COMPLETE-IND             35031499
350315         WHEN PV-RCV-INCOMPLETE-COUNT > +0                        35031599
350316             MOVE 'Y'         TO PS-RECV-COMPLETE-IND             35031699
350317         WHEN (SQLCODE NOT = +0)                                  35031799
350318             MOVE 'S200-GET-RCV-INCOMPLETE' TO AA-PARAGRAPH-NAME  35031899
350320             MOVE 'UNSUCCESSFUL SELECT' TO AA-DB2-OPERATION       35032099
350322             MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                35032299
350323             PERFORM Z998-DB2-ABEND                               35032399
350326     END-EVALUATE.                                                35032699
350327                                                                  35032799
350328*--------------------------------------------------------------*  35032899
350330* INSERTS NON-INVOICED RECEIPT                                 *  35033099
350340*--------------------------------------------------------------*  35034099
350350 U100-INSERT-TNINREC.                                             35035099
350360                                                                  35036099
350400     MOVE 'U100-INSERT-TNINREC' TO PV-CURRENT-PARAGRAPH.          35040074
350500                                                                  35050074
350600     PERFORM WITH TEST AFTER                                      35060074
350700             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 35070074
350800             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         35080074
350900                     SQLCODE = ZERO                               35090074
351000                                                                  35100074
351100         EXEC SQL                                                 35110074
351200              SET :KEY-TIMESTAMP = CURRENT TIMESTAMP              35120074
351300         END-EXEC                                                 35130074
351400                                                                  35140074
351500         IF SQLCODE NOT = ZERO                                    35150074
351600             MOVE PV-CURRENT-PARAGRAPH                            35160074
351700                                 TO AA-PARAGRAPH-NAME             35170074
351800             MOVE 'UNSUCCESSFUL SET TIMESTAMP'                    35180074
351900                                 TO AA-DB2-OPERATION              35190074
352000             MOVE 'TNINREC'      TO AA-DB2-TABLE-1                35200074
352100             PERFORM Z998-DB2-ABEND                               35210074
352200         END-IF                                                   35220074
352300                                                                  35230074
352400         MOVE KEY-NANOSEC-2     TO PV-RANDOM-KEY-NANOSEC-1        35240074
352500         MOVE KEY-NANOSEC-1     TO PV-RANDOM-KEY-NANOSEC-2        35250074
352600         MOVE KEY-MINUTE        TO PV-RANDOM-KEY-MINUTE           35260074
352700         MOVE KEY-SECOND        TO PV-RANDOM-KEY-SECOND           35270074
352800         MOVE PV-RANDOM-KEY     TO PV-RANDOM-KEY-INT              35280074
352900         MOVE PV-RANDOM-KEY-INT TO NINREC-NON-INVC-SEQ-NBR        35290074
353000                                                                  35300074
353100         EXEC SQL                                                 35310074
353200              INSERT INTO TNINREC                                 35320074
353300                     ( PO_NBR                                     35330074
353400                      ,VER_NBR                                    35340074
353500                      ,PO_LNE_NBR                                 35350074
353600                      ,NON_INVC_SEQ_NBR                           35360074
353700                      ,STR_NBR                                    35370074
353800                      ,NON_INVC_UNT_QTY                           35380074
353900                      ,UNT_COST_AMT                               35390074
354000                      ,PAYT_RLSE_TMST                             35400074
354100                      ,STATUS_CDE                                 35410074
354200                      ,PAYT_DTE                                   35420074
354300                      ,REC_TMST                                   35430074
354400                      ,ORIG_DISC_PCT                              35440074
354500                      ,DC_NBR)                                    35450074
354600             VALUES  (:NINREC-PO-NBR                              35460074
354700                     ,0                                           35470074
354800                     ,:NINREC-PO-LNE-NBR                          35480074
354900                     ,:NINREC-NON-INVC-SEQ-NBR                    35490074
355000                     ,:NINREC-STR-NBR                             35500074
355100                     ,:NINREC-NON-INVC-UNT-QTY                    35510074
355200                     ,:NINREC-UNT-COST-AMT                        35520074
355300                     ,:NINREC-PAYT-RLSE-TMST                      35530074
355400                     ,:NINREC-STATUS-CDE                          35540074
355500                     ,:NINREC-PAYT-DTE                            35550074
355600                     ,:NINREC-REC-TMST                            35560074
355700                     ,:NINREC-ORIG-DISC-PCT                       35570074
355800                     ,:NINREC-DC-NBR)                             35580074
355900         END-EXEC                                                 35590074
356000         EVALUATE TRUE                                            35600074
356100             WHEN SQLCODE = +0                                    35610074
356200             WHEN SQLCODE = -803                                  35620074
356300             WHEN SQLCODE = -904                                  35630074
356400             WHEN SQLCODE = -913                                  35640074
356500                  CONTINUE                                        35650074
356600                                                                  35660074
356700                 WHEN SQLWARN0 NOT = SPACES                       35670074
356800                 WHEN SQLCODE  NOT = ZERO                         35680074
356900                     MOVE PV-CURRENT-PARAGRAPH                    35690074
357000                                         TO AA-PARAGRAPH-NAME     35700074
357100                     MOVE 'UNSUCCESSFUL INSERT: TNINREC'          35710074
357200                                         TO AA-DB2-OPERATION      35720074
357300                     MOVE 'TNINREC'      TO AA-DB2-TABLE-1        35730074
357400                     PERFORM Z998-DB2-ABEND                       35740074
357500         END-EVALUATE                                             35750074
357600     END-PERFORM.                                                 35760074
357700                                                                  35770074
357800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         35780074
357900         MOVE PV-CURRENT-PARAGRAPH                                35790074
358000                             TO AA-PARAGRAPH-NAME                 35800074
358100         MOVE 'MAX RETRIES EXCEEDED ON INSERT: TNINREC'           35810074
358200                             TO AA-DB2-OPERATION                  35820074
358300         MOVE 'TNINREC'      TO AA-DB2-TABLE-1                    35830074
358400         PERFORM Z998-DB2-ABEND                                   35840074
358500     END-IF.                                                      35850074
358600                                                                  35860074
358700*--------------------------------------------------------------*  35870074
358800* INSERTS REMAINDER ROW TO TINVOIC                             *  35880074
358900*--------------------------------------------------------------*  35890074
359000 U210-INSERT-TINVOIC.                                             35900074
359100                                                                  35910074
359200     MOVE 'U210-INSERT-TINVOIC' TO PV-CURRENT-PARAGRAPH.          35920074
359300                                                                  35930074
359400***** SET THE MAX RETRIES HIGHER HERE SO THAT MORE ATTEMPTS WILL  35940075
359500***** BE MADE TO DETERMINE A UNIQUE RANDOM PAYT-REQ-SEQ-NBR       35950075
359600                                                                  35960075
359700     SET INSERT-NOT-SUCCESSFUL TO TRUE.                           35970075
359800                                                                  35980075
359900     PERFORM WITH TEST AFTER                                      35990075
360000             VARYING WS-INSERT-INVC-RETRY-COUNTER FROM 1 BY 1     36000075
360100             UNTIL   WS-INSERT-INVC-RETRY-COUNTER > 100           36010075
360200                OR   INSERT-SUCCESSFUL                            36020075
360300                                                                  36030075
360310             PERFORM G150-GET-CURRENT-TIMESTAMP                   36031099
360340             MOVE INVOIC-PAYT-REQ-SEQ-NBR                         36034099
360341                                  TO PV-PAYT-REQ-SEQ-NBR-9        36034199
360350             MOVE PV-PAYT-REQ-SEQ-NBR-X   TO INVOIC-INVC-ID       36035099
360360                                                                  36036099
360400             EXEC SQL                                             36040075
360500                 INSERT INTO TINVOIC                              36050075
360600                    ( PO_NBR                                      36060074
360700                     ,INVC_ID                                     36070074
360800                     ,PAYT_REQ_SEQ_NBR                            36080074
360900                     ,INVC_TYP_CDE                                36090074
361000                     ,ENTR_MTHD_CDE                               36100074
361100                     ,CRE_BY_USR_ID                               36110074
361200                     ,BAR_CDE                                     36120074
361300                     ,SPLIT_TERMS_IND                             36130074
361400                     ,DTL_ENTR_IND                                36140074
361500                     ,INVC_CART_CT                                36150074
361600                     ,CRE_DTE                                     36160074
361700                     ,PPD_RVRSL_IND                               36170074
361800                     ,INVC_DTE                                    36180074
361900                     ,GRO_COST_AMT                                36190074
362000                     ,INVC_NET_COST_AMT                           36200074
362100                     ,RMIT_VND_ID                                 36210074
362200                     ,STR_NBR                                     36220074
362300                     ,HOLD_IND                                    36230074
362400                     ,DUE_DTE_SRC_CDE                             36240074
362500                     ,CALC_DUE_DTE                                36250074
362600                     ,PAYT_DTE                                    36260074
362700                     ,AP_PRC_DTE                                  36270074
362800                     ,AP_PRC_CDE                                  36280074
362900                     ,PAYT_RLSE_TMST                              36290074
363000                     ,STATUS_CDE                                  36300074
363100                     ,STATUS_CHG_TMST                             36310074
363200                     ,DC_NBR                                      36320074
363300                     ,MTCH_LVL_CDE)                               36330074
363400                 VALUES                                           36340075
363500                     (:INVOIC-PO-NBR                              36350074
363600                     ,:INVOIC-INVC-ID                             36360074
363700                     ,:INVOIC-PAYT-REQ-SEQ-NBR                    36370074
363800                     ,:INVOIC-INVC-TYP-CDE                        36380074
363900                     ,:INVOIC-ENTR-MTHD-CDE                       36390074
364000                     ,:INVOIC-CRE-BY-USR-ID                       36400074
364100                     ,:INVOIC-BAR-CDE                             36410074
364200                     ,:INVOIC-SPLIT-TERMS-IND                     36420074
364300                     ,:INVOIC-DTL-ENTR-IND                        36430074
364400                     ,:INVOIC-INVC-CART-CT                        36440074
364500                     ,:INVOIC-CRE-DTE                             36450074
364600                     ,:INVOIC-PPD-RVRSL-IND                       36460074
364700                     ,:INVOIC-INVC-DTE                            36470074
364800                     ,:INVOIC-GRO-COST-AMT                        36480074
364900                     ,:INVOIC-INVC-NET-COST-AMT                   36490074
365000                     ,:INVOIC-RMIT-VND-ID                         36500074
365100                     ,:INVOIC-STR-NBR                             36510074
365200                     ,:INVOIC-HOLD-IND                            36520074
365300                     ,:INVOIC-DUE-DTE-SRC-CDE                     36530074
365400                     ,:INVOIC-CALC-DUE-DTE                        36540074
365500                     ,:INVOIC-PAYT-DTE                            36550074
365600                     ,:INVOIC-AP-PRC-DTE                          36560074
365700                     ,:INVOIC-AP-PRC-CDE                          36570074
365800                     ,:INVOIC-PAYT-RLSE-TMST                      36580074
365900                     ,:INVOIC-STATUS-CDE                          36590074
366000                     ,:CURR-TIMESTAMP                             36600074
366100                     ,:INVOIC-DC-NBR                              36610074
366200                     ,:INVOIC-MTCH-LVL-CDE)                       36620074
366300             END-EXEC                                             36630075
366400                                                                  36640074
366500             EVALUATE TRUE                                        36650075
366600                 WHEN SQLCODE = ZERO                              36660075
366700                      SET INSERT-SUCCESSFUL TO TRUE               36670075
366800                 WHEN SQLCODE = -904                              36680075
366900                 WHEN SQLCODE = -913                              36690075
367000                      CONTINUE                                    36700075
367100                                                                  36710075
367200                 WHEN SQLCODE = -803                              36720075
367300                      MOVE WS-INSERT-INVC-RETRY-COUNTER TO        36730075
367400                                    WS-DISPLAY-RETRY-COUNTER      36740075
367500                      DISPLAY 'DUPLICATE INVOIC:'                 36750075
367600                          ' PO: ' INVOIC-PO-NBR                   36760075
367700                          ' INVC ID: ' INVOIC-INVC-ID             36770075
367800                          ' PAYREQ: ' INVOIC-PAYT-REQ-SEQ-NBR     36780075
367900                          ' RETRY#: ' WS-DISPLAY-RETRY-COUNTER    36790075
368000                      PERFORM G150-GET-CURRENT-TIMESTAMP          36800075
368100                                                                  36810075
368200                 WHEN SQLWARN0 NOT = SPACES                       36820075
368300                 WHEN SQLCODE  NOT = ZERO                         36830075
368400                      MOVE PV-CURRENT-PARAGRAPH                   36840075
368500                                    TO AA-PARAGRAPH-NAME          36850075
368600                      MOVE 'UNSUCCESSFUL INSERT: TINVOIC'         36860075
368700                                    TO AA-DB2-OPERATION           36870075
368800                      MOVE 'TINVOIC'                              36880075
368900                                    TO AA-DB2-TABLE-1             36890075
369000                      PERFORM Z998-DB2-ABEND                      36900075
369100             END-EVALUATE                                         36910075
369200     END-PERFORM.                                                 36920075
369300                                                                  36930075
369400     IF WS-INSERT-INVC-RETRY-COUNTER > 100                        36940075
369500        MOVE PV-CURRENT-PARAGRAPH   TO AA-PARAGRAPH-NAME          36950078
369700        MOVE 'MAX RETRIES EXCEEDED ON INSERT TINVOIC ROW'         36970078
369800                                    TO AA-DB2-OPERATION           36980075
369900        MOVE 'TINVOIC'              TO AA-DB2-TABLE-1             36990078
370100        PERFORM Z998-DB2-ABEND                                    37010075
370200     END-IF.                                                      37020075
370300                                                                  37030075
370400     EVALUATE TRUE                                                37040075
370500       WHEN SQLCODE = +0                                          37050075
370600         CONTINUE                                                 37060075
370700       WHEN SQLWARN0 NOT = SPACES                                 37070075
370800       WHEN SQLCODE  NOT = ZERO                                   37080075
370900         MOVE PV-CURRENT-PARAGRAPH  TO AA-PARAGRAPH-NAME          37090075
371000         MOVE 'UNSUCCESSFUL INSERT: TINVOIC' TO AA-DB2-OPERATION  37100075
371100         MOVE 'TINVOIC'             TO AA-DB2-TABLE-1             37110075
371200         PERFORM Z998-DB2-ABEND                                   37120075
371300     END-EVALUATE.                                                37130075
371400                                                                  37140075
371500*--------------------------------------------------------------*  37150075
371600* INSERTS REMAINDER ROW TO TMDINVC                             *  37160075
371700*--------------------------------------------------------------*  37170075
371800 U220-INSERT-TMDINVC.                                             37180075
371900                                                                  37190075
372000     MOVE 'U220-INSERT-TMDINVC' TO PV-CURRENT-PARAGRAPH.          37200075
372100                                                                  37210075
372200     EXEC SQL                                                     37220075
372300          INSERT INTO TMDINVC                                     37230075
372400                    ( PO_NBR                                      37240075
372500                     ,INVC_ID                                     37250075
372600                     ,BOL_ID                                      37260075
372700                     ,VEND_FRGT_PCT                               37270075
372800                     ,KOHLS_FRGT_PCT                              37280075
372900                     ,TERM_SEL_CDE                                37290075
373000                     ,TOT_INVC_PC_QTY                             37300075
373100                     ,IMPRT_CHRG_PRC_CDE                          37310075
373200                     ,PAYT_REQ_SEQ_NBR )                          37320075
373300          VALUES                                                  37330075
373400                     (:MDINVC-PO-NBR                              37340075
373500                     ,:MDINVC-INVC-ID                             37350075
373600                     ,:MDINVC-BOL-ID                              37360075
373700                     ,:MDINVC-VEND-FRGT-PCT                       37370075
373800                     ,:MDINVC-KOHLS-FRGT-PCT                      37380075
373900                     ,:MDINVC-TERM-SEL-CDE                        37390075
374000                     ,:MDINVC-TOT-INVC-PC-QTY                     37400075
374100                     ,:MDINVC-IMPRT-CHRG-PRC-CDE                  37410075
374200                     ,:MDINVC-PAYT-REQ-SEQ-NBR)                   37420075
374300     END-EXEC.                                                    37430075
374400                                                                  37440075
374500     EVALUATE TRUE                                                37450075
374600         WHEN SQLCODE = +0                                        37460075
374700              CONTINUE                                            37470075
374800                                                                  37480075
374900             WHEN SQLWARN0 NOT = SPACES                           37490075
375000             WHEN SQLCODE  NOT = ZERO                             37500075
375100                 MOVE PV-CURRENT-PARAGRAPH                        37510075
375200                                     TO AA-PARAGRAPH-NAME         37520075
375300                 MOVE 'UNSUCCESSFUL INSERT: TMDINVC'              37530075
375400                                     TO AA-DB2-OPERATION          37540075
375500                 MOVE 'TMDINVC'      TO AA-DB2-TABLE-1            37550075
375600                 PERFORM Z998-DB2-ABEND                           37560075
375700     END-EVALUATE.                                                37570075
375800                                                                  37580075
375900*--------------------------------------------------------------*  37590075
376000* INSERTS REMAINDER ROW TO TINVCTM                             *  37600075
376100*--------------------------------------------------------------*  37610075
376200 U230-INSERT-TINVCTM.                                             37620075
376300                                                                  37630075
376400     MOVE 'U230-INSERT-TINVCTM' TO PV-CURRENT-PARAGRAPH.          37640075
376500                                                                  37650075
376600     EXEC SQL                                                     37660075
376700          INSERT INTO TINVCTM                                     37670075
376800                  (PO_NBR                                         37680075
376900                  ,INVC_ID                                        37690075
377000                  ,TERM_SEQ_NBR                                   37700075
377100                  ,TERM_TYP_CDE                                   37710075
377200                  ,TERM_BASIS_DTE_CDE                             37720075
377300                  ,EFF_DTE                                        37730075
377400                  ,DISC_PCT                                       37740075
377500                  ,DISC_AMT                                       37750075
377600                  ,DISC_DUE_DTE                                   37760075
377700                  ,DISC_DUE_DAY_QTY                               37770075
377800                  ,NET_DUE_DTE                                    37780075
377900                  ,NET_DUE_DAY_QTY                                37790075
378000                  ,EXTD_DAYS_QTY                                  37800075
378100                  )                                               37810075
378200          VALUES ( :INVCTM-PO-NBR                                 37820075
378300                  ,:INVCTM-INVC-ID                                37830075
378400                  ,:INVCTM-TERM-SEQ-NBR                           37840075
378500                  ,:INVCTM-TERM-TYP-CDE                           37850075
378600                  ,:INVCTM-TERM-BASIS-DTE-CDE                     37860075
378700                  ,:INVCTM-EFF-DTE                                37870075
378800                  ,:INVCTM-DISC-PCT                               37880075
378900                  ,:INVCTM-DISC-AMT                               37890075
379000                  ,:INVCTM-DISC-DUE-DTE                           37900075
379100                  ,:INVCTM-DISC-DUE-DAY-QTY                       37910075
379200                  ,:INVCTM-NET-DUE-DTE                            37920075
379300                  ,:INVCTM-NET-DUE-DAY-QTY                        37930075
379400                  ,:INVCTM-EXTD-DAYS-QTY                          37940075
379500                  )                                               37950075
379600     END-EXEC.                                                    37960075
379700                                                                  37970075
379800     EVALUATE TRUE                                                37980075
379900         WHEN SQLCODE = +0                                        37990075
380000              CONTINUE                                            38000075
380100                                                                  38010075
380200             WHEN SQLWARN0 NOT = SPACES                           38020075
380300             WHEN SQLCODE  NOT = ZERO                             38030075
380400                 MOVE PV-CURRENT-PARAGRAPH                        38040075
380500                                     TO AA-PARAGRAPH-NAME         38050075
380600                 MOVE 'UNSUCCESSFUL INSERT: TINVCTM'              38060075
380700                                     TO AA-DB2-OPERATION          38070075
380800                 MOVE 'TINVCTM'      TO AA-DB2-TABLE-1            38080075
380900                 PERFORM Z998-DB2-ABEND                           38090075
381000     END-EVALUATE.                                                38100075
381100                                                                  38110075
381200*--------------------------------------------------------------*  38120075
381300* INSERTS REMAINDER ROW TO TALCHRG                             *  38130075
381400*--------------------------------------------------------------*  38140075
381500 U240-INSERT-TALCHRG.                                             38150075
381600                                                                  38160075
381700     MOVE 'U240-INSERT-TALCHRG' TO PV-CURRENT-PARAGRAPH.          38170075
381800                                                                  38180075
381900     EXEC SQL                                                     38190075
382000          INSERT INTO TALCHRG                                     38200075
382100                 ( PO_NBR                                         38210075
382200                  ,INVC_ID                                        38220075
382300                  ,ALW_CHRG_SEQ_NBR                               38230075
382400                  ,ALW_CHRG_TYP_CDE                               38240075
382500                  ,ALW_CHRG_CDE                                   38250075
382600                  ,ALW_CHRG_SER_CDE                               38260075
382700                  ,ALW_CHRG_PCT                                   38270075
382800                  ,ALW_CHRG_AMT )                                 38280075
382900          VALUES ( :ALCHRG-PO-NBR                                 38290075
383000                  ,:ALCHRG-INVC-ID                                38300075
383100                  ,:ALCHRG-ALW-CHRG-SEQ-NBR                       38310075
383200                  ,:ALCHRG-ALW-CHRG-TYP-CDE                       38320075
383300                  ,:ALCHRG-ALW-CHRG-CDE                           38330075
383400                  ,:ALCHRG-ALW-CHRG-SER-CDE                       38340075
383500                  ,:ALCHRG-ALW-CHRG-PCT                           38350075
383600                  ,:ALCHRG-ALW-CHRG-AMT )                         38360075
383700     END-EXEC                                                     38370075
383800                                                                  38380075
383900     EVALUATE TRUE                                                38390075
384000         WHEN SQLCODE = +0                                        38400075
384100              CONTINUE                                            38410075
384200                                                                  38420075
384300             WHEN SQLWARN0 NOT = SPACES                           38430075
384400             WHEN SQLCODE  NOT = ZERO                             38440075
384500                 MOVE PV-CURRENT-PARAGRAPH                        38450075
384600                                     TO AA-PARAGRAPH-NAME         38460075
384700                 MOVE 'UNSUCCESSFUL INSERT: TALCHRG'              38470075
384800                                     TO AA-DB2-OPERATION          38480075
384900                 MOVE 'TALCHRG'      TO AA-DB2-TABLE-1            38490075
385000                 PERFORM Z998-DB2-ABEND                           38500075
385100     END-EVALUATE.                                                38510075
385200                                                                  38520075
385300*--------------------------------------------------------------*  38530075
385400* INSERTS REMAINDER ROW TO TPREQIT                             *  38540075
385500*--------------------------------------------------------------*  38550075
385600 U300-INSERT-TPREQIT.                                             38560075
385700                                                                  38570075
385800     MOVE 'U300-INSERT-TPREQIT' TO PV-CURRENT-PARAGRAPH.          38580075
385900                                                                  38590075
386000     PERFORM U310-GET-MAX-LNE-NBR.                                38600075
386100                                                                  38610075
386200     EXEC SQL                                                     38620075
386300          INSERT INTO TPREQIT                                     38630075
386400                  ( PAYT_REQ_SEQ_NBR                              38640075
386500                   ,PAYT_REQ_LNE_NBR                              38650075
386600                   ,PAY_REQ_LNE_QTY                               38660075
386700                   ,QTY_UNT_OF_MSMT                               38670075
386800                   ,UNT_COST_AMT)                                 38680075
386900          VALUES ( :PREQIT-PAYT-REQ-SEQ-NBR                       38690075
387000                  ,:PREQIT-PAYT-REQ-LNE-NBR                       38700075
387100                  ,:PREQIT-PAY-REQ-LNE-QTY                        38710075
387200                  ,:PREQIT-QTY-UNT-OF-MSMT                        38720075
387300                  ,:PREQIT-UNT-COST-AMT)                          38730075
387400     END-EXEC.                                                    38740075
387500                                                                  38750075
387600     EVALUATE TRUE                                                38760075
387700         WHEN SQLCODE = +0                                        38770075
387800              CONTINUE                                            38780075
387900                                                                  38790075
388000             WHEN SQLWARN0 NOT = SPACES                           38800075
388100             WHEN SQLCODE  NOT = ZERO                             38810075
388200                 MOVE PV-CURRENT-PARAGRAPH                        38820075
388300                                     TO AA-PARAGRAPH-NAME         38830075
388400                 MOVE 'UNSUCCESSFUL INSERT: TPREQIT'              38840075
388500                                     TO AA-DB2-OPERATION          38850075
388600                 MOVE 'TPREQIT'      TO AA-DB2-TABLE-1            38860075
388700                 PERFORM Z998-DB2-ABEND                           38870075
388800     END-EVALUATE.                                                38880075
388900                                                                  38890075
389000*--------------------------------------------------------------*  38900075
389100* RETRIEVES THE GREATEST PAY REQ LINE NUMBER FOR NEW PREQIT    *  38910075
389200*--------------------------------------------------------------*  38920075
389300 U310-GET-MAX-LNE-NBR.                                            38930075
389400                                                                  38940075
389500     MOVE 'U310-GET-MAX-LNE-NBR' TO PV-CURRENT-PARAGRAPH.         38950075
389600                                                                  38960075
389700     EXEC SQL                                                     38970075
389800       SELECT  MAX(PAYT_REQ_LNE_NBR)                              38980075
389900        INTO   :PREQIT-PAYT-REQ-LNE-NBR                           38990075
390000         FROM   TPREQIT                                           39000075
390100        WHERE   PAYT_REQ_SEQ_NBR = :INVOIC-PAYT-REQ-SEQ-NBR       39010075
390200     END-EXEC.                                                    39020075
390300                                                                  39030075
390400     EVALUATE TRUE                                                39040075
390500         WHEN SQLCODE = +0                                        39050075
390600             ADD  +1 TO PREQIT-PAYT-REQ-LNE-NBR                   39060075
390700                                                                  39070075
390800         WHEN SQLCODE = -305                                      39080075
390900             MOVE +1 TO PREQIT-PAYT-REQ-LNE-NBR                   39090075
391000                                                                  39100075
391100         WHEN SQLWARN0 NOT = SPACES                               39110075
391200         WHEN SQLCODE  NOT = ZERO                                 39120075
391300             MOVE PV-CURRENT-PARAGRAPH                            39130075
391400                                 TO AA-PARAGRAPH-NAME             39140075
391500             MOVE 'UNSUCCESSFUL SELECT: TPREQIT'                  39150075
391600                                 TO AA-DB2-OPERATION              39160075
391700             MOVE 'TPREQIT'      TO AA-DB2-TABLE-1                39170075
391800             PERFORM Z998-DB2-ABEND                               39180075
391900     END-EVALUATE.                                                39190075
392000                                                                  39200075
392100*--------------------------------------------------------------*  39210075
392200* INSERTS REMAINDER ROW TO TMIITEM                             *  39220075
392300*--------------------------------------------------------------*  39230075
392400 U400-INSERT-TMIITEM.                                             39240075
392500                                                                  39250075
392600     MOVE 'U400-INSERT-TMIITEM' TO PV-CURRENT-PARAGRAPH.          39260075
392700                                                                  39270075
392800     EXEC SQL                                                     39280075
392900          INSERT INTO TMIITEM                                     39290075
393000                  ( PAYT_REQ_SEQ_NBR                              39300075
393100                   ,PAYT_REQ_LNE_NBR                              39310075
393200                   ,UNT_COST_SEL_CDE                              39320075
393300                   ,PO_NBR                                        39330075
393400                   ,VER_NBR                                       39340075
393500                   ,PO_LNE_NBR)                                   39350075
393600          VALUES ( :MIITEM-PAYT-REQ-SEQ-NBR                       39360075
393700                  ,:MIITEM-PAYT-REQ-LNE-NBR                       39370075
393800                  ,:MIITEM-UNT-COST-SEL-CDE                       39380075
393900                  ,:MIITEM-PO-NBR                                 39390075
394000                  ,:MIITEM-VER-NBR                                39400075
394100                      :MIITEM-VER-NBR-NN                          39410075
394200                  ,:MIITEM-PO-LNE-NBR                             39420075
394300                      :MIITEM-PO-LNE-NBR-NN )                     39430075
394400     END-EXEC.                                                    39440075
394500                                                                  39450075
394600     EVALUATE TRUE                                                39460075
394700         WHEN SQLCODE = +0                                        39470075
394800              CONTINUE                                            39480075
394900                                                                  39490075
395000             WHEN SQLWARN0 NOT = SPACES                           39500075
395100             WHEN SQLCODE  NOT = ZERO                             39510075
395200                 MOVE PV-CURRENT-PARAGRAPH                        39520075
395300                                     TO AA-PARAGRAPH-NAME         39530075
395400                 MOVE 'UNSUCCESSFUL INSERT: TMIITEM'              39540075
395500                                     TO AA-DB2-OPERATION          39550075
395600                 MOVE 'TMIITEM'      TO AA-DB2-TABLE-1            39560075
395700                 PERFORM Z998-DB2-ABEND                           39570075
395800     END-EVALUATE.                                                39580075
395900                                                                  39590075
396000*--------------------------------------------------------------*  39600075
396100* UPDATES THE GROSS COST ON THE REMAINDER INVOICE HEADER       *  39610075
396200* AFTER ALL REMAINDER ITEMS HAVE BEEN ADDED.                   *  39620075
396300*--------------------------------------------------------------*  39630075
396400 U500-UPDATE-TINVOIC-COST.                                        39640075
396500                                                                  39650075
396600     MOVE 'U500-UPDATE-TINVOIC-COST' TO PV-CURRENT-PARAGRAPH.     39660075
396700                                                                  39670075
396800     EXEC SQL                                                     39680075
396900         UPDATE TINVOIC                                           39690075
397000            SET GRO_COST_AMT      = :INVOIC-GRO-COST-AMT          39700075
397100               ,INVC_NET_COST_AMT = :INVOIC-INVC-NET-COST-AMT     39710075
397200          WHERE PO_NBR            = :INVOIC-PO-NBR                39720075
397300            AND INVC_ID           = :INVOIC-INVC-ID               39730075
397400     END-EXEC.                                                    39740075
397500                                                                  39750075
397600     EVALUATE TRUE                                                39760075
397700         WHEN SQLCODE = ZERO                                      39770075
397800              CONTINUE                                            39780075
397900                                                                  39790075
398000         WHEN SQLWARN0 NOT = SPACES                               39800075
398100         WHEN SQLCODE  NOT = ZERO                                 39810075
398200             MOVE PV-CURRENT-PARAGRAPH                            39820075
398300                                 TO AA-PARAGRAPH-NAME             39830075
398400             MOVE 'UNSUCCESSFUL UPDATE: TINVOIC COST'             39840075
398500                                 TO AA-DB2-OPERATION              39850075
398600             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                39860075
398700             PERFORM Z998-DB2-ABEND                               39870075
398800     END-EVALUATE.                                                39880075
398900                                                                  39890075
399000*--------------------------------------------------------------*  39900075
399100* UPDATES THE TOTAL QTY ON THE REMAINDER INVOICE HEADER        *  39910075
399200* AFTER ALL REMAINDER ITEMS HAVE BEEN ADDED.                   *  39920075
399300*--------------------------------------------------------------*  39930075
399400 U510-UPDATE-TMDINVC-QTY.                                         39940075
399500                                                                  39950075
399600     MOVE 'U510-UPDATE-TMDINVC-QTY' TO PV-CURRENT-PARAGRAPH.      39960075
399700                                                                  39970075
399800     EXEC SQL                                                     39980075
399900         UPDATE TMDINVC                                           39990075
400000            SET TOT_INVC_PC_QTY  = :MDINVC-TOT-INVC-PC-QTY        40000075
400100          WHERE PO_NBR           = :MDINVC-PO-NBR                 40010075
400200            AND INVC_ID          = :MDINVC-INVC-ID                40020075
400300     END-EXEC.                                                    40030075
400400                                                                  40040075
400500     EVALUATE TRUE                                                40050075
400600         WHEN SQLCODE = ZERO                                      40060075
400700              CONTINUE                                            40070075
400800                                                                  40080075
400900         WHEN SQLWARN0 NOT = SPACES                               40090075
401000         WHEN SQLCODE  NOT = ZERO                                 40100075
401100             MOVE PV-CURRENT-PARAGRAPH                            40110075
401200                                 TO AA-PARAGRAPH-NAME             40120075
401300             MOVE 'UNSUCCESSFUL UPDATE: TMDINVC QTY'              40130075
401400                                 TO AA-DB2-OPERATION              40140075
401500             MOVE 'TMDINVC'      TO AA-DB2-TABLE-1                40150075
401600             PERFORM Z998-DB2-ABEND                               40160075
401700     END-EVALUATE.                                                40170075
401800                                                                  40180075
401900*--------------------------------------------------------------*  40190075
402000* THE PROCESS CODE IS SET TO 'M' (MATCHED) AND THE PROCESS     *  40200075
402100* DATE IS UPDATED ON TRECEIV FOR BULK POS.                     *  40210075
402200*--------------------------------------------------------------*  40220075
402300 U700-UPDATE-TRECEIV.                                             40230075
402400                                                                  40240075
402500     MOVE 'U700-UPDATE-TRECEIV'     TO PV-CURRENT-PARAGRAPH.      40250075
402600                                                                  40260075
402700     MOVE T-ORD-NBR     (RC-IDX)    TO RECEIV-ORD-NBR.            40270075
402800     MOVE T-REC-SEQ-NBR (RC-IDX)    TO RECEIV-REC-SEQ-NBR.        40280075
402900     MOVE T-CRE-TMST    (RC-IDX)    TO RECEIV-CRE-TMST.           40290075
403000                                                                  40300075
403100     EXEC SQL                                                     40310075
403200         UPDATE TRECEIV                                           40320075
403300            SET AP_PRC_CDE       = 'M'                            40330075
403400               ,AP_PRC_DTE       = :CURR-DATE                     40340075
403500          WHERE ORD_NBR          = :RECEIV-ORD-NBR                40350075
403600            AND REC_SEQ_NBR      = :RECEIV-REC-SEQ-NBR            40360075
403700            AND CRE_TMST         = :RECEIV-CRE-TMST               40370075
403800     END-EXEC.                                                    40380075
403900                                                                  40390075
404000     EVALUATE TRUE                                                40400075
404100         WHEN SQLCODE = ZERO                                      40410075
404200              CONTINUE                                            40420075
404300                                                                  40430075
404400         WHEN SQLWARN0 NOT = SPACES                               40440075
404500         WHEN SQLCODE  NOT = ZERO                                 40450075
404600             MOVE PV-CURRENT-PARAGRAPH                            40460075
404700                                 TO AA-PARAGRAPH-NAME             40470075
404800             MOVE 'UNSUCCESSFUL UPDATE: TRECEIV'                  40480075
404900                                 TO AA-DB2-OPERATION              40490075
405000             MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                40500075
405100             PERFORM Z998-DB2-ABEND                               40510075
405200     END-EVALUATE.                                                40520075
405300                                                                  40530075
405400*--------------------------------------------------------------*  40540075
405500* THE PROCESS CODE IS SET TO 'M' (MATCHED) AND THE PROCESS     *  40550075
405600* DATE IS UPDATED ON TRECDIS FOR BY STORE POS.                 *  40560075
405700*--------------------------------------------------------------*  40570075
405800 U710-UPDATE-TRECDIS.                                             40580075
405900                                                                  40590075
406000     MOVE 'U710-UPDATE-TRECDIS'     TO PV-CURRENT-PARAGRAPH.      40600075
406100                                                                  40610075
406200     MOVE DK-PO-NBR                 TO RECDIS-ORD-NBR.            40620075
406300     MOVE T-RD-REC-SEQ-NBR (RD-IDX) TO RECDIS-REC-SEQ-NBR.        40630075
406400     MOVE T-RD-ORD-LNE-NBR (RD-IDX) TO RECDIS-ORD-LNE-NBR.        40640075
406500     MOVE T-RD-OPER-UNT-ID (RD-IDX) TO RECDIS-OPER-UNT-ID.        40650075
406600     MOVE T-RD-FCLTY-ID    (RD-IDX) TO RECDIS-FCLTY-ID.           40660075
406700     MOVE T-RD-STR-NBR     (RD-IDX) TO RECDIS-STR-NBR.            40670075
406800     MOVE T-RD-STR-FCLTY-ID(RD-IDX) TO RECDIS-STR-FCLTY-ID.       40680075
406900     MOVE T-RD-CRE-TMST    (RD-IDX) TO RECDIS-CRE-TMST.           40690075
407000                                                                  40700075
407100     EXEC SQL                                                     40710075
407200         UPDATE TRECDIS                                           40720075
407300            SET AP_PRC_CDE       = 'M'                            40730075
407400               ,AP_PRC_DTE       = :CURR-DATE                     40740075
407500          WHERE ORD_NBR          = :RECDIS-ORD-NBR                40750075
407600            AND REC_SEQ_NBR      = :RECDIS-REC-SEQ-NBR            40760075
407700            AND ORD_LNE_NBR      = :RECDIS-ORD-LNE-NBR            40770075
407800            AND OPER_UNT_ID      = :RECDIS-OPER-UNT-ID            40780075
407900            AND FCLTY_ID         = :RECDIS-FCLTY-ID               40790075
408000            AND STR_NBR          = :RECDIS-STR-NBR                40800075
408100            AND STR_FCLTY_ID     = :RECDIS-STR-FCLTY-ID           40810075
408200            AND CRE_TMST         = :RECDIS-CRE-TMST               40820075
408300     END-EXEC.                                                    40830075
408400                                                                  40840075
408500     EVALUATE TRUE                                                40850075
408600         WHEN SQLCODE = ZERO                                      40860075
408700              CONTINUE                                            40870075
408800                                                                  40880075
408900         WHEN SQLWARN0 NOT = SPACES                               40890075
409000         WHEN SQLCODE  NOT = ZERO                                 40900075
409100             MOVE PV-CURRENT-PARAGRAPH                            40910075
409200                                 TO AA-PARAGRAPH-NAME             40920075
409300             MOVE 'UNSUCCESSFUL UPDATE: TRECDIS'                  40930075
409400                                 TO AA-DB2-OPERATION              40940075
409500             MOVE 'TRECDIS'      TO AA-DB2-TABLE-1                40950075
409600             PERFORM Z998-DB2-ABEND                               40960075
409700     END-EVALUATE.                                                40970075
409800                                                                  40980075
409900*--------------------------------------------------------------*  40990075
410000* THE STATUS CODE IS SET TO 'M' (MATCHED) AND THE PAYMENT      *  41000075
410100* RELEASE TIMESTAMP IS SET ON TNINREC FOR RECONCILED NRS.      *  41010075
410200*--------------------------------------------------------------*  41020075
410300 U720-UPDATE-TNINREC.                                             41030075
410400                                                                  41040075
410500     MOVE 'U720-UPDATE-TNINREC'     TO PV-CURRENT-PARAGRAPH.      41050075
410600                                                                  41060075
410700     MOVE T-NI-PO-LNE-NBR       (NI-IDX) TO NINREC-PO-LNE-NBR.    41070075
410800     MOVE T-NI-NON-INVC-SEQ-NBR (NI-IDX) TO                       41080075
410900                                          NINREC-NON-INVC-SEQ-NBR.41090075
411000                                                                  41100075
411100     EXEC SQL                                                     41110075
411200         UPDATE TNINREC                                           41120075
411300            SET STATUS_CDE       = 'M'                            41130075
411400               ,PAYT_RLSE_TMST   = :CURR-TIMESTAMP                41140075
411500          WHERE PO_NBR           = :DK-PO-NBR                     41150075
411600            AND PO_LNE_NBR       = :NINREC-PO-LNE-NBR             41160075
411700            AND NON_INVC_SEQ_NBR = :NINREC-NON-INVC-SEQ-NBR       41170075
411800     END-EXEC.                                                    41180075
411900                                                                  41190075
412000     EVALUATE TRUE                                                41200075
412100         WHEN SQLCODE = ZERO                                      41210075
412200              CONTINUE                                            41220075
412300                                                                  41230075
412400         WHEN SQLWARN0 NOT = SPACES                               41240075
412500         WHEN SQLCODE  NOT = ZERO                                 41250075
412600             MOVE PV-CURRENT-PARAGRAPH                            41260075
412700                                 TO AA-PARAGRAPH-NAME             41270075
412800             MOVE 'UNSUCCESSFUL UPDATE: TNINREC'                  41280075
412900                                 TO AA-DB2-OPERATION              41290075
413000             MOVE 'TNINREC'      TO AA-DB2-TABLE-1                41300075
413100             PERFORM Z998-DB2-ABEND                               41310075
413200     END-EVALUATE.                                                41320075
413300                                                                  41330075
413400*--------------------------------------------------------------*  41340075
413500* THE STATUS CODE IS SET TO 'RL' (RELEASED) AND THE PAYMENT    *  41350075
413600* RELEASE TIMESTAMP AND STATUS CHANGE TIMESTAMP ARE SET ON     *  41360075
413700* TINVOIC FOR INVOICES THAT HAVE BEEN RECONCILED.              *  41370075
413800*--------------------------------------------------------------*  41380075
413900 U800-UPDATE-TINVOIC.                                             41390075
414000                                                                  41400075
414100     MOVE 'U800-UPDATE-TINVOIC'     TO PV-CURRENT-PARAGRAPH.      41410075
414200                                                                  41420075
414300     MOVE DK-PO-NBR                 TO INVOIC-PO-NBR.             41430075
414400     MOVE IA-INVOICE-ID (IA-SUB)    TO INVOIC-INVC-ID.            41440075
414500                                                                  41450075
414600     EXEC SQL                                                     41460075
414700         UPDATE TINVOIC                                           41470075
414800            SET STATUS_CDE       = 'RL'                           41480075
414900               ,PAYT_RLSE_TMST   = :CURR-TIMESTAMP                41490075
415000               ,STATUS_CHG_TMST  = :CURR-TIMESTAMP                41500075
415100          WHERE PO_NBR           = :INVOIC-PO-NBR                 41510075
415200            AND INVC_ID          = :INVOIC-INVC-ID                41520075
415300     END-EXEC.                                                    41530075
415400                                                                  41540075
415500     EVALUATE TRUE                                                41550075
415600         WHEN SQLCODE = ZERO                                      41560075
415700              CONTINUE                                            41570075
415800                                                                  41580075
415900         WHEN SQLWARN0 NOT = SPACES                               41590075
416000         WHEN SQLCODE  NOT = ZERO                                 41600075
416100             MOVE PV-CURRENT-PARAGRAPH                            41610075
416200                                 TO AA-PARAGRAPH-NAME             41620075
416300             MOVE 'UNSUCCESSFUL UPDATE: TINVOIC'                  41630075
416400                                 TO AA-DB2-OPERATION              41640075
416500             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                41650075
416600             PERFORM Z998-DB2-ABEND                               41660075
416700     END-EVALUATE.                                                41670075
416800                                                                  41680075
416900*--------------------------------------------------------------*  41690075
417000* A ROW IS INSERTED INTO TPRCCLM                               *  41700075
417100*--------------------------------------------------------------*  41710075
417200 U900-INSERT-TPRCCLM.                                             41720075
417300                                                                  41730075
417400     MOVE 'U900-UPDATE-TPRCCLM'     TO PV-CURRENT-PARAGRAPH.      41740075
417500                                                                  41750075
417600     EXEC SQL                                                     41760075
417700          INSERT INTO TPRCCLM                                     41770075
417800                ( PO_NBR                                          41780075
417900                 ,STR_NBR                                         41790075
418000                 ,INVC_ID                                         41800075
418100                 ,PO_LNE_NBR                                      41810075
418200                 ,PRCCLM_SEQ_NBR                                  41820075
418300                 ,DOC_TYP_CDE                                     41830075
418400                 ,UNT_QTY                                         41840075
418500                 ,UNT_COST_AMT                                    41850075
418600                 ,ADJ_COST_AMT                                    41860075
418700                 ,PAYT_RLSE_TMST                                  41870075
418800                )                                                 41880075
418900         VALUES (:PRCCLM-PO-NBR                                   41890075
419000                ,:PRCCLM-STR-NBR                                  41900075
419100                ,:PRCCLM-INVC-ID                                  41910075
419200                ,:PRCCLM-PO-LNE-NBR                               41920075
419300                ,:PRCCLM-PRCCLM-SEQ-NBR                           41930075
419400                ,:PRCCLM-DOC-TYP-CDE                              41940075
419500                ,:PRCCLM-UNT-QTY                                  41950075
419600                ,:PRCCLM-UNT-COST-AMT                             41960075
419700                ,:PRCCLM-ADJ-COST-AMT                             41970075
419800                ,:PRCCLM-PAYT-RLSE-TMST                           41980075
419900                )                                                 41990075
420000     END-EXEC.                                                    42000075
420100                                                                  42010075
420200     EVALUATE TRUE                                                42020075
420300         WHEN SQLCODE = +0                                        42030075
420400              CONTINUE                                            42040075
420500                                                                  42050075
420600             WHEN SQLWARN0 NOT = SPACES                           42060075
420700             WHEN SQLCODE  NOT = ZERO                             42070075
420800                 MOVE PV-CURRENT-PARAGRAPH                        42080075
420900                                     TO AA-PARAGRAPH-NAME         42090075
421000                 MOVE 'UNSUCCESSFUL INSERT: TPRCCLM'              42100075
421100                                     TO AA-DB2-OPERATION          42110075
421200                 MOVE 'TPRCCLM'      TO AA-DB2-TABLE-1            42120075
421300                 PERFORM Z998-DB2-ABEND                           42130075
421400     END-EVALUATE.                                                42140075
421500                                                                  42150075
421600*-------------------------------------------------------------*   42160075
421700* FOR PO/STORES THAT HAVE BEEN RECONCILED, THE ROW ON TPOSTRR *   42170075
421800* IS UPDATED:  THE STATUS CODE IS SET TO ' ' FOR PROCESSING,  *   42180075
421900* DISCOUNT FIELD VALUES ARE ENTERED, AND PAYMENT RELEASE      *   42190075
422000* FILEDS ARE SET.                                             *   42200075
422100*-------------------------------------------------------------*   42210075
422200 U950-UPDATE-TPOSTRR.                                             42220075
422300                                                                  42230075
422400     MOVE 'U950-UPDATE-TPOSTRR' TO PV-CURRENT-PARAGRAPH.          42240075
422500                                                                  42250075
422600     IF DK-MTCH-LVL-CDE = 'D'                                     42260075
422700        MOVE DK-DC-NBR  TO DK-STR-NBR                             42270075
422800     END-IF.                                                      42280075
422900                                                                  42290075
423000     EXEC SQL                                                     42300075
423100         UPDATE TPOSTRR                                           42310075
423200         SET STATUS_CDE        = ' '                              42320075
423300            ,WEIGHTED_DISC_PCT = :POSTRR-WEIGHTED-DISC-PCT        42330075
423400            ,TOTAL_DISC_AMT    = :POSTRR-TOTAL-DISC-AMT           42340075
423500            ,PAYT_RLSE_TMST    = :POSTRR-PAYT-RLSE-TMST           42350075
423600            ,PAYT_RLSE_USR_ID  = :PV-PROGRAM-NAME                 42360075
423700         WHERE PO_NBR          = :DK-PO-NBR                       42370075
423800           AND STR_NBR         = :DK-STR-NBR                      42380075
423900           AND MTCH_LVL_CDE    = :DK-MTCH-LVL-CDE                 42390075
424000           AND STATUS_CDE      = 'A'                              42400075
424100           AND CRE_PRC_CDE     = 'A'                              42410075
424200     END-EXEC.                                                    42420075
424300                                                                  42430075
424400     EVALUATE TRUE                                                42440075
424500         WHEN SQLCODE = ZERO                                      42450075
424600              ADD +1 TO PV-POS-RECONCILED                         42460075
424700                                                                  42470075
424710         WHEN SQLCODE = +100                                      42471099
424720              CONTINUE                                            42472099
424730                                                                  42473099
424800         WHEN SQLWARN0 NOT = SPACES                               42480075
424900         WHEN SQLCODE  NOT = ZERO                                 42490075
425000             MOVE PV-CURRENT-PARAGRAPH                            42500075
425100                                 TO AA-PARAGRAPH-NAME             42510075
425200             MOVE 'UNSUCCESSFUL UPDATE: TPOSTRR'                  42520075
425300                                 TO AA-DB2-OPERATION              42530075
425400             MOVE 'TPOSTRR'      TO AA-DB2-TABLE-1                42540075
425500             PERFORM Z998-DB2-ABEND                               42550075
425600     END-EVALUATE.                                                42560075
425700                                                                  42570075
425800*--------------------------------------------------------------*  42580075
425900* WHEN A DECISION IS MADE TO BYPASS THE PO/STORE IN PROCESS,   *  42590075
426000* THE STATUS CODE ON TPOSTRR IS SET TO 'P' (PROCESSED) SO      *  42600075
426100* THE PO/STORE WILL NOT BE BROUGHT INTO FURTHER PROCESSING     *  42610075
426200* AND THE TPOSTRR ROW WILL BE DELETED AT THE END OF THE NIGHT. *  42620075
426300* THE PAYMENT RELEASE TERMINAL ID IS SET TO 'BYPASS' FOR       *  42630075
426400* INFORMATIONAL INVESTIGATIVE PURPOSES.                        *  42640075
426500*--------------------------------------------------------------*  42650075
426600 U960-BYPASS-POSTRR.                                              42660075
426700                                                                  42670075
426800     MOVE 'U960-BYPASS-POSTRR' TO PV-CURRENT-PARAGRAPH.           42680075
426900                                                                  42690075
427000     IF DK-MTCH-LVL-CDE = 'D'                                     42700075
427100        MOVE DK-DC-NBR  TO DK-STR-NBR                             42710075
427200     END-IF.                                                      42720075
427300                                                                  42730075
427400     EXEC SQL                                                     42740075
427500         UPDATE TPOSTRR                                           42750075
427600         SET STATUS_CDE         = 'P'                             42760075
427700            ,PAYT_RLSE_USR_ID   = 'BYPASS'                        42770075
427800         WHERE PO_NBR          = :DK-PO-NBR                       42780075
427900           AND STR_NBR         = :DK-STR-NBR                      42790075
428000           AND MTCH_LVL_CDE    = :DK-MTCH-LVL-CDE                 42800075
428100           AND STATUS_CDE      = 'A'                              42810075
428200           AND CRE_PRC_CDE     = 'A'                              42820075
428300     END-EXEC.                                                    42830075
428400                                                                  42840075
428500     EVALUATE TRUE                                                42850075
428600         WHEN SQLCODE = ZERO                                      42860075
428700              ADD +1 TO PV-POS-BYPASSED                           42870075
428800                                                                  42880075
428810         WHEN SQLCODE = +100                                      42881099
428820              CONTINUE                                            42882099
428830                                                                  42883099
428900         WHEN SQLWARN0 NOT = SPACES                               42890075
429000         WHEN SQLCODE  NOT = ZERO                                 42900075
429100             MOVE PV-CURRENT-PARAGRAPH                            42910075
429200                                 TO AA-PARAGRAPH-NAME             42920075
429300             MOVE 'UNSUCCESSFUL UPDATE: TPOSTRR'                  42930075
429400                                 TO AA-DB2-OPERATION              42940075
429500             MOVE 'TPOSTRR'      TO AA-DB2-TABLE-1                42950075
429600             PERFORM Z998-DB2-ABEND                               42960075
429700     END-EVALUATE.                                                42970075
429800                                                                  42980075
429900*--------------------------------------------------------------*  42990075
430000* WHEN A DECISION IS MADE TO BYPASS THE PO/STORE IN PROCESS,   *  43000075
430100* ROWS ARE WRITTEN OUT TO THE 'POS REQUIRING MANUAL RECON-     *  43010075
430200* CILIATION' REPORT TABLE.                                     *  43020075
430300*--------------------------------------------------------------*  43030075
430400 W100-INSERT-RPT-ROW.                                             43040075
430500                                                                  43050075
430600     MOVE 'W100-INSERT-RPT-ROW' TO PV-CURRENT-PARAGRAPH.          43060075
430700                                                                  43070075
430800     EXEC SQL                                                     43080075
430900         INSERT INTO TOUTAP5                                      43090075
431000             (MANL_RECNCL_ODR)                                    43100075
431100         VALUES                                                   43110075
431200             (:OUTAP5-MANL-RECNCL-ODR)                            43120075
431300     END-EXEC.                                                    43130075
431400                                                                  43140075
431500     EVALUATE TRUE                                                43150075
431600         WHEN SQLCODE = ZERO                                      43160075
431700              CONTINUE                                            43170075
431800                                                                  43180075
431900         WHEN SQLWARN0 NOT = SPACES                               43190075
432000         WHEN SQLCODE  NOT = ZERO                                 43200075
432100             MOVE PV-CURRENT-PARAGRAPH                            43210075
432200                                 TO AA-PARAGRAPH-NAME             43220075
432300             MOVE 'UNSUCCESSFUL INSERT: TOUTAP5'                  43230075
432400                                 TO AA-DB2-OPERATION              43240075
432500             MOVE 'TOUTAP5'      TO AA-DB2-TABLE-1                43250075
432600             PERFORM Z998-DB2-ABEND                               43260075
432700     END-EVALUATE.                                                43270075
432800                                                                  43280075
432900*--------------------------------------------------------------*  43290075
433000* OPENS THE EXCLUDED VENDOR CURSOR                             *  43300075
433100*--------------------------------------------------------------*  43310075
433200 Y100-OPEN-EXCL-VENDOR-CSR.                                       43320075
433300                                                                  43330075
433400     MOVE 'Y100-OPEN-EXCL-VENDOR-CSR' TO PV-CURRENT-PARAGRAPH.    43340075
433500                                                                  43350075
433600     EXEC SQL                                                     43360075
433700         OPEN EXCL_VENDOR_CSR                                     43370075
433800     END-EXEC.                                                    43380075
433900                                                                  43390075
434000     EVALUATE TRUE                                                43400075
434100         WHEN SQLCODE = ZERO                                      43410075
434200              CONTINUE                                            43420075
434300                                                                  43430075
434400         WHEN SQLWARN0 NOT = SPACES                               43440075
434500         WHEN SQLCODE  NOT = ZERO                                 43450075
434600             MOVE PV-CURRENT-PARAGRAPH                            43460075
434700                                 TO AA-PARAGRAPH-NAME             43470075
434800             MOVE                                                 43480075
434900              'UNSUCCESSFUL OPEN ON EXCL_VENDOR_CSR'              43490075
435000                                 TO AA-DB2-OPERATION              43500075
435100             MOVE 'TVNDAGR'      TO AA-DB2-TABLE-1                43510075
435200             PERFORM Z998-DB2-ABEND                               43520075
435300     END-EVALUATE.                                                43530075
435400                                                                  43540075
435500*--------------------------------------------------------------*  43550075
435600* CLOSES THE EXCLUDED VENDOR CURSOR                            *  43560075
435700*--------------------------------------------------------------*  43570075
435800 Y110-CLOSE-EXCL-VENDOR-CSR.                                      43580075
435900                                                                  43590075
436000     MOVE 'Y110-CLOSE-EXCL-VENDOR-CSR' TO PV-CURRENT-PARAGRAPH.   43600075
436100                                                                  43610075
436200     EXEC SQL                                                     43620075
436300         CLOSE EXCL_VENDOR_CSR                                    43630075
436400     END-EXEC.                                                    43640075
436500                                                                  43650075
436600     EVALUATE TRUE                                                43660075
436700         WHEN SQLCODE = ZERO                                      43670075
436800              CONTINUE                                            43680075
436900                                                                  43690075
437000         WHEN SQLWARN0 NOT = SPACES                               43700075
437100         WHEN SQLCODE  NOT = ZERO                                 43710075
437200             MOVE PV-CURRENT-PARAGRAPH                            43720075
437300                                 TO AA-PARAGRAPH-NAME             43730075
437400             MOVE                                                 43740075
437500              'UNSUCCESSFUL CLOSE ON EXCL_VENDOR_CSR'             43750075
437600                                 TO AA-DB2-OPERATION              43760075
437700             MOVE 'TVNDAGR'      TO AA-DB2-TABLE-1                43770075
437800             PERFORM Z998-DB2-ABEND                               43780075
437900     END-EVALUATE.                                                43790075
438000                                                                  43800075
438100*--------------------------------------------------------------*  43810075
438200* OPENS THE PO/STORE PROCESSING CURSOR                         *  43820075
438300*--------------------------------------------------------------*  43830075
438400 Y200-OPEN-POSTRR-CSR.                                            43840075
438500                                                                  43850075
438600     MOVE 'Y200-OPEN-POSTRR-CSR' TO PV-CURRENT-PARAGRAPH.         43860075
438700                                                                  43870075
438800     EXEC SQL                                                     43880075
438900         OPEN POSTRR_CSR                                          43890075
439000     END-EXEC.                                                    43900075
439100                                                                  43910075
439200     EVALUATE TRUE                                                43920075
439300         WHEN SQLCODE = ZERO                                      43930075
439400              CONTINUE                                            43940075
439500                                                                  43950075
439600         WHEN SQLWARN0 NOT = SPACES                               43960075
439700         WHEN SQLCODE  NOT = ZERO                                 43970075
439800             MOVE PV-CURRENT-PARAGRAPH                            43980075
439900                                 TO AA-PARAGRAPH-NAME             43990075
440000             MOVE 'UNSUCCESSFUL OPEN ON POSTRR_CSR'               44000075
440100                                 TO AA-DB2-OPERATION              44010075
440200             MOVE 'TPOSTRR'      TO AA-DB2-TABLE-1                44020075
440300             PERFORM Z998-DB2-ABEND                               44030075
440400     END-EVALUATE.                                                44040075
440500                                                                  44050075
440600*--------------------------------------------------------------*  44060075
440700* CLOSES THE PO/STORE PROCESSING CURSOR                        *  44070075
440800*--------------------------------------------------------------*  44080075
440900 Y210-CLOSE-POSTRR-CSR.                                           44090075
441000                                                                  44100075
441100     MOVE 'Y210-CLOSE-POSTRR-CSR' TO PV-CURRENT-PARAGRAPH.        44110075
441200                                                                  44120075
441300     EXEC SQL                                                     44130075
441400         CLOSE POSTRR_CSR                                         44140075
441500     END-EXEC.                                                    44150075
441600                                                                  44160075
441700     EVALUATE TRUE                                                44170075
441800         WHEN SQLCODE = ZERO                                      44180075
441900              CONTINUE                                            44190075
442000                                                                  44200075
442100         WHEN SQLWARN0 NOT = SPACES                               44210075
442200         WHEN SQLCODE  NOT = ZERO                                 44220075
442300             MOVE PV-CURRENT-PARAGRAPH                            44230075
442400                                 TO AA-PARAGRAPH-NAME             44240075
442500             MOVE 'UNSUCCESSFUL CLOSE ON POSTRR_CSR'              44250075
442600                                 TO AA-DB2-OPERATION              44260075
442700             MOVE 'TPOSTRR'      TO AA-DB2-TABLE-1                44270075
442800             PERFORM Z998-DB2-ABEND                               44280075
442900     END-EVALUATE.                                                44290075
443000                                                                  44300075
443100*--------------------------------------------------------------*  44310075
443200* OPENS THE INVOICE CURSOR                                     *  44320075
443300*--------------------------------------------------------------*  44330075
443400 Y300-OPEN-TINVOIC-CSR.                                           44340075
443500                                                                  44350075
443600     MOVE 'Y300-OPEN-TINVOIC-CSR' TO PV-CURRENT-PARAGRAPH.        44360075
443700                                                                  44370075
443800     EXEC SQL                                                     44380075
443900         OPEN TINVOIC_CSR                                         44390075
444000     END-EXEC.                                                    44400075
444100                                                                  44410075
444200     EVALUATE TRUE                                                44420075
444300         WHEN SQLCODE = ZERO                                      44430075
444400              CONTINUE                                            44440075
444500                                                                  44450075
444600         WHEN SQLWARN0 NOT = SPACES                               44460075
444700         WHEN SQLCODE  NOT = ZERO                                 44470075
444800             MOVE PV-CURRENT-PARAGRAPH                            44480075
444900                                 TO AA-PARAGRAPH-NAME             44490075
445000             MOVE 'UNSUCCESSFUL OPEN ON TINVOIC_CSR'              44500075
445100                                 TO AA-DB2-OPERATION              44510075
445200             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                44520075
445300             PERFORM Z998-DB2-ABEND                               44530075
445400     END-EVALUATE.                                                44540075
445500                                                                  44550075
445600*--------------------------------------------------------------*  44560075
445700* CLOSES THE INVOICE CURSOR                                    *  44570075
445800*--------------------------------------------------------------*  44580075
445900 Y310-CLOSE-TINVOIC-CSR.                                          44590075
446000                                                                  44600075
446100     MOVE 'Y310-CLOSE-TINVOIC-CSR' TO PV-CURRENT-PARAGRAPH.       44610075
446200                                                                  44620075
446300     EXEC SQL                                                     44630075
446400         CLOSE TINVOIC_CSR                                        44640075
446500     END-EXEC.                                                    44650075
446600                                                                  44660075
446700     EVALUATE TRUE                                                44670075
446800         WHEN SQLCODE = ZERO                                      44680075
446900              CONTINUE                                            44690075
447000                                                                  44700075
447100         WHEN SQLWARN0 NOT = SPACES                               44710075
447200         WHEN SQLCODE  NOT = ZERO                                 44720075
447300             MOVE PV-CURRENT-PARAGRAPH                            44730075
447400                                 TO AA-PARAGRAPH-NAME             44740075
447500             MOVE 'UNSUCCESSFUL CLOSE ON TINVOIC_CSR'             44750075
447600                                 TO AA-DB2-OPERATION              44760075
447700             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                44770075
447800             PERFORM Z998-DB2-ABEND                               44780075
447900     END-EVALUATE.                                                44790075
448000                                                                  44800075
448100*--------------------------------------------------------------*  44810075
448200* OPENS THE RECDIS CURSOR                                      *  44820075
448300*--------------------------------------------------------------*  44830075
448400 Y400-OPEN-TRECDIS-CSR.                                           44840075
448500                                                                  44850075
448600     MOVE 'Y400-OPEN-TRECDIS-CSR' TO PV-CURRENT-PARAGRAPH.        44860075
448700                                                                  44870075
448800     EXEC SQL                                                     44880075
448900         OPEN TRECDIS_CSR                                         44890075
449000     END-EXEC.                                                    44900075
449100                                                                  44910075
449200     EVALUATE TRUE                                                44920075
449300         WHEN SQLCODE = ZERO                                      44930075
449400              CONTINUE                                            44940075
449500                                                                  44950075
449600         WHEN SQLWARN0 NOT = SPACES                               44960075
449700         WHEN SQLCODE  NOT = ZERO                                 44970075
449800             MOVE PV-CURRENT-PARAGRAPH                            44980075
449900                                 TO AA-PARAGRAPH-NAME             44990075
450000             MOVE 'UNSUCCESSFUL OPEN ON TRECDIS_CSR'              45000075
450100                                 TO AA-DB2-OPERATION              45010075
450200             MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                45020075
450300             MOVE 'TRECITM'      TO AA-DB2-TABLE-2                45030075
450400             MOVE 'TRECDIS'      TO AA-DB2-TABLE-3                45040075
450500             MOVE 'TPURITM'      TO AA-DB2-TABLE-4                45050075
450600             PERFORM Z998-DB2-ABEND                               45060075
450700     END-EVALUATE.                                                45070075
450800                                                                  45080075
450900*--------------------------------------------------------------*  45090075
451000* CLOSES THE RECDIS CURSOR                                     *  45100075
451100*--------------------------------------------------------------*  45110075
451200 Y410-CLOSE-TRECDIS-CSR.                                          45120075
451300                                                                  45130075
451400     MOVE 'Y410-CLOSE-TRECDIS-CSR' TO PV-CURRENT-PARAGRAPH.       45140075
451500                                                                  45150075
451600     EXEC SQL                                                     45160075
451700         CLOSE TRECDIS_CSR                                        45170075
451800     END-EXEC.                                                    45180075
451900                                                                  45190075
452000     EVALUATE TRUE                                                45200075
452100         WHEN SQLCODE = ZERO                                      45210075
452200              CONTINUE                                            45220075
452300                                                                  45230075
452400         WHEN SQLWARN0 NOT = SPACES                               45240075
452500         WHEN SQLCODE  NOT = ZERO                                 45250075
452600             MOVE PV-CURRENT-PARAGRAPH                            45260075
452700                                 TO AA-PARAGRAPH-NAME             45270075
452800             MOVE 'UNSUCCESSFUL CLOSE ON TRECDIS_CSR'             45280075
452900                                 TO AA-DB2-OPERATION              45290075
453000             MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                45300075
453100             MOVE 'TRECITM'      TO AA-DB2-TABLE-2                45310075
453200             MOVE 'TRECDIS'      TO AA-DB2-TABLE-3                45320075
453300             MOVE 'TPURITM'      TO AA-DB2-TABLE-4                45330075
453400             PERFORM Z998-DB2-ABEND                               45340075
453500     END-EVALUATE.                                                45350075
453600                                                                  45360075
453700*--------------------------------------------------------------*  45370075
453800* OPENS THE RECEIV CURSOR                                      *  45380075
453900*--------------------------------------------------------------*  45390075
454000 Y415-OPEN-TRECEIV-CSR.                                           45400075
454100                                                                  45410075
454200     MOVE 'Y415-OPEN-TRECEIV-CSR' TO PV-CURRENT-PARAGRAPH.        45420075
454300                                                                  45430075
454400     EXEC SQL                                                     45440075
454500         OPEN TRECEIV_CSR                                         45450075
454600     END-EXEC.                                                    45460075
454700                                                                  45470075
454800     EVALUATE TRUE                                                45480075
454900         WHEN SQLCODE = ZERO                                      45490075
455000              CONTINUE                                            45500075
455100                                                                  45510075
455200         WHEN SQLWARN0 NOT = SPACES                               45520075
455300         WHEN SQLCODE  NOT = ZERO                                 45530075
455400             MOVE PV-CURRENT-PARAGRAPH                            45540075
455500                                 TO AA-PARAGRAPH-NAME             45550075
455600             MOVE 'UNSUCCESSFUL OPEN ON TRECEIV_CSR'              45560075
455700                                 TO AA-DB2-OPERATION              45570075
455800             MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                45580075
455900             MOVE 'TRECITM'      TO AA-DB2-TABLE-2                45590075
456000             MOVE 'TRECDIS'      TO AA-DB2-TABLE-3                45600075
456100             MOVE 'TPURITM'      TO AA-DB2-TABLE-4                45610075
456200             PERFORM Z998-DB2-ABEND                               45620075
456300     END-EVALUATE.                                                45630075
456400                                                                  45640075
456500*--------------------------------------------------------------*  45650075
456600* CLOSES THE RECEIV CURSOR                                     *  45660075
456700*--------------------------------------------------------------*  45670075
456800 Y420-CLOSE-TRECEIV-CSR.                                          45680075
456900                                                                  45690075
457000     MOVE 'Y420-CLOSE-TRECEIV-CSR' TO PV-CURRENT-PARAGRAPH.       45700075
457100                                                                  45710075
457200     EXEC SQL                                                     45720075
457300         CLOSE TRECEIV_CSR                                        45730075
457400     END-EXEC.                                                    45740075
457500                                                                  45750075
457600     EVALUATE TRUE                                                45760075
457700         WHEN SQLCODE = ZERO                                      45770075
457800              CONTINUE                                            45780075
457900                                                                  45790075
458000         WHEN SQLWARN0 NOT = SPACES                               45800075
458100         WHEN SQLCODE  NOT = ZERO                                 45810075
458200             MOVE PV-CURRENT-PARAGRAPH                            45820075
458300                                 TO AA-PARAGRAPH-NAME             45830075
458400             MOVE 'UNSUCCESSFUL CLOSE ON TRECEIV_CSR'             45840075
458500                                 TO AA-DB2-OPERATION              45850075
458600             MOVE 'TRECEIV'      TO AA-DB2-TABLE-1                45860075
458700             MOVE 'TRECITM'      TO AA-DB2-TABLE-2                45870075
458800             MOVE 'TRECDIS'      TO AA-DB2-TABLE-3                45880075
458900             MOVE 'TPURITM'      TO AA-DB2-TABLE-4                45890075
459000             PERFORM Z998-DB2-ABEND                               45900075
459100     END-EVALUATE.                                                45910075
459200                                                                  45920075
459300*--------------------------------------------------------------*  45930075
459400* OPENS THE NINREC CURSOR                                      *  45940075
459500*--------------------------------------------------------------*  45950075
459600 Y500-OPEN-TNINREC-CSR.                                           45960075
459700                                                                  45970075
459800     MOVE 'Y500-OPEN-TNINREC-CSR' TO PV-CURRENT-PARAGRAPH.        45980075
459900                                                                  45990075
460000     EXEC SQL                                                     46000075
460100         OPEN TNINREC_CSR                                         46010075
460200     END-EXEC.                                                    46020075
460300                                                                  46030075
460400     EVALUATE TRUE                                                46040075
460500         WHEN SQLCODE = ZERO                                      46050075
460600              CONTINUE                                            46060075
460700                                                                  46070075
460800         WHEN SQLWARN0 NOT = SPACES                               46080075
460900         WHEN SQLCODE  NOT = ZERO                                 46090075
461000             MOVE PV-CURRENT-PARAGRAPH                            46100075
461100                                 TO AA-PARAGRAPH-NAME             46110075
461200             MOVE 'UNSUCCESSFUL OPEN ON TNINREC_CSR'              46120075
461300                                 TO AA-DB2-OPERATION              46130075
461400             MOVE 'TNINREC'      TO AA-DB2-TABLE-1                46140075
461500             PERFORM Z998-DB2-ABEND                               46150075
461600     END-EVALUATE.                                                46160075
461700                                                                  46170075
461800*--------------------------------------------------------------*  46180075
461900* OPENS THE NINREC DC CURSOR                                   *  46190075
462000*--------------------------------------------------------------*  46200075
462100 Y505-OPEN-TNINREC-DC-CSR.                                        46210075
462200                                                                  46220075
462300     MOVE 'Y505-OPEN-TNINREC-DC-CSR' TO PV-CURRENT-PARAGRAPH.     46230075
462400                                                                  46240075
462500     EXEC SQL                                                     46250075
462600         OPEN TNINREC_DC_CSR                                      46260075
462700     END-EXEC.                                                    46270075
462800                                                                  46280075
462900     EVALUATE TRUE                                                46290075
463000         WHEN SQLCODE = ZERO                                      46300075
463100              CONTINUE                                            46310075
463200                                                                  46320075
463300         WHEN SQLWARN0 NOT = SPACES                               46330075
463400         WHEN SQLCODE  NOT = ZERO                                 46340075
463500             MOVE PV-CURRENT-PARAGRAPH                            46350075
463600                                 TO AA-PARAGRAPH-NAME             46360075
463700             MOVE 'UNSUCCESSFUL OPEN ON TNINREC_DC_CSR'           46370075
463800                                 TO AA-DB2-OPERATION              46380075
463900             MOVE 'TNINREC'      TO AA-DB2-TABLE-1                46390075
464000             PERFORM Z998-DB2-ABEND                               46400075
464100     END-EVALUATE.                                                46410075
464200                                                                  46420075
464300*-------------------------------------------------------------*   46430075
464400* CLOSES THE NINREC CURSOR                                    *   46440075
464500*-------------------------------------------------------------*   46450075
464600 Y510-CLOSE-TNINREC-CSR.                                          46460075
464700                                                                  46470075
464800     MOVE 'Y510-CLOSE-TNINREC-CSR' TO PV-CURRENT-PARAGRAPH.       46480075
464900                                                                  46490075
465000     EXEC SQL                                                     46500075
465100         CLOSE TNINREC_CSR                                        46510075
465200     END-EXEC.                                                    46520075
465300                                                                  46530075
465400     EVALUATE TRUE                                                46540075
465500         WHEN SQLCODE = ZERO                                      46550075
465600              CONTINUE                                            46560075
465700                                                                  46570075
465800         WHEN SQLWARN0 NOT = SPACES                               46580075
465900         WHEN SQLCODE  NOT = ZERO                                 46590075
466000             MOVE PV-CURRENT-PARAGRAPH                            46600075
466100                                 TO AA-PARAGRAPH-NAME             46610075
466200             MOVE 'UNSUCCESSFUL CLOSE ON TNINREC_CSR'             46620075
466300                                 TO AA-DB2-OPERATION              46630075
466400             MOVE 'TNINREC'      TO AA-DB2-TABLE-1                46640075
466500             PERFORM Z998-DB2-ABEND                               46650075
466600     END-EVALUATE.                                                46660075
466700                                                                  46670075
466800*--------------------------------------------------------------*  46680075
466900* CLOSES THE NINREC DC CURSOR                                  *  46690075
467000*--------------------------------------------------------------*  46700075
467100 Y515-CLOSE-TNINREC-DC-CSR.                                       46710075
467200                                                                  46720075
467300     MOVE 'Y515-CLOSE-TNINREC-DC-CSR' TO PV-CURRENT-PARAGRAPH.    46730075
467400                                                                  46740075
467500     EXEC SQL                                                     46750075
467600         CLOSE TNINREC_DC_CSR                                     46760075
467700     END-EXEC.                                                    46770075
467800                                                                  46780075
467900     EVALUATE TRUE                                                46790075
468000         WHEN SQLCODE = ZERO                                      46800075
468100              CONTINUE                                            46810075
468200                                                                  46820075
468300         WHEN SQLWARN0 NOT = SPACES                               46830075
468400         WHEN SQLCODE  NOT = ZERO                                 46840075
468500             MOVE PV-CURRENT-PARAGRAPH                            46850075
468600                                 TO AA-PARAGRAPH-NAME             46860075
468700             MOVE 'UNSUCCESSFUL CLOSE ON TNINREC_DC_CSR'          46870075
468800                                 TO AA-DB2-OPERATION              46880075
468900             MOVE 'TNINREC'      TO AA-DB2-TABLE-1                46890075
469000             PERFORM Z998-DB2-ABEND                               46900075
469100     END-EVALUATE.                                                46910075
469200                                                                  46920075
469300*--------------------------------------------------------------*  46930075
469400* OPENS THE PREQIT CURSOR                                      *  46940075
469500*--------------------------------------------------------------*  46950075
469600 Y600-OPEN-TPREQIT-CSR.                                           46960075
469700                                                                  46970075
469800     MOVE 'Y600-OPEN-TPREQIT-CSR' TO PV-CURRENT-PARAGRAPH.        46980075
469900                                                                  46990075
470000     EXEC SQL                                                     47000075
470100         OPEN TPREQIT_CSR                                         47010075
470200     END-EXEC.                                                    47020075
470300                                                                  47030075
470400     EVALUATE TRUE                                                47040075
470500         WHEN SQLCODE = ZERO                                      47050075
470600              CONTINUE                                            47060075
470700                                                                  47070075
470800         WHEN SQLWARN0 NOT = SPACES                               47080075
470900         WHEN SQLCODE  NOT = ZERO                                 47090075
471000             MOVE PV-CURRENT-PARAGRAPH                            47100075
471100                                 TO AA-PARAGRAPH-NAME             47110075
471200             MOVE 'UNSUCCESSFUL OPEN ON TPREQIT_CSR'              47120075
471300                                 TO AA-DB2-OPERATION              47130075
471400             MOVE 'TPREQIT'      TO AA-DB2-TABLE-1                47140075
471500             MOVE 'TMIITEM'      TO AA-DB2-TABLE-2                47150075
471600             MOVE 'TPURITM'      TO AA-DB2-TABLE-3                47160075
471700             PERFORM Z998-DB2-ABEND                               47170075
471800     END-EVALUATE.                                                47180075
471900                                                                  47190075
472000*--------------------------------------------------------------*  47200075
472100* CLOSES THE PREQIT CURSOR                                     *  47210075
472200*--------------------------------------------------------------*  47220075
472300 Y610-CLOSE-TPREQIT-CSR.                                          47230075
472400                                                                  47240075
472500     MOVE 'Y610-CLOSE-TPREQIT-CSR' TO PV-CURRENT-PARAGRAPH.       47250075
472600                                                                  47260075
472700     EXEC SQL                                                     47270075
472800         CLOSE TPREQIT_CSR                                        47280075
472900     END-EXEC.                                                    47290075
473000                                                                  47300075
473100     EVALUATE TRUE                                                47310075
473200         WHEN SQLCODE = ZERO                                      47320075
473300              CONTINUE                                            47330075
473400                                                                  47340075
473500         WHEN SQLWARN0 NOT = SPACES                               47350075
473600         WHEN SQLCODE  NOT = ZERO                                 47360075
473700             MOVE PV-CURRENT-PARAGRAPH                            47370075
473800                                 TO AA-PARAGRAPH-NAME             47380075
473900             MOVE 'UNSUCCESSFUL CLOSE ON TPREQIT_CSR'             47390075
474000                                 TO AA-DB2-OPERATION              47400075
474100             MOVE 'TPREQIT'      TO AA-DB2-TABLE-1                47410075
474200             MOVE 'TMIITEM'      TO AA-DB2-TABLE-2                47420075
474300             MOVE 'TPURITM'      TO AA-DB2-TABLE-3                47430075
474400             PERFORM Z998-DB2-ABEND                               47440075
474500     END-EVALUATE.                                                47450075
474600                                                                  47460075
474700*--------------------------------------------------------------*  47470075
474800* OPENS THE DISCOUNT CURSOR                                    *  47480075
474900*--------------------------------------------------------------*  47490075
475000 Y700-OPEN-DISCOUNT-CSR.                                          47500075
475100                                                                  47510075
475200     MOVE 'Y700-OPEN-DISCOUNT-CSR' TO PV-CURRENT-PARAGRAPH.       47520075
475300                                                                  47530075
475400     EXEC SQL                                                     47540075
475500         OPEN DISCOUNT_CSR                                        47550075
475600     END-EXEC.                                                    47560075
475700                                                                  47570075
475800     EVALUATE TRUE                                                47580075
475900         WHEN SQLCODE = ZERO                                      47590075
476000              CONTINUE                                            47600075
476100                                                                  47610075
476200         WHEN SQLWARN0 NOT = SPACES                               47620075
476300         WHEN SQLCODE  NOT = ZERO                                 47630075
476400             MOVE PV-CURRENT-PARAGRAPH                            47640075
476500                                 TO AA-PARAGRAPH-NAME             47650075
476600             MOVE 'UNSUCCESSFUL OPEN ON DISCOUNT_CSR'             47660075
476700                                 TO AA-DB2-OPERATION              47670075
476800             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                47680075
476900             PERFORM Z998-DB2-ABEND                               47690075
477000     END-EVALUATE.                                                47700075
477100                                                                  47710075
477200                                                                  47720075
477300*--------------------------------------------------------------*  47730075
477400* CLOSES THE DISCOUNT CURSOR                                   *  47740075
477500*--------------------------------------------------------------*  47750075
477600 Y710-CLOSE-DISCOUNT-CSR.                                         47760075
477700                                                                  47770075
477800     MOVE 'Y710-CLOSE-DISCOUNT-CSR' TO PV-CURRENT-PARAGRAPH.      47780075
477900                                                                  47790075
478000     EXEC SQL                                                     47800075
478100         CLOSE DISCOUNT_CSR                                       47810075
478200     END-EXEC.                                                    47820075
478300                                                                  47830075
478400     EVALUATE TRUE                                                47840075
478500         WHEN SQLCODE = ZERO                                      47850075
478600              CONTINUE                                            47860075
478700                                                                  47870075
478800         WHEN SQLWARN0 NOT = SPACES                               47880075
478900         WHEN SQLCODE  NOT = ZERO                                 47890075
479000             MOVE PV-CURRENT-PARAGRAPH                            47900075
479100                                 TO AA-PARAGRAPH-NAME             47910075
479200             MOVE 'UNSUCCESSFUL CLOSE ON DISCOUNT_CSR'            47920075
479300                                 TO AA-DB2-OPERATION              47930075
479400             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                47940075
479500             PERFORM Z998-DB2-ABEND                               47950075
479600     END-EVALUATE.                                                47960075
479700                                                                  47970075
479800*--------------------------------------------------------------*  47980075
479900* OPENS PREQIT NULL LINE CURSOR                                *  47990075
480000*--------------------------------------------------------------*  48000075
480100 Y800-OPEN-NULL-LNE-NBR-CSR.                                      48010075
480200                                                                  48020075
480300     MOVE 'Y800-OPEN-NULL-LNE-NBR-CSR'  TO PV-CURRENT-PARAGRAPH.  48030075
480400                                                                  48040075
480500     EXEC SQL                                                     48050075
480600          OPEN  PREQIT_NULL_PO_CSR                                48060075
480700     END-EXEC.                                                    48070075
480800                                                                  48080075
480900     EVALUATE TRUE                                                48090075
481000         WHEN SQLCODE = ZERO                                      48100075
481100              CONTINUE                                            48110075
481200                                                                  48120075
481300         WHEN SQLWARN0 NOT = SPACES                               48130075
481400         WHEN SQLCODE  NOT = ZERO                                 48140075
481500             MOVE PV-CURRENT-PARAGRAPH                            48150075
481600                                 TO AA-PARAGRAPH-NAME             48160075
481700             MOVE                                                 48170075
481800               'UNSUCCESSFUL OPEN ON PREQIT_NULL_PO_CSR'          48180075
481900                                 TO AA-DB2-OPERATION              48190075
482000             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                48200075
482100             MOVE 'TPREQIT'      TO AA-DB2-TABLE-2                48210075
482200             MOVE 'TMIITEM'      TO AA-DB2-TABLE-3                48220075
482300             PERFORM Z998-DB2-ABEND                               48230075
482400     END-EVALUATE.                                                48240075
482500                                                                  48250075
482600*--------------------------------------------------------------*  48260075
482700* CLOSES PREQIT NULL LINE CURSOR                               *  48270075
482800*--------------------------------------------------------------*  48280075
482900 Y810-CLOSE-NULL-LNE-NBR-CSR.                                     48290075
483000                                                                  48300075
483100     MOVE 'Y810-CLOSE-NULL-LNE-NBR-CSR' TO PV-CURRENT-PARAGRAPH.  48310075
483200                                                                  48320075
483300     EXEC SQL                                                     48330075
483400          CLOSE PREQIT_NULL_PO_CSR                                48340075
483500     END-EXEC.                                                    48350075
483600                                                                  48360075
483700     EVALUATE TRUE                                                48370075
483800         WHEN SQLCODE = ZERO                                      48380075
483900              CONTINUE                                            48390075
484000                                                                  48400075
484100         WHEN SQLWARN0 NOT = SPACES                               48410075
484200         WHEN SQLCODE  NOT = ZERO                                 48420075
484300             MOVE PV-CURRENT-PARAGRAPH                            48430075
484400                                 TO AA-PARAGRAPH-NAME             48440075
484500             MOVE                                                 48450075
484600               'UNSUCCESSFUL CLOSE ON PREQIT_NULL_PO_CSR'         48460075
484700                                 TO AA-DB2-OPERATION              48470075
484800             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                48480075
484900             MOVE 'TPREQIT'      TO AA-DB2-TABLE-2                48490075
485000             MOVE 'TMIITEM'      TO AA-DB2-TABLE-3                48500075
485100             PERFORM Z998-DB2-ABEND                               48510075
485200     END-EVALUATE.                                                48520075
485300                                                                  48530075
485310 Y900-OPEN-INVC-ITEM-CSR.                                         48531091
485320                                                                  48532091
485321     MOVE 'Y900-OPEN-INVC-ITEM-CSR' TO PV-CURRENT-PARAGRAPH.      48532192
485390                                                                  48539091
485391         EXEC SQL                                                 48539191
485392             OPEN  INVC_ITEM_CSR                                  48539291
485393         END-EXEC                                                 48539391
485394                                                                  48539491
485395         EVALUATE TRUE                                            48539591
485396             WHEN SQLCODE = +0                                    48539691
485397                  CONTINUE                                        48539791
485398             WHEN SQLCODE = -904                                  48539891
485399             WHEN SQLCODE = -913                                  48539991
485400                  CONTINUE                                        48540091
485401             WHEN SQLWARN0 NOT = SPACE                            48540191
485402             WHEN SQLCODE  NOT = +0                               48540291
485403             MOVE PV-CURRENT-PARAGRAPH                            48540392
485404                                 TO AA-PARAGRAPH-NAME             48540492
485405             MOVE 'UNSUCCESSFUL OPEN ON INVC_ITEM_CSR'            48540592
485406                                 TO AA-DB2-OPERATION              48540692
485407             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                48540792
485408             MOVE 'TPREQIT'      TO AA-DB2-TABLE-2                48540892
485409             MOVE 'TMIITEM'      TO AA-DB2-TABLE-3                48540992
485411             PERFORM Z998-DB2-ABEND                               48541192
485415         END-EVALUATE.                                            48541594
485417/                                                                 48541791
485418 Y910-CLOSE-INVC-ITEM-CSR.                                        48541891
485419                                                                  48541991
485420     MOVE 'Y910-CLOSE-INVC-ITEM-CSR' TO PV-CURRENT-PARAGRAPH.     48542092
485421                                                                  48542192
485422     EXEC SQL                                                     48542291
485423        CLOSE INVC_ITEM_CSR                                       48542391
485424     END-EXEC.                                                    48542491
485425                                                                  48542592
485426     EVALUATE TRUE                                                48542692
485427         WHEN SQLCODE = ZERO                                      48542792
485428              CONTINUE                                            48542892
485429                                                                  48542992
485430         WHEN SQLWARN0 NOT = SPACES                               48543092
485431         WHEN SQLCODE  NOT = ZERO                                 48543192
485432             MOVE PV-CURRENT-PARAGRAPH                            48543292
485433                                 TO AA-PARAGRAPH-NAME             48543392
485434             MOVE                                                 48543492
485435               'UNSUCCESSFUL CLOSE ON INVC_ITEM_CSR'              48543592
485436                                 TO AA-DB2-OPERATION              48543692
485437             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                48543792
485438             MOVE 'TPREQIT'      TO AA-DB2-TABLE-2                48543892
485439             MOVE 'TMIITEM'      TO AA-DB2-TABLE-3                48543992
485440             PERFORM Z998-DB2-ABEND                               48544092
485441     END-EVALUATE.                                                48544192
485450/                                                                 48545091
485460*----------------------------------------------------------------*48546075
485500*    OPENS THE ADVERTISING CURSOR                                *48550075
485600*----------------------------------------------------------------*48560075
485700*Y900-OPEN-ADVERTISING-CSR.                                       48570075
485800*                                                                 48580075
485900*    MOVE 'Y900-OPEN-ADVERTISING-CSR' TO PV-CURRENT-PARAGRAPH.    48590075
486000*                                                                 48600075
486100*    EXEC SQL                                                     48610075
486200*        OPEN ADVERT_CSR                                          48620075
486300*    END-EXEC.                                                    48630075
486400*                                                                 48640075
486500*    EVALUATE TRUE                                                48650075
486600*        WHEN SQLCODE = ZERO                                      48660075
486700*             CONTINUE                                            48670075
486800*                                                                 48680075
486900*        WHEN SQLWARN0 NOT = SPACES                               48690075
487000*        WHEN SQLCODE  NOT = ZERO                                 48700075
487100*            MOVE PV-CURRENT-PARAGRAPH                            48710075
487200*                                TO AA-PARAGRAPH-NAME             48720075
487300*            MOVE 'UNSUCCESSFUL OPEN ON ADVERT_CSR'               48730075
487400*                                TO AA-DB2-OPERATION              48740075
487500*            MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                48750075
487600*            PERFORM Z998-DB2-ABEND                               48760075
487700*    END-EVALUATE.                                                48770075
487800*                                                                 48780075
487900*                                                                 48790075
488000*----------------------------------------------------------------*48800075
488100*    CLOSES THE ADVERTISING CURSOR.                              *48810075
488200*----------------------------------------------------------------*48820075
488300*Y910-CLOSE-ADVERTISING-CSR.                                      48830075
488400*                                                                 48840075
488500*    MOVE 'Y910-CLOSE-ADVERTISING-CSR' TO PV-CURRENT-PARAGRAPH.   48850075
488600*                                                                 48860075
488700*    EXEC SQL                                                     48870075
488800*        CLOSE ADVERT_CSR                                         48880075
488900*    END-EXEC.                                                    48890075
489000*                                                                 48900075
489100*    EVALUATE TRUE                                                48910075
489200*        WHEN SQLCODE = ZERO                                      48920075
489300*             CONTINUE                                            48930075
489400*                                                                 48940075
489500*        WHEN SQLWARN0 NOT = SPACES                               48950075
489600*        WHEN SQLCODE  NOT = ZERO                                 48960075
489700*            MOVE PV-CURRENT-PARAGRAPH                            48970075
489800*                                TO AA-PARAGRAPH-NAME             48980075
489900*            MOVE 'UNSUCCESSFUL CLOSE ON ADVERT_CSR'              48990075
490000*                                TO AA-DB2-OPERATION              49000075
490100*            MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                49010075
490200*            PERFORM Z998-DB2-ABEND                               49020075
490300*    END-EVALUATE.                                                49030075
490400*EJECT                                                            49040075
490500                                                                  49050075
490600*--------------------------------------------------------------*  49060075
490700* COMMITS DB2 UPDATES FOR THE PO/STORE PROCESSED               *  49070075
490800*--------------------------------------------------------------*  49080075
490900 Z100-COMMIT.                                                     49090075
491000                                                                  49100075
491100     MOVE 'Z100-COMMIT'         TO PV-CURRENT-PARAGRAPH.          49110075
491200                                                                  49120075
491300     EXEC SQL                                                     49130075
491400         COMMIT                                                   49140075
491500     END-EXEC.                                                    49150075
491600                                                                  49160075
491700     EVALUATE TRUE                                                49170075
491800         WHEN SQLCODE = ZEROS                                     49180075
491900              CONTINUE                                            49190075
492000         WHEN OTHER                                               49200075
492100             MOVE PV-CURRENT-PARAGRAPH                            49210075
492200                                 TO AA-PARAGRAPH-NAME             49220075
492300             MOVE 'UNSUCCESSFUL COMMIT'                           49230075
492400                                 TO AA-DB2-OPERATION              49240075
492500             MOVE SPACES         TO AA-DB2-TABLE-1                49250075
492600                                    AA-DB2-TABLE-2                49260075
492700                                    AA-DB2-TABLE-3                49270075
492800                                    AA-DB2-TABLE-4                49280075
492900                                    AA-DB2-TABLE-5                49290075
493000             PERFORM Z998-DB2-ABEND                               49300075
493100     END-EVALUATE.                                                49310075
493200                                                                  49320075
493300*--------------------------------------------------------------*  49330075
493400* ABEND ROUTINE FOR DB2 ERRORS                                 *  49340075
493500*--------------------------------------------------------------*  49350075
493600 Z998-DB2-ABEND.                                                  49360075
493700                                                                  49370075
493800     DISPLAY AA-ABEND-LIT.                                        49380075
493900     DISPLAY AA-DB2-ERROR-LIT.                                    49390075
494000     DISPLAY AA-PROGRAM-LIT.                                      49400075
494100     DISPLAY AA-PARAGRAPH-LIT.                                    49410075
494200     DISPLAY AA-DB2-OPERATION-LIT.                                49420075
494300     DISPLAY AA-DB2-TABLE-1.                                      49430075
494400     IF AA-DB2-TABLE-2 > SPACE                                    49440075
494500         DISPLAY AA-DB2-TABLE-2.                                  49450075
494600     IF AA-DB2-TABLE-3 > SPACE                                    49460075
494700         DISPLAY AA-DB2-TABLE-3.                                  49470075
494800     IF AA-DB2-TABLE-4 > SPACE                                    49480075
494900         DISPLAY AA-DB2-TABLE-4.                                  49490075
495000     IF AA-DB2-TABLE-5 > SPACE                                    49500075
495100         DISPLAY AA-DB2-TABLE-5.                                  49510075
495200     IF DK-PO-NBR > 0                                             49520075
495300         MOVE DK-PO-NBR   TO AA-PO-NBR                            49530075
495400         MOVE DK-STR-NBR  TO AA-STR-NBR                           49540075
495500         DISPLAY 'PO    = ' AA-PO-NBR                             49550075
495600         DISPLAY 'STORE = ' AA-STR-NBR                            49560075
495700     END-IF.                                                      49570075
495800                                                                  49580075
495900     SET AC-DB2-ERROR TO TRUE.                                    49590075
496000     COPY DPPD004.                                                49600075
496100                                                                  49610075
496200     CALL 'ILBOABN0' USING ABEND-CODE.                            49620075
496300                                                                  49630075
496400*--------------------------------------------------------------*  49640075
496500* ABEND ROUTINE                                                *  49650075
496600*--------------------------------------------------------------*  49660075
496700 Z999-ABEND.                                                      49670075
496800                                                                  49680075
496900     DISPLAY AA-ABEND-LIT.                                        49690075
497000     DISPLAY AA-PROGRAM-LIT.                                      49700075
497100     DISPLAY AA-PARAGRAPH-LIT.                                    49710075
497200     DISPLAY AA-MESSAGE-LINE.                                     49720075
497300     IF DK-PO-NBR > 0                                             49730075
497400         MOVE DK-PO-NBR   TO AA-PO-NBR                            49740075
497500         MOVE DK-STR-NBR  TO AA-STR-NBR                           49750075
497600         DISPLAY 'PO    = ' AA-PO-NBR                             49760075
497700         DISPLAY 'STORE = ' AA-STR-NBR                            49770075
497800     END-IF.                                                      49780075
497900     CALL 'ILBOABN0' USING ABEND-CODE.                            49790075
498000                                                                  49800075
498100*--------------------------------------------------------------*  49810099
498200* COPYBOOK FOR SEPHORA PROCESSES                               *  49820099
498300*--------------------------------------------------------------*  49830099
498400     COPY APPD021.                                                49840099
498500                                                                  49850099
