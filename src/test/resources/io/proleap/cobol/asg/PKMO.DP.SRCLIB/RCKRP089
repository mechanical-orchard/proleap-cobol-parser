000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.             RCKRP089.                                00020000
000300 AUTHOR.                 DENISE HAHN.                             00030000
000400 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00040000
000500 DATE-WRITTEN.           MARCH, 2017.                             00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800***************************************************************** 00080000
000900*                                                               * 00090000
001000*  CR RECEIVERS FROM PACK-TO-LIGHT FAILED STORE ADJUSTMENTS     * 00100000
001100*  PO-RCVR-LINE SEQUENCE                                        * 00110000
001200*                                                               * 00120000
001300*  INPUT FILE IS CREATED BY RCKUP066 - RCRD098 - LRECL 200      * 00130000
001400*                                                               * 00140000
001500***************************************************************** 00150000
001600 ENVIRONMENT DIVISION.                                            00160000
001700 CONFIGURATION SECTION.                                           00170000
001800                                                                  00180000
001900 SOURCE-COMPUTER.        IBM-3090.                                00190000
002000 OBJECT-COMPUTER.        IBM-3090.                                00200000
002100                                                                  00210000
002200***************************************************************** 00220000
002300 INPUT-OUTPUT SECTION.                                            00230000
002400                                                                  00240000
002500 FILE-CONTROL.                                                    00250000
002600                                                                  00260000
002700     SELECT INPUT-FILE                                            00270000
002800         ASSIGN TO INP01.                                         00280000
002900                                                                  00290000
003000     SELECT REPORT-FILE                                           00300000
003100         ASSIGN TO RPT01.                                         00310000
003200                                                                  00320000
003300***************************************************************** 00330000
003400 DATA DIVISION.                                                   00340000
003500***************************************************************** 00350000
003600 FILE SECTION.                                                    00360000
003700                                                                  00370000
003800 FD  INPUT-FILE                                                   00380000
003900     RECORDING MODE IS F                                          00390000
004000     LABEL RECORDS ARE STANDARD                                   00400000
004100     BLOCK CONTAINS 0 RECORDS.                                    00410000
004200 01  INPUT-RECORD                    PIC  X(200).                 00420000
004300                                                                  00430000
004400 FD  REPORT-FILE                                                  00440000
004500     RECORDING MODE IS F                                          00450000
004600     BLOCK CONTAINS 0  RECORDS.                                   00460000
004700 01  REPORT-RECORD                   PIC X(132).                  00470000
004800                                                                  00480000
004900***************************************************************** 00490000
005000 WORKING-STORAGE SECTION.                                         00500000
005100                                                                  00510000
005200 01  PROGRAM-SWITCHES.                                            00520000
005300     05  PS-END-OF-INPUT-FILE-SW     PIC X(01) VALUE 'N'.         00530000
005400         88  PS-END-OF-INPUT                   VALUE 'Y'.         00540000
005500         88  PS-NOT-END-OF-INPUT               VALUE 'N'.         00550000
005600                                                                  00560000
005700 01  PC-PROGRAM-CONSTANTS.                                        00570000
005800     05  PC-RCKRP089                 PIC X(08) VALUE              00580000
005900                                               'RCKRP089'.        00590000
006000     05  PC-REPORT-NBR               PIC X(02) VALUE '-1'.        00600000
006100     05  PC-MAX-LINE-COUNT           PIC S9(3) VALUE +60          00610000
006200                                               COMP-3.            00620000
006300     05  PC-SLASH                    PIC X(01) VALUE '/'.         00630000
006400     05  PC-DASH                     PIC X(01) VALUE '-'.         00640000
006500                                                                  00650000
006600 01  SD-DATE-TIME.                                                00660000
006700     05  SD-SYSTEM-DATE.                                          00670000
006800         10  SD-SYSTEM-DATE-YY       PIC 9(02) VALUE ZERO.        00680000
006900         10  SD-SYSTEM-DATE-MM       PIC 9(02) VALUE ZERO.        00690000
007000         10  SD-SYSTEM-DATE-DD       PIC 9(02) VALUE ZERO.        00700000
007100     05  SD-SYSTEM-TIME.                                          00710000
007200         10  SD-SYSTEM-TIME-HH       PIC 9(02) VALUE ZERO.        00720000
007300         10  SD-SYSTEM-TIME-MM       PIC 9(02) VALUE ZERO.        00730000
007400         10  SD-SYSTEM-TIME-SS       PIC 9(02) VALUE ZERO.        00740000
007500         10  FILLER                  PIC 9(02) VALUE ZERO.        00750000
007600*                                                                 00760000
007700 01  PV-PROGRAM-VARIABLES.                                        00770000
007800     05  PV-PREV-OPER                PIC  9(05).                  00780000
007900     05  PV-PREV-PO                  PIC  9(09).                  00790000
008000     05  PV-PREV-RCVR                PIC  9(04).                  00800000
008100     05  PV-SQLCODE                  PIC 9(09) VALUE ZERO.        00810000
008200     05  PV-PAGE-COUNT               PIC S9(4) VALUE ZERO         00820000
008300                                               COMP-3.            00830000
008400     05  PV-READ-COUNT                PIC S9(7) COMP-3            00840000
008500                                                VALUE ZERO.       00850000
008600     05  PV-WRITE-COUNT               PIC S9(7) COMP-3            00860000
008700                                                VALUE ZERO.       00870000
008800     05  PV-LINE-COUNT               PIC S9(3) VALUE ZERO         00880000
008900                                               COMP-3.            00890000
009000     05  PV-LINES-ON-PAGE            PIC  9(3) VALUE 60.          00900000
009100                                                                  00910000
009200     05  PV-RPT-DATE.                                             00920000
009300         10  PV-RPT-DATE-MM          PIC 9(02) VALUE ZERO.        00930000
009400         10  FILLER                  PIC X(01) VALUE '-'.         00940000
009500         10  PV-RPT-DATE-DD          PIC 9(02) VALUE ZERO.        00950000
009600         10  FILLER                  PIC X(01) VALUE '-'.         00960000
009700         10  PV-RPT-DATE-YY          PIC 9(02) VALUE ZERO.        00970000
009800                                                                  00980000
009900 01  PV-ABEND-FIELDS.                                             00990000
010000     05  PV-DB2-FUNCTION              PIC X(30) VALUE SPACES.     01000000
010100     05  PV-DB2-TABLE-NAME            PIC X(30) VALUE SPACES.     01010000
010200     05  PV-ABEND-CODE               PIC S9(4) VALUE +0           01020000
010300                                               COMP SYNC.         01030000
010400     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'RCKRP089'.  01040000
010500     05  PV-ABEND-PARAGRAPH          PIC X(50) VALUE SPACES.      01050000
010600     05  PV-ABEND-OPERATION          PIC X(50) VALUE SPACES.      01060000
010700     05  PV-ABEND-STRUCTURE-1        PIC X(08) VALUE SPACES.      01070000
010800                                                                  01080000
010900     05  PV-DISPLAY-READ-COUNT       PIC ZZZ,ZZZ,ZZ9.             01090000
011000     05  PV-DISPLAY-WRITE-COUNT      PIC ZZZ,ZZZ,ZZ9.             01100000
011100     05  PV-DISP-SQL                 PIC  -999.                   01110000
011200     05  PV-DISP-OPER                PIC  9999.                   01120000
011300                                                                  01130000
011400******************************************************************01140000
011500* RECORD LAYOUT FOR THE INPUT FILE.                               01150000
011600******************************************************************01160000
011700     COPY RCRD098.                                                01170000
011800                                                                  01180000
011900******************************************************************01190000
012000*  WORK FIELDS FOR PRINTING A 132 CHARACTER REPORT.               01200000
012100******************************************************************01210000
012200     COPY DPWS132O.                                               01220000
012300                                                                  01230000
012400 01  WS-BATCH-PROC-DATE.                                          01240000
012500     05  WS-BATCH-PROC-CC            PIC X(02) VALUE SPACES.      01250000
012600     05  WS-BATCH-PROC-YY            PIC X(02) VALUE SPACES.      01260000
012700     05  FILLER                      PIC X(01) VALUE SPACES.      01270000
012800     05  WS-BATCH-PROC-MM            PIC X(02) VALUE SPACES.      01280000
012900     05  FILLER                      PIC X(01) VALUE SPACES.      01290000
013000     05  WS-BATCH-PROC-DD            PIC X(02) VALUE SPACES.      01300000
013100*                                                                 01310000
013200 01  HEADING-LINES.                                               01320000
013300     05  HEADING-LINE1.                                           01330000
013400         10  FILLER                  PIC X(38) VALUE SPACES.      01340000
013500         10  FILLER                  PIC X(40) VALUE              01350000
013600         'PTL-CR RECEIVERS FROM FAILED POST VERIFY'.              01360000
013700         10  FILLER                  PIC X(18) VALUE              01370000
013800         ' ADJUSTMENTS BY PO'.                                    01380002
013900         10  FILLER                  PIC X(36) VALUE SPACES.      01390000
014000                                                                  01400000
014100     05  HEADING-LINE1A.                                          01410000
014200         10  FILLER                  PIC X(53) VALUE SPACES.      01420000
014300         10  FILLER                  PIC X(16) VALUE              01430000
014400         'PROCESS DATE OF '.                                      01440000
014500         10  HD1-PROCESS-DATE        PIC X(10) VALUE SPACES.      01450000
014600         10  FILLER                  PIC X(53) VALUE SPACES.      01460000
014700                                                                  01470000
015400     05  HEADING-LINE2.                                           01540001
015500         10  FILLER            PIC X(16) VALUE SPACES.            01550000
015600         10  FILLER            PIC X(03) VALUE 'NEW'.             01560000
015700         10  FILLER            PIC X(11) VALUE SPACES.            01570000
015800         10  FILLER            PIC X(04) VALUE 'ORIG'.            01580000
015900         10  FILLER            PIC X(66) VALUE SPACES.            01590000
016000         10  FILLER            PIC X(06) VALUE 'VERIFY'.          01600000
016100         10  FILLER            PIC X(05) VALUE SPACES.            01610000
016200         10  FILLER            PIC X(03) VALUE 'ERR'.             01620000
016300         10  FILLER            PIC X(03) VALUE SPACES.            01630000
016400         10  FILLER            PIC X(10) VALUE 'ADJUSTMENT'.      01640000
016500         10  FILLER            PIC X(05) VALUE SPACES.            01650000
016600                                                                  01660000
016700     05  HEADING-LINE3.                                           01670001
016800         10  FILLER            PIC X(04) VALUE 'OPER'.            01680000
016900         10  FILLER            PIC X(06) VALUE SPACES.            01690000
017000         10  FILLER            PIC X(02) VALUE 'PO'.              01700000
017100         10  FILLER            PIC X(03) VALUE SPACES.            01710000
017200         10  FILLER            PIC X(09) VALUE 'RCVR LINE'.       01720000
017300         10  FILLER            PIC X(02) VALUE SPACES.            01730000
017400         10  FILLER            PIC X(09) VALUE 'STR RCVR '.       01740000
017500         10  FILLER            PIC X(11) VALUE 'VENDOR NAME'.     01750000
017600         10  FILLER            PIC X(15) VALUE SPACES.            01760000
017700         10  FILLER            PIC X(05) VALUE 'DEPT'.            01770000
017800         10  FILLER            PIC X(09) VALUE 'DEPT NAME'.       01780000
017900         10  FILLER            PIC X(12) VALUE SPACES.            01790000
018000         10  FILLER            PIC X(07) VALUE 'SKU NBR'.         01800000
018100         10  FILLER            PIC X(05) VALUE SPACES.            01810000
018200         10  FILLER            PIC X(08) VALUE 'QUANTITY'.        01820000
018300         10  FILLER            PIC X(04) VALUE SPACES.            01830000
018400         10  FILLER            PIC X(03) VALUE 'NBR'.             01840000
018500         10  FILLER            PIC X(03) VALUE SPACES.            01850000
018600         10  FILLER            PIC X(09) VALUE 'ERR DESCR'.       01860000
018700         10  FILLER            PIC X(08) VALUE SPACES.            01870000
018800                                                                  01880000
018900                                                                  01890000
019000 01  DETAIL-LINES.                                                01900000
019100     05  DETAIL-LINE1.                                            01910000
019200         10  DL1-DC-NBR               PIC  Z(04) VALUE ZEROES.    01920000
019300         10  FILLER                   PIC  X(01) VALUE SPACES.    01930000
019400         10  DL1-PO                   PIC  Z(09) VALUE ZEROES.    01940000
019500         10  FILLER                   PIC  X(01) VALUE SPACES.    01950000
019600         10  DL1-NEW-RCVR             PIC  Z(04) VALUE ZEROES.    01960000
019700         10  FILLER                   PIC  X(01) VALUE SPACES.    01970000
019800         10  DL1-LINE                 PIC  Z(04) VALUE ZEROES.    01980000
019900         10  FILLER                   PIC  X(01) VALUE SPACES.    01990000
020000         10  DL1-STR                  PIC  Z(04) VALUE ZEROES.    02000000
020100         10  FILLER                   PIC  X(01) VALUE SPACES.    02010000
020200         10  DL1-ORIG-RCVR            PIC  Z(04) VALUE ZEROES.    02020000
020300         10  FILLER                   PIC  X(01) VALUE SPACES.    02030000
020400         10  DL1-VENDOR-NAME          PIC  X(25) VALUE SPACES.    02040000
020500         10  FILLER                   PIC  X(01) VALUE SPACES.    02050000
020600         10  DL1-DEPT                 PIC  9(04) VALUE ZEROES.    02060000
020700         10  FILLER                   PIC  X(01) VALUE SPACES.    02070000
020800         10  DL1-DEPT-NAME            PIC  X(20) VALUE SPACES.    02080000
020900         10  FILLER                   PIC  X(01) VALUE SPACES.    02090000
021000         10  DL1-SKU                  PIC  9(08) VALUE ZEROES.    02100000
021100         10  FILLER                   PIC  X(01) VALUE SPACES.    02110000
021200         10  DL1-VERIFY-QTY           PIC  ZZZ,ZZZ,ZZZ.           02120000
021300         10  FILLER                   PIC  X(03) VALUE SPACES.    02130000
021400         10  DL1-ADJ-ERR-CDE          PIC  X(04) VALUE SPACES.    02140000
021500         10  FILLER                   PIC  X(03) VALUE SPACES.    02150000
021600         10  DL1-ADJ-ERR-DESCR        PIC  X(10) VALUE SPACES.    02160000
021700         10  FILLER                   PIC  X(06) VALUE SPACES.    02170000
021800                                                                  02180000
021900                                                                  02190000
022000 01  MISCELLANEOUS-LINES.                                         02200000
022100     05  BLANK-LINE.                                              02210000
022200         10  FILLER                  PIC X(150) VALUE SPACES.     02220000
022300                                                                  02230000
022400     05  END-OF-REPORT-LINE.                                      02240000
022500         10  FILLER                  PIC X(44) VALUE SPACES.      02250000
022600         10  FILLER                  PIC X(45) VALUE              02260000
022700             '*******   E N D   O F   R E P O R T   *******'.     02270000
022800         10  FILLER                  PIC X(43) VALUE SPACES.      02280000
022900         10  FILLER                  PIC X(18) VALUE SPACES.      02290000
023000                                                                  02300000
023100     05  NO-DATA-TO-REPORT-LINE.                                  02310000
023200         10  FILLER                  PIC X(40) VALUE SPACES.      02320000
023300         10  FILLER                  PIC  X(52)    VALUE          02330000
023400         '*******  N O   D A T A   T O   R E P O R T   *******'.  02340000
023500         10  FILLER                  PIC  X(40)    VALUE SPACES.  02350000
023600         10  FILLER                  PIC X(18) VALUE SPACES.      02360000
023700                                                                  02370000
023800                                                                  02380000
023900******************************************************************02390000
024000*  USED FOR DB2 ERROR MESSAGE BUILDING                            02400000
024100******************************************************************02410000
024200     COPY DPWS004.                                                02420000
024300                                                                  02430000
024400******************************************************************02440000
024500*   DB2 SQL COMMUNICATION AREA                                    02450000
024600******************************************************************02460000
024700     EXEC SQL                                                     02470000
024800          INCLUDE SQLCA                                           02480000
024900     END-EXEC.                                                    02490000
025000                                                                  02500000
025100*---------------------------------------------------------------* 02510000
025200*  DCLGEN FOR THE LOGISTICS LOCATION TABLE                        02520000
025300*  XLT_LOC                                                        02530000
025400*---------------------------------------------------------------* 02540000
025500     EXEC SQL                                                     02550000
025600          INCLUDE XLT00010                                        02560000
025700     END-EXEC.                                                    02570000
025800                                                                  02580000
025900*---------------------------------------------------------------* 02590000
026000*  TPURCHS                                                        02600000
026100*---------------------------------------------------------------* 02610000
026200     EXEC SQL                                                     02620000
026300          INCLUDE TPURCHS                                         02630000
026400     END-EXEC.                                                    02640000
026500                                                                  02650000
026600*---------------------------------------------------------------* 02660000
026700*  XLT_DEPT                                                       02670000
026800*---------------------------------------------------------------* 02680000
026900     EXEC SQL                                                     02690000
027000          INCLUDE XLT00002                                        02700000
027100     END-EXEC.                                                    02710000
027200                                                                  02720000
027300*---------------------------------------------------------------* 02730000
027400*  TENTNME                                                        02740000
027500*---------------------------------------------------------------* 02750000
027600     EXEC SQL                                                     02760000
027700          INCLUDE TENTNME                                         02770000
027800     END-EXEC.                                                    02780000
027900                                                                  02790000
028000******************************************************************02800000
028100 PROCEDURE DIVISION.                                              02810000
028200     DISPLAY '**** START OF RCKRP089 ****'.                       02820000
028300                                                                  02830000
028400*OPEN FILES.                                                      02840000
028500     OPEN INPUT  INPUT-FILE                                       02850000
028600          OUTPUT REPORT-FILE.                                     02860000
028700                                                                  02870000
028800     PERFORM 1000-INITIALIZATION.                                 02880000
028900                                                                  02890000
029000     SET  PS-NOT-END-OF-INPUT   TO  TRUE.                         02900000
029100                                                                  02910000
029200     PERFORM 7000-READ-EXTRACT-FILE.                              02920000
029300                                                                  02930000
029400     MOVE RC098-ORIG-OPER-UNIT  TO  PV-PREV-OPER.                 02940000
029500     MOVE RC098-ORIG-PO-NBR     TO  PV-PREV-PO.                   02950000
029600     MOVE RC098-ORIG-PO-RCVR    TO  PV-PREV-RCVR.                 02960000
029700                                                                  02970000
029800     IF PS-END-OF-INPUT                                           02980000
029900        ADD +1                  TO PV-PAGE-COUNT                  02990000
030000        MOVE PV-PAGE-COUNT      TO DP132O-PAGE-NUMBER             03000000
030100        WRITE REPORT-RECORD                                       03010000
030200          FROM DP132O-STANDRD-HEADER-132-COLS                     03020000
030300            AFTER ADVANCING PAGE                                  03030000
030400        WRITE REPORT-RECORD                                       03040000
030500          FROM HEADING-LINE1                                      03050000
030600            AFTER ADVANCING 1 LINES                               03060000
030700        WRITE REPORT-RECORD                                       03070000
030800          FROM HEADING-LINE1A                                     03080000
030900            AFTER ADVANCING 1 LINES                               03090000
031000        WRITE REPORT-RECORD                                       03100000
031100          FROM HEADING-LINE2                                      03110000
031200            AFTER ADVANCING 1 LINE                                03120000
031210        WRITE REPORT-RECORD                                       03121001
031220          FROM HEADING-LINE3                                      03122001
031230            AFTER ADVANCING 1 LINE                                03123001
031300        WRITE REPORT-RECORD                                       03130000
031400          FROM NO-DATA-TO-REPORT-LINE                             03140000
031500            AFTER ADVANCING 2 LINES                               03150000
031600     ELSE                                                         03160000
031700         MOVE RC098-ORIG-OPER-UNIT  TO  PV-PREV-OPER              03170000
031900         PERFORM 1500-PRINT-HEADINGS                              03190000
032000         PERFORM 3000-GET-VENDOR-INFO                             03200000
032100         PERFORM 3010-GET-DEPT-INFO                               03210000
032200         PERFORM 2000-PROCESS-INPUT                               03220000
032300           UNTIL PS-END-OF-INPUT                                  03230000
032400     END-IF.                                                      03240000
032500                                                                  03250000
032600*FINISH REPORT.                                                   03260000
032700                                                                  03270000
032800     WRITE REPORT-RECORD                                          03280000
032900       FROM END-OF-REPORT-LINE                                    03290000
033000         AFTER ADVANCING 3 LINES.                                 03300000
033100                                                                  03310000
033200*CLOSE FILES.                                                     03320000
033300     CLOSE INPUT-FILE                                             03330000
033400           REPORT-FILE.                                           03340000
033500                                                                  03350000
033600     MOVE PV-READ-COUNT TO PV-DISPLAY-READ-COUNT.                 03360000
033700     DISPLAY 'TOTAL INPUT READ ' PV-DISPLAY-READ-COUNT.           03370000
033800                                                                  03380000
033900     MOVE PV-WRITE-COUNT TO PV-DISPLAY-WRITE-COUNT.               03390000
034000     DISPLAY 'TOTAL RECS WRITTEN ' PV-DISPLAY-WRITE-COUNT.        03400000
034100                                                                  03410000
034200     GOBACK.                                                      03420000
034300*                                                                 03430000
034400******************************************************************03440000
034500*  PERFORM THE INITIAL PROCESSING FOR THE PROGRAM.               *03450000
034600******************************************************************03460000
034700 1000-INITIALIZATION.                                             03470000
034800     ACCEPT SD-SYSTEM-DATE                                        03480000
034900       FROM DATE.                                                 03490000
035000                                                                  03500000
035100     ACCEPT SD-SYSTEM-TIME                                        03510000
035200       FROM TIME.                                                 03520000
035300                                                                  03530000
035400     MOVE SD-SYSTEM-DATE-MM  TO DP132O-RUN-MONTH.                 03540000
035500     MOVE SD-SYSTEM-DATE-DD  TO DP132O-RUN-DAY.                   03550000
035600     MOVE SD-SYSTEM-DATE-YY  TO DP132O-RUN-YEAR.                  03560000
035700     MOVE SD-SYSTEM-TIME-HH  TO DP132O-RUN-HOUR.                  03570000
035800     MOVE SD-SYSTEM-TIME-MM  TO DP132O-RUN-MINUTE.                03580000
035900                                                                  03590000
036000     MOVE SD-SYSTEM-DATE-MM  TO PV-RPT-DATE-MM.                   03600000
036100     MOVE SD-SYSTEM-DATE-DD  TO PV-RPT-DATE-DD.                   03610000
036200     MOVE SD-SYSTEM-DATE-YY  TO PV-RPT-DATE-YY.                   03620000
036300                                                                  03630000
036400     MOVE PC-RCKRP089             TO DP132O-PROGRAM-NAME.         03640000
036500     MOVE PC-REPORT-NBR           TO DP132O-REPORT-NUMBER.        03650000
036600     MOVE +0                      TO PV-PAGE-COUNT.               03660000
036700                                                                  03670000
036800                                                                  03680000
036900******************************************************************03690000
037000**  WRITES REPORT HEADER LINES FOR FIRST PAGE AND ANY SUBSEQUENT  03700000
037100**  PAGES (AS NEEDED).                                            03710000
037200******************************************************************03720000
037300 1500-PRINT-HEADINGS.                                             03730000
037400     ADD +1                  TO PV-PAGE-COUNT.                    03740000
037500     MOVE PV-PAGE-COUNT      TO DP132O-PAGE-NUMBER.               03750000
037600                                                                  03760000
037700     MOVE PV-RPT-DATE        TO  HD1-PROCESS-DATE.                03770000
037800                                                                  03780000
037900     WRITE REPORT-RECORD                                          03790000
038000       FROM DP132O-STANDRD-HEADER-132-COLS                        03800000
038100         AFTER ADVANCING PAGE.                                    03810000
038200                                                                  03820000
038300     WRITE REPORT-RECORD                                          03830000
038400       FROM HEADING-LINE1                                         03840000
038500         AFTER ADVANCING 1 LINES.                                 03850000
038600                                                                  03860000
038700     WRITE REPORT-RECORD                                          03870000
038800       FROM HEADING-LINE1A                                        03880000
038900         AFTER ADVANCING 1 LINES.                                 03890000
039000                                                                  03900000
039100     WRITE REPORT-RECORD                                          03910000
039200       FROM HEADING-LINE2                                         03920000
039300         AFTER ADVANCING 2 LINES.                                 03930001
039400                                                                  03940000
039500     WRITE REPORT-RECORD                                          03950000
039600       FROM HEADING-LINE3                                         03960000
039700         AFTER ADVANCING 1 LINES.                                 03970001
039800                                                                  03980000
040300     WRITE REPORT-RECORD                                          04030000
040400       FROM BLANK-LINE                                            04040000
040500         AFTER ADVANCING 1 LINE.                                  04050000
040600                                                                  04060000
040700     MOVE +05                TO PV-LINE-COUNT.                    04070000
040800                                                                  04080000
040900                                                                  04090000
041000******************************************************************04100000
041100**  READ INPUT-FILE, WHEN DC CHANGES, DO A PAGE BREAK             04110000
041200******************************************************************04120000
041300 2000-PROCESS-INPUT.                                              04130000
041400                                                                  04140001
041500     IF  RC098-ORIG-PO-NBR  =  PV-PREV-PO   AND                   04150001
041600         RC098-ORIG-PO-RCVR =  PV-PREV-RCVR                       04160001
041700         CONTINUE                                                 04170001
041800     ELSE                                                         04180001
041900         PERFORM 6000-PRINT-BLANK-LINE                            04190001
042000         IF  PV-LINE-COUNT  > PV-LINES-ON-PAGE                    04200001
042100             PERFORM 1500-PRINT-HEADINGS                          04210001
042200         END-IF                                                   04220001
042300     END-IF.                                                      04230001
042400                                                                  04240001
043200     IF  RC098-ORIG-PO-NBR  =  PV-PREV-PO                         04320001
043300         CONTINUE                                                 04330000
043400     ELSE                                                         04340000
043500         PERFORM 3000-GET-VENDOR-INFO                             04350000
043600         PERFORM 3010-GET-DEPT-INFO                               04360000
043700     END-IF.                                                      04370000
043800                                                                  04380000
043900     MOVE RC098-ORIG-PO-NBR     TO  PV-PREV-PO.                   04390000
044000     MOVE RC098-ORIG-PO-RCVR    TO  PV-PREV-RCVR.                 04400000
044100                                                                  04410000
044200     PERFORM 5000-WRITE-RPT-DTL.                                  04420000
044300                                                                  04430000
044400     PERFORM 7000-READ-EXTRACT-FILE.                              04440000
044500                                                                  04450000
044600                                                                  04460000
044700****************************************************************  04470000
044800* GET VENDOR NAME                                              *  04480000
044900****************************************************************  04490000
045000 3000-GET-VENDOR-INFO.                                            04500000
045100                                                                  04510000
045200     MOVE  RC098-ORIG-PO-NBR  TO PURCHS-PO-NBR.                   04520000
045300                                                                  04530000
045400     EXEC SQL                                                     04540000
045500          SELECT                                                  04550000
045600                 A.DEPT_NBR                                       04560000
045700               , B.ENT_NAME_DESC                                  04570000
045800            INTO                                                  04580000
045900                 :PURCHS-DEPT-NBR                                 04590000
046000               , :ENTNME-ENT-NAME-DESC                            04600000
046100            FROM TPURCHS A,                                       04610000
046200                 TENTNME B                                        04620000
046300           WHERE A.VER_STATUS_CDE = 'A'                           04630000
046400             AND A.PO_NBR         = :PURCHS-PO-NBR                04640000
046500             AND A.ENT_ID         = B.ENT_ID                      04650000
046600             AND B.TYPE_CDE       = '01'                          04660000
046700            WITH UR                                               04670000
046800     END-EXEC.                                                    04680000
046900                                                                  04690000
047000     EVALUATE TRUE                                                04700000
047100         WHEN SQLCODE = +0                                        04710000
047200              CONTINUE                                            04720000
047300         WHEN SQLCODE = +100                                      04730000
047400              MOVE 'UNKNOWN'  TO  ENTNME-ENT-NAME-DESC            04740000
047500         WHEN OTHER                                               04750000
047600             MOVE SQLCODE                 TO  PV-DISP-SQL         04760000
047700             DISPLAY 'RCKRP089: 3000-'                            04770000
047800                     ' SQL:'  PV-DISP-SQL                         04780000
047900                     ' RCVR:' RC098-ORIG-OPER-UNIT                04790000
048000                     '-'      RC098-ORIG-PO-NBR                   04800000
048100                     '-'      RC098-ORIG-PO-RCVR                  04810000
048200                     '-'      RC098-ORIG-PO-LNE-NBR               04820000
048300                     '-'      RC098-ORIG-STR-NBR                  04830000
048400                                                                  04840000
048500             MOVE '3000-GET-VENDOR-INFO  '                        04850000
048600                           TO PV-ABEND-PARAGRAPH                  04860000
048700             MOVE 'GET VENDOR NAME'   TO PV-DB2-FUNCTION          04870000
048800             MOVE 'TENTNME '          TO PV-DB2-TABLE-NAME        04880000
048900             PERFORM 9900-DB2-ABEND                               04890000
049000     END-EVALUATE.                                                04900000
049100                                                                  04910000
049200                                                                  04920000
049300****************************************************************  04930000
049400* GET DEPT NAME                                                *  04940000
049500****************************************************************  04950000
049600 3010-GET-DEPT-INFO.                                              04960000
049700                                                                  04970000
049800     MOVE  PURCHS-DEPT-NBR  TO  XLT00002-DEPT-NBR                 04980000
049900                                                                  04990000
050000     EXEC SQL                                                     05000000
050100          SELECT                                                  05010000
050200                 DEPT_NM                                          05020000
050300            INTO                                                  05030000
050400                 :XLT00002-DEPT-NM                                05040000
050500            FROM XLT_DEPT                                         05050000
050600           WHERE DEPT_NBR         = :XLT00002-DEPT-NBR            05060000
050700            WITH UR                                               05070000
050800     END-EXEC.                                                    05080000
050900                                                                  05090000
051000     EVALUATE TRUE                                                05100000
051100         WHEN SQLCODE = +0                                        05110000
051200              CONTINUE                                            05120000
051300         WHEN SQLCODE = +100                                      05130000
051400              MOVE 'UNKNOWN'  TO  XLT00002-DEPT-NM                05140000
051500         WHEN OTHER                                               05150000
051600             MOVE SQLCODE                 TO  PV-DISP-SQL         05160000
051700             DISPLAY 'RCKRP089: 3010-'                            05170000
051800                     ' SQL:'  PV-DISP-SQL                         05180000
051900                     ' RCVR:' RC098-ORIG-OPER-UNIT                05190000
052000                     '-'      RC098-ORIG-PO-NBR                   05200000
052100                     '-'      RC098-ORIG-PO-RCVR                  05210000
052200                     '-'      RC098-ORIG-PO-LNE-NBR               05220000
052300                     '-'      RC098-ORIG-STR-NBR                  05230000
052400                                                                  05240000
052500             MOVE '3010-GET-DEPT-INFO    '                        05250000
052600                           TO PV-ABEND-PARAGRAPH                  05260000
052700             MOVE 'GET DEPT NAME'     TO PV-DB2-FUNCTION          05270000
052800             MOVE 'XLT_DEPT'          TO PV-DB2-TABLE-NAME        05280000
052900             PERFORM 9900-DB2-ABEND                               05290000
053000     END-EVALUATE.                                                05300000
053100                                                                  05310000
053200                                                                  05320000
053300****************************************************************  05330000
053400* MOVE THE DETAILS TO REPORT LINE.                             *  05340000
053500****************************************************************  05350000
053600 5000-WRITE-RPT-DTL.                                              05360000
053700                                                                  05370000
053800     MOVE RC098-ORIG-OPER-UNIT      TO DL1-DC-NBR                 05380000
053900     MOVE RC098-ORIG-PO-NBR         TO DL1-PO                     05390000
054000     MOVE RC098-NEW-PO-RCVR         TO DL1-NEW-RCVR               05400000
054100     MOVE RC098-ORIG-PO-LNE-NBR     TO DL1-LINE                   05410000
054200     MOVE RC098-ORIG-STR-NBR        TO DL1-STR                    05420000
054300     MOVE RC098-ORIG-PO-RCVR        TO DL1-ORIG-RCVR              05430000
054400     MOVE ENTNME-ENT-NAME-DESC      TO DL1-VENDOR-NAME            05440000
054500     MOVE XLT00002-DEPT-NBR         TO DL1-DEPT                   05450000
054600     MOVE XLT00002-DEPT-NM          TO DL1-DEPT-NAME              05460000
054700     MOVE RC098-SKU-NBR             TO DL1-SKU                    05470000
054800     MOVE RC098-TO-VERIFY-QTY       TO DL1-VERIFY-QTY             05480000
054900     MOVE RC098-FINCL-ADJ-ERR-CDE   TO DL1-ADJ-ERR-CDE            05490000
055000     MOVE RC098-ADJ-ERR-DESC        TO DL1-ADJ-ERR-DESCR          05500000
055100                                                                  05510000
055200     WRITE REPORT-RECORD                                          05520000
055300      FROM DETAIL-LINE1                                           05530000
055400     AFTER ADVANCING 1 LINES.                                     05540000
055500                                                                  05550000
055600     ADD  1                  TO PV-LINE-COUNT.                    05560000
055700     IF  PV-LINE-COUNT  > PV-LINES-ON-PAGE                        05570000
055800         PERFORM 1500-PRINT-HEADINGS                              05580000
055900     END-IF.                                                      05590000
056000                                                                  05600000
056100                                                                  05610000
056200****************************************************************  05620000
056300* PRINTS A BLANK LINE                                          *  05630000
056400****************************************************************  05640000
056500 6000-PRINT-BLANK-LINE.                                           05650000
056600                                                                  05660000
056700        WRITE REPORT-RECORD                                       05670000
056800          FROM BLANK-LINE                                         05680000
056900            AFTER ADVANCING 1 LINE                                05690000
057000                                                                  05700000
057100     ADD +1 TO PV-LINE-COUNT.                                     05710000
057200                                                                  05720000
057300******************************************************************05730000
057400*  READ A FROM THE INPUT FILE                                    *05740000
057500******************************************************************05750000
057600 7000-READ-EXTRACT-FILE.                                          05760000
057610                                                                  05761001
057700     READ INPUT-FILE                                              05770000
057800          INTO RC098-ITEM-REC                                     05780000
057900         AT END                                                   05790000
058000             SET PS-END-OF-INPUT TO TRUE                          05800000
058100         NOT AT END                                               05810000
058200             ADD +1 TO PV-READ-COUNT                              05820000
058300     END-READ.                                                    05830000
058400                                                                  05840000
060900******************************************************************06090000
061000*  ABEND ROUTINE                                                 *06100000
061100******************************************************************06110000
061200 9900-DB2-ABEND.                                                  06120000
061300                                                                  06130000
061400     MOVE SQLCODE TO PV-SQLCODE.                                  06140000
061500     DISPLAY '*** DB2 ERROR '.                                    06150000
061600     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       06160000
061700     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 06170000
061800     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               06180000
061900     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               06190000
062000     DISPLAY '*** FUNCTION  = ' PV-DB2-FUNCTION.                  06200000
062100     DISPLAY '*** TABLE 1   = ' PV-DB2-TABLE-NAME.                06210000
062200                                                                  06220000
062300     COPY DPPD004.                                                06230000
062400                                                                  06240000
062500     MOVE +4013 TO PV-ABEND-CODE.                                 06250000
062600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         06260000
062700                                                                  06270000
062800 9998-ABEND.                                                      06280000
062900                                                                  06290000
063000     DISPLAY '***************'.                                   06300000
063100     DISPLAY '** ABEND     **'.                                   06310000
063200     DISPLAY '** PROGRAM   ** = ' PV-ABEND-PROGRAM.               06320000
063300     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             06330000
063400     DISPLAY '***************'.                                   06340000
063500                                                                  06350000
063600     MOVE +4008                  TO PV-ABEND-CODE.                06360000
063700     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         06370000
063800                                                                  06380000
063900 9999-ABEND.                                                      06390000
064000                                                                  06400000
064100     DISPLAY '***************'.                                   06410000
064200     DISPLAY '** ABEND     **'.                                   06420000
064300     DISPLAY '** PROGRAM   ** = ' PV-ABEND-PROGRAM.               06430000
064400     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             06440000
064500     DISPLAY '***************'.                                   06450000
064600                                                                  06460000
064700     MOVE +4008                  TO PV-ABEND-CODE.                06470000
064800     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         06480000
064900                                                                  06490000
065000******************************************************************06500000
065100*                 E N D   O F   P R O G R A M                    *06510000
065200******************************************************************06520000
