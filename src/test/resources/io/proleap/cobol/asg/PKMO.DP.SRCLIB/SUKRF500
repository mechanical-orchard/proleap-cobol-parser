000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             SUKRF500.                                00050000
000600 AUTHOR.                 LARRY SCHLEICHER - STRATAGEM             00060000
000700 INSTALLATION.           KOHLS.                                   00070000
000800 DATE-WRITTEN            JUNE, 1996.                              00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200* THIS PROGRAM DISPLAYS THE SHIPPING UNIT RF MENU ON THE         *00120000
001300* LRT (LASER RADIO TERMINAL) AND PASSES CONTROL TO THE PROGRAM   *00130000
001400* WHICH PROCESSES THE SELECTED FUNCTION.                         *00140000
001410* 05/31/2013  SHOBHIT BAIJAL           TKID: TKMALR7             *00141000
001420*             MODIFIED FOR THE RFID PROJECT #5148B. THIS CHANGE  *00142064
001430*             IS TO ADD AN OPTION '5' FOR PRINTING FINAL RFID    *00143000
001440*             LABEL.                                             *00144000
001450*             CHANGES TAGGED AS SB 05/31/13 PR5148B              *00145000
001500******************************************************************00150000
263968* CHANGED 11/16/2021    BY JIM HUNTER      WR: CHG0263968         00152067
263968* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00153067
263968* MAKING THE CALL DYNAMIC VS STATIC.                              00154067
001500******************************************************************00155068
001600                                                                  00160000
001700******************************************************************00170000
001800 ENVIRONMENT DIVISION.                                            00180000
001900******************************************************************00190000
002000                                                                  00200000
002100******************************************************************00210000
002200 DATA DIVISION.                                                   00220000
002300******************************************************************00230000
002400                                                                  00240000
002500******************************************************************00250000
002600 WORKING-STORAGE SECTION.                                         00260000
002700******************************************************************00270000
002800     COPY MPWS026.                                                00280000
002900 01  CA-COMMAREA.                                                 00290000
003000     05  CA-COMMON-DATA.                                          00300000
003100         10  CA-TRANSACTION-STATUS                                00310000
003200                                         PIC  X(01)  VALUE SPACE. 00320000
003300             88  CA-INITIALIZE-SCREEN                VALUE 'S'.   00330000
003400             88  CA-PROCESS-SCREEN                   VALUE 'R'.   00340000
003500         10  CA-LAST-PROGRAM             PIC  X(08)  VALUE SPACE. 00350000
003600     05  CA-PROGRAM-DATA.                                         00360000
003700         10  CA-SELECTION-X              PIC  X(01)  VALUE SPACE. 00370000
003800             88  CA-VALID-SELECTION                  VALUES       00380000
003810* SB 05/31/13 PR5148B START                                       00381000
003900                 '1' '2' '3' '4' '5' '6'.                         00390065
003910* SB 05/31/13 PR5148B END                                         00391000
004100         10  CA-SELECTION  REDEFINES  CA-SELECTION-X              00410000
004200                                         PIC  9(01).              00420000
004300             88  CA-SELECTION-ONE                    VALUE 1.     00430000
004400             88  CA-SELECTION-TWO                    VALUE 2.     00440000
004410             88  CA-SELECTION-THREE                  VALUE 3.     00441000
004411             88  CA-SELECTION-FOUR                   VALUE 4.     00441100
004412* SB 05/31/13 PR5148B START                                       00441200
004413             88  CA-SELECTION-FIVE                   VALUE 5.     00441300
004414* SB 05/31/13 PR5148B END                                         00441400
004415             88  CA-SELECTION-SIX                    VALUE 6.     00441564
004420         10  CA-FILLER1                  PIC  X(290) VALUE SPACE. 00442000
004600                                                                  00460000
004700 01  CA-COMMAREA-2.                                               00470000
004800     COPY SUWS001.                                                00480000
004900                                                                  00490000
005000 01  PC-PROGRAM-CONSTANTS.                                        00500000
005200     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     00520000
005300                                                     COMP SYNC.   00530000
005310     05  PC-PGM-TBL-LENGTH               PIC S9(05)  VALUE +0     00531000
005320                                                     COMP-3.      00532000
005400     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00540000
005500         'SUKRF500'.                                              00550000
005600     05  PC-DC-RF-APPL-PGM               PIC  X(08)  VALUE        00560000
005700         'MPKCS027'.                                              00570000
005800     05  PC-MENU-TRANID                  PIC  X(04)  VALUE 'S500'.00580000
005900     05  PC-CHECK-AUTH-FOR-TRAN-S501     PIC  X(04)  VALUE 'S501'.00590000
006000     05  PC-CHECK-AUTH-FOR-TRAN-S529     PIC  X(04)  VALUE 'S529'.00600000
006100     05  PC-CHECK-AUTH-FOR-TRAN-S508     PIC  X(04)  VALUE 'S508'.00610000
006110     05  PC-CHECK-AUTH-FOR-TRAN-S538     PIC  X(04)  VALUE 'S538'.00611000
006120     05  PC-CHECK-AUTH-FOR-TRAN-S742     PIC  X(04)  VALUE 'S742'.00612000
006121     05  PC-CHECK-AUTH-FOR-TRAN-S743     PIC  X(04)  VALUE 'S743'.00612164
006130* SB 05/31/13 PR5148B START                                       00613000
006140     05  PC-CHECK-AUTH-FOR-TRAN-S705     PIC  X(04)  VALUE 'S705'.00614000
006150* SB 05/31/13 PR5148B END                                         00615000
006200     05  PC-END-OF-SESSION-MSG           PIC  X(19)  VALUE        00620000
006300         'END OF SESSION     '.                                   00630000
006400     05  PC-INVALID-SELECTION-MSG        PIC  X(19)  VALUE        00640000
006500         'INVALID SELECTION  '.                                   00650000
006600     05  PC-UNRECOGNIZED-PF-KEY-MSG      PIC  X(19)  VALUE        00660000
006700         'UNRECOGNIZED PF KEY'.                                   00670000
006800     05  PC-ACCESS-NOT-ALLOWED-MSG       PIC  X(19)  VALUE        00680000
006900         'USER NOT AUTHORIZED'.                                   00690000
007000     05  PC-NON-NUMERIC-SELECTION-MSG    PIC  X(19)  VALUE        00700000
007100         'NUMERIC VALUE REQ. '.                                   00710000
007200     05  PC-PROGRAM-FUNCTION-KEYS        PIC  X(19)  VALUE        00720000
007300         'F3 =END            '.                                   00730000
007400     05  PC-TRANS-UNAVAILABLE-MSG        PIC  X(19)  VALUE        00740000
007500         'TRANS NOT AVAILABLE'.                                   00750000
007600     05  PC-CICS-ABEND-MSG               PIC  X(19)  VALUE        00760000
007700         'CICS ABEND -CALL DP'.                                   00770000
007800     05  PC-CICSAUTH-MSG                 PIC  X(19)  VALUE        00780000
007900         'CICSAUTH BAD RETURN'.                                   00790000
008000     05  PC-UNAVAIL-SELECTION-MSG        PIC X(19)   VALUE        00800000
008100         'SELECTION NOT AVAIL'.                                   00810000
008110* RPK 06/2007 - ADD NEW MESSAGE                                   00811000
008120     05  PC-DC-IN-WMOS-MSG               PIC X(19)   VALUE        00812000
008130         'ERR - DC IS ON WMS'.                                    00813000
008140                                                                  00814000
008200                                                                  00820000
008500                                                                  00850000
008600                                                                  00860000
008700 01  PN-PGM-NAME-DATA.                                            00870000
008800     05  PN-SELECTION-01-PROGRAM         PIC  X(08)  VALUE        00880000
009000         'SUKRF529'.                                              00900000
009100     05  PN-SELECTION-02-PROGRAM         PIC  X(08)  VALUE        00910000
009200         'SUKRF508'.                                              00920000
009210     05  PN-SELECTION-03-PROGRAM         PIC  X(08)  VALUE        00921000
009220         'SUKRF538'.                                              00922000
009230     05  PN-SELECTION-04-PROGRAM         PIC  X(08)  VALUE        00923000
009240         'SUKRF742'.                                              00924000
009250* SB 05/31/13 PR5148B START                                       00925000
009251     05  PN-SELECTION-05-PROGRAM         PIC  X(08)  VALUE        00925100
009252         'SUKRF705'.                                              00925200
009270* SB 05/31/13 PR5148B END                                         00927000
009280     05  PN-SELECTION-06-PROGRAM         PIC  X(08)  VALUE        00928064
009290         'SUKRF743'.                                              00929064
009300                                                                  00930000
009400 01  PN-PGM-NAME-TABLE  REDEFINES  PN-PGM-NAME-DATA.              00940000
009410* SB 05/31/13 PR5148B START                                       00941000
009500     05  PN-PGM-NAME  OCCURS 6 TIMES                              00950064
009600                      INDEXED BY PN-INDX                          00960000
009700                                         PIC  X(08).              00970000
009710* SB 05/31/13 PR5148B END                                         00971000
009800                                                                  00980000
009900 01  PS-PROGRAM-SWITCHES.                                         00990000
010000     05  PS-ACCESS-ALLOWED-IND           PIC  X(01)  VALUE 'N'.   01000000
010100         88  PS-NO-ACCESS-ALLOWED                    VALUE 'N'.   01010000
010200         88  PS-ACCESS-ALLOWED                       VALUE 'Y'.   01020000
010210     05  PS-DC-ON-WMOS-SW               PIC  X       VALUE 'N'.   01021000
010220         88  PS-DC-ON-WMOS-YES                       VALUE 'Y'.   01022000
010230         88  PS-DC-ON-WMOS-NO                        VALUE 'N'.   01023000
010300                                                                  01030000
010400                                                                  01040000
010500 01  PV-PROGRAM-VARIABLES.                                        01050000
010600     05  PV-MESSAGE-AREA                 PIC  X(19)  VALUE SPACE. 01060000
010700     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  01070000
010800                                                     COMP SYNC.   01080000
010900     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 01090000
011000                                                                  01100000
011020* RPK 06/2007 - ADD KEY FIELDS                                    01102000
011030 01  DK-DB2-KEYS.                                                 01103000
011040     05  DK-OPER-UNT-ID                  PIC S9(04) COMP.         01104000
011050     05  DK-CURRENT-TIMESTAMP            PIC X(26)   VALUE SPACES.01105000
011060                                                                  01106000
011100******************************************************************01110000
011200*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               01120000
011300******************************************************************01130000
011400     COPY DPWS013.                                                01140000
011500                                                                  01150000
011600******************************************************************01160000
011700*    COPY BOOK FOR THE CICSAUTH SUBROUTINE                        01170000
011800******************************************************************01180000
011900     COPY DPWS008.                                                01190000
012000                                                                  01200000
012010******************************************************************01201000
012020*  COPY BOOK FOR THE LOGIN INFO SUBROUTINE.                       01202000
012030******************************************************************01203000
012040     COPY DPWS026.                                                01204000
012050                                                                  01205000
012100******************************************************************01210000
012200*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 01220000
012300******************************************************************01230000
012400     COPY DPWS010I.                                               01240000
012500                                                                  01250000
012600******************************************************************01260000
012700*  GENERATED DSECT FOR THE SUKM500 MAPSET                         01270000
012800******************************************************************01280000
012900     COPY SUKM500.                                                01290000
013000                                                                  01300000
013100******************************************************************01310000
013200* HELP SCREEN COMMAREA                                            01320000
013300******************************************************************01330000
013400     COPY PCWS192.                                                01340000
013500                                                                  01350000
013600******************************************************************01360000
013700* HELP SCREEN WORK AREA                                           01370000
013800******************************************************************01380000
013900     COPY PCWS188.                                                01390000
014000                                                                  01400000
014100******************************************************************01410000
014200*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   01420000
014300******************************************************************01430000
014400     COPY DPWS015.                                                01440000
014500                                                                  01450000
014600******************************************************************01460000
014700*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      01470000
014800******************************************************************01480000
014900     COPY DFHAID.                                                 01490000
015000                                                                  01500000
015010* RPK 06/2007 - ADD WST00008/9/10                                 01501000
015020******************************************************************01502000
015030*  SQL AND COBOL DECLARATIONS FOR WST_INTGRTN_TYP                 01503000
015040******************************************************************01504000
015050     EXEC SQL                                                     01505000
015060          INCLUDE WST00008                                        01506000
015070     END-EXEC.                                                    01507000
015080******************************************************************01508000
015090*  SQL AND COBOL DECLARATIONS FOR WST_ATTR_DEFN                   01509000
015091******************************************************************01509100
015092     EXEC SQL                                                     01509200
015093          INCLUDE WST00009                                        01509300
015094     END-EXEC.                                                    01509400
015095******************************************************************01509500
015096*  SQL AND COBOL DECLARATIONS FOR WST_ATTR_ELEM                   01509600
015097******************************************************************01509700
015098     EXEC SQL                                                     01509800
015099          INCLUDE WST00010                                        01509900
015100     END-EXEC.                                                    01510000
015101                                                                  01510100
015102******************************************************************01510200
015103*  COMMUNICATIONS AREA FOR DB2                                    01510300
015104******************************************************************01510400
015105     EXEC SQL                                                     01510500
015106         INCLUDE SQLCA                                            01510600
015107     END-EXEC.                                                    01510700
015108                                                                  01510800
015110******************************************************************01511000
015200 LINKAGE SECTION.                                                 01520000
015300******************************************************************01530000
015400 01  DFHCOMMAREA.                                                 01540000
015500     05  FILLER                       OCCURS 1 TO 4072 TIMES      01550000
015600                                      DEPENDING ON EIBCALEN.      01560000
015700         10  FILLER                   PIC X.                      01570000
015800                                                                  01580000
015900                                                                  01590000
016000******************************************************************01600000
016100 PROCEDURE DIVISION.                                              01610000
016200******************************************************************01620000
016300 0000-PROGRAM-MAINLINE.                                           01630000
016400     INITIALIZE                         CA-COMMAREA.              01640000
016500     MOVE DFHCOMMAREA                TO CA-COMMAREA.              01650000
016600     MOVE LOW-VALUES                 TO SU500AI.                  01660000
016700                                                                  01670000
016710     COMPUTE PC-PGM-TBL-LENGTH = LENGTH OF PN-PGM-NAME-TABLE      01671000
016720                               / LENGTH OF PN-PGM-NAME.           01672000
016730                                                                  01673000
016800     EVALUATE TRUE                                                01680000
016900         WHEN EIBCALEN = ZERO                                     01690000
017000         WHEN EIBAID = DFHCLEAR                                   01700000
017100         WHEN CA-INITIALIZE-SCREEN                                01710000
017200              INITIALIZE CA-COMMAREA                              01720000
017300*             MOVE PC-PROGRAM-FUNCTION-KEYS                       01730000
017400*                                    TO AMSGLNO                   01740000
017500              PERFORM 8000-SEND-MAP                               01750000
017600              PERFORM 8200-RETURN-TRANID                          01760000
017700         WHEN EIBAID = DFHENTER                                   01770000
017800              PERFORM 1000-RECEIVE-MAP                            01780000
017900              PERFORM 1100-EDIT-SELECTION                         01790000
018000         WHEN EIBAID = DFHPF3                                     01800000
018100              MOVE PC-DC-RF-APPL-PGM TO PV-TRANSFER-PROGRAM       01810000
018200              PERFORM 2100-XCTL-TO-SELECTED-PROGRAM               01820000
018300         WHEN EIBAID = DFHPF1                                     01830000
018400              PERFORM 1400-HELP-SCREEN                            01840000
018500         WHEN OTHER                                               01850000
018600              MOVE PC-UNRECOGNIZED-PF-KEY-MSG                     01860000
018700                                     TO AMSGLNO                   01870000
018800              PERFORM 8100-SEND-DATA-ONLY                         01880000
018900              PERFORM 8200-RETURN-TRANID                          01890000
019000     END-EVALUATE.                                                01900000
019100                                                                  01910000
019200     GOBACK.                                                      01920000
019300*                                                                 01930000
019400*                                                                 01940000
019500 1000-RECEIVE-MAP.                                                01950000
019600     EXEC CICS                                                    01960000
019700         RECEIVE MAP    ('SU500A')                                01970000
019800                 MAPSET ('SUKM500')                               01980000
019900                 RESP   (PV-CICS-RESPONSE)                        01990000
020000     END-EXEC.                                                    02000000
020100                                                                  02010000
020200     EVALUATE TRUE                                                02020000
020300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02030000
020400              PERFORM 1010-RECEIVE-SCREEN-FIELDS                  02040000
020500         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                02050000
020600              CONTINUE                                            02060000
020700         WHEN OTHER                                               02070000
020800              MOVE '1000-RECEIVE-MAP'                             02080000
020900                                     TO DP013-PARAGRAPH           02090000
021000              MOVE 'UNABLE TO RECEIVE MAP'                        02100000
021100                                     TO DP013-MESSAGE-TEXT (1)    02110000
021200              SET DP013-LOGIC-ABEND  TO TRUE                      02120000
021300              SET DP013-NO-ROLLBACK  TO TRUE                      02130000
021400              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              02140000
021500     END-EVALUATE.                                                02150000
021600*                                                                 02160000
021700*                                                                 02170000
021800 1010-RECEIVE-SCREEN-FIELDS.                                      02180000
021900     IF  ASELECTL > ZERO                                          02190000
022000         MOVE ASELECTI               TO CA-SELECTION-X            02200000
022100     END-IF.                                                      02210000
022200*                                                                 02220000
022300*                                                                 02230000
022400 1100-EDIT-SELECTION.                                             02240000
022500                                                                  02250000
022900         MOVE CA-SELECTION-X         TO DP010I-UNEDITED-FIELD     02290000
023000         MOVE 1                      TO DP010I-MAXIMUM-DIGITS     02300000
023100         MOVE 0                      TO DP010I-MAXIMUM-DECIMALS   02310000
023200         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  02320000
023300                                                                  02330000
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                         02341067
263968              USING DP010I-NUMERIC-EDIT-AREA                      02342067
023500                                                                  02350000
023600         IF  DP010I-ERROR-DETECTED                                02360000
023700             MOVE PC-NON-NUMERIC-SELECTION-MSG TO AMSGLNO         02370000
023800             PERFORM 8100-SEND-DATA-ONLY                          02380000
023900             PERFORM 8200-RETURN-TRANID                           02390000
024000         ELSE                                                     02400000
024100             MOVE DP010I-NUMERIC-FIELD   TO CA-SELECTION          02410000
024200         END-IF.                                                  02420066
024400                                                                  02440000
024410* RPK 06/2007 - START                                             02441000
024420     PERFORM 2060-GET-CURR-TMST.                                  02442000
024421     PERFORM DP026-0000-GET-LOGON-INFO.                           02442100
024431     MOVE DP026-LOCATION-NBR         TO DK-OPER-UNT-ID.           02443100
024440     PERFORM 2070-CHECK-DC-WMOS.                                  02444000
024450                                                                  02445000
024460* IF THE DC IS SET UP ON WMOS, THEN THE ONLY OPTION AVAILABLE     02446000
024470* FROM THIS SCREEN IS '2. CARTON AUDIT'                           02447000
024480     IF  PS-DC-ON-WMOS-YES                                        02448000
024490         IF  CA-SELECTION-ONE                                     02449000
024491         OR  CA-SELECTION-THREE                                   02449100
024492             MOVE DP015-UNP-NUM-BRT-MDT  TO ASELECTA              02449200
024493             MOVE PC-DC-IN-WMOS-MSG      TO AMSGLNO               02449300
024494             PERFORM 8100-SEND-DATA-ONLY                          02449400
024495             PERFORM 8200-RETURN-TRANID                           02449500
024496         END-IF                                                   02449600
024497     END-IF.                                                      02449700
024498* RPK 06/2007 - END                                               02449800
024499                                                                  02449900
024500     EVALUATE TRUE                                                02450000
024600     WHEN CA-VALID-SELECTION                                      02460000
024700         PERFORM 2000-PROCESS-SELECTION                           02470000
024800     WHEN OTHER                                                   02480000
024900         MOVE DP015-UNP-ALP-BRT-MDT  TO ASELECTA                  02490000
025000         MOVE PC-INVALID-SELECTION-MSG                            02500000
025100                                     TO AMSGLNO                   02510000
025200         PERFORM 8100-SEND-DATA-ONLY                              02520000
025300         PERFORM 8200-RETURN-TRANID                               02530000
025400     END-EVALUATE.                                                02540000
025500*                                                                 02550000
025510     COPY DPPD026.                                                02551000
025600*                                                                 02560000
025700 1400-HELP-SCREEN.                                                02570000
025800     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      02580000
025900     MOVE 'SUKRF500'                  TO PC192-PROGRAM-NAME       02590000
026000     COPY PCPD188.                                                02600000
026100     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      02610000
026200     PERFORM 2200-XCTL-TO-HELP.                                   02620000
026300                                                                  02630000
026400*                                                                 02640000
026500*                                                                 02650000
026600 2000-PROCESS-SELECTION.                                          02660000
026700     SET PN-INDX                     TO CA-SELECTION.             02670000
026800     IF ( CA-SELECTION < PC-PGM-TBL-LENGTH ) OR                   02680000
026810        ( CA-SELECTION = PC-PGM-TBL-LENGTH )                      02681000
026900         PERFORM 9000-CHECK-RACF                                  02690000
027000     ELSE                                                         02700000
027500         MOVE PN-PGM-NAME (PN-INDX)  TO PV-TRANSFER-PROGRAM       02750000
027600         PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                    02760000
027800     END-IF.                                                      02780000
027900                                                                  02790000
028010     IF  PS-ACCESS-ALLOWED                                        02801000
028100         MOVE PN-PGM-NAME (PN-INDX)  TO PV-TRANSFER-PROGRAM       02810000
028200         PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                    02820000
028300     ELSE                                                         02830000
028400         MOVE DP015-UNP-ALP-BRT-MDT  TO ASELECTA                  02840000
028500         PERFORM 8100-SEND-DATA-ONLY                              02850000
028600         PERFORM 8200-RETURN-TRANID                               02860000
028700     END-IF.                                                      02870000
028811*                                                                 02881100
028812*-----------------------------------------------------------------02881200
028820                                                                  02882000
028830* RPK 06/2007 - START                                             02883000
028840 2060-GET-CURR-TMST.                                              02884000
028850                                                                  02885000
028860         EXEC SQL                                                 02886000
028870             SET :DK-CURRENT-TIMESTAMP = CURRENT TIMESTAMP        02887000
028880         END-EXEC.                                                02888000
028890                                                                  02889000
028891                                                                  02889100
028892 2070-CHECK-DC-WMOS.                                              02889200
028893                                                                  02889300
028894     EXEC SQL                                                     02889400
028895          SELECT   A.INTGRTN_TYP_DESC                             02889500
028896            INTO  :WST00008-INTGRTN-TYP-DESC                      02889600
028897            FROM                                                  02889700
028898                  WST_INTGRTN_TYP  A                              02889800
028899               ,  WST_ATTR_DEFN    B                              02889900
028900               ,  WST_ATTR_ELEM    C                              02890000
028901               ,  WST_ATTR_ELEM    D                              02890100
028902               ,  WST_ATTR_ELEM    E                              02890200
028903            WHERE                                                 02890300
028904                  A.INTGRTN_TYP_CDE   = 'WMOSON'                  02890400
028905              AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE         02890500
028906              AND B.ATTR_DEFN_SEQ_NBR = 1                         02890600
028907              AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE         02890700
028908              AND C.ATTR_DEFN_SEQ_NBR = 1                         02890800
028909              AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE         02890900
028910              AND D.ATTR_DEFN_SEQ_NBR = 2                         02891000
028911              AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE         02891100
028912              AND E.ATTR_DEFN_SEQ_NBR = 3                         02891200
028913              AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR       02891300
028914              AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR       02891400
028915              AND C.ATTR_ELEM_NBR     = :DK-OPER-UNT-ID           02891500
028916              AND E.ATTR_ELEM_TMST   <= :DK-CURRENT-TIMESTAMP     02891600
028917     END-EXEC.                                                    02891700
028918                                                                  02891800
028919     EVALUATE TRUE                                                02891900
028920         WHEN SQLCODE = ZERO                                      02892000
028921             SET PS-DC-ON-WMOS-YES      TO TRUE                   02892100
028922         WHEN OTHER                                               02892200
028923             SET PS-DC-ON-WMOS-NO       TO TRUE                   02892300
028924     END-EVALUATE.                                                02892400
028925* RPK 06/2007 - END                                               02892500
028926                                                                  02892600
028927                                                                  02892700
028930*                                                                 02893000
029000 2100-XCTL-TO-SELECTED-PROGRAM.                                   02900000
029100                                                                  02910000
029200     INITIALIZE SU001-COMMON-DATA.                                02920000
029300     SET SU001-INITIALIZE-SCREEN     TO TRUE.                     02930000
029400     MOVE PC-CURRENT-PROGRAM-NAME    TO SU001-LAST-PROGRAM.       02940000
029500                                                                  02950000
029700     MOVE LENGTH OF CA-COMMAREA-2 TO PV-COMMAREA-LENGTH           02970000
029800     EXEC CICS                                                    02980000
029900         XCTL                                                     02990000
030000             PROGRAM   (PV-TRANSFER-PROGRAM)                      03000000
030100             COMMAREA  (SU001-COMMON-DATA)                        03010000
030300             LENGTH    (PV-COMMAREA-LENGTH)                       03030000
030400             RESP      (PV-CICS-RESPONSE)                         03040000
030500     END-EXEC.                                                    03050000
030600                                                                  03060000
030700     EVALUATE TRUE                                                03070000
030800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03080000
030900              CONTINUE                                            03090000
031000         WHEN OTHER                                               03100000
031100              MOVE '2100-XCTL-TO-SELECTED-PROGRAM'                03110000
031200                                     TO DP013-PARAGRAPH           03120000
031300              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       03130000
031400                                     TO DP013-MESSAGE-TEXT (1)    03140000
031500              MOVE PV-TRANSFER-PROGRAM                            03150000
031600                                     TO DP013-MESSAGE-TEXT (2)    03160000
031700              SET DP013-CICS-ABEND   TO TRUE                      03170000
031800              SET DP013-NO-ROLLBACK  TO TRUE                      03180000
031900              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              03190000
032000              MOVE PC-TRANS-UNAVAILABLE-MSG                       03200000
032100                                     TO AMSGLNO                   03210000
032200              SET CA-PROCESS-SCREEN  TO TRUE                      03220000
032300              PERFORM 8100-SEND-DATA-ONLY                         03230000
032400              PERFORM 8200-RETURN-TRANID                          03240000
032500     END-EVALUATE.                                                03250000
032600*                                                                 03260000
032700*                                                                 03270000
032800 2200-XCTL-TO-HELP.                                               03280000
032900                                                                  03290000
033000     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH.      03300000
033100     SET MP026-INITIALIZE-SCREEN      TO TRUE.                    03310000
033200     MOVE MP026-COMMAREA              TO PC192-HOST-SAVE-AREA.    03320000
033300                                                                  03330000
033400     EXEC CICS                                                    03340000
033500         XCTL                                                     03350000
033600             PROGRAM   (PV-TRANSFER-PROGRAM)                      03360000
033700             COMMAREA  (PC192-COMMAREA)                           03370000
033800             LENGTH    (PV-COMMAREA-LENGTH)                       03380000
033900             RESP      (PV-CICS-RESPONSE)                         03390000
034000     END-EXEC.                                                    03400000
034100                                                                  03410000
034200     EVALUATE TRUE                                                03420000
034300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03430000
034400              CONTINUE                                            03440000
034500         WHEN OTHER                                               03450000
034600              MOVE '2200-XCTL-TO-HELP'                            03460000
034700                                     TO DP013-PARAGRAPH           03470000
034800              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       03480000
034900                                     TO DP013-MESSAGE-TEXT (1)    03490000
035000              MOVE PV-TRANSFER-PROGRAM                            03500000
035100                                     TO DP013-MESSAGE-TEXT (2)    03510000
035200              SET DP013-CICS-ABEND   TO TRUE                      03520000
035300              SET DP013-NO-ROLLBACK  TO TRUE                      03530000
035400              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              03540000
035500              MOVE PC-TRANS-UNAVAILABLE-MSG                       03550000
035600                                     TO AMSGLNO                   03560000
035700              SET MP026-PROCESS-SCREEN TO TRUE                    03570000
035800              PERFORM 8100-SEND-DATA-ONLY                         03580000
035900              PERFORM 8200-RETURN-TRANID                          03590000
036000     END-EVALUATE.                                                03600000
036100*                                                                 03610000
036200*                                                                 03620000
036300 8000-SEND-MAP.                                                   03630000
036400     EXEC CICS                                                    03640000
036500         SEND MAP       ('SU500A')                                03650000
036600              MAPSET    ('SUKM500')                               03660000
036700              ERASE                                               03670000
036800              RESP      (PV-CICS-RESPONSE)                        03680000
036900     END-EXEC.                                                    03690000
037000                                                                  03700000
037100     EVALUATE TRUE                                                03710000
037200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03720000
037300              CONTINUE                                            03730000
037400         WHEN OTHER                                               03740000
037500              MOVE '8000-SEND-MAP'   TO DP013-PARAGRAPH           03750000
037600              MOVE 'UNABLE TO SEND MAP'                           03760000
037700                                     TO DP013-MESSAGE-TEXT (1)    03770000
037800              SET DP013-CICS-ABEND   TO TRUE                      03780000
037900              SET DP013-NO-ROLLBACK  TO TRUE                      03790000
038000              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              03800000
038100     END-EVALUATE.                                                03810000
038200*                                                                 03820000
038300*                                                                 03830000
038400 8100-SEND-DATA-ONLY.                                             03840000
038500     MOVE -1 TO ASELECTL.                                         03850000
038600                                                                  03860000
038700     EXEC CICS                                                    03870000
038800         SEND MAP       ('SU500A')                                03880000
038900              MAPSET    ('SUKM500')                               03890000
039000              CURSOR                                              03900000
039100              DATAONLY                                            03910000
039200              RESP      (PV-CICS-RESPONSE)                        03920000
039300     END-EXEC.                                                    03930000
039400                                                                  03940000
039500     EVALUATE TRUE                                                03950000
039600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03960000
039700              CONTINUE                                            03970000
039800         WHEN OTHER                                               03980000
039900              MOVE '8100-SEND-DATA-ONLY'                          03990000
040000                                     TO DP013-PARAGRAPH           04000000
040100              MOVE 'UNABLE TO SEND DATA'                          04010000
040200                                     TO DP013-MESSAGE-TEXT (1)    04020000
040300              SET DP013-CICS-ABEND   TO TRUE                      04030000
040400              SET DP013-NO-ROLLBACK  TO TRUE                      04040000
040500              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              04050000
040600     END-EVALUATE.                                                04060000
040700*                                                                 04070000
040800*                                                                 04080000
040900 8200-RETURN-TRANID.                                              04090000
041000                                                                  04100000
041100     MOVE LENGTH OF CA-COMMAREA-2     TO PV-COMMAREA-LENGTH       04110000
041200     EXEC CICS                                                    04120000
041300         RETURN TRANSID   (PC-MENU-TRANID)                        04130000
041400                COMMAREA  (CA-COMMAREA)                           04140000
041600                LENGTH    (PV-COMMAREA-LENGTH)                    04160000
041700                RESP      (PV-CICS-RESPONSE)                      04170000
041800     END-EXEC.                                                    04180000
041900                                                                  04190000
042000     EVALUATE TRUE                                                04200000
042100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 04210000
042200              CONTINUE                                            04220000
042300         WHEN OTHER                                               04230000
042400              MOVE '8200-RETURN-TRANID'                           04240000
042500                                     TO DP013-PARAGRAPH           04250000
042600              MOVE 'UNABLE TO RETURN TO TRANID'                   04260000
042700                                     TO DP013-MESSAGE-TEXT (1)    04270000
042800              SET DP013-CICS-ABEND   TO TRUE                      04280000
042900              SET DP013-NO-ROLLBACK  TO TRUE                      04290000
043000              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              04300000
043100     END-EVALUATE.                                                04310000
043200*                                                                 04320000
043300*                                                                 04330000
043400 8300-LOGOFF-TO-VTAM-SCREEN.                                      04340000
043500     EXEC CICS                                                    04350000
043600         START TRANSID  ('Z011')                                  04360000
043700               TERMID   (EIBTRMID)                                04370000
043800               NOHANDLE                                           04380000
043900     END-EXEC.                                                    04390000
044000*                                                                 04400000
044100*                                                                 04410000
044200 9000-CHECK-RACF.                                                 04420000
044300******************************************************************04430000
044400*  CHECK ACCESSS AUTHORITY OF USER                                04440000
044500******************************************************************04450000
044600     SET DP008-RSRC-TYPE-TRAN        TO TRUE.                     04460000
044700     SET DP008-ACCESS-TYPE-USE       TO TRUE.                     04470000
044800                                                                  04480000
044900     EVALUATE TRUE                                                04490000
045000         WHEN CA-SELECTION-ONE                                    04500000
045200              MOVE PC-CHECK-AUTH-FOR-TRAN-S529                    04520000
045300                                     TO DP008-RESOURCE-NAME       04530000
045400         WHEN CA-SELECTION-TWO                                    04540000
045500              MOVE PC-CHECK-AUTH-FOR-TRAN-S508                    04550000
045600                                     TO DP008-RESOURCE-NAME       04560000
045610         WHEN CA-SELECTION-THREE                                  04561000
045620              MOVE PC-CHECK-AUTH-FOR-TRAN-S538                    04562000
045630                                     TO DP008-RESOURCE-NAME       04563000
045640         WHEN CA-SELECTION-FOUR                                   04564000
045650              MOVE PC-CHECK-AUTH-FOR-TRAN-S742                    04565000
045660                                     TO DP008-RESOURCE-NAME       04566000
045670* SB 05/31/13 PR5148B START                                       04567000
045671         WHEN CA-SELECTION-FIVE                                   04567100
045672              MOVE PC-CHECK-AUTH-FOR-TRAN-S705                    04567200
045673                                     TO DP008-RESOURCE-NAME       04567300
045690* SB 05/31/13 PR5148B END                                         04569000
045691         WHEN CA-SELECTION-SIX                                    04569164
045692              MOVE PC-CHECK-AUTH-FOR-TRAN-S743                    04569264
045693                                     TO DP008-RESOURCE-NAME       04569364
045700     END-EVALUATE.                                                04570000
045800                                                                  04580000
045900     EXEC CICS                                                    04590000
046000          LINK PROGRAM  (DP008-SECURITY-SUBROUTINE)               04600000
046100               COMMAREA (DP008-SECURITY-COMMAREA)                 04610000
046200               LENGTH   (DP008-SECURITY-COMMAREA-LENGTH)          04620000
046300               RESP     (PV-CICS-RESPONSE)                        04630000
046400     END-EXEC.                                                    04640000
046500                                                                  04650000
046600     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                       04660000
046700         IF  DP008-CALL-SUCCESSFUL                                04670000
046800             IF  DP008-ACCESS-ALLOWED                             04680000
046900                 SET PS-ACCESS-ALLOWED                            04690000
047000                                     TO TRUE                      04700000
047100             ELSE                                                 04710000
047200                 MOVE PC-ACCESS-NOT-ALLOWED-MSG                   04720000
047300                                     TO AMSGLNO                   04730000
047400             END-IF                                               04740000
047500         ELSE                                                     04750000
047600             MOVE PC-CICSAUTH-MSG    TO AMSGLNO                   04760000
047700         END-IF                                                   04770000
047800     ELSE                                                         04780000
047900         MOVE '9000-CHECK-RACF'      TO DP013-PARAGRAPH           04790000
048000         MOVE 'BAD LINK TO RACF PROGRAM'                          04800000
048100                                     TO DP013-MESSAGE-TEXT (1)    04810000
048200         SET DP013-CICS-ABEND        TO TRUE                      04820000
048300         SET DP013-NO-ROLLBACK       TO TRUE                      04830000
048400         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   04840000
048500     END-IF.                                                      04850000
048600*                                                                 04860000
048700*                                                                 04870000
048800 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  04880000
048900     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            04890000
049000     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           04900000
049100     INITIALIZE DP013-SRC-TASK-NUMBER                             04910000
049200                DP013-STACK.                                      04920000
049300     SET DP013-LINK-RETURN           TO TRUE.                     04930000
049400                                                                  04940000
049500     EXEC CICS                                                    04950000
049600         LINK                                                     04960000
049700             PROGRAM   (DP013-NAME)                               04970000
049800             COMMAREA  (DP013-PARAMETERS)                         04980000
049900             LENGTH    (DP013-LENGTH)                             04990000
050000     END-EXEC.                                                    05000000
