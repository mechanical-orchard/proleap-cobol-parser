       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    MLKUT355.                                                 
       AUTHOR.        VL YANG.                                                  
       INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
       DATE-WRITTEN.  03/30/2007.                                               
       DATE-COMPILED.                                                           
                                                                                
      ******************************************************************        
      * THIS PROGRAM WILL TAKE THE DEPT/BRAND/VENDOR SMOOTHING VALUES           
      * AND PRORATE DOWN TO THE WEEKLY DETAIL AND MONTHLY DETAIL LEDGER.        
      *                                                                         
      * THE PROGRAM WILL EXECUTE IN AN DETAIL MODE AND AN SUMMARY MODE.         
      * THE DETAIL MODE WILL PRODUCE THE REPORT AT THE SUB-CLASS                
      * LOCATION LEVEL AND THE SUMMARY MODE WILL PRODUCE THE REPORT             
      * AT THE DEPT/BRAND/VENDOR LEVEL.                                         
      *                                                                         
      * THE OPTIONAL ADJUSTMENT INPUT FILE IS A FILE THAT WOULD HAVE            
      * BEEN CREATED FROM PREVIOUS EXECUTION.  THIS FILE CONTAINS               
      * ADDITIONAL ADJUSTMENTS THAT WOULD NEED TO BE MADE TO THE                
      * ORIGINAL EIC BEFORE THE THE CURRENT PRORATION CAN TAKE PLACE.           
      *                                                                         
      ******************** HISTORY OF CHANGES **************************        
      * CHG ID/                                                        *        
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES                    *        
      * -------  ----------  ----------------------------------------  *        
LY07A4* LY0704A  2007-04-17  CORRECT END OF MONTH AND END OF SEASON    *        
      *                      LOGIC.  -V. LEE YANG                      *        
LY07B4* LY0704B  2007-04-24  FIX NEXT FISCAL PERIOD PARTITION INFO     *        
      *                      LOOKUP NOT FOUND LOGIC.  -V. LEE YANG     *        
LY07C4* LY0704C  2007-05-04  DON'T PRORATE WHEN IT'S NOT AT END OF     *        
      *                      MONTH.  -V. LEE YANG                      *        
LY0705* LY0705   2007-05-22  CORRECT PARTITION NBR AND PARTITION GP    *        
      *                              -V. LEE YANG                      *        
33539 * 33539    10-15-2007  BUILD IN EFFICIENCY TO IMPROVE CYCLE PERF.         
      *                      -ROD JANSSEN                                       
      ******************************************************************        
P18333*  CHANGE ID    CHANGE DATE            REASON FOR CHANGE         *        
P18333* P18333  - COGNIZANT - 09/28/12        -PBI000000018333                  
P18333*    - ML PERFORMANCE TUNING-REMOVED UNWANTED DISPLAYS.                   
P18333******************************************************************        
257901* 257901  06-01-2021 SRINIVASAN  INCREASED THE LENGTH OF LABEL SEQ        
257901*                                NUMBER FROM 4 TO 5 TO AVOID THE          
257901*                                TRUNCATION OF LABEL SEQ NUMBER           
257901*                                WHICH IS GREATER THAN 4 DIGITS.          
257901*                                CHANGE NUMBER : CHG0257901               
257901******************************************************************        
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER.        IBM-3090.                                        
       OBJECT-COMPUTER.        IBM-3090.                                        
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT OPTIONAL EXECUTION-CONTROL-FILE                               
               ASSIGN TO INP01.                                                 
           SELECT COMMON-RECALC-IN-FILE                                         
               ASSIGN TO INP02.                                                 
           SELECT COMMON-RECALC-OUT-FILE                                        
               ASSIGN TO OUT01.                                                 
           SELECT COMMON-RECALC-FWD-FILE                                        
               ASSIGN TO OUT02.                                                 
           SELECT ADJUST-RPT-FILE                                               
               ASSIGN TO RPT01.                                                 
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD  EXECUTION-CONTROL-FILE                                               
           RECORDING  MODE IS F                                                 
           BLOCK CONTAINS 0 RECORDS.                                            
       01  EXECUTION-CONTROL-REC           PIC X(080).                          
                                                                                
       FD  COMMON-RECALC-IN-FILE                                                
           RECORDING  MODE IS F                                                 
           BLOCK CONTAINS 0 RECORDS.                                            
       01  COMMON-RECALC-IN-REC            PIC X(400).                          
                                                                                
       FD  COMMON-RECALC-OUT-FILE                                               
           RECORDING  MODE IS F                                                 
           BLOCK CONTAINS 0 RECORDS.                                            
       01  COMMON-RECALC-OUT-REC           PIC X(400).                          
                                                                                
       FD  COMMON-RECALC-FWD-FILE                                               
           RECORDING  MODE IS F                                                 
           BLOCK CONTAINS 0 RECORDS.                                            
       01  COMMON-RECALC-FWD-REC           PIC X(400).                          
                                                                                
       FD  ADJUST-RPT-FILE                                                      
           RECORDING  MODE IS F                                                 
           BLOCK CONTAINS 0 RECORDS.                                            
       01  ADJUST-RPT-REC                  PIC X(0650).                         
                                                                                
      /*****************************************************************        
       WORKING-STORAGE SECTION.                                                 
      ******************************************************************        
                                                                                
       01  ABEND-CODE                      PIC S9(4)       VALUE ZEROES         
                               COMP SYNC.                                       
           88  SQL-ABEND                                   VALUE +4001.         
           88  NON-SQL-ABEND                               VALUE +4011.         
                                                                                
       01  PA-PROGRAM-ACCUMULATORS.                                             
                                                                                
           05  PA-CONTROL-CNT              PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PA-RECORD-IN-CNT            PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PA-RECORD-IGNORED           PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
LY07C4     05  PA-RECORD-ACCEPTED          PIC S9(09)      VALUE ZEROES         
LY07C4                         COMP-3.                                          
           05  PA-RECORD-OUT-CNT           PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PA-RECORD-FWD-CNT           PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PA-RECORD-RPT-CNT           PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PA-PARTN-MISMATCH           PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PA-DKEY-NOT-FOUND           PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PA-BRND-VND-NOT-FOUND       PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PA-BRND-NOT-FOUND           PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PA-VNDR-NOT-FOUND           PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
                                                                                
       01  PC-PROGRAM-CONSTANTS.                                                
           05 PC-PROGRAM-NAME              PIC X(08)   VALUE 'MLKUT355'.        
           05 PC-UNKNOWN                   PIC X(08)   VALUE '????????'.        
           05 PC-NOT-BEG-SEASON            PIC S9(08)      VALUE +4090          
                               COMP SYNC.                                       
           05 PC-BEG-SEASON                PIC S9(08)      VALUE +4091          
                               COMP SYNC.                                       
           05 PC-3                         PIC S9(05)      VALUE +3             
                               COMP-3.                                          
                                                                                
       01  PT-DETAIL-OUT-HEADER.                                                
           05  PT-MAIN-SECTION-HDR.                                             
               10  FILLER                  PIC X(10)       VALUE                
                   'PARTITION,'.                                                
               10  FILLER                  PIC X(11)       VALUE                
                   'TABLE NAME,'.                                               
               10  FILLER                  PIC X(12)       VALUE                
                   'FISCAL DATE,'.                                              
               10  FILLER                  PIC X(05)       VALUE                
                   'DEPT,'.                                                     
               10  FILLER                  PIC X(06)       VALUE                
                   'BRAND,'.                                                    
               10  FILLER                  PIC X(11)       VALUE                
                   'BRAND NAME,'.                                               
               10  FILLER                  PIC X(07)       VALUE                
                   'VENDOR,'.                                                   
               10  FILLER                  PIC X(12)       VALUE                
                   'VENDOR NAME,'.                                              
               10  FILLER                  PIC X(05)       VALUE                
                   'DKEY,'.                                                     
               10  FILLER                  PIC X(10)       VALUE                
                   'SUB-CLASS,'.                                                
               10  FILLER                  PIC X(09)       VALUE                
                   'LOCATION,'.                                                 
               10  FILLER                  PIC X(09)       VALUE                
                   'SECT BRK,'.                                                 
           05  PT-DEPT-BRAND-VEND-HDR.                                          
               10  FILLER                  PIC X(13)       VALUE                
                   'DBV BOP COST,'.                                             
               10  FILLER                  PIC X(08)       VALUE                
                   'DBV EIR,'.                                                  
               10  FILLER                  PIC X(19)       VALUE                
                   'DBV PRE-SMOOTH EIC,'.                                       
               10  FILLER                  PIC X(14)       VALUE                
                   'DBV INV ADJ 1,'.                                            
               10  FILLER                  PIC X(10)       VALUE                
                   'DBV EIC 1,'.                                                
               10  FILLER                  PIC X(14)       VALUE                
                   'DBV INV ADJ 2,'.                                            
               10  FILLER                  PIC X(10)       VALUE                
                   'DBV EIC 2,'.                                                
               10  FILLER                  PIC X(08)       VALUE                
                   'DBV GM$,'.                                                  
               10  FILLER                  PIC X(09)       VALUE                
                   'SECT BRK,'.                                                 
           05  PT-DETAIL-SECTION-HDR.                                           
               10  FILLER                  PIC X(09)       VALUE                
                   'BOP COST,'.                                                 
               10  FILLER                  PIC X(13)       VALUE                
                   'SALES RETAIL,'.                                             
               10  FILLER                  PIC X(13)       VALUE                
                   'RECEIPT COST,'.                                             
               10  FILLER                  PIC X(10)       VALUE                
                   'PADJ COST,'.                                                
               10  FILLER                  PIC X(04)       VALUE                
                   'EIR,'.                                                      
               10  FILLER                  PIC X(15)       VALUE                
                   'PRE-SMOOTH EIC,'.                                           
               10  FILLER                  PIC X(11)       VALUE                
                   'PRO-RATE %,'.                                               
               10  FILLER                  PIC X(15)       VALUE                
                   'ORIG INV ADJ 1,'.                                           
               10  FILLER                  PIC X(19)       VALUE                
                   'ADJUSTED INV ADJ 1,'.                                       
               10  FILLER                  PIC X(11)       VALUE                
                   'ORIG EIC 1,'.                                               
               10  FILLER                  PIC X(15)       VALUE                
                   'ADJUSTED EIC 1,'.                                           
               10  FILLER                  PIC X(15)       VALUE                
                   'ORIG INV ADJ 2,'.                                           
               10  FILLER                  PIC X(19)       VALUE                
                   'ADJUSTED INV ADJ 2,'.                                       
               10  FILLER                  PIC X(11)       VALUE                
                   'ORIG EIC 2,'.                                               
               10  FILLER                  PIC X(15)       VALUE                
                   'ADJUSTED EIC 2,'.                                           
               10  FILLER                  PIC X(14)       VALUE                
                   'ORIG FINAL GM,'.                                            
               10  FILLER                  PIC X(18)       VALUE                
                   'ADJUSTED FINAL GM,'.                                        
               10  FILLER                  PIC X(09)       VALUE                
                   'SECT BRK,'.                                                 
           05  PT-MESSAGE-SECTION-HDR.                                          
               10  FILLER                  PIC X(08)       VALUE                
                   'MESSAGE,'.                                                  
           05  FILLER                      PIC X(88)       VALUE SPACES.        
                                                                                
       01  PT-DETAIL-OUT-REC.                                                   
           05  PT-MAIN-SECTION-DTL.                                             
               10  PT-PARTN-NBR            PIC 9999        VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-TABLE-NAME           PIC X(18)       VALUE SPACES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-FSCL-END-DTE         PIC X(10)       VALUE SPACES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-DEPT-NBR             PIC 9(04)       VALUE ZEROS.         
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-LBL-SEQ-NBR          PIC 9(09)       VALUE ZEROS.         
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-BRAND-NAME           PIC X(20)       VALUE SPACES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-ENT-ID               PIC 9(09)       VALUE ZEROS.         
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-VENDOR-NAME          PIC X(30)       VALUE SPACES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-ML-LWST-ID           PIC 9(09)       VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-SUB-CLASS            PIC 9(04)       VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-LOCATION             PIC 9(04)       VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  FILLER                  PIC X(01)       VALUE ','.           
           05  PT-DEPT-BRAND-VEND-DTL.                                          
               10  PT-DBV-BOP-COST         PIC -9(11).99   VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-DBV-EIR              PIC -9(11).99   VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-DBV-PRE-SMOOTH-EIC   PIC -9(11).99   VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-DBV-INV-ADJ-1        PIC -9(11).99   VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-DBV-EIC-1            PIC -9(11).99   VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-DBV-INV-ADJ-2        PIC -9(11).99   VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-DBV-EIC-2            PIC -9(11).99   VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-DBV-GM               PIC -9(11).99   VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  FILLER                  PIC X(01)       VALUE ','.           
           05  PT-DETAIL-SECTION-DTL.                                           
               10  PT-DTL-BOP-COST         PIC -9(11).99   VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-DTL-SALES-RTL        PIC -9(11).99   VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-DTL-RCPT-NET-CST     PIC -9(11).99   VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-DTL-PADJ-NET-CST     PIC -9(11).99   VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-DTL-EIR              PIC -9(11).99   VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-DTL-PRE-SMOOTH-EIC   PIC -9(11).99   VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-DTL-PRORATE-PCT      PIC -9(03).9(10)                     
                                                           VALUE ZEROES.        
               10  PT-DTL-PRORATE-PCT-X REDEFINES PT-DTL-PRORATE-PCT            
                                           PIC X(15).                           
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-DTL-ORIG-INV-ADJ-1   PIC -9(11).99   VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-DTL-ADJ-INV-ADJ-1    PIC -9(11).99   VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-DTL-ORIG-EIC-1       PIC -9(11).99   VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-DTL-ADJ-EIC-1        PIC -9(11).99   VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-DTL-ORIG-INV-ADJ-2   PIC -9(11).99   VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-DTL-ADJ-INV-ADJ-2    PIC -9(11).99   VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-DTL-ORIG-EIC-2       PIC -9(11).99   VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-DTL-ADJ-EIC-2        PIC -9(11).99   VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-DTL-ORIG-ADJ-GM      PIC -9(11).99   VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  PT-DTL-ADJ-ADJ-GM       PIC -9(11).99   VALUE ZEROES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  FILLER                  PIC X(01)       VALUE ','.           
           05  PT-MESSAGE-SECTION-DTL.                                          
               10  PT-MSG-TEXT             PIC X(30)       VALUE SPACES.        
               10  FILLER                  PIC X(01)       VALUE ','.           
               10  FILLER                  PIC X(01)       VALUE ','.           
           05  FILLER                      PIC X(48)       VALUE SPACES.        
                                                                                
       01  PS-PROGRAM-SWITCHES.                                                 
           05  PS-COMMON-RECALC-IN-EOF-SW  PIC X(01)       VALUE 'N'.           
               88  PS-COMMON-RECALC-IN-NOT-EOF             VALUE 'N'.           
               88  PS-COMMON-RECALC-IN-EOF                 VALUE 'Y'.           
           05  PS-EXEC-CONTROL-SW         PIC X(01)        VALUE 'N'.           
               88  PS-EXEC-CONTROL-NOT-EOF                 VALUE 'N'.           
               88  PS-EXEC-CONTROL-EOF                     VALUE 'Y'.           
           05  PS-DEPT-BRND-VND-SW        PIC X(01)        VALUE 'N'.           
               88  PS-DEPT-BRND-VND-NOT-FOUND              VALUE 'N'.           
               88  PS-DEPT-BRND-VND-FOUND                  VALUE 'Y'.           
LY07B4     05  PS-PARTN-INFO-LOOKUP-SW    PIC X(01)        VALUE SPACE.         
LY07B4         88  PS-GET-CURR-PARTN-INFO                  VALUE 'C'.           
LY07B4         88  PS-GET-NEXT-PARTN-INFO                  VALUE 'N'.           
           05  PS-BEG-SEASON-SW           PIC X(01)        VALUE 'N'.           
               88  PS-NOT-BEG-SEASON                       VALUE 'N'.           
               88  PS-BEG-SEASON                           VALUE 'Y'.           
                                                                                
       01  PV-PROGRAM-VARIABLES.                                                
33539      05  PV-MLT00003-FSCL-DTE-SAVE PIC X(10)  VALUE SPACES.               
33539      05  PV-MLT00002-DEPT-NBR-SAVE PIC S9(4)V COMP-3 VALUE ZEROS.         
33539      05  PV-SAVE-PARTN-NBR       PIC S9(4) COMP VALUE ZEROS.              
33539      05  PV-SAVE-DEPT-GP-CDE     PIC X(01)  VALUE SPACES.                 
33539      05  PV-SAVE-FSCL-MN-NBR     PIC X(02)  VALUE SPACES.                 
33539      05  PV-SAVE-FSCL-WK-NBR     PIC X(02)  VALUE SPACES.                 
33539      05  PV-SAVE-PFM-END-DTE     PIC X(10)  VALUE SPACES.                 
33539      05  PV-SAVE-PFW-END-DTE     PIC X(10)  VALUE SPACES.                 
33539      05  PV-SAVE-FSCL-MN-END-DTE PIC X(10)  VALUE SPACES.                 
33539      05  PV-SAVE-SEA-END-DTE     PIC X(10)  VALUE SPACES.                 
33539                                                                           
33539      05  PV-CURR-FSCL-END-DTE-SAVE PIC X(10)  VALUE SPACES.               
33539      05  PV-DTATTR-FSCL-MN-END-DTE PIC X(10)  VALUE SPACES.               
33539      05  PV-DTATTR-FSCL-MN-NBR     PIC X(02)  VALUE SPACES.               
33539      05  PV-DTATTR-FSCL-WK-END-DTE PIC X(10)  VALUE SPACES.               
33539      05  PV-DTATTR-FSCL-WK-NBR     PIC X(02)  VALUE SPACES.               
33539                                                                           
           05  PV-DEPT-NBR-9               PIC 9(04)       VALUE ZEROES.        
           05  PV-DEPT-NBR-X REDEFINES PV-DEPT-NBR-9                            
                                           PIC X(04).                           
           05  FILLER REDEFINES PV-DEPT-NBR-9.                                  
               10  FILLER                  PIC X(01).                           
               10  PV-DEPT-NBR-3X          PIC X(03).                           
           05  PV-ML-LWST-ID-9             PIC 9(09)       VALUE ZEROES.        
           05  PV-DRIVING-DKEY             PIC S9(09)      VALUE ZEROES         
                               COMP.                                            
           05  PV-CURR-PARTN-NBR           PIC S9(04)      VALUE ZEROES         
                               COMP.                                            
           05  PV-CURR-PARTN-GROUP         PIC S9(04)      VALUE ZEROES         
                               COMP.                                            
           05  PV-LBL-SEQ-NBR              PIC S9(04)      VALUE ZEROES         
                               COMP.                                            
257901     05  PV-LBL-SEQ-NBR-9            PIC 9(05)       VALUE ZEROES.        
           05  PV-ENT-ID                   PIC S9(09)      VALUE ZEROES         
                               COMP.                                            
           05  PV-ENT-ID-9                 PIC 9(09)       VALUE ZEROES.        
           05  PV-CURR-FSCL-PERIOD         PIC X(02)       VALUE SPACES.        
           05  PV-CURR-FSCL-END-DTE        PIC X(10)       VALUE SPACES.        
LY07A4     05  PV-PREV-FSCL-MN-END-DTE     PIC X(10)       VALUE SPACES.        
LY07A4     05  PV-CURR-FSCL-MN-END-DTE     PIC X(10)       VALUE SPACES.        
LY07A4     05  PV-CURR-FSCL-SEA-END-DTE    PIC X(10)       VALUE SPACES.        
           05  PV-PARAGRAPH-NAME           PIC X(30)       VALUE SPACES.        
           05  PV-DB2-OPER-ATTEMPTED       PIC X(30)       VALUE SPACES.        
           05  PV-TOT-END-INV-COST-AMT     PIC S9(11)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PV-TOT-END-INV-RTL-AMT      PIC S9(11)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PV-TLY-INV-COST-ADJ1-AMT    PIC S9(11)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PV-TLY-INV-COST-ADJ2-AMT    PIC S9(11)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PV-TLY-END-INV-COST1-AMT    PIC S9(11)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PV-TLY-END-INV-COST2-AMT    PIC S9(11)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PV-WORK-AMT                 PIC S9(11)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PV-PRORATE-PCT              PIC S9(3)V9(10) VALUE ZEROES         
                               COMP-3.                                          
           05  PV-TTL-BOP-COST             PIC S9(11)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PV-TTL-SALES-RTL            PIC S9(11)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PV-TTL-RCPT-NET-CST         PIC S9(11)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PV-TTL-PADJ-NET-CST         PIC S9(11)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PV-TTL-EIR                  PIC S9(11)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PV-TTL-PRE-SMOOTH-EIC       PIC S9(11)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PV-TTL-ORIG-INV-ADJ-1       PIC S9(11)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PV-TTL-ADJ-INV-ADJ-1        PIC S9(11)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PV-TTL-ORIG-EIC-1           PIC S9(11)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PV-TTL-ADJ-EIC-1            PIC S9(11)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PV-TTL-ORIG-INV-ADJ-2       PIC S9(11)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PV-TTL-ADJ-INV-ADJ-2        PIC S9(11)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PV-TTL-ORIG-EIC-2           PIC S9(11)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PV-TTL-ADJ-EIC-2            PIC S9(11)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PV-TTL-ORIG-ADJ-GM          PIC S9(11)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  PV-TTL-ADJ-ADJ-GM           PIC S9(11)V99   VALUE ZEROES         
                               COMP-3.                                          
                                                                                
      ******************************************************************        
      *  OPTIONAL CONTROL CARD                                                  
      ******************************************************************        
       01  PV-CC-OPTIONAL-CONTROL.                                              
           05  FILLER                      PIC X(01)       VALUE SPACES.        
               88  PV-CC-COMMENT                           VALUE '*'.           
               88  PV-CC-NOT-COMMENT                       VALUE SPACES.        
           05  PV-CC-REQUEST-TYPE          PIC X(08)       VALUE SPACES.        
               88  PV-CC-WEEKLY-REQUEST                    VALUE                
                   'WEEKLY'.                                                    
               88  PV-CC-MONTHLY-REQUEST                   VALUE                
                   'MONTHLY'.                                                   
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  PV-CC-FSCL-END-DATE         PIC X(10)       VALUE SPACES.        
           05  FILLER REDEFINES PV-CC-FSCL-END-DATE.                            
               10  PV-CC-FSCL-END-YYYY     PIC X(04).                           
               10  FILLER                  PIC X(01).                           
                   88  PV-CC-FSCL-END-DASH-1               VALUE '-'.           
               10  PV-CC-FSCL-END-MM       PIC X(02).                           
               10  FILLER                  PIC X(01).                           
                   88  PV-CC-FSCL-END-DASH-2               VALUE '-'.           
               10  PV-CC-FSCL-END-DD       PIC X(02).                           
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  PV-CC-PROCESS-TABLE         PIC X(18)       VALUE SPACES.        
               88  PV-CC-MONTHLY-TABLE                     VALUE                
                   'MLT_MNLY_SUM'.                                              
               88  PV-CC-WEEKLY-TABLE                      VALUE                
                   'MLT_WKLY_SUM'.                                              
               88  PV-CC-VALID-TABLES                      VALUES ARE           
                   'MLT_WKLY_SUM',                                              
                   'MLT_MNLY_SUM'.                                              
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  PV-CC-PROCESS-MODE          PIC X(10)       VALUE SPACES.        
               88  PV-CC-DETAIL-MODE                       VALUE                
                   'DETAIL'.                                                    
               88  PV-CC-SUMMARY-MODE                      VALUE                
                   'SUMMARY'.                                                   
LY07C4     05  FILLER                      PIC X(01)       VALUE SPACES.        
LY07C4     05  PV-CC-PROCESS-OPT           PIC X(01)       VALUE SPACES.        
LY07C4         88  PV-CC-PROCESS-NORMAL-OPT                VALUE '0'.           
LY07C4         88  PV-CC-PROCESS-SMOOTH-OPT                VALUE '1'.           
LY07C4     05  FILLER                      PIC X(28)       VALUE SPACES.        
                                                                                
      ******************************************************************        
      *  MLRD070 COMMON RECALC EXTRACT INPUT RECORD                             
      ******************************************************************        
      *01  ML070-COMMON-RECALC-EXTRACT.                                         
           COPY MLRD070.                                                        
                                                                                
      ******************************************************************        
      *  MLRD070 COMMON RECALC EXTRACT ADJUSTMENT RECORD                        
      ******************************************************************        
      *01  MLADJ-COMMON-RECALC-EXTRACT.                                         
           COPY MLRD070 REPLACING ML070 BY MLADJ.                               
                                                                                
      ******************************************************************        
      *  MLRD070 COMMON RECALC EXTRACT NEXT FISCAL RECORD                       
      ******************************************************************        
      *01  MLNXT-COMMON-RECALC-EXTRACT.                                         
           COPY MLRD070 REPLACING ML070 BY MLNXT.                               
                                                                                
      *****************************************************************         
      * ERROR MESSAGE AREA FOR DB2                                              
      *****************************************************************         
           COPY DPWS004.                                                        
                                                                                
      *************************************************************             
      *    DB2 TVSCHVL (GET BRAND NAME)                           *             
      *************************************************************             
           EXEC SQL                                                             
               INCLUDE TVSCHVL                                                  
           END-EXEC.                                                            
                                                                                
      *************************************************************             
      *    DB2 XMT_VND (GET VENDOR NAME)                          *             
      *************************************************************             
           EXEC SQL                                                             
               INCLUDE XMT00000                                                 
           END-EXEC.                                                            
                                                                                
      *************************************************************             
      *    DB2 TDTATTR (GET DATE INFORMATION FROM DATE ATTRIBUTE) *             
      *************************************************************             
           EXEC SQL                                                             
               INCLUDE TDTATTR                                                  
           END-EXEC.                                                            
                                                                                
      *************************************************************             
      *    DB2 MLT_PARTN_BAL (GET PARTITION BALANCE INFOR)        *             
      *************************************************************             
           EXEC SQL                                                             
               INCLUDE MLT00002                                                 
           END-EXEC.                                                            
                                                                                
      *************************************************************             
      *    DB2 MLT_PARTN_CNTL(GET PARTITION CONTROL INFO)         *             
      *************************************************************             
           EXEC SQL                                                             
               INCLUDE MLT00003                                                 
           END-EXEC.                                                            
                                                                                
      *************************************************************             
      *    DB2 MLT_DEPT_BRND_VND (GET F-CALC DEPT/BRAND/VENDOR)   *             
      *************************************************************             
           EXEC SQL                                                             
               INCLUDE MLT00010                                                 
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
      * DB2 - MLV_BRND_VND.                                                     
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE MLV00000                                                 
           END-EXEC.                                                            
                                                                                
      *************************************************************             
      *    DB2 COMMUNICATION AREA                                 *             
      *************************************************************             
           EXEC SQL                                                             
               INCLUDE SQLCA                                                    
           END-EXEC.                                                            
                                                                                
      ******************************************************************        
       PROCEDURE DIVISION.                                                      
      ******************************************************************        
                                                                                
       0000-MAINLINE.                                                           
                                                                                
           PERFORM 1000-INITIALIZE.                                             
                                                                                
           PERFORM 8000-READ-INPUT.                                             
                                                                                
           PERFORM 1100-PROCESS-INPUT                                           
               UNTIL PS-COMMON-RECALC-IN-EOF.                                   
                                                                                
           PERFORM 9000-END-PROCESSING.                                         
                                                                                
           IF PS-BEG-SEASON                                                     
               MOVE PC-BEG-SEASON      TO RETURN-CODE                           
           ELSE                                                                 
               MOVE PC-NOT-BEG-SEASON  TO RETURN-CODE                           
           END-IF.                                                              
                                                                                
           STOP RUN.                                                            
                                                                                
      ******************************************************************        
      *  PERFORM THE NECESSARY INITIALIZATION STEPS                             
      ******************************************************************        
       1000-INITIALIZE.                                                         
                                                                                
           OPEN  INPUT EXECUTION-CONTROL-FILE                                   
                       COMMON-RECALC-IN-FILE                                    
                OUTPUT COMMON-RECALC-OUT-FILE                                   
                       COMMON-RECALC-FWD-FILE                                   
                       ADJUST-RPT-FILE.                                         
                                                                                
           SET PS-NOT-BEG-SEASON       TO TRUE.                                 
                                                                                
           MOVE ZEROES                TO MLT00002-DEPT-NBR                      
                                         MLT00010-ML-LO-MDSE-LVL-ID.            
                                                                                
      * GET THE FIRST VALID CONTROL CARD                                        
           PERFORM 1050-PROCESS-CONTROL.                                        
                                                                                
      ******************************************************************        
      *  CHECK/PROCESS CONTROL CARDS                                            
      ******************************************************************        
       1050-PROCESS-CONTROL.                                                    
                                                                                
           DISPLAY ' '.                                                         
                                                                                
           PERFORM 8100-READ-CONTROL.                                           
           PERFORM                                                              
               UNTIL PS-EXEC-CONTROL-EOF                                        
                   OR PV-CC-NOT-COMMENT                                         
               DISPLAY ' ' PV-CC-OPTIONAL-CONTROL                               
               ADD +1 TO PA-CONTROL-CNT                                         
               PERFORM 8100-READ-CONTROL                                        
           END-PERFORM.                                                         
           IF PV-CC-OPTIONAL-CONTROL = SPACES                                   
               CONTINUE                                                         
           ELSE                                                                 
               DISPLAY ' ' PV-CC-OPTIONAL-CONTROL                               
               IF PV-CC-FSCL-END-YYYY IS NUMERIC                                
                   AND PV-CC-FSCL-END-MM IS NUMERIC                             
                   AND PV-CC-FSCL-END-DD IS NUMERIC                             
                   AND PV-CC-FSCL-END-DASH-1                                    
                   AND PV-CC-FSCL-END-DASH-2                                    
                   DISPLAY ' * PROCESSING TABLE ' PV-CC-PROCESS-TABLE           
                           ' FOR FISCAL DATE ' PV-CC-FSCL-END-DATE              
                           ' IN ' PV-CC-PROCESS-MODE ' MODE.'                   
               ELSE                                                             
                   MOVE SPACES TO PV-CC-FSCL-END-DATE                           
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF PV-CC-FSCL-END-DATE = SPACES                                      
               OR NOT PV-CC-VALID-TABLES                                        
               DISPLAY ' *** INVALID DATE OR TABLE IN CONTROL CARD ***'         
               SET NON-SQL-ABEND   TO TRUE                                      
               MOVE '1050-PROCESS-CONTROL' TO PV-PARAGRAPH-NAME                 
               PERFORM 9999-OTHER-ABEND                                         
           ELSE                                                                 
               IF PV-CC-WEEKLY-TABLE                                            
                   MOVE 'W'                TO MLT00003-TBL-TM-LVL-CDE           
               ELSE                                                             
                   IF PV-CC-MONTHLY-TABLE                                       
                       MOVE 'M'            TO MLT00003-TBL-TM-LVL-CDE           
                   END-IF                                                       
               END-IF                                                           
LY07C4         IF PV-CC-PROCESS-SMOOTH-OPT                                      
LY07C4             DISPLAY ' *  PROCESSING WITH SMOOTHING/RECONCILING'          
LY07C4                     ' OPTION ON.'                                        
LY07C4         ELSE                                                             
LY07C4             DISPLAY ' *  PROCESSING WITH NO'                             
LY07C4                     ' SMOOTHING/RECONCILING OPTION (OPT OFF).'           
LY07C4         END-IF                                                           
           END-IF.                                                              
                                                                                
           DISPLAY ' '.                                                         
                                                                                
      ******************************************************************        
      *  PROCESS THE INPUT FILES FOR TOTAL RECORD BREAK                         
      ******************************************************************        
       1100-PROCESS-INPUT.                                                      
                                                                                
           ADD +1 TO PA-RECORD-IN-CNT.                                          
                                                                                
      * IS THIS A TOTAL RECORD?                                                 
           IF ML070-MAJ-CL-NBR = ZEROES                                         
               AND ML070-SUB-CL-NBR = ZEROES                                    
               AND ML070-LOC-NBR = ZEROES                                       
               MOVE ML070-CURR-END-INV-COST-AMT                                 
                   TO PV-TOT-END-INV-COST-AMT                                   
               MOVE ML070-CURR-END-INV-RTL-AMT                                  
                   TO PV-TOT-END-INV-RTL-AMT                                    
               ADD +1 TO PA-RECORD-IGNORED                                      
           ELSE                                                                 
               PERFORM 2000-PROCESS-DETAIL                                      
           END-IF.                                                              
                                                                                
           PERFORM 8000-READ-INPUT.                                             
                                                                                
                                                                                
      ******************************************************************        
      *  MAIN LOGIC TO PROCESS THE DETAIL                                       
      ******************************************************************        
       2000-PROCESS-DETAIL.                                                     
                                                                                
      * KEY BREAK?                                                              
           IF ML070-DEPT-NBR = MLT00002-DEPT-NBR                                
               AND ML070-ML-LWST-ID = MLT00010-ML-LO-MDSE-LVL-ID                
               AND ML070-FSCL-END-DTE = PV-CURR-FSCL-END-DTE                    
      * TALLY UP PREVIOUS RECORD                                                
               ADD MLADJ-END-INV-COST-AMT1  TO PV-TLY-END-INV-COST1-AMT         
               ADD MLADJ-INV-COST-ADJ1      TO PV-TLY-INV-COST-ADJ1-AMT         
               ADD MLADJ-END-INV-COST-AMT2  TO PV-TLY-END-INV-COST2-AMT         
               ADD MLADJ-INV-COST-ADJ2      TO PV-TLY-INV-COST-ADJ2-AMT         
                                                                                
               PERFORM 3100-LOAD-DETAIL-ADJ                                     
                                                                                
      * WRITE PREVIOUS RECORD                                                   
               PERFORM 8400-WRITE-COMMON-RECALC-OUT                             
      * IS IT THE END OF THE FISCAL MONTH?  YES, CREATE FORWARD ROW             
LY07A4*        IF PS-DEPT-BRND-VND-FOUND                                        
LY07A4         IF PV-CURR-FSCL-MN-END-DTE = ML070-FSCL-END-DTE                  
                   AND (MLADJ-CURR-END-INV-RTL-AMT NOT = ZEROES OR              
                           MLADJ-END-INV-COST-AMT2 NOT = ZEROES)                
                   PERFORM 3300-LOAD-NEXT-FSCL                                  
                   PERFORM 8450-WRITE-COMMON-RECALC-FWD                         
               END-IF                                                           
33539 ***      IF PV-CC-DETAIL-MODE                                             
33539 ***          PERFORM 8500-WRITE-ADJUST-RPT                                
33539 ***      END-IF                                                           
           ELSE                                                                 
      * FIRST TIME THROUGH?                                                     
LY07C4         IF PA-RECORD-ACCEPTED = 0                                        
                   CONTINUE                                                     
               ELSE                                                             
                   PERFORM 2025-CHECK-REMAINING                                 
               END-IF                                                           
                                                                                
               MOVE ZEROES       TO PV-TLY-INV-COST-ADJ1-AMT                    
                                    PV-TLY-INV-COST-ADJ2-AMT                    
                                    PV-TLY-END-INV-COST1-AMT                    
                                    PV-TLY-END-INV-COST2-AMT                    
                                    PV-TTL-BOP-COST                             
                                    PV-TTL-SALES-RTL                            
                                    PV-TTL-RCPT-NET-CST                         
                                    PV-TTL-PADJ-NET-CST                         
                                    PV-TTL-EIR                                  
                                    PV-TTL-PRE-SMOOTH-EIC                       
                                    PV-TTL-ORIG-INV-ADJ-1                       
                                    PV-TTL-ADJ-INV-ADJ-1                        
                                    PV-TTL-ORIG-EIC-1                           
                                    PV-TTL-ADJ-EIC-1                            
                                    PV-TTL-ORIG-INV-ADJ-2                       
                                    PV-TTL-ADJ-INV-ADJ-2                        
                                    PV-TTL-ORIG-EIC-2                           
                                    PV-TTL-ADJ-EIC-2                            
                                    PV-TTL-ORIG-ADJ-GM                          
                                    PV-TTL-ADJ-ADJ-GM                           
                                                                                
               MOVE ML070-DEPT-NBR      TO MLT00002-DEPT-NBR                    
               MOVE ML070-ML-LWST-ID    TO MLV00000-ML-LO-MDSE-LVL-ID           
                                           MLT00010-ML-LO-MDSE-LVL-ID           
               MOVE ML070-FSCL-END-DTE  TO PV-CURR-FSCL-END-DTE                 
                                           MLT00003-FSCL-DTE                    
                                                                                
      * GET CURRENT PARTITION INFO, REPLACE IF NEED BE.                         
LY07B4         SET PS-GET-CURR-PARTN-INFO   TO TRUE                             
               PERFORM 3500-GET-PARTN-INFO                                      
               IF PV-CC-WEEKLY-TABLE                                            
                   MOVE DTATTR-FSCL-WK-NBR     TO PV-CURR-FSCL-PERIOD           
               ELSE                                                             
                   IF PV-CC-MONTHLY-TABLE                                       
                       MOVE DTATTR-FSCL-MN-NBR TO PV-CURR-FSCL-PERIOD           
                   END-IF                                                       
               END-IF                                                           
LY07A4         MOVE DTATTR-PFM-END-DTE     TO PV-PREV-FSCL-MN-END-DTE           
LY07A4         MOVE DTATTR-FSCL-MN-END-DTE TO PV-CURR-FSCL-MN-END-DTE           
LY07A4         MOVE DTATTR-SEA-END-DTE     TO PV-CURR-FSCL-SEA-END-DTE          
               MOVE MLT00003-PARTN-NBR     TO PV-CURR-PARTN-NBR                 
               MOVE MLT00003-DEPT-GP-CDE   TO PV-CURR-PARTN-GROUP               
                                                                                
      * LOAD PREV DEPT/BRAND/VENDOR INFORMATION                                 
LY07A4         MOVE PV-PREV-FSCL-MN-END-DTE TO MLT00010-FSCL-MN-END-DTE         
               PERFORM 2400-GET-DEPT-BRAND-VND                                  
               MOVE MLT00010-END-INV-COST-AMT  TO PT-DBV-BOP-COST               
                                                                                
      * GET NEXT FISCAL AND PARTITION INFO                                      
               PERFORM 3550-GET-NEXT-FSCL-DTE                                   
LY07B4         SET PS-GET-NEXT-PARTN-INFO   TO TRUE                             
               PERFORM 3500-GET-PARTN-INFO                                      
               MOVE MLT00003-PARTN-NBR     TO MLNXT-PARTN-NBR                   
               MOVE MLT00003-DEPT-GP-CDE   TO MLNXT-PARTN-GROUP                 
                                                                                
33539 *** TO MAKE A PERFORMANCE GAIN, WE HAVE COMMENTED OUT THE                 
33539 *** .CSV FILE CREATION AT THIS TIME.                                      
33539 ***      PERFORM 2100-GET-BV-VIEW                                         
33539 ***      PERFORM 2200-GET-BRAND-NAME                                      
33539 ***      PERFORM 2300-GET-VENDOR-NAME                                     
      * SETUP REPORT                                                            
               MOVE ML070-PARTN-NBR            TO PT-PARTN-NBR                  
               MOVE PV-CC-PROCESS-TABLE        TO PT-TABLE-NAME                 
               MOVE ML070-FSCL-END-DTE         TO PT-FSCL-END-DTE               
               MOVE ML070-DEPT-NBR             TO PT-DEPT-NBR                   
                                                  MLNXT-DEPT-NBR                
               MOVE ML070-ML-LWST-ID           TO PT-ML-LWST-ID                 
                                                  MLNXT-ML-LWST-ID              
                                                                                
      * LOAD CURRENT DEPT/BRAND/VENDOR INFORMATION                              
LY07C4*        MOVE ML070-FSCL-END-DTE  TO MLT00010-FSCL-MN-END-DTE             
LY07C4         MOVE PV-CURR-FSCL-MN-END-DTE TO MLT00010-FSCL-MN-END-DTE         
               PERFORM 2400-GET-DEPT-BRAND-VND                                  
               MOVE MLT00010-END-INV-RTL-AMT   TO PT-DBV-EIR                    
               MOVE MLT00010-END-INV-COST-AMT  TO PT-DBV-PRE-SMOOTH-EIC         
               MOVE MLT00010-INV-COST-ADJ1-AMT TO PT-DBV-INV-ADJ-1              
               MOVE MLT00010-END-INV-COST1-AMT TO PT-DBV-EIC-1                  
               MOVE MLT00010-INV-COST-ADJ2-AMT TO PT-DBV-INV-ADJ-2              
               MOVE MLT00010-END-INV-COST2-AMT TO PT-DBV-EIC-2                  
               MOVE MLT00010-GRO-MRGN-AMT      TO PT-DBV-GM                     
           END-IF.                                                              
                                                                                
      * ENSURE THAT THE CURRENT PARTITION NUMBER, GROUP, FISCAL PERIOD          
      * LABEL SEQ, AND ENT-ID ARE CORRECT, BECAUSE THE RECALC RECORD            
      * DOES NOT NECESSARILY HAVE THE CORRECT INFORMATION AT THIS POINT.        
           MOVE PV-CURR-FSCL-PERIOD    TO ML070-FSCL-PERIOD.                    
           MOVE MLV00000-LBL-SEQ-NBR   TO PT-LBL-SEQ-NBR.                       
      *                                   ML070-LBL-SEQ-NBR                     
      *                                   MLNXT-LBL-SEQ-NBR.                    
           MOVE ML070-LBL-SEQ-NBR      TO MLNXT-LBL-SEQ-NBR.                    
           MOVE MLV00000-ENT-ID        TO PT-ENT-ID                             
      *                                   ML070-ENT-ID                          
      *                                   MLNXT-ENT-ID.                         
           MOVE ML070-ENT-ID           TO MLNXT-ENT-ID.                         
           IF PV-CURR-PARTN-NBR = ML070-PARTN-NBR                               
               AND PV-CURR-PARTN-GROUP = ML070-PARTN-GROUP                      
               CONTINUE                                                         
           ELSE                                                                 
               ADD +1                      TO PA-PARTN-MISMATCH                 
LY0705*        MOVE MLT00003-PARTN-NBR     TO ML070-PARTN-NBR                   
LY0705         MOVE PV-CURR-PARTN-NBR      TO ML070-PARTN-NBR                   
LY0705*        MOVE MLT00003-DEPT-GP-CDE   TO ML070-PARTN-GROUP                 
LY0705         MOVE PV-CURR-PARTN-GROUP    TO ML070-PARTN-GROUP                 
           END-IF.                                                              
                                                                                
      * SAVE OFF CURRENT RECORD                                                 
           MOVE ML070-COMMON-RECALC-EXTRACT                                     
               TO MLADJ-COMMON-RECALC-EXTRACT.                                  
                                                                                
      * SETUP REPORT LOCATION/SUB-CLASS LEVEL                                   
           MOVE ML070-MAJ-CL-NBR           TO MLNXT-MAJ-CL-NBR.                 
           MOVE ML070-SUB-CL-NBR           TO PT-SUB-CLASS                      
                                              MLNXT-SUB-CL-NBR.                 
           MOVE ML070-LOC-NBR              TO PT-LOCATION                       
                                              MLNXT-LOC-NBR.                    
           MOVE SPACES                     TO PT-MSG-TEXT.                      
                                                                                
      * FOUND CURR FISCAL PERIOD'S BRAND/VENDOR CALC'D INFO AND                 
      * PROCESSING FOR THE END OF THE MONTH?                                    
           IF PS-DEPT-BRND-VND-FOUND                                            
LY07C4         AND PV-CC-FSCL-END-DATE = PV-CURR-FSCL-MN-END-DTE                
LY07C4         AND ML070-FSCL-END-DTE = PV-CURR-FSCL-MN-END-DTE                 
LY07C4         AND PV-CC-PROCESS-SMOOTH-OPT                                     
               IF PV-TOT-END-INV-COST-AMT = 0                                   
                   MOVE SPACES                  TO PT-DTL-PRORATE-PCT-X         
                   MOVE MLADJ-CURR-END-INV-COST-AMT                             
                       TO MLADJ-END-INV-COST-AMT1                               
                          MLADJ-END-INV-COST-AMT2                               
               ELSE                                                             
                   PERFORM 2050-PRORATE-ADJ                                     
               END-IF                                                           
           ELSE                                                                 
               MOVE MLADJ-CURR-END-INV-COST-AMT                                 
                   TO MLADJ-END-INV-COST-AMT1                                   
                      MLADJ-END-INV-COST-AMT2                                   
           END-IF.                                                              
                                                                                
           PERFORM 3000-LOAD-DETAIL-ORIG.                                       
                                                                                
LY07C4     ADD +1 TO PA-RECORD-ACCEPTED.                                        
                                                                                
      ******************************************************************        
      * CHECK TO SEE IF THERE IS ANY REMAINING/RESIDUAL TO PRORATE              
      ******************************************************************        
       2025-CHECK-REMAINING.                                                    
                                                                                
           IF PS-DEPT-BRND-VND-FOUND                                            
LY07C4         AND PV-CC-FSCL-END-DATE = PV-CURR-FSCL-MN-END-DTE                
LY07C4         AND ML070-FSCL-END-DTE = PV-CURR-FSCL-MN-END-DTE                 
LY07C4         AND PV-CC-PROCESS-SMOOTH-OPT                                     
               MOVE 'REMAINING/RESIDUAL'   TO PT-MSG-TEXT                       
                                                                                
               COMPUTE MLADJ-END-INV-COST-AMT1                                  
                                     = MLT00010-END-INV-COST1-AMT               
                                     - PV-TLY-END-INV-COST1-AMT                 
                                                                                
               COMPUTE MLADJ-INV-COST-ADJ1                                      
                                     = MLADJ-END-INV-COST-AMT1                  
                                     - MLADJ-CURR-END-INV-COST-AMT              
                                                                                
               COMPUTE MLADJ-END-INV-COST-AMT2                                  
                                     = MLT00010-END-INV-COST2-AMT               
                                     - PV-TLY-END-INV-COST2-AMT                 
               COMPUTE MLADJ-INV-COST-ADJ2                                      
                                     = MLADJ-END-INV-COST-AMT2                  
                                     - MLADJ-END-INV-COST-AMT1                  
                                                                                
               MOVE SPACES                 TO PT-DTL-PRORATE-PCT-X              
           ELSE                                                                 
               MOVE MLADJ-CURR-END-INV-COST-AMT                                 
                   TO MLADJ-END-INV-COST-AMT1                                   
                      MLADJ-END-INV-COST-AMT2                                   
           END-IF.                                                              
                                                                                
      * DO NOT LOAD ORIGINAL FROM CURRENT, USE PREVIOUS LOADED VALUES           
      *    PERFORM 3000-LOAD-DETAIL-ORIG.                                       
           PERFORM 3100-LOAD-DETAIL-ADJ.                                        
                                                                                
           PERFORM 8400-WRITE-COMMON-RECALC-OUT.                                
      * IS IT THE END OF THE FISCAL MONTH?  YES, CREATE FORWARD ROW             
LY07A4*    IF PS-DEPT-BRND-VND-FOUND                                            
LY07A4     IF PV-CURR-FSCL-MN-END-DTE = MLADJ-FSCL-END-DTE                      
               AND (MLADJ-CURR-END-INV-RTL-AMT NOT = ZEROES OR                  
                       MLADJ-END-INV-COST-AMT2 NOT = ZEROES)                    
               PERFORM 3300-LOAD-NEXT-FSCL                                      
               PERFORM 8450-WRITE-COMMON-RECALC-FWD                             
           END-IF.                                                              
33539 ***  IF PV-CC-DETAIL-MODE                                                 
33539 ***      PERFORM 8500-WRITE-ADJUST-RPT                                    
33539 ***  ELSE                                                                 
33539 ***      PERFORM 3200-LOAD-SUMMARY-INFO                                   
33539 ***      PERFORM 8500-WRITE-ADJUST-RPT                                    
33539 ***  END-IF.                                                              
33539 ***                                                                       
P18333***  DISPLAY ' * FISCAL DATE ' PT-FSCL-END-DTE                            
P18333***          ' DEPT ' PT-DEPT-NBR                                         
P18333***          ' DKEY ' PT-ML-LWST-ID                                       
P18333***          ' ENDED AT RECORD ' PA-RECORD-OUT-CNT.                       
                                                                                
      ******************************************************************        
      *  PRORATE THE VARIOUS FIELDS/COLUMNS                                     
      ******************************************************************        
       2050-PRORATE-ADJ.                                                        
                                                                                
      * CALC PRORATE PERCENT = EIC / TOTAL EIC FOR DEPT, BRAND, VENDOR          
           COMPUTE PV-PRORATE-PCT ROUNDED                                       
                   = MLADJ-CURR-END-INV-COST-AMT                                
                                  / PV-TOT-END-INV-COST-AMT.                    
           MOVE PV-PRORATE-PCT             TO PT-DTL-PRORATE-PCT.               
                                                                                
      * RECORD AND PRORATE/ADJUST EIC-1                                         
           COMPUTE MLADJ-END-INV-COST-AMT1 ROUNDED                              
                   = MLT00010-END-INV-COST1-AMT                                 
                                           * PV-PRORATE-PCT.                    
                                                                                
      * INVENTORY COST ADJ 1 = EIC-1 - EIC                                      
           COMPUTE MLADJ-INV-COST-ADJ1 = MLADJ-END-INV-COST-AMT1                
                                       - MLADJ-CURR-END-INV-COST-AMT.           
                                                                                
      * RECORD AND PRORATE/ADJUST EIC-2                                         
           COMPUTE MLADJ-END-INV-COST-AMT2 ROUNDED                              
                   = MLT00010-END-INV-COST2-AMT                                 
                                           * PV-PRORATE-PCT.                    
                                                                                
      * INVENTORY COST ADJ 2 = EIC-2 - EIC-1                                    
           COMPUTE MLADJ-INV-COST-ADJ2 = MLADJ-END-INV-COST-AMT2                
                                       - MLADJ-END-INV-COST-AMT1.               
                                                                                
                                                                                
      ******************************************************************        
      *  TRANSLATE THE DKEY TO BRAND AND VENDOR                                 
      ******************************************************************        
       2100-GET-BV-VIEW.                                                        
                                                                                
           EXEC SQL                                                             
              SELECT                                                            
                      LBL_SEQ_NBR                                               
                     ,ENT_ID                                                    
                INTO  :MLV00000-LBL-SEQ-NBR                                     
                     ,:MLV00000-ENT-ID                                          
                FROM  MLV_BRND_VND                                              
               WHERE  ML_LO_MDSE_LVL_ID = :MLV00000-ML-LO-MDSE-LVL-ID           
              WITH UR                                                           
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
               WHEN +0                                                          
                   MOVE MLV00000-LBL-SEQ-NBR TO PV-LBL-SEQ-NBR                  
                   MOVE MLV00000-ENT-ID      TO PV-ENT-ID                       
               WHEN +100                                                        
                   ADD +1                  TO PA-DKEY-NOT-FOUND                 
                   MOVE MLV00000-ML-LO-MDSE-LVL-ID                              
                       TO PV-ML-LWST-ID-9                                       
                   DISPLAY 'UNKNOWN BV VIEW FOR ' PV-ML-LWST-ID-9               
                   MOVE PC-UNKNOWN         TO PT-BRAND-NAME                     
                   MOVE PC-UNKNOWN         TO PT-VENDOR-NAME                    
                   MOVE ZEROS              TO PV-LBL-SEQ-NBR                    
                   MOVE ZEROS              TO PV-ENT-ID                         
               WHEN OTHER                                                       
                   DISPLAY ' DKEY: ' MLV00000-ML-LO-MDSE-LVL-ID                 
                   MOVE 'SELECT MLV_BRND_VND ' TO PV-DB2-OPER-ATTEMPTED         
                   MOVE '2100-GET-BV-VIEW   ' TO PV-PARAGRAPH-NAME              
                   PERFORM 9950-SQL-ABEND                                       
           END-EVALUATE.                                                        
                                                                                
                                                                                
      ******************************************************************        
      *  GET THE BRAND NAME FROM TVSCHVL                                        
      ******************************************************************        
       2200-GET-BRAND-NAME.                                                     
                                                                                
           EXEC SQL                                                             
              SELECT   CHARTC_VAL_DESC                                          
                INTO  :VSCHVL-CHARTC-VAL-DESC                                   
                FROM   TVSCHVL                                                  
               WHERE   CHARTC_CDE = :PC-3                                       
                 AND   CHARTC_SEQ_NBR = :PV-LBL-SEQ-NBR                         
              WITH UR                                                           
           END-EXEC.                                                            
                                                                                
           IF SQLCODE = +0                                                      
               INSPECT VSCHVL-CHARTC-VAL-DESC                                   
                                REPLACING ALL ',' BY ' '                        
               MOVE VSCHVL-CHARTC-VAL-DESC TO PT-BRAND-NAME                     
           ELSE                                                                 
               IF SQLCODE = +100                                                
                   ADD +1                  TO PA-BRND-NOT-FOUND                 
                   MOVE PC-UNKNOWN         TO PT-BRAND-NAME                     
                   MOVE PV-LBL-SEQ-NBR     TO PV-LBL-SEQ-NBR-9                  
                   DISPLAY 'UNKNOWN BRAND FOR ' PV-LBL-SEQ-NBR-9                
           ELSE                                                                 
               DISPLAY ' LABEL SEQ: ' PV-LBL-SEQ-NBR                            
               MOVE 'SELECT TVSCHVL     ' TO PV-DB2-OPER-ATTEMPTED              
               MOVE '2200-GET-BRAND-NAME' TO PV-PARAGRAPH-NAME                  
               PERFORM 9950-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  GET THE VENDOR NAME FROM XMT_VND                                       
      ******************************************************************        
       2300-GET-VENDOR-NAME.                                                    
                                                                                
           EXEC SQL                                                             
              SELECT   PRIM_VND_NM                                              
                INTO  :XMT00000-PRIM-VND-NM                                     
                FROM   XMT_VND                                                  
               WHERE   ENT_ID = :PV-ENT-ID                                      
              WITH UR                                                           
           END-EXEC.                                                            
                                                                                
           IF SQLCODE = +0                                                      
               INSPECT XMT00000-PRIM-VND-NM                                     
                                      REPLACING ALL ',' BY ' '                  
               MOVE XMT00000-PRIM-VND-NM   TO PT-VENDOR-NAME                    
           ELSE                                                                 
               IF SQLCODE = +100                                                
                   ADD +1                  TO PA-VNDR-NOT-FOUND                 
                   MOVE PC-UNKNOWN         TO PT-VENDOR-NAME                    
                   MOVE PV-ENT-ID          TO PV-ENT-ID-9                       
                   DISPLAY 'UNKNOWN VENDOR FOR ' PV-ENT-ID-9                    
           ELSE                                                                 
               DISPLAY ' ENT-ID: ' PV-ENT-ID                                    
               MOVE 'SELECT XMT_VND     ' TO PV-DB2-OPER-ATTEMPTED              
               MOVE '2300-GET-VENDOR-NAME ' TO PV-PARAGRAPH-NAME                
               PERFORM 9950-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  GET THE VARIOUS DEPT/BRAND/VENDOR INFO TO USE IN PRORATION             
      ******************************************************************        
       2400-GET-DEPT-BRAND-VND.                                                 
                                                                                
           EXEC SQL                                                             
              SELECT                                                            
                      A.END_INV_RTL_AMT                                         
                     ,A.END_INV_COST_AMT                                        
                     ,A.INV_COST_ADJ1_AMT                                       
                     ,A.END_INV_COST1_AMT                                       
                     ,A.INV_COST_ADJ2_AMT                                       
                     ,A.END_INV_COST2_AMT                                       
                     ,A.GRO_MRGN_AMT                                            
                INTO                                                            
                     :MLT00010-END-INV-RTL-AMT                                  
                    ,:MLT00010-END-INV-COST-AMT                                 
                    ,:MLT00010-INV-COST-ADJ1-AMT                                
                    ,:MLT00010-END-INV-COST1-AMT                                
                    ,:MLT00010-INV-COST-ADJ2-AMT                                
                    ,:MLT00010-END-INV-COST2-AMT                                
                    ,:MLT00010-GRO-MRGN-AMT                                     
                FROM   MLT_DEPT_BRND_VND  A                                     
                WHERE                                                           
                       A.PARTN_NBR IN (                                         
                         SELECT  B.PARTN_NBR                                    
                           FROM  MLT_PARTN_CNTL  B                              
                           WHERE B.TBL_TM_LVL_CDE                               
                                     = 'M'                                      
                             AND B.FSCL_DTE = :MLT00010-FSCL-MN-END-DTE         
                             AND B.DEPT_GP_CDE IN (                             
                                 SELECT  C.DEPT_GP_CDE                          
                                   FROM  MLT_PARTN_BAL  C                       
                                   WHERE C.TBL_TM_LVL_CDE                       
                                             = 'M'                              
                                     AND C.DEPT_NBR = :MLT00002-DEPT-NBR        
                                     AND :MLT00010-FSCL-MN-END-DTE              
                                         BETWEEN C.EFF_BEG_DTE AND              
                                             VALUE (C.EFF_END_DTE,              
                                                 '9999-12-30')                  
                                   )                                            
                           )                                                    
                   AND A.DEPT_NBR = :MLT00002-DEPT-NBR                          
                   AND A.ML_LO_MDSE_LVL_ID = :MLT00010-ML-LO-MDSE-LVL-ID        
              WITH UR                                                           
           END-EXEC.                                                            
                                                                                
           EVALUATE SQLCODE                                                     
               WHEN +0                                                          
                   SET PS-DEPT-BRND-VND-FOUND     TO TRUE                       
               WHEN +100                                                        
      *            DISPLAY ' DEPT-BRAND-VENDOR INFO NOT FOUND FOR'              
      *                    ' DEPT ' MLT00002-DEPT-NBR                           
      *                    ' DKEY ' MLT00010-ML-LO-MDSE-LVL-ID                  
      *                    ' DATE ' MLT00010-FSCL-MN-END-DTE                    
                   ADD +1                  TO PA-BRND-VND-NOT-FOUND             
                   SET PS-DEPT-BRND-VND-NOT-FOUND TO TRUE                       
                   MOVE ZEROES     TO MLT00010-END-INV-RTL-AMT                  
                                      MLT00010-END-INV-COST-AMT                 
                                      MLT00010-INV-COST-ADJ1-AMT                
                                      MLT00010-END-INV-COST1-AMT                
                                      MLT00010-INV-COST-ADJ2-AMT                
                                      MLT00010-END-INV-COST2-AMT                
                                      MLT00010-GRO-MRGN-AMT                     
               WHEN OTHER                                                       
                   DISPLAY ' DEPT ' MLT00002-DEPT-NBR                           
                           ' DKEY ' MLT00010-ML-LO-MDSE-LVL-ID                  
                           ' DATE ' MLT00010-FSCL-MN-END-DTE                    
                   MOVE 'SELECT MLT_DEPT_BRND_VND'                              
                       TO PV-DB2-OPER-ATTEMPTED                                 
                   MOVE '2400-GET-DEPT-BRAND-VND'                               
                       TO PV-PARAGRAPH-NAME                                     
                   PERFORM 9950-SQL-ABEND                                       
           END-EVALUATE.                                                        
                                                                                
                                                                                
      ******************************************************************        
      *  LOAD THE ORIGINAL DETAIL INFORMATION FOR REPORT/CSV                    
      ******************************************************************        
       3000-LOAD-DETAIL-ORIG.                                                   
                                                                                
           MOVE ML070-PREV-END-INV-COST-AMT  TO PT-DTL-BOP-COST.                
           ADD  ML070-PREV-END-INV-COST-AMT  TO PV-TTL-BOP-COST.                
                                                                                
           MOVE ML070-CURR-SLS-RTL-AMT       TO PT-DTL-SALES-RTL.               
           ADD  ML070-CURR-SLS-RTL-AMT       TO PV-TTL-SALES-RTL.               
                                                                                
           MOVE ML070-CURR-RCPT-NET-COST-AMT TO PT-DTL-RCPT-NET-CST.            
           ADD  ML070-CURR-RCPT-NET-COST-AMT TO PV-TTL-RCPT-NET-CST.            
                                                                                
           MOVE ML070-CURR-PADJ-NET-COST-AMT TO PT-DTL-PADJ-NET-CST.            
           ADD  ML070-CURR-PADJ-NET-COST-AMT TO PV-TTL-PADJ-NET-CST.            
                                                                                
           MOVE ML070-CURR-END-INV-RTL-AMT  TO PT-DTL-EIR.                      
           ADD  ML070-CURR-END-INV-RTL-AMT  TO PV-TTL-EIR.                      
                                                                                
           MOVE ML070-CURR-END-INV-COST-AMT TO PT-DTL-PRE-SMOOTH-EIC.           
           ADD  ML070-CURR-END-INV-COST-AMT TO PV-TTL-PRE-SMOOTH-EIC.           
                                                                                
           MOVE ML070-END-INV-COST-AMT1     TO PT-DTL-ORIG-EIC-1.               
           ADD  ML070-END-INV-COST-AMT1     TO PV-TTL-ORIG-EIC-1.               
                                                                                
           MOVE ML070-INV-COST-ADJ1         TO PT-DTL-ORIG-INV-ADJ-1.           
           ADD  ML070-INV-COST-ADJ1         TO PV-TTL-ORIG-INV-ADJ-1.           
                                                                                
           MOVE ML070-END-INV-COST-AMT2     TO PT-DTL-ORIG-EIC-2.               
           ADD  ML070-END-INV-COST-AMT2     TO PV-TTL-ORIG-EIC-2.               
                                                                                
           MOVE ML070-INV-COST-ADJ2         TO PT-DTL-ORIG-INV-ADJ-2.           
           ADD  ML070-INV-COST-ADJ2         TO PV-TTL-ORIG-INV-ADJ-2.           
                                                                                
           MOVE ML070-ADJ-GRO-MRGN-AMT      TO PT-DTL-ORIG-ADJ-GM.              
           ADD  ML070-ADJ-GRO-MRGN-AMT      TO PV-TTL-ORIG-ADJ-GM.              
                                                                                
                                                                                
      ******************************************************************        
      *  LOAD THE ADJUSTED DETAIL INFO FOR REPORT/CSV, RECALC GM$               
      ******************************************************************        
       3100-LOAD-DETAIL-ADJ.                                                    
                                                                                
           MOVE MLADJ-END-INV-COST-AMT1     TO PT-DTL-ADJ-EIC-1.                
           ADD  MLADJ-END-INV-COST-AMT1     TO PV-TTL-ADJ-EIC-1.                
                                                                                
           MOVE MLADJ-INV-COST-ADJ1         TO PT-DTL-ADJ-INV-ADJ-1.            
           ADD  MLADJ-INV-COST-ADJ1         TO PV-TTL-ADJ-INV-ADJ-1.            
                                                                                
           MOVE MLADJ-END-INV-COST-AMT2     TO PT-DTL-ADJ-EIC-2.                
           ADD  MLADJ-END-INV-COST-AMT2     TO PV-TTL-ADJ-EIC-2.                
                                                                                
           MOVE MLADJ-INV-COST-ADJ2         TO PT-DTL-ADJ-INV-ADJ-2.            
           ADD  MLADJ-INV-COST-ADJ2         TO PV-TTL-ADJ-INV-ADJ-2.            
                                                                                
      * CALC ADJUSTED SALES COST                                                
           COMPUTE MLADJ-CURR-SLS-COST-AMT =                                    
                 (  MLADJ-PREV-END-INV-COST-AMT                                 
                  + MLADJ-CURR-RCPT-NET-COST-AMT                                
                  + MLADJ-CURR-PADJ-NET-COST-AMT                                
                  - MLADJ-END-INV-COST-AMT2     ).                              
                                                                                
      * CALC ADJUSTED GROSS MARGIN                                              
           COMPUTE MLADJ-ADJ-GRO-MRGN-AMT =                                     
                       MLADJ-CURR-SLS-RTL-AMT                                   
                     - MLADJ-CURR-SLS-COST-AMT.                                 
                                                                                
           MOVE MLADJ-ADJ-GRO-MRGN-AMT      TO PT-DTL-ADJ-ADJ-GM.               
           ADD  MLADJ-ADJ-GRO-MRGN-AMT      TO PV-TTL-ADJ-ADJ-GM.               
                                                                                
                                                                                
      ******************************************************************        
      *  LOAD THE SUMMARY INFOR FOR REPORT/CSV                                  
      ******************************************************************        
       3200-LOAD-SUMMARY-INFO.                                                  
                                                                                
           MOVE PV-TTL-BOP-COST              TO PT-DTL-BOP-COST.                
                                                                                
           MOVE PV-TTL-SALES-RTL             TO PT-DTL-SALES-RTL.               
                                                                                
           MOVE PV-TTL-RCPT-NET-CST          TO PT-DTL-RCPT-NET-CST.            
                                                                                
           MOVE PV-TTL-PADJ-NET-CST          TO PT-DTL-PADJ-NET-CST.            
                                                                                
           MOVE PV-TTL-EIR                   TO PT-DTL-EIR.                     
                                                                                
           MOVE PV-TTL-PRE-SMOOTH-EIC       TO PT-DTL-PRE-SMOOTH-EIC.           
                                                                                
           MOVE PV-TTL-ORIG-EIC-1           TO PT-DTL-ORIG-EIC-1.               
                                                                                
           MOVE PV-TTL-ORIG-INV-ADJ-1       TO PT-DTL-ORIG-INV-ADJ-1.           
                                                                                
           MOVE PV-TTL-ORIG-EIC-2           TO PT-DTL-ORIG-EIC-2.               
                                                                                
           MOVE PV-TTL-ORIG-INV-ADJ-2       TO PT-DTL-ORIG-INV-ADJ-2.           
                                                                                
           MOVE PV-TTL-ORIG-ADJ-GM          TO PT-DTL-ORIG-ADJ-GM.              
                                                                                
           MOVE PV-TTL-ADJ-EIC-1            TO PT-DTL-ADJ-EIC-1.                
                                                                                
           MOVE PV-TTL-ADJ-INV-ADJ-1        TO PT-DTL-ADJ-INV-ADJ-1.            
                                                                                
           MOVE PV-TTL-ADJ-EIC-2            TO PT-DTL-ADJ-EIC-2.                
                                                                                
           MOVE PV-TTL-ADJ-INV-ADJ-2        TO PT-DTL-ADJ-INV-ADJ-2.            
                                                                                
           MOVE PV-TTL-ADJ-ADJ-GM           TO PT-DTL-ADJ-ADJ-GM.               
                                                                                
                                                                                
      ******************************************************************        
      *  LOAD THE NEXT FISCAL OR FORWARD ADJUSTMENT INFORMATION                 
      ******************************************************************        
       3300-LOAD-NEXT-FSCL.                                                     
                                                                                
           MOVE ZEROES               TO MLNXT-TYPE                              
                                        MLNXT-PREV-END-INV-RTL-AMT              
      *                                 MLNXT-PREV-END-INV-COST-AMT             
                                        MLNXT-CURR-RCPT-RTL-AMT                 
                                        MLNXT-CURR-PADJ-RTL-AMT                 
                                        MLNXT-CURR-MKUP-RTL-AMT                 
                                        MLNXT-CURR-MKDN-RTL-AMT                 
                                        MLNXT-CURR-XFER-IN-RTL-AMT              
                                        MLNXT-CURR-XFER-OUT-RTL-AMT             
                                        MLNXT-CURR-SLS-RTL-AMT                  
                                        MLNXT-CURR-INV-ADJ-RTL-AMT              
                                        MLNXT-CURR-SHNK-RTL-AMT                 
                                        MLNXT-CURR-END-INV-RTL-AMT              
                                        MLNXT-CURR-CUM-MKUP-PCT                 
                                        MLNXT-CURR-END-INV-COST-AMT             
                                        MLNXT-CURR-SLS-COST-AMT                 
                                        MLNXT-CURR-GRO-MRGN-AMT                 
                                        MLNXT-CURR-RCPT-NET-COST-AMT            
                                        MLNXT-CURR-PADJ-NET-COST-AMT            
                                        MLNXT-SEAS-RCPT-RTL-AMT                 
                                        MLNXT-SEAS-RCPT-NET-COST-AMT            
                                        MLNXT-SEAS-PADJ-RTL-AMT                 
                                        MLNXT-SEAS-PADJ-NET-COST-AMT            
                                        MLNXT-SEAS-MKUP-RTL-AMT                 
                                        MLNXT-SEAS-XFER-IN-RTL-AMT              
                                        MLNXT-SEAS-XFER-OUT-RTL-AMT             
                                        MLNXT-BEG-SEAS-INV-RTL-AMT              
                                        MLNXT-BEG-SEAS-INV-COST-AMT             
                                        MLNXT-SHNK-RTL-AMT                      
                                        MLNXT-SHNK-SLS-RTL-AMT                  
                                        MLNXT-INV-COST-ADJ1                     
                                        MLNXT-INV-COST-ADJ2                     
                                        MLNXT-END-INV-COST-AMT1                 
                                        MLNXT-END-INV-COST-AMT2                 
                                        MLNXT-OUTLYER-CANDI-IND                 
                                        MLNXT-TGT-CUM-MKUP-PCT                  
                                        MLNXT-ADJ-GRO-MRGN-AMT                  
                                        MLNXT-SEAS-INV-COST-ADJ1                
                                        MLNXT-SEAS-INV-COST-ADJ2                
                                        MLNXT-CUM-TO-DATE-PURCH-RTL             
                                        MLNXT-CUM-TO-DATE-PURCH-COST            
                                        MLNXT-LVL1-SMOOTH-IND                   
                                        MLNXT-LVL2-SMOOTH-IND                   
                                        MLNXT-LVL3-SMOOTH-IND                   
                                        MLNXT-LVL4-SMOOTH-IND.                  
                                                                                
      * SET THE NEXT BEG INVENTORY COST (BOP) TO THE END OF THIS (EOP)          
           MOVE MLADJ-END-INV-COST-AMT2                                         
               TO MLNXT-PREV-END-INV-COST-AMT.                                  
                                                                                
LY07A4* END OF SEASON?                                                          
      * IF SO, SET THE BEGINING SEASON COST TO THE END OF THIS                  
LY07A4     IF PV-CURR-FSCL-SEA-END-DTE = PV-CURR-FSCL-END-DTE                   
               MOVE MLADJ-END-INV-COST-AMT2                                     
                   TO MLNXT-BEG-SEAS-INV-COST-AMT                               
               SET PS-BEG-SEASON       TO TRUE                                  
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  GET PARTITION INFORMATION FOR A GIVEN FISCAL DATE                      
      ******************************************************************        
       3500-GET-PARTN-INFO.                                                     
                                                                                
33539      IF MLT00003-FSCL-DTE EQUAL PV-MLT00003-FSCL-DTE-SAVE AND             
33539         MLT00002-DEPT-NBR EQUAL PV-MLT00002-DEPT-NBR-SAVE                 
33539        INITIALIZE DCLTDTATTR                                              
33539        MOVE PV-SAVE-PARTN-NBR       TO MLT00003-PARTN-NBR                 
33539        MOVE PV-SAVE-DEPT-GP-CDE     TO MLT00003-DEPT-GP-CDE               
33539        MOVE PV-SAVE-FSCL-MN-NBR     TO DTATTR-FSCL-MN-NBR                 
33539        MOVE PV-SAVE-FSCL-WK-NBR     TO DTATTR-FSCL-WK-NBR                 
33539        MOVE PV-SAVE-PFM-END-DTE     TO DTATTR-PFM-END-DTE                 
33539        MOVE PV-SAVE-PFW-END-DTE     TO DTATTR-PFW-END-DTE                 
33539        MOVE PV-SAVE-FSCL-MN-END-DTE TO DTATTR-FSCL-MN-END-DTE             
33539        MOVE PV-SAVE-SEA-END-DTE     TO DTATTR-SEA-END-DTE                 
33539      ELSE                                                                 
33539        EXEC SQL                                                           
               SELECT                                                           
                       B.PARTN_NBR                                              
                      ,B.DEPT_GP_CDE                                            
                      ,D.FSCL_MN_NBR                                            
                      ,D.FSCL_WK_NBR                                            
                      ,D.PFM_END_DTE                                            
                      ,D.PFW_END_DTE                                            
LY07A4                ,D.FSCL_MN_END_DTE                                        
LY07A4                ,D.SEA_END_DTE                                            
                 INTO                                                           
                       :MLT00003-PARTN-NBR                                      
                      ,:MLT00003-DEPT-GP-CDE                                    
                      ,:DTATTR-FSCL-MN-NBR                                      
                      ,:DTATTR-FSCL-WK-NBR                                      
                      ,:DTATTR-PFM-END-DTE                                      
                      ,:DTATTR-PFW-END-DTE                                      
LY07A4                ,:DTATTR-FSCL-MN-END-DTE                                  
LY07A4                ,:DTATTR-SEA-END-DTE                                      
                 FROM                                                           
                       MLT_PARTN_CNTL  B                                        
                      ,TDTATTR         D                                        
                 WHERE                                                          
                       B.TBL_TM_LVL_CDE                                         
                           = :MLT00003-TBL-TM-LVL-CDE                           
                   AND B.FSCL_DTE = :MLT00003-FSCL-DTE                          
                   AND B.DEPT_GP_CDE IN (                                       
                         SELECT  C.DEPT_GP_CDE                                  
                           FROM  MLT_PARTN_BAL  C                               
                           WHERE C.TBL_TM_LVL_CDE                               
                                     = :MLT00003-TBL-TM-LVL-CDE                 
                             AND C.DEPT_NBR = :MLT00002-DEPT-NBR                
                             AND :MLT00003-FSCL-DTE                             
                                 BETWEEN C.EFF_BEG_DTE AND                      
                                     VALUE (C.EFF_END_DTE,                      
                                         '9999-12-30')                          
                           )                                                    
                   AND KY_DTE = :MLT00003-FSCL-DTE                              
               WITH UR                                                          
33539        END-EXEC                                                           
                                                                                
33539        EVALUATE SQLCODE                                                   
               WHEN +0                                                          
                   CONTINUE                                                     
LY07B4         WHEN +100                                                        
LY07B4             IF PS-GET-NEXT-PARTN-INFO                                    
LY07B4                 MOVE ZEROES        TO MLT00003-PARTN-NBR                 
LY07B4                                       MLT00003-DEPT-GP-CDE               
LY07B4                                       DTATTR-FSCL-MN-NBR                 
LY07B4                                       DTATTR-FSCL-WK-NBR                 
LY07B4                 MOVE SPACES        TO DTATTR-PFM-END-DTE                 
LY07B4                                       DTATTR-PFW-END-DTE                 
LY07B4                                       DTATTR-FSCL-MN-END-DTE             
LY07B4                                       DTATTR-SEA-END-DTE                 
LY07B4             ELSE                                                         
LY07B4                 DISPLAY ' TABLE LEVEL: ' MLT00003-TBL-TM-LVL-CDE         
LY07B4                         ' FISCAL DATE: ' MLT00003-FSCL-DTE               
LY07B4                 MOVE 'SELECT CURR PARTN_CNTL'                            
LY07B4                     TO PV-DB2-OPER-ATTEMPTED                             
LY07B4                 MOVE '3500-GET-PARTN-INFO ' TO PV-PARAGRAPH-NAME         
LY07B4                 PERFORM 9950-SQL-ABEND                                   
LY07B4             END-IF                                                       
               WHEN OTHER                                                       
                   DISPLAY ' TABLE LEVEL: ' MLT00003-TBL-TM-LVL-CDE             
                           ' FISCAL DATE: ' MLT00003-FSCL-DTE                   
LY07B4             IF PS-GET-CURR-PARTN-INFO                                    
LY07B4                 MOVE 'SELECT CURR PARTN_CNTL'                            
LY07B4                     TO PV-DB2-OPER-ATTEMPTED                             
LY07B4             ELSE                                                         
LY07B4                 MOVE 'SELECT NEXT PARTN_CNTL'                            
LY07B4                     TO PV-DB2-OPER-ATTEMPTED                             
LY07B4             END-IF                                                       
                   MOVE '3500-GET-PARTN-INFO ' TO PV-PARAGRAPH-NAME             
                   PERFORM 9950-SQL-ABEND                                       
33539        END-EVALUATE                                                       
33539                                                                           
33539        MOVE MLT00003-FSCL-DTE TO PV-MLT00003-FSCL-DTE-SAVE                
33539        MOVE MLT00002-DEPT-NBR TO PV-MLT00002-DEPT-NBR-SAVE                
33539                                                                           
33539        MOVE MLT00003-PARTN-NBR     TO PV-SAVE-PARTN-NBR                   
33539        MOVE MLT00003-DEPT-GP-CDE   TO PV-SAVE-DEPT-GP-CDE                 
33539        MOVE DTATTR-FSCL-MN-NBR     TO PV-SAVE-FSCL-MN-NBR                 
33539        MOVE DTATTR-FSCL-WK-NBR     TO PV-SAVE-FSCL-WK-NBR                 
33539        MOVE DTATTR-PFM-END-DTE     TO PV-SAVE-PFM-END-DTE                 
33539        MOVE DTATTR-PFW-END-DTE     TO PV-SAVE-PFW-END-DTE                 
33539        MOVE DTATTR-FSCL-MN-END-DTE TO PV-SAVE-FSCL-MN-END-DTE             
33539        MOVE DTATTR-SEA-END-DTE     TO PV-SAVE-SEA-END-DTE                 
33539                                                                           
33539      END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
      *  GET THE NEXT FISCAL END DATE FROM DATE ATTRIBUTES                      
      ******************************************************************        
       3550-GET-NEXT-FSCL-DTE.                                                  
                                                                                
33539      IF PV-CURR-FSCL-END-DTE EQUAL PV-CURR-FSCL-END-DTE-SAVE AND          
33539         MLT00002-DEPT-NBR EQUAL PV-MLT00002-DEPT-NBR-SAVE                 
33539        INITIALIZE DCLTDTATTR                                              
33539        MOVE PV-DTATTR-FSCL-MN-END-DTE TO DTATTR-FSCL-MN-END-DTE           
33539        MOVE PV-DTATTR-FSCL-MN-NBR     TO DTATTR-FSCL-MN-NBR               
33539        MOVE PV-DTATTR-FSCL-WK-END-DTE TO DTATTR-FSCL-WK-END-DTE           
33539        MOVE PV-DTATTR-FSCL-WK-NBR     TO DTATTR-FSCL-WK-NBR               
33539        IF PV-CC-WEEKLY-TABLE                                              
33539          MOVE DTATTR-FSCL-WK-END-DTE   TO MLT00003-FSCL-DTE               
33539                                           MLNXT-FSCL-END-DTE              
33539          MOVE DTATTR-FSCL-WK-NBR       TO MLNXT-FSCL-PERIOD               
33539        ELSE                                                               
33539          IF PV-CC-MONTHLY-TABLE                                           
33539            MOVE DTATTR-FSCL-MN-END-DTE TO MLT00003-FSCL-DTE               
33539                                           MLNXT-FSCL-END-DTE              
33539            MOVE DTATTR-FSCL-MN-NBR     TO MLNXT-FSCL-PERIOD               
33539          END-IF                                                           
33539        END-IF                                                             
33539      ELSE                                                                 
33539        EXEC SQL                                                           
              SELECT                                                            
                      FSCL_MN_END_DTE                                           
                     ,FSCL_MN_NBR                                               
                     ,FSCL_WK_END_DTE                                           
                     ,FSCL_WK_NBR                                               
                INTO  :DTATTR-FSCL-MN-END-DTE                                   
                     ,:DTATTR-FSCL-MN-NBR                                       
                     ,:DTATTR-FSCL-WK-END-DTE                                   
                     ,:DTATTR-FSCL-WK-NBR                                       
                FROM  TDTATTR                                                   
                WHERE (KY_DTE - 1 DAY) = :PV-CURR-FSCL-END-DTE                  
              WITH UR                                                           
33539        END-EXEC                                                           
                                                                                
33539        IF SQLCODE = +0                                                    
               IF PV-CC-WEEKLY-TABLE                                            
                   MOVE DTATTR-FSCL-WK-END-DTE     TO MLT00003-FSCL-DTE         
                                                      MLNXT-FSCL-END-DTE        
                   MOVE DTATTR-FSCL-WK-NBR         TO MLNXT-FSCL-PERIOD         
               ELSE                                                             
                   IF PV-CC-MONTHLY-TABLE                                       
                       MOVE DTATTR-FSCL-MN-END-DTE TO MLT00003-FSCL-DTE         
                                                      MLNXT-FSCL-END-DTE        
                       MOVE DTATTR-FSCL-MN-NBR     TO MLNXT-FSCL-PERIOD         
                   END-IF                                                       
               END-IF                                                           
33539        ELSE                                                               
               DISPLAY ' KEY-DATE - 1 DAY: ' PV-CURR-FSCL-END-DTE               
               MOVE 'SELECT DTATTR       ' TO PV-DB2-OPER-ATTEMPTED             
               MOVE '3550-GET-NEXT-FSCL-DTE' TO PV-PARAGRAPH-NAME               
               PERFORM 9950-SQL-ABEND                                           
33539        END-IF                                                             
33539                                                                           
33539        MOVE PV-CURR-FSCL-END-DTE   TO PV-CURR-FSCL-END-DTE-SAVE           
33539                                                                           
33539        MOVE DTATTR-FSCL-MN-END-DTE TO PV-DTATTR-FSCL-MN-END-DTE           
33539        MOVE DTATTR-FSCL-MN-NBR     TO PV-DTATTR-FSCL-MN-NBR               
33539        MOVE DTATTR-FSCL-WK-END-DTE TO PV-DTATTR-FSCL-WK-END-DTE           
33539        MOVE DTATTR-FSCL-WK-NBR     TO PV-DTATTR-FSCL-WK-NBR               
33539                                                                           
           END-IF.                                                              
                                                                                
      ******************************************************************        
      * READ THE COMMON RECALC INPUT EXTRACT                                    
      ******************************************************************        
       8000-READ-INPUT.                                                         
                                                                                
           READ COMMON-RECALC-IN-FILE INTO ML070-COMMON-RECALC-EXTRACT          
               AT END                                                           
                   SET PS-COMMON-RECALC-IN-EOF TO TRUE.                         
                                                                                
                                                                                
      ******************************************************************        
      * READ THE CONTROL CARD                                                   
      ******************************************************************        
       8100-READ-CONTROL.                                                       
                                                                                
           READ EXECUTION-CONTROL-FILE INTO PV-CC-OPTIONAL-CONTROL              
               AT END                                                           
                   SET PS-EXEC-CONTROL-EOF TO TRUE.                             
                                                                                
      ******************************************************************        
      * WRITE/GENERATE THE CORRECT/CURRENT RECALC EXTRACT                       
      ******************************************************************        
       8400-WRITE-COMMON-RECALC-OUT.                                            
                                                                                
           WRITE COMMON-RECALC-OUT-REC FROM MLADJ-COMMON-RECALC-EXTRACT.        
                                                                                
           ADD +1 TO PA-RECORD-OUT-CNT.                                         
                                                                                
      ******************************************************************        
      * WRITE/GENERATE THE FORWARD RECALC ADJUSTMENT EXTRACT                    
      ******************************************************************        
       8450-WRITE-COMMON-RECALC-FWD.                                            
                                                                                
           WRITE COMMON-RECALC-FWD-REC FROM MLNXT-COMMON-RECALC-EXTRACT.        
                                                                                
           ADD +1 TO PA-RECORD-FWD-CNT.                                         
                                                                                
      ******************************************************************        
      * WRITE/GENERATE THE CSV REPORT OF THE ADJUSTMENTS                        
      ******************************************************************        
       8500-WRITE-ADJUST-RPT.                                                   
                                                                                
           IF PA-RECORD-RPT-CNT = 0                                             
               WRITE ADJUST-RPT-REC     FROM PT-DETAIL-OUT-HEADER               
               ADD +1 TO PA-RECORD-RPT-CNT                                      
           END-IF.                                                              
                                                                                
           WRITE ADJUST-RPT-REC FROM PT-DETAIL-OUT-REC.                         
                                                                                
           ADD +1 TO PA-RECORD-RPT-CNT.                                         
                                                                                
      ******************************************************************        
      *  PERFORM THE NECESSARY END PROCESSING STEPS                             
      ******************************************************************        
       9000-END-PROCESSING.                                                     
                                                                                
LY07C4     IF PA-RECORD-ACCEPTED > 0                                            
               PERFORM 2025-CHECK-REMAINING                                     
           END-IF.                                                              
                                                                                
           CLOSE EXECUTION-CONTROL-FILE                                         
                 COMMON-RECALC-IN-FILE                                          
                 COMMON-RECALC-OUT-FILE                                         
                 COMMON-RECALC-FWD-FILE                                         
                 ADJUST-RPT-FILE.                                               
                                                                                
           DISPLAY '*************************************************'          
           DISPLAY ' RECORD IN:      ' PA-RECORD-IN-CNT.                        
           DISPLAY ' HEADER RECORDS: ' PA-RECORD-IGNORED.                       
LY07C4     DISPLAY ' DETAIL RECORDS: ' PA-RECORD-ACCEPTED.                      
33539 ***  DISPLAY ' REPORT RECORD:  ' PA-RECORD-RPT-CNT.                       
           DISPLAY ' ADJUST RECORD:  ' PA-RECORD-OUT-CNT.                       
           DISPLAY ' FORWARD RECORD: ' PA-RECORD-FWD-CNT.                       
           DISPLAY ' '.                                                         
           DISPLAY ' BRAND VENDOR NOT FOUND: ' PA-BRND-VND-NOT-FOUND.           
           DISPLAY ' PARTITION INFO MISMATCH ' PA-PARTN-MISMATCH.               
           DISPLAY ' DKEY NOT FOUND:         ' PA-DKEY-NOT-FOUND.               
           DISPLAY ' BRAND NAME NOT FOUND:   ' PA-BRND-NOT-FOUND.               
           DISPLAY ' VENDOR NAME NOT FOUND:  ' PA-VNDR-NOT-FOUND.               
           DISPLAY '*************************************************'.         
                                                                                
                                                                                
      ***************************************************************           
      *    SQL ABEND PROCESSING                                     *           
      ***************************************************************           
       9950-SQL-ABEND.                                                          
                                                                                
           DISPLAY '** OPERATION = ' PV-DB2-OPER-ATTEMPTED.                     
                                                                                
           COPY DPPD004.                                                        
                                                                                
           SET SQL-ABEND       TO TRUE.                                         
           PERFORM 9999-OTHER-ABEND.                                            
                                                                                
                                                                                
      ***************************************************************           
      *    ISSUE THE ACTUAL ABEND CALL                              *           
      ***************************************************************           
       9999-OTHER-ABEND.                                                        
                                                                                
           DISPLAY '**  ABEND     **'.                                          
           DISPLAY '**  PROGRAM   = ' PC-PROGRAM-NAME.                          
           DISPLAY '**  PARAGRAPH  = ' PV-PARAGRAPH-NAME.                       
           DISPLAY '************************************************'.          
           CALL 'ILBOABN0' USING ABEND-CODE.                                    
