000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300 PROGRAM-ID.             SUKUT945.                                00030000
000400 AUTHOR.                 DENISE HAHN.                             00040000
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050000
000600 DATE-WRITTEN.           SEPTEMBER, 2013.                         00060000
000700 DATE-COMPILED.                                                   00070000
000800***************************************************************** 00080000
000900*  ONE TIME PROGRAM TO EXTRACT TUPLDER RECORDS                  * 00090000
001000*                                                               * 00100000
001100*  MACON DC CHANGED THE CONVEYOR BUT NOT IN CICS                * 00110000
001200*  THIS PROGRAM WILL EXTRACT THE MISSING DIVERTS                * 00120000
001300*                                                               * 00130000
001310*  900+ CARTONS KICKED OUT                                      * 00140000
001320*  THE FILE GENERATED FROM THIS PROGRAM WILL BE FED INTO        * 00150000
001321*  SUKUT945 TO GENERATE SQL INSERT STATEMENTS INTO TSUCRDV      * 00160000
001322*                                                               * 00170000
001323***************************************************************** 00180000
001324 ENVIRONMENT DIVISION.                                            00190000
001325 CONFIGURATION SECTION.                                           00200000
001326                                                                  00210000
001327 SOURCE-COMPUTER.        IBM-3090.                                00220000
001328 OBJECT-COMPUTER.        IBM-3090.                                00230000
001329                                                                  00240000
001330***************************************************************** 00250000
001331 INPUT-OUTPUT SECTION.                                            00260000
001332                                                                  00270000
001333 FILE-CONTROL.                                                    00280000
001334                                                                  00290000
001335     SELECT UPLDER-FILE                                           00300000
001336         ASSIGN TO OUT01.                                         00310000
001337                                                                  00320000
001338***************************************************************** 00330000
001339 DATA DIVISION.                                                   00340000
001340***************************************************************** 00350000
001341 FILE SECTION.                                                    00360000
001350                                                                  00370000
001360 FD  UPLDER-FILE                                                  00380001
001370     RECORDING MODE IS F                                          00390000
001380     BLOCK CONTAINS 0  RECORDS.                                   00400000
001390 01  UPLDER-RECORD                   PIC X(160).                  00410001
001400                                                                  00420000
001500***************************************************************** 00430000
001600 WORKING-STORAGE SECTION.                                         00440000
001700                                                                  00450000
001800 01  PROGRAM-SWITCHES.                                            00460000
001900     05  PS-EOF-DRIVING-CSR-SW       PIC X(01) VALUE 'N'.         00470000
002000         88  PS-EOF-DRIVING-CSR                VALUE 'Y'.         00480000
002100         88  PS-NOT-EOF-DRIVING-CSR            VALUE 'N'.         00490000
002200                                                                  00500000
002300     05  PS-EOF-DVRT-CSR-SW          PIC X(01) VALUE 'N'.         00510000
002400         88  PS-EOF-DVRT-CSR                   VALUE 'Y'.         00520000
002500         88  PS-NOT-EOF-DVRT-CSR               VALUE 'N'.         00530000
002600                                                                  00540000
002700 01  PC-PROGRAM-CONSTANTS.                                        00550000
002800     05  PC-SUKUT945                 PIC X(08) VALUE              00560000
002900                                               'SUKUT945'.        00570000
003000     05  PC-DEFAULT-TMST             PIC X(26)  VALUE             00580000
003100                                    '9999-09-09-09.09.09.999999'. 00590000
003200                                                                  00600000
003300                                                                  00610000
003400     05  PV-READ-COUNT                PIC 9(09)  VALUE ZERO.      00620000
003500     05  PV-READ-COUNT-2              PIC 9(09)  VALUE ZERO.      00630000
003600     05  PV-WRITE-COUNT               PIC 9(09)  VALUE ZERO.      00640000
003700                                                                  00650000
003701     05  PV-DVRT-NBR.                                             00660008
003702         10  PV-DVRT-1-5               PIC X(05).                 00670008
003703         10  PV-DVRT-6-9               PIC X(4).                  00680008
003705                                                                  00690008
003710     05  PV-WORK-DATE.                                            00700004
003720         10   PV-WORK-YY              PIC X(4).                   00710005
003740         10   PV-WORK-MM              PIC X(02).                  00720005
003760         10   PV-WORK-DD              PIC X(02).                  00730005
003770     05  PV-DATE.                                                 00740004
003772         10  PV-DATE-YEAR             PIC X(04).                  00750004
003773         10  PV-DATE-DASH1            PIC X.                      00760004
003774         10  PV-DATE-MONTH            PIC XX.                     00770006
003775         10  PV-DATE-DASH2            PIC X.                      00780006
003776         10  PV-DATE-DAY              PIC XX.                     00790006
003780                                                                  00800004
003790     05  PV-WORK-TIME.                                            00810004
003791         10  PV-WORK-HOUR             PIC XX.                     00820004
003793         10  PV-WORK-MIN              PIC XX.                     00830004
003795         10  PV-WORK-SEC              PIC XX.                     00840004
003796     05  PV-TIME.                                                 00850004
003797         10  PV-TIME-HOUR             PIC XX.                     00860004
003798         10  PV-TIME-COLON1           PIC X.                      00870004
003799         10  PV-TIME-MIN              PIC XX.                     00880004
003800         10  PV-TIME-COLON2           PIC X.                      00890006
003801         10  PV-TIME-SEC              PIC XX.                     00900004
003802                                                                  00910004
003810     05  PV-SQLCODE                  PIC 9(09) VALUE ZERO.        00920000
003900     05  PV-DISP-SQLCODE             PIC -999.                    00930000
003910                                                                  00940001
004100                                                                  00950000
004200 01  PV-ABEND-FIELDS.                                             00960000
004300     05  PV-ABEND-CODE               PIC S9(4) VALUE +0           00970000
004400                                               COMP SYNC.         00980000
004500     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'SUKUT945'.  00990000
004600     05  PV-ABEND-PARAGRAPH          PIC X(50) VALUE SPACES.      01000000
004700     05  PV-ABEND-OPERATION          PIC X(50) VALUE SPACES.      01010000
004800     05  PV-ABEND-STRUCTURE-1        PIC X(08) VALUE SPACES.      01020000
004900     05  PV-DB2-OPERATION-MESSAGE-1  PIC X(79) VALUE SPACES.      01030000
005000     05  PV-DB2-OPERATION-MESSAGE-2  PIC X(79) VALUE SPACES.      01040000
005100     05  PV-DB2-OPERATION-MESSAGE-3  PIC X(79) VALUE SPACES.      01050000
005200     05  PV-DB2-OPERATION-MESSAGE-4  PIC X(79) VALUE SPACES.      01060000
005300     05  PV-DB2-TABLE-NAME-1         PIC X(08) VALUE SPACES.      01070000
005400     05  PV-DB2-TABLE-NAME-2         PIC X(08) VALUE SPACES.      01080000
005500                                                                  01090000
005600     05  PV-DISPLAY-OPER             PIC  9(04) VALUE ZEROES.     01100000
005700     05  PV-DISPLAY-SQLCODE          PIC  9(03)- VALUE ZEROES.    01110000
005800     05  PV-DB2-TABLE-NAME1          PIC  X(15) VALUE SPACES.     01120000
005900                                                                  01130000
006000     05  PV-DISPLAY-READ-COUNT1      PIC ZZZ,ZZZ,ZZ9.             01140000
006100     05  PV-DISPLAY-WRITE-COUNT      PIC ZZZ,ZZZ,ZZ9.             01150000
006200 01  DK-DB-KEYS.                                                  01160000
006300     05  DK-SHIPT-UNT-ID             PIC S9(18)V COMP-3.          01170000
006400     05  DK-OPER                     PIC S9(04) COMP.             01180000
006500     05  DK-DIVERT-TMST              PIC  X(26).                  01190000
006600                                                                  01200000
006700                                                                  01210000
006800******************************************************************01220000
006900* OUTPUT RECORD LAYOUT                                            01230000
007000******************************************************************01240000
007100     COPY SURD945.                                                01250001
007200                                                                  01260000
007300******************************************************************01270000
007400*  USED FOR DB2 ERROR MESSAGE BUILDING                            01280000
007500******************************************************************01290000
007600     COPY DPWS004.                                                01300000
007700                                                                  01310000
007800******************************************************************01320000
007900*   DB2 SQL COMMUNICATION AREA                                    01330000
008000******************************************************************01340000
008100     EXEC SQL                                                     01350000
008200          INCLUDE SQLCA                                           01360000
008300     END-EXEC.                                                    01370000
008400                                                                  01380000
008500                                                                  01390000
008600*---------------------------------------------------------------* 01400000
008700*  TSUCRDV                                                        01410000
008800*---------------------------------------------------------------* 01420000
008900     EXEC SQL                                                     01430000
009000          INCLUDE TUPLDER                                         01440001
009100     END-EXEC.                                                    01450000
009200                                                                  01460000
009300*---------------------------------------------------------------* 01470000
009400*  THIS CURSOR BRINGS BACK THE DIVERTS WE WANT TO KEEP            01480000
009500*---------------------------------------------------------------* 01490000
009600                                                                  01500000
009700     EXEC SQL                                                     01510000
009800          DECLARE DRIVING_CSR CURSOR FOR                          01520000
009900           SELECT                                                 01530001
010100                  SUBSTR(PKT_TXT,1,4)                             01540001
010110                , SUBSTR(PKT_TXT,35,4)                            01550001
010120                , SUBSTR(PKT_TXT,39,4)                            01560001
010130                , PRC_TMST                                        01570001
010300                , SUBSTR(PKT_TXT,13,22)                           01580001
010400                , ' '                                             01590001
010500                , SUBSTR(PKT_TXT,15,18)                           01600004
010510                , '00000000       '                               01610009
010520                , '   0'                                          01620009
010530                , 'A'                                             01630001
010540                , ' '                                             01640001
010550                , '147 '                                          01650010
010560                , '0829'                                          01660010
010600                , SUBSTR(PKT_TXT,43,8)                            01670001
010700                , SUBSTR(PKT_TXT,51,6)                            01680001
010800            FROM TUPLDER                                          01690003
010900           WHERE OPER_UNT_ID  = 860                               01700010
011000             AND UPLD_TRN_CDE = 'B'                               01710001
011200             AND (SUBSTR(PKT_TXT,39,3) = 'Eco'                    01720011
                   OR   SUBSTR(PKT_TXT,39,3) = '147')                   01730010
011800           WITH UR                                                01740000
011900                                                                  01750000
012000     END-EXEC.                                                    01760000
012100                                                                  01770000
014600******************************************************************01780000
014700 PROCEDURE DIVISION.                                              01790000
014800     DISPLAY '**** START OF SUKUT945 ****'.                       01800000
014900                                                                  01810000
015000*OPEN FILES.                                                      01820000
015100     OPEN OUTPUT UPLDER-FILE.                                     01830001
015200                                                                  01840000
015300     SET   PS-NOT-EOF-DRIVING-CSR                                 01850000
015400           PS-NOT-EOF-DVRT-CSR     TO  TRUE                       01860000
015500                                                                  01870000
015600     PERFORM 1000-INITIALIZATION.                                 01880000
015700                                                                  01890000
015800     PERFORM 2000-PROCESS-INPUT                                   01900000
015900       UNTIL PS-EOF-DRIVING-CSR.                                  01910000
016000                                                                  01920000
016100     PERFORM 4030-CLOSE-DRIVING-CURSOR.                           01930000
016200                                                                  01940000
016300     DISPLAY '***'                                                01950000
016400     DISPLAY '*** INPUT COUNT:  ' PV-READ-COUNT                   01960000
016500     DISPLAY '*** OUTPUT COUNT: ' PV-WRITE-COUNT                  01970000
016600     DISPLAY '***'.                                               01980000
016700                                                                  01990000
016800*CLOSE FILES.                                                     02000000
016900     CLOSE UPLDER-FILE.                                           02010001
017000                                                                  02020000
017100                                                                  02030000
017200     GOBACK.                                                      02040000
017300                                                                  02050000
017400******************************************************************02060000
017500*  PERFORM THE INITIAL PROCESSING FOR THE PROGRAM.               *02070000
017600******************************************************************02080000
017700 1000-INITIALIZATION.                                             02090000
017800     DISPLAY '1000-INITIALIZE '.                                  02100000
017900                                                                  02110000
018000     PERFORM 4000-OPEN-DRIVING-CURSOR.                            02120000
018100     PERFORM 4010-FETCH-DRIVING-CURSOR.                           02130000
018200                                                                  02140000
018300                                                                  02150000
018400******************************************************************02160000
018500**  READ INPUT-FILE, WHEN DC CHANGES, DO A PAGE BREAK             02170000
018600******************************************************************02180000
018700 2000-PROCESS-INPUT.                                              02190000
018800                                                                  02200000
019000                                                                  02210000
019100     PERFORM 8000-WRITE-OUTPUT-RECORD                             02220001
019300                                                                  02230000
019500                                                                  02240000
019600     PERFORM 4010-FETCH-DRIVING-CURSOR.                           02250000
019700                                                                  02260000
019800                                                                  02270000
021100                                                                  02280000
021200                                                                  02290000
021300                                                                  02300000
021400*---------------------------------------------------------------- 02310000
021500*                                                                 02320000
021600*---------------------------------------------------------------- 02330000
021700 4000-OPEN-DRIVING-CURSOR.                                        02340000
021800                                                                  02350000
021900         EXEC SQL                                                 02360000
022000              OPEN DRIVING_CSR                                    02370000
022100         END-EXEC                                                 02380000
022200                                                                  02390000
022300         MOVE SQLCODE  TO  PV-DISP-SQLCODE                        02400000
022400                                                                  02410000
022500         EVALUATE TRUE                                            02420000
022600             WHEN SQLWARN0 NOT = SPACES                           02430000
022700             WHEN SQLCODE < ZERO                                  02440000
022800             WHEN SQLCODE > ZERO                                  02450000
022900                 MOVE '4000-OPEN-DRIVING-CURSOR  '                02460000
023000                                 TO PV-ABEND-PARAGRAPH            02470000
023100                 MOVE 'OPEN THE TRIP_CSR     '                    02480000
023200                                 TO PV-ABEND-OPERATION            02490000
023300                 PERFORM 9900-DB2-ABEND                           02500000
023400             WHEN SQLCODE = ZERO                                  02510000
023500             WHEN SQLCODE = +100                                  02520000
023600                 CONTINUE                                         02530000
023700         END-EVALUATE.                                            02540000
023800                                                                  02550000
023900                                                                  02560000
024000*---------------------------------------------------------------- 02570000
024100*                                                                 02580000
024200*---------------------------------------------------------------- 02590000
024300 4010-FETCH-DRIVING-CURSOR.                                       02600000
024400                                                                  02610000
024500     INITIALIZE SU945-UPLDER-RECORD.                              02620001
024600                                                                  02630000
024700     SET  PS-NOT-EOF-DVRT-CSR  TO  TRUE.                          02640000
024800                                                                  02650000
024900     EXEC SQL                                                     02660000
025000          FETCH DRIVING_CSR                                       02670000
025100           INTO                                                   02680000
025200                :SU945-OPER-UNT-ID                                02690001
025300              , :SU945-DIVERT-NBR                                 02700001
025400              , :SU945-DIVERT-LOC-ID                              02710001
025410              , :SU945-DIVERT-TMST                                02720001
025420              , :SU945-BRCDE-NBR                                  02730001
025430              , :SU945-PRC-RSN-CDE                                02740001
025440              , :SU945-SHIPT-UNT-ID                               02750001
025450              , :SU945-BTCH-NBR                                   02760001
025460              , :SU945-BTCH-RVSN-NBR                              02770001
025470              , :SU945-ACTV-CDE                                   02780001
025480              , :SU945-NACTV-USR-ID                               02790001
025490              , :SU945-DOOR-ID                                    02800001
025491              , :SU945-DEST-OPER-UNT-ID                           02810001
025492              , :SU945-DIVERT-SYS-DTE                             02820001
025493              , :SU945-DIVERT-SYS-TM                              02830001
025510     END-EXEC.                                                    02840001
025600                                                                  02850000
025700     EVALUATE TRUE                                                02860000
025800         WHEN SQLCODE = ZERO                                      02870000
025900              ADD  1  TO  PV-READ-COUNT                           02880000
026000              ADD  1  TO  PV-READ-COUNT-2                         02890000
026100                                                                  02900000
026200              IF  PV-READ-COUNT-2  > 49                           02910000
026300                  MOVE  PV-READ-COUNT  TO  PV-DISPLAY-READ-COUNT1 02920000
026400                  MOVE  PV-WRITE-COUNT TO  PV-DISPLAY-WRITE-COUNT 02930000
026500                  DISPLAY 'READ:'   PV-DISPLAY-READ-COUNT1        02940000
026600                          '   '                                   02950000
026700                          'WRITE:'  PV-DISPLAY-WRITE-COUNT        02960000
026800                  MOVE 0  TO PV-READ-COUNT-2                      02970000
026900              END-IF                                              02980000
027000                                                                  02990000
027002              MOVE ZEROES                TO PV-DVRT-1-5           03000008
027003              MOVE SU945-DIVERT-NBR      TO PV-DVRT-6-9           03010008
027004              MOVE PV-DVRT-NBR           TO SU945-DIVERT-NBR      03020008
                    IF PV-DVRT-6-9 = '0046'                             03030010
                       CONTINUE                                         03040010
                    ELSE                                                03050010
                       MOVE '149 ' TO SU945-DOOR-ID                     03060010
                    END-IF                                              03070010
027005                                                                  03080008
027010              MOVE SU945-DIVERT-SYS-DTE  TO PV-WORK-DATE          03090004
027020              MOVE PV-WORK-YY            TO PV-DATE-YEAR          03100004
027030              MOVE '-'                   TO PV-DATE-DASH1         03110004
027040              MOVE PV-WORK-MM            TO PV-DATE-MONTH         03120004
027050              MOVE '-'                   TO PV-DATE-DASH2         03130006
027060              MOVE PV-WORK-DD            TO PV-DATE-DAY           03140004
027070              MOVE PV-DATE               TO SU945-DIVERT-SYS-DTE  03150004
027080                                                                  03160004
027090              MOVE SU945-DIVERT-SYS-TM   TO PV-WORK-TIME          03170004
027091              MOVE PV-WORK-HOUR          TO PV-TIME-HOUR          03180004
027092              MOVE ':'                   TO PV-TIME-COLON1        03190004
027093              MOVE PV-WORK-MIN           TO PV-TIME-MIN           03200004
027094              MOVE ':'                   TO PV-TIME-COLON2        03210006
027095              MOVE PV-WORK-SEC           TO PV-TIME-SEC           03220004
027096              MOVE PV-TIME               TO SU945-DIVERT-SYS-TM   03230004
027097                                                                  03240004
027100         WHEN SQLCODE = +100                                      03250000
027200             SET PS-EOF-DRIVING-CSR TO TRUE                       03260000
027300         WHEN SQLWARN0 NOT = SPACES                               03270000
027400         WHEN SQLCODE < ZERO                                      03280000
027500         WHEN SQLCODE > ZERO                                      03290000
027600             MOVE '4010-FETCH-DRIVING-CURSOR'                     03300000
027700                                 TO PV-ABEND-PARAGRAPH            03310000
027800             MOVE 'FETCH THE TRIP_CSR    '                        03320000
027900                                 TO PV-ABEND-OPERATION            03330000
028000             PERFORM 9900-DB2-ABEND                               03340000
028100     END-EVALUATE.                                                03350000
028200                                                                  03360000
028300                                                                  03370000
028400*---------------------------------------------------------------- 03380000
028500*                                                                 03390000
028600*---------------------------------------------------------------- 03400000
028700 4030-CLOSE-DRIVING-CURSOR.                                       03410000
028800                                                                  03420000
028900         EXEC SQL                                                 03430000
029000              CLOSE DRIVING_CSR                                   03440000
029100         END-EXEC                                                 03450000
029200                                                                  03460000
029300         EVALUATE TRUE                                            03470000
029400             WHEN SQLWARN0 NOT = SPACES                           03480000
029500             WHEN SQLCODE < ZERO                                  03490000
029600             WHEN SQLCODE > ZERO                                  03500000
029700                 MOVE '4030-CLOSE-DRIVING-CURSOR       '          03510000
029800                                 TO PV-ABEND-PARAGRAPH            03520000
029900                 MOVE 'CLOSE THE TRIP_CSR     '                   03530000
030000                                 TO PV-ABEND-OPERATION            03540000
030100                 PERFORM 9900-DB2-ABEND                           03550000
030200             WHEN SQLCODE = ZERO                                  03560000
030300                 CONTINUE                                         03570000
030400         END-EVALUATE.                                            03580000
030500                                                                  03590000
030600                                                                  03600000
038700                                                                  03610000
038800******************************************************************03620000
038900*                                                                *03630000
039000******************************************************************03640000
039100 8000-WRITE-OUTPUT-RECORD.                                        03650000
039200                                                                  03660000
039300     WRITE UPLDER-RECORD                                          03670001
039400      FROM SU945-UPLDER-RECORD.                                   03680001
039500     ADD +1 TO PV-WRITE-COUNT.                                    03690000
039600                                                                  03700000
039700                                                                  03710000
039800******************************************************************03720000
039900*  ABEND ROUTINE                                                 *03730000
040000******************************************************************03740000
040100 9900-DB2-ABEND.                                                  03750000
040200                                                                  03760000
040300     MOVE SQLCODE TO PV-SQLCODE.                                  03770000
040400     DISPLAY '*** DB2 ERROR '.                                    03780000
040500     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       03790000
040600     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 03800000
040700     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               03810000
040800     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               03820000
040900     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       03830000
041000     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       03840000
041100     DISPLAY '*** TABLE 1   = ' PV-DB2-TABLE-NAME-1.              03850000
041200     DISPLAY '*** TABLE 2   = ' PV-DB2-TABLE-NAME-2.              03860000
041300                                                                  03870000
041400     COPY DPPD004.                                                03880000
041500                                                                  03890000
041600     MOVE +4013 TO PV-ABEND-CODE.                                 03900000
041700     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         03910000
041800                                                                  03920000
041900 9999-ABEND.                                                      03930000
042000                                                                  03940000
042100     DISPLAY '***************'.                                   03950000
042200     DISPLAY '** ABEND     **'.                                   03960000
042300     DISPLAY '** PROGRAM   ** = ' PV-ABEND-PROGRAM.               03970000
042400     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             03980000
042500     DISPLAY '***************'.                                   03990000
042600                                                                  04000000
042700     MOVE +4008                  TO PV-ABEND-CODE.                04010000
042800     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         04020000
042900                                                                  04030000
043000******************************************************************04040000
043100*                 E N D   O F   P R O G R A M                    *04050000
043200******************************************************************04060000
