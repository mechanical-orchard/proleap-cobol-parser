000100 IDENTIFICATION DIVISION.                                         00010099
000200 PROGRAM-ID.    POKCS108.                                         00020099
000300 AUTHOR.        SUE BARTELT.                                      00030099
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040099
000500 DATE-WRITTEN.  03-15-00.                                         00050099
000600 DATE-COMPILED.                                                   00060099
000700                                                                  00070099
000800*---------------------------------------------------------------* 00080099
000900*    W108 - PURCHASE ORDER PACK SUMMARY                         * 00090099
001000*                                                               * 00100099
001100*    THIS PROGRAM SHOWS THE PACK DATA FOR THE ENTIRE PO.        * 00110099
001200*    THE USER CAN SELECT A SPECIFIC LINE TO INQUIRE ON IT BY    * 00120099
001300*    "INNER" DETAIL OR "MULTI" DETAIL. THE USER CAN ALSO TOGGLE * 00130099
001400*    TO THE ALLOCATION SCREEN.                                  * 00140099
001500*    THIS PROGRAM IS A COPY OF POKCS034 WITH MODIFICATIONS.     * 00150099
001600*---------------------------------------------------------------* 00160099
001700* DATE     WHO      DESCRIPTION                                   00170099
001800* 11/18/13 TKMAKZD  COMMENTED OUT THE MULTIPACK PROGRAM CALL      00180099
001900*                   FOR MULTI PACKS. CHANGE TAG : P5207           00190099
002000*                                           CR# : CHG0081355      00200099
002100*---------------------------------------------------------------* 00210099
002200* 11/11/14 TKMA394  EXPANDED PO NUMBER TO 8 DIGITS IN MAP AND     00220099
002300*                   COMMAREA.        CHANGE TAG : C98147          00230099
002400*                                           CR# : CHG0098147      00240099
002500*---------------------------------------------------------------* 00250099
002510* DATE  10/27/2021                                                00251099
002520*            - CHANGE CALL OF 'DPKUT100' TO                     * 00252099
002530*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00253099
002540*              MAKING THE CALL DYNAMIC VS STATIC                * 00254099
002550*     MADE BY: GERMAN BANDA            WR/IR #: CHG0263126        00255099
002560*                                                               * 00256099
002570*---------------------------------------------------------------* 00257099
CICS  *  CHANGED 11/16/2022    BY BARB SCHULTZ    WR: CHG0278485      * 00257199
CICS  *                                                               * 00257299
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00257399
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00257499
002570*---------------------------------------------------------------* 00257799
002580                                                                  00258099
002590/                                                                 00259099
002600 ENVIRONMENT DIVISION.                                            00260099
002700                                                                  00270099
002800 DATA DIVISION.                                                   00280099
002900                                                                  00290099
003000 WORKING-STORAGE SECTION.                                         00300099
003100                                                                  00310099
003200 01  DK-DB2-KEYS.                                                 00320099
003300     05  DK-PO-NBR                 PIC S9(9) COMP VALUE +0.       00330099
003400     05  DK-PO-LNE-NBR             PIC S9(9) COMP VALUE +0.       00340099
003500     05  DK-ENT-ID                 PIC S9(9) COMP VALUE +0.       00350099
003600     05  DK-DEPT-NBR               PIC X(03) VALUE SPACES.        00360099
003700                                                                  00370099
003800 01  PC-PROGRAM-CONSTANTS.                                        00380099
003900     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00390099
004000                                                    'PO108A  '.   00400099
004100     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00410099
004200                                                    'POKM108 '.   00420099
004300     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00430099
004400                                                    'POKCS108'.   00440099
004500     05  PC-APPL-MAP                    PIC S9(04)  VALUE  +1     00450099
004600                                                    COMP.         00460099
004700     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00470099
004800     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00480099
004900     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00490099
005000     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +13     00500099
005100                                                    COMP SYNC.    00510099
005200     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00520099
005300                                                    COMP SYNC.    00530099
005400     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00540099
005500                                                    +1000000      00550099
005600                                                    COMP-3.       00560099
005700     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00570099
005800                                                    COMP SYNC.    00580099
005900     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      00590099
006000                                                    COMP-3.       00600099
006100     05  PC-MAX-RETRIES-2               PIC S9(03)  VALUE +2      00610099
006200                                                    COMP-3.       00620099
006300     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00630099
006400     05  PC-MIN-UPC                     PIC S9(15)V               00640099
006500                                         VALUE +000400000000000   00650099
006600                                                   COMP-3.        00660099
006700     05  PC-MAX-UPC                     PIC S9(15)V               00670099
006800                                         VALUE +000409999999999   00680099
006900                                                   COMP-3.        00690099
007000     05  PC-TSYMSG-NUMBERS.                                       00700099
007100         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00710099
007200         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00720099
007300         10  PC-TSYMSG-00017            PIC  9(05)  VALUE 00017.  00730099
007400         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  00740099
007500         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00750099
007600         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00760099
007700         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00770099
007800         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00780099
007900         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00790099
008000         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00800099
008100         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00810099
008200         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00820099
008300         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00830099
008400         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00840099
008500         10  PC-TSYMSG-00168            PIC  9(05)  VALUE 00168.  00850099
008600         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00860099
008700         10  PC-TSYMSG-00310            PIC  9(05)  VALUE 00310.  00870099
008800         10  PC-TSYMSG-00330            PIC  9(05)  VALUE 00330.  00880099
008900         10  PC-TSYMSG-00461            PIC  9(05)  VALUE 00461.  00890099
009000         10  PC-TSYMSG-00486            PIC  9(05)  VALUE 00486.  00900099
009100         10  PC-TSYMSG-00587            PIC  9(05)  VALUE 00587.  00910099
009200         10  PC-TSYMSG-00588            PIC  9(05)  VALUE 00588.  00920099
009300         10  PC-TSYMSG-00778            PIC  9(05)  VALUE 00778.  00930099
009400         10  PC-TSYMSG-01773            PIC  9(05)  VALUE 01773.  00940099
009500         10  PC-TSYMSG-02761            PIC  9(05)  VALUE 02761.  00950099
009600                                                                  00960099
009700 01  PS-PROGRAM-SWITCHES.                                         00970099
009800     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00980099
009900         88  PS-NO-ERROR                            VALUE 'Y'.    00990099
010000         88  PS-ERROR                               VALUE 'N'.    01000099
010100     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01010099
010200         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01020099
010300         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01030099
010400     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01040099
010500         88  PS-DONE                                VALUE 'Y'.    01050099
010600         88  PS-NOT-DONE                            VALUE 'N'.    01060099
010700     05  PS-SKIP-SW                     PIC  X(01)  VALUE 'N'.    01070099
010800         88  PS-DONT-SKIP                           VALUE 'N'.    01080099
010900         88  PS-SKIP                                VALUE 'Y'.    01090099
011000                                                                  01100099
011100 01  PV-PROGRAM-VARIABLES.                                        01110099
011200     05  PV-RV-COUNT                    PIC S9(04)  COMP          01120099
011300                                                    VALUE +0.     01130099
011400     05  PV-SUB                         PIC S9(04)  VALUE +0      01140099
011500                                                    COMP SYNC.    01150099
011600     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01160099
011700                                                    COMP SYNC.    01170099
011800     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01180099
011900                                                    COMP-3.       01190099
012000     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01200099
012100                                                    COMP-3.       01210099
012200     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01220099
012300                                                    COMP-3.       01230099
012400     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01240099
012500                                                    COMP-3.       01250099
012600     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01260099
012700                                                    COMP-3.       01270099
012800     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01280099
012900                                                    COMP-3.       01290099
013000     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01300099
013100                                                    COMP-3.       01310099
013200     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01320099
013300                                                    COMP SYNC.    01330099
013400     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01340099
013500                                                    COMP SYNC.    01350099
013600     05  PV-ITEM                        PIC S9(04)  VALUE +0      01360099
013700                                                    COMP SYNC.    01370099
013800     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01380099
013900                                                    COMP SYNC.    01390099
014000     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01400099
014100                                                    COMP SYNC.    01410099
014200     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01420099
014300                                                    COMP SYNC.    01430099
014400     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01440099
014500                                                    COMP SYNC.    01450099
014600     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01460099
014700                                                    COMP SYNC.    01470099
014800     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01480099
014900                                                    COMP SYNC.    01490099
015000     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01500099
015100                                                    COMP SYNC.    01510099
015200     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01520099
015300                                                    COMP SYNC.    01530099
015400     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01540099
015500                                                    COMP SYNC.    01550099
015600     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01560099
015700                                                    COMP SYNC.    01570099
015800     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01580099
015900                                                    COMP SYNC.    01590099
016000     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01600099
016100                                                    COMP SYNC.    01610099
016200     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      01620099
016300                                                    COMP-3.       01630099
016400     05  PV-VER-QTY-NULL                PIC S9(04)  VALUE +0      01640099
016500                                                    COMP SYNC.    01650099
016600     05  PV-ASN-QTY-NULL                PIC S9(04)  VALUE +0      01660099
016700                                                    COMP SYNC.    01670099
016800     05  PV-ALLOC-NULL                  PIC S9(04)  VALUE +0      01680099
016900                                                    COMP SYNC.    01690099
017000     05  PV-ALLOC-ALLPLN-NULL           PIC S9(04)  VALUE +0      01700099
017100                                                    COMP SYNC.    01710099
017200     05  PV-PO-LNE-NBR                  PIC S9(09)  VALUE +0      01720099
017300                                                    COMP.         01730099
017400     05  PV-ASN-PO-LN-NBR               PIC S9(03)V VALUE +0      01740099
017500                                                    COMP-3.       01750099
017600     05  PV-ASN-PO-NBR                  PIC X(22)   VALUE SPACES. 01760099
017700     05  PV-ASN-PO-NBR-6                PIC X(22)   VALUE SPACES. 01770099
017800     05  PV-PO-NBR9                     PIC 9(10)   VALUE ZEROES. 01780099
017900     05  PV-UPC-NBR                     PIC 9(15).                01790099
018000     05  PV-UPC-NBR-X REDEFINES PV-UPC-NBR                        01800099
018100                                        PIC X(15).                01810099
018200     05  PV-UPC-NBR-DISPLAY             PIC X(16)   VALUE SPACES. 01820099
018300     05  PV-INNER-PACK-TOTAL            PIC 9(05).                01830099
018400     05  PV-TOT-UNT-PER-CTN             PIC 9(05)  VALUE ZEROES.  01840099
018500     05  PV-TOT-TOTAL-CRTNS             PIC 9(05)  VALUE ZEROES.  01850099
018600     05  PV-TOT-TOTAL-UNITS             PIC 9(06)  VALUE ZEROES.  01860099
018700     05  PV-TOT-INNER-PK                PIC 9(05)  VALUE ZEROES.  01870099
018800     05  PV-SUM-PREPK-RATO-QTY          PIC S9(09) VALUE +0       01880099
018900                                                   COMP.          01890099
019000     05  PV-AD-DATE-10.                                           01900099
019100         10  PV-AD-DATE-CC         PIC X(02).                     01910099
019200         10  PV-AD-DATE.                                          01920099
019300             15  PV-AD-DATE-YY     PIC X(02).                     01930099
019400             15  FILLER            PIC X(01)    VALUE '-'.        01940099
019500             15  PV-AD-DATE-MM     PIC X(02).                     01950099
019600             15  FILLER            PIC X(01)    VALUE '-'.        01960099
019700             15  PV-AD-DATE-DD     PIC X(02).                     01970099
019800     05  PV-SLASH-DATE.                                           01980099
019900         10  PV-SL-DATE.                                          01990099
020000             15  PV-SL-DATE-MM     PIC X(02).                     02000099
020100             15  FILLER            PIC X(01)    VALUE '/'.        02010099
020200             15  PV-SL-DATE-DD     PIC X(02).                     02020099
020300             15  FILLER            PIC X(01)    VALUE '/'.        02030099
020400             15  PV-SL-DATE-YY     PIC X(02).                     02040099
020500         10  PV-SL-DATE-CC         PIC X(02).                     02050099
020600         10  PV-NULL-IND           PIC S9(04)   VALUE +0 COMP.    02060099
020700*---------------------------------------------------------------* 02070099
020800*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 02080099
020900*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 02090099
021000*   APPLICATION-SPECIFIC COMMAREA.                              * 02100099
021100*---------------------------------------------------------------* 02110099
021200 01  LQW-LIST-QUEUE-WORK-AREA.                                    02120099
021300     05  LQW-BLOCK-MODIFIED             PIC X(01)   VALUE SPACE.  02130099
021400     05  LQW-ITEM-ENTRIES               OCCURS 13 TIMES           02140099
021500                                        INDEXED BY LQW-IDX.       02150099
021600         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02160099
021700         10  LQW-TEMP-SELECTED-SW       PIC X(01).                02170099
021800         10  LQW-SELECTED-SW            PIC X(01).                02180099
021900             88  LQW-SELECT                         VALUE 'S'.    02190099
022000             88  LQW-DESELECT                       VALUE ' '.    02200099
022100         10  LQW-PACK-ID                PIC 9(04).                02210099
022200         10  LQW-PACK-DESC              PIC X(27).                02220099
022500         10  LQW-STAT-CDE               PIC X(02).                02250099
022600         10  LQW-INNER-PACK             PIC 9(03).                02260099
022700         10  LQW-UNITS-PER-CTN          PIC 9(05).                02270099
022800         10  LQW-TOTAL-CRTNS            PIC 9(05).                02280099
022900         10  LQW-TOTAL-UNITS            PIC 9(06).                02290099
023000/                                                                 02300099
023100*---------------------------------------------------------------* 02310099
023200*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 02320099
023300*---------------------------------------------------------------* 02330099
023400                                                                  02340099
023500     COPY POWS012.                                                02350099
023600                                                                  02360099
023700/                                                                 02370099
023800*---------------------------------------------------------------* 02380099
023900*    MAP LAYOUT                                                 * 02390099
024000*---------------------------------------------------------------* 02400099
024100                                                                  02410099
024200     COPY POKM108.                                                02420099
024300                                                                  02430099
024400 01  MR-OCCURS-LAYOUT                   REDEFINES  PO108AO.       02440099
024500     05  FILLER                         PIC X(48).                02450099
024600                                                                  02460099
024700     05  FILLER                         PIC X(05).                02470099
024800     05  MR-PO-NBR-X.                                             02480099
024900         10  MR-PO-NBR                  PIC Z(8).                 02490099
025000                                                                  02500099
025100     05  FILLER                         PIC X(05).                02510099
025200     05  MR-PACK-TYPE                   PIC X(1).                 02520099
025300                                                                  02530099
025400     05  MR-SCROLL-AREA                 OCCURS 13 TIMES.          02540099
025500         10  MR-SELECTL                 PIC S9(04) COMP.          02550099
025600         10  MR-SELECTA                 PIC X(01).                02560099
025700         10  MR-SELECTC                 PIC X(01).                02570099
025800         10  MR-SELECTH                 PIC X(01).                02580099
025900         10  MR-SELECT                  PIC X(01).                02590099
026000                                                                  02600099
026100         10  FILLER                     PIC X(05).                02610099
026200         10  MR-PACK-ID-X.                                        02620099
026300             15  MR-PACK-ID             PIC ZZZZ.                 02630099
026400                                                                  02640099
026500         10  FILLER                     PIC X(05).                02650099
026600         10  MR-PACK-DESC               PIC X(27).                02660099
026700                                                                  02670099
026800         10  FILLER                     PIC X(05).                02680099
026900         10  MR-STAT-CDE                PIC X(02).                02690099
027000                                                                  02700099
027100         10  FILLER                     PIC X(05).                02710099
027200         10  MR-INNER-PACK-X.                                     02720099
027300             15  MR-INNER-PACK          PIC ZZ9.                  02730099
027400                                                                  02740099
027500         10  FILLER                     PIC X(05).                02750099
027600         10  MR-UNITS-PER-CTN-X.                                  02760099
027700             15  MR-UNITS-PER-CTN       PIC ZZZZ9.                02770099
027800                                                                  02780099
027900         10  FILLER                     PIC X(05).                02790099
028000         10  MR-TOTAL-CRTNS-X.                                    02800099
028100             15  MR-TOTAL-CRTNS         PIC ZZZZ9.                02810099
028200                                                                  02820099
028300         10  FILLER                     PIC X(05).                02830099
028400         10  MR-TOTAL-UNITS-X.                                    02840099
028500             15  MR-TOTAL-UNITS         PIC ZZZZZ9.               02850099
028600/                                                                 02860099
028700*---------------------------------------------------------------* 02870099
028800*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02880099
028900*---------------------------------------------------------------* 02890099
029000                                                                  02900099
029100     COPY DPWS015.                                                02910099
029200                                                                  02920099
029300*---------------------------------------------------------------* 02930099
029400*    FUNCTION KEYS COPYBOOK.                                    * 02940099
029500*---------------------------------------------------------------* 02950099
029600                                                                  02960099
029700     COPY DPWS016.                                                02970099
029800                                                                  02980099
029900*---------------------------------------------------------------* 02990099
030000*    NUMERIC EDIT LAYOUT.                                       * 03000099
030100*---------------------------------------------------------------* 03010099
030200                                                                  03020099
030300     COPY DPWS010I.                                               03030099
030400                                                                  03040099
030500/                                                                 03050099
030600*---------------------------------------------------------------* 03060099
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 03070099
030800*---------------------------------------------------------------* 03080099
030900                                                                  03090099
031000     COPY DPWS030.                                                03100099
CICS       COPY DPWS930.                                                03101099
031100                                                                  03110099
031200/                                                                 03120099
031300*---------------------------------------------------------------* 03130099
031400*    STANDARD COMMAREA.                                         * 03140099
031500*---------------------------------------------------------------* 03150099
031600                                                                  03160099
031700     COPY DPWS020.                                                03170099
031800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03180099
031900                                                                  03190099
032000*---------------------------------------------------------------* 03200099
032100* INTER-APPLICATION COMMAREA.                                   * 03210099
032200*---------------------------------------------------------------* 03220099
032300                                                                  03230099
032400         10  INTER-APPL-COMM-AREA       PIC X(200).               03240099
032500     COPY POWS013.                                                03250099
032600     COPY POWS017.                                                03260099
032700*---------------------------------------------------------------* 03270099
032800*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03280099
032900*---------------------------------------------------------------* 03290099
033000         10  ASC-SPECIFIC-COMMAREA.                               03300099
033100             15  ASC-LIST-KEYS.                                   03310099
033200                 20  ASC-KEY-PO-NBR        PIC S9(9) COMP.        03320099
033300                 20  ASC-KEY-PACK-TYPE     PIC X(01).             03330099
033400             15  ASC-BLOCK-ENTRIES      OCCURS 2 TIMES.           03340099
033500                 20  ASC-BLOCK-MODIFIED-SW                        03350099
033600                                        PIC X(01).                03360099
033700                     88  ASC-BLOCK-NOT-MODIFIED    VALUE 'N'.     03370099
033800                     88  ASC-BLOCK-MODIFIED        VALUE 'Y'.     03380099
033900                                                                  03390099
034000                 20  ASC-ITEM-ARRAY.                              03400099
034100                     25  ASC-ITEM-ENTRIES OCCURS 13 TIMES.        03410099
034200                         30  ASC-LIST-ITEM-NUMBER                 03420099
034300                                        PIC S9(09) COMP-3.        03430099
034400                         30  ASC-TEMP-SELECTED-SW                 03440099
034500                                        PIC X(01).                03450099
034600                             88  ASC-VALID-SELECT  VALUE ' '      03460099
034700                                                         'S'      03470099
034800                                                         'B'      03480099
034900                                                         'E'.     03490099
035000                             88  ASC-TEMP-NO-SELECT               03500099
035100                                                   VALUE ' '.     03510099
035200                             88  ASC-TEMP-SELECT   VALUE 'S'.     03520099
035300                             88  ASC-TEMP-BEGIN    VALUE 'B'.     03530099
035400                             88  ASC-TEMP-END      VALUE 'E'.     03540099
035500                         30  ASC-SELECTED-SW                      03550099
035600                                        PIC X(01).                03560099
035700                             88  ASC-NO-SELECT     VALUE ' '.     03570099
035800                             88  ASC-SELECT        VALUE 'S'.     03580099
035900                             88  ASC-BEGIN         VALUE 'B'.     03590099
036000                             88  ASC-END           VALUE 'E'.     03600099
036100                         30  ASC-PACK-ID           PIC 9(04).     03610099
036200                         30  ASC-PACK-DESC         PIC X(27).     03620099
036300                         30  ASC-STAT-CDE          PIC X(02).     03630099
036400                         30  ASC-INNER-PACK        PIC 9(03).     03640099
036500                         30  ASC-UNITS-PER-CTN     PIC 9(05).     03650099
036600                         30  ASC-TOTAL-CRTNS       PIC 9(05).     03660099
036700                         30  ASC-TOTAL-UNITS       PIC 9(06).     03670099
036800             15  ASC-TOT-INNER-PK                  PIC 9(05).     03680099
036900             15  ASC-TOT-UNT-PER-CTN               PIC 9(07).     03690099
037000             15  ASC-TOT-TOTAL-CRTNS               PIC 9(07).     03700099
037100             15  ASC-TOT-TOTAL-UNITS               PIC 9(08).     03710099
037200                                                                  03720099
037300             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     03730099
037400             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     03740099
037500             15  ASC-NUMBER-OF-ITEMS-READ                         03750099
037600                                        PIC S9(09) COMP-3.        03760099
037700             15  ASC-NUMBER-OF-SELECTED-ITEMS                     03770099
037800                                        PIC S9(09) COMP-3.        03780099
037900             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        03790099
038000             15  ASC-ITEM-AT-TOP-OF-PANEL                         03800099
038100                                        PIC S9(09) COMP-3.        03810099
038200             15  ASC-ITEM-AT-BOT-OF-PANEL                         03820099
038300                                        PIC S9(09) COMP-3.        03830099
038400             15  ASC-HIGHEST-BLOCK-WRITTEN                        03840099
038500                                        PIC S9(04) COMP SYNC.     03850099
038600             15  ASC-START-OF-SELECTED-RANGE                      03860099
038700                                        PIC S9(09) COMP-3.        03870099
038800             15  ASC-END-OF-SELECTED-RANGE                        03880099
038900                                        PIC S9(09) COMP-3.        03890099
039000             15  ASC-ITEMS-LEFT-INDICATOR                         03900099
039100                                        PIC X(01).                03910099
039200                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     03920099
039300                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     03930099
039400             15  ASC-TEMP-QUEUE-UPDATE-SW                         03940099
039500                                        PIC X(01).                03950099
039600                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     03960099
039700                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     03970099
039800             15  ASC-LIST-QUEUE-NAME.                             03980099
039900                 20  ASC-LIST-TERM-ID   PIC X(04).                03990099
040000                 20  ASC-LIST-TASK-NUMBER                         04000099
040100                                        PIC S9(05) COMP-3.        04010099
040200                 20  ASC-LIST-SEQ       PIC 9(01).                04020099
040300             15  ASC-SEL-QUEUE-NAME.                              04030099
040400                 20  ASC-SEL-TERM-ID    PIC X(04).                04040099
040500                 20  ASC-SEL-TASK-NUMBER                          04050099
040600                                        PIC S9(05) COMP-3.        04060099
040700                 20  ASC-SEL-SEQ        PIC 9(01).                04070099
040800                                                                  04080099
040900             15  ASC-CURSOR-SW          PIC X(01).                04090099
041000                 88  ASC-NO-CURSOR                 VALUE 'N'.     04100099
041100                 88  ASC-ITEM-CURSOR               VALUE 'I'.     04110099
041200                 88  ASC-APP-ITEM-CURSOR           VALUE 'A'.     04120099
041300             15  ASC-START-ITEM-REQUEST.                          04130099
041400                 20  ASC-START-ITEM-REQUEST-N                     04140099
041500                                        PIC 9(07).                04150099
041600             15  ASC-TOT-UNT-QTY        PIC 9(07).                04160099
041700             15  ASC-TOT-SKUS-QTY       PIC 9(03).                04170099
041800             15  ASC-PO-TYP-CDE         PIC X(02).                04180099
041900*  ADDED 05-12-99 FOR PRODUCT PREPACKAGING PROJECT                04190099
042000             15  ASC-PO-PKGNG-CDE       PIC X(01).                04200099
042100             15  ASC-UNCONFIRM-PACK-SW  PIC X(01).                04210099
042200                 88  ASC-UNCONFIRMED-PACKS         VALUE 'Y'.     04220099
042300                 88  ASC-NO-UNCONFIRMED-PACKS      VALUE 'N'.     04230099
042400/                                                                 04240099
042500*---------------------------------------------------------------* 04250099
042600*    ABEND PROCESSING COPYBOOK.                                 * 04260099
042700*---------------------------------------------------------------* 04270099
042800                                                                  04280099
042900     COPY DPWS013.                                                04290099
043000                                                                  04300099
043100/                                                                 04310099
043200*---------------------------------------------------------------* 04320099
043300*    DB2 AREA FOR THE PURCHASE ORDER TABLE                      * 04330099
043400*---------------------------------------------------------------* 04340099
043500     EXEC SQL                                                     04350099
043600          INCLUDE TPURCHS                                         04360099
043700     END-EXEC.                                                    04370099
043800                                                                  04380099
043900/                                                                 04390099
044000*---------------------------------------------------------------* 04400099
044100*    DB2 AREA FOR THE PURCHASE ORDER LINE ITEM TABLE            * 04410099
044200*---------------------------------------------------------------* 04420099
044300     EXEC SQL                                                     04430099
044400          INCLUDE TPURITM                                         04440099
044500     END-EXEC.                                                    04450099
044600                                                                  04460099
044700/                                                                 04470099
044800*---------------------------------------------------------------* 04480099
044900*    DB2 AREA FOR THE PRE PACK TABLE                            * 04490099
045000*---------------------------------------------------------------* 04500099
045100     EXEC SQL                                                     04510099
045200          INCLUDE TPOPRPK                                         04520099
045300     END-EXEC.                                                    04530099
045400                                                                  04540099
045500/                                                                 04550099
045600*---------------------------------------------------------------* 04560099
045700*    DB2 AREA FOR COMMUNICATIONS                                * 04570099
045800*---------------------------------------------------------------* 04580099
045900     EXEC SQL                                                     04590099
046000          INCLUDE SQLCA                                           04600099
046100     END-EXEC.                                                    04610099
046200/                                                                 04620099
046300*---------------------------------------------------------------* 04630099
046400*    CURSOR TO SELECT PRE-PACK SUMMARY INFO                     * 04640099
046500*---------------------------------------------------------------* 04650099
046600                                                                  04660099
046700      EXEC SQL                                                    04670099
046800           DECLARE PREPACK-CSR CURSOR FOR                         04680099
046900           SELECT PREPK_TYP_CDE                                   04690099
047000                 ,PO_PREPK_ID                                     04700099
047100                 ,PREPK_DESC                                      04710099
047200                 ,PREPK_STAT_CDE                                  04720099
047300                 ,INPK_UNT_QTY                                    04730099
047400                 ,OTPK_UNT_QTY                                    04740099
047500                 ,OTPK_ORD_QTY                                    04750099
047600             FROM TPOPRPK                                         04760099
047700           WHERE PO_NBR = :ASC-KEY-PO-NBR                         04770099
047800      END-EXEC.                                                   04780099
047900/                                                                 04790099
048000 LINKAGE SECTION.                                                 04800099
048100                                                                  04810099
048200 01  DFHCOMMAREA.                                                 04820099
048300     05  FILLER                         OCCURS  1 TO 4072 TIMES   04830099
048400                                        DEPENDING ON EIBCALEN.    04840099
048500         10  FILLER                     PIC X.                    04850099
048600                                                                  04860099
048700/                                                                 04870099
048800 PROCEDURE DIVISION.                                              04880099
048900*---------------------------------------------------------------* 04890099
049000*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 04900099
049100*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 04910099
049200*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 04920099
049300*---------------------------------------------------------------* 04930099
049400 0000-MAIN-MODULE.                                                04940099
049500                                                                  04950099
049600     INITIALIZE DP030-CICS-API-FIELDS.                            04960099
049700                                                                  04970099
049800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04980099
049900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04990099
050000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05000099
050100                                                                  05010099
050200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05020099
050300                                                                  05030099
050400     MOVE LENGTH OF PO108AI        TO DP030-MAP-LENGTH (1).       05040099
050500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05050099
050600                                                                  05060099
050700     PERFORM 0001-CALL-CICS-ARCH-API.                             05070099
050800     PERFORM 1000-CONTROL-PROCESSING                              05080099
050900                                                                  05090099
051000     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05100099
051100     PERFORM 0001-CALL-CICS-ARCH-API.                             05110099
051200                                                                  05120099
051300*---------------------------------------------------------------* 05130099
051400*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 05140099
051500*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 05150099
051600*---------------------------------------------------------------* 05160099
051700 0001-CALL-CICS-ARCH-API.                                         05170099
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05180099
051900                                    DFHCOMMAREA                   05190099
052000                                    DP030-CICS-API-FIELDS         05200099
052100                                    DP020-STANDARD-COMMAREA       05210099
052200                                    PO108AI.                      05220099
052300                                                                  05230099
052400     IF  DP030-RC-CALL-SUCCESSFUL                                 05240099
052500         CONTINUE                                                 05250099
052600     ELSE                                                         05260099
052700         SET DP013-NO-ROLLBACK                                    05270099
052800             DP013-XCTL-DISPLAY-RESTART                           05280099
052900             DP013-CICS-ABEND      TO TRUE                        05290099
053000         MOVE '0001-CALL-CICS-ARCH-API'                           05300099
053100                                   TO DP013-PARAGRAPH             05310099
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05320099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05330099
053400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05340099
053500         PERFORM DP013-0000-PROCESS-ABEND                         05350099
053600     END-IF.                                                      05360099
053700                                                                  05370099
053800*----------------------------------------------------------------*05380099
053900* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05390099
054000* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05400099
054100*                                                                *05410099
054200* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05420099
054300*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05430099
054400*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05440099
054500*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05450099
054600*----------------------------------------------------------------*05460099
054700                                                                  05470099
054800 1000-CONTROL-PROCESSING.                                         05480099
054900                                                                  05490099
055000     EVALUATE TRUE                                                05500099
055100         WHEN DP020-NEXT-ACT-INITIAL                              05510099
055200             INITIALIZE ASC-SPECIFIC-COMMAREA                     05520099
055300             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05530099
055400                                      ASC-SEL-TERM-ID             05540099
055500             MOVE DP020-SRC-TASK-NUMBER                           05550099
055600                                   TO ASC-LIST-TASK-NUMBER        05560099
055700                                      ASC-SEL-TASK-NUMBER         05570099
055800             MOVE PC-LIST-QUEUE-SEQ                               05580099
055900                                   TO ASC-LIST-SEQ                05590099
056000             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05600099
056100             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05610099
056200             IF  PS-COMMAREA-NOT-VALID                            05620099
056300                 SET DP020-NEXT-ACT-APPL-ERROR                    05630099
056400                                   TO TRUE                        05640099
056500             ELSE                                                 05650099
056600                 PERFORM 4000-BUILD-INITIAL-PANEL                 05660099
056700             END-IF                                               05670099
056800                                                                  05680099
056900         WHEN DP020-NEXT-ACT-READ-MAP                             05690099
057000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05700099
057100                                   TO PV-TOP-ITEM                 05710099
057200             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   05720099
057300             PERFORM 2000-PROCESS-PANEL                           05730099
057400                                                                  05740099
057500         WHEN DP020-NEXT-ACT-RETURN                               05750099
057600             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05760099
057700                                   TO PV-TOP-ITEM                 05770099
057800             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   05780099
057900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05790099
058000             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05800099
058100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05810099
058200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05820099
058300             IF DP020-MSG-FATAL OR DP020-MSG-WARNING              05830099
058400                CONTINUE                                          05840099
058500             ELSE                                                 05850099
058600                IF ASC-UNCONFIRMED-PACKS                          05860099
058700*                  -- PURCHASE ORDER HAS UNCONFIRMED PACKS --     05870099
058800                   MOVE PC-TSYMSG-02761 TO DP020-MSG-NUMBER       05880099
058900                   SET DP020-MSG-WARNING TO TRUE                  05890099
059000                END-IF                                            05900099
059100             END-IF                                               05910099
059200                                                                  05920099
059300         WHEN OTHER                                               05930099
059400             SET DP013-LOGIC-ABEND TO TRUE                        05940099
059500             SET DP013-NO-ROLLBACK TO TRUE                        05950099
059600             MOVE '1000-CONTROL-PROCESSING'                       05960099
059700                                   TO DP013-PARAGRAPH             05970099
059800             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05980099
059900                                   TO DP013-MESSAGE-TEXT(1)       05990099
060000             PERFORM DP013-0000-PROCESS-ABEND                     06000099
060100     END-EVALUATE.                                                06010099
060200                                                                  06020099
060300/                                                                 06030099
060400*----------------------------------------------------------------*06040099
060500* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *06050099
060600*----------------------------------------------------------------*06060099
060700                                                                  06070099
060800 1100-PROCESS-INTER-APPL-COMM.                                    06080099
060900                                                                  06090099
061000     SET PS-COMMAREA-VALID         TO TRUE.                       06100099
061100     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06110099
061200                                                                  06120099
061300     IF  PO017-PO-NBR = ZEROES                                    06130099
061400         MOVE PC-TSYMSG-00461    TO DP020-MSG-NUMBER              06140099
061500         SET PS-ERROR                                             06150099
061600             PS-COMMAREA-NOT-VALID                                06160099
061700             DP020-NEXT-ACT-APPL-ERROR                            06170099
061800             DP020-MSG-FATAL     TO TRUE                          06180099
061900     ELSE                                                         06190099
062000         MOVE PO017-PO-NBR       TO ASC-KEY-PO-NBR                06200099
062100                                    DK-PO-NBR                     06210099
062200     END-IF.                                                      06220099
062300                                                                  06230099
062400/                                                                 06240099
062500*----------------------------------------------------------------*06250099
062600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06260099
062700* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06270099
062800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06280099
062900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06290099
063000* FUNCTION KEYS CAN GET THIS FAR.                                *06300099
063100*----------------------------------------------------------------*06310099
063200                                                                  06320099
063300 2000-PROCESS-PANEL.                                              06330099
063400     EVALUATE TRUE                                                06340099
063500         WHEN DP020-SRC-AID = DP016-CLEAR                         06350099
063600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06360099
063700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06370099
063800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06380099
063900                                                                  06390099
064000         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06400099
064100             INITIALIZE ASC-TOT-INNER-PK                          06410099
064200             INITIALIZE ASC-TOT-UNT-PER-CTN                       06420099
064300             INITIALIZE ASC-TOT-TOTAL-CRTNS                       06430099
064400             INITIALIZE ASC-TOT-TOTAL-UNITS                       06440099
064500             PERFORM 2050-DELETE-LIST-QUEUE                       06450099
064600             PERFORM 4000-BUILD-INITIAL-PANEL                     06460099
064700                                                                  06470099
064800         WHEN DP020-FK-DESELECT (DP020-SRC-AID)                   06480099
064900             PERFORM 2140-DESELECT-ALL-ITEMS                      06490099
065000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06500099
065100                                                                  06510099
065200         WHEN DP020-FK-SELECT-ALL (DP020-SRC-AID)                 06520099
065300              PERFORM 2150-SELECT-ALL-ITEMS                       06530099
065400              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                06540099
065500                                                                  06550099
065600         WHEN OTHER                                               06560099
065700             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06570099
065800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06580099
065900             IF  PS-NO-ERROR                                      06590099
066000                 SET DP030-CONTINUE-GO TO TRUE                    06600099
066100                 PERFORM 2100-CHECK-FUNCTION-KEY                  06610099
066200             ELSE                                                 06620099
066300                 SET DP030-OVERRIDE-GO TO TRUE                    06630099
066400             END-IF                                               06640099
066500     END-EVALUATE.                                                06650099
066600                                                                  06660099
066700/                                                                 06670099
066800*----------------------------------------------------------------*06680099
066900*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06690099
067000*----------------------------------------------------------------*06700099
067100 2050-DELETE-LIST-QUEUE.                                          06710099
067200                                                                  06720099
067300     EXEC CICS                                                    06730099
067400         DELETEQ TS                                               06740099
067500           QUEUE (ASC-LIST-QUEUE-NAME)                            06750099
067600            RESP (PV-CICS-RESP)                                   06760099
067700     END-EXEC.                                                    06770099
067800                                                                  06780099
067900     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06790099
068000        (PV-CICS-RESP = DFHRESP(QIDERR))                          06800099
068100         CONTINUE                                                 06810099
068200     ELSE                                                         06820099
068300         SET DP013-CICS-ABEND      TO TRUE                        06830099
068400         SET DP013-NO-ROLLBACK     TO TRUE                        06840099
068500                                                                  06850099
068600         MOVE '2050-DELETE-LIST-QUEUE'                            06860099
068700                                   TO DP013-PARAGRAPH             06870099
068800         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06880099
068900                                   TO DP013-MESSAGE-TEXT (1)      06890099
069000         PERFORM DP013-0000-PROCESS-ABEND                         06900099
069100     END-IF.                                                      06910099
069200                                                                  06920099
069300     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06930099
069400                                                                  06940099
069500/                                                                 06950099
069600*----------------------------------------------------------------*06960099
069700* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06970099
069800* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06980099
069900* CICS ARCHITECTURE API.                                         *06990099
070000*----------------------------------------------------------------*07000099
070100 2100-CHECK-FUNCTION-KEY.                                         07010099
070200                                                                  07020099
070300     EVALUATE TRUE                                                07030099
070400         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 07040099
070500              IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO             07050099
070600                  INITIALIZE PO013-INTER-APPL-COMMAREA            07060099
070700                  MOVE ASC-NUMBER-OF-SELECTED-ITEMS               07070099
070800                                TO PO013-NUMBER-OF-SELECTED-ITEMS 07080099
070900                  MOVE ASC-KEY-PO-NBR TO PO013-PO-NBR             07090099
071000                  PERFORM 5000-PREPARE-SEL-QUEUE                  07100099
071100              ELSE                                                07110099
071200                  SET DP030-OVERRIDE-GO                           07120099
071300                      DP020-MSG-WARNING                           07130099
071400                                TO TRUE                           07140099
071500                  MOVE PC-TSYMSG-00057                            07150099
071600                                TO DP020-MSG-NUMBER               07160099
071700              END-IF                                              07170099
071800* GOING TO INNER DETAIL SCREEN                                    07180099
071900         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              07190099
072000              IF ASC-NUMBER-OF-SELECTED-ITEMS < 1                 07200099
072100                 SET DP030-OVERRIDE-GO                            07210099
072200                     DP020-MSG-WARNING                            07220099
072300                               TO TRUE                            07230099
072400                 MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER         07240099
072500              ELSE                                                07250099
072600                 INITIALIZE PO013-INTER-APPL-COMMAREA             07260099
072700                 PERFORM 2105-GET-DEPT-NBR                        07270099
072800                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                07280099
072900                              TO PO013-NUMBER-OF-SELECTED-ITEMS   07290099
073000                 MOVE ASC-KEY-PO-NBR       TO PO013-PO-NBR        07300099
073100                 MOVE PURCHS-PKGNG-CDE     TO PO013-PO-PKGNG-CDE  07310099
073200                 MOVE DK-DEPT-NBR          TO PO013-DEPT-NBR      07320099
073300                 PERFORM 5000-PREPARE-SEL-QUEUE                   07330099
073400              END-IF                                              07340099
073500                                                                  07350099
073600                                                                  07360099
073700         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              07370099
073800             IF ASC-NUMBER-OF-SELECTED-ITEMS = 0                  07380099
073900                MOVE ASC-KEY-PO-NBR       TO PO017-PO-NBR         07390099
074000             END-IF                                               07400099
074100                                                                  07410099
074200             IF ASC-NUMBER-OF-SELECTED-ITEMS > 0                  07420099
074300                SET DP030-OVERRIDE-GO                             07430099
074400                    DP020-MSG-WARNING                             07440099
074500                              TO TRUE                             07450099
074600                MOVE PC-TSYMSG-00778                              07460099
074700                              TO DP020-MSG-NUMBER                 07470099
074800             END-IF                                               07480099
074900                                                                  07490099
075000         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07500099
075100             MOVE +1               TO PV-TOP-ITEM                 07510099
075200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07520099
075300             PERFORM 3200-RESET-ATTRIBUTES                        07530099
075400                                                                  07540099
075500         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07550099
075600             PERFORM 2110-BROWSE-BACKWARD                         07560099
075700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07570099
075800             PERFORM 3200-RESET-ATTRIBUTES                        07580099
075900                                                                  07590099
076000         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07600099
076100             PERFORM 2120-BROWSE-FORWARD                          07610099
076200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07620099
076300             PERFORM 3200-RESET-ATTRIBUTES                        07630099
076400                                                                  07640099
076500         WHEN DP020-SRC-AID = DP016-ENTER                         07650099
076600             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   07660099
076700             IF  PS-ERROR                                         07670099
076800                 CONTINUE                                         07680099
076900             ELSE                                                 07690099
077000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07700099
077100             END-IF                                               07710099
077200             IF DP020-MSG-FATAL OR DP020-MSG-WARNING              07720099
077300                CONTINUE                                          07730099
077400             ELSE                                                 07740099
077500                IF ASC-UNCONFIRMED-PACKS                          07750099
077600*                  -- PURCHASE ORDER HAS UNCONFIRMED PACKS --     07760099
077700                   MOVE PC-TSYMSG-02761 TO DP020-MSG-NUMBER       07770099
077800                   SET DP020-MSG-WARNING TO TRUE                  07780099
077900                END-IF                                            07790099
078000             END-IF                                               07800099
078100                                                                  07810099
078200         WHEN OTHER                                               07820099
078300             SET DP013-NO-ROLLBACK                                07830099
078400                 DP013-XCTL-DISPLAY-RESTART                       07840099
078500                 DP013-CICS-ABEND  TO TRUE                        07850099
078600             MOVE '2100-CHECK-FUNCTION-KEY'                       07860099
078700                                   TO DP013-PARAGRAPH             07870099
078800             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07880099
078900                                   TO DP013-MESSAGE-TEXT (1)      07890099
079000             PERFORM DP013-0000-PROCESS-ABEND                     07900099
079100     END-EVALUATE.                                                07910099
079200                                                                  07920099
079300/                                                                 07930099
079400*----------------------------------------------------------------*07940099
079500*    GET DEPARTMENT NUMBER FROM TPURCHS                          *07950099
079600*----------------------------------------------------------------*07960099
079700                                                                  07970099
079800 2105-GET-DEPT-NBR.                                               07980099
079900                                                                  07990099
080000     PERFORM                                                      08000099
080100         WITH TEST AFTER                                          08010099
080200         VARYING PV-RETRY-COUNTER                                 08020099
080300         FROM 1 BY 1                                              08030099
080400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08040099
080500            OR (SQLCODE = +0))                                    08050099
080600                                                                  08060099
080700      EXEC SQL                                                    08070099
080800           SELECT DEPT_NBR                                        08080099
080900                 ,PKGNG_CDE                                       08090099
081000           INTO   :PURCHS-DEPT-NBR                                08100099
081100                 ,:PURCHS-PKGNG-CDE                               08110099
081200           FROM    TPURCHS                                        08120099
081300           WHERE   PO_NBR = :ASC-KEY-PO-NBR                       08130099
081400           AND     VER_STATUS_CDE = 'A'                           08140099
081500      END-EXEC                                                    08150099
081600                                                                  08160099
081700      EVALUATE TRUE                                               08170099
081800          WHEN SQLCODE = 0                                        08180099
081900               MOVE PURCHS-DEPT-NBR TO DK-DEPT-NBR                08190099
082000          WHEN SQLCODE = +100                                     08200099
082100               MOVE '2105-GET-DEPT-NBR' TO DP013-PARAGRAPH        08210099
082200               MOVE 'UNSUCCESSFUL SELECT GET DEPT NBR '           08220099
082300                                 TO DP013-MESSAGE-TEXT (1)        08230099
082400               MOVE SQLCA        TO DP013-SQLCA                   08240099
082500               MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)      08250099
082600               SET DP013-DB2-ABEND                                08260099
082700                   DP013-XCTL-DISPLAY-RESTART                     08270099
082800                                 TO TRUE                          08280099
082900               PERFORM DP013-0000-PROCESS-ABEND                   08290099
083000          WHEN SQLCODE = -904                                     08300099
083100          WHEN SQLCODE = -913                                     08310099
083200               CONTINUE                                           08320099
083300          WHEN SQLWARN0 NOT = SPACES                              08330099
083400          WHEN SQLCODE < +0                                       08340099
083500          WHEN SQLCODE > +0                                       08350099
083600               MOVE '2105-GET-DEPT-NBR' TO DP013-PARAGRAPH        08360099
083700               MOVE 'UNSUCCESSFUL SELECT GET DEPT NBR '           08370099
083800                                 TO DP013-MESSAGE-TEXT (1)        08380099
083900               MOVE SQLCA        TO DP013-SQLCA                   08390099
084000               MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)      08400099
084100               SET DP013-DB2-ABEND                                08410099
084200                   DP013-XCTL-DISPLAY-RESTART                     08420099
084300                                 TO TRUE                          08430099
084400               PERFORM DP013-0000-PROCESS-ABEND                   08440099
084500      END-EVALUATE                                                08450099
084600     END-PERFORM.                                                 08460099
084700                                                                  08470099
084800     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         08480099
084900        MOVE '2105-GET-DEPT-NBR' TO DP013-PARAGRAPH               08490099
085000        MOVE 'MAX RETRIES EXCEEDED ON SELECT  TPURCHS'            08500099
085100                                 TO DP013-MESSAGE-TEXT (1)        08510099
085200        MOVE SQLCA               TO DP013-SQLCA                   08520099
085300        MOVE 'TPURCHS '          TO DP013-DB2-TABLE-NAME (1)      08530099
085400        SET DP013-DB2-ABEND                                       08540099
085500            DP013-XCTL-DISPLAY-RESTART                            08550099
085600                                 TO TRUE                          08560099
085700        PERFORM DP013-0000-PROCESS-ABEND                          08570099
085800     END-IF.                                                      08580099
085900                                                                  08590099
086000*----------------------------------------------------------------*08600099
086100*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *08610099
086200*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *08620099
086300*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *08630099
086400*    MESSAGE.                                                    *08640099
086500*----------------------------------------------------------------*08650099
086600                                                                  08660099
086700 2110-BROWSE-BACKWARD.                                            08670099
086800                                                                  08680099
086900     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    08690099
087000         GIVING PV-TOP-ITEM.                                      08700099
087100                                                                  08710099
087200     IF  ((PV-TOP-ITEM < +1)                                      08720099
087300       OR (PV-TOP-ITEM = +1))                                     08730099
087400         MOVE +1                   TO PV-TOP-ITEM                 08740099
087500*        -- TOP OF LIST --                                        08750099
087600         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            08760099
087700         SET DP020-MSG-INFORMATIONAL                              08770099
087800                                   TO TRUE                        08780099
087900     END-IF.                                                      08790099
088000                                                                  08800099
088100/                                                                 08810099
088200*----------------------------------------------------------------*08820099
088300*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *08830099
088400*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *08840099
088500*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *08850099
088600*----------------------------------------------------------------*08860099
088700                                                                  08870099
088800 2120-BROWSE-FORWARD.                                             08880099
088900                                                                  08890099
089000     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              08900099
089100         GIVING PV-TOP-ITEM.                                      08910099
089200                                                                  08920099
089300     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   08930099
089400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08940099
089500                                   TO PV-TOP-ITEM                 08950099
089600*        -- BOTTOM OF LIST --                                     08960099
089700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08970099
089800         SET DP020-MSG-INFORMATIONAL                              08980099
089900                                   TO TRUE                        08990099
090000     ELSE                                                         09000099
090100         COMPUTE PV-BOTTOM-ITEM =                                 09010099
090200             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 09020099
090300         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            09030099
090400*            -- BOTTOM OF LIST --                                 09040099
090500             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            09050099
090600             SET DP020-MSG-INFORMATIONAL                          09060099
090700                                   TO TRUE                        09070099
090800         END-IF                                                   09080099
090900     END-IF.                                                      09090099
091000                                                                  09100099
091100/                                                                 09110099
091200*----------------------------------------------------------------*09120099
091300*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *09130099
091400*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *09140099
091500*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *09150099
091600*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *09160099
091700*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *09170099
091800*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *09180099
091900*----------------------------------------------------------------*09190099
092000                                                                  09200099
092100 2130-CHECK-FOR-JUMP-BROWSE.                                      09210099
092200                                                                  09220099
092300     SET PS-NO-ERROR               TO TRUE.                       09230099
092400     IF (ASC-START-ITEM-REQUEST = SPACE)                          09240099
092500         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09250099
092600                                   TO PV-TOP-ITEM                 09260099
092700     ELSE                                                         09270099
092800         MOVE ASC-START-ITEM-REQUEST                              09280099
092900                                   TO DP010I-UNEDITED-FIELD       09290099
093000         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       09300099
093100         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     09310099
093200         SET DP010I-NEGATIVE-NOT-ALLOWED                          09320099
093300                                   TO TRUE                        09330099
093410         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09341099
093420                         USING DP010I-NUMERIC-EDIT-AREA           09342099
093500                                                                  09350099
093600         IF  NOT DP010I-ERROR-DETECTED                            09360099
093700             MOVE DP010I-NUMERIC-FIELD                            09370099
093800                                   TO ASC-START-ITEM-REQUEST-N    09380099
093900             IF  ASC-START-ITEM-REQUEST-N > ZERO                  09390099
094000                 IF  ASC-START-ITEM-REQUEST-N >                   09400099
094100                                          ASC-NUMBER-OF-ITEMS-READ09410099
094200                     MOVE SPACE TO ASC-START-ITEM-REQUEST         09420099
094300                     COMPUTE PV-TOP-ITEM =                        09430099
094400                             ASC-NUMBER-OF-ITEMS-READ             09440099
094500                             - PC-ITEMS-PER-PANEL + 1             09450099
094600                     IF  PV-TOP-ITEM < +1                         09460099
094700                         MOVE +1   TO PV-TOP-ITEM                 09470099
094800                         MOVE PC-TSYMSG-00070                     09480099
094900                                   TO DP020-MSG-NUMBER            09490099
095000                         SET DP020-MSG-INFORMATIONAL              09500099
095100                                   TO TRUE                        09510099
095200                     END-IF                                       09520099
095300                 ELSE                                             09530099
095400                     MOVE ASC-START-ITEM-REQUEST-N                09540099
095500                                   TO PV-TOP-ITEM                 09550099
095600                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      09560099
095700                     COMPUTE PV-BOTTOM-ITEM =                     09570099
095800                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     09580099
095900                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ09590099
096000*                        -- BOTTOM OF LIST --                     09600099
096100                         MOVE PC-TSYMSG-00070                     09610099
096200                                   TO DP020-MSG-NUMBER            09620099
096300                         SET DP020-MSG-INFORMATIONAL              09630099
096400                                   TO TRUE                        09640099
096500                     END-IF                                       09650099
096600                 END-IF                                           09660099
096700             ELSE                                                 09670099
096800*                --- VALUE OUT OF RANGE ----                      09680099
096900                 MOVE PC-TSYMSG-00101                             09690099
097000                                   TO DP020-MSG-NUMBER            09700099
097100                 MOVE -1           TO ASTRTITL                    09710099
097200                 SET DP030-SET-CURSOR-APPL-1                      09720099
097300                                   TO TRUE                        09730099
097400                 MOVE DP015-REVERSE                               09740099
097500                                   TO ASTRTITH                    09750099
097600                 MOVE DP015-RED    TO ASTRTITC                    09760099
097700                 MOVE DP015-UNP-NUM-BRT-MDT                       09770099
097800                                   TO ASTRTITA                    09780099
097900                 SET DP020-MSG-FATAL                              09790099
098000                                   TO TRUE                        09800099
098100                 SET PS-ERROR      TO TRUE                        09810099
098200             END-IF                                               09820099
098300                                                                  09830099
098400         ELSE                                                     09840099
098500             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09850099
098600             MOVE -1               TO ASTRTITL                    09860099
098700             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09870099
098800             MOVE DP015-REVERSE    TO ASTRTITH                    09880099
098900             MOVE DP015-RED        TO ASTRTITC                    09890099
099000             MOVE DP015-UNP-NUM-BRT-MDT                           09900099
099100                                   TO ASTRTITA                    09910099
099200             SET DP020-MSG-FATAL   TO TRUE                        09920099
099300             SET PS-ERROR          TO TRUE                        09930099
099400         END-IF                                                   09940099
099500     END-IF.                                                      09950099
099600                                                                  09960099
099700/                                                                 09970099
099800*----------------------------------------------------------------*09980099
099900*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *09990099
100000*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *10000099
100100*----------------------------------------------------------------*10010099
100200 2140-DESELECT-ALL-ITEMS.                                         10020099
100300                                                                  10030099
100400     MOVE +1                       TO ASC-BLK-SUB.                10040099
100500                                                                  10050099
100600     PERFORM 2141-CLEAR-SELECTED-INDS                             10060099
100700         VARYING ASC-ITEM-SUB                                     10070099
100800         FROM 1 BY 1                                              10080099
100900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10090099
101000                                                                  10100099
101100     ADD +1                        TO ASC-BLK-SUB.                10110099
101200                                                                  10120099
101300     PERFORM 2141-CLEAR-SELECTED-INDS                             10130099
101400         VARYING ASC-ITEM-SUB                                     10140099
101500         FROM 1 BY 1                                              10150099
101600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10160099
101700                                                                  10170099
101800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10180099
101900                                   TO PV-LIST-ITEM-NUMBER.        10190099
102000                                                                  10200099
102100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10210099
102200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10220099
102300                                                                  10230099
102400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10240099
102500        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      10250099
102600         MOVE +1                   TO ASC-BLK-SUB                 10260099
102700                                                                  10270099
102800         PERFORM 5100-WRITE-TEMP-STORAGE                          10280099
102900                                                                  10290099
103000         MOVE +1                   TO PV-BLOCK-NUMBER             10300099
103100                                                                  10310099
103200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10320099
103300             PV-FIRST-BLOCK-IN-ARRAY - 1                          10330099
103400                                                                  10340099
103500         PERFORM                                                  10350099
103600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10360099
103700                                                                  10370099
103800             PERFORM 4410-READ-TEMP-STORAGE                       10380099
103900                                                                  10390099
104000             PERFORM 2141-CLEAR-SELECTED-INDS                     10400099
104100                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 10410099
104200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10420099
104300                                                                  10430099
104400             PERFORM 5100-WRITE-TEMP-STORAGE                      10440099
104500                                                                  10450099
104600             ADD +1                TO PV-BLOCK-NUMBER             10460099
104700                                                                  10470099
104800         END-PERFORM                                              10480099
104900                                                                  10490099
105000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10500099
105100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10510099
105200                                                                  10520099
105300         PERFORM                                                  10530099
105400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10540099
105500                   ASC-HIGHEST-BLOCK-WRITTEN                      10550099
105600                                                                  10560099
105700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10570099
105800                                   TO PV-BLOCK-NUMBER             10580099
105900                                                                  10590099
106000             PERFORM 4410-READ-TEMP-STORAGE                       10600099
106100                                                                  10610099
106200             PERFORM 2141-CLEAR-SELECTED-INDS                     10620099
106300                 VARYING ASC-ITEM-SUB                             10630099
106400                 FROM 1 BY 1                                      10640099
106500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10650099
106600                                                                  10660099
106700             PERFORM 5100-WRITE-TEMP-STORAGE                      10670099
106800                                                                  10680099
106900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10690099
107000                                                                  10700099
107100         END-PERFORM                                              10710099
107200                                                                  10720099
107300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10730099
107400                                   TO PV-BLOCK-NUMBER             10740099
107500                                                                  10750099
107600         PERFORM 4410-READ-TEMP-STORAGE                           10760099
107700     END-IF.                                                      10770099
107800                                                                  10780099
107900                                                                  10790099
108000     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS10800099
108100     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.10810099
108200     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  10820099
108300                                                                  10830099
108400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10840099
108500                                                                  10850099
108600/                                                                 10860099
108700*----------------------------------------------------------------*10870099
108800*    MARK EACH ITEM AS BEING NOT SELECTED.                       *10880099
108900*----------------------------------------------------------------*10890099
109000                                                                  10900099
109100 2141-CLEAR-SELECTED-INDS.                                        10910099
109200                                                                  10920099
109300     IF  ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)          10930099
109400             NOT EQUAL ZERO                                       10940099
109500         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10950099
109600             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10960099
109700                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    10970099
109800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10980099
109900                                   TO TRUE                        10990099
110000         END-IF                                                   11000099
110100     END-IF.                                                      11010099
110200                                                                  11020099
110300/                                                                 11030099
110400*----------------------------------------------------------------*11040099
110500*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *11050099
110600*  FOR ALL ITEMS.                                                *11060099
110700*----------------------------------------------------------------*11070099
110800                                                                  11080099
110900 2150-SELECT-ALL-ITEMS.                                           11090099
111000                                                                  11100099
111100     MOVE +1                       TO ASC-BLK-SUB.                11110099
111200                                                                  11120099
111300     PERFORM 2151-SET-SELECTED-INDS                               11130099
111400         VARYING ASC-ITEM-SUB                                     11140099
111500         FROM 1 BY 1                                              11150099
111600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11160099
111700                                                                  11170099
111800     ADD +1                        TO ASC-BLK-SUB.                11180099
111900                                                                  11190099
112000     PERFORM 2151-SET-SELECTED-INDS                               11200099
112100         VARYING ASC-ITEM-SUB                                     11210099
112200         FROM 1 BY 1                                              11220099
112300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11230099
112400                                                                  11240099
112500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11250099
112600                                   TO PV-LIST-ITEM-NUMBER.        11260099
112700                                                                  11270099
112800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11280099
112900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11290099
113000                                                                  11300099
113100     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11310099
113200        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    11320099
113300         MOVE +1                   TO ASC-BLK-SUB                 11330099
113400                                                                  11340099
113500         PERFORM 5100-WRITE-TEMP-STORAGE                          11350099
113600                                                                  11360099
113700         MOVE +1                   TO PV-BLOCK-NUMBER             11370099
113800                                                                  11380099
113900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11390099
114000             PV-FIRST-BLOCK-IN-ARRAY - 1                          11400099
114100                                                                  11410099
114200         PERFORM                                                  11420099
114300             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11430099
114400                                                                  11440099
114500             PERFORM 4410-READ-TEMP-STORAGE                       11450099
114600                                                                  11460099
114700             PERFORM 2151-SET-SELECTED-INDS                       11470099
114800                 VARYING ASC-ITEM-SUB                             11480099
114900                 FROM 1 BY 1                                      11490099
115000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11500099
115100                                                                  11510099
115200             PERFORM 5100-WRITE-TEMP-STORAGE                      11520099
115300                                                                  11530099
115400             ADD +1                TO PV-BLOCK-NUMBER             11540099
115500         END-PERFORM                                              11550099
115600                                                                  11560099
115700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11570099
115800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11580099
115900                                                                  11590099
116000         PERFORM                                                  11600099
116100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11610099
116200                   ASC-HIGHEST-BLOCK-WRITTEN                      11620099
116300                                                                  11630099
116400             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11640099
116500                                   TO PV-BLOCK-NUMBER             11650099
116600                                                                  11660099
116700             PERFORM 4410-READ-TEMP-STORAGE                       11670099
116800                                                                  11680099
116900             PERFORM 2151-SET-SELECTED-INDS                       11690099
117000                 VARYING ASC-ITEM-SUB                             11700099
117100                 FROM 1 BY 1                                      11710099
117200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11720099
117300                                                                  11730099
117400             PERFORM 5100-WRITE-TEMP-STORAGE                      11740099
117500                                                                  11750099
117600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11760099
117700         END-PERFORM                                              11770099
117800                                                                  11780099
117900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11790099
118000                                   TO PV-BLOCK-NUMBER             11800099
118100                                                                  11810099
118200         PERFORM 4410-READ-TEMP-STORAGE                           11820099
118300     END-IF.                                                      11830099
118400                                                                  11840099
118500     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             11850099
118600          ASC-NUMBER-OF-SELECTED-ITEMS.                           11860099
118700                                                                  11870099
118800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11880099
118900                                                                  11890099
119000/                                                                 11900099
119100*----------------------------------------------------------------*11910099
119200*    MARK EACH ITEM AS BEING SELECTED.                           *11920099
119300*----------------------------------------------------------------*11930099
119400                                                                  11940099
119500 2151-SET-SELECTED-INDS.                                          11950099
119600                                                                  11960099
119700     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11970099
119800             NOT EQUAL ZERO                                       11980099
119900         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11990099
120000             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12000099
120100                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        12010099
120200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12020099
120300                                   TO TRUE                        12030099
120400         END-IF                                                   12040099
120500     END-IF.                                                      12050099
120600                                                                  12060099
120700/                                                                 12070099
120800*----------------------------------------------------------------*12080099
120900*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *12090099
121000*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *12100099
121100*----------------------------------------------------------------*12110099
121200 2200-MOVE-SCREEN-TO-COMMAREA.                                    12120099
121300                                                                  12130099
121400     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             12140099
121500     MOVE +1                       TO PV-SUB.                     12150099
121600                                                                  12160099
121700     PERFORM 3100-SET-SUBSCRIPTS.                                 12170099
121800                                                                  12180099
121900     IF  ASTRTITL > ZERO                                          12190099
122000         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      12200099
122100     ELSE                                                         12210099
122200         IF  ASTRTITF = DP015-ERASE-EOF                           12220099
122300             INITIALIZE ASC-START-ITEM-REQUEST                    12230099
122400         END-IF                                                   12240099
122500     END-IF.                                                      12250099
122600                                                                  12260099
122700     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          12270099
122800         VARYING PV-SUB                                           12280099
122900         FROM 1 BY 1                                              12290099
123000         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      12300099
123100                                                                  12310099
123200/                                                                 12320099
123300*----------------------------------------------------------------*12330099
123400*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *12340099
123500*----------------------------------------------------------------*12350099
123600 2210-MOVE-LINES-TO-COMMAREA.                                     12360099
123700                                                                  12370099
123800     IF  MR-SELECTL (PV-SUB) > ZERO                               12380099
123900         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     12390099
124000                                   TO TRUE                        12400099
124100         MOVE MR-SELECT (PV-SUB)   TO ASC-TEMP-SELECTED-SW        12410099
124200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12420099
124300     ELSE                                                         12430099
124400         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                12440099
124500             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         12450099
124600             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        12460099
124700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12470099
124800         END-IF                                                   12480099
124900     END-IF.                                                      12490099
125000                                                                  12500099
125100     ADD +1                        TO ASC-ITEM-SUB.               12510099
125200                                                                  12520099
125300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12530099
125400         ADD +1                    TO ASC-BLK-SUB                 12540099
125500         MOVE +1                   TO ASC-ITEM-SUB                12550099
125600     END-IF.                                                      12560099
125700                                                                  12570099
125800/                                                                 12580099
125900*----------------------------------------------------------------*12590099
126000*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *12600099
126100*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *12610099
126200*----------------------------------------------------------------*12620099
126300 3000-EDIT-DATA-IN-COMMAREA.                                      12630099
126400                                                                  12640099
126500     SET PS-NO-ERROR               TO TRUE.                       12650099
126600                                                                  12660099
126700     PERFORM 3200-RESET-ATTRIBUTES.                               12670099
126800                                                                  12680099
126900     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     12690099
127000**                                                                12700099
127100* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              12710099
127200* EDITTING IS DONE FROM THE BOTTOM UP.                            12720099
127300**                                                                12730099
127400     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       12740099
127500         ASC-ITEMS-DISPLAYED - 1.                                 12750099
127600                                                                  12760099
127700     PERFORM 3100-SET-SUBSCRIPTS.                                 12770099
127800     PERFORM 3300-EDIT-SELECTIONS                                 12780099
127900         VARYING PV-SUB                                           12790099
128000         FROM PV-SUB BY -1                                        12800099
128100         UNTIL PV-SUB < +1                                        12810099
128200                                                                  12820099
128300     IF  PS-NO-ERROR                                              12830099
128400         PERFORM 3400-CHECK-RANGE-SEQUENCE                        12840099
128500     END-IF.                                                      12850099
128600                                                                  12860099
128700     IF  ((PS-NO-ERROR)                                           12870099
128800       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   12880099
128900       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    12890099
129000             PERFORM 3500-MARK-RANGE-AS-SELECTED                  12900099
129100     END-IF.                                                      12910099
129200                                                                  12920099
129300/                                                                 12930099
129400*----------------------------------------------------------------*12940099
129500*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *12950099
129600*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*12960099
129700*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *12970099
129800*                                                                *12980099
129900*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *12990099
130000*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *13000099
130100*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *13010099
130200*    US IN THE 2ND BLOCK OF THE ARRAY.                           *13020099
130300*----------------------------------------------------------------*13030099
130400                                                                  13040099
130500 3100-SET-SUBSCRIPTS.                                             13050099
130600                                                                  13060099
130700     COMPUTE ASC-ITEM-SUB =                                       13070099
130800         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        13080099
130900                                                                  13090099
131000     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         13100099
131100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            13110099
131200                                                                  13120099
131300         MOVE PC-MAX-BLOCKS-IN-ARRAY                              13130099
131400                                   TO ASC-BLK-SUB                 13140099
131500     ELSE                                                         13150099
131600         MOVE +1                   TO ASC-BLK-SUB                 13160099
131700     END-IF.                                                      13170099
131800                                                                  13180099
131900*----------------------------------------------------------------*13190099
132000*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *13200099
132100*----------------------------------------------------------------*13210099
132200                                                                  13220099
132300 3200-RESET-ATTRIBUTES.                                           13230099
132400                                                                  13240099
132500     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   13250099
132600     MOVE DP015-GREEN              TO ASTRTITC.                   13260099
132700     MOVE DP015-UNDERLINE          TO ASTRTITH.                   13270099
132800                                                                  13280099
132900     IF DP020-NEXT-ACT-RETURN                                     13290099
133000     OR DP020-NEXT-ACT-READ-MAP                                   13300099
133100        PERFORM                                                   13310099
133200            VARYING PV-SUB                                        13320099
133300            FROM 1 BY 1                                           13330099
133400            UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                    13340099
133500            MOVE DP015-UNP-ALP-NOR-OFF                            13350099
133600                                      TO MR-SELECTA (PV-SUB)      13360099
133700            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      13370099
133800            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      13380099
133900        END-PERFORM                                               13390099
134000     ELSE                                                         13400099
134100        PERFORM                                                   13410099
134200            VARYING PV-SUB                                        13420099
134300            FROM 1 BY 1                                           13430099
134400            UNTIL PV-SUB > PC-ITEMS-PER-PANEL                     13440099
134500            MOVE DP015-UNP-ALP-NOR-OFF                            13450099
134600                                      TO MR-SELECTA (PV-SUB)      13460099
134700            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      13470099
134800            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      13480099
134900        END-PERFORM                                               13490099
135000     END-IF.                                                      13500099
135100                                                                  13510099
135200/                                                                 13520099
135300*----------------------------------------------------------------*13530099
135400*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *13540099
135500*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *13550099
135600*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *13560099
135700*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *13570099
135800*----------------------------------------------------------------*13580099
135900 3300-EDIT-SELECTIONS.                                            13590099
136000                                                                  13600099
136100     EVALUATE TRUE                                                13610099
136200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13620099
136300             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         13630099
136400                 CONTINUE                                         13640099
136500                                                                  13650099
136600         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         13660099
136700             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        13670099
136800                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS13680099
136900                 MOVE ASC-TEMP-SELECTED-SW                        13690099
137000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13700099
137100                                   TO ASC-SELECTED-SW             13710099
137200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13720099
137300             END-IF                                               13730099
137400                                                                  13740099
137500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13750099
137600                 = SPACE                                          13760099
137700             EVALUATE TRUE                                        13770099
137800                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       13780099
137900                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS13790099
138000                     MOVE SPACE    TO ASC-SELECTED-SW             13800099
138100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13810099
138200                                                                  13820099
138300                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        13830099
138400                     MOVE ZERO     TO ASC-START-OF-SELECTED-RANGE 13840099
138500                     MOVE SPACE    TO ASC-SELECTED-SW             13850099
138600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13860099
138700                                                                  13870099
138800                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          13880099
138900                     MOVE ZERO     TO ASC-END-OF-SELECTED-RANGE   13890099
139000                     MOVE SPACE    TO ASC-SELECTED-SW             13900099
139100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13910099
139200             END-EVALUATE                                         13920099
139300                                                                  13930099
139400         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           13940099
139500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13950099
139600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13960099
139700             END-IF                                               13970099
139800             PERFORM 3310-EDIT-RANGE                              13980099
139900                                                                  13990099
140000         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             14000099
140100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14010099
140200                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14020099
140300             END-IF                                               14030099
140400             PERFORM 3310-EDIT-RANGE                              14040099
140500                                                                  14050099
140600         WHEN OTHER                                               14060099
140700             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            14070099
140800             SET DP020-MSG-FATAL   TO TRUE                        14080099
140900             MOVE -1               TO MR-SELECTL (PV-SUB)         14090099
141000             SET DP030-SET-CURSOR-APPL-1                          14100099
141100                                   TO TRUE                        14110099
141200             MOVE DP015-RED        TO MR-SELECTC (PV-SUB)         14120099
141300             MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB)         14130099
141400             SET PS-ERROR          TO TRUE                        14140099
141500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14150099
141600                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     14160099
141700                 MOVE SPACE        TO ASC-SELECTED-SW             14170099
141800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14180099
141900             END-IF                                               14190099
142000     END-EVALUATE.                                                14200099
142100                                                                  14210099
142200     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             14220099
142300     SUBTRACT +1 FROM ASC-ITEM-SUB.                               14230099
142400                                                                  14240099
142500     IF  ASC-ITEM-SUB < 1                                         14250099
142600         SUBTRACT +1 FROM ASC-BLK-SUB                             14260099
142700         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                14270099
142800     END-IF.                                                      14280099
142900                                                                  14290099
143000*----------------------------------------------------------------*14300099
143100*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *14310099
143200*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *14320099
143300*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *14330099
143400*  THE ENDING.                                                   *14340099
143500*----------------------------------------------------------------*14350099
143600 3310-EDIT-RANGE.                                                 14360099
143700                                                                  14370099
143800     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                14380099
143900         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   14390099
144000             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)14400099
144100                                   TO ASC-SELECTED-SW             14410099
144200                                        (ASC-BLK-SUB ASC-ITEM-SUB)14420099
144300             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 14430099
144400         ELSE                                                     14440099
144500             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     14450099
144600                 CONTINUE                                         14460099
144700             ELSE                                                 14470099
144800*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        14480099
144900                 MOVE PC-TSYMSG-00054                             14490099
145000                                   TO DP020-MSG-NUMBER            14500099
145100                 SET DP020-MSG-FATAL                              14510099
145200                                   TO TRUE                        14520099
145300                 MOVE -1           TO MR-SELECTL (PV-SUB)         14530099
145400                 SET DP030-SET-CURSOR-APPL-1                      14540099
145500                                   TO TRUE                        14550099
145600                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         14560099
145700                 MOVE DP015-UNDERLINE                             14570099
145800                                   TO MR-SELECTH (PV-SUB)         14580099
145900                 SET PS-ERROR      TO TRUE                        14590099
146000             END-IF                                               14600099
146100         END-IF                                                   14610099
146200     ELSE                                                         14620099
146300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     14630099
146400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 14640099
146500                                   TO ASC-SELECTED-SW             14650099
146600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14660099
146700             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   14670099
146800         ELSE                                                     14680099
146900             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       14690099
147000                 CONTINUE                                         14700099
147100             ELSE                                                 14710099
147200*                -- ONLY ONE END-OF-RANGE ALLOWED --              14720099
147300                 MOVE PC-TSYMSG-00055                             14730099
147400                                   TO DP020-MSG-NUMBER            14740099
147500                 SET DP020-MSG-FATAL                              14750099
147600                                   TO TRUE                        14760099
147700                 MOVE -1           TO MR-SELECTL (PV-SUB)         14770099
147800                 SET DP030-SET-CURSOR-APPL-1                      14780099
147900                                   TO TRUE                        14790099
148000                 SET PS-ERROR      TO TRUE                        14800099
148100             END-IF                                               14810099
148200         END-IF                                                   14820099
148300     END-IF.                                                      14830099
148400                                                                  14840099
148500*----------------------------------------------------------------*14850099
148600*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *14860099
148700*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *14870099
148800*----------------------------------------------------------------*14880099
148900 3400-CHECK-RANGE-SEQUENCE.                                       14890099
149000                                                                  14900099
149100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       14910099
149200       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      14920099
149300       AND  ASC-START-OF-SELECTED-RANGE >                         14930099
149400                                         ASC-END-OF-SELECTED-RANGE14940099
149500*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                14950099
149600         MOVE PC-TSYMSG-00052      TO DP020-MSG-NUMBER            14960099
149700         SET DP020-MSG-FATAL       TO TRUE                        14970099
149800         SET PS-ERROR              TO TRUE                        14980099
149900         PERFORM 3410-POSITION-AT-ERROR                           14990099
150000     END-IF.                                                      15000099
150100                                                                  15010099
150200*----------------------------------------------------------------*15020099
150300*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *15030099
150400*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *15040099
150500*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *15050099
150600*----------------------------------------------------------------*15060099
150700 3410-POSITION-AT-ERROR.                                          15070099
150800                                                                  15080099
150900     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       15090099
151000                                                                  15100099
151100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 15110099
151200                    - PV-TOP-ITEM + 1.                            15120099
151300                                                                  15130099
151400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15140099
151500         CONTINUE                                                 15150099
151600     ELSE                                                         15160099
151700         MOVE -1                   TO MR-SELECTL (PV-SUB)         15170099
151800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15180099
151900         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15190099
152000     END-IF.                                                      15200099
152100                                                                  15210099
152200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   15220099
152300                    - PV-TOP-ITEM + 1.                            15230099
152400                                                                  15240099
152500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15250099
152600         CONTINUE                                                 15260099
152700     ELSE                                                         15270099
152800         MOVE -1                   TO MR-SELECTL (PV-SUB)         15280099
152900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15290099
153000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15300099
153100     END-IF.                                                      15310099
153200                                                                  15320099
153300/                                                                 15330099
153400*----------------------------------------------------------------*15340099
153500*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *15350099
153600*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *15360099
153700*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *15370099
153800*----------------------------------------------------------------*15380099
153900                                                                  15390099
154000 3500-MARK-RANGE-AS-SELECTED.                                     15400099
154100                                                                  15410099
154200     MOVE +1                       TO ASC-BLK-SUB.                15420099
154300                                                                  15430099
154400     PERFORM 3510-MARK-SELECTED-INDS                              15440099
154500         VARYING ASC-ITEM-SUB                                     15450099
154600         FROM 1 BY 1                                              15460099
154700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15470099
154800                                                                  15480099
154900     ADD +1                        TO ASC-BLK-SUB.                15490099
155000                                                                  15500099
155100     PERFORM 3510-MARK-SELECTED-INDS                              15510099
155200         VARYING ASC-ITEM-SUB                                     15520099
155300         FROM 1 BY 1                                              15530099
155400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15540099
155500                                                                  15550099
155600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15560099
155700                                   TO PV-LIST-ITEM-NUMBER.        15570099
155800                                                                  15580099
155900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15590099
156000         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         15600099
156100               PC-ITEMS-PER-PANEL).                               15610099
156200                                                                  15620099
156300     MOVE ASC-START-OF-SELECTED-RANGE                             15630099
156400                                   TO PV-START-OF-SELECTED-RANGE. 15640099
156500                                                                  15650099
156600     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            15660099
156700         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  15670099
156800               PC-ITEMS-PER-PANEL).                               15680099
156900                                                                  15690099
157000     MOVE ASC-END-OF-SELECTED-RANGE                               15700099
157100                                   TO PV-END-OF-SELECTED-RANGE.   15710099
157200                                                                  15720099
157300     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             15730099
157400         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    15740099
157500               PC-ITEMS-PER-PANEL).                               15750099
157600                                                                  15760099
157700     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             15770099
157800         PV-FIRST-BLOCK-IN-ARRAY + 1.                             15780099
157900                                                                  15790099
158000     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    15800099
158100        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        15810099
158200         MOVE +1                   TO ASC-BLK-SUB                 15820099
158300         PERFORM 5100-WRITE-TEMP-STORAGE                          15830099
158400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15840099
158500             PV-FIRST-BLOCK-IN-ARRAY - 1                          15850099
158600                                                                  15860099
158700         PERFORM                                                  15870099
158800             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      15880099
158900                   PV-PREV-BLOCK-IN-ARRAY                         15890099
159000             MOVE PV-FIRST-BLOCK-IN-RANGE                         15900099
159100                                   TO PV-BLOCK-NUMBER             15910099
159200             PERFORM 4410-READ-TEMP-STORAGE                       15920099
159300             PERFORM 3510-MARK-SELECTED-INDS                      15930099
159400                 VARYING ASC-ITEM-SUB                             15940099
159500                 FROM 1 BY 1                                      15950099
159600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15960099
159700             PERFORM 5100-WRITE-TEMP-STORAGE                      15970099
159800             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     15980099
159900         END-PERFORM                                              15990099
160000                                                                  16000099
160100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         16010099
160200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     16020099
160300         PERFORM                                                  16030099
160400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       16040099
160500                   PV-LAST-BLOCK-IN-RANGE                         16050099
160600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          16060099
160700                                   TO PV-BLOCK-NUMBER             16070099
160800             PERFORM 4410-READ-TEMP-STORAGE                       16080099
160900             PERFORM 3510-MARK-SELECTED-INDS                      16090099
161000                 VARYING ASC-ITEM-SUB                             16100099
161100                 FROM 1 BY 1                                      16110099
161200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16120099
161300             PERFORM 5100-WRITE-TEMP-STORAGE                      16130099
161400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16140099
161500         END-PERFORM                                              16150099
161600                                                                  16160099
161700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             16170099
161800                                   TO PV-BLOCK-NUMBER             16180099
161900         PERFORM 4410-READ-TEMP-STORAGE                           16190099
162000     END-IF.                                                      16200099
162100                                                                  16210099
162200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 16220099
162300                                      ASC-END-OF-SELECTED-RANGE.  16230099
162400                                                                  16240099
162500/                                                                 16250099
162600*----------------------------------------------------------------*16260099
162700* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *16270099
162800*----------------------------------------------------------------*16280099
162900                                                                  16290099
163000 3510-MARK-SELECTED-INDS.                                         16300099
163100                                                                  16310099
163200     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) >         16320099
163300         ASC-START-OF-SELECTED-RANGE)                             16330099
163400     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =         16340099
163500         ASC-START-OF-SELECTED-RANGE)                             16350099
163600                                                                  16360099
163700         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     16370099
163800             ASC-END-OF-SELECTED-RANGE)                           16380099
163900         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     16390099
164000             ASC-END-OF-SELECTED-RANGE)                           16400099
164100                                                                  16410099
164200             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          16420099
164300                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   16430099
164400                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   16440099
164500                                   TO TRUE                        16450099
164600                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              16460099
164700                                   TO TRUE                        16470099
164800                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS16480099
164900             END-IF                                               16490099
165000         END-IF                                                   16500099
165100     END-IF.                                                      16510099
165200                                                                  16520099
165300/                                                                 16530099
165400*----------------------------------------------------------------*16540099
165500*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *16550099
165600*    INITIALIZE ALL COUNTERS AND FLAGS.                          *16560099
165700*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *16570099
165800*    DISPLAY THE PANEL TO USER.                                  *16580099
165900*----------------------------------------------------------------*16590099
166000                                                                  16600099
166100 4000-BUILD-INITIAL-PANEL.                                        16610099
166200                                                                  16620099
166300     INITIALIZE ASC-BLOCK-ENTRIES (1)                             16630099
166400                ASC-BLOCK-ENTRIES (2).                            16640099
166500                                                                  16650099
166600     MOVE +1                       TO ASC-BLK-SUB.                16660099
166700                                                                  16670099
166800     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       16680099
166900                                                                  16690099
167000     MOVE +0                       TO ASC-ITEM-SUB                16700099
167100                                      ASC-NUMBER-OF-ITEMS-READ    16710099
167200                                      ASC-NUMBER-OF-SELECTED-ITEMS16720099
167300                                      ASC-HIGHEST-BLOCK-WRITTEN   16730099
167400                                      ASC-START-OF-SELECTED-RANGE 16740099
167500                                      ASC-END-OF-SELECTED-RANGE   16750099
167600                                      ASC-ITEM-AT-TOP-OF-PANEL.   16760099
167700                                                                  16770099
167800     PERFORM 4100-PREPARE-CURSOR.                                 16780099
167900                                                                  16790099
168000     MOVE ZEROES                   TO PV-PO-LNE-NBR.              16800099
168100                                                                  16810099
168200     PERFORM 4010-OPEN-CURSOR.                                    16820099
168300                                                                  16830099
168400     PERFORM 4300-READ-ITEMS-FROM-DB.                             16840099
168500                                                                  16850099
168600     PERFORM 4020-CLOSE-CURSOR.                                   16860099
168700                                                                  16870099
168800     MOVE +1                       TO PV-TOP-ITEM.                16880099
168900                                                                  16890099
169000     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          16900099
169100         SET DP020-NEXT-ACT-APPL-ERROR                            16910099
169200                                   TO TRUE                        16920099
169300         SET DP020-MSG-FATAL       TO TRUE                        16930099
169400         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            16940099
169500     ELSE                                                         16950099
169600         MOVE -1                   TO MR-SELECTL (1)              16960099
169700         SET DP030-SET-CURSOR-APPL-1                              16970099
169800                                   TO TRUE                        16980099
169900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     16990099
170000     END-IF.                                                      17000099
170100                                                                  17010099
170200/                                                                 17020099
170300*----------------------------------------------------------------*17030099
170400* OPEN THE PO LINE ITEM CURSOR                                   *17040099
170500*----------------------------------------------------------------*17050099
170600                                                                  17060099
170700 4010-OPEN-CURSOR.                                                17070099
170800                                                                  17080099
170900     PERFORM                                                      17090099
171000         WITH TEST AFTER                                          17100099
171100         VARYING PV-RETRY-COUNTER                                 17110099
171200         FROM 1 BY 1                                              17120099
171300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17130099
171400            OR (SQLCODE = +0))                                    17140099
171500                                                                  17150099
171600         EXEC SQL                                                 17160099
171700             OPEN PREPACK-CSR                                     17170099
171800         END-EXEC                                                 17180099
171900                                                                  17190099
172000         EVALUATE TRUE                                            17200099
172100             WHEN SQLCODE = +0                                    17210099
172200                  CONTINUE                                        17220099
172300             WHEN SQLCODE = -904                                  17230099
172400             WHEN SQLCODE = -913                                  17240099
172500                  CONTINUE                                        17250099
172600             WHEN SQLWARN0 NOT = SPACE                            17260099
172700             WHEN SQLCODE  NOT = +0                               17270099
172800                  MOVE '4010-OPEN-CURSOR'                         17280099
172900                                   TO DP013-PARAGRAPH             17290099
173000                  MOVE 'OPEN PREPACK-CSR CURSOR'                  17300099
173100                                   TO DP013-MESSAGE-TEXT (1)      17310099
173200                  MOVE SQLCA       TO DP013-SQLCA                 17320099
173300                  MOVE 'TPOPRPK'   TO DP013-DB2-TABLE-NAME (1)    17330099
173400                  SET DP013-DB2-ABEND                             17340099
173500                                   TO TRUE                        17350099
173600                  PERFORM DP013-0000-PROCESS-ABEND                17360099
173700         END-EVALUATE                                             17370099
173800     END-PERFORM.                                                 17380099
173900                                                                  17390099
174000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17400099
174100         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             17410099
174200         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              17420099
174300                                   TO DP013-MESSAGE-TEXT (1)      17430099
174400         MOVE SQLCA                TO DP013-SQLCA                 17440099
174500         SET DP013-DB2-ABEND       TO TRUE                        17450099
174600         PERFORM DP013-0000-PROCESS-ABEND                         17460099
174700     END-IF.                                                      17470099
174800                                                                  17480099
174900/                                                                 17490099
175000*----------------------------------------------------------------*17500099
175100* CLOSE THE PO LINE ITEM CURSOR                                  *17510099
175200*----------------------------------------------------------------*17520099
175300                                                                  17530099
175400 4020-CLOSE-CURSOR.                                               17540099
175500                                                                  17550099
175600      EXEC SQL                                                    17560099
175700           CLOSE PREPACK-CSR                                      17570099
175800      END-EXEC                                                    17580099
175900                                                                  17590099
176000     EVALUATE TRUE                                                17600099
176100         WHEN SQLCODE = +0                                        17610099
176200              CONTINUE                                            17620099
176300                                                                  17630099
176400         WHEN SQLWARN0 NOT = SPACE                                17640099
176500         WHEN SQLCODE  NOT = +0                                   17650099
176600              MOVE '4020-CLOSE-CURSOR'                            17660099
176700                                   TO DP013-PARAGRAPH             17670099
176800              MOVE 'CLOSE PREPACK-CSR CURSOR'                     17680099
176900                                   TO DP013-MESSAGE-TEXT (1)      17690099
177000              MOVE SQLCA           TO DP013-SQLCA                 17700099
177100              MOVE 'TPOPRPK'       TO DP013-DB2-TABLE-NAME (1)    17710099
177200              SET DP013-DB2-ABEND  TO TRUE                        17720099
177300              PERFORM DP013-0000-PROCESS-ABEND                    17730099
177400     END-EVALUATE.                                                17740099
177500                                                                  17750099
177600/                                                                 17760099
177700*----------------------------------------------------------------*17770099
177800*    DEPENDING ON WHAT WAS PASSED IN THE COMMAREA, SETUP THE     *17780099
177900*    DB2 KEYS IN PREPARATION FOR THE OPEN CURSROR.               *17790099
178000*----------------------------------------------------------------*17800099
178100                                                                  17810099
178200 4100-PREPARE-CURSOR.                                             17820099
178300                                                                  17830099
178400     MOVE ASC-KEY-PO-NBR         TO DK-PO-NBR.                    17840099
178500                                                                  17850099
178600/                                                                 17860099
178700*----------------------------------------------------------------*17870099
178800*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *17880099
178900*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *17890099
179000*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *17900099
179100*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *17910099
179200*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *17920099
179300*                                                                *17930099
179400*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *17940099
179500*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *17950099
179600*    UPON INITIALIZATION.                                        *17960099
179700*----------------------------------------------------------------*17970099
179800                                                                  17980099
179900 4300-READ-ITEMS-FROM-DB.                                         17990099
180000                                                                  18000099
180100     PERFORM                                                      18010099
180200         VARYING PV-READ-COUNT                                    18020099
180300         FROM 1 BY 1                                              18030099
180400         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    18040099
180500            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         18050099
180600                                                                  18060099
180700         PERFORM 4310-FETCH                                       18070099
180800                                                                  18080099
180900         PERFORM 4313-CHECK-UNCONFIRMED-PACKS                     18090099
181000                                                                  18100099
181100         PERFORM 4311-GET-TOTAL-UNITS                             18110099
181200                                                                  18120099
181300         PERFORM 4312-GET-UNITS-PER-CRTN                          18130099
181400         IF POPRPK-PREPK-TYP-CDE = 'M'                            18140099
181500            ADD PV-SUM-PREPK-RATO-QTY TO PV-TOT-UNT-PER-CTN       18150099
181600         END-IF                                                   18160099
181700         IF POPRPK-PREPK-TYP-CDE = 'I'                            18170099
181800            MOVE POPRPK-OTPK-UNT-QTY TO PV-TOT-UNT-PER-CTN        18180099
181900*           MULTIPLY PV-SUM-PREPK-RATO-QTY BY POPRPK-INPK-UNT-QTY 18190099
182000*           GIVING PV-TOT-UNT-PER-CTN                             18200099
182100         END-IF                                                   18210099
182200                                                                  18220099
182300         IF  ASC-ITEMS-LEFT-ON-DB                                 18230099
182400             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                18240099
182500                 ADD +1            TO ASC-ITEM-SUB                18250099
182600             ELSE                                                 18260099
182700                 ADD +1            TO ASC-BLK-SUB                 18270099
182800                 MOVE +1           TO ASC-ITEM-SUB                18280099
182900                                                                  18290099
183000                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         18300099
183100                     MOVE +1       TO ASC-BLK-SUB                 18310099
183200                     SET ASC-BLOCK-MODIFIED (1)                   18320099
183300                                   TO TRUE                        18330099
183400                     PERFORM 5100-WRITE-TEMP-STORAGE              18340099
183500                     MOVE ASC-BLOCK-ENTRIES                       18350099
183600                               (PC-MAX-BLOCKS-IN-ARRAY)           18360099
183700                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 18370099
183800                     ADD +1        TO ASC-BLK-SUB                 18380099
183900                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   18390099
184000                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      18400099
184100                                   TO TRUE                        18410099
184200                 END-IF                                           18420099
184300             END-IF                                               18430099
184400             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    18440099
184500             MOVE ASC-NUMBER-OF-ITEMS-READ                        18450099
184600                                   TO ASC-LIST-ITEM-NUMBER        18460099
184700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18470099
184800             MOVE POPRPK-PO-PREPK-ID                              18480099
184900                                   TO ASC-PACK-ID                 18490099
185000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18500099
185100             MOVE POPRPK-PREPK-DESC                               18510099
185200                                   TO ASC-PACK-DESC               18520099
185300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18530099
185400             EVALUATE TRUE                                        18540099
185500                 WHEN POPRPK-PREPK-STAT-CDE = 'C'                 18550099
185600                       MOVE 'CN' TO ASC-STAT-CDE                  18560099
185700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18570099
185800                 WHEN POPRPK-PREPK-STAT-CDE = 'R'                 18580099
185900                       MOVE 'RV' TO ASC-STAT-CDE                  18590099
186000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18600099
186100                 WHEN POPRPK-PREPK-STAT-CDE = 'A'                 18610099
186200                       MOVE 'AC' TO ASC-STAT-CDE                  18620099
186300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18630099
186400                 WHEN OTHER                                       18640099
186500                       MOVE POPRPK-PREPK-STAT-CDE TO ASC-STAT-CDE 18650099
186600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18660099
186700             END-EVALUATE                                         18670099
186800             IF POPRPK-PREPK-TYP-CDE = 'M'                        18680099
186900                MOVE 0 TO PV-INNER-PACK-TOTAL                     18690099
187000             ELSE                                                 18700099
187100                COMPUTE PV-INNER-PACK-TOTAL =                     18710099
187200                     POPRPK-OTPK-UNT-QTY / POPRPK-INPK-UNT-QTY    18720099
187300             END-IF                                               18730099
187400             MOVE PV-INNER-PACK-TOTAL                             18740099
187500                                   TO ASC-INNER-PACK              18750099
187600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18760099
187700             ADD PV-INNER-PACK-TOTAL TO ASC-TOT-INNER-PK          18770099
187800             IF POPRPK-PREPK-TYP-CDE = 'M'                        18780099
187900*DMH            MOVE PURITM-PREPK-RATO-QTY                        18790099
187910                MOVE PV-SUM-PREPK-RATO-QTY                        18791099
188000                                   TO ASC-UNITS-PER-CTN           18800099
188100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18810099
188200             ELSE                                                 18820099
188300                MOVE POPRPK-OTPK-UNT-QTY                          18830099
188400                                   TO ASC-UNITS-PER-CTN           18840099
188500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18850099
188600             END-IF                                               18860099
188700*DMH         ADD PURITM-PREPK-RATO-QTY TO ASC-TOT-UNT-PER-CTN     18870099
188710             ADD PV-SUM-PREPK-RATO-QTY TO ASC-TOT-UNT-PER-CTN     18871099
188800             MOVE POPRPK-OTPK-ORD-QTY                             18880099
188900                                   TO ASC-TOTAL-CRTNS             18890099
189000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18900099
189100             ADD POPRPK-OTPK-ORD-QTY TO ASC-TOT-TOTAL-CRTNS       18910099
189200             MOVE PURITM-UNT-QTY   TO ASC-TOTAL-UNITS             18920099
189300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18930099
189400             ADD PURITM-UNT-QTY    TO ASC-TOT-TOTAL-UNITS         18940099
189500         END-IF                                                   18950099
189600     END-PERFORM.                                                 18960099
189700                                                                  18970099
189800     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          18980099
189900         MOVE +1                   TO ASC-BLK-SUB                 18990099
190000         PERFORM 5100-WRITE-TEMP-STORAGE                          19000099
190100         ADD +1                    TO ASC-BLK-SUB                 19010099
190200         PERFORM 5100-WRITE-TEMP-STORAGE                          19020099
190300                                                                  19030099
190400         MOVE 1                    TO ASC-BLK-SUB                 19040099
190500                                      PV-BLOCK-NUMBER             19050099
190600         PERFORM 4410-READ-TEMP-STORAGE                           19060099
190700         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             19070099
190800             MOVE 2                TO ASC-BLK-SUB                 19080099
190900                                      PV-BLOCK-NUMBER             19090099
191000             PERFORM 4410-READ-TEMP-STORAGE                       19100099
191100         END-IF                                                   19110099
191200     END-IF.                                                      19120099
191300                                                                  19130099
191400/                                                                 19140099
191500*----------------------------------------------------------------*19150099
191600*    FETCH A VENDOR ROW                                          *19160099
191700*----------------------------------------------------------------*19170099
191800                                                                  19180099
191900 4310-FETCH.                                                      19190099
192000                                                                  19200099
192100     EXEC SQL                                                     19210099
192200          FETCH PREPACK-CSR                                       19220099
192300          INTO :POPRPK-PREPK-TYP-CDE                              19230099
192400              ,:POPRPK-PO-PREPK-ID                                19240099
192500              ,:POPRPK-PREPK-DESC                                 19250099
192600              ,:POPRPK-PREPK-STAT-CDE                             19260099
192700              ,:POPRPK-INPK-UNT-QTY                               19270099
192800              ,:POPRPK-OTPK-UNT-QTY                               19280099
192900              ,:POPRPK-OTPK-ORD-QTY                               19290099
193000     END-EXEC                                                     19300099
193100                                                                  19310099
193200     EVALUATE TRUE                                                19320099
193300         WHEN SQLCODE = +0                                        19330099
193400              MOVE POPRPK-PREPK-TYP-CDE TO ASC-KEY-PACK-TYPE      19340099
193500         WHEN SQLCODE = +100                                      19350099
193600              SET ASC-NO-ITEMS-LEFT-ON-DB                         19360099
193700                                   TO TRUE                        19370099
193800         WHEN SQLWARN0 NOT = SPACE                                19380099
193900         WHEN SQLCODE < +0                                        19390099
194000         WHEN SQLCODE > +0                                        19400099
194100              MOVE '4310-FETCH-CURSOR'                            19410099
194200                                   TO DP013-PARAGRAPH             19420099
194300              MOVE 'FETCH PREPACK CURSOR'                         19430099
194400                                   TO DP013-MESSAGE-TEXT (1)      19440099
194500              MOVE SQLCA           TO DP013-SQLCA                 19450099
194600              MOVE 'TPOPRPK'       TO DP013-DB2-TABLE-NAME (1)    19460099
194700              SET DP013-DB2-ABEND  TO TRUE                        19470099
194800              PERFORM DP013-0000-PROCESS-ABEND                    19480099
194900     END-EVALUATE.                                                19490099
195000                                                                  19500099
195100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        19510099
195200         MOVE '4310-FETCH-CURSOR'  TO DP013-PARAGRAPH             19520099
195300         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             19530099
195400                                   TO DP013-MESSAGE-TEXT (1)      19540099
195500         MOVE SQLCA                TO DP013-SQLCA                 19550099
195600         SET DP013-DB2-ABEND                                      19560099
195700             DP013-XCTL-DISPLAY-RESTART                           19570099
195800                                   TO TRUE                        19580099
195900         PERFORM DP013-0000-PROCESS-ABEND                         19590099
196000     END-IF.                                                      19600099
196100                                                                  19610099
196200/                                                                 19620099
196300*----------------------------------------------------------------*19630099
196400* GET TOTAL UNITS                                                *19640099
196500*----------------------------------------------------------------*19650099
196600                                                                  19660099
196700 4311-GET-TOTAL-UNITS.                                            19670099
196800                                                                  19680099
196900      EXEC SQL                                                    19690099
197000           SELECT  SUM(UNT_QTY)                                   19700099
197100             INTO :PURITM-UNT-QTY:PV-NULL-IND                     19710099
197200             FROM  TPURITM                                        19720099
197300            WHERE  PO_NBR = :ASC-KEY-PO-NBR                       19730099
197400              AND  PO_PREPK_ID = :POPRPK-PO-PREPK-ID              19740099
197500              AND  VER_STATUS_CDE = 'A'                           19750099
197600      END-EXEC.                                                   19760099
197700                                                                  19770099
197800     EVALUATE TRUE                                                19780099
197900         WHEN SQLCODE = +0                                        19790099
198000              ADD PURITM-UNT-QTY TO PV-TOT-TOTAL-UNITS            19800099
198100         WHEN SQLWARN0 NOT = SPACE                                19810099
198200         WHEN SQLCODE < +0                                        19820099
198300         WHEN SQLCODE > +0                                        19830099
198400              MOVE '4311-GET-TOTAL-UNITS '                        19840099
198500                                   TO DP013-PARAGRAPH             19850099
198600              MOVE 'UNSUCCESSFUL SELECT ON TPURITM'               19860099
198700                                   TO DP013-MESSAGE-TEXT (1)      19870099
198800              MOVE SQLCA           TO DP013-SQLCA                 19880099
198900              MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (1)    19890099
199000              SET DP013-DB2-ABEND  TO TRUE                        19900099
199100              PERFORM DP013-0000-PROCESS-ABEND                    19910099
199200     END-EVALUATE.                                                19920099
199300                                                                  19930099
199400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        19940099
199500         MOVE '4311-GET-TOTAL-UNITS'  TO DP013-PARAGRAPH          19950099
199600         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             19960099
199700                                   TO DP013-MESSAGE-TEXT (1)      19970099
199800         MOVE SQLCA                TO DP013-SQLCA                 19980099
199900         SET DP013-DB2-ABEND                                      19990099
200000             DP013-XCTL-DISPLAY-RESTART                           20000099
200100                                   TO TRUE                        20010099
200200         PERFORM DP013-0000-PROCESS-ABEND                         20020099
200300     END-IF.                                                      20030099
200400                                                                  20040099
200500 4312-GET-UNITS-PER-CRTN.                                         20050099
200600      EXEC SQL                                                    20060099
200700           SELECT  SUM(PREPK_RATO_QTY)                            20070099
200800             INTO :PV-SUM-PREPK-RATO-QTY    :PV-NULL-IND          20080099
200900             FROM  TPURITM                                        20090099
201000            WHERE  PO_NBR = :ASC-KEY-PO-NBR                       20100099
201100              AND  PO_PREPK_ID = :POPRPK-PO-PREPK-ID              20110099
201200              AND  VER_STATUS_CDE = 'A'                           20120099
201300      END-EXEC.                                                   20130099
201400                                                                  20140099
201500     EVALUATE TRUE                                                20150099
201600         WHEN SQLCODE = +0                                        20160099
201700*DMH          MOVE PURITM-PREPK-RATO-QTY TO PV-SUM-PREPK-RATO-QTY 20170099
201710              CONTINUE                                            20171099
201800         WHEN SQLWARN0 NOT = SPACE                                20180099
201900         WHEN SQLCODE < +0                                        20190099
202000         WHEN SQLCODE > +0                                        20200099
202100              MOVE '4312-GET-UNITS-PER-CRTN'                      20210099
202200                                  TO DP013-PARAGRAPH              20220099
202300              MOVE 'UNSUCCESSFUL SELECT ON TPURITM'               20230099
202400                                  TO DP013-MESSAGE-TEXT (1)       20240099
202500              MOVE SQLCA           TO DP013-SQLCA                 20250099
202600             MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (1)     20260099
202700              SET DP013-DB2-ABEND  TO TRUE                        20270099
202800             PERFORM DP013-0000-PROCESS-ABEND                     20280099
202900     END-EVALUATE.                                                20290099
203000                                                                  20300099
203100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        20310099
203200        MOVE '4312-GET-UNITS-PER-CRTN'  TO DP013-PARAGRAPH        20320099
203300         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             20330099
203400                                  TO DP013-MESSAGE-TEXT (1)       20340099
203500         MOVE SQLCA                TO DP013-SQLCA                 20350099
203600        SET DP013-DB2-ABEND                                       20360099
203700             DP013-XCTL-DISPLAY-RESTART                           20370099
203800                                  TO TRUE                         20380099
203900         PERFORM DP013-0000-PROCESS-ABEND                         20390099
204000     END-IF.                                                      20400099
204100                                                                  20410099
204200 4313-CHECK-UNCONFIRMED-PACKS.                                    20420099
204300                                                                  20430099
204400     PERFORM                                                      20440099
204500         WITH TEST AFTER                                          20450099
204600         VARYING PV-RETRY-COUNTER                                 20460099
204700         FROM 1 BY 1                                              20470099
204800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               20480099
204900            OR (SQLCODE = +0))                                    20490099
205000                                                                  20500099
205100     EXEC SQL                                                     20510099
205200          SELECT COUNT(*)                                         20520099
205300          INTO    :PV-RV-COUNT                                    20530099
205400          FROM    TPURITM                                         20540099
205500          WHERE   PO_NBR = :ASC-KEY-PO-NBR                        20550099
205600            AND   STATUS_CDE = 'RV'                               20560099
205700            AND   VER_STATUS_CDE = 'A'                            20570099
205800     END-EXEC                                                     20580099
205900                                                                  20590099
206000      EVALUATE TRUE                                               20600099
206100          WHEN SQLCODE = 0                                        20610099
206200              IF PV-RV-COUNT > 0                                  20620099
206300*               -- PURCHASE ORDER HAS UNCONFIRMED PACKS --        20630099
206400                 MOVE PC-TSYMSG-02761 TO DP020-MSG-NUMBER         20640099
206500                 SET DP020-MSG-WARNING TO TRUE                    20650099
206600                 SET ASC-UNCONFIRMED-PACKS TO TRUE                20660099
206700              END-IF                                              20670099
206800          WHEN SQLCODE = -904                                     20680099
206900          WHEN SQLCODE = -913                                     20690099
207000               CONTINUE                                           20700099
207100          WHEN SQLWARN0 NOT = SPACES                              20710099
207200          WHEN SQLCODE < +0                                       20720099
207300          WHEN SQLCODE > +0                                       20730099
207400               MOVE '4313-CHECK-UNCONFIRMED-PACKS'                20740099
207500                                 TO DP013-PARAGRAPH               20750099
207600               MOVE 'UNSUCCESSFUL COUNT OF RV STATUS CODES'       20760099
207700                                 TO DP013-MESSAGE-TEXT (1)        20770099
207800               MOVE SQLCA        TO DP013-SQLCA                   20780099
207900               MOVE 'TPURITM '   TO DP013-DB2-TABLE-NAME (1)      20790099
208000               SET DP013-DB2-ABEND                                20800099
208100                   DP013-XCTL-DISPLAY-RESTART                     20810099
208200                                 TO TRUE                          20820099
208300               PERFORM DP013-0000-PROCESS-ABEND                   20830099
208400      END-EVALUATE                                                20840099
208500     END-PERFORM.                                                 20850099
208600                                                                  20860099
208700     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         20870099
208800        MOVE '4313-CHECK-UNCONFIRMED-PACKS' TO DP013-PARAGRAPH    20880099
208900        MOVE 'MAX RETRIES EXCEEDED FOR RV STATUS CODE COUNT'      20890099
209000                                 TO DP013-MESSAGE-TEXT (1)        20900099
209100        MOVE SQLCA               TO DP013-SQLCA                   20910099
209200        MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (1)      20920099
209300        SET DP013-DB2-ABEND                                       20930099
209400            DP013-XCTL-DISPLAY-RESTART                            20940099
209500                                 TO TRUE                          20950099
209600        PERFORM DP013-0000-PROCESS-ABEND                          20960099
209700     END-IF.                                                      20970099
209800                                                                  20980099
209900*----------------------------------------------------------------*20990099
210000* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *21000099
210100*----------------------------------------------------------------*21010099
210200                                                                  21020099
210300 4400-MOVE-COMMAREA-TO-SCREEN.                                    21030099
210400                                                                  21040099
210500     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             21050099
210600         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          21060099
210700         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          21070099
210800             MOVE +1               TO ASC-BLK-SUB                 21080099
210900             PERFORM 5100-WRITE-TEMP-STORAGE                      21090099
211000             ADD +1                TO ASC-BLK-SUB                 21100099
211100             PERFORM 5100-WRITE-TEMP-STORAGE                      21110099
211200             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             21120099
211300                 GIVING PV-BLOCK-NUMBER                           21130099
211400                 REMAINDER PV-REMAINDER                           21140099
211500             IF  PV-REMAINDER > ZERO                              21150099
211600                 ADD +1            TO PV-BLOCK-NUMBER             21160099
211700             END-IF                                               21170099
211800             MOVE +1               TO ASC-BLK-SUB                 21180099
211900             PERFORM 4410-READ-TEMP-STORAGE                       21190099
212000             ADD +1                TO ASC-BLK-SUB                 21200099
212100                                      PV-BLOCK-NUMBER             21210099
212200             PERFORM 4410-READ-TEMP-STORAGE                       21220099
212300     END-IF.                                                      21230099
212400                                                                  21240099
212500     MOVE +1                       TO ASC-BLK-SUB.                21250099
212600                                                                  21260099
212700     COMPUTE ASC-ITEM-SUB =                                       21270099
212800         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              21280099
212900         + PC-ITEMS-PER-PANEL).                                   21290099
213000                                                                  21300099
213100     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        21310099
213200         ADD +1                    TO ASC-BLK-SUB                 21320099
213300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            21330099
213400     END-IF.                                                      21340099
213500                                                                  21350099
213600     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           21360099
213700         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                21370099
213800                                                                  21380099
213900     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        21390099
214000     PERFORM 4420-FORMAT-LIST-LINES                               21400099
214100         VARYING PV-SUB                                           21410099
214200         FROM PC-ITEMS-PER-PANEL BY -1                            21420099
214300         UNTIL PV-SUB < +1.                                       21430099
214400                                                                  21440099
214500     COMPUTE ASC-ITEMS-DISPLAYED =                                21450099
214600         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          21460099
214700                                                                  21470099
214800     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    21480099
214900                                      ASTRTITO.                   21490099
215000                                                                  21500099
215100     MOVE ASC-KEY-PO-NBR           TO MR-PO-NBR.                  21510099
215200     IF PO013-PO-PKGNG-CDE > SPACES                               21520099
215300        MOVE PO013-PO-PKGNG-CDE       TO MR-PACK-TYPE             21530099
215400     END-IF                                                       21540099
215500     IF POPRPK-PREPK-TYP-CDE > SPACES                             21550099
215600        MOVE POPRPK-PREPK-TYP-CDE     TO MR-PACK-TYPE             21560099
215700     END-IF                                                       21570099
215800     IF MR-PACK-TYPE = SPACES                                     21580099
215900        MOVE ASC-KEY-PACK-TYPE TO MR-PACK-TYPE                    21590099
216000     END-IF                                                       21600099
216100                                                                  21610099
216200     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    21620099
216300     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    21630099
216400     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            21640099
216500                                   TO ASELITO.                    21650099
216600                                                                  21660099
216700     MOVE ASC-TOT-INNER-PK         TO ATINPKO.                    21670099
216800     MOVE ASC-TOT-UNT-PER-CTN      TO ATUPCTO.                    21680099
216900     MOVE ASC-TOT-TOTAL-CRTNS      TO ATCTNSO.                    21690099
217000     MOVE ASC-TOT-TOTAL-UNITS      TO ATUNTSO.                    21700099
217100                                                                  21710099
217200     IF  DP020-MSG-NUMBER-X = SPACE                               21720099
217300         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  21730099
217400*            --- MORE ITEMS TO DISPLAY ----                       21740099
217500             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            21750099
217600             SET DP020-MSG-INFORMATIONAL                          21760099
217700                                   TO TRUE                        21770099
217800         END-IF                                                   21780099
217900     END-IF.                                                      21790099
218000                                                                  21800099
218100*----------------------------------------------------------------*21810099
218200*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *21820099
218300*----------------------------------------------------------------*21830099
218400                                                                  21840099
218500 4410-READ-TEMP-STORAGE.                                          21850099
218600                                                                  21860099
218700     EXEC CICS                                                    21870099
218800         READQ TS                                                 21880099
218900             QUEUE (ASC-LIST-QUEUE-NAME)                          21890099
219000             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21900099
219100             ITEM  (PV-BLOCK-NUMBER)                              21910099
219200             RESP  (PV-CICS-RESP)                                 21920099
219300     END-EXEC.                                                    21930099
219400                                                                  21940099
219500     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       21950099
219600       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     21960099
219700         CONTINUE                                                 21970099
219800     ELSE                                                         21980099
219900         SET DP013-CICS-ABEND      TO TRUE                        21990099
220000         SET DP013-NO-ROLLBACK     TO TRUE                        22000099
220100         MOVE '4410-READ-TEMP-STORAGE'                            22010099
220200                                   TO DP013-PARAGRAPH             22020099
220300         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      22030099
220400                                   TO DP013-MESSAGE-TEXT(1)       22040099
220500         PERFORM DP013-0000-PROCESS-ABEND                         22050099
220600     END-IF.                                                      22060099
220700                                                                  22070099
220800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      22080099
220900                                   TO TRUE.                       22090099
221000                                                                  22100099
221100     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         22110099
221200         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               22120099
221300     END-IF.                                                      22130099
221400                                                                  22140099
221500/                                                                 22150099
221600*----------------------------------------------------------------*22160099
221700*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *22170099
221800*----------------------------------------------------------------*22180099
221900                                                                  22190099
222000 4420-FORMAT-LIST-LINES.                                          22200099
222100                                                                  22210099
222200     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      22220099
222300         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                22230099
222400         MOVE DP015-ASK-DRK-OFF    TO MR-SELECTA (PV-SUB)         22240099
222500         MOVE SPACES               TO MR-PO-NBR-X                 22250099
222600                                      MR-PACK-TYPE                22260099
222700                                      MR-SELECT  (PV-SUB)         22270099
222800                                      MR-PACK-ID-X (PV-SUB)       22280099
222900                                      MR-PACK-DESC (PV-SUB)       22290099
223000                                      MR-STAT-CDE  (PV-SUB)       22300099
223100                                      MR-INNER-PACK-X (PV-SUB)    22310099
223200                                      MR-UNITS-PER-CTN-X (PV-SUB) 22320099
223300                                      MR-TOTAL-CRTNS-X (PV-SUB)   22330099
223400                                      MR-TOTAL-UNITS-X (PV-SUB)   22340099
223500     ELSE                                                         22350099
223600         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      22360099
223700                                                   > SPACE        22370099
223800             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 22380099
223900                                   TO MR-SELECT (PV-SUB)          22390099
224000         ELSE                                                     22400099
224100             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      22410099
224200                                   TO MR-SELECT (PV-SUB)          22420099
224300         END-IF                                                   22430099
224400                                                                  22440099
224500         IF  DP030-SET-CURSOR-TRAILER                             22450099
224600             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)22460099
224700                 > SPACE)                                         22470099
224800               OR (PV-SUB = 1))                                   22480099
224900                SET DP030-SET-CURSOR-APPL-1 TO TRUE               22490099
225000                MOVE -1            TO MR-SELECTL (PV-SUB)         22500099
225100             END-IF                                               22510099
225200         END-IF                                                   22520099
225300                                                                  22530099
225400         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           22540099
225500             MOVE ASC-PACK-ID  (ASC-BLK-SUB ASC-ITEM-SUB)         22550099
225600                                   TO MR-PACK-ID (PV-SUB)         22560099
225700             MOVE ASC-PACK-DESC (ASC-BLK-SUB ASC-ITEM-SUB)        22570099
225800                                   TO MR-PACK-DESC (PV-SUB)       22580099
225900             MOVE ASC-STAT-CDE  (ASC-BLK-SUB ASC-ITEM-SUB)        22590099
226000                                   TO MR-STAT-CDE  (PV-SUB)       22600099
226100             MOVE ASC-INNER-PACK (ASC-BLK-SUB ASC-ITEM-SUB)       22610099
226200                                   TO MR-INNER-PACK (PV-SUB)      22620099
226300             MOVE ASC-UNITS-PER-CTN (ASC-BLK-SUB ASC-ITEM-SUB)    22630099
226400                                   TO MR-UNITS-PER-CTN (PV-SUB)   22640099
226500             MOVE ASC-TOTAL-CRTNS (ASC-BLK-SUB ASC-ITEM-SUB)      22650099
226600                                   TO MR-TOTAL-CRTNS (PV-SUB)     22660099
226700             MOVE ASC-TOTAL-UNITS (ASC-BLK-SUB ASC-ITEM-SUB)      22670099
226800                                   TO MR-TOTAL-UNITS (PV-SUB)     22680099
226900         END-IF                                                   22690099
227000     END-IF.                                                      22700099
227100                                                                  22710099
227200     SUBTRACT +1 FROM ASC-ITEM-SUB.                               22720099
227300                                                                  22730099
227400     IF  ASC-ITEM-SUB < + 1                                       22740099
227500         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                22750099
227600         MOVE +1                   TO ASC-BLK-SUB                 22760099
227700     END-IF.                                                      22770099
227800                                                                  22780099
227900*----------------------------------------------------------------*22790099
228000*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *22800099
228100*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *22810099
228200*  ISSUE A WARNING.                                              *22820099
228300*----------------------------------------------------------------*22830099
228400 4430-CHECK-FOR-BEGIN-AND-END.                                    22840099
228500                                                                  22850099
228600     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       22860099
228700         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     22870099
228800*            -- NO END-OF-RANGE SPECFIED ---                      22880099
228900             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            22890099
229000             SET DP020-MSG-WARNING TO TRUE                        22900099
229100             PERFORM 4431-POSITION-AT-WARNING                     22910099
229200         END-IF                                                   22920099
229300     ELSE                                                         22930099
229400         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     22940099
229500*            -- NO BEGINNING-OF-RANGE SPECFIED ---                22950099
229600             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            22960099
229700             SET DP020-MSG-WARNING TO TRUE                        22970099
229800             PERFORM 4431-POSITION-AT-WARNING                     22980099
229900         END-IF                                                   22990099
230000     END-IF.                                                      23000099
230100                                                                  23010099
230200*----------------------------------------------------------------*23020099
230300*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *23030099
230400*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *23040099
230500*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *23050099
230600*  POSITION THE CURSOR THERE.                                    *23060099
230700*----------------------------------------------------------------*23070099
230800 4431-POSITION-AT-WARNING.                                        23080099
230900                                                                  23090099
231000     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 23100099
231100                    - PV-TOP-ITEM + 1.                            23110099
231200                                                                  23120099
231300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23130099
231400         CONTINUE                                                 23140099
231500     ELSE                                                         23150099
231600         SET DP030-SET-CURSOR-APPL-1                              23160099
231700                                   TO TRUE                        23170099
231800         MOVE -1                   TO MR-SELECTL (PV-SUB)         23180099
231900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         23190099
232000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         23200099
232100     END-IF.                                                      23210099
232200                                                                  23220099
232300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   23230099
232400                    - PV-TOP-ITEM + 1.                            23240099
232500                                                                  23250099
232600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23260099
232700         CONTINUE                                                 23270099
232800     ELSE                                                         23280099
232900         SET DP030-SET-CURSOR-APPL-1                              23290099
233000                                   TO TRUE                        23300099
233100         MOVE -1                   TO MR-SELECTL (PV-SUB)         23310099
233200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         23320099
233300         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         23330099
233400     END-IF.                                                      23340099
233500                                                                  23350099
233600/                                                                 23360099
233700*----------------------------------------------------------------*23370099
233800* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *23380099
233900* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *23390099
234000* FOR THE SELECTED ITEMS QUEUE.                                  *23400099
234100*                                                                *23410099
234200* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *23420099
234300* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *23430099
234400* THE ARRAY IS FULL.                                             *23440099
234500*----------------------------------------------------------------*23450099
234600                                                                  23460099
234700 5000-PREPARE-SEL-QUEUE.                                          23470099
234800                                                                  23480099
234900     MOVE +1                       TO ASC-BLK-SUB.                23490099
235000     PERFORM 5100-WRITE-TEMP-STORAGE.                             23500099
235100     ADD +1                        TO ASC-BLK-SUB.                23510099
235200     PERFORM 5100-WRITE-TEMP-STORAGE.                             23520099
235300                                                                  23530099
235400     MOVE ASC-SEL-QUEUE-NAME       TO PO013-SEL-QUEUE-NAME.       23540099
235500     PERFORM 6010-DELETE-SEL-QUEUE.                               23550099
235600                                                                  23560099
235700     IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                      23570099
235800         SET ASC-UPDATE-TSQ        TO TRUE                        23580099
235900     END-IF.                                                      23590099
236000                                                                  23600099
236100     SET PO012-IDX                 TO 1.                          23610099
236200     MOVE ZERO                     TO PO013-NUMBER-OF-TS-ITEMS.   23620099
236300     INITIALIZE PO012-SELECTED-ITEM-ARRAY.                        23630099
236400                                                                  23640099
236500     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           23650099
236600             VARYING PV-ITEM                                      23660099
236700             FROM 1 BY 1                                          23670099
236800             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     23680099
236900                                                                  23690099
237000     IF  PO012-IDX > 1                                            23700099
237100         PERFORM 5205-WRITE-SEL-QUEUE                             23710099
237200         ADD +1                    TO PO013-NUMBER-OF-TS-ITEMS    23720099
237300     END-IF.                                                      23730099
237400                                                                  23740099
237500/                                                                 23750099
237600*----------------------------------------------------------------*23760099
237700*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *23770099
237800*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *23780099
237900*----------------------------------------------------------------*23790099
238000                                                                  23800099
238100 5100-WRITE-TEMP-STORAGE.                                         23810099
238200                                                                  23820099
238300     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     23830099
238400                                   TO PV-LIST-ITEM-NUMBER.        23840099
238500     COMPUTE PV-BLOCK-NUMBER =                                    23850099
238600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    23860099
238700                                                                  23870099
238800     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             23880099
238900     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             23890099
239000         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      23900099
239100             PERFORM 5105-REWRITE-ASC-LISTQ                       23910099
239200         END-IF                                                   23920099
239300     ELSE                                                         23930099
239400         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       23940099
239500         ASC-HIGHEST-BLOCK-WRITTEN + 1                            23950099
239600         PERFORM 5110-WRITE-ASC-LISTQ                             23960099
239700         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   23970099
239800     END-IF.                                                      23980099
239900                                                                  23990099
240000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      24000099
240100                                   TO TRUE.                       24010099
240200                                                                  24020099
240300/                                                                 24030099
240400*----------------------------------------------------------------*24040099
240500*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *24050099
240600*  SPECIFIC COMMAREA.                                            *24060099
240700*----------------------------------------------------------------*24070099
240800 5105-REWRITE-ASC-LISTQ.                                          24080099
240900                                                                  24090099
241000     EXEC CICS                                                    24100099
241100         WRITEQ TS                                                24110099
241200             QUEUE (ASC-LIST-QUEUE-NAME)                          24120099
241300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24130099
241400             ITEM  (PV-BLOCK-NUMBER)                              24140099
241500             REWRITE                                              24150099
241600             RESP  (PV-CICS-RESP)                                 24160099
241700     END-EXEC.                                                    24170099
241800                                                                  24180099
241900     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           24190099
242000         CONTINUE                                                 24200099
242100     ELSE                                                         24210099
242200         SET DP013-CICS-ABEND      TO TRUE                        24220099
242300         SET DP013-NO-ROLLBACK     TO TRUE                        24230099
242400         MOVE '5105-REWRITE-ASC-LISTQ'                            24240099
242500                                   TO DP013-PARAGRAPH             24250099
242600         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     24260099
242700                                   TO DP013-MESSAGE-TEXT(1)       24270099
242800         PERFORM DP013-0000-PROCESS-ABEND                         24280099
242900     END-IF.                                                      24290099
243000                                                                  24300099
243100/                                                                 24310099
243200*----------------------------------------------------------------*24320099
243300*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *24330099
243400*  SPECIFIC COMMAREA.                                            *24340099
243500*----------------------------------------------------------------*24350099
243600 5110-WRITE-ASC-LISTQ.                                            24360099
243700                                                                  24370099
243800     EXEC CICS                                                    24380099
243900         WRITEQ TS                                                24390099
244000             QUEUE (ASC-LIST-QUEUE-NAME)                          24400099
244100             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24410099
244200             ITEM  (PV-BLOCK-NUMBER)                              24420099
244300             RESP  (PV-CICS-RESP)                                 24430099
244400     END-EXEC.                                                    24440099
244500                                                                  24450099
244600     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      24460099
244700         SET DP013-CICS-ABEND      TO TRUE                        24470099
244800         SET DP013-NO-ROLLBACK     TO TRUE                        24480099
244900         MOVE '5110-WRITE-ASC-LISTQ'                              24490099
245000                                   TO DP013-PARAGRAPH             24500099
245100         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           24510099
245200                                   TO DP013-MESSAGE-TEXT(1)       24520099
245300         PERFORM DP013-0000-PROCESS-ABEND                         24530099
245400     END-IF.                                                      24540099
245500                                                                  24550099
245600/                                                                 24560099
245700*----------------------------------------------------------------*24570099
245800* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *24580099
245900* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *24590099
246000*----------------------------------------------------------------*24600099
246100                                                                  24610099
246200 5200-FILL-SEL-QUEUE-RECORD.                                      24620099
246300                                                                  24630099
246400     PERFORM 6112-READ-LIST-QUEUE.                                24640099
246500                                                                  24650099
246600     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       24660099
246700         PERFORM                                                  24670099
246800         VARYING LQW-IDX                                          24680099
246900         FROM 1 BY 1                                              24690099
247000         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            24700099
247100           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          24710099
247200                                                                  24720099
247300             IF  LQW-SELECT (LQW-IDX)                             24730099
247400                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              24740099
247500                                   TO PO012-ITEM (PO012-IDX)      24750099
247600                 MOVE LQW-PACK-ID (LQW-IDX)                       24760099
247700                           TO PO012-PACK-ID (PO012-IDX)           24770099
247800                 MOVE 'I'          TO PO012-ACTION-SW (PO012-IDX) 24780099
247900                 SET PO012-IDX UP BY 1                            24790099
248000                 IF  PO012-IDX > PO012-MAX-ITEMS                  24800099
248100                     PERFORM 5205-WRITE-SEL-QUEUE                 24810099
248200                     ADD +1        TO PO013-NUMBER-OF-TS-ITEMS    24820099
248300                     INITIALIZE PO012-SELECTED-ITEM-ARRAY         24830099
248400                     SET PO012-IDX TO 1                           24840099
248500                 END-IF                                           24850099
248600             END-IF                                               24860099
248700         END-PERFORM                                              24870099
248800     END-IF.                                                      24880099
248900                                                                  24890099
249000/                                                                 24900099
249100*----------------------------------------------------------------*24910099
249200*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *24920099
249300*----------------------------------------------------------------*24930099
249400                                                                  24940099
249500 5205-WRITE-SEL-QUEUE.                                            24950099
249600                                                                  24960099
249700     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            24970099
249800                                   TO PO012-SELECTED-ITEMS.       24980099
249900                                                                  24990099
250000     EXEC CICS                                                    25000099
250100          WRITEQ TS                                               25010099
250200              QUEUE (ASC-SEL-QUEUE-NAME)                          25020099
250300              FROM  (PO012-PO-SELECT-RECORD)                      25030099
250400              ITEM  (PV-SEL-QUEUE-ITEM)                           25040099
250500              RESP  (PV-CICS-RESP)                                25050099
250600     END-EXEC.                                                    25060099
250700                                                                  25070099
250800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25080099
250900         CONTINUE                                                 25090099
251000     ELSE                                                         25100099
251100         SET DP013-CICS-ABEND      TO TRUE                        25110099
251200         SET DP013-NO-ROLLBACK     TO TRUE                        25120099
251300         MOVE '5205-WRITE-SEL-QUEUE'                              25130099
251400                                   TO DP013-PARAGRAPH             25140099
251500         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          25150099
251600                                   TO DP013-MESSAGE-TEXT(1)       25160099
251700         PERFORM DP013-0000-PROCESS-ABEND                         25170099
251800     END-IF.                                                      25180099
251900                                                                  25190099
252000/                                                                 25200099
252100*----------------------------------------------------------------*25210099
252200*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *25220099
252300*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *25230099
252400*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *25240099
252500*  THE USER.                                                     *25250099
252600*----------------------------------------------------------------*25260099
252700 6000-REFRESH-PANEL-FROM-TEMP.                                    25270099
252800                                                                  25280099
252900     IF  ASC-UPDATE-TSQ                                           25290099
253000         SET ASC-NO-TSQ-UPDATE     TO TRUE                        25300099
253100         MOVE ZERO                 TO PV-SAVE-ITEM                25310099
253200                                      PV-SEL-QUEUE-ITEM           25320099
253300         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        25330099
253400                                   TO PV-HOLD-SELECTED-ITEMS      25340099
253500            PERFORM 6100-UPDATE-TSQ                               25350099
253600                UNTIL PV-ITEMS-PROCESSED >                        25360099
253700                                    PV-HOLD-SELECTED-ITEMS        25370099
253800         PERFORM 6010-DELETE-SEL-QUEUE                            25380099
253900         INITIALIZE ASC-BLOCK-ENTRIES (1)                         25390099
254000                    ASC-BLOCK-ENTRIES (2)                         25400099
254100     END-IF.                                                      25410099
254200                                                                  25420099
254300/                                                                 25430099
254400*----------------------------------------------------------------*25440099
254500*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *25450099
254600*----------------------------------------------------------------*25460099
254700 6010-DELETE-SEL-QUEUE.                                           25470099
254800                                                                  25480099
254900     EXEC CICS                                                    25490099
255000         DELETEQ TS                                               25500099
255100             QUEUE (ASC-SEL-QUEUE-NAME)                           25510099
255200             RESP  (PV-CICS-RESP)                                 25520099
255300     END-EXEC.                                                    25530099
255400                                                                  25540099
255500     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      25550099
255600         (PV-CICS-RESP = DFHRESP(QIDERR)))                        25560099
255700         CONTINUE                                                 25570099
255800     ELSE                                                         25580099
255900         SET DP013-CICS-ABEND      TO TRUE                        25590099
256000         SET DP013-NO-ROLLBACK     TO TRUE                        25600099
256100         MOVE '6010-DELETE-SEL-QUEUE'                             25610099
256200                                   TO DP013-PARAGRAPH             25620099
256300         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         25630099
256400                                   TO DP013-MESSAGE-TEXT (1)      25640099
256500         PERFORM DP013-0000-PROCESS-ABEND                         25650099
256600     END-IF.                                                      25660099
256700                                                                  25670099
256800/                                                                 25680099
256900*----------------------------------------------------------------*25690099
257000*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *25700099
257100*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *25710099
257200*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *25720099
257300*    THE TEMP QUEUE.                                             *25730099
257400*----------------------------------------------------------------*25740099
257500                                                                  25750099
257600 6100-UPDATE-TSQ.                                                 25760099
257700                                                                  25770099
257800     ADD 1                         TO PV-SEL-QUEUE-ITEM.          25780099
257900     PERFORM 6105-READ-SEL-QUEUE.                                 25790099
258000                                                                  25800099
258100     PERFORM                                                      25810099
258200         VARYING PO012-IDX                                        25820099
258300         FROM 1 BY 1                                              25830099
258400         UNTIL ((PV-ITEMS-PROCESSED >                             25840099
258500                              PV-HOLD-SELECTED-ITEMS)             25850099
258600         OR (PO012-IDX GREATER THAN PO012-MAX-ITEMS))             25860099
258700         IF  PO012-ACTION-SW (PO012-IDX) > SPACE                  25870099
258800             PERFORM 6110-PROCESS-ITEMS                           25880099
258900         END-IF                                                   25890099
259000         ADD +1                    TO PV-ITEMS-PROCESSED          25900099
259100     END-PERFORM.                                                 25910099
259200                                                                  25920099
259300     PERFORM 6111-WRITE-LIST-QUEUE.                               25930099
259400/                                                                 25940099
259500*----------------------------------------------------------------*25950099
259600*    READ THE LIST QUEUE RECORD.                                 *25960099
259700*----------------------------------------------------------------*25970099
259800                                                                  25980099
259900 6105-READ-SEL-QUEUE.                                             25990099
260000                                                                  26000099
260100     EXEC CICS                                                    26010099
260200          READQ TS                                                26020099
260300              QUEUE (ASC-SEL-QUEUE-NAME)                          26030099
260400              INTO  (PO012-PO-SELECT-RECORD)                      26040099
260500              ITEM  (PV-SEL-QUEUE-ITEM)                           26050099
260600              RESP  (PV-CICS-RESP)                                26060099
260700     END-EXEC.                                                    26070099
260800                                                                  26080099
260900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26090099
261000         CONTINUE                                                 26100099
261100     ELSE                                                         26110099
261200         SET DP013-CICS-ABEND      TO TRUE                        26120099
261300         SET DP013-NO-ROLLBACK     TO TRUE                        26130099
261400         MOVE '6105-READ-SEL-QUEUE'                               26140099
261500                                   TO DP013-PARAGRAPH             26150099
261600         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           26160099
261700                                   TO DP013-MESSAGE-TEXT(1)       26170099
261800         PERFORM DP013-0000-PROCESS-ABEND                         26180099
261900     END-IF.                                                      26190099
262000                                                                  26200099
262100/                                                                 26210099
262200*----------------------------------------------------------------*26220099
262300*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*26230099
262400*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*26240099
262500*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *26250099
262600*----------------------------------------------------------------*26260099
262700                                                                  26270099
262800 6110-PROCESS-ITEMS.                                              26280099
262900                                                                  26290099
263000     COMPUTE PV-ITEM = 1 + ((PO012-ITEM (PO012-IDX) - 1)          26300099
263100                     / PC-ITEMS-PER-PANEL).                       26310099
263200                                                                  26320099
263300     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           26330099
263400         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          26340099
263500             PERFORM 6111-WRITE-LIST-QUEUE                        26350099
263600         END-IF                                                   26360099
263700         MOVE PV-ITEM              TO PV-SAVE-ITEM                26370099
263800                                                                  26380099
263900         PERFORM 6112-READ-LIST-QUEUE                             26390099
264000         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               26400099
264100             CONTINUE                                             26410099
264200         END-IF                                                   26420099
264300     END-IF.                                                      26430099
264400                                                                  26440099
264500     COMPUTE PV-SUB = (PO012-ITEM (PO012-IDX)                     26450099
264600                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              26460099
264700                                                                  26470099
264800     SET LQW-DESELECT (PV-SUB)     TO TRUE.                       26480099
264900     MOVE LQW-SELECTED-SW (PV-SUB) TO LQW-TEMP-SELECTED-SW        26490099
265000                                     (PV-SUB).                    26500099
265100     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                26510099
265200                                                                  26520099
265300/                                                                 26530099
265400*----------------------------------------------------------------*26540099
265500*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *26550099
265600*----------------------------------------------------------------*26560099
265700                                                                  26570099
265800 6111-WRITE-LIST-QUEUE.                                           26580099
265900                                                                  26590099
266000     EXEC CICS                                                    26600099
266100         WRITEQ TS                                                26610099
266200             QUEUE (ASC-LIST-QUEUE-NAME)                          26620099
266300             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     26630099
266400             ITEM  (PV-SAVE-ITEM)                                 26640099
266500             REWRITE                                              26650099
266600             RESP  (PV-CICS-RESP)                                 26660099
266700     END-EXEC.                                                    26670099
266800                                                                  26680099
266900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26690099
267000         CONTINUE                                                 26700099
267100     ELSE                                                         26710099
267200         SET DP013-CICS-ABEND      TO TRUE                        26720099
267300         SET DP013-NO-ROLLBACK     TO TRUE                        26730099
267400         MOVE '6111-WRITE-LIST-QUEUE'                             26740099
267500                                   TO DP013-PARAGRAPH             26750099
267600         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  26760099
267700                                   TO DP013-MESSAGE-TEXT(1)       26770099
267800         PERFORM DP013-0000-PROCESS-ABEND                         26780099
267900     END-IF.                                                      26790099
268000                                                                  26800099
268100/                                                                 26810099
268200*----------------------------------------------------------------*26820099
268300*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*26830099
268400*----------------------------------------------------------------*26840099
268500                                                                  26850099
268600 6112-READ-LIST-QUEUE.                                            26860099
268700                                                                  26870099
268800     EXEC CICS                                                    26880099
268900         READQ TS                                                 26890099
269000             QUEUE (ASC-LIST-QUEUE-NAME)                          26900099
269100             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     26910099
269200             ITEM  (PV-ITEM)                                      26920099
269300             RESP  (PV-CICS-RESP)                                 26930099
269400     END-EXEC.                                                    26940099
269500                                                                  26950099
269600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26960099
269700         CONTINUE                                                 26970099
269800     ELSE                                                         26980099
269900         SET DP013-CICS-ABEND      TO TRUE                        26990099
270000         SET DP013-NO-ROLLBACK     TO TRUE                        27000099
270100         MOVE '6112-READ-LIST-QUEUE'                              27010099
270200                                   TO DP013-PARAGRAPH             27020099
270300         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    27030099
270400                                   TO DP013-MESSAGE-TEXT(1)       27040099
270500         PERFORM DP013-0000-PROCESS-ABEND                         27050099
270600     END-IF.                                                      27060099
270700                                                                  27070099
270800/                                                                 27080099
270900*----------------------------------------------------------------*27090099
271000*    ABEND PROCESSOR MODULE                                      *27100099
271100*----------------------------------------------------------------*27110099
271200                                                                  27120099
271300     COPY DPPD013.                                                27130099
