000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    APKRP294.                                         00020000
000300 AUTHOR.        ROLF NOHE.                                        00030000
000400 DATE-WRITTEN.  JULY 2008.                                        00040001
000500 DATE-COMPILED.                                                   00050000
000600*---------------------------------------------------------------* 00060000
000700*     REPORT OF ALL INVOICES RECEIVED VIA EDI.                  * 00070000
000800*---------------------------------------------------------------* 00080000
000900*    COBOL 390                                                  * 00090000
001000*---------------------------------------------------------------* 00100000
001100*  PURPOSE:  TO CREATE A REPORT OF ALL EDI INVOICES RECEIVED    * 00110000
001200*  FOR THE PREVIOUS WEEK.                                       * 00120000
001300*                                                               * 00130000
001400*  INPUT:  IMPORT EXP AUDIT RECORDS (APRD019)                   * 00140000
001500*  OUTPUT: ALL INVOICES REPORT                                  * 00150000
001600*---------------------------------------------------------------* 00160000
001700* CHANGE LOG:                                                   * 00170000
001800*                                                               * 00180000
001900* DATE  07/17/2008                                              * 00190001
002000*     CHANGE MADE: INITIAL VERSION.                             * 00200000
002100*     MADE BY: ROLF NOHE               WR/IR #: WR31733         * 00210000
002200*                                                               * 00220000
002300* DATE  10/23/2008                                              * 00230018
002400*     CHANGE MADE: ADDED STATUS CODE TO THE REPORT PER THE      * 00240018
002500*     USERS REQUEST.                                            * 00250018
002600*     MADE BY: ROLF NOHE               WR/IR #: WR31733         * 00260018
002700*                                                               * 00270018
002800* DATE  11/24/2008                                              * 00280020
002900*     CHANGE MADE: ADDED CODE TO PARAGRAPH S100- TO HANDLE -811 * 00290020
003000*     DB2 ERROR CODE TO NOT ABEND.                              * 00300020
003100*     MADE BY: MIKE BESKE              WR/IR #: INC000000607088 * 00310020
003200*                                                               * 00320020
003300* DATE  11/25/2008                                              * 00330022
003400*     CHANGE MADE: UPDATED CODE TO USE THE AP019-PO-NBR IN THE  * 00340021
003500*     SQL SELECT ON TINVOIC IN PARA S100-.                      * 00350021
003600*     MADE BY: MIKE BESKE              WR/IR #: INC000000607088 * 00360021
003700*                                                               * 00360126
003800* DATE  11/04/2014                                              * 00361026
003900*     CHANGE MADE: MODIFIED PO NUMBER LENGTH FROM 7 DIGIT TO 9  * 00362026
004000*     DIGIT IN THE REPORT LAYOUT.                               * 00363026
004001*     MADE BY: COGNIZANT               WR/IR #: CHG0094517      * 00364026
004002*---------------------------------------------------------------* 00380000
004003 ENVIRONMENT DIVISION.                                            00390000
004004 CONFIGURATION SECTION.                                           00400000
004100 SOURCE-COMPUTER.        IBM-370.                                 00410000
004200 OBJECT-COMPUTER.        IBM-370.                                 00420000
004300                                                                  00430000
004400 INPUT-OUTPUT SECTION.                                            00440000
004500 FILE-CONTROL.                                                    00450000
004600     SELECT ALL-INVC-RPT-FILE     ASSIGN TO INP01.                00460000
004700     SELECT ALL-INVC-PR-REPORT    ASSIGN TO RPT01.                00470000
004800                                                                  00480000
004900 DATA DIVISION.                                                   00490000
005000 FILE SECTION.                                                    00500000
005100                                                                  00510000
005200 FD  ALL-INVC-RPT-FILE                                            00520000
005300     RECORDING MODE IS F                                          00530000
005400     LABEL RECORDS ARE STANDARD                                   00540000
005500     BLOCK CONTAINS 0 RECORDS                                     00550000
005600     RECORD CONTAINS 360 CHARACTERS                               00560000
005700     DATA RECORD IS ALL-INVC-RPT-REC.                             00570000
005800                                                                  00580000
005900 01  ALL-INVC-RPT-REC                   PIC X(360).               00590000
006000                                                                  00600000
006100 FD  ALL-INVC-PR-REPORT                                           00610000
006200     RECORDING MODE IS F                                          00620000
006300     LABEL RECORDS ARE STANDARD                                   00630000
006400     BLOCK CONTAINS 0 RECORDS                                     00640000
006500     RECORD CONTAINS 150 CHARACTERS                               00650000
006600     DATA RECORD IS ALL-INVC-PR-REPORT-REC.                       00660000
006700                                                                  00670000
006800 01  ALL-INVC-PR-REPORT-REC             PIC X(150).               00680000
006900                                                                  00690000
007000 WORKING-STORAGE SECTION.                                         00700000
007100                                                                  00710000
007200 01  PROGRAM-SWITCHES.                                            00720000
007300     05  PS-ALL-INVC-RPT-EOF-SW         PIC X     VALUE 'N'.      00730000
007400         88 PS-ALL-INVC-RPT-NOT-EOF               VALUE 'N'.      00740000
007500         88 PS-ALL-INVC-RPT-EOF                   VALUE 'Y'.      00750000
007600                                                                  00760000
007700 01  PROGRAM-VARIABLES.                                           00770000
007800     05  PV-ALL-INVC-RPT-OUT            PIC 9(12) VALUE 0.        00780000
007900     05  PV-COUNT-INPUT                 PIC 9(12) VALUE 0.        00790000
008000     05  PV-HOLD-CHRG-AMT               PIC S9(09)V99  COMP-3.    00800000
008100     05  PV-HOLD-CALC-DEC               PIC S9(05)V999 COMP-3.    00810000
008200     05  MAX-LINES                      PIC S9(3) COMP-3          00820000
008300                                                  VALUE +65.      00830000
008400     05  PAGE-COUNT                     PIC S9(9) COMP-3          00840000
008500                                                  VALUE +0.       00850000
008600     05  LINE-COUNT                     PIC S9(3) COMP-3          00860000
008700                                                  VALUE +0.       00870000
008800     05  PV-SYSTEM-DATE                 PIC X(08) VALUE ZERO.     00880000
008900     05  FILLER REDEFINES PV-SYSTEM-DATE.                         00890000
009000         10  PV-SYSTEM-CCYY.                                      00900000
009100             15  PV-SYSTEM-CENTURY      PIC X(02).                00910000
009200             15  PV-SYSTEM-YEAR         PIC X(02).                00920000
009300         10  PV-SYSTEM-MONTH            PIC X(02).                00930000
009400         10  PV-SYSTEM-DAY              PIC X(02).                00940000
009500     05  PV-SYSTEM-TIME.                                          00950000
009600         10  PV-SYSTEM-HOUR             PIC 9(02) VALUE ZERO.     00960000
009700         10  PV-SYSTEM-MINUTE           PIC 9(02) VALUE ZERO.     00970000
009800         10  PV-SYSTEM-SECOND           PIC 9(02) VALUE ZERO.     00980000
009900         10  FILLER                     PIC 9(02) VALUE ZERO.     00990000
010000     05  PV-PROGRAM-NAME                PIC X(8) VALUE 'APKRP294'.01000000
010100     05  SAVE-CHRG-CODE                 PIC X(03) VALUE SPACES.   01010000
010200     05  SAVE-CHRG-AMT                  PIC -------.99            01020000
010300                                                  VALUE ZEROES.   01030000
010400     05  SAVE-CALC-DEC                  PIC S9(05)V999 COMP-3     01040000
010500                                                  VALUE ZEROES.   01050000
010600     05  PV-HOLD-CALC-PO                PIC S9(4)V99 COMP-3       01060000
010700                                                  VALUE ZEROES.   01070000
010800     05  PV-PO-NBR                      PIC S9(9) COMP.           01080021
010900     05  PV-INVOICE-NBR                 PIC X(22).                01090021
011000     05  PV-STATUS-CDE                  PIC X(02).                01100004
011100                                                                  01110000
011200*----------------------------------------------------------------*01120000
011300*           KOHLS STANDARD 150 CHARACTER REPORT HEADER           *01130000
011400*----------------------------------------------------------------*01140000
011500     COPY DPWS150O.                                               01150000
011600                                                                  01160000
011700 01  BLANK-LINE                         PIC X(150) VALUE SPACES.  01170000
011800                                                                  01180000
011900 01  SAVE-DETAIL-LINE                   PIC X(150) VALUE SPACES.  01190000
012000                                                                  01200000
012100 01  HDR-TITLE-1.                                                 01210000
012200     05  FILLER                         PIC  X(59) VALUE SPACE.   01220000
012300     05  FILLER                         PIC  X(35) VALUE          01230002
012400             ' ALL 210 INVOICES RECEIVED VIA EDI '.               01240002
012500     05  FILLER                         PIC  X(44) VALUE SPACE.   01250002
012600                                                                  01260000
012700 01  HEADER-1.                                                    01270000
012800     05  FILLER                PIC X(35) VALUE SPACES.            01280010
012900     05  FILLER                PIC X(02) VALUE 'PO'.              01290000
013000     05  FILLER                PIC X(29) VALUE SPACES.            01300026
013100     05  FILLER                PIC X(12) VALUE 'CONTAINER / '.    01310000
013200     05  FILLER                PIC X(02) VALUE SPACES.            01320026
013300     05  FILLER                PIC X(11) VALUE 'NET INVOICE'.     01330000
013400     05  FILLER                PIC X(03) VALUE SPACES.            01340000
013500     05  FILLER                PIC X(04) VALUE 'CHRG'.            01350000
013600     05  FILLER                PIC X(07) VALUE SPACES.            01360000
013700     05  FILLER                PIC X(06) VALUE 'CHARGE'.          01370000
013800     05  FILLER                PIC X(07) VALUE SPACES.            01380012
013900     05  FILLER                PIC X(05) VALUE 'TOTAL'.           01390000
014000     05  FILLER                PIC X(03) VALUE SPACES.            01400000
014100     05  FILLER                PIC X(06) VALUE 'PO CTN'.          01410000
014200     05  FILLER                PIC X(03) VALUE SPACES.            01420000
014300     05  FILLER                PIC X(08) VALUE 'CALC DDF'.        01430000
014400     05  FILLER                PIC X(01) VALUE SPACES.            01440000
014500     05  FILLER                PIC X(06) VALUE 'STATUS'.          01450015
014600                                                                  01460000
014700 01  HEADER-2.                                                    01470000
014800     05  FILLER                PIC X(09) VALUE 'VENDOR ID'.       01480000
014900     05  FILLER                PIC X(02) VALUE SPACES.            01490005
015000     05  FILLER                PIC X(11) VALUE 'VENDOR NAME'.     01500000
015100     05  FILLER                PIC X(11) VALUE SPACES.            01510010
015200     05  FILLER                PIC X(06) VALUE 'NUMBER'.          01520000
015300     05  FILLER                PIC X(05) VALUE SPACES.            01530026
015400     05  FILLER                PIC X(10) VALUE 'INVOICE ID'.      01540000
015500     05  FILLER                PIC X(09) VALUE SPACES.            01550008
015600     05  FILLER                PIC X(14) VALUE 'BOL ID / ENTRY'.  01560000
015700     05  FILLER                PIC X(08) VALUE SPACES.            01570026
015800     05  FILLER                PIC X(06) VALUE 'AMOUNT'.          01580000
015900     05  FILLER                PIC X(03) VALUE SPACES.            01590000
016000     05  FILLER                PIC X(04) VALUE 'CODE'.            01600000
016100     05  FILLER                PIC X(07) VALUE SPACES.            01610000
016200     05  FILLER                PIC X(06) VALUE 'AMOUNT'.          01620000
016300     05  FILLER                PIC X(05) VALUE SPACES.            01630012
016400     05  FILLER                PIC X(07) VALUE 'DRAYAGE'.         01640000
016500     05  FILLER                PIC X(04) VALUE SPACES.            01650000
016600     05  FILLER                PIC X(03) VALUE 'QTY'.             01660000
016700     05  FILLER                PIC X(06) VALUE SPACES.            01670000
016800     05  FILLER                PIC X(06) VALUE 'RT/CTN'.          01680000
016900     05  FILLER                PIC X(03) VALUE SPACES.            01690016
017000     05  FILLER                PIC X(04) VALUE 'CODE'.            01700015
017100                                                                  01710000
017200 01  DETAIL-1.                                                    01720003
017300     05  DTL-VENDOR-ID         PIC X(10) VALUE SPACES.            01730003
017400     05  FILLER                PIC X(01) VALUE SPACES.            01740008
017500     05  DTL-VENDOR-NAME       PIC X(20) VALUE SPACES.            01750003
017600     05  FILLER                PIC X(02) VALUE SPACES.            01760005
017700     05  DTL-PO-NUMBER         PIC ZZZZZZZZ9 VALUE ZEROES.        01770028
017800     05  FILLER                PIC X(02) VALUE SPACES.            01780005
017900     05  DTL-INVOICE-ID        PIC X(17) VALUE SPACES.            01790003
018000     05  FILLER                PIC X(02) VALUE SPACES.            01800017
018100     05  DTL-REFERENCE-ID      PIC X(16) VALUE SPACES.            01810003
018200     05  FILLER                PIC X(01) VALUE SPACES.            01820026
018300     05  DTL-NET-INVC-AMT      PIC --------.99                    01830003
018400                                         VALUE ZEROES.            01840003
018500     05  FILLER                PIC X(03) VALUE SPACES.            01850013
018600     05  DTL-CHRG-CODE         PIC X(03) VALUE SPACES.            01860003
018700     05  FILLER                PIC X(04) VALUE SPACES.            01870003
018800     05  DTL-CHRG-AMT          PIC -------.99                     01880003
018900                                         VALUE ZEROES.            01890003
019000     05  FILLER                PIC X(02) VALUE SPACES.            01900003
019100     05  DTL-TOT-DRAYAGE       PIC -------.99                     01910003
019200                                         VALUE ZEROES.            01920003
019300     05  FILLER                PIC X(03) VALUE SPACES.            01930017
019400     05  DTL-PO-QTY            PIC ZZZZ9 VALUE ZEROES.            01940003
019500     05  FILLER                PIC X(03) VALUE SPACES.            01950003
019600     05  DTL-CALC-DEC          PIC -.999 VALUE ZEROES.            01960003
019700     05  FILLER                PIC X(07) VALUE SPACES.            01970017
019800     05  DTL-STATUS-CDE        PIC X(02) VALUE SPACES.            01980003
019900     05  FILLER                PIC X(03) VALUE SPACES.            01990003
020000                                                                  02000000
020100 01  END-OF-REPORT.                                               02010000
020200     05  FILLER                PIC X(85) VALUE SPACES.            02020000
020300     05  FILLER                PIC X(29) VALUE                    02030000
020400        '- - - - END OF REPORT - - - -'.                          02040000
020500     05  FILLER                PIC X(45) VALUE SPACES.            02050000
020600                                                                  02060000
020700 01  NO-DATA-TO-REPORT.                                           02070000
020800     05  FILLER                PIC X(63) VALUE SPACES.            02080000
020900     05  FILLER                PIC X(23) VALUE                    02090000
021000        '-  NO DATA TO REPORT  -'.                                02100000
021100     05  FILLER                PIC X(45) VALUE SPACES.            02110000
021200 EJECT                                                            02120000
021300                                                                  02130000
021400*--------------------------------------------------------------*  02140000
021500*  APRD019 RECORD LAYOUT FOR IMPORT EXP AUDIT RECORD FILE.     *  02150000
021600*--------------------------------------------------------------*  02160000
021700     COPY APRD019.                                                02170000
021800                                                                  02180000
021900*-----------------------------------------------------------      02190004
022000*    SQL COMMUNICATIONS AREA DCLGEN                               02200004
022100*-----------------------------------------------------------      02210004
022200     EXEC SQL                                                     02220004
022300         INCLUDE SQLCA                                            02230004
022400     END-EXEC.                                                    02240004
022500                                                                  02250004
022600*-----------------------------------------------------------      02260003
022700*    AP-INVOICE TABLE                                             02270003
022800*-----------------------------------------------------------      02280003
022900     EXEC SQL                                                     02290003
023000         INCLUDE TINVOIC                                          02300003
023100     END-EXEC.                                                    02310003
023200                                                                  02320003
023300*----------------------------------------------------------------*02330004
023400*    SQLCA FORMATTED MESSAGE AREA                                 02340004
023500*----------------------------------------------------------------*02350004
023600     COPY DPWS004.                                                02360004
023700                                                                  02370004
023800*----------------------------------------------------------------*02380004
023900*    ABEND DATA AREAS                                             02390004
024000*----------------------------------------------------------------*02400004
024100 01  ABEND-CODE                    PIC S9(4)    VALUE ZEROES      02410004
024200                                   COMP         SYNC.             02420004
024300                                                                  02430004
024400     88  AC-ANY-ERROR                           VALUE  +4001      02440004
024500                                                THRU   +4019.     02450004
024600     88  AC-INVALID-KEY-WRITE                   VALUE  +4001.     02460004
024700     88  AC-INVALID-KEY-READ                    VALUE  +4002.     02470004
024800     88  AC-INVALID-CONTROL-CARD                VALUE  +4003.     02480004
024900     88  AC-OPEN-ERROR                          VALUE  +4005.     02490004
025000     88  AC-CLOSE-ERROR                         VALUE  +4006.     02500004
025100     88  AC-INVALID-DATA                        VALUE  +4008.     02510004
025200     88  AC-DB2-ERROR                           VALUE  +4013.     02520004
025300     88  AC-UNSUCCESSFUL-SELECT                 VALUE  +4015.     02530004
025400     88  AC-MAX-RETRIES-EXCEEDED                VALUE  +4016.     02540004
025500                                                                  02550004
025600                                                                  02560004
025700 01  ABEND-AREAS.                                                 02570004
025800     05  AA-ABEND-LIT              PIC  X(40)   VALUE             02580004
025900             '*****       ABEND'.                                 02590004
026000     05  AA-PROGRAM-LIT            PIC  X(40)   VALUE             02600004
026100             '*****   PROGRAM: APKRP294'.                         02610004
026200     05  AA-PARAGRAPH-LIT.                                        02620004
026300         10  FILLER                PIC  X(17)   VALUE             02630004
026400             '***** PARAGRAPH: '.                                 02640004
026500         10  AA-PARAGRAPH-NAME     PIC  X(35)   VALUE SPACES.     02650004
026600     05  AA-MESSAGE-LINE-1.                                       02660004
026700         10  FILLER                PIC  X(06)   VALUE '*****'.    02670004
026800         10  AA-MESSAGE-1          PIC  X(80)   VALUE SPACES.     02680004
026900     05  AA-MESSAGE-LINE-2.                                       02690004
027000         10  FILLER                PIC  X(06)   VALUE '*****'.    02700004
027100         10  AA-MESSAGE-2          PIC  X(80)   VALUE SPACES.     02710004
027200     05  AA-DB2-ERROR-LIT          PIC  X(40)   VALUE             02720004
027300             '*****    DB2 ERROR'.                                02730004
027400     05  AA-DB2-OPERATION-LIT.                                    02740004
027500         10  FILLER                PIC  X(17)   VALUE             02750004
027600             '***** OPERATION: '.                                 02760004
027700         10  AA-DB2-OPERATION.                                    02770004
027800             15  AA-DB2-OP-1       PIC  X(25)   VALUE SPACES.     02780004
027900             15  AA-DB2-OP-2       PIC  X(25)   VALUE SPACES.     02790004
028000     05  AA-DB2-TABLE-1            PIC  X(08)   VALUE SPACES.     02800004
028100                                                                  02810004
028200 PROCEDURE DIVISION.                                              02820000
028300                                                                  02830000
028400 A100-MAINLINE-ROUTINE.                                           02840000
028500                                                                  02850000
028600     PERFORM B100-INITIALIZATION.                                 02860000
028700                                                                  02870000
028800     PERFORM B200-CREATE-ALL-INVC-RPT                             02880000
028900       UNTIL PS-ALL-INVC-RPT-EOF.                                 02890000
029000                                                                  02900000
029100     PERFORM B300-TERMINATION.                                    02910000
029200     GOBACK.                                                      02920000
029300                                                                  02930000
029400*--------------------------------------------------------------*  02940000
029500* B100-INITIALIZATION                                          *  02950000
029600*  INITIALIZATION PROCESSING.                                  *  02960000
029700*--------------------------------------------------------------*  02970000
029800 B100-INITIALIZATION.                                             02980000
029900                                                                  02990000
030000     DISPLAY ' '.                                                 03000000
030100     DISPLAY '**--------------- APKRP294 --------------------**'. 03010000
030200                                                                  03020000
030300     OPEN INPUT  ALL-INVC-RPT-FILE                                03030000
030400          OUTPUT ALL-INVC-PR-REPORT.                              03040000
030500                                                                  03050000
030600     INITIALIZE DCLTINVOIC.                                       03060003
030700                                                                  03070003
030800     MOVE FUNCTION CURRENT-DATE  TO PV-SYSTEM-DATE.               03080000
030900     MOVE PV-SYSTEM-MONTH        TO DP150O-RUN-MONTH.             03090000
031000     MOVE PV-SYSTEM-DAY          TO DP150O-RUN-DAY.               03100000
031100     MOVE PV-SYSTEM-YEAR         TO DP150O-RUN-YEAR.              03110000
031200     ACCEPT PV-SYSTEM-TIME       FROM TIME.                       03120000
031300     MOVE PV-SYSTEM-HOUR         TO DP150O-RUN-HOUR.              03130000
031400     MOVE PV-SYSTEM-MINUTE       TO DP150O-RUN-MINUTE.            03140000
031500     MOVE PV-PROGRAM-NAME        TO DP150O-PROGRAM-NAME.          03150000
031600     MOVE '1'                    TO DP150O-REPORT-NUMBER.         03160000
031700                                                                  03170000
031800     PERFORM W100-WRITE-HEADINGS.                                 03180000
031900                                                                  03190000
032000     PERFORM R100-READ-INPUT.                                     03200000
032100                                                                  03210000
032200     IF PS-ALL-INVC-RPT-EOF                                       03220000
032300         DISPLAY ' NO REPORT RECORDS TO PROCESS '                 03230000
032400         WRITE ALL-INVC-PR-REPORT-REC FROM NO-DATA-TO-REPORT      03240000
032500             AFTER ADVANCING 1 LINE                               03250000
032600     END-IF.                                                      03260000
032700                                                                  03270000
032800*--------------------------------------------------------------*  03280000
032900* B200-CREATE-ALL-INVC-RPT.                                    *  03290000
033000*  THIS ROUTINE HOLDS THE MAIN LOGIC FOR INVOICES RECEIVED     *  03300000
033100*  REPORTING.                                                  *  03310004
033200*--------------------------------------------------------------*  03320000
033300 B200-CREATE-ALL-INVC-RPT.                                        03330000
033400                                                                  03340000
033500     MOVE SPACES TO DETAIL-1.                                     03350000
033600                                                                  03360000
033700     MOVE AP019-VENDOR-NBR           TO DTL-VENDOR-ID.            03370000
033800     MOVE AP019-VENDOR-NAME          TO DTL-VENDOR-NAME.          03380000
033900     MOVE AP019-PO-NBR               TO DTL-PO-NUMBER.            03390000
034000     MOVE AP019-INVOICE-NBR          TO DTL-INVOICE-ID.           03400000
034100                                                                  03410000
034200     IF AP019-ENTRY-NBR = SPACES                                  03420000
034300        IF AP019-BOL-ID = SPACES                                  03430000
034400           MOVE AP019-CONTAINER-ID   TO DTL-REFERENCE-ID          03440000
034500        ELSE                                                      03450000
034600           MOVE AP019-BOL-ID         TO DTL-REFERENCE-ID          03460000
034700     ELSE                                                         03470000
034800        MOVE AP019-ENTRY-NBR         TO DTL-REFERENCE-ID          03480000
034900     END-IF.                                                      03490000
035000                                                                  03500000
035100     MOVE AP019-NET-INVC-AMT         TO DTL-NET-INVC-AMT.         03510000
035200     MOVE AP019-TOTAL-DRAYAGE-AMT    TO DTL-TOT-DRAYAGE.          03520000
035300     MOVE AP019-PO-QTY               TO DTL-PO-QTY.               03530000
035400                                                                  03540013
035500     MOVE AP019-PO-NBR               TO PV-PO-NBR.                03550021
035600     MOVE AP019-INVOICE-NBR          TO PV-INVOICE-NBR.           03560021
035700                                                                  03570021
035800     PERFORM S100-SELECT-INVOICE-STATUS.                          03580021
035900     MOVE PV-STATUS-CDE              TO DTL-STATUS-CDE.           03590021
036000                                                                  03600021
036100     MOVE DETAIL-1                   TO SAVE-DETAIL-LINE.         03610021
036200                                                                  03620021
036300     PERFORM VARYING AP019-IDX FROM 1 BY 1                        03630021
036400       UNTIL AP019-CHARGE-CDE(AP019-IDX) = SPACE                  03640021
036500          OR AP019-IDX > 20                                       03650021
036600             MOVE AP019-CHARGE-CDE(AP019-IDX) TO DTL-CHRG-CODE    03660021
036700             MOVE AP019-CHARGE-AMT(AP019-IDX) TO DTL-CHRG-AMT     03670021
036800                                                 PV-HOLD-CHRG-AMT 03680021
036900             IF DTL-CHRG-CODE = 'DDF'                             03690021
037000                DIVIDE PV-HOLD-CHRG-AMT BY AP019-PO-QTY           03700021
037100                   GIVING PV-HOLD-CALC-DEC                        03710021
037200                MOVE PV-HOLD-CALC-DEC         TO DTL-CALC-DEC     03720021
037300                DISPLAY 'PV-HOLD-CALC-DEC: ' PV-HOLD-CALC-DEC     03730021
037400                DISPLAY 'DTL-CALC-DEC: ' DTL-CALC-DEC             03740021
037500             END-IF                                               03750021
037600                                                                  03760021
037700             PERFORM W200-WRITE-DETAIL                            03770021
037800             MOVE SPACES TO DETAIL-1                              03780021
037900     END-PERFORM.                                                 03790021
038000                                                                  03800021
038100                                                                  03810021
038200     PERFORM W300-WRITE-BLANK-LINE.                               03820021
038300                                                                  03830021
038400     PERFORM R100-READ-INPUT.                                     03840021
038500                                                                  03850021
038600*--------------------------------------------------------------*  03860021
038700* B300-TERMINATION                                             *  03870021
038800*  END OF PROGRAM PROCESSING.                                  *  03880021
038900*--------------------------------------------------------------*  03890021
039000 B300-TERMINATION.                                                03900021
039100                                                                  03910021
039200     DISPLAY '*************************************'.             03920021
039300     DISPLAY '*************************************'.             03930021
039400     DISPLAY 'EDI IMPORT INVOICE COUNT  ' PV-COUNT-INPUT.         03940021
039500     DISPLAY 'ALL INVOICE RECS WRITTEN  ' PV-ALL-INVC-RPT-OUT.    03950021
039600     DISPLAY '*************************************'.             03960021
039700     DISPLAY '*************************************'.             03970021
039800                                                                  03980021
039900     CLOSE ALL-INVC-RPT-FILE                                      03990021
040000           ALL-INVC-PR-REPORT.                                    04000021
040100                                                                  04010021
040200*--------------------------------------------------------------*  04020021
040300* R100-READ-INPUT                                              *  04030021
040400*  READS A RECORD IN A FILE.                                   *  04040021
040500*--------------------------------------------------------------*  04050021
040600 R100-READ-INPUT.                                                 04060021
040700                                                                  04070021
040800      INITIALIZE AP019-IMPORT-EXP-AUDIT-RECORD.                   04080021
040900                                                                  04090021
041000      READ ALL-INVC-RPT-FILE INTO AP019-IMPORT-EXP-AUDIT-RECORD   04100021
041100          AT END                                                  04110021
041200              SET PS-ALL-INVC-RPT-EOF TO TRUE                     04120021
041300      END-READ.                                                   04130021
041400                                                                  04140021
041500      IF PS-ALL-INVC-RPT-NOT-EOF                                  04150021
041600         ADD 1 TO PV-COUNT-INPUT                                  04160021
041700      END-IF.                                                     04170021
041800                                                                  04180021
041900*--------------------------------------------------------------*  04190021
042000* S100-SELECT-INVOICE-STATUS                                   *  04200021
042100*  SELECT STATUS_CDE FROM TINVOIC.                             *  04210021
042200*--------------------------------------------------------------*  04220021
042300 S100-SELECT-INVOICE-STATUS.                                      04230021
042400                                                                  04240021
042500     EXEC SQL                                                     04250021
042600         SELECT STATUS_CDE                                        04260021
042700           INTO :PV-STATUS-CDE                                    04270021
042800           FROM TINVOIC                                           04280021
042900          WHERE PO_NBR  = :PV-PO-NBR                              04290021
043000            AND INVC_ID = :PV-INVOICE-NBR                         04300021
043100     END-EXEC                                                     04310021
043200                                                                  04320021
043300     EVALUATE TRUE                                                04330021
043400         WHEN SQLCODE = ZERO                                      04340021
043500         WHEN SQLCODE = -305                                      04350021
043600             CONTINUE                                             04360021
043700         WHEN SQLCODE = +100                                      04370021
043800             MOVE SPACES           TO PV-STATUS-CDE               04380021
043900                                                                  04390021
044000         WHEN SQLWARN0 NOT = SPACES                               04400021
044100         WHEN SQLCODE NOT  = ZERO                                 04410021
044200             DISPLAY 'PO NBR :  ' AP019-PO-NBR                    04420021
044300             DISPLAY 'INVC ID:  ' PV-INVOICE-NBR                  04430021
044400             MOVE 'S100-SELECT-INVOICE-STATUS'                    04440021
044500                                 TO AA-PARAGRAPH-NAME             04450021
044600             MOVE 'UNSUCCESSFUL SELECT'                           04460021
044700                                 TO AA-DB2-OPERATION              04470021
044800             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                04480021
044900             PERFORM Z999-DB2-ABEND                               04490021
045000     END-EVALUATE.                                                04500021
045100                                                                  04510021
045200                                                                  04520021
045300*--------------------------------------------------------------*  04530021
045400* W100-WRITE-HEADINGS                                          *  04540021
045500*  PRODUCE THE PAGE HEADINGS FOR THE REPORT.                   *  04550021
045600*--------------------------------------------------------------*  04560021
045700 W100-WRITE-HEADINGS.                                             04570021
045800                                                                  04580021
045900     ADD 1 TO PAGE-COUNT.                                         04590021
046000     MOVE PAGE-COUNT TO DP150O-PAGE-NUMBER.                       04600021
046100                                                                  04610021
046200     WRITE ALL-INVC-PR-REPORT-REC                                 04620021
046300       FROM DP150O-STANDRD-HEADER-150-COLS AFTER ADVANCING PAGE.  04630021
046400                                                                  04640021
046500     WRITE ALL-INVC-PR-REPORT-REC FROM HDR-TITLE-1                04650021
046600         AFTER ADVANCING 1 LINE.                                  04660021
046700                                                                  04670021
046800     WRITE ALL-INVC-PR-REPORT-REC FROM BLANK-LINE                 04680021
046900         AFTER ADVANCING 1 LINE.                                  04690021
047000                                                                  04700021
047100     WRITE ALL-INVC-PR-REPORT-REC FROM HEADER-1                   04710021
047200         AFTER ADVANCING 2 LINES.                                 04720021
047300                                                                  04730021
047400     WRITE ALL-INVC-PR-REPORT-REC FROM HEADER-2                   04740021
047500         AFTER ADVANCING 1 LINE.                                  04750021
047600                                                                  04760021
047700     WRITE ALL-INVC-PR-REPORT-REC FROM BLANK-LINE                 04770021
047800         AFTER ADVANCING 1 LINE.                                  04780021
047900                                                                  04790021
048000     MOVE +7            TO LINE-COUNT.                            04800021
048100                                                                  04810021
048200*--------------------------------------------------------------*  04820021
048300* W200-WRITE-DETAIL                                            *  04830021
048400*  THIS ROUTINE WRITES THE DETAIL LINES.                       *  04840021
048500*--------------------------------------------------------------*  04850021
048600 W200-WRITE-DETAIL.                                               04860021
048700                                                                  04870021
048800     DISPLAY 'W200-WRITE-DETAIL'.                                 04880021
048900                                                                  04890021
049000     IF LINE-COUNT >= MAX-LINES                                   04900021
049100        PERFORM W100-WRITE-HEADINGS                               04910021
049200        MOVE DTL-CHRG-CODE    TO SAVE-CHRG-CODE                   04920021
049300        MOVE DTL-CHRG-AMT     TO SAVE-CHRG-AMT                    04930021
049400        MOVE DTL-CALC-DEC     TO SAVE-CALC-DEC                    04940021
049500        DISPLAY 'SAVE-CALC-DEC: ' SAVE-CALC-DEC                   04950021
049600        MOVE SAVE-DETAIL-LINE TO DETAIL-1                         04960021
049700        MOVE SAVE-CHRG-CODE   TO DTL-CHRG-CODE                    04970021
049800        MOVE SAVE-CHRG-AMT    TO DTL-CHRG-AMT                     04980021
049900        IF DTL-CHRG-CODE = 'DDF'                                  04990021
050000           MOVE SAVE-CALC-DEC TO DTL-CALC-DEC                     05000021
050100           DISPLAY 'DTL-CALC-DEC: ' DTL-CALC-DEC                  05010021
050200        END-IF                                                    05020021
050300     END-IF.                                                      05030021
050400                                                                  05040021
050500     WRITE ALL-INVC-PR-REPORT-REC FROM DETAIL-1                   05050021
050600         AFTER ADVANCING 1 LINE.                                  05060021
050700                                                                  05070021
050800     ADD 1 TO LINE-COUNT                                          05080021
050900              PV-ALL-INVC-RPT-OUT.                                05090021
051000                                                                  05100021
051100*--------------------------------------------------------------*  05110021
051200* W300-WRITE-BLANK-LINE                                        *  05120021
051300*--------------------------------------------------------------*  05130021
051400 W300-WRITE-BLANK-LINE.                                           05140021
051500                                                                  05150021
051600     DISPLAY 'W300-WRITE-BLANK-LINE'.                             05160021
051700                                                                  05170021
051800     IF LINE-COUNT >= MAX-LINES                                   05180021
051900        CONTINUE                                                  05190021
052000     ELSE                                                         05200021
052100        WRITE ALL-INVC-PR-REPORT-REC FROM BLANK-LINE              05210021
052200        ADD 1 TO LINE-COUNT                                       05220021
052300     END-IF.                                                      05230021
052400                                                                  05240021
052500*----------------------------------------------------------------*05250021
052600*    DB2 ABEND ROUTINE                                           *05260021
052700*----------------------------------------------------------------*05270021
052800 Z999-DB2-ABEND.                                                  05280021
052900                                                                  05290021
053000     CLOSE ALL-INVC-RPT-FILE                                      05300021
053100           ALL-INVC-PR-REPORT.                                    05310021
053200                                                                  05320021
053300     DISPLAY AA-ABEND-LIT.                                        05330021
053400     DISPLAY AA-MESSAGE-LINE-1.                                   05340021
053500     DISPLAY AA-MESSAGE-LINE-2.                                   05350021
053600     DISPLAY AA-DB2-ERROR-LIT.                                    05360021
053700     DISPLAY AA-PROGRAM-LIT.                                      05370021
053800     DISPLAY AA-PARAGRAPH-LIT.                                    05380021
053900     DISPLAY AA-DB2-OPERATION-LIT.                                05390021
054000     DISPLAY AA-DB2-TABLE-1.                                      05400021
054100     SET AC-DB2-ERROR TO TRUE.                                    05410021
054200                                                                  05420021
054300     COPY DPPD004.                                                05430021
054400                                                                  05440021
054500     CALL 'ILBOABN0' USING ABEND-CODE.                            05450021
054600                                                                  05460021
