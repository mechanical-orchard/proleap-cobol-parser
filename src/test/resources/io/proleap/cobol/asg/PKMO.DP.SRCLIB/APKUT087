000100 IDENTIFICATION DIVISION.                                         00010025
000200 PROGRAM-ID.     APKUT087.                                        00020026
000300 AUTHOR.         MIKE BESKE.                                      00030026
000400 DATE-WRITTEN.   NOVEMBER 2002.                                   00040026
000500*************************************************************     00050025
000600*    COBOL 2 WITH DB2 SQL                                   *     00060028
000700*                                                           *     00070025
000800*    CALCULATE NON-INVOICED RECEIPT AGING                   *     00080037
000900*                                                           *     00090025
001000*   PROGRAM OVERVIEW:                                       *     00100025
001100*                                                           *     00110025
001200*  THIS PROGRAM AGES THE SORTED NON-INVOICED RECEIPTS       *     00120035
001300*  EXTRACT FILE INTO FIVE DIFFERENT AGING BUCKETS. THE INPUT*     00130035
001400*  FILE IS SORTED IN DEPARTMENT, VENDOR NAME AND PO NUMBER  *     00140035
001500*  ORDER.  THE OUTPUT FILE IS USED AS INPUT FOR APKRP088.   *     00150035
001600*                                                           *     00160025
001700*   DB2 TABLES:                                             *     00170028
001800*  1. PURCHASE ORDER TABLE                      (TPURCHS)   *     00180037
001900*                                                           *     00190028
002000*   INPUT:                                                  *     00200025
002100*  1. NON-INVC-FILE                             (APRD042)   *     00210037
002200*                                                           *     00220025
002300*   OUTPUT:                                                 *     00230025
002400*  1. AGED-NIR-FILE                             (APRD071)   *     00240037
002500*                                                           *     00250025
002600*************************************************************     00260025
002700*   CHANGES:                                                *     00270025
002800*                                                           *     00280025
002900* 02/06/2003                                                *     00290037
003000*    CHANGE MADE: ARKPO PHASE3 PROJECT.                     *     00300037
003100*    UPDATED THE PGM TITLE TO MATCH THE SPEC TITLE.         *     00310037
003200*    UPDATED PGM COMMENT BLOCK WITH THE FILENAMES.          *     00320037
003300*    INCREASED THE FILE SIZE OF THE OUTPUT FILE TO 150 BYTES*     00330037
003400*    INCREASED THE W/S PO-NBR FIELD TO 9 BYTES.             *     00340038
003500* MADE BY:  MIKE BESKE                          WR#: 23500  *     00350037
003600*                                                           *     00360039
003700* 05/21/2004  CHANGED MADE: STORE CONSTRAINTS PROJECT       *     00370039
003800*             RECOMPILED THIS PROGRAM TO PICK UP THE APRD042*     00380039
003900*             COPYBOOK MODIFICATIONS.                       *     00390039
004000*             MADE BY: MIKE BESKE             WR/IR #:25805 *     00400039
007100*                                                           *     00401040
006700* 09/10/2021  CHANGED MADE: RECOMPILE FOR NEW APRD042       *     00402040
007000*             MADE BY: JEAN KURK              CHG0260549    *     00403040
004100*                                                           *     00410035
004200*************************************************************     00420025
004300/                                                                 00430025
004400 ENVIRONMENT DIVISION.                                            00440025
004500 CONFIGURATION SECTION.                                           00450025
004600 INPUT-OUTPUT SECTION.                                            00460025
004700 FILE-CONTROL.                                                    00470025
004800                                                                  00480025
004900     SELECT NON-INVC-FILE        ASSIGN TO UT-S-INP01.            00490025
005000     SELECT AGED-NIR-FILE        ASSIGN TO UT-S-OUT01.            00500035
005100                                                                  00510025
005200 DATA DIVISION.                                                   00520025
005300 FILE SECTION.                                                    00530025
005400 FD  NON-INVC-FILE                                                00540025
005500     RECORDING MODE IS F                                          00550025
005600     LABEL RECORDS ARE STANDARD                                   00560025
005700     BLOCK CONTAINS 0 RECORDS                                     00570025
005800     DATA RECORD IS NON-INVC-RECORD.                              00580025
005900 01  NON-INVC-RECORD             PIC  X(120).                     00590025
006000                                                                  00600025
006100 FD  AGED-NIR-FILE                                                00610035
006200     RECORDING MODE IS F                                          00620025
006300     LABEL RECORDS ARE STANDARD                                   00630025
006400     BLOCK CONTAINS 0 RECORDS                                     00640025
006500     DATA RECORD IS AGED-NIR-RECORD.                              00650035
006600 01  AGED-NIR-RECORD             PIC  X(150).                     00660037
006700                                                                  00670025
006800 WORKING-STORAGE SECTION.                                         00680025
006900                                                                  00690025
007000 01  PROGRAM-WORKAREA.                                            00700025
007100     05  FILLER                  PIC  X(30)           VALUE       00710025
007200         '** BEGINING OF APKUT087 W/S **'.                        00720026
007300                                                                  00730025
007400     05  PV-CURRENT-PARAGRAPH    PIC  X(30)           VALUE SPACE.00740025
007500     05  PV-PROGRAM-NAME         PIC  X(08)           VALUE       00750025
007600         'APKUT087'.                                              00760026
007700     05  PV-RETRY-MAX            PIC S9(04)    COMP   VALUE +3.   00770029
007800     05  PV-RETRY-COUNT          PIC S9(04)    COMP   VALUE +0.   00780029
007900     05  INPUT-COUNT             PIC 9(09)            VALUE  0.   00790032
008000     05  OUTPUT-COUNT            PIC 9(09)            VALUE  0.   00800032
008100                                                                  00810025
008200     05  PV-PO-NBR               PIC S9(9)            VALUE ZEROS 00820028
008300                                                       COMP.      00830028
008400     05  PV-YYYY-MM-DD.                                           00840025
008500         10  PV-CHECK-DATE       PIC X(10) VALUE SPACES.          00850025
008600                                                                  00860025
008700     05  PV-CURRENT-DATE.                                         00870025
008800         10  PV-CURRENT-YEAR     PIC  9(02)           VALUE 0.    00880025
008900         10  PV-CURRENT-MONTH    PIC  9(02)           VALUE 0.    00890025
009000         10  PV-CURRENT-DAY      PIC  9(02)           VALUE 0.    00900025
009100                                                                  00910025
009200     05  PV-CURRENT-JULIAN.                                       00920025
009300         10 PV-CURRENT-JUL-YY    PIC  9(02) VALUE 0.              00930025
009400         10 PV-CURRENT-JUL-DDD   PIC  9(03) VALUE 0.              00940025
009500     05  PV-CURRENT-JULIAN-CCYYDDD.                               00950025
009600         10 PV-CURRENT-JUL-CC    PIC  9(02) VALUE 0.              00960025
009700         10 PV-CURRENT-JUL-YYDDD PIC  9(05) VALUE 0.              00970025
009800                                                                  00980025
009900     05  PV-CURR-DATE-MINUS-60   PIC 9(07)            VALUE 0.    00990028
010000     05  PV-CURR-DT-MINUS-60-CH REDEFINES                         01000028
010100               PV-CURR-DATE-MINUS-60   PIC X(07).                 01010028
010200     05  PV-CURR-DATE-MINUS-90   PIC 9(07)            VALUE 0.    01020028
010300     05  PV-CURR-DT-MINUS-90-CH REDEFINES                         01030028
010400               PV-CURR-DATE-MINUS-90   PIC X(07).                 01040028
010500     05  PV-CURR-DATE-MINUS-120  PIC 9(07)            VALUE 0.    01050025
010600     05  PV-CURR-DT-MINUS-120-CH REDEFINES                        01060025
010700               PV-CURR-DATE-MINUS-120  PIC X(07).                 01070025
010800     05  PV-CURR-DATE-MINUS-180  PIC 9(07)            VALUE 0.    01080025
010900     05  PV-CURR-DT-MINUS-180-CH REDEFINES                        01090025
011000               PV-CURR-DATE-MINUS-180  PIC X(07).                 01100025
011100     05  PV-CURR-DATE-MINUS-360  PIC 9(07)            VALUE 0.    01110025
011200     05  PV-CURR-DT-MINUS-360-CH REDEFINES                        01120025
011300               PV-CURR-DATE-MINUS-360  PIC X(07).                 01130025
011400                                                                  01140025
011500     05  WS-COMPARE-CCYYDDD            PIC 9(07)      VALUE 0.    01150025
011600                                                                  01160025
011700     05  PV-CURRENT-TIME.                                         01170025
011800         10  PV-CURRENT-HOUR     PIC  9(02)           VALUE 0.    01180025
011900         10  PV-CURRENT-MINUTE   PIC  9(02)           VALUE 0.    01190025
012000         10  FILLER              PIC  9(02)           VALUE 0.    01200025
012100                                                                  01210025
012200 01  ACCUM-FIELDS.                                                01220025
012300     05  PV-AMOUNT-FIELDS.                                        01230028
012400         10  PV-COST-0           PIC S9(09)V99 COMP-3 VALUE +0.   01240028
012500         10  PV-COST-61          PIC S9(09)V99 COMP-3 VALUE +0.   01250028
012600         10  PV-COST-91          PIC S9(09)V99 COMP-3 VALUE +0.   01260029
012700         10  PV-COST-121         PIC S9(09)V99 COMP-3 VALUE +0.   01270028
012800         10  PV-COST-181         PIC S9(09)V99 COMP-3 VALUE +0.   01280028
012900         10  PV-RETAIL-0         PIC S9(09)V99 COMP-3 VALUE +0.   01290028
013000         10  PV-RETAIL-61        PIC S9(09)V99 COMP-3 VALUE +0.   01300028
013100         10  PV-RETAIL-91        PIC S9(09)V99 COMP-3 VALUE +0.   01310029
013200         10  PV-RETAIL-121       PIC S9(09)V99 COMP-3 VALUE +0.   01320028
013300         10  PV-RETAIL-181       PIC S9(09)V99 COMP-3 VALUE +0.   01330028
013400                                                                  01340026
013500 01  PROGRAM-SWITCHES-SUBS.                                       01350025
013600     05  PV-EOF-SW               PIC  X(01)           VALUE 'N'.  01360025
013700         88  EOF                 VALUE 'Y'.                       01370025
013800     05  PV-DATE-SW              PIC  X(01)           VALUE 'N'.  01380025
013900         88  VALID-DATE          VALUE 'Y'.                       01390025
014000         88  NOT-VALID-DATE      VALUE 'N'.                       01400025
014100                                                                  01410026
014200 01  SAVE-FIELDS.                                                 01420026
014300     05  SAVE-DEPARTMENT         PIC  9(03)           VALUE 0.    01430026
014400     05  SAVE-VENDOR-NAME        PIC  X(30)           VALUE SPACE.01440026
014500     05  SAVE-VENDOR-NBR         PIC  X(09)           VALUE SPACE.01450026
014600     05  SAVE-PO-NBR             PIC  9(09)           VALUE 0.    01460037
014700                                                                  01470026
014800*  INPUT RECORD AREA                                              01480025
014900                                                                  01490025
015000     COPY APRD042.                                                01500025
015100                                                                  01510025
015200*  OUTPUT RECORD AREA                                             01520026
015300                                                                  01530026
015400     COPY APRD071.                                                01540026
015500                                                                  01550026
015600                                                                  01560026
015700*** GREGORIAN/JULIAN DATE CONVERSION                              01570026
015800     COPY DPWS500.                                                01580026
015900                                                                  01590026
016000*----------------------------------------------------------------*01600028
016100*  PURCHASE TABLE                                                *01610028
016200*----------------------------------------------------------------*01620028
016300     EXEC SQL                                                     01630028
016400          INCLUDE TPURCHS                                         01640028
016500     END-EXEC.                                                    01650028
016600                                                                  01660028
016700*                                                                 01670028
016800*    SQL COMMUNICATIONS AREA DCLGEN                               01680028
016900*                                                                 01690028
017000     EXEC SQL                                                     01700028
017100         INCLUDE SQLCA                                            01710028
017200     END-EXEC.                                                    01720028
017300                                                                  01730028
017400*----------------------------------------------------------------*01740026
017500*  ABEND DATA AREAS                                              *01750026
017600*----------------------------------------------------------------*01760026
017700 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          01770026
017800                                             COMP SYNC.           01780026
017900     88  AC-BAD-DATA                         VALUE +4003.         01790026
018000     88  AC-DB2-ERROR                        VALUE +4013.         01800028
018100     88  AC-DATE-ERROR                       VALUE +4019.         01810026
018200                                                                  01820026
018300                                                                  01830026
018400 01  ABEND-AREAS.                                                 01840026
018500     05  AA-ABEND-LIT            PIC  X(40)  VALUE                01850026
018600             '*****       ABEND'.                                 01860026
018700     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                01870026
018800             '*****   PROGRAM: APKUT087'.                         01880026
018900     05  AA-PARAGRAPH-LIT.                                        01890026
019000         10  FILLER              PIC  X(17)  VALUE                01900026
019100             '***** PARAGRAPH: '.                                 01910026
019200         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        01920026
019300     05  AA-MESSAGE-LINE.                                         01930026
019400         10  FILLER              PIC  X(06)  VALUE '*****'.       01940026
019500         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        01950026
019600     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                01960028
019700             '*****    DB2 ERROR'.                                01970028
019800     05  AA-DB2-OPERATION-LIT.                                    01980028
019900         10  FILLER              PIC  X(17)  VALUE                01990028
020000             '***** OPERATION: '.                                 02000028
020100         10  AA-DB2-OPERATION.                                    02010028
020200             15  AA-DB2-OP-1     PIC  X(50)  VALUE SPACES.        02020028
020300             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        02030028
020400     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        02040028
020500     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        02050028
020600     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        02060028
020700     05  AA-DB2-TABLE-4          PIC  X(08)  VALUE SPACES.        02070028
020800     05  AA-DB2-TABLE-5          PIC  X(08)  VALUE SPACES.        02080028
020900                                                                  02090026
021000     COPY DPWS004.                                                02100028
021100                                                                  02110028
021200 01  FILLER                      PIC  X(25)  VALUE                02120026
021300     '** END OF APKUT087 W/S **'.                                 02130026
021400                                                                  02140026
021500 PROCEDURE DIVISION.                                              02150026
021600                                                                  02160026
021700***************************************************************** 02170026
021800*  MAIN DRIVER PARAGRAPH                                          02180036
021900***************************************************************** 02190026
022000 A100-MAIN.                                                       02200035
022100                                                                  02210026
022200     MOVE 'A100-MAIN'            TO   PV-CURRENT-PARAGRAPH.       02220035
022300                                                                  02230026
022400     PERFORM B100-BEGIN-PROGRAM.                                  02240035
022500                                                                  02250026
022600     PERFORM B200-PROCESS-DATA UNTIL EOF.                         02260035
022700                                                                  02270026
022800     PERFORM B300-END-PROGRAM.                                    02280035
022900                                                                  02290026
023000     GOBACK.                                                      02300026
023100                                                                  02310026
023200***************************************************************** 02320026
023300*  PROGRAM INITIALIZATION                                         02330036
023400***************************************************************** 02340026
023500 B100-BEGIN-PROGRAM.                                              02350035
023600                                                                  02360026
023700     MOVE 'B100-BEGIN-PROGRAM'   TO   PV-CURRENT-PARAGRAPH.       02370035
023800                                                                  02380026
023900     OPEN INPUT  NON-INVC-FILE                                    02390026
024000          OUTPUT AGED-NIR-FILE.                                   02400035
024100                                                                  02410026
024200     INITIALIZE DCLTPURCHS                                        02420031
024300                AP071-RECORD.                                     02430031
024400                                                                  02440028
024500     ACCEPT PV-CURRENT-JULIAN    FROM DAY.                        02450026
024600     MOVE PV-CURRENT-JULIAN    TO PV-CURRENT-JUL-YYDDD.           02460026
024700     IF PV-CURRENT-JUL-YY > 80                                    02470026
024800        MOVE 19 TO PV-CURRENT-JUL-CC                              02480026
024900     ELSE                                                         02490026
025000        MOVE 20 TO PV-CURRENT-JUL-CC.                             02500026
025100                                                                  02510026
025200     PERFORM C100-CALC-OLD-DATES.                                 02520035
025300                                                                  02530026
025400     PERFORM R100-READ-NON-INVC-FILE.                             02540035
025500     MOVE AP042-DEPT-NBR         TO SAVE-DEPARTMENT.              02550026
025600     MOVE AP042-ENT-NM-DESC      TO SAVE-VENDOR-NAME.             02560026
025700     MOVE AP042-VND-NBR          TO SAVE-VENDOR-NBR.              02570026
025800     MOVE AP042-PO-NBR           TO SAVE-PO-NBR.                  02580026
025900                                                                  02590026
026000***************************************************************** 02600035
026100*  PROCESS THE INPUT RECORD BY COMPARING THE DEPARTMENT, VENDOR   02610036
026200*  NAME & PO NUMBER TO SAVE FIELDS.  DETERMINE THE AGE OF THE     02620036
026300*  RECORD AND ADD THE COST AND RETAIL AMOUNTS TO THE APPROPRIATE  02630036
026400*  BUCKETS.                                                       02640036
026500***************************************************************** 02650036
026600 B200-PROCESS-DATA.                                               02660036
026700                                                                  02670036
026800     MOVE 'B200-PROCESS-DATA'    TO   PV-CURRENT-PARAGRAPH.       02680036
026900                                                                  02690036
027000     IF AP042-DEPT-NBR NOT = SAVE-DEPARTMENT                      02700036
027100        PERFORM C200-PROCESS-DETAIL                               02710036
027200        MOVE AP042-DEPT-NBR         TO   SAVE-DEPARTMENT          02720036
027300        MOVE AP042-ENT-NM-DESC      TO   SAVE-VENDOR-NAME         02730036
027400        MOVE AP042-VND-NBR          TO   SAVE-VENDOR-NBR          02740036
027500        MOVE AP042-PO-NBR           TO   SAVE-PO-NBR              02750036
027600     ELSE                                                         02760036
027700        IF AP042-ENT-NM-DESC NOT = SAVE-VENDOR-NAME               02770036
027800           PERFORM C200-PROCESS-DETAIL                            02780036
027900           MOVE AP042-ENT-NM-DESC   TO   SAVE-VENDOR-NAME         02790036
028000           MOVE AP042-VND-NBR       TO   SAVE-VENDOR-NBR          02800036
028100           MOVE AP042-PO-NBR        TO   SAVE-PO-NBR              02810036
028200        ELSE                                                      02820036
028300           IF AP042-PO-NBR NOT  = SAVE-PO-NBR                     02830036
028400              PERFORM C200-PROCESS-DETAIL                         02840036
028500              MOVE AP042-PO-NBR     TO   SAVE-PO-NBR              02850036
028600           END-IF                                                 02860036
028700        END-IF                                                    02870036
028800     END-IF.                                                      02880036
028900                                                                  02890036
029000     SET NOT-VALID-DATE TO TRUE.                                  02900036
029100     MOVE AP042-REC-DTE TO PV-CHECK-DATE.                         02910036
029200                                                                  02920036
029300     MOVE SPACES        TO PV-DATE-SW.                            02930036
029400     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         02940036
029500     SET DPG51-ACTUAL-CALENDAR-ONLY                               02950036
029600         DPG52-LK-DTE-ISO-FMT                                     02960036
029700         DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                     02970036
029800     MOVE PV-YYYY-MM-DD              TO DPG52-LK-DATE-INPUT.      02980036
029900     PERFORM D100-DATE-ROUTINE.                                   02990036
030000                                                                  03000036
030100     IF VALID-DATE                                                03010036
030200          MOVE DPG55-JULIAN-DATE-CCYYDDD TO WS-COMPARE-CCYYDDD    03020036
030300        EVALUATE TRUE                                             03030036
030400          WHEN WS-COMPARE-CCYYDDD  < PV-CURR-DATE-MINUS-180       03040036
030500               PERFORM E500-COST-181                              03050036
030600          WHEN WS-COMPARE-CCYYDDD  < PV-CURR-DATE-MINUS-120       03060036
030700               PERFORM E400-COST-121                              03070036
030800          WHEN WS-COMPARE-CCYYDDD  < PV-CURR-DATE-MINUS-90        03080036
030900               PERFORM E300-COST-91                               03090036
031000          WHEN WS-COMPARE-CCYYDDD  < PV-CURR-DATE-MINUS-60        03100036
031100               PERFORM E200-COST-61                               03110036
031200          WHEN OTHER                                              03120036
031300               PERFORM E100-COST-0                                03130036
031400        END-EVALUATE                                              03140036
031500     END-IF.                                                      03150036
031600                                                                  03160036
031700     PERFORM R100-READ-NON-INVC-FILE.                             03170036
031800                                                                  03180036
031900***************************************************************** 03190036
032000*  END OF PROCESSING.  PROCESS THE LAST RECORD.  CLOSE FILES.     03200036
032100*  DISPLAY COUNTS.                                                03210036
032200***************************************************************** 03220036
032300 B300-END-PROGRAM.                                                03230036
032400                                                                  03240036
032500     MOVE 'B300-END-PROGRAM'     TO   PV-CURRENT-PARAGRAPH.       03250036
032600                                                                  03260036
032700     PERFORM C200-PROCESS-DETAIL.                                 03270036
032800                                                                  03280036
032900     CLOSE  NON-INVC-FILE                                         03290036
033000            AGED-NIR-FILE.                                        03300036
033100                                                                  03310036
033200     DISPLAY '***** APKUT087 COUNTS *****'.                       03320036
033300     DISPLAY 'RECORDS READ    = ' INPUT-COUNT.                    03330036
033400     DISPLAY 'RECORDS WRITTEN = ' OUTPUT-COUNT.                   03340036
033500     DISPLAY '***************************'.                       03350036
033600                                                                  03360036
033700***************************************************************** 03370036
033800*  CALCULATES DATES 60, 90, 120, 180, AND 360 DAYS PAST TO BE     03380036
033900*  USED IN DATE COMPARISONS FOR AGING.                            03390036
034000***************************************************************** 03400036
034100 C100-CALC-OLD-DATES.                                             03410036
034200                                                                  03420036
034300* CALCULATE 60 DAYS AGO                                           03430036
034400     MOVE SPACES                    TO PV-DATE-SW.                03440036
034500     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         03450036
034600     SET DPG51-ACTUAL-CALENDAR-ONLY                               03460036
034700         DPG51-DECREMENT-DATE                                     03470036
034800         DPG52-LK-DTE-JULIAN-CC     TO TRUE.                      03480036
034900     MOVE PV-CURRENT-JULIAN-CCYYDDD TO DPG52-LK-DATE-INPUT.       03490036
035000     MOVE 60                        TO DPG51-INCR-DECR-DAYS-9.    03500036
035100     PERFORM D100-DATE-ROUTINE.                                   03510036
035200     IF VALID-DATE                                                03520036
035300         MOVE DPG55-JULIAN-DATE-CCYYDDD TO PV-CURR-DT-MINUS-60-CH 03530036
035400     ELSE                                                         03540036
035500         DISPLAY 'JULIAN DATE '  PV-CURRENT-JULIAN-CCYYDDD        03550036
035600         MOVE 'C100-CALC-OLD-DATES' TO AA-PARAGRAPH-NAME          03560036
035700         MOVE 'BAD DATE CONVERSION FOR CURRENT DATE MINUS 60'     03570036
035800                                    TO AA-MESSAGE                 03580036
035900         SET AC-DATE-ERROR          TO TRUE                       03590036
036000         PERFORM Z999-ABEND                                       03600036
036100     END-IF.                                                      03610036
036200                                                                  03620036
036300* CALCULATE 90 DAYS AGO                                           03630036
036400     MOVE SPACES                    TO PV-DATE-SW.                03640036
036500     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         03650036
036600     SET DPG51-ACTUAL-CALENDAR-ONLY                               03660036
036700         DPG51-DECREMENT-DATE                                     03670036
036800         DPG52-LK-DTE-JULIAN-CC     TO TRUE.                      03680036
036900     MOVE PV-CURRENT-JULIAN-CCYYDDD TO DPG52-LK-DATE-INPUT.       03690036
037000     MOVE 90                        TO DPG51-INCR-DECR-DAYS-9.    03700036
037100     PERFORM D100-DATE-ROUTINE.                                   03710036
037200     IF VALID-DATE                                                03720036
037300         MOVE DPG55-JULIAN-DATE-CCYYDDD TO PV-CURR-DT-MINUS-90-CH 03730036
037400     ELSE                                                         03740036
037500         DISPLAY 'JULIAN DATE '  PV-CURRENT-JULIAN-CCYYDDD        03750036
037600         MOVE 'C100-CALC-OLD-DATES' TO AA-PARAGRAPH-NAME          03760036
037700         MOVE 'BAD DATE CONVERSION FOR CURRENT DATE MINUS 90'     03770036
037800                                    TO AA-MESSAGE                 03780036
037900         SET AC-DATE-ERROR          TO TRUE                       03790036
038000         PERFORM Z999-ABEND                                       03800036
038100     END-IF.                                                      03810036
038200                                                                  03820036
038300* CALCULATE 120 DAYS AGO                                          03830036
038400     MOVE SPACES                    TO PV-DATE-SW.                03840036
038500     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         03850036
038600     SET DPG51-ACTUAL-CALENDAR-ONLY                               03860036
038700         DPG51-DECREMENT-DATE                                     03870036
038800         DPG52-LK-DTE-JULIAN-CC     TO TRUE.                      03880036
038900     MOVE PV-CURRENT-JULIAN-CCYYDDD TO DPG52-LK-DATE-INPUT.       03890036
039000     MOVE 120                       TO DPG51-INCR-DECR-DAYS-9.    03900036
039100     PERFORM D100-DATE-ROUTINE.                                   03910036
039200     IF VALID-DATE                                                03920036
039300         MOVE DPG55-JULIAN-DATE-CCYYDDD TO PV-CURR-DT-MINUS-120-CH03930036
039400     ELSE                                                         03940036
039500         DISPLAY 'JULIAN DATE '  PV-CURRENT-JULIAN-CCYYDDD        03950036
039600         MOVE 'C100-CALC-OLD-DATES' TO AA-PARAGRAPH-NAME          03960036
039700         MOVE 'BAD DATE CONVERSION FOR CURRENT DATE MINUS 120'    03970036
039800                                    TO AA-MESSAGE                 03980036
039900         SET AC-DATE-ERROR          TO TRUE                       03990036
040000         PERFORM Z999-ABEND                                       04000036
040100     END-IF.                                                      04010036
040200                                                                  04020036
040300* CALCULATE 180 DAYS AGO                                          04030036
040400     MOVE SPACES                    TO PV-DATE-SW.                04040036
040500     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         04050036
040600     SET DPG51-ACTUAL-CALENDAR-ONLY                               04060036
040700         DPG51-DECREMENT-DATE                                     04070036
040800         DPG52-LK-DTE-JULIAN-CC     TO TRUE.                      04080036
040900     MOVE PV-CURRENT-JULIAN-CCYYDDD TO DPG52-LK-DATE-INPUT.       04090036
041000     MOVE 180                       TO DPG51-INCR-DECR-DAYS-9.    04100036
041100     PERFORM D100-DATE-ROUTINE.                                   04110036
041200     IF VALID-DATE                                                04120036
041300         MOVE DPG55-JULIAN-DATE-CCYYDDD TO PV-CURR-DT-MINUS-180-CH04130036
041400     ELSE                                                         04140036
041500         DISPLAY 'JULIAN DATE '  PV-CURRENT-JULIAN-CCYYDDD        04150036
041600         MOVE 'C100-CALC-OLD-DATES' TO AA-PARAGRAPH-NAME          04160036
041700         MOVE 'BAD DATE CONVERSION FOR CURRENT DATE MINUS 180'    04170036
041800                                    TO AA-MESSAGE                 04180036
041900         SET AC-DATE-ERROR          TO TRUE                       04190036
042000         PERFORM Z999-ABEND                                       04200036
042100     END-IF.                                                      04210036
042200                                                                  04220036
042300* CALCULATE 360 DAYS AGO                                          04230036
042400     MOVE SPACES                    TO PV-DATE-SW.                04240036
042500     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         04250036
042600     SET DPG51-ACTUAL-CALENDAR-ONLY                               04260036
042700         DPG51-DECREMENT-DATE                                     04270036
042800         DPG52-LK-DTE-JULIAN-CC     TO TRUE.                      04280036
042900     MOVE PV-CURRENT-JULIAN-CCYYDDD TO DPG52-LK-DATE-INPUT.       04290036
043000     MOVE 360                       TO DPG51-INCR-DECR-DAYS-9.    04300036
043100     PERFORM D100-DATE-ROUTINE.                                   04310036
043200     IF VALID-DATE                                                04320036
043300         MOVE DPG55-JULIAN-DATE-CCYYDDD TO PV-CURR-DT-MINUS-360-CH04330036
043400     ELSE                                                         04340036
043500         DISPLAY 'JULIAN DATE '  PV-CURRENT-JULIAN-CCYYDDD        04350036
043600         MOVE 'C100-CALC-OLD-DATES' TO AA-PARAGRAPH-NAME          04360036
043700         MOVE 'BAD DATE CONVERSION FOR CURRENT DATE MINUS 360'    04370036
043800                                    TO AA-MESSAGE                 04380036
043900         SET AC-DATE-ERROR          TO TRUE                       04390036
044000         PERFORM Z999-ABEND                                       04400036
044100     END-IF.                                                      04410036
044200                                                                  04420036
044300***************************************************************** 04430036
044400*  MOVE THE APPROPRIATE FIELDS TO THE OUTPUT RECORD LAYOUT.       04440036
044500*  WRITE OUT THE RECORD TO THE OUTPUT FILE.                       04450036
044600***************************************************************** 04460036
044700 C200-PROCESS-DETAIL.                                             04470036
044800                                                                  04480036
044900     MOVE SAVE-DEPARTMENT     TO AP071-DEPT-NBR.                  04490036
045000     MOVE SAVE-VENDOR-NAME    TO AP071-ENT-NM-DESC.               04500036
045100     MOVE SAVE-VENDOR-NBR     TO AP071-VND-NBR.                   04510036
045200     MOVE SAVE-PO-NBR         TO AP071-PO-NBR                     04520036
045300                                 PV-PO-NBR.                       04530036
045400     PERFORM R200-GET-PO-DATA.                                    04540036
045500     MOVE PURCHS-OTB-PER-NBR  TO AP071-OTB-PER-NBR.               04550036
045600     COMPUTE AP071-TOTAL-COST   = PV-COST-181 + PV-COST-121 +     04560036
045700                                  PV-COST-91  + PV-COST-61  +     04570036
045800                                  PV-COST-0.                      04580036
045900     COMPUTE AP071-TOTAL-RETAIL = PV-RETAIL-181 + PV-RETAIL-121 + 04590036
046000                                  PV-RETAIL-91  + PV-RETAIL-61  + 04600036
046100                                  PV-RETAIL-0.                    04610036
046200     MOVE PV-COST-181         TO AP071-COST-181.                  04620036
046300     MOVE PV-RETAIL-181       TO AP071-RETAIL-181.                04630036
046400     MOVE PV-COST-121         TO AP071-COST-121.                  04640036
046500     MOVE PV-RETAIL-121       TO AP071-RETAIL-121.                04650036
046600     MOVE PV-COST-91          TO AP071-COST-91.                   04660036
046700     MOVE PV-RETAIL-91        TO AP071-RETAIL-91.                 04670036
046800     MOVE PV-COST-61          TO AP071-COST-61.                   04680036
046900     MOVE PV-RETAIL-61        TO AP071-RETAIL-61.                 04690036
047000     MOVE PV-COST-0           TO AP071-COST-0.                    04700036
047100     MOVE PV-RETAIL-0         TO AP071-RETAIL-0.                  04710036
047200                                                                  04720036
047300     WRITE AGED-NIR-RECORD FROM AP071-RECORD.                     04730036
047400     ADD 1 TO OUTPUT-COUNT.                                       04740036
047500     INITIALIZE AP071-RECORD                                      04750036
047600                PV-AMOUNT-FIELDS.                                 04760036
047700                                                                  04770036
047800***************************************************************** 04780036
047900*  CALLS THE DATE ROUTINE MODULE.                                 04790036
048000***************************************************************** 04800036
048100 D100-DATE-ROUTINE.                                               04810036
048200                                                                  04820036
048300     CALL DP500-KOHLS-CALENDAR-ROUTINE                            04830036
048400         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               04840036
048500                                                                  04850036
048600     IF (DPG54-SEVERE-ERROR OR                                    04860036
048700         DPG54-WARNING-ERROR)                                     04870036
048800         SET NOT-VALID-DATE TO TRUE                               04880036
048900     ELSE                                                         04890036
049000         SET VALID-DATE TO TRUE                                   04900036
049100     END-IF.                                                      04910036
049200                                                                  04920036
049300***************************************************************** 04930036
049400*  ADD THE RETAIL AND COST AMOUNTS TO THE 0 DAYS BUCKET.          04940036
049500***************************************************************** 04950036
049600 E100-COST-0.                                                     04960036
049700                                                                  04970036
049800     ADD AP042-CALCD-VRFD-RTL-AMT  TO  PV-RETAIL-0.               04980036
049900     ADD AP042-CALCD-VRFD-COST-AMT TO  PV-COST-0.                 04990036
050000                                                                  05000036
050100***************************************************************** 05010036
050200*  ADD THE RETAIL AND COST AMOUNTS TO THE 61 DAYS BUCKET.         05020036
050300***************************************************************** 05030036
050400 E200-COST-61.                                                    05040036
050500                                                                  05050036
050600     ADD AP042-CALCD-VRFD-RTL-AMT  TO  PV-RETAIL-61.              05060036
050700     ADD AP042-CALCD-VRFD-COST-AMT TO  PV-COST-61.                05070036
050800                                                                  05080036
050900***************************************************************** 05090036
051000*  ADD THE RETAIL AND COST AMOUNTS TO THE 91 DAYS BUCKET.         05100036
051100***************************************************************** 05110036
051200 E300-COST-91.                                                    05120036
051300                                                                  05130036
051400     ADD AP042-CALCD-VRFD-RTL-AMT  TO  PV-RETAIL-91.              05140036
051500     ADD AP042-CALCD-VRFD-COST-AMT TO  PV-COST-91.                05150036
051600                                                                  05160036
051700***************************************************************** 05170036
051800*  ADD THE RETAIL AND COST AMOUNTS TO THE 121 DAYS BUCKET.        05180036
051900***************************************************************** 05190036
052000 E400-COST-121.                                                   05200036
052100                                                                  05210036
052200     ADD AP042-CALCD-VRFD-RTL-AMT  TO  PV-RETAIL-121.             05220036
052300     ADD AP042-CALCD-VRFD-COST-AMT TO  PV-COST-121.               05230036
052400                                                                  05240036
052500***************************************************************** 05250036
052600*  ADD THE RETAIL AND COST AMOUNTS TO THE 181 DAYS BUCKET.        05260036
052700***************************************************************** 05270036
052800 E500-COST-181.                                                   05280036
052900                                                                  05290036
053000     ADD AP042-CALCD-VRFD-RTL-AMT  TO  PV-RETAIL-181.             05300036
053100     ADD AP042-CALCD-VRFD-COST-AMT TO  PV-COST-181.               05310036
053200                                                                  05320036
053300***************************************************************** 05330036
053400*  READ THE INPUT FILE.                                           05340036
053500***************************************************************** 05350036
053600 R100-READ-NON-INVC-FILE.                                         05360036
053700                                                                  05370036
053800     MOVE 'R100-READ-NON-INVC-FILE'                               05380036
053900                                 TO   PV-CURRENT-PARAGRAPH.       05390036
054000                                                                  05400036
054100     READ NON-INVC-FILE          INTO AP042-EXTRACT-FILE          05410036
054200         AT END                                                   05420036
054300             SET EOF TO TRUE.                                     05430036
054400                                                                  05440036
054500     IF PV-EOF-SW = 'N'                                           05450036
054600        ADD 1 TO INPUT-COUNT                                      05460036
054700     END-IF.                                                      05470036
054800                                                                  05480036
054900***************************************************************** 05490036
055000*  SELECT THE OPEN TO BUY PERIOD FOM TPURCHS.                     05500036
055100***************************************************************** 05510036
055200 R200-GET-PO-DATA.                                                05520036
055300                                                                  05530036
055400     MOVE 'R200-GET-PO-DATA    ' TO PV-CURRENT-PARAGRAPH.         05540036
055500                                                                  05550036
055600     PERFORM WITH TEST AFTER                                      05560036
055700             VARYING PV-RETRY-COUNT FROM 1 BY 1                   05570036
055800             UNTIL   PV-RETRY-COUNT > PV-RETRY-MAX OR             05580036
055900                     SQLCODE = ZERO OR                            05590036
056000                     SQLCODE = +100                               05600036
056100                                                                  05610036
056200             EXEC SQL                                             05620036
056300                 SELECT                                           05630036
056400                       OTB_PER_NBR                                05640036
056500                 INTO                                             05650036
056600                      :PURCHS-OTB-PER-NBR                         05660036
056700                 FROM                                             05670036
056800                      TPURCHS                                     05680036
056900                 WHERE PO_NBR         = :PV-PO-NBR                05690036
057000                   AND VER_STATUS_CDE = 'A'                       05700036
057100             END-EXEC                                             05710036
057200                                                                  05720036
057300             EVALUATE TRUE                                        05730036
057400                 WHEN SQLCODE = ZERO                              05740036
057500                 WHEN SQLCODE = +100                              05750036
057600                 WHEN SQLCODE = -904                              05760036
057700                 WHEN SQLCODE = -913                              05770036
057800                      CONTINUE                                    05780036
057900                                                                  05790036
058000                 WHEN SQLWARN0 NOT = SPACES                       05800036
058100                 WHEN SQLCODE  NOT = ZERO                         05810036
058200                     MOVE PV-CURRENT-PARAGRAPH                    05820036
058300                                         TO AA-PARAGRAPH-NAME     05830036
058400                     MOVE 'UNSUCCESSFUL SELECT'                   05840036
058500                                         TO AA-DB2-OPERATION      05850036
058600                     MOVE 'TPURCHS'      TO AA-DB2-TABLE-1        05860036
058700                     MOVE SPACES         TO AA-DB2-TABLE-2        05870036
058800                                            AA-DB2-TABLE-3        05880036
058900                                            AA-DB2-TABLE-4        05890036
059000                                            AA-DB2-TABLE-5        05900036
059100                     PERFORM Z998-DB2-ABEND                       05910036
059200             END-EVALUATE                                         05920036
059300     END-PERFORM.                                                 05930036
059400                                                                  05940036
059500     IF PV-RETRY-COUNT > PV-RETRY-MAX                             05950036
059600         MOVE PV-CURRENT-PARAGRAPH                                05960036
059700                             TO AA-PARAGRAPH-NAME                 05970036
059800         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    05980036
059900                             TO AA-DB2-OPERATION                  05990036
060000         MOVE 'TPURCHS'      TO AA-DB2-TABLE-1                    06000036
060100         MOVE SPACES         TO AA-DB2-TABLE-2                    06010036
060200                                AA-DB2-TABLE-3                    06020036
060300                                AA-DB2-TABLE-4                    06030036
060400                                AA-DB2-TABLE-5                    06040036
060500         PERFORM Z998-DB2-ABEND                                   06050036
060600     END-IF.                                                      06060036
060700                                                                  06070036
060800     EVALUATE TRUE                                                06080036
060900         WHEN SQLCODE = ZEROS                                     06090036
061000             CONTINUE                                             06100036
061100         WHEN SQLCODE = +100                                      06110036
061200             MOVE '999'             TO PURCHS-DEPT-NBR            06120036
061300         WHEN OTHER                                               06130036
061400             MOVE PV-CURRENT-PARAGRAPH                            06140036
061500                                 TO AA-PARAGRAPH-NAME             06150036
061600             MOVE 'UNSUCCESSFUL SELECT'                           06160036
061700                                 TO AA-DB2-OPERATION              06170036
061800             MOVE 'TPURCHS'      TO AA-DB2-TABLE-1                06180036
061900             MOVE '       '      TO AA-DB2-TABLE-2                06190036
062000             MOVE '       '      TO AA-DB2-TABLE-3                06200036
062100             MOVE SPACES         TO AA-DB2-TABLE-4                06210036
062200                                    AA-DB2-TABLE-5                06220036
062300             PERFORM Z998-DB2-ABEND                               06230036
062400     END-EVALUATE.                                                06240036
062500                                                                  06250036
062600***************************************************************** 06260036
062700*  ABEND ROUTINE FOR DB2 ERRORS                                   06270036
062800***************************************************************** 06280036
062900 Z998-DB2-ABEND.                                                  06290036
063000                                                                  06300036
063100     CLOSE  NON-INVC-FILE                                         06310036
063200            AGED-NIR-FILE.                                        06320036
063300                                                                  06330036
063400     DISPLAY AA-ABEND-LIT.                                        06340036
063500     DISPLAY AA-DB2-ERROR-LIT.                                    06350036
063600     DISPLAY AA-PROGRAM-LIT.                                      06360036
063700     DISPLAY AA-PARAGRAPH-LIT.                                    06370036
063800     DISPLAY AA-DB2-OPERATION-LIT.                                06380036
063900     DISPLAY AA-DB2-TABLE-1.                                      06390036
064000     DISPLAY AA-DB2-TABLE-2.                                      06400036
064100     DISPLAY AA-DB2-TABLE-3.                                      06410036
064200     DISPLAY AA-DB2-TABLE-4.                                      06420036
064300     SET AC-DB2-ERROR TO TRUE.                                    06430036
064400                                                                  06440036
064500     COPY DPPD004.                                                06450036
064600                                                                  06460036
064700     CALL 'ILBOABN0' USING ABEND-CODE.                            06470036
064800                                                                  06480036
064900***************************************************************** 06490036
065000*  ABEND ROUTINE FOR ERRORS                                       06500036
065100***************************************************************** 06510036
065200 Z999-ABEND.                                                      06520036
065300                                                                  06530036
065400     CLOSE  NON-INVC-FILE                                         06540036
065500            AGED-NIR-FILE.                                        06550036
065600                                                                  06560036
065700     DISPLAY AA-ABEND-LIT.                                        06570036
065800     DISPLAY AA-PROGRAM-LIT.                                      06580036
065900     DISPLAY AA-PARAGRAPH-LIT.                                    06590036
066000     DISPLAY AA-MESSAGE-LINE.                                     06600036
066100     CALL 'ILBOABN0' USING ABEND-CODE.                            06610036
