      ******************************************************************00010021
       IDENTIFICATION DIVISION.                                         00020021
      ******************************************************************00030021
                                                                        00040021
       PROGRAM-ID.             TFKUT503.                                00050021
       AUTHOR.                 JACK KRAMER.                             00060021
       INSTALLATION.           KOHLS.                                   00070021
       DATE-WRITTEN            3/98.                                    00080021
       DATE-COMPILED.                                                   00090021
                                                                        00100021
      ******************************************************************00110021
      *  THIS PROGRAM PRODUCES AN OUTPUT FILE OF ALL TRANSFERS THAT WERE00120021
      *  POSITIVELY RECEIVED AT AN RTV LOCATION DURING THE PREVIOUS     00130021
      *  FISCAL MONTH. THE FILE CONTAINS INFORMATION NECESSARY TO       00140021
      *  PRODUCE A FISCAL MONTH REPORT SHOWING RTV TRANSFER DISCREPANCY 00150021
      *  PERCENTAGES.                                                   00160021
      ******************************************************************00170021
100404** 10/04/2004 CHANGED BY: RAY GRAF                                00180021
100404**     EXPAND STORE NUMBER. MAKE DOMAIN COMPLIANT.                00190021
      ***************************************************************** 00200021
010209** 01/02/2009 CHANGED BY: DAVE WELLER                             00210021
010209**     EXPAND DISTRICT NUMBER.                                    00220021
      ***************************************************************** 00230021
022812** 02/28/2012 CHANGED BY: CHERI PARMLEY           PRJ#3403        00240021
022812**     COMPILE FOR CHANGES TO TTFITEM AND TTFITRC TABLES          00250021
      ***************************************************************** 00260021
C98011** 11/03/2014 CHANGED BY: COGNIZANT                               00270021
C98011**     INCREASED SPACE FOR PROGRAM VARIABLES AND RECOMPILE        00280021
C98011**     THE CHAGNES DONE FOR COPYBOOK TFRD043                      00290021
      ***************************************************************** 00300021
                                                                        00310021
      ******************************************************************00320021
       ENVIRONMENT DIVISION.                                            00330021
      ******************************************************************00340021
                                                                        00350021
       CONFIGURATION SECTION.                                           00360021
                                                                        00370021
       SOURCE-COMPUTER.        IBM-3090.                                00380021
       OBJECT-COMPUTER.        IBM-3090.                                00390021
                                                                        00400021
       INPUT-OUTPUT SECTION.                                            00410021
                                                                        00420021
       FILE-CONTROL.                                                    00430021
                                                                        00440021
           SELECT PROCESS-DATES-FILE                                    00450021
               ASSIGN TO INP01.                                         00460021
                                                                        00470021
           SELECT RTV-XFER-FILE                                         00480021
               ASSIGN TO OUT01.                                         00490021
                                                                        00500021
      ******************************************************************00510021
       DATA DIVISION.                                                   00520021
      ******************************************************************00530021
                                                                        00540021
       FILE SECTION.                                                    00550021
                                                                        00560021
       FD  RTV-XFER-FILE                                                00570021
           RECORDING MODE IS F                                          00580021
           LABEL RECORDS ARE STANDARD                                   00590021
           BLOCK CONTAINS 0 RECORDS.                                    00600021
                                                                        00610021
       01  RTV-XFER-RECORD                     PIC  X(60).              00620021
                                                                        00630021
       FD  PROCESS-DATES-FILE                                           00640021
           RECORDING MODE IS F                                          00650021
           LABEL RECORDS ARE STANDARD                                   00660021
           BLOCK CONTAINS 0 RECORDS.                                    00670021
                                                                        00680021
       01  PROCESS-DATES-RECORD                PIC  X(16).              00690021
                                                                        00700021
      ******************************************************************00710021
       WORKING-STORAGE SECTION.                                         00720021
      ******************************************************************00730021
                                                                        00740021
      *                                                                 00750021
      *  RECORD LAYOUT FOR THE PROCESS DATES FILE                       00760021
      *                                                                 00770021
           COPY TFRD029.                                                00780021
                                                                        00790021
      *                                                                 00800021
      *  RECORD LAYOUT FOR THE TRANSFER DISCREPANCY FILE                00810021
      *                                                                 00820021
           COPY TFRD043.                                                00830021
                                                                        00840021
      *                                                                 00850021
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER STATUS    00860021
      *  TABLE                                                          00870021
      *                                                                 00880021
           EXEC SQL                                                     00890021
               INCLUDE TTFSTAT                                          00900021
           END-EXEC.                                                    00910021
                                                                        00920021
      *                                                                 00930021
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER MASTER    00940021
      *  TABLE                                                          00950021
      *                                                                 00960021
           EXEC SQL                                                     00970021
               INCLUDE TTFMSTR                                          00980021
           END-EXEC.                                                    00990021
                                                                        01000021
      *                                                                 01010021
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER RECEIPT   01020021
      *  TABLE                                                          01030021
      *                                                                 01040021
           EXEC SQL                                                     01050021
               INCLUDE TTFRCPT                                          01060021
           END-EXEC.                                                    01070021
                                                                        01080021
      *                                                                 01090021
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER ITEM TABLE01100021
      *                                                                 01110021
           EXEC SQL                                                     01120021
               INCLUDE TTFITEM                                          01130021
           END-EXEC.                                                    01140021
                                                                        01150021
      *                                                                 01160021
      *  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE TRANSFER ITEM      01170021
      *  RECEIPT TABLE                                                  01180021
      *                                                                 01190021
           EXEC SQL                                                     01200021
               INCLUDE TTFITRC                                          01210021
           END-EXEC.                                                    01220021
                                                                        01230021
      *---------------------------------------------------------------* 01240021
100404*    DB2 AREA FOR XST_LOC TABLE                                 * 01250021
      *---------------------------------------------------------------* 01260021
           EXEC SQL                                                     01270021
100404          INCLUDE XST00001                                        01280021
           END-EXEC.                                                    01290021
      *---------------------------------------------------------------* 01300021
100404*    DB2 AREA FOR XST_LOC_DIST TABLE                            * 01310021
      *---------------------------------------------------------------* 01320021
           EXEC SQL                                                     01330021
100404          INCLUDE XST00002                                        01340021
           END-EXEC.                                                    01350021
                                                                        01360021
      *                                                                 01370021
      *  COMMUNICATIONS AREA FOR DB2                                    01380021
      *                                                                 01390021
           EXEC SQL                                                     01400021
               INCLUDE SQLCA                                            01410021
           END-EXEC.                                                    01420021
                                                                        01430021
      *                                                                 01440021
      *  DB2 FORMATTED ERROR MESSAGE                                    01450021
      *                                                                 01460021
           COPY DPWS004.                                                01470021
                                                                        01480021
       01  ABEND-CODE                          PIC S9(04)  VALUE +0     01490021
                                                           COMP SYNC.   01500021
                                                                        01510021
       01  PHV-PROGRAM-HOLD-VARIABLES.                                  01520021
           05  PVH-RCV-STR-NBR                 PIC  9(04)  VALUE ZEROS. 01530021
010209     05  PVH-DISTRICT                    PIC  X(04)  VALUE SPACE. 01540021
           05  PVH-DISTRICT-N REDEFINES PVH-DISTRICT                    01550021
010209                                         PIC  9(04).              01560021
           05  PVH-FRM-STR-NBR                 PIC  9(04)  VALUE ZEROS. 01570021
           05  PVH-XFER-DKEY-ID                PIC  9(09)  VALUE ZEROS. 01580021
                                                                        01590021
       01  PC-PROGRAM-CONSTANTS.                                        01600021
           05  PC-POSITIVE-RCPT                PIC  X(02)  VALUE 'PR'.  01610021
           05  PC-RTV                          PIC  X(02)  VALUE 'RV'.  01620021
                                                                        01630021
       01  PS-PROGRAM-SWITCHES.                                         01640021
           05  PS-END-OF-TRANSFERS-IND         PIC  X(01)  VALUE 'N'.   01650021
               88  PS-MORE-TRANSFERS                       VALUE 'N'.   01660021
               88  PS-END-OF-TRANSFERS                     VALUE 'Y'.   01670021
           05  PS-XFER-DISCREP-IND             PIC  X(01)  VALUE 'N'.   01680021
               88  PS-NO-XFER-DISCREP                      VALUE 'N'.   01690021
               88  PS-XFER-DISCREP                         VALUE 'Y'.   01700021
                                                                        01710021
       01  PV-PROGRAM-VARIABLES.                                        01720021
           05  PV-PARAGRAPH-NAME               PIC  X(30)  VALUE SPACE. 01730021
           05  PV-DB2-OPERATION-ATTEMPTED      PIC  X(30)  VALUE SPACE. 01740021
           05  PV-BEG-TIMESTAMP.                                        01750021
               10  PV-BEG-CC                   PIC  X(02)  VALUE SPACE. 01760021
               10  PV-BEG-YY                   PIC  X(02)  VALUE SPACE. 01770021
               10  FILLER                      PIC  X(01)  VALUE '-'.   01780021
               10  PV-BEG-MM                   PIC  X(02)  VALUE SPACE. 01790021
               10  FILLER                      PIC  X(01)  VALUE '-'.   01800021
               10  PV-BEG-DD                   PIC  X(02)  VALUE SPACE. 01810021
               10                      PIC X(16) VALUE                  01820021
                                       '-00.00.00.000000'.              01830021
           05  PV-BEG-TMST REDEFINES                                    01840021
                 PV-BEG-TIMESTAMP      PIC X(26).                       01850021
           05  PV-END-TIMESTAMP.                                        01860021
               10  PV-END-CC                   PIC  X(02)  VALUE SPACE. 01870021
               10  PV-END-YY                   PIC  X(02)  VALUE SPACE. 01880021
               10  FILLER                      PIC  X(01)  VALUE '-'.   01890021
               10  PV-END-MM                   PIC  X(02)  VALUE SPACE. 01900021
               10  FILLER                      PIC  X(01)  VALUE '-'.   01910021
               10  PV-END-DD                   PIC  X(02)  VALUE SPACE. 01920021
               10                      PIC X(16) VALUE                  01930021
                                       '-23.59.59.999999'.              01940021
           05  PV-END-TMST REDEFINES                                    01950021
                 PV-END-TIMESTAMP      PIC X(26).                       01960021
C98011     05  PV-SUM-XFER-PRICE       PIC S9(08)V99 COMP-3 VALUE ZERO. 01970021
C98011     05  PV-SUM-RCVD-PRICE       PIC S9(08)V99 COMP-3 VALUE ZERO. 01980021
           05  PV-ABSOLUTE-QTY         PIC  9(04)           VALUE ZERO. 01990021
           05  PV-ABSOLUTE-PRICE       PIC  9(07)V99        VALUE ZERO. 02000021
           05  PV-UNITS-RCVD           PIC S9(06)           VALUE ZERO. 02010021
           05  PV-UNITS-VARIANCE       PIC S9(06)           VALUE ZERO. 02020021
           05  PV-DOLLARS-RCVD         PIC S9(07)V99 COMP-3 VALUE ZERO. 02030021
           05  PV-DOLLARS-XFER         PIC S9(07)V99 COMP-3 VALUE ZERO. 02040021
           05  PV-TOTAL-TRANSFERS      PIC S9(05)           VALUE ZERO. 02050021
           05  PV-TRANSFERS-WITH-DISCREP                                02060021
                                       PIC S9(05)           VALUE ZERO. 02070021
      *                                                                 02080021
      * CURSOR TO RETRIEVE ALL TRANSFERS RECEIVED AT AN RTV LOCATION    02090021
      * DURING THE SPECIFIED TIME PERIOD                                02100021
      *                                                                 02110021
           EXEC SQL                                                     02120021
              DECLARE  RTV_XFER_CSR CURSOR FOR                          02130021
100404        SELECT   DT2.DIST_NBR                                     02140021
                      ,R.STR_NBR                                        02150021
                      ,M.FR_STR_NBR                                     02160021
                      ,M.XFER_DKEY_ID                                   02170021
                      ,I.XFER_LNE_NBR                                   02180021
                      ,I.XFER_QTY                                       02190021
                      ,I.XFER_QTY * I.XFER_PRIC_AMT                     02200021
                      ,SUM(IR.RCVD_XFER_QTY)                            02210021
                      ,SUM(IR.RCVD_XFER_QTY * IR.RCVD_XFER_PRIC_AMT)    02220021
              FROM                                                      02230021
                       TTFITEM       I                                  02240021
                     , TTFMSTR       M                                  02250021
                     , TTFITRC       IR                                 02260021
                     , TTFRCPT       R                                  02270021
                     , TTFSTAT       S                                  02280021
100404               , XST_LOC       LT1                                02290021
100404               , XST_LOC_DIST  DT2                                02300021
              WHERE                                                     02310021
                S.XFER_STAT_CDE   = :PC-POSITIVE-RCPT       AND         02320021
                S.XFER_STAT_TMST     BETWEEN                            02330021
                                    :PV-BEG-TMST AND                    02340021
                                    :PV-END-TMST            AND         02350021
                R.RCV_XFER_BEG_TMST  = S.XFER_STAT_TMST     AND         02360021
                R.RCV_XFER_BEG_TMST  = IR.XFER_RCPT_TMST    AND         02370021
                I.XFER_DKEY_ID       = M.XFER_DKEY_ID       AND         02380021
                I.XFER_DKEY_ID       = R.XFER_DKEY_ID       AND         02390021
                I.XFER_DKEY_ID       = S.XFER_DKEY_ID       AND         02400021
                I.XFER_DKEY_ID       = IR.XFER_DKEY_ID      AND         02410021
                I.XFER_LNE_NBR       = IR.XFER_LNE_NBR      AND         02420021
100404          M.FR_STR_NBR         = DT2.LOC_NBR          AND         02430021
100404          DT2.END_DTE         IS NULL                 AND         02440021
100404          R.STR_NBR            = LT1.LOC_NBR          AND         02450021
100404          LT1.LOC_TYP_CDE      = :PC-RTV                          02460021
              GROUP BY                                                  02470021
100404                 DT2.DIST_NBR                                     02480021
                      ,R.STR_NBR                                        02490021
                      ,M.FR_STR_NBR                                     02500021
                      ,M.XFER_DKEY_ID                                   02510021
                      ,I.XFER_LNE_NBR                                   02520021
                      ,I.XFER_QTY                                       02530021
                      ,I.XFER_PRIC_AMT                                  02540021
              ORDER BY                                                  02550021
                       R.STR_NBR                                        02560021
100404                ,DT2.DIST_NBR                                     02570021
                      ,M.FR_STR_NBR                                     02580021
                      ,M.XFER_DKEY_ID                                   02590021
              WITH UR                                                   02600021
           END-EXEC.                                                    02610021
                                                                        02620021
      ******************************************************************02630021
       PROCEDURE DIVISION.                                              02640021
      ******************************************************************02650021
                                                                        02660021
      ******************************************************************02670021
      *  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM    02680021
      ******************************************************************02690021
       0000-PROGRAM-MAINLINE.                                           02700021
           PERFORM 1000-INITIALIZE.                                     02710021
                                                                        02720021
           PERFORM 2000-CREATE-RTV-XFER-FILE.                           02730021
                                                                        02740021
           PERFORM 9000-EOJ-ROUTINE.                                    02750021
                                                                        02760021
           STOP RUN.                                                    02770021
      *                                                                 02780021
       1000-INITIALIZE.                                                 02790021
           OPEN  INPUT PROCESS-DATES-FILE                               02800021
                OUTPUT RTV-XFER-FILE.                                   02810021
                                                                        02820021
           PERFORM 7000-READ-PROCESS-DATES-FILE.                        02830021
                                                                        02840021
           DISPLAY 'TF029-PROCESS-DATES-RECORD = '                      02850021
               TF029-PROCESS-DATES-RECORD.                              02860021
           MOVE TF029-PROCESS-START-MONTH    TO PV-BEG-MM.              02870021
           MOVE TF029-PROCESS-START-DAY      TO PV-BEG-DD.              02880021
           MOVE TF029-PROCESS-START-YEAR     TO PV-BEG-YY.              02890021
           MOVE TF029-PROCESS-START-CENTURY  TO PV-BEG-CC.              02900021
           MOVE TF029-PROCESS-END-MONTH      TO PV-END-MM.              02910021
           MOVE TF029-PROCESS-END-DAY        TO PV-END-DD.              02920021
           MOVE TF029-PROCESS-END-YEAR       TO PV-END-YY.              02930021
           MOVE TF029-PROCESS-END-CENTURY    TO PV-END-CC.              02940021
      *                                                                 02950021
      ******************************************************************02960021
      * 2000-CREATE-RTV-XFER-FILE.                                      02970021
      ******************************************************************02980021
       2000-CREATE-RTV-XFER-FILE.                                       02990021
           PERFORM 3000-OPEN-RTV-XFER-CSR.                              03000021
           PERFORM 3100-FETCH-RTV-XFER-CSR.                             03010021
                                                                        03020021
           IF PS-MORE-TRANSFERS                                         03030021
               MOVE TFRCPT-STR-NBR          TO PVH-RCV-STR-NBR          03040021
100404         MOVE XST00002-DIST-NBR       TO PVH-DISTRICT-N           03050021
               MOVE TFMSTR-FR-STR-NBR       TO PVH-FRM-STR-NBR          03060021
               MOVE TFMSTR-XFER-DKEY-ID     TO PVH-XFER-DKEY-ID         03070021
               PERFORM 4000-PROCESS-TRANSFERS                           03080021
                   UNTIL PS-END-OF-TRANSFERS                            03090021
               PERFORM 5000-FORMAT-OUTPUT                               03100021
           END-IF.                                                      03110021
                                                                        03120021
           PERFORM 3200-CLOSE-RTV-XFER-CSR.                             03130021
      *                                                                 03140021
       3000-OPEN-RTV-XFER-CSR.                                          03150021
           EXEC SQL                                                     03160021
               OPEN RTV_XFER_CSR                                        03170021
           END-EXEC.                                                    03180021
                                                                        03190021
           EVALUATE TRUE                                                03200021
               WHEN SQLCODE = ZERO                                      03210021
                   CONTINUE                                             03220021
               WHEN OTHER                                               03230021
                   MOVE '3000-OPEN-RTV-XFER-CSR'                        03240021
                       TO PV-PARAGRAPH-NAME                             03250021
                   MOVE 'OPEN THE RTV_XFER_CSR'                         03260021
                       TO PV-DB2-OPERATION-ATTEMPTED                    03270021
                   PERFORM 9100-SQL-ABEND                               03280021
           END-EVALUATE.                                                03290021
      *                                                                 03300021
       3100-FETCH-RTV-XFER-CSR.                                         03310021
           INITIALIZE DCLTTFMSTR                                        03320021
                      DCLTTFSTAT                                        03330021
                      DCLTTFRCPT                                        03340021
                      DCLTTFITEM                                        03350021
                      DCLTTFITEM                                        03360021
100404                DCLXST00001                                       03370021
100404                DCLXST00002.                                      03380021
                                                                        03390021
           EXEC SQL                                                     03400021
               FETCH  RTV_XFER_CSR                                      03410021
100404          INTO  :XST00002-DIST-NBR                                03420021
                     ,:TFRCPT-STR-NBR                                   03430021
                     ,:TFMSTR-FR-STR-NBR                                03440021
                     ,:TFMSTR-XFER-DKEY-ID                              03450021
                     ,:TFITEM-XFER-LNE-NBR                              03460021
                     ,:TFITEM-XFER-QTY                                  03470021
                     ,:PV-SUM-XFER-PRICE                                03480021
                     ,:TFITRC-RCVD-XFER-QTY                             03490021
                     ,:PV-SUM-RCVD-PRICE                                03500021
           END-EXEC.                                                    03510021
                                                                        03520021
           EVALUATE TRUE                                                03530021
               WHEN SQLCODE = ZERO                                      03540021
                   CONTINUE                                             03550021
               WHEN SQLCODE = +100                                      03560021
                   SET PS-END-OF-TRANSFERS      TO  TRUE                03570021
               WHEN OTHER                                               03580021
                   MOVE '3100-FETCH-RTV-XFER-CSR'                       03590021
                       TO PV-PARAGRAPH-NAME                             03600021
                   MOVE 'FETCH THE RTV_XFER_CSR'                        03610021
                       TO PV-DB2-OPERATION-ATTEMPTED                    03620021
                   PERFORM 9100-SQL-ABEND                               03630021
           END-EVALUATE.                                                03640021
      *                                                                 03650021
       3200-CLOSE-RTV-XFER-CSR.                                         03660021
           EXEC SQL                                                     03670021
               CLOSE RTV_XFER_CSR                                       03680021
           END-EXEC.                                                    03690021
                                                                        03700021
           EVALUATE TRUE                                                03710021
               WHEN SQLCODE = ZERO                                      03720021
                   CONTINUE                                             03730021
               WHEN OTHER                                               03740021
                   MOVE '3200-CLOSE-RTV-XFER-CSR'                       03750021
                       TO PV-PARAGRAPH-NAME                             03760021
                   MOVE 'CLOSE THE RTV_XFER_CSR'                        03770021
                       TO PV-DB2-OPERATION-ATTEMPTED                    03780021
                   PERFORM 9100-SQL-ABEND                               03790021
           END-EVALUATE.                                                03800021
      *                                                                 03810021
       4000-PROCESS-TRANSFERS.                                          03820021
           IF TFRCPT-STR-NBR         NOT = PVH-RCV-STR-NBR      OR      03830021
100404        XST00002-DIST-NBR      NOT = PVH-DISTRICT-N       OR      03840021
              TFMSTR-FR-STR-NBR      NOT = PVH-FRM-STR-NBR              03850021
               PERFORM 5000-FORMAT-OUTPUT                               03860021
           END-IF.                                                      03870021
           IF TFMSTR-XFER-DKEY-ID    NOT = PVH-XFER-DKEY-ID             03880021
               PERFORM 5100-NEW-TRANSFER                                03890021
           END-IF.                                                      03900021
           ADD TFITRC-RCVD-XFER-QTY  TO  PV-UNITS-RCVD.                 03910021
           ADD PV-SUM-RCVD-PRICE     TO  PV-DOLLARS-RCVD.               03920021
           ADD PV-SUM-XFER-PRICE     TO  PV-DOLLARS-XFER.               03930021
           IF TFITEM-XFER-QTY NOT = TFITRC-RCVD-XFER-QTY                03940021
               COMPUTE PV-ABSOLUTE-QTY =                                03950021
                  TFITEM-XFER-QTY - TFITRC-RCVD-XFER-QTY                03960021
               ADD PV-ABSOLUTE-QTY   TO  PV-UNITS-VARIANCE              03970021
               SET PS-XFER-DISCREP   TO TRUE                            03980021
           END-IF.                                                      03990021
           IF PV-SUM-XFER-PRICE NOT = PV-SUM-RCVD-PRICE                 04000021
               SET PS-XFER-DISCREP   TO TRUE                            04010021
           END-IF.                                                      04020021
                                                                        04030021
           PERFORM 3100-FETCH-RTV-XFER-CSR.                             04040021
      *                                                                 04050021
       5000-FORMAT-OUTPUT.                                              04060021
           PERFORM 5100-NEW-TRANSFER.                                   04070021
           INITIALIZE TF043-RTV-TRANSFER-RECORD.                        04080021
                                                                        04090021
           MOVE PVH-RCV-STR-NBR            TO  TF043-RCV-STR-NBR.       04100021
           MOVE PVH-DISTRICT               TO  TF043-DISTRICT-NBR.      04110021
           MOVE PVH-FRM-STR-NBR            TO  TF043-FR-STR-NBR.        04120021
           MOVE PV-TOTAL-TRANSFERS         TO  TF043-XFERS-RCVD.        04130021
           MOVE PV-TRANSFERS-WITH-DISCREP  TO  TF043-XFERS-WITH-DISCREP.04140021
           MOVE PV-UNITS-RCVD              TO  TF043-UNITS-RCVD.        04150021
           MOVE PV-UNITS-VARIANCE          TO  TF043-UNITS-VARIANCE.    04160021
           MOVE PV-DOLLARS-RCVD            TO  TF043-DOLLARS-RCVD.      04170021
           MOVE PV-DOLLARS-XFER            TO  TF043-DOLLARS-XFER.      04180021
                                                                        04190021
           PERFORM 8000-WRITE-XFER-DSCRP-FILE.                          04200021
                                                                        04210021
           MOVE ZEROS                      TO  PV-TOTAL-TRANSFERS       04220021
                                               PV-TRANSFERS-WITH-DISCREP04230021
                                               PV-UNITS-RCVD            04240021
                                               PV-UNITS-VARIANCE        04250021
                                               PV-DOLLARS-RCVD          04260021
                                               PV-DOLLARS-XFER.         04270021
           MOVE TFRCPT-STR-NBR             TO PVH-RCV-STR-NBR.          04280021
100404     MOVE XST00002-DIST-NBR          TO PVH-DISTRICT-N            04290021
           MOVE TFMSTR-FR-STR-NBR          TO PVH-FRM-STR-NBR.          04300021
      *                                                                 04310021
       5100-NEW-TRANSFER.                                               04320021
           ADD 1                           TO  PV-TOTAL-TRANSFERS.      04330021
           IF PS-XFER-DISCREP                                           04340021
               ADD 1                       TO  PV-TRANSFERS-WITH-DISCREP04350021
           END-IF.                                                      04360021
           SET PS-NO-XFER-DISCREP          TO TRUE.                     04370021
           MOVE TFMSTR-XFER-DKEY-ID        TO PVH-XFER-DKEY-ID.         04380021
      *                                                                 04390021
       7000-READ-PROCESS-DATES-FILE.                                    04400021
           READ PROCESS-DATES-FILE                                      04410021
               INTO TF029-PROCESS-DATES-RECORD                          04420021
           END-READ.                                                    04430021
      *                                                                 04440021
       8000-WRITE-XFER-DSCRP-FILE.                                      04450021
           WRITE RTV-XFER-RECORD                                        04460021
               FROM TF043-RTV-TRANSFER-RECORD                           04470021
           END-WRITE.                                                   04480021
      *                                                                 04490021
       9000-EOJ-ROUTINE.                                                04500021
           CLOSE RTV-XFER-FILE                                          04510021
                 PROCESS-DATES-FILE.                                    04520021
      *                                                                 04530021
      ******************************************************************04540021
      *  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    04550021
      *  ERROR OR WARNING CODE OCCURS.                                  04560021
      ******************************************************************04570021
       9100-SQL-ABEND.                                                  04580021
           DISPLAY '** ABEND     **'.                                   04590021
           DISPLAY '** PROGRAM   ** = TFKUT503'.                        04600021
           DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              04610021
           DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     04620021
                                                                        04630021
      ******************************************************************04640021
      * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    04650021
      * MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         04660021
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     04670021
      * FORMAT.                                                         04680021
      ******************************************************************04690021
           COPY DPPD004.                                                04700021
                                                                        04710021
           MOVE +4013  TO  ABEND-CODE.                                  04720021
           CALL 'ILBOABN0' USING ABEND-CODE.                            04730021
