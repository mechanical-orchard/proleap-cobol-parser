000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    PCKCS747.                                         00040000
000500 AUTHOR.        DEANNA BRANTNER.                                  00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  OCTOBER, 2001.                                    00070000
000800 DATE-COMPILED.                                                   00080000
000900*---------------------------------------------------------------* 00090000
001000*    E747 - IN-TRANSIT - SKU STORE DETAIL LIST SCREEN             00100000
001100* 12/21/2015  NEHA BAGRODIA ADD THE F24 KEY IN FSKCS032 PROGRAM   00110056
001200*                           TO GO TO PROGRAM PCKCS747-IN-TRANSIT  00120057
001300*                           SKU STORE DETAIL LIST SCREEN          00130057
001400*---------------------------------------------------------------* 00140000
001410* DATE  11/04/2021                                                00141099
001420*            - CHANGE CALL OF 'DPKUT100' TO                     * 00142099
001430*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00143099
001440*              MAKING THE CALL DYNAMIC VS STATIC                * 00144099
001450*     MADE BY: GERMAN BANDA            WR/IR #: CHG0264232        00145099
001460*-----------------------------------------------------------------00146099
1122RM* DATE  11/07/2022                                              * 00147099
1122RM*            - ADD COPYBOOK DPWS930                             * 00148099
1122RM*              CHANGE CALL TO DPWS030 FROM STATIC TO            * 00149099
1122RM*              DYNAMIC.                                         * 00149199
1122RM*     MADE BY: BOB MCASEY              WR/IR #: CHG0277910      * 00149299
1122RM*-----------------------------------------------------------------00149399
001500 ENVIRONMENT DIVISION.                                            00150000
001600 DATA DIVISION.                                                   00160000
001700                                                                  00170000
001800 WORKING-STORAGE SECTION.                                         00180000
001900 01  DK-DB2-KEYS.                                                 00190000
002000     05  DK-SKU                         PIC S9(08)V VALUE ZERO    00200000
002100                                                    COMP-3.       00210000
002200     05  DK-UPC-ID                      PIC S9(09)  VALUE ZERO    00220000
002300                                                    COMP.         00230000
002400     05  DK-PO                          PIC S9(09)  VALUE ZERO    00240000
002500                                                    COMP.         00250000
002600     05  DK-RCVR                        PIC S9(09)  VALUE ZERO    00260000
002700                                                    COMP.         00270000
002800     05  DK-STR-NBR                     PIC S9(04)  VALUE ZERO    00280000
002900                                                    COMP.         00290000
003000     05  DK-STORE-NUMBER                PIC S9(04)  VALUE ZERO    00300099
003100                                                    COMP.         00310073
003200     05  DK-PO-TRN-NBR                  PIC 9(09) VALUE ZEROES.   00320000
003300     05  DK-TRN-NBR-N REDEFINES DK-PO-TRN-NBR.                    00330000
003400         10  DK-TRN-NBR-X               PIC X(09).                00340000
003500     05  DK-TRN-NBR-9.                                            00350000
003600         10  FILLER                       PIC X(01) VALUE SPACES. 00360000
003700         10  DK-TRN-NBR-8                 PIC X(08) VALUE SPACES. 00370000
003800                                                                  00380000
003900     05  DK-PO-RCVR-NBR-N                 PIC 9(09) VALUE ZEROES. 00390000
004000     05  DK-PO-RCVR-NBR-X REDEFINES DK-PO-RCVR-NBR-N.             00400000
004100         10  DK-RCVR-NBR-X                PIC X(09).              00410000
004200     05  DK-RCVR-NBR-9.                                           00420000
004300         10  FILLER                       PIC X(06) VALUE SPACES. 00430000
004400         10  DK-RCVR-NBR-3                PIC X(03) VALUE SPACES. 00440000
004500                                                                  00450000
004600     05  DK-PO-RCVR.                                              00460000
004700         10  DK-TRN-NBR                   PIC X(09) VALUE SPACES. 00470099
004800         10  FILLER                       PIC X(01) VALUE '-'.    00480000
004900         10  DK-RCVR-NBR                  PIC X(03) VALUE SPACES. 00490000
005000                                                                  00500094
005100     05  PV-DISPLAY-CS-PULL.                                      00510000
005200         10  PV-CS-PULL-NBR               PIC X(08) VALUE SPACES. 00520000
005300         10  FILLER                       PIC X(04) VALUE SPACES. 00530000
005400                                                                  00540000
005500 01  PC-PROGRAM-CONSTANTS.                                        00550000
005600     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE 'PC747A  '.  00560000
005700     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE 'PCKM747'.   00570000
005800     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'PCKCS747'.  00580000
005900     05  PC-XL001-VSM-PGM          PIC  X(08)  VALUE 'XLKUT001'.  00590000
006000     05  PC-XMKCS001               PIC  X(08)  VALUE 'XMKCS001'.  00600000
006100     05  PC-LIST-QUEUE-SEQ         PIC  9(01)  VALUE 1.           00610000
006200     05  PC-SEL-QUEUE-SEQ          PIC  9(01)  VALUE 2.           00620000
006300     05  PC-CRIT-SPEC-FORMAT       PIC  X(01)  VALUE '1'.         00630000
006400     05  PC-LIST-FORMAT            PIC  X(01)  VALUE '2'.         00640000
006500     05  PC-PORCVR-FORMAT          PIC  X(01)  VALUE '3'.         00650000
006600     05  PC-FASHION-FORMAT         PIC  X(01)  VALUE '4'.         00660007
006700     05  PC-ITEMS-PER-PANEL        PIC S9(04)  VALUE +10          00670000
006800                                               COMP SYNC.         00680000
006900     05  PC-MAX-BLOCKS-IN-ARRAY    PIC S9(04)  VALUE +2           00690000
007000                                               COMP SYNC.         00700000
007100     05  PC-MAX-ITEMS              PIC S9(09)  VALUE +1000000     00710000
007200                                               COMP-3.            00720000
007300     05  PC-MSG-NUMBER-LENGTH      PIC S9(04)  VALUE +5           00730000
007400                                               COMP SYNC.         00740000
007500     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00750000
007600                                               COMP-3.            00760000
007700     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00770000
007800     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00780000
007900     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00790000
008000     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00800000
008100     05  PC-DASH                   PIC  X(01)  VALUE '-'.         00810099
008200     05  PC-SLASH                  PIC  X(01)  VALUE '/'.         00820095
008300     05  PC-ZERO                   PIC S9(04)  VALUE ZEROES       00830000
008400                                               COMP.              00840000
008500     05  PC-01                     PIC  X(02)  VALUE '01'.        00850000
008600     05  PC-A                      PIC  X(01)  VALUE 'A'.         00860000
008700     05  PC-UN                     PIC  X(02)  VALUE 'UN'.        00870000
008800     05  PC-SH                     PIC  X(02)  VALUE 'SH'.        00880000
008900     05  PC-RA                     PIC  X(02)  VALUE 'RA'.        00890000
009000     05  PC-AR                     PIC  X(02)  VALUE 'AR'.        00900000
009100     05  PC-VA                     PIC  X(02)  VALUE 'VA'.        00910000
009200     05  PC-OA                     PIC  X(02)  VALUE 'OA'.        00920000
009300     05  PC-ST                     PIC  X(02)  VALUE 'ST'.        00930000
009400     05  PC-IA                     PIC  X(02)  VALUE 'IA'.        00940000
009500     05  PC-CS                     PIC  X(02)  VALUE 'CS'.        00950000
009600     05  PC-CL                     PIC  X(02)  VALUE 'CL'.        00960000
009700     05  PC-SA                     PIC  X(02)  VALUE 'SA'.        00970000
009800     05  PC-UM                     PIC  X(02)  VALUE 'UM'.        00980002
009900     05  PC-AU                     PIC  X(02)  VALUE 'AU'.        00990045
010000     05  PC-NS                     PIC  X(02)  VALUE 'NS'.        01000045
010100     05  PC-MM                     PIC  X(02)  VALUE 'MM'.        01010045
010200     05  PC-MU                     PIC  X(02)  VALUE 'MU'.        01020045
010300     05  PC-AM                     PIC  X(02)  VALUE 'AM'.        01030045
010400     05  PC-SM                     PIC  X(02)  VALUE 'SM'.        01040045
010500     05  PC-UNLOAD                 PIC  X(10)  VALUE 'UNLOAD STR'.01050000
010600     05  PC-SHIPPD                 PIC  X(10)  VALUE 'SHIPPED DC'.01060000
010700     05  PC-RECEIPT                PIC  X(10)  VALUE 'RECEPT ADJ'.01070000
010800     05  PC-ACTUAL                 PIC  X(10)  VALUE 'VE RECEIPT'.01080000
010900     05  PC-VERIFD                 PIC  X(10)  VALUE 'VERIFD ADJ'.01090000
011000     05  PC-ONHAND                 PIC  X(10)  VALUE 'ONHAND ADJ'.01100000
011100     05  PC-SKUTRN                 PIC  X(10)  VALUE 'SKUTRN ADJ'.01110000
011200     05  PC-INTRNS                 PIC  X(10)  VALUE 'INTRNS ADJ'.01120000
011300     05  PC-CNTLSTK                PIC  X(10)  VALUE 'CENTRL STK'.01130000
011400     05  PC-CLEANUP                PIC  X(10)  VALUE 'CLEAN UP  '.01140000
011500     05  PC-STREXP                 PIC  X(10)  VALUE 'STREXP ADJ'.01150000
011600     05  PC-UNMEMO                 PIC  X(10)  VALUE 'UNLD-MEMO'. 01160006
011700     05  PC-ASMUNLD                PIC  X(10)  VALUE 'ASMP UNLD'. 01170045
011800     05  PC-NOTSCAN                PIC  X(10)  VALUE 'NOT SCAND'. 01180045
011900     05  PC-ASMPTMEMO              PIC  X(10)  VALUE 'ASMPT-MEMO'.01190045
012000     05  PC-UNLMEM                 PIC  X(10)  VALUE 'UNLMEM'.    01200045
012100     05  PC-MULT                   PIC  X(04)  VALUE 'MULT'.      01210039
012200     05  PC-MEMO                   PIC  X(08)  VALUE ' MEMO   '.  01220052
012300*                                                                 01230001
012400*                                                                 01240000
012500*----------------------------------------------------------------*01250000
012600*  SYSTEM MESSAGES                                               *01260000
012700*----------------------------------------------------------------*01270000
012800*   00005 = INVALID VALUE                                        *01280000
012900*   00008 = MUST BE NUMERIC                                      *01290000
013000*   00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED  *01300000
013100*   00051 - NO END OF RANGE HAS BEEN SPECIFIED                   *01310000
013200*   00052 - END OF RANGE PRECEDES START OF RANGE                 *01320000
013300*   00053 - NO START OF RANGE HAS BEEN SPECIFIED                 *01330000
013400*   00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED   *01340000
013500*   00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED     *01350000
013600*   00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       *01360000
013700*   00069 - TOP OF LIST                                          *01370000
013800*   00070 - BOTTOM OF LIST                                       *01380000
013900*   00101 - VALUE MUST BE > ZERO AND  < 1,000,000                *01390000
014000*   00551 - WAIT 15 SECONDS;RETRY FUNCTION AGAIN; IF UNSUCCESSFUL*01400000
014100*   00279 - MORE ITEMS TO DISPLAY                                *01410000
014200*   00840 - YOU ARE NOT AUTHORIZED TO VIEW THIS INFORMATION      *01420000
014300*   00984 - DATABASE IS BUSY, TRY AGAIN IN A FEW MINUTES         *01430000
014400*   02227 = APPLICATION UNAVAILABLE AT THIS TIME                 *01440000
014500*   99901 = INVALID COMMAND WAS ENTERED                          *01450000
014600*----------------------------------------------------------------*01460000
014700     05  PC-TSYMSG-NUMBERS.                                       01470000
014800         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01480000
014900         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  01490000
015000         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01500000
015100         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01510000
015200         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01520000
015300         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01530000
015400         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01540000
015500         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01550000
015600         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01560000
015700         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01570000
015800         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01580000
015900         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01590000
016000         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01600000
016100         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  01610000
016200         10  PC-TSYMSG-00746            PIC  9(05)  VALUE 00746.  01620000
016300         10  PC-TSYMSG-00840            PIC  9(05)  VALUE 00840.  01630000
016400         10  PC-TSYMSG-01563            PIC  9(05)  VALUE 01563.  01640000
016500         10  PC-TSYMSG-00984            PIC  9(05)  VALUE 00984.  01650000
016600         10  PC-TSYMSG-02227            PIC  9(05)  VALUE 02227.  01660000
016700         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  01670000
016800*                                                                 01680000
016900 01  PS-PROGRAM-SWITCHES.                                         01690000
017000     05  PS-BLOCK-ERROR-SW              PIC  X(01)  VALUE 'Y'.    01700000
017100         88  PS-NO-BLOCK-ERROR                      VALUE 'Y'.    01710000
017200         88  PS-BLOCK-ERROR                         VALUE 'N'.    01720000
017300     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01730000
017400         88  PS-NO-ERROR                            VALUE 'Y'.    01740000
017500         88  PS-ERROR                               VALUE 'N'.    01750000
017600     05  PS-SOFT-ABORT-ERROR-SW         PIC  X(01)  VALUE  'N'.   01760000
017700         88  PS-SOFT-ABORT-ERROR                    VALUE  'Y'.   01770000
017800         88  PS-NO-SOFT-ABORT-ERROR                 VALUE  'N'.   01780000
017900     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01790000
018000         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01800000
018100         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01810000
018200     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01820000
018300         88  PS-DONE                                VALUE 'Y'.    01830000
018400         88  PS-NOT-DONE                            VALUE 'N'.    01840000
018500     05  PS-LIST-END-SW                 PIC  X(01)  VALUE  'N'.   01850000
018600         88  PS-LIST-END                            VALUE  'Y'.   01860000
018700         88  PS-NO-LIST-END                         VALUE  'N'.   01870000
018800     05  PS-ACCESS-SW                   PIC  X(01)  VALUE  'N'.   01880000
018900         88  PS-ACCESS-ALLOWED                      VALUE  'Y'.   01890000
019000         88  PS-ACCESS-NOT-ALLOWED                  VALUE  'N'.   01900000
019100*                                                                 01910000
019200 01  PV-PROGRAM-VARIABLES.                                        01920000
019300     05  PV-ORIGINAL-BLOCK               PIC S9(04)  VALUE +0     01930000
019400                                                     COMP SYNC.   01940000
019500     05  PV-ITEMS-HOLD                   PIC S9(03)  COMP-3.      01950000
019600     05  PV-ITEMS-DIFF                   PIC S9(03)  COMP-3.      01960000
019700     05  PV-RACF-ERROR-CODE             PIC  9(04)  VALUE ZEROES. 01970000
019800     05  PV-CICS-RESPONSE               PIC S9(08)  VALUE ZEROES  01980000
019900                                        COMP SYNC.                01990000
020000     05  PV-SUB                         PIC S9(04)  VALUE +0      02000000
020100                                                    COMP SYNC.    02010000
020200     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      02020000
020300                                                    COMP SYNC.    02030000
020400     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      02040000
020500                                                    COMP-3.       02050000
020600     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      02060000
020700                                                    COMP-3.       02070000
020800     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      02080000
020900                                                    COMP-3.       02090000
021000     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      02100000
021100                                                    COMP-3.       02110000
021200     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      02120000
021300                                                    COMP-3.       02130000
021400     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      02140000
021500                                                    COMP-3.       02150000
021600     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      02160000
021700                                                    COMP-3.       02170000
021800     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      02180000
021900                                                    COMP SYNC.    02190000
022000     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      02200000
022100                                                    COMP SYNC.    02210000
022200     05  PV-ITEM                        PIC S9(04)  VALUE +0      02220000
022300                                                    COMP SYNC.    02230000
022400     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      02240000
022500                                                    COMP SYNC.    02250000
022600     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      02260000
022700                                                    COMP SYNC.    02270000
022800     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      02280000
022900                                                    COMP SYNC.    02290000
023000     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      02300000
023100                                                    COMP SYNC.    02310000
023200     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      02320000
023300                                                    COMP SYNC.    02330000
023400     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02340000
023500                                                    COMP SYNC.    02350000
023600     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02360000
023700                                                    COMP SYNC.    02370000
023800     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      02380000
023900                                                    COMP SYNC.    02390000
024000     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      02400000
024100                                                    COMP SYNC.    02410000
024200     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      02420000
024300                                                    COMP SYNC.    02430000
024400     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      02440000
024500                                                    COMP SYNC.    02450000
024600     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      02460000
024700                                                    COMP SYNC.    02470000
024800     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02480000
024900                                                    COMP SYNC.    02490000
025000     05  PV-NULL-IND-1                  PIC S9(04)  VALUE +0      02500000
025100                                                    COMP.         02510000
025200     05  PV-NULL-IND-2                  PIC S9(04)  VALUE +0      02520000
025300                                                    COMP.         02530000
025400     05  PV-NULL-IND-3                  PIC S9(04)  VALUE +0      02540000
025500                                                    COMP.         02550000
025600     05  PV-SOFT-ABORT-MSG.                                       02560000
025700         10  FILLER            PIC X(12) VALUE ' PCKCS747 - '.    02570000
025800         10  FILLER            PIC X(09) VALUE 'SQLCODE: '.       02580000
025900         10  PV-SOFT-SQLCODE   PIC ZZZZZZZZ9-.                    02590000
026000         10  FILLER            PIC X(12) VALUE ' PARAGRAPH: '.    02600000
026100         10  PV-SOFT-PARAGRAPH PIC X(30).                         02610000
026200     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     02620000
026300                                                     COMP SYNC.   02630000
026400     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 02640000
026500     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACE. 02650000
026600     05  PV-CICS-MSG-HOLD.                                        02660000
026700         10  FILLER                      PIC  X(01)  VALUE SPACE. 02670000
026800         10  PV-CICS-MSG-DATA            PIC  X(79)  VALUE SPACE. 02680000
026900     05  PV-CICS-MSG-HOLD2.                                       02690000
027000         10  FILLER                      PIC  X(01)  VALUE SPACE. 02700000
027100         10  PV-CICS-MSG-DATA2           PIC  X(99)  VALUE SPACE. 02710000
027200                                                                  02720000
027300     05  PV-TMST                 PIC X(26)   VALUE SPACES.        02730000
027400     05  PV-TMST-R REDEFINES  PV-TMST.                            02740000
027500         10   PV-TMST-CCYY              PIC X(04).                02750000
027600         10   FILLER                    PIC X(01).                02760000
027700         10   PV-TMST-MM                PIC X(02).                02770000
027800         10   FILLER                    PIC X(01).                02780000
027900         10   PV-TMST-DD                PIC X(02).                02790000
028000         10   FILLER                    PIC X(01).                02800000
028100         10   PV-TMST-HRS               PIC X(02).                02810000
028200         10   FILLER                    PIC X(01).                02820000
028300         10   PV-TMST-MIN               PIC X(02).                02830000
028400         10   FILLER                    PIC X(01).                02840000
028500         10   PV-TMST-SEC               PIC X(02).                02850000
028600         10   FILLER                    PIC X(07).                02860000
028700     05  PV-DATE-DISPLAY.                                         02870000
028800         10   PV-DISPLAY-MM             PIC X(02)   VALUE SPACES. 02880000
028900         10   PV-SLASH-1                PIC X(01)   VALUE '/'.    02890000
029000         10   PV-DISPLAY-DD             PIC X(02)   VALUE SPACES. 02900000
029100         10   PV-SLASH-2                PIC X(01)   VALUE '/'.    02910000
029200         10   PV-DISPLAY-CCYY           PIC X(04)   VALUE SPACES. 02920000
029300     05  PV-SELECT-LIST-SEQ              PIC  X(01) VALUE SPACES. 02930000
029400     05  PV-NBR-ITEMS                    PIC  9(05) VALUE ZEROES. 02940000
029500     05  PV-SEL-TERM-ID                  PIC  X(04).              02950000
029600     05  PV-SEL-TASK-NUMBER              PIC  9(05).              02960000
029700     05  PV-SEL-SEQ                      PIC  9(01).              02970000
029800     05  PV-USER-ID                      PIC  X(08).              02980000
029900     05  PV-USER-ID-R REDEFINES PV-USER-ID.                       02990000
030000         10  PV-USER-1-2                 PIC  X(02).              03000000
030100             88  PV-TK-USER-ID           VALUE 'TK', 'TC', 'TV'.  03010000
030200         10  FILLER                      PIC  X(06).              03020000
030300     05  PV-TYPE-DESC                    PIC  X(10).              03030038
030400     05  PV-TYPE-DESC-R REDEFINES PV-TYPE-DESC.                   03040038
030500         10  PV-TYPE-DESCRIP             PIC  X(06).              03050038
030600         10  PV-MISLD-STR                PIC  X(04).              03060038
030700     05  PV-TTL-STORE-EXPECT             PIC S9(9) COMP.          03070000
030800     05  PV-TTL-INTRNST-QTY              PIC S9(9) COMP.          03080000
030900     05  PV-TTL-STORE-ON-HAND            PIC S9(9) COMP.          03090000
031000     05  PV-TTL-ONHAND-QTY               PIC S9(9) COMP.          03100000
031100                                                                  03110060
031200     05  PV-DISP-SQLCODE                 PIC -999.                03120060
031300     05  PV-DISP-PRCG-QTY                PIC -9(9).               03130060
031400     05  PV-DISP-BAL-QTY                 PIC -9(9).               03140060
031500     05  PV-DISP-PO                      PIC  Z(9).               03150060
031600     05  PV-DISP-RCVR                    PIC  9(4).               03160060
031700     05  PV-DISP-TRIP                    PIC  9(9).               03170060
031800     05  PV-DISP-LOC-NBR                 PIC  9(4).               03180060
031900     05  PV-DISP-SCN-LOC                 PIC  9(4).               03190066
032000     05  PV-DISP-UPC-ID                  PIC  9(9).               03200075
032100     05  PV-DISP-PO-RCVR.                                         03210099
032200         10  PDPR-TRN-NBR                PIC X(09) VALUE SPACES.  03220099
032300         10  PDPR-HYPHEN                 PIC X(01) VALUE SPACES.  03230099
032400         10  PDPR-RCVR-NBR               PIC X(03) VALUE SPACES.  03240099
032500                                                                  03250000
032600******************************************************************03260000
032700**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **03270000
032800**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **03280000
032900**  APPLICATION-SPECIFIC COMMAREA.                              **03290000
033000******************************************************************03300000
033100 01  LQW-LIST-QUEUE-WORK-AREA.                                    03310000
033200     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  03320000
033300     05  LQW-ITEM-ENTRIES               OCCURS 10 TIMES           03330000
033400                                        INDEXED BY LQW-IDX.       03340000
033500         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       03350000
033600         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               03360000
033700         10  LQW-SELECTED-SW            PIC  X(01).               03370000
033800             88  LQW-SELECT                         VALUE 'S'.    03380000
033900             88  LQW-DESELECT                       VALUE ' '.    03390000
034000         10  LQW-ACTION                 PIC  X(03).               03400000
034100             88  LQW-DEL                            VALUE 'DEL'.  03410000
034200             88  LQW-INQ                            VALUE 'INQ'.  03420000
034300             88  LQW-UPD                            VALUE 'UPD'.  03430000
034400             88  LQW-ERR                            VALUE 'ERR'.  03440000
034500         10  LQW-DATE                   PIC  X(10).               03450000
034600         10  LQW-DESC                   PIC  X(10).               03460000
034700         10  LQW-PO-RCVR                PIC  X(12).               03470000
034800         10  LQW-TRN-QTY                PIC  9(08)-.              03480000
034900         10  LQW-BAL-QTY                PIC  9(08)-.              03490000
035000         10  LQW-OUTBND-TRIP            PIC  9(09).               03500000
035100         10  LQW-USERID                 PIC  X(08).               03510000
035200                                                                  03520000
035300*---------------------------------------------------------------* 03530000
035400* SELECTON QUEUE LAYOUT                                         * 03540000
035500*---------------------------------------------------------------* 03550000
035600     COPY PCWS212.                                                03560000
035700                                                                  03570000
035800*---------------------------------------------------------------* 03580000
035900*    MAP LAYOUT                                                 * 03590000
036000*---------------------------------------------------------------* 03600000
036100     COPY PCKM747.                                                03610000
036200*                                                                 03620000
036300 01  MR-OCCURS-LAYOUT                   REDEFINES  PC747AO.       03630000
036400     05  FILLER                         PIC X(287).               03640099
036500     05  MR-SCROLL-AREA                 OCCURS 10 TIMES.          03650000
036600                                                                  03660000
036700         10  MR-DATEL                   PIC S9(04) COMP.          03670000
036800         10  MR-DATEA                   PIC  X(01).               03680000
036900         10  MR-DATEC                   PIC  X(01).               03690000
037000         10  MR-DATEH                   PIC  X(01).               03700000
037100         10  MR-DATE                    PIC  X(10).               03710000
037200                                                                  03720000
037300         10  MR-DESCL                   PIC S9(04) COMP.          03730000
037400         10  MR-DESCA                   PIC  X(01).               03740000
037500         10  MR-DESCC                   PIC  X(01).               03750000
037600         10  MR-DESCH                   PIC  X(01).               03760000
037700         10  MR-DESC                    PIC  X(10).               03770000
037800                                                                  03780000
037900         10  MR-PO-RCVRL                PIC S9(04) COMP.          03790000
038000         10  MR-PO-RCVRA                PIC  X(01).               03800000
038100         10  MR-PO-RCVRC                PIC  X(01).               03810000
038200         10  MR-PO-RCVRH                PIC  X(01).               03820000
038300         10  MR-PO-RCVR                 PIC  X(13).               03830099
038400                                                                  03840000
038500         10  MR-TRN-QTYL                PIC S9(04) COMP.          03850000
038600         10  MR-TRN-QTYA                PIC  X(01).               03860000
038700         10  MR-TRN-QTYC                PIC  X(01).               03870000
038800         10  MR-TRN-QTYH                PIC  X(01).               03880000
038900         10  MR-TRN-QTY                 PIC  X(09).               03890000
039000         10  MR-TRN-QTY-X REDEFINES MR-TRN-QTY.                   03900000
039100             15  MR-TRN-QTY-N              PIC ZZZZZZZ9-.         03910000
039200                                                                  03920000
039300         10  MR-BAL-QTYL                PIC S9(04) COMP.          03930000
039400         10  MR-BAL-QTYA                PIC  X(01).               03940000
039500         10  MR-BAL-QTYC                PIC  X(01).               03950000
039600         10  MR-BAL-QTYH                PIC  X(01).               03960000
039700         10  MR-BAL-QTY                 PIC  X(09).               03970000
039800         10  MR-BAL-QTY-X REDEFINES MR-BAL-QTY.                   03980000
039900             15  MR-BAL-QTY-N              PIC ZZZZZZZ9-.         03990000
040000                                                                  04000000
040100         10  MR-OUTBND-TRIPL            PIC S9(04) COMP.          04010000
040200         10  MR-OUTBND-TRIPA            PIC  X(01).               04020000
040300         10  MR-OUTBND-TRIPC            PIC  X(01).               04030000
040400         10  MR-OUTBND-TRIPH            PIC  X(01).               04040000
040500         10  MR-OUTBND-TRIP-A           PIC  X(09).               04050000
040600         10  MR-OUTBND-TRIP-X REDEFINES MR-OUTBND-TRIP-A.         04060000
040700             15  MR-OUTBND-TRIP         PIC  ZZZZZZZZ9.           04070000
040800                                                                  04080000
040900         10  MR-USERIDL                 PIC S9(04) COMP.          04090000
041000         10  MR-USERIDA                 PIC  X(01).               04100000
041100         10  MR-USERIDC                 PIC  X(01).               04110000
041200         10  MR-USERIDH                 PIC  X(01).               04120000
041300         10  MR-USERID                  PIC  X(08).               04130000
041400                                                                  04140000
041500*----------------------------------------------------------------*04150000
041600*    XMKCS001 COPYBOOK USED WITH XMKCS001 - ON HAND QUANTITY     *04160000
041700*----------------------------------------------------------------*04170000
041800     COPY XMWS003.                                                04180000
041900                                                                  04190000
042000*---------------------------------------------------------------* 04200000
042100*    ATTRIBUTE SETTINGS COPYBOOK.                               * 04210000
042200*---------------------------------------------------------------* 04220000
042300     COPY DPWS015.                                                04230000
042400                                                                  04240000
042500*---------------------------------------------------------------* 04250000
042600*    FUNCTION KEYS COPYBOOK.                                    * 04260000
042700*---------------------------------------------------------------* 04270000
042800     COPY DPWS016.                                                04280000
042900                                                                  04290000
043000*---------------------------------------------------------------* 04300000
043100*    NUMERIC EDIT LAYOUT.                                       * 04310000
043200*---------------------------------------------------------------* 04320000
043300     COPY DPWS010I.                                               04330000
043400                                                                  04340000
043500*---------------------------------------------------------------* 04350000
043600*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   * 04360000
043700*---------------------------------------------------------------* 04370000
043800     COPY DPWS030.                                                04380000
1122RM     COPY DPWS930.                                                04381099
043900                                                                  04390000
044000*---------------------------------------------------------------* 04400000
044100*    STANDARD COMMAREA.                                         * 04410000
044200*---------------------------------------------------------------* 04420000
044300     COPY DPWS020.                                                04430000
044400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04440000
044500                                                                  04450000
044600*---------------------------------------------------------------* 04460000
044700* INTER-APPLICATION COMMAREA.                                   * 04470000
044800*   PCWS210 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 04480000
044900*             SPEC SCREEN (PCKCS745).                           * 04490000
045000*   PCWS211 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 04500000
045100*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION     * 04510000
045200*             (PCKCS746).                                       * 04520000
045300*---------------------------------------------------------------* 04530000
045400                                                                  04540000
045500         10  INTER-APPL-COMM-AREA       PIC X(200).               04550000
045600     COPY PCWS210.                                                04560000
045700     COPY PCWS211.                                                04570000
045800                                                                  04580010
045900         10  FS009-FS-INTER-APPL-COMMAREA REDEFINES               04590032
046000                      INTER-APPL-COMM-AREA.                       04600032
046100     COPY FSWS009.                                                04610032
046200*---------------------------------------------------------------* 04620000
046300*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 04630000
046400*---------------------------------------------------------------* 04640000
046500         10  ASC-SPECIFIC-COMMAREA.                               04650000
046600             15  ASC-SKU                     PIC S9(08)V COMP-3.  04660000
046700             15  ASC-PO                      PIC S9(09) COMP.     04670000
046800             15  ASC-RCVR                    PIC S9(09) COMP.     04680000
046900             15  ASC-UPC-ID                  PIC S9(09) COMP.     04690000
047000             15  ASC-SKU-DESC                PIC  X(25).          04700000
047100             15  ASC-STR-NBR-X               PIC  X(04).          04710000
047200             15  ASC-STR-NBR-N REDEFINES ASC-STR-NBR-X.           04720000
047300                 20  ASC-STR-NBR             PIC  9(04).          04730000
047400             15  ASC-STORE-NAME              PIC  X(40).          04740000
047500             15  ASC-TTL-FASHION             PIC S9(09).          04750000
047600             15  ASC-TTL-INTRNST             PIC S9(09).          04760000
047700             15  ASC-TTL-STR-EXPECT          PIC S9(09).          04770000
047800             15  ASC-TTL-STR-ON-HAND         PIC S9(09).          04780000
047900             15  ASC-SCREEN-DISPLAY          PIC  X(01).          04790000
048000                 88  ASC-DISP-INTR                VALUE 'I'.      04800000
048100                 88  ASC-DISP-INTR-PORCVR         VALUE 'J'.      04810000
048200                 88  ASC-DISP-STR-EXPT            VALUE 'S'.      04820000
048300                 88  ASC-DISP-STR-EXPT-PORCVR     VALUE 'T'.      04830000
048400             15  ASC-FASHION-ON-HAND         PIC S9(09).          04840000
048500             15  ASC-INTR-QTY                PIC S9(09).          04850000
048600             15  ASC-STORE-EXPTECTED         PIC S9(09).          04860000
048700             15  ASC-STORE-ON-HAND           PIC S9(09).          04870000
048800             15  ASC-LAST-UPDT               PIC  X(10).          04880000
048900             15  ASC-TRAN-DATE               PIC  X(10).          04890000
049000             15  ASC-TYPE-DESC               PIC  X(10).          04900000
049100             15  ASC-PO-RCVR-NBR             PIC  X(13).          04910099
049200             15  ASC-TRN-QTY                 PIC  9(08)-.         04920000
049300             15  ASC-BAL-QTY                 PIC  9(08)-.         04930000
049400             15  ASC-OUTBND-TRIP             PIC  9(09).          04940000
049500             15  ASC-USER-ID                 PIC  X(08).          04950000
049600             15  ASC-PARM-BOSS-RECV          PIC S9(09) COMP.     04960099
049700             15  FILLER                      PIC  X(020).         04970099
049800*-----------------------------------------------------------------04980000
049900             15  ASC-BLK-SUB                  PIC S9(04) COMP     04990000
050000                                                         SYNC.    05000000
050100             15  ASC-ITEM-SUB                 PIC S9(04) COMP     05010000
050200                                                         SYNC.    05020000
050300             15  ASC-NUMBER-OF-ITEMS-READ     PIC S9(09) COMP-3.  05030000
050400             15  ASC-NUMBER-OF-SELECTED-ITEMS PIC S9(09) COMP-3.  05040000
050500             15  ASC-ITEMS-DISPLAYED          PIC S9(03) COMP-3.  05050000
050600             15  ASC-ITEM-AT-TOP-OF-PANEL     PIC S9(09) COMP-3.  05060000
050700             15  ASC-ITEM-AT-BOT-OF-PANEL     PIC S9(09) COMP-3.  05070000
050800             15  ASC-HIGHEST-BLOCK-WRITTEN    PIC S9(04) COMP     05080000
050900                                                         SYNC.    05090000
051000             15  ASC-START-OF-SELECTED-RANGE  PIC S9(09) COMP-3.  05100000
051100             15  ASC-END-OF-SELECTED-RANGE    PIC S9(09) COMP-3.  05110000
051200             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         05120000
051300                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     05130000
051400                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     05140000
051500             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).         05150000
051600                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     05160000
051700                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     05170000
051800             15  ASC-LIST-QUEUE-NAME.                             05180000
051900                 20  ASC-LIST-TERM-ID         PIC  X(04).         05190000
052000                 20  ASC-LIST-TASK-NUMBER     PIC S9(05) COMP-3.  05200000
052100                 20  ASC-LIST-SEQ             PIC  9(01).         05210000
052200                                                                  05220000
052300             15  ASC-START-ITEM-REQUEST.                          05230000
052400                 20  ASC-START-ITEM-REQUEST-N PIC  9(05).         05240000
052500                                                                  05250000
052600             15  ASC-SEL-SUB                  PIC S9(4) COMP.     05260000
052700             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     05270000
052800             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          05280000
052900                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 05290000
053000             15  ASC-SEL-QUEUE-NAME.                              05300000
053100                 20  ASC-SEL-TERM-ID          PIC  X(04).         05310000
053200                 20  ASC-SEL-TASK-NUMBER      PIC S9(05) COMP-3.  05320000
053300                 20  ASC-SEL-SEQ              PIC  9(01).         05330000
053400             15  ASC-SEL-QUEUE-NAME-2.                            05340000
053500                 20  ASC-SEL-TERM-ID-2        PIC  X(04).         05350000
053600                 20  ASC-SEL-TASK-NUMBER-2    PIC S9(05) COMP-3.  05360000
053700                 20  ASC-SEL-SEQ-2            PIC  9(01).         05370000
053800             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  05380000
053900                                                                  05390000
054000*-----------------------------------------------------------------05400000
054100             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                05410000
054200                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  05420000
054300                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   05430000
054400                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   05440000
054500                                                                  05450000
054600                 20  ASC-ITEM-ARRAY.                              05460000
054700                     25  ASC-ITEM-ENTRIES OCCURS 10 TIMES.        05470000
054800                         30  ASC-LIST-ITEM-NUMBER                 05480000
054900                                                     PIC S9(09)   05490000
055000                                                     COMP-3.      05500000
055100                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  05510000
055200                             88  ASC-VALID-SELECT    VALUE ' '    05520000
055300                                                           'S'    05530000
055400                                                           'B'    05540000
055500                                                           'E'.   05550000
055600                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   05560000
055700                             88  ASC-TEMP-SELECT     VALUE 'S'.   05570000
055800                             88  ASC-TEMP-BEGIN      VALUE 'B'.   05580000
055900                             88  ASC-TEMP-END        VALUE 'E'.   05590000
056000                         30  ASC-SELECTED-SW         PIC  X(01).  05600000
056100                             88  ASC-NO-SELECT       VALUE ' '.   05610000
056200                             88  ASC-SELECT          VALUE 'S'.   05620000
056300                             88  ASC-BEGIN           VALUE 'B'.   05630000
056400                             88  ASC-END             VALUE 'E'.   05640000
056500                         30  ASC-ACTION              PIC  X(03).  05650000
056600                         30  ASC-TRANDATE            PIC  X(10).  05660000
056700                         30  ASC-TYPEDESC            PIC  X(10).  05670000
056800                         30  ASC-PO-RCVR             PIC  X(13).  05680099
056900                         30  ASC-TRNQTY              PIC  9(08)-. 05690000
057000                         30  ASC-BALQTY              PIC  9(08)-. 05700000
057100                         30  ASC-OUTTRIP             PIC  9(09).  05710000
057200                         30  ASC-USERID              PIC  X(08).  05720000
057300                                                                  05730000
057400*---------------------------------------------------------------* 05740000
057500*    ABEND PROCESSING COPYBOOK.                                 * 05750000
057600*---------------------------------------------------------------* 05760000
057700     COPY DPWS013.                                                05770000
057800                                                                  05780000
057900*----------------------------------------------------------------*05790000
058000*    XLKUT001 COPYBOOK                                           *05800000
058100*----------------------------------------------------------------*05810000
058200     COPY XLWS001.                                                05820000
058300                                                                  05830000
058400*---------------------------------------------------------------* 05840000
058500*    PCT_TRN_CLSN_BAL                                             05850000
058600*---------------------------------------------------------------* 05860000
058700     EXEC SQL                                                     05870000
058800          INCLUDE PCT00014                                        05880000
058900     END-EXEC.                                                    05890000
059000                                                                  05900000
059100*---------------------------------------------------------------* 05910000
059200*    PCT_TRN_CLSN_DTL                                           * 05920000
059300*---------------------------------------------------------------* 05930000
059400     EXEC SQL                                                     05940000
059500          INCLUDE PCT00015                                        05950000
059600     END-EXEC.                                                    05960000
059700                                                                  05970000
059800*---------------------------------------------------------------* 05980000
059900*    XLT_LOC                                                    * 05990000
060000*---------------------------------------------------------------* 06000000
060100     EXEC SQL                                                     06010000
060200          INCLUDE XLT00010                                        06020000
060300     END-EXEC.                                                    06030000
060400                                                                  06040000
060500*---------------------------------------------------------------* 06050068
060600*    SUT_OTBND_CART                                             * 06060068
060700*---------------------------------------------------------------* 06070068
060800     EXEC SQL                                                     06080068
060900          INCLUDE SUT00024                                        06090068
061000     END-EXEC.                                                    06100068
061100                                                                  06110068
061200*---------------------------------------------------------------* 06120068
061300*    SUT_OTBND_UPC                                              * 06130068
061400*---------------------------------------------------------------* 06140068
061500     EXEC SQL                                                     06150068
061600          INCLUDE SUT00028                                        06160068
061700     END-EXEC.                                                    06170068
061800                                                                  06180068
061900*---------------------------------------------------------------* 06190069
062000*    SUT_OTBND_SCN_STR                                          * 06200069
062100*---------------------------------------------------------------* 06210069
062200     EXEC SQL                                                     06220069
062300          INCLUDE SUT00121                                        06230069
062400     END-EXEC.                                                    06240069
062500                                                                  06250069
062600*---------------------------------------------------------------* 06260069
062700*    XLT_UPC                                                    * 06270069
062800*---------------------------------------------------------------* 06280069
062900     EXEC SQL                                                     06290069
063000          INCLUDE XLT00006                                        06300069
063100     END-EXEC.                                                    06310069
063200                                                                  06320069
063300*---------------------------------------------------------------* 06330099
063400*    DB2 AREA FOR THE PARAMETER TABLE                           * 06340099
063500*---------------------------------------------------------------* 06350099
063600     EXEC SQL                                                     06360099
063700         INCLUDE TKRPRPM                                          06370099
063800     END-EXEC.                                                    06380099
063900                                                                  06390099
064000*---------------------------------------------------------------* 06400000
064100*    INTRANSIT CURSOR                                             06410000
064200*---------------------------------------------------------------* 06420000
064300     EXEC SQL                                                     06430000
064400          DECLARE INTRANSIT-CSR CURSOR FOR                        06440000
064500              SELECT  IN_TRNST_TRN_TMST                           06450000
064600                     ,TRN_TYP_CDE                                 06460000
064700                     ,TRN_CLSN_PRCG_QTY                           06470000
064800                     ,TRN_CLSN_BAL_QTY                            06480000
064900                     ,UPD_USR_ID                                  06490000
065000                     ,PO_NBR                                      06500000
065100                     ,RCVR_SEQ_NBR                                06510000
065200                     ,OTBND_TRIP_ID                               06520000
065300                FROM  PCT_TRN_CLSN_DTL                            06530000
065400               WHERE  INTR_UPC_ID    = :DK-UPC-ID                 06540000
065500                 AND  LOC_NBR        = :DK-STR-NBR                06550000
065600                 AND  TRN_CLSN_CDE   = 'IT'                       06560000
065700              ORDER BY IN_TRNST_TRN_TMST                          06570000
065800     END-EXEC.                                                    06580000
065900                                                                  06590000
066000*---------------------------------------------------------------* 06600000
066100*    INTRANSIT PO/RCVR CURSOR                                     06610000
066200*---------------------------------------------------------------* 06620000
066300     EXEC SQL                                                     06630000
066400          DECLARE INTR-PORCVR-CSR CURSOR FOR                      06640000
066500              SELECT  IN_TRNST_TRN_TMST                           06650000
066600                     ,TRN_TYP_CDE                                 06660000
066700                     ,TRN_CLSN_PRCG_QTY                           06670000
066800                     ,TRN_CLSN_BAL_QTY                            06680000
066900                     ,UPD_USR_ID                                  06690000
067000                     ,PO_NBR                                      06700000
067100                     ,RCVR_SEQ_NBR                                06710000
067200                     ,OTBND_TRIP_ID                               06720000
067300                FROM  PCT_TRN_CLSN_DTL                            06730000
067400               WHERE  INTR_UPC_ID    = :DK-UPC-ID                 06740000
067500                 AND  LOC_NBR        = :DK-STR-NBR                06750000
067600                 AND  TRN_CLSN_CDE   = 'IT'                       06760000
067700            ORDER BY PO_NBR, RCVR_SEQ_NBR, IN_TRNST_TRN_TMST      06770000
067800     END-EXEC.                                                    06780000
067900                                                                  06790000
068000*---------------------------------------------------------------* 06800000
068100*  USE THIS CURSOR WHEN COMING FROM THE PO/RCVR SCREEN - 761      06810000
068200*---------------------------------------------------------------* 06820000
068300     EXEC SQL                                                     06830000
068400          DECLARE PORCVR-INTR-CSR CURSOR FOR                      06840000
068500              SELECT  IN_TRNST_TRN_TMST                           06850000
068600                     ,TRN_TYP_CDE                                 06860000
068700                     ,TRN_CLSN_PRCG_QTY                           06870000
068800                     ,TRN_CLSN_BAL_QTY                            06880000
068900                     ,UPD_USR_ID                                  06890000
069000                     ,PO_NBR                                      06900000
069100                     ,RCVR_SEQ_NBR                                06910000
069200                     ,OTBND_TRIP_ID                               06920000
069300                FROM  PCT_TRN_CLSN_DTL                            06930000
069400               WHERE  INTR_UPC_ID    = :DK-UPC-ID                 06940000
069500                 AND  LOC_NBR        = :DK-STR-NBR                06950000
069600                 AND  TRN_CLSN_CDE   = 'IT'                       06960000
069700                 AND  PO_NBR         = :DK-PO                     06970000
069800                 AND  RCVR_SEQ_NBR   = :DK-RCVR                   06980000
069900            ORDER BY IN_TRNST_TRN_TMST                            06990000
070000     END-EXEC.                                                    07000000
070100                                                                  07010000
070200*---------------------------------------------------------------* 07020000
070300*    STORE-EXPECTED CURSOR                                        07030000
070400*---------------------------------------------------------------* 07040000
070500     EXEC SQL                                                     07050000
070600          DECLARE STR-EXPECTED-CSR CURSOR FOR                     07060000
070700              SELECT  IN_TRNST_TRN_TMST                           07070000
070800                     ,TRN_TYP_CDE                                 07080000
070900                     ,TRN_CLSN_PRCG_QTY                           07090000
071000                     ,TRN_CLSN_BAL_QTY                            07100000
071100                     ,UPD_USR_ID                                  07110000
071200                     ,PO_NBR                                      07120000
071300                     ,RCVR_SEQ_NBR                                07130000
071400                     ,OTBND_TRIP_ID                               07140000
071500                FROM  PCT_TRN_CLSN_DTL                            07150000
071600               WHERE  INTR_UPC_ID    = :DK-UPC-ID                 07160000
071700                 AND  LOC_NBR        = :DK-STR-NBR                07170000
071800                 AND  TRN_CLSN_CDE   = 'SE'                       07180000
071900              ORDER BY IN_TRNST_TRN_TMST                          07190000
072000     END-EXEC.                                                    07200000
072100                                                                  07210000
072200*---------------------------------------------------------------* 07220000
072300*    STORE-EXPECTED PO/RCVR CURSOR                                07230000
072400*---------------------------------------------------------------* 07240000
072500     EXEC SQL                                                     07250000
072600          DECLARE STR-EXP-PORCVR-CSR CURSOR FOR                   07260000
072700              SELECT  IN_TRNST_TRN_TMST                           07270000
072800                     ,TRN_TYP_CDE                                 07280000
072900                     ,TRN_CLSN_PRCG_QTY                           07290000
073000                     ,TRN_CLSN_BAL_QTY                            07300000
073100                     ,UPD_USR_ID                                  07310000
073200                     ,PO_NBR                                      07320000
073300                     ,RCVR_SEQ_NBR                                07330000
073400                     ,OTBND_TRIP_ID                               07340000
073500                FROM  PCT_TRN_CLSN_DTL                            07350000
073600               WHERE  INTR_UPC_ID    = :DK-UPC-ID                 07360000
073700                 AND  LOC_NBR        = :DK-STR-NBR                07370000
073800                 AND  TRN_CLSN_CDE   = 'SE'                       07380000
073900            ORDER BY PO_NBR, RCVR_SEQ_NBR, IN_TRNST_TRN_TMST      07390000
074000     END-EXEC.                                                    07400000
074100                                                                  07410000
074200*---------------------------------------------------------------* 07420000
074300* USE THIS CURSOR WHEN COMING FROM THE PO/RCVR SCREEN - 761       07430000
074400*---------------------------------------------------------------* 07440000
074500     EXEC SQL                                                     07450000
074600          DECLARE PORCVR-STR-EXP-CSR CURSOR FOR                   07460000
074700              SELECT  IN_TRNST_TRN_TMST                           07470000
074800                     ,TRN_TYP_CDE                                 07480000
074900                     ,TRN_CLSN_PRCG_QTY                           07490000
075000                     ,TRN_CLSN_BAL_QTY                            07500000
075100                     ,UPD_USR_ID                                  07510000
075200                     ,PO_NBR                                      07520000
075300                     ,RCVR_SEQ_NBR                                07530000
075400                     ,OTBND_TRIP_ID                               07540000
075500                FROM  PCT_TRN_CLSN_DTL                            07550000
075600               WHERE  INTR_UPC_ID    = :DK-UPC-ID                 07560000
075700                 AND  LOC_NBR        = :DK-STR-NBR                07570000
075800                 AND  PO_NBR         = :DK-PO                     07580000
075900                 AND  RCVR_SEQ_NBR   = :DK-RCVR                   07590000
076000                 AND  TRN_CLSN_CDE   = 'SE'                       07600000
076100            ORDER BY IN_TRNST_TRN_TMST                            07610000
076200     END-EXEC.                                                    07620000
076300                                                                  07630000
076400*---------------------------------------------------------------* 07640000
076500*    DB2 AREA FOR COMMUNICATIONS                                * 07650000
076600*---------------------------------------------------------------* 07660000
076700     EXEC SQL                                                     07670000
076800          INCLUDE SQLCA                                           07680000
076900     END-EXEC.                                                    07690000
077000                                                                  07700000
077100*-----------------------------------------------------------------07710000
077200 LINKAGE SECTION.                                                 07720000
077300                                                                  07730000
077400 01  DFHCOMMAREA.                                                 07740000
077500     05  FILLER                         OCCURS  1 TO 4072 TIMES   07750000
077600                                        DEPENDING ON EIBCALEN.    07760000
077700         10  FILLER                     PIC X.                    07770000
077800                                                                  07780000
077900                                                                  07790000
078000 PROCEDURE DIVISION.                                              07800000
078100******************************************************************07810000
078200**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **07820000
078300**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **07830000
078400**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **07840000
078500******************************************************************07850000
078600 0000-MAIN-MODULE.                                                07860000
078700     INITIALIZE DP030-CICS-API-FIELDS.                            07870000
078800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       07880000
078900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          07890000
079000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         07900000
079100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       07910000
079200     MOVE LENGTH OF PC747AI        TO DP030-MAP-LENGTH (1).       07920000
079300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     07930000
079400     PERFORM 0001-CALL-CICS-ARCH-API.                             07940000
079500*                                                                 07950000
079600     PERFORM 1000-CONTROL-PROCESSING                              07960000
079700*                                                                 07970000
079800     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     07980000
079900     PERFORM 0001-CALL-CICS-ARCH-API.                             07990000
080000                                                                  08000000
080100******************************************************************08010000
080200**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **08020000
080300**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **08030000
080400******************************************************************08040000
080500 0001-CALL-CICS-ARCH-API.                                         08050000
1122RM*    CALL 'DPKCS030' USING DFHEIBLK                               08060099
1122RM     CALL DP930-CICS-ARCH-API                                     08061099
1122RM                     USING DFHEIBLK                               08062099
080700                           DFHCOMMAREA                            08070000
080800                           DP030-CICS-API-FIELDS                  08080000
080900                           DP020-STANDARD-COMMAREA                08090000
081000                           PC747AI.                               08100000
081100*                                                                 08110000
081200     IF  DP030-RC-CALL-SUCCESSFUL                                 08120000
081300         CONTINUE                                                 08130000
081400     ELSE                                                         08140000
081500         SET DP013-NO-ROLLBACK                                    08150000
081600             DP013-XCTL-DISPLAY-RESTART                           08160000
081700             DP013-CICS-ABEND      TO TRUE                        08170000
081800         MOVE '0001-CALL-CICS-ARCH-API' TO DP013-PARAGRAPH        08180000
1122RM*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX08190099
1122RM*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      08200099
1122rm         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O08201099
1122RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      08202099
082100         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      08210000
082200         PERFORM DP013-0000-PROCESS-ABEND                         08220000
082300     END-IF.                                                      08230000
082400                                                                  08240000
082500*----------------------------------------------------------------*08250000
082600* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *08260000
082700* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *08270000
082800*                                                                *08280000
082900* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *08290000
083000*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *08300000
083100*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *08310000
083200*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *08320000
083300*----------------------------------------------------------------*08330000
083400 1000-CONTROL-PROCESSING.                                         08340000
083500                                                                  08350000
083600     EVALUATE TRUE                                                08360000
083700         WHEN DP020-NEXT-ACT-INITIAL                              08370000
083800             INITIALIZE ASC-SPECIFIC-COMMAREA                     08380000
083900             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            08390000
084000                                      ASC-SEL-TERM-ID             08400000
084100                                      ASC-SEL-TERM-ID-2           08410000
084200             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   08420000
084300                                           ASC-SEL-TASK-NUMBER    08430000
084400                                           ASC-SEL-TASK-NUMBER-2  08440000
084500             MOVE PC-LIST-QUEUE-SEQ  TO ASC-LIST-SEQ              08450000
084600             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 08460000
084700                                      ASC-SEL-SEQ-2               08470000
084800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 08480000
084900             PERFORM 4000-BUILD-INITIAL-PANEL                     08490000
085000                                                                  08500000
085100         WHEN DP020-NEXT-ACT-READ-MAP                             08510000
085200             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         08520000
085300             PERFORM 2000-PROCESS-PANEL                           08530000
085400                                                                  08540000
085500         WHEN DP020-NEXT-ACT-RETURN                               08550000
085600             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         08560000
085700             MOVE ZERO  TO ASC-ITEM-AT-TOP-OF-PANEL               08570000
085800             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 08580000
085900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08590000
086000                                                                  08600000
086100         WHEN OTHER                                               08610000
086200             SET DP013-LOGIC-ABEND TO TRUE                        08620000
086300             SET DP013-NO-ROLLBACK TO TRUE                        08630000
086400             MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH    08640000
086500             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    08650000
086600                                   TO DP013-MESSAGE-TEXT(1)       08660000
086700             PERFORM DP013-0000-PROCESS-ABEND                     08670000
086800     END-EVALUATE.                                                08680000
086900                                                                  08690000
087000*----------------------------------------------------------------*08700000
087100* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *08710000
087200* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *08720000
087300*    PC-CRIT-SPEC-FORMAT IS A '1' AND COMES FROM PCKCS745        *08730000
087400*    PC-LIST-FORMAT      IS A '2' AND COMES FROM PCKCS746        *08740000
087500*    PC-PORCVR-FORMAT    IS A '3' AND COMES FROM PCKCS761        *08750000
087600*    PC-FASHION-FORMAT   IS A '4' AND COMES FROM FSKCS032        *08760008
087700*----------------------------------------------------------------*08770000
087800 1100-PROCESS-INTER-APPL-COMM.                                    08780000
087900                                                                  08790000
088000     SET PS-COMMAREA-VALID         TO TRUE.                       08800000
088100     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     08810090
088200     PERFORM 1110-GET-BOSS-PARM.                                  08820099
088300                                                                  08830000
088400     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          08840000
088500         MOVE PC210-SKU               TO ASC-SKU                  08850000
088600         MOVE PC210-STORE-NBR         TO ASC-STR-NBR              08860000
088700                                         DK-STR-NBR               08870000
088800         MOVE PC210-STORE-NAME        TO ASC-STORE-NAME           08880000
088900         MOVE PC210-UPC-ID            TO ASC-UPC-ID               08890000
089000                                         DK-UPC-ID                08900000
089100         MOVE PC210-SCREEN-DISPLAY    TO ASC-SCREEN-DISPLAY       08910000
089200     ELSE                                                         08920000
089300     IF  DP020-INT-APPL-FORMAT-IND = PC-LIST-FORMAT               08930000
089400         SET ASC-USE-SELECTION-QUEUE TO TRUE                      08940000
089500         MOVE PC211-NUMBER-OF-SELECTED-ITEMS TO                   08950000
089600                                      ASC-NUMBER-OF-SELECTED-ITEMS08960000
089700         MOVE PC211-NUMBER-OF-TS-ITEMS TO ASC-NUMBER-OF-TS-ITEMS  08970000
089800         MOVE PC211-SEL-QUEUE-NAME     TO ASC-SEL-QUEUE-NAME      08980000
089900         MOVE PC211-SKU                TO ASC-SKU                 08990000
090000         MOVE PC211-STORE-NBR          TO ASC-STR-NBR             09000000
090100                                          DK-STR-NBR              09010000
090200         MOVE PC211-SCREEN-DISPLAY     TO ASC-SCREEN-DISPLAY      09020000
090300         PERFORM 1120-PREPARE-LIST-ENTRY                          09030000
090400     ELSE                                                         09040000
090500     IF  DP020-INT-APPL-FORMAT-IND = PC-PORCVR-FORMAT             09050000
090600         SET ASC-USE-SELECTION-QUEUE TO TRUE                      09060000
090700         MOVE PC211-NUMBER-OF-SELECTED-ITEMS TO                   09070000
090800                                      ASC-NUMBER-OF-SELECTED-ITEMS09080000
090900         MOVE PC211-NUMBER-OF-TS-ITEMS TO ASC-NUMBER-OF-TS-ITEMS  09090000
091000         MOVE PC211-SEL-QUEUE-NAME     TO ASC-SEL-QUEUE-NAME      09100000
091100         MOVE PC211-PO-NBR             TO ASC-PO                  09110000
091200                                          DK-PO                   09120000
091300         MOVE PC211-RCVR-NBR           TO ASC-RCVR                09130000
091400                                          DK-RCVR                 09140000
091500         MOVE PC211-SKU                TO ASC-SKU                 09150000
091600         MOVE PC211-STORE-NBR          TO ASC-STR-NBR             09160000
091700                                          DK-STR-NBR              09170000
091800         MOVE PC211-SCREEN-DISPLAY     TO ASC-SCREEN-DISPLAY      09180000
091900         PERFORM 1120-PREPARE-LIST-ENTRY                          09190000
092000     ELSE                                                         09200008
092100     IF  DP020-INT-APPL-FORMAT-IND = PC-FASHION-FORMAT            09210008
092200         MOVE FS009-SKU-NUMBER-X   TO ASC-SKU                     09220009
092300                                      DK-SKU                      09230027
092400         MOVE FS009-STORE-NUMBER-X TO ASC-STR-NBR                 09240009
092500                                      DK-STR-NBR                  09250009
092600         MOVE FS009-STORE-NAME     TO ASC-STORE-NAME              09260013
092700         MOVE FS009-UPC-ID         TO ASC-UPC-ID                  09270035
092800                                      DK-UPC-ID                   09280035
092900         MOVE FS009-SCREEN-DISPLAY     TO ASC-SCREEN-DISPLAY      09290012
093000     END-IF                                                       09300008
093100     END-IF                                                       09310008
093200     END-IF                                                       09320008
093300     END-IF.                                                      09330000
093400                                                                  09340000
093500                                                                  09350000
093600*----------------------------------------------------------------*09360099
093700*- RETRIEVE THE PARAMETER FROM TKRPRPM TO DETERMINE IF THIS IS    09370099
093800*- A BOSS RECEIVER.                                               09380099
093900*----------------------------------------------------------------*09390099
094000 1110-GET-BOSS-PARM.                                              09400099
094100                                                                  09410099
094200     EXEC SQL                                                     09420099
094300          SELECT FUNC_QTY                                         09430099
094400          INTO  :ASC-PARM-BOSS-RECV                               09440099
094500           FROM TKRPRPM                                           09450099
094600          WHERE LOC_ID            =  90                           09460099
094700            AND SYS_PRC_FUNC_CDE  = 'BSSRCV'                      09470099
094800            AND INTFC_SYS_CDE     = 'GIV'                         09480099
094900            AND FUNC_PRC_STAT_CDE = 'AC'                          09490099
095000           WITH UR                                                09500099
095100     END-EXEC.                                                    09510099
095200                                                                  09520099
095300     EVALUATE TRUE                                                09530099
095400         WHEN SQLCODE = ZERO                                      09540099
095500              CONTINUE                                            09550099
095600                                                                  09560099
095700         WHEN SQLWARN0 NOT = SPACE                                09570099
095800         WHEN SQLCODE NOT = ZERO                                  09580099
095900              MOVE '2115-GET-BOSS-PARM'                           09590099
096000                                  TO DP013-PARAGRAPH              09600099
096100              MOVE 'BOSS RCVR PARM       '                        09610099
096200                                  TO DP013-MESSAGE-TEXT (1)       09620099
096300              MOVE SQLCA          TO DP013-SQLCA                  09630099
096400              MOVE 'TKRPRPM'      TO DP013-DB2-TABLE-NAME (1)     09640099
096500              SET DP013-DB2-ABEND TO TRUE                         09650099
096600              PERFORM DP013-0000-PROCESS-ABEND                    09660099
096700     END-EVALUATE.                                                09670099
096800                                                                  09680099
096900*-----------------------------------------------------------------09690000
097000*  PREPARE LIST ENTRY                                             09700000
097100*-----------------------------------------------------------------09710000
097200 1120-PREPARE-LIST-ENTRY.                                         09720000
097300                                                                  09730000
097400     MOVE PC212-MAX-ITEMS          TO ASC-SEL-SUB.                09740000
097500     MOVE ZERO                     TO ASC-SEL-ITEM.               09750000
097600     PERFORM 1130-GET-NEXT-RECORD.                                09760000
097700                                                                  09770000
097800*-----------------------------------------------------------------09780000
097900*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*09790000
098000*-----------------------------------------------------------------09800000
098100 1130-GET-NEXT-RECORD.                                            09810000
098200     ADD +1                       TO ASC-SEL-SUB.                 09820000
098300                                                                  09830000
098400     IF  ASC-SEL-SUB > PC212-MAX-ITEMS                            09840000
098500         ADD +1                   TO ASC-SEL-ITEM                 09850000
098600         MOVE +1                  TO ASC-SEL-SUB                  09860000
098700     END-IF.                                                      09870000
098800                                                                  09880000
098900     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                09890000
099000         PERFORM 9100-READ-SEL-QUEUE                              09900000
099100         IF  PC212-ITEM (ASC-SEL-SUB) > ZERO                      09910000
099200             MOVE PC212-STORE-NBR (ASC-SEL-SUB) TO ASC-STR-NBR    09920000
099300                                                   DK-STR-NBR     09930000
099400             MOVE PC212-STORE-NAME (ASC-SEL-SUB) TO ASC-STORE-NAME09940000
099500             MOVE PC212-FASH-ON-HAND (ASC-SEL-SUB)                09950000
099600                                 TO ASC-FASHION-ON-HAND           09960000
099700             MOVE PC212-INTR-QTY (ASC-SEL-SUB) TO ASC-INTR-QTY    09970000
099800             MOVE PC212-STORE-EXPECTED (ASC-SEL-SUB)              09980000
099900                                 TO ASC-STORE-EXPTECTED           09990000
100000             MOVE PC212-STORE-ON-HAND (ASC-SEL-SUB)               10000000
100100                                 TO ASC-STORE-ON-HAND             10010000
100200             MOVE PC212-LAST-UPDT (ASC-SEL-SUB) TO ASC-LAST-UPDT  10020000
100300             SET PC212-INQ (ASC-SEL-SUB) TO TRUE                  10030000
100400             PERFORM 9200-REWRITE-SEL-QUEUE                       10040000
100500         ELSE                                                     10050000
100600             SUBTRACT +1 FROM ASC-SEL-SUB                         10060000
100700             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             10070000
100800             SET DP020-MSG-INFORMATIONAL                          10080000
100900                 PS-LIST-END             TO TRUE                  10090000
101000         END-IF                                                   10100000
101100     ELSE                                                         10110000
101200         SUBTRACT +1 FROM ASC-SEL-ITEM                            10120000
101300         MOVE PC212-MAX-ITEMS     TO ASC-SEL-SUB                  10130000
101400         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             10140000
101500         SET DP020-MSG-INFORMATIONAL                              10150000
101600             PS-LIST-END             TO TRUE                      10160000
101700     END-IF.                                                      10170000
101800                                                                  10180000
101900*----------------------------------------------------------------*10190000
102000*    GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING      *10200000
102100*    PROCESSED.                                                  *10210000
102200*----------------------------------------------------------------*10220000
102300 1140-GET-PREV-RECORD.                                            10230000
102400     SUBTRACT +1 FROM ASC-SEL-SUB.                                10240000
102500                                                                  10250000
102600     IF  ASC-SEL-SUB < +1                                         10260000
102700         SUBTRACT +1 FROM ASC-SEL-ITEM                            10270000
102800         MOVE PC212-MAX-ITEMS     TO ASC-SEL-SUB                  10280000
102900     END-IF.                                                      10290000
103000                                                                  10300000
103100     IF  ASC-SEL-ITEM > ZERO                                      10310000
103200         PERFORM 9100-READ-SEL-QUEUE                              10320000
103300         MOVE PC212-STORE-NBR (ASC-SEL-SUB) TO ASC-STR-NBR        10330000
103400                                               DK-STR-NBR         10340000
103500         MOVE PC212-STORE-NAME (ASC-SEL-SUB) TO ASC-STORE-NAME    10350000
103600         MOVE PC212-FASH-ON-HAND (ASC-SEL-SUB)                    10360000
103700                                          TO ASC-FASHION-ON-HAND  10370000
103800         MOVE PC212-INTR-QTY (ASC-SEL-SUB) TO ASC-INTR-QTY        10380000
103900         MOVE PC212-STORE-EXPECTED (ASC-SEL-SUB)                  10390000
104000                                         TO  ASC-STORE-EXPTECTED  10400000
104100         MOVE PC212-STORE-ON-HAND (ASC-SEL-SUB)                   10410000
104200                                         TO  ASC-STORE-ON-HAND    10420000
104300         MOVE PC212-LAST-UPDT (ASC-SEL-SUB) TO ASC-LAST-UPDT      10430000
104400         SET PC212-INQ (ASC-SEL-SUB) TO TRUE                      10440000
104500         PERFORM 9200-REWRITE-SEL-QUEUE                           10450000
104600     ELSE                                                         10460000
104700         MOVE +1                  TO ASC-SEL-ITEM                 10470000
104800                                     ASC-SEL-SUB                  10480000
104900         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             10490000
105000         SET DP020-MSG-INFORMATIONAL                              10500000
105100             PS-LIST-END             TO TRUE                      10510000
105200     END-IF.                                                      10520000
105300                                                                  10530000
105400*----------------------------------------------------------------*10540000
105500* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *10550000
105600* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *10560000
105700* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *10570000
105800* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *10580000
105900* FUNCTION KEYS CAN GET THIS FAR.                                *10590000
106000*----------------------------------------------------------------*10600000
106100 2000-PROCESS-PANEL.                                              10610000
106200     EVALUATE TRUE                                                10620000
106300         WHEN DP020-SRC-AID = DP016-CLEAR                         10630000
106400             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    10640000
106500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10650000
106600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10660000
106700                                                                  10670000
106800         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    10680000
106900             PERFORM 2050-DELETE-LIST-QUEUE                       10690000
107000             PERFORM 4000-BUILD-INITIAL-PANEL                     10700000
107100                                                                  10710000
107200         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             10720000
107300             IF  ASC-USE-SELECTION-QUEUE                          10730000
107400                 PERFORM 1130-GET-NEXT-RECORD                     10740000
107500                 IF PS-LIST-END                                   10750000
107600                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         10760000
107700                     SET PS-NO-LIST-END TO TRUE                   10770000
107800                 ELSE                                             10780000
107900                     PERFORM 2050-DELETE-LIST-QUEUE               10790000
108000                     PERFORM 3200-RESET-ATTRIBUTES                10800000
108100                     PERFORM 4000-BUILD-INITIAL-PANEL             10810000
108200                 END-IF                                           10820000
108300              ELSE                                                10830000
108400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             10840000
108500*                --- BOTTOM OF LIST ---                           10850000
108600                 MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER         10860000
108700                 SET DP020-MSG-INFORMATIONAL TO TRUE              10870000
108800             END-IF                                               10880000
108900                                                                  10890000
109000         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             10900000
109100             IF  ASC-USE-SELECTION-QUEUE                          10910000
109200                 PERFORM 1140-GET-PREV-RECORD                     10920000
109300                 IF PS-LIST-END                                   10930000
109400                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         10940000
109500                     SET PS-NO-LIST-END TO TRUE                   10950000
109600                 ELSE                                             10960000
109700                     PERFORM 2050-DELETE-LIST-QUEUE               10970000
109800                     PERFORM 3200-RESET-ATTRIBUTES                10980000
109900                     PERFORM 4000-BUILD-INITIAL-PANEL             10990000
110000                 END-IF                                           11000000
110100             ELSE                                                 11010000
110200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             11020000
110300                 MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER         11030000
110400                 SET DP020-MSG-INFORMATIONAL TO TRUE              11040000
110500             END-IF                                               11050000
110600                                                                  11060000
110700*                                                                 11070000
110800* F18- INTRANSIT                                                  11080000
110900         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               11090000
111000                                                                  11100000
111100              EVALUATE TRUE                                       11110000
111200                  WHEN ASC-DISP-INTR                              11120000
111300                       SET  ASC-DISP-STR-EXPT  TO  TRUE           11130000
111400                  WHEN ASC-DISP-STR-EXPT                          11140000
111500                       SET  ASC-DISP-INTR      TO  TRUE           11150000
111600                  WHEN ASC-DISP-INTR-PORCVR                       11160000
111700                       SET  ASC-DISP-INTR      TO  TRUE           11170000
111800                  WHEN ASC-DISP-STR-EXPT-PORCVR                   11180000
111900                       SET  ASC-DISP-STR-EXPT  TO  TRUE           11190000
112000              END-EVALUATE                                        11200000
112100                                                                  11210000
112200              PERFORM 2050-DELETE-LIST-QUEUE                      11220000
112300              PERFORM 3200-RESET-ATTRIBUTES                       11230000
112400              PERFORM 4000-BUILD-INITIAL-PANEL                    11240000
112500                                                                  11250000
112600*                                                                 11260000
112700* F17- PO/RCVR                                                    11270000
112800         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               11280000
112900                                                                  11290000
113000              EVALUATE TRUE                                       11300000
113100                  WHEN ASC-DISP-INTR                              11310000
113200                       SET  ASC-DISP-INTR-PORCVR      TO  TRUE    11320000
113300                  WHEN ASC-DISP-STR-EXPT                          11330000
113400                       SET  ASC-DISP-STR-EXPT-PORCVR  TO  TRUE    11340000
113500                  WHEN ASC-DISP-INTR-PORCVR                       11350000
113600                       SET  ASC-DISP-INTR      TO  TRUE           11360000
113700                  WHEN ASC-DISP-STR-EXPT-PORCVR                   11370000
113800                       SET  ASC-DISP-STR-EXPT  TO  TRUE           11380000
113900              END-EVALUATE                                        11390000
114000                                                                  11400000
114100              PERFORM 2050-DELETE-LIST-QUEUE                      11410000
114200              PERFORM 3200-RESET-ATTRIBUTES                       11420000
114300              PERFORM 4000-BUILD-INITIAL-PANEL                    11430000
114400*                                                                 11440000
114500         WHEN OTHER                                               11450000
114600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 11460000
114700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   11470000
114800                                                                  11480000
114900             IF  PS-NO-ERROR                                      11490000
115000                 SET DP030-CONTINUE-GO TO TRUE                    11500000
115100                 PERFORM 2100-CHECK-FUNCTION-KEY                  11510000
115200             ELSE                                                 11520000
115300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             11530000
115400                 SET DP030-OVERRIDE-GO TO TRUE                    11540000
115500             END-IF                                               11550000
115600     END-EVALUATE.                                                11560000
115700                                                                  11570000
115800*----------------------------------------------------------------*11580000
115900*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *11590000
116000*----------------------------------------------------------------*11600000
116100 2050-DELETE-LIST-QUEUE.                                          11610000
116200                                                                  11620000
116300     EXEC CICS                                                    11630000
116400         DELETEQ TS                                               11640000
116500             QUEUE (ASC-LIST-QUEUE-NAME)                          11650000
116600             RESP  (PV-CICS-RESP)                                 11660000
116700     END-EXEC.                                                    11670000
116800                                                                  11680000
116900     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       11690000
117000        (PV-CICS-RESP = DFHRESP(QIDERR))                          11700000
117100         CONTINUE                                                 11710000
117200     ELSE                                                         11720000
117300         SET DP013-CICS-ABEND      TO TRUE                        11730000
117400         SET DP013-NO-ROLLBACK     TO TRUE                        11740000
117500                                                                  11750000
117600         MOVE '2050-DELETE-LIST-QUEUE' TO DP013-PARAGRAPH         11760000
117700         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    11770000
117800                                   TO DP013-MESSAGE-TEXT (1)      11780000
117900         PERFORM DP013-0000-PROCESS-ABEND                         11790000
118000     END-IF.                                                      11800000
118100                                                                  11810000
118200     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  11820000
118300                                                                  11830000
118400*----------------------------------------------------------------*11840000
118500* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*11850000
118600* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *11860000
118700* CICS ARCHITECTURE API.                                         *11870000
118800*----------------------------------------------------------------*11880000
118900 2100-CHECK-FUNCTION-KEY.                                         11890000
119000                                                                  11900000
119100     EVALUATE TRUE                                                11910000
119200*                                                                 11920000
119300* F6 - FIRST PAGE                                                 11930000
119400         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  11940000
119500             MOVE +1               TO PV-TOP-ITEM                 11950000
119600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11960000
119700*                                                                 11970000
119800* F7 - PREVIOUS PAGE                                              11980000
119900         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   11990000
120000             PERFORM 2110-BROWSE-BACKWARD                         12000000
120100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12010000
120200*                                                                 12020000
120300* F8 - NEXT PAGE                                                  12030000
120400         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   12040000
120500             PERFORM 2120-BROWSE-FORWARD                          12050000
120600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12060000
120700*                                                                 12070000
120800* ENTER KEY                                                       12080000
120900         WHEN DP020-SRC-AID = DP016-ENTER                         12090000
121000             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   12100000
121100             IF  PS-ERROR                                         12110000
121200                 CONTINUE                                         12120000
121300             ELSE                                                 12130000
121400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             12140000
121500             END-IF                                               12150000
121600                                                                  12160000
121700         WHEN OTHER                                               12170000
121800             SET DP013-NO-ROLLBACK                                12180000
121900                 DP013-XCTL-DISPLAY-RESTART                       12190000
122000                 DP013-CICS-ABEND  TO TRUE                        12200000
122100             MOVE '2100-CHECK-FUNCTION-KEY'                       12210000
122200                                   TO DP013-PARAGRAPH             12220000
122300             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      12230000
122400                                   TO DP013-MESSAGE-TEXT (1)      12240000
122500             PERFORM DP013-0000-PROCESS-ABEND                     12250000
122600     END-EVALUATE.                                                12260000
122700*                                                                 12270000
122800*----------------------------------------------------------------*12280000
122900*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *12290000
123000*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *12300000
123100*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *12310000
123200*    MESSAGE.                                                    *12320000
123300*----------------------------------------------------------------*12330000
123400 2110-BROWSE-BACKWARD.                                            12340000
123500     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    12350000
123600         GIVING PV-TOP-ITEM.                                      12360000
123700*                                                                 12370000
123800     IF  ((PV-TOP-ITEM < +1)                                      12380000
123900       OR (PV-TOP-ITEM = +1))                                     12390000
124000         MOVE +1                   TO PV-TOP-ITEM                 12400000
124100*        -- TOP OF LIST --                                        12410000
124200         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            12420000
124300         SET DP020-MSG-INFORMATIONAL TO TRUE                      12430000
124400     END-IF.                                                      12440000
124500                                                                  12450000
124600*----------------------------------------------------------------*12460000
124700*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *12470000
124800*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *12480000
124900*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *12490000
125000*----------------------------------------------------------------*12500000
125100 2120-BROWSE-FORWARD.                                             12510000
125200                                                                  12520000
125300     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              12530000
125400         GIVING PV-TOP-ITEM.                                      12540000
125500     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   12550000
125600         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             12560000
125700*        -- BOTTOM OF LIST --                                     12570000
125800         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            12580000
125900         SET DP020-MSG-INFORMATIONAL  TO TRUE                     12590000
126000     ELSE                                                         12600000
126100         COMPUTE PV-BOTTOM-ITEM =                                 12610000
126200             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 12620000
126300         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            12630000
126400*            -- BOTTOM OF LIST --                                 12640000
126500             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            12650000
126600             SET DP020-MSG-INFORMATIONAL TO TRUE                  12660000
126700         END-IF                                                   12670000
126800     END-IF.                                                      12680000
126900                                                                  12690000
127000*----------------------------------------------------------------*12700000
127100*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *12710000
127200*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *12720000
127300*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *12730000
127400*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *12740000
127500*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *12750000
127600*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *12760000
127700*----------------------------------------------------------------*12770000
127800 2130-CHECK-FOR-JUMP-BROWSE.                                      12780000
127900     SET PS-NO-ERROR               TO TRUE.                       12790000
128000     IF (ASC-START-ITEM-REQUEST = SPACE)                          12800000
128100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            12810000
128200                                   TO PV-TOP-ITEM                 12820000
128300     ELSE                                                         12830000
128400         MOVE ASC-START-ITEM-REQUEST                              12840000
128500                                   TO DP010I-UNEDITED-FIELD       12850000
128600         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     12860000
128700         MOVE LENGTH OF ASC-START-ITEM-REQUEST                    12870000
128800                                 TO DP010I-MAXIMUM-DIGITS         12880000
128900         SET DP010I-NEGATIVE-NOT-ALLOWED                          12890000
129000                                   TO TRUE                        12900000
129110         CALL DP010I-NUMERIC-EDIT-ROUTINE                         12911099
129120                         USING DP010I-NUMERIC-EDIT-AREA           12912099
129200                                                                  12920000
129300         IF  NOT DP010I-ERROR-DETECTED                            12930000
129400             MOVE DP010I-NUMERIC-FIELD                            12940000
129500                                   TO  ASC-START-ITEM-REQUEST-N   12950000
129600             IF  ASC-START-ITEM-REQUEST-N > ZERO                  12960000
129700                 IF  ASC-START-ITEM-REQUEST-N >                   12970000
129800                                          ASC-NUMBER-OF-ITEMS-READ12980000
129900                     MOVE SPACE TO ASC-START-ITEM-REQUEST         12990000
130000                     COMPUTE PV-TOP-ITEM =                        13000000
130100                             ASC-NUMBER-OF-ITEMS-READ             13010000
130200                             - PC-ITEMS-PER-PANEL + 1             13020000
130300                     IF  PV-TOP-ITEM < +1                         13030000
130400                         MOVE +1   TO PV-TOP-ITEM                 13040000
130500                         MOVE PC-TSYMSG-00070                     13050000
130600                                   TO DP020-MSG-NUMBER            13060000
130700                         SET DP020-MSG-INFORMATIONAL              13070000
130800                                   TO TRUE                        13080000
130900                     ELSE                                         13090000
131000                         MOVE  PV-TOP-ITEM                        13100000
131100                           TO  ASC-START-ITEM-REQUEST-N           13110000
131200                     END-IF                                       13120000
131300                 ELSE                                             13130000
131400                     MOVE ASC-START-ITEM-REQUEST-N                13140000
131500                                   TO PV-TOP-ITEM                 13150000
131600                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      13160000
131700                     COMPUTE PV-BOTTOM-ITEM =                     13170000
131800                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     13180000
131900                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ13190000
132000                         SUBTRACT  PV-TOP-ITEM                    13200000
132100                             FROM  ASC-NUMBER-OF-ITEMS-READ       13210000
132200                           GIVING  ASC-ITEMS-DISPLAYED            13220000
132300                         MOVE  ASC-NUMBER-OF-ITEMS-READ           13230000
132400                           TO  PV-BOTTOM-ITEM                     13240000
132500*                        -- BOTTOM OF LIST --                     13250000
132600                         MOVE PC-TSYMSG-00070                     13260000
132700                                   TO DP020-MSG-NUMBER            13270000
132800                         SET DP020-MSG-INFORMATIONAL              13280000
132900                                   TO TRUE                        13290000
133000                     END-IF                                       13300000
133100                 END-IF                                           13310000
133200             ELSE                                                 13320000
133300*                --- VALUE OUT OF RANGE ----                      13330000
133400                 MOVE PC-TSYMSG-00101                             13340000
133500                                   TO DP020-MSG-NUMBER            13350000
133600                 MOVE -1           TO ASTRTITL                    13360000
133700                 SET DP030-SET-CURSOR-APPL-1                      13370000
133800                                   TO TRUE                        13380000
133900                 MOVE DP015-REVERSE                               13390000
134000                                   TO ASTRTITH                    13400000
134100                 MOVE DP015-RED    TO ASTRTITC                    13410000
134200                 MOVE DP015-UNP-NUM-BRT-MDT                       13420000
134300                                   TO ASTRTITA                    13430000
134400                 SET DP020-MSG-FATAL                              13440000
134500                                   TO TRUE                        13450000
134600                 SET PS-ERROR      TO TRUE                        13460000
134700             END-IF                                               13470000
134800                                                                  13480000
134900         ELSE                                                     13490000
135000             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            13500000
135100             MOVE -1               TO ASTRTITL                    13510000
135200             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  13520000
135300             MOVE DP015-REVERSE    TO ASTRTITH                    13530000
135400             MOVE DP015-RED        TO ASTRTITC                    13540000
135500             MOVE DP015-UNP-NUM-BRT-MDT                           13550000
135600                                   TO ASTRTITA                    13560000
135700             SET DP020-MSG-FATAL   TO TRUE                        13570000
135800             SET PS-ERROR          TO TRUE                        13580000
135900         END-IF                                                   13590000
136000     END-IF.                                                      13600000
136100                                                                  13610000
136200******************************************************************13620000
136300** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **13630000
136400** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **13640000
136500******************************************************************13650000
136600 2200-MOVE-SCREEN-TO-COMMAREA.                                    13660000
136700                                                                  13670000
136800     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             13680000
136900     MOVE +1                       TO PV-SUB.                     13690000
137000*                                                                 13700000
137100     PERFORM 3100-SET-SUBSCRIPTS.                                 13710000
137200     IF  ASTRTITL > ZERO                                          13720000
137300         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          13730000
137400     ELSE                                                         13740000
137500         IF  ASTRTITF = DP015-ERASE-EOF                           13750000
137600             INITIALIZE ASC-START-ITEM-REQUEST                    13760000
137700         END-IF                                                   13770000
137800     END-IF.                                                      13780000
137900                                                                  13790000
138000     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          13800000
138100         VARYING PV-SUB                                           13810000
138200         FROM 1 BY 1                                              13820000
138300         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      13830000
138400******************************************************************13840000
138500** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**13850000
138600******************************************************************13860000
138700 2210-MOVE-LINES-TO-COMMAREA.                                     13870000
138800     SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE                 13880000
138900     MOVE SPACE        TO ASC-TEMP-SELECTED-SW                    13890000
139000                          (ASC-BLK-SUB, ASC-ITEM-SUB)             13900000
139100                                                                  13910000
139200     ADD +1                        TO ASC-ITEM-SUB.               13920000
139300                                                                  13930000
139400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        13940000
139500         ADD +1                    TO ASC-BLK-SUB                 13950000
139600         MOVE +1                   TO ASC-ITEM-SUB                13960000
139700     END-IF.                                                      13970000
139800******************************************************************13980000
139900** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      *L13990000
140000** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **14000000
140100******************************************************************14010000
140200 3000-EDIT-DATA-IN-COMMAREA.                                      14020000
140300     SET PS-NO-ERROR               TO TRUE.                       14030000
140400     PERFORM 3200-RESET-ATTRIBUTES.                               14040000
140500     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     14050000
140600                                                                  14060000
140700**                                                                14070000
140800* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              14080000
140900* EDITTING IS DONE FROM THE BOTTOM UP.                            14090000
141000**                                                                14100000
141100     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       14110000
141200         ASC-ITEMS-DISPLAYED - 1.                                 14120000
141300     PERFORM 3100-SET-SUBSCRIPTS.                                 14130000
141400*                                                                 14140000
141500     IF  PS-NO-ERROR                                              14150000
141600         PERFORM 3005-EDIT-COMMAREA-BLOCKS                        14160000
141700     END-IF.                                                      14170000
141800                                                                  14180000
141900     IF  PS-NO-ERROR                                              14190000
142000         PERFORM 3400-CHECK-RANGE-SEQUENCE                        14200000
142100     END-IF.                                                      14210000
142200*                                                                 14220000
142300     IF  ((PS-NO-ERROR)                                           14230000
142400       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   14240000
142500       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    14250000
142600             PERFORM 3500-MARK-RANGE-AS-SELECTED                  14260000
142700     END-IF.                                                      14270000
142800                                                                  14280000
142900*----------------------------------------------------------------*14290000
143000*   3005-EDIT-COMMAREA-BLOCKS                                    *14300000
143100*----------------------------------------------------------------*14310000
143200 3005-EDIT-COMMAREA-BLOCKS.                                       14320000
143300     MOVE +1                       TO PV-BLOCK-NUMBER.            14330000
143400     MOVE +1                       TO ASC-BLK-SUB.                14340000
143500     MOVE PC-ITEMS-PER-PANEL       TO ASC-ITEM-SUB.               14350000
143600                                                                  14360000
143700     COMPUTE PV-BLOCK-NUMBER  =                                   14370000
143800        1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /                 14380000
143900            PC-ITEMS-PER-PANEL.                                   14390000
144000                                                                  14400000
144100     MOVE  PV-BLOCK-NUMBER         TO PV-ORIGINAL-BLOCK.          14410000
144200                                                                  14420000
144300     PERFORM                                                      14430000
144400       UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN          14440000
144500          OR PS-ERROR                                             14450000
144600          OR PS-BLOCK-ERROR                                       14460000
144700                                                                  14470000
144800             COMPUTE PV-ITEMS-HOLD  =                             14480000
144900                     ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +        14490000
145000                     PC-ITEMS-PER-PANEL - 1                       14500000
145100                                                                  14510000
145200             IF  PV-ITEMS-HOLD  >  ASC-NUMBER-OF-ITEMS-READ       14520000
145300                 SUBTRACT  ASC-NUMBER-OF-ITEMS-READ               14530000
145400                     FROM  PV-ITEMS-HOLD                          14540000
145500                   GIVING  PV-ITEMS-DIFF                          14550000
145600                 SUBTRACT  PV-ITEMS-DIFF                          14560000
145700                     FROM  PC-ITEMS-PER-PANEL                     14570000
145800                   GIVING  PV-ITEMS-HOLD                          14580000
145900                     MOVE  PV-ITEMS-HOLD  TO  PV-SUB              14590000
146000                                              ASC-ITEM-SUB        14600000
146100                                              ASC-ITEMS-DISPLAYED 14610000
146200             ELSE                                                 14620000
146300                 MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB              14630000
146400                 MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB        14640000
146500             END-IF                                               14650000
146600                                                                  14660000
146700             PERFORM 3300-EDIT-SELECTIONS                         14670000
146800                     VARYING PV-SUB                               14680000
146900                        FROM PV-SUB BY -1                         14690000
147000                       UNTIL PV-SUB < +1                          14700000
147100                                                                  14710000
147200             MOVE +1               TO ASC-BLK-SUB                 14720000
147300                                                                  14730000
147400             PERFORM 5105-REWRITE-ASC-LISTQ                       14740000
147500                                                                  14750000
147600             MOVE +1                TO ASC-BLK-SUB                14760000
147700                                                                  14770000
147800             IF  PS-BLOCK-ERROR                                   14780000
147900                 SET  PS-ERROR     TO TRUE                        14790000
148000                 MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)        14800000
148100                                   TO PV-TOP-ITEM                 14810000
148200             ELSE                                                 14820000
148300                 ADD  +1           TO PV-BLOCK-NUMBER             14830000
148400                 IF  PV-BLOCK-NUMBER >                            14840000
148500                     ASC-HIGHEST-BLOCK-WRITTEN                    14850000
148600                     MOVE +2       TO ASC-BLK-SUB                 14860000
148700                     PERFORM 4410-READ-TEMP-STORAGE               14870000
148800                     MOVE +1       TO ASC-BLK-SUB                 14880000
148900                 ELSE                                             14890000
149000                     PERFORM 4410-READ-TEMP-STORAGE               14900000
149100                     ADD  +1        TO PV-BLOCK-NUMBER            14910000
149200                     MOVE +2        TO ASC-BLK-SUB                14920000
149300                     PERFORM 4410-READ-TEMP-STORAGE               14930000
149400                     SUBTRACT +1  FROM PV-BLOCK-NUMBER            14940000
149500                     MOVE +1        TO ASC-BLK-SUB                14950000
149600                 END-IF                                           14960000
149700             END-IF                                               14970000
149800     END-PERFORM.                                                 14980000
149900                                                                  14990000
150000     IF  PV-ORIGINAL-BLOCK  = +1    OR                            15000000
150100         PS-ERROR                   OR                            15010000
150200         PS-BLOCK-ERROR                                           15020000
150300         CONTINUE                                                 15030000
150400     ELSE                                                         15040000
150500         MOVE +1                 TO PV-BLOCK-NUMBER               15050000
150600         MOVE +1                 TO ASC-BLK-SUB                   15060000
150700         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  15070000
150800         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEMS-DISPLAYED           15080000
150900         PERFORM 4410-READ-TEMP-STORAGE                           15090000
151000                                                                  15100000
151100         PERFORM                                                  15110000
151200           UNTIL PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK              15120000
151300              OR PS-ERROR                                         15130000
151400              OR PS-BLOCK-ERROR                                   15140000
151500                                                                  15150000
151600                 COMPUTE PV-ITEMS-HOLD  =                         15160000
151700                         ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +    15170000
151800                         PC-ITEMS-PER-PANEL - 1                   15180000
151900                                                                  15190000
152000                 IF  PV-ITEMS-HOLD > ASC-NUMBER-OF-ITEMS-READ     15200000
152100                     SUBTRACT  ASC-NUMBER-OF-ITEMS-READ           15210000
152200                         FROM  PV-ITEMS-HOLD                      15220000
152300                       GIVING  PV-ITEMS-DIFF                      15230000
152400                     SUBTRACT  PV-ITEMS-DIFF                      15240000
152500                         FROM  PC-ITEMS-PER-PANEL                 15250000
152600                       GIVING  PV-ITEMS-HOLD                      15260000
152700                         MOVE  PV-ITEMS-HOLD TO PV-SUB            15270000
152800                                                ASC-ITEM-SUB      15280000
152900                                               ASC-ITEMS-DISPLAYED15290000
153000                 ELSE                                             15300000
153100                     MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB          15310000
153200                     MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB    15320000
153300                 END-IF                                           15330000
153400                                                                  15340000
153500                 PERFORM 3300-EDIT-SELECTIONS                     15350000
153600                         VARYING PV-SUB                           15360000
153700                            FROM PV-SUB BY -1                     15370000
153800                           UNTIL PV-SUB < +1                      15380000
153900                                                                  15390000
154000                 MOVE +1               TO ASC-BLK-SUB             15400000
154100                                                                  15410000
154200                 PERFORM 5105-REWRITE-ASC-LISTQ                   15420000
154300                                                                  15430000
154400                 MOVE +1                TO ASC-BLK-SUB            15440000
154500                                                                  15450000
154600                 IF  PS-BLOCK-ERROR                               15460000
154700                     SET  PS-ERROR     TO TRUE                    15470000
154800                     MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)    15480000
154900                                       TO PV-TOP-ITEM             15490000
155000                 ELSE                                             15500000
155100                     ADD  +1            TO PV-BLOCK-NUMBER        15510000
155200                     IF  PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK      15520000
155300                         MOVE +2        TO ASC-BLK-SUB            15530000
155400                         PERFORM 4410-READ-TEMP-STORAGE           15540000
155500                         MOVE +1        TO ASC-BLK-SUB            15550000
155600                     ELSE                                         15560000
155700                         PERFORM 4410-READ-TEMP-STORAGE           15570000
155800                         ADD  +1        TO PV-BLOCK-NUMBER        15580000
155900                         MOVE +2        TO ASC-BLK-SUB            15590000
156000                         PERFORM 4410-READ-TEMP-STORAGE           15600000
156100                         SUBTRACT +1  FROM PV-BLOCK-NUMBER        15610000
156200                         MOVE +1        TO ASC-BLK-SUB            15620000
156300                     END-IF                                       15630000
156400                 END-IF                                           15640000
156500     END-PERFORM.                                                 15650000
156600                                                                  15660000
156700*----------------------------------------------------------------*15670000
156800*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *15680000
156900*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*15690000
157000*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *15700000
157100*                                                                *15710000
157200*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *15720000
157300*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *15730000
157400*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *15740000
157500*    US IN THE 2ND BLOCK OF THE ARRAY.                           *15750000
157600*----------------------------------------------------------------*15760000
157700 3100-SET-SUBSCRIPTS.                                             15770000
157800                                                                  15780000
157900     COMPUTE ASC-ITEM-SUB =                                       15790000
158000         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        15800000
158100                                                                  15810000
158200     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         15820000
158300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            15830000
158400         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               15840000
158500     ELSE                                                         15850000
158600         MOVE +1                     TO ASC-BLK-SUB               15860000
158700     END-IF.                                                      15870000
158800******************************************************************15880000
158900** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **15890000
159000******************************************************************15900000
159100 3200-RESET-ATTRIBUTES.                                           15910000
159200     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   15920000
159300     MOVE DP015-GREEN              TO ASTRTITC.                   15930000
159400     MOVE DP015-UNDERLINE          TO ASTRTITH.                   15940000
159500                                                                  15950000
159600******************************************************************15960000
159700** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **15970000
159800** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **15980000
159900** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **15990000
160000** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **16000000
160100******************************************************************16010000
160200 3300-EDIT-SELECTIONS.                                            16020000
160300     EVALUATE TRUE                                                16030000
160400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     16040000
160500             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         16050000
160600                 CONTINUE                                         16060000
160700         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         16070000
160800             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        16080000
160900                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   16090000
161000                 MOVE ASC-TEMP-SELECTED-SW                        16100000
161100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16110000
161200                                TO ASC-SELECTED-SW                16120000
161300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16130000
161400             END-IF                                               16140000
161500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     16150000
161600                 = SPACE                                          16160000
161700             EVALUATE TRUE                                        16170000
161800                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       16180000
161900                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS16190000
162000                     MOVE SPACE TO ASC-SELECTED-SW                16200000
162100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16210000
162200                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        16220000
162300                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    16230000
162400                     MOVE SPACE TO ASC-SELECTED-SW                16240000
162500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16250000
162600                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          16260000
162700                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      16270000
162800                     MOVE SPACE TO ASC-SELECTED-SW                16280000
162900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16290000
163000             END-EVALUATE                                         16300000
163100         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           16310000
163200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            16320000
163300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    16330000
163400             END-IF                                               16340000
163500             PERFORM 3310-EDIT-RANGE                              16350000
163600         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             16360000
163700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            16370000
163800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    16380000
163900             END-IF                                               16390000
164000             PERFORM 3310-EDIT-RANGE                              16400000
164100         WHEN OTHER                                               16410000
164200             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           16420000
164300             SET DP020-MSG-FATAL    TO TRUE                       16430000
164400             MOVE -1                TO ASTRTITL                   16440000
164500             SET DP030-SET-CURSOR-APPL-1                          16450000
164600                                    TO TRUE                       16460000
164700             SET PS-ERROR TO TRUE                                 16470000
164800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            16480000
164900                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     16490000
165000                 MOVE SPACE         TO ASC-SELECTED-SW            16500000
165100                                        (ASC-BLK-SUB ASC-ITEM-SUB)16510000
165200             END-IF                                               16520000
165300     END-EVALUATE.                                                16530000
165400                                                                  16540000
165500     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 16550000
165600     SUBTRACT +1 FROM ASC-ITEM-SUB.                               16560000
165700     IF  ASC-ITEM-SUB < 1                                         16570000
165800         SUBTRACT +1 FROM ASC-BLK-SUB                             16580000
165900         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                16590000
166000     END-IF.                                                      16600000
166100                                                                  16610000
166200******************************************************************16620000
166300** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **16630000
166400** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **16640000
166500** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**16650000
166600** THE ENDING.                                                  **16660000
166700******************************************************************16670000
166800 3310-EDIT-RANGE.                                                 16680000
166900     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                16690000
167000         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   16700000
167100             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)16710000
167200                                   TO ASC-SELECTED-SW             16720000
167300                                        (ASC-BLK-SUB ASC-ITEM-SUB)16730000
167400             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 16740000
167500         ELSE                                                     16750000
167600             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     16760000
167700                 CONTINUE                                         16770000
167800             ELSE                                                 16780000
167900*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        16790000
168000                 MOVE PC-TSYMSG-00054                             16800000
168100                                       TO DP020-MSG-NUMBER        16810000
168200                 MOVE -1               TO ASTRTITL                16820000
168300                 SET DP020-MSG-FATAL                              16830000
168400                     DP030-SET-CURSOR-APPL-1                      16840000
168500                     PS-ERROR          TO TRUE                    16850000
168600             END-IF                                               16860000
168700         END-IF                                                   16870000
168800     ELSE                                                         16880000
168900         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     16890000
169000             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 16900000
169100                                   TO ASC-SELECTED-SW             16910000
169200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   16920000
169300             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   16930000
169400         ELSE                                                     16940000
169500             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       16950000
169600                 CONTINUE                                         16960000
169700             ELSE                                                 16970000
169800*                -- ONLY ONE END-OF-RANGE ALLOWED --              16980000
169900                 MOVE PC-TSYMSG-00055                             16990000
170000                                        TO DP020-MSG-NUMBER       17000000
170100                 MOVE -1                TO ASTRTITL               17010000
170200                 SET DP020-MSG-FATAL                              17020000
170300                     DP030-SET-CURSOR-APPL-1                      17030000
170400                     PS-ERROR           TO TRUE                   17040000
170500             END-IF                                               17050000
170600         END-IF                                                   17060000
170700     END-IF.                                                      17070000
170800*                                                                 17080000
170900******************************************************************17090000
171000** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **17100000
171100** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **17110000
171200******************************************************************17120000
171300 3400-CHECK-RANGE-SEQUENCE.                                       17130000
171400     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       17140000
171500       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      17150000
171600       AND  ASC-START-OF-SELECTED-RANGE >                         17160000
171700                                         ASC-END-OF-SELECTED-RANGE17170000
171800*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                17180000
171900         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 17190000
172000         SET DP020-MSG-FATAL TO TRUE                              17200000
172100         SET PS-ERROR TO TRUE                                     17210000
172200         PERFORM 3410-POSITION-AT-ERROR                           17220000
172300     END-IF.                                                      17230000
172400******************************************************************17240000
172500** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **17250000
172600** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **17260000
172700** SHOULD BE POSITIONED ON A RANGE ERROR.                       **17270000
172800******************************************************************17280000
172900 3410-POSITION-AT-ERROR.                                          17290000
173000     SET DP030-SET-CURSOR-APPL-1                                  17300000
173100                                   TO TRUE.                       17310000
173200     MOVE -1                       TO ASTRTITL                    17320000
173300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 17330000
173400                    - PV-TOP-ITEM + 1.                            17340000
173500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      17350000
173600         CONTINUE                                                 17360000
173700     END-IF.                                                      17370000
173800*                                                                 17380000
173900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   17390000
174000                    - PV-TOP-ITEM + 1.                            17400000
174100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      17410000
174200         CONTINUE                                                 17420000
174300     END-IF.                                                      17430000
174400                                                                  17440000
174500*----------------------------------------------------------------*17450000
174600*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *17460000
174700*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *17470000
174800*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *17480000
174900*----------------------------------------------------------------*17490000
175000 3500-MARK-RANGE-AS-SELECTED.                                     17500000
175100     MOVE +1                       TO  ASC-BLK-SUB.               17510000
175200     PERFORM 3510-MARK-SELECTED-INDS                              17520000
175300         VARYING ASC-ITEM-SUB                                     17530000
175400         FROM 1 BY 1                                              17540000
175500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17550000
175600                                                                  17560000
175700     ADD +1                        TO ASC-BLK-SUB.                17570000
175800     PERFORM 3510-MARK-SELECTED-INDS                              17580000
175900         VARYING ASC-ITEM-SUB                                     17590000
176000         FROM 1 BY 1                                              17600000
176100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17610000
176200                                                                  17620000
176300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               17630000
176400                                   TO  PV-LIST-ITEM-NUMBER.       17640000
176500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            17650000
176600         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         17660000
176700               PC-ITEMS-PER-PANEL).                               17670000
176800                                                                  17680000
176900     MOVE ASC-START-OF-SELECTED-RANGE                             17690000
177000                                   TO PV-START-OF-SELECTED-RANGE. 17700000
177100     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            17710000
177200         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  17720000
177300               PC-ITEMS-PER-PANEL).                               17730000
177400                                                                  17740000
177500     MOVE ASC-END-OF-SELECTED-RANGE                               17750000
177600                                   TO  PV-END-OF-SELECTED-RANGE.  17760000
177700     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             17770000
177800         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    17780000
177900               PC-ITEMS-PER-PANEL).                               17790000
178000     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             17800000
178100         PV-FIRST-BLOCK-IN-ARRAY + 1.                             17810000
178200                                                                  17820000
178300     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    17830000
178400        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        17840000
178500         MOVE +1                   TO ASC-BLK-SUB                 17850000
178600         PERFORM 5100-WRITE-TEMP-STORAGE                          17860000
178700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         17870000
178800             PV-FIRST-BLOCK-IN-ARRAY - 1                          17880000
178900                                                                  17890000
179000         PERFORM                                                  17900000
179100             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      17910000
179200                   PV-PREV-BLOCK-IN-ARRAY                         17920000
179300             MOVE PV-FIRST-BLOCK-IN-RANGE                         17930000
179400                                   TO PV-BLOCK-NUMBER             17940000
179500             PERFORM 4410-READ-TEMP-STORAGE                       17950000
179600             PERFORM 3510-MARK-SELECTED-INDS                      17960000
179700                 VARYING ASC-ITEM-SUB                             17970000
179800                 FROM 1 BY 1                                      17980000
179900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17990000
180000             PERFORM 5100-WRITE-TEMP-STORAGE                      18000000
180100             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     18010000
180200         END-PERFORM                                              18020000
180300                                                                  18030000
180400         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         18040000
180500             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     18050000
180600         PERFORM                                                  18060000
180700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       18070000
180800                   PV-LAST-BLOCK-IN-RANGE                         18080000
180900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          18090000
181000                                   TO PV-BLOCK-NUMBER             18100000
181100             PERFORM 4410-READ-TEMP-STORAGE                       18110000
181200             PERFORM 3510-MARK-SELECTED-INDS                      18120000
181300                 VARYING ASC-ITEM-SUB                             18130000
181400                 FROM 1 BY 1                                      18140000
181500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18150000
181600             PERFORM 5100-WRITE-TEMP-STORAGE                      18160000
181700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      18170000
181800         END-PERFORM                                              18180000
181900                                                                  18190000
182000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             18200000
182100                                   TO PV-BLOCK-NUMBER             18210000
182200         PERFORM 4410-READ-TEMP-STORAGE                           18220000
182300     END-IF.                                                      18230000
182400                                                                  18240000
182500     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 18250000
182600                                      ASC-END-OF-SELECTED-RANGE.  18260000
182700                                                                  18270000
182800*----------------------------------------------------------------*18280000
182900* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *18290000
183000*----------------------------------------------------------------*18300000
183100 3510-MARK-SELECTED-INDS.                                         18310000
183200                                                                  18320000
183300     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         18330000
183400                                ASC-ITEM-SUB) >                   18340000
183500         ASC-START-OF-SELECTED-RANGE)                             18350000
183600     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         18360000
183700                                ASC-ITEM-SUB) =                   18370000
183800         ASC-START-OF-SELECTED-RANGE)                             18380000
183900                                                                  18390000
184000         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     18400000
184100                                    ASC-ITEM-SUB) <               18410000
184200             ASC-END-OF-SELECTED-RANGE)                           18420000
184300         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     18430000
184400                                    ASC-ITEM-SUB) =               18440000
184500             ASC-END-OF-SELECTED-RANGE)                           18450000
184600                                                                  18460000
184700             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          18470000
184800                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   18480000
184900                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   18490000
185000                               TO TRUE                            18500000
185100                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              18510000
185200                               TO TRUE                            18520000
185300                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    18530000
185400             END-IF                                               18540000
185500         END-IF                                                   18550000
185600     END-IF.                                                      18560000
185700                                                                  18570000
185800*----------------------------------------------------------------*18580000
185900*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *18590000
186000*    INITIALIZE ALL COUNTERS AND FLAGS.                          *18600000
186100*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *18610000
186200*    DISPLAY THE PANEL TO USER.                                  *18620000
186300*----------------------------------------------------------------*18630000
186400 4000-BUILD-INITIAL-PANEL.                                        18640000
186500                                                                  18650000
186600     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            18660000
186700                                 ASC-BLOCK-ENTRIES (2).           18670000
186800     MOVE +1                 TO ASC-BLK-SUB.                      18680000
186900     SET ASC-ITEMS-LEFT-ON-DB                                     18690000
187000                             TO TRUE.                             18700000
187100                                                                  18710000
187200     MOVE +0                 TO ASC-ITEM-SUB                      18720000
187300                                ASC-NUMBER-OF-ITEMS-READ          18730000
187400                                ASC-NUMBER-OF-SELECTED-ITEMS      18740000
187500                                ASC-HIGHEST-BLOCK-WRITTEN         18750000
187600                                ASC-START-OF-SELECTED-RANGE       18760000
187700                                ASC-END-OF-SELECTED-RANGE         18770000
187800                                ASC-ITEM-AT-TOP-OF-PANEL          18780000
187900                                PV-TTL-STORE-EXPECT               18790000
188000                                PV-TTL-INTRNST-QTY                18800000
188100                                PV-TTL-STORE-ON-HAND              18810000
188200                                PV-TTL-ONHAND-QTY                 18820000
188300                                ASC-TTL-FASHION                   18830000
188400                                ASC-TTL-INTRNST                   18840000
188500                                ASC-TTL-STR-EXPECT                18850000
188600                                ASC-TTL-STR-ON-HAND.              18860000
188700                                                                  18870000
188800     MOVE ASC-STR-NBR        TO DK-STR-NBR.                       18880000
188900     MOVE ASC-PO             TO DK-PO.                            18890000
189000     MOVE ASC-RCVR           TO DK-RCVR.                          18900000
189100     INITIALIZE XL001-ITEM-COMMAREA.                              18910000
189200     SET XL001-BY-NUMERIC-SKU TO TRUE.                            18920000
189300     SET XL001-SELECT-SKU     TO TRUE.                            18930000
189400     MOVE ASC-SKU             TO XL001-KEY-SKU.                   18940000
189500                                                                  18950000
189600     CALL PC-XL001-VSM-PGM USING DFHEIBLK                         18960000
189700                                 XL001-COMMAREA                   18970000
189800                                 XL001-ITEM-COMMAREA.             18980000
189900                                                                  18990000
190000     IF XL001-SUCCESSFUL                                          19000000
190100             MOVE XL001-SKU-DESC    TO ASC-SKU-DESC               19010000
190200             MOVE XL001-INTR-UPC-ID TO ASC-UPC-ID                 19020000
190300                                       DK-UPC-ID                  19030000
190400     END-IF.                                                      19040000
190500                                                                  19050000
190600     PERFORM 4005-GET-STR-LONG-NAME.                              19060000
190700                                                                  19070000
190800     PERFORM 4010-OPEN-CURSOR.                                    19080000
190900     PERFORM 4300-READ-ITEMS-FROM-DB.                             19090000
191000     PERFORM 4020-CLOSE-CURSOR.                                   19100000
191100                                                                  19110000
191200     MOVE +1                   TO  PV-TOP-ITEM.                   19120000
191300*    IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          19130000
191400*        SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    19140000
191500*        SET DP020-MSG-FATAL   TO  TRUE                           19150000
191600*        MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               19160000
191700*    ELSE                                                         19170000
191800         MOVE -1               TO ASTRTITL                        19180000
191900         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      19190000
192000         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                    19200000
192100*    END-IF.                                                      19210000
192200                                                                  19220000
192300*----------------------------------------------------------------*19230000
192400 4005-GET-STR-LONG-NAME.                                          19240000
192500                                                                  19250000
192600     EXEC SQL                                                     19260000
192700          SELECT  LOC_NM                                          19270000
192800            INTO :XLT00010-LOC-NM                                 19280000
192900            FROM  XLT_LOC                                         19290000
193000           WHERE  LOC_NBR  =  :DK-STR-NBR                         19300000
193100     END-EXEC                                                     19310000
193200                                                                  19320000
193300                                                                  19330000
193400     EVALUATE TRUE                                                19340000
193500         WHEN SQLCODE = ZERO                                      19350000
193600              MOVE  XLT00010-LOC-NM  TO ASC-STORE-NAME            19360000
193700                                                                  19370000
193800         WHEN SQLCODE = +100                                      19380000
193900              CONTINUE                                            19390000
194000                                                                  19400000
194100         WHEN SQLWARN0 NOT = SPACE                                19410000
194200         WHEN SQLCODE NOT = ZERO                                  19420000
194300              MOVE '4005-GET-STR-LONG-NAME' TO DP013-PARAGRAPH    19430000
194400              MOVE 'LONG STORE NAME      '                        19440000
194500                               TO DP013-MESSAGE-TEXT (1)          19450000
194600              MOVE ASC-STORE-NAME                                 19460000
194700                               TO DP013-MESSAGE-TEXT (2)          19470000
194800              MOVE SQLCA       TO DP013-SQLCA                     19480000
194900              MOVE 'XLT_LOC'          TO                          19490000
195000                                   DP013-DB2-TABLE-NAME (1)       19500000
195100              SET DP013-DB2-ABEND TO TRUE                         19510000
195200              PERFORM DP013-0000-PROCESS-ABEND                    19520000
195300     END-EVALUATE.                                                19530000
195400                                                                  19540000
195500                                                                  19550000
195600*----------------------------------------------------------------*19560000
195700* OPEN THE CURSOR                                                 19570000
195800*----------------------------------------------------------------*19580000
195900 4010-OPEN-CURSOR.                                                19590000
196000     PERFORM                                                      19600000
196100         WITH TEST AFTER                                          19610000
196200         VARYING PV-RETRY-COUNTER                                 19620000
196300         FROM 1 BY 1                                              19630000
196400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               19640000
196500                   OR (SQLCODE = ZERO))                           19650000
196600                                                                  19660000
196700         EVALUATE TRUE                                            19670000
196800             WHEN ASC-DISP-INTR AND                               19680000
196900                  DP020-INT-APPL-FORMAT-IND = PC-PORCVR-FORMAT    19690000
197000                  EXEC SQL                                        19700000
197100                       OPEN PORCVR-INTR-CSR                       19710000
197200                  END-EXEC                                        19720000
197300                                                                  19730000
197400             WHEN ASC-DISP-STR-EXPT AND                           19740000
197500                  DP020-INT-APPL-FORMAT-IND = PC-PORCVR-FORMAT    19750000
197600                  EXEC SQL                                        19760000
197700                       OPEN PORCVR-STR-EXP-CSR                    19770000
197800                  END-EXEC                                        19780000
197900                                                                  19790000
198000             WHEN ASC-DISP-INTR                                   19800000
198100                  EXEC SQL                                        19810000
198200                       OPEN INTRANSIT-CSR                         19820000
198300                  END-EXEC                                        19830000
198400                                                                  19840000
198500             WHEN ASC-DISP-STR-EXPT                               19850000
198600                  EXEC SQL                                        19860000
198700                       OPEN STR-EXPECTED-CSR                      19870000
198800                  END-EXEC                                        19880000
198900                                                                  19890000
199000             WHEN ASC-DISP-INTR-PORCVR                            19900000
199100                  EXEC SQL                                        19910000
199200                       OPEN INTR-PORCVR-CSR                       19920000
199300                  END-EXEC                                        19930000
199400                                                                  19940000
199500             WHEN ASC-DISP-STR-EXPT-PORCVR                        19950000
199600                  EXEC SQL                                        19960000
199700                       OPEN STR-EXP-PORCVR-CSR                    19970000
199800                  END-EXEC                                        19980000
199900         END-EVALUATE                                             19990000
200000                                                                  20000000
200100         EVALUATE TRUE                                            20010000
200200             WHEN SQLCODE = ZERO                                  20020000
200300             WHEN SQLCODE = -904                                  20030000
200400             WHEN SQLCODE = -913                                  20040000
200500                 CONTINUE                                         20050000
200600             WHEN SQLWARN0 NOT = SPACES                           20060000
200700             WHEN SQLCODE < ZERO                                  20070000
200800             WHEN SQLCODE > ZERO                                  20080000
200900                 MOVE '4010-OPEN-CURSOR' TO DP013-PARAGRAPH       20090000
201000                 MOVE 'OPEN CURSOR PROBLEM    - '                 20100000
201100                                   TO DP013-MESSAGE-TEXT (1)      20110000
201200                 MOVE SQLCA        TO DP013-SQLCA                 20120000
201300                 MOVE 'PCT_TRN_CLSN_DTL' TO                       20130000
201400                                      DP013-DB2-TABLE-NAME (1)    20140000
201500                 SET DP013-DB2-ABEND                              20150000
201600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           20160000
201700                 PERFORM DP013-0000-PROCESS-ABEND                 20170000
201800         END-EVALUATE                                             20180000
201900     END-PERFORM.                                                 20190000
202000*                                                                 20200000
202100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        20210000
202200         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             20220000
202300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   20230000
202400                                   TO DP013-MESSAGE-TEXT (1)      20240000
202500         MOVE SQLCA                TO DP013-SQLCA                 20250000
202600         MOVE 'PCT_TRN_CLSN_DTL'   TO DP013-DB2-TABLE-NAME (1)    20260000
202700         SET DP013-DB2-ABEND                                      20270000
202800             DP013-XCTL-DISPLAY-RESTART TO TRUE                   20280000
202900         PERFORM DP013-0000-PROCESS-ABEND                         20290000
203000     END-IF.                                                      20300000
203100                                                                  20310000
203200*----------------------------------------------------------------*20320000
203300* CLOSE THE CURSOR.                                               20330000
203400*----------------------------------------------------------------*20340000
203500 4020-CLOSE-CURSOR.                                               20350000
203600                                                                  20360000
203700     EVALUATE TRUE                                                20370000
203800         WHEN ASC-DISP-INTR AND                                   20380000
203900              DP020-INT-APPL-FORMAT-IND = PC-PORCVR-FORMAT        20390000
204000              EXEC SQL                                            20400000
204100                   CLOSE PORCVR-INTR-CSR                          20410000
204200              END-EXEC                                            20420000
204300                                                                  20430000
204400         WHEN ASC-DISP-STR-EXPT  AND                              20440000
204500              DP020-INT-APPL-FORMAT-IND = PC-PORCVR-FORMAT        20450000
204600              EXEC SQL                                            20460000
204700                   CLOSE PORCVR-STR-EXP-CSR                       20470000
204800              END-EXEC                                            20480000
204900                                                                  20490000
205000         WHEN ASC-DISP-INTR                                       20500000
205100              EXEC SQL                                            20510000
205200                   CLOSE INTRANSIT-CSR                            20520000
205300              END-EXEC                                            20530000
205400                                                                  20540000
205500         WHEN ASC-DISP-STR-EXPT                                   20550000
205600              EXEC SQL                                            20560000
205700                   CLOSE STR-EXPECTED-CSR                         20570000
205800              END-EXEC                                            20580000
205900                                                                  20590000
206000         WHEN ASC-DISP-INTR-PORCVR                                20600000
206100              EXEC SQL                                            20610000
206200                   CLOSE INTR-PORCVR-CSR                          20620000
206300              END-EXEC                                            20630000
206400                                                                  20640000
206500         WHEN ASC-DISP-STR-EXPT                                   20650000
206600              EXEC SQL                                            20660000
206700                   CLOSE STR-EXPECTED-CSR                         20670000
206800              END-EXEC                                            20680000
206900     END-EVALUATE.                                                20690000
207000                                                                  20700000
207100     EVALUATE TRUE                                                20710000
207200         WHEN SQLCODE = ZERO                                      20720000
207300         WHEN SQLCODE = +100                                      20730000
207400             CONTINUE                                             20740000
207500         WHEN SQLWARN0 NOT = SPACES                               20750000
207600         WHEN SQLCODE < ZERO                                      20760000
207700         WHEN SQLCODE > ZERO                                      20770000
207800             MOVE '4020-CLOSE-CURSOR' TO DP013-PARAGRAPH          20780000
207900             MOVE 'CLOSE CURSOR PROBLEM   '                       20790000
208000                               TO DP013-MESSAGE-TEXT (1)          20800000
208100             MOVE SQLCA        TO DP013-SQLCA                     20810000
208200             MOVE 'PCT_TRN_CLSN_DTL' TO                           20820000
208300                                  DP013-DB2-TABLE-NAME (1)        20830000
208400             SET DP013-DB2-ABEND                                  20840000
208500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               20850000
208600             PERFORM DP013-0000-PROCESS-ABEND                     20860000
208700     END-EVALUATE.                                                20870000
208800                                                                  20880000
208900*----------------------------------------------------------------*20890000
209000*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *20900000
209100*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *20910000
209200*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *20920000
209300*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *20930000
209400*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *20940000
209500*                                                                *20950000
209600*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *20960000
209700*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *20970000
209800*    UPON INITIALIZATION.                                        *20980000
209900*----------------------------------------------------------------*20990000
210000 4300-READ-ITEMS-FROM-DB.                                         21000000
210100                                                                  21010000
210200     PERFORM                                                      21020000
210300         VARYING PV-READ-COUNT                                    21030000
210400         FROM 1 BY 1                                              21040000
210500         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    21050000
210600            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         21060000
210700                                                                  21070000
210800         PERFORM 4310-FETCH                                       21080000
210900                                                                  21090000
211000         IF  ASC-ITEMS-LEFT-ON-DB                                 21100000
211100             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                21110000
211200                 ADD +1            TO ASC-ITEM-SUB                21120000
211300             ELSE                                                 21130000
211400                 ADD +1            TO ASC-BLK-SUB                 21140000
211500                 MOVE +1           TO ASC-ITEM-SUB                21150000
211600                                                                  21160000
211700                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         21170000
211800                     MOVE +1       TO ASC-BLK-SUB                 21180000
211900                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           21190000
212000                     PERFORM 5100-WRITE-TEMP-STORAGE              21200000
212100                     MOVE ASC-BLOCK-ENTRIES                       21210000
212200                                   (PC-MAX-BLOCKS-IN-ARRAY)       21220000
212300                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 21230000
212400                     ADD +1        TO ASC-BLK-SUB                 21240000
212500                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   21250000
212600                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      21260000
212700                                                          TO TRUE 21270000
212800                 END-IF                                           21280000
212900             END-IF                                               21290000
213000             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    21300000
213100             SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE          21310000
213200             MOVE ASC-NUMBER-OF-ITEMS-READ                        21320000
213300                                   TO ASC-LIST-ITEM-NUMBER        21330000
213400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  21340000
213500             MOVE PCT00015-IN-TRNST-TRN-TMST TO PV-TMST           21350000
213600             MOVE PV-TMST-CCYY  TO  PV-DISPLAY-CCYY               21360000
213700             MOVE PV-TMST-MM    TO  PV-DISPLAY-MM                 21370000
213800             MOVE PV-TMST-DD    TO  PV-DISPLAY-DD                 21380000
213900             MOVE PV-DATE-DISPLAY                                 21390000
214000                        TO ASC-TRANDATE (ASC-BLK-SUB ASC-ITEM-SUB)21400000
214100             EVALUATE PCT00015-TRN-TYP-CDE                        21410000
214200                 WHEN PC-UN                                       21420000
214300                     MOVE PC-UNLOAD                               21430000
214400                      TO ASC-TYPEDESC (ASC-BLK-SUB ASC-ITEM-SUB)  21440000
214500                 WHEN PC-SH                                       21450000
214600                     MOVE PC-SHIPPD                               21460000
214700                      TO ASC-TYPEDESC (ASC-BLK-SUB ASC-ITEM-SUB)  21470000
214800                 WHEN PC-RA                                       21480000
214900                     MOVE PC-RECEIPT                              21490000
215000                      TO ASC-TYPEDESC (ASC-BLK-SUB ASC-ITEM-SUB)  21500000
215100                 WHEN PC-AR                                       21510000
215200                     MOVE PC-ACTUAL                               21520000
215300                      TO ASC-TYPEDESC (ASC-BLK-SUB ASC-ITEM-SUB)  21530000
215400                 WHEN PC-VA                                       21540000
215500                     MOVE PC-VERIFD                               21550000
215600                      TO ASC-TYPEDESC (ASC-BLK-SUB ASC-ITEM-SUB)  21560000
215700                 WHEN PC-OA                                       21570000
215800                     MOVE PC-ONHAND                               21580000
215900                      TO ASC-TYPEDESC (ASC-BLK-SUB ASC-ITEM-SUB)  21590000
216000                 WHEN PC-ST                                       21600000
216100                     MOVE PC-SKUTRN                               21610000
216200                      TO ASC-TYPEDESC (ASC-BLK-SUB ASC-ITEM-SUB)  21620000
216300                 WHEN PC-IA                                       21630000
216400                     MOVE PC-INTRNS                               21640000
216500                      TO ASC-TYPEDESC (ASC-BLK-SUB ASC-ITEM-SUB)  21650000
216600                 WHEN PC-CS                                       21660000
216700                     MOVE PC-CNTLSTK                              21670000
216800                      TO ASC-TYPEDESC (ASC-BLK-SUB ASC-ITEM-SUB)  21680000
216900                 WHEN PC-CL                                       21690000
217000                     MOVE PC-CLEANUP                              21700000
217100                      TO ASC-TYPEDESC (ASC-BLK-SUB ASC-ITEM-SUB)  21710000
217200                 WHEN PC-SA                                       21720000
217300                     MOVE PC-STREXP                               21730000
217400                      TO ASC-TYPEDESC (ASC-BLK-SUB ASC-ITEM-SUB)  21740000
217500                 WHEN PC-UM                                       21750002
217600                     MOVE PC-UNMEMO                               21760002
217700                      TO ASC-TYPEDESC (ASC-BLK-SUB ASC-ITEM-SUB)  21770002
217800                     MOVE PC-MEMO                                 21780051
217900                         TO ASC-USERID (ASC-BLK-SUB ASC-ITEM-SUB) 21790051
218000                 WHEN PC-AU                                       21800045
218100                     MOVE PC-ASMUNLD                              21810045
218200                      TO ASC-TYPEDESC (ASC-BLK-SUB ASC-ITEM-SUB)  21820045
218300                 WHEN PC-NS                                       21830045
218400                     MOVE PC-NOTSCAN                              21840045
218500                      TO ASC-TYPEDESC (ASC-BLK-SUB ASC-ITEM-SUB)  21850045
218600                     MOVE PC-MEMO                                 21860051
218700                         TO ASC-USERID (ASC-BLK-SUB ASC-ITEM-SUB) 21870051
218800                 WHEN PC-MM                                       21880045
218900                     PERFORM 4600-DETERMINE-MISLOAD-STR           21890039
219000                     MOVE 'MISMEM'  TO PV-TYPE-DESCRIP            21900038
219100                     MOVE PV-TYPE-DESC                            21910045
219200                      TO ASC-TYPEDESC (ASC-BLK-SUB ASC-ITEM-SUB)  21920045
219300                     MOVE PC-MEMO                                 21930051
219400                         TO ASC-USERID (ASC-BLK-SUB ASC-ITEM-SUB) 21940051
219500                 WHEN PC-MU                                       21950045
219600                     PERFORM 4700-DETERMINE-EXPCTD-STR            21960043
219700                     MOVE 'MISUNL'  TO PV-TYPE-DESCRIP            21970039
219800                     MOVE PV-TYPE-DESC                            21980045
219900                      TO ASC-TYPEDESC (ASC-BLK-SUB ASC-ITEM-SUB)  21990045
220000                 WHEN PC-AM                                       22000045
220100                     MOVE PC-ASMPTMEMO                            22010045
220200                      TO ASC-TYPEDESC (ASC-BLK-SUB ASC-ITEM-SUB)  22020045
220300                     MOVE PC-MEMO                                 22030051
220400                         TO ASC-USERID (ASC-BLK-SUB ASC-ITEM-SUB) 22040051
220500                 WHEN PC-SM                                       22050045
220600                     PERFORM 4700-DETERMINE-EXPCTD-STR            22060049
220700                                                                  22070047
220800                     MOVE PC-UNLMEM TO PV-TYPE-DESCRIP            22080048
220900                     MOVE PV-TYPE-DESC                            22090045
221000                      TO ASC-TYPEDESC (ASC-BLK-SUB ASC-ITEM-SUB)  22100045
221100                     MOVE PC-MEMO                                 22110051
221200                         TO ASC-USERID (ASC-BLK-SUB ASC-ITEM-SUB) 22120051
221300                                                                  22130044
221400                 WHEN OTHER                                       22140002
221500                     MOVE PCT00015-TRN-TYP-CDE                    22150000
221600                      TO ASC-TYPEDESC (ASC-BLK-SUB ASC-ITEM-SUB)  22160000
221700             END-EVALUATE                                         22170000
221800             EVALUATE PCT00015-TRN-TYP-CDE                        22180000
221900                 WHEN PC-CS                                       22190000
222000                      MOVE PCT00015-PO-NBR   TO DK-PO-TRN-NBR     22200086
222100                      MOVE DK-TRN-NBR-X      TO DK-TRN-NBR-9      22210099
222200                      MOVE ZEROES            TO DK-PO-RCVR-NBR-N  22220099
222300                      MOVE DK-RCVR-NBR-X     TO DK-RCVR-NBR-9     22230099
222400                      MOVE DK-RCVR-NBR-3     TO DK-RCVR-NBR       22240099
222500                      MOVE DK-TRN-NBR-9      TO DK-TRN-NBR        22250099
222610                      MOVE DK-PO-RCVR        TO                   22261099
222620                           ASC-PO-RCVR (ASC-BLK-SUB ASC-ITEM-SUB) 22262099
222700                                                                  22270094
222800                 WHEN OTHER                                       22280000
222900                      MOVE SPACES            TO PV-DISP-PO-RCVR   22290099
223000                      MOVE PCT00015-PO-NBR   TO DK-PO-TRN-NBR     22300086
223100                      MOVE DK-TRN-NBR-X      TO DK-TRN-NBR        22310099
223200**                  IF BOSS RECEIVER DISPLAY 'BSS'                22320099
223300                      IF PCT00015-RCVR-SEQ-NBR =                  22330099
223400                                                ASC-PARM-BOSS-RECV22340099
223500                         MOVE DK-TRN-NBR-X   TO PDPR-TRN-NBR      22350099
223600                         MOVE PC-DASH        TO PDPR-HYPHEN       22360099
223700                         MOVE 'BSS'          TO PDPR-RCVR-NBR     22370099
223800                         MOVE PV-DISP-PO-RCVR TO                  22380099
223900                            ASC-PO-RCVR (ASC-BLK-SUB ASC-ITEM-SUB)22390099
224000                      ELSE                                        22400099
224100                         MOVE PCT00015-RCVR-SEQ-NBR               22410086
224200                                             TO DK-PO-RCVR-NBR-N  22420086
224300                         MOVE DK-RCVR-NBR-X  TO DK-RCVR-NBR-9     22430086
224400                         MOVE DK-RCVR-NBR-3  TO DK-RCVR-NBR       22440086
224500                         MOVE DK-PO-RCVR     TO                   22450086
224600                            ASC-PO-RCVR (ASC-BLK-SUB ASC-ITEM-SUB)22460086
224700                      END-IF                                      22470099
224800             END-EVALUATE                                         22480000
224900                                                                  22490000
225000             MOVE PCT00015-TRN-CLSN-PRCG-QTY                      22500000
225100                         TO ASC-TRNQTY (ASC-BLK-SUB ASC-ITEM-SUB) 22510000
225200             MOVE PCT00015-TRN-CLSN-BAL-QTY                       22520000
225300                         TO ASC-BALQTY (ASC-BLK-SUB ASC-ITEM-SUB) 22530000
225400             MOVE PCT00015-OTBND-TRIP-ID                          22540000
225500                        TO ASC-OUTTRIP (ASC-BLK-SUB ASC-ITEM-SUB) 22550000
225600             MOVE PCT00015-UPD-USR-ID  TO  PV-USER-ID             22560000
225700             IF  ( PV-TK-USER-ID ) OR                             22570051
225800                 ( PV-USER-ID = 'PCKUT083' )                      22580000
225900                 MOVE PCT00015-UPD-USR-ID                         22590000
226000                         TO ASC-USERID (ASC-BLK-SUB ASC-ITEM-SUB) 22600000
226100             ELSE                                                 22610056
226200                 IF ASC-USERID (ASC-BLK-SUB ASC-ITEM-SUB)         22620056
226300                              = PC-MEMO                           22630056
226400                    CONTINUE                                      22640056
226500                 ELSE                                             22650056
226600                    MOVE SPACES                                   22660056
226700                         TO ASC-USERID (ASC-BLK-SUB ASC-ITEM-SUB) 22670000
226800                 END-IF                                           22680056
226900             END-IF                                               22690056
227000         END-IF                                                   22700000
227100     END-PERFORM.                                                 22710000
227200                                                                  22720000
227300     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          22730000
227400         MOVE +1               TO ASC-BLK-SUB                     22740000
227500         PERFORM 5100-WRITE-TEMP-STORAGE                          22750000
227600         ADD +1                TO ASC-BLK-SUB                     22760000
227700         PERFORM 5100-WRITE-TEMP-STORAGE                          22770000
227800                                                                  22780000
227900         MOVE 1                TO ASC-BLK-SUB                     22790000
228000                                  PV-BLOCK-NUMBER                 22800000
228100         PERFORM 4410-READ-TEMP-STORAGE                           22810000
228200         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             22820000
228300             MOVE 2            TO ASC-BLK-SUB                     22830000
228400                                  PV-BLOCK-NUMBER                 22840000
228500             PERFORM 4410-READ-TEMP-STORAGE                       22850000
228600         END-IF                                                   22860000
228700     END-IF.                                                      22870000
228800                                                                  22880000
228900*----------------------------------------------------------------*22890000
229000*    FETCH THE CURSOR                                             22900000
229100*----------------------------------------------------------------*22910000
229200 4310-FETCH.                                                      22920000
229300                                                                  22930000
229400     INITIALIZE DCLPCT00015.                                      22940000
229500                                                                  22950000
229600     EVALUATE TRUE                                                22960000
229700                                                                  22970000
229800         WHEN ASC-DISP-INTR AND                                   22980000
229900              DP020-INT-APPL-FORMAT-IND = PC-PORCVR-FORMAT        22990000
230000              EXEC SQL                                            23000000
230100                   FETCH PORCVR-INTR-CSR                          23010000
230200                    INTO  :PCT00015-IN-TRNST-TRN-TMST             23020000
230300                         ,:PCT00015-TRN-TYP-CDE                   23030000
230400                         ,:PCT00015-TRN-CLSN-PRCG-QTY             23040000
230500                         ,:PCT00015-TRN-CLSN-BAL-QTY              23050000
230600                         ,:PCT00015-UPD-USR-ID                    23060000
230700                         ,:PCT00015-PO-NBR                        23070000
230800                         ,:PCT00015-RCVR-SEQ-NBR                  23080000
230900                         ,:PCT00015-OTBND-TRIP-ID                 23090000
231000              END-EXEC                                            23100000
231100                                                                  23110000
231200         WHEN ASC-DISP-STR-EXPT  AND                              23120000
231300              DP020-INT-APPL-FORMAT-IND = PC-PORCVR-FORMAT        23130000
231400              EXEC SQL                                            23140000
231500                   FETCH PORCVR-STR-EXP-CSR                       23150000
231600                    INTO  :PCT00015-IN-TRNST-TRN-TMST             23160000
231700                         ,:PCT00015-TRN-TYP-CDE                   23170000
231800                         ,:PCT00015-TRN-CLSN-PRCG-QTY             23180000
231900                         ,:PCT00015-TRN-CLSN-BAL-QTY              23190000
232000                         ,:PCT00015-UPD-USR-ID                    23200000
232100                         ,:PCT00015-PO-NBR                        23210000
232200                         ,:PCT00015-RCVR-SEQ-NBR                  23220000
232300                         ,:PCT00015-OTBND-TRIP-ID                 23230000
232400              END-EXEC                                            23240000
232500                                                                  23250000
232600         WHEN ASC-DISP-INTR                                       23260000
232700              EXEC SQL                                            23270000
232800                   FETCH INTRANSIT-CSR                            23280000
232900                    INTO  :PCT00015-IN-TRNST-TRN-TMST             23290000
233000                         ,:PCT00015-TRN-TYP-CDE                   23300000
233100                         ,:PCT00015-TRN-CLSN-PRCG-QTY             23310000
233200                         ,:PCT00015-TRN-CLSN-BAL-QTY              23320000
233300                         ,:PCT00015-UPD-USR-ID                    23330000
233400                         ,:PCT00015-PO-NBR                        23340000
233500                         ,:PCT00015-RCVR-SEQ-NBR                  23350000
233600                         ,:PCT00015-OTBND-TRIP-ID                 23360000
233700              END-EXEC                                            23370000
233800                                                                  23380000
233900         WHEN ASC-DISP-STR-EXPT                                   23390000
234000              EXEC SQL                                            23400000
234100                   FETCH STR-EXPECTED-CSR                         23410000
234200                    INTO  :PCT00015-IN-TRNST-TRN-TMST             23420000
234300                         ,:PCT00015-TRN-TYP-CDE                   23430000
234400                         ,:PCT00015-TRN-CLSN-PRCG-QTY             23440000
234500                         ,:PCT00015-TRN-CLSN-BAL-QTY              23450000
234600                         ,:PCT00015-UPD-USR-ID                    23460000
234700                         ,:PCT00015-PO-NBR                        23470000
234800                         ,:PCT00015-RCVR-SEQ-NBR                  23480000
234900                         ,:PCT00015-OTBND-TRIP-ID                 23490000
235000              END-EXEC                                            23500000
235100                                                                  23510000
235200         WHEN ASC-DISP-INTR-PORCVR                                23520000
235300              EXEC SQL                                            23530000
235400                   FETCH INTR-PORCVR-CSR                          23540000
235500                    INTO  :PCT00015-IN-TRNST-TRN-TMST             23550000
235600                         ,:PCT00015-TRN-TYP-CDE                   23560000
235700                         ,:PCT00015-TRN-CLSN-PRCG-QTY             23570000
235800                         ,:PCT00015-TRN-CLSN-BAL-QTY              23580000
235900                         ,:PCT00015-UPD-USR-ID                    23590000
236000                         ,:PCT00015-PO-NBR                        23600000
236100                         ,:PCT00015-RCVR-SEQ-NBR                  23610000
236200                         ,:PCT00015-OTBND-TRIP-ID                 23620000
236300              END-EXEC                                            23630000
236400                                                                  23640000
236500         WHEN ASC-DISP-STR-EXPT-PORCVR                            23650000
236600              EXEC SQL                                            23660000
236700                   FETCH STR-EXP-PORCVR-CSR                       23670000
236800                    INTO  :PCT00015-IN-TRNST-TRN-TMST             23680000
236900                         ,:PCT00015-TRN-TYP-CDE                   23690000
237000                         ,:PCT00015-TRN-CLSN-PRCG-QTY             23700000
237100                         ,:PCT00015-TRN-CLSN-BAL-QTY              23710000
237200                         ,:PCT00015-UPD-USR-ID                    23720000
237300                         ,:PCT00015-PO-NBR                        23730000
237400                         ,:PCT00015-RCVR-SEQ-NBR                  23740000
237500                         ,:PCT00015-OTBND-TRIP-ID                 23750000
237600              END-EXEC                                            23760000
237700     END-EVALUATE.                                                23770000
237800*                                                                 23780085
237900* JUST FOR TESTING - BEGIN                                        23790060
238000*    MOVE  SQLCODE                     TO PV-DISP-SQLCODE         23800085
238100*    MOVE  PCT00015-TRN-CLSN-PRCG-QTY  TO PV-DISP-PRCG-QTY        23810085
238200*    MOVE  PCT00015-TRN-CLSN-BAL-QTY   TO PV-DISP-BAL-QTY         23820085
238300*    MOVE  PCT00015-PO-NBR             TO PV-DISP-PO              23830085
238400*    MOVE  PCT00015-RCVR-SEQ-NBR       TO PV-DISP-RCVR            23840085
238500*    MOVE  PCT00015-OTBND-TRIP-ID      TO PV-DISP-TRIP            23850085
238600*    DISPLAY ' '                                                  23860085
238700*    DISPLAY ' PCKCS747 4310-FETCH '                              23870085
238800*            ' CURSOR:'    ASC-SCREEN-DISPLAY                     23880085
238900*            ' SQL:'       PV-DISP-SQLCODE                        23890085
239000*            ' DISPLAY:'   ASC-SCREEN-DISPLAY                     23900085
239100*            ' FORMAT:'    DP020-INT-APPL-FORMAT-IND.             23910085
239200*    DISPLAY ' PCKCS747 4310-FETCH '                              23920085
239300*            ' TMST:  '    PCT00015-IN-TRNST-TRN-TMST.            23930085
239400*    DISPLAY ' PCKCS747 4310-FETCH '                              23940085
239500*            ' TYP-CDE:'   PCT00015-TRN-TYP-CDE                   23950085
239600*            ' PRCG QTY:'  PV-DISP-PRCG-QTY                       23960085
239700*            ' BAL QTY:'   PV-DISP-BAL-QTY.                       23970085
239800*    DISPLAY ' PCKCS747 4310-FETCH '                              23980085
239900*            ' USERID: '   PCT00015-UPD-USR-ID                    23990085
240000*            ' TRIP:'      PV-DISP-TRIP                           24000085
240100*            ' PO-RCVR:'   PV-DISP-PO '-' PV-DISP-RCVR.           24010085
240200* JUST FOR TESTING - END                                          24020063
240300                                                                  24030060
240400     EVALUATE TRUE                                                24040000
240500         WHEN SQLCODE = ZERO                                      24050000
240600         WHEN SQLCODE = -305                                      24060000
240700              CONTINUE                                            24070000
240800                                                                  24080000
240900         WHEN SQLCODE = +100                                      24090000
241000               SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                24100000
241100                                                                  24110000
241200         WHEN SQLWARN0 NOT = SPACE                                24120000
241300         WHEN SQLCODE NOT = ZERO                                  24130000
241400              MOVE '4310-FETCH-CURSOR' TO DP013-PARAGRAPH         24140000
241500              MOVE 'FETCH CURSOR PROBLEM '                        24150000
241600                               TO DP013-MESSAGE-TEXT (1)          24160000
241700              MOVE SQLCA       TO DP013-SQLCA                     24170000
241800              MOVE 'PCT_TRN_CLSN_DTL' TO                          24180000
241900                                   DP013-DB2-TABLE-NAME (1)       24190000
242000              SET DP013-DB2-ABEND TO TRUE                         24200000
242100              PERFORM DP013-0000-PROCESS-ABEND                    24210000
242200     END-EVALUATE.                                                24220000
242300                                                                  24230000
242400                                                                  24240000
242500*----------------------------------------------------------------*24250000
242600* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *24260000
242700*----------------------------------------------------------------*24270000
242800 4400-MOVE-COMMAREA-TO-SCREEN.                                    24280000
242900     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             24290000
243000         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          24300000
243100         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          24310000
243200             MOVE +1    TO ASC-BLK-SUB                            24320000
243300             PERFORM 5100-WRITE-TEMP-STORAGE                      24330000
243400             ADD +1     TO ASC-BLK-SUB                            24340000
243500             PERFORM 5100-WRITE-TEMP-STORAGE                      24350000
243600             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             24360000
243700                 GIVING PV-BLOCK-NUMBER                           24370000
243800                 REMAINDER PV-REMAINDER                           24380000
243900             IF  PV-REMAINDER > ZERO                              24390000
244000                 ADD +1 TO PV-BLOCK-NUMBER                        24400000
244100             END-IF                                               24410000
244200             MOVE +1    TO ASC-BLK-SUB                            24420000
244300             PERFORM 4410-READ-TEMP-STORAGE                       24430000
244400             ADD +1     TO ASC-BLK-SUB                            24440000
244500                           PV-BLOCK-NUMBER                        24450000
244600             PERFORM 4410-READ-TEMP-STORAGE                       24460000
244700     END-IF.                                                      24470000
244800     MOVE +1            TO ASC-BLK-SUB.                           24480000
244900     COMPUTE ASC-ITEM-SUB =                                       24490000
245000         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              24500000
245100         + PC-ITEMS-PER-PANEL).                                   24510000
245200*                                                                 24520000
245300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        24530000
245400         ADD +1         TO ASC-BLK-SUB                            24540000
245500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            24550000
245600     END-IF.                                                      24560000
245700*                                                                 24570000
245800     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           24580000
245900         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                24590000
246000     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        24600000
246100     PERFORM 4420-FORMAT-LIST-LINES                               24610000
246200         VARYING PV-SUB                                           24620000
246300         FROM PC-ITEMS-PER-PANEL BY -1                            24630000
246400         UNTIL PV-SUB < +1.                                       24640000
246500*                                                                 24650000
246600     COMPUTE ASC-ITEMS-DISPLAYED =                                24660000
246700         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          24670000
246800     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    24680000
246900                                      ASTRTITO.                   24690000
247000     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    24700000
247100     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    24710000
247200                                                                  24720000
247300     MOVE ASC-SKU              TO  ASKUO.                         24730000
247400     MOVE ASC-SKU-DESC         TO  ADESCO.                        24740000
247500     MOVE ASC-STR-NBR          TO  ASTOREO.                       24750000
247600                                                                  24760000
247700     MOVE ASC-STR-NBR        TO DK-STR-NBR.                       24770000
247800     MOVE ASC-UPC-ID         TO DK-UPC-ID.                        24780000
247900     PERFORM 4500-GET-TOTALS.                                     24790000
248000                                                                  24800000
248100***** THERE IS ONLY ONE WAY TO CALCULATE TOTAL STORE ON HAND **** 24810000
248200***** THAT IS TO SUBTRACT TOTAL STORE EXPECTED FROM TOTAL    **** 24820000
248300***** FASHION ON HAND GIVING TOTAL STORE ON HAND. 05/2006    **** 24830000
248400**   IF  ASC-TTL-STR-EXPECT > 0                                   24840000
248500         SUBTRACT  ASC-TTL-STR-EXPECT                             24850000
248600            FROM ASC-TTL-FASHION                                  24860000
248700         GIVING  ASC-TTL-STR-ON-HAND                              24870000
248800**   ELSE                                                         24880000
248900**       COMPUTE ASC-TTL-STR-ON-HAND =                            24890000
249000**         ASC-TTL-STR-EXPECT  + ASC-TTL-FASHION                  24900000
249100**   END-IF.                                                      24910000
249200     MOVE ASC-TTL-FASHION      TO  AFASHO.                        24920000
249300     MOVE ASC-TTL-INTRNST      TO  ATRANO.                        24930000
249400     MOVE ASC-TTL-STR-EXPECT   TO  AEXPTO.                        24940000
249500     MOVE ASC-TTL-STR-ON-HAND  TO  ASTORO.                        24950000
249600                                                                  24960000
249700     EVALUATE TRUE                                                24970000
249800         WHEN ASC-DISP-INTR                                       24980000
249900             MOVE 'IN-TRANSIT'           TO  AHD01O               24990000
250000             MOVE 'IN-TRANSIT'           TO  AHD02O               25000000
250100             MOVE 'IN-TRANSIT VIEW '     TO  AVIEWO               25010000
250200             MOVE SPACES                 TO  AVIEW2O              25020000
250300         WHEN ASC-DISP-STR-EXPT                                   25030000
250400             MOVE ' STR-EXPT '                        TO  AHD01O  25040000
250500             MOVE ' STR-EXPT '                        TO  AHD02O  25050000
250600             MOVE 'STORE-EXPECTED VIEW '              TO  AVIEWO  25060000
250700             MOVE 'YELLOW - EFC PO LEVEL TRANSACTION' TO  AVIEW2O 25070000
250800         WHEN ASC-DISP-INTR-PORCVR                                25080000
250900             MOVE 'IN-TRANSIT'           TO  AHD01O               25090000
251000             MOVE 'IN-TRANSIT'           TO  AHD02O               25100000
251100             MOVE 'IN-TRNS PO RCVR VIEW' TO  AVIEWO               25110000
251200             MOVE SPACES                 TO  AVIEW2O              25120000
251300         WHEN ASC-DISP-STR-EXPT-PORCVR                            25130000
251400             MOVE ' STR-EXPT '                        TO  AHD01O  25140000
251500             MOVE ' STR-EXPT '                        TO  AHD02O  25150000
251600             MOVE 'STR-EXP PO RCVR VIEW'              TO  AVIEWO  25160000
251700             MOVE 'YELLOW - EFC PO LEVEL TRANSACTION' TO  AVIEW2O 25170000
251800     END-EVALUATE.                                                25180000
251900                                                                  25190000
252000     MOVE ASC-STORE-NAME       TO  ANAMEO.                        25200000
252100                                                                  25210000
252200     IF  DP020-MSG-NUMBER-X = SPACE                               25220000
252300         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  25230000
252400*            --- MORE ITEMS TO DISPLAY ----                       25240000
252500             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            25250000
252600             SET DP020-MSG-INFORMATIONAL TO TRUE                  25260000
252700         END-IF                                                   25270000
252800     END-IF.                                                      25280000
252900                                                                  25290000
253000*----------------------------------------------------------------*25300000
253100*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *25310000
253200*----------------------------------------------------------------*25320000
253300 4410-READ-TEMP-STORAGE.                                          25330000
253400                                                                  25340000
253500     EXEC CICS                                                    25350000
253600         READQ TS                                                 25360000
253700             QUEUE (ASC-LIST-QUEUE-NAME)                          25370000
253800             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25380000
253900             ITEM  (PV-BLOCK-NUMBER)                              25390000
254000             RESP  (PV-CICS-RESP)                                 25400000
254100     END-EXEC.                                                    25410000
254200                                                                  25420000
254300     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       25430000
254400       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     25440000
254500         CONTINUE                                                 25450000
254600     ELSE                                                         25460000
254700         SET DP013-CICS-ABEND     TO TRUE                         25470000
254800         SET DP013-NO-ROLLBACK    TO TRUE                         25480000
254900         MOVE '4410-READ-TEMP-STORAGE'                            25490000
255000                                  TO DP013-PARAGRAPH              25500000
255100         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      25510000
255200                                  TO DP013-MESSAGE-TEXT(1)        25520000
255300         PERFORM DP013-0000-PROCESS-ABEND                         25530000
255400     END-IF.                                                      25540000
255500                                                                  25550000
255600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             25560000
255700*                                                                 25570000
255800     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         25580000
255900         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               25590000
256000     END-IF.                                                      25600000
256100                                                                  25610000
256200*----------------------------------------------------------------*25620000
256300*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *25630000
256400*----------------------------------------------------------------*25640000
256500 4420-FORMAT-LIST-LINES.                                          25650000
256600     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      25660000
256700         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                25670000
256800*        MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           25680000
256900*        MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           25690000
257000*        MOVE SPACE              TO MR-SELECTI (PV-SUB)           25700000
257100         MOVE SPACES             TO MR-DATE          (PV-SUB)     25710000
257200                                    MR-DESC          (PV-SUB)     25720000
257300                                    MR-PO-RCVR       (PV-SUB)     25730000
257400                                    MR-TRN-QTY       (PV-SUB)     25740000
257500                                    MR-BAL-QTY       (PV-SUB)     25750000
257600                                    MR-OUTBND-TRIP-A (PV-SUB)     25760000
257700                                    MR-USERID        (PV-SUB)     25770000
257800     ELSE                                                         25780000
257900*        IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      25790000
258000*                                                  > SPACE        25800000
258100*            MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 25810000
258200*                                TO MR-SELECTI (PV-SUB)           25820000
258300*        ELSE                                                     25830000
258400*            MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      25840000
258500*                                TO MR-SELECTI (PV-SUB)           25850000
258600*        END-IF                                                   25860000
258700         IF  DP030-SET-CURSOR-TRAILER                             25870000
258800             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)25880000
258900                 > SPACE)                                         25890000
259000               OR (PV-SUB = 1))                                   25900000
259100                SET DP030-SET-CURSOR-APPL-1 TO TRUE               25910000
259200                MOVE -1               TO ASTRTITL                 25920000
259300             END-IF                                               25930000
259400         END-IF                                                   25940000
259500*                                                                 25950000
259600         MOVE ASC-TRANDATE (ASC-BLK-SUB ASC-ITEM-SUB)             25960000
259700                                              TO MR-DATE (PV-SUB) 25970000
259800         MOVE ASC-TYPEDESC (ASC-BLK-SUB ASC-ITEM-SUB)             25980000
259900                                              TO MR-DESC (PV-SUB) 25990000
260000         MOVE ASC-PO-RCVR (ASC-BLK-SUB ASC-ITEM-SUB)              26000000
260100                                           TO MR-PO-RCVR (PV-SUB) 26010000
260200         MOVE ASC-TRNQTY (ASC-BLK-SUB ASC-ITEM-SUB)               26020000
260300                                         TO MR-TRN-QTY-N (PV-SUB) 26030000
260400         MOVE ASC-BALQTY (ASC-BLK-SUB ASC-ITEM-SUB)               26040000
260500                                         TO MR-BAL-QTY-N (PV-SUB) 26050000
260600         MOVE ASC-OUTTRIP (ASC-BLK-SUB ASC-ITEM-SUB)              26060000
260700                                       TO MR-OUTBND-TRIP (PV-SUB) 26070000
260800         MOVE ASC-USERID (ASC-BLK-SUB ASC-ITEM-SUB)               26080000
260900                                            TO MR-USERID (PV-SUB) 26090000
261000         IF ( MR-USERID(PV-SUB) = 'PCKUT083' )                    26100000
261100             MOVE SPACES          TO MR-USERID (PV-SUB)           26110000
261200             MOVE DP015-YELLOW    TO MR-DESCC  (PV-SUB)           26120000
261300         ELSE                                                     26130000
261400             IF MR-USERID (PV-SUB) = PC-MEMO                      26140052
261500                MOVE DP015-YELLOW TO MR-USERIDC  (PV-SUB)         26150052
261600             ELSE                                                 26160052
261700                MOVE DP015-TURQUOISE TO MR-DESCC (PV-SUB)         26170052
261800             END-IF                                               26180052
261900         END-IF                                                   26190052
262000     END-IF.                                                      26200000
262100     SUBTRACT +1 FROM ASC-ITEM-SUB                                26210000
262200     IF  ASC-ITEM-SUB < + 1                                       26220000
262300         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  26230000
262400         MOVE +1                 TO ASC-BLK-SUB                   26240000
262500     END-IF.                                                      26250000
262600                                                                  26260000
262700******************************************************************26270000
262800** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **26280000
262900** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **26290000
263000** ISSUE A WARNING.                                             **26300000
263100******************************************************************26310000
263200 4430-CHECK-FOR-BEGIN-AND-END.                                    26320000
263300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       26330000
263400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     26340000
263500*            -- NO END-OF-RANGE SPECFIED ---                      26350000
263600             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            26360000
263700             SET DP020-MSG-WARNING TO TRUE                        26370000
263800             PERFORM 4431-POSITION-AT-WARNING                     26380000
263900         END-IF                                                   26390000
264000     ELSE                                                         26400000
264100         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     26410000
264200*            -- NO BEGINNING-OF-RANGE SPECFIED ---                26420000
264300             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            26430000
264400             SET DP020-MSG-WARNING TO TRUE                        26440000
264500             PERFORM 4431-POSITION-AT-WARNING                     26450000
264600         END-IF                                                   26460000
264700     END-IF.                                                      26470000
264800******************************************************************26480000
264900** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **26490000
265000** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **26500000
265100** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **26510000
265200** POSITION THE CURSOR THERE.                                   **26520000
265300******************************************************************26530000
265400 4431-POSITION-AT-WARNING.                                        26540000
265500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 26550000
265600                    - PV-TOP-ITEM + 1.                            26560000
265700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      26570000
265800         CONTINUE                                                 26580000
265900     ELSE                                                         26590000
266000         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      26600000
266100         MOVE -1                    TO ASTRTITL                   26610000
266200     END-IF.                                                      26620000
266300*                                                                 26630000
266400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   26640000
266500                    - PV-TOP-ITEM + 1.                            26650000
266600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      26660000
266700         CONTINUE                                                 26670000
266800     ELSE                                                         26680000
266900         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      26690000
267000         MOVE -1                   TO ASTRTITL                    26700000
267100     END-IF.                                                      26710000
267200                                                                  26720000
267300******************************************************************26730000
267400* THE TOTALS IN THE HEADER PORTION OF THE SCREEN IS FOR THE       26740000
267500* ENTIRE SKU.                                                     26750000
267600******************************************************************26760000
267700 4500-GET-TOTALS.                                                 26770000
267800     EXEC SQL                                                     26780000
267900          SELECT  TRN_CLSN_QTY                                    26790000
268000            INTO :PV-TTL-INTRNST-QTY                              26800000
268100            FROM  PCT_TRN_CLSN_BAL                                26810000
268200           WHERE  INTR_UPC_ID       =  :DK-UPC-ID                 26820000
268300             AND  LOC_NBR           =  :DK-STR-NBR                26830000
268400             AND  TRN_CLSN_CDE      =  'IT'                       26840000
268500     END-EXEC.                                                    26850000
268600                                                                  26860000
268700     EVALUATE TRUE                                                26870000
268800         WHEN SQLCODE = ZERO                                      26880000
268900              MOVE PV-TTL-INTRNST-QTY TO  ASC-TTL-INTRNST         26890000
269000         WHEN OTHER                                               26900000
269100              MOVE ZEROES             TO  ASC-TTL-INTRNST         26910000
269200     END-EVALUATE.                                                26920000
269300                                                                  26930000
269400     EXEC SQL                                                     26940000
269500          SELECT  TRN_CLSN_QTY                                    26950000
269600            INTO :PV-TTL-STORE-EXPECT                             26960000
269700            FROM  PCT_TRN_CLSN_BAL                                26970000
269800           WHERE  INTR_UPC_ID       =  :DK-UPC-ID                 26980000
269900             AND  LOC_NBR           =  :DK-STR-NBR                26990000
270000             AND  TRN_CLSN_CDE      =  'SE'                       27000000
270100     END-EXEC.                                                    27010000
270200                                                                  27020000
270300     EVALUATE TRUE                                                27030000
270400         WHEN SQLCODE = ZERO                                      27040000
270500              MOVE PV-TTL-STORE-EXPECT TO ASC-TTL-STR-EXPECT      27050000
270600         WHEN OTHER                                               27060000
270700              MOVE ZEROES              TO ASC-TTL-STR-EXPECT      27070000
270800     END-EVALUATE.                                                27080000
270900                                                                  27090000
271000     INITIALIZE XM003-ITEM-COMMAREA.                              27100000
271100     SET XM003-ONHAND-YES  TO TRUE.                               27110000
271200                                                                  27120000
271300     MOVE ASC-SKU          TO XM003-KEY-SKU.                      27130000
271400     MOVE ASC-STR-NBR      TO XM003-KEY-STR-NBR.                  27140000
271500     MOVE LENGTH OF XM003-ITEM-COMMAREA TO PV-COMMAREA-LENGTH.    27150000
271600                                                                  27160000
271700     EXEC CICS                                                    27170000
271800          LINK                                                    27180000
271900               PROGRAM (PC-XMKCS001)                              27190000
272000              COMMAREA (XM003-ITEM-COMMAREA)                      27200000
272100                LENGTH (PV-COMMAREA-LENGTH)                       27210000
272200                  RESP (PV-CICS-RESPONSE)                         27220000
272300     END-EXEC.                                                    27230000
272400                                                                  27240000
272500     EVALUATE TRUE                                                27250000
272600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 27260000
272700              EVALUATE TRUE                                       27270000
272800                  WHEN XM003-SUCCESSFUL                           27280000
272900                       MOVE XM003-ONHAND    TO PV-TTL-ONHAND-QTY  27290000
273000                       MOVE PV-TTL-ONHAND-QTY TO ASC-TTL-FASHION  27300000
273100                  WHEN OTHER                                      27310000
273200                       IF XM003-RETURN-SQLCODE = +100             27320000
273300                           MOVE 0 TO PV-TTL-ONHAND-QTY            27330000
273400                                     ASC-TTL-FASHION              27340000
273500                       END-IF                                     27350000
273600              END-EVALUATE                                        27360000
273700         WHEN OTHER                                               27370000
273800              MOVE 0 TO PV-TTL-ONHAND-QTY                         27380000
273900                        ASC-TTL-FASHION                           27390000
274000     END-EVALUATE.                                                27400000
274100                                                                  27410000
274200 4600-DETERMINE-MISLOAD-STR.                                      27420085
274300                                                                  27430039
274400     EXEC SQL                                                     27440039
274500        SELECT DISTINCT(LOC_NBR)                                  27450058
274600          INTO :PCT00015-LOC-NBR                                  27460039
274700          FROM  PCT_TRN_CLSN_DTL                                  27470039
274800         WHERE INTR_UPC_ID = :DK-UPC-ID                           27480039
274900           AND PO_NBR      = :PCT00015-PO-NBR                     27490039
275000           AND RCVR_SEQ_NBR    = :PCT00015-RCVR-SEQ-NBR           27500040
275100           AND TRN_CLSN_CDE    = 'SE'                             27510040
275200           AND TRN_TYP_CDE   IN ('MU','SM')                       27520050
275300     END-EXEC                                                     27530039
275400                                                                  27540039
275500*                                                                 27550085
275600* JUST FOR TESTING - BEGIN                                        27560060
275700*    MOVE  SQLCODE                     TO PV-DISP-SQLCODE         27570085
275800*    MOVE  PCT00015-LOC-NBR            TO PV-DISP-LOC-NBR         27580085
275900*    DISPLAY ' '.                                                 27590085
276000*    DISPLAY ' PCKCS747 4600- '                                   27600085
276100*            ' SQL:'       PV-DISP-SQLCODE                        27610085
276200*            ' LOC:'       PV-DISP-LOC-NBR.                       27620085
276300* JUST FOR TESTING - END                                          27630060
276400                                                                  27640060
276500                                                                  27650039
276600     EVALUATE TRUE                                                27660039
276700         WHEN SQLCODE = ZERO                                      27670039
276800              MOVE  PCT00015-LOC-NBR TO PV-MISLD-STR              27680057
276900                                                                  27690039
277000         WHEN SQLCODE = +100                                      27700039
277100              MOVE SPACES TO PV-MISLD-STR                         27710039
277200                                                                  27720039
277300         WHEN SQLCODE = -811                                      27730039
277400              PERFORM 4605-DETERMINE-MISLOAD-MLT-STR              27740070
277500                                                                  27750039
277600         WHEN SQLWARN0 NOT = SPACE                                27760039
277700         WHEN SQLCODE NOT = ZERO                                  27770039
277800              MOVE '4600-DETERMINE-MISLOAD' TO DP013-PARAGRAPH    27780039
277900              MOVE 'SELECT MISLOAD STORE '                        27790039
278000                               TO DP013-MESSAGE-TEXT (1)          27800039
278100              MOVE DK-UPC-ID                                      27810039
278200                               TO DP013-MESSAGE-TEXT (2)          27820039
278300              MOVE SQLCA       TO DP013-SQLCA                     27830039
278400              MOVE 'PCT_TRN_CLSN_DTL' TO                          27840039
278500                                   DP013-DB2-TABLE-NAME (1)       27850039
278600              SET DP013-DB2-ABEND TO TRUE                         27860039
278700              PERFORM DP013-0000-PROCESS-ABEND                    27870039
278800     END-EVALUATE.                                                27880039
278900                                                                  27890039
279000                                                                  27900065
279100******************************************************************27910065
279200*WHEN MULITPLE ROWS ARE RETURNED - ADD TRIP TO SELECT           **27920065
279300*DMH 9/13/17                                                    **27930065
279400******************************************************************27940065
279500 4605-DETERMINE-MISLOAD-MLT-STR.                                  27950070
279600                                                                  27960065
279700     MOVE ASC-STR-NBR TO DK-STORE-NUMBER.                         27970073
279800                                                                  27980073
279900     EXEC SQL                                                     27990066
280000          SELECT DISTINCT B.DEST_LOC_NBR                          28000066
280100            INTO :SUT00024-DEST-LOC-NBR                           28010066
280200            FROM SUT_OTBND_UPC A                                  28020066
280300               , SUT_OTBND_CART B                                 28030066
280400               , SUT_OTBND_STR_SCN C                              28040066
280500               , XLT_UPC D                                        28050066
280600          WHERE A.TRN_NBR           = :PCT00015-PO-NBR            28060066
280700            AND A.RCVR_SEQ_NBR      = :PCT00015-RCVR-SEQ-NBR      28070066
280800            AND D.INTR_UPC_ID       = :DK-UPC-ID                  28080066
280900            AND A.UPC_NBR = D.UPC_NBR                             28090066
281000            AND B.SHIPT_UNT_ID      = A.SHIPT_UNT_ID              28100066
281100            AND C.SHIPT_UNT_ID      = A.SHIPT_UNT_ID              28110066
281200            AND C.SCN_LOC_NBR       = :DK-STORE-NUMBER            28120073
281300            AND C.SCN_OTBND_TRIP_ID = :PCT00015-OTBND-TRIP-ID     28130066
281400            AND C.SCN_TYP_CDE       = 'SSSM'                      28140066
281500           WITH UR                                                28150069
281600     END-EXEC.                                                    28160066
281700                                                                  28170080
281800* JUST FOR TESTING - BEGIN                                        28180065
281900*    MOVE  SQLCODE                     TO PV-DISP-SQLCODE         28190085
282000*    MOVE  SUT00024-DEST-LOC-NBR       TO PV-DISP-LOC-NBR         28200085
282100*    MOVE  DK-STORE-NUMBER             TO PV-DISP-SCN-LOC         28210085
282200*    MOVE  DK-UPC-ID                   TO PV-DISP-UPC-ID          28220085
282300*    MOVE  PCT00015-PO-NBR             TO PV-DISP-PO              28230085
282400*    MOVE  PCT00015-RCVR-SEQ-NBR       TO PV-DISP-RCVR            28240085
282500*    DISPLAY ' '.                                                 28250085
282600*    DISPLAY ' PCKCS747 4605- '                                   28260085
282700*            ' SQL:'       PV-DISP-SQLCODE                        28270085
282800*            ' LOC:'       PV-DISP-LOC-NBR                        28280085
282900*            ' STORE:'     PV-DISP-SCN-LOC                        28290085
283000*            ' UPCID:'     PV-DISP-UPC-ID.                        28300085
283100*    DISPLAY ' PCKCS747 4605- '                                   28310085
283200*            ' PO:'        PV-DISP-PO                             28320085
283300*            '-'           PV-DISP-RCVR.                          28330085
283400* JUST FOR TESTING - END                                          28340075
283500                                                                  28350075
283600                                                                  28360075
283700     EVALUATE TRUE                                                28370075
283800         WHEN SQLCODE = ZERO                                      28380075
283900              MOVE  SUT00024-DEST-LOC-NBR TO PV-MISLD-STR         28390075
284000                                                                  28400075
284100         WHEN SQLCODE = +100                                      28410075
284200              MOVE SPACES TO PV-MISLD-STR                         28420075
284300                                                                  28430075
284400         WHEN SQLCODE = -811                                      28440075
284500              MOVE PC-MULT TO PV-MISLD-STR                        28450075
284600                                                                  28460075
284700         WHEN SQLWARN0 NOT = SPACE                                28470075
284800         WHEN SQLCODE NOT = ZERO                                  28480075
284900              MOVE ' 4605-DETERMINE-MISLOAD-MLT-STR'              28490075
285000                                            TO DP013-PARAGRAPH    28500075
285100              MOVE 'SELECT MISLOAD STORE '                        28510075
285200                               TO DP013-MESSAGE-TEXT (1)          28520075
285300              MOVE DK-UPC-ID                                      28530075
285400                               TO DP013-MESSAGE-TEXT (2)          28540075
285500              MOVE SQLCA       TO DP013-SQLCA                     28550075
285600              MOVE 'SUT_OTBND_UPC'                                28560075
285700                                TO DP013-DB2-TABLE-NAME (1)       28570075
285800              MOVE 'SUT_OTBND_CART'                               28580075
285900                                TO DP013-DB2-TABLE-NAME (2)       28590075
286000              MOVE 'SUT_OTBND_STR_SCN'                            28600075
286100                                TO DP013-DB2-TABLE-NAME (3)       28610075
286200              MOVE 'XLT_UPC'                                      28620075
286300                                TO DP013-DB2-TABLE-NAME (4)       28630075
286400              SET DP013-DB2-ABEND TO TRUE                         28640075
286500              PERFORM DP013-0000-PROCESS-ABEND                    28650075
286600     END-EVALUATE.                                                28660075
286700                                                                  28670075
286800*                                                                 28680077
286900 4700-DETERMINE-EXPCTD-STR.                                       28690075
287000                                                                  28700043
287100     EXEC SQL                                                     28710043
287200        SELECT  DISTINCT(LOC_NBR)                                 28720058
287300          INTO :PCT00015-LOC-NBR                                  28730043
287400          FROM  PCT_TRN_CLSN_DTL                                  28740043
287500         WHERE INTR_UPC_ID = :DK-UPC-ID                           28750043
287600           AND PO_NBR      = :PCT00015-PO-NBR                     28760043
287700           AND RCVR_SEQ_NBR    = :PCT00015-RCVR-SEQ-NBR           28770043
287800           AND TRN_CLSN_CDE    = 'SE'                             28780043
287900           AND TRN_TYP_CDE  IN ('MM','SM')                        28790050
288000     END-EXEC.                                                    28800077
288100                                                                  28810043
288200*                                                                 28820085
288300* JUST FOR TESTING - BEGIN                                        28830060
288400*    MOVE  SQLCODE                     TO PV-DISP-SQLCODE         28840085
288500*    MOVE  PCT00015-LOC-NBR            TO PV-DISP-LOC-NBR         28850085
288600*    DISPLAY ' '.                                                 28860085
288700*    DISPLAY ' PCKCS747 4700- '                                   28870085
288800*            ' SQL:'       PV-DISP-SQLCODE                        28880085
288900*            ' LOC:'       PV-DISP-LOC-NBR.                       28890085
289000* JUST FOR TESTING - END                                          28900060
289100                                                                  28910060
289200                                                                  28920043
289300     EVALUATE TRUE                                                28930050
289400         WHEN SQLCODE = ZERO                                      28940043
289500              MOVE  PCT00015-LOC-NBR TO PV-MISLD-STR              28950043
289600                                                                  28960043
289700         WHEN SQLCODE = +100                                      28970043
289800              MOVE SPACES TO PV-MISLD-STR                         28980043
289900                                                                  28990043
290000                                                                  29000043
290100         WHEN SQLCODE = -811                                      29010043
290200              PERFORM 4705-DETERMINE-EXPCTD-MLT-STR               29020070
290300                                                                  29030043
290400         WHEN SQLWARN0 NOT = SPACE                                29040043
290500         WHEN SQLCODE NOT = ZERO                                  29050043
290600              MOVE '4700-DETERMINE-EXPCTD-' TO DP013-PARAGRAPH    29060043
290700              MOVE 'SELECT EXPECTD STORE '                        29070043
290800                               TO DP013-MESSAGE-TEXT (1)          29080043
290900              MOVE DK-UPC-ID                                      29090043
291000                               TO DP013-MESSAGE-TEXT (2)          29100043
291100              MOVE SQLCA       TO DP013-SQLCA                     29110043
291200              MOVE 'PCT_TRN_CLSN_DTL' TO                          29120043
291300                                   DP013-DB2-TABLE-NAME (1)       29130043
291400              SET DP013-DB2-ABEND TO TRUE                         29140043
291500              PERFORM DP013-0000-PROCESS-ABEND                    29150043
291600     END-EVALUATE.                                                29160043
291700                                                                  29170043
291800                                                                  29180043
291900******************************************************************29190066
292000*WHEN MULITPLE ROWS ARE RETURNED - ADD TRIP TO SELECT           **29200066
292100*DMH 9/13/17                                                    **29210066
292200******************************************************************29220066
292300 4705-DETERMINE-EXPCTD-MLT-STR.                                   29230070
292400                                                                  29240066
292500     MOVE ASC-STR-NBR TO DK-STORE-NUMBER.                         29250073
292600                                                                  29260073
292700     EXEC SQL                                                     29270066
292800          SELECT DISTINCT C.SCN_LOC_NBR                           29280082
292900            INTO :SUT00121-SCN-LOC-NBR                            29290082
293000            FROM SUT_OTBND_UPC A                                  29300082
293100               , SUT_OTBND_CART B                                 29310082
293200               , SUT_OTBND_STR_SCN C                              29320082
293300               , XLT_UPC D                                        29330082
293400          WHERE A.TRN_NBR           = :PCT00015-PO-NBR            29340082
293500            AND A.RCVR_SEQ_NBR      = :PCT00015-RCVR-SEQ-NBR      29350082
293600            AND D.INTR_UPC_ID       = :DK-UPC-ID                  29360082
293700            AND A.UPC_NBR = D.UPC_NBR                             29370082
293800            AND B.SHIPT_UNT_ID      = A.SHIPT_UNT_ID              29380082
293900            AND C.SHIPT_UNT_ID      = A.SHIPT_UNT_ID              29390082
294000            AND B.DEST_LOC_NBR      = :DK-STORE-NUMBER            29400082
294100            AND C.SCN_TYP_CDE       = 'SSSM'                      29410082
294200           WITH UR                                                29420082
294300     END-EXEC.                                                    29430082
294400                                                                  29440066
294500                                                                  29450080
294600* JUST FOR TESTING - BEGIN                                        29460066
294700*    MOVE  SQLCODE                     TO PV-DISP-SQLCODE         29470085
294800*    MOVE  SUT00121-SCN-LOC-NBR        TO PV-DISP-LOC-NBR         29480085
294900*    MOVE  DK-STORE-NUMBER             TO PV-DISP-SCN-LOC         29490085
295000*    MOVE  DK-UPC-ID                   TO PV-DISP-UPC-ID          29500085
295100*    MOVE  PCT00015-PO-NBR             TO PV-DISP-PO              29510085
295200*    MOVE  PCT00015-RCVR-SEQ-NBR       TO PV-DISP-RCVR            29520085
295300*    DISPLAY ' '.                                                 29530085
295400*    DISPLAY ' PCKCS747 4705- '                                   29540085
295500*            ' SQL:'       PV-DISP-SQLCODE                        29550085
295600*            ' LOC:'       PV-DISP-LOC-NBR                        29560085
295700*            ' STORE:'     PV-DISP-SCN-LOC                        29570085
295800*            ' UPCID:'     PV-DISP-UPC-ID.                        29580085
295900*    DISPLAY ' PCKCS747 4705- '                                   29590085
296000*            ' PO:'        PV-DISP-PO                             29600085
296100*            '-'           PV-DISP-RCVR.                          29610085
296200* JUST FOR TESTING - END                                          29620075
296300                                                                  29630075
296400                                                                  29640075
296500     EVALUATE TRUE                                                29650075
296600         WHEN SQLCODE = ZERO                                      29660075
296700              MOVE  SUT00121-SCN-LOC-NBR  TO PV-MISLD-STR         29670082
296800                                                                  29680075
296900         WHEN SQLCODE = +100                                      29690075
297000              MOVE SPACES TO PV-MISLD-STR                         29700075
297100                                                                  29710075
297200         WHEN SQLCODE = -811                                      29720075
297300              MOVE PC-MULT TO PV-MISLD-STR                        29730075
297400                                                                  29740075
297500         WHEN SQLWARN0 NOT = SPACE                                29750075
297600         WHEN SQLCODE NOT = ZERO                                  29760075
297700              MOVE '4705-DETERMINE-EXPCTD-MLT-STR'                29770075
297800                                            TO DP013-PARAGRAPH    29780075
297900              MOVE 'SELECT EXPECTD STORE '                        29790075
298000                               TO DP013-MESSAGE-TEXT (1)          29800075
298100              MOVE DK-UPC-ID                                      29810075
298200                               TO DP013-MESSAGE-TEXT (2)          29820075
298300              MOVE SQLCA       TO DP013-SQLCA                     29830075
298400              MOVE 'SUT_OTBND_UPC'                                29840075
298500                                TO DP013-DB2-TABLE-NAME (1)       29850075
298600              MOVE 'SUT_OTBND_CART'                               29860075
298700                                TO DP013-DB2-TABLE-NAME (2)       29870075
298800              MOVE 'SUT_OTBND_STR_SCN'                            29880075
298900                                TO DP013-DB2-TABLE-NAME (3)       29890075
299000              MOVE 'XLT_UPC'                                      29900075
299100                                TO DP013-DB2-TABLE-NAME (4)       29910075
299200              SET DP013-DB2-ABEND TO TRUE                         29920075
299300              PERFORM DP013-0000-PROCESS-ABEND                    29930075
299400     END-EVALUATE.                                                29940075
299500                                                                  29950075
299600                                                                  29960075
299700*----------------------------------------------------------------*29970043
299800* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *29980000
299900* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *29990000
300000* FOR THE SELECTED ITEMS QUEUE.                                  *30000000
300100*                                                                *30010000
300200* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *30020000
300300* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *30030000
300400* THE ARRAY IS FULL.                                             *30040000
300500*----------------------------------------------------------------*30050000
300600 5000-PREPARE-SEL-QUEUE.                                          30060000
300700                                                                  30070000
300800     MOVE +1                   TO  ASC-BLK-SUB.                   30080000
300900     PERFORM 5100-WRITE-TEMP-STORAGE.                             30090000
301000     ADD +1                    TO  ASC-BLK-SUB.                   30100000
301100     PERFORM 5100-WRITE-TEMP-STORAGE.                             30110000
301200                                                                  30120000
301300     MOVE ASC-SEL-QUEUE-NAME-2 TO  ASC-SEL-QUEUE-NAME.            30130000
301400     MOVE ASC-SEL-QUEUE-NAME   TO  PC211-SEL-QUEUE-NAME.          30140000
301500     PERFORM 6010-DELETE-SEL-QUEUE.                               30150000
301600                                                                  30160000
301700     SET ASC-UPDATE-TSQ        TO  TRUE.                          30170000
301800                                                                  30180000
301900     SET PC212-IDX             TO  1.                             30190000
302000     MOVE ZERO                 TO PC211-NUMBER-OF-TS-ITEMS.       30200000
302100     INITIALIZE PC212-SELECTED-ITEM-ARRAY.                        30210000
302200                                                                  30220000
302300     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           30230000
302400             VARYING PV-ITEM                                      30240000
302500             FROM 1 BY 1                                          30250000
302600             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     30260000
302700                                                                  30270000
302800     IF  PC212-IDX > 1                                            30280000
302900         PERFORM 5205-WRITE-SEL-QUEUE                             30290000
303000         ADD +1                TO PC211-NUMBER-OF-TS-ITEMS        30300000
303100     END-IF.                                                      30310000
303200                                                                  30320000
303300*----------------------------------------------------------------*30330000
303400*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *30340000
303500*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *30350000
303600*----------------------------------------------------------------*30360000
303700 5100-WRITE-TEMP-STORAGE.                                         30370000
303800     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     30380000
303900                                   TO PV-LIST-ITEM-NUMBER.        30390000
304000     COMPUTE PV-BLOCK-NUMBER =                                    30400000
304100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    30410000
304200                                                                  30420000
304300     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             30430000
304400     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             30440000
304500         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      30450000
304600             PERFORM 5105-REWRITE-ASC-LISTQ                       30460000
304700         END-IF                                                   30470000
304800     ELSE                                                         30480000
304900         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       30490000
305000         ASC-HIGHEST-BLOCK-WRITTEN + 1                            30500000
305100         PERFORM 5110-WRITE-ASC-LISTQ                             30510000
305200         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   30520000
305300     END-IF.                                                      30530000
305400                                                                  30540000
305500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             30550000
305600                                                                  30560000
305700******************************************************************30570000
305800** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **30580000
305900** SPECIFIC COMMAREA.                                           **30590000
306000******************************************************************30600000
306100 5105-REWRITE-ASC-LISTQ.                                          30610000
306200     EXEC CICS                                                    30620000
306300         WRITEQ TS                                                30630000
306400             QUEUE (ASC-LIST-QUEUE-NAME)                          30640000
306500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               30650000
306600             ITEM  (PV-BLOCK-NUMBER)                              30660000
306700             REWRITE                                              30670000
306800             RESP  (PV-CICS-RESP)                                 30680000
306900     END-EXEC.                                                    30690000
307000                                                                  30700000
307100     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           30710000
307200         CONTINUE                                                 30720000
307300     ELSE                                                         30730000
307400         SET DP013-CICS-ABEND            TO TRUE                  30740000
307500         SET DP013-NO-ROLLBACK           TO TRUE                  30750000
307600         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       30760000
307700         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     30770000
307800                                         TO DP013-MESSAGE-TEXT(1) 30780000
307900         PERFORM DP013-0000-PROCESS-ABEND                         30790000
308000     END-IF.                                                      30800000
308100                                                                  30810000
308200******************************************************************30820000
308300** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **30830000
308400** SPECIFIC COMMAREA.                                           **30840000
308500******************************************************************30850000
308600 5110-WRITE-ASC-LISTQ.                                            30860000
308700     EXEC CICS                                                    30870000
308800         WRITEQ TS                                                30880000
308900             QUEUE (ASC-LIST-QUEUE-NAME)                          30890000
309000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               30900000
309100             ITEM  (PV-BLOCK-NUMBER)                              30910000
309200             RESP  (PV-CICS-RESP)                                 30920000
309300     END-EXEC.                                                    30930000
309400     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      30940000
309500         SET DP013-CICS-ABEND      TO TRUE                        30950000
309600         SET DP013-NO-ROLLBACK     TO TRUE                        30960000
309700         MOVE '5110-WRITE-ASC-LISTQ'                              30970000
309800                                   TO DP013-PARAGRAPH             30980000
309900         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           30990000
310000                                   TO DP013-MESSAGE-TEXT(1)       31000000
310100         PERFORM DP013-0000-PROCESS-ABEND                         31010000
310200     END-IF.                                                      31020000
310300                                                                  31030000
310400*----------------------------------------------------------------*31040000
310500* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *31050000
310600* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *31060000
310700*----------------------------------------------------------------*31070000
310800 5200-FILL-SEL-QUEUE-RECORD.                                      31080000
310900                                                                  31090000
311000     PERFORM 6112-READ-LIST-QUEUE.                                31100000
311100                                                                  31110000
311200     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       31120000
311300         PERFORM                                                  31130000
311400         VARYING LQW-IDX                                          31140000
311500         FROM 1 BY 1                                              31150000
311600         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            31160000
311700           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          31170000
311800                                                                  31180000
311900             IF  LQW-SELECT (LQW-IDX)                             31190000
312000                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              31200000
312100                                   TO PC212-ITEM (PC212-IDX)      31210000
312200                 MOVE SPACE        TO PC212-ACTION-SW (PC212-IDX) 31220000
312300                                                                  31230000
312400                 SET PC212-IDX UP BY 1                            31240000
312500                 IF  PC212-IDX > PC212-MAX-ITEMS                  31250000
312600                     PERFORM 5205-WRITE-SEL-QUEUE                 31260000
312700                     ADD +1        TO PC211-NUMBER-OF-TS-ITEMS    31270000
312800                     INITIALIZE PC212-SELECTED-ITEM-ARRAY         31280000
312900                     SET PC212-IDX TO  1                          31290000
313000                 END-IF                                           31300000
313100             END-IF                                               31310000
313200         END-PERFORM                                              31320000
313300     END-IF.                                                      31330000
313400                                                                  31340000
313500*----------------------------------------------------------------*31350000
313600*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *31360000
313700*----------------------------------------------------------------*31370000
313800 5205-WRITE-SEL-QUEUE.                                            31380000
313900                                                                  31390000
314000     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            31400000
314100                                   TO PC212-SELECTED-ITEMS.       31410000
314200                                                                  31420000
314300     EXEC CICS                                                    31430000
314400          WRITEQ TS                                               31440000
314500              QUEUE (ASC-SEL-QUEUE-NAME)                          31450000
314600              FROM  (PC212-SELECT-RECORD)                         31460000
314700              ITEM  (PV-SEL-QUEUE-ITEM)                           31470000
314800              RESP  (PV-CICS-RESP)                                31480000
314900     END-EXEC.                                                    31490000
315000                                                                  31500000
315100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          31510000
315200         CONTINUE                                                 31520000
315300     ELSE                                                         31530000
315400         SET DP013-CICS-ABEND      TO TRUE                        31540000
315500         SET DP013-NO-ROLLBACK     TO TRUE                        31550000
315600         MOVE '5205-WRITE-SEL-QUEUE'                              31560000
315700                                   TO DP013-PARAGRAPH             31570000
315800         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          31580000
315900                                   TO DP013-MESSAGE-TEXT(1)       31590000
316000         PERFORM DP013-0000-PROCESS-ABEND                         31600000
316100     END-IF.                                                      31610000
316200******************************************************************31620000
316300** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **31630000
316400** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **31640000
316500** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **31650000
316600** THE USER.                                                    **31660000
316700******************************************************************31670000
316800 6000-REFRESH-PANEL-FROM-TEMP.                                    31680000
316900     IF  ASC-UPDATE-TSQ                                           31690000
317000         SET ASC-NO-TSQ-UPDATE TO TRUE                            31700000
317100         MOVE ZERO                 TO PV-SAVE-ITEM                31710000
317200                                      PV-SEL-QUEUE-ITEM           31720000
317300         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        31730000
317400                                   TO PV-HOLD-SELECTED-ITEMS      31740000
317500         MOVE +1                   TO PV-ITEMS-PROCESSED          31750000
317600         PERFORM 6100-UPDATE-TSQ                                  31760000
317700             UNTIL PV-ITEMS-PROCESSED >                           31770000
317800                                     PV-HOLD-SELECTED-ITEMS       31780000
317900         INITIALIZE ASC-BLOCK-ENTRIES (1)                         31790000
318000                    ASC-BLOCK-ENTRIES (2)                         31800000
318100     END-IF.                                                      31810000
318200                                                                  31820000
318300*----------------------------------------------------------------*31830000
318400*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *31840000
318500*----------------------------------------------------------------*31850000
318600 6010-DELETE-SEL-QUEUE.                                           31860000
318700                                                                  31870000
318800     EXEC CICS                                                    31880000
318900         DELETEQ TS                                               31890000
319000             QUEUE (ASC-SEL-QUEUE-NAME)                           31900000
319100             RESP  (PV-CICS-RESP)                                 31910000
319200     END-EXEC.                                                    31920000
319300*                                                                 31930000
319400     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      31940000
319500        (PV-CICS-RESP = DFHRESP(QIDERR)))                         31950000
319600         CONTINUE                                                 31960000
319700     ELSE                                                         31970000
319800         SET DP013-CICS-ABEND TO TRUE                             31980000
319900         SET DP013-NO-ROLLBACK TO TRUE                            31990000
320000         MOVE '6010-DELETE-SEL-QUEUE'                             32000000
320100                        TO DP013-PARAGRAPH                        32010000
320200         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         32020000
320300                        TO DP013-MESSAGE-TEXT (1)                 32030000
320400         PERFORM DP013-0000-PROCESS-ABEND                         32040000
320500     END-IF.                                                      32050000
320600                                                                  32060000
320700*----------------------------------------------------------------*32070000
320800*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *32080000
320900*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *32090000
321000*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *32100000
321100*    THE TEMP QUEUE.                                             *32110000
321200*----------------------------------------------------------------*32120000
321300 6100-UPDATE-TSQ.                                                 32130000
321400                                                                  32140000
321500     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             32150000
321600     PERFORM 6150-READ-SEL-QUEUE.                                 32160000
321700     PERFORM                                                      32170000
321800         VARYING PC212-IDX                                        32180000
321900         FROM 1 BY 1                                              32190000
322000         UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)     32200000
322100         OR (PC212-IDX GREATER THAN PC212-MAX-ITEMS))             32210000
322200         IF  PC212-ACTION-SW (PC212-IDX) > SPACE                  32220000
322300             PERFORM 6110-PROCESS-ITEMS                           32230000
322400         END-IF                                                   32240000
322500         ADD +1                TO PV-ITEMS-PROCESSED              32250000
322600     END-PERFORM.                                                 32260000
322700     PERFORM 6111-WRITE-LIST-QUEUE.                               32270000
322800                                                                  32280000
322900*----------------------------------------------------------------*32290000
323000*    READ THE LIST QUEUE RECORD.                                 *32300000
323100*----------------------------------------------------------------*32310000
323200 6150-READ-SEL-QUEUE.                                             32320000
323300                                                                  32330000
323400     EXEC CICS                                                    32340000
323500          READQ TS                                                32350000
323600              QUEUE (ASC-SEL-QUEUE-NAME)                          32360000
323700              INTO  (PC212-SELECT-RECORD)                         32370000
323800              ITEM  (PV-SEL-QUEUE-ITEM)                           32380000
323900              RESP  (PV-CICS-RESP)                                32390000
324000     END-EXEC.                                                    32400000
324100*                                                                 32410000
324200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          32420000
324300         CONTINUE                                                 32430000
324400     ELSE                                                         32440000
324500         SET DP013-CICS-ABEND      TO  TRUE                       32450000
324600         SET DP013-NO-ROLLBACK     TO  TRUE                       32460000
324700         MOVE '6150-READ-SEL-QUEUE' TO  DP013-PARAGRAPH           32470000
324800         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           32480000
324900                                   TO  DP013-MESSAGE-TEXT(1)      32490000
325000         PERFORM DP013-0000-PROCESS-ABEND                         32500000
325100     END-IF.                                                      32510000
325200                                                                  32520000
325300*----------------------------------------------------------------*32530000
325400*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*32540000
325500*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*32550000
325600*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *32560000
325700*----------------------------------------------------------------*32570000
325800 6110-PROCESS-ITEMS.                                              32580000
325900                                                                  32590000
326000     COMPUTE PV-ITEM = 1 + ((PC212-ITEM (PC212-IDX) - 1)          32600000
326100                     / PC-ITEMS-PER-PANEL).                       32610000
326200                                                                  32620000
326300     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           32630000
326400         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          32640000
326500             PERFORM 6111-WRITE-LIST-QUEUE                        32650000
326600         END-IF                                                   32660000
326700         MOVE PV-ITEM          TO PV-SAVE-ITEM                    32670000
326800                                                                  32680000
326900         PERFORM 6112-READ-LIST-QUEUE                             32690000
327000         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               32700000
327100             CONTINUE                                             32710000
327200         END-IF                                                   32720000
327300     END-IF.                                                      32730000
327400                                                                  32740000
327500     COMPUTE PV-SUB = (PC212-ITEM (PC212-IDX)                     32750000
327600                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              32760000
327700     SET LQW-DESELECT (PV-SUB) TO    TRUE                         32770000
327800     MOVE LQW-SELECTED-SW (PV-SUB)                                32780000
327900                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  32790000
328000                                                                  32800000
328100     EVALUATE TRUE                                                32810000
328200         WHEN PC212-INQ (PC212-IDX)                               32820000
328300              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             32830000
328400                                                                  32840000
328500         WHEN PC212-UPD (PC212-IDX)                               32850000
328600              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             32860000
328700                                                                  32870000
328800         WHEN PC212-DEL (PC212-IDX)                               32880000
328900              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             32890000
329000                                                                  32900000
329100         WHEN PC212-ERR (PC212-IDX)                               32910000
329200              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             32920000
329300     END-EVALUATE.                                                32930000
329400                                                                  32940000
329500     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                32950000
329600                                                                  32960000
329700*----------------------------------------------------------------*32970000
329800*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *32980000
329900*----------------------------------------------------------------*32990000
330000 6111-WRITE-LIST-QUEUE.                                           33000000
330100                                                                  33010000
330200     EXEC CICS                                                    33020000
330300         WRITEQ TS                                                33030000
330400             QUEUE (ASC-LIST-QUEUE-NAME)                          33040000
330500             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     33050000
330600             ITEM  (PV-SAVE-ITEM)                                 33060000
330700             REWRITE                                              33070000
330800             RESP  (PV-CICS-RESP)                                 33080000
330900     END-EXEC.                                                    33090000
331000*                                                                 33100000
331100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          33110000
331200         CONTINUE                                                 33120000
331300     ELSE                                                         33130000
331400         SET DP013-CICS-ABEND  TO  TRUE                           33140000
331500         SET DP013-NO-ROLLBACK TO  TRUE                           33150000
331600         MOVE '6111-WRITE-LIST-QUEUE'                             33160000
331700                               TO  DP013-PARAGRAPH                33170000
331800         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  33180000
331900                               TO  DP013-MESSAGE-TEXT(1)          33190000
332000         PERFORM DP013-0000-PROCESS-ABEND                         33200000
332100     END-IF.                                                      33210000
332200                                                                  33220000
332300*----------------------------------------------------------------*33230000
332400*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*33240000
332500*----------------------------------------------------------------*33250000
332600 6112-READ-LIST-QUEUE.                                            33260000
332700                                                                  33270000
332800     EXEC CICS                                                    33280000
332900         READQ TS                                                 33290000
333000             QUEUE (ASC-LIST-QUEUE-NAME)                          33300000
333100             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     33310000
333200             ITEM  (PV-ITEM)                                      33320000
333300             RESP  (PV-CICS-RESP)                                 33330000
333400     END-EXEC.                                                    33340000
333500*                                                                 33350000
333600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          33360000
333700         CONTINUE                                                 33370000
333800     ELSE                                                         33380000
333900         SET DP013-CICS-ABEND        TO TRUE                      33390000
334000         SET DP013-NO-ROLLBACK       TO TRUE                      33400000
334100         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           33410000
334200         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    33420000
334300                                     TO DP013-MESSAGE-TEXT(1)     33430000
334400         PERFORM DP013-0000-PROCESS-ABEND                         33440000
334500     END-IF.                                                      33450000
334600                                                                  33460000
334700*-----------------------------------------------------------------33470000
334800*  READ THE LIST QUEUE RECORD                                     33480000
334900*-----------------------------------------------------------------33490000
335000 9100-READ-SEL-QUEUE.                                             33500000
335100                                                                  33510000
335200     EXEC CICS                                                    33520000
335300         READQ TS                                                 33530000
335400             QUEUE (ASC-SEL-QUEUE-NAME)                           33540000
335500             INTO  (PC212-SELECT-RECORD)                          33550000
335600             ITEM  (ASC-SEL-ITEM)                                 33560000
335700             RESP  (PV-CICS-RESP)                                 33570000
335800     END-EXEC.                                                    33580000
335900     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        33590000
336000         CONTINUE                                                 33600000
336100     ELSE                                                         33610000
336200         SET DP013-LOGIC-ABEND                                    33620000
336300             DP013-NO-ROLLBACK   TO   TRUE                        33630000
336400         MOVE '9100-READ-SEL-QUEUE' TO   DP013-PARAGRAPH          33640000
336500         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   33650000
336600                                 TO   DP013-MESSAGE-TEXT (1)      33660000
336700         PERFORM DP013-0000-PROCESS-ABEND                         33670000
336800     END-IF.                                                      33680000
336900                                                                  33690000
337000*-----------------------------------------------------------------33700000
337100* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *33710000
337200*-----------------------------------------------------------------33720000
337300 9200-REWRITE-SEL-QUEUE.                                          33730000
337400                                                                  33740000
337500     EXEC CICS                                                    33750000
337600          WRITEQ TS                                               33760000
337700              QUEUE  (ASC-SEL-QUEUE-NAME)                         33770000
337800              FROM   (PC212-SELECT-RECORD)                        33780000
337900              ITEM   (ASC-SEL-ITEM)                               33790000
338000              RESP   (PV-CICS-RESP)                               33800000
338100              REWRITE                                             33810000
338200     END-EXEC.                                                    33820000
338300                                                                  33830000
338400     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   33840000
338500         SET DP013-CICS-ABEND                                     33850000
338600             DP013-NO-ROLLBACK     TO TRUE                        33860000
338700         MOVE '9200-REWRITE-SEL-QUEUE'                            33870000
338800                                   TO DP013-PARAGRAPH             33880000
338900         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   33890000
339000                                   TO DP013-MESSAGE-TEXT (1)      33900000
339100         PERFORM DP013-0000-PROCESS-ABEND                         33910000
339200     END-IF.                                                      33920000
339300                                                                  33930000
339400*----------------------------------------------------------------*33940000
339500*    THE DB2 RESOURCE IS NOT AVAILABLE, DISPLAY A MESSAGE ON     *33950000
339600*    THE TERMINAL INDICATING THAT THE RESOURCE IS UNAVAILABLE.   *33960000
339700*----------------------------------------------------------------*33970000
339800 9900-SOFT-ABORT.                                                 33980000
339900                                                                  33990000
340000     EXEC CICS SYNCPOINT                                          34000000
340100          ROLLBACK                                                34010000
340200     END-EXEC.                                                    34020000
340300                                                                  34030000
340400     SET  PS-ERROR                                                34040000
340500          PS-SOFT-ABORT-ERROR                                     34050000
340600          DP020-MSG-FATAL       TO  TRUE.                         34060000
340700                                                                  34070000
340800*----------------------------------------------------------------*34080000
340900*    ABEND PROCESSOR MODULE                                      *34090000
341000*----------------------------------------------------------------*34100000
341100     COPY DPPD013.                                                34110000
