       IDENTIFICATION DIVISION.                                         00010001
       PROGRAM-ID.           PXKUT032.                                  00020001
       AUTHOR.               D. WELLER                                  00030001
       INSTALLATION.         KOHLS DEPARTMENT STORES.                   00040001
       DATE-WRITTEN          03/07/2007.                                00050001
       DATE-COMPILED.                                                   00060001
                                                                        00070001
      ******************************************************************00080001
      *   PXKUT032 - TRUNCATE FILE                                      00090001
      *                                                                 00100001
      *   THIS PROGRAM SEQUENTIALLY READS AN INPUT FILE (PXRD040)       00110001
      *   AND USES CREATES A TRUNCATED OUTPUT FILE (PXRD041) BY         00120003
      *   REMOVING 3 FIELDS:                                            00130001
      *       EVNT-CTG-CDE                                              00140001
      *       PRCHG-TYP-CDE                                             00141001
      *       SKU-NBR                                                   00142001
      ******************** HISTORY OF CHANGES **************************00150001
      * CHG ID/                                                        *00160001
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES                    *00170001
      * -------  ----------  ----------------------------------------  *00180001
      ******************************************************************00190001
                                                                        00200001
       ENVIRONMENT DIVISION.                                            00210001
                                                                        00220001
       CONFIGURATION SECTION.                                           00230001
                                                                        00240001
       SOURCE-COMPUTER. IBM-3090.                                       00250001
       OBJECT-COMPUTER. IBM-3090.                                       00260001
                                                                        00270001
       INPUT-OUTPUT SECTION.                                            00280001
       FILE-CONTROL.                                                    00290001
                                                                        00320001
           SELECT EXTRACT-FILE                                          00330001
               ASSIGN TO INP01.                                         00340001
                                                                        00350001
           SELECT TRUNCATED-FILE                                        00360001
               ASSIGN TO OUT01.                                         00370001
                                                                        00410001
       DATA DIVISION.                                                   00420001
                                                                        00430001
       FILE SECTION.                                                    00440001
       FD  EXTRACT-FILE                                                 00510001
           LABEL RECORDS ARE STANDARD                                   00520001
           RECORDING MODE IS F                                          00530001
           BLOCK CONTAINS 0 RECORDS.                                    00540001
       01  EXTRACT-RECORD                  PIC X(213).                  00550008
                                                                        00560001
       FD  TRUNCATED-FILE                                               00570001
           LABEL RECORDS ARE STANDARD                                   00580001
           RECORDING MODE IS F                                          00590001
           BLOCK CONTAINS 0 RECORDS.                                    00600001
       01  TRUNCATED-RECORD                PIC X(193).                  00610001
                                                                        00680001
       WORKING-STORAGE SECTION.                                         00690001
                                                                        00700001
      ***************************************************************** 00710001
      *  EXTRACT RECORD LAYOUT                                          00720001
      ***************************************************************** 00730001
      *01  PXRD040-EXTRACT-RECORD.                                      00740001
           COPY PXRD040.                                                00750001
                                                                        01010001
      ***************************************************************** 01020001
      *  TRUNCATED RECORD LAYOUT                                        01030001
      ***************************************************************** 01040001
      *01  PXRD041-TRUNCATED-RECORD.                                    01050001
           COPY PXRD041.                                                01060001
                                                                        01130001
      ***************************************************************** 01140001
      *  PROGRAM'S CONSTANTS                                          * 01150001
      ***************************************************************** 01160001
       01  PC-PROGRAM-CONSTANTS.                                        01170001
           05  PC-PROGRAM-NAME             PIC X(08)       VALUE        01190001
               'PXKUT032'.                                              01200001
                                                                        01230001
      ***************************************************************** 01240001
      *  PROGRAM'S SWITCHES                                           * 01250001
      ***************************************************************** 01260001
       01  PS-PROGRAM-SWITCHES.                                         01270001
           05  PS-END-OF-INPUT-FILE-SW     PIC X(01)       VALUE 'N'.   01280001
               88  PS-END-OF-INPUT-FILE                    VALUE 'Y'.   01290001
               88  PS-NOT-END-OF-INPUT-FILE                VALUE 'N'.   01300001
                                                                        01690001
      ***************************************************************** 01700001
      *  PROGRAM'S VARIABLES                                          * 01710001
      ***************************************************************** 01720001
       01  PV-PROGRAM-VARIABLES.                                        01730001
           05  PV-PARAGRAPH-NAME           PIC X(40)       VALUE SPACES.01750001
           05  PV-RECORDS-READ             PIC 9(08)       VALUE 0.     01790010
           05  PV-RECORDS-WRITTEN          PIC 9(08)       VALUE 0.     01800010
                                                                        01810001
      ***************************************************************** 01820001
      *  ABEND CODE AREA                                              * 01830001
      ***************************************************************** 01840001
       01  PV-ABEND-CODE                   PIC S9(04)      VALUE ZEROES 01850001
                               COMP SYNC.                               01860001
           88  ABEND-4001-INV-WRITE-KEY                    VALUE +4001. 01870001
           88  ABEND-4002-INV-READ-KEY                     VALUE +4002. 01880001
           88  ABEND-4003-CNTL-CARD-ERRORS                 VALUE +4003. 01890001
           88  ABEND-4004-SEQUENCE-ERROR                   VALUE +4004. 01900001
           88  ABEND-4005-OPEN-FILE-ERROR                  VALUE +4005. 01910001
           88  ABEND-4006-CLOSE-FILE-ERROR                 VALUE +4006. 01920001
           88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 01930001
           88  ABEND-4009-INVALID-DATA                     VALUE +4009. 01940001
           88  ABEND-4012-BAD-INTR-SORT                    VALUE +4012. 01950001
           88  ABEND-4013-DB-ERROR                         VALUE +4013. 01960001
                                                                        01980001
       01  WS-MSG-TEXT                     PIC X(512)      VALUE SPACES.01990001
       01  WS-MAX-SIZE                     PIC S9(09)      VALUE +512   02000001
                               COMP.                                    02010001
       01  WS-MSG-LENGTH                   PIC S9(09)      VALUE ZEROES 02020001
                               COMP.                                    02030001
                                                                        02790001
       PROCEDURE DIVISION.                                              02800001
                                                                        02810001
      ******************************************************************02820001
      *    MAINLINE LOGIC                                              *02830001
      ******************************************************************02840001
                                                                        02850001
       0000-MAINLINE.                                                   02860001
                                                                        02870001
           PERFORM 1000-INITIALIZATION.                                 02880001
                                                                        02890001
           PERFORM 2000-PROCESS-INPUT                                   02900001
               UNTIL PS-END-OF-INPUT-FILE.                              02910001
                                                                        02920001
           PERFORM 9900-EOJ-LOGIC.                                      02930001
                                                                        02980001
           GOBACK.                                                      02990001
                                                                        03000001
      ******************************************************************03010001
      *    LOGON TO ORACLE, AND DECLARE THE ORACLE CURSORS.            *03020001
      ******************************************************************03030001
       1000-INITIALIZATION.                                             03040001
                                                                        03050001
           OPEN INPUT                                                   03060001
                       EXTRACT-FILE                                     03070001
                OUTPUT                                                  03080001
                       TRUNCATED-FILE.                                  03090001
                                                                        03100001
                                                                        03420001
           PERFORM 6100-READ-EXTRACT-FILE.                              03430001
           IF PS-END-OF-INPUT-FILE                                      03440001
               DISPLAY ' *** NOTHING TO PROCESS ***'                    03450001
               DISPLAY ' '                                              03460001
           END-IF.                                                      03490001
                                                                        04040001
      ******************************************************************04050001
      *    2000-PROCESS-INPUT                                          *04060001
      *      THIS IS PERFORMED ONLY VIA THE 0000-MAINLINE              *04070001
      *      PURPOSE: READ AND PROCESS THE PURCHASE ADJUSTMENT FILE    *04080001
      *               TO UPDATE THE DAT_AVL_VND_FUND TABLE             *04090001
      ******************************************************************04100001
       2000-PROCESS-INPUT.                                              04110001
                                                                        04120001
           PERFORM 7000-PROCESS-INPUT.                                  04130001
                                                                        04140001
           PERFORM 6100-READ-EXTRACT-FILE.                              04150001
                                                                        04250001
      ******************************************************************04260001
      *  READ EXTRACT FILE                                              04270001
      ******************************************************************04280001
       6100-READ-EXTRACT-FILE.                                          04290001
                                                                        04300001
           READ EXTRACT-FILE INTO PXRD040-EXTRACT-RECORD                04310002
               AT END SET PS-END-OF-INPUT-FILE TO TRUE.                 04320001
                                                                        04330001
           IF PS-NOT-END-OF-INPUT-FILE                                  04340001
               ADD 1 TO PV-RECORDS-READ                                 04350001
           END-IF.                                                      04360001
                                                                        04510001
      ******************************************************************04520001
      *  WRITE OUT TRUNCATED RECORD                                     04530001
      ******************************************************************04540001
       6300-WRITE-TRUNCATED-FILE.                                       04550001
                                                                        04600001
           WRITE TRUNCATED-RECORD FROM PXRD041-TRUNCATED-RECORD.        04610002
           ADD 1                       TO PV-RECORDS-WRITTEN.           04611004
                                                                        04620001
      ******************************************************************04630001
      *  PROCESS INPUT                                                  04640001
      ******************************************************************04650001
       7000-PROCESS-INPUT.                                              04660001
                                                                        04670001
           MOVE '7000-PROCESS-INPUT'   TO PV-PARAGRAPH-NAME.            04680001
                                                                        04690001
           MOVE PXRD040-PRCHG-ID       TO PXRD041-PRCHG-ID.             04691001
           MOVE PXRD040-STR-GP-TYP-CDE TO PXRD041-STR-GP-TYP-CDE.       04692001
           MOVE PXRD040-STR-GP-ID      TO PXRD041-STR-GP-ID.            04694001
           MOVE PXRD040-EFF-DATE       TO PXRD041-EFF-DATE.             04695001
           MOVE PXRD040-STR-NBR        TO PXRD041-STR-NBR.              04695101
           MOVE PXRD040-LOC-NM         TO PXRD041-LOC-NM.               04695201
           MOVE PXRD040-BUS-AREA-ID    TO PXRD041-BUS-AREA-ID.          04695301
           MOVE PXRD040-BUS-AREA-DESC  TO PXRD041-BUS-AREA-DESC.        04695401
           MOVE PXRD040-DEPT-NBR       TO PXRD041-DEPT-NBR.             04695501
           MOVE PXRD040-VS-NBR         TO PXRD041-VS-NBR.               04695601
           MOVE PXRD040-LBL-NM         TO PXRD041-LBL-NM.               04695701
           MOVE PXRD040-VS-DESC        TO PXRD041-VS-DESC.              04695801
           MOVE PXRD040-STKR-NBR       TO PXRD041-STKR-NBR.             04695901
           MOVE PXRD040-SUB-CL-NBR     TO PXRD041-SUB-CL-NBR.           04696001
           MOVE PXRD040-STR-EXPTED-QTY TO PXRD041-STR-EXPTED-QTY.       04696101
           MOVE PXRD040-IN-TRNST-QTY   TO PXRD041-IN-TRNST-QTY.         04696201
           MOVE PXRD040-UNT-RTL-AMT    TO PXRD041-UNT-RTL-AMT.          04696301
           MOVE PXRD040-LAST-UPD-TMST  TO PXRD041-LAST-UPD-TMST.        04696401
           IF PXRD040-LAST-NCLR-NULL-IND = X'6F'                        04696511
              MOVE ZEROES              TO PXRD041-LAST-NCLR-RTL-AMT     04696609
           ELSE                                                         04696709
              MOVE PXRD040-LAST-NCLR-RTL-AMT                            04696809
                                       TO PXRD041-LAST-NCLR-RTL-AMT     04696909
           END-IF.                                                      04697009
                                                                        04702001
           PERFORM 6300-WRITE-TRUNCATED-FILE.                           04710001
                                                                        05880001
      ******************************************************************05890001
      *    9900-EOJ-LOGIC.                                              05900001
      *      THIS IS PERFORMED AT END OF INPUT FILE.                    05910001
      *      PURPOSE: CLOSE INPUT FILE,                                 05920001
      *      DISPLAY RECORD COUNTS.                                     05930001
      ******************************************************************05940001
       9900-EOJ-LOGIC.                                                  05950001
                                                                        05960001
           CLOSE                                                        05970001
                 EXTRACT-FILE                                           05980001
                 TRUNCATED-FILE.                                        05990001
                                                                        06010001
           DISPLAY ' '.                                                 06020001
           DISPLAY 'RECORDS READ       ' PV-RECORDS-READ.               06030001
           DISPLAY 'PARAMETERS WRITTEN ' PV-RECORDS-WRITTEN.            06040001
           DISPLAY '**------ END ' PC-PROGRAM-NAME ' ------**'.         06050001
                                                                        06440001
      ******************************************************************06450001
      * PROGRAM ABEND PARAGRAPH                                         06460001
      ******************************************************************06470001
       9999-ABEND.                                                      06480001
                                                                        06490001
           CALL 'ILBOABN0'  USING PV-ABEND-CODE.                        06500001
                                                                        06510001
      ******************************************************************06520001
      *    END OF SOURCE CODE FOR PXKUT032                             *06530001
      ******************************************************************06540001
