000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.    ETKCS335.                                         00030000
000400 AUTHOR.        TESS BESTE.                                       00040000
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
000600 DATE-WRITTEN.  01-26-94.                                         00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900*-----------------------------------------------------------------00090000
001000*               E335 - NETWORK LIST PROGRAM                       00100000
001100*                                                                 00110000
001200* THIS PROGRAM GENERATES A LIST OF EDI NETWORKS. FOR EACH NETWORK,00120000
001300* IT LISTS THE NETWORK ID, NETWORK NAME, AND NETWORK TYPE. THE ADD00130000
001400* FUNCTION CAN BE INVOKED BY PRESSING THE ADD FUNCTION KEY, OR THE00140000
001500* UPDATE OR DELETE FUNCTION CAN BE INVOKED BY SELECTING ONE OR    00150000
001600* MORE ITEMS AND PRESSING THE UPDATE OR DELETE FUNCTION KEY.      00160000
001700*-----------------------------------------------------------------00170000
001710* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00171002
001720*            - CHANGE CALL OF DPKUT100 TO                       * 00172002
001730*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00173002
001740*              MAKING THE CALL DYNAMIC VS STATIC                * 00174002
001750*                                                               * 00175002
001760*---------------------------------------------------------------* 00176002
CICS  *  CHANGED 10/26/2022    BY BARB SCHULTZ    WR: CHG0277210      * 00177003
CICS  *                                                               * 00178003
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00179003
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00179103
CICS  *---------------------------------------------------------------* 00179303
001800                                                                  00180000
001900                                                                  00190000
002000 ENVIRONMENT DIVISION.                                            00200000
002100                                                                  00210000
002200 DATA DIVISION.                                                   00220000
002300                                                                  00230000
002400 WORKING-STORAGE SECTION.                                         00240000
002500                                                                  00250000
002600 01  PC-PROGRAM-CONSTANTS.                                        00260000
002700     05  PC-CURRENT-MAP-NAME          PIC  X(08)    VALUE         00270000
002800                                                         'ET335A'.00280000
002900     05  PC-CURRENT-MAPSET-NAME       PIC  X(08)    VALUE         00290000
003000                                                        'ETKM335'.00300000
003100     05  PC-CURRENT-PROGRAM-NAME      PIC  X(08)    VALUE         00310000
003200                                                       'ETKCS335'.00320000
003300     05  PC-LIST-QUEUE-SEQ            PIC  9        VALUE 1.      00330000
003400     05  PC-SEL-QUEUE-SEQ             PIC  9        VALUE 2.      00340000
003500     05  PC-ITEMS-PER-PANEL           PIC S9(4)     COMP SYNC     00350000
003600                                                    VALUE +12.    00360000
003700     05  PC-MAX-BLOCKS-IN-ARRAY       PIC S9(4)     COMP SYNC     00370000
003800                                                    VALUE +2.     00380000
003900     05  PC-MAX-ITEMS                 PIC S9(9)     COMP-3        00390000
004000                                                    VALUE         00400000
004100                                                         +1000000.00410000
004200     05  PC-ITEM-NUMBER-LENGTH        PIC S9(4)     COMP SYNC     00420000
004300                                                    VALUE +6.     00430000
004400     05  PC-INQ                       PIC  X(3)     VALUE 'INQ'.  00440000
004500     05  PC-ADD                       PIC  X(3)     VALUE 'ADD'.  00450000
004600     05  PC-UPD                       PIC  X(3)     VALUE 'UPD'.  00460000
004700     05  PC-DEL                       PIC  X(3)     VALUE 'DEL'.  00470000
004800     05  PC-ERR                       PIC  X(3)     VALUE 'ERR'.  00480000
004900                                                                  00490000
005000     05  PC-TSYMSG-NUMBERS.                                       00500000
005100         10  PC-TSYMSG-00005          PIC  9(5)     VALUE 00005.  00510000
005200         10  PC-TSYMSG-00008          PIC  9(5)     VALUE 00008.  00520000
005300         10  PC-TSYMSG-00050          PIC  9(5)     VALUE 00050.  00530000
005400         10  PC-TSYMSG-00051          PIC  9(5)     VALUE 00051.  00540000
005500         10  PC-TSYMSG-00052          PIC  9(5)     VALUE 00052.  00550000
005600         10  PC-TSYMSG-00053          PIC  9(5)     VALUE 00053.  00560000
005700         10  PC-TSYMSG-00054          PIC  9(5)     VALUE 00054.  00570000
005800         10  PC-TSYMSG-00055          PIC  9(5)     VALUE 00055.  00580000
005900         10  PC-TSYMSG-00057          PIC  9(5)     VALUE 00057.  00590000
006000         10  PC-TSYMSG-00069          PIC  9(5)     VALUE 00069.  00600000
006100         10  PC-TSYMSG-00070          PIC  9(5)     VALUE 00070.  00610000
006200         10  PC-TSYMSG-00101          PIC  9(5)     VALUE 00101.  00620000
006300         10  PC-TSYMSG-00279          PIC  9(5)     VALUE 00279.  00630000
006400         10  PC-TSYMSG-00551          PIC  9(5)     VALUE 00551.  00640000
006500     05  PC-NETWK-TYPE-CDE-0-DESC     PIC  X(12)    VALUE         00650000
006600                                                   'DIAL UP'.     00660000
006700     05  PC-NETWK-TYPE-CDE-1-DESC     PIC  X(12)    VALUE         00670000
006800                                                   'LEASE LINE'.  00680000
006900     05  PC-NETWK-TYPE-CDE-2-DESC     PIC  X(12)    VALUE         00690000
007000                                                   'INTERCONNECT'.00700000
007100                                                                  00710000
007200 01  PS-PROGRAM-SWITCHES.                                         00720000
007300     05  PS-ERROR-SW                  PIC  X        VALUE 'Y'.    00730000
007400         88  PS-NO-ERROR                            VALUE 'Y'.    00740000
007500         88  PS-ERROR                               VALUE 'N'.    00750000
007600     05  PS-START-ITEM-ERROR-SW       PIC  X        VALUE 'Y'.    00760000
007700         88  PS-NO-START-ITEM-ERROR                 VALUE 'Y'.    00770000
007800         88  PS-START-ITEM-ERROR                    VALUE 'N'.    00780000
007900                                                                  00790000
008000 01  PV-PROGRAM-VARIABLES.                                        00800000
008100     05  PV-SUB                       PIC S9(4)     COMP SYNC     00810000
008200                                                    VALUE +0.     00820000
008300     05  PV-REMAINDER                 PIC S9(4)     COMP SYNC     00830000
008400                                                    VALUE +0.     00840000
008500     05  PV-READ-COUNT                PIC S9(9)     COMP-3        00850000
008600                                                    VALUE +0.     00860000
008700     05  PV-ITEMS-PROCESSED           PIC S9(9)     COMP-3        00870000
008800                                                    VALUE +0.     00880000
008900     05  PV-HOLD-SELECTED-ITEMS       PIC S9(9)     COMP-3        00890000
009000                                                    VALUE +0.     00900000
009100     05  PV-ITEM-IN-USE               PIC S9(9)     COMP-3        00910000
009200                                                    VALUE +0.     00920000
009300     05  PV-TOP-ITEM                  PIC S9(9)     COMP-3        00930000
009400                                                    VALUE +0.     00940000
009500     05  PV-BOTTOM-ITEM               PIC S9(9)     COMP-3        00950000
009600                                                    VALUE +0.     00960000
009700     05  PV-TEMP-BLOCK-NUMBER         PIC S9(9)     COMP-3        00970000
009800                                                    VALUE +0.     00980000
009900     05  PV-BLOCK-NUMBER              PIC S9(4)     COMP SYNC     00990000
010000                                                    VALUE +0.     01000000
010100     05  PV-CICS-RESP                 PIC S9(4)     COMP SYNC     01010000
010200                                                    VALUE +0.     01020000
010300     05  PV-ITEM                      PIC S9(4)     COMP SYNC     01030000
010400                                                    VALUE +0.     01040000
010500     05  PV-SEL-QUEUE-ITEM            PIC S9(4)     COMP SYNC     01050000
010600                                                    VALUE +0.     01060000
010700     05  PV-SAVE-ITEM                 PIC S9(4)     COMP SYNC     01070000
010800                                                    VALUE +0.     01080000
010900     05  PV-HIGHEST-BLOCK-WRITTEN     PIC S9(4)     COMP SYNC     01090000
011000                                                    VALUE +0.     01100000
011100     05  PV-LIST-ITEM-NUMBER          PIC S9(4)     COMP SYNC     01110000
011200                                                    VALUE +0.     01120000
011300     05  PV-FIRST-BLOCK-IN-ARRAY      PIC S9(4)     COMP SYNC     01130000
011400                                                    VALUE +0.     01140000
011500     05  PV-NEXT-BLOCK-IN-ARRAY       PIC S9(4)     COMP SYNC     01150000
011600                                                    VALUE +0.     01160000
011700     05  PV-PREV-BLOCK-IN-ARRAY       PIC S9(4)     COMP SYNC     01170000
011800                                                    VALUE +0.     01180000
011900     05  PV-FIRST-BLOCK-IN-RANGE      PIC S9(4)     COMP SYNC     01190000
012000                                                    VALUE +0.     01200000
012100     05  PV-LAST-BLOCK-IN-RANGE       PIC S9(4)     COMP SYNC     01210000
012200                                                    VALUE +0.     01220000
012300     05  PV-START-OF-SELECTED-RANGE   PIC S9(4)     COMP SYNC     01230000
012400                                                    VALUE +0.     01240000
012500     05  PV-END-OF-SELECTED-RANGE     PIC S9(4)     COMP SYNC     01250000
012600                                                    VALUE +0.     01260000
012700                                                                  01270000
012800*-----------------------------------------------------------------01280000
012900* THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE. THERE 01290000
013000* MUST BE A BLOCK IN THE APPLICATION SPECIFIC COMMAREA WITH AN    01300000
013100* IDENTICAL LAYOUT.                                               01310000
013200*-----------------------------------------------------------------01320000
013300 01  LQW-LIST-QUEUE-WORK-AREA.                                    01330000
013400     05  LQW-BLOCK-MODIFIED           PIC  X(01)    VALUE SPACE.  01340000
013500     05  LQW-ITEM-ENTRIES             OCCURS 12 TIMES             01350000
013600                                      INDEXED BY LQW-IDX.         01360000
013700         10  LQW-LIST-ITEM-NUMBER     PIC S9(9)     COMP-3.       01370000
013800         10  LQW-TEMP-SELECTED-SW     PIC  X.                     01380000
013900         10  LQW-SELECTED-SW          PIC  X.                     01390000
014000             88  LQW-SELECT                         VALUE 'S'.    01400000
014100             88  LQW-DESELECT                       VALUE SPACE.  01410000
014200         10  LQW-ACTION               PIC  X(3).                  01420000
014300         10  LQW-NETWK-ID             PIC  X.                     01430000
014400         10  LQW-NETWK-NME            PIC  X(15).                 01440000
014500         10  LQW-NETWK-TYPE-CDE-DESC  PIC  X(12).                 01450000
014600                                                                  01460000
014700*---------------------------------------------------------------* 01470000
014800*  RECORD LAYOUT FOR THE NETWORK LIST TEMP STORAGE QUEUE.       * 01480000
014900*---------------------------------------------------------------* 01490000
015000     COPY ETWS335.                                                01500000
015100                                                                  01510000
015200*---------------------------------------------------------------* 01520000
015300*    MAP LAYOUT                                                 * 01530000
015400*---------------------------------------------------------------* 01540000
015500     COPY ETKM335.                                                01550000
015600                                                                  01560000
015700 01  MR-MAP-REDEFINITION              REDEFINES ET335AO.          01570000
015800     05  FILLER                       PIC X(48).                  01580000
015900     05  MR-SCROLL-AREA               OCCURS 12 TIMES.            01590000
016000         10  MR-SELECTL               PIC S9(04)    COMP.         01600000
016100         10  MR-SELECTA               PIC  X.                     01610000
016200         10  MR-SELECTC               PIC  X.                     01620000
016300         10  MR-SELECTH               PIC  X.                     01630000
016400         10  MR-SELECTI               PIC  X.                     01640000
016500                                                                  01650000
016600         10  MR-ACTIONL               PIC S9(04)    COMP.         01660000
016700         10  MR-ACTIONA               PIC  X.                     01670000
016800         10  MR-ACTIONC               PIC  X.                     01680000
016900         10  MR-ACTIONH               PIC  X.                     01690000
017000         10  MR-ACTION                PIC  X(3).                  01700000
017100                                                                  01710000
017200         10  MR-NETWORK-IDL           PIC S9(04)    COMP.         01720000
017300         10  MR-NETWORK-IDA           PIC  X.                     01730000
017400         10  MR-NETWORK-IDC           PIC  X.                     01740000
017500         10  MR-NETWORK-IDH           PIC  X.                     01750000
017600         10  MR-NETWORK-ID            PIC  X.                     01760000
017700                                                                  01770000
017800         10  MR-NETWORK-NAMEL         PIC S9(04)    COMP.         01780000
017900         10  MR-NETWORK-NAMEA         PIC  X.                     01790000
018000         10  MR-NETWORK-NAMEC         PIC  X.                     01800000
018100         10  MR-NETWORK-NAMEH         PIC  X.                     01810000
018200         10  MR-NETWORK-NAME          PIC  X(15).                 01820000
018300                                                                  01830000
018400         10  MR-NETWORK-TYPEL         PIC S9(04)    COMP.         01840000
018500         10  MR-NETWORK-TYPEA         PIC  X.                     01850000
018600         10  MR-NETWORK-TYPEC         PIC  X.                     01860000
018700         10  MR-NETWORK-TYPEH         PIC  X.                     01870000
018800         10  MR-NETWORK-TYPE          PIC  X(12).                 01880000
018900                                                                  01890000
019000*---------------------------------------------------------------* 01900000
019100*    ATTRIBUTE SETTINGS COPYBOOK.                               * 01910000
019200*---------------------------------------------------------------* 01920000
019300     COPY DPWS015.                                                01930000
019400                                                                  01940000
019500*---------------------------------------------------------------* 01950000
019600*    FUNCTION KEYS COPYBOOK.                                    * 01960000
019700*---------------------------------------------------------------* 01970000
019800     COPY DPWS016.                                                01980000
019900                                                                  01990000
020000*---------------------------------------------------------------* 02000000
020100*    NUMERIC EDIT LAYOUT.                                       * 02010000
020200*---------------------------------------------------------------* 02020000
020300     COPY DPWS010I.                                               02030000
020400                                                                  02040000
020500*---------------------------------------------------------------* 02050000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02060003
020700*---------------------------------------------------------------* 02070000
020800     COPY DPWS030.                                                02080000
CICS       COPY DPWS930.                                                02081003
020900                                                                  02090000
021000*---------------------------------------------------------------* 02100000
021100*    STANDARD COMMAREA.                                         * 02110000
021200*---------------------------------------------------------------* 02120000
021300     COPY DPWS020.                                                02130000
021400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02140000
021500                                                                  02150000
021600*---------------------------------------------------------------* 02160000
021700*  INTER-APPLICATION COMMAREA FOR THE NETWORK SCREENS.            02170000
021800*---------------------------------------------------------------* 02180000
021900         10  INTER-APPL-COMM-AREA       PIC X(200).               02190000
022000     COPY ETWS336.                                                02200000
022100                                                                  02210000
022200*---------------------------------------------------------------* 02220000
022300*  APPLICATION-SPECIFIC COMMAREA.                                 02230000
022400*---------------------------------------------------------------* 02240000
022500         10  ASC-SPECIFIC-COMMAREA.                               02250000
022600             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02260000
022700                 20  ASC-BLOCK-MODIFIED-SW                        02270000
022800                                      PIC  X.                     02280000
022900                     88  ASC-BLOCK-NOT-MODIFIED     VALUE 'N'.    02290000
023000                     88  ASC-BLOCK-MODIFIED         VALUE 'Y'.    02300000
023100                                                                  02310000
023200                 20  ASC-ITEM-ARRAY.                              02320000
023300                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        02330000
023400                         30  ASC-LIST-ITEM-NUMBER                 02340000
023500                                      PIC S9(9)     COMP-3.       02350000
023600                         30  ASC-TEMP-SELECTED-SW                 02360000
023700                                      PIC X.                      02370000
023800                             88  ASC-VALID-SELECT   VALUE SPACE   02380000
023900                                                          'S'     02390000
024000                                                          'B'     02400000
024100                                                          'E'.    02410000
024200                             88  ASC-TEMP-NO-SELECT VALUE SPACE.  02420000
024300                             88  ASC-TEMP-SELECT    VALUE 'S'.    02430000
024400                             88  ASC-TEMP-BEGIN     VALUE 'B'.    02440000
024500                             88  ASC-TEMP-END       VALUE 'E'.    02450000
024600                         30  ASC-SELECTED-SW                      02460000
024700                                      PIC X.                      02470000
024800                             88  ASC-NO-SELECT      VALUE SPACE.  02480000
024900                             88  ASC-SELECT         VALUE 'S'.    02490000
025000                             88  ASC-BEGIN          VALUE 'B'.    02500000
025100                             88  ASC-END            VALUE 'E'.    02510000
025200                         30  ASC-ACTION                           02520000
025300                                      PIC  X(3).                  02530000
025400                         30  ASC-NETWORK-ID                       02540000
025500                                      PIC  X.                     02550000
025600                         30  ASC-NETWORK-NAME                     02560000
025700                                      PIC  X(15).                 02570000
025800                         30  ASC-NETWORK-TYPE                     02580000
025900                                      PIC  X(12).                 02590000
026000             15  ASC-BLK-SUB          PIC S9(4)     COMP SYNC.    02600000
026100             15  ASC-ITEM-SUB         PIC S9(4)     COMP SYNC.    02610000
026200             15  ASC-NUMBER-OF-ITEMS-READ                         02620000
026300                                      PIC S9(9)     COMP-3.       02630000
026400             15  ASC-NUMBER-OF-SELECTED-ITEMS                     02640000
026500                                      PIC S9(9)     COMP-3.       02650000
026600             15  ASC-ITEMS-DISPLAYED  PIC S9(3)     COMP-3.       02660000
026700             15  ASC-ITEM-AT-TOP-OF-PANEL                         02670000
026800                                      PIC S9(9)     COMP-3.       02680000
026900             15  ASC-ITEM-AT-BOT-OF-PANEL                         02690000
027000                                      PIC S9(9)     COMP-3.       02700000
027100             15  ASC-HIGHEST-BLOCK-WRITTEN                        02710000
027200                                      PIC S9(4)     COMP SYNC.    02720000
027300             15  ASC-START-OF-SELECTED-RANGE                      02730000
027400                                      PIC S9(9)     COMP-3.       02740000
027500             15  ASC-END-OF-SELECTED-RANGE                        02750000
027600                                      PIC S9(9)     COMP-3.       02760000
027700             15  ASC-ITEMS-LEFT-INDICATOR                         02770000
027800                                      PIC X.                      02780000
027900                 88  ASC-ITEMS-LEFT-ON-DB           VALUE 'Y'.    02790000
028000                 88  ASC-NO-ITEMS-LEFT-ON-DB        VALUE 'N'.    02800000
028100             15  ASC-TEMP-QUEUE-UPDATE-SW                         02810000
028200                                      PIC X.                      02820000
028300                 88  ASC-UPDATE-TSQ                 VALUE 'Y'.    02830000
028400                 88  ASC-NO-TSQ-UPDATE              VALUE SPACE.  02840000
028500             15  ASC-LIST-QUEUE-NAME.                             02850000
028600                 20  ASC-LIST-TERM-ID PIC  X(4).                  02860000
028700                 20  ASC-LIST-TASK-NUMBER                         02870000
028800                                      PIC S9(5)     COMP-3.       02880000
028900                 20  ASC-LIST-SEQ     PIC  9.                     02890000
029000             15  ASC-SEL-QUEUE-NAME.                              02900000
029100                 20  ASC-SEL-TERM-ID  PIC  X(4).                  02910000
029200                 20  ASC-SEL-TASK-NUMBER                          02920000
029300                                      PIC S9(5)     COMP-3.       02930000
029400                 20  ASC-SEL-SEQ      PIC  9.                     02940000
029500             15  ASC-START-ITEM-REQUEST.                          02950000
029600                 20  ASC-START-ITEM-REQUEST-N                     02960000
029700                                      PIC  9(5).                  02970000
029800         10  FILLER                   PIC  X(1889).               02980000
029900                                                                  02990000
030000*---------------------------------------------------------------* 03000000
030100*    ABEND PROCESSING COPYBOOK.                                 * 03010000
030200*---------------------------------------------------------------* 03020000
030300     COPY DPWS013.                                                03030000
030400                                                                  03040000
030500*---------------------------------------------------------------* 03050000
030600*    DB2 AREA FOR NETWORK TABLE                                   03060000
030700*---------------------------------------------------------------* 03070000
030800     EXEC SQL                                                     03080000
030900          INCLUDE TNETWRK                                         03090000
031000     END-EXEC.                                                    03100000
031100                                                                  03110000
031200*---------------------------------------------------------------* 03120000
031300*    DB2 AREA FOR COMMUNICATIONS                                * 03130000
031400*---------------------------------------------------------------* 03140000
031500     EXEC SQL                                                     03150000
031600          INCLUDE SQLCA                                           03160000
031700     END-EXEC.                                                    03170000
031800                                                                  03180000
031900*---------------------------------------------------------------* 03190000
032000*    NETWORK CURSOR. SELECT ALL NETWORKS.                       * 03200000
032100*---------------------------------------------------------------* 03210000
032200     EXEC SQL                                                     03220000
032300         DECLARE  TNETWRK-CSR CURSOR FOR                          03230000
032400         SELECT   NETWK_ID                                        03240000
032500                , NETWK_NME                                       03250000
032600                , NETWK_TYPE_CDE                                  03260000
032700         FROM     TNETWRK                                         03270000
032800         ORDER BY NETWK_ID                                        03280000
032900     END-EXEC.                                                    03290000
033000                                                                  03300000
033100                                                                  03310000
033200 LINKAGE SECTION.                                                 03320000
033300                                                                  03330000
033400 01  DFHCOMMAREA.                                                 03340000
033500     05  FILLER                         OCCURS  1 TO 4072 TIMES   03350000
033600                                        DEPENDING ON EIBCALEN.    03360000
033700         10  FILLER                     PIC X.                    03370000
033800 EJECT                                                            03380000
033900 PROCEDURE DIVISION.                                              03390000
034000                                                                  03400000
034100*-----------------------------------------------------------------03410000
034200* THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.     03420000
034300* CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM PROCESSING, 03430000
034400* AND CALL THE CICS ARCHITECTURE API TO EXIT.                     03440000
034500*-----------------------------------------------------------------03450000
034600 0000-MAIN-MODULE.                                                03460000
034700                                                                  03470000
034800     INITIALIZE DP030-CICS-API-FIELDS.                            03480000
034900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03490000
035000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03500000
035100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03510000
035200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03520000
035300     MOVE LENGTH OF ET335AI        TO DP030-MAP-LENGTH (1).       03530000
035400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03540000
035500     PERFORM 0001-CALL-CICS-ARCH-API.                             03550000
035600                                                                  03560000
035700     PERFORM 1000-CONTROL-PROCESSING                              03570000
035800                                                                  03580000
035900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03590000
036000     PERFORM 0001-CALL-CICS-ARCH-API.                             03600000
036100                                                                  03610000
036200                                                                  03620000
036300*-----------------------------------------------------------------03630000
036400* THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE. IT   03640000
036500* WILL ABEND IF ANY ERRORS OCCUR IN THAT CALL.                    03650000
036600*-----------------------------------------------------------------03660000
036700 0001-CALL-CICS-ARCH-API.                                         03670000
036800                                                                  03680000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03690003
037000                                    DFHCOMMAREA                   03700003
037100                                    DP030-CICS-API-FIELDS         03710003
037200                                    DP020-STANDARD-COMMAREA       03720003
037300                                    ET335AI.                      03730003
037400                                                                  03740000
037500     IF  DP030-RC-CALL-SUCCESSFUL                                 03750000
037600         CONTINUE                                                 03760000
037700     ELSE                                                         03770000
037800         SET DP013-NO-ROLLBACK                                    03780000
037900             DP013-XCTL-DISPLAY-RESTART                           03790000
038000             DP013-CICS-ABEND      TO TRUE                        03800000
038100         MOVE '0001-CALL-CICS-ARCH-API'                           03810000
038200                                   TO DP013-PARAGRAPH             03820000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03830003
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03840003
038500         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      03850000
038600         PERFORM DP013-0000-PROCESS-ABEND                         03860000
038700     END-IF.                                                      03870000
038800                                                                  03880000
038900*-----------------------------------------------------------------03890000
039000* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *03900000
039100* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *03910000
039200*                                                                *03920000
039300* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *03930000
039400*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *03940000
039500*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *03950000
039600*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *03960000
039700*-----------------------------------------------------------------03970000
039800 1000-CONTROL-PROCESSING.                                         03980000
039900                                                                  03990000
040000     EVALUATE TRUE                                                04000000
040100         WHEN DP020-NEXT-ACT-INITIAL                              04010000
040200             INITIALIZE ASC-SPECIFIC-COMMAREA                     04020000
040300             MOVE EIBTRMID              TO ASC-LIST-TERM-ID       04030000
040400                                           ASC-SEL-TERM-ID        04040000
040500             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   04050000
040600                                           ASC-SEL-TASK-NUMBER    04060000
040700             MOVE PC-LIST-QUEUE-SEQ     TO ASC-LIST-SEQ           04070000
040800             MOVE PC-SEL-QUEUE-SEQ      TO ASC-SEL-SEQ            04080000
040900             MOVE SPACE                 TO ASC-START-ITEM-REQUEST 04090000
041000             PERFORM 4000-BUILD-INITIAL-PANEL                     04100000
041100                                                                  04110000
041200         WHEN DP020-NEXT-ACT-READ-MAP                             04120000
041300             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         04130000
041400             PERFORM 2000-PROCESS-PANEL                           04140000
041500                                                                  04150000
041600         WHEN DP020-NEXT-ACT-RETURN                               04160000
041700             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04170000
041800                                   TO PV-TOP-ITEM                 04180000
041900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    04190000
042000             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 04200000
042100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04210000
042200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04220000
042300                                                                  04230000
042400         WHEN OTHER                                               04240000
042500             SET DP013-LOGIC-ABEND                                04250000
042600                 DP013-NO-ROLLBACK TO TRUE                        04260000
042700             MOVE '1000-CONTROL-PROCESSING'                       04270000
042800                                   TO DP013-PARAGRAPH             04280000
042900             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    04290000
043000                                   TO DP013-MESSAGE-TEXT(1)       04300000
043100             PERFORM DP013-0000-PROCESS-ABEND                     04310000
043200     END-EVALUATE.                                                04320000
043300                                                                  04330000
043400                                                                  04340000
043500*-----------------------------------------------------------------04350000
043600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04360000
043700* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04370000
043800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04380000
043900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04390000
044000* FUNCTION KEYS CAN GET THIS FAR.                                *04400000
044100*-----------------------------------------------------------------04410000
044200 2000-PROCESS-PANEL.                                              04420000
044300                                                                  04430000
044400     EVALUATE TRUE                                                04440000
044500         WHEN DP020-SRC-AID = DP016-CLEAR                         04450000
044600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    04460000
044700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04470000
044800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04480000
044900                                                                  04490000
045000         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    04500000
045100             PERFORM 2050-DELETE-LIST-QUEUE                       04510000
045200             PERFORM 4000-BUILD-INITIAL-PANEL                     04520000
045300                                                                  04530000
045400         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    04540000
045500             PERFORM 2140-DESELECT-ALL-ITEMS                      04550000
045600             PERFORM 3200-RESET-ATTRIBUTES                        04560000
045700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04570000
045800                                                                  04580000
045900         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  04590000
046000             PERFORM 2150-SELECT-ALL-ITEMS                        04600000
046100             PERFORM 3200-RESET-ATTRIBUTES                        04610000
046200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04620000
046300                                                                  04630000
046400         WHEN DP020-FK-GO-TO-TRAN (DP020-SRC-AID)                 04640000
046500             CONTINUE                                             04650000
046600                                                                  04660000
046700         WHEN OTHER                                               04670000
046800             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 04680000
046900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04690000
047000             IF  PS-NO-ERROR                                      04700000
047100                 SET DP030-CONTINUE-GO TO TRUE                    04710000
047200                 PERFORM 2100-CHECK-FUNCTION-KEY                  04720000
047300             ELSE                                                 04730000
047400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             04740000
047500                 SET DP030-OVERRIDE-GO TO TRUE                    04750000
047600             END-IF                                               04760000
047700     END-EVALUATE.                                                04770000
047800                                                                  04780000
047900                                                                  04790000
048000*-----------------------------------------------------------------04800000
048100*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *04810000
048200*-----------------------------------------------------------------04820000
048300 2050-DELETE-LIST-QUEUE.                                          04830000
048400                                                                  04840000
048500     EXEC CICS                                                    04850000
048600         DELETEQ TS                                               04860000
048700             QUEUE (ASC-LIST-QUEUE-NAME)                          04870000
048800             RESP  (PV-CICS-RESP)                                 04880000
048900     END-EXEC.                                                    04890000
049000                                                                  04900000
049100     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       04910000
049200        (PV-CICS-RESP = DFHRESP(QIDERR))                          04920000
049300         CONTINUE                                                 04930000
049400     ELSE                                                         04940000
049500         SET DP013-CICS-ABEND                                     04950000
049600             DP013-NO-ROLLBACK     TO TRUE                        04960000
049700                                                                  04970000
049800         MOVE '2050-DELETE-LIST-QUEUE'                            04980000
049900                                   TO DP013-PARAGRAPH             04990000
050000         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    05000000
050100                                   TO DP013-MESSAGE-TEXT (1)      05010000
050200         PERFORM DP013-0000-PROCESS-ABEND                         05020000
050300     END-IF.                                                      05030000
050400                                                                  05040000
050500     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  05050000
050600                                                                  05060000
050700                                                                  05070000
050800*-----------------------------------------------------------------05080000
050900* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*05090000
051000* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *05100000
051100* CICS ARCHITECTURE API.                                         *05110000
051200*-----------------------------------------------------------------05120000
051300 2100-CHECK-FUNCTION-KEY.                                         05130000
051400                                                                  05140000
051500     EVALUATE TRUE                                                05150000
051600         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 05160000
051700             IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO               05170000
051800                 INITIALIZE ET336-NUMBER-OF-TS-ITEMS              05180000
051900                            ET336-SEL-QUEUE-NAME                  05190000
052000                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                05200000
052100                                TO ET336-NUMBER-OF-SELECTED-ITEMS 05210000
052200                 PERFORM 5000-PREPARE-SEL-QUEUE                   05220000
052300             ELSE                                                 05230000
052400                 SET DP030-OVERRIDE-GO TO TRUE                    05240000
052500*                ---- A LIST ITEM MUST BE SELECTED ----           05250000
052600                 MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER        05260000
052700                 SET DP020-MSG-WARNING TO TRUE                    05270000
052800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05280000
052900             END-IF                                               05290000
053000                                                                  05300000
053100         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  05310000
053200             MOVE +1               TO PV-TOP-ITEM                 05320000
053300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05330000
053400                                                                  05340000
053500         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   05350000
053600             PERFORM 2110-BROWSE-BACKWARD                         05360000
053700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05370000
053800                                                                  05380000
053900         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   05390000
054000             PERFORM 2120-BROWSE-FORWARD                          05400000
054100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05410000
054200                                                                  05420000
054300         WHEN DP020-SRC-AID = DP016-ENTER                         05430000
054400             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   05440000
054500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05450000
054600                                                                  05460000
054700         WHEN OTHER                                               05470000
054800             SET DP013-NO-ROLLBACK                                05480000
054900                 DP013-XCTL-DISPLAY-RESTART                       05490000
055000                 DP013-CICS-ABEND  TO TRUE                        05500000
055100             MOVE '2100-CHECK-FUNCTION-KEY'                       05510000
055200                                   TO DP013-PARAGRAPH             05520000
055300             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05530000
055400                                   TO DP013-MESSAGE-TEXT (1)      05540000
055500             PERFORM DP013-0000-PROCESS-ABEND                     05550000
055600     END-EVALUATE.                                                05560000
055700                                                                  05570000
055800                                                                  05580000
055900*----------------------------------------------------------------*05590000
056000* IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP ITEM    05600000
056100* NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP, SET THE TOP   05610000
056200* ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST MESSAGE.          05620000
056300*----------------------------------------------------------------*05630000
056400 2110-BROWSE-BACKWARD.                                            05640000
056500                                                                  05650000
056600     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    05660000
056700         GIVING PV-TOP-ITEM.                                      05670000
056800                                                                  05680000
056900     IF  ((PV-TOP-ITEM < +1)                                      05690000
057000       OR (PV-TOP-ITEM = +1))                                     05700000
057100         MOVE +1                   TO PV-TOP-ITEM                 05710000
057200*        -- TOP OF LIST --                                        05720000
057300         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            05730000
057400         SET DP020-MSG-INFORMATIONAL TO TRUE                      05740000
057500     END-IF.                                                      05750000
057600                                                                  05760000
057700                                                                  05770000
057800*----------------------------------------------------------------*05780000
057900* IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP ITEM     05790000
058000* NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO PAST THE   05800000
058100* END, ISSUE THE BOTTOM OF LIST MESSAGE.                          05810000
058200*----------------------------------------------------------------*05820000
058300 2120-BROWSE-FORWARD.                                             05830000
058400                                                                  05840000
058500     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              05850000
058600         GIVING PV-TOP-ITEM.                                      05860000
058700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   05870000
058800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            05880000
058900                                   TO PV-TOP-ITEM                 05890000
059000*        -- BOTTOM OF LIST --                                     05900000
059100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            05910000
059200         SET DP020-MSG-INFORMATIONAL                              05920000
059300                                   TO TRUE                        05930000
059400     ELSE                                                         05940000
059500         COMPUTE PV-BOTTOM-ITEM =                                 05950000
059600             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 05960000
059700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            05970000
059800*            -- BOTTOM OF LIST --                                 05980000
059900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            05990000
060000             SET DP020-MSG-INFORMATIONAL                          06000000
060100                                   TO TRUE                        06010000
060200         END-IF                                                   06020000
060300     END-IF.                                                      06030000
060400                                                                  06040000
060500                                                                  06050000
060600*----------------------------------------------------------------*06060000
060700* THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO THAT   06070000
060800* THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST. THIS IS A  06080000
060900* FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST RATHER THAN    06090000
061000* HITTING NEXT-PAGE TO GET TO THAT POINT. THE NEW LIST NUMBER     06100000
061100* ENTERED IS EDITED TO MAKE SURE THAT IT IS NUMERIC AND FALLS     06110000
061200* WITHIN A SPECIFIED RANGE.                                       06120000
061300*----------------------------------------------------------------*06130000
061400 2130-CHECK-FOR-JUMP-BROWSE.                                      06140000
061500                                                                  06150000
061600     IF ASC-START-ITEM-REQUEST = SPACE                            06160000
061700         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             06170000
061800     ELSE                                                         06180000
061900         MOVE ASC-START-ITEM-REQUEST  TO DP010I-UNEDITED-FIELD    06190000
062000         MOVE PC-ITEM-NUMBER-LENGTH   TO DP010I-MAXIMUM-DIGITS    06200000
062100         MOVE +0                      TO DP010I-MAXIMUM-DECIMALS  06210000
062200         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  06220000
062310         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06231001
062320                         USING DP010I-NUMERIC-EDIT-AREA           06232001
062400                                                                  06240000
062500         IF  NOT DP010I-ERROR-DETECTED                            06250000
062600             MOVE DP010I-NUMERIC-FIELD                            06260000
062700                                   TO  ASC-START-ITEM-REQUEST-N   06270000
062800             IF  ASC-START-ITEM-REQUEST-N > ZERO                  06280000
062900                 IF  ASC-START-ITEM-REQUEST-N >                   06290000
063000                                          ASC-NUMBER-OF-ITEMS-READ06300000
063100                     MOVE SPACE TO ASC-START-ITEM-REQUEST         06310000
063200                     COMPUTE PV-TOP-ITEM =                        06320000
063300                             ASC-NUMBER-OF-ITEMS-READ             06330000
063400                             - PC-ITEMS-PER-PANEL + 1             06340000
063500                     IF  PV-TOP-ITEM < +1                         06350000
063600                         MOVE +1   TO PV-TOP-ITEM                 06360000
063700*                        ---- BOTTOM OF LIST ----                 06370000
063800                         MOVE PC-TSYMSG-00070                     06380000
063900                                   TO DP020-MSG-NUMBER            06390000
064000                         SET DP020-MSG-INFORMATIONAL TO TRUE      06400000
064100                     END-IF                                       06410000
064200                 ELSE                                             06420000
064300                     MOVE ASC-START-ITEM-REQUEST-N TO PV-TOP-ITEM 06430000
064400                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      06440000
064500                     COMPUTE PV-BOTTOM-ITEM =                     06450000
064600                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     06460000
064700                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ06470000
064800*                        -- BOTTOM OF LIST --                     06480000
064900                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 06490000
065000                         SET DP020-MSG-INFORMATIONAL TO TRUE      06500000
065100                     END-IF                                       06510000
065200                 END-IF                                           06520000
065300             ELSE                                                 06530000
065400*                --- VALUE OUT OF RANGE ----                      06540000
065500                 MOVE PC-TSYMSG-00101        TO DP020-MSG-NUMBER  06550000
065600                 MOVE -1                     TO ASTRTITL          06560000
065700                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              06570000
065800                 MOVE DP015-REVERSE          TO ASTRTITH          06580000
065900                 MOVE DP015-RED              TO ASTRTITC          06590000
066000                 MOVE DP015-UNP-NUM-BRT-OFF  TO ASTRTITA          06600000
066100                 SET DP020-MSG-FATAL                              06610000
066200                     PS-START-ITEM-ERROR     TO TRUE              06620000
066300             END-IF                                               06630000
066400         ELSE                                                     06640000
066500*            ---- MUST BE NUMERIC ----                            06650000
066600             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER      06660000
066700             MOVE -1                     TO ASTRTITL              06670000
066800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  06680000
066900             MOVE DP015-REVERSE          TO ASTRTITH              06690000
067000             MOVE DP015-RED              TO ASTRTITC              06700000
067100             MOVE DP015-UNP-NUM-BRT-OFF  TO ASTRTITA              06710000
067200             SET DP020-MSG-FATAL         TO TRUE                  06720000
067300             SET PS-START-ITEM-ERROR     TO TRUE                  06730000
067400         END-IF                                                   06740000
067500     END-IF.                                                      06750000
067600                                                                  06760000
067700                                                                  06770000
067800*----------------------------------------------------------------*06780000
067900* IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION SWITCH   06790000
068000* FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.                    06800000
068100*----------------------------------------------------------------*06810000
068200 2140-DESELECT-ALL-ITEMS.                                         06820000
068300                                                                  06830000
068400     MOVE +1                       TO ASC-BLK-SUB.                06840000
068500                                                                  06850000
068600     PERFORM 2141-CLEAR-SELECTED-INDS                             06860000
068700         VARYING ASC-ITEM-SUB                                     06870000
068800         FROM 1 BY 1                                              06880000
068900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 06890000
069000                                                                  06900000
069100     ADD +1                        TO ASC-BLK-SUB.                06910000
069200                                                                  06920000
069300     PERFORM 2141-CLEAR-SELECTED-INDS                             06930000
069400         VARYING ASC-ITEM-SUB                                     06940000
069500         FROM 1 BY 1                                              06950000
069600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 06960000
069700                                                                  06970000
069800     MOVE ASC-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER.       06980000
069900                                                                  06990000
070000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            07000000
070100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    07010000
070200                                                                  07020000
070300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     07030000
070400        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      07040000
070500         MOVE +1                   TO ASC-BLK-SUB                 07050000
070600                                                                  07060000
070700         PERFORM 5100-WRITE-TEMP-STORAGE                          07070000
070800                                                                  07080000
070900         MOVE +1                   TO PV-BLOCK-NUMBER             07090000
071000                                                                  07100000
071100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         07110000
071200             PV-FIRST-BLOCK-IN-ARRAY - 1                          07120000
071300                                                                  07130000
071400         PERFORM                                                  07140000
071500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       07150000
071600                                                                  07160000
071700             PERFORM 4410-READ-TEMP-STORAGE                       07170000
071800                                                                  07180000
071900             PERFORM 2141-CLEAR-SELECTED-INDS                     07190000
072000                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 07200000
072100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          07210000
072200                                                                  07220000
072300             PERFORM 5100-WRITE-TEMP-STORAGE                      07230000
072400                                                                  07240000
072500             ADD +1                TO PV-BLOCK-NUMBER             07250000
072600         END-PERFORM                                              07260000
072700                                                                  07270000
072800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         07280000
072900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     07290000
073000                                                                  07300000
073100         PERFORM                                                  07310000
073200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       07320000
073300                   ASC-HIGHEST-BLOCK-WRITTEN                      07330000
073400                                                                  07340000
073500             MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER       07350000
073600                                                                  07360000
073700             PERFORM 4410-READ-TEMP-STORAGE                       07370000
073800                                                                  07380000
073900             PERFORM 2141-CLEAR-SELECTED-INDS                     07390000
074000                 VARYING ASC-ITEM-SUB                             07400000
074100                 FROM 1 BY 1                                      07410000
074200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          07420000
074300                                                                  07430000
074400             PERFORM 5100-WRITE-TEMP-STORAGE                      07440000
074500                                                                  07450000
074600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      07460000
074700         END-PERFORM                                              07470000
074800                                                                  07480000
074900         MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER          07490000
075000                                                                  07500000
075100         PERFORM 4410-READ-TEMP-STORAGE                           07510000
075200     END-IF.                                                      07520000
075300                                                                  07530000
075400     MOVE +0  TO ASC-NUMBER-OF-SELECTED-ITEMS                     07540000
075500                 ASC-START-OF-SELECTED-RANGE                      07550000
075600                 ASC-END-OF-SELECTED-RANGE.                       07560000
075700                                                                  07570000
075800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        07580000
075900                                                                  07590000
076000                                                                  07600000
076100*----------------------------------------------------------------*07610000
076200* MARK EACH ITEM AS BEING NOT SELECTED.                           07620000
076300*----------------------------------------------------------------*07630000
076400 2141-CLEAR-SELECTED-INDS.                                        07640000
076500                                                                  07650000
076600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) NOT = ZERO07660000
076700         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          07670000
076800             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          07680000
076900                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    07690000
077000                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  07700000
077100                                   TO TRUE                        07710000
077200         END-IF                                                   07720000
077300     END-IF.                                                      07730000
077400                                                                  07740000
077500                                                                  07750000
077600*----------------------------------------------------------------*07760000
077700*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *07770000
077800*  FOR ALL ITEMS.                                                *07780000
077900*----------------------------------------------------------------*07790000
078000 2150-SELECT-ALL-ITEMS.                                           07800000
078100                                                                  07810000
078200     MOVE +1                       TO ASC-BLK-SUB.                07820000
078300                                                                  07830000
078400     PERFORM 2151-SET-SELECTED-INDS                               07840000
078500         VARYING ASC-ITEM-SUB                                     07850000
078600         FROM 1 BY 1                                              07860000
078700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 07870000
078800                                                                  07880000
078900     ADD +1                        TO ASC-BLK-SUB.                07890000
079000                                                                  07900000
079100     PERFORM 2151-SET-SELECTED-INDS                               07910000
079200         VARYING ASC-ITEM-SUB                                     07920000
079300         FROM 1 BY 1                                              07930000
079400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 07940000
079500                                                                  07950000
079600     MOVE ASC-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER.       07960000
079700                                                                  07970000
079800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            07980000
079900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    07990000
080000                                                                  08000000
080100     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     08010000
080200        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    08020000
080300         MOVE +1                   TO ASC-BLK-SUB                 08030000
080400                                                                  08040000
080500         PERFORM 5100-WRITE-TEMP-STORAGE                          08050000
080600                                                                  08060000
080700         MOVE +1                   TO PV-BLOCK-NUMBER             08070000
080800                                                                  08080000
080900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         08090000
081000             PV-FIRST-BLOCK-IN-ARRAY - 1                          08100000
081100                                                                  08110000
081200         PERFORM                                                  08120000
081300             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       08130000
081400                                                                  08140000
081500             PERFORM 4410-READ-TEMP-STORAGE                       08150000
081600                                                                  08160000
081700             PERFORM 2151-SET-SELECTED-INDS                       08170000
081800                 VARYING ASC-ITEM-SUB                             08180000
081900                 FROM 1 BY 1                                      08190000
082000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08200000
082100                                                                  08210000
082200             PERFORM 5100-WRITE-TEMP-STORAGE                      08220000
082300                                                                  08230000
082400             ADD +1                TO PV-BLOCK-NUMBER             08240000
082500         END-PERFORM                                              08250000
082600                                                                  08260000
082700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         08270000
082800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     08280000
082900                                                                  08290000
083000         PERFORM                                                  08300000
083100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       08310000
083200                   ASC-HIGHEST-BLOCK-WRITTEN                      08320000
083300                                                                  08330000
083400             MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER       08340000
083500                                                                  08350000
083600             PERFORM 4410-READ-TEMP-STORAGE                       08360000
083700                                                                  08370000
083800             PERFORM 2151-SET-SELECTED-INDS                       08380000
083900                 VARYING ASC-ITEM-SUB                             08390000
084000                 FROM 1 BY 1                                      08400000
084100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08410000
084200                                                                  08420000
084300             PERFORM 5100-WRITE-TEMP-STORAGE                      08430000
084400                                                                  08440000
084500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      08450000
084600         END-PERFORM                                              08460000
084700                                                                  08470000
084800         MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER          08480000
084900                                                                  08490000
085000         PERFORM 4410-READ-TEMP-STORAGE                           08500000
085100     END-IF.                                                      08510000
085200                                                                  08520000
085300     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             08530000
085400                       ASC-NUMBER-OF-SELECTED-ITEMS.              08540000
085500                                                                  08550000
085600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        08560000
085700                                                                  08570000
085800                                                                  08580000
085900*----------------------------------------------------------------*08590000
086000* MARK EACH ITEM AS BEING SELECTED.                               08600000
086100*----------------------------------------------------------------*08610000
086200 2151-SET-SELECTED-INDS.                                          08620000
086300                                                                  08630000
086400     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) NOT = ZERO08640000
086500         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             08650000
086600             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             08660000
086700                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        08670000
086800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  08680000
086900                               TO  TRUE                           08690000
087000         END-IF                                                   08700000
087100     END-IF.                                                      08710000
087200                                                                  08720000
087300                                                                  08730000
087400*----------------------------------------------------------------*08740000
087500* MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE       08750000
087600* SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.    08760000
087700*----------------------------------------------------------------*08770000
087800 2200-MOVE-SCREEN-TO-COMMAREA.                                    08780000
087900                                                                  08790000
088000     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             08800000
088100     MOVE +1                       TO PV-SUB.                     08810000
088200                                                                  08820000
088300     PERFORM 3100-SET-SUBSCRIPTS.                                 08830000
088400     IF  ASTRTITL > ZERO                                          08840000
088500         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          08850000
088600     ELSE                                                         08860000
088700         IF ASTRTITF = DP015-ERASE-EOF                            08870000
088800             MOVE SPACE TO ASC-START-ITEM-REQUEST                 08880000
088900         END-IF.                                                  08890000
089000                                                                  08900000
089100     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          08910000
089200         VARYING PV-SUB                                           08920000
089300         FROM 1 BY 1                                              08930000
089400         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      08940000
089500                                                                  08950000
089600                                                                  08960000
089700*----------------------------------------------------------------*08970000
089800* MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA.  08980000
089900*----------------------------------------------------------------*08990000
090000 2210-MOVE-LINES-TO-COMMAREA.                                     09000000
090100                                                                  09010000
090200     IF  MR-SELECTL (PV-SUB) > ZERO                               09020000
090300         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             09030000
090400         MOVE MR-SELECTI (PV-SUB)  TO ASC-TEMP-SELECTED-SW        09040000
090500                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      09050000
090600     ELSE                                                         09060000
090700         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                09070000
090800                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     09080000
090900                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        09090000
091000                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      09100000
091100         END-IF                                                   09110000
091200     END-IF.                                                      09120000
091300                                                                  09130000
091400     ADD +1                        TO ASC-ITEM-SUB.               09140000
091500                                                                  09150000
091600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        09160000
091700         ADD +1                    TO ASC-BLK-SUB                 09170000
091800         MOVE +1                   TO ASC-ITEM-SUB                09180000
091900     END-IF.                                                      09190000
092000                                                                  09200000
092100                                                                  09210000
092200*----------------------------------------------------------------*09220000
092300* EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE         09230000
092400* COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).    09240000
092500*----------------------------------------------------------------*09250000
092600 3000-EDIT-DATA-IN-COMMAREA.                                      09260000
092700                                                                  09270000
092800     SET PS-NO-ERROR               TO TRUE.                       09280000
092900     PERFORM 3200-RESET-ATTRIBUTES.                               09290000
093000     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     09300000
093100                                                                  09310000
093200*    *------------------------------------------------------------09320000
093300*    * CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.         09330000
093400*    * EDITTING IS DONE FROM THE BOTTOM UP.                       09340000
093500*    *------------------------------------------------------------09350000
093600     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       09360000
093700         ASC-ITEMS-DISPLAYED - 1.                                 09370000
093800     PERFORM 3100-SET-SUBSCRIPTS.                                 09380000
093900     PERFORM 3300-EDIT-SELECTIONS                                 09390000
094000         VARYING PV-SUB                                           09400000
094100         FROM PV-SUB BY -1                                        09410000
094200         UNTIL PV-SUB < +1                                        09420000
094300                                                                  09430000
094400     IF  PS-NO-ERROR                                              09440000
094500         PERFORM 3400-CHECK-RANGE-SEQUENCE                        09450000
094600     END-IF.                                                      09460000
094700                                                                  09470000
094800     IF  ((PS-NO-ERROR)                                           09480000
094900       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   09490000
095000       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    09500000
095100             PERFORM 3500-MARK-RANGE-AS-SELECTED                  09510000
095200     END-IF.                                                      09520000
095300                                                                  09530000
095400                                                                  09540000
095500*----------------------------------------------------------------*09550000
095600* DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM     09560000
095700* CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY. THIS WILL     09570000
095800* POSITION US IN THE 1ST BLOCK OF THE ARRAY.                      09580000
095900*                                                                 09590000
096000* IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS IN A  09600000
096100* BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT THE MAXIMUM 09610000
096200* NUMBER OF ITEMS. THIS WILL CORRECTLY POSITION US IN THE 2ND     09620000
096300* BLOCK OF THE ARRAY.                                             09630000
096400*----------------------------------------------------------------*09640000
096500 3100-SET-SUBSCRIPTS.                                             09650000
096600                                                                  09660000
096700     COMPUTE ASC-ITEM-SUB =                                       09670000
096800         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        09680000
096900                                                                  09690000
097000     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         09700000
097100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            09710000
097200         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               09720000
097300     ELSE                                                         09730000
097400         MOVE +1                     TO ASC-BLK-SUB               09740000
097500     END-IF.                                                      09750000
097600                                                                  09760000
097700                                                                  09770000
097800*----------------------------------------------------------------*09780000
097900* RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.        09790000
098000*----------------------------------------------------------------*09800000
098100 3200-RESET-ATTRIBUTES.                                           09810000
098200                                                                  09820000
098300     MOVE DP015-UNP-NUM-NOR-OFF    TO ASTRTITA.                   09830000
098400     MOVE DP015-GREEN              TO ASTRTITC.                   09840000
098500     MOVE DP015-UNDERLINE          TO ASTRTITH.                   09850000
098600                                                                  09860000
098700     PERFORM                                                      09870000
098800         VARYING PV-SUB                                           09880000
098900         FROM 1 BY 1                                              09890000
099000         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        09900000
099100         MOVE DP015-UNP-ALP-NOR-OFF                               09910000
099200                                   TO MR-SELECTA (PV-SUB)         09920000
099300         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         09930000
099400         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         09940000
099500     END-PERFORM.                                                 09950000
099600                                                                  09960000
099700                                                                  09970000
099800*----------------------------------------------------------------*09980000
099900* EDIT THE SELECTIONS MADE. NOTE THAT THE 'SELECTED-SW' IS WHAT   09990000
100000* WAS PREVIOUSLY CHECKED AND CORRECT. 'TEMP-SELECTED-SW' IS WHAT  10000000
100100* HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR WAS ENTERED   10010000
100200* EARLIER, BUT DID NOT PASS THE EDITS.                            10020000
100300*----------------------------------------------------------------*10030000
100400 3300-EDIT-SELECTIONS.                                            10040000
100500                                                                  10050000
100600     EVALUATE TRUE                                                10060000
100700         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     10070000
100800             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         10080000
100900                 CONTINUE                                         10090000
101000         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         10100000
101100             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        10110000
101200                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   10120000
101300                 MOVE ASC-TEMP-SELECTED-SW                        10130000
101400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10140000
101500                                TO ASC-SELECTED-SW                10150000
101600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10160000
101700             END-IF                                               10170000
101800         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     10180000
101900                 = SPACE                                          10190000
102000             EVALUATE TRUE                                        10200000
102100                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       10210000
102200                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS10220000
102300                     MOVE SPACE TO ASC-SELECTED-SW                10230000
102400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10240000
102500                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        10250000
102600                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    10260000
102700                     MOVE SPACE TO ASC-SELECTED-SW                10270000
102800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10280000
102900                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          10290000
103000                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      10300000
103100                     MOVE SPACE TO ASC-SELECTED-SW                10310000
103200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10320000
103300             END-EVALUATE                                         10330000
103400         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           10340000
103500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            10350000
103600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    10360000
103700             END-IF                                               10370000
103800             PERFORM 3310-EDIT-RANGE                              10380000
103900         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             10390000
104000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            10400000
104100                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    10410000
104200             END-IF                                               10420000
104300             PERFORM 3310-EDIT-RANGE                              10430000
104400         WHEN OTHER                                               10440000
104500*            ---- INVALID VALUE ----                              10450000
104600             MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER      10460000
104700             SET DP020-MSG-FATAL         TO TRUE                  10470000
104800             MOVE -1                     TO MR-SELECTL (PV-SUB)   10480000
104900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  10490000
105000             MOVE DP015-RED              TO MR-SELECTC (PV-SUB)   10500000
105100             MOVE DP015-REVERSE          TO MR-SELECTH (PV-SUB)   10510000
105200             SET PS-ERROR                TO TRUE                  10520000
105300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            10530000
105400                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     10540000
105500                 MOVE SPACE         TO ASC-SELECTED-SW            10550000
105600                                        (ASC-BLK-SUB ASC-ITEM-SUB)10560000
105700             END-IF                                               10570000
105800     END-EVALUATE.                                                10580000
105900                                                                  10590000
106000     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 10600000
106100     SUBTRACT +1 FROM ASC-ITEM-SUB.                               10610000
106200     IF  ASC-ITEM-SUB < 1                                         10620000
106300         SUBTRACT +1 FROM ASC-BLK-SUB                             10630000
106400         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                10640000
106500     END-IF.                                                      10650000
106600                                                                  10660000
106700                                                                  10670000
106800*-----------------------------------------------------------------10680000
106900* IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A RANGE OF10690000
107000* LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1 ENDING AND MAKE10700000
107100* SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE ENDING.       10710000
107200*-----------------------------------------------------------------10720000
107300 3310-EDIT-RANGE.                                                 10730000
107400                                                                  10740000
107500     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                10750000
107600         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   10760000
107700             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)10770000
107800                                   TO ASC-SELECTED-SW             10780000
107900                                        (ASC-BLK-SUB ASC-ITEM-SUB)10790000
108000             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 10800000
108100         ELSE                                                     10810000
108200             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     10820000
108300                 CONTINUE                                         10830000
108400             ELSE                                                 10840000
108500*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        10850000
108600                 MOVE PC-TSYMSG-00054 TO DP020-MSG-NUMBER         10860000
108700                 SET DP020-MSG-FATAL  TO TRUE                     10870000
108800                 MOVE -1              TO MR-SELECTL (PV-SUB)      10880000
108900                 SET DP030-SET-CURSOR-APPL-1                      10890000
109000                                      TO TRUE                     10900000
109100                 MOVE DP015-RED       TO MR-SELECTC (PV-SUB)      10910000
109200                 MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)      10920000
109300                 SET PS-ERROR         TO TRUE                     10930000
109400             END-IF                                               10940000
109500         END-IF                                                   10950000
109600     ELSE                                                         10960000
109700         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     10970000
109800             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 10980000
109900                                   TO ASC-SELECTED-SW             10990000
110000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11000000
110100             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   11010000
110200         ELSE                                                     11020000
110300             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       11030000
110400                 CONTINUE                                         11040000
110500             ELSE                                                 11050000
110600*                -- ONLY ONE END-OF-RANGE ALLOWED --              11060000
110700                 MOVE PC-TSYMSG-00055 TO DP020-MSG-NUMBER         11070000
110800                 SET DP020-MSG-FATAL  TO TRUE                     11080000
110900                 MOVE -1              TO MR-SELECTL (PV-SUB)      11090000
111000                 SET DP030-SET-CURSOR-APPL-1                      11100000
111100                     PS-ERROR         TO TRUE                     11110000
111200             END-IF                                               11120000
111300         END-IF                                                   11130000
111400     END-IF.                                                      11140000
111500                                                                  11150000
111600                                                                  11160000
111700******************************************************************11170000
111800* IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED, MAKE  11180000
111900* SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.          11190000
112000******************************************************************11200000
112100 3400-CHECK-RANGE-SEQUENCE.                                       11210000
112200                                                                  11220000
112300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       11230000
112400       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      11240000
112500       AND  ASC-START-OF-SELECTED-RANGE >                         11250000
112600                                         ASC-END-OF-SELECTED-RANGE11260000
112700*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                11270000
112800         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 11280000
112900         SET DP020-MSG-FATAL                                      11290000
113000             PS-ERROR        TO TRUE                              11300000
113100         PERFORM 3410-POSITION-AT-ERROR                           11310000
113200     ELSE                                                         11320000
113300         MOVE -1 TO MR-SELECTL (1)                                11330000
113400     END-IF.                                                      11340000
113500     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       11350000
113600                                                                  11360000
113700                                                                  11370000
113800******************************************************************11380000
113900* BECAUSE RANGES CAN SPAN MULTIPLE PAGES, A SEPARATE PARAGRAPH    11390000
114000* (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR SHOULD BE    11400000
114100* POSITIONED ON A RANGE ERROR.                                    11410000
114200******************************************************************11420000
114300 3410-POSITION-AT-ERROR.                                          11430000
114400                                                                  11440000
114500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 11450000
114600                    - PV-TOP-ITEM + 1.                            11460000
114700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      11470000
114800         CONTINUE                                                 11480000
114900     ELSE                                                         11490000
115000         MOVE -1                   TO MR-SELECTL (PV-SUB)         11500000
115100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         11510000
115200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         11520000
115300     END-IF.                                                      11530000
115400                                                                  11540000
115500     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   11550000
115600                    - PV-TOP-ITEM + 1.                            11560000
115700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      11570000
115800         CONTINUE                                                 11580000
115900     ELSE                                                         11590000
116000         MOVE -1                   TO MR-SELECTL (PV-SUB)         11600000
116100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         11610000
116200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         11620000
116300     END-IF.                                                      11630000
116400                                                                  11640000
116500                                                                  11650000
116600*----------------------------------------------------------------*11660000
116700*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *11670000
116800*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *11680000
116900*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *11690000
117000*----------------------------------------------------------------*11700000
117100 3500-MARK-RANGE-AS-SELECTED.                                     11710000
117200                                                                  11720000
117300     MOVE +1                       TO  ASC-BLK-SUB.               11730000
117400     PERFORM 3510-MARK-SELECTED-INDS                              11740000
117500         VARYING ASC-ITEM-SUB                                     11750000
117600         FROM 1 BY 1                                              11760000
117700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11770000
117800                                                                  11780000
117900     ADD +1                        TO ASC-BLK-SUB.                11790000
118000     PERFORM 3510-MARK-SELECTED-INDS                              11800000
118100         VARYING ASC-ITEM-SUB                                     11810000
118200         FROM 1 BY 1                                              11820000
118300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11830000
118400                                                                  11840000
118500     MOVE ASC-LIST-ITEM-NUMBER(1 1) TO  PV-LIST-ITEM-NUMBER.      11850000
118600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11860000
118700         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         11870000
118800               PC-ITEMS-PER-PANEL).                               11880000
118900                                                                  11890000
119000     MOVE ASC-START-OF-SELECTED-RANGE                             11900000
119100                                    TO PV-START-OF-SELECTED-RANGE.11910000
119200     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            11920000
119300         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  11930000
119400               PC-ITEMS-PER-PANEL).                               11940000
119500                                                                  11950000
119600     MOVE ASC-END-OF-SELECTED-RANGE TO  PV-END-OF-SELECTED-RANGE. 11960000
119700     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             11970000
119800         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    11980000
119900               PC-ITEMS-PER-PANEL).                               11990000
120000     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             12000000
120100         PV-FIRST-BLOCK-IN-ARRAY + 1.                             12010000
120200                                                                  12020000
120300     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    12030000
120400        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        12040000
120500         MOVE +1                   TO ASC-BLK-SUB                 12050000
120600         PERFORM 5100-WRITE-TEMP-STORAGE                          12060000
120700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12070000
120800             PV-FIRST-BLOCK-IN-ARRAY - 1                          12080000
120900                                                                  12090000
121000         PERFORM                                                  12100000
121100             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      12110000
121200                   PV-PREV-BLOCK-IN-ARRAY                         12120000
121300             MOVE PV-FIRST-BLOCK-IN-RANGE TO PV-BLOCK-NUMBER      12130000
121400             PERFORM 4410-READ-TEMP-STORAGE                       12140000
121500             PERFORM 3510-MARK-SELECTED-INDS                      12150000
121600                 VARYING ASC-ITEM-SUB                             12160000
121700                 FROM 1 BY 1                                      12170000
121800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12180000
121900             PERFORM 5100-WRITE-TEMP-STORAGE                      12190000
122000             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     12200000
122100         END-PERFORM                                              12210000
122200                                                                  12220000
122300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12230000
122400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12240000
122500         PERFORM                                                  12250000
122600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12260000
122700                   PV-LAST-BLOCK-IN-RANGE                         12270000
122800             MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER       12280000
122900             PERFORM 4410-READ-TEMP-STORAGE                       12290000
123000             PERFORM 3510-MARK-SELECTED-INDS                      12300000
123100                 VARYING ASC-ITEM-SUB                             12310000
123200                 FROM 1 BY 1                                      12320000
123300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12330000
123400             PERFORM 5100-WRITE-TEMP-STORAGE                      12340000
123500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12350000
123600         END-PERFORM                                              12360000
123700                                                                  12370000
123800         MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER          12380000
123900         PERFORM 4410-READ-TEMP-STORAGE                           12390000
124000     END-IF.                                                      12400000
124100                                                                  12410000
124200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 12420000
124300                                      ASC-END-OF-SELECTED-RANGE.  12430000
124400                                                                  12440000
124500                                                                  12450000
124600*----------------------------------------------------------------*12460000
124700* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *12470000
124800*----------------------------------------------------------------*12480000
124900 3510-MARK-SELECTED-INDS.                                         12490000
125000                                                                  12500000
125100     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) >         12510000
125200         ASC-START-OF-SELECTED-RANGE)                             12520000
125300     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =         12530000
125400         ASC-START-OF-SELECTED-RANGE)                             12540000
125500         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     12550000
125600             ASC-END-OF-SELECTED-RANGE)                           12560000
125700         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     12570000
125800             ASC-END-OF-SELECTED-RANGE)                           12580000
125900             IF NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)         12590000
126000                 SET ASC-SELECT        (ASC-BLK-SUB  ASC-ITEM-SUB)12600000
126100                     ASC-TEMP-SELECT   (ASC-BLK-SUB  ASC-ITEM-SUB)12610000
126200                     ASC-BLOCK-MODIFIED (ASC-BLK-SUB)             12620000
126300                               TO TRUE                            12630000
126400                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    12640000
126500             END-IF                                               12650000
126600         END-IF                                                   12660000
126700     END-IF.                                                      12670000
126800                                                                  12680000
126900                                                                  12690000
127000*----------------------------------------------------------------*12700000
127100* INITIALIZE BOTH BLOCKS IN THE ARRAY AND ALL COUNTERS AND FLAGS. 12710000
127200* READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.      12720000
127300* DISPLAY THE PANEL TO USER.                                      12730000
127400*----------------------------------------------------------------*12740000
127500 4000-BUILD-INITIAL-PANEL.                                        12750000
127600                                                                  12760000
127700     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            12770000
127800                                 ASC-BLOCK-ENTRIES (2).           12780000
127900     MOVE +1                  TO ASC-BLK-SUB.                     12790000
128000     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            12800000
128100     MOVE +0                  TO ASC-ITEM-SUB                     12810000
128200                                 ASC-NUMBER-OF-ITEMS-READ         12820000
128300                                 ASC-NUMBER-OF-SELECTED-ITEMS     12830000
128400                                 ASC-HIGHEST-BLOCK-WRITTEN        12840000
128500                                 ASC-START-OF-SELECTED-RANGE      12850000
128600                                 ASC-END-OF-SELECTED-RANGE        12860000
128700                                 ASC-ITEM-AT-TOP-OF-PANEL.        12870000
128800                                                                  12880000
128900     PERFORM 4010-OPEN-CURSOR.                                    12890000
129000                                                                  12900000
129100     IF SQLCODE = ZERO                                            12910000
129200         PERFORM 4300-READ-ITEMS-FROM-DB                          12920000
129300         PERFORM 4020-CLOSE-CURSOR                                12930000
129400         MOVE +1 TO  PV-TOP-ITEM                                  12940000
129500         IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                      12950000
129600             SET DP020-NEXT-ACT-APPL-ERROR                        12960000
129700                 DP020-MSG-FATAL TO TRUE                          12970000
129800*            ---- NO LIST ITEMS FOUND FOR CRITERIA ----           12980000
129900             MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER           12990000
130000         ELSE                                                     13000000
130100             MOVE -1               TO MR-SELECTL (1)              13010000
130200             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  13020000
130300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13030000
130400         END-IF                                                   13040000
130500     ELSE                                                         13050000
130600         SET  DP020-NEXT-ACT-APPL-ERROR                           13060000
130700              DP020-MSG-WARNING         TO TRUE                   13070000
130800*        ---- WAIT 15 SECONDS, THEN RETRY ----                    13080000
130900         MOVE PC-TSYMSG-00551  TO  DP020-MSG-NUMBER               13090000
131000     END-IF.                                                      13100000
131100                                                                  13110000
131200                                                                  13120000
131300 4010-OPEN-CURSOR.                                                13130000
131400                                                                  13140000
131500     EXEC SQL                                                     13150000
131600          OPEN TNETWRK-CSR                                        13160000
131700     END-EXEC.                                                    13170000
131800                                                                  13180000
131900     EVALUATE TRUE                                                13190000
132000         WHEN SQLCODE = ZERO                                      13200000
132100         WHEN SQLCODE = -904                                      13210000
132200         WHEN SQLCODE = -913                                      13220000
132300             CONTINUE                                             13230000
132400         WHEN SQLWARN0 NOT = SPACES                               13240000
132500         WHEN SQLCODE  NOT = ZERO                                 13250000
132600             MOVE '4010-OPEN-CURSOR'                              13260000
132700                                     TO DP013-PARAGRAPH           13270000
132800             MOVE 'OPEN TNETWRK-CSR' TO DP013-MESSAGE-TEXT (1)    13280000
132900             MOVE SQLCA              TO DP013-SQLCA               13290000
133000             MOVE 'TNETWRK '         TO DP013-DB2-TABLE-NAME (1)  13300000
133100             SET DP013-DB2-ABEND                                  13310000
133200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               13320000
133300             PERFORM DP013-0000-PROCESS-ABEND                     13330000
133400     END-EVALUATE.                                                13340000
133500                                                                  13350000
133600                                                                  13360000
133700 4020-CLOSE-CURSOR.                                               13370000
133800                                                                  13380000
133900     EXEC SQL                                                     13390000
134000         CLOSE TNETWRK-CSR                                        13400000
134100     END-EXEC.                                                    13410000
134200                                                                  13420000
134300     EVALUATE TRUE                                                13430000
134400         WHEN SQLCODE = ZERO                                      13440000
134500             CONTINUE                                             13450000
134600         WHEN SQLWARN0 NOT = SPACES                               13460000
134700         WHEN SQLCODE  NOT = ZERO                                 13470000
134800             MOVE '4020-CLOSE-CURSOR'                             13480000
134900                                      TO DP013-PARAGRAPH          13490000
135000             MOVE 'CLOSE TNETWRK-CSR' TO DP013-MESSAGE-TEXT (1)   13500000
135100             MOVE SQLCA               TO DP013-SQLCA              13510000
135200             MOVE 'TNETWRK'           TO DP013-DB2-TABLE-NAME (1) 13520000
135300             SET DP013-DB2-ABEND                                  13530000
135400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               13540000
135500             PERFORM DP013-0000-PROCESS-ABEND                     13550000
135600     END-EVALUATE.                                                13560000
135700                                                                  13570000
135800                                                                  13580000
135900*----------------------------------------------------------------*13590000
136000* READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE BLOCKS 13600000
136100* IN THE ARRAY. WHENEVER BOTH BLOCKS BECOME FULL, WRITE OUT THE   13610000
136200* 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND BLOCK IN THE ARRAY 13620000
136300* TO THE 1ST BLOCK, AND INITIALIZE THE 2ND BLOCK, MAKING IT       13630000
136400* AVAILABLE TO BE USED.                                           13640000
136500*                                                                 13650000
136600* DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE ROWS   13660000
136700* ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM UPON      13670000
136800* INITIALIZATION.                                                 13680000
136900*----------------------------------------------------------------*13690000
137000 4300-READ-ITEMS-FROM-DB.                                         13700000
137100                                                                  13710000
137200     PERFORM                                                      13720000
137300         VARYING PV-READ-COUNT                                    13730000
137400         FROM 1 BY 1                                              13740000
137500         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    13750000
137600            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         13760000
137700                                                                  13770000
137800         PERFORM 4310-FETCH                                       13780000
137900                                                                  13790000
138000         IF  ASC-ITEMS-LEFT-ON-DB                                 13800000
138100             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                13810000
138200                 ADD +1            TO ASC-ITEM-SUB                13820000
138300             ELSE                                                 13830000
138400                 ADD +1            TO ASC-BLK-SUB                 13840000
138500                 MOVE +1           TO ASC-ITEM-SUB                13850000
138600                                                                  13860000
138700                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         13870000
138800                     MOVE +1       TO ASC-BLK-SUB                 13880000
138900                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           13890000
139000                     PERFORM 5100-WRITE-TEMP-STORAGE              13900000
139100                     MOVE ASC-BLOCK-ENTRIES                       13910000
139200                                          (PC-MAX-BLOCKS-IN-ARRAY)13920000
139300                                 TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)13930000
139400                     ADD +1        TO ASC-BLK-SUB                 13940000
139500                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   13950000
139600                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      13960000
139700                                                           TO TRUE13970000
139800                 END-IF                                           13980000
139900             END-IF                                               13990000
140000             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    14000000
140100             MOVE ASC-NUMBER-OF-ITEMS-READ                        14010000
140200                TO ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)14020000
140300             MOVE NETWRK-NETWK-ID                                 14030000
140400                TO ASC-NETWORK-ID       (ASC-BLK-SUB ASC-ITEM-SUB)14040000
140500             MOVE NETWRK-NETWK-NME                                14050000
140600                TO ASC-NETWORK-NAME     (ASC-BLK-SUB ASC-ITEM-SUB)14060000
140700             EVALUATE TRUE                                        14070000
140800                 WHEN NETWRK-NETWK-TYPE-CDE = '0'                 14080000
140900                     MOVE PC-NETWK-TYPE-CDE-0-DESC                14090000
141000                       TO ASC-NETWORK-TYPE                        14100000
141100                                        (ASC-BLK-SUB ASC-ITEM-SUB)14110000
141200                 WHEN NETWRK-NETWK-TYPE-CDE = '1'                 14120000
141300                     MOVE PC-NETWK-TYPE-CDE-1-DESC                14130000
141400                       TO ASC-NETWORK-TYPE                        14140000
141500                                        (ASC-BLK-SUB ASC-ITEM-SUB)14150000
141600                 WHEN NETWRK-NETWK-TYPE-CDE = '2'                 14160000
141700                     MOVE PC-NETWK-TYPE-CDE-2-DESC                14170000
141800                       TO ASC-NETWORK-TYPE                        14180000
141900                                        (ASC-BLK-SUB ASC-ITEM-SUB)14190000
142000             END-EVALUATE                                         14200000
142100         END-IF                                                   14210000
142200     END-PERFORM.                                                 14220000
142300                                                                  14230000
142400     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          14240000
142500         MOVE +1               TO ASC-BLK-SUB                     14250000
142600         PERFORM 5100-WRITE-TEMP-STORAGE                          14260000
142700         ADD +1                TO ASC-BLK-SUB                     14270000
142800         PERFORM 5100-WRITE-TEMP-STORAGE                          14280000
142900                                                                  14290000
143000         MOVE 1                TO ASC-BLK-SUB                     14300000
143100                                  PV-BLOCK-NUMBER                 14310000
143200         PERFORM 4410-READ-TEMP-STORAGE                           14320000
143300         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             14330000
143400             MOVE 2            TO ASC-BLK-SUB                     14340000
143500                                  PV-BLOCK-NUMBER                 14350000
143600             PERFORM 4410-READ-TEMP-STORAGE                       14360000
143700         END-IF                                                   14370000
143800     END-IF.                                                      14380000
143900                                                                  14390000
144000                                                                  14400000
144100 4310-FETCH.                                                      14410000
144200                                                                  14420000
144300      EXEC SQL                                                    14430000
144400           FETCH TNETWRK-CSR                                      14440000
144500           INTO  :NETWRK-NETWK-ID                                 14450000
144600               , :NETWRK-NETWK-NME                                14460000
144700               , :NETWRK-NETWK-TYPE-CDE                           14470000
144800      END-EXEC.                                                   14480000
144900                                                                  14490000
145000     EVALUATE TRUE                                                14500000
145100         WHEN SQLCODE = ZERO                                      14510000
145200         WHEN SQLCODE = +100                                      14520000
145300              CONTINUE                                            14530000
145400         WHEN SQLWARN0 NOT = SPACE                                14540000
145500         WHEN SQLCODE  NOT = ZERO                                 14550000
145600              MOVE '4310-FETCH-CURSOR' TO DP013-PARAGRAPH         14560000
145700              MOVE 'FETCH TNETWRK-CSR' TO DP013-MESSAGE-TEXT (1)  14570000
145800              MOVE SQLCA               TO DP013-SQLCA             14580000
145900              SET DP013-DB2-ABEND      TO TRUE                    14590000
146000              PERFORM DP013-0000-PROCESS-ABEND                    14600000
146100     END-EVALUATE.                                                14610000
146200                                                                  14620000
146300     IF  SQLCODE = +100                                           14630000
146400         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                      14640000
146500     END-IF.                                                      14650000
146600                                                                  14660000
146700                                                                  14670000
146800*----------------------------------------------------------------*14680000
146900* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *14690000
147000*----------------------------------------------------------------*14700000
147100 4400-MOVE-COMMAREA-TO-SCREEN.                                    14710000
147200                                                                  14720000
147300     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             14730000
147400         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          14740000
147500         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          14750000
147600             MOVE +1    TO ASC-BLK-SUB                            14760000
147700             PERFORM 5100-WRITE-TEMP-STORAGE                      14770000
147800             ADD +1     TO ASC-BLK-SUB                            14780000
147900             PERFORM 5100-WRITE-TEMP-STORAGE                      14790000
148000             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             14800000
148100                 GIVING PV-BLOCK-NUMBER                           14810000
148200                 REMAINDER PV-REMAINDER                           14820000
148300             IF  PV-REMAINDER > ZERO                              14830000
148400                 ADD +1 TO PV-BLOCK-NUMBER                        14840000
148500             END-IF                                               14850000
148600             MOVE +1    TO ASC-BLK-SUB                            14860000
148700             PERFORM 4410-READ-TEMP-STORAGE                       14870000
148800             ADD +1     TO ASC-BLK-SUB                            14880000
148900                           PV-BLOCK-NUMBER                        14890000
149000             PERFORM 4410-READ-TEMP-STORAGE                       14900000
149100     END-IF.                                                      14910000
149200                                                                  14920000
149300     MOVE +1            TO ASC-BLK-SUB.                           14930000
149400                                                                  14940000
149500     COMPUTE ASC-ITEM-SUB =                                       14950000
149600         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              14960000
149700         + PC-ITEMS-PER-PANEL).                                   14970000
149800                                                                  14980000
149900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        14990000
150000         ADD +1         TO ASC-BLK-SUB                            15000000
150100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            15010000
150200     END-IF.                                                      15020000
150300                                                                  15030000
150400     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           15040000
150500         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                15050000
150600                                                                  15060000
150700     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        15070000
150800     PERFORM 4420-FORMAT-LIST-LINES                               15080000
150900         VARYING PV-SUB                                           15090000
151000         FROM PC-ITEMS-PER-PANEL BY -1                            15100000
151100         UNTIL PV-SUB < +1.                                       15110000
151200                                                                  15120000
151300     COMPUTE ASC-ITEMS-DISPLAYED =                                15130000
151400         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          15140000
151500                                                                  15150000
151600     IF PS-NO-START-ITEM-ERROR                                    15160000
151700         MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL15170000
151800                                          ASTRTITO                15180000
151900         MOVE SPACE                    TO ASC-START-ITEM-REQUEST  15190000
152000     ELSE                                                         15200000
152100         MOVE ASC-START-ITEM-REQUEST   TO ASTRTITO                15210000
152200     END-IF.                                                      15220000
152300                                                                  15230000
152400     MOVE ASC-ITEM-AT-BOT-OF-PANEL     TO AENDITO.                15240000
152500     MOVE ASC-NUMBER-OF-ITEMS-READ     TO ATOTITO.                15250000
152600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO ASELITO.                15260000
152700                                                                  15270000
152800     IF  DP020-MSG-NUMBER-X = SPACE                               15280000
152900         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  15290000
153000*            --- MORE ITEMS TO DISPLAY ----                       15300000
153100             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            15310000
153200             SET DP020-MSG-INFORMATIONAL TO TRUE                  15320000
153300         END-IF                                                   15330000
153400     END-IF.                                                      15340000
153500                                                                  15350000
153600                                                                  15360000
153700*----------------------------------------------------------------*15370000
153800*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *15380000
153900*----------------------------------------------------------------*15390000
154000 4410-READ-TEMP-STORAGE.                                          15400000
154100                                                                  15410000
154200     EXEC CICS                                                    15420000
154300         READQ TS                                                 15430000
154400             QUEUE (ASC-LIST-QUEUE-NAME)                          15440000
154500             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               15450000
154600             ITEM  (PV-BLOCK-NUMBER)                              15460000
154700             RESP  (PV-CICS-RESP)                                 15470000
154800     END-EXEC.                                                    15480000
154900                                                                  15490000
155000     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       15500000
155100       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     15510000
155200         CONTINUE                                                 15520000
155300     ELSE                                                         15530000
155400         SET DP013-CICS-ABEND                                     15540000
155500             DP013-NO-ROLLBACK    TO TRUE                         15550000
155600         MOVE '4410-READ-TEMP-STORAGE' TO DP013-PARAGRAPH         15560000
155700         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      15570000
155800                                       TO DP013-MESSAGE-TEXT(1)   15580000
155900         PERFORM DP013-0000-PROCESS-ABEND                         15590000
156000     END-IF.                                                      15600000
156100                                                                  15610000
156200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             15620000
156300                                                                  15630000
156400     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         15640000
156500         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               15650000
156600     END-IF.                                                      15660000
156700                                                                  15670000
156800                                                                  15680000
156900*----------------------------------------------------------------*15690000
157000* PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.        15700000
157100*----------------------------------------------------------------*15710000
157200 4420-FORMAT-LIST-LINES.                                          15720000
157300                                                                  15730000
157400     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      15740000
157500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                15750000
157600         MOVE DP015-ASK-DRK-OFF TO MR-SELECTA             (PV-SUB)15760000
157700         MOVE SPACE             TO MR-SELECTI             (PV-SUB)15770000
157800                                   MR-ACTION              (PV-SUB)15780000
157900                                   MR-NETWORK-ID          (PV-SUB)15790000
158000                                   MR-NETWORK-NAME        (PV-SUB)15800000
158100                                   MR-NETWORK-TYPE        (PV-SUB)15810000
158200     ELSE                                                         15820000
158300         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      15830000
158400                                                   > SPACE        15840000
158500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 15850000
158600                                 TO MR-SELECTI (PV-SUB)           15860000
158700         ELSE                                                     15870000
158800             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      15880000
158900                                 TO MR-SELECTI (PV-SUB)           15890000
159000         END-IF                                                   15900000
159100                                                                  15910000
159200         IF  DP030-SET-CURSOR-TRAILER                             15920000
159300             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)15930000
159400                 > SPACE)                                         15940000
159500             OR (PV-SUB = 1))                                     15950000
159600                SET DP030-SET-CURSOR-APPL-1 TO TRUE               15960000
159700                MOVE -1          TO MR-SELECTL (PV-SUB)           15970000
159800             END-IF                                               15980000
159900         END-IF                                                   15990000
160000                                                                  16000000
160100         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           16010000
160200             MOVE ASC-ACTION    (ASC-BLK-SUB ASC-ITEM-SUB)        16020000
160300                  TO MR-ACTION              (PV-SUB)              16030000
160400             MOVE ASC-NETWORK-ID   (ASC-BLK-SUB ASC-ITEM-SUB)     16040000
160500                  TO MR-NETWORK-ID          (PV-SUB)              16050000
160600             MOVE ASC-NETWORK-NAME (ASC-BLK-SUB ASC-ITEM-SUB)     16060000
160700                  TO MR-NETWORK-NAME        (PV-SUB)              16070000
160800             MOVE ASC-NETWORK-TYPE                                16080000
160900                                   (ASC-BLK-SUB ASC-ITEM-SUB)     16090000
161000                  TO MR-NETWORK-TYPE (PV-SUB)                     16100000
161100         END-IF                                                   16110000
161200     END-IF.                                                      16120000
161300                                                                  16130000
161400     SUBTRACT +1 FROM ASC-ITEM-SUB                                16140000
161500     IF  ASC-ITEM-SUB < + 1                                       16150000
161600         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  16160000
161700         MOVE +1                 TO ASC-BLK-SUB                   16170000
161800     END-IF.                                                      16180000
161900                                                                  16190000
162000                                                                  16200000
162100*-----------------------------------------------------------------16210000
162200* IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF RANGE16220000
162300* WAS SPECIFIED AND VICE-VERSA. IF ONE IS MISSING, ISSUE A        16230000
162400* WARNING.                                                        16240000
162500*-----------------------------------------------------------------16250000
162600 4430-CHECK-FOR-BEGIN-AND-END.                                    16260000
162700                                                                  16270000
162800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       16280000
162900         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     16290000
163000*            -- NO END-OF-RANGE SPECFIED ---                      16300000
163100             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            16310000
163200             SET DP020-MSG-WARNING TO TRUE                        16320000
163300             PERFORM 4431-POSITION-AT-WARNING                     16330000
163400         END-IF                                                   16340000
163500     ELSE                                                         16350000
163600         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     16360000
163700*            -- NO BEGINNING-OF-RANGE SPECFIED ---                16370000
163800             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            16380000
163900             SET DP020-MSG-WARNING TO TRUE                        16390000
164000             PERFORM 4431-POSITION-AT-WARNING                     16400000
164100         END-IF                                                   16410000
164200     END-IF.                                                      16420000
164300                                                                  16430000
164400                                                                  16440000
164500*-----------------------------------------------------------------16450000
164600* ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,     16460000
164700* DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE IS ON16470000
164800* THE CURRENT SCREEN. IF IT IS, HIGHLIGHT IT AND POSITION THE     16480000
164900* CURSOR THERE.                                                   16490000
165000*-----------------------------------------------------------------16500000
165100 4431-POSITION-AT-WARNING.                                        16510000
165200                                                                  16520000
165300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 16530000
165400                    - PV-TOP-ITEM + 1.                            16540000
165500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16550000
165600         CONTINUE                                                 16560000
165700     ELSE                                                         16570000
165800         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      16580000
165900         MOVE -1                     TO MR-SELECTL (PV-SUB)       16590000
166000         MOVE DP015-REVERSE          TO MR-SELECTH (PV-SUB)       16600000
166100         MOVE DP015-YELLOW           TO MR-SELECTC (PV-SUB)       16610000
166200     END-IF.                                                      16620000
166300                                                                  16630000
166400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   16640000
166500                    - PV-TOP-ITEM + 1.                            16650000
166600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16660000
166700         CONTINUE                                                 16670000
166800     ELSE                                                         16680000
166900         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      16690000
167000         MOVE -1                     TO MR-SELECTL (PV-SUB)       16700000
167100         MOVE DP015-REVERSE          TO MR-SELECTH (PV-SUB)       16710000
167200         MOVE DP015-YELLOW           TO MR-SELECTC (PV-SUB)       16720000
167300     END-IF.                                                      16730000
167400                                                                  16740000
167500                                                                  16750000
167600*----------------------------------------------------------------*16760000
167700* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *16770000
167800* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *16780000
167900* FOR THE SELECTED ITEMS QUEUE.                                  *16790000
168000*                                                                *16800000
168100* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *16810000
168200* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *16820000
168300* THE ARRAY IS FULL.                                             *16830000
168400*----------------------------------------------------------------*16840000
168500 5000-PREPARE-SEL-QUEUE.                                          16850000
168600                                                                  16860000
168700     MOVE +1                   TO  ASC-BLK-SUB.                   16870000
168800     PERFORM 5100-WRITE-TEMP-STORAGE.                             16880000
168900     ADD +1                    TO  ASC-BLK-SUB.                   16890000
169000     PERFORM 5100-WRITE-TEMP-STORAGE.                             16900000
169100                                                                  16910000
169200     MOVE ASC-SEL-QUEUE-NAME   TO  ET336-SEL-QUEUE-NAME.          16920000
169300     PERFORM 6010-DELETE-SEL-QUEUE.                               16930000
169400                                                                  16940000
169500     SET ASC-UPDATE-TSQ        TO  TRUE.                          16950000
169600     SET ET335-IDX             TO  1.                             16960000
169700     MOVE ZERO                 TO ET336-NUMBER-OF-TS-ITEMS.       16970000
169800     INITIALIZE ET335-SELECTED-ITEM-ARRAY.                        16980000
169900                                                                  16990000
170000     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           17000000
170100             VARYING PV-ITEM                                      17010000
170200             FROM 1 BY 1                                          17020000
170300             UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN.           17030000
170400                                                                  17040000
170500     IF  ET335-IDX > 1                                            17050000
170600         PERFORM 5205-WRITE-SEL-QUEUE                             17060000
170700         ADD +1                TO ET336-NUMBER-OF-TS-ITEMS        17070000
170800     END-IF.                                                      17080000
170900                                                                  17090000
171000                                                                  17100000
171100*----------------------------------------------------------------*17110000
171200* WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE. REWRITE  17120000
171300* AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.                17130000
171400*----------------------------------------------------------------*17140000
171500 5100-WRITE-TEMP-STORAGE.                                         17150000
171600                                                                  17160000
171700     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     17170000
171800                                   TO PV-LIST-ITEM-NUMBER.        17180000
171900     COMPUTE PV-BLOCK-NUMBER =                                    17190000
172000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    17200000
172100                                                                  17210000
172200     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             17220000
172300     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             17230000
172400         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      17240000
172500             PERFORM 5105-REWRITE-ASC-LISTQ                       17250000
172600         END-IF                                                   17260000
172700     ELSE                                                         17270000
172800         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       17280000
172900         ASC-HIGHEST-BLOCK-WRITTEN + 1                            17290000
173000         PERFORM 5110-WRITE-ASC-LISTQ                             17300000
173100         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   17310000
173200     END-IF.                                                      17320000
173300                                                                  17330000
173400     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             17340000
173500                                                                  17350000
173600                                                                  17360000
173700******************************************************************17370000
173800* REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       17380000
173900* SPECIFIC COMMAREA.                                              17390000
174000******************************************************************17400000
174100 5105-REWRITE-ASC-LISTQ.                                          17410000
174200                                                                  17420000
174300     EXEC CICS                                                    17430000
174400         WRITEQ TS                                                17440000
174500             QUEUE (ASC-LIST-QUEUE-NAME)                          17450000
174600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               17460000
174700             ITEM  (PV-BLOCK-NUMBER)                              17470000
174800             REWRITE                                              17480000
174900             RESP  (PV-CICS-RESP)                                 17490000
175000     END-EXEC.                                                    17500000
175100                                                                  17510000
175200     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           17520000
175300         CONTINUE                                                 17530000
175400     ELSE                                                         17540000
175500         SET DP013-CICS-ABEND            TO TRUE                  17550000
175600         SET DP013-NO-ROLLBACK           TO TRUE                  17560000
175700         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       17570000
175800         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     17580000
175900                                         TO DP013-MESSAGE-TEXT(1) 17590000
176000         PERFORM DP013-0000-PROCESS-ABEND                         17600000
176100     END-IF.                                                      17610000
176200                                                                  17620000
176300                                                                  17630000
176400*-----------------------------------------------------------------17640000
176500* WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-SPECIFIC 17650000
176600* COMMAREA.                                                       17660000
176700*-----------------------------------------------------------------17670000
176800 5110-WRITE-ASC-LISTQ.                                            17680000
176900                                                                  17690000
177000     EXEC CICS                                                    17700000
177100         WRITEQ TS                                                17710000
177200             QUEUE (ASC-LIST-QUEUE-NAME)                          17720000
177300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               17730000
177400             ITEM  (PV-BLOCK-NUMBER)                              17740000
177500             RESP  (PV-CICS-RESP)                                 17750000
177600     END-EXEC.                                                    17760000
177700                                                                  17770000
177800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      17780000
177900         SET DP013-CICS-ABEND      TO TRUE                        17790000
178000         SET DP013-NO-ROLLBACK     TO TRUE                        17800000
178100         MOVE '5110-WRITE-ASC-LISTQ'                              17810000
178200                                   TO DP013-PARAGRAPH             17820000
178300         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           17830000
178400                                   TO DP013-MESSAGE-TEXT(1)       17840000
178500         PERFORM DP013-0000-PROCESS-ABEND                         17850000
178600     END-IF.                                                      17860000
178700                                                                  17870000
178800                                                                  17880000
178900*----------------------------------------------------------------*17890000
179000* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *17900000
179100* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *17910000
179200*----------------------------------------------------------------*17920000
179300 5200-FILL-SEL-QUEUE-RECORD.                                      17930000
179400                                                                  17940000
179500     PERFORM 6112-READ-LIST-QUEUE.                                17950000
179600                                                                  17960000
179700     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       17970000
179800         PERFORM                                                  17980000
179900         VARYING LQW-IDX                                          17990000
180000         FROM 1 BY 1                                              18000000
180100         UNTIL LQW-IDX > PC-ITEMS-PER-PANEL                       18010000
180200           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO              18020000
180300                                                                  18030000
180400             IF  LQW-SELECT (LQW-IDX)                             18040000
180500                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              18050000
180600                                   TO ET335-ITEM (ET335-IDX)      18060000
180700                 MOVE LQW-NETWK-ID (LQW-IDX)                      18070000
180800                                   TO ET335-NETWORK-ID (ET335-IDX)18080000
180900                 MOVE SPACE        TO ET335-ACTION-SW  (ET335-IDX)18090000
181000                 SET ET335-IDX UP BY 1                            18100000
181100                 IF  ET335-IDX > ET335-MAX-ITEMS                  18110000
181200                     PERFORM 5205-WRITE-SEL-QUEUE                 18120000
181300                     ADD +1        TO ET336-NUMBER-OF-TS-ITEMS    18130000
181400                     INITIALIZE ET335-SELECTED-ITEM-ARRAY         18140000
181500                     SET ET335-IDX TO  1                          18150000
181600                 END-IF                                           18160000
181700             END-IF                                               18170000
181800         END-PERFORM                                              18180000
181900     END-IF.                                                      18190000
182000                                                                  18200000
182100                                                                  18210000
182200*----------------------------------------------------------------*18220000
182300*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *18230000
182400*----------------------------------------------------------------*18240000
182500 5205-WRITE-SEL-QUEUE.                                            18250000
182600                                                                  18260000
182700     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO ET335-SELECTED-ITEMS.   18270000
182800                                                                  18280000
182900     EXEC CICS                                                    18290000
183000          WRITEQ TS                                               18300000
183100              QUEUE (ASC-SEL-QUEUE-NAME)                          18310000
183200              FROM  (ET335-NETWORK-ID-REC)                        18320000
183300              ITEM  (PV-SEL-QUEUE-ITEM)                           18330000
183400              RESP  (PV-CICS-RESP)                                18340000
183500     END-EXEC.                                                    18350000
183600                                                                  18360000
183700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          18370000
183800         CONTINUE                                                 18380000
183900     ELSE                                                         18390000
184000         SET DP013-CICS-ABEND                                     18400000
184100             DP013-NO-ROLLBACK     TO TRUE                        18410000
184200         MOVE '5205-WRITE-SEL-QUEUE'                              18420000
184300                                   TO DP013-PARAGRAPH             18430000
184400         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          18440000
184500                                   TO DP013-MESSAGE-TEXT(1)       18450000
184600         PERFORM DP013-0000-PROCESS-ABEND                         18460000
184700     END-IF.                                                      18470000
184800                                                                  18480000
184900                                                                  18490000
185000*-----------------------------------------------------------------18500000
185100* WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,    18510000
185200* SET UP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY. EDIT THE18520000
185300* SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO THE USER. 18530000
185400******************************************************************18540000
185500 6000-REFRESH-PANEL-FROM-TEMP.                                    18550000
185600                                                                  18560000
185700     IF  ASC-UPDATE-TSQ                                           18570000
185800         SET ASC-NO-TSQ-UPDATE TO TRUE                            18580000
185900         MOVE ZERO             TO PV-SAVE-ITEM                    18590000
186000                                  PV-SEL-QUEUE-ITEM               18600000
186100         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        18610000
186200                                   TO PV-HOLD-SELECTED-ITEMS      18620000
186300         PERFORM 6100-UPDATE-TSQ                                  18630000
186400             UNTIL PV-ITEMS-PROCESSED >                           18640000
186500                                     ASC-NUMBER-OF-SELECTED-ITEMS 18650000
186600         PERFORM 6010-DELETE-SEL-QUEUE                            18660000
186700         INITIALIZE ASC-BLOCK-ENTRIES (1)                         18670000
186800                    ASC-BLOCK-ENTRIES (2)                         18680000
186900                                                                  18690000
187000         DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 18700000
187100                GIVING PV-BLOCK-NUMBER                            18710000
187200                REMAINDER PV-REMAINDER                            18720000
187300         IF  PV-REMAINDER > ZERO                                  18730000
187400             ADD +1     TO PV-BLOCK-NUMBER                        18740000
187500         END-IF                                                   18750000
187600         MOVE +1        TO ASC-BLK-SUB                            18760000
187700         PERFORM 4410-READ-TEMP-STORAGE                           18770000
187800         ADD +1         TO ASC-BLK-SUB                            18780000
187900                           PV-BLOCK-NUMBER                        18790000
188000         PERFORM 4410-READ-TEMP-STORAGE                           18800000
188100     END-IF.                                                      18810000
188200                                                                  18820000
188300                                                                  18830000
188400*----------------------------------------------------------------*18840000
188500*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *18850000
188600*----------------------------------------------------------------*18860000
188700 6010-DELETE-SEL-QUEUE.                                           18870000
188800                                                                  18880000
188900     EXEC CICS                                                    18890000
189000         DELETEQ TS                                               18900000
189100             QUEUE (ASC-SEL-QUEUE-NAME)                           18910000
189200             RESP  (PV-CICS-RESP)                                 18920000
189300     END-EXEC.                                                    18930000
189400                                                                  18940000
189500     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      18950000
189600        (PV-CICS-RESP = DFHRESP(QIDERR)))                         18960000
189700         CONTINUE                                                 18970000
189800     ELSE                                                         18980000
189900         SET DP013-CICS-ABEND                                     18990000
190000             DP013-NO-ROLLBACK TO TRUE                            19000000
190100         MOVE '6010-DELETE-SEL-QUEUE'                             19010000
190200                        TO DP013-PARAGRAPH                        19020000
190300         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         19030000
190400                        TO DP013-MESSAGE-TEXT (1)                 19040000
190500         PERFORM DP013-0000-PROCESS-ABEND                         19050000
190600     END-IF.                                                      19060000
190700                                                                  19070000
190800                                                                  19080000
190900*----------------------------------------------------------------*19090000
191000* INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE. LOOP     19100000
191100* THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER TO BE USED19110000
191200* TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN THE TEMP QUEUE.   19120000
191300*----------------------------------------------------------------*19130000
191400 6100-UPDATE-TSQ.                                                 19140000
191500                                                                  19150000
191600     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             19160000
191700     PERFORM 6105-READ-SEL-QUEUE.                                 19170000
191800     PERFORM                                                      19180000
191900         VARYING ET335-IDX                                        19190000
192000         FROM 1 BY 1                                              19200000
192100         UNTIL ((PV-ITEMS-PROCESSED >                             19210000
192200                              PV-HOLD-SELECTED-ITEMS)             19220000
192300         OR (ET335-IDX > ET335-MAX-ITEMS))                        19230000
192400         IF  ET335-ACTION-SW (ET335-IDX) > SPACE                  19240000
192500             PERFORM 6110-PROCESS-ITEMS                           19250000
192600         END-IF                                                   19260000
192700         ADD +1                TO PV-ITEMS-PROCESSED              19270000
192800     END-PERFORM.                                                 19280000
192900                                                                  19290000
193000     PERFORM 6111-WRITE-LIST-QUEUE.                               19300000
193100                                                                  19310000
193200                                                                  19320000
193300 6105-READ-SEL-QUEUE.                                             19330000
193400                                                                  19340000
193500     EXEC CICS                                                    19350000
193600          READQ TS                                                19360000
193700              QUEUE (ASC-SEL-QUEUE-NAME)                          19370000
193800              INTO  (ET335-NETWORK-ID-REC)                        19380000
193900              ITEM  (PV-SEL-QUEUE-ITEM)                           19390000
194000              RESP  (PV-CICS-RESP)                                19400000
194100     END-EXEC.                                                    19410000
194200                                                                  19420000
194300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          19430000
194400         CONTINUE                                                 19440000
194500     ELSE                                                         19450000
194600         SET DP013-CICS-ABEND                                     19460000
194700             DP013-NO-ROLLBACK     TO  TRUE                       19470000
194800         MOVE '6105-READ-SEL-QUEUE'                               19480000
194900                                   TO  DP013-PARAGRAPH            19490000
195000         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           19500000
195100                                   TO  DP013-MESSAGE-TEXT(1)      19510000
195200         PERFORM DP013-0000-PROCESS-ABEND                         19520000
195300     END-IF.                                                      19530000
195400                                                                  19540000
195500                                                                  19550000
195600*----------------------------------------------------------------*19560000
195700* CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.    19570000
195800* REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE THE19580000
195900* LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.                   19590000
196000*----------------------------------------------------------------*19600000
196100 6110-PROCESS-ITEMS.                                              19610000
196200                                                                  19620000
196300     COMPUTE PV-ITEM = 1 + ((ET335-ITEM (ET335-IDX) - 1)          19630000
196400                     / PC-ITEMS-PER-PANEL).                       19640000
196500                                                                  19650000
196600     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           19660000
196700         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          19670000
196800             PERFORM 6111-WRITE-LIST-QUEUE                        19680000
196900         END-IF                                                   19690000
197000         MOVE PV-ITEM          TO PV-SAVE-ITEM                    19700000
197100                                                                  19710000
197200         PERFORM 6112-READ-LIST-QUEUE                             19720000
197300         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               19730000
197400             CONTINUE                                             19740000
197500         END-IF                                                   19750000
197600     END-IF.                                                      19760000
197700                                                                  19770000
197800     COMPUTE PV-SUB = (ET335-ITEM (ET335-IDX)                     19780000
197900                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              19790000
198000     SET LQW-DESELECT (PV-SUB) TO    TRUE                         19800000
198100     MOVE LQW-SELECTED-SW (PV-SUB)                                19810000
198200                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  19820000
198300     EVALUATE TRUE                                                19830000
198400         WHEN ET335-INQ (ET335-IDX)                               19840000
198500              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             19850000
198600                                                                  19860000
198700         WHEN ET335-UPD (ET335-IDX)                               19870000
198800              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             19880000
198900                                                                  19890000
199000         WHEN ET335-DEL (ET335-IDX)                               19900000
199100              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             19910000
199200                                                                  19920000
199300         WHEN ET335-ERR (ET335-IDX)                               19930000
199400              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             19940000
199500     END-EVALUATE.                                                19950000
199600                                                                  19960000
199700     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                19970000
199800                                                                  19980000
199900                                                                  19990000
200000*----------------------------------------------------------------*20000000
200100*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *20010000
200200*----------------------------------------------------------------*20020000
200300 6111-WRITE-LIST-QUEUE.                                           20030000
200400                                                                  20040000
200500     EXEC CICS                                                    20050000
200600         WRITEQ TS                                                20060000
200700             QUEUE (ASC-LIST-QUEUE-NAME)                          20070000
200800             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     20080000
200900             ITEM  (PV-SAVE-ITEM)                                 20090000
201000             REWRITE                                              20100000
201100             RESP  (PV-CICS-RESP)                                 20110000
201200     END-EXEC.                                                    20120000
201300                                                                  20130000
201400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          20140000
201500         CONTINUE                                                 20150000
201600     ELSE                                                         20160000
201700         SET DP013-CICS-ABEND  TO  TRUE                           20170000
201800         SET DP013-NO-ROLLBACK TO  TRUE                           20180000
201900         MOVE '6111-WRITE-LIST-QUEUE'                             20190000
202000                               TO  DP013-PARAGRAPH                20200000
202100         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  20210000
202200                               TO  DP013-MESSAGE-TEXT(1)          20220000
202300         PERFORM DP013-0000-PROCESS-ABEND                         20230000
202400     END-IF.                                                      20240000
202500                                                                  20250000
202600                                                                  20260000
202700*----------------------------------------------------------------*20270000
202800*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*20280000
202900*----------------------------------------------------------------*20290000
203000 6112-READ-LIST-QUEUE.                                            20300000
203100                                                                  20310000
203200     EXEC CICS                                                    20320000
203300         READQ TS                                                 20330000
203400             QUEUE (ASC-LIST-QUEUE-NAME)                          20340000
203500             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     20350000
203600             ITEM  (PV-ITEM)                                      20360000
203700             RESP  (PV-CICS-RESP)                                 20370000
203800     END-EXEC.                                                    20380000
203900                                                                  20390000
204000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          20400000
204100         CONTINUE                                                 20410000
204200     ELSE                                                         20420000
204300         SET DP013-CICS-ABEND                                     20430000
204400             DP013-NO-ROLLBACK       TO TRUE                      20440000
204500         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           20450000
204600         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    20460000
204700                                     TO DP013-MESSAGE-TEXT(1)     20470000
204800         PERFORM DP013-0000-PROCESS-ABEND                         20480000
204900     END-IF.                                                      20490000
205000                                                                  20500000
205100                                                                  20510000
205200*----------------------------------------------------------------*20520000
205300*    ABEND PROCESSOR MODULE                                      *20530000
205400*----------------------------------------------------------------*20540000
205500                                                                  20550000
205600     COPY DPPD013.                                                20560000
