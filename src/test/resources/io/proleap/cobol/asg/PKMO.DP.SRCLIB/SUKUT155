000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.             SUKUT155.                                00050000
000600 AUTHOR.                 DENISE HAHN.                             00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            DECEMBER 2013.                           00080000
000900 DATE-COMPILED.                                                   00090000
001000***************************************************************** 00100000
001100*                                                               * 00110000
001200*  THIS PROGRAM WILL CREATE AN EXTRACT FILE TO BE USED TO PURGE * 00120000
001300*  OLD ROWS FROM TSULBXF THAT DO NOT HAVE A PARENT/CHILD ROW    * 00130000
001400*  ON EITHER THE INBOUND CARTON TABLE (TSHPUNT) OR THE OUTBOUND * 00140000
001410*  CARTON TABLE (SUT_OTBND_CART).                               * 00141000
001440***************************************************************** 00144000
001450***************************************************************** 00145000
001460 ENVIRONMENT DIVISION.                                            00146000
001470***************************************************************** 00147000
001480                                                                  00148000
001490 CONFIGURATION SECTION.                                           00149000
001500                                                                  00150000
001600 SOURCE-COMPUTER.        IBM-3090.                                00160000
001700 OBJECT-COMPUTER.        IBM-3090.                                00170000
001800                                                                  00180000
001900 INPUT-OUTPUT SECTION.                                            00190000
002000                                                                  00200000
002100 FILE-CONTROL.                                                    00210000
002200*                                                                 00220000
002300     SELECT XREF-OUT-FILE                                         00230000
002400         ASSIGN TO OUT01.                                         00240000
002500*                                                                 00250000
002600***************************************************************** 00260000
002700 DATA DIVISION.                                                   00270000
002800***************************************************************** 00280000
002900*                                                                 00290000
003000 FILE SECTION.                                                    00300000
003100*                                                                 00310000
003200 FD  XREF-OUT-FILE                                                00320000
003300     RECORDING MODE IS F                                          00330000
003400     LABEL RECORDS ARE STANDARD                                   00340000
003500     BLOCK CONTAINS 0 RECORDS.                                    00350000
003600*                                                                 00360000
003700 01  XREF-OUT-REC                    PIC  X(088).                 00370000
003710*                                                                 00371000
003800 WORKING-STORAGE SECTION.                                         00380000
003900*                                                                 00390000
004000 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00400000
004100                                                   COMP SYNC.     00410000
004200*                                                                 00420000
004300 01  PROGRAM-SWITCHES.                                            00430000
004400     05  PS-EOF-TSULBXF-CURSOR-SW    PIC  X(01)    VALUE 'N'.     00440000
004500         88  PS-EOF-TSULBXF-CSR                    VALUE 'Y'.     00450000
004600         88  PS-NOT-EOF-TSULBXF-CSR                VALUE 'N'.     00460000
004700     05  PS-CARTON-ON-INBD-SW        PIC  X(01)    VALUE 'N'.     00470005
004800         88  PS-CARTON-ON-INBD-YES                 VALUE 'Y'.     00480005
004900         88  PS-CARTON-ON-INBD-NO                  VALUE 'N'.     00490005
004910     05  PS-CARTON-ON-OTBD-SW        PIC  X(01)    VALUE 'N'.     00491005
004920         88  PS-CARTON-ON-OTBD-YES                 VALUE 'Y'.     00492005
004930         88  PS-CARTON-ON-OTBD-NO                  VALUE 'N'.     00493005
005000                                                                  00500000
005100 01  PC-PROGRAM-CONSTANTS.                                        00510000
005200     05  PC-CURRENT-PROGRAM-NAME    PIC  X(08)     VALUE          00520000
005300                                                   'SUKUT155'.    00530000
005400                                                                  00540000
005500 01  PV-PROGRAM-VARIABLES.                                        00550000
005600     05  PV-DISPLAY-PURGE-WEEKS      PIC  Z(09).                  00560000
005700     05  PV-DISPLAY-COUNT            PIC  ZZZ,ZZZ,ZZ9.            00570000
005800     05  PV-DISPLAY-SQLCODE          PIC -9(03).                  00580001
005801     05  PV-DISPLAY-SSCC             PIC  Z(18).                  00580101
005810     05  PV-DISPLAY-BRCDE            PIC  X(22).                  00581001
005820     05  PV-DISPLAY-DEST             PIC  Z(04).                  00582001
005900                                                                  00590000
006000     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  00600000
006100     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  00610000
006200     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  00620000
006300                                                                  00630000
006400     05  PV-FETCH-CNT                PIC  9(09)    VALUE ZERO.    00640000
006600     05  PV-OUTPUT-CNT               PIC  9(09)    VALUE ZERO.    00660000
006700     05  PV-INBD-ERROR-CNT           PIC  9(09)    VALUE ZERO.    00670000
006710     05  PV-OTBD-ERROR-CNT           PIC  9(09)    VALUE ZERO.    00671000
007100                                                                  00710000
007200 01  DK-DB-KEYS.                                                  00720000
007300     05  DK-PURGE-WEEKS              PIC S9(09)  COMP.            00730000
007310     05  DK-CURRENT-TIMESTAMP        PIC  X(26).                  00731000
007320     05  DK-PURGE-TIMESTAMP          PIC  X(26).                  00732000
007400                                                                  00740000
007700                                                                  00770000
007800/                                                                 00780000
007900******************************************************************00790000
008000*  DB2 FORMATTED MESSAGE AREA                                     00800000
008100******************************************************************00810000
008200     COPY DPWS004.                                                00820000
008300                                                                  00830000
008400******************************************************************00840000
008500*  COPY BOOK FOR THE PARAMETER TABLE                              00850000
008600******************************************************************00860000
008700     EXEC SQL                                                     00870000
008800          INCLUDE TKRPRPM                                         00880000
008900     END-EXEC.                                                    00890000
009000                                                                  00900000
009100******************************************************************00910000
009200*  COPY BOOK FOR THE INBND/OTBND CARTON CROSS REFERENCE           00920000
009300******************************************************************00930000
009400     EXEC SQL                                                     00940000
009500          INCLUDE TSULBXF                                         00950000
009600     END-EXEC.                                                    00960000
009700                                                                  00970000
009800******************************************************************00980000
009900*  COPY BOOK FOR THE INBOUND CARTON TABLE - TSHPUNT               00990000
010000******************************************************************01000000
010100     EXEC SQL                                                     01010000
010200          INCLUDE TSHPUNT                                         01020002
010300     END-EXEC.                                                    01030000
010400                                                                  01040000
010500******************************************************************01050000
010600*  COPY BOOK FOR THE OUTBOUND CARTON TABLE - SUT_OTBND_CART       01060000
010700******************************************************************01070000
010800     EXEC SQL                                                     01080000
010900          INCLUDE SUT00024                                        01090000
011000     END-EXEC.                                                    01100000
011100                                                                  01110000
012600******************************************************************01260000
012700*  DB2 COMMUNICATION AREA                                         01270000
012800******************************************************************01280000
012900     EXEC SQL                                                     01290000
013000         INCLUDE SQLCA                                            01300000
013100     END-EXEC.                                                    01310000
013200                                                                  01320000
013300******************************************************************01330000
013400*  DB2 COMMUNICATION AREA2                                        01340000
013500******************************************************************01350000
013600     COPY SQLCA2.                                                 01360000
013700                                                                  01370000
013800                                                                  01380000
013900     EXEC SQL                                                     01390000
014000       DECLARE TSULBXF_CSR CURSOR FOR                             01400000
014100         SELECT SHIPT_UNT_ID                                      01410000
014200               ,BRCDE_NBR                                         01420000
014210               ,CART_LBL_TYP_CDE                                  01421000
014220               ,DEST_OPER_UNT_ID                                  01422000
014230               ,STAT_CDE                                          01423000
014240               ,LAST_STAT_CHG_TMST                                01424000
014250               ,CRE_TMST                                          01425000
014300          FROM  TSULBXF                                           01430000
014400          WHERE CRE_TMST <= :DK-PURGE-TIMESTAMP                   01440004
014500           WITH UR                                                01450000
014600     END-EXEC.                                                    01460000
015800                                                                  01580000
015900*                                                                 01590000
016000 PROCEDURE DIVISION.                                              01600000
016100*                                                                 01610000
016200 0000-MAINLINE-PROCESSING.                                        01620000
016300******************************************************************01630000
016400**  THIS IS THE MAIN DRIVER FOR THE PROGRAM.                      01640000
016500******************************************************************01650000
016600                                                                  01660000
016700     PERFORM 1000-INITIALIZATION.                                 01670000
016800                                                                  01680000
016900     PERFORM 2000-PROCESS-TSULBXF                                 01690000
017000       UNTIL PS-EOF-TSULBXF-CSR.                                  01700000
017100                                                                  01710000
017200     PERFORM 2300-CLOSE-TSULBXF-CSR.                              01720000
017700                                                                  01770000
017800     DISPLAY ' '                                                  01780000
017801                                                                  01780100
017802     MOVE  PV-FETCH-CNT         TO  PV-DISPLAY-COUNT.             01780200
017810     DISPLAY 'TOTAL ROWS FETCHED:   ' PV-DISPLAY-COUNT.           01781000
017820                                                                  01782000
017830     MOVE  PV-INBD-ERROR-CNT    TO  PV-DISPLAY-COUNT.             01783000
017900     DISPLAY 'INBOUND ERROR COUNT:  ' PV-DISPLAY-COUNT.           01790000
017901                                                                  01790100
017902     MOVE  PV-OTBD-ERROR-CNT    TO  PV-DISPLAY-COUNT.             01790200
017910     DISPLAY 'OUTBOUND ERROR COUNT: ' PV-DISPLAY-COUNT.           01791000
017911                                                                  01791100
017912     MOVE  PV-OUTPUT-CNT        TO  PV-DISPLAY-COUNT.             01791200
017920     DISPLAY 'EXTRACT COUNT:        ' PV-DISPLAY-COUNT.           01792000
017921                                                                  01792100
017930     DISPLAY ' '                                                  01793000
018700                                                                  01870000
018800     CLOSE XREF-OUT-FILE.                                         01880000
018900                                                                  01890000
019000     GOBACK.                                                      01900000
019100                                                                  01910000
019200                                                                  01920000
019300 1000-INITIALIZATION.                                             01930000
019400******************************************************************01940000
019500**  PERFORM THE INITIAL PROCESSING FOR THE PROGRAM.               01950000
019600******************************************************************01960000
019700                                                                  01970000
019710     MOVE  SPACES  TO  SULBXF-BRCDE-NBR                           01971006
019711                       SULBXF-CART-LBL-TYP-CDE                    01971106
019712                       SULBXF-STAT-CDE                            01971206
019713                       SULBXF-LAST-STAT-CHG-TMST                  01971306
019714                       SULBXF-CRE-TMST.                           01971406
019720     MOVE  ZEROES  TO  SULBXF-SHIPT-UNT-ID                        01972006
019730                       SULBXF-DEST-OPER-UNT-ID.                   01973006
019740                                                                  01974006
019800     OPEN OUTPUT XREF-OUT-FILE.                                   01980000
019900                                                                  01990000
020000     PERFORM 7000-GET-PURGE-DATE.                                 02000000
020100                                                                  02010000
020600     SET  PS-NOT-EOF-TSULBXF-CSR  TO  TRUE.                       02060000
020800                                                                  02080000
020900     PERFORM 2100-OPEN-TSULBXF-CSR.                               02090000
021100                                                                  02110000
021110     PERFORM 2200-FETCH-TSULBXF-CSR.                              02111009
021200                                                                  02120000
021300*                                                                 02130000
021400 2000-PROCESS-TSULBXF.                                            02140000
021500                                                                  02150000
021600     SET  PS-CARTON-ON-INBD-NO                                    02160000
021700          PS-CARTON-ON-OTBD-NO  TO  TRUE.                         02170000
021800                                                                  02180000
022400     PERFORM 2400-CHECK-INBOUND.                                  02240000
022410                                                                  02241000
022420     IF  PS-CARTON-ON-INBD-YES                                    02242000
022430         CONTINUE                                                 02243000
022440     ELSE                                                         02244000
022500         PERFORM 2500-CHECK-OUTBOUND                              02250000
022510     END-IF.                                                      02251000
022600                                                                  02260000
022700     IF  PS-CARTON-ON-INBD-YES  OR                                02270000
022710         PS-CARTON-ON-OTBD-YES                                    02271000
022720         CONTINUE                                                 02272000
022730     ELSE                                                         02273000
023100         PERFORM 8000-WRITE-EXTRACT-RECORD                        02310000
023600     END-IF.                                                      02360000
023800                                                                  02380000
023900     PERFORM 2200-FETCH-TSULBXF-CSR.                              02390000
024000                                                                  02400000
024100                                                                  02410000
024200 2100-OPEN-TSULBXF-CSR.                                           02420000
024300     MOVE '2100-OPEN-TSULBXF-CSR'    TO PV-ABEND-PARAGRAPH.       02430000
024400                                                                  02440000
024500     EXEC SQL                                                     02450000
024600          OPEN TSULBXF_CSR                                        02460002
024700     END-EXEC.                                                    02470000
024800                                                                  02480000
024900     EVALUATE TRUE                                                02490000
025000         WHEN SQLCODE = 0                                         02500000
025100             CONTINUE                                             02510000
025200         WHEN SQLWARN0 NOT = SPACES                               02520000
025300         WHEN SQLCODE < ZERO                                      02530000
025400         WHEN SQLCODE > ZERO                                      02540000
025401            MOVE SQLCODE              TO  PV-DISPLAY-SQLCODE      02540101
025402            MOVE SULBXF-SHIPT-UNT-ID  TO  PV-DISPLAY-SSCC         02540201
025403            MOVE SULBXF-BRCDE-NBR     TO  PV-DISPLAY-BRCDE        02540301
025410            DISPLAY 'SUKUT155 - 2100  '                           02541001
025420                    'SQL:'   PV-DISPLAY-SQLCODE  '  '             02542001
025430                    'SSCC:'  PV-DISPLAY-SSCC     '  '             02543001
025440                    'BRCDE:' PV-DISPLAY-BRCDE                     02544001
025450                                                                  02545001
025500             MOVE '2100-OPEN-TSULBXF-CSR'                         02550000
025600                             TO PV-PARAGRAPH-NAME                 02560000
025700             MOVE 'OPEN THE TSULBXF_CURSOR            '           02570000
025800                             TO PV-DB2-OPERATION-ATTEMPTED        02580000
025900             PERFORM 9100-SQL-ABEND                               02590000
026000     END-EVALUATE.                                                02600000
026100                                                                  02610000
026200                                                                  02620000
026300 2200-FETCH-TSULBXF-CSR.                                          02630000
026400     MOVE '2200-FETCH-TSULBXF-CSR'   TO PV-ABEND-PARAGRAPH.       02640000
026500                                                                  02650000
026600     EXEC SQL                                                     02660000
026700          FETCH TSULBXF_CSR                                       02670002
026800          INTO  :SULBXF-SHIPT-UNT-ID                              02680000
026900              , :SULBXF-BRCDE-NBR                                 02690000
026910              , :SULBXF-CART-LBL-TYP-CDE                          02691000
026920              , :SULBXF-DEST-OPER-UNT-ID                          02692000
026930              , :SULBXF-STAT-CDE                                  02693000
026940              , :SULBXF-LAST-STAT-CHG-TMST                        02694000
026950              , :SULBXF-CRE-TMST                                  02695000
027000     END-EXEC.                                                    02700000
027100                                                                  02710000
027200     EVALUATE TRUE                                                02720000
027300       WHEN SQLCODE = ZEROS                                       02730000
027400            ADD  1  TO  PV-FETCH-CNT                              02740000
027500       WHEN SQLCODE = +100                                        02750000
027600            SET PS-EOF-TSULBXF-CSR  TO TRUE                       02760000
027700       WHEN SQLWARN0 NOT = SPACES                                 02770000
027800       WHEN SQLCODE < ZERO                                        02780000
027900       WHEN SQLCODE > ZERO                                        02790000
027910            MOVE SQLCODE              TO  PV-DISPLAY-SQLCODE      02791001
027920            MOVE SULBXF-SHIPT-UNT-ID  TO  PV-DISPLAY-SSCC         02792001
027930            MOVE SULBXF-BRCDE-NBR     TO  PV-DISPLAY-BRCDE        02793001
027931            DISPLAY 'SUKUT155 - 2200  '                           02793101
027932                    'SQL:'   PV-DISPLAY-SQLCODE  '  '             02793201
027933                    'SSCC:'  PV-DISPLAY-SSCC     '  '             02793301
027934                    'BRCDE:' PV-DISPLAY-BRCDE                     02793401
027940                                                                  02794001
028000            MOVE '2200-FETCH-TSULBXF-CSR'                         02800001
028100                               TO PV-PARAGRAPH-NAME               02810000
028200            MOVE 'FETCH TSULBXF CURSOR '                          02820001
028300                               TO PV-DB2-OPERATION-ATTEMPTED      02830000
028400            PERFORM 9100-SQL-ABEND                                02840001
028500     END-EVALUATE.                                                02850000
028600                                                                  02860000
028700                                                                  02870000
028800 2300-CLOSE-TSULBXF-CSR.                                          02880000
028900     MOVE '2300-CLOSE-TSULBXF-CSR'   TO PV-ABEND-PARAGRAPH.       02890000
029000                                                                  02900000
029100     EXEC SQL                                                     02910000
029200         CLOSE TSULBXF_CSR                                        02920002
029300     END-EXEC.                                                    02930000
029400                                                                  02940000
029500     EVALUATE TRUE                                                02950000
029600         WHEN SQLCODE = ZERO                                      02960000
029700         WHEN SQLCODE = -904                                      02970000
029800         WHEN SQLCODE = -911                                      02980000
029900              CONTINUE                                            02990000
030000         WHEN SQLWARN0 NOT = SPACES                               03000000
030100         WHEN SQLCODE < ZERO                                      03010000
030200         WHEN SQLCODE > ZERO                                      03020000
030201              MOVE SQLCODE              TO  PV-DISPLAY-SQLCODE    03020101
030202              MOVE SULBXF-SHIPT-UNT-ID  TO  PV-DISPLAY-SSCC       03020201
030203              MOVE SULBXF-BRCDE-NBR     TO  PV-DISPLAY-BRCDE      03020301
030210              DISPLAY 'SUKUT155 - 2300  '                         03021001
030220                      'SQL:'   PV-DISPLAY-SQLCODE  '  '           03022001
030230                      'SSCC:'  PV-DISPLAY-SSCC     '  '           03023001
030240                      'BRCDE:' PV-DISPLAY-BRCDE                   03024001
030250                                                                  03025001
030300              MOVE '2300-CLOSE-TSULBXF-CSR'                       03030000
030400                              TO PV-PARAGRAPH-NAME                03040000
030500              MOVE 'CLOSE THE TSULBXF-CSR              '          03050000
030600                              TO PV-DB2-OPERATION-ATTEMPTED       03060000
030700              PERFORM 9100-SQL-ABEND                              03070000
030800     END-EVALUATE.                                                03080000
030900                                                                  03090000
031000                                                                  03100000
031100 2400-CHECK-INBOUND.                                              03110000
031200     MOVE '2400-CHECK-INBOUND'   TO PV-ABEND-PARAGRAPH.           03120000
031400                                                                  03140000
031500     EXEC SQL                                                     03150000
031600         SELECT SHIPT_UNT_ID                                      03160001
031700           INTO :SHPUNT-SHIPT-UNT-ID                              03170001
031800           FROM TSHPUNT                                           03180001
032000          WHERE SHIPT_UNT_ID  = :SULBXF-SHIPT-UNT-ID              03200003
032010          FETCH FIRST 1 ROW ONLY                                  03201008
032100           WITH UR                                                03210001
032500     END-EXEC.                                                    03250000
032600                                                                  03260000
032700     EVALUATE TRUE                                                03270000
032800         WHEN SQLCODE = ZEROS                                     03280000
032801         WHEN SQLCODE = -811                                      03280107
032810              SET  PS-CARTON-ON-INBD-YES  TO  TRUE                03281001
032820              ADD  1  TO   PV-INBD-ERROR-CNT                      03282001
032821                                                                  03282101
032830              MOVE SULBXF-SHIPT-UNT-ID     TO PV-DISPLAY-SSCC     03283001
032840              MOVE SULBXF-BRCDE-NBR        TO PV-DISPLAY-BRCDE    03284001
032860              MOVE SULBXF-DEST-OPER-UNT-ID TO PV-DISPLAY-DEST     03286001
032900                                                                  03290001
032901              DISPLAY 'SUKUT155: ON INBD  '                       03290101
032902                      'SSCC:'  PV-DISPLAY-SSCC            '  '    03290201
032903                      'BRCDE:' PV-DISPLAY-BRCDE           '  '    03290301
032904                      'TYPE:'  SULBXF-CART-LBL-TYP-CDE    '  '    03290401
032905                      'DEST:'  PV-DISPLAY-DEST            '  '    03290501
032906                      'ST:'    SULBXF-STAT-CDE            '  '    03290601
032907                      'CHG:'   SULBXF-LAST-STAT-CHG-TMST  '  '    03290701
032908                      'CRE:'   SULBXF-CRE-TMST            '  '    03290801
032910         WHEN SQLCODE = +100                                      03291000
032911              SET  PS-CARTON-ON-INBD-NO   TO  TRUE                03291101
032930         WHEN SQLWARN0 NOT = SPACES                               03293000
032940         WHEN SQLCODE < ZERO                                      03294000
032950         WHEN SQLCODE > ZERO                                      03295000
032951              MOVE SQLCODE              TO  PV-DISPLAY-SQLCODE    03295101
032952              MOVE SULBXF-SHIPT-UNT-ID  TO  PV-DISPLAY-SSCC       03295201
032953              MOVE SULBXF-BRCDE-NBR     TO  PV-DISPLAY-BRCDE      03295301
032954              DISPLAY 'SUKUT155 - 2400  '                         03295401
032955                      'SQL:'   PV-DISPLAY-SQLCODE  '  '           03295501
032956                      'SSCC:'  PV-DISPLAY-SSCC     '  '           03295601
032957                      'BRCDE:' PV-DISPLAY-BRCDE                   03295701
032958                                                                  03295801
032960              MOVE '2400-CHECK-INBOUND'                           03296001
032970                             TO PV-PARAGRAPH-NAME                 03297000
032980              MOVE 'CHECK CARTON ON INBOUND TSHPUNT'              03298001
032990                             TO PV-DB2-OPERATION-ATTEMPTED        03299000
032991              PERFORM 9100-SQL-ABEND                              03299101
032992         WHEN SQLCODE = ZERO                                      03299201
032993              CONTINUE                                            03299300
032994     END-EVALUATE.                                                03299400
032995                                                                  03299500
032996                                                                  03299600
033200 2500-CHECK-OUTBOUND.                                             03320000
033300     MOVE '2500-CHECK-OUTBOUND'  TO PV-ABEND-PARAGRAPH.           03330000
033320                                                                  03332001
033330     EXEC SQL                                                     03333001
033340         SELECT SHIPT_UNT_ID                                      03334001
033350           INTO :SUT00024-SHIPT-UNT-ID                            03335001
033360           FROM SUT_OTBND_CART                                    03336001
033370          WHERE ORIG_CART_ID  = :SULBXF-SHIPT-UNT-ID              03337003
033371          FETCH FIRST 1 ROW ONLY                                  03337108
033380           WITH UR                                                03338001
033390     END-EXEC.                                                    03339001
033391                                                                  03339101
033392     EVALUATE TRUE                                                03339201
033393         WHEN SQLCODE = ZEROS                                     03339301
033394         WHEN SQLCODE = -811                                      03339408
033395              SET  PS-CARTON-ON-OTBD-YES  TO  TRUE                03339508
033396              ADD  1  TO   PV-OTBD-ERROR-CNT                      03339608
033397                                                                  03339708
033398              MOVE SULBXF-SHIPT-UNT-ID     TO PV-DISPLAY-SSCC     03339808
033399              MOVE SULBXF-BRCDE-NBR        TO PV-DISPLAY-BRCDE    03339908
033400              MOVE SULBXF-DEST-OPER-UNT-ID TO PV-DISPLAY-DEST     03340008
033401                                                                  03340108
033402              DISPLAY 'SUKUT155: ON OTBD  '                       03340208
033403                      'SSCC:'  PV-DISPLAY-SSCC            '  '    03340308
033404                      'BRCDE:' PV-DISPLAY-BRCDE           '  '    03340408
033405                      'TYPE:'  SULBXF-CART-LBL-TYP-CDE    '  '    03340508
033406                      'DEST:'  PV-DISPLAY-DEST            '  '    03340608
033407                      'ST:'    SULBXF-STAT-CDE            '  '    03340708
033408                      'CHG:'   SULBXF-LAST-STAT-CHG-TMST  '  '    03340808
033409                      'CRE:'   SULBXF-CRE-TMST            '  '    03340908
033410                                                                  03341008
033411         WHEN SQLCODE = +100                                      03341108
033412              SET  PS-CARTON-ON-OTBD-NO   TO  TRUE                03341208
033413         WHEN SQLWARN0 NOT = SPACES                               03341308
033414         WHEN SQLCODE < ZERO                                      03341408
033415         WHEN SQLCODE > ZERO                                      03341508
033416              MOVE SQLCODE              TO  PV-DISPLAY-SQLCODE    03341608
033417              MOVE SULBXF-SHIPT-UNT-ID  TO  PV-DISPLAY-SSCC       03341708
033418              MOVE SULBXF-BRCDE-NBR     TO  PV-DISPLAY-BRCDE      03341808
033419              DISPLAY 'SUKUT155 - 2500  '                         03341908
033420                      'SQL:'   PV-DISPLAY-SQLCODE  '  '           03342008
033421                      'SSCC:'  PV-DISPLAY-SSCC     '  '           03342108
033422                      'BRCDE:' PV-DISPLAY-BRCDE                   03342208
033423                                                                  03342308
033424              MOVE '2500-CHECK-OUTBOUND'                          03342408
033425                             TO PV-PARAGRAPH-NAME                 03342508
033426              MOVE 'CHECK CARTON ON OUTBOUND SUT_OTBND_CART'      03342608
033440                             TO PV-DB2-OPERATION-ATTEMPTED        03344001
033450              PERFORM 9100-SQL-ABEND                              03345001
033460         WHEN SQLCODE = ZERO                                      03346001
033470              CONTINUE                                            03347001
033480     END-EVALUATE.                                                03348001
033490                                                                  03349001
033491                                                                  03349101
046865 7000-GET-PURGE-DATE.                                             04686500
046866                                                                  04686600
046867     EXEC SQL                                                     04686700
046868         SELECT  FUNC_QTY                                         04686800
046869              ,  CURRENT TIMESTAMP                                04686900
046870              ,  (CURRENT TIMESTAMP -(FUNC_QTY * 7) DAYS)         04687000
046871           INTO :DK-PURGE-WEEKS                                   04687100
046872              , :DK-CURRENT-TIMESTAMP                             04687200
046873              , :DK-PURGE-TIMESTAMP                               04687300
046874           FROM TKRPRPM                                           04687400
046875          WHERE LOC_ID            =  90                           04687500
046876            AND INTFC_SYS_CDE     = 'KHL'                         04687600
046877            AND SYS_PRC_FUNC_CDE  = 'XFPURG'                      04687700
046878            AND FUNC_PRC_STAT_CDE = 'AC'                          04687800
046879            AND FUNC_BEG_TMST    <=  CURRENT TIMESTAMP            04687900
046880            AND FUNC_END_TMST    >=  CURRENT TIMESTAMP            04688000
046881     END-EXEC.                                                    04688100
046882                                                                  04688200
046883     EVALUATE TRUE                                                04688300
046884         WHEN SQLCODE = ZEROS                                     04688400
046885              MOVE  DK-PURGE-WEEKS  TO  PV-DISPLAY-PURGE-WEEKS    04688500
046886              DISPLAY ' '                                         04688600
046887              DISPLAY '** SUKUT155 **'                            04688700
046888              DISPLAY '** PURGE ' PV-DISPLAY-PURGE-WEEKS          04688802
046889                      ' WEEKS **'                                 04688900
046890              DISPLAY '** CURRENT TIMESTAMP: '                    04689000
046891                       DK-CURRENT-TIMESTAMP                       04689100
046892              DISPLAY '** PURGE TIIMESTAMP:  '                    04689200
046893                       DK-PURGE-TIMESTAMP                         04689300
046894              DISPLAY ' '                                         04689400
046895         WHEN SQLWARN0 NOT = SPACES                               04689500
046896         WHEN SQLCODE < ZERO                                      04689600
046897         WHEN SQLCODE > ZERO                                      04689700
046898              MOVE SQLCODE              TO  PV-DISPLAY-SQLCODE    04689801
046899              MOVE SULBXF-SHIPT-UNT-ID  TO  PV-DISPLAY-SSCC       04689901
046900              MOVE SULBXF-BRCDE-NBR     TO  PV-DISPLAY-BRCDE      04690001
046901              DISPLAY 'SUKUT155 - 7000 '                          04690101
046902                      'PARM: XFPURG  '                            04690201
046903                      'SQL:'   PV-DISPLAY-SQLCODE  '  '           04690301
046904                      'SSCC:'  PV-DISPLAY-SSCC     '  '           04690401
046905                      'BRCDE:' PV-DISPLAY-BRCDE                   04690501
046906                                                                  04690601
046907              MOVE '7000-GET-PURGE-DATE '                         04690701
046908                             TO PV-PARAGRAPH-NAME                 04690801
046909              MOVE 'GET NUMBER OF WEEKS TO PURGE   '              04690901
046910                             TO PV-DB2-OPERATION-ATTEMPTED        04691001
046911              PERFORM 9100-SQL-ABEND                              04691101
046912     END-EVALUATE.                                                04691201
046920                                                                  04692000
047000                                                                  04700000
047030 8000-WRITE-EXTRACT-RECORD.                                       04703000
047040                                                                  04704000
047051     INITIALIZE XREF-OUT-REC.                                     04705100
047052     WRITE XREF-OUT-REC FROM DCLTSULBXF.                          04705200
047053     ADD +1 TO PV-OUTPUT-CNT.                                     04705300
047060                                                                  04706000
047070                                                                  04707000
047080 9100-SQL-ABEND.                                                  04708000
047090******************************************************************04709000
047100*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    04710000
047200*  ERROR OR WARNING CODE OCCURS.                                  04720000
047300******************************************************************04730000
047400     DISPLAY '9100-SQL-ABEND'.                                    04740000
047500     DISPLAY '** ABEND     **'.                                   04750000
047600     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        04760000
047700     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              04770000
047800     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     04780000
047900                                                                  04790000
048000******************************************************************04800000
048100* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    04810000
048200* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         04820000
048300* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     04830000
048400* FORMAT.                                                         04840000
048500******************************************************************04850000
048600     COPY DPPD004.                                                04860000
048700                                                                  04870000
048800     MOVE +4013                  TO ABEND-CODE.                   04880000
048900     CALL 'ILBOABN0' USING ABEND-CODE.                            04890000
049000                                                                  04900000
