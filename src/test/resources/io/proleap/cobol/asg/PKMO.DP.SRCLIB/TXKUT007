000100******************************************************************00010043
000200 IDENTIFICATION DIVISION.                                         00020043
000300******************************************************************00030043
000400                                                                  00040043
000500 PROGRAM-ID.             TXKUT007.                                00050043
000600 AUTHOR.                 KATHY PRIESTER.                          00060043
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070043
000800 DATE-WRITTEN.           MARCH 2001.                              00080043
000900 DATE-COMPILED.                                                   00090043
001000                                                                  00100043
001100***************************************************************** 00110043
001200*  THIS PROGRAM SUMMARIZES THE TAX EXTRACT RECORDS FOR TAX        00120043
001300*  REPORTING.  THE TRANSACTIONS ARE SUMMARIZED BY STORE, STATE,   00130043
001400*  ZIP CODE, GEO CODE, ORDER DATE, EXEMPT INDICATOR, PRODUCT CODE,00140043
001500*  TAX RATE, DEBIT/CREDIT INDICATOR, AND CALCULATION INDICATOR.   00150043
001600*                                                                 00160043
001700*  THE INPUT FILE MUST BE SORTED BY THE DATA ELEMENTS LISTED ABOVE00170043
001800*                                                                 00180043
001900*  DEPARTMENTS 981 AND 983 ARE NOT INCLUDED IN THE SUMMARY        00190043
001910******************************************************************00200043
002000* 08/16/2001 CHANGED PROGRAM TO WRITE TRANSACTIONS THAT HAVE A    00210043
002010* K.PRIESTER GROSS AMOUNT OF ZERO AND A TAX AMOUNT THAT IS NOT    00220043
002020* EL PASO    ZERO.  TAX REFUNDS DO NOT HAVE A GROSS SALES AMOUNT. 00230043
002030*            THEY ONLY HAVE A TAX AMOUNT.  THE PROGRAM PREVIOUSLY 00240043
002040*            SKIPPED ALL TRANSACTIONS WITH A GROSS AMOUNT OF ZERO.00250043
002050*                                                                 00260043
P8612 ******************************************************************00270043
P8612 *  CHANGED 10/09/2014   BY COGNIZANT       CHG0092405             00280043
P8612 *  CHANGED PROGRAM TO EXCLUDE MARKETPLACE TRANSACTIONS FROM THE   00290043
P8612 *  SUMMARY TOTALS.                                                00300043
P8612 *                                                                 00310043
C3258 ******************************************************************00320043
C3258 *  CHANGED 01/27/2014   BY COGNIZANT       CHG0103258             00330043
C3258 *  CHANGED PROGRAM TO EXCLUDE THIRD PARTY GIFT CARD SALES FROM    00340043
C3258 *  TAXBATCH PROCESS                                               00350043
C19114******************************************************************00360043
C19114*  08/13/15  COGNIZANT    CHG0119114                             *00370043
C19114*  MODIFIED THE DATE LOGIC FOR LATES AND CORRECTION TRANSACTIONS *00380043
C19114*  PROCESS DATE IS UNCHANGED FROM HOW IT WAS IN THE TAX EXTRACT  *00390043
C19114******************************************************************00400043
12386A*  12/10/18  COGNIZANT                                           *00401047
12386A*  CHANGES DONE TO IGNORE THE CHARITABLE DONATION CATEGORY 81710 *00402047
12386A*  FROM FURTHER PROCESSING.                                      *00403047
12386A******************************************************************00404047
SEPHOR*  CHANGED 04/26/2022   BY BARB SCHULTZ    CHG0269533             00406054
SEPHOR*  CHANGED PROGRAM TO EXCLUDE SEPHORA GIFT CARD SALES FROM        00407050
SEPHOR*  TAXBATCH PROCESS                                               00408050
002100******************************************************************00410043
002200 ENVIRONMENT DIVISION.                                            00420043
002300******************************************************************00430043
002400                                                                  00440043
002500 CONFIGURATION SECTION.                                           00450043
002600                                                                  00460043
002700 SOURCE-COMPUTER.    IBM-3090.                                    00470043
002800 OBJECT-COMPUTER.    IBM-3090.                                    00480043
002900                                                                  00490043
003000 INPUT-OUTPUT SECTION.                                            00500043
003100                                                                  00510043
003200 FILE-CONTROL.                                                    00520043
003300                                                                  00530043
003400     SELECT POS-DATE-CARD-FILE                                    00540043
003500         ASSIGN TO INP01.                                         00550043
003600                                                                  00560043
003700     SELECT TAX-EXTRACT-IN-FILE                                   00570043
003800         ASSIGN TO INP02.                                         00580043
003900                                                                  00590043
003910     SELECT TAX-EXCLU-IN-FILE                                     00600043
003920         ASSIGN TO INP03.                                         00610043
003930                                                                  00620043
004000     SELECT TAX-SUMMARY-FILE                                      00630043
004100         ASSIGN TO OUT01.                                         00640043
004200                                                                  00650043
004300******************************************************************00660043
004400 DATA DIVISION.                                                   00670043
004500******************************************************************00680043
004600                                                                  00690043
004700 FILE SECTION.                                                    00700043
004800                                                                  00710043
004900 FD  POS-DATE-CARD-FILE                                           00720043
005000     RECORDING MODE IS F                                          00730043
005100     BLOCK CONTAINS 0 RECORDS                                     00740043
005200     LABEL RECORDS ARE STANDARD.                                  00750043
005300                                                                  00760043
005400 01  POS-DATE-CARD-RECORD            PIC X(80).                   00770043
005500                                                                  00780043
005600                                                                  00790043
005700 FD  TAX-EXTRACT-IN-FILE                                          00800043
005800     RECORDING MODE IS F                                          00810043
005900     LABEL RECORDS ARE STANDARD                                   00820043
006000     BLOCK CONTAINS 0 RECORDS                                     00830043
006100     RECORD CONTAINS 200 CHARACTERS.                              00840043
006200                                                                  00850043
006300 01  TAX-EXTRACT-IN-RECORD    PIC X(200).                         00860043
006400                                                                  00870043
006410 FD  TAX-EXCLU-IN-FILE                                            00880043
006420     RECORDING MODE IS F                                          00890043
006430     LABEL RECORDS ARE STANDARD                                   00900043
006440     BLOCK CONTAINS 0 RECORDS                                     00910043
006450     RECORD CONTAINS 80 CHARACTERS.                               00920043
006460                                                                  00930043
006470 01  TAX-EXCLUSION-RECORD     PIC X(80).                          00940043
006480                                                                  00950043
006500 FD  TAX-SUMMARY-FILE                                             00960043
006600     RECORDING MODE IS F                                          00970043
006700     LABEL RECORDS ARE STANDARD                                   00980043
006800     BLOCK CONTAINS 0 RECORDS                                     00990043
006900     RECORD CONTAINS 111 CHARACTERS.                              01000043
007000                                                                  01010043
007100 01  TAX-SUMMARY-RECORD   PIC X(111).                             01020043
007200                                                                  01030043
007300 WORKING-STORAGE SECTION.                                         01040043
007400                                                                  01050043
007500******************************************************************01060043
007600* RECORD LAYOUT FOR INPUT DATE CARD (POS DATE)                    01070043
007700******************************************************************01080043
007800 01  CC-CONTROL-CARD.                                             01090043
007900     05  CC-CONTROL-CARD-DISPLAY.                                 01100043
008000         10  CC-CONTROL-NAME     PIC X(14)    VALUE               01110043
008100                                              'P.O.S. DATE = '.   01120043
008200         10  CC-POS-DATE-MMDDYY.                                  01130043
008300             15  CC-POS-DATE-MM  PIC 9(2)     VALUE ZERO.         01140043
008400             15  CC-POS-DATE-DD  PIC 9(2)     VALUE ZERO.         01150043
008500             15  CC-POS-DATE-YY  PIC 9(2)     VALUE ZERO.         01160043
008600     05  FILLER                  PIC X(60)    VALUE SPACE.        01170043
008700                                                                  01180043
008710 01  EXCLUSION-REC.                                               01190043
008780     05  EXCLU-SKU               PIC X(8)     VALUE SPACE.        01200043
008790     05  FILLER                  PIC X(72)    VALUE SPACE.        01210043
008791                                                                  01220043
008800 01  PV-POS-CCYY-MM-DD.                                           01230043
008900     05  PV-POS-CC               PIC X(02).                       01240043
009000     05  PV-POS-YY               PIC X(02).                       01250043
009100     05  FILLER                  PIC X(01).                       01260043
009200     05  PV-POS-MM               PIC X(02).                       01270043
009300     05  FILLER                  PIC X(01).                       01280043
009400     05  PV-POS-DD               PIC X(02).                       01290043
009500 01  PV-RUN-DATE-MMDDYY.                                          01300043
009600     05  PV-RUN-DATE-MM          PIC X(02)    VALUE SPACE.        01310043
009700     05  FILLER                  PIC X(01)    VALUE '/'.          01320043
009800     05  PV-RUN-DATE-DD          PIC X(02)    VALUE SPACE.        01330043
009900     05  FILLER                  PIC X(01)    VALUE '/'.          01340043
010000     05  PV-RUN-DATE-YY          PIC X(02)    VALUE SPACE.        01350043
010100                                                                  01360043
010200 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      01370043
010300                                                  COMP SYNC.      01380043
010400     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    01390043
010410     88  AC-TABLE-OVERFLOW-ERROR                  VALUE +4004.    01400043
010500     88  AC-DB2-ERROR                             VALUE +4013.    01410043
010600                                                                  01420043
010700 01  ABEND-CODE                  PIC S9(4)    VALUE ZERO          01430043
010800                                 COMP SYNC.                       01440043
010900                                                                  01450043
011000 01  PS-PROGRAM-SWITCHES.                                         01460043
011100     05  PS-END-OF-TAX-EXTRACT-FILE-SW                            01470043
011200                                 PIC X(1)     VALUE 'N'.          01480043
011300         88  PS-NOT-END-OF-TAX-EXTRACT-FILE   VALUE 'N'.          01490043
011400         88  PS-END-OF-TAX-EXTRACT-FILE       VALUE 'Y'.          01500043
011500     05  PS-END-OF-CARD-FILE-SW  PIC X(1)     VALUE 'N'.          01510043
011600         88  PS-NOT-END-OF-CARD-FILE          VALUE 'N'.          01520043
011700         88  PS-END-OF-CARD-FILE              VALUE 'Y'.          01530043
011800     05  PS-TAX-RPT-DEPT-SW      PIC X(1)     VALUE 'N'.          01540043
011900         88  PS-TAX-RPT-DEPT-NO               VALUE 'N'.          01550043
012000         88  PS-TAX-RPT-DEPT-YES              VALUE 'Y'.          01560043
012010     05  PS-END-OF-EXCLU-FILE-SW  PIC X(1)    VALUE 'N'.          01570043
012020         88  PS-NOT-END-OF-EXCLU-FILE         VALUE 'N'.          01580043
012030         88  PS-END-OF-EXCLU-FILE             VALUE 'Y'.          01590043
012110     05  PS-EXCLUSION-SW           PIC X(1)    VALUE 'N'.         01600043
012120         88  PS-EXCLUSION-MATCH               VALUE 'Y'.          01610043
012130         88  PS-NOT-EXCLUSION-MATCH           VALUE 'N'.          01620043
P8612      05  PS-MARKETPLACE-SW         PIC X(1)    VALUE 'N'.         01630043
P8612          88  PS-MARKETPLACE                   VALUE 'Y'.          01640043
P8612          88  PS-NOT-MARKETPLACE               VALUE 'N'.          01650043
012140                                                                  01660043
012200 01  PC-PROGRAM-CONSTANTS.                                        01670043
012300     05  PC-CURRENT-PROGRAM-NAME PIC X(8)     VALUE 'TXKUT007'.   01680043
012310     05  PC-EXCLU-LIMIT          PIC S9(03)  COMP-3 VALUE +25.    01690043
012400                                                                  01700043
012500 01  PV-PROGRAM-VARIABLES.                                        01710043
012600     05  PV-PARAGRAPH-NAME       PIC   X(30)        VALUE SPACE.  01720043
012610     05  PV-DISPLAY-CNT          PIC ZZZ,ZZZ,ZZ9-.                01730043
013200     05  PV-ORDER-DTE            PIC   X(10)        VALUE SPACES. 01740043
013210     05  PV-PROCESS-DTE          PIC   X(10)        VALUE SPACES. 01750043
013211     05  PV-IN-PROCESS-DTE       PIC   X(10)        VALUE SPACES. 01760043
013220     05  PV-FIRST-DAY            PIC   X(10)        VALUE SPACES. 01770043
013300     05  PV-TAX-RT-PCT           PIC  S9V9(04) COMP-3 VALUE ZERO. 01780043
013310     05  PV-SAVE-TAX-RT-PCT      PIC  S9V9(05) COMP-3 VALUE ZERO. 01790043
013700     05  PV-DEPT-NBR             PIC   X(03)        VALUE SPACES. 01800043
C3258          88 PV-NON-TAX-RPT-DEPT VALUES  '981', '983', '833',      01810043
SEPHOR                                        '834', '712'.             01820050
013810     05  PV-SUB                  PIC  S9(03) COMP-3 VALUE ZERO.   01830043
013820     05  PV-TOT-EXCLU-AMT        PIC  S9(09)V99 COMP-3            01840043
013830                                                    VALUE ZERO.   01850043
013840     05  PV-DISP-TOT-AMT         PIC  Z,ZZZ,ZZZ.99  VALUE ZERO.   01860043
013900                                                                  01870043
014000 01  PA-PROGRAM-ACCUMULATORS.                                     01880043
014100     05  PA-INPUT-TRAN-CNT               PIC S9(9) COMP-3         01890043
014200                                             VALUE ZERO.          01900043
014300     05  PA-SUMMARY-CNT                  PIC S9(9) COMP-3         01910043
014400                                             VALUE ZERO.          01920043
014410     05  PA-NON-TAX-RPT-CNT              PIC S9(9) COMP-3         01930043
014420                                             VALUE ZERO.          01940043
014430     05  PA-SUMM-AMT-ZERO-CNT            PIC S9(9) COMP-3         01950043
014440                                             VALUE ZERO.          01960043
014450     05  PA-EXCLUSION-CNT                PIC S9(9) COMP-3         01970043
014460                                             VALUE ZERO.          01980043
014500                                                                  01990043
014510 01  EXCLUSION-TABLE.                                             02000043
014520     05  ET-EXCL-DEF OCCURS 25 TIMES.                             02010043
014530         10  ET-SKU            PIC X(8).                          02020043
014540                                                                  02030043
014550                                                                  02040043
014600***************************************************************** 02050043
014700*  TAX EXTRACT FILE RECORD LAYOUT                                 02060043
014800***************************************************************** 02070043
014900     COPY TXRD006.                                                02080043
015000                                                                  02090043
015100***************************************************************** 02100043
015200*  TAX SUMMARY FILE RECORD LAYOUT                                 02110043
015300***************************************************************** 02120043
015400     COPY TXRD007.                                                02130043
015500                                                                  02140043
015600******************************************************************02150043
015700*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)             02160043
015800******************************************************************02170043
015900     COPY DPWS500.                                                02180043
016000                                                                  02190043
016100******************************************************************02200043
016200 PROCEDURE DIVISION.                                              02210043
016300******************************************************************02220043
016400 0000-MAINLINE.                                                   02230043
016500                                                                  02240043
016600     PERFORM 1000-INITIALIZE.                                     02250043
016700                                                                  02260043
016800     PERFORM 2100-READ-TAX-EXTRACT-FILE                           02270043
016900        UNTIL PS-TAX-RPT-DEPT-YES                                 02280043
017000           OR PS-END-OF-TAX-EXTRACT-FILE.                         02290043
017010                                                                  02300043
017100     IF PS-NOT-END-OF-TAX-EXTRACT-FILE                            02310043
017200         PERFORM 2200-FORMAT-NEW-SUMMARY-REC                      02320043
017300                                                                  02330043
017400         PERFORM 2000-PROCESS-TAX-EXTRACT                         02340043
017500            UNTIL PS-END-OF-TAX-EXTRACT-FILE                      02350043
017600                                                                  02360043
017610         IF TX007-GROSS-AMT > ZERO OR TX007-TAX-AMT > 0           02370043
017620             PERFORM 2300-WRITE-SUMMARY-REC                       02380043
017630         ELSE                                                     02390043
017640             ADD +1 TO PA-SUMM-AMT-ZERO-CNT                       02400043
017650         END-IF                                                   02410043
017660                                                                  02420043
017800     ELSE                                                         02430043
017900         DISPLAY 'NO TAX REPORTING ITEMS FOR PROCESSING DATE'     02440043
018000     END-IF.                                                      02450043
018100                                                                  02460043
018200     PERFORM 9000-EOJ-ROUTINE.                                    02470043
018300                                                                  02480043
018400     GOBACK.                                                      02490043
018500                                                                  02500043
018600******************************************************************02510043
018700*  SET UP FOR PROGRAM PROCESSING BY OPENING ALL FILES.           *02520043
018800******************************************************************02530043
018900 1000-INITIALIZE.                                                 02540043
019000                                                                  02550043
019100     OPEN INPUT  POS-DATE-CARD-FILE                               02560043
019200                 TAX-EXTRACT-IN-FILE                              02570043
019210                 TAX-EXCLU-IN-FILE                                02580043
019300          OUTPUT TAX-SUMMARY-FILE.                                02590043
019400                                                                  02600043
019500     READ POS-DATE-CARD-FILE INTO CC-CONTROL-CARD                 02610043
019600        AT END                                                    02620043
019700           SET PS-END-OF-CARD-FILE TO TRUE.                       02630043
019800                                                                  02640043
019900     DISPLAY 'TXKUT007 CONTROL CARD: ' CC-CONTROL-CARD.           02650043
020000                                                                  02660043
020100     CLOSE POS-DATE-CARD-FILE.                                    02670043
020200                                                                  02680043
020300     IF PS-END-OF-CARD-FILE                                       02690043
020400        DISPLAY '** ABEND ** ' PC-CURRENT-PROGRAM-NAME            02700043
020500        DISPLAY 'DATE CONTROL CARD EMPTY'                         02710043
020600        MOVE '1000-INITIALIZE' TO PV-PARAGRAPH-NAME               02720043
020700        SET AC-CONTROL-CARD-ERROR TO TRUE                         02730043
020800        PERFORM 9200-ABEND                                        02740043
020900     END-IF.                                                      02750043
021000                                                                  02760043
021100     PERFORM 1115-CONVERT-INPUT-DATE.                             02770043
021200                                                                  02780043
021202     PERFORM                                                      02790043
021203        UNTIL PS-END-OF-EXCLU-FILE                                02800043
021204         READ TAX-EXCLU-IN-FILE INTO EXCLUSION-REC                02810043
021205            AT END                                                02820043
021206               SET PS-END-OF-EXCLU-FILE TO TRUE                   02830043
021207            NOT AT END                                            02840043
021210               ADD +1 TO PV-SUB                                   02850043
021211               IF PV-SUB > PC-EXCLU-LIMIT                         02860043
021212                   SET AC-TABLE-OVERFLOW-ERROR TO TRUE            02870043
021213                   MOVE '1000-INITIALIZE' TO                      02880043
021214                                      PV-PARAGRAPH-NAME           02890043
021215                   DISPLAY 'EXCLUSION TABLE OVERFLOW'             02900043
021217                   PERFORM 9200-ABEND                             02910043
021218               END-IF                                             02920043
021220               MOVE EXCLU-SKU TO ET-SKU(PV-SUB)                   02930043
021221         END-READ                                                 02940043
021222     END-PERFORM.                                                 02950043
021240                                                                  02960043
021250     CLOSE TAX-EXCLU-IN-FILE.                                     02970043
021260                                                                  02980043
021300******************************************************************02990043
021400*     CALL KOHLS CALENDAR ROUTINE:                                03000043
021500*         PASS: CONTROL CARD POS DATE (MMDDYY FORMAT).            03010043
021600*       RETURN: ACTUAL CALENDAR DB2 ISO DATE (CCYY-MM-DD FORMAT). 03020043
021700******************************************************************03030043
021800 1115-CONVERT-INPUT-DATE.                                         03040043
021900                                                                  03050043
022000     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              03060043
022100                                                                  03070043
022200     SET  DPG51-FISCAL-454-CALENDAR    TO TRUE.                   03080043
022300     SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   03090043
022400     SET  DPG52-LK-DTE-GREG            TO TRUE.                   03100043
022500     MOVE CC-POS-DATE-MMDDYY           TO DPG52-LK-DATE-INPUT.    03110043
022600     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    03120043
022700                                             DPG54 DPG55 DPG56.   03130043
022800     IF DPG54-SEVERE-ERROR                                        03140043
022900            DISPLAY '** ABEND ** ' PC-CURRENT-PROGRAM-NAME        03150043
023000            DISPLAY 'DATE CONTROL CARD INVALID'                   03160043
023100            SET AC-CONTROL-CARD-ERROR TO TRUE                     03170043
023200            MOVE '1115-CONVERT-INPUT-DATE'                        03180043
023300                                      TO PV-PARAGRAPH-NAME        03190043
023400            PERFORM 9200-ABEND                                    03200043
023500     END-IF.                                                      03210043
023600                                                                  03220043
023700     DISPLAY 'EXECUTION DATE USED = ' DPG55-DB2-ISO-DATE-FMT.     03230043
023800                                                                  03240043
023900     MOVE DPG55-DB2-ISO-DATE-FMT       TO PV-POS-CCYY-MM-DD.      03250043
024000     MOVE PV-POS-MM                    TO PV-RUN-DATE-MM.         03260043
024100     MOVE PV-POS-DD                    TO PV-RUN-DATE-DD.         03270043
024200     MOVE PV-POS-YY                    TO PV-RUN-DATE-YY.         03280043
024210     MOVE DPG56-FIRST-FP-DB2-ISO-FMT   TO PV-FIRST-DAY.           03290043
024300                                                                  03300043
024400******************************************************************03310043
024500* THIS PARAGRAPH READS THE INPUT FILE AND WRITES A SUMMARY       *03320043
024600* RECORD EACH TIME THERE IS A CHANGE IN THE KEY.                 *03330043
024700******************************************************************03340043
024800 2000-PROCESS-TAX-EXTRACT.                                        03350043
024900                                                                  03360043
025010     SET PS-NOT-EXCLUSION-MATCH  TO TRUE.                         03370043
025020                                                                  03380043
025100     PERFORM VARYING PV-SUB FROM 1 BY 1                           03390043
025200         UNTIL PS-EXCLUSION-MATCH                                 03400043
025300             OR PV-SUB > PC-EXCLU-LIMIT                           03410043
025301         IF TX006-SKU-NBR   =   ET-SKU(PV-SUB)                    03420043
025302             SET PS-EXCLUSION-MATCH                               03430043
025303                 PS-TAX-RPT-DEPT-NO      TO TRUE                  03440043
025304             ADD +1 TO PA-EXCLUSION-CNT                           03450043
025305             IF TX006-CREDIT-NO                                   03460043
025306                 ADD TX006-TAXABLE-AMT TO PV-TOT-EXCLU-AMT        03470043
025307             ELSE                                                 03480043
025308                 SUBTRACT TX006-TAXABLE-AMT FROM PV-TOT-EXCLU-AMT 03490043
025309             END-IF                                               03500043
025310         END-IF                                                   03510043
025311     END-PERFORM .                                                03520043
025314                                                                  03530043
025320     IF TX006-STR-NBR          = TX007-STR-NBR  AND               03540043
025400        TX006-ST-CDE           = TX007-ST-CDE   AND               03550043
025500        TX006-ZIP-CDE          = TX007-ZIP-CDE  AND               03560043
025600        TX006-GEO-CDE          = TX007-GEO-CDE  AND               03570043
025700        TX006-TAXWARE-PROD-CDE = TX007-TAXWARE-PROD-CDE AND       03580043
025800        TX006-CREDIT-IND       = TX007-CREDIT-IND       AND       03590043
025801        TX006-EXEMPT-IND       = TX007-EXEMPT-IND       AND       03600043
025810        TX006-TAX-RT-PCT       = PV-SAVE-TAX-RT-PCT     AND       03610043
026100        TX006-PROCESS-TYPE     = TX007-CALC-TYP-IND     AND       03620043
026200        TX006-ORDER-DTE        = PV-ORDER-DTE           AND       03630043
026210        PV-IN-PROCESS-DTE      = PV-PROCESS-DTE                   03640043
026300           CONTINUE                                               03650043
026400     ELSE                                                         03660043
026410         IF TX007-GROSS-AMT > ZERO OR TX007-TAX-AMT > 0           03670043
026600             PERFORM 2300-WRITE-SUMMARY-REC                       03680043
026610         ELSE                                                     03690043
026620             ADD +1 TO PA-SUMM-AMT-ZERO-CNT                       03700043
026700         END-IF                                                   03710043
026800         IF PS-TAX-RPT-DEPT-YES                                   03720043
026900             PERFORM 2200-FORMAT-NEW-SUMMARY-REC                  03730043
027000         END-IF                                                   03740043
027100     END-IF.                                                      03750043
027200                                                                  03760043
027300     IF PS-TAX-RPT-DEPT-YES                                       03770043
P8612          IF PS-MARKETPLACE                                        03780043
P8612             CONTINUE                                              03790043
P8612          ELSE                                                     03800043
027400            ADD TX006-SLD-QTY       TO TX007-NO-OF-ITEMS          03810043
027500            ADD TX006-TAXABLE-AMT   TO TX007-GROSS-AMT            03820043
027600            ADD TX006-TX-AMT        TO TX007-TAX-AMT              03830043
P8612          END-IF                                                   03840043
027700     END-IF.                                                      03850043
027800                                                                  03860043
027900     PERFORM 2100-READ-TAX-EXTRACT-FILE.                          03870043
028000                                                                  03880043
028100******************************************************************03890043
028200* READ THE TAX SUMMARY FILE.                                     *03900043
028300******************************************************************03910043
028400 2100-READ-TAX-EXTRACT-FILE.                                      03920043
028500                                                                  03930043
028600     READ TAX-EXTRACT-IN-FILE                                     03940043
028700         INTO TX006-TAX-AUDIT-RECORD                              03950043
028800         AT END                                                   03960043
028900             SET PS-END-OF-TAX-EXTRACT-FILE TO TRUE               03970043
029000     END-READ.                                                    03980043
029100                                                                  03990043
029200     IF PS-NOT-END-OF-TAX-EXTRACT-FILE                            04000043
029210        ADD +1 TO PA-INPUT-TRAN-CNT                               04010043
029300        MOVE TX006-DEPT-NBR TO PV-DEPT-NBR                        04020043
029400        IF PV-NON-TAX-RPT-DEPT                                    04030043
029500            SET PS-TAX-RPT-DEPT-NO  TO TRUE                       04040043
029510            ADD +1 TO PA-NON-TAX-RPT-CNT                          04050043
029600        ELSE                                                      04060043
029700            SET PS-TAX-RPT-DEPT-YES TO TRUE                       04070043
029800        END-IF                                                    04080043
12386A*----> EXCLUDING THE CHARITABLE DONATIONS TRANSACTIONS            04081049
12386A        IF  TX006-DEPT-NBR   = '817'                              04081149
12386A        AND TX006-SUB-CL-NBR = '10'                               04082049
12386A            SET PS-TAX-RPT-DEPT-NO  TO TRUE                       04083049
12386A            ADD +1 TO PA-NON-TAX-RPT-CNT                          04084049
12386A        END-IF                                                    04085049
P8612         SET PS-NOT-MARKETPLACE TO TRUE                            04090043
P8612         IF TX006-DEPT-NBR   = '070' AND                           04100043
P8612            TX006-SUB-CL-NBR = '91'                                04110043
P8612             SET PS-MARKETPLACE TO TRUE                            04120043
P8612             DISPLAY 'MARKETPLACE 07091 '                          04130043
P8612             DISPLAY '*** '  TX006-TAX-AUDIT-RECORD                04140043
P8612         END-IF                                                    04150043
C19114*       IF TX006-PROCESS-DTE < PV-FIRST-DAY                       04160043
029850            MOVE TX006-PROCESS-DTE TO PV-IN-PROCESS-DTE           04170043
C19114*       ELSE                                                      04180043
C19114*           MOVE PV-POS-CCYY-MM-DD TO PV-IN-PROCESS-DTE           04190043
C19114*       END-IF                                                    04200043
029900     END-IF.                                                      04210043
030000******************************************************************04220043
030100* FORMAT A NEW SUMMARY RECORD.                                   *04230043
030200******************************************************************04240043
030300 2200-FORMAT-NEW-SUMMARY-REC.                                     04250043
030400                                                                  04260043
030500     INITIALIZE TX007-TAX-SUMMARY-RECORD.                         04270043
030600     MOVE '03'                   TO TX007-COMPANY-ID.             04280043
030700     MOVE TX006-STR-NBR          TO TX007-STR-NBR.                04290043
030800     MOVE TX006-ST-CDE           TO TX007-ST-CDE.                 04300043
030900     MOVE TX006-ZIP-CDE          TO TX007-ZIP-CDE.                04310043
031000     MOVE TX006-GEO-CDE          TO TX007-GEO-CDE.                04320043
031100     MOVE TX006-ORDER-DTE        TO PV-ORDER-DTE.                 04330043
031200     MOVE TX006-ORDER-DTE (1:4)  TO TX007-ORDER-DTE (1:4).        04340043
031300     MOVE TX006-ORDER-DTE (6:2)  TO TX007-ORDER-DTE (5:2).        04350043
031400     MOVE TX006-ORDER-DTE (9:2)  TO TX007-ORDER-DTE (7:2).        04360043
031500     MOVE TX006-TAXWARE-PROD-CDE TO TX007-TAXWARE-PROD-CDE.       04370043
031600     MOVE TX006-EXEMPT-IND       TO TX007-EXEMPT-IND.             04380043
031700     MOVE TX006-CREDIT-IND       TO TX007-CREDIT-IND.             04390043
031800     MOVE TX006-PROCESS-TYPE     TO TX007-CALC-TYP-IND.           04400043
031900     MOVE TX006-TAX-EXMPT-ID     TO TX007-TX-EXMPT-ID.            04410043
031910     MOVE TX006-TAX-RT-PCT       TO PV-SAVE-TAX-RT-PCT.           04420043
032000     COMPUTE PV-TAX-RT-PCT ROUNDED = TX006-TAX-RT-PCT             04430043
032100     END-COMPUTE.                                                 04440043
032200     MOVE PV-TAX-RT-PCT           TO TX007-TAX-RATE.              04450043
032201     MOVE PV-IN-PROCESS-DTE       TO PV-PROCESS-DTE.              04460043
032202     MOVE PV-IN-PROCESS-DTE (1:4) TO TX007-PROCESS-DTE (1:4).     04470043
032203     MOVE PV-IN-PROCESS-DTE (6:2) TO TX007-PROCESS-DTE (5:2).     04480043
032204     MOVE PV-IN-PROCESS-DTE (9:2) TO TX007-PROCESS-DTE (7:2).     04490043
032600                                                                  04500043
032700******************************************************************04510043
032800* WRITE A SUMMARY RECORD.                                        *04520043
032900******************************************************************04530043
033000 2300-WRITE-SUMMARY-REC.                                          04540043
033100                                                                  04550043
033200     WRITE TAX-SUMMARY-RECORD                                     04560043
033300         FROM TX007-TAX-SUMMARY-RECORD.                           04570043
033310     ADD +1 TO PA-SUMMARY-CNT.                                    04580043
033320     INITIALIZE TX007-TAX-SUMMARY-RECORD.                         04590043
033400                                                                  04600043
033500******************************************************************04610043
033600*  CLOSE ALL FILES.                                              *04620043
033700******************************************************************04630043
033800 9000-EOJ-ROUTINE.                                                04640043
033900                                                                  04650043
033910     MOVE PA-INPUT-TRAN-CNT TO PV-DISPLAY-CNT.                    04660043
033920     DISPLAY 'INPUT TRANSACTIONS READ                  '          04670043
033930             PV-DISPLAY-CNT.                                      04680043
033940     MOVE PA-NON-TAX-RPT-CNT TO PV-DISPLAY-CNT.                   04690043
033950     DISPLAY 'TRANSACTIONS NOT SUMMARIZED              '          04700043
033960             PV-DISPLAY-CNT.                                      04710043
033970     MOVE PA-SUMMARY-CNT     TO PV-DISPLAY-CNT.                   04720043
033980     DISPLAY 'SUMMARY RECORDS WRITTEN                  '          04730043
033990             PV-DISPLAY-CNT.                                      04740043
033991     MOVE PA-EXCLUSION-CNT   TO PV-DISPLAY-CNT.                   04750043
033992     DISPLAY 'NUMBER OF RECORDS EXCLUDED               '          04760043
033993             PV-DISPLAY-CNT.                                      04770043
033994     MOVE PV-TOT-EXCLU-AMT   TO PV-DISP-TOT-AMT                   04780043
033995     DISPLAY 'TOTAL AMOUNT EXCLUDED                    '          04790043
033996             PV-DISP-TOT-AMT.                                     04800043
034010     CLOSE TAX-EXTRACT-IN-FILE                                    04810043
034100           TAX-SUMMARY-FILE.                                      04820043
034200                                                                  04830043
034300******************************************************************04840043
034400* 9200-ABEND                                                      04850043
034500*     ABEND PROGRAM WHEN A PROGRAM ERROR OCCURS                   04860043
034600******************************************************************04870043
034700 9200-ABEND.                                                      04880043
034800                                                                  04890043
034900     DISPLAY '** ABEND        **'.                                04900043
035000     DISPLAY '** PROGRAM      ** = ' PC-CURRENT-PROGRAM-NAME.     04910043
035100     DISPLAY '** PARAGRAPH    ** = ' PV-PARAGRAPH-NAME.           04920043
035200                                                                  04930043
035300     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         04940043
035400                                                                  04950043
