000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             ARKUT062.                                00050000
000600 AUTHOR.                 LUKE SCHULTE.                            00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            06-24-2005.                              00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*   THIS PROGRAM WILL EXTRACT ALL ACTIVE EMPLOYEES FROM THE       00120026
001300*   WORKDAY FILE AND WRITE THEM TO AN OUTPUT FILE. THIS IS A      00130026
001300*   FULL FILE.                                                    00131026
001400*                                                                 00140000
006200******************************************************************00141026
001500*  FD CONVERSION RCW 09/01/2011 CHANGE OUTPUT AND CHANGE TO SEND  00150000
001600*                               TO FIRST DATA.                    00160000
006200******************************************************************00170000
EDDCHG*                                                                 00180000
EDDCHG* REQUIREMENT   : EMPLOYEE DISCOUNT DEVELOPMENT PROJECT           00190000
EDDCHG* INCIDENT ID   : INC2168500                                      00200000
EDDCHG* AUTHOR        : COGNIZANT                                       00210000
EDDCHG* DATE  CHANGED : 2012-09-27                                      00220000
EDDCHG* CHANGES MADE  : THE NEW_EMP CURSOR IS UPDATED TO EXTRACT        00230000
EDDCHG*                 ROWS FOR 'NEW HIRES' AND 'RE-HIRES' THAT ARE    00240000
EDDCHG*                 CURRENTLY ACTIVE. CHANGES ARE TAGGED 'EDDCHG'.  00250000
EDDCHG*                                                                 00260000
C92316******************************************************************00270011
C92316* PROD DATE  INIT  CHNG CNTL   DESCRIPTION                       *00280011
C92316* ---------  ----  ---------  -----------------------------------*00290011
C92316* 09/23/2014  CTS  CHG0092316  REMOVED THE 14 DAYS LOGIC IN THE   00300012
C92316*                              QUERY WHILE FETCHING ACTIVE ASSOCS.00310011
C92316*                              REPLACED THE CONDITION TO FETCH    00320011
C92316*                              BEGIN DATE BETWEEN CURRENT         00330011
C92316*                              DATE AND CURRENT DATE-14DAYS TO    00340011
C92316*                              BEGIN DATE LESS THAN EQUAL TO      00350011
C92316*                              CURENT DATE.                       00360011
C92316******************************************************************00370011
C05157******************************************************************00371017
C05157* PROD DATE  INIT  CHNG CNTL   DESCRIPTION                       *00372017
C05157* ---------  ----  ---------  -----------------------------------*00373017
C05157* 02/18/2015  CTS  CHG0105157  THE NEW CURSOR UPDATED TO FETCH    00374017
C05157*                              THE RECORDS WHICH ARE ACTIVE       00375017
C05157*                              ASSOCS IRRESPECTIVE OF ACTION CODE 00376017
C05157*                              DEFINED IN XST TABLES.             00377017
C05157*                              THIS QUERY WILL NOT FETCH 'TERM'   00378017
C05157*                              ASSOCS AND THOSE WHOSE ACTION CODE 00379017
C05157*                              IS 'D'.THIS WILL NOT FETCH ANY     00379117
C05157*                              FUTURE DATE RECORDS.               00379217
CD0318******************************************************************00379320
CD0318* PROD DATE  INIT  CHNG CNTL   DESCRIPTION                       *00379420
CD0318* ---------  ----  ---------  -----------------------------------*00379520
CD0318* 03/16/2016  CTS  CHG0135181  CHANGED THE LAYOUT OF THE OUTPUT   00379620
CD0318*                              FILE FROM RECORD LENGTH 10 TO      00379720
CD0318*                              32 TO ACCOMODATE ASSOC_ID,ACCOUNT, 00379820
CD0318*                              AND INDICATOR DETAILS.             00379920
      ******************************************************************00380021
      * PROD DATE  INIT  CHNG CNTL   DESCRIPTION                       *00380121
      * ---------  ----  ---------  -----------------------------------*00380221
      * 06/30/2017  CLP  CHG0168613  ELIMINATION OF THE XST_ASSOC AND   00380332
      *                              XST_ASSOC_EMPT TABLES AND REPLACE  00380421
      *                              THEM WITH A NEW FILE COMING FROM   00380521
      *                              WORKDAY. THIS PROGRAM ASSUMES THAT 00380622
      *                              ALL THE INPUT ARE ACTIVE EMPLOYEES.00380730
      *                              SORT IS DONE BEFORE HAND TO ASSURE 00380831
      *                              THIS.                              00380922
      ******************************************************************00381022
006500 ENVIRONMENT DIVISION.                                            00382022
006600******************************************************************00390000
006700                                                                  00400000
006800 CONFIGURATION SECTION.                                           00410000
006900                                                                  00420000
007000 SOURCE-COMPUTER.        IBM-3090.                                00430000
007100 OBJECT-COMPUTER.        IBM-3090.                                00440000
007200                                                                  00450000
007300 INPUT-OUTPUT SECTION.                                            00460000
007400                                                                  00470000
007500 FILE-CONTROL.                                                    00480000
007900                                                                  00490000
008110     SELECT WD-EMPLOYEE-ACCOUNT-FILE                              00491022
008120         ASSIGN TO INP01.                                         00492022
                                                                        00493022
008110     SELECT EMPLOYEE-ACCOUNT-FILE                                 00500000
008120         ASSIGN TO OUT01.                                         00510000
008200                                                                  00520000
008300******************************************************************00530000
008400 DATA DIVISION.                                                   00540000
008500******************************************************************00550000
008600                                                                  00560000
008700 FILE SECTION.                                                    00570000
027602                                                                  00580000
027603 FD WD-EMPLOYEE-ACCOUNT-FILE                                      00581022
027604     RECORDING MODE IS F                                          00582022
027605     BLOCK CONTAINS 0 RECORDS                                     00583022
027606     LABEL RECORDS ARE STANDARD.                                  00584022
027607                                                                  00585022
CD0318 01  WD-EMPLOYEE-ACCOUNT-REC          PIC X(200).                 00586029
027607                                                                  00587022
027603 FD EMPLOYEE-ACCOUNT-FILE                                         00590000
027604     RECORDING MODE IS F                                          00600000
027605     BLOCK CONTAINS 0 RECORDS                                     00610000
027606     LABEL RECORDS ARE STANDARD.                                  00620000
027607                                                                  00630000
CD0318 01 EMPLOYEE-ACCOUNT-REC              PIC X(32).                  00640020
027609                                                                  00650000
027610 WORKING-STORAGE SECTION.                                         00660000
027611******************************************************************00670000
027612*                        ABEND CODES                              00680000
027613******************************************************************00690000
027614     COPY ARWS052.                                                00700000
027615                                                                  00710000
027616******************************************************************00720000
027617*                        SWITCHES                                 00730000
027618******************************************************************00740000
027619 01 PS-PROGRAM-SWITCHES.                                          00750000
000211    05 PS-EOF-SW                      PIC X(01)  VALUE 'N'.       00781022
000212       88 PS-EOF                                 VALUE 'Y'.       00782022
000212       88 PS-NOT-EOF                             VALUE 'N'.       00783022
027636******************************************************************00790000
027637*                        CONSTANTS                                00800000
027638******************************************************************00810000
027639 01 PC-PROGRAM-CONSTANTS.                                         00820000
027640    05 PC-PAGE-SIZE                   PIC S9(4)  VALUE +61        00830000
027641                                                 COMP.            00840000
027642    05 PC-SUCCESSFUL-SQLCODE          PIC S9(9)  VALUE ZEROES     00850000
027643                                                 COMP.            00860000
027644    05 PC-ROW-NOT-FOUND-SQLCODE       PIC S9(9)  VALUE +100       00870000
027645                                                 COMP.            00880000
027646    05 PC-DUPLICATE-ROW-SQLCODE       PIC S9(9)  VALUE -803       00890000
027647                                                 COMP.            00900000
027648    05 PC-PROGRAM-NAME                PIC X(8)   VALUE 'ARKUT062'.00910000
027649    05 PC-ADD-DISC-STAT               PIC X(1)   VALUE 'A'.       00920000
027650                                                                  00930000
027651******************************************************************00940000
027652*                        VARIABLES                                00950000
027653******************************************************************00960000
027654 01 PV-PROGRAM-VARIABLES.                                         00970000
027655    05 PV-READ-COUNT                  PIC S9(9)  VALUE ZEROES     00980000
027656                                                 COMP.            00990000
027657    05 PV-WRITE-COUNT                 PIC S9(9)  VALUE ZEROES     01000000
027658                                                 COMP.            01010000
027659    05 PV-PARAGRAPH-NAME              PIC X(30)  VALUE SPACES.    01020000
027660    05 PV-KEY-VALUE-NAME              PIC X(30)  VALUE SPACES.    01030000
027661    05 PV-KEY-VALUE                   PIC X(30)  VALUE SPACES.    01040000
027662    05 PV-DB2-TABLE-NAME              PIC X(30)  VALUE SPACES.    01050000
027663    05 PV-OPERATION-MSG               PIC X(30)  VALUE SPACES.    01060000
027664    05 PV-DUMMY-ACCT-NBR              PIC 9(10)  VALUE 6000000000.01070000
027665                                                                  01080000
027666    05 PV-CURR-TMST                   PIC X(26)  VALUE SPACES.    01090000
027669                                                                  01100000
027670******************************************************************01110000
027671*                        COPYBOOKS                                01120000
027672******************************************************************01130000
027673                                                                  01140000
027674******************************************************************01141022
027675* INPUT EMPLOYEE FILE FROM WORKDAY LAYOUT                         01142022
027676******************************************************************01143022
           COPY ARRD100.                                                01144022
030300                                                                  01145022
027674******************************************************************01150000
027675* EMPLOYEE ACCOUNT FILE RECORD LAYOUT                             01160000
027676******************************************************************01170000
           COPY ARRD053.                                                01180000
030300                                                                  01190000
030400******************************************************************01200000
030500* DPWS004 VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004 01210000
030600******************************************************************01220000
030610     COPY DPWS004.                                                01230000
030611                                                                  01240000
030620******************************************************************01250000
030630* DB2 MESSAGE AREA                                                01260000
030640******************************************************************01270000
030650     COPY SQLCA2.                                                 01280000
030700                                                                  01290000
030710******************************************************************01300000
030720*                     SQL DECLARATIONS                            01310000
030730******************************************************************01320000
030731                                                                  01330000
030733******************************************************************01340000
030734*  STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                01350000
030735******************************************************************01360000
030737                                                                  01370000
030738     EXEC SQL                                                     01380000
030739         INCLUDE SQLCA                                            01390000
030740     END-EXEC.                                                    01400000
042900                                                                  01840000
043000******************************************************************01850000
043100 PROCEDURE DIVISION.                                              01860000
043200******************************************************************01870000
043300                                                                  01880000
043400*--------------*                                                  01890000
043500 0000-MAINLINE.                                                   01900000
043600*--------------*                                                  01910000
049400                                                                  01920000
049500     PERFORM Z050-INITIALIZE.                                     01930000
049611                                                                  01960000
049630     PERFORM 8100-READ-NEW-EMP-FILE.                              01980022
049631                                                                  01990000
000530     IF PS-EOF                                                    01991022
000531         DISPLAY ALL '*'                                          01992022
000532         DISPLAY '**  WORKDAY EMPLOYEE FILE IS EMPTY **'          01993022
000533         DISPLAY ALL '*'                                          01994022
000534     END-IF.                                                      01995022
                                                                        01996022
049632     PERFORM 2000-PROCESS-NEW-EMPLOYEES                           02000000
049633        UNTIL PS-EOF.                                             02010022
049634                                                                  02020000
049639     PERFORM Z100-END-PROC.                                       02050000
049640                                                                  02060000
049641     STOP RUN.                                                    02070000
049650                                                                  02080000
059600*-------------------------------*                                 02090000
059700 2000-PROCESS-NEW-EMPLOYEES.                                      02100000
059800*-------------------------------*                                 02110000
059801*    DO NOT YET KNOW WHETHER OR NOT EMPL HAS ACCT.                02120000
CD0318     MOVE AR100-EMP-ID            TO AR053-ASSOC-ID.              02160027
059910     MOVE AR100-SSN-NBR           TO AR053-SS-NBR.                02170027
059930     MOVE PC-ADD-DISC-STAT        TO AR053-DISC-STAT-CDE.         02190000
063500                                                                  02200000
063800     PERFORM 5000-WRITE-EMPL-ACCT-REC.                            02210000
063820     PERFORM 8100-READ-NEW-EMP-FILE.                              02220022
064000                                                                  02230000
064100*-------------------------------*                                 02240000
064200 5000-WRITE-EMPL-ACCT-REC.                                        02250000
064300*-------------------------------*                                 02260000
064310     WRITE EMPLOYEE-ACCOUNT-REC                                   02270000
064400        FROM AR053-EMPLOYEE-ACCOUNT-REC.                          02280000
064410                                                                  02290000
064420     ADD 1 TO PV-WRITE-COUNT.                                     02300000
064500                                                                  02310000
088400*-----------------------------*                                   02520000
088500 8100-READ-NEW-EMP-FILE.                                          02530022
088600*-----------------------------*                                   02540000
           READ WD-EMPLOYEE-ACCOUNT-FILE INTO                           02550023
091400          AR100-WD-EMPLOYEE-REC                                   02770023
001945     AT END                                                       02780022
001946         SET PS-EOF                   TO TRUE                     02790022
001947     NOT AT END                                                   02800022
001948         ADD 1                        TO PV-READ-COUNT            02810022
001949     END-READ.                                                    02820022
098710                                                                  02970000
098800******************************************************************02980000
098900* Z050 - INITIALIZE                                               02990000
099000******************************************************************03000000
099100 Z050-INITIALIZE.                                                 03010000
099110                                                                  03020000
           DISPLAY '*** BEGIN ARKUT062 ***'.                            03020125
                                                                        03020225
099300     OPEN INPUT  WD-EMPLOYEE-ACCOUNT-FILE.                        03030022
099300     OPEN OUTPUT EMPLOYEE-ACCOUNT-FILE.                           03031022
                                                                        03032022
           SET PS-NOT-EOF TO TRUE.                                      03033022
                                                                        03033124
           EXEC SQL                                                     03034024
               SET :PV-CURR-TMST = CURRENT TIMESTAMP                    03035024
           END-EXEC.                                                    03036025
                                                                        03037024
           DISPLAY 'CURRENT TIMESTAMP = ' PV-CURR-TMST.                 03038025
100795                                                                  03040000
100800******************************************************************03050000
100900* Z100 - PERFORMS TASK TERMINATION PROCESSING                     03060022
101000******************************************************************03070000
101100 Z100-END-PROC.                                                   03080000
101230                                                                  03090000
101240     DISPLAY ' '.                                                 03100000
101250     DISPLAY '**********************'.                            03110000
101260     DISPLAY '   ARKUT062 CONTROLS  '.                            03120000
101270     DISPLAY '**********************'.                            03130000
101293     DISPLAY 'RECORDS READ   : ' PV-READ-COUNT.                   03140000
101294     DISPLAY 'RECORDS WRITTEN: ' PV-WRITE-COUNT.                  03150000
101295                                                                  03160000
101310     CLOSE WD-EMPLOYEE-ACCOUNT-FILE.                              03170022
101310     CLOSE EMPLOYEE-ACCOUNT-FILE.                                 03171022
101500                                                                  03180000
108613******************************************************************03190000
108620* Z999 - ABEND ROUTINE                                            03200000
108630******************************************************************03210000
108640 Z999-ABEND.                                                      03220000
108650                                                                  03230000
108699     IF ABEND-4013-DB2-ERROR                                      03240000
108708                                                                  03250000
108709        PERFORM D999-DISPLAY-SQLCA                                03260000
108710                                                                  03270000
108711        MOVE SQLCODE    TO SQLCODE2                               03280000
108712        MOVE SQLERRD(3) TO SQLERRD3                               03290000
108713                                                                  03300000
108714        DISPLAY '** ABEND           ** = SQLABEND'                03310000
108715        DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME        03320000
108716        DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME      03330000
108717        DISPLAY '** KEY VALUE NAME  ** = ' PV-KEY-VALUE-NAME      03340000
108718        DISPLAY '** KEY VALUE       ** = ' PV-KEY-VALUE           03350000
108719        DISPLAY '** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME      03360000
108720        DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG       03370000
108721        DISPLAY '** SQLCODE         ** = ' SQLCODE2               03380000
108722        DISPLAY '** ROWS PROCESSED  ** = ' SQLERRD3               03390000
108723        DISPLAY '** SQLERRM         ** = ' SQLERRM                03400000
108724        DISPLAY '** SQLERRMC        ** = ' SQLERRMC               03410000
108725     ELSE                                                         03420000
108726        DISPLAY '** ABEND           ** = ABEND (NON-SQL)'         03430000
108727        DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME        03440000
108728        DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME      03450000
108729        DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG       03460000
108730        DISPLAY '** KEY VALUE NAME  ** = ' PV-KEY-VALUE-NAME      03470000
108731        DISPLAY '** KEY VALUE       ** = ' PV-KEY-VALUE           03480000
108732     END-IF.                                                      03490000
108733     CALL 'ILBOABN0' USING ABEND-CODE.                            03500000
108734                                                                  03510000
108735******************************************************************03520000
108736* D999 - DISPLAY SQL INFORMATION IN READABLE FORMAT               03530000
108737******************************************************************03540000
108738 D999-DISPLAY-SQLCA.                                              03550000
108739******************************************************************03560000
108740*  THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   03570000
108741*  MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        03580000
108750* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     03590000
108760*  FORMAT.                                                        03600000
108770******************************************************************03610000
108780                                                                  03620000
108790        COPY DPPD004.                                             03630000
