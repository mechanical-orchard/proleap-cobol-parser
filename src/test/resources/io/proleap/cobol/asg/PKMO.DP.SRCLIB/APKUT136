000100 IDENTIFICATION DIVISION.                                         00010000
000200*-----------------------*                                         00020000
000300 PROGRAM-ID.    APKUT136.                                         00030000
000400 AUTHOR.        CHRIS KUNSTMANN  IBS.                             00040000
000500 DATE-WRITTEN.  12/29/98.                                         00050000
000600*-----------------------*                                         00060000
000700                                                                  00070000
000800*---------------------------------------------------------------* 00080000
000900*     COBOL II / DB2                                            * 00090000
001000*                                                               * 00100000
001100*  ADJUSTMENT JOURNAL COMBINATION EDIT FOR EXTERNAL INTERFACES  * 00110000
001200*                                                               * 00120000
001300*    THE OBJECTIVE OF THIS PROGRAM IS TO ACCEPT ADJUSTMENT      * 00130000
001400*   TRANSACTIONS FROM SOURCES OTHER THAN THE BATCH MATCHING     * 00140000
001500*   PROCESS, AND TO EXTRACT AND REFORMAT ADJUSTMENT DATA TO     * 00150000
001600*   INTERFACE TO EXTERNAL SYSTEMS. BALANCE CHECKS WILL BE       * 00160000
001700*   PERFORMED FOR DATA INTEGRITY, AND FIELD EDITS ARE EXECUTED  * 00170000
001800*   TO ENSURE VALID DATA IS LOADED TO THE ADJUSTMENT JOURNAL    * 00180000
001900*   DATABASE. AN OUTPUT FILE WILL CONTAIN ALL VALID DATA, AND   * 00190000
002000*   AN EXCEPTION REPORT WILL DISPLAY ANY DATA WITH ERRORS OR    * 00200000
002100*   WARNINGS.                                                   * 00210000
002200*---------------------------------------------------------------* 00220000
002300*                                                               * 00230000
002400* DB2 TABLES:                                                   * 00240000
002500*  1. AP-PROCESS CONTROL                    (TAPCNTL)           * 00250000
002600*  2. AP-ADJUSTMENT JOURNAL                 (TADJRNL)           * 00260000
002700*  3. EX-EXTERNAL ENTERPRISE                (TEXTENT)           * 00270000
002800*  4. EX-EXTERNAL ENTERPRISE NAME           (TENTNME)           * 00280000
002900*  5. MERCHANDISE AREA                      (TMDSEAR)           * 00290000
003000*  6. PO-PURCHASE TABLE                     (TPURCHS)           * 00300000
003100*  7. LOCATION TABLE                        (XFT00017)          * 00310000
003200*  8. AP-TRANSACTION CODE TABLE             (TTRNCDE)           * 00320000
003300*  9. AP-SKU CROSS REFERENCE                (TSKXREF)           * 00330000
003400*                                                               * 00340000
003500* INPUT:                                                        * 00350000
003600*  1. DETAIL ADJUSTMENT TRANSACTIONS        (APRD045)           * 00360000
003800*                                                               * 00380000
003900* OUTPUT:                                                       * 00390000
004000*  1. EDITED TRANSACTIONS FILE              (APRD045)           * 00400000
004100*     (PREFIX IS CHANGED FROM AP045- TO EDITD-)                 * 00410000
004200*  2. ADJ JRNL ERROR/EXCEPTION FILE         (APRD122)           * 00420000
004300*                                                               * 00430000
004400*---------------------------------------------------------------* 00440000
004500*   CHANGES:                                                    * 00450000
004600*      WR 5998      INITIAL PROGRAM                             * 00460000
004700*                                                               * 00470000
004800*   CHANGES: WHEN ENTER DATE IS VALID & NOT A FUTURE DATE       * 00480000
004900*      MOVE BATCH CONTROL DATE TO ENTER DATE FIELD.             * 00490000
005000*                                                               * 00500000
005100*   08/30/1999    JILL JUEL                                     * 00510000
005200*      MOVE THE APCNTL-BTCH-PRC-DTE TO AP045-PS-BTCH-DTE IN THE * 00520000
005300*      INITIALIZATION ROUTINE AND REMOVE THE BATCH PROCESS DATE * 00530000
005400*      EDIT FROM C100-RECORD-EDITS.                             * 00540000
005500*                                                               * 00550000
005600*   10/11/1999 CHANGE DATE-INVALID TO WARNING-ERROR IN DATE     * 00560000
005700*          ROUTINE CHECKING                                     * 00570000
005800*          BY: L SCHALLHORN                           WR 06041  * 00580000
005900*                                                               * 00590000
006000*   02/02/2000 MODIFIED THE FIELD-LEVEL EDITS TO ADD VALIDATION * 00600000
006100*          OF THE AP045-PYMT-DUE-DTE.  IF THE DATE IS NOT EQUAL * 00610000
006200*          TO SPACES, THEN IT MUST CONTAIN A VALID DATE.  IF    * 00620000
006300*          AN INVALID DATE IS FOUND, A LINE IS CREATED ON THE   * 00630000
006400*          EXCEPTION REPORT AND TREATED AS A FATAL ERROR.       * 00640000
006500*          BY: ROBIN BERNOSKI                         WR 20419  * 00650000
006600*                                                               * 00660000
006700*   08/25/2000                                                  * 00670000
006800*      ADDED LOGIC TO PROCESS THE NEW MOS FIELDS. THE NEW       * 00680000
006900*      FIELD IS HANDLED THE SAME WAY THE NEW STORE DISCOUNT     * 00690000
007000*      IS HANDLED.                                              * 00700000
007100*      MADE BY: JILL JUEL                             WR 20224  * 00710000
007200*                                                               * 00720000
007300*   02/21/2001                                                  * 00730000
007400*      ADDED PARAGRAPH C350-PROCESS-POSTING-PERIOD TO CHECK IF  * 00740000
007500*      THE POSTING PERIOD IS FILLED WITH A VALID VALUE, AND IF  * 00750000
007600*      NOT, TO FILL IT WITH CURRENT.  THE LOGIC USED TO ASSUME  * 00760000
007700*      THAT NO VALUE WAS SENT AND ALWAYS OVERLAID WITH CURRENT. * 00770000
007800*   MADE BY: NANCY EILBES                WR/IR #: 20419         * 00780000
007900*                                                               * 00790000
008000*   04/12/2001                                                  * 00800000
008100*      MODIFIED THE LOGIC IN C100-RECORD-EDITS WHICH DECIDES    * 00810000
008200*      IF THE DATABASES NEED TO BE READ AGAIN TO EDIT PO AND/OR * 00820000
008300*      VENDOR NUMBER.  THE BREAK LOGIC WAS NOT RE-READING THE   * 00830000
008400*      DATABASE IF THE PO NUMBER HAD CHANGED BUT VENDOR HAD NOT.* 00840000
008500*   MADE BY: NANCY EILBES                WR/IR #: 20704         * 00850000
008600*                                                               * 00860000
008700*   05/08/2001                                                  * 00870000
008800*     MODIFIED THE INITAL VALUE OF THE PV-SAVE-PO-NBR FIELD TO  * 00880000
008900*     ALL '*'.  THIS WAS NECESSARY BECAUSE THE PROGRAM WOULDN'T * 00890000
009000*     PERFORM THE VENDOR EDITS FOR TRANSACTIONS THAT HAVE NO PO * 00900000
009100*     BECAUSE IT LOOKED AS IF THE PO WAS NEVER CHANGING.        * 00910000
009200*   MADE BY: NANCY EILBES                WR/IR #: 20704         * 00920000
009300*                                                               * 00930000
009400*   07/24/2001                                                  * 00940000
009500*     INCREASED THE INPUT AND OUTPUT RECORD FROM 400 TO 500.    * 00950000
009600*     THIS CHANGE WAS MADE BECAUSE COPYBOOK APRD045 WAS         * 00960000
009700*     INCREASED TO 500.                                         * 00970000
009800*   MADE BY: ALEXIS KEIKER               WR/IR #: 22467         * 00980000
009900*                                                               * 00990000
010000*   02/28/2002                                                  * 01000000
010100*     MODIFIED DATABASE CALL IN S500- PARAGRAPH TO ACCOUNT FOR  * 01010000
010200*     MULTIPLE ROWS ON THE PS_GL_ACCOUNT_TBL FOR AN ACCOUNT.    * 01020000
010300*     ADDED CHECK OF MAXIMUM EFFECTIVE DATE.                    * 01030000
010400*   MADE BY: MARK BURNSIDE               PITS  #: 452670        * 01040000
010500*                                                               * 01050000
010600*   05/16/2002                                                  * 01060000
010700*     CHANGE MADE:  NI-SKU CHANGES.  THE 3 BYTE SKU-SEQ FIELD   * 01070000
010800*     IS REPLACED WITH A NUMERIC 8 BYTE SKU FIELD.  CHANGES     * 01080000
010900*     MADE TO PARAGRAPHS C150, C175, AND S200.                  * 01090000
011000*   MADE BY:  KEVIN CATLIN               WR/IR #: 21278         * 01100000
011100*                                                               * 01110000
011200*   02/10/2003                                                  * 01120000
011300*      CHANGED CALL TO PEOPLESOFT TABLE TO USE NEW ALIAS        * 01130000
011400*      NAMING STANDARD.                                         * 01140000
011500*   MADE BY: L SCHALLHORN                 WR#: 23417            * 01150000
011600*                                                               * 01160000
011700*   DATE  09/29/2003                                            * 01170000
011800*       CHANGE MADE: RECOMPILE FROM PRODUCTION TO PICK UP       * 01180000
011900*       CHANGE TO COPYBOOK APRD045.                             * 01190000
012000*       MADE BY: MIKE BESKE              WR/IR #: WR21316       * 01200000
012100*                                                               * 01210000
012200*   DATE  04/02/2004                                            * 01220000
012300*       CHANGE MADE: REPLACED TSTR000 WITH XFT00003.  CHANGED   * 01230000
012400*       THE DEFINITIONS OF W/S STORE FIELDS PV-STORE-NBR AND    * 01240000
012500*       PV-DB2-STR TO BE 9(5) AND S9(4) COMP-3.  THESE FIELDS   * 01250000
012600*       ARE USED IN THE SQL INVOLVING XFT00003.                 * 01260000
012700*       MADE BY: MIKE BESKE              WR/IR #: WR25805       * 01270000
012800*                                                               * 01280000
012900*   DATE  09/30/2004                                            * 01290000
013000*       CHANGE MADE: ADDED A SQL COMMIT STMT AFTER THE SQL      * 01300000
013100*       SELECT IN PARAGRAPH S800-SELECT-STORE.  THE COMMIT WILL * 01310000
013200*       CLOSE THE DB2 THREAD FOR THE DB3P SUB SYSTEM AND NOT    * 01320000
013300*       LEAVE IT HANGING.  IF THIS WAS NOT DONE THEN THE PROGRAM* 01330000
013400*       COULD ABEND WITH A REASON CODE X'00D30109'.             * 01340000
013500*       MADE BY: MIKE BESKE              WR/IR #: P000690867    * 01350000
013600*                                                               * 01360000
013700*   DATE  10/01/2004                                            * 01370000
013800*       CHANGE MADE: REPLACED SQL COMMIT WITH X100-COMMIT PARA. * 01380000
013900*       MADE BY: MIKE BESKE              WR/IR #: P000690867    * 01390000
014000*                                                               * 01400000
014100*   DATE  09/01/2005                                            * 01410000
014200*       CHANGE MADE: ADDED LOGIC TO BYPASS THE PO/VENDOR EDIT   * 01420000
014300*       FOR TRANSACTIONS COMING FROM PROGRAM APKUT301 AND ONLY  * 01430000
014400*       EDIT THE VENDOR NUMBER.  THESE TRANSACTIONS ARE ALL FOR * 01440000
014500*       TRANSINTERNATIONAL, SO THE VENDOR/PO COMBINATION WILL   * 01450000
014600*       NEVER BE VALID.  ALSO, FOR THESE TRANSACTIONS, THE PO   * 01460000
014700*       IS MOVED TO THE REPORT INSTEAD OF THE DOC-NBR, BECAUSE  * 01470000
014800*       THESE HAVE A SYSTEM GENERATED NUMBER THAT WOULD BE      * 01480000
014900*       MEANINGLESS TO ANYONE TRYING TO CORRECT ERRORS FROM THE * 01490000
015000*       REPORT.                                                 * 01500000
015100*       MADE BY: NANCY EILBES            WR/IR #: WR28335       * 01510000
015200*                                                               * 01520000
015300*   DATE  09/29/2005                                            * 01530000
015400*       CHANGE MADE: ADDED LOGIC TO BYPASS OVERLAYING THE ENTER * 01540000
015500*       DATE FOR TRANSACTIONS FROM PROGRAM APKUT301.  THIS      * 01550000
015600*       PROGRAM IS RUN AT VARIOUS TIMES OF DAY AND THE BATCH    * 01560000
015700*       PROCESS DATE MAY NOT HAVE BEEN UPDATED YET TO REFLECT   * 01570000
015800*       THE NEW PROCESSING DATE, BUT APKUT301 HAS ALREADY MADE  * 01580000
015900*       SURE THE TRANSACTIONS HAVE THE CORRECT DATE ON THEM.    * 01590000
016000*       FOLLOW-UP TO THE ABOVE INSTALLATION.                    * 01600000
016100*       MADE BY: NANCY EILBES            WR/IR #: WR28335       * 01610000
016200*                                                               * 01620000
016300*   DATE  10/27/2005                                            * 01630000
016400*       CHANGE MADE: REMOVED LOGIC IN INITIALIZATION THAT WAS   * 01640000
016500*       MOVING THE BATCH PROCESS DATE TO THE PS BATCH DATE.     * 01650000
016600*       THIS IS HANDLED DIFFERENTLY LATER IN THE PROGRAM AND    * 01660000
016700*       CAUSED THE FIRST RECORD ON THE FILE TO BE PROCESSED     * 01670000
016800*       DIFFERENTLY THAN THE REMAINING RECORDS.                 * 01680000
016900*       MADE BY: NANCY EILBES            WR/IR #: P000816501    * 01690000
017000*                                                               * 01700000
017100*   DATE  11/01/2005                                            * 01710000
017200*       CHANGE MADE: REMOVED ALL EDITS ON THE DATE PORTION OF   * 01720000
017300*       THE PS BATCH NUMBER.  THIS PROGRAM IS ALREADY MAKING    * 01730000
017400*       SURE THAT THE ENTER DATE AND BATCH NUMBER MATCH, SO     * 01740000
017500*       THIS EDIT WAS UNNECESSARY AND THE WAY IT WAS HANDLED    * 01750000
017600*       IT WAS CAUSING ERRORS TO BE REPORTED WHERE THERE WERE   * 01760000
017700*       NONE.                                                   * 01770000
017800*       MADE BY: NANCY EILBES            WR/IR #: P000816501    * 01780000
017900*                                                               * 01790000
018000*   DATE  01/30/2006                                            * 01800000
018100*       CHANGE MADE: ADDED LOGIC TO C175-EDIT-MERCHANDISE-TRANS * 01810000
018200*       TO SEARCH TSKXREF FOR A VALID MATCHING SKU.  IF SKU IS  * 01820000
018300*       NOT FOUND A WARNING MESSAGE IS CREATED ON THE EDIT      * 01830000
018400*       REPORT AND ZEROES ARE SUBSTITUTED IN PLACE OF THE       * 01840000
018500*       INVALID SKU NUMBER.                                       01850000
018600*       MADE BY: ROLF NOHE               WR/IR #: WR28582       * 01860000
018700*                                                               * 01870000
018800*   DATE  09/26/2006                                            * 01880000
018900*       CHANGE MADE: ADDED APKUT095 AS AN AP045-ENTR-ID THAT    * 01890000
019000*                    SHOULD NOT ADJUST THE AP045-PS-BTCH-DTE IN * 01900000
019100*                    PARAGRAPH C100-RECORD-EDITS.               * 01910000
019200*       MADE BY: ROLF NOHE               WR/IR #: P000929345    * 01920000
019300*                                                               * 01930000
019400*   DATE  03/27/2007                                            * 01940000
019500*       CHANGE MADE: RECOMPILE FROM PRODUCTION TO INCORPORATE   * 01950000
019600*       CHANGES TO PS_XFT_LOC TABLE FOR STORE DEMOGRAPHICS.     * 01960000
019700*       MADE BY: KEVIN CATLIN            WR/IR #: WR31452       * 01970000
019800*                                                               * 01980000
019900*   DATE  03/13/2008                                            * 01990000
020000*       CHANGE MADE: MODIFIED THE ERROR CHECK WHEN              * 02000000
020100*       TRNCDE-COST-PRCCTL-CDE = 'R' AND ALL 3 AMOUNTS (GROSS,  * 02010000
020200*       FREIGHT AND MISC CHARGE) ARE EQUAL TO ZEROES TO KICK OUT* 02020000
020300*       AND DISPLAY A NEW MESSAGE THAT ONE OF THESE AMOUNTS IS  * 02030000
020400*       REQUIRED.                                               * 02040000
020500*       MADE BY: ROLF NOHE               WR/IR #: WR31518       * 02050000
020600*                                                               * 02060000
020700*   DATE  04/29/2008                                            * 02070000
020800*       CHANGE MADE: ADDED NEW PROGRAM APKUT337 TO CHECK FOR    * 02080000
020900*       APKUT031 TO OVERRIDE DATE AND NOT USE BATCH DATE        * 02090000
021000*       MADE BY: GREG WISIALOWSKI        WR/IR #: WR34276       * 02100000
021100*                                                               * 02110000
021200*   DATE  10/07/2008                                            * 02120000
021300*       CHANGE MADE: ADDED EDIT TO REJECT MERCHANDISE TRANSACTS * 02130000
021400*       THAT HAVE THE HEADQUARTERS STORE NUMBER.  THIS CHANGE   * 02140000
021500*       REQUIRED ADDING THE LOC_TYP_CDE TO THE SELECT FROM THE  * 02150000
021600*       XFT00003 TABLE.  IN C100, THE STORE NUMBER EDIT WAS     * 02160000
021700*       MOVED BEFORE THE TRAN TYPE EDIT SO THAT THE TYPE WOULD  * 02170000
021800*       BE AVAILABLE TO THE EDIT ADDED IN C175.                 * 02180000
021900*       MADE BY: NANCY EILBES           WR/IR #:INC000000548165 * 02190000
022000*                                                               * 02200000
022100*   DATE  10/20/2010                                            * 02210000
022200*       CHANGE MADE: REMOVED ALL REPORT LOGIC FROM THE PROGRAM  * 02220000
022300*       AND REPLACED IT WITH WRITING ALL WARNINGS/ERRORS TO AN  * 02230000
022400*       OUTPUT RECORD (APRD122).  PARAGRAPHS C450- AND C500-    * 02240000
022500*       WERE CREATED TO FORMAT THE DATA INTO THE APRD122 LAYOUT.* 02250000
022600*       EDITED S700- TO INCLUDE THE PO_TYP_CDE IN THE SELECT    * 02260000
022700*       STATEMENT ALONG WITH THE VER_STATUS_CDE = 'A' IN THE    * 02270000
022800*       WHERE CLAUSE.  THE PO_TYP_CDE VALUE IS NEEDED TO        * 02280000
022900*       DETERMINE IF THE PO IS AN IMPORT.  LOGIC WAS ADDED TO   * 02290000
023000*       C100- TO ALLOW THE VENDOR ID TO BE DIFFERENT FROM THE PO* 02300000
023100*       VENDOR ID IF THE PO IS AN IMPORT AND THE TRANSACTION AN * 02310000
023200*       EXPENSE.  CODE WAS ALSO INCLUDED IN THIS PARAGRAPH TO   * 02320000
023300*       VALIDATE THE AP045-DOC-DTE.  EDITED S900- TO INCLUDE THE* 02330000
023400*       DEPT AND SUBCLASS FIELDS IN THE WHERE CLAUSE OF THE     * 02340000
023500*       SELECT STATEMENT.  THE HOLD VARIABLES FOR THESE FIELDS  * 02350000
023600*       ARE POPULATED IN C175-.  LASTLY, ADDED CRITERIA TO THE  * 02360000
023700*       WHERE CLAUSE IN S800- TO VERIFY THAT THE FINANCIAL CLOSE* 02370000
023800*       DATE IS GREATER THAN THE CURRENT DATE.  THIS ENSURES    * 02380000
023900*       THAT THE LOCATION IS OPEN FOR THE FINANCIAL             * 02390000
024000*       TRANSACTIONS.                                           * 02400000
024100*       NANCY EILBES - ADDED CHANGES FOR SAME PROJECT: IN C100, * 02410000
024200*       RESTRUCTURED THE PO AND VENDOR VALIDATION SO THEY COULD * 02420000
024300*       BE DONE INDEPENDENTLY.  THEY WERE SO INTERTWINED THAT   * 02430000
024400*       IF A RECORD HAD AN INVALID PO, AND THE NEXT RECORD HAD  * 02440000
024500*       THE SAME VENDOR, BUT NO PO, THE SECOND RECORD WOULD     * 02450000
024600*       REJECT EVEN THOUGH IT HAD NO ERRORS. REMOVED S350.      * 02460000
024700*       MADE BY: KRYSTEN LEROY          WR/IR #: WR35892        * 02470000
024800*                                                               * 02480000
024900*   DATE  09/07/2011                                            * 02490000
025000*       CHANGE MADE: MODIFIED THE LOGIC WHICH VERIFIES THAT THE * 02500000
025100*       PO/VENDOR COMBINATION IS VALID TO ALLOW THE TRANSACTION * 02510000
025200*       VENDOR TO NOT MATCH THE PO VENDOR WHEN THE TRANSACTION  * 02520000
025300*       IS EITHER FOR TRANS-INTERNATIONAL OR THE PO IS AN IMPORT* 02530000
025400*       AND THE TRANSACTION IS EXPENSE.  WHEN IMPORT PO AND THE * 02540000
025500*       TRANSACTION IS MERCHANDISE, A WARNING WILL BE ISSUED    * 02550000
025600*       IF THE TRANSACTION VENDOR DOES NOT MATCH THE PO VENDOR. * 02560000
025700*       ELIMINATED HARD-CODING OF CERTAIN SOURCE PROGRAMS TO    * 02570000
025800*       ALLOW SPECIFIC VENDOR OR ENTER DATE VALUES.             * 02580000
025900*       MADE BY: NANCY EILBES           WR/IR #:WR35892         * 02590000
026000*                                                               * 02600000
026100*   DATE  08/09/2011                                            * 02610000
026200*       CHANGE MADE: PEOPLESOFT VERSION 9.1 UPGRADE             * 02620000
026300*       PS_GL_ACCOUNT_TBL ON DB3P IS BEING MOVED TO ORACLE      * 02630000
026400*       AS PART OF THE PEOPLESOFT FI UPGRADE PROJECT.SINCE THIS * 02640000
026500*       PROGRAM ACCESS ALL LEGACY TABLES AND ONLY ONE PS TABLE, * 02650000
026600*       THE PROGRAM IS CNGING TO USE APRD526 AS INPUT, WHICH IS * 02660000
026700*       THE EXTRACT OF THE PS_GL_ACCOUNT_TBL DATA  INSTEAD OF   * 02670000
026800*       DIRECTLY ACCESSING THE TABLE. IT WILL ALSO CHANGE TO USE* 02680000
026900*       THE DB2P SIDE OF LOCATION DOMAIN TABLE INSTEAD OF       * 02690000
027000*       PEOPLESOFT LOCATION DOMAIN TABLE.                       * 02700000
027100*       MADE BY: ANIL BEDEKAR           WR/IR #: WR37038        * 02710000
027200*---------------------------------------------------------------* 02720000
027300* CHANGE LOG:                                                  *  02730034
027400*                                                              *  02740016
027500*  03/04/2014                                                  *  02750016
027600*     CHANGE MADE: ADDED THREE FIELDS PO #, NET COST AND       *  02760016
027700*                  NET RETAIL TO THE REPORT.                   *  02770016
027800*  MADE BY: SHEBENA (COGNIZANT)        WR/IR#: CHG0077514      *  02780019
027900*                                                              *  02790029
028000*  07/09/2015                                                  *  02800016
028100*     CHANGE MADE: CHANGES MADE TO C175-EDIT-MERCHANDISE-TRANS *  02810016
028200*     WHERE THE SKU NUMBER IS VALIDATED. ADDED LOGIC TO CHECK  *  02820016
028300*     THAT PS-ERROR-FATAL SWITCH IS NOT BEEN SET TO TRUE BEFORE*  02830029
028400*     CHANGING PS-ERROR-WARNING SWITCH TO TRUE.                   02840029
028500*  MADE BY: PARTHI  (COGNIZANT)        WR/IR#: CHG0117296      *  02850019
028510*                                                              *  02851033
028520*  02/05/2016                                                  *  02852034
028530*     CHANGE MADE: CHANGES MADE TO C100-RECORD-EDITS AND       *  02853033
028540*     S200-SELECT-TRANCODE. ADDED THE COLUMN AP_PSTG_IND WHILE *  02854033
028550*     SELECTING FROM TTRNCDE TABLE. THIS COLUMN WILL TELL US   *  02855033
028560*     WHETHER THE ADJUSTMENT IS BEING INTERFACED TO PS OR NOT. *  02856033
028561*     IF IT IS, WE NEED TO CHECK IF THE NET COST IS ZERO, AND  *  02856133
028562*     IF IT TURNS OUT TO BE ZERO, WE'VE TO REJECT THAT         *  02856234
028563*     ADJUSTMENT. HOWEVER, THERE ARE TIMES WHEN AP KEYS AN     *  02856333
028564*     ADJUSTMENT THAT ONLY UPDATES RETAIL, NOT THE NET COST.   *  02856433
028565*     IN SUCH CASES, THE TRANSACTION STILL HAS TO BE CHECKED   *  02856534
028566*     FOR ZERO NET COST, BUT MUST NOT BE REJECTED.             *  02856634
028570*  MADE BY: SRINATH  (COGNIZANT)        WR/IR#: CHG0132544     *  02857033
028580*                                                              *  02858039
028590*  02/06/2018                                                  *  02859039
028591*     CHANGE MADE: ADDED THE WEEKLY FREIGHT VENDOR '000340000' *  02859139
028592*     AS A VALID FREIGHT VENDOR AND CREATED AN 88 LEVEL FOR    *  02859239
028593*     VALID-FRGT-VND-NBR UNDER PV-VND-NBR, RATHER THAN HAVING  *  02859339
028594*     A SEPARATE FIELD. MODIFIED LOGIC IN C100-RECORD-EDITS    *  02859439
028595*     TO CHECK THE 88 LEVEL INSTEAD OF COMPARING AP045-VND-NBR *  02859539
028596*     TO THE OLD WS FIELD.                                     *  02859639
028597*     THIS CHANGE WAS NEEDED BECAUSE THE AP FREIGHT TEAM WAS   *  02859739
028598*     UPLOADING ADJUSTMENTS USING THE WEEKLY FREIGHT VENDOR ID *  02859839
028599*     AND THEY WERE REJECTING DUE TO THE VENDOR ID NOT MATCHING*  02859939
028600*     THE PO VENDOR ID.                                        *  02860039
028601*  MADE BY: NANCY EILBES                WR/IR#: CHG0189588     *  02860139
028602*                                                              *  02860247
028603* 03/05/2019                                                   *  02860348
028604*     CHANGE MADE: REMOVING THE INP02 GL-ACCT-UNLD-FILE AND    *  02860448
028605*     INTRODUCING THE NEWLY CREATED DB2 TABLE APT_ACCT_TBL     *  02860548
028606*     TO GET THE ACCOUNT DETAILS FROM TABLE INSTEAD OF UNLOAD  *  02860648
028607*     FILE.                                                    *  02860748
028608*   MADE BY: COGNIZANT            WR/IR#: CHG0220043           *  02860848
028609*                                                              *  02860949
028610*DATE  04/09/2019                                              *  02861049
028611*    CHANGE MADE: MODIFIED THE SQL VALIDATING GL ACCOUNT TO    *  02861149
028612*    ADD CRITERIA THAT EFFECTIVE STATUS MUST BE 'A' FOR ACTIVE.*  02861249
028613*    MADE BY: NANCY EILBES            WR/IR #: CHG0221352      *  02861349
028614*                                                              *  02861449
028615*DATE  08/28/2020                                              *  02861552
028616*    CHANGE MADE: ADDED LOGIC TO BYPASS WRITING TRANSACTIONS   *  02861652
028617*    TO THE OUTPUT FILE IF THEY ARE FOR DEPT 985 AND HAVE 54   *  02861752
028618*    OR 55 AS THE AP TRANCODE. THE REASON FOR THIS CHANGE IS   *  02861852
028619*    TO PREVENT RTV DEBITS AND CREDITS FOR MARKETPLACE GOODS   *  02861952
028620*    FROM BEING LOADED INTO THE ADJUSTMENT DATABASE AND BEING  *  02862052
028621*    SENT DOWNSTREAM TO KFS PAYABLES AND GL.  COUNTS ARE KEPT  *  02862152
028622*    OF THE RECORDS SKIPPED AND DISPLAYED AT EOJ.              *  02862252
028623*    MADE BY: NANCY EILBES            WR/IR #: CHG0248119      *  02862352
028624*                                                              *  02862452
028625*DATE  06/24/2021                                              *  02862572
028626*    CHANGE MADE: ACCUMULATE THE CONTROL RECORD TOTALS AND     *  02862673
028627*    COMPARE THEM TO THE DETAIL RECORD TOTALS.  THIS WILL      *  02862773
028628*    ALLOW FOR MULTIPLE FILES TO BE INPUT ON A BATCH CYCLE.    *  02862873
028629*    MADE BY: JIM HUNTER              WR/IR #: CHG0258776      *  02862973
028630*                                                              *  02863073
028631*DATE  01/08/2022                                              *  02863173
028632*    CHANGE MADE: ADDED TO THE DEPT NBR AND CL-NBR EDIT IF THE *  02863273
028633*    EXPENSE CAME FROM THE DAKUT301 PROGRAM, ERROR OUT IF      *  02863373
028634*    THE DEPT NBR OR CL-NBR IS SPACES. THE GL ACCOUNT CODE, THE*  02863473
028635*    DEPT NBR, AND THE CL-NBR SHOULD BE FILLED IN FOR A 7C     *  02863573
028636*    AND 7D RECORD.                                            *  02863673
028637*    MADE BY: BARB SCHULTZ            WR/IR #: CHG0265366      *  02863773
028638*                                                              *  02863873
028639*DATE  02/15/2022                                              *  02863974
028640*    CHANGE MADE: ADDED FEDEX AS A VALID FREIGHT VENDOR.       *  02864074
028641*    VENDOR ID '000653162'.                                    *  02864174
028645*    MADE BY: NANCY EILBES            WR/IR #: CHG0266930      *  02864574
028646*                                                              *  02864674
028647*DATE  04/05/2022                                              *  02864776
028648*    CHANGE MADE: ADDED UPS AS A VALID FREIGHT VENDOR.         *  02864876
028649*    VENDOR ID '000620443'.                                    *  02864976
028650*    MADE BY: NANCY EILBES            WR/IR #: CHG0268702      *  02865076
028651*                                                              *  02865176
028652*DATE  09/20/2022                                              *  02865277
028653*    CHANGE MADE: ADDED SCHNEIDER AS A VALID FREIGHT VENDOR.   *  02865377
028654*    VENDOR ID '001074251'.                                    *  02865477
028655*    MADE BY: NANCY EILBES            WR/IR #: CHG0268702      *  02865577
028656*                                                              *  02865677
028660****************************************************************  02866076
028700                                                                  02870000
028800 ENVIRONMENT DIVISION.                                            02880000
028900 CONFIGURATION SECTION.                                           02890000
029000 SOURCE-COMPUTER. IBM-3090.                                       02900000
029100 OBJECT-COMPUTER. IBM-3090.                                       02910000
029200                                                                  02920000
029300                                                                  02930000
029400 INPUT-OUTPUT SECTION.                                            02940000
029500 FILE-CONTROL.                                                    02950000
029600                                                                  02960000
029700     SELECT ADJ-TRANS-FILE                 ASSIGN TO UT-S-INP01.  02970000
029900     SELECT EDITD-TRANS-FILE               ASSIGN TO UT-S-OUT01.  02990000
030000     SELECT ADJ-ERR-EXCPT-FILE             ASSIGN TO UT-S-OUT02.  03000000
030100                                                                  03010000
030200 DATA DIVISION.                                                   03020000
030300 FILE SECTION.                                                    03030000
030400                                                                  03040000
030500 FD  ADJ-TRANS-FILE                                               03050000
030600     RECORDING MODE IS F                                          03060000
030700     BLOCK CONTAINS 0 CHARACTERS                                  03070000
030800     LABEL RECORDS ARE STANDARD                                   03080000
030900     DATA RECORD IS ADJ-TRANS-RECORD.                             03090000
031000 01  ADJ-TRANS-RECORD             PIC X(500).                     03100000
031100                                                                  03110000
031900 FD  EDITD-TRANS-FILE                                             03190000
032000     RECORDING MODE IS F                                          03200000
032100     BLOCK CONTAINS 0 CHARACTERS                                  03210000
032200     LABEL RECORDS ARE STANDARD                                   03220000
032300     DATA RECORD IS EDITD-TRANS-RECORD.                           03230000
032400 01  EDITD-TRANS-RECORD           PIC X(500).                     03240000
032500                                                                  03250000
032600 FD  ADJ-ERR-EXCPT-FILE                                           03260000
032700     RECORDING MODE IS F                                          03270000
032800     LABEL RECORDS ARE STANDARD                                   03280000
032900     BLOCK CONTAINS 0 RECORDS                                     03290000
033000     DATA RECORD IS ADJ-ERR-EXCPT-RECORD.                         03300000
033100 01  ADJ-ERR-EXCPT-RECORD        PIC  X(154).                     03310000
033200                                                                  03320000
033300                                                                  03330000
033400 WORKING-STORAGE SECTION.                                         03340000
033500                                                                  03350000
033600 01  PC-PROGRAM-CONSTANTS.                                        03360000
033700     05  PC-WS-PROGRAM           PIC  X(32)     VALUE             03370000
033800         '**** WORKING STORAGE FOR ****'.                         03380000
033900     05  PC-PROGRAM-NAME         PIC  X(08)     VALUE 'APKUT136'. 03390000
034000     05  PC-LINES-MAX            PIC S999       VALUE +64.        03400000
034100     05  PC-CALC-ERROR-FIELD     PIC  X(20)     VALUE             03410000
034200         '  CALCULATED AMOUNT '.                                  03420000
034300     05  PC-CTL-ERROR-MSG        PIC  X(47)     VALUE             03430000
034400         'CONTROL AMOUNT DOESN''T MATCH CALCULATED AMOUNT'.       03440000
034500     05  PC-REQUIRED-MSG         PIC  X(28)     VALUE             03450000
034600         'REQUIRED, NOT FOUND ON INPUT'.                          03460000
034700     05  PC-ONE-AMT-REQUIRED-MSG PIC  X(48)     VALUE             03470000
034800         'ONE OF THE AMTS IS REQUIRED, NONE FOUND ON INPUT'.      03480000
034900     05  PC-NOT-FOUND-MSG        PIC  X(19)     VALUE             03490000
035000         'NOT FOUND IN SYSTEM'.                                   03500000
035100     05  PC-NOT-NUM-MSG          PIC  X(11)     VALUE             03510000
035200         'NOT NUMERIC'.                                           03520000
035300     05  PC-INVALID-MSG          PIC  X(13)     VALUE             03530000
035400         'INVALID VALUE'.                                         03540000
035500     05  PC-DUPLICATES-MSG       PIC  X(47)     VALUE             03550000
035600         'DUPLICATES NOT ALLOWED, ALREADY FOUND ON SYSTEM'.       03560000
035700     05  PC-REQMDSE-INP-MSG      PIC  X(43)     VALUE             03570000
035800         'REQUIRED FOR MDSE TRANS, NOT FOUND ON INPUT'.           03580000
035900     05  PC-REQMDSE-SYS-MSG      PIC  X(44)     VALUE             03590000
036000         'REQUIRED FOR MDSE TRANS, NOT FOUND ON SYSTEM'.          03600000
036100     05  PC-EXPENSE-WARNING      PIC  X(44)     VALUE             03610000
036200         '* WARNING, EXPECTED SPACES FOR EXPENSE TRANS'.          03620000
036300     05  PC-MDS-LOCATION-MSG     PIC  X(44)     VALUE             03630000
036400         'CORP OFFICE NOT ALLOWED FOR MDSE TRANSACTION'.          03640000
036500     05  PC-EXP-LOCATION-MSG     PIC  X(43)     VALUE             03650000
036600         'MUST BE CORP OFFICE FOR EXPENSE TRANSACTION'.           03660000
036700     05  PC-NET-COST-ZERO        PIC  X(38)     VALUE             03670029
036800         'NET COST ON ADJUSTMENTS CANNOT BE ZERO'.                03680029
037000                                                                  03700000
037100 01  PS-PROGRAM-SWITCHES.                                         03710000
037200     05  PS-ADJ-TRANS-SW         PIC  X(01)     VALUE 'Y'.        03720000
037300         88  PS-ADJ-TRANS-FOUND                 VALUE 'Y'.        03730000
037400         88  PS-ADJ-TRANS-END                   VALUE 'N'.        03740000
037700     05  PS-BYPASS-SW            PIC  X(01)     VALUE 'N'.        03770000
037800         88  PS-BYPASS-IGNORED                  VALUE 'N'.        03780000
037900         88  PS-BYPASS-NOW                      VALUE 'W'.        03790000
038000     05  PS-ERROR-SW             PIC  X(01)     VALUE 'N'.        03800000
038100         88  PS-ERROR-FREE                      VALUE 'N'.        03810000
038200         88  PS-ERROR-WARNING                   VALUE 'W'.        03820000
038300         88  PS-ERROR-FATAL                     VALUE 'F'.        03830000
038400     05  PS-ENTITY-SW            PIC  X(01)     VALUE 'N'.        03840000
038500         88  PS-ENTITY-INVALID                  VALUE 'N'.        03850000
038600         88  PS-ENTITY-VALID                    VALUE 'Y'.        03860000
038700     05  PS-VENDOR-SW            PIC  X(01)     VALUE 'N'.        03870000
038800         88  PS-VENDOR-INVALID                  VALUE 'N'.        03880000
038900         88  PS-VENDOR-VALID                    VALUE 'Y'.        03890000
039000     05  PV-GL-ACCOUNT-SW        PIC  X(01)     VALUE 'N'.        03900000
039100         88  PV-GL-ACCOUNT-INVALID              VALUE 'N'.        03910000
039200         88  PV-GL-ACCOUNT-VALID                VALUE 'Y'.        03920000
039300     05  PS-PURCHS-CD            PIC  X(01)     VALUE 'N'.        03930000
039400         88  PS-PURCHS-INVALID                  VALUE 'N'.        03940000
039500         88  PS-PURCHS-VALID                    VALUE 'Y'.        03950000
039600         88  PS-PURCHS-NOT-ENTERED              VALUE 'X'.        03960000
039700     05  PS-MDSEAR-SW            PIC  X(01)     VALUE 'N'.        03970000
039800         88  PS-MDSEAR-INVALID                  VALUE 'N'.        03980000
039900         88  PS-MDSEAR-VALID                    VALUE 'Y'.        03990000
040000     05  PS-STORE-SW             PIC  X(01)     VALUE 'N'.        04000000
040100         88  PS-STORE-INVALID                   VALUE 'N'.        04010000
040200         88  PS-STORE-VALID                     VALUE 'Y'.        04020000
040300     05  PS-PRINT-KEY-SW         PIC  X(01)     VALUE ' '.        04030000
040400         88 PS-PRINT-KEY                        VALUE 'Y'.        04040000
040500     05  PS-SKU-SW               PIC  X(01)     VALUE 'Y'.        04050000
040600         88  PS-SKU-INVALID                     VALUE 'N'.        04060000
040700         88  PS-SKU-VALID                       VALUE 'Y'.        04070000
040800     05  PS-CNTRL-WRTTN-SW       PIC  X(01)     VALUE 'N'.        04080000
040900         88  PS-CNTRL-WRTTN                     VALUE 'Y'.        04090000
041000         88  PS-CNTRL-NOT-WRTTN                 VALUE 'N'.        04100000
041100                                                                  04110000
041200 01  PV-PROGRAM-VARIABLES.                                        04120000
041300     05  PV-COUNTERS             COMP.                            04130000
041400         10  PV-COUNT-READ       PIC 9(11)     VALUE ZEROES.      04140000
041700         10  PV-COUNT-WRITTEN    PIC S9(11)    VALUE ZEROES.      04170000
041800         10  PV-COUNT-WARNINGS   PIC S9(11)    VALUE ZEROES.      04180000
041900         10  PV-COUNT-ERRORS     PIC S9(11)    VALUE ZEROES.      04190000
042000         10  PV-COUNT-CLEAN      PIC S9(11)    VALUE ZEROES.      04200000
042100         10  PV-COUNT-RPT        PIC S9(11)    VALUE ZEROES.      04210000
042110         10  PV-COUNT-DPT985     PIC S9(11)    VALUE ZEROES.      04211050
042200                                                                  04220000
042300     05  PV-HOLD-FIELDS.                                          04230000
042400         10  PV-HOLD-KEY-DATA-FIELDS                              04240000
042500                                 PIC  X(37)     VALUE SPACES.     04250000
042600         10  PV-MDSEAR-MDSELV-CDE                                 04260000
042700                                 PIC  X(03)     VALUE SPACES.     04270000
042800         10  PV-MDSEAR-MAJ-CL-CDE                                 04280000
042900                                 PIC  X(02)     VALUE SPACES.     04290000
043000         10  PV-MDSEAR-SUB-CL-CDE                                 04300000
043100                                 PIC  X(03)     VALUE SPACES.     04310000
043200         10  PV-DB2-CL-NBR.                                       04320000
043300             15  FILLER          PIC  X         VALUE ZEROES.     04330000
043400             15  PV-CL-NBR.                                       04340000
043500                 20  PV-MAJ-IND  PIC  X         VALUE SPACES.     04350000
043600                 20  PV-SUB-IND  PIC  X         VALUE SPACES.     04360000
043700         10  PV-STORE-NBR        PIC  9(5)      VALUE ZEROES.     04370000
043800         10  PV-DB2-STR          PIC S9(4) COMP-3 VALUE ZEROES.   04380000
043900         10  PV-PO-NBR     COMP  PIC S9(09)     VALUE 999999999.  04390000
044000         10  PV-SAVE-PO-NBR      PIC  X(9)      VALUE ALL '*'.    04400000
044100         10  PV-VND-NBR          PIC  X(9)      VALUE SPACES.     04410000
044110             88  VALID-FRGT-VND-NBR             VALUE '003926581' 04411038
044120                                                    , '000653162' 04412073
044121                                                    , '000620443' 04412175
044122                                                    , '001074251' 04412277
044130                                                    , '000340000'.04413073
044140** VALID FREIGHT VENDORS ARE TRANSINTERNATIONAL '003926581'       04414073
044150** FEDEX '000653162', WEEKLY FREIGHT (INTERNAL) '000340000'       04415075
044151** UNITED PARCEL SERVICE-PHIL '000620443'                         04415177
044152** AND SCHNEIDER NATIONAL INC. '001074251'                        04415277
044160**                                                                04416073
044200         10  PV-SKU-NBR          PIC S9(08)V COMP-3 VALUE ZEROES. 04420000
044300         10  PV-DEPARTMENT       PIC S9(04)V COMP-3 VALUE ZEROES. 04430000
044400         10  PV-DEPT-NBR         PIC X(03).                       04440000
044500         10  PV-DEPT-NBR-9 REDEFINES PV-DEPT-NBR PIC 9(03).       04450000
044600         10  PV-CLASS            PIC S9(04)V COMP-3 VALUE ZEROES. 04460000
044700         10  PV-CLS              PIC X(02).                       04470000
044800         10  PV-CLS-9 REDEFINES PV-CLS PIC 9(02).                 04480000
044900     05  PV-ACCUM-FIELDS         COMP-3.                          04490000
045000         10  PV-ACCUM-GRO-COST   PIC S9(11)V99  VALUE ZEROES.     04500000
045100         10  PV-ACCUM-RETL       PIC S9(11)V99  VALUE ZEROES.     04510000
045200         10  PV-ACCUM-FRGT       PIC S9(11)V99  VALUE ZEROES.     04520000
045300         10  PV-ACCUM-MISC-CHRG  PIC S9(11)V99  VALUE ZEROES.     04530000
045400         10  PV-ACCUM-NET-COST   PIC S9(11)V99  VALUE ZEROES.     04540000
045500         10  PV-ACCUM-TERM-DISC  PIC S9(11)V99  VALUE ZEROES.     04550000
045600         10  PV-ACCUM-NW-STR-DISC PIC S9(11)V99 VALUE ZEROES.     04560000
045700         10  PV-ACCUM-TRD-DISC   PIC S9(11)V99  VALUE ZEROES.     04570000
045800         10  PV-ACCUM-MOS-DISC   PIC S9(11)V99  VALUE ZEROES.     04580000
045801     05  PV-CTL-ACCUM-FIELDS        COMP-3.                       04580163
045810         10  PV-CTL-RECORD-COUNT    PIC S9(11)    VALUE ZEROES.   04581063
045820         10  PV-CTL-GRO-COST-AMT    PIC S9(11)V99 VALUE ZEROES.   04582063
045830         10  PV-CTL-RETL-AMT        PIC S9(11)V99 VALUE ZEROES.   04583063
045840         10  PV-CTL-FRGT-AMT        PIC S9(11)V99 VALUE ZEROES.   04584063
045850         10  PV-CTL-MISC-CHRG-AMT   PIC S9(11)V99 VALUE ZEROES.   04585063
045860         10  PV-CTL-NET-COST-AMT    PIC S9(11)V99 VALUE ZEROES.   04586063
045870         10  PV-CTL-TERM-DISC-AMT   PIC S9(11)V99 VALUE ZEROES.   04587063
045880         10  PV-CTL-NW-STR-DISC-AMT PIC S9(11)V99 VALUE ZEROES.   04588063
045890         10  PV-CTL-TRD-DISC-AMT    PIC S9(11)V99 VALUE ZEROES.   04589063
045891         10  PV-CTL-MOS-DISC-AMT    PIC S9(11)V99 VALUE ZEROES.   04589163
045900     05  PV-CURRENT-DATE.                                         04590000
046000         10  PV-CURRENT-YEAR     PIC  9(02)     VALUE ZEROS.      04600000
046100         10  PV-CURRENT-MONTH    PIC  9(02)     VALUE ZEROS.      04610000
046200         10  PV-CURRENT-DAY      PIC  9(02)     VALUE ZEROS.      04620000
046300     05  PV-CURRENT-TIME.                                         04630000
046400         10  PV-CURRENT-HOUR     PIC  9(02)     VALUE ZEROES.     04640000
046500         10  PV-CURRENT-MINUTE   PIC  9(02)     VALUE ZEROES.     04650000
046600         10  FILLER              PIC  9(02)     VALUE ZEROES.     04660000
046700     05  PV-DB2-TIME-FORMAT.                                      04670000
046800         10  PV-DB2-TIME-DASH    PIC  X         VALUE SPACES.     04680000
046900         10  PV-DB2-TIME-HH      PIC  9(02)     VALUE ZEROES.     04690000
047000         10  PV-DB2-TIME-PERIOD1 PIC  X         VALUE SPACES.     04700000
047100         10  PV-DB2-TIME-MM      PIC  9(02)     VALUE ZEROES.     04710000
047200         10  PV-DB2-TIME-PERIOD2 PIC  X         VALUE SPACES.     04720000
047300         10  PV-DB2-TIME-SS      PIC  9(02)     VALUE ZEROES.     04730000
047400         10  PV-DB2-TIME-PERIOD3 PIC  X         VALUE SPACES.     04740000
047500         10  PV-DB2-TIME-REM     PIC  9(06)     VALUE ZEROES.     04750000
047600                                                                  04760000
047700     05  PV-ERR-AMT              PIC S9(11)V99  VALUE ZEROES.     04770000
047800     05  PV-ERR-AMT-R            REDEFINES      PV-ERR-AMT.       04780000
047900         10  PV-ERR-AMT-NBR      PIC  9(11).                      04790000
048000         10  PV-ERR-AMT-DEC      PIC  99.                         04800000
048100     05  PV-ERR-AMT-NBR-S        PIC S9(11).                      04810000
048200     05  PV-ERROR-AMT-DIS.                                        04820000
048300         10  PV-ERROR-NBR        PIC  --,---,---,--9.             04830000
048400         10  PV-ERROR-DECIMAL    PIC  X(01)     VALUE '.'.        04840000
048500         10  PV-ERROR-DEC        PIC  99        VALUE ZEROES.     04850000
048600         10  FILLER              PIC  X(05)     VALUE SPACES.     04860000
048700     05  PV-ERROR-READ-DIS.                                       04870000
048800         10  PV-ERROR-READ       PIC  ZZ,ZZZ,ZZZ,ZZ9.             04880000
048900         10  FILLER              PIC  X(08)     VALUE SPACES.     04890000
049000                                                                  04900000
049100     05  PV-ERR-PCT-DIS          PIC  9V9999    VALUE ZEROES.     04910000
049200     05  FILLER                  REDEFINES      PV-ERR-PCT-DIS.   04920000
049300         10  PV-ERR-PCT-NUM-DIS  PIC  X(05).                      04930000
049400                                                                  04940000
049500     05  PV-ERR-DIS.                                              04950000
049600         10  PV-ERR-NUM-DIS      PIC  9(11)V99  VALUE ZEROES.     04960000
049700                                                                  04970000
049800     05  PV-GL-ACCT-VARIABLES.                                    04980043
049900         10  PV-GL-ACCT-ACCOUNT  PIC  X(10)  VALUE SPACES.        04990048
050400 01  PV-REPORT-CONTROLS.                                          05040000
050500     05  PV-LINE-SKIP            PIC S999       VALUE ZEROES.     05050000
050600     05  PV-LINES-PER-PAGE       PIC S999       VALUE +999.       05060000
050700     05  PV-PAGE-COUNT           PIC S9(05)     VALUE ZEROES.     05070000
050800     05  PV-COUNT                PIC S9(05)     VALUE ZEROES.     05080000
050900                                                                  05090000
051000                                                                  05100000
051100*---------------------------------------------------------------  05110000
051200*  WORK AREA PASSED IN CALL TO DPKUT500 DATE ROUTINE              05120000
051300*---------------------------------------------------------------  05130000
051400     COPY DPWS500.                                                05140000
051500                                                                  05150000
051600*---------------------------------------------------------------  05160000
051700*    ADJUSTMENT TRANSACTION FILE - INPUT                          05170000
051800*---------------------------------------------------------------  05180000
051900     COPY APRD045.                                                05190000
052400                                                                  05240000
052500*----------------------------------------------------------------*05250000
052600*    ADJUSTMENT TRANSACTION FILE - OUTPUT (EDITED)                05260000
052700*----------------------------------------------------------------*05270000
052800     COPY APRD045 REPLACING 'AP045-' BY 'EDITD-'.                 05280000
052900                                                                  05290000
053000*----------------------------------------------------------------*05300000
053100*    ADJUSTMENT ERROR/EXCEPTION TRANSCTION FILE - OUTPUT          05310000
053200*----------------------------------------------------------------*05320000
053300     COPY APRD122.                                                05330000
053400                                                                  05340000
053500                                                                  05350000
053600*----------------------------------------------------------------*05360000
053700*  AP-PAYMENT CONTROL                                            *05370000
053800*----------------------------------------------------------------*05380000
053900     EXEC SQL                                                     05390000
054000          INCLUDE TAPCNTL                                         05400000
054100     END-EXEC.                                                    05410000
054200                                                                  05420000
054300*----------------------------------------------------------------*05430000
054400*  AP-ADJUSTMENT JOURNAL                                         *05440000
054500*----------------------------------------------------------------*05450000
054600     EXEC SQL                                                     05460000
054700          INCLUDE TADJRNL                                         05470000
054800     END-EXEC.                                                    05480000
054900                                                                  05490000
055000*----------------------------------------------------------------*05500000
055100*  EX-EXTERNAL ENTERPRISE                                        *05510000
055200*----------------------------------------------------------------*05520000
055300     EXEC SQL                                                     05530000
055400          INCLUDE TEXTENT                                         05540000
055500     END-EXEC.                                                    05550000
055600                                                                  05560000
055700*----------------------------------------------------------------*05570000
055800*  EX-EXTERNAL ENTERPRISE NAME                                   *05580000
055900*----------------------------------------------------------------*05590000
056000     EXEC SQL                                                     05600000
056100          INCLUDE TENTNME                                         05610000
056200     END-EXEC.                                                    05620000
056300                                                                  05630000
056400*----------------------------------------------------------------*05640000
056500*  MERCHANDISE AREA TABLE                                        *05650000
056600*----------------------------------------------------------------*05660000
056700     EXEC SQL                                                     05670000
056800          INCLUDE TMDSEAR                                         05680000
056900     END-EXEC.                                                    05690000
057000                                                                  05700000
057100*----------------------------------------------------------------*05710000
057200*  PO-PURCHASING TABLE                                           *05720000
057300*----------------------------------------------------------------*05730000
057400     EXEC SQL                                                     05740000
057500          INCLUDE TPURCHS                                         05750000
057600     END-EXEC.                                                    05760000
057700                                                                  05770000
057800*----------------------------------------------------------------*05780000
057900*  LOCATION TABLE                                                *05790000
058000*----------------------------------------------------------------*05800000
058100     EXEC SQL                                                     05810000
058200          INCLUDE XFT00017                                        05820000
058300     END-EXEC.                                                    05830000
058400                                                                  05840000
058500*----------------------------------------------------------------*05850000
058600*  AP-TRANSACTION CODE                                           *05860000
058700*----------------------------------------------------------------*05870000
058800     EXEC SQL                                                     05880000
058900          INCLUDE TTRNCDE                                         05890000
059000     END-EXEC.                                                    05900000
059100                                                                  05910000
059200*----------------------------------------------------------------*05920000
059300*  AP-TSKXREF                                                    *05930000
059400*----------------------------------------------------------------*05940000
059500     EXEC SQL                                                     05950000
059600          INCLUDE TSKXREF                                         05960000
059700     END-EXEC.                                                    05970000
059800                                                                  05980000
059810*----------------------------------------------------------------*05981048
059820*  APT_ACCT_TBL                                                  *05982048
059830*----------------------------------------------------------------*05983048
059840     EXEC SQL                                                     05984048
059850          INCLUDE APT00002                                        05985048
059860     END-EXEC.                                                    05986048
059870                                                                  05987048
059900*----------------------------------------------------------------*05990000
060000*    SQL COMMUNICATIONS AREA DCLGEN                               06000000
060100*----------------------------------------------------------------*06010000
060200     EXEC SQL                                                     06020000
060300         INCLUDE SQLCA                                            06030000
060400     END-EXEC.                                                    06040000
060500                                                                  06050000
060600*---------------------------------------------------------------- 06060000
060700*  ABEND DATA AREAS                                               06070000
060800*---------------------------------------------------------------- 06080000
060900 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          06090000
061000                                             COMP SYNC.           06100000
061100     88  AC-DB2-ERROR                        VALUE +4013.         06110000
061200                                                                  06120000
061300                                                                  06130000
061400 01  ABEND-AREAS.                                                 06140000
061500     05  AA-ABEND-LIT            PIC  X(40)  VALUE                06150000
061600             '*****       ABEND'.                                 06160000
061700     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                06170000
061800             '*****   PROGRAM: APKUT136'.                         06180000
061900     05  AA-PARAGRAPH-LIT.                                        06190000
062000         10  FILLER              PIC  X(17)  VALUE                06200000
062100             '***** PARAGRAPH: '.                                 06210000
062200         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        06220000
062300     05  AA-MESSAGE-LINE.                                         06230000
062400         10  FILLER              PIC  X(06)  VALUE '*****'.       06240000
062500         10  AA-MESSAGE.                                          06250000
062600             15 AA-MESS-1        PIC  X(30)  VALUE SPACES.        06260000
062700             15 AA-MESS-2        PIC  X(97)  VALUE SPACES.        06270000
062800     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                06280000
062900             '*****    DB2 ERROR'.                                06290000
063000     05  AA-DB2-OPERATION-LIT.                                    06300000
063100         10  FILLER              PIC  X(17)  VALUE                06310000
063200             '***** OPERATION: '.                                 06320000
063300         10  AA-DB2-OPERATION.                                    06330000
063400             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        06340000
063500             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        06350000
063600     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        06360000
063700     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        06370000
063800     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        06380000
063900     05  AA-DB2-TABLE-4          PIC  X(08)  VALUE SPACES.        06390000
064000                                                                  06400000
064100*---------------------------------------------------------------- 06410000
064200*  SQLCA FORMATTED MESSAGE AREA                                   06420000
064300*---------------------------------------------------------------- 06430000
064400     COPY DPWS004.                                                06440000
064500                                                                  06450000
064600 01  FILLER                      PIC  X(35)  VALUE                06460000
064700     '**** END OF W/S ** APKUT136 ****'.                          06470000
064800                                                                  06480000
064900 PROCEDURE DIVISION.                                              06490000
065000                                                                  06500000
065100     PERFORM A100-MAINLINE.                                       06510000
065200     GOBACK.                                                      06520000
065300                                                                  06530000
065400 A100-MAINLINE.                                                   06540000
065500                                                                  06550000
065600     PERFORM B100-INITIALIZE.                                     06560000
065700                                                                  06570000
065800     PERFORM B200-PROCESS-ADJ-TRANS-FILE                          06580000
065900         UNTIL PS-ADJ-TRANS-END.                                  06590063
066000**       OR    AP045-CONTROL-RECORD.                              06600063
066100                                                                  06610000
066200     PERFORM B300-END-OF-PROGRAM.                                 06620000
066300                                                                  06630000
066400                                                                  06640000
066500 B100-INITIALIZE.                                                 06650000
066600*---------------------------------------------------------------- 06660000
066700*    INITIALIZATION PROCESSING                                    06670000
066800*---------------------------------------------------------------- 06680000
066900                                                                  06690000
067000     DISPLAY '* * * * * * * * * * * * * * * * * * * * * * *'      06700000
067100     DISPLAY 'APKUT136 START PROCESSING '                         06710000
067200                                                                  06720000
067300     OPEN INPUT  ADJ-TRANS-FILE                                   06730000
067500     OPEN OUTPUT EDITD-TRANS-FILE                                 06750000
067600                 ADJ-ERR-EXCPT-FILE.                              06760000
067700                                                                  06770000
067800     INITIALIZE DCLTAPCNTL                                        06780000
067900                DCLTADJRNL                                        06790000
068000                DCLTEXTENT                                        06800000
068100                DCLTENTNME                                        06810000
068200                DCLTMDSEAR                                        06820000
068300                DCLTPURCHS                                        06830000
068400                DCLXFT00017                                       06840000
068500                DCLTTRNCDE                                        06850000
068600                DCLTSKXREF                                        06860000
068700                EDITD-TRANSACTION-FILE.                           06870000
068800                                                                  06880000
068900     PERFORM S100-SELECT-BATCH-PROCESS-DATE.                      06890000
069000                                                                  06900000
069100     PERFORM R100-READ-ADJ-TRANS-FILE.                            06910000
069200     IF PS-ADJ-TRANS-FOUND                                        06920000
069300         MOVE AP045-KEY-FIELDS     TO EDITD-KEY-FIELDS            06930000
069400         MOVE AP045-TRN-TYP-CDE    TO EDITD-TRN-TYP-CDE           06940000
069500         MOVE AP045-PO-NBR         TO EDITD-PO-NBR                06950000
069600         MOVE AP045-DEPT-NBR       TO EDITD-DEPT-NBR              06960000
069700         MOVE AP045-GL-ACCT-NBR    TO EDITD-GL-ACCT-NBR           06970000
069800***  ELSE                                                         06980000
069900***      MOVE 'INPUT FILE EMPTY'   TO DL-ERROR-FIELD              06990000
070000***      MOVE 'NO DATA TO PROCESS' TO DL-ERROR-MESSAGE            07000000
070100***      PERFORM E100-PROCESS-REPORT-RECORDS                      07010000
070200     END-IF.                                                      07020000
070300                                                                  07030000
071900 B200-PROCESS-ADJ-TRANS-FILE.                                     07190000
072000*---------------------------------------------------------------- 07200000
072100*    CONTROLS THE PROCESSING OF ADJUSTMENT TRANSACTIONS.          07210000
072200*---------------------------------------------------------------- 07220000
072300                                                                  07230000
072400* RESET ERROR SWITCH FOR EACH NEW RECORD.                         07240000
072500     SET PS-ERROR-FREE                                            07250000
072600         PS-BYPASS-IGNORED       TO TRUE.                         07260000
072700                                                                  07270000
072800     IF NOT AP045-DETAIL-RECORD                                   07280000
072900         SET PS-ERROR-FATAL                                       07290000
073000             PS-BYPASS-NOW       TO TRUE                          07300000
073010**       DON'T WRITE ERROR FOR CONTROL RECORDS                    07301063
073020         IF NOT AP045-CONTROL-RECORD                              07302063
073100             PERFORM C500-EMPTY-ERROR-EXCPT-FIELDS                07310058
073200             MOVE AP045-RECD-TYP-CDE TO AP122-ERROR-VALUE         07320058
073300             MOVE 'RECORD TYPE CODE' TO AP122-ERROR-FIELD         07330058
073400             MOVE 'ONLY DETAIL RECORDS ALLOWED, THIS IS NOT '     07340058
073500               TO AP122-ERROR-MESSAGE                             07350058
073600             PERFORM W200-WRITE-ERROR-EXCPT-RECORD                07360058
073610         END-IF                                                   07361063
073700     ELSE                                                         07370000
073800         IF AP045-AP-TRN-CDE NOT = TRNCDE-AP-TRN-CDE              07380000
073900           OR AP045-AP-TRN-CDE = ZEROES                           07390000
074000           OR AP045-AP-TRN-CDE = SPACES                           07400000
074100             PERFORM S200-SELECT-TRANCODE                         07410000
074200         END-IF                                                   07420000
074300         IF PS-ERROR-FATAL                                        07430000
074400            PERFORM C450-COMMON-ERR-EXCPT-FIELDS                  07440000
074500            MOVE 'AP TRAN CODE'      TO AP122-ERROR-FIELD         07450000
074600            MOVE AP045-AP-TRN-CDE    TO AP122-ERROR-VALUE         07460000
074700            MOVE 'NOT FOUND OR NOT CURRENTLY EFFECTIVE'           07470000
074800              TO AP122-ERROR-MESSAGE                              07480000
074900            PERFORM W200-WRITE-ERROR-EXCPT-RECORD                 07490000
075000         ELSE                                                     07500000
075100* MUST BE DETAIL RECORD WITH VALID AP TRAN CODE TO EDIT.          07510000
075200             PERFORM C100-RECORD-EDITS                            07520000
075300         END-IF                                                   07530000
075400     END-IF.                                                      07540000
075500                                                                  07550000
075600* BYPASS SWITCH IS SET FOR NON-DETAIL AND INVALID AP TRANS CODES  07560000
075700*  THESE WEREN'T EDITED, SO WE SKIP CRSS-RECORD-EDITS, ALSO.      07570000
075800     IF PS-BYPASS-IGNORED                                         07580000
075900       AND AP045-VND-NBR = EDITD-VND-NBR                          07590000
076000       AND AP045-DOC-NBR = EDITD-DOC-NBR                          07600000
076100         PERFORM C200-CROSS-RECORD-EDITS                          07610000
076200     END-IF.                                                      07620000
076300                                                                  07630000
076400*  ACCUMULATE TOTALS FOR ALL INPUT DATA WITH, OR WITHOUT, ERRORS. 07640000
076401** DON'T ACCUMULATE TOTALS FOR CONTROL RECORDS                    07640163
076402     IF NOT AP045-CONTROL-RECORD                                  07640263
076500         PERFORM C300-ACCUM-RECORD-TOTALS                         07650058
076510     END-IF.                                                      07651063
076600                                                                  07660000
076700     IF PS-ERROR-FATAL                                            07670000
076810**       AVOID INCREMENTING ERROR COUNT TWICE PER RECORD          07681063
076820**       ADD +1                  TO PV-COUNT-ERRORS               07682063
076830         CONTINUE                                                 07683063
076900     ELSE                                                         07690000
077000         IF PS-ERROR-WARNING                                      07700000
077100             ADD +1              TO PV-COUNT-WARNINGS             07710000
077200         ELSE                                                     07720000
077300             ADD +1              TO PV-COUNT-CLEAN                07730000
077400         END-IF                                                   07740000
077500         MOVE AP045-TRANSACTION-FILE TO EDITD-TRANSACTION-FILE    07750000
077600         PERFORM C350-PROCESS-POSTING-PERIOD                      07760000
077601** LOGIC ADDED TO BYPASS WRITING RTV TRANSACTIONS FOR DEPT 985    07760150
077602** TO PREVENT POSTING TO AP FOR MARKETPLACE RETURNS.              07760250
077610         IF EDITD-DEPT-NBR = '985'                                07761050
077620         AND (EDITD-AP-TRN-CDE = '54' OR '55')                    07762051
077630            ADD +1 TO PV-COUNT-DPT985                             07763050
077640         ELSE                                                     07764050
077641            PERFORM W100-WRITE-AP045-EDITD-RECORD                 07764150
077650         END-IF                                                   07765050
077800     END-IF.                                                      07780000
077900                                                                  07790000
078000     PERFORM R100-READ-ADJ-TRANS-FILE.                            07800000
078100                                                                  07810000
078200                                                                  07820000
078300*---------------------------------------------------------------- 07830000
078400*    END OF PROGRAM                                               07840000
078500*---------------------------------------------------------------- 07850000
078600 B300-END-OF-PROGRAM.                                             07860000
078700                                                                  07870000
078800     IF PV-COUNT-READ > ZEROES                                    07880000
078900       OR AP045-CONTROL-RECORD                                    07890000
079010***      IF PS-ADJ-TRANS-END                                      07901063
079100***          INITIALIZE AP045-CONTROL-FIELDS                      07910063
079110***          INITIALIZE PV-CTL-ACCUM-FIELDS                       07911063
079200***          MOVE 'MISSING '     TO AP045-VND-NBR                 07920063
079300***      END-IF                                                   07930063
079400         PERFORM C400-PROCESS-CONTROL-DATA                        07940000
079500                                                                  07950000
079600         IF PS-ERROR-FREE                                         07960000
079700             IF ( PV-COUNT-WARNINGS = ZEROES                      07970000
079800                 AND PV-COUNT-ERRORS = ZEROES )                   07980000
079900*                PERFORM C500-EMPTY-ERROR-EXCPT-FIELDS            07990000
080000*                MOVE 'NO ERRORS' TO AP122-ERROR-FIELD            08000000
080100*                MOVE SPACES      TO AP122-ERROR-VALUE            08010000
080200*                                    AP122-ERROR-TYP-CDE          08020000
080300*                MOVE 'NO EXCEPTIONS FOUND IN DATA PROCESSED '    08030000
080400*                  TO AP122-ERROR-MESSAGE                         08040000
080500*                PERFORM W200-WRITE-ERROR-EXCPT-RECORD            08050000
080600                 CONTINUE                                         08060000
080700             END-IF                                               08070000
080800         ELSE                                                     08080000
080900             MOVE 4094           TO RETURN-CODE                   08090000
081000         END-IF                                                   08100000
081100     END-IF.                                                      08110000
081200                                                                  08120000
081300     DISPLAY ' '.                                                 08130000
081400     DISPLAY ' ACCUMULATED DETAIL AMOUNTS '.                      08140063
081500     MOVE PV-ACCUM-GRO-COST      TO PV-ERR-AMT.                   08150000
081600     PERFORM D100-PROCESS-NUMERIC-ERRORS.                         08160000
081700     DISPLAY 'GROSS COST  = ' AP122-ERROR-VALUE.                  08170000
081800                                                                  08180000
081900     MOVE PV-ACCUM-RETL          TO PV-ERR-AMT.                   08190000
082000     PERFORM D100-PROCESS-NUMERIC-ERRORS.                         08200000
082100     DISPLAY 'RETAIL      = ' AP122-ERROR-VALUE.                  08210000
082200                                                                  08220000
082300     MOVE PV-ACCUM-FRGT          TO PV-ERR-AMT.                   08230000
082400     PERFORM D100-PROCESS-NUMERIC-ERRORS.                         08240000
082500     DISPLAY 'FREIGHT     = ' AP122-ERROR-VALUE.                  08250000
082600                                                                  08260000
082700     MOVE PV-ACCUM-MISC-CHRG     TO PV-ERR-AMT.                   08270000
082800     PERFORM D100-PROCESS-NUMERIC-ERRORS.                         08280000
082900     DISPLAY 'MISC CHRG   = ' AP122-ERROR-VALUE.                  08290000
083000                                                                  08300000
083100     MOVE PV-ACCUM-NET-COST      TO PV-ERR-AMT.                   08310000
083200     PERFORM D100-PROCESS-NUMERIC-ERRORS.                         08320000
083300     DISPLAY 'NET COST    = ' AP122-ERROR-VALUE.                  08330000
083400                                                                  08340000
083500     MOVE PV-ACCUM-TERM-DISC     TO PV-ERR-AMT.                   08350000
083600     PERFORM D100-PROCESS-NUMERIC-ERRORS.                         08360000
083700     DISPLAY 'TERM DISC   = ' AP122-ERROR-VALUE.                  08370000
083800                                                                  08380000
083900     MOVE PV-ACCUM-NW-STR-DISC   TO PV-ERR-AMT.                   08390000
084000     PERFORM D100-PROCESS-NUMERIC-ERRORS.                         08400000
084100     DISPLAY 'NW STR DISC = ' AP122-ERROR-VALUE.                  08410000
084200                                                                  08420000
084300     MOVE PV-ACCUM-TRD-DISC      TO PV-ERR-AMT.                   08430000
084400     PERFORM D100-PROCESS-NUMERIC-ERRORS.                         08440000
084500     DISPLAY 'TRD DISC    = ' AP122-ERROR-VALUE.                  08450000
084600                                                                  08460000
084700     MOVE PV-ACCUM-MOS-DISC      TO PV-ERR-AMT.                   08470000
084800     PERFORM D100-PROCESS-NUMERIC-ERRORS.                         08480000
084900     DISPLAY 'MOS DISC    = ' AP122-ERROR-VALUE.                  08490000
085000                                                                  08500000
085110     DISPLAY ' '.                                                 08511063
085200     DISPLAY '* * * * * * * * * * * * * * * * * * * * * * *'.     08520063
085300     DISPLAY ' '.                                                 08530063
085320     DISPLAY ' ACCUMULATED CONTROL AMOUNTS '.                     08532063
085331     MOVE PV-CTL-RECORD-COUNT    TO PV-ERROR-READ.                08533163
085350     DISPLAY 'RECORD CNT  = ' PV-ERROR-READ.                      08535063
085360                                                                  08536063
085361     MOVE PV-CTL-GRO-COST-AMT    TO PV-ERR-AMT.                   08536163
085362     PERFORM D100-PROCESS-NUMERIC-ERRORS.                         08536263
085363     DISPLAY 'GROSS COST  = ' AP122-ERROR-VALUE.                  08536363
085364                                                                  08536463
085370     MOVE PV-CTL-RETL-AMT        TO PV-ERR-AMT.                   08537063
085380     PERFORM D100-PROCESS-NUMERIC-ERRORS.                         08538063
085390     DISPLAY 'RETAIL      = ' AP122-ERROR-VALUE.                  08539063
085391                                                                  08539163
085392     MOVE PV-CTL-FRGT-AMT        TO PV-ERR-AMT.                   08539263
085393     PERFORM D100-PROCESS-NUMERIC-ERRORS.                         08539363
085394     DISPLAY 'FREIGHT     = ' AP122-ERROR-VALUE.                  08539463
085395                                                                  08539563
085396     MOVE PV-CTL-MISC-CHRG-AMT   TO PV-ERR-AMT.                   08539663
085397     PERFORM D100-PROCESS-NUMERIC-ERRORS.                         08539763
085398     DISPLAY 'MISC CHRG   = ' AP122-ERROR-VALUE.                  08539863
085399                                                                  08539963
085400     MOVE PV-CTL-NET-COST-AMT    TO PV-ERR-AMT.                   08540063
085401     PERFORM D100-PROCESS-NUMERIC-ERRORS.                         08540163
085402     DISPLAY 'NET COST    = ' AP122-ERROR-VALUE.                  08540263
085403                                                                  08540363
085404     MOVE PV-CTL-TERM-DISC-AMT   TO PV-ERR-AMT.                   08540463
085405     PERFORM D100-PROCESS-NUMERIC-ERRORS.                         08540563
085406     DISPLAY 'TERM DISC   = ' AP122-ERROR-VALUE.                  08540663
085407                                                                  08540763
085408     MOVE PV-CTL-NW-STR-DISC-AMT TO PV-ERR-AMT.                   08540863
085409     PERFORM D100-PROCESS-NUMERIC-ERRORS.                         08540963
085410     DISPLAY 'NW STR DISC = ' AP122-ERROR-VALUE.                  08541063
085411                                                                  08541163
085412     MOVE PV-CTL-TRD-DISC-AMT    TO PV-ERR-AMT.                   08541263
085413     PERFORM D100-PROCESS-NUMERIC-ERRORS.                         08541363
085414     DISPLAY 'TRD DISC    = ' AP122-ERROR-VALUE.                  08541463
085415                                                                  08541563
085416     MOVE PV-CTL-MOS-DISC-AMT    TO PV-ERR-AMT.                   08541663
085417     PERFORM D100-PROCESS-NUMERIC-ERRORS.                         08541763
085418     DISPLAY 'MOS DISC    = ' AP122-ERROR-VALUE.                  08541863
085419                                                                  08541963
085420     DISPLAY ' '.                                                 08542063
085421     DISPLAY '* * * * * * * * * * * * * * * * * * * * * * *'.     08542161
085422     DISPLAY ' '.                                                 08542261
085430                                                                  08543061
085500     COMPUTE PV-COUNT-RPT =                                       08550000
085600                        ( PV-COUNT-WARNINGS + PV-COUNT-ERRORS ).  08560000
085700     DISPLAY 'VALID RECORDS PROCESSED   = ' PV-COUNT-CLEAN.       08570000
085800     DISPLAY 'WARNINGS PROCESSED        = ' PV-COUNT-WARNINGS.    08580000
085900     DISPLAY 'ERRORS PROCESSED          = ' PV-COUNT-ERRORS.      08590000
086000     DISPLAY 'TOTAL RECORDS READ        = ' PV-COUNT-READ.        08600000
086100     DISPLAY ' '.                                                 08610000
086200     DISPLAY 'EDITED RECORDS WRITTEN    = ' PV-COUNT-WRITTEN.     08620000
086210     DISPLAY 'DEPT 985 RECORDS SKIPPED  = ' PV-COUNT-DPT985.      08621050
086300     DISPLAY ' '.                                                 08630000
086400     DISPLAY 'ERRORS + WARNINGS WRITTEN = ' PV-COUNT-RPT.         08640000
086800     DISPLAY ' '.                                                 08680000
086900     DISPLAY 'APKUT136 END OF PROCESSING '.                       08690000
087000     DISPLAY '* * * * * * * * * * * * * * * * * * * * * * *'.     08700000
087100                                                                  08710000
087200     CLOSE ADJ-TRANS-FILE                                         08720000
087400           EDITD-TRANS-FILE                                       08740000
087500           ADJ-ERR-EXCPT-FILE.                                    08750000
087600                                                                  08760000
087700                                                                  08770000
087800 C100-RECORD-EDITS.                                               08780000
087900*---------------------------------------------------------------- 08790000
088000*  EDIT ALL FIELDS ON DETAIL RECORDS WITH VALID TRAN CODES.       08800000
088100*---------------------------------------------------------------- 08810000
088200                                                                  08820000
088300     INITIALIZE PS-MDSEAR-SW.                                     08830000
088400                                                                  08840000
088500*  EDIT VND NBR / PO NBR                                          08850000
088600     IF  AP045-PO-NBR = PV-SAVE-PO-NBR                            08860000
088700         CONTINUE                                                 08870000
088800     ELSE                                                         08880000
088900         IF  AP045-PO-NBR = SPACES                                08890000
089000         OR  AP045-PO-NBR = ZERO                                  08900000
089100             INITIALIZE PV-PO-NBR                                 08910000
089200             MOVE AP045-PO-NBR TO PV-SAVE-PO-NBR                  08920000
089300             SET PS-PURCHS-NOT-ENTERED TO TRUE                    08930000
089400         ELSE                                                     08940000
089500             MOVE AP045-PO-NBR TO PV-PO-NBR                       08950000
089600                                  PV-SAVE-PO-NBR                  08960000
089700             PERFORM S700-SELECT-PURCHS                           08970000
089800         END-IF                                                   08980000
089900     END-IF.                                                      08990000
090000                                                                  09000000
090100     IF  AP045-VND-NBR = PV-VND-NBR                               09010000
090200         CONTINUE                                                 09020000
090300     ELSE                                                         09030000
090400         MOVE AP045-VND-NBR TO PV-VND-NBR                         09040000
090500         IF  AP045-VND-NBR = SPACES                               09050000
090600         OR  AP045-VND-NBR = ZEROES                               09060000
090700             SET PS-ENTITY-INVALID TO TRUE                        09070000
090800         ELSE                                                     09080000
090900             PERFORM S300-SELECT-ENTITY                           09090000
091000         END-IF                                                   09100000
091100     END-IF.                                                      09110000
091200                                                                  09120000
091300     IF  PS-ENTITY-VALID                                          09130000
091400         IF  PS-PURCHS-VALID                                      09140000
091810             IF  VALID-FRGT-VND-NBR                               09181038
091900             OR  ( AP045-EXPENSE                                  09190000
092000                   AND (PURCHS-PO-TYP-CDE = 'IM' OR 'IE' OR 'IF'))09200000
092100                 CONTINUE                                         09210000
092200             ELSE                                                 09220000
092300                 IF  EXTENT-ENT-ID = PURCHS-ENT-ID                09230000
092400                     CONTINUE                                     09240000
092500                 ELSE                                             09250000
092600                    IF  PURCHS-PO-TYP-CDE = 'IM' OR 'IE' OR 'IF'  09260000
092700                        SET PS-ERROR-WARNING TO TRUE              09270000
092800                    ELSE                                          09280000
092900                        SET PS-ERROR-FATAL  TO TRUE               09290000
093000                    END-IF                                        09300000
093100                    PERFORM C450-COMMON-ERR-EXCPT-FIELDS          09310000
093200                    STRING AP045-VND-NBR '/' AP045-PO-NBR         09320000
093300                      DELIMITED BY SIZE INTO AP122-ERROR-VALUE    09330000
093400                    END-STRING                                    09340000
093500                    MOVE 'VENDOR/PO NBR' TO AP122-ERROR-FIELD     09350000
093600                    MOVE 'VENDOR NOT ASSOCIATED WITH PO NUMBER'   09360000
093700                      TO AP122-ERROR-MESSAGE                      09370000
093800                    PERFORM W200-WRITE-ERROR-EXCPT-RECORD         09380000
093900                 END-IF                                           09390000
094000             END-IF                                               09400000
094100         END-IF                                                   09410000
094200     ELSE                                                         09420000
094300         SET PS-ERROR-FATAL     TO TRUE                           09430000
094400         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     09440000
094500         MOVE 'VENDOR NUMBER'   TO AP122-ERROR-FIELD              09450000
094600         MOVE AP045-VND-NBR     TO AP122-ERROR-VALUE              09460000
094700         MOVE PC-NOT-FOUND-MSG  TO AP122-ERROR-MESSAGE            09470000
094800         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    09480000
094900     END-IF.                                                      09490000
095000                                                                  09500000
095100* EDIT DOC NBR  (AP045-DOC-NBR/AP045-VND-NBR COMBO)               09510000
095200     IF  AP045-VND-NBR NOT = ADJRNL-VND-NBR                       09520000
095300     OR  AP045-DOC-NBR NOT = ADJRNL-DOC-NBR                       09530000
095400         PERFORM S400-SELECT-VENDOR-TADJRNL                       09540000
095500     END-IF.                                                      09550000
095600     IF  PS-VENDOR-INVALID                                        09560000
095700         SET PS-ERROR-FATAL TO TRUE                               09570000
095800         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     09580000
095900         STRING AP045-VND-NBR '/' AP045-DOC-NBR                   09590000
096000           DELIMITED BY SIZE INTO AP122-ERROR-VALUE               09600000
096100         END-STRING                                               09610000
096200         MOVE 'VENDOR/DOCUMENT NUMBER' TO AP122-ERROR-FIELD       09620000
096300         MOVE PC-DUPLICATES-MSG        TO AP122-ERROR-MESSAGE     09630000
096400         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    09640000
096500     END-IF.                                                      09650000
096600                                                                  09660000
096700* EDIT PO NUMBER                                                  09670000
096800     IF  PS-PURCHS-INVALID                                        09680000
096900         SET PS-ERROR-FATAL     TO TRUE                           09690000
097000         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     09700000
097100         MOVE AP045-PO-NBR      TO AP122-ERROR-VALUE              09710000
097200         MOVE 'PO NUMBER'       TO AP122-ERROR-FIELD              09720000
097300         MOVE PC-NOT-FOUND-MSG  TO AP122-ERROR-MESSAGE            09730000
097400         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    09740000
097500     ELSE                                                         09750000
097600         IF TRNCDE-PO-NBR-REQR-IND = 'Y'                          09760000
097700             IF  PS-PURCHS-NOT-ENTERED                            09770000
097800                 SET PS-ERROR-FATAL    TO TRUE                    09780000
097900                 PERFORM C450-COMMON-ERR-EXCPT-FIELDS             09790000
098000                 MOVE AP045-PO-NBR     TO AP122-ERROR-VALUE       09800000
098100                 MOVE 'PO NUMBER'      TO AP122-ERROR-FIELD       09810000
098200                 MOVE PC-REQUIRED-MSG  TO AP122-ERROR-MESSAGE     09820000
098300                 PERFORM W200-WRITE-ERROR-EXCPT-RECORD            09830000
098400             END-IF                                               09840000
098500         END-IF                                                   09850000
098600     END-IF.                                                      09860000
098700                                                                  09870000
098800     IF AP045-DOC-DTE > AP045-ENTR-DTE                            09880000
098900         SET PS-ERROR-FATAL      TO TRUE                          09890000
099000         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     09900000
099100         MOVE AP045-DOC-DTE      TO AP122-ERROR-VALUE             09910000
099200         MOVE 'DOCUMENT DATE '   TO AP122-ERROR-FIELD             09920000
099300         MOVE 'MUST BE LESS THAN OR EQUAL TO ENTRY DATE'          09930000
099400           TO AP122-ERROR-MESSAGE                                 09940000
099500         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    09950000
099600     END-IF.                                                      09960000
099700                                                                  09970000
099800* EDIT STORE NUMBER                                               09980000
099900     IF AP045-STR-NBR NOT = PV-STORE-NBR                          09990000
100000         MOVE AP045-STR-NBR      TO PV-STORE-NBR                  10000000
100100         PERFORM S800-SELECT-STORE                                10010000
100200         PERFORM X100-COMMIT                                      10020000
100300     END-IF.                                                      10030000
100400     IF PS-STORE-INVALID                                          10040000
100500         SET PS-ERROR-FATAL      TO TRUE                          10050000
100600         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     10060000
100700         MOVE AP045-STR-NBR      TO AP122-ERROR-VALUE             10070000
100800         MOVE 'STORE NUMBER'     TO AP122-ERROR-FIELD             10080000
100900         MOVE PC-NOT-FOUND-MSG   TO AP122-ERROR-MESSAGE           10090000
101000         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    10100000
101100     END-IF.                                                      10110000
101200                                                                  10120000
101300     IF AP045-TRN-TYP-CDE NOT = TRNCDE-TRN-TYP-CDE                10130000
101400         SET PS-ERROR-FATAL      TO TRUE                          10140000
101500         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     10150000
101600         MOVE AP045-TRN-TYP-CDE  TO AP122-ERROR-VALUE             10160000
101700         MOVE 'TRN TYP CDE '     TO AP122-ERROR-FIELD             10170000
101800         MOVE PC-NOT-FOUND-MSG   TO AP122-ERROR-MESSAGE           10180000
101900         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    10190000
102000     END-IF.                                                      10200000
102100                                                                  10210000
102200     IF AP045-EXPENSE                                             10220000
102300         PERFORM C150-EDIT-EXPENSE-TRANS                          10230000
102400     ELSE                                                         10240000
102500         IF AP045-MERCHANDISE                                     10250000
102600             PERFORM C175-EDIT-MERCHANDISE-TRANS                  10260000
102700         ELSE                                                     10270000
102800             SET PS-ERROR-FATAL     TO TRUE                       10280000
102900             PERFORM C450-COMMON-ERR-EXCPT-FIELDS                 10290000
103000             MOVE AP045-TRN-TYP-CDE TO AP122-ERROR-VALUE          10300000
103100             MOVE 'TRN TYP CDE '    TO AP122-ERROR-FIELD          10310000
103200             MOVE 'NO DATA EDITS AVAILABLE FOR THIS TRN TYP CDE'  10320000
103300               TO AP122-ERROR-MESSAGE                             10330000
103400             PERFORM W200-WRITE-ERROR-EXCPT-RECORD                10340000
103500         END-IF                                                   10350000
103600     END-IF.                                                      10360000
103700                                                                  10370000
103800     IF AP045-PSTG-TYP-CDE NOT = TRNCDE-PSTG-TYP-CDE              10380000
103900         SET PS-ERROR-FATAL      TO TRUE                          10390000
104000         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     10400000
104100         MOVE AP045-PSTG-TYP-CDE TO AP122-ERROR-VALUE             10410000
104200         MOVE 'POSTING TYP CDE ' TO AP122-ERROR-FIELD             10420000
104300         MOVE PC-NOT-FOUND-MSG   TO AP122-ERROR-MESSAGE           10430000
104400         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    10440000
104500     END-IF.                                                      10450000
104600                                                                  10460000
104700***  IF  AP045-ENTR-ID = 'APKUT301'                               10470000
104800     IF  AP045-ENTR-ID = 'APKUT095'                               10480000
104900***  OR  AP045-ENTR-ID = 'APKUT095'                               10490000
105000***  OR  AP045-ENTR-ID = 'APKUT337'                               10500000
105100         CONTINUE                                                 10510000
105200     ELSE                                                         10520000
105300         MOVE APCNTL-BTCH-PRC-DTE    TO AP045-ENTR-DTE            10530000
105400                                        AP045-PS-BTCH-DTE         10540000
105500     END-IF.                                                      10550000
105600                                                                  10560000
105700     MOVE AP045-ENTR-TME         TO PV-DB2-TIME-FORMAT.           10570000
105800     IF  PV-DB2-TIME-DASH NOT = '-'                               10580000
105900     OR  PV-DB2-TIME-PERIOD1 NOT = '.'                            10590000
106000     OR  PV-DB2-TIME-PERIOD2 NOT = '.'                            10600000
106100     OR  PV-DB2-TIME-PERIOD3 NOT = '.'                            10610000
106200     OR  PV-DB2-TIME-HH NOT NUMERIC                               10620000
106300     OR  PV-DB2-TIME-MM NOT NUMERIC                               10630000
106400     OR  PV-DB2-TIME-SS NOT NUMERIC                               10640000
106500     OR  PV-DB2-TIME-REM NOT NUMERIC                              10650000
106600         SET PS-ERROR-FATAL      TO TRUE                          10660000
106700         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     10670000
106800         MOVE AP045-ENTR-TME     TO AP122-ERROR-VALUE             10680000
106900         MOVE 'ENTRY TIME'       TO AP122-ERROR-FIELD             10690000
107000         MOVE 'DATA NOT FORMATED AS -99.99.99.999999'             10700000
107100           TO AP122-ERROR-MESSAGE                                 10710000
107200         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    10720000
107300     END-IF.                                                      10730000
107400                                                                  10740000
107500     IF AP045-ENTR-ID = SPACES                                    10750000
107600         SET PS-ERROR-FATAL      TO TRUE                          10760000
107700         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     10770000
107800         MOVE AP045-ENTR-ID      TO AP122-ERROR-VALUE             10780000
107900         MOVE 'ENTRY ID '        TO AP122-ERROR-FIELD             10790000
108000         MOVE PC-REQUIRED-MSG    TO AP122-ERROR-MESSAGE           10800000
108100         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    10810000
108200     END-IF.                                                      10820000
108300                                                                  10830000
108400     IF NOT AP045-ORGN-VALID                                      10840000
108500         SET PS-ERROR-FATAL      TO TRUE                          10850000
108600         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     10860000
108700         MOVE AP045-ORGN-CDE     TO AP122-ERROR-VALUE             10870000
108800         MOVE 'ORIGIN CODE '     TO AP122-ERROR-FIELD             10880000
108900         MOVE PC-INVALID-MSG     TO AP122-ERROR-MESSAGE           10890000
109000         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    10900000
109100     END-IF.                                                      10910000
109200                                                                  10920000
109300* EDIT INVOICE CUTOFF DATE                                        10930000
109400     INITIALIZE DPG51, DPG52, DPG53,                              10940000
109500                DPG54, DPG55, DPG56.                              10950000
109600     MOVE AP045-INV-CUTOFF-DTE   TO DPG52-LK-DATE-INPUT           10960000
109700                                                                  10970000
109800     SET DPG51-ACTUAL-CALENDAR-ONLY                               10980000
109900         DPG51-DO-NOT-INCR-DECR-DATE                              10990000
110000         DPG52-LK-DTE-ISO-FMT    TO TRUE.                         11000000
110100                                                                  11010000
110200     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    11020000
110300                                             DPG54 DPG55 DPG56.   11030000
110400                                                                  11040000
110500     IF DPG54-SEVERE-ERROR                                        11050000
110600         DISPLAY '* SEVERE ERROR OCCURRED IN DPKUT500 '           11060000
110700         DISPLAY '* DATE ROUTINE ERROR ON AP045-INV-CUTOFF-DTE =' 11070000
110800                                          AP045-INV-CUTOFF-DTE    11080000
110900         PERFORM Z998-ABEND                                       11090000
111000     END-IF.                                                      11100000
111100     IF DPG54-WARNING-ERROR                                       11110000
111200         SET PS-ERROR-FATAL         TO TRUE                       11120000
111300         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     11130000
111400         MOVE AP045-INV-CUTOFF-DTE  TO AP122-ERROR-VALUE          11140000
111500         MOVE 'INVOICE CUTOFF DATE' TO AP122-ERROR-FIELD          11150000
111600         MOVE PC-INVALID-MSG        TO AP122-ERROR-MESSAGE        11160000
111700         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    11170000
111800     END-IF.                                                      11180000
111900                                                                  11190000
112000* EDIT PEOPLESOFT BATCH NUMBER                                    11200000
112100     IF  AP045-PS-BTCH-SRC-CDE NOT = TRNCDE-BTCH-SRC-CDE          11210000
112200     OR  AP045-PS-BTCH-SEQ-NBR NOT = ZEROES                       11220000
112300         SET PS-ERROR-FATAL      TO TRUE                          11230000
112400         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     11240000
112500         MOVE AP045-PS-BTCH-NBR  TO AP122-ERROR-VALUE             11250000
112600         MOVE 'PS BATCH NUMBER'  TO AP122-ERROR-FIELD             11260000
112700         MOVE PC-INVALID-MSG     TO AP122-ERROR-MESSAGE           11270000
112800         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    11280000
112900     END-IF.                                                      11290000
113000                                                                  11300000
113100* EDIT AP045-ENT-ID                                               11310000
113200     IF  PS-ENTITY-INVALID                                        11320000
113300     OR  AP045-ENT-ID NOT = EXTENT-ENT-ID                         11330000
113400         SET PS-ERROR-FATAL      TO TRUE                          11340000
113500         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     11350000
113600         MOVE AP045-ENT-ID       TO AP122-ERROR-VALUE             11360000
113700         MOVE 'ENTITY ID '       TO AP122-ERROR-FIELD             11370000
113800         MOVE PC-NOT-FOUND-MSG   TO AP122-ERROR-MESSAGE           11380000
113900         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    11390000
114000     END-IF.                                                      11400000
114100                                                                  11410000
114200* EDIT AP045-NME-DESC                                             11420000
114300     IF  PS-ENTITY-INVALID                                        11430000
114400     OR  AP045-ENT-NME-DESC NOT = ENTNME-ENT-NAME-DESC            11440000
114500         SET PS-ERROR-FATAL      TO TRUE                          11450000
114600         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     11460000
114700         MOVE AP045-ENT-NME-DESC TO AP122-ERROR-VALUE             11470000
114800         MOVE 'ENTITY NAME'      TO AP122-ERROR-FIELD             11480000
114900         MOVE PC-NOT-FOUND-MSG   TO AP122-ERROR-MESSAGE           11490000
115000         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    11500000
115100     END-IF.                                                      11510000
115200                                                                  11520000
115300     IF  TRNCDE-RSN-TXT-REQR-IND = 'Y'                            11530000
115400     AND AP045-RSN-1ST-LNE-TXT = SPACES                           11540000
115500         SET PS-ERROR-FATAL          TO TRUE                      11550000
115600         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     11560000
115700         MOVE AP045-RSN-1ST-LNE-TXT  TO AP122-ERROR-VALUE         11570000
115800         MOVE 'REASON TEXT '         TO AP122-ERROR-FIELD         11580000
115900         MOVE PC-REQUIRED-MSG        TO AP122-ERROR-MESSAGE       11590000
116000         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    11600000
116100     END-IF.                                                      11610000
116200                                                                  11620000
116300     IF AP045-TERM-DISC-PCT NOT NUMERIC                           11630000
116400         SET PS-ERROR-FATAL       TO TRUE                         11640000
116500         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     11650000
116600         MOVE AP045-TERM-DISC-PCT TO PV-ERR-PCT-DIS               11660000
116700         MOVE PV-ERR-PCT-NUM-DIS  TO AP122-ERROR-VALUE            11670000
116800         MOVE 'TERM DISC PCT '    TO AP122-ERROR-FIELD            11680000
116900         MOVE PC-NOT-NUM-MSG      TO AP122-ERROR-MESSAGE          11690000
117000         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    11700000
117100     END-IF.                                                      11710000
117200                                                                  11720000
117300     IF AP045-NW-STR-DISC-PCT NOT NUMERIC                         11730000
117400         SET PS-ERROR-FATAL         TO TRUE                       11740000
117500         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     11750000
117600         MOVE AP045-NW-STR-DISC-PCT TO PV-ERR-PCT-DIS             11760000
117700         MOVE PV-ERR-PCT-NUM-DIS    TO AP122-ERROR-VALUE          11770000
117800         MOVE 'NW STR DISC PCT'     TO AP122-ERROR-FIELD          11780000
117900         MOVE PC-NOT-NUM-MSG        TO AP122-ERROR-MESSAGE        11790000
118000         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    11800000
118100     END-IF.                                                      11810000
118200                                                                  11820000
118300     IF AP045-TRD-DISC-PCT NOT NUMERIC                            11830000
118400         SET PS-ERROR-FATAL      TO TRUE                          11840000
118500         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     11850000
118600         MOVE AP045-TRD-DISC-PCT TO PV-ERR-PCT-DIS                11860000
118700         MOVE PV-ERR-PCT-NUM-DIS TO AP122-ERROR-VALUE             11870000
118800         MOVE 'TRD DISC PCT '    TO AP122-ERROR-FIELD             11880000
118900         MOVE PC-NOT-NUM-MSG     TO AP122-ERROR-MESSAGE           11890000
119000         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    11900000
119100     END-IF.                                                      11910000
119200                                                                  11920000
119300     IF AP045-MOS-DISC-PCT NOT NUMERIC                            11930000
119400         SET PS-ERROR-FATAL      TO TRUE                          11940000
119500         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     11950000
119600         MOVE AP045-MOS-DISC-PCT TO PV-ERR-PCT-DIS                11960000
119700         MOVE PV-ERR-PCT-NUM-DIS TO AP122-ERROR-VALUE             11970000
119800         MOVE 'MOS DISC PCT'     TO AP122-ERROR-FIELD             11980000
119900         MOVE PC-NOT-NUM-MSG     TO AP122-ERROR-MESSAGE           11990000
120000         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    12000000
120100     END-IF.                                                      12010000
120200                                                                  12020000
120300* EDIT GROSS COST AMT                                             12030000
120400     IF AP045-GRO-COST-AMT NOT NUMERIC                            12040000
120500         SET PS-ERROR-FATAL       TO TRUE                         12050000
120600         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     12060000
120700         MOVE AP045-GRO-COST-AMT  TO PV-ERR-NUM-DIS               12070000
120800         MOVE PV-ERR-DIS          TO AP122-ERROR-VALUE            12080000
120900         MOVE 'GROSS COST AMOUNT' TO AP122-ERROR-FIELD            12090000
121000         MOVE PC-NOT-NUM-MSG      TO AP122-ERROR-MESSAGE          12100000
121100         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    12110000
121200     ELSE                                                         12120000
121300         IF TRNCDE-COST-PRCCTL-CDE = 'N'                          12130000
121400           AND AP045-GRO-COST-AMT NOT = ZEROES                    12140000
121500             SET PS-ERROR-FATAL       TO TRUE                     12150000
121600             PERFORM C450-COMMON-ERR-EXCPT-FIELDS                 12160000
121700             MOVE AP045-GRO-COST-AMT  TO PV-ERR-AMT               12170000
121800             PERFORM D100-PROCESS-NUMERIC-ERRORS                  12180000
121900             MOVE 'GROSS COST AMOUNT' TO AP122-ERROR-FIELD        12190000
122000             MOVE 'NOT ALLOWED, FOUND ON INPUT'                   12200000
122100               TO AP122-ERROR-MESSAGE                             12210000
122200             PERFORM W200-WRITE-ERROR-EXCPT-RECORD                12220000
122300         END-IF                                                   12230000
122400         IF TRNCDE-COST-PRCCTL-CDE = 'R' AND                      12240000
122500           (AP045-GRO-COST-AMT  = ZEROES AND                      12250000
122600            AP045-FRGT-AMT      = ZEROES AND                      12260000
122700            AP045-MISC-CHRG-AMT = ZEROES)                         12270000
122800             SET PS-ERROR-FATAL          TO TRUE                  12280000
122900             PERFORM C450-COMMON-ERR-EXCPT-FIELDS                 12290000
123000             MOVE AP045-GRO-COST-AMT     TO PV-ERR-AMT            12300000
123100             PERFORM D100-PROCESS-NUMERIC-ERRORS                  12310000
123200             MOVE 'GROSS / FRGT / MISC CHRG '                     12320000
123300               TO AP122-ERROR-FIELD                               12330000
123400             MOVE PC-ONE-AMT-REQUIRED-MSG TO AP122-ERROR-MESSAGE  12340000
123500             PERFORM W200-WRITE-ERROR-EXCPT-RECORD                12350000
123600         END-IF                                                   12360000
123700         IF TRNCDE-PSTG-TYP-CDE = 'CR'                            12370000
123800           AND AP045-GRO-COST-AMT > ZEROES                        12380000
123900           AND ( TRNCDE-COST-PRCCTL-CDE = 'R'                     12390000
124000                OR TRNCDE-COST-PRCCTL-CDE = 'A' )                 12400000
124100             SET PS-ERROR-FATAL       TO TRUE                     12410000
124200             PERFORM C450-COMMON-ERR-EXCPT-FIELDS                 12420000
124300             MOVE AP045-GRO-COST-AMT  TO PV-ERR-AMT               12430000
124400             PERFORM D100-PROCESS-NUMERIC-ERRORS                  12440000
124500             MOVE 'GROSS COST AMOUNT' TO AP122-ERROR-FIELD        12450000
124600             MOVE 'POSITIVE AMT INVALID FOR CREDIT'               12460000
124700               TO AP122-ERROR-MESSAGE                             12470000
124800             PERFORM W200-WRITE-ERROR-EXCPT-RECORD                12480000
124900         END-IF                                                   12490000
125000         IF TRNCDE-PSTG-TYP-CDE = 'CH'                            12500000
125100           AND AP045-GRO-COST-AMT < ZEROES                        12510000
125200           AND ( TRNCDE-COST-PRCCTL-CDE = 'R'                     12520000
125300                OR TRNCDE-COST-PRCCTL-CDE = 'A' )                 12530000
125400             SET PS-ERROR-FATAL       TO TRUE                     12540000
125500             PERFORM C450-COMMON-ERR-EXCPT-FIELDS                 12550000
125600             MOVE AP045-GRO-COST-AMT  TO PV-ERR-AMT               12560000
125700             PERFORM D100-PROCESS-NUMERIC-ERRORS                  12570000
125800             MOVE 'GROSS COST AMOUNT' TO AP122-ERROR-FIELD        12580000
125900             MOVE 'NEGATIVE AMT INVALID FOR CHARGE'               12590000
126000               TO AP122-ERROR-MESSAGE                             12600000
126100             PERFORM W200-WRITE-ERROR-EXCPT-RECORD                12610000
126200         END-IF                                                   12620000
126300     END-IF.                                                      12630000
126400                                                                  12640000
126500* EDIT FRGT AMT                                                   12650000
126600     IF AP045-FRGT-AMT NOT NUMERIC                                12660000
126700         SET PS-ERROR-FATAL      TO TRUE                          12670000
126800         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     12680000
126900         MOVE AP045-FRGT-AMT     TO PV-ERR-NUM-DIS                12690000
127000         MOVE PV-ERR-DIS         TO AP122-ERROR-VALUE             12700000
127100         MOVE 'FREIGHT AMOUNT'   TO AP122-ERROR-FIELD             12710000
127200         MOVE PC-NOT-NUM-MSG     TO AP122-ERROR-MESSAGE           12720000
127300         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    12730000
127400     ELSE                                                         12740000
127500         IF TRNCDE-FRGT-REQR-IND = 'Y'                            12750000
127600             IF AP045-FRGT-AMT = ZEROES                           12760000
127700                 SET PS-ERROR-FATAL   TO TRUE                     12770000
127800                 PERFORM C450-COMMON-ERR-EXCPT-FIELDS             12780000
127900                 MOVE AP045-FRGT-AMT  TO PV-ERR-AMT               12790000
128000                 PERFORM D100-PROCESS-NUMERIC-ERRORS              12800000
128100                 MOVE 'FREIGHT AMOUNT' TO AP122-ERROR-FIELD       12810000
128200                 MOVE PC-REQUIRED-MSG  TO AP122-ERROR-MESSAGE     12820000
128300                 PERFORM W200-WRITE-ERROR-EXCPT-RECORD            12830000
128400             END-IF                                               12840000
128500             IF TRNCDE-PSTG-TYP-CDE = 'CR'                        12850000
128600               AND AP045-FRGT-AMT > ZEROES                        12860000
128700                 SET PS-ERROR-FATAL    TO TRUE                    12870000
128800                 PERFORM C450-COMMON-ERR-EXCPT-FIELDS             12880000
128900                 MOVE AP045-FRGT-AMT   TO PV-ERR-AMT              12890000
129000                 PERFORM D100-PROCESS-NUMERIC-ERRORS              12900000
129100                 MOVE 'FREIGHT AMOUNT' TO AP122-ERROR-FIELD       12910000
129200                 MOVE 'POSITIVE AMT INVALID FOR CREDIT'           12920000
129300                   TO AP122-ERROR-MESSAGE                         12930000
129400                 PERFORM W200-WRITE-ERROR-EXCPT-RECORD            12940000
129500             END-IF                                               12950000
129600             IF TRNCDE-PSTG-TYP-CDE = 'CH'                        12960000
129700               AND AP045-FRGT-AMT < ZEROES                        12970000
129800                 SET PS-ERROR-FATAL    TO TRUE                    12980000
129900                 PERFORM C450-COMMON-ERR-EXCPT-FIELDS             12990000
130000                 MOVE AP045-FRGT-AMT   TO PV-ERR-AMT              13000000
130100                 PERFORM D100-PROCESS-NUMERIC-ERRORS              13010000
130200                 MOVE 'FREIGHT AMOUNT' TO AP122-ERROR-FIELD       13020000
130300                 MOVE 'NEGATIVE AMT INVALID FOR CHARGE'           13030000
130400                   TO AP122-ERROR-MESSAGE                         13040000
130500                 PERFORM W200-WRITE-ERROR-EXCPT-RECORD            13050000
130600             END-IF                                               13060000
130700         END-IF                                                   13070000
130800     END-IF.                                                      13080000
130900                                                                  13090000
131000* EDIT MISC CHRG AMT                                              13100000
131100     IF AP045-MISC-CHRG-AMT NOT NUMERIC                           13110000
131200         SET PS-ERROR-FATAL       TO TRUE                         13120000
131300         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     13130000
131400         MOVE AP045-MISC-CHRG-AMT  TO PV-ERR-NUM-DIS              13140000
131500         MOVE PV-ERR-DIS           TO AP122-ERROR-VALUE           13150000
131600         MOVE 'MISC CHARGE AMOUNT' TO AP122-ERROR-FIELD           13160000
131700         MOVE PC-NOT-NUM-MSG       TO AP122-ERROR-MESSAGE         13170000
131800         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    13180000
131900     ELSE                                                         13190000
132000         IF TRNCDE-PSTG-TYP-CDE = 'CR'                            13200000
132100           AND AP045-MISC-CHRG-AMT > ZEROES                       13210000
132200             SET PS-ERROR-FATAL        TO TRUE                    13220000
132300             PERFORM C450-COMMON-ERR-EXCPT-FIELDS                 13230000
132400             MOVE AP045-MISC-CHRG-AMT  TO PV-ERR-AMT              13240000
132500             PERFORM D100-PROCESS-NUMERIC-ERRORS                  13250000
132600             MOVE 'MISC CHARGE AMOUNT' TO AP122-ERROR-FIELD       13260000
132700             MOVE 'POSITIVE AMT INVALID FOR CREDIT'               13270000
132800               TO AP122-ERROR-MESSAGE                             13280000
132900             PERFORM W200-WRITE-ERROR-EXCPT-RECORD                13290000
133000         END-IF                                                   13300000
133100         IF TRNCDE-PSTG-TYP-CDE = 'CH'                            13310000
133200           AND AP045-MISC-CHRG-AMT < ZEROES                       13320000
133300             SET PS-ERROR-FATAL        TO TRUE                    13330000
133400             PERFORM C450-COMMON-ERR-EXCPT-FIELDS                 13340000
133500             MOVE AP045-MISC-CHRG-AMT  TO PV-ERR-AMT              13350000
133600             PERFORM D100-PROCESS-NUMERIC-ERRORS                  13360000
133700             MOVE 'MISC CHARGE AMOUNT' TO AP122-ERROR-FIELD       13370000
133800             MOVE 'NEGATIVE AMT INVALID FOR CHARGE'               13380000
133900               TO AP122-ERROR-MESSAGE                             13390000
134000             PERFORM W200-WRITE-ERROR-EXCPT-RECORD                13400000
134100         END-IF                                                   13410000
134200     END-IF.                                                      13420000
134300                                                                  13430000
134400* EDIT TERM DISC AMT                                              13440000
134500     IF AP045-DTL-TERM-DISC-AMT NOT NUMERIC                       13450000
134600         SET PS-ERROR-FATAL            TO TRUE                    13460000
134700         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     13470000
134800         MOVE AP045-DTL-TERM-DISC-AMT  TO PV-ERR-NUM-DIS          13480000
134900         MOVE PV-ERR-DIS               TO AP122-ERROR-VALUE       13490000
135000         MOVE 'TERM DISCOUNT AMOUNT'   TO AP122-ERROR-FIELD       13500000
135100         MOVE PC-NOT-NUM-MSG           TO AP122-ERROR-MESSAGE     13510000
135200         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    13520000
135300     END-IF.                                                      13530000
135400                                                                  13540000
135500* EDIT NEW STORE DISC AMT                                         13550000
135600     IF AP045-DTL-NW-STR-DISC-AMT NOT NUMERIC                     13560000
135700         SET PS-ERROR-FATAL               TO TRUE                 13570000
135800         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     13580000
135900         MOVE AP045-DTL-NW-STR-DISC-AMT   TO PV-ERR-NUM-DIS       13590000
136000         MOVE PV-ERR-DIS                  TO AP122-ERROR-VALUE    13600000
136100         MOVE 'NEW STORE DISCOUNT AMOUNT' TO AP122-ERROR-FIELD    13610000
136200         MOVE PC-NOT-NUM-MSG              TO AP122-ERROR-MESSAGE  13620000
136300         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    13630000
136400     END-IF.                                                      13640000
136500                                                                  13650000
136600* EDIT TRD DISC AMT                                               13660000
136700     IF AP045-DTL-TRD-DISC-AMT NOT NUMERIC                        13670000
136800         SET PS-ERROR-FATAL          TO TRUE                      13680000
136900         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     13690000
137000         MOVE AP045-DTL-TRD-DISC-AMT TO PV-ERR-NUM-DIS            13700000
137100         MOVE PV-ERR-DIS             TO AP122-ERROR-VALUE         13710000
137200         MOVE 'TRD DISCOUNT AMOUNT'  TO AP122-ERROR-FIELD         13720000
137300         MOVE PC-NOT-NUM-MSG         TO AP122-ERROR-MESSAGE       13730000
137400         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    13740000
137500     END-IF.                                                      13750000
137600                                                                  13760000
137700* EDIT MOS DISC AMT                                               13770000
137800     IF AP045-DTL-MOS-DISC-AMT NOT NUMERIC                        13780000
137900         SET PS-ERROR-FATAL           TO TRUE                     13790000
138000         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     13800000
138100         MOVE AP045-DTL-MOS-DISC-AMT  TO PV-ERR-NUM-DIS           13810000
138200         MOVE PV-ERR-DIS              TO AP122-ERROR-VALUE        13820000
138300         MOVE 'MARK OUT OF STOCK DISCOUNT AMOUNT'                 13830000
138400           TO AP122-ERROR-FIELD                                   13840000
138500         MOVE PC-NOT-NUM-MSG          TO AP122-ERROR-MESSAGE      13850000
138600         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    13860000
138700     END-IF.                                                      13870000
138800                                                                  13880000
138900                                                                  13890000
139000* EDIT NET COST AMT                                               13900000
139100     IF AP045-NET-COST-AMT NOT = ( AP045-GRO-COST-AMT +           13910000
139200       AP045-FRGT-AMT + AP045-MISC-CHRG-AMT -                     13920000
139300       AP045-DTL-TERM-DISC-AMT - AP045-DTL-NW-STR-DISC-AMT -      13930000
139400       AP045-DTL-TRD-DISC-AMT  - AP045-DTL-MOS-DISC-AMT )         13940000
139500         SET PS-ERROR-FATAL      TO TRUE                          13950000
139600         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     13960000
139700         MOVE AP045-NET-COST-AMT TO PV-ERR-AMT                    13970000
139800         PERFORM D100-PROCESS-NUMERIC-ERRORS                      13980000
139900         MOVE 'NET COST AMOUNT'  TO AP122-ERROR-FIELD             13990000
140000         MOVE '<> GROSS + FRGT + MISC - (TERM + NW STR + TRD)DISC'14000000
140100           TO AP122-ERROR-MESSAGE                                 14010000
140200         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    14020000
140300     END-IF.                                                      14030000
140400                                                                  14040000
140500*PRB0053229 START                                                 14050029
140600     IF AP045-NET-COST-AMT = 0 AND TRNCDE-AP-PSTG-IND = 'Y'       14060033
140700        SET PS-ERROR-FATAL TO TRUE                                14070032
140800            PERFORM C450-COMMON-ERR-EXCPT-FIELDS                  14080032
140900            MOVE AP045-NET-COST-AMT TO PV-ERR-AMT                 14090032
141000            PERFORM D100-PROCESS-NUMERIC-ERRORS                   14100032
141100            MOVE 'NET COST AMOUNT' TO AP122-ERROR-FIELD           14110032
141200            MOVE PC-NET-COST-ZERO TO AP122-ERROR-MESSAGE          14120032
141300            PERFORM W200-WRITE-ERROR-EXCPT-RECORD                 14130032
141400     END-IF.                                                      14140032
141500*PRB0053229 END                                                   14150029
144900                                                                  14490029
145000* EDIT PAYMENT DUE DATE                                           14500000
145100     IF AP045-PYMT-DUE-DTE = SPACES OR LOW-VALUES                 14510000
145200        MOVE AP045-ENTR-DTE TO AP045-PYMT-DUE-DTE                 14520000
145300     ELSE                                                         14530000
145400        IF AP045-PYMT-DUE-DTE NOT = SPACES                        14540000
145500        AND AP045-PYMT-DUE-DTE NOT = LOW-VALUES                   14550000
145600          INITIALIZE DPG51, DPG52, DPG53,                         14560000
145700                     DPG54, DPG55, DPG56                          14570000
145800          MOVE AP045-PYMT-DUE-DTE    TO DPG52-LK-DATE-INPUT       14580000
145900                                                                  14590000
146000          SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE                 14600000
146100          SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE                 14610000
146200          SET DPG52-LK-DTE-ISO-FMT        TO TRUE                 14620000
146300                                                                  14630000
146400          CALL DP500-KOHLS-CALENDAR-ROUTINE                       14640000
146500                                       USING DPG51 DPG52 DPG53    14650000
146600                                             DPG54 DPG55 DPG56    14660000
146700                                                                  14670000
146800          IF (DPG54-SEVERE-ERROR OR DPG54-WARNING-ERROR)          14680000
146900             SET PS-ERROR-FATAL       TO TRUE                     14690000
147000             PERFORM C450-COMMON-ERR-EXCPT-FIELDS                 14700000
147100             MOVE AP045-PYMT-DUE-DTE  TO AP122-ERROR-VALUE        14710000
147200             MOVE 'PAYMENT DUE DATE'  TO AP122-ERROR-FIELD        14720000
147300             MOVE PC-INVALID-MSG      TO AP122-ERROR-MESSAGE      14730000
147400             PERFORM W200-WRITE-ERROR-EXCPT-RECORD                14740000
147500          END-IF.                                                 14750000
147600                                                                  14760000
147700* EDIT DOCUMENT DATE                                              14770000
147800     INITIALIZE DPG51, DPG52, DPG53,                              14780000
147900                DPG54, DPG55, DPG56.                              14790000
148000     MOVE AP045-DOC-DTE          TO DPG52-LK-DATE-INPUT           14800000
148100                                                                  14810000
148200     SET DPG51-ACTUAL-CALENDAR-ONLY                               14820000
148300         DPG51-DO-NOT-INCR-DECR-DATE                              14830000
148400         DPG52-LK-DTE-ISO-FMT    TO TRUE.                         14840000
148500                                                                  14850000
148600     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    14860000
148700                                             DPG54 DPG55 DPG56.   14870000
148800                                                                  14880000
148900     IF DPG54-SEVERE-ERROR                                        14890000
149000         DISPLAY '* SEVERE ERROR OCCURRED IN DPKUT500 '           14900000
149100         DISPLAY '* DATE ROUTINE ERROR ON AP045-DOC-DTE ='        14910000
149200                                          AP045-DOC-DTE           14920000
149300         PERFORM Z998-ABEND                                       14930000
149400     END-IF.                                                      14940000
149500     IF DPG54-WARNING-ERROR                                       14950000
149600         SET PS-ERROR-FATAL         TO TRUE                       14960000
149700         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     14970000
149800         MOVE AP045-DOC-DTE         TO AP122-ERROR-VALUE          14980000
149900         MOVE 'DOCUMENT DATE'       TO AP122-ERROR-FIELD          14990000
150000         MOVE PC-INVALID-MSG        TO AP122-ERROR-MESSAGE        15000000
150100         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    15010000
150200     END-IF.                                                      15020000
150300                                                                  15030000
150400                                                                  15040000
150500 C150-EDIT-EXPENSE-TRANS.                                         15050000
150600*---------------------------------------------------------------- 15060000
150700*  EDIT EXPENSE TRANSACTIONS FOR SPECIFIC DATA.                   15070000
150800*---------------------------------------------------------------- 15080000
150900                                                                  15090000
151000*  EDIT GL ACCOUNT NBR OF PEOPLESOFT GL ACCOUNT TABLE             15100000
151100     IF AP045-GL-ACCT-NBR = SPACES                                15110064
151200         SET PS-ERROR-FATAL          TO TRUE                      15120000
151300         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     15130000
151400         MOVE AP045-GL-ACCT-NBR      TO AP122-ERROR-VALUE         15140000
151500         MOVE 'GL ACCOUNT NBR'       TO AP122-ERROR-FIELD         15150000
151600         MOVE 'REQUIRED FOR EXPENSE, NOT FOUND ON INPUT'          15160000
151700           TO AP122-ERROR-MESSAGE                                 15170000
151800         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    15180000
151900     ELSE                                                         15190000
152100         PERFORM S500-SELECT-GL-ACCOUNT-NBR                       15210041
152300         IF PV-GL-ACCOUNT-INVALID                                 15230000
152400             SET PS-ERROR-FATAL       TO TRUE                     15240000
152500             PERFORM C450-COMMON-ERR-EXCPT-FIELDS                 15250000
152600             MOVE AP045-GL-ACCT-NBR   TO AP122-ERROR-VALUE        15260000
152700             MOVE 'PS GL ACCOUNT NBR' TO AP122-ERROR-FIELD        15270000
152800             MOVE PC-NOT-FOUND-MSG    TO AP122-ERROR-MESSAGE      15280000
152900             PERFORM W200-WRITE-ERROR-EXCPT-RECORD                15290000
153000         ELSE                                                     15300000
153100             IF TRNCDE-GL-ACCT-NBR NOT = SPACES                   15310000
153200               AND PV-GL-ACCT-ACCOUNT NOT = TRNCDE-GL-ACCT-NBR    15320000
153300                 SET PS-ERROR-FATAL       TO TRUE                 15330000
153400                 PERFORM C450-COMMON-ERR-EXCPT-FIELDS             15340000
153500                 MOVE AP045-GL-ACCT-NBR   TO AP122-ERROR-VALUE    15350000
153600                 MOVE 'PS GL ACCOUNT NBR' TO AP122-ERROR-FIELD    15360000
153700                 MOVE 'TRNCDE NOT EQUAL TO GL ACCOUNT TBL'        15370000
153800                   TO AP122-ERROR-MESSAGE                         15380000
153900                 PERFORM W200-WRITE-ERROR-EXCPT-RECORD            15390000
154000             END-IF                                               15400000
154100         END-IF                                                   15410000
154200     END-IF.                                                      15420000
154300                                                                  15430000
154400*----------------------------------------------------------------*15440000
154500* THIS WAS CODED BUT NOT IMPLEMENTED FOR INC000000548165.         15450000
154600* BUSINESS RULES FOR THIS NEED TO BE REFINED BEFORE ENFORCING.    15460000
154700* LOGIC HAS BEEN IMPLEMENTED WITH WR35892.                        15470000
154800*----------------------------------------------------------------*15480000
154900* VALIDATE LOCATION TYPE FOR A EXPENSE TRANS IS HQ                15490000
155000*    IF  XFT00017-LOC-TYP-CDE NOT EQUAL 'HQ'                      15500000
155100*        SET PS-ERROR-FATAL       TO TRUE                         15510000
155200*        PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     15520000
155300*        MOVE AP045-STR-NBR       TO AP122-ERROR-VALUE            15530000
155400*        MOVE 'STORE NUMBER '     TO AP122-ERROR-FIELD            15540000
155500*        MOVE PC-EXP-LOCATION-MSG TO AP122-ERROR-MESSAGE          15550000
155600*        PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    15560000
155700*    END-IF.                                                      15570000
155800                                                                  15580000
155900* EDIT DEPT NBR FOR AN EXPENSE                                    15590000
156000     IF AP045-DEPT-NBR = SPACES AND                               15600072
156010        AP045-ENTR-ID  = 'DAKUT301'                               15601072
156100         IF NOT PS-ERROR-FATAL                                    15610000
156200             SET PS-ERROR-WARNING    TO TRUE                      15620000
156300         END-IF                                                   15630000
156400         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     15640000
156500         MOVE AP045-DEPT-NBR         TO AP122-ERROR-VALUE         15650000
156600         MOVE 'DEPARTMENT NBR'       TO AP122-ERROR-FIELD         15660000
156700         MOVE PC-EXPENSE-WARNING     TO AP122-ERROR-MESSAGE       15670000
156800         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    15680000
156900     END-IF.                                                      15690000
157000                                                                  15700000
157100* EDIT CLASS NUMBER FOR AN EXPENSE                                15710000
157200     IF AP045-CL-NBR   = SPACES AND                               15720072
157210        AP045-ENTR-ID  = 'DAKUT301'                               15721072
157300         IF NOT PS-ERROR-FATAL                                    15730069
157400             SET PS-ERROR-WARNING    TO TRUE                      15740069
157500         END-IF                                                   15750069
157600         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     15760069
157700         MOVE AP045-CL-NBR           TO AP122-ERROR-VALUE         15770069
157800         MOVE 'CLASS NUMBER'         TO AP122-ERROR-FIELD         15780069
157900         MOVE PC-EXPENSE-WARNING     TO AP122-ERROR-MESSAGE       15790069
158000         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    15800069
158100     END-IF.                                                      15810069
158200                                                                  15820000
158300* EDIT SKU NUMBER FOR AN EXPENSE                                  15830000
158400     IF AP045-SKU-NBR NOT = ZEROES                                15840000
158500         IF NOT PS-ERROR-FATAL                                    15850000
158600             SET PS-ERROR-WARNING    TO TRUE                      15860000
158700         END-IF                                                   15870000
158800         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     15880000
158900         MOVE AP045-SKU-NBR          TO AP122-ERROR-VALUE         15890000
159000         MOVE 'SKU NUMBER'           TO AP122-ERROR-FIELD         15900000
159100         MOVE PC-EXPENSE-WARNING     TO AP122-ERROR-MESSAGE       15910000
159200         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    15920000
159300     END-IF.                                                      15930000
159400                                                                  15940000
159500* EDIT RETAIL AMOUNT FOR AN EXPENSE                               15950000
159600     IF AP045-RETL-AMT NOT = ZEROES                               15960000
159700         IF NOT PS-ERROR-FATAL                                    15970000
159800             SET PS-ERROR-WARNING    TO TRUE                      15980000
159900         END-IF                                                   15990000
160000         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     16000000
160100         MOVE AP045-RETL-AMT         TO PV-ERR-AMT                16010000
160200         PERFORM D100-PROCESS-NUMERIC-ERRORS                      16020000
160300         MOVE 'RETAIL AMOUNT '       TO AP122-ERROR-FIELD         16030000
160400         MOVE '* WARNING, EXPECTED ZEROES FOR EXPENSE TRANS.   '  16040000
160500           TO AP122-ERROR-MESSAGE                                 16050000
160600         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    16060000
160700     END-IF.                                                      16070000
160800                                                                  16080000
160900                                                                  16090000
161000 C175-EDIT-MERCHANDISE-TRANS.                                     16100000
161100*---------------------------------------------------------------- 16110000
161200*  EDIT MERCHANDISE TRANSACTIONS FOR SPECIFIC DATA.               16120000
161300*---------------------------------------------------------------- 16130000
161400                                                                  16140000
161500* EDIT GL ACCOUNT NBR FOR A MERCHANDISE                           16150000
161600     IF AP045-GL-ACCT-NBR NOT = SPACES                            16160064
161700         IF NOT PS-ERROR-FATAL                                    16170000
161800             SET PS-ERROR-WARNING    TO TRUE                      16180000
161900         END-IF                                                   16190000
162000         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     16200000
162100         MOVE AP045-GL-ACCT-NBR      TO AP122-ERROR-VALUE         16210000
162200         MOVE 'GL ACCOUNT NBR'       TO AP122-ERROR-FIELD         16220000
162300         MOVE '* WARNING, EXPECTED SPACES FOR MERCHANDISE TRANS'  16230000
162400           TO AP122-ERROR-MESSAGE                                 16240000
162500         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    16250000
162600     END-IF.                                                      16260000
162700                                                                  16270000
162800* VALIDATE LOCATION TYPE FOR A MERCHANDISE TRANS IS NOT HQ        16280000
162900     IF  XFT00017-LOC-TYP-CDE = 'HQ'                              16290000
163000         SET PS-ERROR-FATAL       TO TRUE                         16300000
163100         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     16310000
163200         MOVE AP045-STR-NBR       TO AP122-ERROR-VALUE            16320000
163300         MOVE 'STORE NUMBER '     TO AP122-ERROR-FIELD            16330000
163400         MOVE PC-MDS-LOCATION-MSG TO AP122-ERROR-MESSAGE          16340000
163500         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    16350000
163600     END-IF.                                                      16360000
163700                                                                  16370000
163800* DEPT NBR                                                        16380000
163900     IF AP045-DEPT-NBR = SPACES                                   16390000
164000         SET PS-ERROR-FATAL          TO TRUE                      16400000
164100         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     16410000
164200         MOVE AP045-DEPT-NBR         TO AP122-ERROR-VALUE         16420000
164300         MOVE 'DEPARTMENT NBR'       TO AP122-ERROR-FIELD         16430000
164400         MOVE PC-REQMDSE-INP-MSG     TO AP122-ERROR-MESSAGE       16440000
164500         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    16450000
164600     ELSE                                                         16460000
164700         IF  PS-PURCHS-NOT-ENTERED                                16470000
164800             MOVE 'DPT'              TO PV-MDSEAR-MDSELV-CDE      16480000
164900             MOVE ZEROES             TO PV-MDSEAR-MAJ-CL-CDE      16490000
165000                                        PV-MDSEAR-SUB-CL-CDE      16500000
165100             PERFORM S600-SELECT-MDSEAR                           16510000
165200             IF  PS-MDSEAR-INVALID                                16520000
165300                 SET PS-ERROR-FATAL        TO TRUE                16530000
165400                 PERFORM C450-COMMON-ERR-EXCPT-FIELDS             16540000
165500                 MOVE AP045-DEPT-NBR       TO AP122-ERROR-VALUE   16550000
165600                 MOVE 'DEPARTMENT NBR'     TO AP122-ERROR-FIELD   16560000
165700                 MOVE PC-REQMDSE-SYS-MSG   TO AP122-ERROR-MESSAGE 16570000
165800                 PERFORM W200-WRITE-ERROR-EXCPT-RECORD            16580000
165900             END-IF                                               16590000
166000         ELSE                                                     16600000
166100             IF  PS-PURCHS-VALID                                  16610000
166200                IF  AP045-DEPT-NBR NOT = PURCHS-DEPT-NBR          16620000
166300                    SET PS-ERROR-FATAL       TO TRUE              16630000
166400                    PERFORM C450-COMMON-ERR-EXCPT-FIELDS          16640000
166500                    MOVE AP045-DEPT-NBR      TO AP122-ERROR-VALUE 16650000
166600                    MOVE 'DEPARTMENT NBR'    TO AP122-ERROR-FIELD 16660000
166700                    MOVE PC-REQMDSE-SYS-MSG TO AP122-ERROR-MESSAGE16670000
166800                    PERFORM W200-WRITE-ERROR-EXCPT-RECORD         16680000
166900                END-IF                                            16690000
167000            END-IF                                                16700000
167100         END-IF                                                   16710000
167200     END-IF.                                                      16720000
167300                                                                  16730000
167400* CLASS NUMBER FOR MERCHANDISE                                    16740000
167500     IF  AP045-CL-NBR = SPACES                                    16750000
167600         SET PS-ERROR-FATAL          TO TRUE                      16760000
167700         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     16770000
167800         MOVE AP045-CL-NBR           TO AP122-ERROR-VALUE         16780000
167900         MOVE 'CLASS NUMBER'         TO AP122-ERROR-FIELD         16790000
168000         MOVE PC-REQMDSE-INP-MSG     TO AP122-ERROR-MESSAGE       16800000
168100         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    16810000
168200     ELSE                                                         16820000
168300         MOVE AP045-CL-NBR           TO PV-CL-NBR                 16830000
168400         IF TRNCDE-SUB-CL-REQR-IND = 'Y'                          16840000
168500           OR PV-SUB-IND NOT = '0'                                16850000
168600* IF LAST DIGIT IN CLASS CODE ISN'T 0, THIS MUST BE A VALID SUB   16860000
168700*  CLASS CODE ON THE SYSTEM. ( I.E. AP045-CL-NBR = '21')          16870000
168800*  ( SET DB2-SUB-CL TO '021', SET DB2-MAJ-CL TO '020', VALIDATE ) 16880000
168900             MOVE 'SCL'              TO PV-MDSEAR-MDSELV-CDE      16890000
169000             MOVE PV-DB2-CL-NBR      TO PV-MDSEAR-SUB-CL-CDE      16900000
169100             MOVE ZEROES             TO PV-SUB-IND                16910000
169200             MOVE PV-CL-NBR          TO PV-MDSEAR-MAJ-CL-CDE      16920000
169300             PERFORM S600-SELECT-MDSEAR                           16930000
169400             IF PS-MDSEAR-INVALID                                 16940000
169500                 SET PS-ERROR-FATAL      TO TRUE                  16950000
169600                 PERFORM C450-COMMON-ERR-EXCPT-FIELDS             16960000
169700****             MOVE AP045-CL-NBR       TO AP122-ERROR-VALUE     16970000
169800                 STRING AP045-DEPT-NBR                            16980000
169900                        '/'                                       16990000
170000                        AP045-CL-NBR                              17000000
170100                     DELIMITED BY SIZE INTO AP122-ERROR-VALUE     17010000
170200                 MOVE 'SUB CLASS NUMBER' TO AP122-ERROR-FIELD     17020000
170300                 IF TRNCDE-SUB-CL-REQR-IND = 'Y'                  17030000
170400                    MOVE PC-REQMDSE-SYS-MSG                       17040000
170500                      TO AP122-ERROR-MESSAGE                      17050000
170600                 ELSE                                             17060000
170700                    MOVE PC-NOT-FOUND-MSG TO AP122-ERROR-MESSAGE  17070000
170800                 END-IF                                           17080000
170900                 PERFORM W200-WRITE-ERROR-EXCPT-RECORD            17090000
171000             END-IF                                               17100000
171100         ELSE                                                     17110000
171200*   LAST DIGIT IN CLASS CODE IS 0, THIS MUST BE A VALID MAJOR     17120000
171300*    CLASS CODE ON THE SYSTEM.                                    17130000
171400             MOVE 'MCL'              TO PV-MDSEAR-MDSELV-CDE      17140000
171500             MOVE AP045-CL-NBR       TO PV-MDSEAR-MAJ-CL-CDE      17150000
171600             MOVE ZEROES             TO PV-MDSEAR-SUB-CL-CDE      17160000
171700             PERFORM S600-SELECT-MDSEAR                           17170000
171800             IF PS-MDSEAR-INVALID                                 17180000
171900                 SET PS-ERROR-FATAL        TO TRUE                17190000
172000                 PERFORM C450-COMMON-ERR-EXCPT-FIELDS             17200000
172100                 MOVE AP045-CL-NBR         TO AP122-ERROR-VALUE   17210000
172200                 MOVE 'MAJOR CLASS NUMBER' TO AP122-ERROR-FIELD   17220000
172300                 MOVE PC-NOT-FOUND-MSG     TO AP122-ERROR-MESSAGE 17230000
172400                 PERFORM W200-WRITE-ERROR-EXCPT-RECORD            17240000
172500             END-IF                                               17250000
172600         END-IF                                                   17260000
172700     END-IF.                                                      17270000
172800                                                                  17280000
172900* EDIT SKU NBR FOR A MERCHANDISE                                  17290000
173000     IF TRNCDE-SKU-SEQ-REQR-IND = 'Y'                             17300000
173100        MOVE AP045-SKU-NBR TO PV-SKU-NBR                          17310000
173200        MOVE AP045-DEPT-NBR TO PV-DEPT-NBR                        17320000
173300        IF PV-DEPT-NBR NOT = SPACE                                17330000
173400           MOVE PV-DEPT-NBR-9   TO PV-DEPARTMENT                  17340000
173500        END-IF                                                    17350000
173600        MOVE AP045-CL-NBR TO PV-CLS                               17360000
173700        IF PV-CLS NOT = SPACE                                     17370000
173800           MOVE PV-CLS-9 TO PV-CLASS                              17380000
173900        END-IF                                                    17390000
174000        PERFORM S900-SELECT-SKU                                   17400000
174100        EVALUATE TRUE                                             17410000
174200           WHEN PS-SKU-VALID                                      17420000
174300              CONTINUE                                            17430000
174400           WHEN PS-SKU-INVALID                                    17440000
174500**            SET PS-ERROR-FATAL     TO TRUE                      17450000
174600*PRB54982 START                                                   17460021
174700         IF NOT PS-ERROR-FATAL                                    17470021
174800               SET PS-ERROR-WARNING  TO TRUE                      17480021
174900         END-IF                                                   17490021
175000*PRB54982 END                                                     17500029
175100              PERFORM C450-COMMON-ERR-EXCPT-FIELDS                17510000
175200              MOVE AP045-SKU-NBR     TO AP122-ERROR-VALUE         17520000
175300              MOVE 'SKU NUMBER'      TO AP122-ERROR-FIELD         17530000
175400              MOVE PC-NOT-FOUND-MSG  TO AP122-ERROR-MESSAGE       17540000
175500              PERFORM W200-WRITE-ERROR-EXCPT-RECORD               17550000
175600              MOVE ZEROES            TO AP045-SKU-NBR             17560000
175700        END-EVALUATE                                              17570000
175800     ELSE                                                         17580000
175900        MOVE ZEROES                  TO AP045-SKU-NBR             17590000
176000     END-IF.                                                      17600000
176100                                                                  17610000
176200* RETL AMT FOR MERCHANDISE                                        17620000
176300     IF AP045-RETL-AMT NOT NUMERIC                                17630000
176400         SET PS-ERROR-FATAL          TO TRUE                      17640000
176500         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     17650000
176600         MOVE AP045-RETL-AMT         TO PV-ERR-NUM-DIS            17660000
176700         MOVE PV-ERR-DIS             TO AP122-ERROR-VALUE         17670000
176800         MOVE 'RETAIL AMOUNT'        TO AP122-ERROR-FIELD         17680000
176900         MOVE PC-NOT-NUM-MSG         TO AP122-ERROR-MESSAGE       17690000
177000         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    17700000
177100     ELSE                                                         17710000
177200         IF TRNCDE-RTL-PRCCTL-CDE = 'N'                           17720000
177300           AND AP045-RETL-AMT NOT = ZEROES                        17730000
177400             SET PS-ERROR-FATAL      TO TRUE                      17740000
177500             PERFORM C450-COMMON-ERR-EXCPT-FIELDS                 17750000
177600             MOVE AP045-RETL-AMT     TO PV-ERR-AMT                17760000
177700             PERFORM D100-PROCESS-NUMERIC-ERRORS                  17770000
177800             MOVE 'RETAIL AMOUNT'    TO AP122-ERROR-FIELD         17780000
177900             MOVE 'NOT ALLOWED, FOUND ON INPUT'                   17790000
178000               TO AP122-ERROR-MESSAGE                             17800000
178100             PERFORM W200-WRITE-ERROR-EXCPT-RECORD                17810000
178200         END-IF                                                   17820000
178300         IF TRNCDE-RTL-PRCCTL-CDE = 'R'                           17830000
178400           AND AP045-RETL-AMT = ZEROES                            17840000
178500             SET PS-ERROR-FATAL       TO TRUE                     17850000
178600             PERFORM C450-COMMON-ERR-EXCPT-FIELDS                 17860000
178700             MOVE AP045-RETL-AMT      TO PV-ERR-AMT               17870000
178800             PERFORM D100-PROCESS-NUMERIC-ERRORS                  17880000
178900             MOVE 'RETAIL AMOUNT'     TO AP122-ERROR-FIELD        17890000
179000             MOVE PC-REQMDSE-INP-MSG TO AP122-ERROR-MESSAGE       17900000
179100             PERFORM W200-WRITE-ERROR-EXCPT-RECORD                17910000
179200         END-IF                                                   17920000
179300         IF TRNCDE-PSTG-TYP-CDE = 'CR'                            17930000
179400           AND AP045-RETL-AMT > ZEROES                            17940000
179500           AND ( TRNCDE-RTL-PRCCTL-CDE = 'R'                      17950000
179600                OR TRNCDE-RTL-PRCCTL-CDE = 'A' )                  17960000
179700             SET PS-ERROR-FATAL   TO TRUE                         17970000
179800             PERFORM C450-COMMON-ERR-EXCPT-FIELDS                 17980000
179900             MOVE AP045-RETL-AMT  TO PV-ERR-AMT                   17990000
180000             PERFORM D100-PROCESS-NUMERIC-ERRORS                  18000000
180100             MOVE 'RETAIL AMOUNT' TO AP122-ERROR-FIELD            18010000
180200             MOVE 'POSITIVE AMT INVALID FOR CREDIT'               18020000
180300               TO AP122-ERROR-MESSAGE                             18030000
180400             PERFORM W200-WRITE-ERROR-EXCPT-RECORD                18040000
180500         END-IF                                                   18050000
180600         IF TRNCDE-PSTG-TYP-CDE = 'CH'                            18060000
180700           AND AP045-RETL-AMT < ZEROES                            18070000
180800           AND ( TRNCDE-RTL-PRCCTL-CDE = 'R'                      18080000
180900                OR TRNCDE-RTL-PRCCTL-CDE = 'A' )                  18090000
181000             SET PS-ERROR-FATAL   TO TRUE                         18100000
181100             PERFORM C450-COMMON-ERR-EXCPT-FIELDS                 18110000
181200             MOVE AP045-RETL-AMT  TO PV-ERR-AMT                   18120000
181300             PERFORM D100-PROCESS-NUMERIC-ERRORS                  18130000
181400             MOVE 'RETAIL AMOUNT' TO AP122-ERROR-FIELD            18140000
181500             MOVE 'NEGATIVE AMT INVALID FOR CHARGE'               18150000
181600               TO AP122-ERROR-MESSAGE                             18160000
181700             PERFORM W200-WRITE-ERROR-EXCPT-RECORD                18170000
181800         END-IF                                                   18180000
181900     END-IF.                                                      18190000
182000                                                                  18200000
182100                                                                  18210000
182200 C200-CROSS-RECORD-EDITS.                                         18220000
182300*---------------------------------------------------------------- 18230000
182400* CROSS RECORD EDITS FOLLOW                                       18240000
182500*   IF VENDOR NUMBER AND DOCUMENT NUMBER MATCH THE PRIOR RECORD:  18250000
182600*    THEN DOCUMENT DATE, AP TRANS CODE, AND PEOPLESOFT BATCH      18260000
182700*    NUMBER MUST ALSO MATCH. IF ANY DON'T, PROCESS THIS ERROR.    18270000
182800*   IF TRAN TYPE CODE MATCHS THE PRIOR RECORD:                    18280000
182900*    FOR MDSE TRANSACTIONS, PO NUMBER AND DEPT NUMBER MUST MATCH  18290000
183000*    FOR EXPENSE TRANSACTIONS, GL ACCT NUMBER MUST MATCH          18300000
183100*---------------------------------------------------------------- 18310000
183200                                                                  18320000
183300     IF AP045-DOC-DTE NOT = EDITD-DOC-DTE                         18330000
183400         SET PS-ERROR-FATAL      TO TRUE                          18340000
183500         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     18350000
183600         MOVE AP045-DOC-DTE      TO AP122-ERROR-VALUE             18360000
183700         MOVE 'DOCUMENT DATE'    TO AP122-ERROR-FIELD             18370000
183800         MOVE 'PREV DOCUMENT DATE DIFFERENT, SAME VENDOR/DOC NBR' 18380000
183900           TO AP122-ERROR-MESSAGE                                 18390000
184000         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    18400000
184100     END-IF.                                                      18410000
184200     IF AP045-AP-TRN-CDE NOT = EDITD-AP-TRN-CDE                   18420000
184300         SET PS-ERROR-FATAL      TO TRUE                          18430000
184400         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     18440000
184500         MOVE AP045-AP-TRN-CDE   TO AP122-ERROR-VALUE             18450000
184600         MOVE 'AP TRANS CODE '   TO AP122-ERROR-FIELD             18460000
184700         MOVE 'PREV AP TRANS CODE DIFFERENT, SAME VENDOR/DOC NBR' 18470000
184800           TO AP122-ERROR-MESSAGE                                 18480000
184900         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    18490000
185000     END-IF.                                                      18500000
185100                                                                  18510000
185200*    IF MDSE TRANSACTIONS, PO NUMBER AND DEPT NUMBER MUST MATCH   18520000
185300     IF AP045-TRN-TYP-CDE = EDITD-TRN-TYP-CDE                     18530000
185400       AND AP045-MERCHANDISE                                      18540000
185500         IF AP045-PO-NBR NOT = EDITD-PO-NBR                       18550000
185600             SET PS-ERROR-FATAL  TO TRUE                          18560000
185700             PERFORM C450-COMMON-ERR-EXCPT-FIELDS                 18570000
185800             MOVE AP045-PO-NBR   TO AP122-ERROR-VALUE             18580000
185900             MOVE 'PO NUMBER'    TO AP122-ERROR-FIELD             18590000
186000             MOVE 'PREV PO NBR DIFFERENT, MULTIPLE MDSE TRANS'    18600000
186100               TO AP122-ERROR-MESSAGE                             18610000
186200             PERFORM W200-WRITE-ERROR-EXCPT-RECORD                18620000
186300         END-IF                                                   18630000
186400         IF AP045-DEPT-NBR NOT = EDITD-DEPT-NBR                   18640000
186500             SET PS-ERROR-FATAL    TO TRUE                        18650000
186600             PERFORM C450-COMMON-ERR-EXCPT-FIELDS                 18660000
186700             MOVE AP045-DEPT-NBR   TO AP122-ERROR-VALUE           18670000
186800             MOVE 'DEPARTMENT NBR' TO AP122-ERROR-FIELD           18680000
186900             MOVE 'PREV DEPT NBR DIFF, MULTIPLE MDSE TRANS'       18690000
187000               TO AP122-ERROR-MESSAGE                             18700000
187100             PERFORM W200-WRITE-ERROR-EXCPT-RECORD                18710000
187200         END-IF                                                   18720000
187300     END-IF.                                                      18730000
187400                                                                  18740000
187500*    IF EXPENSE TRANSACTIONS, GL ACCT NUMBER MUST MATCH           18750000
187600     IF AP045-TRN-TYP-CDE = EDITD-TRN-TYP-CDE                     18760000
187700       AND AP045-EXPENSE                                          18770000
187800       AND AP045-GL-ACCT-NBR NOT = EDITD-GL-ACCT-NBR              18780000
187900         SET PS-ERROR-FATAL      TO TRUE                          18790000
188000         PERFORM C450-COMMON-ERR-EXCPT-FIELDS                     18800000
188100         MOVE AP045-GL-ACCT-NBR  TO AP122-ERROR-VALUE             18810000
188200         MOVE 'GL ACCOUNT NBR'   TO AP122-ERROR-FIELD             18820000
188300         MOVE 'PREV GL ACCT NBR DIFFERENT, MULTIPLE EXP TRANS'    18830000
188400           TO AP122-ERROR-MESSAGE                                 18840000
188500         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    18850000
188600     END-IF.                                                      18860000
188700                                                                  18870000
188800                                                                  18880000
188900 C300-ACCUM-RECORD-TOTALS.                                        18890000
189000*---------------------------------------------------------------- 18900000
189100*  ACCUMULATE AMOUNT FIELDS FOR ALL INPUT RECORDS. THIS WILL BE   18910000
189200*  COMPARED TO THE CONTROL RECORD IN END-OF-FILE PROCESSING.      18920000
189300*---------------------------------------------------------------- 18930000
189400                                                                  18940000
189500     IF AP045-GRO-COST-AMT NUMERIC                                18950000
189600         COMPUTE PV-ACCUM-GRO-COST =                              18960000
189700                 ( PV-ACCUM-GRO-COST + AP045-GRO-COST-AMT )       18970000
189800     END-IF.                                                      18980000
189900     IF AP045-RETL-AMT NUMERIC                                    18990000
190000         COMPUTE PV-ACCUM-RETL =                                  19000000
190100                 ( PV-ACCUM-RETL + AP045-RETL-AMT )               19010000
190200     END-IF.                                                      19020000
190300     IF AP045-FRGT-AMT NUMERIC                                    19030000
190400         COMPUTE PV-ACCUM-FRGT =                                  19040000
190500                 ( PV-ACCUM-FRGT + AP045-FRGT-AMT )               19050000
190600     END-IF.                                                      19060000
190700     IF AP045-MISC-CHRG-AMT NUMERIC                               19070000
190800         COMPUTE PV-ACCUM-MISC-CHRG =                             19080000
190900                 ( PV-ACCUM-MISC-CHRG + AP045-MISC-CHRG-AMT )     19090000
191000     END-IF.                                                      19100000
191100     IF AP045-NET-COST-AMT NUMERIC                                19110000
191200         COMPUTE PV-ACCUM-NET-COST =                              19120000
191300                 ( PV-ACCUM-NET-COST + AP045-NET-COST-AMT )       19130000
191400     END-IF.                                                      19140000
191500     IF AP045-DTL-TERM-DISC-AMT NUMERIC                           19150000
191600         COMPUTE PV-ACCUM-TERM-DISC =                             19160000
191700                 ( PV-ACCUM-TERM-DISC + AP045-DTL-TERM-DISC-AMT ) 19170000
191800     END-IF.                                                      19180000
191900     IF AP045-DTL-NW-STR-DISC-AMT NUMERIC                         19190000
192000         COMPUTE PV-ACCUM-NW-STR-DISC = ( PV-ACCUM-NW-STR-DISC    19200000
192100                                  + AP045-DTL-NW-STR-DISC-AMT )   19210000
192200     END-IF.                                                      19220000
192300     IF AP045-DTL-TRD-DISC-AMT NUMERIC                            19230000
192400         COMPUTE PV-ACCUM-TRD-DISC =                              19240000
192500                 ( PV-ACCUM-TRD-DISC + AP045-DTL-TRD-DISC-AMT )   19250000
192600     END-IF.                                                      19260000
192700     IF AP045-DTL-MOS-DISC-AMT NUMERIC                            19270000
192800         COMPUTE PV-ACCUM-MOS-DISC = ( PV-ACCUM-MOS-DISC          19280000
192900                                  + AP045-DTL-MOS-DISC-AMT )      19290000
193000     END-IF.                                                      19300000
193100                                                                  19310000
193200 C350-PROCESS-POSTING-PERIOD.                                     19320000
193300*---------------------------------------------------------------- 19330000
193400*  IF NO POSTING PERIOD IS ON THE INPUT FILE, OR THE POSTING      19340000
193500*  PERIOD DOES NOT MATCH ONE OF THE VALID PERIODS ON THE APCNTL   19350000
193600*  TABLE, REPLACE THE FIELDS WITH THE CURRENT POSTING PERIOD      19360000
193700*---------------------------------------------------------------- 19370000
193800     IF EDITD-PSTG-FYR-NBR = SPACES                               19380000
193900     OR EDITD-PSTG-FMN-NBR = SPACES                               19390000
194000     OR EDITD-PSTG-FWK-NBR = SPACES                               19400000
194100        MOVE APCNTL-CURR-PSTG-FYR-NBR TO EDITD-PSTG-FYR-NBR       19410000
194200        MOVE APCNTL-CURR-PSTG-FMN-NBR TO EDITD-PSTG-FMN-NBR       19420000
194300        MOVE APCNTL-CURR-PSTG-FWK-NBR TO EDITD-PSTG-FWK-NBR       19430000
194400     ELSE                                                         19440000
194500        IF  EDITD-PSTG-FYR-NBR = APCNTL-CURR-PSTG-FYR-NBR         19450000
194600        AND EDITD-PSTG-FMN-NBR = APCNTL-CURR-PSTG-FMN-NBR         19460000
194700        AND EDITD-PSTG-FWK-NBR = APCNTL-CURR-PSTG-FWK-NBR         19470000
194800            CONTINUE                                              19480000
194900        ELSE                                                      19490000
195000            IF  EDITD-PSTG-FYR-NBR = APCNTL-PREV-PSTG-FYR-NBR     19500000
195100            AND EDITD-PSTG-FMN-NBR = APCNTL-PREV-PSTG-FMN-NBR     19510000
195200            AND EDITD-PSTG-FWK-NBR = APCNTL-PREV-PSTG-FWK-NBR     19520000
195300            AND APCNTL-MULT-PSTG-PER-IND  = 'Y'                   19530000
195400                CONTINUE                                          19540000
195500            ELSE                                                  19550000
195600                MOVE APCNTL-CURR-PSTG-FYR-NBR                     19560000
195700                             TO EDITD-PSTG-FYR-NBR                19570000
195800                MOVE APCNTL-CURR-PSTG-FMN-NBR                     19580000
195900                             TO EDITD-PSTG-FMN-NBR                19590000
196000                MOVE APCNTL-CURR-PSTG-FWK-NBR                     19600000
196100                             TO EDITD-PSTG-FWK-NBR                19610000
196200            END-IF                                                19620000
196300         END-IF                                                   19630000
196400      END-IF.                                                     19640000
196500                                                                  19650000
196600 C400-PROCESS-CONTROL-DATA.                                       19660000
196700*---------------------------------------------------------------- 19670000
196800*  COMPARE CONTROL DATA WITH ACCUMULATED INPUT AMOUNTS.           19680000
196900*   ANY DISCREPANCIES ARE ERRORS.                                 19690000
197000*---------------------------------------------------------------- 19700000
197100                                                                  19710000
197200     INITIALIZE AP122-ADJ-INTERFACE-EXCEPTIONS.                   19720000
197300     MOVE 'CONTROL RECORD'       TO AP045-DOC-NBR.                19730000
197400     MOVE AP045-DOC-NBR          TO AP122-DOC-NBR.                19740000
197500     SET PS-ERROR-FREE           TO TRUE.                         19750000
197600                                                                  19760000
197700     IF PV-CTL-RECORD-COUNT NOT = PV-COUNT-READ                   19770063
197800         IF PS-CNTRL-NOT-WRTTN                                    19780000
197900            PERFORM C450-COMMON-ERR-EXCPT-FIELDS                  19790000
198000            PERFORM W200-WRITE-ERROR-EXCPT-RECORD                 19800000
198100            SET PS-CNTRL-WRTTN       TO TRUE                      19810000
198200         END-IF                                                   19820000
198300         SET PS-ERROR-FATAL          TO TRUE                      19830000
198400         PERFORM C500-EMPTY-ERROR-EXCPT-FIELDS                    19840000
198500         MOVE PV-CTL-RECORD-COUNT    TO PV-ERROR-READ             19850063
198600         MOVE PV-ERROR-READ-DIS      TO AP122-ERROR-VALUE         19860000
198700         MOVE 'INPUT RECORD COUNT'   TO AP122-ERROR-FIELD         19870000
198800         MOVE PC-CTL-ERROR-MSG       TO AP122-ERROR-MESSAGE       19880000
198900         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    19890000
199000         MOVE PV-COUNT-READ          TO PV-ERROR-READ             19900000
199100         MOVE PV-ERROR-READ-DIS      TO AP122-ERROR-VALUE         19910000
199200         MOVE PC-CALC-ERROR-FIELD    TO AP122-ERROR-FIELD         19920000
199300         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    19930000
199400     END-IF.                                                      19940000
199500     IF PV-CTL-GRO-COST-AMT NOT = PV-ACCUM-GRO-COST               19950063
199600         IF PS-CNTRL-NOT-WRTTN                                    19960000
199700            PERFORM C450-COMMON-ERR-EXCPT-FIELDS                  19970000
199800            PERFORM W200-WRITE-ERROR-EXCPT-RECORD                 19980000
199900            SET PS-CNTRL-WRTTN       TO TRUE                      19990000
200000         END-IF                                                   20000000
200100         SET PS-ERROR-FATAL           TO TRUE                     20010000
200200         PERFORM C500-EMPTY-ERROR-EXCPT-FIELDS                    20020000
200300         MOVE PV-CTL-GRO-COST-AMT     TO PV-ERR-AMT               20030063
200400         PERFORM D100-PROCESS-NUMERIC-ERRORS                      20040000
200500         MOVE 'INPUT GROSS COST CNTL' TO AP122-ERROR-FIELD        20050000
200600         MOVE PC-CTL-ERROR-MSG        TO AP122-ERROR-MESSAGE      20060000
200700         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    20070000
200800         MOVE PV-ACCUM-GRO-COST       TO PV-ERR-AMT               20080000
200900         PERFORM D100-PROCESS-NUMERIC-ERRORS                      20090000
201000         MOVE PC-CALC-ERROR-FIELD     TO AP122-ERROR-FIELD        20100000
201100         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    20110000
201200     END-IF.                                                      20120000
201300     IF PV-CTL-RETL-AMT NOT = PV-ACCUM-RETL                       20130063
201400         IF PS-CNTRL-NOT-WRTTN                                    20140000
201500            PERFORM C450-COMMON-ERR-EXCPT-FIELDS                  20150000
201600            PERFORM W200-WRITE-ERROR-EXCPT-RECORD                 20160000
201700            SET PS-CNTRL-WRTTN       TO TRUE                      20170000
201800         END-IF                                                   20180000
201900         SET PS-ERROR-FATAL            TO TRUE                    20190000
202000         PERFORM C500-EMPTY-ERROR-EXCPT-FIELDS                    20200000
202100         MOVE PV-CTL-RETL-AMT          TO PV-ERR-AMT              20210063
202200         PERFORM D100-PROCESS-NUMERIC-ERRORS                      20220000
202300         MOVE 'INPUT RETAIL AMT CNTL'  TO AP122-ERROR-FIELD       20230000
202400         MOVE PC-CTL-ERROR-MSG         TO AP122-ERROR-MESSAGE     20240000
202500         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    20250000
202600         MOVE PV-ACCUM-RETL            TO PV-ERR-AMT              20260000
202700         PERFORM D100-PROCESS-NUMERIC-ERRORS                      20270000
202800         MOVE PC-CALC-ERROR-FIELD      TO AP122-ERROR-FIELD       20280000
202900         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    20290000
203000     END-IF.                                                      20300000
203100     IF PV-CTL-FRGT-AMT NOT = PV-ACCUM-FRGT                       20310063
203200         IF PS-CNTRL-NOT-WRTTN                                    20320000
203300            PERFORM C450-COMMON-ERR-EXCPT-FIELDS                  20330000
203400            PERFORM W200-WRITE-ERROR-EXCPT-RECORD                 20340000
203500            SET PS-CNTRL-WRTTN       TO TRUE                      20350000
203600         END-IF                                                   20360000
203700         SET PS-ERROR-FATAL            TO TRUE                    20370000
203800         PERFORM C500-EMPTY-ERROR-EXCPT-FIELDS                    20380000
203900         MOVE PV-CTL-FRGT-AMT          TO PV-ERR-AMT              20390063
204000         PERFORM D100-PROCESS-NUMERIC-ERRORS                      20400000
204100         MOVE 'INPUT FREIGHT AMT CNTL' TO AP122-ERROR-FIELD       20410000
204200         MOVE PC-CTL-ERROR-MSG         TO AP122-ERROR-MESSAGE     20420000
204300         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    20430000
204400         MOVE PV-ACCUM-FRGT            TO PV-ERR-AMT              20440000
204500         PERFORM D100-PROCESS-NUMERIC-ERRORS                      20450000
204600         MOVE PC-CALC-ERROR-FIELD      TO AP122-ERROR-FIELD       20460000
204700         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    20470000
204800     END-IF.                                                      20480000
204900     IF PV-CTL-MISC-CHRG-AMT NOT = PV-ACCUM-MISC-CHRG             20490063
205000         IF PS-CNTRL-NOT-WRTTN                                    20500000
205100            PERFORM C450-COMMON-ERR-EXCPT-FIELDS                  20510000
205200            PERFORM W200-WRITE-ERROR-EXCPT-RECORD                 20520000
205300            SET PS-CNTRL-WRTTN       TO TRUE                      20530000
205400         END-IF                                                   20540000
205500         SET PS-ERROR-FATAL            TO TRUE                    20550000
205600         PERFORM C500-EMPTY-ERROR-EXCPT-FIELDS                    20560000
205700         MOVE PV-CTL-MISC-CHRG-AMT     TO PV-ERR-AMT              20570063
205800         PERFORM D100-PROCESS-NUMERIC-ERRORS                      20580000
205900         MOVE 'INPUT MISC CHRG CNTL'   TO AP122-ERROR-FIELD       20590000
206000         MOVE PC-CTL-ERROR-MSG         TO AP122-ERROR-MESSAGE     20600000
206100         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    20610000
206200         MOVE PV-ACCUM-MISC-CHRG       TO PV-ERR-AMT              20620000
206300         PERFORM D100-PROCESS-NUMERIC-ERRORS                      20630000
206400         MOVE PC-CALC-ERROR-FIELD      TO AP122-ERROR-FIELD       20640000
206500         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    20650000
206600     END-IF.                                                      20660000
206700     IF PV-CTL-NET-COST-AMT NOT = PV-ACCUM-NET-COST               20670063
206800         IF PS-CNTRL-NOT-WRTTN                                    20680000
206900            PERFORM C450-COMMON-ERR-EXCPT-FIELDS                  20690000
207000            PERFORM W200-WRITE-ERROR-EXCPT-RECORD                 20700000
207100            SET PS-CNTRL-WRTTN       TO TRUE                      20710000
207200         END-IF                                                   20720000
207300         SET PS-ERROR-FATAL          TO TRUE                      20730000
207400         PERFORM C500-EMPTY-ERROR-EXCPT-FIELDS                    20740000
207500         MOVE PV-CTL-NET-COST-AMT    TO PV-ERR-AMT                20750063
207600         PERFORM D100-PROCESS-NUMERIC-ERRORS                      20760000
207700         MOVE 'INPUT NET COST CNTL'  TO AP122-ERROR-FIELD         20770000
207800         MOVE PC-CTL-ERROR-MSG       TO AP122-ERROR-MESSAGE       20780000
207900         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    20790000
208000         MOVE PV-ACCUM-NET-COST      TO PV-ERR-AMT                20800000
208100         PERFORM D100-PROCESS-NUMERIC-ERRORS                      20810000
208200         MOVE PC-CALC-ERROR-FIELD    TO AP122-ERROR-FIELD         20820000
208300         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    20830000
208400     END-IF.                                                      20840000
208500     IF PV-CTL-TERM-DISC-AMT NOT = PV-ACCUM-TERM-DISC             20850063
208600         IF PS-CNTRL-NOT-WRTTN                                    20860000
208700            PERFORM C450-COMMON-ERR-EXCPT-FIELDS                  20870000
208800            PERFORM W200-WRITE-ERROR-EXCPT-RECORD                 20880000
208900            SET PS-CNTRL-WRTTN       TO TRUE                      20890000
209000         END-IF                                                   20900000
209100         SET PS-ERROR-FATAL           TO TRUE                     20910000
209200         PERFORM C500-EMPTY-ERROR-EXCPT-FIELDS                    20920000
209300         MOVE PV-CTL-TERM-DISC-AMT    TO PV-ERR-AMT               20930063
209400         PERFORM D100-PROCESS-NUMERIC-ERRORS                      20940000
209500         MOVE 'INPUT TERM DISC CNTL'  TO AP122-ERROR-FIELD        20950000
209600         MOVE PC-CTL-ERROR-MSG        TO AP122-ERROR-MESSAGE      20960000
209700         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    20970000
209800         MOVE PV-ACCUM-TERM-DISC      TO PV-ERR-AMT               20980000
209900         PERFORM D100-PROCESS-NUMERIC-ERRORS                      20990000
210000         MOVE PC-CALC-ERROR-FIELD     TO AP122-ERROR-FIELD        21000000
210100         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    21010000
210200     END-IF.                                                      21020000
210300     IF PV-CTL-NW-STR-DISC-AMT NOT = PV-ACCUM-NW-STR-DISC         21030063
210400         IF PS-CNTRL-NOT-WRTTN                                    21040000
210500            PERFORM C450-COMMON-ERR-EXCPT-FIELDS                  21050000
210600            PERFORM W200-WRITE-ERROR-EXCPT-RECORD                 21060000
210700            SET PS-CNTRL-WRTTN       TO TRUE                      21070000
210800         END-IF                                                   21080000
210900         SET PS-ERROR-FATAL              TO TRUE                  21090000
211000         PERFORM C500-EMPTY-ERROR-EXCPT-FIELDS                    21100000
211100         MOVE PV-CTL-NW-STR-DISC-AMT     TO PV-ERR-AMT            21110063
211200         PERFORM D100-PROCESS-NUMERIC-ERRORS                      21120000
211300         MOVE 'INPUT NW STR DISC CNTL'   TO AP122-ERROR-FIELD     21130000
211400         MOVE PC-CTL-ERROR-MSG           TO AP122-ERROR-MESSAGE   21140000
211500         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    21150000
211600         MOVE PV-ACCUM-NW-STR-DISC       TO PV-ERR-AMT            21160000
211700         PERFORM D100-PROCESS-NUMERIC-ERRORS                      21170000
211800         MOVE PC-CALC-ERROR-FIELD        TO AP122-ERROR-FIELD     21180000
211900         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    21190000
212000     END-IF.                                                      21200000
212100     IF PV-CTL-TRD-DISC-AMT NOT = PV-ACCUM-TRD-DISC               21210063
212200         IF PS-CNTRL-NOT-WRTTN                                    21220000
212300            PERFORM C450-COMMON-ERR-EXCPT-FIELDS                  21230000
212400            PERFORM W200-WRITE-ERROR-EXCPT-RECORD                 21240000
212500            SET PS-CNTRL-WRTTN       TO TRUE                      21250000
212600         END-IF                                                   21260000
212700         SET PS-ERROR-FATAL            TO TRUE                    21270000
212800         PERFORM C500-EMPTY-ERROR-EXCPT-FIELDS                    21280000
212900         MOVE PV-CTL-TRD-DISC-AMT      TO PV-ERR-AMT              21290063
213000         PERFORM D100-PROCESS-NUMERIC-ERRORS                      21300000
213100         MOVE 'INPUT TRD DISC CNTL'    TO AP122-ERROR-FIELD       21310000
213200         MOVE PC-CTL-ERROR-MSG         TO AP122-ERROR-MESSAGE     21320000
213300         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    21330000
213400         MOVE PV-ACCUM-TRD-DISC        TO PV-ERR-AMT              21340000
213500         PERFORM D100-PROCESS-NUMERIC-ERRORS                      21350000
213600         MOVE PC-CALC-ERROR-FIELD      TO AP122-ERROR-FIELD       21360000
213700         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    21370000
213800     END-IF.                                                      21380000
213900     IF PV-CTL-MOS-DISC-AMT NOT = PV-ACCUM-MOS-DISC               21390063
214000         IF PS-CNTRL-NOT-WRTTN                                    21400000
214100            PERFORM C450-COMMON-ERR-EXCPT-FIELDS                  21410000
214200            PERFORM W200-WRITE-ERROR-EXCPT-RECORD                 21420000
214300            SET PS-CNTRL-WRTTN       TO TRUE                      21430000
214400         END-IF                                                   21440000
214500         SET PS-ERROR-FATAL          TO TRUE                      21450000
214600         PERFORM C500-EMPTY-ERROR-EXCPT-FIELDS                    21460000
214700         MOVE PV-CTL-MOS-DISC-AMT    TO PV-ERR-AMT                21470063
214800         PERFORM D100-PROCESS-NUMERIC-ERRORS                      21480000
214900         MOVE 'INPUT MOS DISC CNTL'  TO AP122-ERROR-FIELD         21490000
215000         MOVE PC-CTL-ERROR-MSG       TO AP122-ERROR-MESSAGE       21500000
215100         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    21510000
215200         MOVE PV-ACCUM-MOS-DISC      TO PV-ERR-AMT                21520000
215300         PERFORM D100-PROCESS-NUMERIC-ERRORS                      21530000
215400         MOVE PC-CALC-ERROR-FIELD    TO AP122-ERROR-FIELD         21540000
215500         PERFORM W200-WRITE-ERROR-EXCPT-RECORD                    21550000
215600     END-IF.                                                      21560000
215700                                                                  21570000
215800     IF PS-ERROR-FATAL                                            21580000
215900        PERFORM C500-EMPTY-ERROR-EXCPT-FIELDS                     21590000
216000        MOVE SPACES                  TO AP122-ERROR-FIELD         21600000
216100                                        AP122-ERROR-VALUE         21610000
216200        MOVE 'CONTROL TOTALS ERROR, ALL DATA HAS BEEN BYPASSED'   21620000
216300          TO AP122-ERROR-MESSAGE                                  21630000
216400        PERFORM W200-WRITE-ERROR-EXCPT-RECORD                     21640000
216500     END-IF.                                                      21650000
216600                                                                  21660000
216700 C450-COMMON-ERR-EXCPT-FIELDS.                                    21670000
216800*---------------------------------------------------------------- 21680000
216900* SET VALUES IN THE APRD122 ERROR/EXCEPTION LAYOUT                21690000
217000*---------------------------------------------------------------- 21700000
217100                                                                  21710000
217200     MOVE AP045-VND-NBR                 TO AP122-VND-NBR.         21720000
217300     MOVE AP045-DOC-NBR                 TO AP122-DOC-NBR.         21730000
217400     MOVE AP045-DOC-DTE                 TO AP122-DOC-DTE.         21740000
217500     MOVE AP045-AP-TRN-CDE              TO AP122-AP-TRN-CDE.      21750000
217600     IF AP045-PO-NBR > SPACES                                     21760015
217700        MOVE AP045-PO-NBR                  TO AP122-PO-NBR        21770015
217800     ELSE                                                         21780000
217900        MOVE ZEROES                        TO AP122-PO-NBR        21790015
218000     END-IF.                                                      21800000
218100     IF AP045-NET-COST-AMT NUMERIC                                21810015
218200        MOVE AP045-NET-COST-AMT            TO AP122-NET-COST      21820015
218300     ELSE                                                         21830015
218400        MOVE ZEROES                        TO AP122-NET-COST      21840015
218500     END-IF.                                                      21850015
218600     IF AP045-RETL-AMT NUMERIC                                    21860015
218700        MOVE AP045-RETL-AMT                TO AP122-NET-RETAIL    21870015
218800     ELSE                                                         21880015
218900        MOVE ZEROES                        TO AP122-NET-RETAIL    21890015
219000     END-IF.                                                      21900015
219100                                                                  21910000
219200     IF PS-ERROR-FATAL                                            21920000
219300        SET AP122-REJECTION             TO TRUE                   21930000
219400     END-IF.                                                      21940000
219500     IF PS-ERROR-WARNING                                          21950000
219600        SET AP122-WARNING               TO TRUE                   21960000
219700     END-IF.                                                      21970000
219800                                                                  21980000
219900 C500-EMPTY-ERROR-EXCPT-FIELDS.                                   21990000
220000*---------------------------------------------------------------- 22000000
220100* SET VALUES IN THE APRD122 ERROR/EXCEPTION LAYOUT TO SPACES      22010000
220200*---------------------------------------------------------------- 22020000
220300                                                                  22030000
220400     MOVE SPACES                        TO AP122-VND-NBR          22040000
220500                                           AP122-DOC-NBR          22050000
220600                                           AP122-DOC-DTE          22060000
220700                                           AP122-AP-TRN-CDE.      22070014
220800     MOVE ZEROES                        TO AP122-PO-NBR           22080014
220900                                           AP122-NET-COST         22090014
221000                                           AP122-NET-RETAIL.      22100000
221100                                                                  22110000
221200     IF PS-ERROR-FATAL                                            22120000
221300        SET AP122-REJECTION             TO TRUE                   22130000
221400     END-IF.                                                      22140000
221500     IF PS-ERROR-WARNING                                          22150000
221600        SET AP122-WARNING               TO TRUE                   22160000
221700     END-IF.                                                      22170000
221800                                                                  22180000
228500 D100-PROCESS-NUMERIC-ERRORS.                                     22850000
228600*---------------------------------------------------------------- 22860000
228700*  REFORMAT NUMERIC FIELDS FOR ERROR MESSAGES.                    22870000
228800*---------------------------------------------------------------- 22880000
228900                                                                  22890000
229000     MOVE PV-ERR-AMT-NBR         TO PV-ERR-AMT-NBR-S.             22900000
229100     IF PV-ERR-AMT < ZEROES                                       22910000
229200       AND PV-ERR-AMT-NBR-S NOT < ZEROES                          22920000
229300         COMPUTE PV-ERR-AMT-NBR-S = PV-ERR-AMT-NBR-S * -1         22930000
229400     END-IF.                                                      22940000
229500     MOVE PV-ERR-AMT-NBR-S       TO PV-ERROR-NBR.                 22950000
229600     MOVE '.'                    TO PV-ERROR-DECIMAL.             22960000
229700     MOVE PV-ERR-AMT-DEC         TO PV-ERROR-DEC.                 22970000
229800                                                                  22980000
229900     MOVE PV-ERROR-AMT-DIS       TO AP122-ERROR-VALUE.            22990000
230000                                                                  23000000
230100 R100-READ-ADJ-TRANS-FILE.                                        23010000
230200*---------------------------------------------------------------- 23020000
230300*    READ THE ADJ-TRANS-FILE INTO COPYBOOK APRD060                23030000
230400*---------------------------------------------------------------- 23040000
230500                                                                  23050000
230600     READ ADJ-TRANS-FILE INTO AP045-TRANSACTION-FILE              23060000
230700       AT END                                                     23070000
230800         SET PS-ADJ-TRANS-END    TO TRUE                          23080000
230900                                                                  23090000
231000       NOT AT END                                                 23100000
231100         SET PS-PRINT-KEY        TO TRUE                          23110000
231200         IF NOT AP045-CONTROL-RECORD                              23120000
231300             ADD 1               TO PV-COUNT-READ                 23130000
231310         ELSE                                                     23131063
231311             PERFORM R110-SUM-CONTROL-RECORD-TOTALS               23131163
231400         END-IF                                                   23140000
231500     END-READ.                                                    23150000
231501                                                                  23150155
231510 R110-SUM-CONTROL-RECORD-TOTALS.                                  23151063
231511*---------------------------------------------------------------- 23151163
231512*    INCREMENT THE CONTROL RECORD TOTALS EACH TIME A CONTROL      23151263
231513*    RECORD IS READ.                                              23151363
231514*---------------------------------------------------------------- 23151463
231520                                                                  23152063
231521     ADD AP045-CTL-RECORD-COUNT     TO PV-CTL-RECORD-COUNT.       23152163
231530     ADD AP045-CTL-GRO-COST-AMT     TO PV-CTL-GRO-COST-AMT.       23153063
231540     ADD AP045-CTL-RETL-AMT         TO PV-CTL-RETL-AMT.           23154063
231550     ADD AP045-CTL-FRGT-AMT         TO PV-CTL-FRGT-AMT.           23155063
231560     ADD AP045-CTL-MISC-CHRG-AMT    TO PV-CTL-MISC-CHRG-AMT.      23156063
231570     ADD AP045-CTL-NET-COST-AMT     TO PV-CTL-NET-COST-AMT.       23157063
231580     ADD AP045-CTL-TERM-DISC-AMT    TO PV-CTL-TERM-DISC-AMT.      23158063
231590     ADD AP045-CTL-NW-STR-DISC-AMT  TO PV-CTL-NW-STR-DISC-AMT.    23159063
231591     ADD AP045-CTL-TRD-DISC-AMT     TO PV-CTL-TRD-DISC-AMT.       23159163
231592     ADD AP045-CTL-MOS-DISC-AMT     TO PV-CTL-MOS-DISC-AMT.       23159263
231600                                                                  23160063
233100 S100-SELECT-BATCH-PROCESS-DATE.                                  23310000
233200*---------------------------------------------------------------- 23320000
233300*   SELECTS BATCH PROCESS DATE FROM TAPCNTL                       23330000
233400*---------------------------------------------------------------- 23340000
233500                                                                  23350000
233600     INITIALIZE DCLTAPCNTL.                                       23360000
233700     MOVE 'S100-SELECT-BATCH-PROCESS-DATE '                       23370000
233800                                 TO AA-PARAGRAPH-NAME.            23380000
233900                                                                  23390000
234000     EXEC SQL                                                     23400000
234100         SELECT                                                   23410000
234200             BTCH_PRC_DTE                                         23420000
234300            ,CURR_PSTG_FYR_NBR                                    23430000
234400            ,CURR_PSTG_FMN_NBR                                    23440000
234500            ,CURR_PSTG_FWK_NBR                                    23450000
234600            ,PREV_PSTG_FYR_NBR                                    23460000
234700            ,PREV_PSTG_FMN_NBR                                    23470000
234800            ,PREV_PSTG_FWK_NBR                                    23480000
234900            ,MULT_PSTG_PER_IND                                    23490000
235000         INTO                                                     23500000
235100             :APCNTL-BTCH-PRC-DTE                                 23510000
235200            ,:APCNTL-CURR-PSTG-FYR-NBR                            23520000
235300            ,:APCNTL-CURR-PSTG-FMN-NBR                            23530000
235400            ,:APCNTL-CURR-PSTG-FWK-NBR                            23540000
235500            ,:APCNTL-PREV-PSTG-FYR-NBR                            23550000
235600            ,:APCNTL-PREV-PSTG-FMN-NBR                            23560000
235700            ,:APCNTL-PREV-PSTG-FWK-NBR                            23570000
235800            ,:APCNTL-MULT-PSTG-PER-IND                            23580000
235900         FROM TAPCNTL                                             23590000
236000     END-EXEC.                                                    23600000
236100                                                                  23610000
236200     EVALUATE TRUE                                                23620000
236300         WHEN SQLCODE = ZERO                                      23630000
236400             CONTINUE                                             23640000
236500                                                                  23650000
236600         WHEN SQLWARN0 NOT = SPACES                               23660000
236700         WHEN SQLCODE  NOT = ZERO                                 23670000
236800             MOVE 'UNSUCCESSFUL SELECT FOR BTCH PRC DTE'          23680000
236900                                 TO AA-DB2-OPERATION              23690000
237000             MOVE 'TAPCNTL'      TO AA-DB2-TABLE-1                23700000
237100             MOVE SPACES         TO AA-DB2-TABLE-2                23710000
237200                                    AA-DB2-TABLE-3                23720000
237300             PERFORM Z999-DB2-ABEND                               23730000
237400     END-EVALUATE.                                                23740000
237500                                                                  23750000
237600                                                                  23760000
237700 S200-SELECT-TRANCODE.                                            23770000
237800*---------------------------------------------------------------- 23780000
237900*   SELECTS TRANCODE FROM TTRNCDE                                 23790000
238000*---------------------------------------------------------------- 23800000
238100                                                                  23810000
238200     MOVE 'S200-SELECT-TRANCODE '                                 23820000
238300                                 TO AA-PARAGRAPH-NAME.            23830000
238400     INITIALIZE DCLTTRNCDE.                                       23840000
238500                                                                  23850000
238600     EXEC SQL                                                     23860000
238700         SELECT                                                   23870000
238800             AP_TRN_CDE                                           23880000
238900            ,EFF_STRT_DTE                                         23890000
239000            ,EFF_END_DTE                                          23900000
239100            ,PSTG_TYP_CDE                                         23910000
239200            ,TRN_TYP_CDE                                          23920000
239300            ,COST_PRCCTL_CDE                                      23930000
239400            ,RTL_PRCCTL_CDE                                       23940000
239500            ,PO_NBR_REQR_IND                                      23950000
239600            ,RSN_TXT_REQR_IND                                     23960000
239700            ,SUB_CL_REQR_IND                                      23970000
239800            ,SKU_SEQ_REQR_IND                                     23980000
239900            ,FRGT_REQR_IND                                        23990000
240000            ,GL_ACCT_NBR                                          24000000
240100            ,BTCH_SRC_CDE                                         24010000
240110            ,AP_PSTG_IND                                          24011033
240200         INTO                                                     24020000
240300             :TRNCDE-AP-TRN-CDE                                   24030000
240400            ,:TRNCDE-EFF-STRT-DTE                                 24040000
240500            ,:TRNCDE-EFF-END-DTE                                  24050000
240600            ,:TRNCDE-PSTG-TYP-CDE                                 24060000
240700            ,:TRNCDE-TRN-TYP-CDE                                  24070000
240800            ,:TRNCDE-COST-PRCCTL-CDE                              24080000
240900            ,:TRNCDE-RTL-PRCCTL-CDE                               24090000
241000            ,:TRNCDE-PO-NBR-REQR-IND                              24100000
241100            ,:TRNCDE-RSN-TXT-REQR-IND                             24110000
241200            ,:TRNCDE-SUB-CL-REQR-IND                              24120000
241300            ,:TRNCDE-SKU-SEQ-REQR-IND                             24130000
241400            ,:TRNCDE-FRGT-REQR-IND                                24140000
241500            ,:TRNCDE-GL-ACCT-NBR                                  24150000
241600            ,:TRNCDE-BTCH-SRC-CDE                                 24160000
241610            ,:TRNCDE-AP-PSTG-IND                                  24161033
241700         FROM TTRNCDE                                             24170000
241800         WHERE AP_TRN_CDE   =  :AP045-AP-TRN-CDE                  24180000
241900         AND   EFF_STRT_DTE <= CURRENT DATE                       24190000
242000         AND   EFF_END_DTE  >  CURRENT DATE                       24200000
242100     END-EXEC.                                                    24210000
242200                                                                  24220000
242300     EVALUATE TRUE                                                24230000
242400         WHEN SQLCODE = ZERO                                      24240000
242500             CONTINUE                                             24250000
242600                                                                  24260000
242700         WHEN SQLCODE = +100                                      24270000
242800             SET PS-ERROR-FATAL                                   24280000
242900                 PS-BYPASS-NOW   TO TRUE                          24290000
243000                                                                  24300000
243100         WHEN SQLWARN0 NOT = SPACES                               24310000
243200         WHEN SQLCODE  NOT = ZERO                                 24320000
243300             MOVE 'UNSUCCESSFUL SELECT FOR TRAN CODE    '         24330000
243400                                 TO AA-DB2-OPERATION              24340000
243500             MOVE 'TTRNCDE'      TO AA-DB2-TABLE-1                24350000
243600             MOVE SPACES         TO AA-DB2-TABLE-2                24360000
243700                                    AA-DB2-TABLE-3                24370000
243800             PERFORM Z999-DB2-ABEND                               24380000
243900     END-EVALUATE.                                                24390000
244000                                                                  24400000
244100                                                                  24410000
244200 S300-SELECT-ENTITY.                                              24420000
244300*---------------------------------------------------------------- 24430000
244400*   SELECTS ENTITY INFORMATION FROM TEXTENT, TPURCHS, & TENTNME   24440000
244500*---------------------------------------------------------------- 24450000
244600                                                                  24460000
244700     MOVE 'S300-SELECT-ENTITY '  TO AA-PARAGRAPH-NAME.            24470000
244800     INITIALIZE DCLTEXTENT                                        24480000
244900                DCLTENTNME.                                       24490000
245000                                                                  24500000
245100     EXEC SQL                                                     24510000
245200         SELECT EX.ENT_ID                                         24520000
245300              , DUN_NBR                                           24530000
245400              , NM.ENT_NAME_DESC                                  24540000
245500           INTO :EXTENT-ENT-ID                                    24550000
245600              , :EXTENT-DUN-NBR                                   24560000
245700              , :ENTNME-ENT-NAME-DESC                             24570000
245800           FROM TEXTENT EX                                        24580000
245900              , TENTNME NM                                        24590000
246000          WHERE DUN_NBR     =  :AP045-VND-NBR                     24600000
246100            AND EX.ENT_ID   =  NM.ENT_ID                          24610000
246200            AND NM.TYPE_CDE = '01'                                24620000
246300     END-EXEC.                                                    24630000
246400                                                                  24640000
246500     EVALUATE TRUE                                                24650000
246600         WHEN SQLCODE = ZERO                                      24660000
246700             SET PS-ENTITY-VALID                                  24670000
246800                                 TO TRUE                          24680000
246900         WHEN SQLCODE = +100                                      24690000
247000             SET PS-ENTITY-INVALID                                24700000
247100                                 TO TRUE                          24710000
247200                                                                  24720000
247300         WHEN SQLWARN0 NOT = SPACES                               24730000
247400         WHEN SQLCODE  NOT = ZERO                                 24740000
247500             DISPLAY 'AP045 VENDOR NUMBER = ' AP045-VND-NBR       24750000
247600             MOVE 'UNSUCCESSFUL SELECT FOR ENTITY DATA '          24760000
247700                                 TO AA-DB2-OPERATION              24770000
247800             MOVE 'TEXTENT'      TO AA-DB2-TABLE-1                24780000
247900             MOVE 'TENTNME'      TO AA-DB2-TABLE-2                24790000
248000             MOVE SPACES         TO AA-DB2-TABLE-3                24800000
248100             PERFORM Z999-DB2-ABEND                               24810000
248200     END-EVALUATE.                                                24820000
248300                                                                  24830000
248400                                                                  24840000
248500*S350-SELECT-ENTITY-PO.                                           24850000
248600*---------------------------------------------------------------- 24860000
248700*   SELECTS ENTITY INFORMATION FROM TEXTENT, TPURCHS, & TENTNME   24870000
248800*---------------------------------------------------------------- 24880000
248900*                                                                 24890000
249000*    MOVE 'S350-SELECT-ENTITY-PO '                                24900000
249100*                                TO AA-PARAGRAPH-NAME.            24910000
249200*    INITIALIZE DCLTEXTENT                                        24920000
249300*               DCLTPURCHS                                        24930000
249400*               DCLTENTNME.                                       24940000
249500*                                                                 24950000
249600*    EXEC SQL                                                     24960000
249700*        SELECT                                                   24970000
249800*            EX.ENT_ID                                            24980000
249900*           ,DUN_NBR                                              24990000
250000*           ,PO_NBR                                               25000000
250100*           ,DEPT_NBR                                             25010000
250200*           ,NM.ENT_NAME_DESC                                     25020000
250300*        INTO                                                     25030000
250400*            :EXTENT-ENT-ID                                       25040000
250500*           ,:EXTENT-DUN-NBR                                      25050000
250600*           ,:PURCHS-PO-NBR                                       25060000
250700*           ,:PURCHS-DEPT-NBR                                     25070000
250800*           ,:ENTNME-ENT-NAME-DESC                                25080000
250900*        FROM TEXTENT EX                                          25090000
251000*            ,TPURCHS PR                                          25100000
251100*            ,TENTNME NM                                          25110000
251200*        WHERE DUN_NBR           =  :AP045-VND-NBR                25120000
251300*        AND   PO_NBR            =  :PV-PO-NBR                    25130000
251400*        AND   EX.ENT_ID         =  PR.ENT_ID                     25140000
251500*        AND   EX.ENT_ID         =  NM.ENT_ID                     25150000
251600*        AND   PR.VER_STATUS_CDE = 'A'                            25160000
251700*        AND   NM.TYPE_CDE       = '01'                           25170000
251800*    END-EXEC.                                                    25180000
251900*                                                                 25190000
252000*    EVALUATE TRUE                                                25200000
252100*        WHEN SQLCODE = ZERO                                      25210000
252200*            SET PS-ENTITY-VALID                                  25220000
252300*                                TO TRUE                          25230000
252400*        WHEN SQLCODE = +100                                      25240000
252500*            SET PS-ENTITY-INVALID                                25250000
252600*                                TO TRUE                          25260000
252700*                                                                 25270000
252800*        WHEN SQLWARN0 NOT = SPACES                               25280000
252900*        WHEN SQLCODE  NOT = ZERO                                 25290000
253000*            DISPLAY 'AP045 VENDOR NUMBER = ' AP045-VND-NBR       25300000
253100*            MOVE 'UNSUCCESSFUL SELECT FOR ENTITY/PO NBR'         25310000
253200*                                TO AA-DB2-OPERATION              25320000
253300*            MOVE 'TEXTENT'      TO AA-DB2-TABLE-1                25330000
253400*            MOVE 'TPURCHS'      TO AA-DB2-TABLE-2                25340000
253500*            MOVE 'TENTNME'      TO AA-DB2-TABLE-3                25350000
253600*            PERFORM Z999-DB2-ABEND                               25360000
253700*    END-EVALUATE.                                                25370000
253800*                                                                 25380000
253900                                                                  25390000
254000 S400-SELECT-VENDOR-TADJRNL.                                      25400000
254100*---------------------------------------------------------------- 25410000
254200*  EDIT VND NBR                                                   25420000
254300*---------------------------------------------------------------- 25430000
254400                                                                  25440000
254500     MOVE 'S400-SELECT-VENDOR-TADJRNL '                           25450000
254600                                 TO AA-PARAGRAPH-NAME.            25460000
254700     INITIALIZE DCLTADJRNL.                                       25470000
254800                                                                  25480000
254900     EXEC SQL                                                     25490000
255000         SELECT                                                   25500000
255100             VND_NBR                                              25510000
255200            ,DOC_NBR                                              25520000
255300         INTO                                                     25530000
255400             :ADJRNL-VND-NBR                                      25540000
255500            ,:ADJRNL-DOC-NBR                                      25550000
255600         FROM TADJRNL                                             25560000
255700         WHERE VND_NBR      =  :AP045-VND-NBR                     25570000
255800         AND   DOC_NBR      =  :AP045-DOC-NBR                     25580000
255900     END-EXEC.                                                    25590000
256000                                                                  25600000
256100     EVALUATE TRUE                                                25610000
256200         WHEN SQLCODE = ZERO                                      25620000
256300         WHEN SQLCODE = -811                                      25630000
256400             SET PS-VENDOR-INVALID                                25640000
256500                                 TO TRUE                          25650000
256600         WHEN SQLCODE = +100                                      25660000
256700             SET PS-VENDOR-VALID                                  25670000
256800                                 TO TRUE                          25680000
256900             INITIALIZE ADJRNL-VND-NBR                            25690000
257000                        ADJRNL-DOC-NBR                            25700000
257100                                                                  25710000
257200         WHEN SQLWARN0 NOT = SPACES                               25720000
257300         WHEN SQLCODE  NOT = ZERO                                 25730000
257400             DISPLAY 'AP045 VENDOR NUMBER   = ' AP045-VND-NBR     25740000
257500             DISPLAY 'AP045 DOCUMENT NUMBER = ' AP045-DOC-NBR     25750000
257600             MOVE 'UNSUCCESSFUL SELECT FOR VENDOR/DOCUMENT NUMBER'25760000
257700                                 TO AA-DB2-OPERATION              25770000
257800             MOVE 'TADJRNL'      TO AA-DB2-TABLE-1                25780000
257900             MOVE SPACES         TO AA-DB2-TABLE-2                25790000
258000                                    AA-DB2-TABLE-3                25800000
258100             PERFORM Z999-DB2-ABEND                               25810000
258200     END-EVALUATE.                                                25820000
258300                                                                  25830000
258400                                                                  25840000
258500 S500-SELECT-GL-ACCOUNT-NBR.                                      25850000
258600*---------------------------------------------------------------- 25860000
258700*   SELECTS GL ACCOUNT NUMBER FROM APT_ACCT_TBL                   25870041
258800*---------------------------------------------------------------- 25880000
258900                                                                  25890000
259000     MOVE 'S500-SELECT-GL-ACCOUNT-NBR '                           25900000
259100                                 TO AA-PARAGRAPH-NAME.            25910000
259200     INITIALIZE PV-GL-ACCT-VARIABLES.                             25920000
259300                                                                  25930000
259400     EXEC SQL                                                     25940000
259500         SELECT                                                   25950000
259600             A.ACCOUNT                                            25960000
259700         INTO                                                     25970000
259800             :PV-GL-ACCT-ACCOUNT                                  25980000
259900         FROM APT_ACCT_TBL A                                      25990042
260000         WHERE A.ACCOUNT    =  :AP045-GL-ACCT-NBR                 26000000
260100           AND A.EFF_STATUS = 'A'                                 26010048
260110           AND A.EFFDT      =                                     26011048
260200               (SELECT MAX(A1.EFFDT)                              26020000
260300                FROM APT_ACCT_TBL A1                              26030042
260400                WHERE A1.ACCOUNT  = A.ACCOUNT                     26040000
260500                AND   A1.EFFDT   <= CURRENT DATE)                 26050000
260600     END-EXEC.                                                    26060000
260700                                                                  26070000
260800     EVALUATE TRUE                                                26080000
260900         WHEN SQLCODE = ZERO                                      26090000
261000             SET PV-GL-ACCOUNT-VALID                              26100000
261100                                 TO TRUE                          26110000
261200         WHEN SQLCODE = +100                                      26120000
261300             SET PV-GL-ACCOUNT-INVALID                            26130000
261400                                 TO TRUE                          26140000
261500             INITIALIZE PV-GL-ACCT-VARIABLES                      26150000
261600                                                                  26160000
261700         WHEN SQLWARN0 NOT = SPACES                               26170000
261800         WHEN SQLCODE  NOT = ZERO                                 26180000
261900             DISPLAY 'AP045 GL ACCOUNT NBR = ' AP045-GL-ACCT-NBR  26190000
262000             MOVE 'UNSUCCESSFUL SELECT FOR GL ACCOUNT NBR'        26200000
262100                                 TO AA-DB2-OPERATION              26210000
262200             MOVE 'GL_ACCO'      TO AA-DB2-TABLE-1                26220000
262300             MOVE 'UNT_TBL'      TO AA-DB2-TABLE-2                26230000
262400             MOVE SPACES         TO AA-DB2-TABLE-3                26240000
262500             PERFORM Z999-DB2-ABEND                               26250000
262600     END-EVALUATE.                                                26260000
262700                                                                  26270000
262800                                                                  26280000
262900 S600-SELECT-MDSEAR.                                              26290000
263000*---------------------------------------------------------------- 26300000
263100*   SELECTS DEPT NBR FROM TMDSEAR                                 26310000
263200*---------------------------------------------------------------- 26320000
263300                                                                  26330000
263400     MOVE 'S600-SELECT-MDSEAR '  TO AA-PARAGRAPH-NAME.            26340000
263500     INITIALIZE DCLTMDSEAR.                                       26350000
263600                                                                  26360000
263700     EXEC SQL                                                     26370000
263800         SELECT                                                   26380000
263900             DEPT_NBR                                             26390000
264000            ,MAJ_CL_NBR                                           26400000
264100            ,SUB_CL_NBR                                           26410000
264200            ,MDSELV_CDE                                           26420000
264300         INTO                                                     26430000
264400             :MDSEAR-DEPT-NBR                                     26440000
264500            ,:MDSEAR-MAJ-CL-NBR                                   26450000
264600            ,:MDSEAR-SUB-CL-NBR                                   26460000
264700            ,:MDSEAR-MDSELV-CDE                                   26470000
264800         FROM TMDSEAR                                             26480000
264900         WHERE DEPT_NBR     =  :AP045-DEPT-NBR                    26490000
265000         AND   MDSELV_CDE   =  :PV-MDSEAR-MDSELV-CDE              26500000
265100         AND   MAJ_CL_NBR   =  :PV-MDSEAR-MAJ-CL-CDE              26510000
265200         AND   SUB_CL_NBR   =  :PV-MDSEAR-SUB-CL-CDE              26520000
265300         AND   STRT_DTE     <=  CURRENT DATE                      26530000
265400         AND   END_DTE      >=  CURRENT DATE                      26540000
265500     END-EXEC.                                                    26550000
265600                                                                  26560000
265700     EVALUATE TRUE                                                26570000
265800         WHEN SQLCODE = ZERO                                      26580000
265900             SET PS-MDSEAR-VALID                                  26590000
266000                                 TO TRUE                          26600000
266100         WHEN SQLCODE = +100                                      26610000
266200             SET PS-MDSEAR-INVALID                                26620000
266300                                 TO TRUE                          26630000
266400                                                                  26640000
266500         WHEN SQLWARN0 NOT = SPACES                               26650000
266600         WHEN SQLCODE  NOT = ZERO                                 26660000
266700             DISPLAY 'AP045 DEPARTMENT NBR = ' AP045-DEPT-NBR     26670000
266800             DISPLAY 'AP045 CLASS CODE = ' AP045-CL-NBR           26680000
266900             DISPLAY 'MDSEAR MDSELV CODE = ' PV-MDSEAR-MDSELV-CDE 26690000
267000             DISPLAY 'MDSEAR MAJ CL CODE = ' PV-MDSEAR-MAJ-CL-CDE 26700000
267100             DISPLAY 'MDSEAR SUB CL CODE = ' PV-MDSEAR-SUB-CL-CDE 26710000
267200             STRING 'UNSUCCESSFUL SELECT FOR '                    26720000
267300                    PV-MDSEAR-MDSELV-CDE                          26730000
267400               DELIMITED BY SIZE                                  26740000
267500               INTO AA-DB2-OPERATION                              26750000
267600             END-STRING                                           26760000
267700             MOVE 'TMDSEAR'      TO AA-DB2-TABLE-1                26770000
267800             MOVE SPACES         TO AA-DB2-TABLE-2                26780000
267900                                    AA-DB2-TABLE-3                26790000
268000             PERFORM Z999-DB2-ABEND                               26800000
268100     END-EVALUATE.                                                26810000
268200                                                                  26820000
268300                                                                  26830000
268400*---------------------------------------------------------------- 26840000
268500*   SELECTS DATA FROM TPURCHS                                     26850000
268600*---------------------------------------------------------------- 26860000
268700 S700-SELECT-PURCHS.                                              26870000
268800                                                                  26880000
268900     MOVE 'S700-SELECT-PURCHS '  TO AA-PARAGRAPH-NAME.            26890000
269000     INITIALIZE DCLTPURCHS.                                       26900000
269100                                                                  26910000
269200     EXEC SQL                                                     26920000
269300         SELECT                                                   26930000
269400             ENT_ID                                               26940000
269500            ,DEPT_NBR                                             26950000
269600            ,PO_TYP_CDE                                           26960000
269700         INTO                                                     26970000
269800             :PURCHS-ENT-ID                                       26980000
269900            ,:PURCHS-DEPT-NBR                                     26990000
270000            ,:PURCHS-PO-TYP-CDE                                   27000000
270100         FROM TPURCHS                                             27010000
270200         WHERE PO_NBR            =  :PV-PO-NBR                    27020000
270300         AND   VER_STATUS_CDE    = 'A'                            27030000
270400     END-EXEC.                                                    27040000
270500                                                                  27050000
270600     EVALUATE TRUE                                                27060000
270700         WHEN SQLCODE = ZERO                                      27070000
270800             SET PS-PURCHS-VALID TO TRUE                          27080000
270900         WHEN SQLCODE = +100                                      27090000
271000             SET PS-PURCHS-INVALID TO TRUE                        27100000
271100         WHEN SQLWARN0 NOT = SPACES                               27110000
271200         WHEN SQLCODE  NOT = ZERO                                 27120000
271300             DISPLAY 'AP045 PO-NBR      = ' AP045-PO-NBR          27130000
271400             MOVE 'UNSUCCESSFUL SELECT FOR PO' TO AA-DB2-OPERATION27140000
271500             MOVE 'TPURCHS'      TO AA-DB2-TABLE-1                27150000
271600             PERFORM Z999-DB2-ABEND                               27160000
271700     END-EVALUATE.                                                27170000
271800                                                                  27180000
271900                                                                  27190000
272000 S800-SELECT-STORE.                                               27200000
272100*---------------------------------------------------------------- 27210000
272200*   SELECTS STORE NUMBER FROM XFT00017                            27220000
272300*---------------------------------------------------------------- 27230000
272400                                                                  27240000
272500     MOVE 'S800-SELECT-STORE '   TO AA-PARAGRAPH-NAME.            27250000
272600     INITIALIZE DCLXFT00017.                                      27260000
272700     MOVE PV-STORE-NBR TO PV-DB2-STR.                             27270000
272800                                                                  27280000
272900     EXEC SQL                                                     27290000
273000         SELECT LOC_NBR                                           27300000
273100              , LOC_TYP_CDE                                       27310000
273200              , FINCL_CLO_DTE                                     27320000
273300           INTO :XFT00017-LOC-NBR                                 27330000
273400              , :XFT00017-LOC-TYP-CDE                             27340000
273500              , :XFT00017-FINCL-CLO-DTE                           27350000
273600           FROM XFT_LOC                                           27360000
273700          WHERE LOC_NBR = :PV-DB2-STR                             27370000
273800            AND LOC_TYP_CDE IN                                    27380000
273900                ('DC', 'DS', 'CS', 'RV', 'HQ', 'AL', 'DA')        27390000
274000            AND FINCL_CLO_DTE >= CURRENT DATE                     27400000
274100     END-EXEC.                                                    27410000
274200                                                                  27420000
274300     EVALUATE TRUE                                                27430000
274400         WHEN SQLCODE = ZERO                                      27440000
274500             SET PS-STORE-VALID                                   27450000
274600                                 TO TRUE                          27460000
274700         WHEN SQLCODE = +100                                      27470000
274800             SET PS-STORE-INVALID                                 27480000
274900                                 TO TRUE                          27490000
275000                                                                  27500000
275100         WHEN SQLWARN0 NOT = SPACES                               27510000
275200         WHEN SQLCODE  NOT = ZERO                                 27520000
275300             DISPLAY 'DB2 STORE = ' PV-STORE-NBR                  27530000
275400             DISPLAY 'AP045 STORE NBR = ' AP045-STR-NBR           27540000
275500             MOVE 'UNSUCCESSFUL SELECT FOR STORE NUMBER'          27550000
275600                                 TO AA-DB2-OPERATION              27560000
275700             MOVE 'XFT00017'     TO AA-DB2-TABLE-1                27570000
275800             MOVE SPACES         TO AA-DB2-TABLE-2                27580000
275900                                    AA-DB2-TABLE-3                27590000
276000             PERFORM Z999-DB2-ABEND                               27600000
276100     END-EVALUATE.                                                27610000
276200                                                                  27620000
276300                                                                  27630000
276400 S900-SELECT-SKU.                                                 27640000
276500*---------------------------------------------------------------- 27650000
276600*   SELECTS SKU FROM TSKXREF                                      27660000
276700*---------------------------------------------------------------- 27670000
276800                                                                  27680000
276900     MOVE 'S900-SELECT-SKU '     TO AA-PARAGRAPH-NAME.            27690000
277000     INITIALIZE DCLTSKXREF.                                       27700000
277100     SET PS-SKU-VALID            TO TRUE.                         27710000
277200                                                                  27720000
277300     EXEC SQL                                                     27730000
277400         SELECT SKU                                               27740000
277500         INTO                                                     27750000
277600             :SKXREF-SKU                                          27760000
277700         FROM TSKXREF                                             27770000
277800         WHERE SKU = :PV-SKU-NBR                                  27780000
277900           AND DEPT = :PV-DEPARTMENT                              27790000
278000           AND SUBCLASS = :PV-CLASS                               27800000
278100     END-EXEC.                                                    27810000
278200                                                                  27820000
278300     EVALUATE TRUE                                                27830000
278400         WHEN SQLCODE = ZERO                                      27840000
278500             CONTINUE                                             27850000
278600                                                                  27860000
278700         WHEN SQLCODE = +100                                      27870000
278800             SET PS-SKU-INVALID  TO TRUE                          27880000
278900                                                                  27890000
279000         WHEN SQLWARN0 NOT = SPACES                               27900000
279100         WHEN SQLCODE  NOT = ZERO                                 27910000
279200             DISPLAY 'AP045 AP SKU = ' AP045-SKU-NBR              27920000
279300             MOVE 'UNSUCCESSFUL SELECT FOR SKU    '               27930000
279400                                 TO AA-DB2-OPERATION              27940000
279500             MOVE 'TSKXREF'      TO AA-DB2-TABLE-1                27950000
279600             MOVE SPACES         TO AA-DB2-TABLE-2                27960000
279700                                    AA-DB2-TABLE-3                27970000
279800             PERFORM Z999-DB2-ABEND                               27980000
279900     END-EVALUATE.                                                27990000
280000                                                                  28000000
280100                                                                  28010000
280200 W100-WRITE-AP045-EDITD-RECORD.                                   28020000
280300*---------------------------------------------------------------- 28030000
280400*    WRITES THE AP045 EDITED RECORD.                              28040000
280500*---------------------------------------------------------------- 28050000
280600                                                                  28060000
280700     WRITE EDITD-TRANS-RECORD    FROM EDITD-TRANSACTION-FILE.     28070000
280800     ADD +1                      TO PV-COUNT-WRITTEN.             28080000
280900                                                                  28090000
281000                                                                  28100000
281100 W200-WRITE-ERROR-EXCPT-RECORD.                                   28110000
281200*---------------------------------------------------------------- 28120000
281300*    WRITES THE AP122 ERROR/EXCEPTION RECORD                      28130000
281400*---------------------------------------------------------------- 28140000
281500                                                                  28150000
281600     WRITE ADJ-ERR-EXCPT-RECORD                                   28160000
281700      FROM AP122-ADJ-INTERFACE-EXCEPTIONS.                        28170000
281800                                                                  28180000
281900     IF PS-ERROR-FATAL                                            28190000
282000        ADD +1                   TO PV-COUNT-ERRORS               28200000
282100     END-IF.                                                      28210000
282200     IF PS-ERROR-WARNING                                          28220000
282300        ADD +1                   TO PV-COUNT-WARNINGS             28230000
282400     END-IF.                                                      28240000
282500     INITIALIZE AP122-ERROR-TYP-CDE                               28250000
282600                AP122-ERROR-FIELD                                 28260000
282700                AP122-ERROR-VALUE                                 28270000
282800                AP122-ERROR-MESSAGE.                              28280000
282900                                                                  28290000
283000 X100-COMMIT.                                                     28300000
283100*---------------------------------------------------------------- 28310000
283200*   COMMIT.                                                       28320000
283300*---------------------------------------------------------------- 28330000
283400                                                                  28340000
283500     MOVE 'X100-COMMIT       '   TO AA-PARAGRAPH-NAME.            28350000
283600                                                                  28360000
283700     EXEC SQL                                                     28370000
283800         COMMIT                                                   28380000
283900     END-EXEC.                                                    28390000
284000                                                                  28400000
284100     EVALUATE TRUE                                                28410000
284200         WHEN SQLCODE = ZERO                                      28420000
284300             CONTINUE                                             28430000
284400         WHEN SQLWARN0 NOT = SPACES                               28440000
284500         WHEN SQLCODE  NOT = ZERO                                 28450000
284600             MOVE 'UNSUCCESSFUL COMMIT '                          28460000
284700                                 TO AA-DB2-OPERATION              28470000
284800             MOVE SPACES         TO AA-DB2-TABLE-1                28480000
284900             MOVE SPACES         TO AA-DB2-TABLE-2                28490000
285000                                    AA-DB2-TABLE-3                28500000
285100             PERFORM Z999-DB2-ABEND                               28510000
285200     END-EVALUATE.                                                28520000
285300                                                                  28530000
285400                                                                  28540000
285500 Z998-ABEND.                                                      28550000
285600*---------------------------------------------------------------- 28560000
285700*    ABEND ROUTINE FOR NON DB2 ERRORS                             28570000
285800*---------------------------------------------------------------- 28580000
285900                                                                  28590000
286000     CLOSE ADJ-TRANS-FILE                                         28600000
286200           EDITD-TRANS-FILE                                       28620000
286300           ADJ-ERR-EXCPT-FILE.                                    28630000
286400                                                                  28640000
286500     COMPUTE PV-COUNT-RPT = PV-COUNT-WARNINGS + PV-COUNT-ERRORS.  28650000
286600     DISPLAY 'NBR OF ERROR FREE PROCESSED  = ' PV-COUNT-CLEAN.    28660000
286700     DISPLAY 'NBR OF WARNINGS PROCESSED    = ' PV-COUNT-WARNINGS. 28670000
286800     DISPLAY 'NBR OF ERRORS   PROCESSED    = ' PV-COUNT-ERRORS.   28680000
286900     DISPLAY 'TOTAL AP045 RECORDS READ     = ' PV-COUNT-READ.     28690000
287000     DISPLAY ' '.                                                 28700000
287100     DISPLAY 'NBR OF AP045 EDITED WRITTEN  = ' PV-COUNT-WRITTEN.  28710000
287200     DISPLAY ' '.                                                 28720000
287300     DISPLAY 'TOTAL ERROR/WARNINGS WRITTEN = ' PV-COUNT-RPT.      28730000
287400     DISPLAY ' '.                                                 28740000
287500     DISPLAY 'APKUT136 END OF PROCESSING '.                       28750000
287600     DISPLAY '* * * * * * * * * * * * * * * * * * * * * * *'.     28760000
287700     DISPLAY AA-ABEND-LIT.                                        28770000
287800     DISPLAY AA-MESSAGE-LINE.                                     28780000
287900     DISPLAY AA-PROGRAM-LIT.                                      28790000
288000     DISPLAY AA-PARAGRAPH-LIT.                                    28800000
288100                                                                  28810000
288200     CALL 'ILBOABN0' USING ABEND-CODE.                            28820000
288300                                                                  28830000
288400                                                                  28840000
288500*---------------------------------------------------------------- 28850000
288600*    ABEND ROUTINE FOR DB2 ERRORS                                 28860000
288700*---------------------------------------------------------------- 28870000
288800 Z999-DB2-ABEND.                                                  28880000
288900                                                                  28890000
289000     CLOSE ADJ-TRANS-FILE                                         28900000
289200           EDITD-TRANS-FILE                                       28920000
289300           ADJ-ERR-EXCPT-FILE.                                    28930000
289400                                                                  28940000
289500     DISPLAY 'KEY OF LAST RECORD READ = ' AP045-KEY-FIELDS.       28950000
289600                                                                  28960000
289700     COMPUTE PV-COUNT-RPT = PV-COUNT-WARNINGS + PV-COUNT-ERRORS.  28970000
289800     DISPLAY 'NBR OF ERROR FREE PROCESSED  = ' PV-COUNT-CLEAN.    28980000
289900     DISPLAY 'NBR OF WARNINGS PROCESSED    = ' PV-COUNT-WARNINGS. 28990000
290000     DISPLAY 'NBR OF ERRORS   PROCESSED    = ' PV-COUNT-ERRORS.   29000000
290100     DISPLAY 'TOTAL AP045 RECORDS READ     = ' PV-COUNT-READ.     29010000
290200     DISPLAY ' '.                                                 29020000
290300     DISPLAY 'NBR OF AP045 EDITED WRITTEN  = ' PV-COUNT-WRITTEN.  29030000
290400     DISPLAY ' '.                                                 29040000
290500     DISPLAY 'TOTAL ERROR/WARNINGS WRITTEN = ' PV-COUNT-RPT.      29050000
290600     DISPLAY ' '.                                                 29060000
290700     DISPLAY 'APKUT136 END OF PROCESSING '.                       29070000
290800     DISPLAY '* * * * * * * * * * * * * * * * * * * * * * *'.     29080000
290900     DISPLAY AA-ABEND-LIT.                                        29090000
291000     DISPLAY AA-MESSAGE-LINE.                                     29100000
291100     DISPLAY AA-DB2-ERROR-LIT.                                    29110000
291200     DISPLAY AA-PROGRAM-LIT.                                      29120000
291300     DISPLAY AA-PARAGRAPH-LIT.                                    29130000
291400     DISPLAY AA-DB2-OPERATION-LIT.                                29140000
291500     DISPLAY AA-DB2-TABLE-1.                                      29150000
291600     DISPLAY AA-DB2-TABLE-2.                                      29160000
291700     DISPLAY AA-DB2-TABLE-3.                                      29170000
291800     SET AC-DB2-ERROR TO TRUE.                                    29180000
291900                                                                  29190000
292000     COPY DPPD004.                                                29200000
292100                                                                  29210000
292200     CALL 'ILBOABN0' USING ABEND-CODE.                            29220000
