000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     APKUT314.                                        00020001
000300 AUTHOR.         MIKE BESKE.                                      00030000
000400 DATE-WRITTEN.   JUNE 2007.                                       00040000
000500*************************************************************     00050000
000600*    COBOL 2 WITH DB2 SQL                                   *     00060000
000700*                                                           *     00070000
000700*  AP CODE FILES EXTRACT FOR EDW SYSTEM                     *     00080018
000700*                                                           *     00090018
000800*  THE PURPOSE OF THIS PROGRAM IS TO PRODUCE MANY CODE FILES*     00100000
000900*  CONTAINING INFORMATION FROM THE AP LEGACY SYSTEM FOR     *     00110003
001000*  DATA WAREHOUSE EDW TABLES.                               *     00120000
001100*                                                           *     00130000
001200*************************************************************     00140000
001300*                                                           *     00150000
001400* DB2 TABLES:                                               *     00160000
001500*  1. AP TRANSACTION CODE TABLE                 (TTRNCDE)   *     00170005
001600*                                                           *     00180000
001700* OUTPUT:                                                   *     00190000
001800*  1. MERCHANDISE INVOICE TERMS SELECT CODE FILE (APRD200)  *     00200003
001900*  2. INVOICE TYPE CODE FILE                     (APRD201)  *     00210003
002000*  3. INVOICE MATCH LEVEL CODE FILE              (APRD202)  *     00220003
002100*  4. DUE DATE SOURCE CODE FILE                  (APRD203)  *     00230003
002200*  5. ALLOWANCE CHARGE TYPE CODE FILE            (APRD204)  *     00240003
002300*  6. ALLOWANCE CHARGE CODE FILE                 (APRD205)  *     00250003
002400*  7. PAYMENT PAY CYCLE CODE FILE                (APRD206)  *     00260003
002500*  8. PAYMENT PAY STATUS CODE FILE               (APRD207)  *     00270003
002600*  9. AP TRANSACTION TYPE CODE FILE              (APRD208)  *     00280003
002700* 10. AP TRANSACTION CODE FILE                   (APRD209)  *     00290003
002800*                                                           *     00300000
002900*************************************************************     00310000
003000* CHANGE LOG:                                               *     00320000
003100*                                                           *     00330000
003200* DATE  06/29/2007                                          *     00340001
003300*     CHANGE MADE: INITIAL IMPLEMENTATION.                  *     00350000
003400*     MADE BY: MIKE BESKE              WR/IR #: WR31780     *     00360000
003500*************************************************************     00370000
003600                                                                  00380000
003700 ENVIRONMENT DIVISION.                                            00390000
003800                                                                  00400000
003900 INPUT-OUTPUT SECTION.                                            00410000
004000                                                                  00420000
004100 FILE-CONTROL.                                                    00430000
004200     SELECT MDSE-INVC-TERM-SEL-FILE  ASSIGN TO OUT01.             00440003
004300     SELECT INVC-TYP-CD-FILE         ASSIGN TO OUT02.             00450003
004400     SELECT INVC-MTCH-LVL-CD-FILE    ASSIGN TO OUT03.             00460003
004500     SELECT DUE-DTE-SRC-CD-FILE      ASSIGN TO OUT04.             00470003
004600     SELECT ALW-CHRG-TYP-CD-FILE     ASSIGN TO OUT05.             00480003
004700     SELECT ALW-CHRG-CD-FILE         ASSIGN TO OUT06.             00490003
004800     SELECT PAYT-PAY-CYC-CD-FILE     ASSIGN TO OUT07.             00500003
004900     SELECT PAYT-PAY-STAT-CD-FILE    ASSIGN TO OUT08.             00510003
005000     SELECT AP-TRN-TYP-CD-FILE       ASSIGN TO OUT09.             00520003
005100     SELECT AP-TRN-CD-FILE           ASSIGN TO OUT10.             00530003
005200                                                                  00540000
005300 DATA DIVISION.                                                   00550000
005400                                                                  00560000
005500 FILE SECTION.                                                    00570000
005600 FD  MDSE-INVC-TERM-SEL-FILE                                      00580003
005700     RECORDING MODE IS F                                          00590000
005800     LABEL RECORDS ARE STANDARD                                   00600000
005900     DATA RECORD IS MDSE-INVC-TERM-SEL-REC.                       00610003
006000 01  MDSE-INVC-TERM-SEL-REC  PIC  X(031).                         00620003
006100                                                                  00630000
006200 FD  INVC-TYP-CD-FILE                                             00640003
006300     RECORDING MODE IS F                                          00650000
006400     LABEL RECORDS ARE STANDARD                                   00660000
006500     DATA RECORD IS INVC-TYP-CD-REC.                              00670003
006600 01  INVC-TYP-CD-REC         PIC  X(032).                         00680003
006700                                                                  00690000
006800 FD  INVC-MTCH-LVL-CD-FILE                                        00700003
006900     RECORDING MODE IS F                                          00710000
007000     LABEL RECORDS ARE STANDARD                                   00720000
007100     DATA RECORD IS INVC-MTCH-LVL-CD-REC.                         00730003
007200 01  INVC-MTCH-LVL-CD-REC    PIC  X(031).                         00740003
007300                                                                  00750000
007400 FD  DUE-DTE-SRC-CD-FILE                                          00760003
007500     RECORDING MODE IS F                                          00770000
007600     LABEL RECORDS ARE STANDARD                                   00780000
007700     DATA RECORD IS DUE-DTE-SRC-CD-REC.                           00790003
007800 01  DUE-DTE-SRC-CD-REC      PIC  X(031).                         00800003
007900                                                                  00810000
008000 FD  ALW-CHRG-TYP-CD-FILE                                         00820003
008100     RECORDING MODE IS F                                          00830000
008200     LABEL RECORDS ARE STANDARD                                   00840000
008300     DATA RECORD IS ALW-CHRG-TYP-CD-REC.                          00850003
008400 01  ALW-CHRG-TYP-CD-REC     PIC  X(031).                         00860003
008500                                                                  00870000
008600 FD  ALW-CHRG-CD-FILE                                             00880003
008700     RECORDING MODE IS F                                          00890000
008800     LABEL RECORDS ARE STANDARD                                   00900000
008900     DATA RECORD IS ALW-CHRG-CD-REC.                              00910004
009000 01  ALW-CHRG-CD-REC         PIC  X(034).                         00920004
009100                                                                  00930000
009200 FD  PAYT-PAY-CYC-CD-FILE                                         00940003
009300     RECORDING MODE IS F                                          00950000
009400     LABEL RECORDS ARE STANDARD                                   00960000
009500     DATA RECORD IS PAYT-PAY-CYC-CD-REC.                          00970004
009600 01  PAYT-PAY-CYC-CD-REC     PIC  X(036).                         00980004
009700                                                                  00990000
009800 FD  PAYT-PAY-STAT-CD-FILE                                        01000003
009900     RECORDING MODE IS F                                          01010000
010000     LABEL RECORDS ARE STANDARD                                   01020000
010100     DATA RECORD IS PAYT-PAY-STAT-CD-REC.                         01030004
010200 01  PAYT-PAY-STAT-CD-REC    PIC  X(031).                         01040004
010300                                                                  01050000
010400 FD  AP-TRN-TYP-CD-FILE                                           01060003
010500     RECORDING MODE IS F                                          01070000
010600     LABEL RECORDS ARE STANDARD                                   01080000
010700     DATA RECORD IS AP-TRN-TYP-CD-REC.                            01090004
010800 01  AP-TRN-TYP-CD-REC       PIC  X(033).                         01100004
010900                                                                  01110000
011000 FD  AP-TRN-CD-FILE                                               01120003
011100     RECORDING MODE IS F                                          01130000
011200     LABEL RECORDS ARE STANDARD                                   01140000
011300     DATA RECORD IS AP-TRN-CD-REC.                                01150004
011400 01  AP-TRN-CD-REC           PIC  X(058).                         01160004
011500                                                                  01170000
011600/                                                                 01180000
011700 WORKING-STORAGE SECTION.                                         01190000
011800                                                                  01200000
011900 01  FILLER                        PIC X(25)  VALUE               01210000
012000                             'WS FOR APKUT314 BEGINS==>'.         01220001
012100                                                                  01230000
012200 01  WS-RETRY-COUNTER              PIC S9(4)  COMP VALUE ZERO.    01240000
012300 01  WS-RETRY-MAX                  PIC S9(4)  COMP VALUE 3.       01250000
012400                                                                  01260000
012500 01  PS-SWITCH-AREA.                                              01270000
012600     05  WS-END-OF-APTRN-CD-SW         PIC X(1)   VALUE 'N'.      01280005
012700         88  WS-END-OF-APTRN-CD-CSR               VALUE 'Y'.      01290005
012800                                                                  01300000
012900 01  WS-INTEGER-UNPK               PIC S9(10).                    01310000
013000 01  WS-SMALLINT-UNPK              PIC S9(4).                     01320000
013100 01  WS-CHARGE-UNPK                PIC S9(3)V9(4).                01330000
013200 01  WS-DISCOUNT-UNPK              PIC S9(2)V9(2).                01340000
013300 01  WS-CHRG-PCT                   PIC S9(3)V9(4) COMP-3.         01350000
013400 01  WS-DISC-PCT                   PIC S9(2)V9(2) COMP-3.         01360000
013500                                                                  01370000
013600 01  WS-INTEGER-EDIT               PIC ++++++++++9.               01380000
013700 01  WS-SMALLINT-EDIT              PIC +++++9.                    01390000
013800 01  WS-PERCENT-EDIT               PIC ++++.999.                  01400000
013900                                                                  01410000
014000 01  WS-PROGRAM-COUNTERS.                                         01420000
014100     05  WS-APTRN-REC-ROWS-FETCHED      PIC  9(09) VALUE ZEROS.   01430005
014200     05  WS-MDSE-INVC-TERM-SEL-REC-OUT  PIC  9(09) VALUE ZEROS.   01440004
014300     05  WS-INVC-TYP-CD-REC-OUT         PIC  9(09) VALUE ZEROS.   01450004
014400     05  WS-INVC-MTCH-LVL-CD-REC-OUT    PIC  9(09) VALUE ZEROS.   01460004
014500     05  WS-DUE-DTE-SRC-CD-REC-OUT      PIC  9(09) VALUE ZEROS.   01470004
014600     05  WS-ALW-CHRG-TYP-CD-REC-OUT     PIC  9(09) VALUE ZEROS.   01480004
014700     05  WS-ALW-CHRG-CD-REC-OUT         PIC  9(09) VALUE ZEROS.   01490004
014800     05  WS-PAYT-PAY-CYC-CD-REC-OUT     PIC  9(09) VALUE ZEROS.   01500004
014900     05  WS-PAYT-PAY-STAT-CD-REC-OUT    PIC  9(09) VALUE ZEROS.   01510004
015000     05  WS-AP-TRN-TYP-CD-REC-OUT       PIC  9(09) VALUE ZEROS.   01520004
015100     05  WS-AP-TRN-CD-REC-OUT           PIC  9(09) VALUE ZEROS.   01530004
015200                                                                  01540000
015300 01  TABLE-AREA.                                                  01550000
015400***************************************************************** 01560000
015500*** INTERNAL ARRAY HOLDS MERCHANDISE INVOICE TERM SELECT          01570006
015600*** CODES AND DESCRIPTIONS                                        01580006
015700     05  MDSE-INVC-TERM-CODES.                                    01590006
015800         10  MDSE-INVC-TERM-1            PIC X(01)  VALUE 'I'.    01600006
015900         10  MDSE-INVC-TERM-DESC-1       PIC X(30)  VALUE         01610006
016000                      'INVOICE                       '.           01620006
016100         10  MDSE-INVC-TERM-2            PIC X(01)  VALUE 'P'.    01630006
016200         10  MDSE-INVC-TERM-DESC-2       PIC X(30)  VALUE         01640006
016300                      'PURCHASE ORDER                '.           01650006
016400     05  MDSE-INVC-TERM-TABLE REDEFINES                           01660006
016500                        MDSE-INVC-TERM-CODES.                     01670006
016600         10  MDSE-INVC-TERM-ENTRIES OCCURS 02 TIMES               01680006
016700                               INDEXED BY IDX1.                   01690006
016800             15  TBL-MDSE-INVC-TERM-CD   PIC X(01).               01700006
016900             15  TBL-MDSE-INVC-TERM-DESC PIC X(30).               01710006
017000                                                                  01720006
017100***************************************************************** 01730006
017200*** INTERNAL ARRAY HOLDS INVOICE TYPE CODES AND DESCRIPTIONS      01740006
017300     05  INVC-TYP-CODES.                                          01750006
017400         10  INVC-TYP-1          PIC X(02)  VALUE 'EI'.           01760006
017500         10  INVC-TYP-DESC-1     PIC X(30)  VALUE                 01770006
017600                      'EXPENSE INVOICE               '.           01780006
017700         10  INVC-TYP-2          PIC X(02)  VALUE 'MI'.           01790006
017800         10  INVC-TYP-DESC-2     PIC X(30)  VALUE                 01800006
017900                      'MERCHANDISE INVOICE           '.           01810006
018000         10  INVC-TYP-3          PIC X(02)  VALUE 'RI'.           01820006
018100         10  INVC-TYP-DESC-3     PIC X(30)  VALUE                 01830006
018200                      'REMAINDER INVOICE             '.           01840006
018300         10  INVC-TYP-4          PIC X(02)  VALUE 'WO'.           01850006
018400         10  INVC-TYP-DESC-4     PIC X(30)  VALUE                 01860006
018500                      'WRITE OFF INVOICE             '.           01870006
018600     05  INVC-TYP-TABLE REDEFINES                                 01880006
018700                        INVC-TYP-CODES.                           01890006
018800         10  INVC-TYP-ENTRIES OCCURS 04 TIMES                     01900006
018900                               INDEXED BY IDX2.                   01910006
019000             15  TBL-INVC-TYP-CD      PIC X(02).                  01920006
019100             15  TBL-INVC-TYP-DESC    PIC X(30).                  01930006
019200                                                                  01940006
019300***************************************************************** 01950006
019400*** INTERNAL ARRAY HOLDS INVOICE MATCH LEVEL                      01960006
019500*** CODES AND DESCRIPTIONS                                        01970006
019600     05  MTCH-LVL-CODES.                                          01980006
019700         10  MTCH-LVL-1          PIC X(01)  VALUE 'D'.            01990006
019800         10  MTCH-LVL-DESC-1     PIC X(30)  VALUE                 02000006
019900                      'DISTRIBUTION CENTER LEVEL     '.           02010006
020000         10  MTCH-LVL-2          PIC X(01)  VALUE 'P'.            02020006
020100         10  MTCH-LVL-DESC-2     PIC X(30)  VALUE                 02030006
020200                      'PO LEVEL                      '.           02040006
020300         10  MTCH-LVL-3          PIC X(01)  VALUE 'S'.            02050006
020400         10  MTCH-LVL-DESC-3     PIC X(30)  VALUE                 02060006
020500                      'STORE LEVEL                   '.           02070006
020600     05  MTCH-LVL-TABLE REDEFINES                                 02080006
020700                        MTCH-LVL-CODES.                           02090006
020800         10  MTCH-LVL-ENTRIES OCCURS 03 TIMES                     02100006
020900                               INDEXED BY IDX3.                   02110006
021000             15  TBL-MTCH-LVL-CD      PIC X(01).                  02120006
021100             15  TBL-MTCH-LVL-DESC    PIC X(30).                  02130006
021200                                                                  02140006
021300***************************************************************** 02150006
021400*** INTERNAL ARRAY HOLDS DUE DATE SOURCE CODES AND DESCRIPTIONS   02160007
021500     05  DUE-DTE-SRC-CODES.                                       02170007
021600         10  DUE-DTE-SRC-1       PIC X(01)  VALUE ' '.            02180007
021700         10  DUE-DTE-SRC-DESC-1  PIC X(30)  VALUE                 02190007
021800                      'UNKNOWN                       '.           02200007
021900         10  DUE-DTE-SRC-2       PIC X(01)  VALUE 'I'.            02210007
022000         10  DUE-DTE-SRC-DESC-2  PIC X(30)  VALUE                 02220007
022100                      'INVOICE                       '.           02230007
022200         10  DUE-DTE-SRC-3       PIC X(01)  VALUE 'R'.            02240007
022300         10  DUE-DTE-SRC-DESC-3  PIC X(30)  VALUE                 02250007
022400                      'RECEIVER                      '.           02260007
022500         10  DUE-DTE-SRC-4       PIC X(01)  VALUE 'X'.            02270007
022600         10  DUE-DTE-SRC-DESC-4  PIC X(30)  VALUE                 02280007
022700                      'EXCEPTION                     '.           02290007
022800     05  DUE-DTE-SRC-TABLE REDEFINES                              02300007
022900                        DUE-DTE-SRC-CODES.                        02310007
023000         10  DUE-DTE-SRC-ENTRIES OCCURS 04 TIMES                  02320007
023100                               INDEXED BY IDX4.                   02330006
023200             15  TBL-DUE-DTE-SRC-CD   PIC X(01).                  02340007
023300             15  TBL-DUE-DTE-SRC-DESC PIC X(30).                  02350007
023400                                                                  02360006
023500***************************************************************** 02370006
023600*** INTERNAL ARRAY HOLDS ALLOWANCE CHARGE TYPE                    02380007
023700*** CODES AND DESCRIPTIONS                                        02390007
023800     05  ALW-CHRG-TYP-CODES.                                      02400007
023900         10  ALW-CHRG-TYP-1      PIC X(01)  VALUE 'A'.            02410007
024000         10  ALW-CHRG-TYP-DESC-1 PIC X(30)  VALUE                 02420007
024100                      'ALLOWANCE                     '.           02430007
024200         10  ALW-CHRG-TYP-2      PIC X(01)  VALUE 'C'.            02440007
024300         10  ALW-CHRG-TYP-DESC-2 PIC X(30)  VALUE                 02450007
024400                      'CHARGE                        '.           02460007
024500     05  ALW-CHRG-TYP-TABLE REDEFINES                             02470007
024600                        ALW-CHRG-TYP-CODES.                       02480007
024700         10  ALW-CHRG-TYP-ENTRIES OCCURS 02 TIMES                 02490007
024800                               INDEXED BY IDX5.                   02500007
024900             15  TBL-ALW-CHRG-TYP-CD  PIC X(01).                  02510007
025000             15  TBL-ALW-CHRG-TYP-DESC PIC X(30).                 02520007
025100                                                                  02530007
025200***************************************************************** 02540007
025300*** INTERNAL ARRAY HOLDS ALLOWANCE CHARGE CODES AND               02550007
025400*** DESCRIPTIONS                                                  02560007
025500     05  ALW-CHRG-CODES.                                          02570010
025600         10  ALW-CHRG-CODE-1     PIC X(03)  VALUE 'ADV'.          02580007
025700         10  ALW-CHRG-TYPE-1     PIC X(01)  VALUE 'A'.            02590007
025800         10  ALW-CHRG-DESC-1     PIC X(30)  VALUE                 02600007
025900                      'BROADCAST PROGRAM             '.           02610007
026000         10  ALW-CHRG-CODE-2     PIC X(03)  VALUE 'ALW'.          02620007
026100         10  ALW-CHRG-TYPE-2     PIC X(01)  VALUE 'A'.            02630007
026200         10  ALW-CHRG-DESC-2     PIC X(30)  VALUE                 02640007
026300                      'PROFIT ASSIST PROGRAM         '.           02650007
026400         10  ALW-CHRG-CODE-3     PIC X(03)  VALUE 'BRD'.          02660007
026500         10  ALW-CHRG-TYPE-3     PIC X(01)  VALUE 'A'.            02670007
026600         10  ALW-CHRG-DESC-3     PIC X(30)  VALUE                 02680007
026700                      'BRIDAL PROGRAM                '.           02690007
026800         10  ALW-CHRG-CODE-4     PIC X(03)  VALUE 'CDH'.          02700007
026900         10  ALW-CHRG-TYPE-4     PIC X(01)  VALUE 'C'.            02710007
027000         10  ALW-CHRG-DESC-4     PIC X(30)  VALUE                 02720007
027100                      'CONSUMER DIRECT HANDLING      '.           02730007
027200         10  ALW-CHRG-CODE-5     PIC X(03)  VALUE 'COP'.          02740007
027300         10  ALW-CHRG-TYPE-5     PIC X(01)  VALUE 'A'.            02750007
027400         10  ALW-CHRG-DESC-5     PIC X(30)  VALUE                 02760007
027500                      'CO-OP ADVERTISING PROGRAM     '.           02770007
027600         10  ALW-CHRG-CODE-6     PIC X(03)  VALUE 'DAS'.          02780007
027700         10  ALW-CHRG-TYPE-6     PIC X(01)  VALUE 'A'.            02790007
027800         10  ALW-CHRG-DESC-6     PIC X(30)  VALUE                 02800007
027900                      'DISCNT ASSOCIATED W/ SHORTAGE '.           02810007
028000         10  ALW-CHRG-CODE-7     PIC X(03)  VALUE 'DDA'.          02820007
028100         10  ALW-CHRG-TYPE-7     PIC X(01)  VALUE 'A'.            02830007
028200         10  ALW-CHRG-DESC-7     PIC X(30)  VALUE                 02840007
028300                      'DAMAGED OR DEFECTIVE ALLOWANCE'.           02850007
028400         10  ALW-CHRG-CODE-8     PIC X(03)  VALUE 'DDF'.          02860007
028500         10  ALW-CHRG-TYPE-8     PIC X(01)  VALUE 'C'.            02870007
028600         10  ALW-CHRG-DESC-8     PIC X(30)  VALUE                 02880007
028700                      'DECONSOLIDATION FEES          '.           02890007
028800         10  ALW-CHRG-CODE-9     PIC X(03)  VALUE 'DRA'.          02900007
028900         10  ALW-CHRG-TYPE-9     PIC X(01)  VALUE 'C'.            02910007
029000         10  ALW-CHRG-DESC-9     PIC X(30)  VALUE                 02920007
029100                      'DRAYAGE FEES                  '.           02930007
029200         10  ALW-CHRG-CODE-10    PIC X(03)  VALUE 'DSC'.          02940007
029300         10  ALW-CHRG-TYPE-10    PIC X(01)  VALUE 'A'.            02950007
029400         10  ALW-CHRG-DESC-10    PIC X(30)  VALUE                 02960007
029500                      'MISC DISCOUNT                 '.           02970007
029600         10  ALW-CHRG-CODE-11    PIC X(03)  VALUE 'DUP'.          02980007
029700         10  ALW-CHRG-TYPE-11    PIC X(01)  VALUE 'C'.            02990007
029800         10  ALW-CHRG-DESC-11    PIC X(30)  VALUE                 03000007
029900                      'DUTY PAID TO BROKER           '.           03010007
030000         10  ALW-CHRG-CODE-12    PIC X(03)  VALUE 'DUT'.          03020007
030100         10  ALW-CHRG-TYPE-12    PIC X(01)  VALUE 'C'.            03030007
030200         10  ALW-CHRG-DESC-12    PIC X(30)  VALUE                 03040007
030300                      'CUSTOMS DUTY                  '.           03050007
030400         10  ALW-CHRG-CODE-13    PIC X(03)  VALUE 'ENT'.          03060007
030500         10  ALW-CHRG-TYPE-13    PIC X(01)  VALUE 'C'.            03070007
030600         10  ALW-CHRG-DESC-13    PIC X(30)  VALUE                 03080007
030700                      'CUSTOMS ENTRY FEE             '.           03090007
030800         10  ALW-CHRG-CODE-14    PIC X(03)  VALUE 'FFA'.          03100007
030900         10  ALW-CHRG-TYPE-14    PIC X(01)  VALUE 'A'.            03110007
031000         10  ALW-CHRG-DESC-14    PIC X(30)  VALUE                 03120007
031100                      'FREIGHT ALLOWANCE             '.           03130007
031200         10  ALW-CHRG-CODE-15    PIC X(03)  VALUE 'FFC'.          03140007
031300         10  ALW-CHRG-TYPE-15    PIC X(01)  VALUE 'C'.            03150007
031400         10  ALW-CHRG-DESC-15    PIC X(30)  VALUE                 03160007
031500                      'FREIGHT CHARGE                '.           03170007
031600         10  ALW-CHRG-CODE-16    PIC X(03)  VALUE 'HGR'.          03180007
031700         10  ALW-CHRG-TYPE-16    PIC X(01)  VALUE 'C'.            03190007
031800         10  ALW-CHRG-DESC-16    PIC X(30)  VALUE                 03200007
031900                      'HANGER CHARGES                '.           03210007
032000         10  ALW-CHRG-CODE-17    PIC X(03)  VALUE 'IAC'.          03220007
032100         10  ALW-CHRG-TYPE-17    PIC X(01)  VALUE 'C'.            03230007
032200         10  ALW-CHRG-DESC-17    PIC X(30)  VALUE                 03240007
032300                      'IMPORT AGENT COMMISSION       '.           03250007
032400         10  ALW-CHRG-CODE-18    PIC X(03)  VALUE 'LCC'.          03260007
032500         10  ALW-CHRG-TYPE-18    PIC X(01)  VALUE 'C'.            03270007
032600         10  ALW-CHRG-DESC-18    PIC X(30)  VALUE                 03280007
032700                      'LETTER OF CREDIT AGENT CMMISSN'.           03290007
032800         10  ALW-CHRG-CODE-19    PIC X(03)  VALUE 'MIS'.          03300007
032900         10  ALW-CHRG-TYPE-19    PIC X(01)  VALUE 'C'.            03310007
033000         10  ALW-CHRG-DESC-19    PIC X(30)  VALUE                 03320007
033100                      'MISCELLANEOUS IMPORT CHARGES  '.           03330007
033200         10  ALW-CHRG-CODE-20    PIC X(03)  VALUE 'MOS'.          03340007
033300         10  ALW-CHRG-TYPE-20    PIC X(01)  VALUE 'A'.            03350007
033400         10  ALW-CHRG-DESC-20    PIC X(30)  VALUE                 03360007
033500                      'MARK OUT OF STOCK DISCOUNT    '.           03370007
033600         10  ALW-CHRG-CODE-21    PIC X(03)  VALUE 'MSC'.          03380007
033700         10  ALW-CHRG-TYPE-21    PIC X(01)  VALUE 'C'.            03390007
033800         10  ALW-CHRG-DESC-21    PIC X(30)  VALUE                 03400007
033900                      'MISC CHARGE                   '.           03410007
034000         10  ALW-CHRG-CODE-22    PIC X(03)  VALUE 'NSD'.          03420007
034100         10  ALW-CHRG-TYPE-22    PIC X(01)  VALUE 'A'.            03430007
034200         10  ALW-CHRG-DESC-22    PIC X(30)  VALUE                 03440007
034300                      'NEW STORE DISCOUNT            '.           03450007
034400         10  ALW-CHRG-CODE-23    PIC X(03)  VALUE 'OAF'.          03460007
034500         10  ALW-CHRG-TYPE-23    PIC X(01)  VALUE 'C'.            03470007
034600         10  ALW-CHRG-DESC-23    PIC X(30)  VALUE                 03480007
034700                      'OCEAN/AIR FREIGHT             '.           03490007
034800         10  ALW-CHRG-CODE-24    PIC X(03)  VALUE 'OCF'.          03500007
034900         10  ALW-CHRG-TYPE-24    PIC X(01)  VALUE 'C'.            03510007
035000         10  ALW-CHRG-DESC-24    PIC X(30)  VALUE                 03520007
035100                      'OVERSEAS CONSOLIDATION FEE    '.           03530007
035200         10  ALW-CHRG-CODE-25    PIC X(03)  VALUE 'ROY'.          03540007
035300         10  ALW-CHRG-TYPE-25    PIC X(01)  VALUE 'C'.            03550007
035400         10  ALW-CHRG-DESC-25    PIC X(30)  VALUE                 03560007
035500                      'LETTER OF CREDIT ROYALTY      '.           03570007
035600         10  ALW-CHRG-CODE-26    PIC X(03)  VALUE 'SAB'.          03580007
035700         10  ALW-CHRG-TYPE-26    PIC X(01)  VALUE 'C'.            03590007
035800         10  ALW-CHRG-DESC-26    PIC X(30)  VALUE                 03600007
035900                      'SHIPPING AND HANDLING         '.           03610007
036000         10  ALW-CHRG-CODE-27    PIC X(03)  VALUE 'SST'.          03620007
036100         10  ALW-CHRG-TYPE-27    PIC X(01)  VALUE 'C'.            03630007
036200         10  ALW-CHRG-DESC-27    PIC X(30)  VALUE                 03640007
036300                      'SALES TAX                     '.           03650007
036400         10  ALW-CHRG-CODE-28    PIC X(03)  VALUE 'TRD'.          03660007
036500         10  ALW-CHRG-TYPE-28    PIC X(01)  VALUE 'A'.            03670007
036600         10  ALW-CHRG-DESC-28    PIC X(30)  VALUE                 03680007
036700                      'TRADE DISCOUNT                '.           03690007
036800         10  ALW-CHRG-CODE-29    PIC X(03)  VALUE 'TTD'.          03700007
036900         10  ALW-CHRG-TYPE-29    PIC X(01)  VALUE 'A'.            03710007
037000         10  ALW-CHRG-DESC-29    PIC X(30)  VALUE                 03720007
037100                      'TRADE DISCOUNT                '.           03730007
037200         10  ALW-CHRG-CODE-30    PIC X(03)  VALUE 'TTV'.          03740007
037300         10  ALW-CHRG-TYPE-30    PIC X(01)  VALUE 'A'.            03750007
037400         10  ALW-CHRG-DESC-30    PIC X(30)  VALUE                 03760007
037500                      'TRANSPORTATION               '.            03770007
037600         10  ALW-CHRG-CODE-31    PIC X(03)  VALUE 'WSA'.          03780007
037700         10  ALW-CHRG-TYPE-31    PIC X(01)  VALUE 'A'.            03790007
037800         10  ALW-CHRG-DESC-31    PIC X(30)  VALUE                 03800007
037900                      'WAREHOUSING                   '.           03810007
038000         10  ALW-CHRG-CODE-32    PIC X(03)  VALUE '400'.          03820007
038100         10  ALW-CHRG-TYPE-32    PIC X(01)  VALUE 'C'.            03830007
038200         10  ALW-CHRG-DESC-32    PIC X(30)  VALUE                 03840007
038300                      'FREIGHT CHARGE                '.           03850007
038400         10  ALW-CHRG-CODE-33    PIC X(03)  VALUE '445'.          03860007
038500         10  ALW-CHRG-TYPE-33    PIC X(01)  VALUE 'C'.            03870007
038600         10  ALW-CHRG-DESC-33    PIC X(30)  VALUE                 03880007
038700                      'INSURANCE                     '.           03890007
038800     05  ALW-CHRG-CDE-TABLE REDEFINES                             03900014
038900                        ALW-CHRG-CODES.                           03910010
039000         10  ALW-CHRG-TYP-ENTRIES OCCURS 33 TIMES                 03920007
039100                               INDEXED BY IDX6.                   03930007
039200             15  TBL-ALW-CHRG-CODE       PIC X(03).               03940007
039300             15  TBL-ALW-CHRG-TYPE       PIC X(01).               03950007
039400             15  TBL-ALW-CHRG-DESC       PIC X(30).               03960007
039500                                                                  03970007
039600***************************************************************** 03980007
039700*** INTERNAL ARRAY HOLDS PAYMENT PAY CYCLE                        03990008
039800*** CODES AND DESCRIPTIONS                                        04000008
039900     05  PAYT-PAY-CYC-CODES.                                      04010008
040000         10  PAYT-PAY-CYC-1      PIC X(06)  VALUE 'GROUP1'.       04020008
040100         10  PAYT-PAY-CYC-DESC-1 PIC X(30)  VALUE                 04030008
040200                      'GROUP1 PAY CYCLE              '.           04040008
040300         10  PAYT-PAY-CYC-2      PIC X(06)  VALUE 'QUICK1'.       04050008
040400         10  PAYT-PAY-CYC-DESC-2 PIC X(30)  VALUE                 04060008
040500                      'EXPRESS CHECK 1 PAY CYCLE     '.           04070008
040600         10  PAYT-PAY-CYC-3      PIC X(06)  VALUE 'QUICK2'.       04080008
040700         10  PAYT-PAY-CYC-DESC-3 PIC X(30)  VALUE                 04090008
040800                      'EXPRESS CHECK 2 PAY CYCLE     '.           04100008
040900         10  PAYT-PAY-CYC-4      PIC X(06)  VALUE 'QUICK3'.       04110008
041000         10  PAYT-PAY-CYC-DESC-4 PIC X(30)  VALUE                 04120008
041100                      'EXPRESS CHECK 3 PAY CYCLE     '.           04130008
041200         10  PAYT-PAY-CYC-5      PIC X(06)  VALUE 'QUICK4'.       04140008
041300         10  PAYT-PAY-CYC-DESC-5 PIC X(30)  VALUE                 04150008
041400                      'EXPRESS CHECK 4 PAY CYCLE     '.           04160008
041500         10  PAYT-PAY-CYC-6      PIC X(06)  VALUE 'QUICK5'.       04170008
041600         10  PAYT-PAY-CYC-DESC-6 PIC X(30)  VALUE                 04180008
041700                      'EXPRESS CHECK 5 PAY CYCLE     '.           04190008
041800         10  PAYT-PAY-CYC-7      PIC X(06)  VALUE 'QUICK6'.       04200008
041900         10  PAYT-PAY-CYC-DESC-7 PIC X(30)  VALUE                 04210008
042000                      'EXPRESS CHECK 6 PAY CYCLE     '.           04220008
042100         10  PAYT-PAY-CYC-8      PIC X(06)  VALUE 'QUICK7'.       04230008
042200         10  PAYT-PAY-CYC-DESC-8 PIC X(30)  VALUE                 04240008
042300                      'EXPRESS CHECK 7 PAY CYCLE     '.           04250008
042400         10  PAYT-PAY-CYC-9      PIC X(06)  VALUE 'QUICK8'.       04260008
042500         10  PAYT-PAY-CYC-DESC-9 PIC X(30)  VALUE                 04270008
042600                      'EXPRESS CHECK 8 PAY CYCLE     '.           04280008
042700         10  PAYT-PAY-CYC-10     PIC X(06)  VALUE 'QUICK9'.       04290008
042800         10  PAYT-PAY-CYC-DESC-10 PIC X(30) VALUE                 04300008
042900                      'EXPRESS CHECK 9 PAY CYCLE     '.           04310008
043000         10  PAYT-PAY-CYC-11     PIC X(06)  VALUE 'WEEKLY'.       04320008
043100         10  PAYT-PAY-CYC-DESC-11 PIC X(30) VALUE                 04330008
043200                      'WEEKLY PAY CYCLE              '.           04340008
043300     05  PAYT-PAY-CYC-TABLE REDEFINES                             04350008
043400                        PAYT-PAY-CYC-CODES.                       04360008
043500         10  PAYT-PAY-CYC-ENTRIES OCCURS 11 TIMES                 04370008
043600                               INDEXED BY IDX7.                   04380008
043700             15  TBL-PAYT-PAY-CYC-CD    PIC X(06).                04390008
043800             15  TBL-PAYT-PAY-CYC-DESC  PIC X(30).                04400008
043900                                                                  04410008
044000***************************************************************** 04420008
044100*** INTERNAL ARRAY HOLDS PAYMENT PAY STATUS                       04430008
044200*** CODES AND DESCRIPTIONS                                        04440008
044300     05  PAYT-PAY-STAT-CODES.                                     04450008
044400         10  PAYT-PAY-STAT-1     PIC X(01)  VALUE 'P'.            04460008
044500         10  PAYT-PAY-STAT-DESC-1 PIC X(30) VALUE                 04470008
044600                      'PAID                          '.           04480008
044700         10  PAYT-PAY-STAT-2     PIC X(01)  VALUE 'R'.            04490008
044800         10  PAYT-PAY-STAT-DESC-2 PIC X(30) VALUE                 04500008
044900                      'REPLACED                      '.           04510008
045000         10  PAYT-PAY-STAT-3     PIC X(01)  VALUE 'V'.            04520008
045100         10  PAYT-PAY-STAT-DESC-3 PIC X(30) VALUE                 04530008
045200                      'VOID                          '.           04540008
045300     05  PAYT-PAY-STAT-TABLE REDEFINES                            04550008
045400                        PAYT-PAY-STAT-CODES.                      04560008
045500         10  PAYT-PAY-STAT-ENTRIES OCCURS 03 TIMES                04570008
045600                               INDEXED BY IDX8.                   04580008
045700             15  TBL-PAYT-PAY-STAT-CD PIC X(01).                  04590008
045800             15  TBL-PAYT-PAY-STAT-DESC PIC X(30).                04600008
045900                                                                  04610008
046000***************************************************************** 04620008
046100*** INTERNAL ARRAY HOLDS AP TRANSACTION TYPE                      04630008
046200*** CODES AND DESCRIPTIONS                                        04640008
046300     05  AP-TRN-TYP-CODES.                                        04650008
046400         10  AP-TRN-TYP-1        PIC X(03)  VALUE 'EXP'.          04660008
046500         10  AP-TRN-TYP-DESC-1   PIC X(30) VALUE                  04670008
046600                      'EXPENSE                       '.           04680008
046700         10  AP-TRN-TYP-2        PIC X(03)  VALUE 'MDS'.          04690008
046800         10  AP-TRN-TYP-DESC-2   PIC X(30) VALUE                  04700008
046900                      'MERCHANDISE                   '.           04710008
047000     05  AP-TRN-TYP-TABLE REDEFINES                               04720008
047100                        AP-TRN-TYP-CODES.                         04730008
047200         10  AP-TRN-TYP-ENTRIES OCCURS 02 TIMES                   04740008
047300                               INDEXED BY IDX9.                   04750011
047400             15  TBL-AP-TRN-TYP-CD   PIC X(03).                   04760008
047500             15  TBL-AP-TRN-TYP-DESC PIC X(30).                   04770008
047600                                                                  04780008
047700***************************************************************** 04790017
047800*** INTERNAL ARRAY HOLDS AP TRANSACTION ONLINE CODE               04800017
047900*** CODES AND DESCRIPTIONS                                        04810017
048000     05  AP-TRN-CDE-CODES.                                        04820017
048100         10  AP-TRN-CDE-1        PIC X(02)  VALUE 'ON'.           04830017
048200         10  AP-TRN-SHRT-DESC-1  PIC X(18)  VALUE                 04840017
048300                      'ONLINE ENTERD VCHR'.                       04850017
048400         10  AP-TRN-DESC-1       PIC X(35)  VALUE                 04860017
048500                      'ONLINE ENTERED VOUCHER             '.      04870017
048600         10  AP-TRN-TYP-CDE-1    PIC X(03)  VALUE 'MDS'.          04880017
048700     05  AP-TRN-CDE-TABLE REDEFINES                               04890017
048800                        AP-TRN-CDE-CODES.                         04900017
048900         10  AP-TRN-CDE-ENTRIES OCCURS 01 TIMES                   04910017
049000                               INDEXED BY IDX10.                  04920017
049100             15  TBL-AP-TRN-CDE       PIC X(02).                  04930017
049200             15  TBL-AP-TRN-SHRT-DESC PIC X(18).                  04940017
049300             15  TBL-AP-TRN-DESC      PIC X(35).                  04950017
049400             15  TBL-AP-TRN-TYP-CDE   PIC X(03).                  04960017
049500                                                                  04970017
049600                                                                  04980017
049700*---------------------------------------------------------------* 04990017
049800* SQLA MESSAGE MODULE                                           * 05000017
049900*---------------------------------------------------------------* 05010017
050000     COPY DPWS004.                                                05020017
050100                                                                  05030017
050200*---------------------------------------------------------------* 05040017
050300* MERCHANDISE INVOICE TERMS SELECT CODE COPYBOOK                  05050017
050400*---------------------------------------------------------------* 05060017
050500     COPY APRD200.                                                05070017
050600                                                                  05080017
050700*---------------------------------------------------------------* 05090017
050800* INVOICE TYPE CODE COPYBOOK                                      05100017
050900*---------------------------------------------------------------* 05110017
051000     COPY APRD201.                                                05120017
051100                                                                  05130017
051200*---------------------------------------------------------------* 05140017
051300* INVOICE MATCH LEVEL CODE COPYBOOK                               05150017
051400*---------------------------------------------------------------* 05160017
051500     COPY APRD202.                                                05170017
051600                                                                  05180017
051700*---------------------------------------------------------------* 05190017
051800* DUE DATE SOURCE CODE COPYBOOK                                   05200017
051900*---------------------------------------------------------------* 05210017
052000     COPY APRD203.                                                05220017
052100                                                                  05230017
052200*---------------------------------------------------------------* 05240017
052300* ALLOWANCE CHARGE TYPE CODE COPYBOOK                             05250017
052400*---------------------------------------------------------------* 05260017
052500     COPY APRD204.                                                05270017
052600                                                                  05280017
052700*---------------------------------------------------------------* 05290017
052800* ALLOWANCE CHARGE CODE COPYBOOK                                  05300017
052900*---------------------------------------------------------------* 05310017
053000     COPY APRD205.                                                05320017
053100                                                                  05330017
053200*---------------------------------------------------------------* 05340017
053300* PAYMENT PAY CYCLE CODE COPYBOOK                                 05350017
053400*---------------------------------------------------------------* 05360017
053500     COPY APRD206.                                                05370017
053600                                                                  05380017
053700*---------------------------------------------------------------* 05390017
053800* PAYMENT PAY STATUS CODE COPYBOOK                                05400017
053900*---------------------------------------------------------------* 05410017
054000     COPY APRD207.                                                05420017
054100                                                                  05430017
054200*---------------------------------------------------------------* 05440017
054300* AP TRANSACTION TYPE CODE COPYBOOK                               05450017
054400*---------------------------------------------------------------* 05460017
054500     COPY APRD208.                                                05470017
054600                                                                  05480017
054700*---------------------------------------------------------------* 05490017
054800* AP TRANSACTION CODE COPYBOOK                                    05500017
054900*---------------------------------------------------------------* 05510017
055000     COPY APRD209.                                                05520017
055100                                                                  05530017
055200 01  WS-ABEND-FIELDS.                                             05540017
055300     05  WS-ABEND-PROGRAM          PIC X(8)   VALUE 'APKUT314'.   05550017
055400     05  WS-ABEND-PARAGRAPH        PIC X(50)  VALUE SPACES.       05560017
055500     05  WS-ABEND-OPERATION        PIC X(50)  VALUE SPACES.       05570017
055600     05  WS-ABEND-STRUCTURE-1      PIC X(8)   VALUE SPACES.       05580017
055700     05  WS-ABEND-STRUCTURE-2      PIC X(8)   VALUE SPACES.       05590017
055800     05  WS-ABEND-STATUS           PIC XX     VALUE SPACES.       05600017
055900                                                                  05610017
056000 01  ABEND-CODE                    PIC S9(4)  COMP SYNC           05620017
056100                                              VALUE ZEROS.        05630017
056200     88 AP-TABLE-FULL              VALUE +4004.                   05640017
056300     88 AP-EMPTY-FILE              VALUE +4005.                   05650017
056400     88 AP-DB2-ERROR               VALUE +4013.                   05660017
056500                                                                  05670017
056600*---------------------------------------------------------------* 05680017
056700*  COMMUNICATIONS AREA2 FOR DB2                                 * 05690017
056800*---------------------------------------------------------------* 05700017
056900     COPY SQLCA2.                                                 05710017
057000                                                                  05720017
057100*---------------------------------------------------------------* 05730017
057200* SQL COMMUNICATIONS AREA DCLGEN                                * 05740017
057300*---------------------------------------------------------------* 05750017
057400     EXEC SQL                                                     05760017
057500          INCLUDE SQLCA                                           05770017
057600     END-EXEC.                                                    05780017
057700                                                                  05790017
057800*---------------------------------------------------------------* 05800017
057900* AP TRANSACTION CODE TABLE                                     * 05810017
058000*---------------------------------------------------------------* 05820017
058100     EXEC SQL                                                     05830017
058200          INCLUDE TTRNCDE                                         05840017
058300     END-EXEC.                                                    05850017
058400                                                                  05860017
058500*---------------------------------------------------------------* 05870017
058600*   THIS IS THE CURSOR THAT RETRIEVES THE AP TRANSACTION CODE   * 05880017
058700*   DATA NEEDED FOR THE EXTRACT FILE                            * 05890017
058800*---------------------------------------------------------------* 05900017
058900     EXEC SQL                                                     05910017
059000        DECLARE AP_TRN_CDE_CSR CURSOR FOR                         05920017
059100          SELECT A.AP_TRN_CDE                                     05930017
059200                ,A.TRN_SHRT_DESC                                  05940017
059300                ,A.TRN_DESC                                       05950017
059400                ,A.TRN_TYP_CDE                                    05960017
059500            FROM TTRNCDE A                                        05970017
059600           WHERE A.EFF_END_DTE =                                  05980017
059700                 (SELECT MAX(B.EFF_END_DTE)                       05990017
059800                    FROM TTRNCDE B                                06000017
059900                   WHERE B.AP_TRN_CDE = A.AP_TRN_CDE)             06010017
060000           ORDER BY A.AP_TRN_CDE                                  06020017
060100     END-EXEC.                                                    06030017
060200                                                                  06040017
060300                                                                  06050017
060400 01  FILLER                        PIC X(25) VALUE                06060017
060500          '<====WS FOR APKUT314 ENDS'.                            06070017
060600                                                                  06080017
060700*********************************                                 06090017
060800 PROCEDURE DIVISION.                                              06100017
060900*********************************                                 06110017
061000 A100-MAINLINE.                                                   06120017
061100                                                                  06130017
061200     PERFORM B100-INITIALIZATION.                                 06140017
061300                                                                  06150017
061400     PERFORM B200-CREATE-APTRN-CD-EXTRCT                          06160017
061500       UNTIL WS-END-OF-APTRN-CD-CSR.                              06170017
061600                                                                  06180017
061700     PERFORM B250-CREATE-ONLINE-APTRN-CD.                         06190017
061800     PERFORM Y200-CLOSE-AP-TRN-CDE-CSR.                           06200017
061900                                                                  06210017
062000     PERFORM C100-CREATE-INVC-TERM-SEL-FILE.                      06220017
062100     PERFORM C200-CREATE-INVC-TYP-FILE.                           06230017
062200     PERFORM C300-CREATE-INVC-MTCH-LVL-FILE.                      06240017
062300     PERFORM C400-CREATE-DUE-DTE-SRC-FILE.                        06250017
062400     PERFORM C500-CREATE-ALW-CHRG-TYP-FILE.                       06260017
062500     PERFORM C600-CREATE-ALW-CHRG-CD-FILE.                        06270017
062600     PERFORM C700-CREATE-PAYT-PAY-CYC-FILE.                       06280017
062700     PERFORM C800-CREATE-PAYT-PAY-STAT-FILE.                      06290017
062800     PERFORM C900-CREATE-AP-TRN-TYP-FILE.                         06300017
062900                                                                  06310017
063000                                                                  06320017
063100     PERFORM B300-END-OF-JOB.                                     06330017
063200                                                                  06340017
063300     GOBACK.                                                      06350017
063400        EJECT                                                     06360017
063500                                                                  06370017
063600*                                                                 06380017
063700***************************************************************** 06390017
063800*  INITIALIZATION PROCESSING                                    * 06400017
063900*  - OPEN EXTRACT FILES                                         * 06410017
064000*  - INITIALIZE DCLGENS                                         * 06420017
064100*  - OPEN CAPABILITIES CURSOR AND FETCH FIRST ROW               * 06430017
064200***************************************************************** 06440017
064300*                                                                 06450017
064400 B100-INITIALIZATION.                                             06460017
064500                                                                  06470017
064600     DISPLAY '**********************************'                 06480017
064700     DISPLAY '*   STARTING PROGRAM APKUT314    *'                 06490017
064800     DISPLAY '**********************************'                 06500017
064900                                                                  06510017
065000     OPEN OUTPUT MDSE-INVC-TERM-SEL-FILE                          06520017
065100                 INVC-TYP-CD-FILE                                 06530017
065200                 INVC-MTCH-LVL-CD-FILE                            06540017
065300                 DUE-DTE-SRC-CD-FILE                              06550017
065400                 ALW-CHRG-TYP-CD-FILE                             06560017
065500                 ALW-CHRG-CD-FILE                                 06570017
065600                 PAYT-PAY-CYC-CD-FILE                             06580017
065700                 PAYT-PAY-STAT-CD-FILE                            06590017
065800                 AP-TRN-TYP-CD-FILE                               06600017
065900                 AP-TRN-CD-FILE.                                  06610017
066000                                                                  06620017
066100     INITIALIZE DCLTTRNCDE.                                       06630017
066200                                                                  06640017
066300     PERFORM Y100-OPEN-AP-TRN-CDE-CSR.                            06650017
066400     PERFORM R100-FETCH-AP-TRN-CDE-CSR.                           06660017
066500                                                                  06670017
066600     IF WS-END-OF-APTRN-CD-CSR                                    06680017
066700        DISPLAY '**********************************'              06690017
066800        DISPLAY '*      PROGRAM = APKUT314        *'              06700017
066900        DISPLAY '**********************************'              06710017
067000        DISPLAY '* NO ROWS WERE SELECTED FROM     *'              06720017
067100        DISPLAY '* THE AP TRANSACTION CODE        *'              06730017
067200        DISPLAY '* CURSOR.                        *'              06740017
067300        DISPLAY '**********************************'              06750017
067400     END-IF.                                                      06760017
067500                                                                  06770017
067600*                                                                 06780017
067700***************************************************************** 06790017
067800*  PROCESS AP_TRN_CDE_CSR RESULTS. MOVES RETRIEVED INFORMATION  * 06800017
067900*  TO THE APRD209 COPYBOOK USED TO WRITE THE OUTPUT FILE        * 06810017
068000***************************************************************** 06820017
068100*                                                                 06830017
068200 B200-CREATE-APTRN-CD-EXTRCT.                                     06840017
068300                                                                  06850017
068400     INITIALIZE AP209-RECORD.                                     06860017
068500                                                                  06870017
068600     MOVE TRNCDE-AP-TRN-CDE    TO AP209-AP-TRN-CDE.               06880017
068700     MOVE TRNCDE-TRN-SHRT-DESC TO AP209-AP-TRN-SHRT-DESC.         06890017
068800     MOVE TRNCDE-TRN-DESC      TO AP209-AP-TRN-DESC.              06900017
068900     MOVE TRNCDE-TRN-TYP-CDE   TO AP209-AP-TRN-TYP-CDE.           06910017
069000                                                                  06920017
069100     PERFORM W100-WRITE-AP-TRN-CDE-REC.                           06930017
069200     PERFORM R100-FETCH-AP-TRN-CDE-CSR.                           06940017
069300                                                                  06950017
069400*                                                                 06960017
069500***************************************************************** 06970017
069600*  PROCESS AP-TRN-CDE-TABLE TO WRITE OUT THE ARRAY DATA           06980017
069700*  TO THE AP TRANSACTION CODE EXTRACT FILE                        06990017
069800***************************************************************** 07000017
069900*                                                                 07010017
070000 B250-CREATE-ONLINE-APTRN-CD.                                     07020017
070100                                                                  07030017
070200     PERFORM VARYING IDX10 FROM 1 BY 1                            07040017
070300        UNTIL IDX10 > 1                                           07050017
070400        INITIALIZE AP209-RECORD                                   07060017
070500        MOVE TBL-AP-TRN-CDE (IDX10)       TO                      07070017
070600                                  AP209-AP-TRN-CDE                07080017
070700        MOVE TBL-AP-TRN-SHRT-DESC (IDX10) TO                      07090017
070800                                  AP209-AP-TRN-SHRT-DESC          07100017
070900        MOVE TBL-AP-TRN-DESC (IDX10)      TO                      07110017
071000                                  AP209-AP-TRN-DESC               07120017
071100        MOVE TBL-AP-TRN-TYP-CDE (IDX10)   TO                      07130017
071200                                  AP209-AP-TRN-TYP-CDE            07140017
071300        PERFORM W100-WRITE-AP-TRN-CDE-REC                         07150017
071400     END-PERFORM.                                                 07160017
071500                                                                  07170017
071600*                                                                 07180017
071700***************************************************************** 07190017
071800*  END OF PROGRAM PROCESSING.                                   * 07200017
071900***************************************************************** 07210017
072000*                                                                 07220017
072100 B300-END-OF-JOB.                                                 07230017
072200                                                                  07240017
072300     CLOSE MDSE-INVC-TERM-SEL-FILE                                07250017
072400           INVC-TYP-CD-FILE                                       07260017
072500           INVC-MTCH-LVL-CD-FILE                                  07270017
072600           DUE-DTE-SRC-CD-FILE                                    07280017
072700           ALW-CHRG-TYP-CD-FILE                                   07290017
072800           ALW-CHRG-CD-FILE                                       07300017
072900           PAYT-PAY-CYC-CD-FILE                                   07310017
073000           PAYT-PAY-STAT-CD-FILE                                  07320017
073100           AP-TRN-TYP-CD-FILE                                     07330017
073200           AP-TRN-CD-FILE.                                        07340017
073300                                                                  07350017
073400     DISPLAY 'AP TRANSACTION CODE ROWS FETCHED = '                07360017
073500                         WS-APTRN-REC-ROWS-FETCHED.               07370017
073600     DISPLAY 'AP TRANSACTION CODE RECS WRITTEN            = '     07380017
073700                         WS-AP-TRN-CD-REC-OUT.                    07390017
073800     DISPLAY 'MERCH INVOICE TERMS SELECT RECS WRITTEN     = '     07400017
073900                         WS-MDSE-INVC-TERM-SEL-REC-OUT.           07410017
074000     DISPLAY 'INVOICE TYPE CODE RECS WRITTEN              = '     07420017
074100                         WS-INVC-TYP-CD-REC-OUT.                  07430017
074200     DISPLAY 'INVOICE MATCH LEVEL CODE RECS WRITTEN       = '     07440017
074300                         WS-INVC-MTCH-LVL-CD-REC-OUT.             07450017
074400     DISPLAY 'DUE DATE SOURCE CODE RECS WRITTEN           = '     07460017
074500                         WS-DUE-DTE-SRC-CD-REC-OUT.               07470017
074600     DISPLAY 'ALLOWANCE CHARGE TYPE CODE RECS WRITTEN     = '     07480017
074700                         WS-ALW-CHRG-TYP-CD-REC-OUT.              07490017
074800     DISPLAY 'ALLOWANCE CHARGE CODE REC WRITTEN           = '     07500017
074900                         WS-ALW-CHRG-CD-REC-OUT.                  07510017
075000     DISPLAY 'PAYMENT PAY CYCLE RECS WRITTEN              = '     07520017
075100                         WS-PAYT-PAY-CYC-CD-REC-OUT.              07530017
075200     DISPLAY 'PAYMENT PAY STATUS CODE RECS WRITTEN        = '     07540017
075300                         WS-PAYT-PAY-STAT-CD-REC-OUT.             07550017
075400     DISPLAY 'AP TRANSACTION TYPE CODE RECS WRITTEN       = '     07560017
075500                         WS-AP-TRN-TYP-CD-REC-OUT.                07570017
075600                                                                  07580017
075700     DISPLAY 'PROGRAM APKUT314 ENDS NORMALLY '.                   07590017
075800                                                                  07600017
075900*                                                                 07610017
076000***************************************************************** 07620017
076100*  PROCESS MDSE-INVC-TERM-TABLE TO WRITE OUT THE ARRAY DATA       07630017
076200*  TO THE MERCHANDISE INVOICE TERM SELECT CODE FILE               07640017
076300***************************************************************** 07650017
076400*                                                                 07660017
076500 C100-CREATE-INVC-TERM-SEL-FILE.                                  07670017
076600                                                                  07680017
076700     PERFORM VARYING IDX1 FROM 1 BY 1                             07690017
076800        UNTIL IDX1 > 2                                            07700017
076900        INITIALIZE AP200-RECORD                                   07710017
077000        MOVE TBL-MDSE-INVC-TERM-CD  (IDX1) TO                     07720017
077100                                 AP200-MDSE-INVC-TERM-SEL-CDE     07730017
077200        MOVE TBL-MDSE-INVC-TERM-DESC(IDX1) TO                     07740017
077300                                 AP200-MDSE-INVC-TERM-SEL-DESC    07750017
077400        PERFORM W101-WRITE-INVC-TERM-SEL-REC                      07760017
077500     END-PERFORM.                                                 07770017
077600                                                                  07780017
077700*                                                                 07790017
077800***************************************************************** 07800017
077900*  PROCESS INVC-TYP-TABLE TO WRITE OUT THE ARRAY DATA             07810017
078000*  TO THE INVOICE TYPE CODE FILE                                  07820017
078100***************************************************************** 07830017
078200*                                                                 07840017
078300 C200-CREATE-INVC-TYP-FILE.                                       07850017
078400                                                                  07860017
078500     PERFORM VARYING IDX2 FROM 1 BY 1                             07870017
078600        UNTIL IDX2 > 4                                            07880017
078700        INITIALIZE AP201-RECORD                                   07890017
078800        MOVE TBL-INVC-TYP-CD  (IDX2)  TO                          07900017
078900                                  AP201-INVC-TYP-CDE              07910017
079000        MOVE TBL-INVC-TYP-DESC (IDX2) TO                          07920017
079100                                  AP201-INVC-TYP-DESC             07930017
079200        PERFORM W102-WRITE-INVC-TYP-REC                           07940017
079300     END-PERFORM.                                                 07950017
079400                                                                  07960017
079500*                                                                 07970017
079600***************************************************************** 07980017
079700*  PROCESS MTCH-LVL-TABLE TO WRITE OUT THE ARRAY DATA             07990017
079800*  TO THE INVOICE MATCH LEVEL CODE FILE                           08000017
079900***************************************************************** 08010017
080000*                                                                 08020017
080100 C300-CREATE-INVC-MTCH-LVL-FILE.                                  08030017
080200                                                                  08040017
080300     PERFORM VARYING IDX3 FROM 1 BY 1                             08050017
080400        UNTIL IDX3 > 3                                            08060017
080500        INITIALIZE AP202-RECORD                                   08070017
080600        MOVE TBL-MTCH-LVL-CD (IDX3)   TO                          08080017
080700                                  AP202-INVC-MTCH-LVL-CDE         08090017
080800        MOVE TBL-MTCH-LVL-DESC (IDX3) TO                          08100017
080900                                  AP202-INVC-MTCH-LVL-DESC        08110017
081000        PERFORM W103-WRITE-INVC-MTCH-LVL-REC                      08120017
081100     END-PERFORM.                                                 08130017
081200                                                                  08140017
081300*                                                                 08150017
081400***************************************************************** 08160017
081500*  PROCESS DUE-DTE-SRC-TABLE TO WRITE OUT THE ARRAY DATA          08170017
081600*  TO THE INVOICE DUE DATE SOURCE CODE FILE                       08180017
081700***************************************************************** 08190017
081800*                                                                 08200017
081900 C400-CREATE-DUE-DTE-SRC-FILE.                                    08210017
082000                                                                  08220017
082100     PERFORM VARYING IDX4 FROM 1 BY 1                             08230017
082200        UNTIL IDX4 > 4                                            08240017
082300        INITIALIZE AP203-RECORD                                   08250017
082400        MOVE TBL-DUE-DTE-SRC-CD (IDX4)   TO                       08260017
082500                                  AP203-INVC-DUE-DTE-SRC-CDE      08270017
082600        MOVE TBL-DUE-DTE-SRC-DESC (IDX4) TO                       08280017
082700                                  AP203-DUE-DTE-SRC-DESC          08290017
082800        PERFORM W104-WRITE-DUE-DTE-SRC-REC                        08300017
082900     END-PERFORM.                                                 08310017
083000                                                                  08320017
083100*                                                                 08330017
083200***************************************************************** 08340017
083300*  PROCESS ALW-CHRG-TYP-TABLE TO WRITE OUT THE ARRAY DATA         08350017
083400*  TO THE ALLOWANCE CHARGE TYPE CODE FILE                         08360017
083500***************************************************************** 08370017
083600*                                                                 08380017
083700 C500-CREATE-ALW-CHRG-TYP-FILE.                                   08390017
083800                                                                  08400017
083900     PERFORM VARYING IDX5 FROM 1 BY 1                             08410017
084000        UNTIL IDX5 > 2                                            08420017
084100        INITIALIZE AP204-RECORD                                   08430017
084200        MOVE TBL-ALW-CHRG-TYP-CD (IDX5)   TO                      08440017
084300                                  AP204-INVC-ALW-CHRG-TYP-CDE     08450017
084400        MOVE TBL-ALW-CHRG-TYP-DESC (IDX5) TO                      08460017
084500                                  AP204-INVC-ALW-CHRG-TYP-DESC    08470017
084600        PERFORM W105-WRITE-ALW-CHRG-TYP-REC                       08480017
084700     END-PERFORM.                                                 08490017
084800                                                                  08500017
084900*                                                                 08510017
085000***************************************************************** 08520017
085100*  PROCESS ALW-CHRG-CDE-TABLE TO WRITE OUT THE ARRAY DATA         08530017
085200*  TO THE ALLOWANCE CHARGE CODE FILE                              08540017
085300***************************************************************** 08550017
085400*                                                                 08560017
085500 C600-CREATE-ALW-CHRG-CD-FILE.                                    08570017
085600                                                                  08580017
085700     PERFORM VARYING IDX6 FROM 1 BY 1                             08590017
085800        UNTIL IDX6 > 33                                           08600017
085900        INITIALIZE AP205-RECORD                                   08610017
086000        MOVE TBL-ALW-CHRG-CODE (IDX6) TO                          08620017
086100                                AP205-INVC-ALW-CHRG-CDE           08630017
086200        MOVE TBL-ALW-CHRG-TYPE (IDX6) TO                          08640017
086300                                AP205-INVC-ALW-CHRG-TYP-CDE       08650017
086400        MOVE TBL-ALW-CHRG-DESC (IDX6) TO                          08660017
086500                                AP205-INVC-ALW-CHRG-DESC          08670017
086600        PERFORM W106-WRITE-ALW-CHRG-CD-REC                        08680017
086700     END-PERFORM.                                                 08690017
086800                                                                  08700017
086900*                                                                 08710017
087000***************************************************************** 08720017
087100*  PROCESS PAYT-PAY-CYC-TABLE TO WRITE OUT THE ARRAY DATA         08730017
087200*  TO THE PAYMENT PAY CYCLE CODE FILE                             08740017
087300***************************************************************** 08750017
087400*                                                                 08760017
087500 C700-CREATE-PAYT-PAY-CYC-FILE.                                   08770017
087600                                                                  08780017
087700     PERFORM VARYING IDX7 FROM 1 BY 1                             08790017
087800        UNTIL IDX7 > 11                                           08800017
087900        INITIALIZE AP206-RECORD                                   08810017
088000        MOVE TBL-PAYT-PAY-CYC-CD (IDX7)   TO                      08820017
088100                                  AP206-PAYT-PAY-CYC-CDE          08830017
088200        MOVE TBL-PAYT-PAY-CYC-DESC (IDX7) TO                      08840017
088300                                  AP206-PAYT-PAY-CYC-DESC         08850017
088400        PERFORM W107-WRITE-PAYT-PAY-CYC-REC                       08860017
088500     END-PERFORM.                                                 08870017
088600                                                                  08880017
088700*                                                                 08890017
088800***************************************************************** 08900017
088900*  PROCESS PAYT-PAY-STAT-TABLE TO WRITE OUT THE ARRAY DATA        08910017
089000*  TO THE PAYMENT PAY STATUS CODE FILE                            08920017
089100***************************************************************** 08930017
089200*                                                                 08940017
089300 C800-CREATE-PAYT-PAY-STAT-FILE.                                  08950017
089400                                                                  08960017
089500     PERFORM VARYING IDX8 FROM 1 BY 1                             08970017
089600        UNTIL IDX8 > 3                                            08980017
089700        INITIALIZE AP207-RECORD                                   08990017
089800        MOVE TBL-PAYT-PAY-STAT-CD  (IDX8)   TO                    09000017
089900                                  AP207-PAYT-STAT-CDE             09010017
090000        MOVE TBL-PAYT-PAY-STAT-DESC  (IDX8) TO                    09020017
090100                                  AP207-PAYT-STAT-DESC            09030017
090200        PERFORM W108-WRITE-PAYT-PAY-STAT-REC                      09040017
090300     END-PERFORM.                                                 09050017
090400                                                                  09060017
090500*                                                                 09070017
090600***************************************************************** 09080017
090700*  PROCESS AP-TRN-TYP-TABLE TO WRITE OUT THE ARRAY DATA           09090017
090800*  TO THE AP TRANSACTION TYPE CODE FILE                           09100017
090900***************************************************************** 09110017
091000*                                                                 09120017
091100 C900-CREATE-AP-TRN-TYP-FILE.                                     09130017
091200                                                                  09140017
091300     PERFORM VARYING IDX9 FROM 1 BY 1                             09150017
091400        UNTIL IDX9 > 2                                            09160017
091500        INITIALIZE AP208-RECORD                                   09170017
091600        MOVE TBL-AP-TRN-TYP-CD  (IDX9)   TO                       09180017
091700                                  AP208-AP-TRN-TYP-CDE            09190017
091800        MOVE TBL-AP-TRN-TYP-DESC  (IDX9) TO                       09200017
091900                                  AP208-AP-TRN-TYP-DESC           09210017
092000        PERFORM W109-WRITE-AP-TRN-TYP-REC                         09220017
092100     END-PERFORM.                                                 09230017
092200                                                                  09240017
092300*                                                                 09250017
092400***************************************************************** 09260017
092500* FETCH THE AP TRANSACTION CODE DATA FROM THE AP_TRN_CDE_CSR    * 09270017
092600***************************************************************** 09280017
092700*                                                                 09290017
092800 R100-FETCH-AP-TRN-CDE-CSR.                                       09300017
092900                                                                  09310017
093000     EXEC SQL                                                     09320017
093100         FETCH AP_TRN_CDE_CSR                                     09330017
093200          INTO :TRNCDE-AP-TRN-CDE                                 09340017
093300              ,:TRNCDE-TRN-SHRT-DESC                              09350017
093400              ,:TRNCDE-TRN-DESC                                   09360017
093500              ,:TRNCDE-TRN-TYP-CDE                                09370017
093600     END-EXEC.                                                    09380017
093700                                                                  09390017
093800     EVALUATE TRUE                                                09400017
093900         WHEN SQLCODE = ZERO                                      09410017
094000              ADD 1 TO WS-APTRN-REC-ROWS-FETCHED                  09420017
094100         WHEN SQLCODE = +100                                      09430017
094200               SET WS-END-OF-APTRN-CD-CSR TO TRUE                 09440017
094300         WHEN SQLWARN0 NOT = SPACES                               09450017
094400         WHEN SQLCODE  NOT = ZERO                                 09460017
094500           MOVE 'R100-FETCH-AP-TRN-CDE-CSR  '                     09470017
094600                                           TO WS-ABEND-PARAGRAPH  09480017
094700           MOVE 'UNSUCCESSFUL FETCH'       TO WS-ABEND-OPERATION  09490017
094800           MOVE 'TTRNCDE'                TO WS-ABEND-STRUCTURE-1  09500017
094900           MOVE '       '                TO WS-ABEND-STRUCTURE-2  09510017
095000           PERFORM Z999-SQL-ERROR                                 09520017
095100     END-EVALUATE.                                                09530017
095200                                                                  09540017
095300*                                                                 09550017
095400***************************************************************** 09560017
095500* WRITE RETRIEVED INFORMATION TO THE AP TRANSACTION CODE        * 09570017
095600* EXTRACT RECORD                                                * 09580017
095700***************************************************************** 09590017
095800*                                                                 09600017
095900 W100-WRITE-AP-TRN-CDE-REC.                                       09610017
096000                                                                  09620017
096100     WRITE AP-TRN-CD-REC FROM AP209-RECORD.                       09630017
096200                                                                  09640017
096300     ADD 1 TO WS-AP-TRN-CD-REC-OUT.                               09650017
096400                                                                  09660017
096500*                                                                 09670017
096600***************************************************************** 09680017
096700* WRITE ARRAY INFORMATION TO THE MERCHANDISE INVOICE TERMS SELECT 09690017
096800* CODE RECORD                                                     09700017
096900***************************************************************** 09710017
097000*                                                                 09720017
097100 W101-WRITE-INVC-TERM-SEL-REC.                                    09730017
097200                                                                  09740017
097300     WRITE MDSE-INVC-TERM-SEL-REC FROM AP200-RECORD.              09750017
097400                                                                  09760017
097500     ADD 1 TO WS-MDSE-INVC-TERM-SEL-REC-OUT.                      09770017
097600                                                                  09780017
097700*                                                                 09790017
097800***************************************************************** 09800017
097900* WRITE ARRAY INFORMATION TO THE INVOICE TYPE CODE                09810017
098000* RECORD                                                          09820017
098100***************************************************************** 09830017
098200*                                                                 09840017
098300 W102-WRITE-INVC-TYP-REC.                                         09850017
098400                                                                  09860017
098500     WRITE INVC-TYP-CD-REC FROM AP201-RECORD.                     09870017
098600                                                                  09880017
098700     ADD 1 TO WS-INVC-TYP-CD-REC-OUT.                             09890017
098800                                                                  09900017
098900*                                                                 09910017
099000***************************************************************** 09920017
099100* WRITE ARRAY INFORMATION TO THE INVOICE MATCH LEVEL CODE         09930017
099200* RECORD                                                          09940017
099300***************************************************************** 09950017
099400*                                                                 09960017
099500 W103-WRITE-INVC-MTCH-LVL-REC.                                    09970017
099600                                                                  09980017
099700     WRITE INVC-MTCH-LVL-CD-REC FROM AP202-RECORD.                09990017
099800                                                                  10000017
099900     ADD 1 TO WS-INVC-MTCH-LVL-CD-REC-OUT.                        10010017
100000                                                                  10020017
100100*                                                                 10030017
100200***************************************************************** 10040017
100300* WRITE ARRAY INFORMATION TO THE DUE DATE SOURCE CODE             10050017
100400* RECORD                                                          10060017
100500***************************************************************** 10070017
100600*                                                                 10080017
100700 W104-WRITE-DUE-DTE-SRC-REC.                                      10090017
100800                                                                  10100017
100900     WRITE DUE-DTE-SRC-CD-REC FROM AP203-RECORD.                  10110017
101000                                                                  10120017
101100     ADD 1 TO WS-DUE-DTE-SRC-CD-REC-OUT.                          10130017
101200                                                                  10140017
101300*                                                                 10150017
101400***************************************************************** 10160017
101500* WRITE ARRAY INFORMATION TO THE ALLOWANCE CHARGE TYPE CODE       10170017
101600* RECORD                                                          10180017
101700***************************************************************** 10190017
101800*                                                                 10200017
101900 W105-WRITE-ALW-CHRG-TYP-REC.                                     10210017
102000                                                                  10220017
102100     WRITE ALW-CHRG-TYP-CD-REC FROM AP204-RECORD.                 10230017
102200                                                                  10240017
102300     ADD 1 TO WS-ALW-CHRG-TYP-CD-REC-OUT.                         10250017
102400                                                                  10260017
102500*                                                                 10270017
102600***************************************************************** 10280017
102700* WRITE ARRAY INFORMATION TO THE ALLOWANCE CHARGE CODE            10290017
102800* RECORD                                                          10300017
102900***************************************************************** 10310017
103000*                                                                 10320017
103100 W106-WRITE-ALW-CHRG-CD-REC.                                      10330017
103200                                                                  10340017
103300     WRITE ALW-CHRG-CD-REC FROM AP205-RECORD.                     10350017
103400                                                                  10360017
103500     ADD 1 TO WS-ALW-CHRG-CD-REC-OUT.                             10370017
103600                                                                  10380017
103700*                                                                 10390017
103800***************************************************************** 10400017
103900* WRITE ARRAY INFORMATION TO THE PAYMENT PAY CYCLE CODE           10410017
104000* RECORD                                                          10420017
104100***************************************************************** 10430017
104200*                                                                 10440017
104300 W107-WRITE-PAYT-PAY-CYC-REC.                                     10450017
104400                                                                  10460017
104500     WRITE PAYT-PAY-CYC-CD-REC FROM AP206-RECORD.                 10470017
104600                                                                  10480017
104700     ADD 1 TO WS-PAYT-PAY-CYC-CD-REC-OUT.                         10490017
104800                                                                  10500017
104900*                                                                 10510017
105000***************************************************************** 10520017
105100* WRITE ARRAY INFORMATION TO THE PAYMENT PAY STATUS CODE          10530017
105200* RECORD                                                          10540017
105300***************************************************************** 10550017
105400*                                                                 10560017
105500 W108-WRITE-PAYT-PAY-STAT-REC.                                    10570017
105600                                                                  10580017
105700     WRITE PAYT-PAY-STAT-CD-REC FROM AP207-RECORD.                10590017
105800                                                                  10600017
105900     ADD 1 TO WS-PAYT-PAY-STAT-CD-REC-OUT.                        10610017
106000                                                                  10620017
106100*                                                                 10630017
106200***************************************************************** 10640017
106300* WRITE ARRAY INFORMATION TO THE AP TRANSACTION TYPE CODE         10650017
106400* RECORD                                                          10660017
106500***************************************************************** 10670017
106600*                                                                 10680017
106700 W109-WRITE-AP-TRN-TYP-REC.                                       10690017
106800                                                                  10700017
106900     WRITE AP-TRN-TYP-CD-REC FROM AP208-RECORD.                   10710017
107000                                                                  10720017
107100     ADD 1 TO WS-AP-TRN-TYP-CD-REC-OUT.                           10730017
107200                                                                  10740017
107300*                                                                 10750017
107400***************************************************************** 10760017
107500*  OPEN AP TRANSACTION CODE CURSOR                              * 10770017
107600***************************************************************** 10780017
107700*                                                                 10790017
107800 Y100-OPEN-AP-TRN-CDE-CSR.                                        10800017
107900                                                                  10810017
108000     PERFORM WITH TEST AFTER                                      10820017
108100        VARYING WS-RETRY-COUNTER FROM 1 BY 1                      10830017
108200          UNTIL WS-RETRY-COUNTER > WS-RETRY-MAX                   10840017
108300             OR SQLCODE = ZERO                                    10850017
108400                                                                  10860017
108500         EXEC SQL                                                 10870017
108600            OPEN AP_TRN_CDE_CSR                                   10880017
108700         END-EXEC                                                 10890017
108800                                                                  10900017
108900         EVALUATE TRUE                                            10910017
109000             WHEN SQLCODE = ZERO                                  10920017
109100                  CONTINUE                                        10930017
109200             WHEN SQLCODE = -904                                  10940017
109300             WHEN SQLCODE = -913                                  10950017
109400                  CONTINUE                                        10960017
109500             WHEN SQLWARN0 NOT = SPACES                           10970017
109600             WHEN SQLCODE  NOT = ZERO                             10980017
109700                  MOVE 'Y100-OPEN-AP-TRN-CDE-CSR  '               10990017
109800                                           TO WS-ABEND-PARAGRAPH  11000017
109900                  MOVE 'UNSUCCESSFUL OPEN' TO WS-ABEND-OPERATION  11010017
110000                  MOVE 'TTRNCDE'         TO WS-ABEND-STRUCTURE-1  11020017
110100                  MOVE '       '         TO WS-ABEND-STRUCTURE-2  11030017
110200                  PERFORM Z999-SQL-ERROR                          11040017
110300         END-EVALUATE                                             11050017
110400     END-PERFORM.                                                 11060017
110500                                                                  11070017
110600     IF WS-RETRY-COUNTER > WS-RETRY-MAX                           11080017
110700        MOVE 'Y100-OPEN-AP-TRN-CDE-CSR  '                         11090017
110800              TO WS-ABEND-PARAGRAPH                               11100017
110900        MOVE 'MAX RETRIES EXCEEDED ON OPEN'                       11110017
111000              TO WS-ABEND-OPERATION                               11120017
111100        PERFORM Z999-SQL-ERROR                                    11130017
111200     END-IF.                                                      11140017
111300                                                                  11150017
111400*                                                                 11160017
111500****************************************************************  11170017
111600*  CLOSE AP TRANSACTION CODE CURSOR                            *  11180017
111700****************************************************************  11190017
111800*                                                                 11200017
111900 Y200-CLOSE-AP-TRN-CDE-CSR.                                       11210017
112000                                                                  11220017
112100     EXEC SQL                                                     11230017
112200        CLOSE AP_TRN_CDE_CSR                                      11240017
112300     END-EXEC.                                                    11250017
112400                                                                  11260017
112500     EVALUATE TRUE                                                11270017
112600         WHEN SQLCODE = ZERO                                      11280017
112700              CONTINUE                                            11290017
112800         WHEN SQLWARN0 NOT = SPACES                               11300017
112900         WHEN SQLCODE  NOT = ZERO                                 11310017
113000              MOVE 'Y200-CLOSE-AP-TRN-CDE-CSR  '                  11320017
113100                                         TO WS-ABEND-PARAGRAPH    11330017
113200              MOVE 'UNSUCCESSFUL CLOSE'  TO WS-ABEND-OPERATION    11340017
113300              MOVE 'TTRNCDE'             TO WS-ABEND-STRUCTURE-1  11350017
113400              MOVE '       '             TO WS-ABEND-STRUCTURE-2  11360017
113500              PERFORM Z999-SQL-ERROR                              11370017
113600     END-EVALUATE.                                                11380017
113700                                                                  11390017
113800*                                                                 11400017
113900***************************************************************** 11410017
114000*  PROCESS DB2 ABENDS.                                          * 11420017
114100***************************************************************** 11430017
114200*                                                                 11440017
114300 Z999-SQL-ERROR.                                                  11450017
114400                                                                  11460017
114500     DISPLAY '*** DB2 ERROR '.                                    11470017
114600     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 11480017
114700     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               11490017
114800     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               11500017
114900     DISPLAY '*** TABLE 1   = ' WS-ABEND-STRUCTURE-1.             11510017
115000     IF WS-ABEND-STRUCTURE-2 > SPACES                             11520017
115100         DISPLAY '*** TABLE 2   = ' WS-ABEND-STRUCTURE-2          11530017
115200     END-IF.                                                      11540017
115300     SET AP-DB2-ERROR              TO TRUE.                       11550017
115400                                                                  11560017
115500     COPY DPPD004.                                                11570017
115600     CALL 'ILBOABN0' USING ABEND-CODE.                            11580017
