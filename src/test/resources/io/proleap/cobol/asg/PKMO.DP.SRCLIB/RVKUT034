000100 IDENTIFICATION DIVISION.                                         00010024
000200                                                                  00020024
000300 PROGRAM-ID.             RVKUT034.                                00030024
000400 AUTHOR.          JOHN HUTCHINSON                                 00040024
000500 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00050024
000600 DATE-WRITTEN.    JUNE 2011.                                      00060024
000700 DATE-COMPILED.                                                   00070024
000800                                                                  00080024
002600*-----------------------------------------------------------------00090024
W40134* DATE:        10/30/2011                                         00100024
W40134* PROJ#:       3219  GENCO/RTV UPGRADE PROJECT                    00110024
W40134* WR/IR#:      WR40134                                            00120024
W40134* PROGRAMMER:  JOHN HUTCHINSON                                    00130024
W40134* DESCRIPTION: THIS PROGRAM WAS CLONED FROM PROGRAM VLKUT030.     00140024
W40134*              LOGIC ADDED TO ACCESS TERRITORY NUMBER BASED ON    00150024
W40134*              REGION NUMBER. COPYBOOK VLRD030 WAS REPLACED WITH  00160024
W40134*              COPYBOOK RVRD030. FIELD MAPPING FOR THE RVRD030    00170024
W40134*              IS THE SAME AS THE VLRD030 COPYBOOK AND THIS       00180024
W40134*              PROGRAM WILL NOW WRITE THE RV030-SITE-RECORD RATHER00190024
W40134*              THAN THE VL030-SITE-RECORD.                        00200024
W40134*                                                                 00210024
W40134* PROGRAM NARRATIVE:                                              00220024
W40134*                                                                 00230024
W40134* THIS PROGRAM WILL CREATE A FILE CONTAINING SITE/MARKER          00240024
W40134* INFORMATION FOR COMPLIANCE NETWORK.                             00250024
W40134*-----------------------------------------------------------------00260024
001500 ENVIRONMENT DIVISION.                                            00270024
001600                                                                  00280024
001700 CONFIGURATION SECTION.                                           00290024
001800                                                                  00300024
001900 SOURCE-COMPUTER.                IBM-3090.                        00310024
002000 OBJECT-COMPUTER.                IBM-3090.                        00320024
002100                                                                  00330024
002200 INPUT-OUTPUT SECTION.                                            00340024
002300                                                                  00350024
002400 FILE-CONTROL.                                                    00360024
002500                                                                  00370024
002600     SELECT  RV-LOCATION-FILE    ASSIGN TO OUT01.                 00380024
002700                                                                  00390024
002800     SELECT  RV-MARKER-FILE      ASSIGN TO OUT02.                 00400024
002900                                                                  00410024
003000******************************************************************00420024
003100 DATA DIVISION.                                                   00430024
003200******************************************************************00440024
003300                                                                  00450024
003400 FILE SECTION.                                                    00460024
003500                                                                  00470024
003600 FD  RV-LOCATION-FILE                                             00480024
003700     RECORDING MODE IS F                                          00490024
003800     LABEL RECORDS ARE STANDARD                                   00500024
003900     BLOCK CONTAINS 0 RECORDS.                                    00510024
004000                                                                  00520024
004100 01  RV-LOCATION-RECORD               PIC  X(314).                00530024
004200                                                                  00540024
004300 FD  RV-MARKER-FILE                                               00550024
004400     RECORDING MODE IS F                                          00560024
004500     LABEL RECORDS ARE STANDARD                                   00570024
004600     BLOCK CONTAINS 0 RECORDS.                                    00580024
004700                                                                  00590024
004800 01  RV-MARKER-RECORD                 PIC  X(78).                 00600024
004900                                                                  00610024
005000                                                                  00620024
005100 WORKING-STORAGE SECTION.                                         00630024
005200                                                                  00640024
005300***************************************************************** 00650024
005400*    INPUT CONTROL CARD                                           00660024
005500***************************************************************** 00670024
005600                                                                  00680024
005700 01  CC-CONTROL-CARD.                                             00690024
005800     05  CC-SCHEDULE-DATE.                                        00700024
005900         10  CC-CCYY                 PIC X(04).                   00710024
006000         10  CC-MM                   PIC X(02).                   00720024
006100         10  CC-DD                   PIC X(02).                   00730024
006200                                                                  00740024
006300***************************************************************** 00750024
006400*    PROGRAM CONSTANTS                                            00760024
006500***************************************************************** 00770024
006600                                                                  00780024
006700 01  PC-CONSTANTS.                                                00790024
006800     05  PC-CURRENT-PGM-RVKUT034      PIC  X(08) VALUE 'RVKUT034'.00800024
007000     05  PC-MAX-RETRIES               PIC S9(04) VALUE +3 COMP.   00810024
007300                                                                  00820024
007100 01  DK-DB2-KEYS.                                                 00830024
007200     05  DK-REGN                      PIC S9(4)V VALUE +0 COMP-3. 00840024
007400                                                                  00850024
007500***************************************************************** 00860024
007600*    PROGRAM SWITCHES                                             00870024
007700***************************************************************** 00880024
007800                                                                  00890024
007900 01  PS-SWITCHES.                                                 00900024
008000     05  PS-END-CURSOR-SWITCH         PIC  X(01) VALUE 'N'.       00910024
008100         88  PS-END-CSR                          VALUE 'Y'.       00920024
008200         88  PS-NOT-END-CSR                      VALUE 'N'.       00930024
008300                                                                  00940024
008400***************************************************************** 00950024
008500*    PROGRAM VARIABLES                                            00960024
008600***************************************************************** 00970024
008700                                                                  00980024
008800 01  PV-VARIABLES.                                                00990024
008900     05  PV-RETRY-COUNT               PIC S9(04) VALUE +0 COMP.   01000024
009100     05  PV-ABEND-CODE                PIC S9(04) VALUE +0 COMP.   01010024
009300     05  PV-PARAGRAPH                 PIC  X(30) VALUE SPACES.    01020024
009400     05  PV-DB2-FUNCTION              PIC  X(30) VALUE SPACES.    01030024
009500     05  PV-ABEND-TABLE-1             PIC  X(20) VALUE SPACES.    01040024
009600     05  PV-ABEND-TABLE-2             PIC  X(20) VALUE SPACES.    01050024
009700     05  PV-ERROR-MSG                 PIC  X(60) VALUE SPACES.    01060024
009800     05  PV-RECS-WRITTEN              PIC  9(09) VALUE ZERO.      01070024
009900     05  PV-DIST-NBR-X.                                           01080024
010000         10  PV-DIST-NBR              PIC  9(03) VALUE ZERO.      01090024
010100     05  PV-REGN-NBR-X.                                           01100024
010200         10  PV-REGN-NBR              PIC  9(03) VALUE ZERO.      01110024
010300     05  PV-INPUT-DATE.                                           01120024
010400         10  PV-INPUT-DATE-CCYY       PIC  9(04) VALUE ZERO.      01130024
010500         10  FILLER                   PIC  X(01) VALUE SPACES.    01140024
010600         10  PV-INPUT-DATE-MM         PIC  9(02) VALUE ZERO.      01150024
010700         10  FILLER                   PIC  X(01) VALUE SPACES.    01160024
010800         10  PV-INPUT-DATE-DD         PIC  9(02) VALUE ZERO.      01170024
010900     05  PV-OUTPUT-DATE.                                          01180024
011000         10  PV-OUTPUT-DATE-CCYY      PIC  9(04) VALUE ZERO.      01190024
011100         10  PV-OUTPUT-DATE-MM        PIC  9(02) VALUE ZERO.      01200024
011200         10  PV-OUTPUT-DATE-DD        PIC  9(02) VALUE ZERO.      01210024
011300     05  PV-RUN-DATE-CN               PIC  X(08) VALUE SPACES.    01220024
011400     05  PV-RUN-TIME-CN               PIC  X(06) VALUE SPACES.    01230024
011500                                                                  01240024
011600***** FILE NAME CONSISTS OF RUN-DATE-CN_SITE.DAT                  01250024
011700*****     EXAMPLE: 20050317_SITE.DAT                              01260024
011800                                                                  01270024
011900     05  PV-FILE-NAME.                                            01280024
012000         10  PV-CREATE-DATE           PIC  X(08) VALUE SPACES.    01290024
012100         10  PV-UNDERSCORE            PIC  X(01) VALUE '_'.       01300024
012200         10  PV-SITE-DAT              PIC  X(08) VALUE SPACES.    01310024
012300     05  PV-TERR-NBR-X.                                           01320024
012400         10  PV-TERR-NBR              PIC  9(03) VALUE ZERO.      01330024
012500                                                                  01340024
012600***  MARKER FILE LAYOUT                                           01350024
012500                                                                  01360024
012700     COPY VLRD029.                                                01370024
012800                                                                  01380024
012900***  LOCATION FILE LAYOUT                                         01390024
012800                                                                  01400024
013000     COPY RVRD030.                                                01410024
013100                                                                  01420024
013200***  LOCATION FILE LAYOUT                                         01430024
013100                                                                  01440024
013300     COPY XLWS071.                                                01450024
013400                                                                  01460024
013500***  DATE ROUTINE COPYBOOK                                        01470024
013400                                                                  01480024
013600     COPY DPWS500.                                                01490024
013700                                                                  01500024
013800***  DB2 ABEND COPYBOOK                                           01510024
013700                                                                  01520024
013900     COPY DPWS004.                                                01530024
014000                                                                  01540024
014100     EXEC SQL                                                     01550024
014200         INCLUDE SQLCA                                            01560024
014300     END-EXEC.                                                    01570024
014400                                                                  01580024
014500     COPY SQLCA2.                                                 01590024
014600                                                                  01600024
014700***  XLT_LOC                                                      01610024
014600                                                                  01620024
014800     EXEC SQL                                                     01630024
014900         INCLUDE XLT00010                                         01640024
015000     END-EXEC.                                                    01650024
016100                                                                  01660024
016200***  XLT_REGN                                                     01670024
016100                                                                  01680024
016300     EXEC SQL                                                     01690024
016400         INCLUDE XLT00012                                         01700024
016500     END-EXEC.                                                    01710024
016501                                                                  01720024
016502***  XLT_DIST                                                     01730024
016501                                                                  01740024
016503     EXEC SQL                                                     01750024
016504         INCLUDE XLT00013                                         01760024
016505     END-EXEC.                                                    01770024
016506                                                                  01780024
016507***  XLT_DC_LOC_ASGMT                                             01790024
016506                                                                  01800024
016506                                                                  01810024
016508     EXEC SQL                                                     01820024
016509         INCLUDE XLT00014                                         01830024
016510     END-EXEC.                                                    01840024
016600                                                                  01850024
016700***  EXTRACT CURSOR                                               01860024
016800                                                                  01870024
016900     EXEC SQL                                                     01880024
017000         DECLARE EXTRACT-CSR CURSOR FOR                           01890024
017100         SELECT                                                   01900024
017200                A.LOC_NBR                                         01910024
017300              , COALESCE(DIST_NBR , 0)                            01920024
017400           FROM                                                   01930024
017500                XLT_LOC A                                         01940024
017600           WHERE                                                  01950024
017700                LOC_TYP_CDE  IN ('DC', 'DS', 'HQ', 'RV')          01960024
017800             AND                                                  01970024
017900              ((CHAR(CURRENT_DATE, ISO)                           01980024
018000                    BETWEEN                                       01990024
018100                 CHAR(OPN_DTE,ISO)                                02000024
018200                    AND                                           02010024
018300                 CHAR(CLO_DTE,ISO))                               02020024
018400                        OR                                        02030024
018500              ((CHAR(CURRENT_DATE, ISO) < OPN_DTE                 02040024
018600                 AND                                              02050024
018700                 CHAR(CLO_DTE,ISO) = '9999-09-09')))              02060024
018800             AND EXISTS                                           02070024
018900                 (SELECT *                                        02080024
019000                    FROM XLT_DC_LOC_ASGMT B                       02090024
019100                   WHERE B.LOC_NBR = A.LOC_NBR                    02100024
019200                     AND DC_NBR    <> 899)                        02110024
019300        ORDER BY                                                  02120024
019400                LOC_NBR                                           02130024
019500        WITH UR                                                   02140024
019600     END-EXEC.                                                    02150024
019700                                                                  02160024
019800 LINKAGE SECTION.                                                 02170024
019900                                                                  02180024
020000 PROCEDURE DIVISION.                                              02190024
020100                                                                  02200024
020200***************************************************************** 02210024
020300*    MAINLINE LOGIC FOR PROGRAM                                   02220024
020400***************************************************************** 02230024
020100                                                                  02240024
020500 0000-MAINLINE.                                                   02250024
020600                                                                  02260024
020700     PERFORM 1000-INITIALIZE.                                     02270024
020800                                                                  02280024
020900     PERFORM 2000-PROCESS                                         02290024
021000         UNTIL PS-END-CSR.                                        02300024
021100                                                                  02310024
021200     PERFORM 9000-EOJ.                                            02320024
021300                                                                  02330024
021400     GOBACK.                                                      02340024
021500                                                                  02350024
021600***************************************************************** 02360024
021700*    INITIALIZATION PARAGRAPH                                     02370024
021800***************************************************************** 02380024
021500                                                                  02390024
021900 1000-INITIALIZE.                                                 02400024
022000                                                                  02410024
022100     OPEN OUTPUT RV-LOCATION-FILE                                 02420024
022200                 RV-MARKER-FILE.                                  02430024
022300                                                                  02440024
022400     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           02450024
022500                                                                  02460024
022600     DISPLAY 'CONTROL CARD ====>  ' CC-CONTROL-CARD.              02470024
022700                                                                  02480024
022800     PERFORM 1100-VALIDATE-CONTROL-CARD.                          02490024
022900                                                                  02500024
023000******* TIME IS CONTAINED CURRENT-DATE IN POSITION 9 FOR 8        02510024
023100                                                                  02520024
023200     MOVE FUNCTION CURRENT-DATE(9:8) TO PV-RUN-TIME-CN.           02530024
023300                                                                  02540024
023400     DISPLAY '******  RUN TIME  => '  PV-RUN-TIME-CN.             02550024
023500                                                                  02560024
023600     PERFORM 7000-OPEN-EXTRACT-CURSOR.                            02570024
023610                                                                  02580024
023700     PERFORM 7200-FETCH-EXTRACT-CURSOR.                           02590024
023800                                                                  02600024
023900******************************************************************02610024
024000**   VALIDATE THE DATE FROM THE SCHEDULE                          02620024
024100******************************************************************02630024
023800                                                                  02640024
024200 1100-VALIDATE-CONTROL-CARD.                                      02650024
024300                                                                  02660024
024400     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              02670024
024500                                                                  02680024
024600     SET DPG51-FISCAL-454-CALENDAR                                02690024
024700         DPG51-DO-NOT-INCR-DECR-DATE                              02700024
024800         DPG52-LK-DTE-ISO           TO TRUE.                      02710024
024900                                                                  02720024
025000     MOVE CC-SCHEDULE-DATE TO DPG52-LK-DATE-INPUT.                02730024
025100                                                                  02740024
025200     CALL DP500-KOHLS-CALENDAR-ROUTINE                            02750024
025300         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               02760024
025400                                                                  02770024
025500     IF DPG54-NO-ERROR                                            02780024
025600         MOVE CC-SCHEDULE-DATE  TO PV-RUN-DATE-CN                 02790024
025700     ELSE                                                         02800024
025800         DISPLAY '** ABEND **'                                    02810024
025900         DISPLAY '** PROGRAM = RVKUT034 -- CALLED MODULE '        02820024
026000                  'DPKUT500 **'                                   02830024
026100         DISPLAY '** PARAGRAPH = 1100-VALIDATE-CONTROL-CARD **'   02840024
026200         DISPLAY '** INVALID SCHEDULE DATE: ' CC-SCHEDULE-DATE    02850024
026300         DISPLAY '** ERROR MESSAGE FROM CALLED MODULE:   '        02860024
026400         DISPLAY DPG54-ERROR-MESSAGE                              02870024
026500         MOVE +4003 TO PV-ABEND-CODE                              02880024
026600         CALL 'ILBOABN0' USING PV-ABEND-CODE                      02890024
026700     END-IF.                                                      02900024
026800                                                                  02910024
026900***************************************************************** 02920024
027000*    PROCESS DATA FROM CURSOR AND WRITE OUTPUT RECORD             02930024
027100***************************************************************** 02940024
026800                                                                  02950024
027200 2000-PROCESS.                                                    02960024
027300                                                                  02970024
027400     PERFORM 2100-GET-LOC-INFO.                                   02980024
027500                                                                  02990024
027600     MOVE 'A'                TO RV030-ACD-INDICATOR.              03000024
027700     MOVE XLT00010-LOC-NBR   TO RV030-LOCATION-NBR.               03010024
027800     MOVE XL071-LOC-NM       TO RV030-LOCATION-NAME.              03020024
027900     MOVE XL071-LNE-1-ADDR   TO RV030-ADDRESS-LINE-1.             03030024
028000     MOVE XL071-LNE-2-ADDR   TO RV030-ADDRESS-LINE-2.             03040024
028100     MOVE SPACES             TO RV030-ADDRESS-LINE-3.             03050024
028200     MOVE XL071-CTY-NM       TO RV030-CITY.                       03060024
028300     MOVE XL071-ST-CDE       TO RV030-STATE.                      03070024
028400     MOVE XL071-ZIP-10-CDE   TO RV030-ZIP-CODE.                   03080024
028500     MOVE XL071-PHN-NBR      TO RV030-PHONE-NBR.                  03090024
028600     MOVE SPACES             TO RV030-FAX-NBR.                    03100024
028700                                                                  03110024
028800     IF XL071-DIST-NBR > 0                                        03120024
028900         PERFORM 2200-GET-DIST-REGN-INFO                          03130024
029000     END-IF.                                                      03140024
029100                                                                  03150024
029200     IF XL071-DIST-NBR > 0                                        03160024
029300         MOVE XL071-DIST-NBR    TO PV-DIST-NBR                    03170024
029400         MOVE PV-DIST-NBR-X     TO RV030-DISTRICT-NBR             03180024
029500         MOVE XLT00013-REGN-NBR TO PV-REGN-NBR                    03190024
029600         MOVE PV-REGN-NBR-X     TO RV030-REGION-NBR               03200024
029700     ELSE                                                         03210024
029800         MOVE '000'             TO RV030-DISTRICT-NBR             03220024
029900                                   RV030-REGION-NBR               03230024
030000     END-IF.                                                      03240024
030100                                                                  03250024
030200     MOVE 'KOHLS'                 TO RV030-COMPANY-NAME.          03260024
030300     MOVE XL071-OPN-DTE           TO PV-INPUT-DATE.               03270024
030400     MOVE PV-INPUT-DATE-CCYY      TO PV-OUTPUT-DATE-CCYY.         03280024
030500     MOVE PV-INPUT-DATE-MM        TO PV-OUTPUT-DATE-MM.           03290024
030600     MOVE PV-INPUT-DATE-DD        TO PV-OUTPUT-DATE-DD.           03300024
030700     MOVE PV-OUTPUT-DATE          TO RV030-SITE-OPEN-DATE.        03310024
030800     MOVE XL071-CLO-DTE           TO PV-INPUT-DATE.               03320024
030900     MOVE PV-INPUT-DATE-CCYY      TO PV-OUTPUT-DATE-CCYY.         03330024
031000     MOVE PV-INPUT-DATE-MM        TO PV-OUTPUT-DATE-MM.           03340024
031100     MOVE PV-INPUT-DATE-DD        TO PV-OUTPUT-DATE-DD.           03350024
031200     MOVE PV-OUTPUT-DATE          TO RV030-SITE-CLOSE-DATE.       03360024
031300     MOVE XL071-ASGMT-PO-STRT-DTE TO PV-INPUT-DATE.               03370024
031400     MOVE PV-INPUT-DATE-CCYY      TO PV-OUTPUT-DATE-CCYY.         03380024
031500     MOVE PV-INPUT-DATE-MM        TO PV-OUTPUT-DATE-MM.           03390024
031600     MOVE PV-INPUT-DATE-DD        TO PV-OUTPUT-DATE-DD.           03400024
031700     MOVE PV-OUTPUT-DATE          TO RV030-SITE-SHIP-START-DATE.  03410024
031800     MOVE XL071-ASGMT-PO-STP-DTE  TO PV-INPUT-DATE.               03420024
031900     MOVE PV-INPUT-DATE-CCYY      TO PV-OUTPUT-DATE-CCYY.         03430024
032000     MOVE PV-INPUT-DATE-MM        TO PV-OUTPUT-DATE-MM.           03440024
032100     MOVE PV-INPUT-DATE-DD        TO PV-OUTPUT-DATE-DD.           03450024
032200     MOVE PV-OUTPUT-DATE          TO RV030-SITE-SHIP-STOP-DATE.   03460024
032300     MOVE 'KSS'                   TO RV030-BUSINESS-UNIT.         03470024
032400     MOVE XL071-ASGMT-DC-NBR      TO RV030-DROP-LOCATION.         03480024
032500     MOVE 'X'                     TO RV030-ANCHOR-CONSTANT.       03490024
032600                                                                  03500024
032700**   USING REGION NUMBER GET TERRITORY NUMBER.                    03510024
032800**   IF NO REGION NUMBER MOVE ZERO TO TERRITORY NUMBER.           03520024
032900                                                                  03530024
033000     INITIALIZE PV-REGN-NBR-X.                                    03540024
033100                                                                  03550024
033300     MOVE ZERO TO PV-TERR-NBR-X.                                  03560024
033400                                                                  03570024
033401     IF RV030-REGION-NBR = ZERO                                   03580024
033402         MOVE ZERO             TO PV-TERR-NBR-X                   03590024
033403     ELSE                                                         03600024
033404         MOVE RV030-REGION-NBR TO PV-REGN-NBR-X                   03610024
033405         MOVE PV-REGN-NBR      TO DK-REGN                         03620024
033406         PERFORM 2300-GET-TERRITORY                               03630024
033407     END-IF.                                                      03640024
033900                                                                  03650024
034000     MOVE PV-TERR-NBR-X TO RV030-TERR-NBR.                        03660024
034100                                                                  03670024
034200     PERFORM 8000-WRITE-OUTPUT.                                   03680024
034300                                                                  03690024
034400     PERFORM 7200-FETCH-EXTRACT-CURSOR.                           03700024
034500                                                                  03710024
034600***************************************************************** 03720024
034700*    USE THE XLKUT071 ROUTINE TO FETCH THE INFORMATION FOR A      03730024
034800*    SPECIFIED LOCATION NUMBER.                                   03740024
034900***************************************************************** 03750024
034500                                                                  03760024
035000 2100-GET-LOC-INFO.                                               03770024
035100                                                                  03780024
035200     INITIALIZE XL071-COMMAREA-REC.                               03790024
035300                                                                  03800024
035400     MOVE XLT00010-LOC-NBR TO XL071-LOCATION-NUMBER               03810024
035500                                                                  03820024
035600     CALL XL071-LOCATION-MODULE USING XL071-COMMAREA-REC.         03830024
035700                                                                  03840024
035800     EVALUATE TRUE                                                03850024
035900         WHEN XL071-NO-ERRORS                                     03860024
036000         WHEN XL071-LOC-NOT-FOUND                                 03870024
036100         WHEN XL071-SQLCODE-N = -305                              03880024
036200         WHEN XL071-SQLCODE-N = -904                              03890024
036300         WHEN XL071-SQLCODE-N = -911                              03900024
036400         WHEN XL071-SQLCODE-N = -913                              03910024
036500             CONTINUE                                             03920024
036600         WHEN XL071-BAD-DB2-RETURN                                03930024
036700             MOVE '2100-GET-LOC-INFO' TO PV-PARAGRAPH             03940024
036800             MOVE 'SELECT ON LOCATION'                            03950024
036900                                      TO PV-DB2-FUNCTION          03960024
037000             MOVE 'GET LOCATION INFO' TO PV-ERROR-MSG             03970024
037100             MOVE 'XLT_LOC'           TO PV-ABEND-TABLE-1         03980024
037200             MOVE 'XLT_DC_LOC_ASGMT'  TO PV-ABEND-TABLE-2         03990024
037300             MOVE XL071-SQLCODE-N     TO SQLCODE                  04000024
037400             PERFORM 9200-SQL-ERROR                               04010024
037500     END-EVALUATE.                                                04020024
037600                                                                  04030024
037700******************************************************************04040024
037800*    FETCH THE DISTRICT AND REGION NUMBER INFORMATION.            04050024
037900******************************************************************04060024
037600                                                                  04070024
038000 2200-GET-DIST-REGN-INFO.                                         04080024
038100                                                                  04090024
038200     INITIALIZE DCLXLT00013.                                      04100024
038300                                                                  04110024
038400     PERFORM                                                      04120024
038500         WITH TEST AFTER                                          04130024
038600         VARYING PV-RETRY-COUNT                                   04140024
038700         FROM 1 BY 1                                              04150024
038800         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 04160024
038900                   OR (SQLCODE = ZERO) OR (SQLCODE = +100))       04170024
039000                                                                  04180024
039100         EXEC SQL                                                 04190024
039200             SELECT                                               04200024
039300                    REGN_NBR                                      04210024
039400               INTO                                               04220024
039500                    :XLT00013-REGN-NBR                            04230024
039600               FROM                                               04240024
039700                    XLT_DIST                                      04250024
039800               WHERE                                              04260024
039900                    DIST_NBR = :XLT00010-DIST-NBR                 04270024
040000         END-EXEC                                                 04280024
040100                                                                  04290024
040200         EVALUATE TRUE                                            04300024
040300             WHEN SQLCODE = +0                                    04310024
040400             WHEN SQLCODE = -904                                  04320024
040500             WHEN SQLCODE = -911                                  04330024
040600             WHEN SQLCODE = -913                                  04340024
040700                 CONTINUE                                         04350024
040800             WHEN SQLCODE = +100                                  04360024
040900                 MOVE ZERO                TO XLT00013-REGN-NBR    04370024
041000                 DISPLAY 'MISSING DIST_NBR = ' XLT00010-DIST-NBR  04380024
041100                         '  LOCATION NBR   = ' XLT00010-LOC-NBR   04390024
041200             WHEN SQLWARN0 NOT EQUAL SPACE                        04400024
041300             WHEN SQLCODE NOT EQUAL ZERO                          04410024
041400                 DISPLAY '** ABEND **'                            04420024
041500                 DISPLAY '** PROGRAM = RVKUT034 **'               04430024
041600                 DISPLAY '** PARAGRAPH = '                        04440024
041700                         '2200-GET-DIST-REGN-INFO **'             04450024
041800                 DISPLAY 'DIST_NBR     = ' XLT00010-DIST-NBR      04460024
041900                 MOVE 'FETCH REGION NBR'  TO PV-ERROR-MSG         04470024
042000                 MOVE 'XLT_DIST'          TO PV-ABEND-TABLE-1     04480024
042100                 PERFORM 9200-SQL-ERROR                           04490024
042200         END-EVALUATE                                             04500024
042300     END-PERFORM.                                                 04510024
042400                                                                  04520024
042500     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          04530024
042600         DISPLAY '** ABEND **'                                    04540024
042700         DISPLAY '** PROGRAM = RVKUT034 **'                       04550024
042800         DISPLAY '** PARAGRAPH = 2200-GET-DIST-REGN-INFO **'      04560024
042900         MOVE 'FETCH REGION NBR MAX RETRIES'  TO PV-ERROR-MSG     04570024
043000         MOVE 'XLT_DIST'                      TO PV-ABEND-TABLE-1 04580024
043100         PERFORM 9200-SQL-ERROR                                   04590024
043200     END-IF.                                                      04600024
043300                                                                  04610024
043400******************************************************************04620024
043500*    SELECT THE TERRITORY NUMBER                                  04630024
043600******************************************************************04640024
043300                                                                  04650024
043700 2300-GET-TERRITORY.                                              04660024
043800                                                                  04670024
043900     INITIALIZE DCLXLT00012.                                      04680024
044000                                                                  04690024
044100     PERFORM                                                      04700024
044200         WITH TEST AFTER                                          04710024
044300         VARYING PV-RETRY-COUNT                                   04720024
044400         FROM 1 BY 1                                              04730024
044500         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 04740024
044600                   OR (SQLCODE = ZERO) OR (SQLCODE = +100))       04750024
044700                                                                  04760024
044800         EXEC SQL                                                 04770024
044900             SELECT TERR_NBR                                      04780024
045000               INTO :XLT00012-TERR-NBR                            04790024
045100               FROM XLT_REGN                                      04800024
045200               WHERE REGN_NBR = :DK-REGN                          04810024
045300         END-EXEC                                                 04820024
045400                                                                  04830024
045500         EVALUATE TRUE                                            04840024
045600             WHEN SQLCODE = +0                                    04850024
045700                 MOVE XLT00012-TERR-NBR TO PV-TERR-NBR            04860024
045800             WHEN SQLCODE = -904                                  04870024
045900             WHEN SQLCODE = -911                                  04880024
046000             WHEN SQLCODE = -913                                  04890024
046100                 CONTINUE                                         04900024
046200             WHEN SQLCODE = +100                                  04910024
046300                 MOVE ZERO  TO PV-TERR-NBR                        04920024
046400                 DISPLAY 'REGION NOT FOUND **'                    04930024
046500                 DISPLAY 'REGION NBR   = ' RV030-REGION-NBR       04940024
046600                 DISPLAY 'LOCATION     = ' RV030-LOCATION-NBR     04950024
046700             WHEN SQLWARN0 NOT EQUAL SPACE                        04960024
046800             WHEN SQLCODE NOT EQUAL ZERO                          04970024
046900                 DISPLAY '** ABEND **'                            04980024
047000                 DISPLAY '** PROGRAM = RVKUT034 **'               04990024
047100                 DISPLAY '** PARAGRAPH = '                        05000024
047200                         '2300-GET-TERRITORY **'                  05010024
047300                 DISPLAY 'REGN_NBR     = ' RV030-REGION-NBR       05020024
047400                 MOVE 'SELECT TERRITORY'  TO PV-ERROR-MSG         05030024
047500                 MOVE 'XLT_REGN'          TO PV-ABEND-TABLE-1     05040024
047600                 PERFORM 9200-SQL-ERROR                           05050024
047700         END-EVALUATE                                             05060024
047800     END-PERFORM.                                                 05070024
047900                                                                  05080024
048000     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          05090024
048100         DISPLAY '** ABEND **'                                    05100024
048200         DISPLAY '** PROGRAM = RVKUT034 **'                       05110024
048300         DISPLAY '** PARAGRAPH = 2300-GET-TERRITORY **'           05120024
048400         MOVE 'FETCH TERRITORY NBR MAX RETRIES' TO PV-ERROR-MSG   05130024
048500         MOVE 'XLT_REGN' TO PV-ABEND-TABLE-1                      05140024
048600         PERFORM 9200-SQL-ERROR                                   05150024
048700     END-IF.                                                      05160024
048800                                                                  05170024
048900******************************************************************05180024
049000*    OPEN CURSOR                                                  05190024
049100******************************************************************05200024
048800                                                                  05210024
049200 7000-OPEN-EXTRACT-CURSOR.                                        05220024
049300                                                                  05230024
049400     PERFORM                                                      05240024
049500         WITH TEST AFTER                                          05250024
049600         VARYING PV-RETRY-COUNT                                   05260024
049700         FROM 1 BY 1                                              05270024
049800         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 05280024
049900                   OR (SQLCODE = ZERO))                           05290024
050000         EXEC SQL                                                 05300024
050100             OPEN EXTRACT-CSR                                     05310024
050200         END-EXEC                                                 05320024
050300                                                                  05330024
050400         EVALUATE TRUE                                            05340024
050500             WHEN SQLCODE = +0                                    05350024
050600             WHEN SQLCODE = -904                                  05360024
050700             WHEN SQLCODE = -911                                  05370024
050800             WHEN SQLCODE = -913                                  05380024
050900                 CONTINUE                                         05390024
051000             WHEN SQLWARN0 NOT EQUAL SPACE                        05400024
051100             WHEN SQLCODE NOT EQUAL ZERO                          05410024
051200                 DISPLAY '** ABEND **'                            05420024
051300                 DISPLAY '** PROGRAM = RVKUT034 **'               05430024
051400                 DISPLAY '** PARAGRAPH = '                        05440024
051500                         '7000-OPEN-EXTRACT-CURSOR **'            05450024
051600                 MOVE 'OPEN CURSOR'   TO PV-ERROR-MSG             05460024
051700                 MOVE 'XLT_LOC'       TO PV-ABEND-TABLE-1         05470024
051800                 PERFORM 9200-SQL-ERROR                           05480024
051900         END-EVALUATE                                             05490024
052000     END-PERFORM.                                                 05500024
052100                                                                  05510024
052200     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          05520024
052300         DISPLAY '** ABEND **'                                    05530024
052400         DISPLAY '** PROGRAM = RVKUT034 **'                       05540024
052500         DISPLAY '** PARAGRAPH =  7000-OPEN-EXTRACT-CURSOR **'    05550024
052600         MOVE 'OPEN CURSOR MAX RETRIES'  TO PV-ERROR-MSG          05560024
052700         MOVE 'XLT_LOC'                  TO PV-ABEND-TABLE-1      05570024
052800         PERFORM 9200-SQL-ERROR                                   05580024
052900     END-IF.                                                      05590024
053000                                                                  05600024
053100******************************************************************05610024
053200*    CLOSE CURSOR                                                 05620024
053300******************************************************************05630024
053000                                                                  05640024
053400 7100-CLOSE-EXTRACT-CURSOR.                                       05650024
053500                                                                  05660024
053600     PERFORM                                                      05670024
053700         WITH TEST AFTER                                          05680024
053800         VARYING PV-RETRY-COUNT                                   05690024
053900         FROM 1 BY 1                                              05700024
054000         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 05710024
054100                   OR (SQLCODE = ZERO))                           05720024
054200         EXEC SQL                                                 05730024
054300             CLOSE EXTRACT-CSR                                    05740024
054400         END-EXEC                                                 05750024
054500                                                                  05760024
054600         EVALUATE TRUE                                            05770024
054700             WHEN SQLCODE = +0                                    05780024
054800             WHEN SQLCODE = -904                                  05790024
054900             WHEN SQLCODE = -911                                  05800024
055000             WHEN SQLCODE = -913                                  05810024
055100                 CONTINUE                                         05820024
055200             WHEN SQLWARN0 NOT EQUAL SPACE                        05830024
055300             WHEN SQLCODE NOT EQUAL ZERO                          05840024
055400                 DISPLAY '** ABEND **'                            05850024
055500                 DISPLAY '** PROGRAM = RVKUT034 **'               05860024
055600                 DISPLAY '** PARAGRAPH = '                        05870024
055700                         '7100-CLOSE-EXTRACT-CURSOR**'            05880024
055800                 MOVE 'CLOSE CURSOR'  TO PV-ERROR-MSG             05890024
055900                 MOVE 'XLT_LOC'       TO PV-ABEND-TABLE-1         05900024
056000                 PERFORM 9200-SQL-ERROR                           05910024
056100         END-EVALUATE                                             05920024
056200     END-PERFORM.                                                 05930024
056300                                                                  05940024
056400     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          05950024
056500         DISPLAY '** ABEND **'                                    05960024
056600         DISPLAY '** PROGRAM = RVKUT034 **'                       05970024
056700         DISPLAY '** PARAGRAPH = 7100-CLOSE-EXTRACT-CURSOR**'     05980024
056800         MOVE 'CLOSE CURSOR MAX RETRIES' TO PV-ERROR-MSG          05990024
056900         MOVE 'XLT_LOC'                  TO PV-ABEND-TABLE-1      06000024
057000         PERFORM 9200-SQL-ERROR                                   06010024
057100     END-IF.                                                      06020024
057200                                                                  06030024
057300******************************************************************06040024
057400*    FETCH CURSOR                                                 06050024
057500******************************************************************06060024
057200                                                                  06070024
057600 7200-FETCH-EXTRACT-CURSOR.                                       06080024
057700                                                                  06090024
057800     PERFORM                                                      06100024
057900         WITH TEST AFTER                                          06110024
058000         VARYING PV-RETRY-COUNT                                   06120024
058100         FROM 1 BY 1                                              06130024
058200         UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)                 06140024
058300                   OR (SQLCODE = ZERO) OR (SQLCODE = +100))       06150024
058400         EXEC SQL                                                 06160024
058500              FETCH EXTRACT-CSR                                   06170024
058600              INTO  :XLT00010-LOC-NBR                             06180024
058700                  , :XLT00010-DIST-NBR                            06190024
058800         END-EXEC                                                 06200024
058900                                                                  06210024
059000         EVALUATE TRUE                                            06220024
059100             WHEN SQLCODE = ZERO                                  06230024
059200             WHEN SQLCODE = -904                                  06240024
059300             WHEN SQLCODE = -911                                  06250024
059400             WHEN SQLCODE = -913                                  06260024
059500                 CONTINUE                                         06270024
059600             WHEN SQLCODE = +100                                  06280024
059700                 SET PS-END-CSR       TO TRUE                     06290024
059800             WHEN SQLWARN0 NOT EQUAL SPACE                        06300024
059900             WHEN SQLCODE NOT EQUAL ZERO                          06310024
060000                 DISPLAY '** ABEND **'                            06320024
060100                 DISPLAY '** PROGRAM = RVKUT034 **'               06330024
060200                 DISPLAY '** PARAGRAPH = '                        06340024
060300                         '7200-FETCH-EXTRACT-CURSOR**'            06350024
060400                 MOVE 'FETCH CURSOR'  TO PV-ERROR-MSG             06360024
060500                 MOVE 'XLT_LOC'       TO PV-ABEND-TABLE-1         06370024
060600                 PERFORM 9200-SQL-ERROR                           06380024
060700         END-EVALUATE                                             06390024
060800     END-PERFORM.                                                 06400024
060900                                                                  06410024
061000     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          06420024
061100         DISPLAY '** ABEND **'                                    06430024
061200         DISPLAY '** PROGRAM = RVKUT034 **'                       06440024
061300         DISPLAY '** PARAGRAPH = 7200-FETCH-EXTRACT-CURSOR**'     06450024
061400         MOVE 'FETCH CURSOR MAX RETRIES' TO PV-ERROR-MSG          06460024
061500         MOVE 'XLT_LOC'                  TO PV-ABEND-TABLE-1      06470024
061600         PERFORM 9200-SQL-ERROR                                   06480024
061700     END-IF.                                                      06490024
061800                                                                  06500024
061900***************************************************************** 06510024
062000*    WRITE OUTPUT FILE                                            06520024
062100***************************************************************** 06530024
061800                                                                  06540024
062200 8000-WRITE-OUTPUT.                                               06550024
062300                                                                  06560024
062400     WRITE RV-LOCATION-RECORD FROM RV030-SITE-RECORD.             06570024
062500                                                                  06580024
062600     ADD 1  TO PV-RECS-WRITTEN.                                   06590024
062700                                                                  06600024
062800***************************************************************** 06610024
062900*    CREATE MARKER FILE                                           06620024
063000***************************************************************** 06630024
062700                                                                  06640024
063100 8500-CREATE-MARKER.                                              06650024
063200                                                                  06660024
063300     MOVE PV-RUN-DATE-CN  TO PV-CREATE-DATE.                      06670024
063400     MOVE 'SITE.DAT'      TO PV-SITE-DAT.                         06680024
063500     MOVE PV-FILE-NAME    TO VL029-FILE-NAME.                     06690024
063600     MOVE PV-RECS-WRITTEN TO VL029-RECORD-COUNT.                  06700024
063700     MOVE PV-RUN-DATE-CN  TO VL029-BUILD-DATE.                    06710024
063800     MOVE PV-RUN-TIME-CN  TO VL029-BUILD-TIME.                    06720024
063900     MOVE 'X'             TO VL029-ANCHOR-CONSTANT.               06730024
064000                                                                  06740024
064100     WRITE RV-MARKER-RECORD FROM VL029-MARKER-RECORD.             06750024
064200                                                                  06760024
064300***************************************************************** 06770024
064400*    END OF JOB PROCESSING                                        06780024
064500***************************************************************** 06790024
064200                                                                  06800024
064600 9000-EOJ.                                                        06810024
064700                                                                  06820024
064800     PERFORM 7100-CLOSE-EXTRACT-CURSOR.                           06830024
064900                                                                  06840024
065000     DISPLAY 'RECORDS WRITTEN ===>  ' PV-RECS-WRITTEN.            06850024
065100                                                                  06860024
065200     PERFORM 8500-CREATE-MARKER.                                  06870024
065300                                                                  06880024
065400     CLOSE RV-LOCATION-FILE                                       06890024
065500           RV-MARKER-FILE.                                        06900024
065600                                                                  06910024
065700***************************************************************** 06920024
065800*    PARAGRAPH EXECUTED WHEN SERIOUS DB2 ERROR OCCURRED           06930024
065900***************************************************************** 06940024
065600                                                                  06950024
066000 9200-SQL-ERROR.                                                  06960024
066100                                                                  06970024
066200     CLOSE RV-LOCATION-FILE                                       06980024
066300           RV-MARKER-FILE.                                        06990024
066400                                                                  07000024
066500     MOVE SQLCODE     TO SQLCODE2.                                07010024
066600     MOVE SQLERRD(3)  TO SQLERRD3.                                07020024
066700                                                                  07030024
066800     DISPLAY '** ABEND **         ** = SQLERROR'.                 07040024
066900     DISPLAY '** PROGRAM          ** = ' PC-CURRENT-PGM-RVKUT034. 07050024
067000     DISPLAY '** PARAGRAPH        ** = ' PV-PARAGRAPH.            07060024
067100     DISPLAY '** OPERATION        ** = ' PV-DB2-FUNCTION.         07070024
067200     DISPLAY '**                  ** = ' PV-ABEND-TABLE-1.        07080024
067300     DISPLAY '**                  ** = ' PV-ABEND-TABLE-2.        07090024
067400     DISPLAY '**                  ** = ' PV-ERROR-MSG.            07100024
067600     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                07110024
067700     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                07120024
067800     DISPLAY '** SQLERRM          ** = ' SQLERRM.                 07130024
067900     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                07140024
068000                                                                  07150024
068100     COPY DPPD004.                                                07160024
068200                                                                  07170024
068300     MOVE +4013  TO PV-ABEND-CODE.                                07180024
068400                                                                  07190024
068500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         07200024
068600                                                                  07210024
068700*************  END OF RVKUT034  ********************************  07220024
