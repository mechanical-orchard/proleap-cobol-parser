000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    SUKUT931.                                         00020000
000300 AUTHOR.        RON KRIER.                                        00030000
000400 INSTALLATION.  KOHLS.                                            00040000
000500 DATE-WRITTEN   FEBRUARY, 2015.                                   00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800* ************************************************************** *00080000
000900* * SUKUT931 - READS AN INPUT RECORD AND GETS DATA FROM THE    * *00090000
001000* *            STORE EXPECTED/IN-TRANSIT DATABASES TO EXTRACT  * *00100000
001100* *            SO THE DATA CAN BE POPULATED TO THE TEST        * *00110000
001200* *            SYSTEM.                                         * *00120000
001300* *                                                            * *00130000
001400* * PURPOSE:                                                   * *00140000
001500* * GETTING TEST DATA FOR THE THE STORE EXPECTED/IN-TRANSIT    * *00150000
001600* * DATABASES HAS ALWAYS BEEN A CHALLENGE.  THIS PROGRAM WILL  * *00160000
001700* * PULL IN AN INPUT FILE (LIKE A FILE FROM SUK060 OR SOME     * *00170000
001800* * OTHER PCRD010 FILE) AND EXTRACT DATA FROM THE DATABASES    * *00180000
001900* * SO THAT WE CAN PULL THE DATA INTO THE TEST TABLES.  THIS   * *00190000
002000* * PROGRAM WILL EXTRACT FROM THE PCT_TRN_CLSN_BAL AND         * *00200000
002100* * PCT_TRN_CLSN_DTL TABLES AS WELL AS THE TSUOBTR TABLE SINCE * *00210000
002200* * THERE IS RI TO THAT TABLE FOR SOME OF THE TRANSACTIONS.    * *00220000
002300* * PROGRAM WILL ALSO PULL SKU LEVEL DATA FROM XLT_SKU TO PUT  * *00230011
002400* * TO AN OUTPUT FILE FOR LOADING INTO TEST.  THIS WILL HELP   * *00240011
002500* * WITH THE PCKCS ONLINE SCREENS TO BE ABLE TO VIEW THE       * *00250011
002600* * STORE EXPECTED/IN-TRANSIT DATA ON THOSE SCREENS.           * *00260011
002700* ************************************************************** *00270000
002800 ENVIRONMENT DIVISION.                                            00280000
002900 CONFIGURATION SECTION.                                           00290000
003000 SOURCE-COMPUTER.        IBM-3090.                                00300000
003100 OBJECT-COMPUTER.        IBM-3090.                                00310000
003200                                                                  00320000
003300 INPUT-OUTPUT SECTION.                                            00330000
003400 FILE-CONTROL.                                                    00340000
003500                                                                  00350000
003600     SELECT INPUT-FILE                    ASSIGN TO IN01.         00360000
003700     SELECT OUTPUT-BAL-FILE               ASSIGN TO OUT01.        00370000
003800     SELECT OUTPUT-DTL-FILE               ASSIGN TO OUT02.        00380000
003900     SELECT OUTPUT-OBTR-FILE              ASSIGN TO OUT03.        00390000
004000     SELECT OUTPUT-SKU-FILE               ASSIGN TO OUT04.        00400011
004100                                                                  00410000
004200******************************************************************00420000
004300 DATA DIVISION.                                                   00430000
004400 FILE SECTION.                                                    00440000
004500                                                                  00450000
004600 FD  INPUT-FILE                                                   00460000
004700     RECORDING MODE IS F                                          00470000
004800     LABEL RECORDS ARE STANDARD                                   00480000
004900     BLOCK CONTAINS 0 RECORDS.                                    00490000
005000 01  INPUT-RECORD                    PIC  X(100).                 00500001
005100                                                                  00510000
005200 FD  OUTPUT-BAL-FILE                                              00520000
005300     RECORDING MODE IS F                                          00530000
005400     LABEL RECORDS ARE STANDARD                                   00540000
005500     BLOCK CONTAINS 0 RECORDS.                                    00550000
005600 01  OUTPUT-BAL-RECORD               PIC  X(22).                  00560001
005700                                                                  00570001
005800 FD  OUTPUT-DTL-FILE                                              00580001
005900     RECORDING MODE IS F                                          00590001
006000     LABEL RECORDS ARE STANDARD                                   00600001
006100     BLOCK CONTAINS 0 RECORDS.                                    00610001
006200 01  OUTPUT-DTL-RECORD               PIC  X(64).                  00620001
006300                                                                  00630001
006400 FD  OUTPUT-OBTR-FILE                                             00640001
006500     RECORDING MODE IS F                                          00650001
006600     LABEL RECORDS ARE STANDARD                                   00660001
006700     BLOCK CONTAINS 0 RECORDS.                                    00670001
006800 01  OUTPUT-OBTR-RECORD              PIC  X(71).                  00680001
006900                                                                  00690011
007000 FD  OUTPUT-SKU-FILE                                              00700011
007100     RECORDING MODE IS F                                          00710011
007200     LABEL RECORDS ARE STANDARD                                   00720011
007300     BLOCK CONTAINS 0 RECORDS.                                    00730011
007400 01  OUTPUT-SKU-RECORD               PIC  X(131).                 00740011
007500                                                                  00750000
007600                                                                  00760000
007700                                                                  00770000
007800 WORKING-STORAGE SECTION.                                         00780000
007900                                                                  00790000
008000 01  PC-PROGRAM-CONSTANTS.                                        00800000
008100     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'SUKUT931'.  00810000
008200     05  PC-PGM-PROGRESS-DESC.                                    00820000
008300         10  PC-ORD-SKU-ADD          PIC X(20) VALUE              00830000
008400             'ORD_SKU_ADD         '.                              00840000
008500     05  PC-ABEND-INFO.                                           00850000
008600         10  PC-ABEND                PIC X(11) VALUE              00860000
008700                                               '** ABEND **'.     00870000
008800         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00880000
008900                                               '- PARA       : '. 00890000
009000         10  PC-ABEND-MSG-DISPLAY-PARA                            00900000
009100                                     PIC X(15) VALUE              00910000
009200                                               '  CALLED PARA: '. 00920000
009300         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00930000
009400                                               '  FOR ABEND# : '. 00940000
009500         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00950000
009600                                               '- ERROR IS   : '. 00960000
009700         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00970000
009800         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              00980000
009900                                               '- ACTION     : '. 00990000
010000     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 5000.        01000000
010100     05  PC-1                        PIC 9(04) VALUE 0001.        01010000
010200     05  PC-2                        PIC 9(04) VALUE 0002.        01020000
010300     05  PC-3                        PIC 9(04) VALUE 0003.        01030000
010400     05  PC-4                        PIC 9(04) VALUE 0004.        01040000
010500     05  PC-5                        PIC 9(04) VALUE 0005.        01050000
010600     05  PC-6                        PIC 9(04) VALUE 0006.        01060000
010700     05  PC-7                        PIC 9(04) VALUE 0007.        01070000
010800     05  PC-8                        PIC 9(04) VALUE 0008.        01080000
010900                                                                  01090000
011000 01  PS-PROGRAM-SWITCHES.                                         01100000
011100     05  PS-INPUT-EOF-SW             PIC X(01) VALUE 'N'.         01110000
011200         88  PS-INPUT-EOF                      VALUE 'Y'.         01120000
011300         88  PS-INPUT-NOT-EOF                  VALUE 'N'.         01130000
011400     05  PS-INPUT-MATCH-SW           PIC X(01) VALUE 'N'.         01140002
011500         88  PS-INPUT-MATCH                    VALUE 'Y'.         01150002
011600         88  PS-INPUT-NOT-MATCH                VALUE 'N'.         01160002
011700     05  PS-WRITE-FROM-SW            PIC X(01) VALUE 'N'.         01170000
011800         88  PS-WRITE-FROM-INPUT               VALUE 'I'.         01180000
011900         88  PS-WRITE-FROM-CURSOR              VALUE 'C'.         01190000
012000     05  PS-END-OF-BAL-CSR-SW        PIC X(01) VALUE 'N'.         01200002
012100         88  PS-END-OF-BAL-CSR                 VALUE 'Y'.         01210002
012200     05  PS-END-OF-DTL-CSR-SW        PIC X(01) VALUE 'N'.         01220002
012300         88  PS-END-OF-DTL-CSR                 VALUE 'Y'.         01230002
012400     05  PS-CURSOR-HAS-DATA-SW       PIC X(01) VALUE 'N'.         01240000
012500         88  PS-CURSOR-HAS-DATA                VALUE 'Y'.         01250000
012600         88  PS-CURSOR-HAS-NO-DATA             VALUE 'N'.         01260000
012700     05  PS-TABLE-LOOP-DONE-SW       PIC X(01) VALUE 'N'.         01270000
012800         88  PS-TABLE-LOOP-DONE                VALUE 'Y'.         01280000
012900         88  PS-TABLE-LOOP-NOT-DONE            VALUE 'N'.         01290000
013000     05  PS-OPEN-SW                  PIC X(01) VALUE 'N'.         01300000
013100         88  PS-OPEN-DID-WORK                  VALUE 'Y'.         01310000
013200         88  PS-OPEN-DID-NOT-WORK              VALUE 'N'.         01320000
013300     05  PS-PO-ON-TPURCHS-SW         PIC X(01) VALUE 'Y'.         01330000
013400         88  PS-PO-ON-TPURCHS                  VALUE 'Y'.         01340000
013500         88  PS-PO-NOT-ON-TPURCHS              VALUE 'N'.         01350000
013600     05  PS-PO-PREV-PACK-PO-SW       PIC X(01) VALUE 'N'.         01360000
013700         88  PS-PO-NOT-PREV-PACK-PO            VALUE 'N'.         01370000
013800         88  PS-PO-PREV-PACK-PO                VALUE 'Y'.         01380000
013900     05  PS-PO-SKU-ON-TPURITM-SW     PIC X(01) VALUE 'Y'.         01390000
014000         88  PS-PO-SKU-ON-TPURITM              VALUE 'Y'.         01400000
014100         88  PS-PO-SKU-NOT-ON-TPURITM          VALUE 'N'.         01410000
014200     05  PS-PO-ON-TPOPRPK-SW         PIC X(01) VALUE 'Y'.         01420000
014300         88  PS-PO-ON-TPOPRPK                  VALUE 'Y'.         01430000
014400         88  PS-PO-NOT-ON-TPOPRPK              VALUE 'N'.         01440000
014500     05  PS-SKU-ON-XLT-SKU-SW        PIC X(01) VALUE 'Y'.         01450000
014600         88  PS-SKU-ON-XLT-SKU                 VALUE 'Y'.         01460000
014700         88  PS-SKU-NOT-ON-XLT-SKU             VALUE 'N'.         01470000
014800     05  PS-SKU-ON-XLT-PK-SW         PIC X(01) VALUE 'Y'.         01480000
014900         88  PS-SKU-ON-XLT-PK                  VALUE 'Y'.         01490000
015000         88  PS-SKU-NOT-ON-XLT-PK              VALUE 'N'.         01500000
015100     05  PS-PO-IS-PREPACK-SW         PIC X(01) VALUE 'Y'.         01510000
015200         88  PS-PO-IS-PREPACK                  VALUE 'Y'.         01520000
015300         88  PS-PO-IS-NOT-PREPACK              VALUE 'N'.         01530000
015400     05  PS-PO-IS-UPDATED-SW         PIC X(01) VALUE 'Y'.         01540000
015500         88  PS-PO-IS-UPDATED                  VALUE 'Y'.         01550000
015600         88  PS-PO-IS-NOT-UPDATED              VALUE 'N'.         01560000
015700     05  PS-SKU-TBL-SW               PIC X(04) VALUE 'SKU '.      01570000
015800         88  PS-SKU-ON-XLT-SKU-TBL             VALUE 'SKU '.      01580000
015900         88  PS-SKU-ON-XLT-PK-TBL              VALUE 'PACK'.      01590000
016000         88  PS-SKU-ON-BOTH-TBL                VALUE 'BOTH'.      01600000
016100         88  PS-SKU-NOT-FOUND                  VALUE 'NFND'.      01610000
016200                                                                  01620000
016300 01  PV-PROGRAM-VARIABLES.                                        01630000
016400     05  PV-PREV-INTR-UPC-ID         PIC S9(9) COMP.              01640001
016500     05  PV-PREV-LOC-NBR             PIC S9(4) COMP.              01650001
016600     05  PV-PREV-OTBND-TRIP-ID       PIC S9(9) COMP.              01660002
016700     05  PV-PREV-DISP-UPC-ID         PIC  9(9) VALUE 0.           01670001
016800     05  PV-PREV-DISP-LOC-NBR        PIC  9(4) VALUE 0.           01680001
016900     05  PV-DISP-INTR-UPC-ID         PIC  9(9) VALUE 0.           01690002
017000     05  PV-SKU-INTR-UPC-ID          PIC S9(9) COMP.              01700011
017100     05  PV-DISP-LOC-NBR             PIC  9(4) VALUE 0.           01710002
017200     05  PV-DISP-OTBND-TRIP-ID       PIC  9(9) VALUE 0.           01720006
017300     05  PV-INPUT-READ               PIC  9(9) VALUE 0.           01730000
017400     05  PV-INPUT-CHECK-CNT          PIC  9(9) VALUE 0.           01740000
017500     05  PV-INPUT-MATCHED            PIC  9(9) VALUE 0.           01750010
017510     05  PV-INPUT-MATCHED-SECONDS    PIC  9(9) VALUE 0.           01751013
017600     05  PV-MATCHED-DTL-NOT-WRITTEN  PIC  9(9) VALUE 0.           01760010
017700     05  PV-OUTPUT-BAL-WRITTEN       PIC  9(9) VALUE 0.           01770001
017800     05  PV-OUTPUT-DTL-WRITTEN       PIC  9(9) VALUE 0.           01780001
017900     05  PV-OUTPUT-OBTR-WRITTEN      PIC  9(9) VALUE 0.           01790001
018000     05  PV-OUTPUT-SKU-WRITTEN       PIC  9(9) VALUE 0.           01800011
018100     05  PV-OUTPUT-FROM-INPUT        PIC  9(9) VALUE 0.           01810000
018200     05  PV-DIFF-FOUND               PIC  9(9) VALUE 0.           01820000
018300     05  PV-DISPLAY-FIELD            PIC  9(9) VALUE 0.           01830000
018400     05  PV-DISPLAY-FIELD2           PIC  9(9) VALUE 0.           01840000
018500     05  PV-DISPLAY-FIELD3           PIC  9(4) VALUE 0.           01850000
018600     05  PV-DISPLAY-FIELD4           PIC  9(5) VALUE 0.           01860000
018700     05  PV-RECS-WITH-MATCHES-CNT    PIC  9(9) VALUE 0.           01870000
018800     05  PV-TABLE-ROW-SELECT-CNT     PIC  9(9) VALUE 0.           01880000
018900     05  PV-EXTRACT-WRITTEN-CNT      PIC  9(9) VALUE 0.           01890000
019000                                                                  01900005
019100     05  PV-NULL-IND                 PIC S9(4) VALUE ZEROS        01910005
019200                                               COMP SYNC.         01920005
019300                                                                  01930000
019400     05  PV-SPACE-CNTR               PIC 9(04) VALUE 0.           01940000
019500     05  PV-CHAR-CNTR                PIC 9(04) VALUE 0.           01950000
019600     05  PV-CONVERSION-FIELD-9       PIC 9(08) VALUE 0.           01960000
019700                                                                  01970000
019800     05  PV-CC-TIMESTAMP             PIC X(26) VALUE SPACES.      01980000
019900     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACES.      01990000
020000     05  PV-DB2-OPERATION-MSG-1      PIC X(79) VALUE SPACES.      02000000
020100     05  PV-DB2-TABLE-NAME           PIC X(18) VALUE SPACES.      02010000
020200     05  PV-DISPLAY-NTH-MULTIPLE     PIC 9(9)  VALUE 0.           02020000
020300     05  PV-DISPLAY-NTH-REMAINDER    PIC 9(9)  VALUE 0.           02030000
020400     05  PV-SQLCODE                  PIC +999  VALUE ZERO.        02040000
020500                                                                  02050002
020600     05  PV-EVENT-TMST              PIC  X(26).                   02060002
020700     05  FILLER REDEFINES     PV-EVENT-TMST.                      02070002
020800         10 PV-TMST-CC              PIC  9(02).                   02080002
020900         10 PV-TMST-YY              PIC  9(02).                   02090002
021000         10 FILLER                  PIC  X(01).                   02100002
021100         10 PV-TMST-MM              PIC  9(02).                   02110002
021200         10 FILLER                  PIC  X(01).                   02120002
021300         10 PV-TMST-DD              PIC  9(02).                   02130002
021400         10 FILLER                  PIC  X(01).                   02140002
021500         10 PV-TMST-HH              PIC  9(02).                   02150002
021600         10 FILLER                  PIC  X(01).                   02160002
021700         10 PV-TMST-MN              PIC  9(02).                   02170002
021800         10 FILLER                  PIC  X(01).                   02180002
021900         10 PV-TMST-SS              PIC  9(02).                   02190002
022000         10 FILLER                  PIC  X(07).                   02200002
022100                                                                  02210000
022200                                                                  02220000
022300 01 TBL-DTL-ENTRIES.                                              02230001
022400    05 TBL-DTL-ENTRY            OCCURS 1000 TIMES                 02240015
022500                                INDEXED BY DTL-INX.               02250001
022600       10 TBL-DTL-TRN-CLSN-CDE          PIC   X(2).               02260001
022700       10 TBL-DTL-IN-TRNST-TRN-TMST     PIC   X(26).              02270001
022800       10 TBL-DTL-TRN-TYP-CDE           PIC   X(2).               02280001
022900       10 TBL-DTL-TRN-CLSN-PRCG-QTY     PIC  S9(9) COMP.          02290001
023000       10 TBL-DTL-TRN-CLSN-BAL-QTY      PIC  S9(9) COMP.          02300001
023100       10 TBL-DTL-UPD-USR-ID            PIC   X(8).               02310001
023200       10 TBL-DTL-OTBND-TRIP-ID         PIC  S9(9) COMP.          02320001
023300       10 TBL-DTL-PO-NBR                PIC  S9(9) COMP.          02330001
023400       10 TBL-DTL-RCVR-SEQ-NBR          PIC  S9(9) COMP.          02340001
023500       10 TBL-DTL-KEEP-SW               PIC   X(1).               02350001
023600          88 TBL-DTL-KEEP                     VALUE 'Y'.          02360001
023700          88 TBL-DTL-NO-KEEP                  VALUE 'N'.          02370001
023800                                                                  02380001
023900 01  OR-BAL-OUTPUT-RECORD.                                        02390001
024000     05  OR-BAL-INTR-UPC-ID          PIC S9(9) COMP.              02400001
024100     05  OR-BAL-LOC-NBR              PIC S9(4) COMP.              02410001
024200     05  OR-BAL-TRN-CLSN-CDE         PIC  X(2).                   02420001
024300     05  OR-BAL-TRN-CLSN-QTY         PIC S9(9) COMP.              02430001
024400     05  OR-BAL-LAST-UPD-DTE         PIC  X(10).                  02440001
024500                                                                  02450001
024600 01  PV-BAL-SE-OUTPUT-RECORD.                                     02460001
024700     05  PV-BAL-SE-INTR-UPC-ID       PIC S9(9) COMP.              02470001
024800     05  PV-BAL-SE-LOC-NBR           PIC S9(4) COMP.              02480001
024900     05  PV-BAL-SE-TRN-CLSN-CDE      PIC  X(2).                   02490001
025000     05  PV-BAL-SE-TRN-CLSN-QTY      PIC S9(9) COMP.              02500001
025100     05  PV-BAL-SE-LAST-UPD-DTE      PIC  X(10).                  02510001
025200                                                                  02520000
025300 01  PV-BAL-IT-OUTPUT-RECORD.                                     02530001
025400     05  PV-BAL-IT-INTR-UPC-ID       PIC S9(9) COMP.              02540001
025500     05  PV-BAL-IT-LOC-NBR           PIC S9(4) COMP.              02550001
025600     05  PV-BAL-IT-TRN-CLSN-CDE      PIC  X(2).                   02560001
025700     05  PV-BAL-IT-TRN-CLSN-QTY      PIC S9(9) COMP.              02570001
025800     05  PV-BAL-IT-LAST-UPD-DTE      PIC  X(10).                  02580001
025900                                                                  02590001
026000 01  OR-DTL-OUTPUT-RECORD.                                        02600001
026100     05  OR-DTL-INTR-UPC-ID          PIC S9(9) COMP.              02610001
026200     05  OR-DTL-LOC-NBR              PIC S9(4) COMP.              02620001
026300     05  OR-DTL-TRN-CLSN-CDE         PIC  X(2).                   02630001
026400     05  OR-DTL-IN-TRNST-TRN-TMST    PIC  X(26).                  02640001
026500     05  OR-DTL-TRN-TYP-CDE          PIC  X(2).                   02650001
026600     05  OR-DTL-TRN-CLSN-PRCG-QTY    PIC S9(9) COMP.              02660001
026700     05  OR-DTL-TRN-CLSN-BAL-QTY     PIC S9(9) COMP.              02670001
026800     05  OR-DTL-UPD-USR-ID           PIC  X(8).                   02680001
026900     05  OR-DTL-OTBND-TRIP-ID        PIC S9(9) COMP.              02690001
027000     05  OR-DTL-PO-NBR               PIC S9(9) COMP.              02700001
027100     05  OR-DTL-RCVR-SEQ-NBR         PIC S9(9) COMP.              02710001
027200                                                                  02720001
027300 01  OR-OBTR-OUTPUT-RECORD.                                       02730001
027400     05  OR-OBTR-OTBND-TRIP-ID       PIC S9(9) COMP.              02740001
027500     05  OR-OBTR-ORGN-OPER-UNT-ID    PIC S9(4) COMP.              02750001
027600     05  OR-OBTR-DEST-OPER-UNT-ID    PIC S9(4) COMP.              02760001
027700     05  OR-OBTR-TRLR-SRL-NBR        PIC S9(9) COMP.              02770001
027800     05  OR-OBTR-BOL-ID              PIC  X(30).                  02780001
027900     05  OR-OBTR-EST-ARRVL-TMST      PIC  X(26).                  02790001
028000     05  OR-OBTR-TRIP-ACTV-CDE       PIC  X(1).                   02800001
028100     05  OR-OBTR-DOOR-TYP-CDE        PIC  X(2).                   02810001
028200                                                                  02820011
028300 01  OR-SKU-OUTPUT-RECORD.                                        02830011
028400     05  OR-SKU-INTR-UPC-ID          PIC S9(9) COMP.              02840011
028500     05  OR-SKU-STYL-ID              PIC S9(8)V COMP-3.           02850011
028600     05  OR-SKU-ITM-NBR              PIC S9(15)V COMP-3.          02860011
028700     05  OR-SKU-SKU-NBR              PIC S9(8)V COMP-3.           02870011
028800     05  OR-SKU-SKU-STAT-CDE         PIC  X(2).                   02880011
028900     05  OR-SKU-SKU-STAT-DESC        PIC  X(10).                  02890011
029000     05  OR-SKU-INNR-PK-QTY          PIC S9(4) COMP.              02900011
029100     05  OR-SKU-OUTR-PK-QTY          PIC S9(4) COMP.              02910011
029200     05  OR-SKU-SKU-DESC             PIC  X(30).                  02920011
029300     05  OR-SKU-KOHLS-SIZE-CDE       PIC S9(9) COMP.              02930011
029400     05  OR-SKU-SIZE-DESC            PIC  X(10).                  02940011
029500     05  OR-SKU-NRF-CLOR-CDE         PIC  X(3).                   02950011
029600     05  OR-SKU-SHRT-CLOR-DESC       PIC  X(4).                   02960011
029700     05  OR-SKU-CSTM-CLOR-DESC       PIC  X(10).                  02970011
029800     05  OR-SKU-REGN-PRIC-IND        PIC  X(1).                   02980011
029900     05  OR-SKU-KY-ITM-IND           PIC  X(1).                   02990011
030000     05  OR-SKU-GP-CDE               PIC  X(3).                   03000011
030100     05  OR-SKU-LAST-UPD-TMST        PIC  X(26).                  03010011
030200     05  OR-SKU-WHSE-RPLNT-IND       PIC  X(1).                   03020011
030300                                                                  03030001
030400 01  DK-DATA-KEY-FIELDS.                                          03040000
030500     05  DK-INTR-UPC-ID              PIC  S9(9) COMP    VALUE 0.  03050001
030600     05  DK-LOC-NBR                  PIC  S9(4) COMP    VALUE 0.  03060003
030700     05  DK-OTBND-TRIP-ID            PIC  S9(9) COMP    VALUE 0.  03070001
030710     05  DK-SKU-INTR-UPC-ID          PIC  S9(9) COMP    VALUE 0.  03071011
030800                                                                  03080000
030900 01  DM-DISPLAY-MESSAGE.                                          03090000
031000     05  DM-01-10.                                                03100000
031100         10  DM-PROGRAM              PIC X(08) VALUE SPACE.       03110000
031200         10  FILLER                  PIC X(02) VALUE ': '.        03120000
031300     05  DM-11-80.                                                03130000
031400         10  FILLER                  PIC X(37) VALUE              03140000
031500                        'SELECT ROWS MATCHING PO DRIVER FILE, '.  03150000
031600         10  FILLER                  PIC X(30) VALUE              03160000
031700                        'CREATING TRECDIS EXTRACT FILE.'.         03170000
031800         10  FILLER                  PIC X(01) VALUE SPACE.       03180000
031900         10  FILLER                  PIC X(01) VALUE ALL '*'.     03190000
032000     05  DM-81-120.                                               03200000
032100         10  FILLER                  PIC X(40) VALUE ALL '*'.     03210000
032200                                                                  03220000
032300 01  DP-DISPLAY-PROGRESS-MSG.                                     03230000
032400     05  DP-PROGRAM                  PIC X(08) VALUE SPACE.       03240000
032500     05  FILLER                      PIC X(02) VALUE SPACE.       03250000
032600     05  DP-STATUS-DESCRIPTION       PIC X(10) VALUE SPACE.       03260000
032700     05  FILLER                      PIC X(04) VALUE ' AT '.      03270000
032800     05  DP-TIMESTAMP-19             PIC X(19) VALUE SPACE.       03280000
032900     05  FILLER                      PIC X(03) VALUE '.  '.       03290000
033000     05  FILLER                      PIC X(03) VALUE              03300000
033100                                         'IN:'.                   03310000
033200     05  DP-IN-CNT                   PIC ZZZ,ZZZ,ZZ9              03320000
033300                                               VALUE ZERO.        03330000
033400     05  FILLER                      PIC X(02) VALUE ', '.        03340000
033500     05  FILLER                      PIC X(14) VALUE              03350000
033600                                         'ROWS SELECTED:'.        03360000
033700     05  DP-ROWS-SELECTED-CNT        PIC ZZZ,ZZZ,ZZ9              03370000
033800                                               VALUE ZERO.        03380000
033900     05  FILLER                      PIC X(02) VALUE ', '.        03390000
034000     05  FILLER                      PIC X(04) VALUE              03400000
034100                                         'OUT:'.                  03410000
034200     05  DP-OUT-CNT                  PIC ZZZ,ZZZ,ZZ9              03420000
034300                                               VALUE ZERO.        03430000
034400     05  FILLER                      PIC X(01) VALUE '.'.         03440000
034500                                                                  03450000
034600 01  ABEND-CODE                      PIC S9(04)                   03460000
034700                                               VALUE ZEROES       03470000
034800                                               COMP SYNC.         03480000
034900                                                                  03490000
035000*---------------------------------------------------------------* 03500000
035100*  DB2 FORMATTED MESSAGE AREA                                     03510000
035200*---------------------------------------------------------------* 03520000
035300     COPY DPWS004.                                                03530000
035400                                                                  03540000
035500                                                                  03550000
035600*---------------------------------------------------------------* 03560001
035700*  INPUT FILE LAYOUT                                              03570001
035800*---------------------------------------------------------------* 03580001
035900     COPY PCRD010.                                                03590001
036000                                                                  03600001
036100                                                                  03610001
036200*---------------------------------------------------------------* 03620000
036300*    DB2 AREA FOR XLT_SKU                                       * 03630011
036400*---------------------------------------------------------------* 03640000
036500     EXEC SQL                                                     03650000
036600          INCLUDE XLT00003                                        03660011
036700     END-EXEC.                                                    03670000
036800                                                                  03680011
036900*---------------------------------------------------------------* 03690011
037000*    DB2 AREA FOR PCT_TRN_CLSN_BAL                              * 03700011
037100*---------------------------------------------------------------* 03710011
037200     EXEC SQL                                                     03720011
037300          INCLUDE PCT00014                                        03730011
037400     END-EXEC.                                                    03740011
037500                                                                  03750000
037600*---------------------------------------------------------------* 03760001
037700*    DB2 AREA FOR PCT_TRN_CLSN_DTL                              * 03770001
037800*---------------------------------------------------------------* 03780001
037900     EXEC SQL                                                     03790001
038000          INCLUDE PCT00015                                        03800001
038100     END-EXEC.                                                    03810001
038200                                                                  03820001
038300*---------------------------------------------------------------* 03830000
038400*    DB2 AREA FOR TSUOBTR                                       * 03840001
038500*---------------------------------------------------------------* 03850000
038600     EXEC SQL                                                     03860000
038700          INCLUDE TSUOBTR                                         03870001
038800     END-EXEC.                                                    03880000
038900                                                                  03890000
039000*---------------------------------------------------------------* 03900000
039100*    DB2 AREA FOR COMMUNICATIONS                                * 03910000
039200*---------------------------------------------------------------* 03920000
039300     EXEC SQL                                                     03930000
039400          INCLUDE SQLCA                                           03940000
039500     END-EXEC.                                                    03950000
039600                                                                  03960000
039700*---------------------------------------------------------------* 03970000
039800*  PCT_TRN_CLS_BAL CURSOR                                         03980001
039900*---------------------------------------------------------------* 03990000
040000     EXEC SQL                                                     04000000
040100          DECLARE BAL-CSR CURSOR FOR                              04010001
040200          SELECT  INTR_UPC_ID                                     04020001
040300               ,LOC_NBR                                           04030001
040400               ,TRN_CLSN_CDE                                      04040001
040500               ,TRN_CLSN_QTY                                      04050001
040600               ,LAST_UPD_DTE                                      04060001
040700            FROM PCT_TRN_CLSN_BAL A                               04070001
040800           WHERE A.INTR_UPC_ID    = :DK-INTR-UPC-ID               04080001
040900             AND A.LOC_NBR        = :DK-LOC-NBR                   04090001
041000     END-EXEC.                                                    04100000
041100                                                                  04110000
041200*---------------------------------------------------------------* 04120001
041300*  PCT_TRN_CLS_DTL CURSOR                                         04130001
041400*---------------------------------------------------------------* 04140001
041500     EXEC SQL                                                     04150001
041600          DECLARE DTL-CSR CURSOR FOR                              04160001
041700          SELECT  INTR_UPC_ID                                     04170001
041800               ,LOC_NBR                                           04180001
041900               ,TRN_CLSN_CDE                                      04190001
042000               ,IN_TRNST_TRN_TMST                                 04200001
042100               ,TRN_TYP_CDE                                       04210001
042200               ,TRN_CLSN_PRCG_QTY                                 04220001
042300               ,TRN_CLSN_BAL_QTY                                  04230001
042400               ,UPD_USR_ID                                        04240001
042500               ,OTBND_TRIP_ID                                     04250001
042600               ,PO_NBR                                            04260001
042700               ,RCVR_SEQ_NBR                                      04270001
042800            FROM PCT_TRN_CLSN_DTL A                               04280001
042900           WHERE A.INTR_UPC_ID    = :DK-INTR-UPC-ID               04290001
043000             AND A.LOC_NBR        = :DK-LOC-NBR                   04300001
043100          ORDER BY IN_TRNST_TRN_TMST                              04310002
043200     END-EXEC.                                                    04320001
043300                                                                  04330001
043400 PROCEDURE DIVISION.                                              04340000
043500                                                                  04350000
043600 0000-PROGRAM-MAINLINE.                                           04360000
043700                                                                  04370000
043800     PERFORM 1000-INITIALIZE.                                     04380000
043900                                                                  04390000
044000     PERFORM 2000-PROCESS-INPUT-FILE                              04400000
044100         UNTIL PS-INPUT-EOF.                                      04410000
044200                                                                  04420000
044300     IF  PV-INPUT-READ > 0                                        04430001
044400         PERFORM 5000-WRITE-OUTPUT                                04440001
044500     END-IF.                                                      04450001
044600                                                                  04460001
044700     CLOSE INPUT-FILE.                                            04470000
044800     CLOSE OUTPUT-BAL-FILE.                                       04480001
044900     CLOSE OUTPUT-DTL-FILE.                                       04490001
045000     CLOSE OUTPUT-OBTR-FILE.                                      04500001
045100     CLOSE OUTPUT-SKU-FILE.                                       04510011
045200                                                                  04520000
045300     MOVE PV-INPUT-READ TO PV-DISPLAY-FIELD.                      04530000
045400     DISPLAY 'INPUT RECORDS READ          :  ' PV-DISPLAY-FIELD.  04540010
045500                                                                  04550010
045600     MOVE PV-INPUT-MATCHED TO PV-DISPLAY-FIELD.                   04560010
045700     DISPLAY 'INPUT MATCHED TO _DTL TABLE :  ' PV-DISPLAY-FIELD.  04570010
045701*  THIS DISPLAY MEANS THAT WE DID NOT MATCH ON THE ENTIRE         04570113
045702*  TIMESTAMP BUT DID MATCH DOWN THRU THE SECONDS PORTION OF       04570213
045703*  TIMESTAMP - PROBABLY BECAUSE WHEN THE DATA WAS INITIALLY       04570313
045704*  INSERTED INTO PCT_TRN_CLSN_DTL IT GOT A -803 AND WE HAD TO     04570413
045705*  ADD 1 TO THE NANO SECOND PART OF THE TIMESTAMP TO MAKE THE     04570513
045706*  KEY UNIQUE.                                                    04570613
045710     MOVE PV-INPUT-MATCHED-SECONDS TO PV-DISPLAY-FIELD.           04571013
045720     DISPLAY 'INPUT MATCHED BY SECONDS    :  ' PV-DISPLAY-FIELD.  04572013
045800     MOVE PV-MATCHED-DTL-NOT-WRITTEN TO PV-DISPLAY-FIELD.         04580010
045900     DISPLAY 'MATCHED _DTL NOT WRITTEN    :  ' PV-DISPLAY-FIELD.  04590010
046000                                                                  04600000
046100     MOVE PV-OUTPUT-BAL-WRITTEN TO PV-DISPLAY-FIELD.              04610001
046200     DISPLAY 'OUTPUT BAL RECORDS WRITTEN  :  ' PV-DISPLAY-FIELD.  04620001
046300     MOVE PV-OUTPUT-DTL-WRITTEN TO PV-DISPLAY-FIELD.              04630001
046400     DISPLAY 'OUTPUT DTL RECORDS WRITTEN  :  ' PV-DISPLAY-FIELD.  04640001
046500     MOVE PV-OUTPUT-OBTR-WRITTEN TO PV-DISPLAY-FIELD.             04650001
046600     DISPLAY 'OUTPUT OBTR RECORDS WRITTEN :  ' PV-DISPLAY-FIELD.  04660001
046700     MOVE PV-OUTPUT-SKU-WRITTEN TO PV-DISPLAY-FIELD.              04670011
046800     DISPLAY 'OUTPUT SKU RECORDS WRITTEN  :  ' PV-DISPLAY-FIELD.  04680011
046900                                                                  04690011
047000     STOP RUN.                                                    04700000
047100                                                                  04710000
047200                                                                  04720000
047300* ************************************************************** *04730000
047400* * INITIALIZATIONS                                            * *04740000
047500* ************************************************************** *04750000
047600 1000-INITIALIZE.                                                 04760000
047700                                                                  04770000
047800     OPEN  INPUT  INPUT-FILE.                                     04780000
047900     OPEN  OUTPUT OUTPUT-BAL-FILE.                                04790001
048000     OPEN  OUTPUT OUTPUT-DTL-FILE.                                04800001
048100     OPEN  OUTPUT OUTPUT-OBTR-FILE.                               04810001
048200     OPEN  OUTPUT OUTPUT-SKU-FILE.                                04820011
048300                                                                  04830000
048400     MOVE ZERO TO PV-PREV-INTR-UPC-ID.                            04840001
048500     MOVE ZERO TO PV-PREV-LOC-NBR.                                04850001
048600     PERFORM 9050-READ-INPUT-FILE.                                04860000
048700                                                                  04870000
048800 2000-PROCESS-INPUT-FILE.                                         04880000
048900                                                                  04890000
049000     IF  PV-PREV-INTR-UPC-ID = ZERO                               04900001
049100     AND PV-PREV-LOC-NBR = ZERO                                   04910001
049200         MOVE PC010-INTR-UPC-ID TO PV-PREV-INTR-UPC-ID            04920001
049300         MOVE PC010-STR-NBR     TO PV-PREV-LOC-NBR                04930001
049400         PERFORM 3000-GET-DATA                                    04940001
049500         PERFORM 4000-CLEAR-OUT-INPUT                             04950001
049600     ELSE                                                         04960001
049700         IF  PC010-INTR-UPC-ID = PV-PREV-INTR-UPC-ID              04970001
049800         AND PC010-STR-NBR     = PV-PREV-LOC-NBR                  04980001
049900             PERFORM 4000-CLEAR-OUT-INPUT                         04990001
050000         ELSE                                                     05000001
050100             PERFORM 5000-WRITE-OUTPUT                            05010001
050200             MOVE PC010-INTR-UPC-ID TO PV-PREV-INTR-UPC-ID        05020001
050300             MOVE PC010-STR-NBR     TO PV-PREV-LOC-NBR            05030001
050400             PERFORM 3000-GET-DATA                                05040001
050500             PERFORM 4000-CLEAR-OUT-INPUT                         05050001
050600         END-IF                                                   05060001
050700     END-IF.                                                      05070001
050800                                                                  05080000
050900     PERFORM 9050-READ-INPUT-FILE.                                05090000
051000                                                                  05100000
051100 3000-GET-DATA.                                                   05110001
051200                                                                  05120001
051300     PERFORM 3050-INITIALIZE-FIELDS.                              05130001
051400                                                                  05140002
051500     MOVE PC010-INTR-UPC-ID  TO DK-INTR-UPC-ID.                   05150002
051600     MOVE PC010-STR-NBR TO DK-LOC-NBR.                            05160002
051700                                                                  05170002
051800     PERFORM 3100-OPEN-BAL-CSR.                                   05180002
051900                                                                  05190002
052000     MOVE 'N' TO PS-END-OF-BAL-CSR-SW.                            05200002
052100     PERFORM 3200-PROCESS-CSR                                     05210002
052200       UNTIL  PS-END-OF-BAL-CSR.                                  05220002
052300                                                                  05230002
052400     PERFORM 3400-CLOSE-BAL-CSR.                                  05240002
052500                                                                  05250002
052600     PERFORM 3600-OPEN-DTL-CSR.                                   05260002
052700                                                                  05270002
052800     MOVE 'N' TO PS-END-OF-DTL-CSR-SW.                            05280002
052900     SET DTL-INX TO 1.                                            05290002
053000     PERFORM 3700-PROCESS-CSR                                     05300002
053100       UNTIL  PS-END-OF-DTL-CSR.                                  05310002
053200                                                                  05320002
053300     PERFORM 3900-CLOSE-DTL-CSR.                                  05330002
053400                                                                  05340001
053500 3050-INITIALIZE-FIELDS.                                          05350001
053600                                                                  05360001
053700     MOVE ZEROS TO OR-BAL-INTR-UPC-ID                             05370001
053800                   OR-BAL-LOC-NBR                                 05380001
053900                   OR-BAL-TRN-CLSN-QTY                            05390001
054000                   PV-BAL-SE-INTR-UPC-ID                          05400001
054100                   PV-BAL-SE-LOC-NBR                              05410001
054200                   PV-BAL-SE-TRN-CLSN-QTY                         05420001
054300                   PV-BAL-IT-INTR-UPC-ID                          05430001
054400                   PV-BAL-IT-LOC-NBR                              05440001
054500                   PV-BAL-IT-TRN-CLSN-QTY                         05450001
054600                   OR-DTL-INTR-UPC-ID                             05460001
054700                   OR-DTL-LOC-NBR                                 05470001
054800                   OR-DTL-TRN-CLSN-PRCG-QTY                       05480001
054900                   OR-DTL-TRN-CLSN-BAL-QTY                        05490001
055000                   OR-DTL-OTBND-TRIP-ID                           05500001
055100                   OR-DTL-PO-NBR                                  05510001
055200                   OR-DTL-RCVR-SEQ-NBR.                           05520001
055300                                                                  05530001
055400     MOVE SPACES TO OR-BAL-TRN-CLSN-CDE                           05540001
055500                    OR-BAL-LAST-UPD-DTE                           05550001
055600                    PV-BAL-SE-TRN-CLSN-CDE                        05560001
055700                    PV-BAL-SE-LAST-UPD-DTE                        05570001
055800                    PV-BAL-IT-TRN-CLSN-CDE                        05580001
055900                    PV-BAL-IT-LAST-UPD-DTE                        05590001
056000                    OR-DTL-TRN-CLSN-CDE                           05600001
056100                    OR-DTL-TRN-TYP-CDE                            05610001
056200                    OR-DTL-IN-TRNST-TRN-TMST                      05620001
056300                    OR-DTL-UPD-USR-ID.                            05630001
056400                                                                  05640001
056500     PERFORM 3055-INITIALIZE-TABLE                                05650004
056600        VARYING DTL-INX FROM 1 BY 1                               05660002
056700          UNTIL DTL-INX > 1000.                                   05670015
056800                                                                  05680001
056900 3055-INITIALIZE-TABLE.                                           05690001
057000                                                                  05700001
057100      MOVE ZEROS  TO TBL-DTL-TRN-CLSN-PRCG-QTY (DTL-INX)          05710002
057200                     TBL-DTL-TRN-CLSN-BAL-QTY (DTL-INX)           05720002
057300                     TBL-DTL-OTBND-TRIP-ID (DTL-INX)              05730002
057400                     TBL-DTL-PO-NBR (DTL-INX)                     05740002
057500                     TBL-DTL-RCVR-SEQ-NBR (DTL-INX).              05750002
057600                                                                  05760002
057700      MOVE SPACES TO TBL-DTL-TRN-CLSN-CDE (DTL-INX)               05770002
057800                     TBL-DTL-IN-TRNST-TRN-TMST (DTL-INX)          05780002
057900                     TBL-DTL-TRN-TYP-CDE (DTL-INX)                05790002
058000                     TBL-DTL-UPD-USR-ID (DTL-INX)                 05800002
058100                     TBL-DTL-KEEP-SW (DTL-INX).                   05810002
058200                                                                  05820001
058300 3100-OPEN-BAL-CSR.                                               05830002
058400                                                                  05840002
058500     EXEC SQL                                                     05850002
058600         OPEN BAL-CSR                                             05860002
058700     END-EXEC.                                                    05870002
058800                                                                  05880002
058900     EVALUATE TRUE                                                05890002
059000         WHEN SQLCODE = ZERO                                      05900002
059100             CONTINUE                                             05910002
059200         WHEN SQLWARN0 NOT = SPACE                                05920002
059300         WHEN SQLCODE < ZERO                                      05930002
059400         WHEN SQLCODE > ZERO                                      05940002
059500          MOVE DK-INTR-UPC-ID TO PV-DISP-INTR-UPC-ID              05950002
059600          MOVE DK-LOC-NBR     TO PV-DISP-LOC-NBR                  05960002
059700          DISPLAY 'INTR UPC ID: ' PV-DISP-INTR-UPC-ID             05970002
059800          DISPLAY 'LOC NBR    : ' PV-DISP-LOC-NBR                 05980002
059900          MOVE '3100-OPEN-BAL-CSR'                                05990002
060000                             TO PV-PARAGRAPH-NAME                 06000002
060100          MOVE 'OPEN BAL-CSR'                                     06010002
060200                             TO PV-DB2-OPERATION-MSG-1            06020002
060300          MOVE 'PCT_TRN_CLSN_BAL'                                 06030002
060400                             TO PV-DB2-TABLE-NAME                 06040002
060500          PERFORM 9999-DB2-ABEND                                  06050002
060600     END-EVALUATE.                                                06060002
060700                                                                  06070002
060800 3200-PROCESS-CSR.                                                06080002
060900                                                                  06090002
061000     PERFORM 3300-FETCH-BAL-CSR.                                  06100002
061100                                                                  06110002
061200     IF  PS-END-OF-BAL-CSR                                        06120002
061300         CONTINUE                                                 06130002
061400     ELSE                                                         06140002
061500         IF  PCT00014-TRN-CLSN-CDE = 'SE'                         06150002
061600             MOVE PCT00014-INTR-UPC-ID  TO                        06160002
061700                  PV-BAL-SE-INTR-UPC-ID                           06170002
061800             MOVE PCT00014-LOC-NBR      TO                        06180002
061900                  PV-BAL-SE-LOC-NBR                               06190002
062000             MOVE PCT00014-TRN-CLSN-CDE TO                        06200002
062100                  PV-BAL-SE-TRN-CLSN-CDE                          06210002
062200             MOVE PCT00014-TRN-CLSN-QTY TO                        06220002
062300                  PV-BAL-SE-TRN-CLSN-QTY                          06230002
062400             MOVE PCT00014-LAST-UPD-DTE TO                        06240002
062500                  PV-BAL-SE-LAST-UPD-DTE                          06250002
062600         ELSE                                                     06260002
062700             MOVE PCT00014-INTR-UPC-ID  TO                        06270002
062800                  PV-BAL-IT-INTR-UPC-ID                           06280002
062900             MOVE PCT00014-LOC-NBR      TO                        06290002
063000                  PV-BAL-IT-LOC-NBR                               06300002
063100             MOVE PCT00014-TRN-CLSN-CDE TO                        06310002
063200                  PV-BAL-IT-TRN-CLSN-CDE                          06320002
063300             MOVE PCT00014-TRN-CLSN-QTY TO                        06330002
063400                  PV-BAL-IT-TRN-CLSN-QTY                          06340002
063500             MOVE PCT00014-LAST-UPD-DTE TO                        06350002
063600                  PV-BAL-IT-LAST-UPD-DTE                          06360002
063700         END-IF                                                   06370002
063800     END-IF.                                                      06380002
063900                                                                  06390002
064000 3300-FETCH-BAL-CSR.                                              06400002
064100                                                                  06410002
064200     EXEC SQL                                                     06420002
064300         FETCH  BAL-CSR                                           06430002
064400          INTO  :PCT00014-INTR-UPC-ID                             06440002
064500             ,  :PCT00014-LOC-NBR                                 06450002
064600             ,  :PCT00014-TRN-CLSN-CDE                            06460002
064700             ,  :PCT00014-TRN-CLSN-QTY                            06470002
064800             ,  :PCT00014-LAST-UPD-DTE                            06480002
064900     END-EXEC.                                                    06490002
065000                                                                  06500002
065100     EVALUATE TRUE                                                06510002
065200         WHEN SQLCODE = ZERO                                      06520002
065300             CONTINUE                                             06530002
065400         WHEN SQLCODE = +100                                      06540002
065500             SET PS-END-OF-BAL-CSR    TO  TRUE                    06550004
065600         WHEN SQLWARN0 NOT = SPACE                                06560002
065700         WHEN SQLCODE < ZERO                                      06570002
065800         WHEN SQLCODE > ZERO                                      06580002
065900          MOVE DK-INTR-UPC-ID TO PV-DISP-INTR-UPC-ID              06590002
066000          MOVE DK-LOC-NBR     TO PV-DISP-LOC-NBR                  06600002
066100          DISPLAY 'INTR UPC ID: ' PV-DISP-INTR-UPC-ID             06610002
066200          DISPLAY 'LOC NBR    : ' PV-DISP-LOC-NBR                 06620002
066300          MOVE '3300-FETCH-BAL-CSR'                               06630002
066400                             TO PV-PARAGRAPH-NAME                 06640002
066500          MOVE 'FETCH BAL-CSR'                                    06650002
066600                             TO PV-DB2-OPERATION-MSG-1            06660002
066700          MOVE 'PCT_TRN_CLSN_BAL'                                 06670002
066800                             TO PV-DB2-TABLE-NAME                 06680002
066900          PERFORM 9999-DB2-ABEND                                  06690002
067000     END-EVALUATE.                                                06700002
067100                                                                  06710002
067200 3400-CLOSE-BAL-CSR.                                              06720002
067300                                                                  06730002
067400     EXEC SQL                                                     06740002
067500         CLOSE BAL-CSR                                            06750002
067600     END-EXEC.                                                    06760002
067700                                                                  06770002
067800     EVALUATE TRUE                                                06780002
067900         WHEN SQLCODE = ZERO                                      06790002
068000             CONTINUE                                             06800002
068100         WHEN SQLWARN0 NOT = SPACE                                06810002
068200         WHEN SQLCODE < ZERO                                      06820002
068300         WHEN SQLCODE > ZERO                                      06830002
068400          MOVE DK-INTR-UPC-ID TO PV-DISP-INTR-UPC-ID              06840002
068500          MOVE DK-LOC-NBR     TO PV-DISP-LOC-NBR                  06850002
068600          DISPLAY 'INTR UPC ID: ' PV-DISP-INTR-UPC-ID             06860002
068700          DISPLAY 'LOC NBR    : ' PV-DISP-LOC-NBR                 06870002
068800          MOVE '3400-CLOSE-BAL-CSR'                               06880002
068900                             TO PV-PARAGRAPH-NAME                 06890002
069000          MOVE 'CLOSE BAL-CSR'                                    06900002
069100                             TO PV-DB2-OPERATION-MSG-1            06910002
069200          MOVE 'PCT_TRN_CLSN_BAL'                                 06920002
069300                             TO PV-DB2-TABLE-NAME                 06930002
069400          PERFORM 9999-DB2-ABEND                                  06940002
069500     END-EVALUATE.                                                06950002
069600                                                                  06960002
069700 3600-OPEN-DTL-CSR.                                               06970002
069800                                                                  06980002
069900     EXEC SQL                                                     06990002
070000         OPEN DTL-CSR                                             07000002
070100     END-EXEC.                                                    07010002
070200                                                                  07020002
070300     EVALUATE TRUE                                                07030002
070400         WHEN SQLCODE = ZERO                                      07040002
070500             CONTINUE                                             07050002
070600         WHEN SQLWARN0 NOT = SPACE                                07060002
070700         WHEN SQLCODE < ZERO                                      07070002
070800         WHEN SQLCODE > ZERO                                      07080002
070900          MOVE DK-INTR-UPC-ID TO PV-DISP-INTR-UPC-ID              07090002
071000          MOVE DK-LOC-NBR     TO PV-DISP-LOC-NBR                  07100002
071100          DISPLAY 'INTR UPC ID: ' PV-DISP-INTR-UPC-ID             07110002
071200          DISPLAY 'LOC NBR    : ' PV-DISP-LOC-NBR                 07120002
071300          MOVE '3600-OPEN-DTL-CSR'                                07130002
071400                             TO PV-PARAGRAPH-NAME                 07140002
071500          MOVE 'OPEN DTL-CSR'                                     07150002
071600                             TO PV-DB2-OPERATION-MSG-1            07160002
071700          MOVE 'PCT_TRN_CLSN_DTL'                                 07170002
071800                             TO PV-DB2-TABLE-NAME                 07180002
071900          PERFORM 9999-DB2-ABEND                                  07190002
072000     END-EVALUATE.                                                07200002
072100                                                                  07210002
072200 3700-PROCESS-CSR.                                                07220002
072300                                                                  07230002
072400     PERFORM 3800-FETCH-DTL-CSR.                                  07240002
072500                                                                  07250002
072600     IF  DTL-INX > 1000                                           07260015
072700         MOVE DK-INTR-UPC-ID TO PV-DISP-INTR-UPC-ID               07270002
072800         MOVE DK-LOC-NBR     TO PV-DISP-LOC-NBR                   07280002
072900         DISPLAY 'INTR UPC ID: ' PV-DISP-INTR-UPC-ID              07290002
073000         DISPLAY 'LOC NBR    : ' PV-DISP-LOC-NBR                  07300002
073100         MOVE '3700-PROCESS-CSR '                                 07310002
073200                            TO PV-PARAGRAPH-NAME                  07320002
073300         MOVE 'MORE THAN 1000 ENTRIES'                            07330015
073400                            TO PV-DB2-OPERATION-MSG-1             07340002
073500         MOVE 'PCT_TRN_CLSN_DTL'                                  07350002
073600                            TO PV-DB2-TABLE-NAME                  07360002
073700         PERFORM 9999-DB2-ABEND                                   07370002
073800     END-IF.                                                      07380002
073900                                                                  07390002
074000                                                                  07400002
074100     IF  PS-END-OF-DTL-CSR                                        07410002
074200         CONTINUE                                                 07420002
074300     ELSE                                                         07430002
074400         MOVE PCT00015-TRN-CLSN-CDE TO                            07440004
074500              TBL-DTL-TRN-CLSN-CDE (DTL-INX)                      07450002
074600         MOVE PCT00015-IN-TRNST-TRN-TMST TO                       07460004
074700              TBL-DTL-IN-TRNST-TRN-TMST (DTL-INX)                 07470002
074800         MOVE PCT00015-TRN-TYP-CDE TO                             07480004
074900              TBL-DTL-TRN-TYP-CDE (DTL-INX)                       07490002
075000         MOVE PCT00015-TRN-CLSN-PRCG-QTY TO                       07500004
075100              TBL-DTL-TRN-CLSN-PRCG-QTY (DTL-INX)                 07510002
075200         MOVE PCT00015-TRN-CLSN-BAL-QTY TO                        07520004
075300              TBL-DTL-TRN-CLSN-BAL-QTY (DTL-INX)                  07530002
075400         MOVE PCT00015-UPD-USR-ID TO                              07540004
075500              TBL-DTL-UPD-USR-ID (DTL-INX)                        07550002
075600         MOVE PCT00015-OTBND-TRIP-ID TO                           07560004
075700              TBL-DTL-OTBND-TRIP-ID (DTL-INX)                     07570002
075800         MOVE PCT00015-PO-NBR TO                                  07580004
075900              TBL-DTL-PO-NBR (DTL-INX)                            07590002
076000         MOVE PCT00015-RCVR-SEQ-NBR TO                            07600004
076100              TBL-DTL-RCVR-SEQ-NBR (DTL-INX)                      07610002
076200         MOVE 'Y' TO TBL-DTL-KEEP-SW (DTL-INX)                    07620002
076300                                                                  07630002
076400     END-IF.                                                      07640002
076500                                                                  07650002
076600     SET DTL-INX UP BY 1.                                         07660002
076700                                                                  07670002
076800 3800-FETCH-DTL-CSR.                                              07680002
076900                                                                  07690002
077000     EXEC SQL                                                     07700002
077100         FETCH  DTL-CSR                                           07710002
077200          INTO  :PCT00015-INTR-UPC-ID                             07720002
077300             ,  :PCT00015-LOC-NBR                                 07730002
077400             ,  :PCT00015-TRN-CLSN-CDE                            07740002
077500             ,  :PCT00015-IN-TRNST-TRN-TMST                       07750002
077600             ,  :PCT00015-TRN-TYP-CDE                             07760002
077700             ,  :PCT00015-TRN-CLSN-PRCG-QTY                       07770002
077800             ,  :PCT00015-TRN-CLSN-BAL-QTY                        07780002
077900             ,  :PCT00015-UPD-USR-ID                              07790002
078000             ,  :PCT00015-OTBND-TRIP-ID   :PV-NULL-IND            07800005
078100             ,  :PCT00015-PO-NBR                                  07810002
078200             ,  :PCT00015-RCVR-SEQ-NBR                            07820002
078300     END-EXEC.                                                    07830002
078400                                                                  07840002
078500     EVALUATE TRUE                                                07850002
078600         WHEN SQLCODE = ZERO                                      07860002
078700              IF  PV-NULL-IND    =  -1                            07870005
078800                  MOVE ZEROES  TO  PCT00015-OTBND-TRIP-ID         07880005
078900              END-IF                                              07890005
079000         WHEN SQLCODE = +100                                      07900002
079100             SET PS-END-OF-DTL-CSR    TO  TRUE                    07910004
079200         WHEN SQLWARN0 NOT = SPACE                                07920002
079300         WHEN SQLCODE < ZERO                                      07930002
079400         WHEN SQLCODE > ZERO                                      07940002
079500          MOVE DK-INTR-UPC-ID TO PV-DISP-INTR-UPC-ID              07950002
079600          MOVE DK-LOC-NBR     TO PV-DISP-LOC-NBR                  07960002
079700          DISPLAY 'INTR UPC ID: ' PV-DISP-INTR-UPC-ID             07970002
079800          DISPLAY 'LOC NBR    : ' PV-DISP-LOC-NBR                 07980002
079900          MOVE '3800-FETCH-DTL-CSR'                               07990002
080000                             TO PV-PARAGRAPH-NAME                 08000002
080100          MOVE 'FETCH DTL-CSR'                                    08010002
080200                             TO PV-DB2-OPERATION-MSG-1            08020002
080300          MOVE 'PCT_TRN_CLSN_DTL'                                 08030002
080400                             TO PV-DB2-TABLE-NAME                 08040002
080500          PERFORM 9999-DB2-ABEND                                  08050002
080600     END-EVALUATE.                                                08060002
080700                                                                  08070002
080800 3900-CLOSE-DTL-CSR.                                              08080002
080900                                                                  08090002
081000     EXEC SQL                                                     08100002
081100         CLOSE DTL-CSR                                            08110002
081200     END-EXEC.                                                    08120002
081300                                                                  08130002
081400     EVALUATE TRUE                                                08140002
081500         WHEN SQLCODE = ZERO                                      08150002
081600             CONTINUE                                             08160002
081700         WHEN SQLWARN0 NOT = SPACE                                08170002
081800         WHEN SQLCODE < ZERO                                      08180002
081900         WHEN SQLCODE > ZERO                                      08190002
082000          MOVE DK-INTR-UPC-ID TO PV-DISP-INTR-UPC-ID              08200002
082100          MOVE DK-LOC-NBR     TO PV-DISP-LOC-NBR                  08210002
082200          DISPLAY 'INTR UPC ID: ' PV-DISP-INTR-UPC-ID             08220002
082300          DISPLAY 'LOC NBR    : ' PV-DISP-LOC-NBR                 08230002
082400          MOVE '3900-CLOSE-DTL-CSR'                               08240002
082500                             TO PV-PARAGRAPH-NAME                 08250002
082600          MOVE 'CLOSE DTL-CSR'                                    08260002
082700                             TO PV-DB2-OPERATION-MSG-1            08270002
082800          MOVE 'PCT_TRN_CLSN_DTL'                                 08280002
082900                             TO PV-DB2-TABLE-NAME                 08290002
083000          PERFORM 9999-DB2-ABEND                                  08300002
083100     END-EVALUATE.                                                08310002
083200                                                                  08320002
083300 4000-CLEAR-OUT-INPUT.                                            08330002
083400                                                                  08340002
083500     SET PS-INPUT-NOT-MATCH TO TRUE.                              08350002
083600     PERFORM 4100-MATCH-INPUT                                     08360002
083700       VARYING DTL-INX FROM 1 BY 1                                08370002
083800         UNTIL DTL-INX > 1000                                     08380015
083900            OR PS-INPUT-MATCH                                     08390002
084000            OR TBL-DTL-KEEP-SW (DTL-INX) = ' '.                   08400002
084100                                                                  08410002
084200 4100-MATCH-INPUT.                                                08420002
084300                                                                  08430002
084400     IF  PC010-TRN-CLSN-CDE =                                     08440002
084500         TBL-DTL-TRN-CLSN-CDE (DTL-INX)                           08450002
084600         IF  PC010-TRN-TYP-CDE =                                  08460002
084700             TBL-DTL-TRN-TYP-CDE (DTL-INX)                        08470002
084800             IF  PC010-PO-NBR =                                   08480002
084900                 TBL-DTL-PO-NBR (DTL-INX)                         08490002
085000                 IF  PC010-RCVR-SEQ-NBR =                         08500002
085100                     TBL-DTL-RCVR-SEQ-NBR (DTL-INX)               08510002
085200                     IF  PC010-UPD-USR-ID =                       08520002
085300                         TBL-DTL-UPD-USR-ID (DTL-INX)             08530002
085400                         IF  PC010-IN-TRNST-QTY =                 08540002
085500                             TBL-DTL-TRN-CLSN-PRCG-QTY (DTL-INX)  08550002
085600                             PERFORM 4200-DATE-CHECK              08560002
085700                         ELSE                                     08570002
085800                             NEXT SENTENCE                        08580002
085900                         END-IF                                   08590002
086000                     ELSE                                         08600002
086100                         NEXT SENTENCE                            08610002
086200                     END-IF                                       08620002
086300                 ELSE                                             08630002
086400                     NEXT SENTENCE                                08640002
086500                 END-IF                                           08650002
086600             ELSE                                                 08660002
086700                 NEXT SENTENCE                                    08670002
086800             END-IF                                               08680002
086900         ELSE                                                     08690002
087000             NEXT SENTENCE                                        08700002
087100         END-IF                                                   08710002
087200     ELSE                                                         08720002
087300         NEXT SENTENCE                                            08730002
087400     END-IF.                                                      08740002
087500                                                                  08750002
087600 4200-DATE-CHECK.                                                 08760002
087700                                                                  08770002
087800     IF  PC010-EVENT-TMST =                                       08780002
087900         TBL-DTL-IN-TRNST-TRN-TMST (DTL-INX)                      08790002
087910         ADD +1 TO PV-INPUT-MATCHED                               08791013
088000         PERFORM 4300-GOT-A-MATCH                                 08800002
088100     ELSE                                                         08810002
088200         MOVE TBL-DTL-IN-TRNST-TRN-TMST (DTL-INX) TO              08820002
088300              PV-EVENT-TMST                                       08830002
088400         IF  PC010-TMST-CC = PV-TMST-CC                           08840002
088500         AND PC010-TMST-YY = PV-TMST-YY                           08850002
088600         AND PC010-TMST-MM = PV-TMST-MM                           08860002
088700         AND PC010-TMST-DD = PV-TMST-DD                           08870002
088800         AND PC010-TMST-HH = PV-TMST-HH                           08880002
088900         AND PC010-TMST-MN = PV-TMST-MN                           08890002
089000         AND PC010-TMST-SS = PV-TMST-SS                           08900002
089010             ADD +1 TO PV-INPUT-MATCHED-SECONDS                   08901013
089100             PERFORM 4300-GOT-A-MATCH                             08910002
089200*            MOVE PC010-INTR-UPC-ID TO PV-DISP-INTR-UPC-ID        08920013
089300*            MOVE PC010-STR-NBR     TO PV-DISP-LOC-NBR            08930013
089400*            DISPLAY 'NON TIMESTAMP MATCH - SKU: '                08940013
089500*                    PV-DISP-INTR-UPC-ID                          08950013
089600*                    ' - '                                        08960013
089700*                    PV-DISP-LOC-NBR                              08970013
089800*            DISPLAY 'CLSN CDE: ' PC010-TRN-CLSN-CDE              08980013
089900*                    ' AND TRN TYP: ' PC010-TRN-TYP-CDE           08990013
090000         END-IF                                                   09000002
090100     END-IF.                                                      09010002
090200                                                                  09020002
090300 4300-GOT-A-MATCH.                                                09030002
090400                                                                  09040002
090600     SET PS-INPUT-MATCH TO TRUE.                                  09060002
090700     MOVE 'N' TO TBL-DTL-KEEP-SW (DTL-INX).                       09070008
090800     MULTIPLY PC010-IN-TRNST-QTY BY -1 GIVING                     09080009
090900              PC010-IN-TRNST-QTY.                                 09090009
091000     IF  PC010-TRN-IN-TRANSIT                                     09100002
091100         ADD PC010-IN-TRNST-QTY TO                                09110008
091200             PV-BAL-IT-TRN-CLSN-QTY                               09120008
091300     ELSE                                                         09130002
091400         ADD PC010-IN-TRNST-QTY TO                                09140008
091500             PV-BAL-SE-TRN-CLSN-QTY                               09150008
091600     END-IF.                                                      09160002
091700                                                                  09170002
091800 5000-WRITE-OUTPUT.                                               09180002
091900                                                                  09190002
092000     IF  PV-BAL-SE-INTR-UPC-ID > 0                                09200002
092100         MOVE PV-BAL-SE-OUTPUT-RECORD TO                          09210002
092200              OR-BAL-OUTPUT-RECORD                                09220002
092300         PERFORM 6000-WRITE-BAL-RECORD                            09230002
092400     END-IF.                                                      09240002
092500                                                                  09250002
092600     IF  PV-BAL-IT-INTR-UPC-ID > 0                                09260002
092700         MOVE PV-BAL-IT-OUTPUT-RECORD TO                          09270002
092800              OR-BAL-OUTPUT-RECORD                                09280002
092900         PERFORM 6000-WRITE-BAL-RECORD                            09290002
093000     END-IF.                                                      09300002
093100                                                                  09310002
093200     PERFORM 5100-SPIN-THRU-TABLE                                 09320002
093300        VARYING DTL-INX FROM 1 BY 1                               09330002
093400          UNTIL TBL-DTL-KEEP-SW (DTL-INX) = ' '                   09340004
093500             OR DTL-INX > 1000.                                   09350015
093600                                                                  09360011
093700     IF  PV-SKU-INTR-UPC-ID = PV-PREV-INTR-UPC-ID                 09370011
093800         CONTINUE                                                 09380011
093900     ELSE                                                         09390011
094000         PERFORM 7000-FORMAT-WRITE-SKU                            09400011
094100         MOVE PV-PREV-INTR-UPC-ID TO                              09410011
094200              PV-SKU-INTR-UPC-ID                                  09420011
094300     END-IF.                                                      09430011
094400                                                                  09440002
094500 5100-SPIN-THRU-TABLE.                                            09450002
094600                                                                  09460002
094700     IF  TBL-DTL-KEEP-SW (DTL-INX) = 'Y'                          09470008
094800         MOVE PV-PREV-INTR-UPC-ID TO OR-DTL-INTR-UPC-ID           09480002
094900         MOVE PV-PREV-LOC-NBR     TO OR-DTL-LOC-NBR               09490002
095000         MOVE TBL-DTL-TRN-CLSN-CDE (DTL-INX)      TO              09500002
095100              OR-DTL-TRN-CLSN-CDE                                 09510002
095200         MOVE TBL-DTL-IN-TRNST-TRN-TMST (DTL-INX) TO              09520002
095300              OR-DTL-IN-TRNST-TRN-TMST                            09530002
095400         MOVE TBL-DTL-TRN-TYP-CDE (DTL-INX)       TO              09540002
095500              OR-DTL-TRN-TYP-CDE                                  09550002
095600         MOVE TBL-DTL-TRN-CLSN-PRCG-QTY (DTL-INX) TO              09560002
095700              OR-DTL-TRN-CLSN-PRCG-QTY                            09570002
095800         MOVE TBL-DTL-TRN-CLSN-BAL-QTY (DTL-INX)  TO              09580002
095900              OR-DTL-TRN-CLSN-BAL-QTY                             09590002
096000         MOVE TBL-DTL-UPD-USR-ID (DTL-INX)        TO              09600002
096100              OR-DTL-UPD-USR-ID                                   09610002
096200         MOVE TBL-DTL-OTBND-TRIP-ID (DTL-INX)     TO              09620002
096300              OR-DTL-OTBND-TRIP-ID                                09630002
096400         MOVE TBL-DTL-PO-NBR (DTL-INX)            TO              09640002
096500              OR-DTL-PO-NBR                                       09650002
096600         MOVE TBL-DTL-RCVR-SEQ-NBR (DTL-INX)      TO              09660002
096700              OR-DTL-RCVR-SEQ-NBR                                 09670002
096800         PERFORM 6100-WRITE-DTL-RECORD                            09680002
096900     ELSE                                                         09690010
097000         ADD +1 TO PV-MATCHED-DTL-NOT-WRITTEN                     09700010
097100     END-IF.                                                      09710002
097200                                                                  09720006
097300     IF  TBL-DTL-OTBND-TRIP-ID (DTL-INX) > 0                      09730006
097400         IF  TBL-DTL-OTBND-TRIP-ID (DTL-INX) =                    09740006
097500             PV-PREV-OTBND-TRIP-ID                                09750006
097600             NEXT SENTENCE                                        09760006
097700         ELSE                                                     09770006
097800             PERFORM 6200-FORMAT-WRITE-OBTR                       09780006
097900             MOVE TBL-DTL-OTBND-TRIP-ID (DTL-INX) TO              09790006
098000                  PV-PREV-OTBND-TRIP-ID                           09800006
098100         END-IF                                                   09810006
098200     END-IF.                                                      09820006
098300                                                                  09830000
098400 6000-WRITE-BAL-RECORD.                                           09840002
098500                                                                  09850000
098600     WRITE OUTPUT-BAL-RECORD FROM OR-BAL-OUTPUT-RECORD.           09860002
098700     ADD +1 TO PV-OUTPUT-BAL-WRITTEN.                             09870002
098800                                                                  09880000
098900 6100-WRITE-DTL-RECORD.                                           09890002
099000                                                                  09900002
099100     WRITE OUTPUT-DTL-RECORD FROM OR-DTL-OUTPUT-RECORD.           09910002
099200     ADD +1 TO PV-OUTPUT-DTL-WRITTEN.                             09920002
099300                                                                  09930002
099400 6200-FORMAT-WRITE-OBTR.                                          09940006
099500                                                                  09950006
099600     MOVE TBL-DTL-OTBND-TRIP-ID (DTL-INX) TO                      09960006
099700          DK-OTBND-TRIP-ID.                                       09970006
099800                                                                  09980006
099900     EXEC SQL                                                     09990006
100000         SELECT OTBND_TRIP_ID                                     10000006
100100              , ORGN_OPER_UNT_ID                                  10010006
100200              , DEST_OPER_UNT_ID                                  10020006
100300              , TRLR_SRL_NBR                                      10030006
100400              , BOL_ID                                            10040006
100500              , EST_ARRVL_TMST                                    10050006
100600              , TRIP_ACTV_CDE                                     10060006
100700              , DOOR_TYP_CDE                                      10070006
100800           INTO :OR-OBTR-OTBND-TRIP-ID                            10080006
100900              , :OR-OBTR-ORGN-OPER-UNT-ID                         10090006
101000              , :OR-OBTR-DEST-OPER-UNT-ID                         10100006
101100              , :OR-OBTR-TRLR-SRL-NBR                             10110006
101200              , :OR-OBTR-BOL-ID                                   10120006
101300              , :OR-OBTR-EST-ARRVL-TMST                           10130006
101400              , :OR-OBTR-TRIP-ACTV-CDE                            10140006
101500              , :OR-OBTR-DOOR-TYP-CDE                             10150006
101600           FROM  TSUOBTR                                          10160006
101700          WHERE OTBND_TRIP_ID =  :DK-OTBND-TRIP-ID                10170006
101800     END-EXEC.                                                    10180006
101900                                                                  10190006
102000     EVALUATE TRUE                                                10200006
102100         WHEN SQLCODE = ZERO                                      10210006
102200             PERFORM 6300-WRITE-OBTR-RECORD                       10220006
102300         WHEN SQLWARN0 NOT = SPACE                                10230006
102400         WHEN SQLCODE < ZERO                                      10240006
102500         WHEN SQLCODE > ZERO                                      10250006
102600          MOVE DK-INTR-UPC-ID TO PV-DISP-INTR-UPC-ID              10260006
102700          MOVE DK-LOC-NBR     TO PV-DISP-LOC-NBR                  10270006
102800          DISPLAY 'INTR UPC ID: ' PV-DISP-INTR-UPC-ID             10280006
102900          DISPLAY 'LOC NBR    : ' PV-DISP-LOC-NBR                 10290006
103000          MOVE DK-OTBND-TRIP-ID TO PV-DISP-OTBND-TRIP-ID          10300006
103100          DISPLAY 'TRIP ID: ' PV-DISP-OTBND-TRIP-ID               10310006
103200          MOVE '6200-FORMAT-WRITE-OBTR'                           10320006
103300                             TO PV-PARAGRAPH-NAME                 10330006
103400          MOVE 'SELECT TSUOBTR'                                   10340006
103500                             TO PV-DB2-OPERATION-MSG-1            10350006
103600          MOVE 'TSUOBTR'                                          10360006
103700                             TO PV-DB2-TABLE-NAME                 10370006
103800          PERFORM 9999-DB2-ABEND                                  10380006
103900     END-EVALUATE.                                                10390006
104000                                                                  10400006
104100 6300-WRITE-OBTR-RECORD.                                          10410006
104200                                                                  10420006
104300     WRITE OUTPUT-OBTR-RECORD FROM OR-OBTR-OUTPUT-RECORD.         10430006
104400     ADD +1 TO PV-OUTPUT-OBTR-WRITTEN.                            10440006
104500                                                                  10450006
104600 7000-FORMAT-WRITE-SKU.                                           10460011
104700                                                                  10470011
104800     MOVE PV-PREV-INTR-UPC-ID TO                                  10480011
104900          DK-SKU-INTR-UPC-ID.                                     10490011
105000                                                                  10500011
105100     EXEC SQL                                                     10510011
105200         SELECT  INTR_UPC_ID                                      10520011
105300                ,STYL_ID                                          10530011
105400                ,ITM_NBR                                          10540011
105500                ,SKU_NBR                                          10550011
105600                ,SKU_STAT_CDE                                     10560011
105700                ,SKU_STAT_DESC                                    10570011
105800                ,INNR_PK_QTY                                      10580011
105900                ,OUTR_PK_QTY                                      10590011
106000                ,SKU_DESC                                         10600011
106100                ,KOHLS_SIZE_CDE                                   10610011
106200                ,SIZE_DESC                                        10620011
106300                ,NRF_CLOR_CDE                                     10630011
106400                ,SHRT_CLOR_DESC                                   10640011
106500                ,CSTM_CLOR_DESC                                   10650011
106600                ,REGN_PRIC_IND                                    10660011
106700                ,KY_ITM_IND                                       10670011
106800                ,GP_CDE                                           10680011
106900                ,LAST_UPD_TMST                                    10690011
107000                ,WHSE_RPLNT_IND                                   10700011
107100           INTO :OR-SKU-INTR-UPC-ID                               10710011
107200              , :OR-SKU-STYL-ID                                   10720011
107300              , :OR-SKU-ITM-NBR                                   10730011
107400              , :OR-SKU-SKU-NBR                                   10740011
107500              , :OR-SKU-SKU-STAT-CDE                              10750011
107600              , :OR-SKU-SKU-STAT-DESC                             10760011
107700              , :OR-SKU-INNR-PK-QTY                               10770011
107800              , :OR-SKU-OUTR-PK-QTY                               10780011
107900              , :OR-SKU-SKU-DESC                                  10790011
108000              , :OR-SKU-KOHLS-SIZE-CDE                            10800011
108100              , :OR-SKU-SIZE-DESC                                 10810011
108200              , :OR-SKU-NRF-CLOR-CDE                              10820011
108300              , :OR-SKU-SHRT-CLOR-DESC                            10830011
108400              , :OR-SKU-CSTM-CLOR-DESC                            10840011
108500              , :OR-SKU-REGN-PRIC-IND                             10850011
108600              , :OR-SKU-KY-ITM-IND                                10860011
108700              , :OR-SKU-GP-CDE                                    10870011
108800              , :OR-SKU-LAST-UPD-TMST                             10880011
108900              , :OR-SKU-WHSE-RPLNT-IND                            10890011
109000           FROM  XLT_SKU                                          10900011
109100          WHERE INTR_UPC_ID   =  :DK-SKU-INTR-UPC-ID              10910011
109200     END-EXEC.                                                    10920011
109300                                                                  10930011
109400     EVALUATE TRUE                                                10940011
109500         WHEN SQLCODE = ZERO                                      10950011
109600             PERFORM 7300-WRITE-SKU-RECORD                        10960011
109700         WHEN SQLWARN0 NOT = SPACE                                10970011
109800         WHEN SQLCODE < ZERO                                      10980011
109900         WHEN SQLCODE > ZERO                                      10990011
110000          MOVE DK-SKU-INTR-UPC-ID TO PV-DISP-INTR-UPC-ID          11000011
110200          DISPLAY 'INTR UPC ID: ' PV-DISP-INTR-UPC-ID             11020011
110600          MOVE '7000-FORMAT-WRITE-SKU'                            11060011
110700                             TO PV-PARAGRAPH-NAME                 11070011
110800          MOVE 'SELECT XLT_SKU'                                   11080011
110900                             TO PV-DB2-OPERATION-MSG-1            11090011
111000          MOVE 'XLT_SKU'                                          11100011
111100                             TO PV-DB2-TABLE-NAME                 11110011
111200          PERFORM 9999-DB2-ABEND                                  11120011
111300     END-EVALUATE.                                                11130011
111400                                                                  11140011
111500 7300-WRITE-SKU-RECORD.                                           11150011
111600                                                                  11160011
111700     WRITE OUTPUT-SKU-RECORD FROM OR-SKU-OUTPUT-RECORD.           11170011
111800     ADD +1 TO PV-OUTPUT-SKU-WRITTEN.                             11180011
111900                                                                  11190011
112000 9050-READ-INPUT-FILE.                                            11200011
112100                                                                  11210000
112200     READ INPUT-FILE                                              11220000
112300          INTO PC010-PCT-INTRANSIT-REC                            11230002
112400          AT END                                                  11240000
112500              SET PS-INPUT-EOF TO TRUE.                           11250000
112600                                                                  11260000
112700     IF PS-INPUT-EOF                                              11270000
112800         CONTINUE                                                 11280000
112900     ELSE                                                         11290000
113000         ADD +1 TO PV-INPUT-READ                                  11300000
113100                   PV-INPUT-CHECK-CNT                             11310000
113200         IF  PV-INPUT-CHECK-CNT = 7500                            11320014
113300             MOVE PV-INPUT-READ TO                                11330000
113400                  DP-OUT-CNT                                      11340000
113500             DISPLAY 'PROGRAM PROGRESS READS: '                   11350000
113600                     DP-OUT-CNT                                   11360000
113700             MOVE +0 TO PV-INPUT-CHECK-CNT                        11370000
113800         END-IF                                                   11380000
113900     END-IF.                                                      11390000
114000                                                                  11400000
114100                                                                  11410000
114200* ************************************************************** *11420000
114300* * DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT *11430000
114400* * AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN          * *11440000
114500* * SQL ERROR OR WARNING CODE OCCURS.                          * *11450000
114600* ************************************************************** *11460000
114700 9999-DB2-ABEND.                                                  11470000
114800                                                                  11480000
114900     DISPLAY PC-CURRENT-PROGRAM-NAME                              11490000
115000             ' 9999-DB2-ABEND'.                                   11500000
115100     DISPLAY PC-CURRENT-PROGRAM-NAME                              11510000
115200             ' ** ABEND           **'.                            11520000
115300     DISPLAY PC-CURRENT-PROGRAM-NAME                              11530000
115400             ' ** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.       11540000
115500     DISPLAY PC-CURRENT-PROGRAM-NAME                              11550000
115600             ' ** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME.       11560000
115700     DISPLAY PC-CURRENT-PROGRAM-NAME                              11570000
115800             ' ** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.  11580000
115900                                                                  11590000
116000     DISPLAY PC-CURRENT-PROGRAM-NAME                              11600000
116100             ' ** SQLCODE         ** = ' SQLCODE.                 11610000
116200     MOVE SQLCODE TO PV-SQLCODE.                                  11620000
116300     DISPLAY PC-CURRENT-PROGRAM-NAME                              11630000
116400             ' ** PV-SQLCODE      ** = ' PV-SQLCODE '.'.          11640000
116500                                                                  11650000
116600     DISPLAY PC-CURRENT-PROGRAM-NAME                              11660000
116700             ' ** SQLWARN0        ** = ' SQLWARN0 '.'.            11670000
116800                                                                  11680000
116900                                                                  11690000
117000*----------------------------------------------------------------*11700000
117100* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *11710000
117200* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *11720000
117300* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *11730000
117400* FORMAT.                                                        *11740000
117500*----------------------------------------------------------------*11750000
117600     COPY DPPD004.                                                11760000
117700                                                                  11770000
117800                                                                  11780000
117900*----------------------------------------------------------------*11790000
118000* CALL ABEND                                                     *11800000
118100*----------------------------------------------------------------*11810000
118200     MOVE +4013                  TO ABEND-CODE.                   11820000
118300     CALL 'ILBOABN0' USING ABEND-CODE.                            11830000
118400*                                                                 11840000
