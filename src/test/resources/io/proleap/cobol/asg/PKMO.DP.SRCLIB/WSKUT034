000100 IDENTIFICATION DIVISION.                                         00010085
000200 PROGRAM-ID.    WSKUT034.                                         00020086
000300 AUTHOR.        JEAN KURKOWSKI.                                   00030086
000400 INSTALLATION.  KOHLS.                                            00040086
000500 DATE-WRITTEN   JUNE, 2007.                                       00050086
000600 DATE-COMPILED.                                                   00060086
000700******************************************************************00070086
000800*   THIS PROGRAM PURGES OLD RECORDS FROM THE WMOS WRAP FILE.      00080086
000500*                                                                         
000500* CHANGES:                                                                
000500* 05/15/2020  JEAN KURK  REPLACE WMRD015 WITH CERD015                     
001100******************************************************************00110086
001200 ENVIRONMENT DIVISION.                                            00120086
001300 CONFIGURATION SECTION.                                           00130086
001400                                                                  00140086
001500 SOURCE-COMPUTER.        IBM-3090.                                00150086
001600 OBJECT-COMPUTER.        IBM-3090.                                00160086
001700                                                                  00170086
001800 INPUT-OUTPUT SECTION.                                            00180086
001900 FILE-CONTROL.                                                    00190086
002000                                                                  00200086
002100     SELECT WRAP-INPUT-FILE                                       00210086
002200         ASSIGN TO INP01.                                         00220086
002300                                                                  00230086
002400     SELECT WRAP-OUTPUT-FILE                                      00240086
002500         ASSIGN TO OUT01.                                         00250086
002600                                                                  00260086
002700******************************************************************00270001
002800 DATA DIVISION.                                                   00280001
002900 FILE SECTION.                                                    00290001
003000                                                                  00300001
003100 FD  WRAP-INPUT-FILE                                              00310001
003200     RECORDING MODE IS F                                          00320001
003300     LABEL RECORDS ARE STANDARD                                   00330001
003400     BLOCK CONTAINS 0 RECORDS.                                    00340001
003500                                                                  00350001
003600 01  WRAP-INPUT-RECORD         PIC  X(158).                       00360001
003700*                                                                 00370001
003800 FD  WRAP-OUTPUT-FILE                                             00380001
003900     RECORDING MODE IS F                                          00390001
004000     LABEL RECORDS ARE STANDARD                                   00400001
004100     BLOCK CONTAINS 0 RECORDS.                                    00410001
004200                                                                  00420001
004300 01  WRAP-OUTPUT-RECORD        PIC  X(158).                       00430001
004400*                                                                 00440001
004500******************************************************************00450001
004600 WORKING-STORAGE SECTION.                                         00460001
004700                                                                  00470001
004800*  WRAP INPUT/OUTPUT FILE LAYOUT                                  00480001
004900******************************************************************00490001
005000     COPY CERD015.                                                00500001
005100*                                                                 00510001
006200******************************************************************00620001
006300*  COMMUNICATIONS AREA FOR DB2                                    00630001
006400******************************************************************00640001
006500     EXEC SQL                                                     00650001
006600          INCLUDE SQLCA                                           00660001
006700     END-EXEC.                                                    00670001
006800                                                                  00680001
006820     COPY SQLCA2.                                                 00682072
006830     COPY DPWS004.                                                00683072
006840                                                                  00684072
006900*   WST_INTGRTN_TYP TABLE                                         00690019
007000******************************************************************00700001
007100     EXEC SQL                                                     00710001
007200          INCLUDE WST00008                                        00720001
007300     END-EXEC.                                                    00730001
007400                                                                  00740001
007500*  WST_ATTR_DEFN TABLE                                            00750019
007600******************************************************************00760019
007700     EXEC SQL                                                     00770019
007800          INCLUDE WST00009                                        00780019
007900     END-EXEC.                                                    00790019
008000                                                                  00800019
008100*  WST_ATTR_ELEM TABLE                                            00810019
008200******************************************************************00820001
008300     EXEC SQL                                                     00830001
008400          INCLUDE WST00010                                        00840001
008500     END-EXEC.                                                    00850001
008600                                                                  00860001
012200                                                                  01220019
012300******************************************************************01230001
012400 01  PS-PROGRAM-SWITCHES.                                         01240001
012500     05  PS-END-OF-FILE-SW           PIC  X(01)    VALUE 'N'.     01250001
012600         88  PS-END-OF-FILE                        VALUE 'Y'.     01260001
012700         88  PS-NOT-END-OF-FILE                    VALUE 'N'.     01270001
013400                                                                  01340001
013500 01  PC-PROGRAM-CONSTANTS.                                        01350001
013600     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08) VALUE 'WSKUT034'. 01360001
013700                                                                  01370001
013800 01  PV-PROGRAM-VARIABLES.                                        01380001
013910     05  PV-ABEND-PARAGRAPH          PIC  X(35) VALUE SPACES.     01391071
013911     05  PV-ABEND-CODE                PIC S9(04) VALUE ZERO       01391171
013912                                                 COMP SYNC.       01391271
015400     05  PV-NBR-OF-DAYS              PIC S9(5) COMP-3 VALUE ZEROS.01400001
015400     05  PV-PURGE-DATE               PIC  X(10)  VALUE SPACES.    01400001
015400     05  PV-DISPLAY-COUNT            PIC  ZZZ,ZZZ,ZZ9.            01400001
015400     05  PV-DISPLAY-DAYS             PIC  ZZ,ZZ9.                 01400001
015600     05  PV-DISPLAY-SQLCODE          PIC  +999.                           
015400     05  PV-READ-COUNTER             PIC  9(5) COMP VALUE ZEROS.  01400001
014200     05  PV-WRITE-COUNTER            PIC  9(5) COMP VALUE ZEROS.  01420001
014201     05  PV-BYPASS-COUNTER           PIC  9(5) COMP VALUE ZEROS.  01420177
007700     05  PV-TRANSACTION-DATE         PIC  X(10)  VALUE SPACE.             
007800     05  FILLER  REDEFINES  PV-TRANSACTION-DATE.                          
007900         10  PV-TRANS-DATE.                                               
008000             15  PV-TRANS-YR             PIC  9(04).                      
008300             15  PV-DASH-1               PIC  X(01).                      
008400             15  PV-TRANS-MM             PIC  9(02).                      
008500             15  PV-DASH-2               PIC  X(01).                      
008600             15  PV-TRANS-DD             PIC  9(02).                      
017410                                                                  01741067
018900******************************************************************01890001
019000 PROCEDURE DIVISION.                                              01900001
019100******************************************************************01910001
019200* CONTROLS THE MAIN PROCESSING OF THE PROGRAM.                    01920002
019300******************************************************************01930001
019400 0000-PROGRAM-MAINLINE.                                           01940001
019500                                                                  01950001
019600     DISPLAY '***** WSKUT034 STARTED *****'.                      01960001
019600     DISPLAY ' '.                                                 01960001
019700                                                                  01970001
019800     PERFORM 1000-INITIALIZE.                                     01980001
019900     PERFORM 2000-PROCESS-WRAP-FILE                               01990001
020000         UNTIL PS-END-OF-FILE.                                    02000001
020100     PERFORM 9500-EOJ-ROUTINE.                                    02010002
020200                                                                  02020001
020300     STOP RUN.                                                    02030001
020400                                                                  02040001
020500******************************************************************02050001
020600*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    02060001
020700*    -- OPEN INPUT FILE                                           02070001
020800*    -- OPEN OUTPUT FILES                                         02080059
020900*    -- GET PURGE DATE FROM DATABASE                              02090001
020900*    -- READ INPUT FILE                                           02090001
021000******************************************************************02100001
021100 1000-INITIALIZE.                                                 02110001
021200                                                                  02120001
021210*    DISPLAY '1000-'.                                             02121083
021300     OPEN INPUT  WRAP-INPUT-FILE.                                 02130001
021400     OPEN OUTPUT WRAP-OUTPUT-FILE.                                02140043
021500                                                                  02150001
021600     PERFORM 3000-GET-PURGE-DATE.                                 02160002
021600     PERFORM 2500-READ-FILE.                                      02160002
021700                                                                  02170001
021800******************************************************************02180001
021900*  PROCESS INPUT UNTIL END OF FILE.                               02190001
022000******************************************************************02200001
022100 2000-PROCESS-WRAP-FILE.                                          02210001
022110*    DISPLAY '2000-'.                                             02211083
022200                                                                  02220001
008000     MOVE CE015-TRANS-YR         TO PV-TRANS-YR.                          
008300     MOVE '-'                    TO PV-DASH-1.                            
008000     MOVE CE015-TRANS-MO         TO PV-TRANS-MM.                          
008300     MOVE '-'                    TO PV-DASH-2.                            
008000     MOVE CE015-TRANS-DA         TO PV-TRANS-DD.                          
008000                                                                          
008001*    DISPLAY 'CE015-TRANS-DATE=' CE015-TRANS-DATE.                        
008002*    DISPLAY 'PV-TRANS-DATE=   ' PV-TRANS-DATE.                           
022400                                                                  02240002
022500     IF PV-TRANS-DATE <= PV-PURGE-DATE                            02250002
022510         ADD 1 TO PV-BYPASS-COUNTER                               02251083
022700     ELSE                                                         02270001
022800         WRITE WRAP-OUTPUT-RECORD FROM                            02280041
022800                                CE015-RECEIPT-UPLOAD-RECORD       02280041
022900         ADD 1 TO PV-WRITE-COUNTER                                02290041
022910     END-IF.                                                      02291083
025500                                                                  02550004
025600     PERFORM 2500-READ-FILE.                                      02560002
025700                                                                  02570001
079300******************************************************************07930038
079400*  READ INPUT FILE.                                               07940038
079500******************************************************************07950038
079600 2500-READ-FILE.                                                  07960038
079610                                                                  07961083
079610*    DISPLAY '2500-'.                                             07961083
079700      INITIALIZE CE015-RECEIPT-UPLOAD-RECORD.                     07970006
079800                                                                  07980001
079900      READ WRAP-INPUT-FILE INTO                                   07990001
080000                           CE015-RECEIPT-UPLOAD-RECORD            08000006
080100            AT END SET PS-END-OF-FILE TO TRUE.                    08010001
080200                                                                  08020001
080300      IF PS-END-OF-FILE                                           08030001
080400         CONTINUE                                                 08040001
080500      ELSE                                                        08050001
080600         ADD +1 TO PV-READ-COUNTER                                08060001
081300      END-IF.                                                     08130001
081400                                                                  08140001
031911******************************************************************03191177
031920*  CHECK TO SEE IF THIS CARTON IS ACTIVE ON OTBND-CART.           03192077
031930******************************************************************03193077
031940 3000-GET-PURGE-DATE.                                             03194077
031961*    DISPLAY '3000-'.                                             03196180
031970                                                                  03197077
031991     EXEC SQL                                                     03199177
031991         SELECT A.INTGRTN_TYP_CDE                                         
031991              , A.INTGRTN_TYP_DESC                                        
031991              , INT (C.ATTR_ELEM_NBR)                                     
031991              , CURRENT DATE - (INT(C.ATTR_ELEM_NBR)) DAYS                
031991         INTO   :WST00008-INTGRTN-TYP-CDE                                 
031991              , :WST00008-INTGRTN-TYP-DESC                                
031991              , :PV-NBR-OF-DAYS                                           
031991              , :PV-PURGE-DATE                                            
031991         FROM WST_INTGRTN_TYP A                                           
031991            , WST_ATTR_DEFN   B                                           
031991            , WST_ATTR_ELEM   C                                           
031991         WHERE A.INTGRTN_TYP_CDE        = 'WMSSEWRAPP'                    
031991           AND A.INTGRTN_TYP_CDE        = B.INTGRTN_TYP_CDE               
031991           AND B.ATTR_DEFN_SEQ_NBR      = 1                               
031991           AND B.INTGRTN_TYP_CDE        = C.INTGRTN_TYP_CDE               
031991           AND C.ATTR_DEFN_SEQ_NBR      = 1                               
031998     END-EXEC.                                                    03199877
031999                                                                  03199977
032001     EVALUATE TRUE                                                03200177
032002         WHEN SQLCODE = ZERO                                      03200277
032003              DISPLAY 'INTGRTN TYPE CODE = '                      03200377
031991                               WST00008-INTGRTN-TYP-CDE                   
032003              DISPLAY 'INTGRTN TYPE DESC = '                      03200377
031991                               WST00008-INTGRTN-TYP-DESC                  
031991              MOVE PV-NBR-OF-DAYS     TO PV-DISPLAY-DAYS                  
032003              DISPLAY 'NUMBER OF DAYS    = '                      03200377
031991                               PV-DISPLAY-DAYS                            
032003              DISPLAY 'PURGE DATE        = '                      03200377
031991                               PV-PURGE-DATE                              
032037         WHEN SQLWARN0 NOT = SPACES                               03203777
032038         WHEN SQLCODE < ZERO                                      03203877
032039         WHEN SQLCODE > ZERO                                      03203977
031961              MOVE '3000-GET-PURGE-DATE'                          03196180
031961                                   TO PV-ABEND-PARAGRAPH          03196180
032045              MOVE SQLCODE         TO PV-DISPLAY-SQLCODE          03204577
032045              DISPLAY 'PROBLEM GETTING PURGE DATE '               03204577
032052                      ' SQL= ' PV-DISPLAY-SQLCODE                 03205277
032053             PERFORM 9900-SQL-ERROR                               03205377
032054     END-EVALUATE.                                                03205477
032055                                                                  03205577
079200                                                                  07920038
082500******************************************************************08250001
082600*  CLOSE INPUT FILE.  DISPLAY COUNTERS.                           08260001
082700******************************************************************08270001
082800 9500-EOJ-ROUTINE.                                                08280002
082810*    DISPLAY '9500-'.                                             08281083
082810                                                                  08281083
082900     CLOSE WRAP-INPUT-FILE                                        08290001
083000           WRAP-OUTPUT-FILE.                                      08300043
083100                                                                  08310001
083200     DISPLAY '      '.                                            08320033
083300                                                                  08330033
083400     MOVE PV-READ-COUNTER               TO  PV-DISPLAY-COUNT.     08340006
083500     DISPLAY 'TOTAL RECORDS READ.......: '  PV-DISPLAY-COUNT.     08350006
083600                                                                  08360033
083931     DISPLAY '      '.                                            08393146
083932                                                                  08393246
083940     MOVE PV-BYPASS-COUNTER             TO  PV-DISPLAY-COUNT.     08394046
083950     DISPLAY 'TOTAL RECORDS BYPASSED...: '  PV-DISPLAY-COUNT.     08395046
083951                                                                  08395185
084000     DISPLAY '      '.                                            08400039
084100                                                                  08410039
083940     MOVE PV-WRITE-COUNTER              TO  PV-DISPLAY-COUNT.     08394046
083950     DISPLAY 'TOTAL RECORDS WRITTEN....: '  PV-DISPLAY-COUNT.     08395046
083951                                                                  08395185
087190                                                                  08719060
087200     DISPLAY '      '.                                            08720033
087300                                                                  08730033
087400     DISPLAY '*****  WSKUT034 ENDED  *****'.                      08740001
087500                                                                  08750001
087600 9900-SQL-ERROR.                                                  08760071
087710*    DISPLAY '9900-'.                                             08771080
087700                                                                  08770071
087800     MOVE SQLCODE               TO SQLCODE2.                      08780071
087900     MOVE SQLERRD(3)            TO SQLERRD3.                      08790071
088000     DISPLAY '** ABEND **       ** = SQLERROR'.                   08800071
088100     DISPLAY '** PROGRAM        ** = WSKUT034'.                   08810071
088200     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        08820071
088300                                                                  08830071
088400     COPY DPPD004.                                                08840071
088600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         08860071
