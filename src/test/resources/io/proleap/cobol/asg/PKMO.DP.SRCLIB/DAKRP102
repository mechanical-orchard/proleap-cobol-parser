       IDENTIFICATION DIVISION.                                         00010049
                                                                        00020049
       PROGRAM-ID.             DAKRP102.                                00030049
       AUTHOR.                 BOB MCASEY.                              00040049
       INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050049
       DATE-WRITTEN.           JULY 2000.                               00060049
       DATE-COMPILED.                                                   00070049
                                                                        00080049
      ***************************************************************** 00090049
      *  PROGRAM NARRATIVE:                                           * 00100049
      *  THIS PROGRAM READS AN EXTRACT FROM THE DEBIT ALLOWANCE ORACLE* 00110049
      *  ONLINE APPLICATION AND CREATES A REPORT OF DEBIT ALLOWANCE   * 00120049
      *  PRICE CHANGE FOR A FISCAL MONTH.  THIS PROGRAM IS RUN DAILY  * 00130049
      *  AND MONTHLY (USING THE ACCUMULATION OF ALL DEBIT ALLOWANCE   * 00140049
      *  RECORDS FOR A PARTICULAR MONTH).                             * 00150049
0301RM*                                                               * 00160049
  |   *   DATE: 03/06/2001     CHANGE ID: 394831     WHO: BOB MCASEY  * 00170049
  |   * DESCRIPTION OF CHANGE:                                        * 00180049
  |   * CHANGE DATE POSTED TO REFLECT THE ACTUAL DATE THE TXNS ARE    * 00190049
  |   * BEING POSTED TO M/L.  CHANGED HEADING TO DISTINGUISH BETWEEN  * 00200049
  |   * DAILY RUN (DAKRP201-1) AND WEEKLY RUN (DAKRP201-2).  THE TITLE* 00210049
  |   * HAS ALSO BEEN CHANGED TO REFLECT THIS.  THIS PROGRAM IS USED  * 00220049
0301RM* IN DAK001 AND DAK201, SO A CONTROL CARD CONTAINS THE LITERALS.* 00230049
0701RM*                                                               * 00240049
  |   *   DATE: 07/20/2001     CHANGE ID: WR22467    WHO: BOB MCASEY  * 00250049
  |   * DESCRIPTION OF CHANGE:                                        * 00260049
  |   * CHANGED RECORD LENGTH OF AP TRANS FILE AND ALL PROCESSING     * 00270049
  |   * ASSOCIATED WITH IT. THE RECORD LENGTH WENT FROM 400 TO 500 AND* 00280049
0701RM* THIS PROGRAM ADDED 50 BYTES TO THAT ALSO.                     * 00290049
      *                                                               * 00300049
      *    WR/PITS#     DATE        DESCRIPTION                       * 00310049
      *    --------   ----------   ---------------------------------  * 00320049
      *    WR23724    05/15/2002   RECOMPILED FOR CHANGES IN COPYBOOK * 00330049
      *                            APRD045                            * 00340049
22405 * 22405  05-31-2001 R JANSSEN  DAII - ASSET RECOVERY ENHANCEMENT  00350049
W26601*W26601  04-20-2004 S JACKSON  STORE EXPANSION EFFORT. ALSO,      00360050
W26601*                              PROCESSING DATE CHANGES MADE TO    00370051
W26601*                              TRULY REFLECT THE EFFECTIVE DATE   00380050
W26601*                              FOR THE DEBIT ALLOWANCE.           00390050
      ***************************************************************** 00400049
      *                                                                 00410049
      /                                                                 00420049
       ENVIRONMENT DIVISION.                                            00430049
                                                                        00440049
       CONFIGURATION SECTION.                                           00450049
                                                                        00460049
       SOURCE-COMPUTER.                        IBM-3090.                00470049
       OBJECT-COMPUTER.                        IBM-3090.                00480049
                                                                        00490049
       INPUT-OUTPUT SECTION.                                            00500049
                                                                        00510049
       FILE-CONTROL.                                                    00520049
                                                                        00530049
           SELECT  AP-TRANS-FILE             ASSIGN TO INP01.           00540049
           SELECT  IN-DATE-FILE              ASSIGN TO INP02.           00550049
           SELECT  CONTROL-CARD-FILE         ASSIGN TO INP03.           00560049
           SELECT  REPORT-CTL-CARD-FILE      ASSIGN TO INP04.           00570049
           SELECT  REPORT-FILE               ASSIGN RPT01.              00580049
                                                                        00590049
      ******************************************************************00600049
       DATA DIVISION.                                                   00610049
      ******************************************************************00620049
                                                                        00630049
       FILE SECTION.                                                    00640049
      *                                                                 00650049
       FD  AP-TRANS-FILE                                                00660049
           LABEL RECORDS ARE STANDARD                                   00670049
           RECORDING MODE IS F                                          00680049
           BLOCK CONTAINS 0 RECORDS.                                    00690049
0701RM*01  AP-TRANS-FILE-REC             PIC X(450).                    00700049
0701RM 01  AP-TRANS-FILE-REC             PIC X(550).                    00710049
                                                                        00720049
       FD  IN-DATE-FILE                                                 00730049
           LABEL RECORDS ARE STANDARD                                   00740049
           RECORDING MODE IS F                                          00750049
           BLOCK CONTAINS 0 RECORDS.                                    00760049
       01  IN-DATE-RECORD                PIC X(50).                     00770049
                                                                        00780049
       FD  CONTROL-CARD-FILE                                            00790049
           RECORDING MODE IS F                                          00800049
           LABEL RECORDS ARE STANDARD                                   00810049
           BLOCK CONTAINS 0 RECORDS.                                    00820049
                                                                        00830049
       01  CONTROL-CARD-RECORD           PIC X(80).                     00840049
                                                                        00850049
       FD  REPORT-CTL-CARD-FILE                                         00860049
           RECORDING MODE IS F                                          00870049
           LABEL RECORDS ARE STANDARD                                   00880049
           BLOCK CONTAINS 0 RECORDS.                                    00890049
                                                                        00900049
       01  REPORT-CTL-CARD-RECORD        PIC X(80).                     00910049
                                                                        00920049
       FD  REPORT-FILE                                                  00930049
           RECORDING MODE F                                             00940049
           LABEL RECORDS OMITTED                                        00950049
           BLOCK CONTAINS  0 RECORDS.                                   00960049
       01  REPORT-RECORD.                                               00970049
           05  REPORT-LINE               PIC X(132).                    00980049
      *                                                                 00990049
       WORKING-STORAGE SECTION.                                         01000049
                                                                        01010049
       01  ABEND-CODE                PIC S9(04) VALUE ZERO              01020049
                                                       COMP SYNC.       01030049
                                                                        01040049
       01  PA-PROGRAM-ACCUMULATORS.                                     01050049
           05  PA-LINE-COUNT         PIC S9(03)    COMP-3 VALUE 0.      01060049
           05  PA-LINE-NO            PIC S9(03)    COMP-3 VALUE 0.      01070049
           05  PA-PAGE-COUNT         PIC S9(05)    COMP-3 VALUE 0.      01080049
           05  PA-IN-COUNT           PIC S9(09)    COMP-3 VALUE 0.      01090049
           05  PA-TOTAL-READ         PIC S9(09)    COMP-3 VALUE 0.      01100049
22405      05  PA-TOTAL-WRITE        PIC S9(09)    COMP-3 VALUE 0.      01110049
           05  PA-BATCH-TXNS         PIC S9(07)    COMP-3 VALUE 0.      01120049
           05  PA-STR-TXNS           PIC S9(07)    COMP-3 VALUE 0.      01130049
           05  PA-TOTAL-CREDIT-AMT   PIC S9(09)V99 COMP-3 VALUE 0.      01140049
           05  PA-TOTAL-RTL-AMT      PIC S9(09)V99 COMP-3 VALUE 0.      01150049
           05  PA-TOTAL-RTL          PIC S9(09)V99 COMP-3 VALUE 0.      01160049
           05  PA-TOTAL-COST         PIC S9(09)V99 COMP-3 VALUE 0.      01170049
           05  PA-BATCH-RTL          PIC S9(09)V99 COMP-3 VALUE 0.      01180049
           05  PA-BATCH-COST         PIC S9(09)V99 COMP-3 VALUE 0.      01190049
           05  PA-STR-RTL            PIC S9(09)V99 COMP-3 VALUE 0.      01200049
           05  PA-STR-COST           PIC S9(09)V99 COMP-3 VALUE 0.      01210049
                                                                        01220049
       01  PC-CONSTANTS.                                                01230049
           05  PC-OPERCO-NBR         PIC  X(02) VALUE '03'.             01240049
           05  PC-MDSELV-DPT         PIC  X(03) VALUE 'DPT'.            01250049
           05  PC-DAK200-JOB         PIC  X(06) VALUE 'DAK200'.         01260049
           05  PC-DAKRP102-PGM       PIC  X(08) VALUE 'DAKRP102'.       01270049
           05  PC-ONE-LINE           PIC S9(01)  VALUE 1.               01280049
           05  PC-THREE-LINES        PIC S9(01)  VALUE 3.               01290049
           05  PC-MAX-RETRIES        PIC S9(01)  VALUE 3.               01300049
           05  PC-MAX-LINES          PIC S9(03)  VALUE 79.              01310049
                                                                        01320049
       01  PM-PROGRAM-MESSAGES.                                         01330049
           05  PM-TOTAL-BATCH.                                          01340049
               10  FILLER            PIC  X(06) VALUE 'BATCH '.         01350049
               10  PM-BATCH          PIC  X(03) VALUE SPACES.           01360049
               10  FILLER            PIC  X(08) VALUE ' TOTALS:'.       01370049
           05  PM-TOTAL-CORP         PIC  X(18) VALUE                   01380049
               'CORPORATE TOTALS:'.                                     01390049
           05  PM-NO-INPUT-MSG       PIC  X(80) VALUE                   01400049
               '          =====> NO INPUT <====                      '. 01410049
           05  PM-END-RPT-MSG        PIC  X(80) VALUE                   01420049
               '          * * *  END OF REPORT  * * *                '. 01430049
                                                                        01440049
       01  PS-SWITCHES.                                                 01450049
           05  PS-EOF-EXTRACT-SWITCH PIC  X(01) VALUE 'N'.              01460049
               88  PS-EOF-EXTRACT                      VALUE 'Y'.       01470049
                                                                        01480049
       01  PV-VARIABLES.                                                01490049
           05  PV-HOLD-BATCH-NBR      PIC X(03)     VALUE SPACES.       01500049
           05  PV-BTCH-SRC-CDE        PIC X(03)     VALUE SPACES.       01510049
           05  PV-RUN-TIME            PIC X(08)     VALUE SPACES.       01520049
           05  PV-RUN-DATE            PIC X(10)     VALUE SPACES.       01530049
           05  PV-EFF-DTE-TIME.                                         01540049
               10  PV-EFF-DTE         PIC X(10).                        01550049
               10  PV-EFF-TIME        PIC X(09).                        01560049
           05  PV-PARAGRAPH           PIC X(30)     VALUE SPACES.       01570049
           05  PV-DB2-OPER-ATTEMPTED  PIC X(40)     VALUE SPACES.       01580049
           05  PV-ABEND-MESSAGE       PIC X(75)     VALUE SPACES.       01590049
           05  PV-LINES               PIC  9(01)    VALUE 0.            01600049
           05  PV-SQL-SUB             PIC S9(01)    COMP-3 VALUE 0.     01610049
           05  PV-STR-NBR             PIC 9(05)     VALUE 0.            01620049
W26601     05  PV-STR-NBR-INT         PIC S9(04)    COMP VALUE 0.       01630050
W26601*    05  PV-STR-NBR-ALPHA REDEFINES PV-STR-NBR.                   01640049
W26601*        10  PV-STR-NBR-1-2     PIC X(02).                        01650049
W26601*        10  PV-STR-NBR-3-5     PIC X(03).                        01660049
           05  PV-HOLD-STR-NBR        PIC 9(05)     VALUE 0.            01670049
0301RM     05  PV-HOLD-PROC-DTE       PIC X(10).                        01680049
           05  PV-TOTAL-CREDITS       PIC S9(09)V99 COMP-3 VALUE 0.     01690049
           05  PV-TOTAL-CREDIT-AMT    PIC S9(09)V99 COMP-3 VALUE 0.     01700049
           05  PV-STMT-DTL-SEQ-NBR    PIC S9(05)    COMP-3 VALUE 0.     01710049
           05  PV-DISP-NUMBER         PIC Z,ZZZ,ZZ9.                    01720049
                                                                        01730049
      ***************************************************************** 01740049
      *  KOHL'S STANDARD FIRST HEADING LINE                             01750049
      ***************************************************************** 01760049
           COPY DPWS132O.                                               01770049
                                                                        01780049
       01  H2-HEADING2.                                                 01790049
           05  FILLER                PIC X(38) VALUE SPACES.            01800049
0301RM     05  H2-HEADING-TITLE      PIC X(51) VALUE SPACES.            01810049
0301RM*    05  FILLER                PIC X(48) VALUE                    01820049
0301RM*    'DEBIT ALLOWANCES PRICE CHANGE BATCH TOTALS FOR '.           01830049
           05  H2-FSCL-MN-END-DTE    PIC X(10) VALUE SPACES.            01840049
0301RM*    05  FILLER                PIC X(09) VALUE SPACES.            01850049
0301RM     05  FILLER                PIC X(06) VALUE SPACES.            01860049
           05  FILLER                PIC X(05) VALUE 'JOB: '.           01870049
           05  H2-JOB-NAME           PIC X(06) VALUE SPACES.            01880049
           05  FILLER                PIC X(16) VALUE SPACES.            01890049
                                                                        01900049
       01  H3-HEADING3.                                                 01910049
           05  FILLER                PIC X(02) VALUE SPACES.            01920049
           05  FILLER                PIC X(04) VALUE 'DATE'.            01930049
           05  FILLER                PIC X(08) VALUE SPACES.            01940049
           05  FILLER                PIC X(05) VALUE 'BATCH'.           01950049
           05  FILLER                PIC X(03) VALUE SPACES.            01960049
           05  FILLER                PIC X(08) VALUE 'LOCATION'.        01970049
           05  FILLER                PIC X(25) VALUE SPACES.            01980049
           05  FILLER                PIC X(06) VALUE 'NBR OF'.          01990049
           05  FILLER                PIC X(14) VALUE SPACES.            02000049
           05  FILLER                PIC X(04) VALUE 'COST'.            02010049
           05  FILLER                PIC X(20) VALUE SPACES.            02020049
           05  FILLER                PIC X(06) VALUE 'RETAIL'.          02030049
           05  FILLER                PIC X(28) VALUE SPACES.            02040049
                                                                        02050049
       01  H4-HEADING4.                                                 02060049
           05  FILLER                PIC X(02) VALUE SPACES.            02070049
           05  FILLER                PIC X(06) VALUE 'POSTED'.          02080049
           05  FILLER                PIC X(07) VALUE SPACES.            02090049
           05  FILLER                PIC X(03) VALUE 'NBR'.             02100049
           05  FILLER                PIC X(36) VALUE SPACES.            02110049
           05  FILLER                PIC X(08) VALUE 'PRC CHGS'.        02120049
           05  FILLER                PIC X(70) VALUE SPACES.            02130049
                                                                        02140049
       01  DL1-DETAIL-LINE-1.                                           02150049
           05  FILLER                PIC X(02) VALUE SPACES.            02160049
           05  DL1-POST-DTE          PIC X(10) VALUE SPACES.            02170049
           05  FILLER                PIC X(03) VALUE SPACES.            02180049
           05  DL1-BATCH-NBR         PIC X(03) VALUE SPACES.            02190049
           05  FILLER                PIC X(04) VALUE SPACES.            02200052
W26601*    05  DL1-STR-NBR           PIC X(03) VALUE SPACES.            02210052
W26601     05  DL1-STR-NBR           PIC X(05) VALUE SPACES.            02220049
           05  FILLER                PIC X(02) VALUE SPACES.            02230049
           05  DL1-STR-NAME          PIC X(25) VALUE SPACES.            02240049
W26601*    05  FILLER                PIC X(03) VALUE SPACES.            02250052
W26601     05  FILLER                PIC X(01) VALUE SPACES.            02260052
           05  DL1-NBR-OF-PRICE-CHGS PIC Z,ZZZ,ZZ9.                     02270049
           05  FILLER                PIC X(03) VALUE SPACES.            02280049
           05  DL1-COST-AMT          PIC ZZZ,ZZZ,ZZZ,ZZ9.99-.           02290049
           05  FILLER                PIC X(05) VALUE SPACES.            02300049
           05  DL1-RETAIL-AMT        PIC ZZZ,ZZZ,ZZZ,ZZ9.99-.           02310049
           05  FILLER                PIC X(18) VALUE SPACES.            02320049
                                                                        02330049
       01  TL1-TOTAL-LINE-1.                                            02340049
           05  FILLER                PIC X(02) VALUE SPACES.            02350049
           05  TL1-TOTAL-TYPE        PIC X(18) VALUE SPACES.            02360049
           05  FILLER                PIC X(35) VALUE SPACES.            02370049
           05  TL1-NBR-OF-PRICE-CHGS PIC Z,ZZZ,ZZ9.                     02380049
           05  FILLER                PIC X(03) VALUE SPACES.            02390049
           05  TL1-COST-AMT          PIC ZZZ,ZZZ,ZZZ,ZZ9.99-.           02400049
           05  FILLER                PIC X(05) VALUE SPACES.            02410049
           05  TL1-RETAIL-AMT        PIC ZZZ,ZZZ,ZZZ,ZZ9.99-.           02420049
           05  FILLER                PIC X(18) VALUE SPACES.            02430049
                                                                        02440049
      ***************************************************************** 02450049
      *  INPUT A/P RECORD LAYOUT  PLUS ADDITIONAL FIELDS              * 02460049
      ***************************************************************** 02470049
           COPY APRD045.                                                02480049
           05  PV-APRD045-BATCH-NBR    PIC X(03).                       02490049
           05  PV-APRD045-CENPPC-NBR   PIC S9(07)    COMP-3.            02500049
           05  PV-APRD045-RTL-AMT      PIC S9(09)V99 COMP-3.            02510049
           05  PV-APRD045-NET-CST-AMT  PIC S9(09)V99 COMP-3.            02520049
           05  PV-APRD045-EFF-DTE      PIC X(19).                       02530049
0301RM     05  PV-APRD045-PROC-DTE     PIC X(10).                       02540049
0301RM*    05  FILLER                  PIC X(12).                       02550049
0301RM     05  FILLER                  PIC X(02).                       02560049
                                                                        02570049
      ****************************************************************  02580049
      * DARD104 COPYBOOK - OPEN FISCAL WEEK/MONTH DATES                 02590049
      ****************************************************************  02600049
           COPY DARD104.                                                02610049
                                                                        02620049
      ****************************************************************  02630049
      * RECORD LAYOUT FOR CONTROL CARD FILE.                            02640049
      ****************************************************************  02650049
       01  CC-CONTROL-CARD.                                             02660049
           05  CC-CTL-DTE                   PIC X(10).                  02670049
           05  CC-CTL-FILLER                PIC X(70).                  02680049
      ****************************************************************  02690049
      * RECORD LAYOUT FOR REPORT CONTROL CARD                           02700049
      ****************************************************************  02710049
       01  RC-CONTROL-CARD.                                             02720049
           05  RC-JOB-NAME                  PIC X(06).                  02730049
           05  RC-RPT-ID                    PIC X(01).                  02740049
           05  RC-RPT-HEADING               PIC X(50).                  02750049
           05  FILLER                       PIC X(23).                  02760049
W26601****************************************************************  02770049
W26601*  DB2 STORE TABLE LAYOUT                                         02780049
W26601****************************************************************  02790049
W26601*    EXEC SQL                                                     02800049
W26601*       INCLUDE TSTR000                                           02810049
W26601*    END-EXEC.                                                    02820049
                                                                        02830049
W26601****************************************************************  02840049
W26601*  DB2 STORE DOMAIN TABLE LAYOUT                                  02850049
W26601****************************************************************  02860049
W26601     EXEC SQL                                                     02870049
W26601        INCLUDE XMT00001                                          02880049
W26601     END-EXEC.                                                    02890049
                                                                        02900049
      ****************************************************************  02910049
      *  COMMUNICATION AREAS FOR DB2                                    02920049
      ****************************************************************  02930049
           EXEC SQL                                                     02940049
               INCLUDE SQLCA                                            02950049
           END-EXEC.                                                    02960049
                                                                        02970049
      ****************************************************              02980049
      *  ERROR MESSAGE AREA FOR DB2                      *              02990049
      ****************************************************              03000049
           COPY DPWS004.                                                03010049
                                                                        03020049
      *                                                                 03030049
       PROCEDURE DIVISION.                                              03040049
                                                                        03050049
       0000-DAKRP102.                                                   03060049
                                                                        03070049
           PERFORM 1000-INITIALIZE                                      03080049
                                                                        03090049
           PERFORM 2000-PROCESS-EXTRACT                                 03100049
               UNTIL PS-EOF-EXTRACT.                                    03110049
                                                                        03120049
           PERFORM 9000-EOJ.                                            03130049
                                                                        03140049
           GOBACK.                                                      03150049
                                                                        03160049
                                                                        03170049
       1000-INITIALIZE.                                                 03180049
                                                                        03190049
           OPEN INPUT  AP-TRANS-FILE                                    03200049
                       CONTROL-CARD-FILE                                03210049
                       REPORT-CTL-CARD-FILE                             03220049
                       IN-DATE-FILE.                                    03230049
           OPEN OUTPUT REPORT-FILE.                                     03240049
                                                                        03250049
           PERFORM 8000-READ-CONTROL-CARD-FILE.                         03260049
           PERFORM 8600-READ-RPT-CTL-CARD-FILE.                         03270049
                                                                        03280049
           PERFORM 8400-READ-EXTRACT.                                   03290049
           IF PS-EOF-EXTRACT                                            03300049
               DISPLAY 'NO DA INPUT -- REPORT WILL BE EMPTY'            03310049
           ELSE                                                         03320049
               MOVE PV-APRD045-BATCH-NBR TO PV-HOLD-BATCH-NBR           03330049
               MOVE AP045-STR-NBR        TO PV-HOLD-STR-NBR             03340049
0301RM*        MOVE PV-APRD045-PROC-DTE  TO PV-HOLD-PROC-DTE            03350050
W26601         MOVE PV-APRD045-EFF-DTE   TO PV-HOLD-PROC-DTE            03360050
               PERFORM 7000-RETRIEVE-STORE-NAME                         03370049
           END-IF.                                                      03380049
                                                                        03390049
           MOVE CC-CTL-DTE   (3:2)           TO DP132O-RUN-YEAR.        03400049
           MOVE CC-CTL-DTE   (6:2)           TO DP132O-RUN-MONTH.       03410049
           MOVE CC-CTL-DTE   (9:2)           TO DP132O-RUN-DAY.         03420049
           MOVE FUNCTION CURRENT-DATE (9:2)  TO DP132O-RUN-HOUR.        03430049
           MOVE FUNCTION CURRENT-DATE (11:2) TO DP132O-RUN-MINUTE.      03440049
           MOVE PC-DAKRP102-PGM              TO DP132O-PROGRAM-NAME.    03450049
0301RM     MOVE RC-RPT-ID                    TO DP132O-REPORT-NUMBER.   03460049
                                                                        03470049
           PERFORM 8200-READ-DATE-FILE.                                 03480049
           PERFORM 4000-WRITE-REPORT-HEADING.                           03490049
                                                                        03500049
       2000-PROCESS-EXTRACT.                                            03510049
                                                                        03520049
           IF PV-APRD045-BATCH-NBR = PV-HOLD-BATCH-NBR                  03530049
22405          IF AP045-STR-NBR = PV-HOLD-STR-NBR                       03540049
22405              PERFORM 2200-ACCUM-STORE-TOTALS                      03550049
22405          ELSE                                                     03560049
22405              PERFORM 2600-PRINT-STORE-TOTALS                      03570049
22405          END-IF                                                   03580049
               PERFORM 2400-ACCUM-BATCH-TOTALS                          03590049
           ELSE                                                         03600049
22405          PERFORM 2600-PRINT-STORE-TOTALS                          03610049
               PERFORM 2800-PRINT-BATCH-TOTALS                          03620049
               PERFORM 2400-ACCUM-BATCH-TOTALS                          03630049
           END-IF.                                                      03640049
                                                                        03650049
           PERFORM 8400-READ-EXTRACT.                                   03660049
                                                                        03670049
22405  2200-ACCUM-STORE-TOTALS.                                         03680049
  |        ADD PV-APRD045-NET-CST-AMT TO PA-STR-COST.                   03690049
  |        ADD PV-APRD045-RTL-AMT  TO PA-STR-RTL.                       03700049
  |        ADD 1                   TO PA-STR-TXNS.                      03710049
  |        ADD 1                   TO PA-TOTAL-WRITE.                   03720049
22405                                                                   03730049
       2400-ACCUM-BATCH-TOTALS.                                         03740049
           ADD PV-APRD045-NET-CST-AMT TO PA-BATCH-COST                  03750049
                                      PA-TOTAL-COST.                    03760049
           ADD PV-APRD045-RTL-AMT  TO PA-BATCH-RTL                      03770049
                                      PA-TOTAL-RTL.                     03780049
           ADD 1                   TO PA-BATCH-TXNS.                    03790049
                                                                        03800049
22405  2600-PRINT-STORE-TOTALS.                                         03810049
22045 *-- PRINT HOLD STORE                                              03820050
W26601*    MOVE PV-APRD045-EFF-DTE  TO PV-EFF-DTE-TIME.                 03830050
W26601*    MOVE PV-EFF-DTE          TO DL1-POST-DTE.                    03840050
W26601     MOVE PV-HOLD-PROC-DTE    TO DL1-POST-DTE.                    03850050
22405      MOVE PV-HOLD-BATCH-NBR   TO DL1-BATCH-NBR.                   03860050
22405      MOVE PA-STR-TXNS         TO DL1-NBR-OF-PRICE-CHGS.           03870050
W26601*    MOVE TSTR000-STORE-NMBR  TO DL1-STR-NBR.                     03880049
W26601*    MOVE TSTR000-STORE-NAME  TO DL1-STR-NAME.                    03890049
W26601     MOVE PV-STR-NBR          TO DL1-STR-NBR.                     03900049
W26601     MOVE XMT00001-LOC-NM     TO DL1-STR-NAME.                    03910049
22405      MOVE PA-STR-RTL          TO DL1-RETAIL-AMT.                  03920050
  |        MOVE PA-STR-COST         TO DL1-COST-AMT.                    03930049
  |        PERFORM 5000-WRITE-REPORT-LINE                               03940049
  |                                                                     03950049
  |   *-- ACCUMULATE FOR CURRENT STORE                                  03960049
  |        MOVE PV-APRD045-RTL-AMT  TO PA-STR-RTL.                      03970049
  |        MOVE PV-APRD045-NET-CST-AMT TO PA-STR-COST.                  03980049
22405      MOVE AP045-STR-NBR       TO PV-HOLD-STR-NBR.                 03990050
W26601     MOVE PV-APRD045-EFF-DTE  TO PV-HOLD-PROC-DTE.                04000050
22405      MOVE 1                   TO PA-STR-TXNS.                     04010050
  |        PERFORM 7000-RETRIEVE-STORE-NAME.                            04020049
  |                                                                     04030049
  |        MOVE ZEROS              TO PA-TOTAL-WRITE.                   04040049
  |                                                                     04050049
  |    2800-PRINT-BATCH-TOTALS.                                         04060049
  |   *-- PRINT HOLD BATCH                                              04070049
  |        MOVE PV-HOLD-BATCH-NBR   TO PM-BATCH.                        04080049
  |        MOVE PM-TOTAL-BATCH      TO TL1-TOTAL-TYPE.                  04090049
  |        MOVE PA-BATCH-TXNS       TO TL1-NBR-OF-PRICE-CHGS.           04100049
  |        MOVE PA-BATCH-RTL        TO TL1-RETAIL-AMT.                  04110049
  |        MOVE PA-BATCH-COST       TO TL1-COST-AMT.                    04120049
  |        MOVE PC-ONE-LINE         TO PV-LINES.                        04130053
  |        PERFORM 5200-WRITE-TOTAL-LINE.                               04140049
  |                                                                     04150049
  |   *    MOVE PV-APRD045-EFF-DTE  TO PV-EFF-DTE-TIME.                 04160049
  |   *    MOVE PV-EFF-DTE          TO DL1-POST-DTE.                    04170049
  |   *    MOVE PV-HOLD-PROC-DTE    TO DL1-POST-DTE.                    04180049
  |   *    MOVE PV-HOLD-BATCH-NBR   TO DL1-BATCH-NBR.                   04190049
  |   *    MOVE PA-BATCH-TXNS       TO DL1-NBR-OF-PRICE-CHGS.           04200049
  |   *    MOVE TSTR000-STORE-NMBR  TO DL1-STR-NBR.                     04210049
  |   *    MOVE TSTR000-STORE-NAME  TO DL1-STR-NAME.                    04220049
  |   *    MOVE PA-BATCH-RTL        TO DL1-RETAIL-AMT.                  04230049
  |   *    MOVE PA-BATCH-COST       TO DL1-COST-AMT.                    04240049
  |   *    PERFORM 5000-WRITE-REPORT-LINE                               04250049
  |                                                                     04260049
  |        IF PA-LINE-NO > PC-MAX-LINES                                 04270049
  |            PERFORM 4000-WRITE-REPORT-HEADING                        04280049
  |        END-IF.                                                      04290049
  |                                                                     04300049
  |        MOVE SPACES         TO REPORT-RECORD.                        04310049
  |        WRITE REPORT-RECORD                                          04320049
  |            AFTER ADVANCING 1 LINES.                                 04330049
  |                                                                     04340049
  |        ADD 1               TO PA-LINE-NO.                           04350049
22405                                                                   04360049
      *-- ACCUMULATE FOR CURRENT BATCH                                  04370049
           MOVE 0                    TO PA-BATCH-TXNS.                  04380049
           MOVE 0                    TO PA-BATCH-RTL.                   04390049
           MOVE 0                    TO PA-BATCH-COST.                  04400049
           MOVE PV-APRD045-BATCH-NBR TO PV-HOLD-BATCH-NBR.              04410049
0301RM*    MOVE PV-APRD045-PROC-DTE  TO PV-HOLD-PROC-DTE.               04420050
W26601     MOVE PV-APRD045-EFF-DTE   TO PV-HOLD-PROC-DTE.               04430050
                                                                        04440049
       4000-WRITE-REPORT-HEADING.                                       04450049
      ******************************************************************04460049
      *   4000-WRITE-REPORT-HEADING                                    *04470049
      *      PRINT HEADING LINES                                       *04480049
      ******************************************************************04490049
                                                                        04500049
           MOVE 0                               TO PA-LINE-COUNT        04510049
           ADD 1                                TO PA-PAGE-COUNT.       04520049
           MOVE PA-PAGE-COUNT                   TO DP132O-PAGE-NUMBER.  04530049
           MOVE DP132O-STANDRD-HEADER-132-COLS  TO REPORT-RECORD.       04540049
           WRITE REPORT-RECORD                                          04550049
                   AFTER ADVANCING PAGE.                                04560049
                                                                        04570049
0301RM     MOVE RC-RPT-HEADING                  TO H2-HEADING-TITLE.    04580049
                                                                        04590049
           MOVE DA104-OPN-FSCL-MN-DTE          TO H2-FSCL-MN-END-DTE.   04600049
0301RM*    MOVE PC-DAK200-JOB                  TO H2-JOB-NAME.          04610049
0301RM     MOVE RC-JOB-NAME                    TO H2-JOB-NAME.          04620049
           MOVE H2-HEADING2                    TO REPORT-RECORD.        04630049
           WRITE REPORT-RECORD                                          04640049
                   AFTER ADVANCING 1 LINE.                              04650049
                                                                        04660049
           MOVE H3-HEADING3    TO REPORT-RECORD.                        04670049
           WRITE REPORT-RECORD                                          04680049
               AFTER ADVANCING 2 LINES.                                 04690049
                                                                        04700049
           MOVE H4-HEADING4    TO REPORT-RECORD.                        04710049
           WRITE REPORT-RECORD                                          04720049
               AFTER ADVANCING 1 LINES.                                 04730049
                                                                        04740049
           MOVE SPACES         TO REPORT-RECORD.                        04750049
           WRITE REPORT-RECORD                                          04760049
               AFTER ADVANCING 1 LINES.                                 04770049
                                                                        04780049
           MOVE 5              TO PA-LINE-NO.                           04790049
                                                                        04800049
       5000-WRITE-REPORT-LINE.                                          04810049
                                                                        04820049
           IF PA-LINE-NO > PC-MAX-LINES                                 04830049
               PERFORM 4000-WRITE-REPORT-HEADING                        04840049
           END-IF.                                                      04850049
                                                                        04860049
           WRITE REPORT-RECORD FROM DL1-DETAIL-LINE-1                   04870049
                  AFTER ADVANCING 1 LINES.                              04880049
           ADD 1 TO PA-LINE-NO.                                         04890049
                                                                        04900049
                                                                        04910049
       5200-WRITE-TOTAL-LINE.                                           04920049
                                                                        04930049
           IF PA-LINE-NO > PC-MAX-LINES                                 04940049
               PERFORM 4000-WRITE-REPORT-HEADING                        04950049
           END-IF.                                                      04960049
                                                                        04970049
           WRITE REPORT-RECORD FROM TL1-TOTAL-LINE-1                    04980049
                  AFTER ADVANCING PV-LINES LINES.                       04990049
           ADD PV-LINES TO PA-LINE-NO.                                  05000049
                                                                        05010049
                                                                        05020049
      ***************************************************************** 05030049
      * GET THE STORE NAME                                              05040049
      ***************************************************************** 05050049
       7000-RETRIEVE-STORE-NAME.                                        05060049
           MOVE AP045-STR-NBR TO PV-STR-NBR.                            05070049
           MOVE PV-STR-NBR    TO PV-STR-NBR-INT.                        05080049
                                                                        05090049
           PERFORM                                                      05100049
               WITH TEST AFTER                                          05110049
               VARYING PV-SQL-SUB FROM 1 BY 1                           05120049
               UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        05130049
                  OR SQLCODE = 0                                        05140049
                                                                        05150049
W26601*        EXEC SQL                                                 05160049
W26601*             SELECT STORE_NAME                                   05170049
W26601*                  , STORE_NMBR                                   05180049
W26601*             INTO  :TSTR000-STORE-NAME                           05190049
W26601*                  ,:TSTR000-STORE-NMBR                           05200049
W26601*             FROM   TSTR000                                      05210049
W26601*             WHERE  OP_CO_NMBR ='03'                             05220049
W26601*               AND  STORE_NMBR = :PV-STR-NBR-3-5                 05230049
W26601*        END-EXEC                                                 05240049
                                                                        05250049
W26601         EXEC SQL                                                 05260049
W26601              SELECT LOC_NM                                       05270049
W26601              INTO  :XMT00001-LOC-NM                              05280049
W26601              FROM   XMT_LOC                                      05290049
W26601              WHERE  LOC_NBR = :PV-STR-NBR-INT                    05300049
W26601         END-EXEC                                                 05310049
                                                                        05320049
               EVALUATE TRUE                                            05330049
                   WHEN SQLCODE = +100                                  05340049
                       DISPLAY '*** DAKRP102 ABEND ***'                 05350049
                       DISPLAY '**** NO MATCH FOR STORE '               05360049
                                                AP045-STR-NBR           05370049
                       DISPLAY ' **** ON DB2 STORE TABLE'               05380049
                       PERFORM 9999-ABEND                               05390049
                   WHEN SQLCODE = -904                                  05400049
                   WHEN SQLCODE = -911                                  05410049
                   WHEN SQLCODE = 0                                     05420049
                       CONTINUE                                         05430049
                   WHEN SQLWARN NOT = SPACES                            05440049
                   WHEN SQLCODE NOT = ZERO                              05450049
                       MOVE 'READING STORE TABLE'                       05460049
                                     TO  PV-DB2-OPER-ATTEMPTED          05470049
                       PERFORM 9999-ABEND                               05480049
               END-EVALUATE                                             05490049
           END-PERFORM.                                                 05500049
                                                                        05510049
           IF  PV-SQL-SUB > PC-MAX-RETRIES                              05520049
               MOVE 'READ RETRIES EXCEEDED'                             05530049
                                     TO  PV-DB2-OPER-ATTEMPTED          05540049
               PERFORM 9999-ABEND                                       05550049
           END-IF.                                                      05560049
                                                                        05570049
                                                                        05580049
      *----------------------------------------------------------------*05590049
      *  READ CONTROL CARD FILE                                         05600049
      *----------------------------------------------------------------*05610049
       8000-READ-CONTROL-CARD-FILE.                                     05620049
                                                                        05630049
           READ CONTROL-CARD-FILE INTO CC-CONTROL-CARD.                 05640049
                                                                        05650049
      *************************************************************     05660049
      *  8200-READ-DATE-FILE GETS THE FISCAL WEEK DATA            *     05670049
      *************************************************************     05680049
       8200-READ-DATE-FILE.                                             05690049
            READ IN-DATE-FILE INTO DARD104-RECORD.                      05700049
                                                                        05710049
       8400-READ-EXTRACT.                                               05720049
           READ AP-TRANS-FILE INTO AP045-TRANSACTION-FILE               05730049
           AT END                                                       05740049
               SET PS-EOF-EXTRACT           TO TRUE                     05750049
           NOT AT END                                                   05760049
               ADD 1                        TO PA-TOTAL-READ            05770049
           END-READ.                                                    05780049
                                                                        05790049
0301RM*------------------------------------------------------------*    05800049
0301RM*  READ REPORT CONTROL CARD FILE                             *    05810049
0301RM*------------------------------------------------------------*    05820049
0301RM 8600-READ-RPT-CTL-CARD-FILE.                                     05830049
0301RM     READ REPORT-CTL-CARD-FILE  INTO RC-CONTROL-CARD.             05840049
                                                                        05850049
      *************************************************************     05860049
      *  9000-EOJ IS PERFORMED FROM 0000-DAKRP102.                *     05870049
      *************************************************************     05880049
       9000-EOJ.                                                        05890049
                                                                        05900049
           IF PA-TOTAL-READ = ZERO                                      05910049
              WRITE REPORT-RECORD FROM PM-NO-INPUT-MSG                  05920049
                    AFTER ADVANCING 5 LINES                             05930049
           ELSE                                                         05940049
22405          PERFORM 2600-PRINT-STORE-TOTALS                          05950049
               PERFORM 2800-PRINT-BATCH-TOTALS                          05960049
               PERFORM 9200-WRITE-REPORT-TOTALS                         05970049
           END-IF.                                                      05980049
                                                                        05990049
           WRITE REPORT-RECORD FROM PM-END-RPT-MSG                      06000049
                AFTER ADVANCING 5 LINES                                 06010049
                                                                        06020049
           CLOSE AP-TRANS-FILE                                          06030049
                 CONTROL-CARD-FILE                                      06040049
                 REPORT-CTL-CARD-FILE                                   06050049
                 IN-DATE-FILE                                           06060049
                 REPORT-FILE.                                           06070049
                                                                        06080049
           DISPLAY SPACES.                                              06090049
           MOVE PA-TOTAL-READ        TO PV-DISP-NUMBER.                 06100049
           DISPLAY 'RECS READ    =    ' PV-DISP-NUMBER.                 06110049
                                                                        06120049
       9200-WRITE-REPORT-TOTALS.                                        06130049
           MOVE PM-TOTAL-CORP   TO TL1-TOTAL-TYPE.                      06140049
           MOVE PA-TOTAL-READ   TO TL1-NBR-OF-PRICE-CHGS.               06150049
           MOVE PA-TOTAL-RTL    TO TL1-RETAIL-AMT.                      06160049
           MOVE PA-TOTAL-COST   TO TL1-COST-AMT.                        06170049
           MOVE PC-THREE-LINES  TO PV-LINES.                            06180049
           PERFORM 5200-WRITE-TOTAL-LINE.                               06190049
                                                                        06200049
       9999-ABEND.                                                      06210049
      ******************************************************************06220049
      *   9999-ABEND.                                                  *06230049
      *      ERROR ABEND ROUTINE                                       *06240049
      ******************************************************************06250049
                                                                        06260049
           MOVE +4013                 TO ABEND-CODE.                    06270049
           DISPLAY '**  ABEND     **'.                                  06280049
           DISPLAY '**  PROGRAM   ** => ' PC-DAKRP102-PGM.              06290049
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH.                 06300049
           DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.        06310049
                                                                        06320049
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         06330049
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        06340049
                                                                        06350049
           COPY DPPD004.                                                06360049
           CALL 'ILBOABN0' USING ABEND-CODE.                            06370049
