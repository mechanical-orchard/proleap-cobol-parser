000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             BCKUT013.                                00050000
000600 AUTHOR.                 RICK TULLOCH.                            00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN.           11-07-19.                                00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*       THIS PROGRAM READS THROUGH A SORTED EMPLOYEE-SUPERVISOR  *00120012
001210*  FILE TO PREPARE A CSV OF THE SUPERVISOR HIERARCHY FOR A       *00121012
001211*  GIVEN EMPLOYEE, AND A FILE OF ALL DIRECT AND INDIRECT REPORTS *00121112
001212*  TO A GIVEN SUPERVISOR.  RELATIVE HIERARCHY LEVELS HIGHER THAN *00121212
001220*  THE MAXIMUM PERMITTED FOR BUSINESS CONTINUITY PURPOSES WILL   *00122012
001221*  NOT BE PROCESSED.                                             *00122112
001222*                                                                *00122212
001230*       THE EMPLOYEE-SUPERVISOR FILE MUST BE SORTED BY ASCENDING *00123012
001240*  EMPLOYEE'S EMPLOYEE ID AND SUPERVISOR HIERARCHY LEVEL.        *00124012
001300******************************************************************00130000
001400                                                                  00140000
001500******************************************************************00150000
001600 ENVIRONMENT DIVISION.                                            00160000
001700******************************************************************00170000
001800                                                                  00180000
001900 CONFIGURATION SECTION.                                           00190000
002000                                                                  00200000
002100 SOURCE-COMPUTER.        IBM-3090.                                00210000
002200 OBJECT-COMPUTER.        IBM-3090.                                00220000
002300                                                                  00230000
002400 INPUT-OUTPUT SECTION.                                            00240000
002500                                                                  00250000
002600 FILE-CONTROL.                                                    00260000
002700                                                                  00270000
002800     SELECT EMPLOYEE-SUPERVISOR-FILE                              00280001
002900         ASSIGN TO INP01.                                         00290000
003000                                                                  00300000
003100     SELECT CSV-SUPERVISOR-FILE                                   00310001
003200         ASSIGN TO OUT01.                                         00320000
003210                                                                  00321004
003220     SELECT SUPERVISOR-ALL-EMPL-FILE                              00322004
003230         ASSIGN TO OUT02.                                         00323006
003300                                                                  00330000
003400******************************************************************00340000
003500 DATA DIVISION.                                                   00350000
003600******************************************************************00360000
003700                                                                  00370000
003800 FILE SECTION.                                                    00380000
003900                                                                  00390000
004000 FD  EMPLOYEE-SUPERVISOR-FILE                                     00400001
004100     RECORDING MODE IS F                                          00410000
004200     LABEL RECORDS ARE STANDARD                                   00420000
004300     BLOCK CONTAINS 0 RECORDS                                     00430000
004400     RECORD CONTAINS 56 CHARACTERS                                00440001
004500     DATA RECORDS IS ES-EMPLOYEE-SUPERVISOR-RECORD.               00450001
004600                                                                  00460000
004700 01  ES-EMPLOYEE-SUPERVISOR-RECORD                                00470001
004710                                 PIC X(56).                       00471001
004800                                                                  00480000
004900 FD  CSV-SUPERVISOR-FILE                                          00490001
005000     RECORDING MODE IS F                                          00500000
005100     LABEL RECORDS ARE STANDARD                                   00510000
005200     BLOCK CONTAINS 0 RECORDS                                     00520000
005300     RECORD CONTAINS 109 CHARACTERS                               00530001
005400     DATA RECORDS IS CS-CSV-SUPERVISOR-RECORD.                    00540001
005500                                                                  00550000
005600 01  CS-CSV-SUPERVISOR-RECORD    PIC X(109).                      00560001
005610                                                                  00561004
005620 FD  SUPERVISOR-ALL-EMPL-FILE                                     00562004
005630     RECORDING MODE IS F                                          00563004
005640     LABEL RECORDS ARE STANDARD                                   00564004
005650     BLOCK CONTAINS 0 RECORDS                                     00565004
005660     RECORD CONTAINS 14 CHARACTERS                                00566004
005670     DATA RECORDS IS SA-SUPER-ALL-EMPL-RECORD.                    00567004
005680                                                                  00568004
005690 01  SA-SUPERVISOR-ALL-EMPL-RECORD                                00569004
005691                                 PIC X(14).                       00569104
005700                                                                  00570000
005800 WORKING-STORAGE SECTION.                                         00580000
006500                                                                  00650000
006600 01  ABEND-CODE                  PIC S9(04)   VALUE ZERO          00660000
006700                                              COMP SYNC.          00670000
006800                                                                  00680000
006900 01  PS-PROGRAM-SWITCHES.                                         00690000
007000     05  PS-END-OF-SUPER-FILE-SW                                  00700001
007100                                 PIC X(1)     VALUE 'N'.          00710000
007200         88  PS-END-OF-SUPER-FILE             VALUE 'Y'.          00720001
007300                                                                  00730000
007400 01  PC-PROGRAM-CONSTANTS.                                        00740000
007500     05  PC-CURRENT-PROGRAM-NAME PIC X(8)     VALUE 'BCKUT013'.   00750000
007510     05  PC-MAXIMUM-HIERARCHY-LEVELS                              00751001
007520                                 PIC S9(4)    VALUE +10           00752003
007530                                              COMP SYNC.          00753001
007600                                                                  00760000
007700 01  PV-PROGRAM-VARIABLES.                                        00770000
007800     05  PV-CURRENT-EMPLOYEE-ID  PIC X(7)     VALUE SPACES.       00780001
007900     05  PV-HIERARCHY-LEVEL      PIC S9(4)    VALUE ZEROS         00790001
007910                                              COMP SYNC.          00791001
013600                                                                  01360000
013610 01  SR-SUPERVISOR-RECORD.                                        01361001
013611     05  SR-EMPLOYEE-ID          PIC X(7)     VALUE SPACES.       01361101
013612     05  SR-SUPERVISOR-NAME      PIC X(40)    VALUE SPACES.       01361201
013620     05  SR-SUPERVISOR-EMPLOYEE-ID                                01362001
013630                                 PIC X(7)     VALUE SPACES.       01363001
013631     05  SR-SUPERVISOR-HIERARCHY-LEVEL                            01363101
013632                                 PIC X(2)     VALUE SPACES.       01363201
013633                                                                  01363301
013634 01  CH-CSV-HEADER-RECORD.                                        01363401
013635     05  FILLER                  PIC X(1)     VALUE '"'.          01363501
013636     05  FILLER                  PIC X(7)     VALUE 'EMP NBR'.    01363607
013637     05  FILLER                  PIC X(3)     VALUE '","'.        01363701
013638     05  FILLER                  PIC X(7)     VALUE 'MGRID01'.    01363801
013640     05  FILLER                  PIC X(3)     VALUE '","'.        01364001
013641     05  FILLER                  PIC X(7)     VALUE 'MGRID02'.    01364101
013642     05  FILLER                  PIC X(3)     VALUE '","'.        01364201
013643     05  FILLER                  PIC X(7)     VALUE 'MGRID03'.    01364301
013644     05  FILLER                  PIC X(3)     VALUE '","'.        01364401
013645     05  FILLER                  PIC X(7)     VALUE 'MGRID04'.    01364501
013646     05  FILLER                  PIC X(3)     VALUE '","'.        01364601
013647     05  FILLER                  PIC X(7)     VALUE 'MGRID05'.    01364701
013648     05  FILLER                  PIC X(3)     VALUE '","'.        01364801
013649     05  FILLER                  PIC X(7)     VALUE 'MGRID06'.    01364901
013650     05  FILLER                  PIC X(3)     VALUE '","'.        01365001
013651     05  FILLER                  PIC X(7)     VALUE 'MGRID07'.    01365101
013652     05  FILLER                  PIC X(3)     VALUE '","'.        01365201
013653     05  FILLER                  PIC X(7)     VALUE 'MGRID08'.    01365301
013654     05  FILLER                  PIC X(3)     VALUE '","'.        01365401
013655     05  FILLER                  PIC X(7)     VALUE 'MGRID09'.    01365501
013656     05  FILLER                  PIC X(3)     VALUE '","'.        01365601
013657     05  FILLER                  PIC X(7)     VALUE 'MGRID10'.    01365701
013658     05  FILLER                  PIC X(1)     VALUE '"'.          01365801
013659                                                                  01365901
013660 01  CD-CSV-DETAIL-RECORD.                                        01366001
013661     05  FILLER                  PIC X(1)     VALUE '"'.          01366101
013662     05  CD-EMPLOYEE-ID          PIC X(7)     VALUE SPACES.       01366201
013663     05  FILLER                  PIC X(3)     VALUE '","'.        01366301
013664     05  CD-SUPERVISOR-EMPLOYEE-ID-1                              01366401
013665                                 PIC X(7)     VALUE SPACES.       01366501
013666     05  FILLER                  PIC X(3)     VALUE '","'.        01366601
013667     05  CD-SUPERVISOR-EMPLOYEE-ID-2                              01366701
013668                                 PIC X(7)     VALUE SPACES.       01366801
013669     05  FILLER                  PIC X(3)     VALUE '","'.        01366901
013670     05  CD-SUPERVISOR-EMPLOYEE-ID-3                              01367001
013671                                 PIC X(7)     VALUE SPACES.       01367101
013672     05  FILLER                  PIC X(3)     VALUE '","'.        01367201
013673     05  CD-SUPERVISOR-EMPLOYEE-ID-4                              01367301
013674                                 PIC X(7)     VALUE SPACES.       01367401
013675     05  FILLER                  PIC X(3)     VALUE '","'.        01367501
013676     05  CD-SUPERVISOR-EMPLOYEE-ID-5                              01367601
013677                                 PIC X(7)     VALUE SPACES.       01367701
013678     05  FILLER                  PIC X(3)     VALUE '","'.        01367801
013679     05  CD-SUPERVISOR-EMPLOYEE-ID-6                              01367901
013680                                 PIC X(7)     VALUE SPACES.       01368001
013681     05  FILLER                  PIC X(3)     VALUE '","'.        01368101
013682     05  CD-SUPERVISOR-EMPLOYEE-ID-7                              01368201
013683                                 PIC X(7)     VALUE SPACES.       01368301
013684     05  FILLER                  PIC X(3)     VALUE '","'.        01368401
013685     05  CD-SUPERVISOR-EMPLOYEE-ID-8                              01368501
013686                                 PIC X(7)     VALUE SPACES.       01368601
013687     05  FILLER                  PIC X(3)     VALUE '","'.        01368701
013688     05  CD-SUPERVISOR-EMPLOYEE-ID-9                              01368801
013689                                 PIC X(7)     VALUE SPACES.       01368901
013690     05  FILLER                  PIC X(3)     VALUE '","'.        01369001
013691     05  CD-SUPERVISOR-EMPLOYEE-ID-10                             01369101
013692                                 PIC X(7)     VALUE SPACES.       01369201
013693     05  FILLER                  PIC X(1)     VALUE '"'.          01369301
013694 01  FILLER                      REDEFINES CD-CSV-DETAIL-RECORD.  01369401
013695     05  FILLER                  PIC X(9).                        01369501
013696     05  CD-SUPERVISOR-ENTRY     OCCURS 10 TIMES.                 01369601
013697         10  FILLER              PIC X(2).                        01369701
013698         10  CD-SUPERVISOR-EMPLOYEE-ID                            01369801
013699                                 PIC X(7).                        01369901
013700         10  FILLER              PIC X(1).                        01370001
013701                                                                  01370104
013702 01  AR-ALL-REPORTS-RECORD.                                       01370204
013703     05  AR-SUPERVISOR-EMPLOYEE-ID                                01370304
013704                                 PIC X(7)     VALUE SPACES.       01370405
013705     05  AR-EMPLOYEE-ID          PIC X(7)     VALUE SPACES.       01370505
013706                                                                  01370608
013707 01  PT-PROGRAM-TOTALS.                                           01370708
013710     05  PT-SUPERVISOR-RCDS-READ PIC S9(9)    VALUE ZEROS         01371008
013711                                              COMP-3.             01371108
013718     05  PT-CSV-RCDS-WRITTEN     PIC S9(9)    VALUE ZEROS         01371808
013719                                              COMP-3.             01371908
013720                                                                  01372008
013721 01  TD-TOTAL-DISPLAY-MESSAGE.                                    01372108
013722     05  TD-TOTAL-ID             PIC X(51)    VALUE SPACES.       01372208
013725         88  TD-SUPERVISOR-RCDS-READ-ID       VALUE               01372508
013726             'SUPERVISOR CSV RECORDS READ  . . . . . . . . . . .'.01372608
013731         88  TD-CSV-RCDS-WRITTEN-ID           VALUE               01373108
013732             'MERGED SUPERVISOR CSV RECORDS WRITTEN  . . . . . .'.01373208
013733     05  TD-TOTAL-AMOUNT         PIC ZZZ,ZZZ,ZZ9                  01373308
013734                                              VALUE ZEROS.        01373408
013735                                                                  01373501
013740******************************************************************01374001
013800 PROCEDURE DIVISION.                                              01380000
013900******************************************************************01390000
014000                                                                  01400000
014100 0000-MAINLINE.                                                   01410000
014200                                                                  01420000
014300     PERFORM 1000-INITIALIZE.                                     01430000
014400                                                                  01440000
014500     PERFORM 2000-PROCESS-EMPLOYEE                                01450001
014600         UNTIL PS-END-OF-SUPER-FILE.                              01460001
014810                                                                  01481009
014820     PERFORM 1500-DISPLAY-PROGRAM-TOTALS.                         01482009
014830                                                                  01483009
014840     PERFORM 9000-EOJ-ROUTINE.                                    01484009
014900                                                                  01490000
015000     GOBACK.                                                      01500000
015100                                                                  01510000
015200******************************************************************01520000
015300*  INITIALIZE FOR PROGRAM PROCESSING.  OPEN ALL FILES.  READ THE *01530000
015400*  THE FIRST SUPERVISOR HIERARCHY RECORD.  WRITE THE CSV         *01540001
015500*  SUPERVISOR HIERARCHY HEADER RECORD.                           *01550001
015600******************************************************************01560000
015700                                                                  01570000
015800 1000-INITIALIZE.                                                 01580000
015900     OPEN INPUT  EMPLOYEE-SUPERVISOR-FILE                         01590001
016000          OUTPUT CSV-SUPERVISOR-FILE                              01600004
016100                 SUPERVISOR-ALL-EMPL-FILE.                        01610004
016800                                                                  01680000
016900     PERFORM 7000-READ-EMPLOYEE-SUPER-FILE.                       01690001
017000                                                                  01700000
017010     PERFORM 8000-WRITE-CSV-HEADER-RECORD.                        01701001
017700*1000-EXIT.                                                       01770000
017710                                                                  01771008
017720******************************************************************01772008
017730*  DISPLAY SUMMARY TOTALS OF I/O ACTIVITY.                       *01773008
017740******************************************************************01774008
017750                                                                  01775008
017760 1500-DISPLAY-PROGRAM-TOTALS.                                     01776008
017793     SET TD-SUPERVISOR-RCDS-READ-ID TO TRUE.                      01779308
017794     MOVE PT-SUPERVISOR-RCDS-READ TO TD-TOTAL-AMOUNT.             01779408
017795     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - '                       01779508
017796               TD-TOTAL-DISPLAY-MESSAGE.                          01779608
017797                                                                  01779708
017798     SET TD-CSV-RCDS-WRITTEN-ID TO TRUE.                          01779808
017799     MOVE PT-CSV-RCDS-WRITTEN TO TD-TOTAL-AMOUNT.                 01779908
017800     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - '                       01780008
017801               TD-TOTAL-DISPLAY-MESSAGE.                          01780108
017802*1500-EXIT.                                                       01780208
017810                                                                  01781000
017900******************************************************************01790000
018000*  PROCESS AN EMPLOYEE.                                          *01800001
018100******************************************************************01810000
018200                                                                  01820000
018300 2000-PROCESS-EMPLOYEE.                                           01830001
018400     INITIALIZE CD-CSV-DETAIL-RECORD                              01840001
018500                PV-HIERARCHY-LEVEL.                               01850001
018600     MOVE SR-EMPLOYEE-ID TO PV-CURRENT-EMPLOYEE-ID                01860001
018700                            CD-EMPLOYEE-ID.                       01870001
018900                                                                  01890000
019700     PERFORM 3000-PROCESS-EMPLOYEE-SUPER                          01970001
019800         UNTIL ((PS-END-OF-SUPER-FILE)                            01980001
020100                 OR (SR-EMPLOYEE-ID NOT =                         02010001
020200                                  PV-CURRENT-EMPLOYEE-ID)).       02020001
020201                                                                  02020101
020210     PERFORM 8100-WRITE-CSV-DETAIL-RECORD.                        02021001
020300*2000-EXIT.                                                       02030000
020400                                                                  02040000
020500******************************************************************02050000
020600*  PROCESS AN EMPLOYEE SUPERVISOR HIERARCHY RECORD.  INCREMENT   *02060011
020610*  THE CURRENT HIERARCHY LEVEL.  THE LEVELS WILL BE RESEQUENCED  *02061011
020620*  IN CASE OF AN OPEN MANAGER POSITION, RATHER THAN USING THE    *02062011
020630*  PROVIDED LEVEL NUMBER.  DO NOT PROCESS ANY RELATIVE HIERARCHY *02063011
020640*  LEVELS HIGHER THAN THE MAXIMUM PERMITTED FOR BUSINESS         *02064011
020650*  CONTINUITY PURPOSES.  MOVE THE SUPERVISOR EMPLOYEE ID INTO    *02065011
020660*  THE RELATIVE SUPERVISOR EMPLOYEE ID FIELD FOR THE ASSOCIATE.  *02066011
020670*  CREATE AND WRITE AN ALL DIRECT AND INDIRECT REPORTS RECORD.   *02067011
020680*  READ THE NEXT EMPLOYEE SUPERVISOR HIERARCHY RECORD.           *02068011
020700******************************************************************02070000
020800                                                                  02080000
020900 3000-PROCESS-EMPLOYEE-SUPER.                                     02090001
020910     ADD +1 TO PV-HIERARCHY-LEVEL.                                02091001
020920                                                                  02092001
020930     IF (PV-HIERARCHY-LEVEL <= PC-MAXIMUM-HIERARCHY-LEVELS)       02093002
020940         MOVE SR-SUPERVISOR-EMPLOYEE-ID TO                        02094001
020950                   CD-SUPERVISOR-EMPLOYEE-ID (PV-HIERARCHY-LEVEL) 02095001
020951         INITIALIZE AR-ALL-REPORTS-RECORD                         02095104
020952         MOVE SR-SUPERVISOR-EMPLOYEE-ID TO                        02095204
020953                   AR-SUPERVISOR-EMPLOYEE-ID                      02095304
020954         MOVE PV-CURRENT-EMPLOYEE-ID TO AR-EMPLOYEE-ID            02095404
020955         PERFORM 8200-WRITE-SUPER-ALL-EMPL-RCD                    02095504
020960     END-IF.                                                      02096001
026000                                                                  02600000
026100     PERFORM 7000-READ-EMPLOYEE-SUPER-FILE.                       02610001
026200*3000-EXIT.                                                       02620000
026300                                                                  02630000
026400******************************************************************02640000
026500*  READ AN EMPLOYEE SUPERVISOR HIERARCHY RECORD, AND             *02650012
026510*  ACCUMULATE I/O TOTALS.                                        *02651012
026600******************************************************************02660000
026700                                                                  02670000
026800 7000-READ-EMPLOYEE-SUPER-FILE.                                   02680001
026900     READ EMPLOYEE-SUPERVISOR-FILE                                02690001
027000         INTO SR-SUPERVISOR-RECORD                                02700001
027100         AT END                                                   02710000
027200             SET PS-END-OF-SUPER-FILE TO TRUE                     02720001
027210             SUBTRACT +1 FROM PT-SUPERVISOR-RCDS-READ             02721008
027300     END-READ.                                                    02730000
027301                                                                  02730108
027310     ADD +1 TO PT-SUPERVISOR-RCDS-READ.                           02731008
027400*7000-EXIT.                                                       02740000
027500                                                                  02750000
027600******************************************************************02760000
027700*  WRITE A CSV SUPERVISOR HEADER RECORD, AND ACCUMULATE I/O      *02770012
027710*  TOTALS.                                                       *02771012
027800******************************************************************02780000
027900                                                                  02790000
028000 8000-WRITE-CSV-HEADER-RECORD.                                    02800001
028100     WRITE CS-CSV-SUPERVISOR-RECORD                               02810001
028110         FROM CH-CSV-HEADER-RECORD.                               02811001
028120                                                                  02812008
028130     ADD +1 TO PT-CSV-RCDS-WRITTEN.                               02813008
028200*8000-EXIT.                                                       02820000
028210                                                                  02821001
028220******************************************************************02822001
028230*  WRITE A CSV SUPERVISOR DETAIL RECORD, AND ACCUMULATE I/O      *02823012
028231*  TOTALS.                                                       *02823112
028240******************************************************************02824001
028250                                                                  02825001
028260 8100-WRITE-CSV-DETAIL-RECORD.                                    02826001
028270     WRITE CS-CSV-SUPERVISOR-RECORD                               02827001
028271         FROM CD-CSV-DETAIL-RECORD.                               02827101
028272                                                                  02827210
028273     ADD +1 TO PT-CSV-RCDS-WRITTEN.                               02827310
028280*8100-EXIT.                                                       02828001
028290                                                                  02829004
028291******************************************************************02829104
028292*  WRITE A SUPERVISOR TO DIRECT AND INDIRECT REPORTS RECORD, AND *02829212
028293*  ACCUMULATE I/O TOTALS.                                        *02829312
028294******************************************************************02829412
028295                                                                  02829512
028296 8200-WRITE-SUPER-ALL-EMPL-RCD.                                   02829612
028297     WRITE SA-SUPERVISOR-ALL-EMPL-RECORD                          02829712
028298         FROM AR-ALL-REPORTS-RECORD.                              02829812
028299*8200-EXIT.                                                       02829912
028300                                                                  02830000
028400******************************************************************02840000
028500*  CLOSE ALL FILES.                                              *02850000
028600******************************************************************02860000
028700                                                                  02870000
028800 9000-EOJ-ROUTINE.                                                02880000
028900     CLOSE EMPLOYEE-SUPERVISOR-FILE                               02890001
029000           CSV-SUPERVISOR-FILE                                    02900005
029010           SUPERVISOR-ALL-EMPL-FILE.                              02901004
029100*9000-EXIT.                                                       02910000
