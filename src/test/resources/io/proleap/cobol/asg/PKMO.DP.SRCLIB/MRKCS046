000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    MRKCS046.                                         00040000
000500 AUTHOR.        KOHLS DEPARTMENT STORES.                          00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  11-15-93.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    Y046 - MR-PTAGS BY STORE FOR A SKU                         * 00110001
001200*                                                               * 00120000
001300*    THIS PROGRAM IS THE LIST SCREEN FOR DISPLAYING PTAGS BY    * 00130001
001400*    STORE.                                                     * 00140001
001500*---------------------------------------------------------------* 00150000
001600******************************************************************00160010
001700* 08/09/01 - THERESE RAMSEYER - COMPUWARE   WR #21601            *00170010
001800*    - UPDATED PROGRAM FOR CHANGEOVER TO NI-SKU.                 *00180010
001900*    - INCREASED LENGTH OF DEPT, CLASS, AND SKU. ADDED SUBCLASS. *00190010
002000*    - CHANGED PROGRAM TO VALIDATE SUBCLASS.                     *00200010
002100*    - ADDED TSKXREF TABLE TO SQL STATEMENTS WHEN NECCESSARY     *00210010
002200*    - ELIMINATED WORKING STORAGE VARIABLES AND PARAGRAPHS FROM  *00220010
002300*      THE TEMPLATE THAT WERE NEVER REFERENCED.                  *00230010
002400*    - ELIMINATED SOME DOCUMENTATION THAT REFERRED TO THE        *00240010
002500*      SYSTEM MESSAGE SCREEN TEMPLATE, NOT THE CURRENT PROGRAM.  *00250010
002600*    - ADDED STANDARD RETRY LOGIC TO 4310- FETCH, 1300- VALIDATE *00260015
002700*      AND 1400- VALIDATE.                                        00270028
002800******************************************************************00280010
002810* 12/26/01 - NICK MOULTON                   WR #21601            *00290028
002820*    - CHANGED 1400-VALIDATE-SKU SO ONLY DEPT/SKU ARE REQUIRED.  *00300028
002830******************************************************************00310028
262436* CHANGED 10/12/2021    BY JIM HUNTER      WR: CHG0262436         00311029
262436* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00312029
262436* MAKING THE CALL DYNAMIC VS STATIC.                              00313029
262436******************************************************************00314029
CICS  * CHANGED 10/28/2022    BY JIM HUNTER      WR: CHG0277420         00315031
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00316031
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00317031
CICS  ******************************************************************00318031
002900 EJECT                                                            00320000
003000 ENVIRONMENT DIVISION.                                            00330000
003100                                                                  00340000
003200 DATA DIVISION.                                                   00350000
003300                                                                  00360000
003400 WORKING-STORAGE SECTION.                                         00370000
003500                                                                  00380000
003600 01  PC-PROGRAM-CONSTANTS.                                        00390000
003700     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00400000
003800                                                    'MR046A  '.   00410000
003900     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00420000
004000                                                    'MRKM046 '.   00430000
004100     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00440000
004200                                                    'MRKCS046'.   00450000
004300     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00460000
004400     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00470000
004500     05  PC-BY-SKU-REQUEST              PIC  X(01)  VALUE '1'.    00480000
004600     05  PC-BY-STORE-REQUEST            PIC  X(01)  VALUE '2'.    00490000
004700     05  PC-BY-PTAG-REQUEST             PIC  X(01)  VALUE '3'.    00500000
004800     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00510000
004900     05  PC-INTER-APPL-LIST             PIC  X(01)  VALUE '2'.    00520000
005000     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +15     00530000
005100                                                    COMP SYNC.    00540000
005200     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00550000
005300                                                    COMP SYNC.    00560000
005400     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00570000
005500                                                    +1000000      00580000
005600                                                    COMP-3.       00590000
005700     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00600000
005800                                                    COMP SYNC.    00610000
005900     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00620000
006000                                                    COMP-3.       00630000
006100     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00640000
006200     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00650000
006300     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00660000
006400     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00670000
006500     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00680000
006600*                                                                 00690000
006700     05  PC-TSYMSG-NUMBERS.                                       00700000
006800         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00710000
006900         10  PC-TSYMSG-00007            PIC  9(05)  VALUE 00007.  00720000
007000         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00730000
007100         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  00740000
007200         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00750000
007300         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00760000
007400         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00770000
007500         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00780000
007600         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00790000
007700         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00800000
007800         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00810000
007900         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00820000
008000         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00830000
008100         10  PC-TSYMSG-00073            PIC  9(05)  VALUE 00073.  00840000
008200         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00850000
008300         10  PC-TSYMSG-00110            PIC  9(05)  VALUE 00110.  00860000
008400         10  PC-TSYMSG-00146            PIC  9(05)  VALUE 00146.  00870000
008500         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  00880000
008600         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00890000
008700         10  PC-TSYMSG-00386            PIC  9(05)  VALUE 00386.  00900000
008800         10  PC-TSYMSG-00690            PIC  9(05)  VALUE 00690.  00910000
008900         10  PC-TSYMSG-00692            PIC  9(05)  VALUE 00692.  00920000
009000         10  PC-TSYMSG-00693            PIC  9(05)  VALUE 00693.  00930000
009100         10  PC-TSYMSG-00694            PIC  9(05)  VALUE 00694.  00940000
009200         10  PC-TSYMSG-00695            PIC  9(05)  VALUE 00695.  00950000
009300         10  PC-TSYMSG-00699            PIC  9(05)  VALUE 00699.  00960000
009310         10  PC-TSYMSG-02801            PIC  9(05)  VALUE 02801.  00970026
009320         10  PC-TSYMSG-02802            PIC  9(05)  VALUE 02802.  00980026
009330         10  PC-TSYMSG-02803            PIC  9(05)  VALUE 02803.  00990026
009400         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  01000000
009500*                                                                 01010000
009600 01  PS-PROGRAM-SWITCHES.                                         01020000
009700     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01030000
009800         88  PS-NO-ERROR                            VALUE 'Y'.    01040000
009900         88  PS-ERROR                               VALUE 'N'.    01050000
010000     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01060000
010100         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01070000
010200         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01080000
010300     05  PS-NO-DEPT-REC-SW              PIC  X(01)  VALUE 'N'.    01090000
010400         88  PS-NO-DEPT-REC                         VALUE 'Y'.    01100000
010500     05  PS-INVALID-SKU-SW              PIC  X(01)  VALUE 'N'.    01110000
010600         88  PS-INVALID-SKU                         VALUE 'N'.    01120000
010700         88  PS-VALID-SKU                           VALUE 'Y'.    01130000
010800*                                                                 01140000
010900 01  PV-PROGRAM-VARIABLES.                                        01150000
011000     05  PV-SQL-SUB                     PIC  S9(04) VALUE +0.     01160015
011100     05  PV-TYPE                        PIC  X(03).               01170000
011200     05  PV-PROCESS-DATE.                                         01180000
011300         10  PV-PROCESS-DATE-CENT       PIC  X(02).               01190000
011400         10  PV-PROCESS-DATE-YY         PIC  X(02).               01200000
011500         10  FILLER                     PIC  X(01) VALUE '-'.     01210000
011600         10  PV-PROCESS-DATE-MM         PIC  X(02).               01220000
011700         10  FILLER                     PIC  X(01) VALUE '-'.     01230000
011800         10  PV-PROCESS-DATE-DD         PIC  X(02).               01240000
011900     05  PV-PROCESS-DATE-R REDEFINES PV-PROCESS-DATE              01250000
012000                                        PIC  X(10).               01260000
012100     05  PV-DEPT-NUMBER-S               PIC S9(04)V COMP-3.       01270001
012200     05  PV-DEPT-NUMBER                 PIC  9(04).               01280001
012300     05  PV-DEPT-X         REDEFINES                              01290001
012400         PV-DEPT-NUMBER                 PIC  X(04).               01300001
012500     05  PV-DEPT-93                     PIC  9(03).               01310001
012600     05  PV-DEPT-X3                     PIC  X(03).               01320001
012700     05  PV-CLASS-NUMBER                PIC  9(04).               01330001
012800     05  PV-CLASS-X        REDEFINES                              01340001
012900         PV-CLASS-NUMBER                PIC  X(04).               01350001
012910     05  PV-CLASS-NUMBER-S              PIC S9(04) COMP-3.        01360023
013000     05  PV-SUBCLASS-NUMBER             PIC  9(04).               01370001
013100     05  PV-SUBCLASS-X     REDEFINES                              01380001
013200         PV-SUBCLASS-NUMBER             PIC  X(04).               01390001
013210     05  PV-SUBCLASS-NUMBER-S           PIC S9(04) COMP-3.        01400024
013300     05  PV-SUBCLASS-X3                 PIC  X(03).               01410004
013400     05  PV-SKU-NUMBER-S                PIC S9(08)V COMP-3.       01420001
013500     05  PV-SKU-NUMBER                  PIC  9(08).               01430001
013600     05  PV-CLASS-X2                    PIC  X(02).               01440007
013700     05  PV-PTAG                        PIC  X(07).               01450000
013800     05  PV-SKU-X3                      PIC  X(03).               01460000
013900     05  PV-SUB                         PIC S9(04)  VALUE +0      01470000
014000                                                    COMP SYNC.    01480000
014100     05  PV-CLASS-X3                    PIC  X(03).               01490000
014200     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01500000
014300                                                    COMP SYNC.    01510000
014400     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01520000
014500                                                    COMP-3.       01530000
014600     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01540000
014700                                                    COMP-3.       01550000
014800     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01560000
014900                                                    COMP-3.       01570000
015000     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01580000
015100                                                    COMP-3.       01590000
015200     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01600000
015300                                                    COMP-3.       01610000
015400     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01620000
015500                                                    COMP-3.       01630000
015600     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01640000
015700                                                    COMP-3.       01650000
015800     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01660000
015900                                                    COMP SYNC.    01670000
016000     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01680000
016100                                                    COMP SYNC.    01690000
016200     05  PV-ITEM                        PIC S9(04)  VALUE +0      01700000
016300                                                    COMP SYNC.    01710000
016400     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01720000
016500                                                    COMP SYNC.    01730000
016600     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01740000
016700                                                    COMP SYNC.    01750000
016800     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01760000
016900                                                    COMP SYNC.    01770000
017000     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01780000
017100                                                    COMP SYNC.    01790000
017200     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01800000
017300                                                    COMP SYNC.    01810000
017400     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01820000
017500                                                    COMP SYNC.    01830000
017600     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01840000
017700                                                    COMP SYNC.    01850000
017800     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01860000
017900                                                    COMP SYNC.    01870000
018000     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01880000
018100                                                    COMP SYNC.    01890000
018200     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01900000
018300                                                    COMP SYNC.    01910000
018400     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01920000
018500                                                    COMP SYNC.    01930000
018600     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01940000
018700                                                    COMP SYNC.    01950000
018800******************************************************************01960000
018900**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01970000
019000**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01980000
019100**  APPLICATION-SPECIFIC COMMAREA.                              **01990000
019200******************************************************************02000000
019300 01  LQW-LIST-QUEUE-WORK-AREA.                                    02010000
019400     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02020000
019500     05  LQW-ITEM-ENTRIES               OCCURS 15 TIMES           02030000
019600                                        INDEXED BY LQW-IDX.       02040000
019700         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)   COMP-3.      02050000
019800         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02060000
019900         10  LQW-SELECTED-SW            PIC  X(01).               02070000
020000             88  LQW-SELECT                         VALUE 'S'.    02080000
020100             88  LQW-DESELECT                       VALUE ' '.    02090000
020200         10  LQW-ACTION                 PIC  X(03).               02100000
020300         10  LQW-PTAG                   PIC  X(07).               02110000
020400         10  LQW-DEPT                   PIC  9(03).               02120001
020500         10  LQW-CLASS                  PIC  9(02).               02130001
020600         10  LQW-SCLASS                 PIC  9(02).               02140001
020700         10  LQW-SKU                    PIC  9(08).               02150001
020800         10  LQW-DESCRIPTION            PIC  X(23).               02160001
020900         10  LQW-SIZE                   PIC  X(05).               02170000
021000         10  LQW-COLOR                  PIC  X(04).               02180000
021100         10  LQW-STORE                  PIC  X(03).               02190000
021200                                                                  02200000
021300 01  ST-SYSTEM-TIME-AREA.                                         02210000
021400     05  ST-ABSTIME                PIC S9(16)  COMP.              02220000
021500     05  ST-TIME-EDIT.                                            02230000
021600         10  ST-TIME-HHMM          PIC X(05).                     02240000
021700         10  FILLER                PIC X(03).                     02250000
021800     05  ST-DATE                   PIC X(08).                     02260000
021900     05  FILLER  REDEFINES  ST-DATE.                              02270000
022000         10  ST-MM                 PIC XX.                        02280000
022100         10  FILLER                PIC X.                         02290000
022200         10  ST-DD                 PIC XX.                        02300000
022300         10  FILLER                PIC X.                         02310000
022400         10  ST-YY                 PIC XX.                        02320000
022500                                                                  02330000
022600                                                                  02340000
022700     EJECT                                                        02350000
022800*---------------------------------------------------------------* 02360000
022900*  RECORD LAYOUT FOR THE SELECTION TEMP STORAGE QUEUE.          * 02370014
023000*---------------------------------------------------------------* 02380000
023100                                                                  02390000
023200     COPY MRWS115.                                                02400000
023300                                                                  02410000
023400     EJECT                                                        02420000
023500*---------------------------------------------------------------* 02430000
023600*    MAP LAYOUT                                                 * 02440000
023700*---------------------------------------------------------------* 02450000
023800                                                                  02460000
023900     COPY MRKM046.                                                02470000
024000*                                                                 02480000
024100 01  MR-OCCURS-LAYOUT                   REDEFINES  MR046AO.       02490000
024200     05  FILLER                         PIC X(44).                02500000
024300     05  MR-SCROLL-AREA                 OCCURS 15 TIMES.          02510000
024400         10  MR-SELECTL                 PIC S9(04) COMP.          02520000
024500         10  MR-SELECTA                 PIC  X(01).               02530000
024600         10  MR-SELECTC                 PIC  X(01).               02540000
024700         10  MR-SELECTH                 PIC  X(01).               02550000
024800         10  MR-SELECTI                 PIC  X(01).               02560000
024900                                                                  02570000
025000         10  MR-ACTIONL                 PIC S9(04) COMP.          02580000
025100         10  MR-ACTIONA                 PIC  X(01).               02590000
025200         10  MR-ACTIONC                 PIC  X(01).               02600000
025300         10  MR-ACTIONH                 PIC  X(01).               02610000
025400         10  MR-ACTION                  PIC  X(03).               02620000
025500                                                                  02630000
025600         10  MR-PTAGL                   PIC S9(04) COMP.          02640000
025700         10  MR-PTAGA                   PIC  X(01).               02650000
025800         10  MR-PTAGC                   PIC  X(01).               02660000
025900         10  MR-PTAGH                   PIC  X(01).               02670000
026000         10  MR-PTAG                    PIC X(07).                02680000
026100                                                                  02690000
026200         10  MR-DEPTL                   PIC S9(04) COMP.          02700001
026300         10  MR-DEPTA                   PIC  X(01).               02710001
026400         10  MR-DEPTC                   PIC  X(01).               02720001
026500         10  MR-DEPTH                   PIC  X(01).               02730001
026600         10  MR-DEPT                    PIC  X(03).               02740001
026700                                                                  02750001
026800         10  MR-CLASSL                  PIC S9(04) COMP.          02760001
026900         10  MR-CLASSA                  PIC  X(01).               02770001
027000         10  MR-CLASSC                  PIC  X(01).               02780001
027100         10  MR-CLASSH                  PIC  X(01).               02790001
027200         10  MR-CLASS                   PIC  X(02).               02800001
027300                                                                  02810001
027400         10  MR-SCLASSL                 PIC S9(04) COMP.          02820001
027500         10  MR-SCLASSA                 PIC  X(01).               02830001
027600         10  MR-SCLASSC                 PIC  X(01).               02840001
027700         10  MR-SCLASSH                 PIC  X(01).               02850001
027800         10  MR-SCLASS                  PIC  X(02).               02860001
027900                                                                  02870001
028000         10  MR-SKUL                    PIC S9(04) COMP.          02880001
028100         10  MR-SKUA                    PIC  X(01).               02890001
028200         10  MR-SKUC                    PIC  X(01).               02900001
028300         10  MR-SKUH                    PIC  X(01).               02910001
028400         10  MR-SKU                     PIC  X(08).               02920001
028500                                                                  02930001
028600         10  MR-DESCRIPTIONL            PIC S9(04) COMP.          02940000
028700         10  MR-DESCRIPTIONA            PIC  X(01).               02950000
028800         10  MR-DESCRIPTIONC            PIC  X(01).               02960000
028900         10  MR-DESCRIPTIONH            PIC  X(01).               02970000
029000         10  MR-DESCRIPTION             PIC  X(23).               02980001
029100                                                                  02990000
029200         10  MR-SIZEL                   PIC S9(04) COMP.          03000000
029300         10  MR-SIZEA                   PIC  X(01).               03010000
029400         10  MR-SIZEC                   PIC  X(01).               03020000
029500         10  MR-SIZEH                   PIC  X(01).               03030000
029600         10  MR-SIZE                    PIC  X(05).               03040000
029700                                                                  03050000
029800         10  MR-COLORL                  PIC S9(04) COMP.          03060000
029900         10  MR-COLORA                  PIC  X(01).               03070000
030000         10  MR-COLORC                  PIC  X(01).               03080000
030100         10  MR-COLORH                  PIC  X(01).               03090000
030200         10  MR-COLOR                   PIC  X(04).               03100000
030300                                                                  03110000
030400         10  MR-STOREL                  PIC S9(04) COMP.          03120000
030500         10  MR-STOREA                  PIC  X(01).               03130000
030600         10  MR-STOREC                  PIC  X(01).               03140000
030700         10  MR-STOREH                  PIC  X(01).               03150000
030800         10  MR-STORE                   PIC  X(03).               03160000
030900     EJECT                                                        03170000
031000*---------------------------------------------------------------* 03180000
031100*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03190000
031200*---------------------------------------------------------------* 03200000
031300                                                                  03210000
031400     COPY DPWS015.                                                03220000
031500                                                                  03230000
031600*---------------------------------------------------------------* 03240000
031700*    FUNCTION KEYS COPYBOOK.                                    * 03250000
031800*---------------------------------------------------------------* 03260000
031900                                                                  03270000
032000     COPY DPWS016.                                                03280000
032100                                                                  03290000
032200*---------------------------------------------------------------* 03300000
032300*    NUMERIC EDIT LAYOUT.                                       * 03310000
032400*---------------------------------------------------------------* 03320000
032500                                                                  03330000
032600     COPY DPWS010I.                                               03340000
032700 EJECT                                                            03350000
032800*---------------------------------------------------------------* 03360000
032900*    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 03370031
033000*---------------------------------------------------------------* 03380000
033100                                                                  03390000
033200     COPY DPWS030.                                                03400000
CICS       COPY DPWS930.                                                03401031
033300 EJECT                                                            03410000
033400*---------------------------------------------------------------* 03420000
033500*    STANDARD COMMAREA.                                         * 03430000
033600*---------------------------------------------------------------* 03440000
033700                                                                  03450000
033800     COPY DPWS020.                                                03460000
033900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03470000
034000                                                                  03480000
034100*---------------------------------------------------------------* 03490000
034200* INTER-APPLICATION COMMAREA.                                   * 03500000
034300*   MRWS114 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 03510000
034400*             SPEC SCREEN.                                      * 03520000
034500*   MRWS102 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03530000
034600*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 03540000
034700*---------------------------------------------------------------* 03550000
034800                                                                  03560000
034900         10  INTER-APPL-COMM-AREA       PIC X(200).               03570000
035000     COPY MRWS114.                                                03580000
035100     COPY MRWS102.                                                03590000
035200*---------------------------------------------------------------* 03600000
035300*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03610000
035400*---------------------------------------------------------------* 03620000
035500         10  ASC-SPECIFIC-COMMAREA.                               03630000
035600             15  ASC-LIST-KEYS.                                   03640000
035700                 20  ASC-KEY-DEPT-N                  PIC  9(04).  03650001
035800                 20  ASC-KEY-DEPT          REDEFINES              03660001
035900                     ASC-KEY-DEPT-N                  PIC  X(04).  03670001
036000                 20  ASC-KEY-CLASS-N                 PIC  9(04).  03680001
036100                 20  ASC-KEY-CLASS         REDEFINES              03690001
036200                     ASC-KEY-CLASS-N                 PIC  X(04).  03700001
036300                 20  ASC-KEY-SUBCLASS-N              PIC  9(04).  03710001
036400                 20  ASC-KEY-SUBCLASS      REDEFINES              03720001
036500                     ASC-KEY-SUBCLASS-N              PIC  X(04).  03730001
036600                 20  ASC-KEY-SKU-N                   PIC  9(08).  03740001
036700                 20  ASC-KEY-SKU           REDEFINES              03750001
036800                     ASC-KEY-SKU-N                   PIC  X(08).  03760001
036900                 20  ASC-KEY-PTAG                    PIC  X(07).  03770000
037000             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03780000
037100                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03790000
037200                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03800000
037300                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03810000
037400                                                                  03820000
037500                 20  ASC-ITEM-ARRAY.                              03830000
037600                     25  ASC-ITEM-ENTRIES OCCURS 15 TIMES.        03840000
037700                         30  ASC-LIST-ITEM-NUMBER                 03850000
037800                                                     PIC S9(09)   03860000
037900                                                     COMP-3.      03870000
038000                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03880000
038100                             88  ASC-VALID-SELECT    VALUE ' '    03890000
038200                                                           'S'    03900000
038300                                                           'B'    03910000
038400                                                           'E'.   03920000
038500                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03930000
038600                             88  ASC-TEMP-SELECT     VALUE 'S'.   03940000
038700                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03950000
038800                             88  ASC-TEMP-END        VALUE 'E'.   03960000
038900                         30  ASC-SELECTED-SW         PIC  X(01).  03970000
039000                             88  ASC-NO-SELECT       VALUE ' '.   03980000
039100                             88  ASC-SELECT          VALUE 'S'.   03990000
039200                             88  ASC-BEGIN           VALUE 'B'.   04000000
039300                             88  ASC-END             VALUE 'E'.   04010000
039400                         30  ASC-ACTION              PIC  X(03).  04020000
039500                         30  ASC-PTAG                PIC  X(07).  04030000
039600                         30  ASC-DEPT                PIC  9(03).  04040001
039700                         30  ASC-CLASS               PIC  9(02).  04050001
039800                         30  ASC-SUBCLASS            PIC  9(02).  04060001
039900                         30  ASC-SKU                 PIC  9(08).  04070001
040000                         30  ASC-DESCRIPTION         PIC  X(23).  04080001
040100                         30  ASC-SIZE                PIC  X(05).  04090000
040200                         30  ASC-COLOR               PIC  X(04).  04100000
040300                         30  ASC-STORE               PIC  X(03).  04110000
040400                                                                  04120000
040500             15  ASC-BLK-SUB                         PIC S9(04)   04130000
040600                                                          COMP    04140000
040700                                                          SYNC.   04150000
040800             15  ASC-ITEM-SUB                        PIC S9(04)   04160000
040900                                                          COMP    04170000
041000                                                          SYNC.   04180000
041100             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   04190000
041200                                                          COMP-3. 04200000
041300             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   04210000
041400                                                          COMP-3. 04220000
041500             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   04230000
041600                                                          COMP-3. 04240000
041700             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   04250000
041800                                                          COMP-3. 04260000
041900             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   04270000
042000                                                          COMP-3. 04280000
042100             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   04290000
042200                                                          COMP-3. 04300000
042300             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   04310000
042400                                                          COMP    04320000
042500                                                          SYNC.   04330000
042600             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   04340000
042700                                                          COMP-3. 04350000
042800             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   04360008
042900                                                          COMP-3. 04370008
043000             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  04380008
043100                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   04390008
043200                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   04400008
043300             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  04410000
043400                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   04420000
043500                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   04430000
043600             15  ASC-LIST-QUEUE-NAME.                             04440000
043700                 20  ASC-LIST-TERM-ID                PIC  X(04).  04450000
043800                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04460000
043900                                                          COMP-3. 04470000
044000                 20  ASC-LIST-SEQ                    PIC  9(01).  04480000
044100             15  ASC-SEL-QUEUE-NAME.                              04490000
044200                 20  ASC-SEL-TERM-ID                 PIC  X(04).  04500000
044300                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   04510000
044400                                                          COMP-3. 04520000
044500                 20  ASC-SEL-SEQ                     PIC  9(01).  04530000
044600             15  ASC-SEL-SUB                         PIC S9(04)   04540000
044700                                                          COMP.   04550000
044800             15  ASC-SEL-ITEM                        PIC S9(04)   04560000
044900                                                          COMP.   04570000
045000                                                                  04580000
045100             15  ASC-START-ITEM-REQUEST.                          04590000
045200                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04600000
045300             15  FILLER                              PIC  X(10).  04610016
045400                                                                  04620016
045500     EJECT                                                        04630000
045600*---------------------------------------------------------------* 04640000
045700*    ABEND PROCESSING COPYBOOK.                                 * 04650000
045800*---------------------------------------------------------------* 04660000
045900                                                                  04670000
046000     COPY DPWS013.                                                04680000
046100                                                                  04690000
046200 EJECT                                                            04700000
046300*---------------------------------------------------------------* 04710000
046400*    DB2 AREA FOR TMDSEAR                                       * 04720000
046500*---------------------------------------------------------------* 04730000
046600     EXEC SQL                                                     04740000
046700         INCLUDE TMDSEAR                                          04750000
046800     END-EXEC.                                                    04760000
046900                                                                  04770000
047000******************************************************************04780001
047100* MRNIS-RFC      PREVIOUS   NOT INCLUDED                          04790001
047200* MRNIS-RFC      CURRENT    DCLGEN FOR TSKXREF                    04800001
047300* MRNIS-RFC      FUTURE     REMOVE WHEN TSKXREF NO LONGER NEEDED  04810001
047400******************************************************************04820001
047500*---------------------------------------------------------------* 04830001
047600*    DB2 AREA FOR TSKXREF                                       * 04840001
047700*---------------------------------------------------------------* 04850001
047800     EXEC SQL                                                     04860001
047900         INCLUDE TSKXREF                                          04870001
048000     END-EXEC.                                                    04880001
048100                                                                  04890001
048200*---------------------------------------------------------------* 04900000
048300*    DB2 AREA FOR TSK                                           * 04910000
048400*---------------------------------------------------------------* 04920000
048500     EXEC SQL                                                     04930000
048600          INCLUDE TSK                                             04940000
048700     END-EXEC.                                                    04950000
048800*---------------------------------------------------------------* 04960000
048900*    DB2 AREA FOR TMRITST                                       * 04970000
049000*---------------------------------------------------------------* 04980000
049100     EXEC SQL                                                     04990000
049200          INCLUDE TMRITST                                         05000000
049300     END-EXEC.                                                    05010000
049400*---------------------------------------------------------------* 05020000
049500*    DB2 AREA FOR COMMUNICATIONS                                * 05030000
049600*---------------------------------------------------------------* 05040000
049700     EXEC SQL                                                     05050000
049800          INCLUDE SQLCA                                           05060000
049900     END-EXEC.                                                    05070000
050000                                                                  05080000
050100******************************************************************05090009
050200* MRNIS-RFC   PREVIOUS   NOT INCLUDED                             05100009
050300* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS, SKU FROM TSKXREF  05110009
050400* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 05120009
050500******************************************************************05130009
050600*---------------------------------------------------------------* 05140000
050700*    PTAG-BY-STORE CURSOR                                       * 05150000
050800*---------------------------------------------------------------* 05160000
050900                                                                  05170000
051000     EXEC SQL                                                     05180000
051100          DECLARE PTAG-BY-STORE CURSOR                            05190000
051200          FOR SELECT DISTINCT                                     05200000
051300                A.PTAG_ID                                         05210000
051400              , X.DEPT                                            05220001
051500              , X.CLASS                                           05230001
051600              , X.SUBCLASS                                        05240001
051700              , X.SKU                                             05250001
051800              , B.SKU_DESC                                        05260000
051900              , B.SIZE_DESC                                       05270000
052000              , B.COLOR_DESC                                      05280000
052100              , A.STR_NBR                                         05290000
052200              , A.ITEM_NBR                                        05300000
052300          FROM                                                    05310000
052400                TMRITST  A                                        05320000
052500              , TSK      B                                        05330000
052600              , TSKXREF  X                                        05340001
052700          WHERE                                                   05350000
052800                A.ITEM_NBR            = B.ITEM_NMBR               05360000
052900           AND  B.ITEM_NMBR           = X.ITM_NBR                 05370003
053000           AND  X.SKU                 = :PV-SKU-NUMBER-S          05380001
053100          ORDER BY                                                05390000
053200                A.PTAG_ID                                         05400000
053300     END-EXEC.                                                    05410000
053400                                                                  05420000
053500                                                                  05430000
053600 EJECT                                                            05440000
053700 LINKAGE SECTION.                                                 05450000
053800                                                                  05460000
053900 01  DFHCOMMAREA.                                                 05470000
054000     05  FILLER                         OCCURS  1 TO 4072 TIMES   05480000
054100                                        DEPENDING ON EIBCALEN.    05490000
054200         10  FILLER                     PIC X.                    05500000
054300                                                                  05510000
054400 EJECT                                                            05520000
054500 PROCEDURE DIVISION.                                              05530000
054600******************************************************************05540000
054700**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **05550000
054800**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **05560000
054900**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **05570000
055000******************************************************************05580000
055100 0000-MAIN-MODULE.                                                05590000
055200     INITIALIZE DP030-CICS-API-FIELDS.                            05600000
055300     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05610000
055400     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05620000
055500     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05630000
055600     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05640000
055700     MOVE LENGTH OF MR046AI        TO DP030-MAP-LENGTH (1).       05650000
055800     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05660000
055900     PERFORM 0001-CALL-CICS-ARCH-API.                             05670000
056000     PERFORM 0500-PREPARE-DATE-MODULE.                            05680000
056100*                                                                 05690000
056200     PERFORM 1000-CONTROL-PROCESSING                              05700000
056300*                                                                 05710000
056400     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05720000
056500     PERFORM 0001-CALL-CICS-ARCH-API.                             05730000
056600                                                                  05740000
056700******************************************************************05750000
056800**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **05760000
056900**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **05770000
057000******************************************************************05780000
057100 0001-CALL-CICS-ARCH-API.                                         05790000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05800031
057300                                    DFHCOMMAREA                   05810031
057400                                    DP030-CICS-API-FIELDS         05820031
057500                                    DP020-STANDARD-COMMAREA       05830031
057600                                    MR046AI.                      05840031
057700*                                                                 05850000
057800     IF  DP030-RC-CALL-SUCCESSFUL                                 05860000
057900         CONTINUE                                                 05870000
058000     ELSE                                                         05880000
058100         SET DP013-NO-ROLLBACK                                    05890000
058200             DP013-XCTL-DISPLAY-RESTART                           05900000
058300             DP013-CICS-ABEND      TO TRUE                        05910000
058400         MOVE '0001-CALL-CICS-ARCH-API'                           05920000
058500                                   TO DP013-PARAGRAPH             05930000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05931031
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05932031
058800         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05960000
058900         PERFORM DP013-0000-PROCESS-ABEND                         05970000
059000     END-IF.                                                      05980000
059100                                                                  05990000
059200 0500-PREPARE-DATE-MODULE.                                        06000000
059300*----------------------------------------------------------------*06010000
059400*                                                                *06020000
059500*     LOAD THE CURRENT DATE TO A WORK AREA.                      *06030000
059600*                                                                *06040000
059700*----------------------------------------------------------------*06050000
059800                                                                  06060000
059900     EXEC CICS ASKTIME                                            06070000
060000               ABSTIME(ST-ABSTIME)                                06080000
060100     END-EXEC.                                                    06090000
060200                                                                  06100000
060300     EXEC CICS FORMATTIME                                         06110000
060400               ABSTIME (ST-ABSTIME)                               06120000
060500               MMDDYY  (ST-DATE)                                  06130000
060600               DATESEP                                            06140000
060700               TIME    (ST-TIME-EDIT)                             06150000
060800               TIMESEP                                            06160000
060900     END-EXEC.                                                    06170000
061000                                                                  06180000
061100     MOVE ST-MM                    TO  PV-PROCESS-DATE-MM.        06190000
061200     MOVE ST-DD                    TO  PV-PROCESS-DATE-DD.        06200000
061300     MOVE ST-YY                    TO  PV-PROCESS-DATE-YY.        06210000
061400                                                                  06220000
061500     IF ST-YY > 90                                                06230000
061600         MOVE 19                 TO PV-PROCESS-DATE-CENT          06240000
061700     ELSE                                                         06250000
061800         MOVE 20                 TO PV-PROCESS-DATE-CENT          06260000
061900     END-IF.                                                      06270000
062000                                                                  06280000
062100                                                                  06290000
062200*----------------------------------------------------------------*06300000
062300* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06310000
062400* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06320000
062500*                                                                *06330000
062600* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *06340000
062700*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *06350000
062800*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *06360000
062900*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *06370000
063000*----------------------------------------------------------------*06380000
063100                                                                  06390000
063200 1000-CONTROL-PROCESSING.                                         06400000
063300                                                                  06410000
063400     EVALUATE TRUE                                                06420000
063500         WHEN DP020-NEXT-ACT-INITIAL                              06430000
063600             INITIALIZE ASC-SPECIFIC-COMMAREA                     06440000
063700             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06450000
063800                                      ASC-SEL-TERM-ID             06460000
063900             MOVE DP020-SRC-TASK-NUMBER                           06470000
064000                                   TO ASC-LIST-TASK-NUMBER        06480000
064100                                      ASC-SEL-TASK-NUMBER         06490000
064200             MOVE PC-LIST-QUEUE-SEQ                               06500000
064300                                   TO ASC-LIST-SEQ                06510000
064400             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 06520000
064500             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06530000
064600***-----$TEMPLATE NOTE$-------------------------------------------06540000
064700*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,06550000
064800*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  06560000
064900*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.06570000
065000***---------------------------------------------------------------06580000
065100             IF  PS-COMMAREA-NOT-VALID                            06590000
065200                 SET DP020-MSG-FATAL                              06600000
065300                                   TO TRUE                        06610000
065400                 SET DP020-NEXT-ACT-APPL-ERROR                    06620000
065500                                   TO TRUE                        06630000
065600             ELSE                                                 06640000
065700                 PERFORM 4000-BUILD-INITIAL-PANEL                 06650000
065800             END-IF                                               06660000
065900                                                                  06670000
066000         WHEN DP020-NEXT-ACT-READ-MAP                             06680000
066100             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06690000
066200                                   TO PV-TOP-ITEM                 06700000
066300             PERFORM 2000-PROCESS-PANEL                           06710000
066400                                                                  06720000
066500         WHEN DP020-NEXT-ACT-RETURN                               06730000
066600             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06740000
066700                                   TO PV-TOP-ITEM                 06750000
066800             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06760000
066900             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 06770000
067000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06780000
067100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06790000
067200                                                                  06800000
067300         WHEN OTHER                                               06810000
067400             SET DP013-LOGIC-ABEND TO TRUE                        06820000
067500             SET DP013-NO-ROLLBACK TO TRUE                        06830000
067600             MOVE '1000-CONTROL-PROCESSING'                       06840000
067700                                   TO DP013-PARAGRAPH             06850000
067800             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06860000
067900                                   TO DP013-MESSAGE-TEXT(1)       06870000
068000             PERFORM DP013-0000-PROCESS-ABEND                     06880000
068100     END-EVALUATE.                                                06890000
068200                                                                  06900000
068300 EJECT                                                            06910000
068400*----------------------------------------------------------------*06920000
068500* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06930000
068600* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06940000
068700*----------------------------------------------------------------*06950000
068800                                                                  06960000
068900 1100-PROCESS-INTER-APPL-COMM.                                    06970000
069000                                                                  06980000
069100     SET PS-COMMAREA-VALID         TO TRUE.                       06990000
069200     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     07000000
069300     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          07010000
069400         PERFORM 1200-EDIT-COMMAREA                               07020000
069500         IF PS-COMMAREA-VALID                                     07030000
069600             MOVE MR114-DEPT           TO ASC-KEY-DEPT-N          07040001
069700             MOVE MR114-CLASS          TO ASC-KEY-CLASS-N         07050001
069800             MOVE MR114-SUBCLASS       TO ASC-KEY-SUBCLASS-N      07060001
069900             MOVE MR114-SKU            TO ASC-KEY-SKU-N           07070001
070000         END-IF                                                   07080000
070100     ELSE                                                         07090000
070200         IF  DP020-INT-APPL-FORMAT-IND = PC-INTER-APPL-LIST       07100000
070300             MOVE MR102-NUMBER-OF-SELECTED-ITEMS                  07110000
070400                                   TO ASC-NUMBER-OF-SELECTED-ITEMS07120000
070500             MOVE MR102-NUMBER-OF-TS-ITEMS                        07130000
070600                                   TO ASC-NUMBER-OF-TS-ITEMS      07140000
070700             MOVE MR102-SEL-QUEUE-NAME                            07150000
070800                                   TO ASC-SEL-QUEUE-NAME          07160000
070900             PERFORM 1120-PREPARE-LIST-ENTRY                      07170000
071000             MOVE MR114-DEPT           TO ASC-KEY-DEPT            07180001
071100             MOVE MR114-CLASS          TO ASC-KEY-CLASS           07190001
071200             MOVE MR114-SUBCLASS       TO ASC-KEY-SUBCLASS        07200001
071300             MOVE MR114-SKU            TO ASC-KEY-SKU             07210001
071400         ELSE                                                     07220000
071500             MOVE PC-TSYMSG-00148                                 07230000
071600                               TO DP020-MSG-NUMBER                07240000
071700             SET DP020-MSG-FATAL                                  07250000
071800                 DP020-NEXT-ACT-APPL-ERROR                        07260000
071900                               TO TRUE.                           07270000
072000                                                                  07280000
072100*----------------------------------------------------------------*07290000
072200* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *07300000
072300* STORAGE QUEUE PASSED FROM THE LIST.                            *07310000
072400*----------------------------------------------------------------*07320000
072500 1120-PREPARE-LIST-ENTRY.                                         07330000
072600     MOVE MR115-MAX-ITEMS          TO ASC-SEL-SUB.                07340000
072700     MOVE ZERO                     TO ASC-SEL-ITEM                07350000
072800                                      PV-SEL-QUEUE-ITEM.          07360000
072900     PERFORM 1130-GET-NEXT-MESSAGE.                               07370000
073000                                                                  07380000
073100 1130-GET-NEXT-MESSAGE.                                           07390000
073200     ADD +1                        TO ASC-SEL-SUB.                07400000
073300     IF  ASC-SEL-SUB > MR115-MAX-ITEMS                            07410000
073400         ADD +1                    TO PV-SEL-QUEUE-ITEM           07420000
073500         MOVE +1                   TO ASC-SEL-SUB                 07430000
073600     END-IF.                                                      07440000
073700     IF  PV-SEL-QUEUE-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS           07450000
073800         PERFORM 6105-READ-SEL-QUEUE                              07460000
073900         SET MR115-IDX TO ASC-SEL-SUB                             07470000
074000         IF  MR115-ITEM (MR115-IDX) > ZERO                        07480000
074100             MOVE MR115-SKU (MR115-IDX) TO MR114-SKU              07490022
074400             MOVE PV-DEPT-NUMBER        TO MR114-DEPT             07500022
074500             MOVE PV-CLASS-NUMBER       TO MR114-CLASS            07510022
074600             MOVE PV-SUBCLASS-NUMBER    TO MR114-CLASS            07520022
074700             MOVE MR115-PTAG (MR115-IDX)                          07530000
074800                                   TO MR114-PTAG                  07540000
074900             PERFORM 9200-REWRITE-LIST-QUEUE                      07550000
075000         ELSE                                                     07560000
075100             SUBTRACT +1 FROM ASC-SEL-SUB                         07570000
075200*            --- BOTTOM OF LIST ---                               07580000
075300             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07590000
075400             SET DP020-MSG-INFORMATIONAL                          07600000
075500                                   TO TRUE                        07610000
075600         END-IF                                                   07620000
075700     ELSE                                                         07630000
075800         SUBTRACT +1 FROM PV-SEL-QUEUE-ITEM                       07640000
075900         MOVE MR115-MAX-ITEMS      TO ASC-SEL-SUB                 07650000
076000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07660000
076100         SET DP020-MSG-INFORMATIONAL                              07670000
076200                                   TO TRUE                        07680000
076300     END-IF.                                                      07690000
076400                                                                  07700000
076500***************************************************************** 07710019
076600*  ONLY DEPT AND SKU ARE REQUIRED. IF SCL IS ENTERED, THEN MCL IS 07720020
076700*  REQUIRED.                                                      07730020
076800***************************************************************** 07740019
076900 1200-EDIT-COMMAREA.                                              07750000
077000                                                                  07760001
077100************                                                      07770020
077200* DEPT EDITS                                                      07780020
077300************                                                      07790020
077400                                                                  07800020
077500     IF  MR114-DEPT      > SPACE                                  07810020
077600         MOVE MR114-DEPT           TO DP010I-UNEDITED-FIELD       07820020
077700         MOVE LENGTH OF MR114-DEPT TO DP010I-MAXIMUM-DIGITS       07830020
077800         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     07840020
077900         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  07850020
262436         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07861029
262436              USING DP010I-NUMERIC-EDIT-AREA                      07862029
078100         IF  DP010I-ERROR-DETECTED                                07870020
078200             SET PS-COMMAREA-NOT-VALID  TO TRUE                   07880020
078300*  DEPT MUST BE NUMERIC                                           07890020
078400             MOVE PC-TSYMSG-00690       TO DP020-MSG-NUMBER       07900020
078500         ELSE                                                     07910020
078600             MOVE DP010I-NUMERIC-FIELD TO PV-DEPT-93              07920020
078700             MOVE PV-DEPT-93           TO MR114-DEPT (2:3)        07930020
078800         END-IF                                                   07940020
078900     ELSE                                                         07950020
079000         SET PS-COMMAREA-NOT-VALID     TO TRUE                    07960020
079100*  DEPT AND SKU ARE REQUIRED                                      07970026
079200         MOVE PC-TSYMSG-02802  TO DP020-MSG-NUMBER                07980026
079300     END-IF.                                                      07990020
079400                                                                  08000020
079500************                                                      08010020
079600* SKU EDITS                                                       08020020
079700************                                                      08030020
079800                                                                  08040020
079900     IF  MR114-SKU       > SPACE                                  08050001
080000         MOVE MR114-SKU            TO DP010I-UNEDITED-FIELD       08060001
080100         MOVE LENGTH OF MR114-SKU TO DP010I-MAXIMUM-DIGITS        08070001
080200         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     08080000
080300         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  08090000
262436         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08101029
262436              USING DP010I-NUMERIC-EDIT-AREA                      08102029
080500         IF  DP010I-ERROR-DETECTED                                08110000
080600             SET PS-COMMAREA-NOT-VALID TO TRUE                    08120000
080700* SKU MUST BE NUMERIC                                             08130000
080800             MOVE PC-TSYMSG-00695                                 08140000
080900                               TO DP020-MSG-NUMBER                08150000
081000         ELSE                                                     08160000
081100             MOVE DP010I-NUMERIC-FIELD                            08170000
081200                                   TO PV-SKU-NUMBER               08180001
081300             MOVE PV-SKU-NUMBER    TO MR114-SKU                   08190001
081400         END-IF                                                   08200000
081500     ELSE                                                         08210000
081600         SET PS-COMMAREA-NOT-VALID TO TRUE                        08220000
081700*  DEPT AND SKU ARE REQUIRED                                      08230026
081800         MOVE PC-TSYMSG-02802  TO DP020-MSG-NUMBER                08240026
081900     END-IF.                                                      08250001
082000                                                                  08260000
082100************                                                      08270020
082200* MCL EDITS                                                       08280020
082300************                                                      08290020
082400                                                                  08300020
082500     IF  MR114-CLASS     > SPACE                                  08310020
082600         MOVE MR114-CLASS          TO DP010I-UNEDITED-FIELD       08320020
082700         MOVE LENGTH OF MR114-CLASS TO DP010I-MAXIMUM-DIGITS      08330020
082800         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     08340020
082900         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  08350020
262436         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08361029
262436              USING DP010I-NUMERIC-EDIT-AREA                      08362029
083100         IF  DP010I-ERROR-DETECTED                                08370020
083200             SET PS-COMMAREA-NOT-VALID   TO TRUE                  08380020
083300* MAJOR CLASS MUST BE NUMERIC                                     08390020
083400             MOVE PC-TSYMSG-00692        TO DP020-MSG-NUMBER      08400020
083500         ELSE                                                     08410027
083600            MOVE DP010I-NUMERIC-FIELD   TO PV-CLASS-NUMBER        08420020
083700            MOVE PV-CLASS-X             TO MR114-CLASS            08430020
083800            MOVE MR114-CLASS (3:2)      TO PV-CLASS-X2            08440020
083900* VALIDATE CALL WILL BE GOING DOWN TO THE MAJOR CLASS LEVEL       08450020
084000            MOVE 'MCL'                  TO PV-TYPE                08460020
084100         END-IF                                                   08470027
084200     ELSE                                                         08480020
084300* VALIDATE CALL WILL BE GOING DOWN TO THE DPT LEVEL BECAUSE       08490020
084400* A CLASS WAS NOT ENTERED                                         08500020
084500        MOVE 'DPT'                      TO PV-TYPE                08510020
084600        MOVE '%%'                       TO PV-CLASS-X2            08520020
084700        MOVE '%%%'                      TO PV-SUBCLASS-X3         08530020
084800     END-IF.                                                      08540020
084900                                                                  08550020
084910* MCL & SCL ARE OPTIONAL, BUT IF SCL IS ENTERED, THEN MCL IS      08560021
084911* REQUIRED.                                                       08570021
084920                                                                  08580021
085000     IF MR114-SUBCLASS > SPACE AND                                08590021
085100        MR114-CLASS = SPACE                                       08600021
085200        SET PS-COMMAREA-NOT-VALID   TO TRUE                       08610021
085300* MAJOR CLASS IS REQUIRED WHEN SUBCLASS IS ENTERED                08620026
085400        MOVE PC-TSYMSG-02801        TO DP020-MSG-NUMBER           08630026
085500     END-IF.                                                      08640021
085600                                                                  08650021
086000************                                                      08660020
086100* SCL EDITS                                                       08670020
086200************                                                      08680020
086300                                                                  08690020
086400     IF MR114-SUBCLASS > SPACE                                    08700020
086500        MOVE MR114-SUBCLASS            TO DP010I-UNEDITED-FIELD   08710020
086600        MOVE LENGTH OF MR114-SUBCLASS  TO DP010I-MAXIMUM-DIGITS   08720020
086700        MOVE ZERO                      TO DP010I-MAXIMUM-DECIMALS 08730020
086800        SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                   08740020
262436        CALL DP010I-NUMERIC-EDIT-ROUTINE                          08751029
262436             USING DP010I-NUMERIC-EDIT-AREA                       08752029
087000        IF  DP010I-ERROR-DETECTED                                 08760020
087100            SET PS-COMMAREA-NOT-VALID   TO TRUE                   08770020
087200* SUBCLASS MUST BE NUMERIC IF IT WAS ENTERED                      08780020
087300            MOVE PC-TSYMSG-02803        TO DP020-MSG-NUMBER       08790026
087400        ELSE                                                      08800020
087500* IF THE USER ENTERED A NUMERIC SCL, THEN THE VALIDATE CALL       08810020
087600* WILL GO DOWN TO THE SCL LEVEL                                   08820020
087700            MOVE DP010I-NUMERIC-FIELD   TO PV-SUBCLASS-NUMBER     08830020
087800            MOVE PV-SUBCLASS-X (2:3)    TO PV-SUBCLASS-X3         08840020
087900            MOVE PV-SUBCLASS-X          TO MR114-SUBCLASS         08850020
088000            MOVE 'SCL'                  TO PV-TYPE                08860020
088100            MOVE MR114-SUBCLASS (2:3)   TO PV-SUBCLASS-X3         08870020
088200        END-IF                                                    08880020
088300     ELSE                                                         08890020
088400* USER DID NOT ENTER A NUMERIC SCL, SO USE %%% IN SCL DB2 FIELD SO08900020
088500* THE VALIDATE CALL WILL NOT BE GOING DOWN TO THE SCL LEVEL       08910020
088600        MOVE '%%%'    TO PV-SUBCLASS-X3                           08920020
088700     END-IF.                                                      08930020
088800                                                                  08940020
088900     IF PS-COMMAREA-VALID                                         08950001
089000         MOVE MR114-DEPT (2:3)        TO PV-DEPT-X3               08960001
089100         PERFORM 1300-VALIDATE-DEPT-CLASS                         08970001
089200         IF PS-NO-DEPT-REC                                        08980001
089300            SET PS-COMMAREA-NOT-VALID  TO TRUE                    08990001
089400*  DEPT/CLASS DOES NOT EXIST                                      09000001
089500            MOVE PC-TSYMSG-00110       TO DP020-MSG-NUMBER        09010001
089600         ELSE                                                     09020001
089700            MOVE MR114-DEPT            TO PV-DEPT-NUMBER-S        09030001
089800            MOVE MR114-SKU             TO PV-SKU-NUMBER-S         09040001
089900            PERFORM 1400-VALIDATE-SKU                             09050001
090000            IF PS-INVALID-SKU                                     09060001
090100               SET PS-COMMAREA-NOT-VALID TO TRUE                  09070001
090200*  SKU DOES NOT EXIST WITHIN DEPT/CLASS                           09080001
090300               MOVE PC-TSYMSG-00386     TO DP020-MSG-NUMBER       09090001
090400            END-IF                                                09100001
090500         END-IF                                                   09110001
090600     END-IF.                                                      09120001
090700                                                                  09130001
091300 1300-VALIDATE-DEPT-CLASS.                                        09140000
091400                                                                  09150000
091500     PERFORM                                                      09160015
091600         WITH TEST AFTER                                          09170015
091700         VARYING PV-SQL-SUB                                       09180015
091800         FROM 1 BY 1                                              09190015
091900         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        09200015
092000           OR (SQLCODE EQUAL ZERO OR +100)                        09210015
092100                                                                  09220015
092200         EXEC SQL                                                 09230015
092300             SELECT MDSEAR_DKEY                                   09240015
092400               INTO :MDSEAR-DKEY                                  09250015
092500               FROM TMDSEAR                                       09260015
092600               WHERE DEPT_NBR          = :PV-DEPT-X3              09270015
092700                 AND MAJ_CL_NBR     LIKE :PV-CLASS-X2             09280020
092800                 AND SUB_CL_NBR     LIKE :PV-SUBCLASS-X3          09290015
092900                 AND MDSELV_CDE        = :PV-TYPE                 09300015
093000                 AND :PV-PROCESS-DATE-R BETWEEN                   09310015
093100                      STRT_DTE AND END_DTE                        09320015
093200         END-EXEC                                                 09330015
093300                                                                  09340000
093400         EVALUATE TRUE                                            09350015
093500             WHEN SQLCODE = 0                                     09360015
093600             MOVE 'N'                TO PS-NO-DEPT-REC-SW         09370015
093700             WHEN SQLCODE = +100                                  09380015
093800             MOVE 'Y'                TO PS-NO-DEPT-REC-SW         09390015
093900             WHEN SQLCODE = -904                                  09400015
094000             WHEN SQLCODE = -913                                  09410015
094100                  CONTINUE                                        09420015
094200             WHEN SQLWARN0 NOT EQUAL SPACES                       09430015
094300             WHEN SQLCODE NOT EQUAL ZERO                          09440015
094400             MOVE 'Y'                TO PS-NO-DEPT-REC-SW         09450015
094500         END-EVALUATE                                             09460015
094600     END-PERFORM.                                                 09470015
094700                                                                  09480000
094800     IF  PV-SQL-SUB > PC-MAX-RETRIES                              09490015
094900         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    09500015
095000                                 TO DP013-MESSAGE-TEXT (1)        09510015
095100         MOVE SQLCA              TO DP013-SQLCA                   09520015
095200         MOVE 'TSKXREF'          TO DP013-DB2-TABLE-NAME (1)      09530015
095300         SET DP013-DB2-ABEND                                      09540015
095400             DP013-XCTL-DISPLAY-RESTART TO TRUE                   09550015
095500         PERFORM DP013-0000-PROCESS-ABEND                         09560015
095600     END-IF.                                                      09570015
095700                                                                  09580000
095800 1400-VALIDATE-SKU.                                               09590000
095900                                                                  09600000
096000     PERFORM                                                      09610015
096100         WITH TEST AFTER                                          09620015
096200         VARYING PV-SQL-SUB                                       09630015
096300         FROM 1 BY 1                                              09640015
096400         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        09650015
096500           OR (SQLCODE EQUAL ZERO OR +100)                        09660015
096600                                                                  09670015
096700         EXEC SQL                                                 09680015
096800           SELECT                                                 09690015
096900               DEPT                                               09700015
096910             , CLASS                                              09710023
096920             , SUBCLASS                                           09720023
097000           INTO                                                   09730015
097100               :SKXREF-DEPT                                       09740015
097110             , :SKXREF-CLASS                                      09750023
097120             , :SKXREF-SUBCLASS                                   09760023
097200           FROM                                                   09770015
097300               TSKXREF                                            09780015
097400           WHERE                                                  09790015
097500                   DEPT      = :PV-DEPT-NUMBER-S                  09800015
097600              AND  SKU       = :PV-SKU-NUMBER-S                   09810015
097700         END-EXEC                                                 09820015
097800                                                                  09830015
097900         EVALUATE TRUE                                            09840015
098000             WHEN SQLCODE = 0                                     09850015
098100             WHEN SQLCODE = +100                                  09860015
098200             WHEN SQLCODE = -904                                  09870015
098300             WHEN SQLCODE = -913                                  09880015
098400                  CONTINUE                                        09890015
098500         END-EVALUATE                                             09900015
098600     END-PERFORM.                                                 09910015
098700                                                                  09920000
098800     IF  PV-SQL-SUB > PC-MAX-RETRIES                              09930015
098900         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    09940015
099000                                 TO DP013-MESSAGE-TEXT (1)        09950015
099100         MOVE SQLCA              TO DP013-SQLCA                   09960015
099200         MOVE 'TSKXREF'          TO DP013-DB2-TABLE-NAME (1)      09970015
099300         SET DP013-DB2-ABEND                                      09980015
099400             DP013-XCTL-DISPLAY-RESTART TO TRUE                   09990015
099500         PERFORM DP013-0000-PROCESS-ABEND                         10000015
099600     END-IF.                                                      10010015
099700                                                                  10020015
099800     IF  SQLCODE EQUAL ZERO                                       10030000
099810         EVALUATE TRUE                                            10040023
099811* IF THIS FIRST CASE IS TRUE, WE KNOW THAT BOTH MCL AND SCL       10050023
099812* WERE ENTERED (EDITS REQUIRE MCL IF SCL WAS ENTERED)             10060023
099820             WHEN MR114-SUBCLASS > SPACE                          10070023
099830               MOVE MR114-CLASS        TO PV-CLASS-NUMBER         10080023
099850               MOVE PV-CLASS-NUMBER    TO PV-CLASS-NUMBER-S       10090023
099860               MOVE MR114-SUBCLASS     TO PV-SUBCLASS-NUMBER      10100023
099861               MOVE PV-SUBCLASS-NUMBER TO PV-SUBCLASS-NUMBER-S    10110023
099870               IF PV-CLASS-NUMBER-S = SKXREF-CLASS                10120023
099880                 AND PV-SUBCLASS-NUMBER-S = SKXREF-SUBCLASS       10130023
099890                  SET PS-VALID-SKU     TO TRUE                    10140023
099891               ELSE                                               10150023
100100                  SET PS-INVALID-SKU    TO TRUE                   10160023
100200               END-IF                                             10170023
100201             WHEN MR114-CLASS > SPACE                             10180023
100202* THIS IS WHEN MCL WAS ENTERD WITHOUT THE SCL                     10190023
100203               MOVE MR114-CLASS        TO PV-CLASS-NUMBER         10200023
100204               MOVE PV-CLASS-NUMBER    TO PV-CLASS-NUMBER-S       10210023
100205               IF PV-CLASS-NUMBER-S = SKXREF-CLASS                10220023
100207                  SET PS-VALID-SKU     TO TRUE                    10230023
100208               ELSE                                               10240023
100209                  SET PS-INVALID-SKU    TO TRUE                   10250023
100210               END-IF                                             10260023
100220             WHEN MR114-DEPT > SPACE                              10270027
100230* THIS IS WHEN ONLY DEPT AND SKU WERE ENTERED                     10280027
100240               MOVE MR114-DEPT         TO PV-DEPT-NUMBER          10290027
100250               MOVE PV-DEPT-NUMBER     TO PV-DEPT-NUMBER-S        10300027
100260               IF PV-DEPT-NUMBER-S = SKXREF-DEPT                  10310027
100270                  SET PS-VALID-SKU     TO TRUE                    10320027
100280               ELSE                                               10330027
100281                  SET PS-INVALID-SKU   TO TRUE                    10340027
100282               END-IF                                             10350027
100290         END-EVALUATE                                             10360027
100291     END-IF.                                                      10370027
100292                                                                  10380027
100400 EJECT                                                            10390000
100500*----------------------------------------------------------------*10400000
100600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *10410000
100700* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *10420000
100800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *10430000
100900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *10440000
101000* FUNCTION KEYS CAN GET THIS FAR.                                *10450000
101100*----------------------------------------------------------------*10460000
101200                                                                  10470000
101300 2000-PROCESS-PANEL.                                              10480000
101400     EVALUATE TRUE                                                10490000
101500         WHEN DP020-SRC-AID = DP016-CLEAR                         10500000
101600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    10510000
101700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10520000
101800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10530000
101900                                                                  10540000
102000         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    10550000
102100             PERFORM 2050-DELETE-LIST-QUEUE                       10560000
102200             PERFORM 4000-BUILD-INITIAL-PANEL                     10570000
102300                                                                  10580000
102400         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    10590000
102500             PERFORM 2140-DESELECT-ALL-ITEMS                      10600000
102600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10610000
102700                                                                  10620000
102800         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  10630000
102900             PERFORM 2150-SELECT-ALL-ITEMS                        10640000
103000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10650000
103100                                                                  10660000
103200         WHEN OTHER                                               10670000
103300             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 10680000
103400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10690000
103500             IF  PS-NO-ERROR                                      10700000
103600                 SET DP030-CONTINUE-GO                            10710000
103700                                 TO TRUE                          10720000
103800                 PERFORM 2100-CHECK-FUNCTION-KEY                  10730000
103900             ELSE                                                 10740000
104000                 SET DP030-OVERRIDE-GO                            10750000
104100                                 TO TRUE                          10760000
104200             END-IF                                               10770000
104300     END-EVALUATE.                                                10780000
104400 EJECT                                                            10790000
104500*----------------------------------------------------------------*10800000
104600*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *10810000
104700*----------------------------------------------------------------*10820000
104800 2050-DELETE-LIST-QUEUE.                                          10830000
104900                                                                  10840000
105000     EXEC CICS                                                    10850000
105100         DELETEQ TS                                               10860000
105200             QUEUE (ASC-LIST-QUEUE-NAME)                          10870000
105300             RESP  (PV-CICS-RESP)                                 10880000
105400     END-EXEC.                                                    10890000
105500                                                                  10900000
105600     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       10910000
105700        (PV-CICS-RESP = DFHRESP(QIDERR))                          10920000
105800         CONTINUE                                                 10930000
105900     ELSE                                                         10940000
106000         SET DP013-CICS-ABEND      TO TRUE                        10950000
106100         SET DP013-NO-ROLLBACK     TO TRUE                        10960000
106200                                                                  10970000
106300         MOVE '2050-DELETE-LIST-QUEUE'                            10980000
106400                                   TO DP013-PARAGRAPH             10990000
106500         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    11000000
106600                                   TO DP013-MESSAGE-TEXT (1)      11010000
106700         PERFORM DP013-0000-PROCESS-ABEND                         11020000
106800     END-IF.                                                      11030000
106900                                                                  11040000
107000     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  11050000
107100 EJECT                                                            11060000
107200*----------------------------------------------------------------*11070000
107300* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*11080000
107400* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *11090000
107500* CICS ARCHITECTURE API.                                         *11100000
107600*----------------------------------------------------------------*11110000
107700 2100-CHECK-FUNCTION-KEY.                                         11120000
107800     EVALUATE TRUE                                                11130000
107900         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  11140000
108000             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              11150000
108100                 INITIALIZE MR102-INTER-APPL-COMMAREA             11160000
108200                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                11170000
108300                                TO MR102-NUMBER-OF-SELECTED-ITEMS 11180000
108400                 PERFORM 5000-PREPARE-SEL-QUEUE                   11190000
108500             ELSE                                                 11200000
108600                 SET DP030-OVERRIDE-GO                            11210000
108700                                   TO TRUE                        11220000
108800                 MOVE PC-TSYMSG-00057                             11230000
108900                                   TO DP020-MSG-NUMBER            11240000
109000                 SET DP020-MSG-WARNING                            11250000
109100                                   TO TRUE                        11260000
109200             END-IF                                               11270000
109300                                                                  11280000
109400                                                                  11290000
109500         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  11300000
109600             MOVE +1               TO PV-TOP-ITEM                 11310000
109700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11320000
109800                                                                  11330000
109900         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   11340000
110000             PERFORM 2110-BROWSE-BACKWARD                         11350000
110100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11360000
110200                                                                  11370000
110300         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   11380000
110400             PERFORM 2120-BROWSE-FORWARD                          11390000
110500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11400000
110600                                                                  11410000
110700         WHEN DP020-SRC-AID = DP016-ENTER                         11420000
110800             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   11430000
110900             IF  PS-ERROR                                         11440000
111000                 CONTINUE                                         11450000
111100             ELSE                                                 11460000
111200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             11470000
111300             END-IF                                               11480000
111400                                                                  11490000
111500                                                                  11500000
111600         WHEN OTHER                                               11510000
111700             SET DP013-NO-ROLLBACK                                11520000
111800                 DP013-XCTL-DISPLAY-RESTART                       11530000
111900                 DP013-CICS-ABEND  TO TRUE                        11540000
112000             MOVE '2100-CHECK-FUNCTION-KEY'                       11550000
112100                                   TO DP013-PARAGRAPH             11560000
112200             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      11570000
112300                                   TO DP013-MESSAGE-TEXT (1)      11580000
112400             PERFORM DP013-0000-PROCESS-ABEND                     11590000
112500     END-EVALUATE.                                                11600000
112600*                                                                 11610000
112700*----------------------------------------------------------------*11620000
112800*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *11630000
112900*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *11640000
113000*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *11650000
113100*    MESSAGE.                                                    *11660000
113200*----------------------------------------------------------------*11670000
113300                                                                  11680000
113400 2110-BROWSE-BACKWARD.                                            11690000
113500     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    11700000
113600         GIVING PV-TOP-ITEM.                                      11710000
113700*                                                                 11720000
113800     IF  ((PV-TOP-ITEM < +1)                                      11730000
113900       OR (PV-TOP-ITEM = +1))                                     11740000
114000         MOVE +1                   TO PV-TOP-ITEM                 11750000
114100*        -- TOP OF LIST --                                        11760000
114200         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            11770000
114300         SET DP020-MSG-INFORMATIONAL TO TRUE                      11780000
114400     END-IF.                                                      11790000
114500                                                                  11800000
114600 EJECT                                                            11810000
114700*----------------------------------------------------------------*11820000
114800*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *11830000
114900*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *11840000
115000*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *11850000
115100*----------------------------------------------------------------*11860000
115200                                                                  11870000
115300 2120-BROWSE-FORWARD.                                             11880000
115400                                                                  11890000
115500     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              11900000
115600         GIVING PV-TOP-ITEM.                                      11910000
115700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   11920000
115800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            11930000
115900                                   TO PV-TOP-ITEM                 11940000
116000*        -- BOTTOM OF LIST --                                     11950000
116100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            11960000
116200         SET DP020-MSG-INFORMATIONAL                              11970000
116300                                   TO TRUE                        11980000
116400     ELSE                                                         11990000
116500         COMPUTE PV-BOTTOM-ITEM =                                 12000000
116600             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 12010000
116700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            12020000
116800*            -- BOTTOM OF LIST --                                 12030000
116900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            12040000
117000             SET DP020-MSG-INFORMATIONAL                          12050000
117100                                   TO TRUE                        12060000
117200         END-IF                                                   12070000
117300     END-IF.                                                      12080000
117400 EJECT                                                            12090000
117500*----------------------------------------------------------------*12100000
117600*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *12110000
117700*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *12120000
117800*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *12130000
117900*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *12140000
118000*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *12150000
118100*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *12160000
118200*----------------------------------------------------------------*12170000
118300                                                                  12180000
118400 2130-CHECK-FOR-JUMP-BROWSE.                                      12190000
118500     SET PS-NO-ERROR               TO TRUE.                       12200000
118600     IF (ASC-START-ITEM-REQUEST = SPACE)                          12210000
118700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            12220000
118800                                   TO PV-TOP-ITEM                 12230000
118900     ELSE                                                         12240000
119000         MOVE ASC-START-ITEM-REQUEST                              12250000
119100                                   TO DP010I-UNEDITED-FIELD       12260000
119200         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       12270000
119300         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     12280000
119400         SET DP010I-NEGATIVE-NOT-ALLOWED                          12290000
119500                                   TO TRUE                        12300000
262436         CALL DP010I-NUMERIC-EDIT-ROUTINE                         12311029
262436              USING DP010I-NUMERIC-EDIT-AREA                      12312029
119700                                                                  12320000
119800         IF  NOT DP010I-ERROR-DETECTED                            12330000
119900             MOVE DP010I-NUMERIC-FIELD                            12340000
120000                                   TO  ASC-START-ITEM-REQUEST-N   12350000
120100             IF  ASC-START-ITEM-REQUEST-N > ZERO                  12360000
120200                 IF  ASC-START-ITEM-REQUEST-N >                   12370000
120300                                          ASC-NUMBER-OF-ITEMS-READ12380000
120400                     MOVE SPACE TO ASC-START-ITEM-REQUEST         12390000
120500                     COMPUTE PV-TOP-ITEM =                        12400000
120600                             ASC-NUMBER-OF-ITEMS-READ             12410000
120700                             - PC-ITEMS-PER-PANEL + 1             12420000
120800                     IF  PV-TOP-ITEM < +1                         12430000
120900                         MOVE +1   TO PV-TOP-ITEM                 12440000
121000                         MOVE PC-TSYMSG-00070                     12450000
121100                                   TO DP020-MSG-NUMBER            12460000
121200                         SET DP020-MSG-INFORMATIONAL              12470000
121300                                   TO TRUE                        12480000
121400                     END-IF                                       12490000
121500                 ELSE                                             12500000
121600                     MOVE ASC-START-ITEM-REQUEST-N                12510000
121700                                   TO PV-TOP-ITEM                 12520000
121800                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      12530000
121900                     COMPUTE PV-BOTTOM-ITEM =                     12540000
122000                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     12550000
122100                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ12560000
122200*                        -- BOTTOM OF LIST --                     12570000
122300                         MOVE PC-TSYMSG-00070                     12580000
122400                                   TO DP020-MSG-NUMBER            12590000
122500                         SET DP020-MSG-INFORMATIONAL              12600000
122600                                   TO TRUE                        12610000
122700                     END-IF                                       12620000
122800                 END-IF                                           12630000
122900             ELSE                                                 12640000
123000*                --- VALUE OUT OF RANGE ----                      12650000
123100                 MOVE PC-TSYMSG-00101                             12660000
123200                                   TO DP020-MSG-NUMBER            12670000
123300                 MOVE -1           TO ASTRTITL                    12680000
123400                 SET DP030-SET-CURSOR-APPL-1                      12690000
123500                                   TO TRUE                        12700000
123600                 MOVE DP015-REVERSE                               12710000
123700                                   TO ASTRTITH                    12720000
123800                 MOVE DP015-RED    TO ASTRTITC                    12730000
123900                 MOVE DP015-UNP-NUM-BRT-MDT                       12740000
124000                                   TO ASTRTITA                    12750000
124100                 SET DP020-MSG-FATAL                              12760000
124200                                   TO TRUE                        12770000
124300                 SET PS-ERROR      TO TRUE                        12780000
124400             END-IF                                               12790000
124500                                                                  12800000
124600         ELSE                                                     12810000
124700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            12820000
124800             MOVE -1               TO ASTRTITL                    12830000
124900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  12840000
125000             MOVE DP015-REVERSE    TO ASTRTITH                    12850000
125100             MOVE DP015-RED        TO ASTRTITC                    12860000
125200             MOVE DP015-UNP-NUM-BRT-MDT                           12870000
125300                                   TO ASTRTITA                    12880000
125400             SET DP020-MSG-FATAL   TO TRUE                        12890000
125500             SET PS-ERROR          TO TRUE                        12900000
125600         END-IF                                                   12910000
125700     END-IF.                                                      12920000
125800 EJECT                                                            12930000
125900*----------------------------------------------------------------*12940000
126000*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *12950000
126100*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *12960000
126200*----------------------------------------------------------------*12970000
126300 2140-DESELECT-ALL-ITEMS.                                         12980000
126400     MOVE +1                       TO ASC-BLK-SUB.                12990000
126500                                                                  13000000
126600     PERFORM 2141-CLEAR-SELECTED-INDS                             13010000
126700         VARYING ASC-ITEM-SUB                                     13020000
126800         FROM 1 BY 1                                              13030000
126900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13040000
127000                                                                  13050000
127100     ADD +1                        TO ASC-BLK-SUB.                13060000
127200                                                                  13070000
127300     PERFORM 2141-CLEAR-SELECTED-INDS                             13080000
127400         VARYING ASC-ITEM-SUB                                     13090000
127500         FROM 1 BY 1                                              13100000
127600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13110000
127700                                                                  13120000
127800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               13130000
127900                                   TO PV-LIST-ITEM-NUMBER.        13140000
128000                                                                  13150000
128100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13160000
128200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    13170000
128300                                                                  13180000
128400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     13190000
128500        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      13200000
128600         MOVE +1                   TO ASC-BLK-SUB                 13210000
128700                                                                  13220000
128800         PERFORM 5100-WRITE-TEMP-STORAGE                          13230000
128900                                                                  13240000
129000         MOVE +1                   TO PV-BLOCK-NUMBER             13250000
129100                                                                  13260000
129200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13270000
129300             PV-FIRST-BLOCK-IN-ARRAY - 1                          13280000
129400                                                                  13290000
129500         PERFORM                                                  13300000
129600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       13310000
129700                                                                  13320000
129800             PERFORM 4410-READ-TEMP-STORAGE                       13330000
129900                                                                  13340000
130000             PERFORM 2141-CLEAR-SELECTED-INDS                     13350000
130100                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 13360000
130200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13370000
130300                                                                  13380000
130400             PERFORM 5100-WRITE-TEMP-STORAGE                      13390000
130500                                                                  13400000
130600             ADD +1                TO PV-BLOCK-NUMBER             13410000
130700                                                                  13420000
130800         END-PERFORM                                              13430000
130900                                                                  13440000
131000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13450000
131100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13460000
131200                                                                  13470000
131300         PERFORM                                                  13480000
131400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13490000
131500                   ASC-HIGHEST-BLOCK-WRITTEN                      13500000
131600                                                                  13510000
131700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          13520000
131800                                   TO PV-BLOCK-NUMBER             13530000
131900                                                                  13540000
132000             PERFORM 4410-READ-TEMP-STORAGE                       13550000
132100                                                                  13560000
132200             PERFORM 2141-CLEAR-SELECTED-INDS                     13570000
132300                 VARYING ASC-ITEM-SUB                             13580000
132400                 FROM 1 BY 1                                      13590000
132500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13600000
132600                                                                  13610000
132700             PERFORM 5100-WRITE-TEMP-STORAGE                      13620000
132800                                                                  13630000
132900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      13640000
133000                                                                  13650000
133100         END-PERFORM                                              13660000
133200                                                                  13670000
133300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             13680000
133400                                   TO PV-BLOCK-NUMBER             13690000
133500                                                                  13700000
133600         PERFORM 4410-READ-TEMP-STORAGE                           13710000
133700     END-IF.                                                      13720000
133800                                                                  13730000
133900                                                                  13740000
134000     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 13750000
134100     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.13760000
134200     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  13770000
134300                                                                  13780000
134400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        13790000
134500                                                                  13800000
134600 EJECT                                                            13810000
134700*----------------------------------------------------------------*13820000
134800*    MARK EACH ITEM AS BEING NOT SELECTED.                       *13830000
134900*----------------------------------------------------------------*13840000
135000                                                                  13850000
135100 2141-CLEAR-SELECTED-INDS.                                        13860000
135200                                                                  13870000
135300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           13880000
135400             NOT EQUAL ZERO                                       13890000
135500         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          13900000
135600             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          13910000
135700                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    13920000
135800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  13930000
135900                                   TO TRUE                        13940000
136000         END-IF                                                   13950000
136100     END-IF.                                                      13960000
136200                                                                  13970000
136300 EJECT                                                            13980000
136400*----------------------------------------------------------------*13990000
136500*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *14000000
136600*  FOR ALL ITEMS.                                                *14010000
136700*----------------------------------------------------------------*14020000
136800                                                                  14030000
136900 2150-SELECT-ALL-ITEMS.                                           14040000
137000                                                                  14050000
137100     MOVE +1                       TO ASC-BLK-SUB.                14060000
137200                                                                  14070000
137300     PERFORM 2151-SET-SELECTED-INDS                               14080000
137400         VARYING ASC-ITEM-SUB                                     14090000
137500         FROM 1 BY 1                                              14100000
137600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14110000
137700                                                                  14120000
137800     ADD +1                        TO ASC-BLK-SUB.                14130000
137900                                                                  14140000
138000     PERFORM 2151-SET-SELECTED-INDS                               14150000
138100         VARYING ASC-ITEM-SUB                                     14160000
138200         FROM 1 BY 1                                              14170000
138300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14180000
138400                                                                  14190000
138500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               14200000
138600                                   TO PV-LIST-ITEM-NUMBER.        14210000
138700                                                                  14220000
138800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            14230000
138900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    14240000
139000                                                                  14250000
139100     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     14260000
139200        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    14270000
139300         MOVE +1                   TO ASC-BLK-SUB                 14280000
139400                                                                  14290000
139500         PERFORM 5100-WRITE-TEMP-STORAGE                          14300000
139600                                                                  14310000
139700         MOVE +1                   TO PV-BLOCK-NUMBER             14320000
139800                                                                  14330000
139900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         14340000
140000             PV-FIRST-BLOCK-IN-ARRAY - 1                          14350000
140100                                                                  14360000
140200         PERFORM                                                  14370000
140300             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       14380000
140400                                                                  14390000
140500             PERFORM 4410-READ-TEMP-STORAGE                       14400000
140600                                                                  14410000
140700             PERFORM 2151-SET-SELECTED-INDS                       14420000
140800                 VARYING ASC-ITEM-SUB                             14430000
140900                 FROM 1 BY 1                                      14440000
141000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14450000
141100                                                                  14460000
141200             PERFORM 5100-WRITE-TEMP-STORAGE                      14470000
141300                                                                  14480000
141400             ADD +1                TO PV-BLOCK-NUMBER             14490000
141500                                                                  14500000
141600         END-PERFORM                                              14510000
141700                                                                  14520000
141800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         14530000
141900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     14540000
142000                                                                  14550000
142100         PERFORM                                                  14560000
142200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       14570000
142300                   ASC-HIGHEST-BLOCK-WRITTEN                      14580000
142400                                                                  14590000
142500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          14600000
142600                                   TO PV-BLOCK-NUMBER             14610000
142700                                                                  14620000
142800             PERFORM 4410-READ-TEMP-STORAGE                       14630000
142900                                                                  14640000
143000             PERFORM 2151-SET-SELECTED-INDS                       14650000
143100                 VARYING ASC-ITEM-SUB                             14660000
143200                 FROM 1 BY 1                                      14670000
143300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14680000
143400                                                                  14690000
143500             PERFORM 5100-WRITE-TEMP-STORAGE                      14700000
143600                                                                  14710000
143700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      14720000
143800                                                                  14730000
143900         END-PERFORM                                              14740000
144000                                                                  14750000
144100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             14760000
144200                                   TO PV-BLOCK-NUMBER             14770000
144300                                                                  14780000
144400         PERFORM 4410-READ-TEMP-STORAGE                           14790000
144500     END-IF.                                                      14800000
144600                                                                  14810000
144700                                                                  14820000
144800     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             14830000
144900                       ASC-NUMBER-OF-SELECTED-ITEMS.              14840000
145000                                                                  14850000
145100     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        14860000
145200                                                                  14870000
145300 EJECT                                                            14880000
145400*----------------------------------------------------------------*14890000
145500*    MARK EACH ITEM AS BEING SELECTED.                           *14900000
145600*----------------------------------------------------------------*14910000
145700                                                                  14920000
145800 2151-SET-SELECTED-INDS.                                          14930000
145900                                                                  14940000
146000     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           14950000
146100             NOT EQUAL ZERO                                       14960000
146200         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             14970000
146300             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             14980000
146400                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        14990000
146500                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  15000000
146600                               TO  TRUE                           15010000
146700         END-IF                                                   15020000
146800     END-IF.                                                      15030000
146900                                                                  15040001
147000******************************************************************15050000
147100** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **15060000
147200** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **15070000
147300******************************************************************15080000
147400 2200-MOVE-SCREEN-TO-COMMAREA.                                    15090000
147500                                                                  15100000
147600     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             15110000
147700     MOVE +1                       TO PV-SUB.                     15120000
147800*                                                                 15130000
147900     PERFORM 3100-SET-SUBSCRIPTS.                                 15140000
148000     IF  ASTRTITL > ZERO                                          15150000
148100         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          15160000
148200     ELSE                                                         15170000
148300         IF  ASTRTITF = DP015-ERASE-EOF                           15180000
148400             INITIALIZE ASC-START-ITEM-REQUEST                    15190000
148500         END-IF                                                   15200000
148600     END-IF.                                                      15210000
148700     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          15220000
148800         VARYING PV-SUB                                           15230000
148900         FROM 1 BY 1                                              15240000
149000         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      15250000
149100******************************************************************15260000
149200** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**15270000
149300******************************************************************15280000
149400 2210-MOVE-LINES-TO-COMMAREA.                                     15290000
149500     IF  MR-SELECTL (PV-SUB) > ZERO                               15300000
149600         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             15310000
149700         MOVE MR-SELECTI (PV-SUB)                                 15320000
149800                                   TO ASC-TEMP-SELECTED-SW        15330000
149900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      15340000
150000     ELSE                                                         15350000
150100         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                15360000
150200                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     15370000
150300                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        15380000
150400                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      15390000
150500         END-IF                                                   15400000
150600     END-IF.                                                      15410000
150700     ADD +1                        TO ASC-ITEM-SUB.               15420000
150800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        15430000
150900         ADD +1                    TO ASC-BLK-SUB                 15440000
151000         MOVE +1                   TO ASC-ITEM-SUB                15450000
151100     END-IF.                                                      15460000
151200******************************************************************15470000
151300** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **15480000
151400** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **15490000
151500******************************************************************15500000
151600 3000-EDIT-DATA-IN-COMMAREA.                                      15510000
151700     SET PS-NO-ERROR               TO TRUE.                       15520000
151800     PERFORM 3200-RESET-ATTRIBUTES.                               15530000
151900     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     15540000
152000**                                                                15550000
152100* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              15560000
152200* EDITTING IS DONE FROM THE BOTTOM UP.                            15570000
152300**                                                                15580000
152400     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       15590000
152500         ASC-ITEMS-DISPLAYED - 1.                                 15600000
152600     PERFORM 3100-SET-SUBSCRIPTS.                                 15610000
152700     PERFORM 3300-EDIT-SELECTIONS                                 15620000
152800         VARYING PV-SUB                                           15630000
152900         FROM PV-SUB BY -1                                        15640000
153000         UNTIL PV-SUB < +1                                        15650000
153100*                                                                 15660000
153200     IF  PS-NO-ERROR                                              15670000
153300         PERFORM 3400-CHECK-RANGE-SEQUENCE                        15680000
153400     END-IF.                                                      15690000
153500*                                                                 15700000
153600     IF  ((PS-NO-ERROR)                                           15710000
153700       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   15720000
153800       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    15730000
153900             PERFORM 3500-MARK-RANGE-AS-SELECTED                  15740000
154000     END-IF.                                                      15750000
154100 EJECT                                                            15760000
154200*----------------------------------------------------------------*15770000
154300*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *15780000
154400*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*15790000
154500*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *15800000
154600*                                                                *15810000
154700*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *15820000
154800*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *15830000
154900*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *15840000
155000*    US IN THE 2ND BLOCK OF THE ARRAY.                           *15850000
155100*----------------------------------------------------------------*15860000
155200                                                                  15870000
155300 3100-SET-SUBSCRIPTS.                                             15880000
155400                                                                  15890000
155500     COMPUTE ASC-ITEM-SUB =                                       15900000
155600         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        15910000
155700                                                                  15920000
155800     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         15930000
155900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            15940000
156000                                                                  15950000
156100         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               15960000
156200     ELSE                                                         15970000
156300         MOVE +1                     TO ASC-BLK-SUB               15980000
156400     END-IF.                                                      15990000
156500******************************************************************16000000
156600** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **16010000
156700******************************************************************16020000
156800                                                                  16030000
156900 3200-RESET-ATTRIBUTES.                                           16040000
157000     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   16050000
157100     MOVE DP015-GREEN              TO ASTRTITC.                   16060000
157200     MOVE DP015-UNDERLINE          TO ASTRTITH.                   16070000
157300*                                                                 16080000
157400     PERFORM                                                      16090000
157500         VARYING PV-SUB                                           16100000
157600         FROM 1 BY 1                                              16110000
157700         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        16120000
157800         MOVE DP015-UNP-ALP-NOR-OFF                               16130000
157900                                   TO MR-SELECTA (PV-SUB)         16140000
158000         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         16150000
158100         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         16160000
158200     END-PERFORM.                                                 16170000
158300******************************************************************16180000
158400** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **16190000
158500** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **16200000
158600** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **16210000
158700** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **16220000
158800******************************************************************16230000
158900 3300-EDIT-SELECTIONS.                                            16240000
159000     EVALUATE TRUE                                                16250000
159100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     16260000
159200             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         16270000
159300                 CONTINUE                                         16280000
159400         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         16290000
159500             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        16300000
159600                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   16310000
159700                 MOVE ASC-TEMP-SELECTED-SW                        16320000
159800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16330000
159900                                TO ASC-SELECTED-SW                16340000
160000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16350000
160100             END-IF                                               16360000
160200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     16370000
160300                 = SPACE                                          16380000
160400             EVALUATE TRUE                                        16390000
160500                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       16400000
160600                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS16410000
160700                     MOVE SPACE TO ASC-SELECTED-SW                16420000
160800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16430000
160900                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        16440000
161000                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    16450000
161100                     MOVE SPACE TO ASC-SELECTED-SW                16460000
161200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16470000
161300                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          16480000
161400                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      16490000
161500                     MOVE SPACE TO ASC-SELECTED-SW                16500000
161600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16510000
161700             END-EVALUATE                                         16520000
161800         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           16530000
161900             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            16540000
162000                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    16550000
162100             END-IF                                               16560000
162200             PERFORM 3310-EDIT-RANGE                              16570000
162300         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             16580000
162400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            16590000
162500                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    16600000
162600             END-IF                                               16610000
162700             PERFORM 3310-EDIT-RANGE                              16620000
162800         WHEN OTHER                                               16630000
162900             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           16640000
163000             SET DP020-MSG-FATAL    TO TRUE                       16650000
163100             MOVE -1                TO MR-SELECTL (PV-SUB)        16660000
163200             SET DP030-SET-CURSOR-APPL-1                          16670000
163300                                    TO TRUE                       16680000
163400             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        16690000
163500             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        16700000
163600             SET PS-ERROR TO TRUE                                 16710000
163700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            16720000
163800                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     16730000
163900                 MOVE SPACE         TO ASC-SELECTED-SW            16740000
164000                                        (ASC-BLK-SUB ASC-ITEM-SUB)16750000
164100             END-IF                                               16760000
164200     END-EVALUATE.                                                16770000
164300                                                                  16780000
164400     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 16790000
164500     SUBTRACT +1 FROM ASC-ITEM-SUB.                               16800000
164600     IF  ASC-ITEM-SUB < 1                                         16810000
164700         SUBTRACT +1 FROM ASC-BLK-SUB                             16820000
164800         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                16830000
164900     END-IF.                                                      16840000
165000******************************************************************16850000
165100** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **16860000
165200** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **16870000
165300** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**16880000
165400** THE ENDING.                                                  **16890000
165500******************************************************************16900000
165600 3310-EDIT-RANGE.                                                 16910000
165700     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                16920000
165800         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   16930000
165900             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)16940000
166000                                   TO ASC-SELECTED-SW             16950000
166100                                        (ASC-BLK-SUB ASC-ITEM-SUB)16960000
166200             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 16970000
166300         ELSE                                                     16980000
166400             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     16990000
166500                 CONTINUE                                         17000000
166600             ELSE                                                 17010000
166700*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        17020000
166800                 MOVE PC-TSYMSG-00054                             17030000
166900                                   TO DP020-MSG-NUMBER            17040000
167000                 SET DP020-MSG-FATAL                              17050000
167100                                   TO TRUE                        17060000
167200                 MOVE -1           TO MR-SELECTL (PV-SUB)         17070000
167300                 SET DP030-SET-CURSOR-APPL-1                      17080000
167400                                   TO TRUE                        17090000
167500                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         17100000
167600                 MOVE DP015-UNDERLINE                             17110000
167700                                   TO MR-SELECTH (PV-SUB)         17120000
167800                 SET PS-ERROR      TO TRUE                        17130000
167900             END-IF                                               17140000
168000         END-IF                                                   17150000
168100     ELSE                                                         17160000
168200         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     17170000
168300             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 17180000
168400                                   TO ASC-SELECTED-SW             17190000
168500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   17200000
168600             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   17210000
168700         ELSE                                                     17220000
168800             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       17230000
168900                 CONTINUE                                         17240000
169000             ELSE                                                 17250000
169100*                -- ONLY ONE END-OF-RANGE ALLOWED --              17260000
169200                 MOVE PC-TSYMSG-00055                             17270000
169300                                   TO DP020-MSG-NUMBER            17280000
169400                 SET DP020-MSG-FATAL                              17290000
169500                                   TO TRUE                        17300000
169600                 MOVE -1           TO MR-SELECTL (PV-SUB)         17310000
169700                 SET DP030-SET-CURSOR-APPL-1                      17320000
169800                                   TO TRUE                        17330000
169900                 SET PS-ERROR      TO TRUE                        17340000
170000             END-IF                                               17350000
170100         END-IF                                                   17360000
170200     END-IF.                                                      17370000
170300*                                                                 17380000
170400******************************************************************17390000
170500** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **17400000
170600** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **17410000
170700******************************************************************17420000
170800 3400-CHECK-RANGE-SEQUENCE.                                       17430000
170900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       17440000
171000       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      17450000
171100       AND  ASC-START-OF-SELECTED-RANGE >                         17460000
171200                                         ASC-END-OF-SELECTED-RANGE17470000
171300*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                17480000
171400         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 17490000
171500         SET DP020-MSG-FATAL TO TRUE                              17500000
171600         SET PS-ERROR TO TRUE                                     17510000
171700         PERFORM 3410-POSITION-AT-ERROR                           17520000
171800     END-IF.                                                      17530000
171900******************************************************************17540000
172000** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **17550000
172100** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **17560000
172200** SHOULD BE POSITIONED ON A RANGE ERROR.                       **17570000
172300******************************************************************17580000
172400 3410-POSITION-AT-ERROR.                                          17590000
172500     SET DP030-SET-CURSOR-APPL-1                                  17600000
172600                                   TO TRUE.                       17610000
172700     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 17620000
172800                    - PV-TOP-ITEM + 1.                            17630000
172900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      17640000
173000         CONTINUE                                                 17650000
173100     ELSE                                                         17660000
173200         MOVE -1                   TO MR-SELECTL (PV-SUB)         17670000
173300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         17680000
173400         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         17690000
173500     END-IF.                                                      17700000
173600*                                                                 17710000
173700     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   17720000
173800                    - PV-TOP-ITEM + 1.                            17730000
173900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      17740000
174000         CONTINUE                                                 17750000
174100     ELSE                                                         17760000
174200         MOVE -1                   TO MR-SELECTL (PV-SUB)         17770000
174300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         17780000
174400         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         17790000
174500     END-IF.                                                      17800000
174600 EJECT                                                            17810000
174700*----------------------------------------------------------------*17820000
174800*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *17830000
174900*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *17840000
175000*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *17850000
175100*----------------------------------------------------------------*17860000
175200                                                                  17870000
175300 3500-MARK-RANGE-AS-SELECTED.                                     17880000
175400     MOVE +1                       TO  ASC-BLK-SUB.               17890000
175500     PERFORM 3510-MARK-SELECTED-INDS                              17900000
175600         VARYING ASC-ITEM-SUB                                     17910000
175700         FROM 1 BY 1                                              17920000
175800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17930000
175900                                                                  17940000
176000     ADD +1                        TO ASC-BLK-SUB.                17950000
176100     PERFORM 3510-MARK-SELECTED-INDS                              17960000
176200         VARYING ASC-ITEM-SUB                                     17970000
176300         FROM 1 BY 1                                              17980000
176400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17990000
176500                                                                  18000000
176600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               18010000
176700                                   TO  PV-LIST-ITEM-NUMBER.       18020000
176800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            18030000
176900         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         18040000
177000               PC-ITEMS-PER-PANEL).                               18050000
177100                                                                  18060000
177200     MOVE ASC-START-OF-SELECTED-RANGE                             18070000
177300                                   TO PV-START-OF-SELECTED-RANGE. 18080000
177400     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            18090000
177500         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  18100000
177600               PC-ITEMS-PER-PANEL).                               18110000
177700                                                                  18120000
177800     MOVE ASC-END-OF-SELECTED-RANGE                               18130000
177900                                   TO  PV-END-OF-SELECTED-RANGE.  18140000
178000     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             18150000
178100         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    18160000
178200               PC-ITEMS-PER-PANEL).                               18170000
178300     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             18180000
178400         PV-FIRST-BLOCK-IN-ARRAY + 1.                             18190000
178500                                                                  18200000
178600     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    18210000
178700        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        18220000
178800         MOVE +1                   TO ASC-BLK-SUB                 18230000
178900         PERFORM 5100-WRITE-TEMP-STORAGE                          18240000
179000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         18250000
179100             PV-FIRST-BLOCK-IN-ARRAY - 1                          18260000
179200                                                                  18270000
179300         PERFORM                                                  18280000
179400             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      18290000
179500                   PV-PREV-BLOCK-IN-ARRAY                         18300000
179600             MOVE PV-FIRST-BLOCK-IN-RANGE                         18310000
179700                                   TO PV-BLOCK-NUMBER             18320000
179800             PERFORM 4410-READ-TEMP-STORAGE                       18330000
179900             PERFORM 3510-MARK-SELECTED-INDS                      18340000
180000                 VARYING ASC-ITEM-SUB                             18350000
180100                 FROM 1 BY 1                                      18360000
180200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18370000
180300             PERFORM 5100-WRITE-TEMP-STORAGE                      18380000
180400             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     18390000
180500         END-PERFORM                                              18400000
180600                                                                  18410000
180700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         18420000
180800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     18430000
180900         PERFORM                                                  18440000
181000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       18450000
181100                   PV-LAST-BLOCK-IN-RANGE                         18460000
181200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          18470000
181300                                   TO PV-BLOCK-NUMBER             18480000
181400             PERFORM 4410-READ-TEMP-STORAGE                       18490000
181500             PERFORM 3510-MARK-SELECTED-INDS                      18500000
181600                 VARYING ASC-ITEM-SUB                             18510000
181700                 FROM 1 BY 1                                      18520000
181800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18530000
181900             PERFORM 5100-WRITE-TEMP-STORAGE                      18540000
182000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      18550000
182100         END-PERFORM                                              18560000
182200                                                                  18570000
182300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             18580000
182400                                   TO PV-BLOCK-NUMBER             18590000
182500         PERFORM 4410-READ-TEMP-STORAGE                           18600000
182600     END-IF.                                                      18610000
182700                                                                  18620000
182800     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 18630000
182900                                      ASC-END-OF-SELECTED-RANGE.  18640000
183000                                                                  18650000
183100 EJECT                                                            18660000
183200*----------------------------------------------------------------*18670000
183300* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *18680000
183400*----------------------------------------------------------------*18690000
183500                                                                  18700000
183600 3510-MARK-SELECTED-INDS.                                         18710000
183700                                                                  18720000
183800     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         18730000
183900                                ASC-ITEM-SUB) >                   18740000
184000         ASC-START-OF-SELECTED-RANGE)                             18750000
184100     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         18760000
184200                                ASC-ITEM-SUB) =                   18770000
184300         ASC-START-OF-SELECTED-RANGE)                             18780000
184400                                                                  18790000
184500         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     18800000
184600                                    ASC-ITEM-SUB) <               18810000
184700             ASC-END-OF-SELECTED-RANGE)                           18820000
184800         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     18830000
184900                                    ASC-ITEM-SUB) =               18840000
185000             ASC-END-OF-SELECTED-RANGE)                           18850000
185100                                                                  18860000
185200             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          18870000
185300                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   18880000
185400                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   18890000
185500                               TO TRUE                            18900000
185600                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              18910000
185700                               TO TRUE                            18920000
185800                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    18930000
185900             END-IF                                               18940000
186000         END-IF                                                   18950000
186100     END-IF.                                                      18960000
186200                                                                  18970000
186300 EJECT                                                            18980000
186400*----------------------------------------------------------------*18990000
186500*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *19000000
186600*    INITIALIZE ALL COUNTERS AND FLAGS.                          *19010000
186700*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *19020000
186800*    DISPLAY THE PANEL TO USER.                                  *19030000
186900*----------------------------------------------------------------*19040000
187000                                                                  19050000
187100 4000-BUILD-INITIAL-PANEL.                                        19060000
187200                                                                  19070000
187300     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            19080000
187400                                 ASC-BLOCK-ENTRIES (2).           19090000
187500     MOVE +1                 TO ASC-BLK-SUB.                      19100000
187600     SET ASC-ITEMS-LEFT-ON-DB                                     19110000
187700                             TO TRUE.                             19120000
187800                                                                  19130000
187900     MOVE +0                 TO ASC-ITEM-SUB                      19140000
188000                                ASC-NUMBER-OF-ITEMS-READ          19150000
188100                                ASC-NUMBER-OF-SELECTED-ITEMS      19160000
188200                                ASC-HIGHEST-BLOCK-WRITTEN         19170000
188300                                ASC-START-OF-SELECTED-RANGE       19180000
188400                                ASC-END-OF-SELECTED-RANGE         19190000
188500                                ASC-ITEM-AT-TOP-OF-PANEL.         19200000
188600     PERFORM 4100-PREPARE-CURSOR                                  19210000
188700                                                                  19220000
188800     PERFORM 4010-OPEN-CURSOR.                                    19230000
188900                                                                  19240000
189000     PERFORM 4300-READ-ITEMS-FROM-DB.                             19250000
189100                                                                  19260000
189200     PERFORM 4020-CLOSE-CURSOR.                                   19270000
189300                                                                  19280000
189400     MOVE +1                   TO  PV-TOP-ITEM.                   19290000
189500     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          19300000
189600         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    19310000
189700         SET DP020-MSG-FATAL   TO  TRUE                           19320000
189800         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               19330000
189900     ELSE                                                         19340000
190000         MOVE -1               TO MR-SELECTL (1)                  19350000
190100         SET DP030-SET-CURSOR-APPL-1                              19360000
190200                               TO TRUE                            19370000
190300         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     19380000
190400     END-IF.                                                      19390000
190500 EJECT                                                            19400000
190600                                                                  19410000
190700 4010-OPEN-CURSOR.                                                19420000
190800     PERFORM                                                      19430000
190900         WITH TEST AFTER                                          19440000
191000         VARYING PV-RETRY-COUNTER                                 19450000
191100         FROM 1 BY 1                                              19460000
191200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               19470000
191300                   OR (SQLCODE = ZERO))                           19480000
191400         EXEC SQL                                                 19490000
191500             OPEN PTAG-BY-STORE                                   19500000
191600         END-EXEC                                                 19510000
191700                                                                  19520000
191800         EVALUATE TRUE                                            19530000
191900             WHEN SQLCODE = ZERO                                  19540000
192000             WHEN SQLCODE = -904                                  19550000
192100             WHEN SQLCODE = -913                                  19560000
192200                 CONTINUE                                         19570000
192300             WHEN SQLWARN0 NOT = SPACES                           19580000
192400             WHEN SQLCODE < ZERO                                  19590000
192500             WHEN SQLCODE > ZERO                                  19600000
192600                 MOVE '4010-OPEN-CURSOR'                          19610000
192700                                   TO DP013-PARAGRAPH             19620000
192800                 MOVE 'OPEN PTAG BY STORE CURSOR - '              19630014
192900                                   TO DP013-MESSAGE-TEXT (1)      19640000
193000                 MOVE SQLCA        TO DP013-SQLCA                 19650000
193100                 MOVE 'TMRITST '   TO DP013-DB2-TABLE-NAME (1)    19660014
193200                 SET DP013-DB2-ABEND                              19670000
193300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           19680000
193400                 PERFORM DP013-0000-PROCESS-ABEND                 19690000
193500         END-EVALUATE                                             19700000
193600     END-PERFORM.                                                 19710000
193700*                                                                 19720000
193800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        19730000
193900         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             19740000
194000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   19750000
194100                                   TO DP013-MESSAGE-TEXT (1)      19760000
194200         MOVE SQLCA                TO DP013-SQLCA                 19770000
194300         MOVE 'TMRITST '           TO DP013-DB2-TABLE-NAME (1)    19780014
194400         SET DP013-DB2-ABEND                                      19790000
194500             DP013-XCTL-DISPLAY-RESTART                           19800000
194600                                   TO TRUE                        19810000
194700         PERFORM DP013-0000-PROCESS-ABEND                         19820000
194800     END-IF.                                                      19830000
194900                                                                  19840000
195000 EJECT                                                            19850000
195100                                                                  19860000
195200 4020-CLOSE-CURSOR.                                               19870000
195300                                                                  19880000
195400     EXEC SQL                                                     19890000
195500          CLOSE PTAG-BY-STORE                                     19900000
195600     END-EXEC.                                                    19910000
195700*                                                                 19920000
195800     EVALUATE TRUE                                                19930000
195900         WHEN SQLCODE = ZERO                                      19940000
196000             CONTINUE                                             19950000
196100         WHEN SQLWARN0 NOT = SPACES                               19960000
196200         WHEN SQLCODE < ZERO                                      19970000
196300         WHEN SQLCODE > ZERO                                      19980000
196400             MOVE '4020-CLOSE-CURSOR'                             19990000
196500                               TO DP013-PARAGRAPH                 20000000
196600             MOVE 'CLOSE PTAG BY STORE CURSOR '                   20010014
196700                               TO DP013-MESSAGE-TEXT (1)          20020000
196800             MOVE SQLCA        TO DP013-SQLCA                     20030000
196900             MOVE 'TMRITST '   TO DP013-DB2-TABLE-NAME (1)        20040014
197000             SET DP013-DB2-ABEND                                  20050000
197100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               20060000
197200             PERFORM DP013-0000-PROCESS-ABEND                     20070000
197300     END-EVALUATE.                                                20080000
197400                                                                  20090000
197500 EJECT                                                            20100000
197600*----------------------------------------------------------------*20110000
197700*    SET UP THE HOST VARIABLES.                                  *20120000
197800*----------------------------------------------------------------*20130000
197900                                                                  20140000
198000 4100-PREPARE-CURSOR.                                             20150000
198100                                                                  20160000
198200     MOVE ASC-KEY-DEPT-N              TO PV-DEPT-NUMBER-S.        20170022
198400     MOVE ASC-KEY-SKU-N               TO PV-SKU-NUMBER-S.         20180022
198600     MOVE ASC-KEY-PTAG                TO PV-PTAG.                 20190000
198700                                                                  20200000
198800 EJECT                                                            20210000
198900*----------------------------------------------------------------*20220000
199000*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *20230000
199100*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *20240000
199200*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *20250000
199300*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *20260000
199400*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *20270000
199500*                                                                *20280000
199600*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *20290000
199700*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *20300000
199800*    UPON INITIALIZATION.                                        *20310000
199900*----------------------------------------------------------------*20320000
200000                                                                  20330000
200100 4300-READ-ITEMS-FROM-DB.                                         20340000
200200                                                                  20350000
200300     PERFORM                                                      20360000
200400         VARYING PV-READ-COUNT                                    20370000
200500         FROM 1 BY 1                                              20380000
200600         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    20390000
200700            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         20400000
200800                                                                  20410000
200900         PERFORM 4310-FETCH                                       20420000
201000                                                                  20430000
201100         IF  ASC-ITEMS-LEFT-ON-DB                                 20440000
201200             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                20450000
201300                 ADD +1            TO ASC-ITEM-SUB                20460000
201400             ELSE                                                 20470000
201500                 ADD +1            TO ASC-BLK-SUB                 20480000
201600                 MOVE +1           TO ASC-ITEM-SUB                20490000
201700                                                                  20500000
201800                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         20510000
201900                     MOVE +1       TO ASC-BLK-SUB                 20520000
202000                     SET ASC-BLOCK-MODIFIED (1)                   20530000
202100                                   TO TRUE                        20540000
202200                     PERFORM 5100-WRITE-TEMP-STORAGE              20550000
202300                     MOVE ASC-BLOCK-ENTRIES                       20560000
202400                               (PC-MAX-BLOCKS-IN-ARRAY)           20570000
202500                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 20580000
202600                     ADD +1        TO ASC-BLK-SUB                 20590000
202700                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   20600000
202800                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      20610000
202900                                   TO TRUE                        20620000
203000                 END-IF                                           20630000
203100             END-IF                                               20640000
203200             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    20650000
203300             MOVE ASC-NUMBER-OF-ITEMS-READ                        20660000
203400                                   TO ASC-LIST-ITEM-NUMBER        20670000
203500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20680000
203600             MOVE MRITST-PTAG-ID   TO  ASC-PTAG                   20690000
203700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20700000
203800             MOVE SKXREF-DEPT      TO  ASC-DEPT                   20710001
203900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20720001
204000             MOVE SKXREF-CLASS     TO  ASC-CLASS                  20730001
204100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20740001
204200             MOVE SKXREF-SUBCLASS  TO  ASC-SUBCLASS               20750001
204300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20760001
204400             MOVE SKXREF-SKU       TO  ASC-SKU                    20770001
204500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20780001
204600             MOVE TSK-SKU-DESC     TO  ASC-DESCRIPTION            20790000
204700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20800000
204800             MOVE TSK-SIZE-DESC    TO  ASC-SIZE                   20810000
204900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20820000
205000             MOVE TSK-COLOR-DESC   TO  ASC-COLOR                  20830000
205100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20840000
205200             MOVE MRITST-STR-NBR   TO  ASC-STORE                  20850000
205300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20860000
205400         END-IF                                                   20870000
205500     END-PERFORM.                                                 20880000
205600                                                                  20890000
205700     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          20900000
205800         MOVE +1               TO ASC-BLK-SUB                     20910000
205900         PERFORM 5100-WRITE-TEMP-STORAGE                          20920000
206000         ADD +1                TO ASC-BLK-SUB                     20930000
206100         PERFORM 5100-WRITE-TEMP-STORAGE                          20940000
206200                                                                  20950000
206300         MOVE 1                TO ASC-BLK-SUB                     20960000
206400                                  PV-BLOCK-NUMBER                 20970000
206500         PERFORM 4410-READ-TEMP-STORAGE                           20980000
206600         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             20990000
206700             MOVE 2            TO ASC-BLK-SUB                     21000000
206800                                  PV-BLOCK-NUMBER                 21010000
206900             PERFORM 4410-READ-TEMP-STORAGE                       21020000
207000         END-IF                                                   21030000
207100     END-IF.                                                      21040000
207200 EJECT                                                            21050000
207300******************************************************************21060009
207400* MRNIS-RFC   PREVIOUS   DEPT, CLASS, SKU FROM TSK OF FS          21070009
207500* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS, SKU FROM TSKXREF  21080009
207600* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 21090009
207700******************************************************************21100009
207800                                                                  21110000
207900 4310-FETCH.                                                      21120000
208000                                                                  21130000
208100     PERFORM                                                      21140015
208200         WITH TEST AFTER                                          21150015
208300         VARYING PV-SQL-SUB                                       21160015
208400         FROM 1 BY 1                                              21170015
208500         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        21180015
208600           OR (SQLCODE EQUAL ZERO OR +100)                        21190015
208700                                                                  21200015
208800         EXEC SQL                                                 21210015
208900              FETCH PTAG-BY-STORE                                 21220015
209000              INTO                                                21230015
209100                    :MRITST-PTAG-ID                               21240015
209200                  , :SKXREF-DEPT                                  21250015
209300                  , :SKXREF-CLASS                                 21260015
209400                  , :SKXREF-SUBCLASS                              21270015
209500                  , :SKXREF-SKU                                   21280015
209600                  , :TSK-SKU-DESC                                 21290015
209700                  , :TSK-SIZE-DESC                                21300015
209800                  , :TSK-COLOR-DESC                               21310015
209900                  , :MRITST-STR-NBR                               21320015
210000                  , :MRITST-ITEM-NBR                              21330015
210100         END-EXEC                                                 21340015
210200                                                                  21350000
210300         EVALUATE TRUE                                            21360015
210400             WHEN SQLCODE = ZERO                                  21370015
210500             WHEN SQLCODE = +100                                  21380015
210600                  CONTINUE                                        21390015
210700             WHEN SQLWARN0 NOT = SPACE                            21400015
210800             WHEN SQLCODE NOT = ZERO                              21410015
210900                  MOVE '4310-FETCH-CURSOR'                        21420015
211000                                   TO DP013-PARAGRAPH             21430015
211100                  MOVE 'FETCH PTAG BY STORE CURSOR'               21440015
211200                                   TO DP013-MESSAGE-TEXT (1)      21450015
211300                  MOVE SQLCA       TO DP013-SQLCA                 21460015
211400                  SET DP013-DB2-ABEND                             21470015
211500                                   TO TRUE                        21480015
211600                  PERFORM DP013-0000-PROCESS-ABEND                21490015
211700         END-EVALUATE                                             21500015
211800     END-PERFORM.                                                 21510015
211900                                                                  21520000
212000     IF  PV-SQL-SUB > PC-MAX-RETRIES                              21530015
212100         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    21540015
212200                                 TO DP013-MESSAGE-TEXT (1)        21550015
212300         MOVE SQLCA              TO DP013-SQLCA                   21560015
212400         MOVE 'TSKXREF'          TO DP013-DB2-TABLE-NAME (1)      21570015
212500         SET DP013-DB2-ABEND                                      21580015
212600             DP013-XCTL-DISPLAY-RESTART TO TRUE                   21590015
212700         PERFORM DP013-0000-PROCESS-ABEND                         21600015
212800     END-IF.                                                      21610015
212900                                                                  21620015
213000     IF  SQLCODE EQUAL +100                                       21630000
213100         SET ASC-NO-ITEMS-LEFT-ON-DB                              21640000
213200                                   TO TRUE                        21650000
213300     END-IF.                                                      21660000
213400                                                                  21670000
213500 EJECT                                                            21680000
213600*----------------------------------------------------------------*21690000
213700* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *21700000
213800*----------------------------------------------------------------*21710000
213900                                                                  21720000
214000 4400-MOVE-COMMAREA-TO-SCREEN.                                    21730000
214100     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             21740000
214200         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          21750000
214300         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          21760000
214400             MOVE +1    TO ASC-BLK-SUB                            21770000
214500             PERFORM 5100-WRITE-TEMP-STORAGE                      21780000
214600             ADD +1     TO ASC-BLK-SUB                            21790000
214700             PERFORM 5100-WRITE-TEMP-STORAGE                      21800000
214800             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             21810000
214900                 GIVING PV-BLOCK-NUMBER                           21820000
215000                 REMAINDER PV-REMAINDER                           21830000
215100             IF  PV-REMAINDER > ZERO                              21840000
215200                 ADD +1 TO PV-BLOCK-NUMBER                        21850000
215300             END-IF                                               21860000
215400             MOVE +1    TO ASC-BLK-SUB                            21870000
215500             PERFORM 4410-READ-TEMP-STORAGE                       21880000
215600             ADD +1     TO ASC-BLK-SUB                            21890000
215700                           PV-BLOCK-NUMBER                        21900000
215800             PERFORM 4410-READ-TEMP-STORAGE                       21910000
215900     END-IF.                                                      21920000
216000     MOVE +1            TO ASC-BLK-SUB.                           21930000
216100     COMPUTE ASC-ITEM-SUB =                                       21940000
216200         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              21950000
216300         + PC-ITEMS-PER-PANEL).                                   21960000
216400*                                                                 21970000
216500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        21980000
216600         ADD +1         TO ASC-BLK-SUB                            21990000
216700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            22000000
216800     END-IF.                                                      22010000
216900*                                                                 22020000
217000     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           22030000
217100         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                22040000
217200     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        22050000
217300     PERFORM 4420-FORMAT-LIST-LINES                               22060000
217400         VARYING PV-SUB                                           22070000
217500         FROM PC-ITEMS-PER-PANEL BY -1                            22080000
217600         UNTIL PV-SUB < +1.                                       22090000
217700*                                                                 22100000
217800     COMPUTE ASC-ITEMS-DISPLAYED =                                22110000
217900         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          22120000
218000     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    22130000
218100                                      ASTRTITO.                   22140000
218200     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    22150000
218300     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    22160000
218400     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            22170000
218500                                   TO ASELITO.                    22180000
218600*                                                                 22190000
218700     IF  DP020-MSG-NUMBER-X = SPACE                               22200000
218800         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  22210000
218900*            --- MORE ITEMS TO DISPLAY ----                       22220000
219000             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            22230000
219100             SET DP020-MSG-INFORMATIONAL TO TRUE                  22240000
219200         END-IF                                                   22250000
219300     END-IF.                                                      22260000
219400*----------------------------------------------------------------*22270000
219500*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *22280000
219600*----------------------------------------------------------------*22290000
219700                                                                  22300000
219800 4410-READ-TEMP-STORAGE.                                          22310000
219900                                                                  22320000
220000     EXEC CICS                                                    22330000
220100         READQ TS                                                 22340000
220200             QUEUE (ASC-LIST-QUEUE-NAME)                          22350000
220300             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22360000
220400             ITEM  (PV-BLOCK-NUMBER)                              22370000
220500             RESP  (PV-CICS-RESP)                                 22380000
220600     END-EXEC.                                                    22390000
220700                                                                  22400000
220800     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       22410000
220900       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     22420000
221000         CONTINUE                                                 22430000
221100     ELSE                                                         22440000
221200         SET DP013-CICS-ABEND     TO TRUE                         22450000
221300         SET DP013-NO-ROLLBACK    TO TRUE                         22460000
221400         MOVE '4410-READ-TEMP-STORAGE'                            22470000
221500                                  TO DP013-PARAGRAPH              22480000
221600         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      22490000
221700                                  TO DP013-MESSAGE-TEXT(1)        22500000
221800         PERFORM DP013-0000-PROCESS-ABEND                         22510000
221900     END-IF.                                                      22520000
222000                                                                  22530000
222100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             22540000
222200*                                                                 22550000
222300     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         22560000
222400         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               22570000
222500     END-IF.                                                      22580000
222600 EJECT                                                            22590000
222700*----------------------------------------------------------------*22600000
222800*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *22610000
222900*----------------------------------------------------------------*22620000
223000                                                                  22630000
223100 4420-FORMAT-LIST-LINES.                                          22640000
223200     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      22650000
223300         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                22660000
223400         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           22670000
223500         MOVE SPACE              TO MR-SELECTI (PV-SUB)           22680000
223600                                    MR-ACTION (PV-SUB)            22690000
223700                                    MR-PTAG (PV-SUB)              22700000
223800                                    MR-DEPT (PV-SUB)              22710001
223900                                    MR-CLASS (PV-SUB)             22720001
224000                                    MR-SCLASS (PV-SUB)            22730001
224100                                    MR-SKU (PV-SUB)               22740001
224200                                    MR-DESCRIPTION (PV-SUB)       22750000
224300                                    MR-SIZE (PV-SUB)              22760000
224400                                    MR-COLOR (PV-SUB)             22770000
224500                                    MR-STORE (PV-SUB)             22780000
224600     ELSE                                                         22790000
224700         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      22800000
224800                                                   > SPACE        22810000
224900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 22820000
225000                                 TO MR-SELECTI (PV-SUB)           22830000
225100         ELSE                                                     22840000
225200             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      22850000
225300                                 TO MR-SELECTI (PV-SUB)           22860000
225400         END-IF                                                   22870000
225500*                                                                 22880000
225600         IF  DP030-SET-CURSOR-TRAILER                             22890000
225700             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)22900000
225800                 > SPACE)                                         22910000
225900               OR (PV-SUB = 1))                                   22920000
226000                SET DP030-SET-CURSOR-APPL-1 TO TRUE               22930000
226100                MOVE -1          TO MR-SELECTL (PV-SUB)           22940000
226200             END-IF                                               22950000
226300         END-IF                                                   22960000
226400*                                                                 22970000
226500         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           22980000
226600             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           22990000
226700                                 TO MR-ACTION (PV-SUB)            23000000
226800             MOVE ASC-PTAG (ASC-BLK-SUB ASC-ITEM-SUB)             23010000
226900                                 TO MR-PTAG (PV-SUB)              23020000
227000             MOVE ASC-DEPT (ASC-BLK-SUB ASC-ITEM-SUB)             23030001
227100                                 TO MR-DEPT (PV-SUB)              23040001
227200             MOVE ASC-CLASS (ASC-BLK-SUB ASC-ITEM-SUB)            23050001
227300                                 TO MR-CLASS (PV-SUB)             23060001
227400             MOVE ASC-SUBCLASS (ASC-BLK-SUB ASC-ITEM-SUB)         23070001
227500                                 TO MR-SCLASS (PV-SUB)            23080001
227600             MOVE ASC-SKU (ASC-BLK-SUB ASC-ITEM-SUB)              23090001
227700                                 TO MR-SKU (PV-SUB)               23100001
227800             MOVE ASC-DESCRIPTION (ASC-BLK-SUB ASC-ITEM-SUB)      23110000
227900                                 TO MR-DESCRIPTION (PV-SUB)       23120000
228000             MOVE ASC-SIZE (ASC-BLK-SUB ASC-ITEM-SUB)             23130000
228100                                 TO MR-SIZE (PV-SUB)              23140000
228200             MOVE ASC-COLOR (ASC-BLK-SUB ASC-ITEM-SUB)            23150000
228300                                 TO MR-COLOR (PV-SUB)             23160000
228400             MOVE ASC-STORE (ASC-BLK-SUB ASC-ITEM-SUB)            23170000
228500                                 TO MR-STORE (PV-SUB)             23180000
228600         END-IF                                                   23190000
228700     END-IF.                                                      23200000
228800     SUBTRACT +1 FROM ASC-ITEM-SUB                                23210000
228900     IF  ASC-ITEM-SUB < + 1                                       23220000
229000         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  23230000
229100         MOVE +1                 TO ASC-BLK-SUB                   23240000
229200     END-IF.                                                      23250000
229300******************************************************************23260000
229400** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **23270000
229500** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **23280000
229600** ISSUE A WARNING.                                             **23290000
229700******************************************************************23300000
229800 4430-CHECK-FOR-BEGIN-AND-END.                                    23310000
229900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       23320000
230000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     23330000
230100*            -- NO END-OF-RANGE SPECFIED ---                      23340000
230200             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            23350000
230300             SET DP020-MSG-WARNING TO TRUE                        23360000
230400             PERFORM 4431-POSITION-AT-WARNING                     23370000
230500         END-IF                                                   23380000
230600     ELSE                                                         23390000
230700         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     23400000
230800*            -- NO BEGINNING-OF-RANGE SPECFIED ---                23410000
230900             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            23420000
231000             SET DP020-MSG-WARNING TO TRUE                        23430000
231100             PERFORM 4431-POSITION-AT-WARNING                     23440000
231200         END-IF                                                   23450000
231300     END-IF.                                                      23460000
231400******************************************************************23470000
231500** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **23480000
231600** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **23490000
231700** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **23500000
231800** POSITION THE CURSOR THERE.                                   **23510000
231900******************************************************************23520000
232000 4431-POSITION-AT-WARNING.                                        23530000
232100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 23540000
232200                    - PV-TOP-ITEM + 1.                            23550000
232300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23560000
232400         CONTINUE                                                 23570000
232500     ELSE                                                         23580000
232600         SET DP030-SET-CURSOR-APPL-1                              23590000
232700                                   TO TRUE                        23600000
232800         MOVE -1                   TO MR-SELECTL (PV-SUB)         23610000
232900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         23620000
233000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         23630000
233100     END-IF.                                                      23640000
233200*                                                                 23650000
233300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   23660000
233400                    - PV-TOP-ITEM + 1.                            23670000
233500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23680000
233600         CONTINUE                                                 23690000
233700     ELSE                                                         23700000
233800         SET DP030-SET-CURSOR-APPL-1                              23710000
233900                                   TO TRUE                        23720000
234000         MOVE -1                   TO MR-SELECTL (PV-SUB)         23730000
234100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         23740000
234200         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         23750000
234300     END-IF.                                                      23760000
234400 EJECT                                                            23770000
234500*----------------------------------------------------------------*23780000
234600* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *23790000
234700* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *23800000
234800* FOR THE SELECTED ITEMS QUEUE.                                  *23810000
234900*                                                                *23820000
235000* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *23830000
235100* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *23840000
235200* THE ARRAY IS FULL.                                             *23850000
235300*----------------------------------------------------------------*23860000
235400                                                                  23870000
235500 5000-PREPARE-SEL-QUEUE.                                          23880000
235600                                                                  23890000
235700     MOVE +1                   TO  ASC-BLK-SUB.                   23900000
235800     PERFORM 5100-WRITE-TEMP-STORAGE.                             23910000
235900     ADD +1                    TO  ASC-BLK-SUB.                   23920000
236000     PERFORM 5100-WRITE-TEMP-STORAGE.                             23930000
236100                                                                  23940000
236200     MOVE ASC-SEL-QUEUE-NAME   TO  MR102-SEL-QUEUE-NAME.          23950000
236300     PERFORM 6010-DELETE-SEL-QUEUE.                               23960000
236400                                                                  23970000
236500     SET ASC-UPDATE-TSQ        TO  TRUE.                          23980000
236600                                                                  23990000
236700     SET MR115-IDX             TO  1.                             24000000
236800     MOVE ZERO                 TO MR102-NUMBER-OF-TS-ITEMS.       24010000
236900     INITIALIZE MR115-SELECTED-ITEM-ARRAY.                        24020000
237000                                                                  24030000
237100     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           24040000
237200             VARYING PV-ITEM                                      24050000
237300             FROM 1 BY 1                                          24060000
237400             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     24070000
237500                                                                  24080000
237600     IF  MR115-IDX > 1                                            24090000
237700         PERFORM 5205-WRITE-SEL-QUEUE                             24100000
237800         ADD +1                TO MR102-NUMBER-OF-TS-ITEMS        24110000
237900     END-IF.                                                      24120000
238000 EJECT                                                            24130000
238100*----------------------------------------------------------------*24140000
238200*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *24150000
238300*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *24160000
238400*----------------------------------------------------------------*24170000
238500                                                                  24180000
238600 5100-WRITE-TEMP-STORAGE.                                         24190000
238700     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     24200000
238800                                   TO PV-LIST-ITEM-NUMBER.        24210000
238900     COMPUTE PV-BLOCK-NUMBER =                                    24220000
239000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    24230000
239100                                                                  24240000
239200     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             24250000
239300     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             24260000
239400         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      24270000
239500             PERFORM 5105-REWRITE-ASC-LISTQ                       24280000
239600         END-IF                                                   24290000
239700     ELSE                                                         24300000
239800         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       24310000
239900         ASC-HIGHEST-BLOCK-WRITTEN + 1                            24320000
240000         PERFORM 5110-WRITE-ASC-LISTQ                             24330000
240100         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   24340000
240200     END-IF.                                                      24350000
240300                                                                  24360000
240400     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             24370000
240500******************************************************************24380000
240600** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **24390000
240700** SPECIFIC COMMAREA.                                           **24400000
240800******************************************************************24410000
240900 5105-REWRITE-ASC-LISTQ.                                          24420000
241000     EXEC CICS                                                    24430000
241100         WRITEQ TS                                                24440000
241200             QUEUE (ASC-LIST-QUEUE-NAME)                          24450000
241300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24460000
241400             ITEM  (PV-BLOCK-NUMBER)                              24470000
241500             REWRITE                                              24480000
241600             RESP  (PV-CICS-RESP)                                 24490000
241700     END-EXEC.                                                    24500000
241800                                                                  24510000
241900     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           24520000
242000         CONTINUE                                                 24530000
242100     ELSE                                                         24540000
242200         SET DP013-CICS-ABEND            TO TRUE                  24550000
242300         SET DP013-NO-ROLLBACK           TO TRUE                  24560000
242400         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       24570000
242500         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     24580000
242600                                         TO DP013-MESSAGE-TEXT(1) 24590000
242700         PERFORM DP013-0000-PROCESS-ABEND                         24600000
242800     END-IF.                                                      24610000
242900                                                                  24620000
243000******************************************************************24630000
243100** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **24640000
243200** SPECIFIC COMMAREA.                                           **24650000
243300******************************************************************24660000
243400 5110-WRITE-ASC-LISTQ.                                            24670000
243500     EXEC CICS                                                    24680000
243600         WRITEQ TS                                                24690000
243700             QUEUE (ASC-LIST-QUEUE-NAME)                          24700000
243800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24710000
243900             ITEM  (PV-BLOCK-NUMBER)                              24720000
244000             RESP  (PV-CICS-RESP)                                 24730000
244100     END-EXEC.                                                    24740000
244200     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      24750000
244300         SET DP013-CICS-ABEND      TO TRUE                        24760000
244400         SET DP013-NO-ROLLBACK     TO TRUE                        24770000
244500         MOVE '5110-WRITE-ASC-LISTQ'                              24780000
244600                                   TO DP013-PARAGRAPH             24790000
244700         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           24800000
244800                                   TO DP013-MESSAGE-TEXT(1)       24810000
244900         PERFORM DP013-0000-PROCESS-ABEND                         24820000
245000     END-IF.                                                      24830000
245100 EJECT                                                            24840000
245200*----------------------------------------------------------------*24850000
245300* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *24860000
245400* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *24870000
245500*----------------------------------------------------------------*24880000
245600 5200-FILL-SEL-QUEUE-RECORD.                                      24890000
245700                                                                  24900000
245800     PERFORM 6112-READ-LIST-QUEUE.                                24910000
245900                                                                  24920000
246000     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       24930000
246100         PERFORM                                                  24940000
246200         VARYING LQW-IDX                                          24950000
246300         FROM 1 BY 1                                              24960000
246400         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            24970000
246500           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          24980000
246600                                                                  24990000
246700             IF  LQW-SELECT (LQW-IDX)                             25000000
246800                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              25010000
246900                                   TO MR115-ITEM (MR115-IDX)      25020000
247000                 MOVE LQW-SKU (LQW-IDX)                           25030000
247100                                   TO MR115-SKU (MR115-IDX)       25040000
247200                 MOVE LQW-DEPT (LQW-IDX)                          25050011
247300                                   TO MR115-DEPT (MR115-IDX)      25060011
247400                                      ASC-KEY-DEPT                25070011
247500                 MOVE LQW-CLASS (LQW-IDX)                         25080011
247600                                   TO MR115-CLASS (MR115-IDX)     25090011
247700                                      ASC-KEY-CLASS               25100011
247800                 MOVE LQW-SCLASS (LQW-IDX)                        25110011
247900                                   TO MR115-SUBCLASS (MR115-IDX)  25120011
248000                                      ASC-KEY-SUBCLASS            25130011
248100                 MOVE LQW-PTAG (LQW-IDX)                          25140000
248200                                   TO MR115-PTAG (MR115-IDX)      25150000
248300                                      ASC-KEY-PTAG                25160000
248400                 MOVE LQW-DESCRIPTION (LQW-IDX)                   25170000
248500                                 TO MR115-DESCRIPTION (MR115-IDX) 25180000
248600                 MOVE LQW-SIZE (LQW-IDX)                          25190000
248700                                   TO MR115-SIZE (MR115-IDX)      25200000
248800                 MOVE LQW-COLOR (LQW-IDX)                         25210000
248900                                   TO MR115-COLOR (MR115-IDX)     25220000
249000                 MOVE LQW-STORE (LQW-IDX)                         25230000
249100                                   TO MR115-STORE (MR115-IDX)     25240000
249200                 SET MR115-IDX UP BY 1                            25250000
249300                 IF  MR115-IDX > MR115-MAX-ITEMS                  25260000
249400                     PERFORM 5205-WRITE-SEL-QUEUE                 25270000
249500                     ADD +1        TO MR102-NUMBER-OF-TS-ITEMS    25280000
249600                     INITIALIZE MR115-SELECTED-ITEM-ARRAY         25290000
249700                     SET MR115-IDX TO  1                          25300000
249800                 END-IF                                           25310000
249900             END-IF                                               25320000
250000         END-PERFORM                                              25330000
250100     END-IF.                                                      25340000
250200                                                                  25350000
250300*----------------------------------------------------------------*25360000
250400*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *25370000
250500*----------------------------------------------------------------*25380000
250600                                                                  25390000
250700 5205-WRITE-SEL-QUEUE.                                            25400000
250800                                                                  25410000
250900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            25420000
251000                                   TO MR115-SELECTED-ITEMS.       25430000
251100                                                                  25440000
251200     EXEC CICS                                                    25450000
251300          WRITEQ TS                                               25460000
251400              QUEUE (ASC-SEL-QUEUE-NAME)                          25470000
251500              FROM  (MR115-MESSAGE-SEL-REC)                       25480000
251600              ITEM  (PV-SEL-QUEUE-ITEM)                           25490000
251700              RESP  (PV-CICS-RESP)                                25500000
251800     END-EXEC.                                                    25510000
251900                                                                  25520000
252000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25530000
252100         CONTINUE                                                 25540000
252200     ELSE                                                         25550000
252300         SET DP013-CICS-ABEND      TO TRUE                        25560000
252400         SET DP013-NO-ROLLBACK     TO TRUE                        25570000
252500         MOVE '5205-WRITE-SEL-QUEUE'                              25580000
252600                                   TO DP013-PARAGRAPH             25590000
252700         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          25600000
252800                                   TO DP013-MESSAGE-TEXT(1)       25610000
252900         PERFORM DP013-0000-PROCESS-ABEND                         25620000
253000     END-IF.                                                      25630000
253100 EJECT                                                            25640000
253200******************************************************************25650000
253300** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **25660000
253400** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **25670000
253500** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **25680000
253600** THE USER.                                                    **25690000
253700******************************************************************25700000
253800 6000-REFRESH-PANEL-FROM-TEMP.                                    25710000
253900     IF  ASC-UPDATE-TSQ                                           25720000
254000         SET ASC-NO-TSQ-UPDATE TO TRUE                            25730000
254100         MOVE ZERO                 TO PV-SAVE-ITEM                25740000
254200                                      PV-SEL-QUEUE-ITEM           25750000
254300         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        25760000
254400                                   TO PV-HOLD-SELECTED-ITEMS      25770000
254500         PERFORM 6100-UPDATE-TSQ                                  25780000
254600             UNTIL PV-ITEMS-PROCESSED >                           25790000
254700                                     ASC-NUMBER-OF-SELECTED-ITEMS 25800000
254800         PERFORM 6010-DELETE-SEL-QUEUE                            25810000
254900         INITIALIZE ASC-BLOCK-ENTRIES (1)                         25820000
255000                    ASC-BLOCK-ENTRIES (2)                         25830000
255100     END-IF.                                                      25840000
255200                                                                  25850000
255300*----------------------------------------------------------------*25860000
255400*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *25870000
255500*----------------------------------------------------------------*25880000
255600 6010-DELETE-SEL-QUEUE.                                           25890000
255700                                                                  25900000
255800     EXEC CICS                                                    25910000
255900         DELETEQ TS                                               25920000
256000             QUEUE (ASC-SEL-QUEUE-NAME)                           25930000
256100             RESP  (PV-CICS-RESP)                                 25940000
256200     END-EXEC.                                                    25950000
256300*                                                                 25960000
256400     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      25970000
256500        (PV-CICS-RESP = DFHRESP(QIDERR)))                         25980000
256600         CONTINUE                                                 25990000
256700     ELSE                                                         26000000
256800         SET DP013-CICS-ABEND TO TRUE                             26010000
256900         SET DP013-NO-ROLLBACK TO TRUE                            26020000
257000         MOVE '6010-DELETE-SEL-QUEUE'                             26030000
257100                        TO DP013-PARAGRAPH                        26040000
257200         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         26050000
257300                        TO DP013-MESSAGE-TEXT (1)                 26060000
257400         PERFORM DP013-0000-PROCESS-ABEND                         26070000
257500     END-IF.                                                      26080000
257600                                                                  26090000
257700*----------------------------------------------------------------*26100000
257800*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *26110000
257900*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *26120000
258000*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *26130000
258100*    THE TEMP QUEUE.                                             *26140000
258200*----------------------------------------------------------------*26150000
258300                                                                  26160000
258400 6100-UPDATE-TSQ.                                                 26170000
258500                                                                  26180000
258600     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             26190000
258700     PERFORM 6105-READ-SEL-QUEUE.                                 26200000
258800     PERFORM                                                      26210000
258900         VARYING MR115-IDX                                        26220000
259000         FROM 1 BY 1                                              26230000
259100         UNTIL ((PV-ITEMS-PROCESSED >                             26240000
259200                              PV-HOLD-SELECTED-ITEMS)             26250000
259300         OR (MR115-IDX GREATER THAN MR115-MAX-ITEMS))             26260000
259400         IF  MR115-ACTION-SW (MR115-IDX) > SPACE                  26270000
259500             PERFORM 6110-PROCESS-ITEMS                           26280000
259600         END-IF                                                   26290000
259700         ADD +1                TO PV-ITEMS-PROCESSED              26300000
259800     END-PERFORM.                                                 26310000
259900     PERFORM 6111-WRITE-LIST-QUEUE.                               26320000
260000*----------------------------------------------------------------*26330000
260100*    READ THE LIST QUEUE RECORD.                                 *26340000
260200*----------------------------------------------------------------*26350000
260300                                                                  26360000
260400 6105-READ-SEL-QUEUE.                                             26370000
260500                                                                  26380000
260600     EXEC CICS                                                    26390000
260700          READQ TS                                                26400000
260800              QUEUE (ASC-SEL-QUEUE-NAME)                          26410000
260900              INTO  (MR115-MESSAGE-SEL-REC)                       26420000
261000              ITEM  (PV-SEL-QUEUE-ITEM)                           26430000
261100              RESP  (PV-CICS-RESP)                                26440000
261200     END-EXEC.                                                    26450000
261300*                                                                 26460000
261400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26470000
261500         CONTINUE                                                 26480000
261600     ELSE                                                         26490000
261700         SET DP013-CICS-ABEND      TO  TRUE                       26500000
261800         SET DP013-NO-ROLLBACK     TO  TRUE                       26510000
261900         MOVE '6105-READ-SEL-QUEUE'                               26520000
262000                                   TO  DP013-PARAGRAPH            26530000
262100         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           26540000
262200                                   TO  DP013-MESSAGE-TEXT(1)      26550000
262300         PERFORM DP013-0000-PROCESS-ABEND                         26560000
262400     END-IF.                                                      26570000
262500 EJECT                                                            26580000
262600*----------------------------------------------------------------*26590000
262700*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*26600000
262800*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*26610000
262900*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *26620000
263000*----------------------------------------------------------------*26630000
263100                                                                  26640000
263200 6110-PROCESS-ITEMS.                                              26650000
263300                                                                  26660000
263400     COMPUTE PV-ITEM = 1 + ((MR115-ITEM (MR115-IDX) - 1)          26670000
263500                     / PC-ITEMS-PER-PANEL).                       26680000
263600                                                                  26690000
263700     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           26700000
263800         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          26710000
263900             PERFORM 6111-WRITE-LIST-QUEUE                        26720000
264000         END-IF                                                   26730000
264100         MOVE PV-ITEM          TO PV-SAVE-ITEM                    26740000
264200                                                                  26750000
264300         PERFORM 6112-READ-LIST-QUEUE                             26760000
264400         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               26770000
264500             CONTINUE                                             26780000
264600         END-IF                                                   26790000
264700     END-IF.                                                      26800000
264800                                                                  26810000
264900     COMPUTE PV-SUB = (MR115-ITEM (MR115-IDX)                     26820000
265000                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              26830000
265100     SET LQW-DESELECT (PV-SUB) TO    TRUE                         26840000
265200     MOVE LQW-SELECTED-SW (PV-SUB)                                26850000
265300                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  26860000
265400     EVALUATE TRUE                                                26870000
265500         WHEN MR115-INQ (MR115-IDX)                               26880000
265600              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             26890000
265700                                                                  26900000
265800         WHEN MR115-UPD (MR115-IDX)                               26910000
265900              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             26920000
266000                                                                  26930000
266100         WHEN MR115-DEL (MR115-IDX)                               26940000
266200              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             26950000
266300                                                                  26960000
266400         WHEN MR115-ERR (MR115-IDX)                               26970000
266500              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             26980000
266600     END-EVALUATE.                                                26990000
266700                                                                  27000000
266800     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                27010000
266900                                                                  27020000
267000*----------------------------------------------------------------*27030000
267100*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *27040000
267200*----------------------------------------------------------------*27050000
267300                                                                  27060000
267400 6111-WRITE-LIST-QUEUE.                                           27070000
267500                                                                  27080000
267600     EXEC CICS                                                    27090000
267700         WRITEQ TS                                                27100000
267800             QUEUE (ASC-LIST-QUEUE-NAME)                          27110000
267900             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     27120000
268000             ITEM  (PV-SAVE-ITEM)                                 27130000
268100             REWRITE                                              27140000
268200             RESP  (PV-CICS-RESP)                                 27150000
268300     END-EXEC.                                                    27160000
268400*                                                                 27170000
268500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27180000
268600         CONTINUE                                                 27190000
268700     ELSE                                                         27200000
268800         SET DP013-CICS-ABEND  TO  TRUE                           27210000
268900         SET DP013-NO-ROLLBACK TO  TRUE                           27220000
269000         MOVE '6111-WRITE-LIST-QUEUE'                             27230000
269100                               TO  DP013-PARAGRAPH                27240000
269200         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  27250000
269300                               TO  DP013-MESSAGE-TEXT(1)          27260000
269400         PERFORM DP013-0000-PROCESS-ABEND                         27270000
269500     END-IF.                                                      27280000
269600                                                                  27290000
269700 EJECT                                                            27300000
269800*----------------------------------------------------------------*27310000
269900*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*27320000
270000*----------------------------------------------------------------*27330000
270100                                                                  27340000
270200 6112-READ-LIST-QUEUE.                                            27350000
270300                                                                  27360000
270400     EXEC CICS                                                    27370000
270500         READQ TS                                                 27380000
270600             QUEUE (ASC-LIST-QUEUE-NAME)                          27390000
270700             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     27400000
270800             ITEM  (PV-ITEM)                                      27410000
270900             RESP  (PV-CICS-RESP)                                 27420000
271000     END-EXEC.                                                    27430000
271100*                                                                 27440000
271200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27450000
271300         CONTINUE                                                 27460000
271400     ELSE                                                         27470000
271500         SET DP013-CICS-ABEND        TO TRUE                      27480000
271600         SET DP013-NO-ROLLBACK       TO TRUE                      27490000
271700         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           27500000
271800         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    27510000
271900                                     TO DP013-MESSAGE-TEXT(1)     27520000
272000         PERFORM DP013-0000-PROCESS-ABEND                         27530000
272100     END-IF.                                                      27540000
272200                                                                  27550000
272300 EJECT                                                            27560000
272400*----------------------------------------------------------------*27570000
272500* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *27580000
272600*----------------------------------------------------------------*27590000
272700 9200-REWRITE-LIST-QUEUE.                                         27600000
272800     EXEC CICS                                                    27610000
272900          WRITEQ TS                                               27620000
273000              QUEUE  (ASC-SEL-QUEUE-NAME)                         27630000
273100              FROM   (MR115-MESSAGE-SEL-REC)                      27640000
273200              ITEM   (PV-SEL-QUEUE-ITEM)                          27650000
273300              RESP   (PV-CICS-RESP)                               27660000
273400              REWRITE                                             27670000
273500     END-EXEC.                                                    27680000
273600                                                                  27690000
273700     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   27700000
273800         SET DP013-CICS-ABEND                                     27710000
273900             DP013-NO-ROLLBACK     TO TRUE                        27720000
274000         MOVE '9200-REWRITE-LIST-QUEUE'                           27730000
274100                                   TO DP013-PARAGRAPH             27740000
274200         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   27750000
274300                                   TO DP013-MESSAGE-TEXT (1)      27760000
274400         PERFORM DP013-0000-PROCESS-ABEND                         27770000
274500     END-IF.                                                      27780000
274600                                                                  27790000
274700*----------------------------------------------------------------*27800000
274800*    ABEND PROCESSOR MODULE                                      *27810000
274900*----------------------------------------------------------------*27820000
275000                                                                  27830000
275100     COPY DPPD013.                                                27840000
