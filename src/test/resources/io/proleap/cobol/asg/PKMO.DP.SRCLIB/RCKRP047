000100 IDENTIFICATION DIVISION.                                                 
000200 TITLE 'PACK BY STORE OVERAGE REPORT'.                                    
000300                                                                          
000400 PROGRAM-ID.             RCKRP047.                                        
000500 AUTHOR.                 DENNIS STEFFEN.                                  
000600 INSTALLATION.           KOHLS DEPARTMENT STORES.                         
000700 DATE-WRITTEN.           MAY 2006.                                        
000800 DATE-COMPILED.                                                           
001700*---------------------------------------------------------------*         
001700* CHANGE HISTORY                                                *         
001300*     MADE BY: PRITHIVIRAJ SUBRAMANIAN (COGNIZANT)              *         
001300*     DATE:    10/24/2014                                       *         
001300*                                                               *         
001300*      CHANGES THRU OUT THE PROGRAM TO INCREASE THE SIZE OF PO# *         
001300*      FROM 7 DIGITS TO 8 DIGITS. TAGGED WITH *PS 10/24/2014    *         
001700*---------------------------------------------------------------*         
000900                                                                          
001000 ENVIRONMENT DIVISION.                                                    
001100 CONFIGURATION SECTION.                                                   
001200 SOURCE-COMPUTER.                        IBM-3090.                        
001300 OBJECT-COMPUTER.                        IBM-3090.                        
001400 INPUT-OUTPUT SECTION.                                                    
001500 FILE-CONTROL.                                                            
001600                                                                          
001700     SELECT EXTRACT-FILE                                                  
001800         ASSIGN TO INP01.                                                 
001900                                                                          
002000     SELECT  REPORT-FILE                                                  
002100         ASSIGN TO RPT01.                                                 
002200                                                                          
002300                                                                          
002400 DATA DIVISION.                                                           
002500 FILE SECTION.                                                            
002600                                                                          
002700 FD  EXTRACT-FILE                                                         
002800     RECORDING MODE IS F                                                  
002900     LABEL RECORDS ARE STANDARD                                           
003000     BLOCK CONTAINS 0 RECORDS.                                            
003100 01  ERROR-RECORD                     PIC X(080).                         
003200                                                                          
003300 FD  REPORT-FILE                                                          
003400     RECORDING MODE IS F                                                  
003500     LABEL RECORDS ARE STANDARD                                           
003600     BLOCK CONTAINS 0 RECORDS.                                            
003700 01  REPORT-RECORD                    PIC X(132).                         
003800/                                                                         
003900 WORKING-STORAGE SECTION.                                                 
004000 01  PS-SWITCHES.                                                         
004100     05  PS-EOF-ERROR-SWITCH          PIC X(01) VALUE 'N'.                
004200         88  PS-EOF-ERROR-FILE                  VALUE 'Y'.                
004300                                                                          
004400 01  ABEND-CODE                       PIC S9(04) VALUE ZERO               
004500                                                 COMP SYNC.               
004600     88  ABEND-4013-DB2-ERROR                        VALUE +4013.         
004700                                                                          
004800 01  SD-SYSTEM-DATE.                                                      
004900     05  SD-SYSTEM-DATE-YY          PIC  9(02)   VALUE ZERO.              
005000     05  SD-SYSTEM-DATE-MM          PIC  9(02)   VALUE ZERO.              
005100     05  SD-SYSTEM-DATE-DD          PIC  9(02)   VALUE ZERO.              
005200                                                                          
005300 01  ST-SYSTEM-TIME.                                                      
005400     05  ST-SYSTEM-HOUR             PIC  9(02)   VALUE ZERO.              
005500     05  ST-SYSTEM-MINUTE           PIC  9(02)   VALUE ZERO.              
005600     05  FILLER                     PIC  9(04)   VALUE ZERO.              
005700                                                                          
005800 01  PV-VARIABLES.                                                        
005900     05  PV-TMST                      PIC X(26) VALUE SPACES.             
006000     05  PV-READ-COUNT                PIC S9(7) COMP-3                    
006100                                                VALUE ZERO.               
006200     05  PV-WRITE-COUNT               PIC S9(7) COMP-3                    
006300                                                VALUE ZERO.               
006400     05  PV-PAGE-COUNT                PIC S9(3) COMP-3                    
006500                                                VALUE ZERO.               
006600     05  PV-LINES-USED              PIC S9(04)   VALUE ZERO               
006700                                                  COMP SYNC.              
006800     05  PV-DB2-FUNCTION              PIC X(30) VALUE SPACES.             
006900     05  PV-PARAGRAPH                 PIC X(30) VALUE SPACES.             
007000     05  PV-DISP-NUMBER               PIC Z,ZZZ,ZZ9.                      
007100                                                                          
007200     05  PV-RUN-DATE                  PIC X(10) VALUE SPACES.             
007300     05  PV-SAVE-START-DATE           PIC X(10) VALUE SPACES.             
007400     05  PV-CURR-VENDOR               PIC X(20).                          
007500     05  PV-PREV-VENDOR               PIC X(20).                          
007600                                                                          
007700 01  PC-CONSTANTS.                                                        
007800     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'RCKRP047'.         
007900     05  PC-END-OF-PAGE               PIC S9(3) COMP-3 VALUE +60.         
008000/                                                                         
008100***  STANDARD REPORT HEADER FOR 132 COLUMN REPORT                         
008200     COPY DPWS132O.                                                       
008300                                                                          
008400*    REPORT EXTRACT                                                       
008500     COPY RCRD023.                                                        
008600                                                                          
008700 01  HL-HEADING-LINE-1.                                                   
008800     05  FILLER                      PIC  X(38)  VALUE SPACES.            
008900     05  FILLER                      PIC  X(36)  VALUE                    
009000      '          PBS OVERAGE REPORT        '.                             
009100     05  FILLER                      PIC  X(37)  VALUE SPACES.            
009200                                                                          
009300 01  HL-HEADING-LINE-2A.                                                  
009400     05  FILLER                      PIC  X(24) VALUE  SPACES.            
009500     05  FILLER                      PIC  X(02) VALUE                     
009600         'PO'.                                                            
009700     05  FILLER                      PIC  X(05) VALUE  SPACES.            
009800     05  FILLER                      PIC  X(03) VALUE                     
009900         'OTB'.                                                           
010000     05  FILLER                      PIC  X(07) VALUE  SPACES.            
010100     05  FILLER                      PIC  X(08) VALUE                     
010200         'ORIG ORD'.                                                      
010300     05  FILLER                      PIC  X(09) VALUE  SPACES.            
010400     05  FILLER                      PIC  X(06) VALUE                     
010500         'VERIFY'.                                                        
010510     05  FILLER                      PIC  X(08) VALUE  SPACES.            
010520     05  FILLER                      PIC  X(08) VALUE                     
010530         'VERIFIED'.                                                      
010600     05  FILLER                      PIC  X(27) VALUE  SPACES.            
010610     05  FILLER                      PIC  X(03) VALUE                     
010620         'A/P'.                                                           
010630     05  FILLER                      PIC  X(10) VALUE  SPACES.            
010640     05  FILLER                      PIC  X(03) VALUE                     
010650         'A/P'.                                                           
010660     05  FILLER                      PIC  X(12) VALUE  SPACES.            
010700                                                                          
010800 01  HL-HEADING-LINE-2.                                                   
010900     05  FILLER                      PIC  X(04) VALUE  SPACES.            
011000     05  FILLER                      PIC  X(11) VALUE                     
011100         'VENDOR NAME'.                                                   
011200     05  FILLER                      PIC  X(07) VALUE  SPACES.            
011300     05  FILLER                      PIC  X(06) VALUE                     
011400         'NUMBER'.                                                        
011500     05  FILLER                      PIC  X(03) VALUE  SPACES.            
011600     05  FILLER                      PIC  X(03) VALUE                     
011700         'MTH'.                                                           
011800     05  FILLER                      PIC  X(07) VALUE  SPACES.            
011900     05  FILLER                      PIC  X(08) VALUE                     
012000         'QUANTITY'.                                                      
012100     05  FILLER                      PIC  X(07) VALUE  SPACES.            
012200     05  FILLER                      PIC  X(08) VALUE                     
012300         'QUANTITY'.                                                      
012400     05  FILLER                      PIC  X(08) VALUE  SPACES.            
012500     05  FILLER                      PIC  X(08) VALUE                     
012600         'VARIANCE'.                                                      
012700     05  FILLER                      PIC  X(04) VALUE  SPACES.            
012800     05  FILLER                      PIC  X(15) VALUE                     
012900         'EXTENDED RETAIL'.                                               
012910     05  FILLER                      PIC  X(08) VALUE  SPACES.            
012920     05  FILLER                      PIC  X(03) VALUE                     
012930         'QTY'.                                                           
012940     05  FILLER                      PIC  X(09) VALUE  SPACES.            
012950     05  FILLER                      PIC  X(08) VALUE                     
012960         'VARIANCE'.                                                      
012970     05  FILLER                      PIC  X(08) VALUE  SPACES.            
013100                                                                          
013200 01  DL-DETAIL-LINE-1.                                                    
013300     05  FILLER                      PIC  X(01).                          
013400     05  DL-VENDOR-NAME              PIC  X(20).                          
013600*PS 10/24/2014 CHANGE STARTS                                              
013500     05  FILLER                      PIC  X(01).                          
013600     05  DL-PO-NBR                   PIC  9(08).                          
013600*PS 10/24/2014 CHANGE ENDS                                                
013700     05  FILLER                      PIC  X(02).                          
013800     05  DL-OTB-MONTH                PIC  X(03).                          
013900     05  FILLER                      PIC  X(05).                          
014000     05  DL-ORIG-ORD-QTY             PIC  ZZ,ZZZ,ZZ9.                     
014100     05  FILLER                      PIC  X(05).                          
014200     05  DL-VERFIFY-QTY              PIC  ZZ,ZZZ,ZZ9.                     
014300     05  FILLER                      PIC  X(05).                          
014400     05  DL-VARIANCE                 PIC  ZZ,ZZZ,ZZ9.                     
014500     05  FILLER                      PIC  X(05).                          
014600     05  DL-EXTENDED-RETAIL          PIC  ZZZ,ZZZ,ZZ9.99-.                
014601     05  FILLER                      PIC  X(03).                          
014610     05  DL-AP-INVOICE-QTY           PIC  ZZ,ZZZ,ZZ9.                     
014620     05  FILLER                      PIC  X(03).                          
014621     05  DL-AP-INVOICE-VARIANCE      PIC  ZZ,ZZZ,ZZ9.                     
014622     05  FILLER                      PIC  X(06).                          
014630*                                                                         
014800                                                                          
014900 01  EP-EMPTY-REPORT-LINE.                                                
015000     05  FILLER                       PIC X(54)  VALUE SPACES.            
015100     05  FILLER                       PIC X(25)  VALUE                    
015200         '******* NO DATA *********'.                                     
015300     05  FILLER                       PIC X(54)  VALUE SPACES.            
015400 01  DL-BLANK-LINE                    PIC X(132) VALUE SPACES.            
015500/                                                                         
015600     EXEC SQL                                                             
015700         INCLUDE SQLCA                                                    
015800     END-EXEC.                                                            
015900                                                                          
016000     COPY SQLCA2.                                                         
016100/                                                                         
016200 PROCEDURE DIVISION.                                                      
016300                                                                          
016400 0000-MAINLINE.                                                           
016500                                                                          
016600     PERFORM 1000-INITIALIZE                                              
016700                                                                          
016800     PERFORM 2000-PROCESS UNTIL PS-EOF-ERROR-FILE                         
016900                                                                          
017000     PERFORM 9000-EOJ.                                                    
017100                                                                          
017200 THE-DUMPER.                                                              
017300     GOBACK.                                                              
017400                                                                          
017500 1000-INITIALIZE.                                                         
017600                                                                          
017700     EXEC SQL SET :PV-TMST = CURRENT TIMESTAMP END-EXEC                   
017800                                                                          
017900     OPEN OUTPUT REPORT-FILE                                              
018000* LOAD SYSTEM DATE INTO HEADINGS                                          
018100     ACCEPT SD-SYSTEM-DATE FROM DATE.                                     
018200     ACCEPT ST-SYSTEM-TIME FROM TIME.                                     
018300                                                                          
018400     MOVE SD-SYSTEM-DATE-YY      TO DP132O-RUN-YEAR.                      
018500     MOVE SD-SYSTEM-DATE-MM      TO DP132O-RUN-MONTH.                     
018600     MOVE SD-SYSTEM-DATE-DD      TO DP132O-RUN-DAY.                       
018700     MOVE ST-SYSTEM-HOUR         TO DP132O-RUN-HOUR.                      
018800     MOVE ST-SYSTEM-MINUTE       TO DP132O-RUN-MINUTE.                    
018900                                                                          
019000     MOVE PC-CURRENT-PROGRAM-NAME                                         
019100                                 TO DP132O-PROGRAM-NAME.                  
019200     MOVE 1                      TO DP132O-REPORT-NUMBER                  
019300                                    DP132O-PAGE-NUMBER                    
019400                                                                          
019500     PERFORM 8100-WRITE-MAIN-HEADINGS                                     
019600                                                                          
019700     OPEN INPUT EXTRACT-FILE                                              
019800                                                                          
019900     MOVE ZERO                        TO RC023-EXTENDED-RETAIL            
020000     PERFORM 8000-READ-EXTRACT                                            
020100         UNTIL RC023-EXTENDED-RETAIL > 500.00                             
020200         OR PS-EOF-ERROR-FILE.                                            
020300                                                                          
020400     IF PS-EOF-ERROR-FILE                                                 
020500         DISPLAY ' -- NO IN-PROCESS ERRORS -- '                           
020600         WRITE REPORT-RECORD FROM EP-EMPTY-REPORT-LINE                    
020700             AFTER ADVANCING 3 LINES                                      
020800     END-IF.                                                              
020900/                                                                         
021000 2000-PROCESS.                                                            
021100                                                                          
021200     PERFORM 2100-BUILD-LINE                                              
021300                                                                          
021400     INSPECT DL-DETAIL-LINE-1 REPLACING ALL LOW-VALUES BY SPACE           
021500                                                                          
021600     WRITE REPORT-RECORD FROM DL-DETAIL-LINE-1                            
021700                AFTER ADVANCING 1 LINES                                   
021800     ADD 1                            TO PV-LINES-USED                    
021900                                                                          
022000     IF PV-LINES-USED > PC-END-OF-PAGE                                    
022100         PERFORM 8100-WRITE-MAIN-HEADINGS                                 
022200     END-IF                                                               
022300                                                                          
022400     MOVE ZERO                        TO RC023-EXTENDED-RETAIL            
022500     PERFORM 8000-READ-EXTRACT                                            
022600         UNTIL RC023-EXTENDED-RETAIL > 500.00                             
022700         OR PS-EOF-ERROR-FILE.                                            
022800/                                                                         
022900 2100-BUILD-LINE.                                                         
023000                                                                          
023100     INITIALIZE DL-DETAIL-LINE-1.                                         
023200*    IF PV-CURR-VENDOR = PV-PREV-VENDOR                                   
023300*        MOVE SPACES                  TO DL-VENDOR-NAME                   
023400*    ELSE                                                                 
023500*        MOVE PV-CURR-VENDOR          TO DL-VENDOR-NAME                   
023600*        MOVE PV-CURR-VENDOR          TO PV-PREV-VENDOR                   
023700*    END-IF                                                               
023800*                                                                         
023810     MOVE RC023-VNDR-NAME             TO DL-VENDOR-NAME                   
023820*                                                                         
023900     MOVE RC023-ORD-NBR               TO DL-PO-NBR                        
024000     MOVE RC023-OTB-PER-NBR (5:2)     TO DL-OTB-MONTH                     
024100     MOVE RC023-ORIG-ORDER-QTY        TO DL-ORIG-ORD-QTY                  
024200     MOVE RC023-VERIFY-QTY            TO DL-VERFIFY-QTY                   
024300     MOVE RC023-EXTENDED-RETAIL       TO DL-EXTENDED-RETAIL               
024400     MOVE RC023-VARIANCE              TO DL-VARIANCE.                     
024410     MOVE RC023-PO-INVOICE-QTY        TO DL-AP-INVOICE-QTY.               
024420     MOVE RC023-INVCE-VARIANCE        TO DL-AP-INVOICE-VARIANCE.          
024500/                                                                         
024600 8000-READ-EXTRACT.                                                       
024700     READ EXTRACT-FILE                                                    
024800         INTO RC023-PBS-REPORT-EXTRACT                                    
024900     AT END                                                               
025000         SET PS-EOF-ERROR-FILE        TO TRUE                             
025100     NOT AT END                                                           
025200*        MOVE RC023-VNDR-NAME         TO PV-CURR-VENDOR                   
025300         ADD 1                        TO PV-READ-COUNT                    
025400         IF RC023-EXTENDED-RETAIL < ZERO                                  
025500             MULTIPLY RC023-EXTENDED-RETAIL BY -1                         
025600             GIVING RC023-EXTENDED-RETAIL                                 
025700         END-IF                                                           
025800     END-READ.                                                            
025900                                                                          
026000 8100-WRITE-MAIN-HEADINGS.                                                
026100                                                                          
026200     ADD 1                            TO PV-PAGE-COUNT.                   
026300     MOVE PV-PAGE-COUNT               TO DP132O-PAGE-NUMBER.              
026400     MOVE ZERO                        TO PV-LINES-USED                    
026500                                                                          
026600     WRITE REPORT-RECORD FROM DP132O-STANDRD-HEADER-132-COLS              
026700                 AFTER ADVANCING PAGE                                     
026800                                                                          
026900     WRITE REPORT-RECORD FROM HL-HEADING-LINE-1                           
027000        AFTER ADVANCING 2 LINES.                                          
027100     WRITE REPORT-RECORD FROM HL-HEADING-LINE-2A                          
027200        AFTER ADVANCING 1 LINES.                                          
027300     WRITE REPORT-RECORD FROM HL-HEADING-LINE-2                           
027400        AFTER ADVANCING 1 LINES.                                          
027500                                                                          
027600     WRITE REPORT-RECORD FROM DL-BLANK-LINE                               
027700        AFTER ADVANCING 1 LINES.                                          
027800                                                                          
027900     INITIALIZE DP132O-LASER-NEW-PAGE-INDICATR.                           
028000     ADD  5                           TO PV-LINES-USED.                   
028100/                                                                         
028200 9000-EOJ.                                                                
028300     CLOSE REPORT-FILE                                                    
028400           EXTRACT-FILE.                                                  
028500/                                                                         
028600 9100-ABEND.                                                              
028700                                                                          
028800     CLOSE EXTRACT-FILE                                                   
028900           REPORT-FILE                                                    
029000                                                                          
029100     MOVE +4013                       TO ABEND-CODE.                      
029200     CALL 'ILBOABN0' USING ABEND-CODE.                                    
029300                                                                          
029400 9200-SQL-ERROR.                                                          
029500                                                                          
029600     MOVE SQLCODE                     TO SQLCODE2.                        
029700     MOVE SQLERRD(3)                  TO SQLERRD3.                        
029800                                                                          
029900     DISPLAY '** ABEND **         ** = SQLERROR'.                         
030000     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.                
030100     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                           
030200     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                        
030300                                                                          
030400     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                        
030500     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                        
030600     DISPLAY '** SQLERRM          ** = ' SQLERRM.                         
030700     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                        
030800                                                                          
030900                                                                          
031000     MOVE +4013                       TO ABEND-CODE.                      
031100     CALL 'ILBOABN0' USING ABEND-CODE.                                    
031200                                                                          
031300 9300-SQL-WARNING.                                                        
031400                                                                          
031500     DISPLAY '9300-SQL-WARNING'.                                          
031600     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.                
031700     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                           
031800     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                        
031900                                                                          
032000     MOVE SQLCODE                     TO SQLCODE2.                        
032100     MOVE SQLERRD(3)                  TO SQLERRD3.                        
032200     DISPLAY '** ABEND **       ** = SQLWARNING'.                         
032300     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                          
032400     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                          
032500     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                          
032600     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                          
032700     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                          
032800     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                          
032900     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                          
033000     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                          
033100     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                          
033200     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                          
033300                                                                          
033400     MOVE +4013                       TO ABEND-CODE.                      
033500     CALL 'ILBOABN0' USING ABEND-CODE.                                    
033600                                                                          
