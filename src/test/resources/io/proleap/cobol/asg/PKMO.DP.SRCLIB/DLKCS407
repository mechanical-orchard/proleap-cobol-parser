000100 TITLE  'SHIP DOOR TEMPLATE INQUIRY'.                                     
000200 IDENTIFICATION DIVISION.                                                 
000300 PROGRAM-ID.    DLKCS407.                                                 
000400 AUTHOR.        DENNIS STEFFEN.                                           
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
000600 DATE-WRITTEN.  DECEMBER 2003.                                            
000700 DATE-COMPILED.                                                           
000800                                                                          
263627*----------------------------------------------------------------*        
263627* CHANGED 11/04/2021    BY JIM HUNTER      WR: CHG0263627                 
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263627* MAKING THE CALL DYNAMIC VS STATIC.                                      
      *                                                                         
009461* CHANGED 10/24/2022    BY BOB MCASEY      WR: CHG0279137                 
009491* ADD COPYBOOK DPWS930 CHANGE CICS ARCHITECTURE CALL TO                   
009491* TO USE CICS ARCHITECTURE CA                                             
263627*----------------------------------------------------------------*        
000900 ENVIRONMENT DIVISION.                                                    
001000 DATA DIVISION.                                                           
001100 WORKING-STORAGE SECTION.                                                 
001200                                                                          
001300 01  DK-DB2-KEYS.                                                         
001400     05  DK-DC-NBR                    PIC S9(04) COMP VALUE ZERO.         
001500                                                                          
001600                                                                          
001700 01  PC-PROGRAM-CONSTANTS.                                                
001800     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE                 
001900                                                    'DLK407  '.           
002000     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE                 
002100                                                    'DLKM407 '.           
002200     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE                 
002300                                                    'DLKCS407'.           
002400     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.              
002500     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.              
002600     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.            
002700     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +65             
002800                                                    COMP SYNC.            
002900     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2              
003000                                                    COMP SYNC.            
003100     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE                 
003200                                                    +1000000              
003300                                                    COMP-3.               
003400     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5              
003500                                                    COMP SYNC.            
003600     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3               
003700                                                    COMP-3.               
003800     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.            
003900     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.          
004000     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.          
004100     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.          
004200     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.          
004300*                                                                         
004400     05  PC-TSYMSG-NUMBERS.                                               
004500         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.          
004600         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.          
004700         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.          
004800         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.          
004900         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.          
005000         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.          
005100         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.          
005200         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.          
005300         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.          
005400         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.          
005500         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.          
005600         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.          
005700         10  PC-TSYMSG-01305            PIC  9(05)  VALUE 01305.          
005800         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.          
005900         10  PC-TSYMSG-00984            PIC  9(05)  VALUE 00984.          
006000         10  PC-TSYMSG-03181            PIC  9(05)  VALUE 03181.          
006100         10  PC-TSYMSG-03182            PIC  9(05)  VALUE 03182.          
006200         10  PC-TSYMSG-03183            PIC  9(05)  VALUE 03183.          
006300         10  PC-TSYMSG-03185            PIC  9(05)  VALUE 03185.          
006400         10  PC-TSYMSG-03186            PIC  9(05)  VALUE 03186.          
006500         10  PC-TSYMSG-03187            PIC  9(05)  VALUE 03187.          
006600         10  PC-TSYMSG-03199            PIC  9(05)  VALUE 03199.          
006700         10  PC-TSYMSG-03201            PIC  9(05)  VALUE 03201.          
006800         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.          
006900*                                                                         
007000 01  PS-PROGRAM-SWITCHES.                                                 
007100     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.            
007200         88  PS-NO-ERROR                            VALUE 'Y'.            
007300         88  PS-ERROR                               VALUE 'N'.            
007400     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.            
007500         88  PS-COMMAREA-VALID                      VALUE 'Y'.            
007600         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.            
007700     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.            
007800         88  PS-DONE                                VALUE 'Y'.            
007900         88  PS-NOT-DONE                            VALUE 'N'.            
008000     05  PS-ACCESS-SW                   PIC  X(01)  VALUE 'N'.            
008100         88  PS-ACCESS-ALLOWED                      VALUE 'Y'.            
008200         88  PS-ACCESS-NOT-ALLOWED                  VALUE 'N'.            
008300     05  PS-LIST-END-SW                 PIC X(01)    VALUE 'N'.           
008400         88  PS-LIST-END                             VALUE 'Y'.           
008500         88  PS-NO-LIST-END                          VALUE 'N'.           
008600                                                                          
008700     05  PS-SOFT-ABORT-ERROR-SW         PIC  X(01)  VALUE 'N'.            
008800         88  PS-SOFT-ABORT-ERROR                    VALUE 'Y'.            
008900         88  PS-NO-SOFT-ABORT-ERROR                 VALUE 'N'.            
009000*                                                                         
009100 01  PV-PROGRAM-VARIABLES.                                                
009200     05  PV-SUB                         PIC S9(04)  VALUE +0              
009300                                                    COMP SYNC.            
009400     05  PV-REMAINDER                   PIC S9(04)  VALUE +0              
009500                                                    COMP SYNC.            
009600     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0              
009700                                                    COMP-3.               
009800     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0              
009900                                                    COMP-3.               
010000     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0              
010100                                                    COMP-3.               
010200     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0              
010300                                                    COMP-3.               
010400     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0              
010500                                                    COMP-3.               
010600     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0              
010700                                                    COMP-3.               
010800     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0              
010900                                                    COMP-3.               
011000     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0              
011100                                                    COMP SYNC.            
011200     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0              
011300                                                    COMP SYNC.            
011400     05  PV-ITEM                        PIC S9(04)  VALUE +0              
011500                                                    COMP SYNC.            
011600     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0              
011700                                                    COMP SYNC.            
011800     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0              
011900                                                    COMP SYNC.            
012000     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0              
012100                                                    COMP SYNC.            
012200     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0              
012300                                                    COMP SYNC.            
012400     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0              
012500                                                    COMP SYNC.            
012600     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0              
012700                                                    COMP SYNC.            
012800     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0              
012900                                                    COMP SYNC.            
013000     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0              
013100                                                    COMP SYNC.            
013200     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0              
013300                                                    COMP SYNC.            
013400     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0              
013500                                                    COMP SYNC.            
013600     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0              
013700                                                    COMP SYNC.            
013800     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0              
013900                                                    COMP SYNC.            
014000     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0              
014100                                                    COMP SYNC.            
014200                                                                          
014300                                                                          
014400                                                                          
014500     05  PV-TEMPLATE-STATUS           PIC X(08) VALUE SPACE.              
014600     05  PV-LENGTH                    PIC S9(05) COMP-3.                  
014700     05  PV-END                       PIC S9(05) COMP-3.                  
014800     05  PV-TEMPLATE-DOOR-COUNT       PIC S9(05) COMP-3.                  
014900     05  PV-DOOR-COUNT                PIC S9(05) COMP-3.                  
015000     05  PV-GROUP-COUNT               PIC S9(05) COMP-3.                  
015100     05  PV-COMMAREA-LENGTH           PIC S9(04) COMP VALUE ZERO.         
015200     05  PV-SOFT-ABORT-MSG.                                               
015300         10  FILLER            PIC X(12) VALUE ' DLKCS407 - '.            
015400         10  FILLER            PIC X(09) VALUE 'SQLCODE: '.               
015500         10  PV-SOFT-SQLCODE   PIC ZZZZZZZZ9-.                            
015600         10  FILLER            PIC X(12) VALUE ' PARAGRAPH: '.            
015700         10  PV-SOFT-PARAGRAPH PIC X(30).                                 
015800     05  PV-CICS-MSG-AREA2            PIC  X(100) VALUE SPACE.            
015900     05  PT-DESC-AREA.                                                    
016000         10  PT-DESC-BYTE OCCURS 40 TIMES PIC X(01).                      
016100                                                                          
016200******************************************************************        
016300**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **        
016400**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **        
016500**  APPLICATION-SPECIFIC COMMAREA.                              **        
016600******************************************************************        
016700 01  LQW-LIST-QUEUE-WORK-AREA.                                            
016800     05  LQW-BLOCK-MODIFIED-SW        PIC  X(01)  VALUE SPACE.            
016900         88  LQW-BLOCK-NOT-MODIFIED      VALUE 'N'.                       
017000         88  LQW-BLOCK-MODIFIED          VALUE 'Y'.                       
017100                                                                          
017200     05  LQW-ITEM-ENTRIES             OCCURS 65 TIMES                     
017300                                      INDEXED BY LQW-IDX.                 
017400         10  LQW-LIST-ITEM-NUMBER     PIC S9(09)  COMP-3.                 
017500                                                                          
017600         10  LQW-ERROR-SW             PIC X(01).                          
017700             88  LQW-ERROR-YES                  VALUE 'Y'.                
017800             88  LQW-ERROR-NO                   VALUE SPACE.              
017900                                                                          
018000         10  LQW-NUMERIC-ERROR-SW     PIC X(01).                          
018100             88  LQW-NUMERIC-ERROR-YES           VALUE 'Y'.               
018200             88  LQW-NUMERIC-ERROR-NO            VALUE SPACE.             
018300                                                                          
018400         10  LQW-DOOR-ID              PIC  X(04).                         
018500         10  LQW-GROUP-NBR            PIC  X(04).                         
018600         10  LQW-GROUP-NBR-N REDEFINES LQW-GROUP-NBR                      
018700                                      PIC 9999.                           
018800/                                                                         
018900*---------------------------------------------------------------*         
019000*  RECORD LAYOUT FOR THE MESSAGE SELECTION TEMP STORAGE QUEUE.  *         
019100*---------------------------------------------------------------*         
019200                                                                          
019300     COPY DLWS006.                                                        
019400*    COPY DPWS057.                                                        
019500                                                                          
019600/                                                                         
019700*---------------------------------------------------------------*         
019800*    MAP LAYOUT                                                 *         
019900*---------------------------------------------------------------*         
020000                                                                          
020100     COPY DLKM407.                                                        
020200*                                                                         
020300 01  MR-OCCURS-LAYOUT                   REDEFINES  DLK407O.               
020400     05  FILLER                         PIC X(172).                       
020500     05  MR-SCROLL-AREA                 OCCURS 65 TIMES.                  
020600                                                                          
020700         10  MR-DOOR-NBR-L            PIC S9(04) COMP.                    
020800         10  MR-DOOR-NBRA             PIC  X(01).                         
020900         10  MR-DOOR-NBRC             PIC  X(01).                         
021000         10  MR-DOOR-NBRH             PIC  X(01).                         
021100         10  MR-DOOR-NBR              PIC  X(04).                         
021200                                                                          
021300         10  MR-GROUP-NBR-L           PIC S9(04) COMP.                    
021400         10  MR-GROUP-NBRA            PIC  X(01).                         
021500         10  MR-GROUP-NBRC            PIC  X(01).                         
021600         10  MR-GROUP-NBRH            PIC  X(01).                         
021700         10  MR-GROUP-NBR.                                                
021800             15  MR-GROUP-NBR-N       PIC Z(04).                          
021900                                                                          
022000/                                                                         
022100     COPY DPWS015.                                                        
022200     COPY DPWS016.                                                        
022300                                                                          
022400*---------------------------------------------------------------*         
022500*    NUMERIC EDIT LAYOUT.                                       *         
022600*---------------------------------------------------------------*         
022700                                                                          
022800     COPY DPWS010I.                                                       
022900                                                                          
023000*---------------------------------------------------------------*         
023100*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   *         
023200*---------------------------------------------------------------*         
023300                                                                          
023400     COPY DPWS030.                                                        
1022RM     COPY DPWS930.                                                        
023500                                                                          
023600*---------------------------------------------------------------*         
023700*    STANDARD COMMAREA.                                         *         
023800*---------------------------------------------------------------*         
023900                                                                          
024000     COPY DPWS020.                                                        
024100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                        
024200                                                                          
024300         10  INTER-APPL-COMM-AREA       PIC X(200).                       
024400     COPY DLWS002.                                                        
024500*---------------------------------------------------------------*         
024600*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   *         
024700*---------------------------------------------------------------*         
024800         10  ASC-SPECIFIC-COMMAREA.                                       
024900             15  ASC-LIST-KEYS.                                           
025000                 20  ASC-KEY-OPER-UNT-ID                                  
025100                                      PIC S9(04) COMP.                    
025200                 20  ASC-KEY-OPER-DESC                                    
025300                                      PIC X(40).                          
025400                 20  ASC-KEY-TEMPLATE-DESC                                
025500                                      PIC X(40).                          
025600                 20  ASC-KEY-DOOR-COUNT                                   
025700                                      PIC S9(04) COMP.                    
025800                 20 ASC-DOOR-GP-TMPL-ID                                   
025900                                      PIC  S9(9) COMP.                    
026000                                                                          
026100             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                        
026200                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).          
026300                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.           
026400                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.           
026500                                                                          
026600                 20  ASC-ITEM-ARRAY.                                      
026700                     25  ASC-ITEM-ENTRIES OCCURS 65 TIMES.                
026800                         30  ASC-LIST-ITEM-NUMBER                         
026900                                                     PIC S9(09)           
027000                                                     COMP-3.              
027100                         30  ASC-ERROR-SW            PIC X(01).           
027200                             88   ASC-ERROR-YES      VALUE 'Y'.           
027300                             88   ASC-ERROR-NO       VALUE SPACE.         
027400                                                                          
027500                         30  ASC-NUMERIC-ERROR-SW     PIC X(01).          
027600                             88  ASC-NUMERIC-ERROR-YES VALUE 'Y'.         
027700                             88  ASC-NUMERIC-ERROR-NO VALUE SPACE.        
027800                                                                          
027900                         30  ASC-DOOR-ID             PIC  X(04).          
028000                         30  ASC-GROUP-NBR-X.                             
028100                             35 ASC-GROUP-NBR        PIC  9(04).          
028200                                                                          
028300             15  ASC-BLK-SUB                         PIC S9(04)           
028400                                                          COMP            
028500                                                          SYNC.           
028600             15  ASC-ITEM-SUB                        PIC S9(04)           
028700                                                          COMP            
028800                                                          SYNC.           
028900             15  ASC-SEL-SUB                         PIC S9(04)           
029000                                                         COMP.            
029100             15  ASC-SEL-ITEM                        PIC S9(04)           
029200                                                         COMP.            
029300             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)           
029400                                                          COMP-3.         
029500             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(09)           
029600                                                          COMP-3.         
029700             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)           
029800                                                          COMP-3.         
029900             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)           
030000                                                          COMP-3.         
030100             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)           
030200                                                          COMP-3.         
030300             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)           
030400                                                          COMP-3.         
030500             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)           
030600                                                          COMP            
030700                                                          SYNC.           
030800             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)           
030900                                                          COMP-3.         
031000             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)           
031100                                                          COMP-3.         
031200             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).          
031300                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.           
031400                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.           
031500             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).          
031600                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.           
031700                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.           
031800             15  ASC-LIST-QUEUE-NAME.                                     
031900                 20  ASC-LIST-TERM-ID                PIC  X(04).          
032000                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)           
032100                                                          COMP-3.         
032200                 20  ASC-LIST-SEQ                    PIC  9(01).          
032300             15  ASC-SEL-QUEUE-NAME.                                      
032400                 20  ASC-SEL-TERM-ID                 PIC  X(04).          
032500                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)           
032600                                                          COMP-3.         
032700                 20  ASC-SEL-SEQ                     PIC  9(01).          
032800                                                                          
032900             15  ASC-CURSOR-SW                       PIC  X(01).          
033000                 88  ASC-DOOR-SEQUENCE               VALUE 'D'.           
033100                 88  ASC-GROUP-SEQUENCE              VALUE 'G'.           
033200             15  ASC-START-ITEM-REQUEST.                                  
033300                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).          
033400             15  ASC-PROTECT-ALL-FIELDS-SW           PIC X.               
033500                 88  ASC-PROTECT-YES         VALUE 'Y'.                   
033600                 88  ASC-PROTECT-NO          VALUE 'N'.                   
033700/                                                                         
033800*---------------------------------------------------------------*         
033900*    ABEND PROCESSING COPYBOOK.                                 *         
034000*---------------------------------------------------------------*         
034100                                                                          
034200     COPY DPWS013.                                                        
034300*----------------------------------------------------------------*        
034400**  SECURITY SUBROUTINE PARAMETERS                                        
034500*----------------------------------------------------------------*        
034600     COPY DPWS008.                                                        
034700                                                                          
034800/                                                                         
034900*    DLT_DOOR_GP_TMPL                                                     
035000     EXEC SQL                                                             
035100          INCLUDE DLT00000                                                
035200     END-EXEC.                                                            
035300                                                                          
035400*    DLT_DOOR_GP                                                          
035500     EXEC SQL                                                             
035600          INCLUDE DLT00001                                                
035700     END-EXEC.                                                            
035800                                                                          
035900*    XLT_LOC                                                              
036000     EXEC SQL                                                             
036100          INCLUDE XLT00010                                                
036200     END-EXEC.                                                            
036300                                                                          
036400*    DB2 AREA FOR COMMUNICATIONS                                *         
036500     EXEC SQL                                                             
036600          INCLUDE SQLCA                                                   
036700     END-EXEC.                                                            
036800/                                                                         
036900*    TEMPLATE CURSOR                                                      
037000     EXEC SQL                                                             
037100         DECLARE DOOR-CSR CURSOR FOR                                      
037200             SELECT  DOOR_ID                                              
037300                 ,   DOOR_GP_NBR                                          
037400             FROM   DLT_DOOR_GP                                           
037500             WHERE   DOOR_GP_TMPL_ID = :ASC-DOOR-GP-TMPL-ID               
037600             ORDER BY                                                     
037700                 DOOR_ID                                                  
037800*            FETCH FIRST 066 ROWS ONLY                                    
037900     END-EXEC.                                                            
038000                                                                          
038100     EXEC SQL                                                             
038200         DECLARE GROUP-CSR CURSOR FOR                                     
038300             SELECT  DOOR_ID                                              
038400                 ,   DOOR_GP_NBR                                          
038500             FROM   DLT_DOOR_GP                                           
038600             WHERE   DOOR_GP_TMPL_ID = :ASC-DOOR-GP-TMPL-ID               
038700             ORDER BY                                                     
038800                 DOOR_GP_NBR                                              
038900         ,       DOOR_ID                                                  
039000*            FETCH FIRST 066 ROWS ONLY                                    
039100     END-EXEC.                                                            
039200/                                                                         
039300 LINKAGE SECTION.                                                         
039400                                                                          
039500 01  DFHCOMMAREA.                                                         
039600     05  FILLER                         OCCURS  1 TO 4072 TIMES           
039700                                        DEPENDING ON EIBCALEN.            
039800         10  FILLER                     PIC X.                            
039900                                                                          
040000/                                                                         
040100 PROCEDURE DIVISION.                                                      
040200                                                                          
040300 0000-MAIN-MODULE.                                                        
040400     INITIALIZE DP030-CICS-API-FIELDS.                                    
040500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.               
040600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.                  
040700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).                 
040800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                               
040900     MOVE LENGTH OF DLK407I        TO DP030-MAP-LENGTH (1).               
041000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).             
041100     PERFORM 0001-CALL-CICS-ARCH-API.                                     
041200*                                                                         
041300     PERFORM 1000-CONTROL-PROCESSING                                      
041400*                                                                         
041500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).             
041600     PERFORM 0001-CALL-CICS-ARCH-API.                                     
041700                                                                          
041800******************************************************************        
041900**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **        
042000**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **        
042100******************************************************************        
042200 0001-CALL-CICS-ARCH-API.                                                 
042300     CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
042400                                    DFHCOMMAREA                           
042500                                    DP030-CICS-API-FIELDS                 
042600                                    DP020-STANDARD-COMMAREA               
042700                                    DLK407I.                              
042800*                                                                         
042900     IF  DP030-RC-CALL-SUCCESSFUL                                         
043000         CONTINUE                                                         
043100     ELSE                                                                 
043200         SET DP013-NO-ROLLBACK                                            
043300             DP013-XCTL-DISPLAY-RESTART                                   
043400             DP013-CICS-ABEND      TO TRUE                                
043500         MOVE '0001-CALL-CICS-ARCH-API'                                   
043600                                   TO DP013-PARAGRAPH                     
1022RM         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
1022RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
043900         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)              
044000         PERFORM DP013-0000-PROCESS-ABEND                                 
044100     END-IF.                                                              
044200                                                                          
044300 1000-CONTROL-PROCESSING.                                                 
044400                                                                          
044500     EVALUATE TRUE                                                        
044600         WHEN DP020-NEXT-ACT-INITIAL                                      
044700             INITIALIZE ASC-SPECIFIC-COMMAREA                             
044800             MOVE EIBTRMID         TO ASC-LIST-TERM-ID                    
044900                                      ASC-SEL-TERM-ID                     
045000             MOVE DP020-SRC-TASK-NUMBER                                   
045100                                   TO ASC-LIST-TASK-NUMBER                
045200                                      ASC-SEL-TASK-NUMBER                 
045300             MOVE PC-LIST-QUEUE-SEQ                                       
045400                                   TO ASC-LIST-SEQ                        
045500             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                         
045600             PERFORM 1100-PROCESS-INTER-APPL-COMM                         
045700             IF  PS-COMMAREA-NOT-VALID                                    
045800                 SET DP020-NEXT-ACT-APPL-ERROR                            
045900                                   TO TRUE                                
046000             ELSE                                                         
046100                 SET ASC-DOOR-SEQUENCE TO TRUE                            
046200                 PERFORM 4000-BUILD-INITIAL-PANEL                         
046300             END-IF                                                       
046400                                                                          
046500             MOVE -1                  TO ASTRTITL                         
046600             SET DP030-SET-CURSOR-APPL-1                                  
046700                                      TO TRUE                             
046800                                                                          
046900         WHEN DP020-NEXT-ACT-READ-MAP                                     
047000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                                
047100                                   TO PV-TOP-ITEM                         
047200             PERFORM 2000-PROCESS-PANEL                                   
047300                                                                          
047400         WHEN DP020-NEXT-ACT-RETURN                                       
047500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                                
047600                                   TO PV-TOP-ITEM                         
047700             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL            
047800             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                         
047900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
048000*            PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
048100                                                                          
048200         WHEN OTHER                                                       
048300             SET DP013-LOGIC-ABEND TO TRUE                                
048400             SET DP013-NO-ROLLBACK TO TRUE                                
048500             MOVE '1000-CONTROL-PROCESSING'                               
048600                                   TO DP013-PARAGRAPH                     
048700             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'            
048800                                   TO DP013-MESSAGE-TEXT(1)               
048900             PERFORM DP013-0000-PROCESS-ABEND                             
049000     END-EVALUATE.                                                        
049100                                                                          
049200/                                                                         
049300 1100-PROCESS-INTER-APPL-COMM.                                            
049400                                                                          
049500     SET PS-COMMAREA-VALID         TO TRUE.                               
049600     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.             
049700                                                                          
049800     MOVE DP020-LOCATION-NBR          TO DK-DC-NBR                        
049900                                         ADCO                             
050000                                         ASC-KEY-OPER-UNT-ID.             
050100                                                                          
050200     PERFORM 7000-LOCATION-DESC.                                          
050300     MOVE ASC-KEY-OPER-DESC           TO ADCNMEO.                         
050400                                                                          
050500     MOVE DL002-DOOR-COUNT            TO ASC-KEY-DOOR-COUNT               
050600                                         ATDOORO.                         
050700                                                                          
050800     MOVE DL002-NUMBER-OF-TS-ITEMS    TO ASC-NUMBER-OF-TS-ITEMS           
050900     MOVE DL002-SEL-QUEUE-NAME        TO ASC-SEL-QUEUE-NAME               
051000     PERFORM 1120-PREPARE-LIST-ENTRY.                                     
051100                                                                          
051200 1120-PREPARE-LIST-ENTRY.                                                 
051300                                                                          
051400     MOVE DL006-MAX-ITEMS             TO ASC-SEL-SUB.                     
051500     MOVE ZERO                        TO ASC-SEL-ITEM.                    
051600     PERFORM 2140-GET-NEXT-MESSAGE.                                       
051700/                                                                         
051800                                                                          
051900 2000-PROCESS-PANEL.                                                      
052000     EVALUATE TRUE                                                        
052100         WHEN DP020-SRC-AID = DP016-CLEAR                                 
052200             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL            
052300*            PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
052400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
052500                                                                          
052600         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                            
052700             MOVE ASC-KEY-OPER-UNT-ID   TO DK-DC-NBR                      
052800             MOVE ASC-KEY-TEMPLATE-DESC TO ADESCO                         
052900             PERFORM 2050-DELETE-LIST-QUEUE                               
053000             PERFORM 4000-BUILD-INITIAL-PANEL                             
053100                                                                          
053200             MOVE -1                  TO ASTRTITL                         
053300             SET DP030-SET-CURSOR-APPL-1                                  
053400                                      TO TRUE                             
053500                                                                          
053600         WHEN OTHER                                                       
053700             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                         
053800*            PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
053900             IF  PS-NO-ERROR                                              
054000                 SET DP030-CONTINUE-GO                                    
054100                                 TO TRUE                                  
054200                 PERFORM 2100-CHECK-FUNCTION-KEY                          
054300             ELSE                                                         
054400                 SET DP030-OVERRIDE-GO                                    
054500                                 TO TRUE                                  
054600             END-IF                                                       
054700     END-EVALUATE.                                                        
054800/                                                                         
054900 2001-NUM-EDIT.                                                           
055000     MOVE ASC-GROUP-NBR-X (ASC-BLK-SUB ASC-ITEM-SUB)                      
055100                                      TO DP010I-UNEDITED-FIELD            
055200     MOVE +4                          TO DP010I-MAXIMUM-DIGITS            
055300     MOVE ZERO                        TO DP010I-MAXIMUM-DECIMALS          
055400     SET DP010I-NEGATIVE-NOT-ALLOWED  TO TRUE                             
055500                                                                          
263627     CALL DP010I-NUMERIC-EDIT-ROUTINE                                     
263627          USING DP010I-NUMERIC-EDIT-AREA                                  
055700                                                                          
055800     IF NOT DP010I-ERROR-DETECTED                                         
055900         MOVE DP010I-NUMERIC-FIELD    TO ASC-GROUP-NBR                    
056000                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
056100     END-IF.                                                              
056200                                                                          
056300*----------------------------------------------------------------*        
056400*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *        
056500*----------------------------------------------------------------*        
056600 2050-DELETE-LIST-QUEUE.                                                  
056700                                                                          
056800     EXEC CICS                                                            
056900         DELETEQ TS                                                       
057000             QUEUE (ASC-LIST-QUEUE-NAME)                                  
057100             RESP  (PV-CICS-RESP)                                         
057200     END-EXEC.                                                            
057300                                                                          
057400     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                               
057500        (PV-CICS-RESP = DFHRESP(QIDERR))                                  
057600         CONTINUE                                                         
057700     ELSE                                                                 
057800         SET DP013-CICS-ABEND      TO TRUE                                
057900         SET DP013-NO-ROLLBACK     TO TRUE                                
058000                                                                          
058100         MOVE '2050-DELETE-LIST-QUEUE'                                    
058200                                   TO DP013-PARAGRAPH                     
058300         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'            
058400                                   TO DP013-MESSAGE-TEXT (1)              
058500         PERFORM DP013-0000-PROCESS-ABEND                                 
058600     END-IF.                                                              
058700                                                                          
058800     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.          
058900/                                                                         
059000*----------------------------------------------------------------*        
059100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*        
059200* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *        
059300* CICS ARCHITECTURE API.                                         *        
059400*----------------------------------------------------------------*        
059500 2100-CHECK-FUNCTION-KEY.                                                 
059600     EVALUATE TRUE                                                        
059700         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                      
059800             PERFORM 2050-DELETE-LIST-QUEUE                               
059900             IF ASC-DOOR-SEQUENCE                                         
060000                 SET ASC-GROUP-SEQUENCE   TO TRUE                         
060100             ELSE                                                         
060200                 SET ASC-DOOR-SEQUENCE   TO TRUE                          
060300             END-IF                                                       
060400             PERFORM 4000-BUILD-INITIAL-PANEL                             
060500                                                                          
060600     WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)                         
060700         PERFORM 2140-GET-NEXT-MESSAGE                                    
060800         IF PS-LIST-END                                                   
060900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
061000             SET PS-NO-LIST-END TO TRUE                                   
061100         ELSE                                                             
061200             PERFORM 2050-DELETE-LIST-QUEUE                               
061300             PERFORM 4000-BUILD-INITIAL-PANEL                             
061400         END-IF                                                           
061500                                                                          
061600     WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)                         
061700         PERFORM 2150-GET-PREV-MESSAGE                                    
061800         IF PS-LIST-END                                                   
061900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
062000             SET PS-NO-LIST-END TO TRUE                                   
062100         ELSE                                                             
062200             PERFORM 2050-DELETE-LIST-QUEUE                               
062300             PERFORM 4000-BUILD-INITIAL-PANEL                             
062400         END-IF                                                           
062500         PERFORM 3200-RESET-ATTRIBUTES                                    
062600                                                                          
062700         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                          
062800             MOVE +1               TO PV-TOP-ITEM                         
062900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
063000                                                                          
063100         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                           
063200             PERFORM 2110-BROWSE-BACKWARD                                 
063300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
063400                                                                          
063500         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                           
063600             PERFORM 2120-BROWSE-FORWARD                                  
063700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
063800                                                                          
063900         WHEN DP020-SRC-AID = DP016-ENTER                                 
064000             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                           
064100             IF  PS-ERROR                                                 
064200                 CONTINUE                                                 
064300             ELSE                                                         
064400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     
064500             END-IF                                                       
064600                                                                          
064700         WHEN OTHER                                                       
064800             SET DP013-NO-ROLLBACK                                        
064900                 DP013-XCTL-DISPLAY-RESTART                               
065000                 DP013-CICS-ABEND  TO TRUE                                
065100             MOVE '2100-CHECK-FUNCTION-KEY'                               
065200                                   TO DP013-PARAGRAPH                     
065300             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'              
065400                                   TO DP013-MESSAGE-TEXT (1)              
065500             PERFORM DP013-0000-PROCESS-ABEND                             
065600     END-EVALUATE.                                                        
065700                                                                          
065800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                                
065900     IF ASC-DOOR-SEQUENCE                                                 
066000         MOVE '** DOOR SEQUENCE **'   TO ASEQO                            
066100     ELSE                                                                 
066200         MOVE '** GROUP SEQUENCE **'   TO ASEQO                           
066300     END-IF                                                               
066400     MOVE ASC-DOOR-GP-TMPL-ID         TO ATMPLO                           
066500     MOVE ASC-KEY-TEMPLATE-DESC       TO ADESCO.                          
066600     MOVE -1                          TO ASTRTITL.                        
066700     SET DP030-SET-CURSOR-APPL-1      TO TRUE.                            
066800                                                                          
066900/                                                                         
067000 2140-GET-NEXT-MESSAGE.                                                   
067100                                                                          
067200     ADD +1                       TO ASC-SEL-SUB.                         
067300     IF  ASC-SEL-SUB > DL006-MAX-ITEMS                                    
067400         ADD +1                   TO ASC-SEL-ITEM                         
067500         MOVE +1                  TO ASC-SEL-SUB                          
067600     END-IF.                                                              
067700                                                                          
067800     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                        
067900         PERFORM 9100-READ-SEL-QUEUE                                      
068000         IF  DL006-ITEM (ASC-SEL-SUB) > ZERO                              
068100             MOVE DL006-GP-TMPL-ID (ASC-SEL-SUB)                          
068200                                      TO DLT00001-DOOR-GP-TMPL-ID         
068300                                         ASC-DOOR-GP-TMPL-ID              
068400             MOVE DL006-TEMPLATE-DESC (ASC-SEL-SUB)                       
068500                                      TO ASC-KEY-TEMPLATE-DESC            
068600             MOVE DL006-DOOR-COUNT (ASC-SEL-SUB)                          
068700                                      TO ASC-KEY-DOOR-COUNT               
068800                                         ATDOORO                          
068900             SET DL006-INQ (ASC-SEL-SUB) TO TRUE                          
069000             PERFORM 9200-REWRITE-SEL-QUEUE                               
069100         ELSE                                                             
069200             SUBTRACT +1 FROM ASC-SEL-SUB                                 
069300             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER                     
069400             SET DP020-MSG-INFORMATIONAL TO TRUE                          
069500             SET PS-LIST-END             TO TRUE                          
069600         END-IF                                                           
069700     ELSE                                                                 
069800         SUBTRACT +1 FROM ASC-SEL-ITEM                                    
069900         MOVE DL006-MAX-ITEMS     TO ASC-SEL-SUB                          
070000         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER                     
070100         SET DP020-MSG-INFORMATIONAL TO TRUE                              
070200         SET PS-LIST-END             TO TRUE                              
070300     END-IF.                                                              
070400                                                                          
070500*----------------------------------------------------------------*        
070600*    GET THE PREVIOUS MESSAGE IF A LIST OF MESSAGES IS BEING     *        
070700*    PROCESSED.                                                  *        
070800*----------------------------------------------------------------*        
070900                                                                          
071000 2150-GET-PREV-MESSAGE.                                                   
071100                                                                          
071200     SUBTRACT +1 FROM ASC-SEL-SUB.                                        
071300     IF  ASC-SEL-SUB < +1                                                 
071400         SUBTRACT +1 FROM ASC-SEL-ITEM                                    
071500         MOVE DL006-MAX-ITEMS     TO ASC-SEL-SUB                          
071600     END-IF.                                                              
071700                                                                          
071800     IF  ASC-SEL-ITEM > ZERO                                              
071900         PERFORM 9100-READ-SEL-QUEUE                                      
072000         MOVE DL006-GP-TMPL-ID (ASC-SEL-SUB)                              
072100                                      TO DLT00001-DOOR-GP-TMPL-ID         
072200                                         ASC-DOOR-GP-TMPL-ID              
072300         MOVE DL006-TEMPLATE-DESC (ASC-SEL-SUB)                           
072400                                      TO ASC-KEY-TEMPLATE-DESC            
072500         MOVE DL006-DOOR-COUNT (ASC-SEL-SUB)                              
072600                                      TO ASC-KEY-DOOR-COUNT               
072700                                         ATDOORO                          
072800                                                                          
072900     ELSE                                                                 
073000         MOVE +1                  TO ASC-SEL-ITEM                         
073100                                     ASC-SEL-SUB                          
073200         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER                     
073300         SET DP020-MSG-INFORMATIONAL TO TRUE                              
073400         SET PS-LIST-END             TO TRUE                              
073500     END-IF.                                                              
073600/                                                                         
073700*                                                                         
073800*----------------------------------------------------------------*        
073900*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *        
074000*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *        
074100*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *        
074200*    MESSAGE.                                                    *        
074300*----------------------------------------------------------------*        
074400                                                                          
074500 2110-BROWSE-BACKWARD.                                                    
074600     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL            
074700         GIVING PV-TOP-ITEM.                                              
074800*                                                                         
074900     IF  ((PV-TOP-ITEM < +1)                                              
075000       OR (PV-TOP-ITEM = +1))                                             
075100         MOVE +1                   TO PV-TOP-ITEM                         
075200*        -- TOP OF LIST --                                                
075300         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER                    
075400         SET DP020-MSG-INFORMATIONAL TO TRUE                              
075500     END-IF.                                                              
075600                                                                          
075700/                                                                         
075800*----------------------------------------------------------------*        
075900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *        
076000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *        
076100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *        
076200*----------------------------------------------------------------*        
076300                                                                          
076400 2120-BROWSE-FORWARD.                                                     
076500                                                                          
076600     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL                      
076700         GIVING PV-TOP-ITEM.                                              
076800     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                           
076900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                                    
077000                                   TO PV-TOP-ITEM                         
077100*        -- BOTTOM OF LIST --                                             
077200         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER                    
077300         SET DP020-MSG-INFORMATIONAL                                      
077400                                   TO TRUE                                
077500     ELSE                                                                 
077600         COMPUTE PV-BOTTOM-ITEM =                                         
077700             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                         
077800         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ                    
077900*            -- BOTTOM OF LIST --                                         
078000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER                    
078100             SET DP020-MSG-INFORMATIONAL                                  
078200                                   TO TRUE                                
078300         END-IF                                                           
078400     END-IF.                                                              
078500 EJECT                                                                    
078600*----------------------------------------------------------------*        
078700*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *        
078800*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *        
078900*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *        
079000*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *        
079100*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *        
079200*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *        
079300*----------------------------------------------------------------*        
079400                                                                          
079500 2130-CHECK-FOR-JUMP-BROWSE.                                              
079600     SET PS-NO-ERROR               TO TRUE.                               
079700     MOVE DP015-UNDERLINE  TO ASTRTITH                                    
079800     MOVE DP015-GREEN      TO ASTRTITC                                    
079900     IF (ASC-START-ITEM-REQUEST = SPACE)                                  
080000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                                    
080100                                   TO PV-TOP-ITEM                         
080200     ELSE                                                                 
080300         MOVE ASC-START-ITEM-REQUEST                                      
080400                                   TO DP010I-UNEDITED-FIELD               
080500         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS               
080600         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS             
080700         SET DP010I-NEGATIVE-NOT-ALLOWED                                  
080800                                   TO TRUE                                
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263627              USING DP010I-NUMERIC-EDIT-AREA                              
081000                                                                          
081100         IF  NOT DP010I-ERROR-DETECTED                                    
081200             MOVE DP010I-NUMERIC-FIELD                                    
081300                                   TO  ASC-START-ITEM-REQUEST-N           
081400             IF  ASC-START-ITEM-REQUEST-N > ZERO                          
081500                 IF  ASC-START-ITEM-REQUEST-N >                           
081600                                          ASC-NUMBER-OF-ITEMS-READ        
081700                     MOVE SPACE TO ASC-START-ITEM-REQUEST                 
081800                     COMPUTE PV-TOP-ITEM =                                
081900                             ASC-NUMBER-OF-ITEMS-READ                     
082000                             - PC-ITEMS-PER-PANEL + 1                     
082100                     IF  PV-TOP-ITEM < +1                                 
082200                         MOVE +1   TO PV-TOP-ITEM                         
082300                         MOVE PC-TSYMSG-00070                             
082400                                   TO DP020-MSG-NUMBER                    
082500                         SET DP020-MSG-INFORMATIONAL                      
082600                                   TO TRUE                                
082700                     END-IF                                               
082800                 ELSE                                                     
082900                     MOVE ASC-START-ITEM-REQUEST-N                        
083000                                   TO PV-TOP-ITEM                         
083100                     MOVE SPACE    TO ASC-START-ITEM-REQUEST              
083200                     COMPUTE PV-BOTTOM-ITEM =                             
083300                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1             
083400                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ        
083500*                        -- BOTTOM OF LIST --                             
083600                         MOVE PC-TSYMSG-00070                             
083700                                   TO DP020-MSG-NUMBER                    
083800                         SET DP020-MSG-INFORMATIONAL                      
083900                                   TO TRUE                                
084000                     END-IF                                               
084100                 END-IF                                                   
084200             ELSE                                                         
084300*                --- VALUE OUT OF RANGE ----                              
084400                 MOVE PC-TSYMSG-00101                                     
084500                                   TO DP020-MSG-NUMBER                    
084600                 MOVE -1           TO ASTRTITL                            
084700                 SET DP030-SET-CURSOR-APPL-1                              
084800                                   TO TRUE                                
084900                 MOVE DP015-REVERSE                                       
085000                                   TO ASTRTITH                            
085100                 MOVE DP015-RED    TO ASTRTITC                            
085200                 MOVE DP015-UNP-NUM-BRT-MDT                               
085300                                   TO ASTRTITA                            
085400                 SET DP020-MSG-FATAL                                      
085500                                   TO TRUE                                
085600                 SET PS-ERROR      TO TRUE                                
085700             END-IF                                                       
085800                                                                          
085900         ELSE                                                             
086000             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER                    
086100             MOVE -1               TO ASTRTITL                            
086200             SET DP030-SET-CURSOR-APPL-1 TO TRUE                          
086300             MOVE DP015-REVERSE    TO ASTRTITH                            
086400             MOVE DP015-RED        TO ASTRTITC                            
086500             MOVE DP015-UNP-NUM-BRT-MDT                                   
086600                                   TO ASTRTITA                            
086700             SET DP020-MSG-FATAL   TO TRUE                                
086800             SET PS-ERROR          TO TRUE                                
086900         END-IF                                                           
087000     END-IF.                                                              
087100 EJECT                                                                    
087200******************************************************************        
087300** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **        
087400** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **        
087500******************************************************************        
087600 2200-MOVE-SCREEN-TO-COMMAREA.                                            
087700                                                                          
087800     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.                     
087900     MOVE +1                       TO PV-SUB.                             
088000*                                                                         
088100     PERFORM 3100-SET-SUBSCRIPTS.                                         
088200     IF  ASTRTITL > ZERO                                                  
088300         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST                  
088400     ELSE                                                                 
088500         IF  ASTRTITF = DP015-ERASE-EOF                                   
088600             INITIALIZE ASC-START-ITEM-REQUEST                            
088700         END-IF                                                           
088800     END-IF.                                                              
088900/                                                                         
089000*----------------------------------------------------------------*        
089100*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *        
089200*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*        
089300*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *        
089400*                                                                *        
089500*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *        
089600*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *        
089700*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *        
089800*    US IN THE 2ND BLOCK OF THE ARRAY.                           *        
089900*----------------------------------------------------------------*        
090000                                                                          
090100 3100-SET-SUBSCRIPTS.                                                     
090200                                                                          
090300     COMPUTE ASC-ITEM-SUB =                                               
090400         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.                
090500                                                                          
090600     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                                 
090700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB                    
090800                                                                          
090900         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB                       
091000     ELSE                                                                 
091100         MOVE +1                     TO ASC-BLK-SUB                       
091200     END-IF.                                                              
091300******************************************************************        
091400** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **        
091500******************************************************************        
091600                                                                          
091700 3200-RESET-ATTRIBUTES.                                                   
091800     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                           
091900     MOVE DP015-GREEN              TO ASTRTITC.                           
092000     MOVE DP015-UNDERLINE          TO ASTRTITH.                           
092100                                                                          
092200     PERFORM                                                              
092300         VARYING PV-SUB                                                   
092400         FROM 1 BY 1                                                      
092500         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                                
092600         MOVE DP015-UNP-ALP-NOR-OFF                                       
092700                                   TO MR-GROUP-NBRA (PV-SUB)              
092800         MOVE DP015-BLUE           TO MR-GROUP-NBRC (PV-SUB)              
092900         MOVE DP015-UNDERLINE      TO MR-GROUP-NBRH (PV-SUB)              
093000     END-PERFORM.                                                         
093100******************************************************************        
093200** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **        
093300** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **        
093400******************************************************************        
093500 3400-CHECK-RANGE-SEQUENCE.                                               
093600     IF  ASC-START-OF-SELECTED-RANGE > ZERO                               
093700       AND  ASC-END-OF-SELECTED-RANGE > ZERO                              
093800       AND  ASC-START-OF-SELECTED-RANGE >                                 
093900                                         ASC-END-OF-SELECTED-RANGE        
094000*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                        
094100         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                         
094200         SET DP020-MSG-FATAL TO TRUE                                      
094300         SET PS-ERROR TO TRUE                                             
094400         PERFORM 3410-POSITION-AT-ERROR                                   
094500     END-IF.                                                              
094600******************************************************************        
094700** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **        
094800** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **        
094900** SHOULD BE POSITIONED ON A RANGE ERROR.                       **        
095000******************************************************************        
095100 3410-POSITION-AT-ERROR.                                                  
095200     SET DP030-SET-CURSOR-APPL-1                                          
095300                                   TO TRUE.                               
095400     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                         
095500                    - PV-TOP-ITEM + 1.                                    
095600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
095700         CONTINUE                                                         
095800     ELSE                                                                 
095900         MOVE -1                   TO MR-GROUP-NBR-L (PV-SUB)             
096000         MOVE DP015-REVERSE        TO MR-GROUP-NBRH (PV-SUB)              
096100         MOVE DP015-RED            TO MR-GROUP-NBRC (PV-SUB)              
096200     END-IF.                                                              
096300*                                                                         
096400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                           
096500                    - PV-TOP-ITEM + 1.                                    
096600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
096700         CONTINUE                                                         
096800     ELSE                                                                 
096900         MOVE -1                   TO MR-GROUP-NBR-L (PV-SUB)             
097000         MOVE DP015-REVERSE        TO MR-GROUP-NBRH (PV-SUB)              
097100         MOVE DP015-RED            TO MR-GROUP-NBRC (PV-SUB)              
097200     END-IF.                                                              
097300/                                                                         
097400*----------------------------------------------------------------*        
097500*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *        
097600*    INITIALIZE ALL COUNTERS AND FLAGS.                          *        
097700*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *        
097800*    DISPLAY THE PANEL TO USER.                                  *        
097900*----------------------------------------------------------------*        
098000                                                                          
098100 4000-BUILD-INITIAL-PANEL.                                                
098200                                                                          
098300     INITIALIZE                  ASC-BLOCK-ENTRIES (1)                    
098400                                 ASC-BLOCK-ENTRIES (2).                   
098500     MOVE +1                 TO ASC-BLK-SUB.                              
098600     SET ASC-ITEMS-LEFT-ON-DB                                             
098700                             TO TRUE.                                     
098800                                                                          
098900     MOVE ZERO               TO ASC-ITEM-SUB                              
099000                                ASC-NUMBER-OF-ITEMS-READ                  
099100                                ASC-NUMBER-OF-SELECTED-ITEMS              
099200                                ASC-HIGHEST-BLOCK-WRITTEN                 
099300                                ASC-START-OF-SELECTED-RANGE               
099400                                ASC-END-OF-SELECTED-RANGE                 
099500                                ASC-ITEM-AT-TOP-OF-PANEL.                 
099600*    PERFORM 4100-PREPARE-CURSOR                                          
099700                                                                          
099800     PERFORM 4010-OPEN-CURSOR.                                            
099900                                                                          
100000     PERFORM 4300-READ-ITEMS-FROM-DB.                                     
100100                                                                          
100200     PERFORM 4020-CLOSE-CURSOR.                                           
100300                                                                          
100400     MOVE +1                   TO  PV-TOP-ITEM.                           
100500     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                                  
100600         MOVE -1                      TO ASTRTITO                         
100700         MOVE ASC-KEY-OPER-UNT-ID     TO ADCO                             
100800         MOVE ASC-KEY-OPER-DESC       TO ADCNMEO                          
100900         PERFORM VARYING PV-SUB                                           
101000                 FROM PC-ITEMS-PER-PANEL BY -1                            
101100                 UNTIL PV-SUB < +1                                        
101200             MOVE DP015-ASK-DRK-OFF  TO MR-GROUP-NBRA (PV-SUB)            
101300                                        MR-DOOR-NBRA (PV-SUB)             
101400         END-PERFORM                                                      
101500         SET DP020-MSG-FATAL                                              
101600             DP030-SET-CURSOR-APPL-1                                      
101700             DP030-OVERRIDE-APPL-ERROR TO TRUE                            
101800         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER                       
101900     ELSE                                                                 
102000         MOVE -1                      TO ASTRTITO                         
102100         SET DP030-SET-CURSOR-APPL-1                                      
102200                               TO TRUE                                    
102300         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                             
102400     END-IF.                                                              
102500/                                                                         
102600 4010-OPEN-CURSOR.                                                        
102700                                                                          
102800     IF ASC-DOOR-SEQUENCE                                                 
102900         PERFORM 7100-OPEN-DOOR-CSR                                       
103000     ELSE                                                                 
103100         PERFORM 7200-OPEN-GROUP-CSR                                      
103200     END-IF.                                                              
103300/                                                                         
103400 4020-CLOSE-CURSOR.                                                       
103500     IF ASC-DOOR-SEQUENCE                                                 
103600         PERFORM 7120-CLOSE-DOOR-CSR                                      
103700     ELSE                                                                 
103800         PERFORM 7220-CLOSE-GROUP-CSR                                     
103900     END-IF.                                                              
104000/                                                                         
104100*----------------------------------------------------------------*        
104200*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *        
104300*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *        
104400*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *        
104500*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *        
104600*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *        
104700*                                                                *        
104800*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *        
104900*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *        
105000*    UPON INITIALIZATION.                                        *        
105100*----------------------------------------------------------------*        
105200                                                                          
105300 4300-READ-ITEMS-FROM-DB.                                                 
105400                                                                          
105500     PERFORM                                                              
105600         VARYING PV-READ-COUNT                                            
105700         FROM 1 BY 1                                                      
105800         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                            
105900            OR (ASC-NO-ITEMS-LEFT-ON-DB))                                 
106000                                                                          
106100         PERFORM 4310-FETCH                                               
106200                                                                          
106300         IF  ASC-ITEMS-LEFT-ON-DB                                         
106400             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                        
106500                 ADD +1            TO ASC-ITEM-SUB                        
106600             ELSE                                                         
106700                 ADD +1            TO ASC-BLK-SUB                         
106800                 MOVE +1           TO ASC-ITEM-SUB                        
106900                                                                          
107000                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 
107100                     MOVE +1       TO ASC-BLK-SUB                         
107200                     SET ASC-BLOCK-MODIFIED (1)                           
107300                                   TO TRUE                                
107400                     PERFORM 5100-WRITE-TEMP-STORAGE                      
107500                     MOVE ASC-BLOCK-ENTRIES                               
107600                               (PC-MAX-BLOCKS-IN-ARRAY)                   
107700                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)         
107800                     ADD +1        TO ASC-BLK-SUB                         
107900                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)           
108000                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)              
108100                                   TO TRUE                                
108200                 END-IF                                                   
108300             END-IF                                                       
108400             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ            
108500             MOVE ASC-NUMBER-OF-ITEMS-READ                                
108600                                   TO ASC-LIST-ITEM-NUMBER                
108700                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
108800*            LOAD CURSOR FIELDS TO ASC                                    
108900             MOVE DLT00001-DOOR-ID    TO ASC-DOOR-ID                      
109000                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
109100             MOVE DLT00001-DOOR-GP-NBR TO ASC-GROUP-NBR                   
109200                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
109300         END-IF                                                           
109400     END-PERFORM.                                                         
109500                                                                          
109600     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                                  
109700         MOVE +1               TO ASC-BLK-SUB                             
109800         PERFORM 5100-WRITE-TEMP-STORAGE                                  
109900         ADD +1                TO ASC-BLK-SUB                             
110000         PERFORM 5100-WRITE-TEMP-STORAGE                                  
110100                                                                          
110200         MOVE 1                TO ASC-BLK-SUB                             
110300                                  PV-BLOCK-NUMBER                         
110400         PERFORM 4410-READ-TEMP-STORAGE                                   
110500         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1                     
110600             MOVE 2            TO ASC-BLK-SUB                             
110700                                  PV-BLOCK-NUMBER                         
110800             PERFORM 4410-READ-TEMP-STORAGE                               
110900         END-IF                                                           
111000     END-IF.                                                              
111100/                                                                         
111200 4310-FETCH.                                                              
111300                                                                          
111400     IF ASC-DOOR-SEQUENCE                                                 
111500         PERFORM 7110-FETCH-DOOR-CSR                                      
111600     ELSE                                                                 
111700         PERFORM 7210-FETCH-GROUP-CSR                                     
111800     END-IF.                                                              
111900/                                                                         
112000*----------------------------------------------------------------*        
112100* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *        
112200*----------------------------------------------------------------*        
112300                                                                          
112400 4400-MOVE-COMMAREA-TO-SCREEN.                                            
112500     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))                     
112600         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))                  
112700         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))                  
112800             MOVE +1    TO ASC-BLK-SUB                                    
112900             PERFORM 5100-WRITE-TEMP-STORAGE                              
113000             ADD +1     TO ASC-BLK-SUB                                    
113100             PERFORM 5100-WRITE-TEMP-STORAGE                              
113200             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                     
113300                 GIVING PV-BLOCK-NUMBER                                   
113400                 REMAINDER PV-REMAINDER                                   
113500             IF  PV-REMAINDER > ZERO                                      
113600                 ADD +1 TO PV-BLOCK-NUMBER                                
113700             END-IF                                                       
113800             MOVE +1    TO ASC-BLK-SUB                                    
113900             PERFORM 4410-READ-TEMP-STORAGE                               
114000             ADD +1     TO ASC-BLK-SUB                                    
114100                           PV-BLOCK-NUMBER                                
114200             PERFORM 4410-READ-TEMP-STORAGE                               
114300     END-IF.                                                              
114400     MOVE +1            TO ASC-BLK-SUB.                                   
114500     COMPUTE ASC-ITEM-SUB =                                               
114600         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))                      
114700         + PC-ITEMS-PER-PANEL).                                           
114800*                                                                         
114900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                                
115000         ADD +1         TO ASC-BLK-SUB                                    
115100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB                    
115200     END-IF.                                                              
115300*                                                                         
115400     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                                   
115500         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                        
115600     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                                
115700     PERFORM 4420-FORMAT-LIST-LINES                                       
115800         VARYING PV-SUB                                                   
115900         FROM PC-ITEMS-PER-PANEL BY -1                                    
116000         UNTIL PV-SUB < +1.                                               
116100                                                                          
116200     COMPUTE ASC-ITEMS-DISPLAYED =                                        
116300         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).                  
116400     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL            
116500                                      ASTRTITO.                           
116600     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                            
116700     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                            
116800                                                                          
116900*    HEADINGS                                                             
117000                                                                          
117100     MOVE ASC-KEY-OPER-UNT-ID         TO ADCO                             
117200     MOVE ASC-KEY-OPER-DESC           TO ADCNMEO.                         
117300     MOVE ASC-KEY-DOOR-COUNT          TO ATDOORO.                         
117400                                                                          
117500     IF ASC-DOOR-SEQUENCE                                                 
117600         MOVE '** DOOR SEQUENCE **'   TO ASEQO                            
117700     ELSE                                                                 
117800         MOVE '** GROUP SEQUENCE **'   TO ASEQO                           
117900     END-IF                                                               
118000     MOVE ASC-DOOR-GP-TMPL-ID         TO ATMPLO.                          
118100     MOVE ASC-KEY-TEMPLATE-DESC       TO ADESCO.                          
118200*                                                                         
118300     IF  DP020-MSG-NUMBER-X = SPACE                                       
118400         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ          
118500*            --- MORE ITEMS TO DISPLAY ----                               
118600             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER                    
118700             SET DP020-MSG-INFORMATIONAL TO TRUE                          
118800         END-IF                                                           
118900     END-IF.                                                              
119000*----------------------------------------------------------------*        
119100*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *        
119200*----------------------------------------------------------------*        
119300                                                                          
119400 4410-READ-TEMP-STORAGE.                                                  
119500                                                                          
119600     EXEC CICS                                                            
119700         READQ TS                                                         
119800             QUEUE (ASC-LIST-QUEUE-NAME)                                  
119900             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                       
120000             ITEM  (PV-BLOCK-NUMBER)                                      
120100             RESP  (PV-CICS-RESP)                                         
120200     END-EXEC.                                                            
120300                                                                          
120400     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                               
120500       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                             
120600         CONTINUE                                                         
120700     ELSE                                                                 
120800         SET DP013-CICS-ABEND     TO TRUE                                 
120900         SET DP013-NO-ROLLBACK    TO TRUE                                 
121000         MOVE '4410-READ-TEMP-STORAGE'                                    
121100                                  TO DP013-PARAGRAPH                      
121200         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'              
121300                                  TO DP013-MESSAGE-TEXT(1)                
121400         PERFORM DP013-0000-PROCESS-ABEND                                 
121500     END-IF.                                                              
121600                                                                          
121700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.                     
121800*                                                                         
121900     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                                 
122000         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)                       
122100     END-IF.                                                              
122200 EJECT                                                                    
122300*----------------------------------------------------------------*        
122400*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *        
122500*----------------------------------------------------------------*        
122600                                                                          
122700 4420-FORMAT-LIST-LINES.                                                  
122800     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ              
122900         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                        
123000         MOVE DP015-ASK-DRK-OFF  TO MR-GROUP-NBRA (PV-SUB)                
123100                                    MR-DOOR-NBRA (PV-SUB)                 
123200         MOVE DP015-HL-OFF       TO MR-GROUP-NBRH (PV-SUB)                
123300                                    MR-DOOR-NBRH (PV-SUB)                 
123400         MOVE SPACE              TO MR-GROUP-NBR (PV-SUB)                 
123500                                    MR-DOOR-NBR (PV-SUB)                  
123600     ELSE                                                                 
123700                                                                          
123800         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL                   
123900             MOVE ASC-DOOR-ID (ASC-BLK-SUB ASC-ITEM-SUB)                  
124000                                      TO MR-DOOR-NBR (PV-SUB)             
124100             IF ASC-GROUP-NBR (ASC-BLK-SUB ASC-ITEM-SUB)                  
124200                     NUMERIC                                              
124300                 MOVE ASC-GROUP-NBR (ASC-BLK-SUB ASC-ITEM-SUB)            
124400                                      TO MR-GROUP-NBR-N (PV-SUB)          
124500             ELSE                                                         
124600                 MOVE ASC-GROUP-NBR-X (ASC-BLK-SUB ASC-ITEM-SUB)          
124700                                      TO MR-GROUP-NBR (PV-SUB)            
124800             END-IF                                                       
124900             MOVE DP015-ASK-NOR-OFF   TO MR-DOOR-NBRA (PV-SUB)            
125000                                         MR-GROUP-NBRA (PV-SUB)           
125100             MOVE DP015-BLUE          TO MR-DOOR-NBRC (PV-SUB)            
125200                                         MR-GROUP-NBRC (PV-SUB)           
125300             MOVE DP015-UNDERLINE     TO MR-GROUP-NBRH (PV-SUB)           
125400                                                                          
125500         END-IF                                                           
125600     END-IF.                                                              
125700                                                                          
125800     SUBTRACT +1 FROM ASC-ITEM-SUB                                        
125900     IF  ASC-ITEM-SUB < + 1                                               
126000         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                          
126100         MOVE +1                 TO ASC-BLK-SUB                           
126200     END-IF.                                                              
126300******************************************************************        
126400** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **        
126500** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **        
126600** ISSUE A WARNING.                                             **        
126700******************************************************************        
126800 4430-CHECK-FOR-BEGIN-AND-END.                                            
126900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                               
127000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                             
127100*            -- NO END-OF-RANGE SPECFIED ---                              
127200             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER                    
127300             SET DP020-MSG-WARNING TO TRUE                                
127400             PERFORM 4431-POSITION-AT-WARNING                             
127500         END-IF                                                           
127600     ELSE                                                                 
127700         IF  ASC-END-OF-SELECTED-RANGE > ZERO                             
127800*            -- NO BEGINNING-OF-RANGE SPECFIED ---                        
127900             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER                    
128000             SET DP020-MSG-WARNING TO TRUE                                
128100             PERFORM 4431-POSITION-AT-WARNING                             
128200         END-IF                                                           
128300     END-IF.                                                              
128400******************************************************************        
128500** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **        
128600** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **        
128700** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **        
128800** POSITION THE CURSOR THERE.                                   **        
128900******************************************************************        
129000 4431-POSITION-AT-WARNING.                                                
129100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                         
129200                    - PV-TOP-ITEM + 1.                                    
129300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
129400         CONTINUE                                                         
129500     ELSE                                                                 
129600         SET DP030-SET-CURSOR-APPL-1                                      
129700                                   TO TRUE                                
129800         MOVE -1                   TO MR-GROUP-NBR-L (PV-SUB)             
129900         MOVE DP015-REVERSE        TO MR-GROUP-NBRH (PV-SUB)              
130000         MOVE DP015-YELLOW         TO MR-GROUP-NBRC (PV-SUB)              
130100     END-IF.                                                              
130200*                                                                         
130300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                           
130400                    - PV-TOP-ITEM + 1.                                    
130500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
130600         CONTINUE                                                         
130700     ELSE                                                                 
130800         SET DP030-SET-CURSOR-APPL-1                                      
130900                                   TO TRUE                                
131000         MOVE -1                   TO MR-GROUP-NBR-L (PV-SUB)             
131100         MOVE DP015-REVERSE        TO MR-GROUP-NBRH (PV-SUB)              
131200         MOVE DP015-YELLOW         TO MR-GROUP-NBRC (PV-SUB)              
131300     END-IF.                                                              
131400 EJECT                                                                    
131500*----------------------------------------------------------------*        
131600*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *        
131700*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *        
131800*----------------------------------------------------------------*        
131900                                                                          
132000 5100-WRITE-TEMP-STORAGE.                                                 
132100     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                             
132200                                   TO PV-LIST-ITEM-NUMBER.                
132300     COMPUTE PV-BLOCK-NUMBER =                                            
132400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).            
132500                                                                          
132600     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)                     
132700     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)                     
132800         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                              
132900             PERFORM 5105-REWRITE-ASC-LISTQ                               
133000         END-IF                                                           
133100     ELSE                                                                 
133200         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                               
133300         ASC-HIGHEST-BLOCK-WRITTEN + 1                                    
133400         PERFORM 5110-WRITE-ASC-LISTQ                                     
133500         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN           
133600     END-IF.                                                              
133700                                                                          
133800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.                     
133900******************************************************************        
134000** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **        
134100** SPECIFIC COMMAREA.                                           **        
134200******************************************************************        
134300 5105-REWRITE-ASC-LISTQ.                                                  
134400     EXEC CICS                                                            
134500         WRITEQ TS                                                        
134600             QUEUE (ASC-LIST-QUEUE-NAME)                                  
134700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                       
134800             ITEM  (PV-BLOCK-NUMBER)                                      
134900             REWRITE                                                      
135000             RESP  (PV-CICS-RESP)                                         
135100     END-EXEC.                                                            
135200                                                                          
135300     IF  PV-CICS-RESP = DFHRESP(NORMAL)                                   
135400         CONTINUE                                                         
135500     ELSE                                                                 
135600         SET DP013-CICS-ABEND            TO TRUE                          
135700         SET DP013-NO-ROLLBACK           TO TRUE                          
135800         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH               
135900         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'             
136000                                         TO DP013-MESSAGE-TEXT(1)         
136100         PERFORM DP013-0000-PROCESS-ABEND                                 
136200     END-IF.                                                              
136300                                                                          
136400******************************************************************        
136500** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **        
136600** SPECIFIC COMMAREA.                                           **        
136700******************************************************************        
136800 5110-WRITE-ASC-LISTQ.                                                    
136900     EXEC CICS                                                            
137000         WRITEQ TS                                                        
137100             QUEUE (ASC-LIST-QUEUE-NAME)                                  
137200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                       
137300             ITEM  (PV-BLOCK-NUMBER)                                      
137400             RESP  (PV-CICS-RESP)                                         
137500     END-EXEC.                                                            
137600     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                              
137700         SET DP013-CICS-ABEND      TO TRUE                                
137800         SET DP013-NO-ROLLBACK     TO TRUE                                
137900         MOVE '5110-WRITE-ASC-LISTQ'                                      
138000                                   TO DP013-PARAGRAPH                     
138100         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'                   
138200                                   TO DP013-MESSAGE-TEXT(1)               
138300         PERFORM DP013-0000-PROCESS-ABEND                                 
138400     END-IF.                                                              
138500/                                                                         
138600*----------------------------------------------------------------*        
138700*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *        
138800*----------------------------------------------------------------*        
138900                                                                          
139000 5205-WRITE-SEL-QUEUE.                                                    
139100                                                                          
139200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                                    
139300                                   TO DL006-SELECTED-ITEMS.               
139400                                                                          
139500     EXEC CICS                                                            
139600          WRITEQ TS                                                       
139700              QUEUE (ASC-SEL-QUEUE-NAME)                                  
139800              FROM  (DL006-SELECT-RECORD)                                 
139900              ITEM  (PV-SEL-QUEUE-ITEM)                                   
140000              RESP  (PV-CICS-RESP)                                        
140100     END-EXEC.                                                            
140200                                                                          
140300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
140400         CONTINUE                                                         
140500     ELSE                                                                 
140600         SET DP013-CICS-ABEND      TO TRUE                                
140700         SET DP013-NO-ROLLBACK     TO TRUE                                
140800         MOVE '5205-WRITE-SEL-QUEUE'                                      
140900                                   TO DP013-PARAGRAPH                     
141000         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'                  
141100                                   TO DP013-MESSAGE-TEXT(1)               
141200         PERFORM DP013-0000-PROCESS-ABEND                                 
141300     END-IF.                                                              
141400 EJECT                                                                    
141500******************************************************************        
141600** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **        
141700** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **        
141800** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **        
141900** THE USER.                                                    **        
142000******************************************************************        
142100 6000-REFRESH-PANEL-FROM-TEMP.                                            
142200     IF  ASC-UPDATE-TSQ                                                   
142300         SET ASC-NO-TSQ-UPDATE TO TRUE                                    
142400         MOVE ZERO                 TO PV-SAVE-ITEM                        
142500                                      PV-SEL-QUEUE-ITEM                   
142600         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                                
142700                                   TO PV-HOLD-SELECTED-ITEMS              
142800         MOVE +1                   TO PV-ITEMS-PROCESSED                  
142900         PERFORM 6100-UPDATE-TSQ                                          
143000             UNTIL PV-ITEMS-PROCESSED >                                   
143100                                     PV-HOLD-SELECTED-ITEMS               
143200         PERFORM 6010-DELETE-SEL-QUEUE                                    
143300         INITIALIZE ASC-BLOCK-ENTRIES (1)                                 
143400                    ASC-BLOCK-ENTRIES (2)                                 
143500     END-IF.                                                              
143600                                                                          
143700*----------------------------------------------------------------*        
143800*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *        
143900*----------------------------------------------------------------*        
144000 6010-DELETE-SEL-QUEUE.                                                   
144100                                                                          
144200     EXEC CICS                                                            
144300         DELETEQ TS                                                       
144400             QUEUE (ASC-SEL-QUEUE-NAME)                                   
144500             RESP  (PV-CICS-RESP)                                         
144600     END-EXEC.                                                            
144700*                                                                         
144800     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                              
144900        (PV-CICS-RESP = DFHRESP(QIDERR)))                                 
145000         CONTINUE                                                         
145100     ELSE                                                                 
145200         SET DP013-CICS-ABEND TO TRUE                                     
145300         SET DP013-NO-ROLLBACK TO TRUE                                    
145400         MOVE '6010-DELETE-SEL-QUEUE'                                     
145500                        TO DP013-PARAGRAPH                                
145600         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'                 
145700                        TO DP013-MESSAGE-TEXT (1)                         
145800         PERFORM DP013-0000-PROCESS-ABEND                                 
145900     END-IF.                                                              
146000                                                                          
146100*----------------------------------------------------------------*        
146200*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *        
146300*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *        
146400*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *        
146500*    THE TEMP QUEUE.                                             *        
146600*----------------------------------------------------------------*        
146700                                                                          
146800 6100-UPDATE-TSQ.                                                         
146900                                                                          
147000     ADD 1                     TO  PV-SEL-QUEUE-ITEM.                     
147100     PERFORM 6105-READ-SEL-QUEUE.                                         
147200     PERFORM                                                              
147300         VARYING DL006-IDX                                                
147400         FROM 1 BY 1                                                      
147500         UNTIL ((PV-ITEMS-PROCESSED >                                     
147600                              PV-HOLD-SELECTED-ITEMS)                     
147700         OR (DL006-IDX GREATER THAN DL006-MAX-ITEMS))                     
147800         IF  DL006-ACTION-SW (DL006-IDX) > SPACE                          
147900             PERFORM 6110-PROCESS-ITEMS                                   
148000         END-IF                                                           
148100         ADD +1                TO PV-ITEMS-PROCESSED                      
148200     END-PERFORM.                                                         
148300     PERFORM 6111-WRITE-LIST-QUEUE.                                       
148400*----------------------------------------------------------------*        
148500*    READ THE LIST QUEUE RECORD.                                 *        
148600*----------------------------------------------------------------*        
148700                                                                          
148800 6105-READ-SEL-QUEUE.                                                     
148900                                                                          
149000     EXEC CICS                                                            
149100          READQ TS                                                        
149200              QUEUE (ASC-SEL-QUEUE-NAME)                                  
149300              INTO  (DL006-SELECT-RECORD)                                 
149400              ITEM  (PV-SEL-QUEUE-ITEM)                                   
149500              RESP  (PV-CICS-RESP)                                        
149600     END-EXEC.                                                            
149700*                                                                         
149800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
149900         CONTINUE                                                         
150000     ELSE                                                                 
150100         SET DP013-CICS-ABEND      TO  TRUE                               
150200         SET DP013-NO-ROLLBACK     TO  TRUE                               
150300         MOVE '6105-READ-SEL-QUEUE'                                       
150400                                   TO  DP013-PARAGRAPH                    
150500         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'                   
150600                                   TO  DP013-MESSAGE-TEXT(1)              
150700         PERFORM DP013-0000-PROCESS-ABEND                                 
150800     END-IF.                                                              
150900 EJECT                                                                    
151000                                                                          
151100 6110-PROCESS-ITEMS.                                                      
151200                                                                          
151300     COMPUTE PV-ITEM = 1 + ((DL006-ITEM (DL006-IDX) - 1)                  
151400                     / PC-ITEMS-PER-PANEL).                               
151500                                                                          
151600     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                                   
151700         IF  PV-SAVE-ITEM NOT EQUAL ZERO                                  
151800             PERFORM 6111-WRITE-LIST-QUEUE                                
151900         END-IF                                                           
152000         MOVE PV-ITEM          TO PV-SAVE-ITEM                            
152100                                                                          
152200         PERFORM 6112-READ-LIST-QUEUE                                     
152300         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                       
152400             CONTINUE                                                     
152500         END-IF                                                           
152600     END-IF.                                                              
152700                                                                          
152800     COMPUTE PV-SUB = (DL006-ITEM (DL006-IDX)                             
152900                    - LQW-LIST-ITEM-NUMBER (1)) + 1.                      
153000                                                                          
153100     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                        
153200                                                                          
153300*----------------------------------------------------------------*        
153400*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *        
153500*----------------------------------------------------------------*        
153600                                                                          
153700 6111-WRITE-LIST-QUEUE.                                                   
153800                                                                          
153900     EXEC CICS                                                            
154000         WRITEQ TS                                                        
154100             QUEUE (ASC-LIST-QUEUE-NAME)                                  
154200             FROM  (LQW-LIST-QUEUE-WORK-AREA)                             
154300             ITEM  (PV-SAVE-ITEM)                                         
154400             REWRITE                                                      
154500             RESP  (PV-CICS-RESP)                                         
154600     END-EXEC.                                                            
154700*                                                                         
154800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
154900         CONTINUE                                                         
155000     ELSE                                                                 
155100         SET DP013-CICS-ABEND  TO  TRUE                                   
155200         SET DP013-NO-ROLLBACK TO  TRUE                                   
155300         MOVE '6111-WRITE-LIST-QUEUE'                                     
155400                               TO  DP013-PARAGRAPH                        
155500         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                          
155600                               TO  DP013-MESSAGE-TEXT(1)                  
155700         PERFORM DP013-0000-PROCESS-ABEND                                 
155800     END-IF.                                                              
155900                                                                          
156000 EJECT                                                                    
156100*----------------------------------------------------------------*        
156200*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*        
156300*----------------------------------------------------------------*        
156400                                                                          
156500 6112-READ-LIST-QUEUE.                                                    
156600                                                                          
156700     EXEC CICS                                                            
156800         READQ TS                                                         
156900             QUEUE (ASC-LIST-QUEUE-NAME)                                  
157000             INTO  (LQW-LIST-QUEUE-WORK-AREA)                             
157100             ITEM  (PV-ITEM)                                              
157200             RESP  (PV-CICS-RESP)                                         
157300     END-EXEC.                                                            
157400*                                                                         
157500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
157600         CONTINUE                                                         
157700     ELSE                                                                 
157800         SET DP013-CICS-ABEND        TO TRUE                              
157900         SET DP013-NO-ROLLBACK       TO TRUE                              
158000         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH                   
158100         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                            
158200                                     TO DP013-MESSAGE-TEXT(1)             
158300         PERFORM DP013-0000-PROCESS-ABEND                                 
158400     END-IF.                                                              
158500/                                                                         
158600 7000-LOCATION-DESC.                                                      
158700     MOVE DP020-LOCATION-NBR          TO XLT00010-LOC-NBR                 
158800                                                                          
158900     EXEC SQL                                                             
159000         SELECT  LOC_NM                                                   
159100           INTO  :XLT00010-LOC-NM                                         
159200           FROM  XLT_LOC                                                  
159300         WHERE LOC_NBR        = :XLT00010-LOC-NBR                         
159400     END-EXEC                                                             
159500                                                                          
159600     EVALUATE TRUE                                                        
159700         WHEN SQLCODE = ZERO                                              
159800             MOVE XLT00010-LOC-NM     TO ASC-KEY-OPER-DESC                
159900         WHEN SQLCODE = +100                                              
160000             MOVE ALL '?'             TO ASC-KEY-OPER-DESC                
160100         WHEN SQLCODE = -904                                              
160200         WHEN SQLCODE = -911                                              
160300         WHEN SQLCODE = -913                                              
160400             MOVE SQLCODE                   TO PV-SOFT-SQLCODE            
160500             MOVE '7000-LOCATION-DESC'      TO PV-SOFT-PARAGRAPH          
160600             MOVE PV-SOFT-ABORT-MSG         TO PV-CICS-MSG-AREA2          
160700             MOVE LENGTH OF PV-CICS-MSG-AREA2                             
160800               TO PV-COMMAREA-LENGTH                                      
160900             EXEC CICS                                                    
161000                  WRITEQ TD                                               
161100                   QUEUE  ('CSSL')                                        
161200                    FROM  (PV-CICS-MSG-AREA2)                             
161300                  LENGTH  (PV-COMMAREA-LENGTH)                            
161400                    RESP  (PV-CICS-RESP)                                  
161500             END-EXEC                                                     
161600             MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER                  
161700             SET  DP020-NEXT-ACT-APPL-ERROR  TO TRUE                      
161800             PERFORM 9900-SOFT-ABORT                                      
161900         WHEN OTHER                                                       
162000              MOVE '7000-LOCATION-DESC'                                   
162100                               TO DP013-PARAGRAPH                         
162200              MOVE 'GET LOCATION DESCRIPTION'                             
162300                               TO DP013-MESSAGE-TEXT (1)                  
162400              MOVE SQLCA       TO DP013-SQLCA                             
162500              MOVE 'XLT_LOC '  TO DP013-DB2-TABLE-NAME (1)                
162600              SET DP013-DB2-ABEND                                         
162700                  DP013-XCTL-DISPLAY-RESTART                              
162800                                   TO TRUE                                
162900                  PERFORM DP013-0000-PROCESS-ABEND                        
163000     END-EVALUATE.                                                        
163100                                                                          
163200 7010-COUNT-TEMPLATE-DOORS.                                               
163300                                                                          
163400     MOVE ZERO                        TO PV-TEMPLATE-DOOR-COUNT           
163500     EXEC SQL                                                             
163600         SELECT  COUNT(*)                                                 
163700           INTO  :PV-TEMPLATE-DOOR-COUNT                                  
163800           FROM  DLT_DOOR_GP                                              
163900         WHERE DOOR_GP_TMPL_ID = :DLT00001-DOOR-GP-TMPL-ID                
164000     END-EXEC                                                             
164100                                                                          
164200     EVALUATE TRUE                                                        
164300         WHEN SQLCODE = ZERO                                              
164400         WHEN SQLCODE = +100                                              
164500             CONTINUE                                                     
164600         WHEN SQLCODE = -904                                              
164700         WHEN SQLCODE = -911                                              
164800         WHEN SQLCODE = -913                                              
164900             MOVE SQLCODE             TO PV-SOFT-SQLCODE                  
165000             MOVE '7010-COUNT-TEMPLATE-DOORS'                             
165100                                      TO PV-SOFT-PARAGRAPH                
165200             MOVE PV-SOFT-ABORT-MSG   TO PV-CICS-MSG-AREA2                
165300             MOVE LENGTH OF PV-CICS-MSG-AREA2                             
165400               TO PV-COMMAREA-LENGTH                                      
165500             EXEC CICS                                                    
165600                  WRITEQ TD                                               
165700                   QUEUE  ('CSSL')                                        
165800                    FROM  (PV-CICS-MSG-AREA2)                             
165900                  LENGTH  (PV-COMMAREA-LENGTH)                            
166000                    RESP  (PV-CICS-RESP)                                  
166100             END-EXEC                                                     
166200             MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER                  
166300             SET  DP020-NEXT-ACT-APPL-ERROR  TO TRUE                      
166400             PERFORM 9900-SOFT-ABORT                                      
166500         WHEN OTHER                                                       
166600              MOVE '7010-COUNT-TEMPLATE-DOORS'                            
166700                                      TO DP013-PARAGRAPH                  
166800              MOVE 'COUNT GROUPS WITHIN TEMPLATE'                         
166900                                      TO DP013-MESSAGE-TEXT (1)           
167000              MOVE SQLCA              TO DP013-SQLCA                      
167100              MOVE 'DLT_DOOR_GP'      TO DP013-DB2-TABLE-NAME (1)         
167200              SET DP013-DB2-ABEND                                         
167300                  DP013-XCTL-DISPLAY-RESTART                              
167400                                   TO TRUE                                
167500                  PERFORM DP013-0000-PROCESS-ABEND                        
167600     END-EVALUATE.                                                        
167700/                                                                         
167800 7100-OPEN-DOOR-CSR.                                                      
167900                                                                          
168000     EXEC SQL                                                             
168100         OPEN DOOR-CSR                                                    
168200     END-EXEC                                                             
168300                                                                          
168400     EVALUATE TRUE                                                        
168500         WHEN SQLCODE = ZERO                                              
168600             CONTINUE                                                     
168700         WHEN SQLCODE = -904                                              
168800         WHEN SQLCODE = -911                                              
168900         WHEN SQLCODE = -913                                              
169000             MOVE '7100-OPEN-DOOR-CSR'                                    
169100                                      TO DP013-PARAGRAPH                  
169200             MOVE 'DB2 TIMEOUT ATTEMPTING TO OPEN CSR'                    
169300                                      TO DP013-MESSAGE-TEXT (1)           
169400             MOVE SQLCA               TO DP013-SQLCA                      
169500             MOVE 'DLT_DOOR_GP_TMPL'  TO DP013-DB2-TABLE-NAME (1)         
169600             SET DP013-DB2-ABEND                                          
169700                 DP013-XCTL-DISPLAY-RESTART                               
169800                                      TO TRUE                             
169900             PERFORM DP013-0000-PROCESS-ABEND                             
170000         WHEN SQLWARN0 NOT = SPACES                                       
170100         WHEN SQLCODE < ZERO                                              
170200         WHEN SQLCODE > ZERO                                              
170300             MOVE '7100-OPEN-DOOR-CSR'                                    
170400                                      TO DP013-PARAGRAPH                  
170500             MOVE 'OPEN DOOR CURSOR - '                                   
170600                                      TO DP013-MESSAGE-TEXT (1)           
170700             MOVE SQLCA               TO DP013-SQLCA                      
170800             MOVE 'DLT_DOOR_GP_TMPL'  TO DP013-DB2-TABLE-NAME (1)         
170900             SET DP013-DB2-ABEND                                          
171000                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
171100             PERFORM DP013-0000-PROCESS-ABEND                             
171200     END-EVALUATE.                                                        
171300*                                                                         
171400 7110-FETCH-DOOR-CSR.                                                     
171500                                                                          
171600     EXEC SQL                                                             
171700         FETCH DOOR-CSR                                                   
171800         INTO                                                             
171900             :DLT00001-DOOR-ID                                            
172000         ,   :DLT00001-DOOR-GP-NBR                                        
172100     END-EXEC                                                             
172200                                                                          
172300     EVALUATE TRUE                                                        
172400         WHEN SQLCODE = ZERO                                              
172500             CONTINUE                                                     
172600         WHEN SQLCODE = +100                                              
172700              SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                         
172800                                                                          
172900         WHEN SQLCODE = -904                                              
173000         WHEN SQLCODE = -911                                              
173100         WHEN SQLCODE = -913                                              
173200             MOVE '7110-FETCH-DOOR-CSR'                                   
173300                                      TO DP013-PARAGRAPH                  
173400             MOVE 'DB2 TIMEOUT ATTEMPTING TO FETCH CSR'                   
173500                                      TO DP013-MESSAGE-TEXT (1)           
173600             MOVE SQLCA               TO DP013-SQLCA                      
173700             MOVE 'DLT_DOOR_GP_TMPL'  TO DP013-DB2-TABLE-NAME (1)         
173800             SET DP013-DB2-ABEND                                          
173900                 DP013-XCTL-DISPLAY-RESTART                               
174000                                      TO TRUE                             
174100             PERFORM DP013-0000-PROCESS-ABEND                             
174200         WHEN SQLWARN0 NOT = SPACE                                        
174300         WHEN SQLCODE NOT = ZERO                                          
174400              MOVE '7110-FETCH-DOOR-CSR'                                  
174500                               TO DP013-PARAGRAPH                         
174600              MOVE 'FETCH TEMPLATE CURSOR'                                
174700                               TO DP013-MESSAGE-TEXT (1)                  
174800              MOVE SQLCA       TO DP013-SQLCA                             
174900              SET DP013-DB2-ABEND                                         
175000                               TO TRUE                                    
175100              PERFORM DP013-0000-PROCESS-ABEND                            
175200     END-EVALUATE.                                                        
175300                                                                          
175400 7120-CLOSE-DOOR-CSR.                                                     
175500                                                                          
175600     EXEC SQL                                                             
175700         CLOSE DOOR-CSR                                                   
175800     END-EXEC                                                             
175900                                                                          
176000     EVALUATE TRUE                                                        
176100         WHEN SQLCODE = ZERO                                              
176200             CONTINUE                                                     
176300         WHEN SQLWARN0 NOT = SPACES                                       
176400         WHEN SQLCODE < ZERO                                              
176500         WHEN SQLCODE > ZERO                                              
176600             MOVE 'DLT_DOOR_GP_TMPL'  TO DP013-DB2-TABLE-NAME (1)         
176700             MOVE '7120-CLOSE-DOOR-CSR'                                   
176800                                      TO DP013-PARAGRAPH                  
176900             MOVE 'CLOSE TEMPLATE CURSOR '                                
177000                                      TO DP013-MESSAGE-TEXT (1)           
177100             MOVE SQLCA               TO DP013-SQLCA                      
177200             SET DP013-DB2-ABEND                                          
177300                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
177400             PERFORM DP013-0000-PROCESS-ABEND                             
177500     END-EVALUATE.                                                        
177600/                                                                         
177700 7200-OPEN-GROUP-CSR.                                                     
177800                                                                          
177900     EXEC SQL                                                             
178000         OPEN GROUP-CSR                                                   
178100     END-EXEC                                                             
178200                                                                          
178300     EVALUATE TRUE                                                        
178400         WHEN SQLCODE = ZERO                                              
178500             CONTINUE                                                     
178600         WHEN SQLCODE = -904                                              
178700         WHEN SQLCODE = -911                                              
178800         WHEN SQLCODE = -913                                              
178900             MOVE '7200-OPEN-GROUP-CSR'                                   
179000                                      TO DP013-PARAGRAPH                  
179100             MOVE 'DB2 TIMEOUT ATTEMPTING TO OPEN CSR'                    
179200                                      TO DP013-MESSAGE-TEXT (1)           
179300             MOVE SQLCA               TO DP013-SQLCA                      
179400             MOVE 'DLT_DOOR_GP_TMPL'  TO DP013-DB2-TABLE-NAME (1)         
179500             SET DP013-DB2-ABEND                                          
179600                 DP013-XCTL-DISPLAY-RESTART                               
179700                                      TO TRUE                             
179800             PERFORM DP013-0000-PROCESS-ABEND                             
179900         WHEN SQLWARN0 NOT = SPACES                                       
180000         WHEN SQLCODE < ZERO                                              
180100         WHEN SQLCODE > ZERO                                              
180200             MOVE '7200-OPEN-GROUP-CSR'                                   
180300                                      TO DP013-PARAGRAPH                  
180400             MOVE 'OPEN GROUP CURSOR - '                                  
180500                                      TO DP013-MESSAGE-TEXT (1)           
180600             MOVE SQLCA               TO DP013-SQLCA                      
180700             MOVE 'DLT_DOOR_GP_TMPL'  TO DP013-DB2-TABLE-NAME (1)         
180800             SET DP013-DB2-ABEND                                          
180900                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
181000             PERFORM DP013-0000-PROCESS-ABEND                             
181100     END-EVALUATE.                                                        
181200*                                                                         
181300 7210-FETCH-GROUP-CSR.                                                    
181400                                                                          
181500     EXEC SQL                                                             
181600         FETCH GROUP-CSR                                                  
181700         INTO                                                             
181800             :DLT00001-DOOR-ID                                            
181900         ,   :DLT00001-DOOR-GP-NBR                                        
182000     END-EXEC                                                             
182100                                                                          
182200     EVALUATE TRUE                                                        
182300         WHEN SQLCODE = ZERO                                              
182400             CONTINUE                                                     
182500         WHEN SQLCODE = +100                                              
182600              SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                         
182700                                                                          
182800         WHEN SQLCODE = -904                                              
182900         WHEN SQLCODE = -911                                              
183000         WHEN SQLCODE = -913                                              
183100             MOVE '7210-FETCH-GROUP-CSR'                                  
183200                                      TO DP013-PARAGRAPH                  
183300             MOVE 'DB2 TIMEOUT ATTEMPTING TO FETCH CSR'                   
183400                                      TO DP013-MESSAGE-TEXT (1)           
183500             MOVE SQLCA               TO DP013-SQLCA                      
183600             MOVE 'DLT_DOOR_GP_TMPL'  TO DP013-DB2-TABLE-NAME (1)         
183700             SET DP013-DB2-ABEND                                          
183800                 DP013-XCTL-DISPLAY-RESTART                               
183900                                      TO TRUE                             
184000             PERFORM DP013-0000-PROCESS-ABEND                             
184100         WHEN SQLWARN0 NOT = SPACE                                        
184200         WHEN SQLCODE NOT = ZERO                                          
184300              MOVE '7210-FETCH-GROUP-CSR'                                 
184400                               TO DP013-PARAGRAPH                         
184500              MOVE 'FETCH TEMPLATE CURSOR'                                
184600                               TO DP013-MESSAGE-TEXT (1)                  
184700              MOVE SQLCA       TO DP013-SQLCA                             
184800              SET DP013-DB2-ABEND                                         
184900                               TO TRUE                                    
185000              PERFORM DP013-0000-PROCESS-ABEND                            
185100     END-EVALUATE.                                                        
185200                                                                          
185300 7220-CLOSE-GROUP-CSR.                                                    
185400                                                                          
185500     EXEC SQL                                                             
185600         CLOSE GROUP-CSR                                                  
185700     END-EXEC                                                             
185800                                                                          
185900     EVALUATE TRUE                                                        
186000         WHEN SQLCODE = ZERO                                              
186100             CONTINUE                                                     
186200         WHEN SQLWARN0 NOT = SPACES                                       
186300         WHEN SQLCODE < ZERO                                              
186400         WHEN SQLCODE > ZERO                                              
186500             MOVE 'DLT_DOOR_GP_TMPL'  TO DP013-DB2-TABLE-NAME (1)         
186600             MOVE '7220-CLOSE-GROUP-CSR'                                  
186700                                      TO DP013-PARAGRAPH                  
186800             MOVE 'CLOSE TEMPLATE CURSOR '                                
186900                                      TO DP013-MESSAGE-TEXT (1)           
187000             MOVE SQLCA               TO DP013-SQLCA                      
187100             SET DP013-DB2-ABEND                                          
187200                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
187300             PERFORM DP013-0000-PROCESS-ABEND                             
187400     END-EVALUATE.                                                        
187500/                                                                         
187600 9100-READ-SEL-QUEUE.                                                     
187700     EXEC CICS                                                            
187800         READQ TS                                                         
187900             QUEUE (ASC-SEL-QUEUE-NAME)                                   
188000             INTO  (DL006-SELECT-RECORD)                                  
188100             ITEM  (ASC-SEL-ITEM)                                         
188200             RESP  (PV-CICS-RESP)                                         
188300     END-EXEC.                                                            
188400                                                                          
188500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                               
188600         CONTINUE                                                         
188700     ELSE                                                                 
188800         SET DP013-LOGIC-ABEND                                            
188900             DP013-NO-ROLLBACK     TO TRUE                                
189000         MOVE '9100-READ-SEL-QUEUE'                                       
189100                                   TO DP013-PARAGRAPH                     
189200         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'           
189300                                   TO DP013-MESSAGE-TEXT (1)              
189400         PERFORM DP013-0000-PROCESS-ABEND                                 
189500     END-IF.                                                              
189600*----------------------------------------------------------------*        
189700* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *        
189800*----------------------------------------------------------------*        
189900 9200-REWRITE-SEL-QUEUE.                                                  
190000     EXEC CICS                                                            
190100          WRITEQ TS                                                       
190200              QUEUE  (ASC-SEL-QUEUE-NAME)                                 
190300              FROM   (DL006-SELECT-RECORD)                                
190400              ITEM   (ASC-SEL-ITEM)                                       
190500              RESP   (PV-CICS-RESP)                                       
190600              REWRITE                                                     
190700     END-EXEC.                                                            
190800                                                                          
190900     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                           
191000         SET DP013-CICS-ABEND                                             
191100             DP013-NO-ROLLBACK     TO TRUE                                
191200         MOVE '9200-REWRITE-SEL-QUEUE'                                    
191300                                   TO DP013-PARAGRAPH                     
191400         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'           
191500                                   TO DP013-MESSAGE-TEXT (1)              
191600         PERFORM DP013-0000-PROCESS-ABEND                                 
191700     END-IF.                                                              
191800/                                                                         
191900 9900-SOFT-ABORT.                                                         
192000                                                                          
192100     EXEC CICS SYNCPOINT                                                  
192200          ROLLBACK                                                        
192300     END-EXEC.                                                            
192400                                                                          
192500     SET  PS-ERROR                                                        
192600          PS-SOFT-ABORT-ERROR                                             
192700          DP020-MSG-FATAL       TO  TRUE.                                 
192800/                                                                         
192900*----------------------------------------------------------------*        
193000*    ABEND PROCESSOR MODULE                                      *        
193100*----------------------------------------------------------------*        
193200                                                                          
193300     COPY DPPD013.                                                        
