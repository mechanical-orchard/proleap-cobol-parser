000100*-----------------------*                                         00010056
000200 IDENTIFICATION DIVISION.                                         00020056
000300*-----------------------*                                         00030056
000400 PROGRAM-ID.    ETKCS355.                                         00040056
000500 AUTHOR.        SUE PARI.                                         00050056
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060056
000700 DATE-WRITTEN.  03-31-00.                                         00070056
000800 DATE-COMPILED.                                                   00080056
000900                                                                  00090056
001000*---------------------------------------------------------------* 00100056
001100*    FG / TSET STATUS HISTORY                                   * 00110056
001200*                                                               * 00120056
001300*    THIS PROGRAM DISPLAYS THE HISTORY OF AN EDI DOCUMENT.      * 00130056
001400*                                                               * 00140056
001500*---------------------------------------------------------------* 00150056
001510* 10/11/2021 GERMAN BANDA                    WR/IR #: CHG0262418* 00151058
001520*            - CHANGE CALL OF DPKUT100 TO                       * 00152058
001530*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00153058
001540*              MAKING THE CALL DYNAMIC VS STATIC                * 00154058
001550*                                                               * 00155058
001560*---------------------------------------------------------------* 00156058
001510*  CHANGED 10/28/2022    BY BARB SCHULTZ    WR: CHG0277210      * 00157059
001520*                                                               * 00158059
001530*  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00159059
001540*  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00159159
001560*---------------------------------------------------------------* 00159359
001600                                                                  00160056
001700 ENVIRONMENT DIVISION.                                            00170056
001800                                                                  00180056
001900 DATA DIVISION.                                                   00190056
002000                                                                  00200056
002100 WORKING-STORAGE SECTION.                                         00210056
002200                                                                  00220056
002300 01  PC-PROGRAM-CONSTANTS.                                        00230056
002400     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00240056
002500                                                    'ET355A  '.   00250056
002600     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00260056
002700                                                    'ETKM355 '.   00270056
002800     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00280056
002900                                                    'ETKCS355'.   00290056
003000     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00300056
003100     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00310056
003200     05  PC-DTL-QUEUE-SEQ               PIC  9(01)  VALUE 3.      00320056
003300     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00330056
003400     05  PC-LIST-FORMAT                 PIC  X(01)  VALUE '2'.    00340056
003500     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +9      00350056
003600                                                    COMP SYNC.    00360056
003700     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00370056
003800                                                    COMP SYNC.    00380056
003900     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00390056
004000                                                    +1000000      00400056
004100                                                    COMP-3.       00410056
004200     05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3      00420056
004300                                                     COMP-3.      00430056
004400                                                                  00440056
004500 01  PC-TSYMSG-NUMBERS.                                           00450056
004600     05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.  00460056
004700     05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.  00470056
004800     05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.  00480056
004900     05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.  00490056
005000     05  PC-TSYMSG-00101                PIC 9(5)    VALUE 00101.  00500056
005100     05  PC-TSYMSG-00148                PIC 9(5)    VALUE 00148.  00510056
005200     05  PC-TSYMSG-00279                PIC 9(5)    VALUE 00279.  00520056
005300     05  PC-TSYMSG-00302                PIC 9(5)    VALUE 00302.  00530056
005400                                                                  00540056
005500 01  PS-PROGRAM-DATES.                                            00550056
005600     05  PS-TIMESTAMP                   PIC X(26).                00560056
005700     05  FILLER REDEFINES PS-TIMESTAMP.                           00570056
005800         10  PS-TIMESTAMP-YEAR          PIC X(04).                00580056
005900         10  FILLER                     PIC X(01).                00590056
006000         10  PS-TIMESTAMP-MONTH         PIC X(02).                00600056
006100         10  FILLER                     PIC X(01).                00610056
006200         10  PS-TIMESTAMP-DAY           PIC X(02).                00620056
006300         10  FILLER                     PIC X(01).                00630056
006400         10  PS-TIMESTAMP-HOUR          PIC X(02).                00640056
006500         10  FILLER                     PIC X(01).                00650056
006600         10  PS-TIMESTAMP-MINUTE        PIC X(02).                00660056
006700         10  FILLER                     PIC X(10).                00670056
006800                                                                  00680056
006900     05  PS-DATE                        PIC X(10).                00690056
007000     05  FILLER REDEFINES PS-DATE.                                00700056
007100         10  PS-DATE-MONTH              PIC X(02).                00710056
007200         10  PS-DATE-SLASH1             PIC X(01).                00720056
007300         10  PS-DATE-DAY                PIC X(02).                00730056
007400         10  PS-DATE-SLASH2             PIC X(01).                00740056
007500         10  PS-DATE-YEAR               PIC X(04).                00750056
007600                                                                  00760056
007700     05  PS-TIME                        PIC X(05).                00770056
007800     05  FILLER REDEFINES PS-TIME.                                00780056
007900         10  PS-TIME-HOUR               PIC X(02).                00790056
008000         10  PS-TIME-COLON              PIC X(01).                00800056
008100         10  PS-TIME-MINUTE             PIC X(02).                00810056
008200                                                                  00820056
008300 01  PS-PROGRAM-SUBSCRIPTS.                                       00830056
008400     05  PS-SUB                         PIC S9(04)   VALUE +0     00840056
008500                                                     COMP SYNC.   00850056
008600                                                                  00860056
008700 01  PS-PROGRAM-SWITCHES.                                         00870056
008800     05  PS-ERROR-SW                    PIC X(01)    VALUE 'Y'.   00880056
008900         88  PS-NO-ERROR                             VALUE 'Y'.   00890056
009000         88  PS-ERROR                                VALUE 'N'.   00900056
009100     05  PS-COMMAREA-SW                 PIC X(01)    VALUE 'N'.   00910056
009200         88  PS-COMMAREA-VALID                       VALUE 'Y'.   00920056
009300         88  PS-COMMAREA-NOT-VALID                   VALUE 'N'.   00930056
009400     05  PS-LIST-END-SW                 PIC X(01)    VALUE 'N'.   00940056
009500         88  PS-LIST-END                             VALUE 'Y'.   00950056
009600         88  PS-NO-LIST-END                          VALUE 'N'.   00960056
009700                                                                  00970056
009800 01  PS-PROGRAM-SESSION-ID.                                       00980056
009900     05  PS-SESSION-ID-NUM              PIC 9(06).                00990056
010000     05  FILLER REDEFINES PS-SESSION-ID-NUM.                      01000056
010100         10  PS-SESSION-ID-CHAR         PIC X(06).                01010056
010200                                                                  01020056
010300     EJECT                                                        01030056
010400 01  PV-PROGRAM-VARIABLES.                                        01040056
010500     05  PV-REMAINDER                   PIC S9(04)   VALUE +0     01050056
010600                                                     COMP SYNC.   01060056
010700     05  PV-READ-COUNT                  PIC S9(09)   VALUE +0     01070056
010800                                                     COMP-3.      01080056
010900     05  PV-TOP-ITEM                    PIC S9(09)   VALUE +0     01090056
011000                                                     COMP-3.      01100056
011100     05  PV-BOTTOM-ITEM                 PIC S9(09)   VALUE +0     01110056
011200                                                     COMP-3.      01120056
011300     05  PV-BLOCK-NUMBER                PIC S9(04)   VALUE +0     01130056
011400                                                     COMP SYNC.   01140056
011500     05  PV-CICS-RESP                   PIC S9(04)   VALUE +0     01150056
011600                                                     COMP SYNC.   01160056
011700     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)   VALUE +0     01170056
011800                                                     COMP SYNC.   01180056
011900     05  PV-LIST-ITEM-NUMBER            PIC S9(04)   VALUE +0     01190056
012000                                                     COMP SYNC.   01200056
012100     05  PV-SQL-SUB                     PIC S9(4)    COMP.        01210056
012200                                                                  01220056
012300 01  PV-DB2-CRITERIA-AREA.                                        01230056
012400     15  PV-DB2-MESSAGE-NUMBER          PIC S9(05)  VALUE ZERO    01240056
012500                                                    COMP-3.       01250056
012600                                                                  01260056
012700 EJECT                                                            01270056
012800*---------------------------------------------------------------* 01280056
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 01290059
013000*---------------------------------------------------------------* 01300056
013100                                                                  01310056
013200     COPY DPWS030.                                                01320056
CICS       COPY DPWS930.                                                01321059
013300 EJECT                                                            01330056
013400*---------------------------------------------------------------* 01340056
013500*    STANDARD COMMAREA.                                         * 01350056
013600*---------------------------------------------------------------* 01360056
013700                                                                  01370056
013800     COPY DPWS020.                                                01380056
013900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01390056
014000                                                                  01400056
014100*---------------------------------------------------------------* 01410056
014200*    INTER-APPLICATION COMMAREA.                                * 01420056
014300*---------------------------------------------------------------* 01430056
014400                                                                  01440056
014500         10  INTER-APPL-COMM-AREA       PIC X(200).               01450056
014600     COPY ETWS307.                                                01460056
014700*---------------------------------------------------------------* 01470056
014800*    SPECIFIC COMMMAREA FOR ETKCS355.                           * 01480056
014900*---------------------------------------------------------------* 01490056
015000         10  ASC-SPECIFIC-COMMAREA.                               01500056
015100             15  ASC-LIST-KEYS.                                   01510056
015200                 20  ASC-VENDOR-NAME                 PIC  X(30).  01520056
015300                 20  ASC-FG-CONTROL-NUMBER           PIC  X(09).  01530056
015400                 20  ASC-TS-CONTROL-NUMBER           PIC  X(09).  01540056
015500                 20  ASC-TRAN-SET                    PIC X(03).   01550056
015600                 20  ASC-DETAIL                      PIC X(15).   01560056
015700                 20  ASC-TP-DKEY                     PIC S9(09)   01570056
015800                                                     COMP.        01580056
015900                 20  ASC-TP-DKEY-TMST                PIC  X(26).  01590056
016000                 20  ASC-FUNC-CDE-SEQ-NBR            PIC S9(09)   01600056
016100                                                     COMP.        01610056
016200                 20  ASC-TRN-SET-SEQ-NBR             PIC S9(09)   01620056
016300                                                     COMP.        01630056
016400                 20  ASC-TRANSL-ERR-IND              PIC X(01).   01640056
016500                 20  ASC-TRN-RLSE-TMST               PIC X(26).   01650056
016600             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                01660056
016700                 20  ASC-ITEM-ARRAY.                              01670056
016800                                                                  01680056
016900                     25  ASC-ITEM-ENTRIES OCCURS 13 TIMES.        01690056
017000                         30  ASC-LIST-ITEM-NUMBER    PIC S9(09)   01700056
017100                                                     COMP-3.      01710056
017200                         30  ASC-STATUS              PIC X(12).   01720056
017300                         30  ASC-DATE                PIC X(10).   01730056
017400                         30  ASC-TIME                PIC X(05).   01740056
017500                         30  ASC-SESSION             PIC X(06).   01750056
017600                                                                  01760056
017700             15  ASC-BLK-SUB                         PIC S9(04)   01770056
017800                                                         COMP     01780056
017900                                                         SYNC.    01790056
018000             15  ASC-ITEM-SUB                        PIC S9(04)   01800056
018100                                                         COMP     01810056
018200                                                         SYNC.    01820056
018300             15  ASC-SEL-SUB                         PIC S9(04)   01830056
018400                                                         COMP.    01840056
018500             15  ASC-SEL-ITEM                        PIC S9(04)   01850056
018600                                                         COMP.    01860056
018700             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   01870056
018800                                                         COMP-3.  01880056
018900             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   01890056
019000                                                         COMP-3.  01900056
019100             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   01910056
019200                                                         COMP-3.  01920056
019300             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   01930056
019400                                                         COMP-3.  01940056
019500             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   01950056
019600                                                         COMP-3.  01960056
019700             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   01970056
019800                                                         COMP-3.  01980056
019900             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   01990056
020000                                                         COMP     02000056
020100                                                         SYNC.    02010056
020200             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   02020056
020300                                                         COMP-3.  02030056
020400             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   02040056
020500                                                         COMP-3.  02050056
020600             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  02060056
020700                 88  ASC-ITEMS-LEFT-ON-DB              VALUE 'Y'. 02070056
020800                 88  ASC-NO-ITEMS-LEFT-ON-DB           VALUE 'N'. 02080056
020900             15  ASC-USE-SELECTION-QUEUE-IND         PIC  X(01).  02090056
021000                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 02100056
021100             15  ASC-DESC-LINE-IND                   PIC  X(01).  02110056
021200                 88  ASC-DESC-LINE-DONE                VALUE 'Y'. 02120056
021300             15  ASC-CORR-LINE-IND                   PIC  X(01).  02130056
021400                 88  ASC-CORR-LINE-DONE                VALUE 'Y'. 02140056
021500             15  ASC-LIST-QUEUE-NAME.                             02150056
021600                 20  ASC-LIST-TERM-ID                PIC  X(04).  02160056
021700                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   02170056
021800                                                         COMP-3.  02180056
021900                 20  ASC-LIST-SEQ                    PIC  9(01).  02190056
022000             15  ASC-SEL-QUEUE-NAME.                              02200056
022100                 20  ASC-SEL-TERM-ID                 PIC  X(04).  02210056
022200                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   02220056
022300                                                          COMP-3. 02230056
022400                 20  ASC-SEL-SEQ                     PIC  9(01).  02240056
022500             15  ASC-DTL-QUEUE-NAME.                              02250056
022600                 20  ASC-DTL-TERM-ID                 PIC  X(04).  02260056
022700                 20  ASC-DTL-TASK-NUMBER             PIC S9(05)   02270056
022800                                                         COMP-3.  02280056
022900                 20  ASC-DTL-SEQ                     PIC  9(01).  02290056
023000                                                                  02300056
023100             15  ASC-START-ITEM-REQUEST.                          02310056
023200                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  02320056
023300                                                                  02330056
023400     COPY ETWS309.                                                02340056
023500                                                                  02350056
023600     EJECT                                                        02360056
023700*---------------------------------------------------------------* 02370056
023800*    ABEND PROCESSING COPYBOOK.                                 * 02380056
023900*---------------------------------------------------------------* 02390056
024000                                                                  02400056
024100     COPY DPWS013.                                                02410056
024200                                                                  02420056
024300     EJECT                                                        02430056
024400*---------------------------------------------------------------* 02440056
024500*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02450056
024600*---------------------------------------------------------------* 02460056
024700                                                                  02470056
024800     COPY DPWS015.                                                02480056
024900                                                                  02490056
025000*---------------------------------------------------------------* 02500056
025100*    FUNCTION KEYS COPYBOOK.                                    * 02510056
025200*---------------------------------------------------------------* 02520056
025300                                                                  02530056
025400     COPY DPWS016.                                                02540056
025500                                                                  02550056
025600*---------------------------------------------------------------* 02560056
025700*    NUMERIC EDIT LAYOUT.                                       * 02570056
025800*---------------------------------------------------------------* 02580056
025900                                                                  02590056
026000     COPY DPWS010I.                                               02600056
026100 EJECT                                                            02610056
026200                                                                  02620056
026300*---------------------------------------------------------------* 02630056
026400*    MAP LAYOUT                                                 * 02640056
026500*---------------------------------------------------------------* 02650056
026600                                                                  02660056
026700     COPY ETKM355.                                                02670056
026800                                                                  02680056
026900 01  MR-OCCURS-LAYOUT          REDEFINES  ET355AO.                02690056
027000     05  FILLER                PIC X(132).                        02700056
027100     05  MR-SCROLL-AREA OCCURS 8 TIMES.                           02710056
027200                                                                  02720056
027300         10  MR-STATUSL        PIC S9(04) COMP.                   02730056
027400         10  MR-STATUSA        PIC  X(01).                        02740056
027500         10  MR-STATUSC        PIC  X(01).                        02750056
027600         10  MR-STATUSH        PIC  X(01).                        02760056
027700         10  MR-STATUS         PIC  X(12).                        02770056
027800                                                                  02780056
027900         10  MR-DATEL          PIC S9(04) COMP.                   02790056
028000         10  MR-DATEA          PIC  X(01).                        02800056
028100         10  MR-DATEC          PIC  X(01).                        02810056
028200         10  MR-DATEH          PIC  X(01).                        02820056
028300         10  MR-DATE           PIC  X(10).                        02830056
028400                                                                  02840056
028500         10  MR-TIMEL          PIC S9(04) COMP.                   02850056
028600         10  MR-TIMEA          PIC  X(01).                        02860056
028700         10  MR-TIMEC          PIC  X(01).                        02870056
028800         10  MR-TIMEH          PIC  X(01).                        02880056
028900         10  MR-TIME           PIC  X(05).                        02890056
029000                                                                  02900056
029100         10  MR-SESSIONL       PIC S9(04) COMP.                   02910056
029200         10  MR-SESSIONA       PIC  X(01).                        02920056
029300         10  MR-SESSIONC       PIC  X(01).                        02930056
029400         10  MR-SESSIONH       PIC  X(01).                        02940056
029500         10  MR-SESSION        PIC  X(06).                        02950056
029600                                                                  02960056
029700 EJECT                                                            02970056
029800*---------------------------------------------------------------* 02980056
029900*    DB2 AREA FOR TINTTRN                                       * 02990056
030000*---------------------------------------------------------------* 03000056
030100     EXEC SQL                                                     03010056
030200          INCLUDE TINTTRN                                         03020056
030300     END-EXEC.                                                    03030056
030400                                                                  03040056
030500*---------------------------------------------------------------* 03050056
030600*    DB2 AREA FOR TTNSTLC                                       * 03060056
030700*---------------------------------------------------------------* 03070056
030800     EXEC SQL                                                     03080056
030900          INCLUDE TTNSTLC                                         03090056
031000     END-EXEC.                                                    03100056
031100                                                                  03110056
031200*---------------------------------------------------------------* 03120056
031300*    DB2 AREA FOR TTNSTCD                                       * 03130056
031400*---------------------------------------------------------------* 03140056
031500     EXEC SQL                                                     03150056
031600          INCLUDE TTNSTCD                                         03160056
031700     END-EXEC.                                                    03170056
031800                                                                  03180056
031900*---------------------------------------------------------------* 03190056
032000*    DB2 AREA FOR COMMUNICATIONS                                * 03200056
032100*---------------------------------------------------------------* 03210056
032200     EXEC SQL                                                     03220056
032300          INCLUDE SQLCA                                           03230056
032400     END-EXEC.                                                    03240056
032500                                                                  03250056
032600*---------------------------------------------------------------* 03260056
032700*    CURSOR TO GET ERROR STATUS CODES AND DESCRIPTIONS          * 03270056
032800*---------------------------------------------------------------* 03280056
032900                                                                  03290056
033000     EXEC SQL                                                     03300056
033100          DECLARE ERR_CURSOR CURSOR FOR                           03310056
033200          SELECT  A.TRN_AUD_TMST,                                 03320056
033300                  B.TRN_STAT_DESC                                 03330056
033400          FROM    TTNSTLC A,                                      03340056
033500                  TTNSTCD B                                       03350056
033600          WHERE   A.TP_DKEY = :ASC-TP-DKEY                        03360056
033700            AND   A.TP_DKEY_TMST =: ASC-TP-DKEY-TMST              03370056
033800            AND   A.FUNC_CDE_SEQ_NBR =:ASC-FUNC-CDE-SEQ-NBR       03380056
033900            AND   A.TRN_SET_SEQ_NBR =:ASC-TRN-SET-SEQ-NBR         03390056
034000            AND   B.TRN_STAT_CDE = A.TRN_STAT_CDE                 03400056
034100         ORDER BY A.TRN_AUD_TMST                                  03410056
034200     END-EXEC.                                                    03420056
034300                                                                  03430056
034400 EJECT                                                            03440056
034500 LINKAGE SECTION.                                                 03450056
034600                                                                  03460056
034700 01  DFHCOMMAREA.                                                 03470056
034800     05  FILLER                         OCCURS  1 TO 4072 TIMES   03480056
034900                                        DEPENDING ON EIBCALEN.    03490056
035000         10  FILLER                     PIC X.                    03500056
035100                                                                  03510056
035200 EJECT                                                            03520056
035300 PROCEDURE DIVISION.                                              03530056
035400                                                                  03540056
035500 0000-MAIN-MODULE.                                                03550056
035600                                                                  03560056
035700     INITIALIZE DP030-CICS-API-FIELDS.                            03570056
035800     MOVE +1                      TO DP030-NUMBER-OF-MAPS.        03580056
035900     MOVE PC-CURRENT-MAPSET-NAME  TO DP030-MAPSET-NAME.           03590056
036000     MOVE PC-CURRENT-MAP-NAME     TO DP030-MAP-NAME (1).          03600056
036100     SET DP030-RECEIVE-APPL-MAP   TO TRUE.                        03610056
036200     MOVE LENGTH OF ET355AI       TO DP030-MAP-LENGTH (1).        03620056
036300     MOVE 'PROGRAM ENTRY CALL'    TO DP013-MESSAGE-TEXT (1).      03630056
036400     PERFORM 0001-CALL-CICS-ARCH-API.                             03640056
036500                                                                  03650056
036600     PERFORM 1000-CONTROL-PROCESSING.                             03660056
036700                                                                  03670056
036800     MOVE 'PROGRAM EXIT CALL'     TO DP013-MESSAGE-TEXT (1).      03680056
036900     PERFORM 0001-CALL-CICS-ARCH-API.                             03690056
037000                                                                  03700056
037100*----------------------------------------------------------------*03710056
037200*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *03720056
037300*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *03730056
037400*----------------------------------------------------------------*03740056
037500                                                                  03750056
037600 0001-CALL-CICS-ARCH-API.                                         03760056
037700                                                                  03770056
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03780059
037900                                    DFHCOMMAREA                   03790059
038000                                    DP030-CICS-API-FIELDS         03800059
038100                                    DP020-STANDARD-COMMAREA       03810059
038200                                    ET355AI.                      03820059
038300                                                                  03830056
038400     IF  DP030-RC-CALL-SUCCESSFUL                                 03840056
038500         CONTINUE                                                 03850056
038600     ELSE                                                         03860056
038700         SET DP013-NO-ROLLBACK TO TRUE                            03870056
038800         SET DP013-XCTL-DISPLAY-RESTART TO TRUE                   03880056
038900         SET DP013-CICS-ABEND TO TRUE                             03890056
CICS           MOVE '0001-CALL-CICS-ARCH-API'                           03900059
CICS                                     TO DP013-PARAGRAPH             03901059
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03910059
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03920059
039300         MOVE DP030-RETURN-CODE                                   03930056
039400                               TO DP013-MESSAGE-TEXT (3)          03940056
039500         PERFORM DP013-0000-PROCESS-ABEND                         03950056
039600     END-IF.                                                      03960056
039700                                                                  03970056
039800*----------------------------------------------------------------*03980056
039900* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *03990056
040000* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04000056
040100*                                                                *04010056
040200* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04020056
040300*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04030056
040400*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04040056
040500*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04050056
040600*----------------------------------------------------------------*04060056
040700                                                                  04070056
040800 1000-CONTROL-PROCESSING.                                         04080056
040900                                                                  04090056
041000     EVALUATE TRUE                                                04100056
041100         WHEN DP020-NEXT-ACT-INITIAL                              04110056
041200             MOVE EIBTRMID          TO ASC-DTL-TERM-ID            04120056
041300             MOVE DP020-SRC-TASK-NUMBER                           04130056
041400                                    TO ASC-DTL-TASK-NUMBER        04140056
041500             MOVE PC-DTL-QUEUE-SEQ  TO ASC-DTL-SEQ                04150056
041600             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04160056
041700***-----$TEMPLATE NOTE$-------------------------------------------04170056
041800*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,04180056
041900*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  04190056
042000*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.04200056
042100***---------------------------------------------------------------04210056
042200             IF  PS-COMMAREA-NOT-VALID                            04220056
042300***              MOVE PC-TSYMSG-99901                             04230056
042400***                            TO  DP020-MSG-NUMBER               04240056
042500***              SET DP020-MSG-FATAL                              04250056
042600***                            TO  TRUE                           04260056
042700                 SET DP020-NEXT-ACT-APPL-ERROR                    04270056
042800                               TO  TRUE                           04280056
042900             ELSE                                                 04290056
043000                 PERFORM 2050-DELETE-DETAIL-QUEUE                 04300056
043100                 PERFORM 4000-BUILD-INITIAL-PANEL                 04310056
043200             END-IF                                               04320056
043300                                                                  04330056
043400         WHEN DP020-NEXT-ACT-READ-MAP                             04340056
043500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04350056
043600                               TO PV-TOP-ITEM                     04360056
043700             PERFORM 2000-PROCESS-PANEL                           04370056
043800                                                                  04380056
043900         WHEN DP020-NEXT-ACT-RETURN                               04390056
044000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04400056
044100                               TO PV-TOP-ITEM                     04410056
044200             MOVE ZERO         TO ASC-ITEM-AT-TOP-OF-PANEL        04420056
044300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04430056
044400                                                                  04440056
044500         WHEN OTHER                                               04450056
044600             SET DP013-LOGIC-ABEND TO TRUE                        04460056
044700             SET DP013-NO-ROLLBACK TO TRUE                        04470056
044800             MOVE '1000-CONTROL-PROCESSING'                       04480056
044900                               TO  DP013-PARAGRAPH                04490056
045000             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    04500056
045100                               TO  DP013-MESSAGE-TEXT(1)          04510056
045200             PERFORM DP013-0000-PROCESS-ABEND                     04520056
045300     END-EVALUATE.                                                04530056
045400                                                                  04540056
045500 EJECT                                                            04550056
045600*----------------------------------------------------------------*04560056
045700* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *04570056
045800* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *04580056
045900*----------------------------------------------------------------*04590056
046000                                                                  04600056
046100 1100-PROCESS-INTER-APPL-COMM.                                    04610056
046200                                                                  04620056
046300     SET PS-COMMAREA-VALID         TO TRUE.                       04630056
046400     INITIALIZE ASC-SPECIFIC-COMMAREA.                            04640056
046500     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     04650056
046600     SET ASC-USE-SELECTION-QUEUE   TO TRUE.                       04660056
046700     MOVE ET307-NUMBER-OF-TS-ITEMS TO ASC-NUMBER-OF-TS-ITEMS      04670056
046800     MOVE ET307-SEL-QUEUE-NAME     TO ASC-SEL-QUEUE-NAME          04680056
046900     PERFORM 1120-PREPARE-LIST-ENTRY.                             04690056
047000                                                                  04700056
047100*----------------------------------------------------------------*04710056
047200*    EDIT THE KEY ENTERED BY THE USER INTO THE KEY FIELD OF THE  *04720056
047300*    COMMAND LINE.  A VALID MESSAGE NUMBER IS THE ONLY KEY       *04730056
047400*    ACCEPTED.                                                   *04740056
047500*----------------------------------------------------------------*04750056
047600                                                                  04760056
047700 1110-EDIT-NAV-KEY.                                               04770056
047800                                                                  04780056
047900     MOVE DP020-NAV-KEY-DATA TO DP010I-UNEDITED-FIELD.            04790056
048000     MOVE ZERO                TO DP010I-MAXIMUM-DECIMALS.         04800056
048100     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     04810056
048210     CALL DP010I-NUMERIC-EDIT-ROUTINE                             04821057
048220                         USING DP010I-NUMERIC-EDIT-AREA           04822057
048300     IF  DP010I-ERROR-DETECTED                                    04830056
048400         SET PS-ERROR TO TRUE                                     04840056
048500         SET DP020-MSG-FATAL TO TRUE                              04850056
048600         MOVE PC-TSYMSG-00302 TO DP020-MSG-NUMBER                 04860056
048700         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    04870056
048800     END-IF.                                                      04880056
048900                                                                  04890056
049000*----------------------------------------------------------------*04900056
049100*    GET READY TO START AT THE FIRST ITEM ON THE LIST.           *04910056
049200*----------------------------------------------------------------*04920056
049300                                                                  04930056
049400 1120-PREPARE-LIST-ENTRY.                                         04940056
049500                                                                  04950056
049600     MOVE ET309-MAX-ITEMS TO ASC-SEL-SUB.                         04960056
049700     MOVE ZERO            TO ASC-SEL-ITEM.                        04970056
049800     PERFORM 2140-GET-NEXT-MESSAGE.                               04980056
049900 EJECT                                                            04990056
050000*----------------------------------------------------------------*05000056
050100*    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED *05010056
050200*    ON WHAT FUNCTION KEY WAS SELECTED.                          *05020056
050300*----------------------------------------------------------------*05030056
050400                                                                  05040056
050500 2000-PROCESS-PANEL.                                              05050056
050600                                                                  05060056
050700     EVALUATE TRUE                                                05070056
050800         WHEN DP020-SRC-AID = DP016-CLEAR                         05080056
050900             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                05090056
051000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05100056
051100             PERFORM 3200-RESET-ATTRIBUTES                        05110056
051200                                                                  05120056
051300         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05130056
051400             PERFORM 2050-DELETE-DETAIL-QUEUE                     05140056
051500             PERFORM 4000-BUILD-INITIAL-PANEL                     05150056
051600             PERFORM 3200-RESET-ATTRIBUTES                        05160056
051700                                                                  05170056
051800         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             05180056
051900             IF  ASC-USE-SELECTION-QUEUE                          05190056
052000                 PERFORM 2140-GET-NEXT-MESSAGE                    05200056
052100                 IF PS-LIST-END                                   05210056
052200                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         05220056
052300                     SET PS-NO-LIST-END TO TRUE                   05230056
052400                 ELSE                                             05240056
052500                     PERFORM 2050-DELETE-DETAIL-QUEUE             05250056
052600                     PERFORM 4000-BUILD-INITIAL-PANEL             05260056
052700                 END-IF                                           05270056
052800                 PERFORM 3200-RESET-ATTRIBUTES                    05280056
052900             ELSE                                                 05290056
053000                 MOVE PC-TSYMSG-00070                             05300056
053100                                  TO DP020-MSG-NUMBER             05310056
053200                 SET DP020-MSG-INFORMATIONAL TO TRUE              05320056
053300             END-IF                                               05330056
053400                                                                  05340056
053500         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             05350056
053600             IF  ASC-USE-SELECTION-QUEUE                          05360056
053700                 PERFORM 2150-GET-PREV-MESSAGE                    05370056
053800                 IF PS-LIST-END                                   05380056
053900                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         05390056
054000                     SET PS-NO-LIST-END TO TRUE                   05400056
054100                 ELSE                                             05410056
054200                     PERFORM 2050-DELETE-DETAIL-QUEUE             05420056
054300                     PERFORM 4000-BUILD-INITIAL-PANEL             05430056
054400                 END-IF                                           05440056
054500                 PERFORM 3200-RESET-ATTRIBUTES                    05450056
054600             ELSE                                                 05460056
054700                 MOVE PC-TSYMSG-00069                             05470056
054800                                  TO DP020-MSG-NUMBER             05480056
054900                 SET DP020-MSG-INFORMATIONAL TO TRUE              05490056
055000             END-IF                                               05500056
055100                                                                  05510056
055200         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  05520056
055300             MOVE +1 TO PV-TOP-ITEM                               05530056
055400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05540056
055500             PERFORM 3200-RESET-ATTRIBUTES                        05550056
055600                                                                  05560056
055700         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   05570056
055800             PERFORM 2110-BROWSE-BACKWARD                         05580056
055900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05590056
056000             PERFORM 3200-RESET-ATTRIBUTES                        05600056
056100                                                                  05610056
056200         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   05620056
056300             PERFORM 2120-BROWSE-FORWARD                          05630056
056400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05640056
056500             PERFORM 3200-RESET-ATTRIBUTES                        05650056
056600                                                                  05660056
056700         WHEN DP020-SRC-AID = DP016-ENTER                         05670056
056800             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   05680056
056900             IF  PS-ERROR                                         05690056
057000                 CONTINUE                                         05700056
057100             ELSE                                                 05710056
057200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05720056
057300                 PERFORM 3200-RESET-ATTRIBUTES                    05730056
057400             END-IF                                               05740056
057500                                                                  05750056
057600         WHEN OTHER                                               05760056
057700             SET DP013-NO-ROLLBACK TO TRUE                        05770056
057800             SET DP013-XCTL-DISPLAY-RESTART TO TRUE               05780056
057900             SET DP013-CICS-ABEND TO TRUE                         05790056
058000             MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH    05800056
058100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05810056
058200                                   TO DP013-MESSAGE-TEXT (1)      05820056
058300             PERFORM DP013-0000-PROCESS-ABEND                     05830056
058400                                                                  05840056
058500     END-EVALUATE.                                                05850056
058600 EJECT                                                            05860056
058700*----------------------------------------------------------------*05870056
058800*    DELETE THE TEMPORARY STORAGE QUEUE.                         *05880056
058900*----------------------------------------------------------------*05890056
059000                                                                  05900056
059100 2050-DELETE-DETAIL-QUEUE.                                        05910056
059200                                                                  05920056
059300     EXEC CICS                                                    05930056
059400         DELETEQ TS                                               05940056
059500             QUEUE (ASC-DTL-QUEUE-NAME)                           05950056
059600             RESP  (PV-CICS-RESP)                                 05960056
059700     END-EXEC.                                                    05970056
059800                                                                  05980056
059900     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       05990056
060000        (PV-CICS-RESP = DFHRESP(QIDERR))                          06000056
060100         CONTINUE                                                 06010056
060200     ELSE                                                         06020056
060300         SET DP013-CICS-ABEND TO TRUE                             06030056
060400         SET DP013-NO-ROLLBACK TO TRUE                            06040056
060500                                                                  06050056
060600         MOVE '2050-DELETE-DETAIL-QUEUE' TO DP013-PARAGRAPH       06060056
060700         MOVE 'ERROR TRYING TO DELETE DETAIL TEMP STORAGE QUEUE'  06070056
060800                        TO DP013-MESSAGE-TEXT (1)                 06080056
060900         PERFORM DP013-0000-PROCESS-ABEND                         06090056
061000     END-IF.                                                      06100056
061100                                                                  06110056
061200     MOVE +0 TO ASC-HIGHEST-BLOCK-WRITTEN.                        06120056
061300 EJECT                                                            06130056
061400*----------------------------------------------------------------*06140056
061500*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *06150056
061600*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *06160056
061700*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *06170056
061800*    MESSAGE.                                                    *06180056
061900*----------------------------------------------------------------*06190056
062000                                                                  06200056
062100 2110-BROWSE-BACKWARD.                                            06210056
062200                                                                  06220056
062300     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    06230056
062400         GIVING PV-TOP-ITEM.                                      06240056
062500                                                                  06250056
062600     IF  PV-TOP-ITEM < +1                                         06260056
062700         MOVE +1              TO PV-TOP-ITEM                      06270056
062800*        -- TOP OF LIST --                                        06280056
062900         MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER                 06290056
063000         SET DP020-MSG-INFORMATIONAL TO TRUE                      06300056
063100     END-IF.                                                      06310056
063200                                                                  06320056
063300 EJECT                                                            06330056
063400                                                                  06340056
063500*----------------------------------------------------------------*06350056
063600*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *06360056
063700*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *06370056
063800*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *06380056
063900*----------------------------------------------------------------*06390056
064000                                                                  06400056
064100 2120-BROWSE-FORWARD.                                             06410056
064200                                                                  06420056
064300     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              06430056
064400         GIVING PV-TOP-ITEM.                                      06440056
064500     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   06450056
064600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06460056
064700                                   TO PV-TOP-ITEM                 06470056
064800*        -- BOTTOM OF LIST --                                     06480056
064900         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06490056
065000         SET DP020-MSG-INFORMATIONAL                              06500056
065100                                   TO TRUE                        06510056
065200     ELSE                                                         06520056
065300         COMPUTE PV-BOTTOM-ITEM =                                 06530056
065400             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 06540056
065500         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            06550056
065600*            -- BOTTOM OF LIST --                                 06560056
065700             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06570056
065800             SET DP020-MSG-INFORMATIONAL                          06580056
065900                                   TO TRUE                        06590056
066000         END-IF                                                   06600056
066100     END-IF.                                                      06610056
066200 EJECT                                                            06620056
066300*----------------------------------------------------------------*06630056
066400*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *06640056
066500*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *06650056
066600*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *06660056
066700*    RATHER THAN HITTING PF8 TO PAGE FORWARD TO THAT POINT.      *06670056
066800*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *06680056
066900*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *06690056
067000*----------------------------------------------------------------*06700056
067100                                                                  06710056
067200 2130-CHECK-FOR-JUMP-BROWSE.                                      06720056
067300                                                                  06730056
067400     IF ASTRTITL > ZERO                                           06740056
067500         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      06750056
067600     ELSE                                                         06760056
067700         IF ASTRTITF = DP015-ERASE-EOF                            06770056
067800             INITIALIZE ASC-START-ITEM-REQUEST                    06780056
067900         END-IF                                                   06790056
068000     END-IF.                                                      06800056
068100                                                                  06810056
068200     SET PS-NO-ERROR               TO TRUE.                       06820056
068300     IF (ASC-START-ITEM-REQUEST = SPACE)                          06830056
068400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06840056
068500                                   TO PV-TOP-ITEM                 06850056
068600     ELSE                                                         06860056
068700         MOVE ASC-START-ITEM-REQUEST                              06870056
068800                                   TO DP010I-UNEDITED-FIELD       06880056
068900         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     06890056
069000         SET DP010I-NEGATIVE-NOT-ALLOWED                          06900056
069100                                   TO TRUE                        06910056
069210         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06921057
069220                         USING DP010I-NUMERIC-EDIT-AREA           06922057
069300                                                                  06930056
069400         IF  NOT DP010I-ERROR-DETECTED                            06940056
069500             MOVE DP010I-NUMERIC-FIELD                            06950056
069600                                   TO  ASC-START-ITEM-REQUEST-N   06960056
069700             IF  ASC-START-ITEM-REQUEST-N > ZERO                  06970056
069800                 IF  ASC-START-ITEM-REQUEST-N >                   06980056
069900                                          ASC-NUMBER-OF-ITEMS-READ06990056
070000                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07000056
070100                     COMPUTE PV-TOP-ITEM =                        07010056
070200                             ASC-NUMBER-OF-ITEMS-READ             07020056
070300                             - PC-ITEMS-PER-PANEL + 1             07030056
070400                     IF  PV-TOP-ITEM < +1                         07040056
070500                         MOVE +1   TO PV-TOP-ITEM                 07050056
070600                         MOVE PC-TSYMSG-00070                     07060056
070700                                   TO DP020-MSG-NUMBER            07070056
070800                         SET DP020-MSG-INFORMATIONAL              07080056
070900                                   TO TRUE                        07090056
071000                     END-IF                                       07100056
071100                 ELSE                                             07110056
071200                     MOVE ASC-START-ITEM-REQUEST-N                07120056
071300                                   TO PV-TOP-ITEM                 07130056
071400                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      07140056
071500                     COMPUTE PV-BOTTOM-ITEM =                     07150056
071600                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     07160056
071700                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ07170056
071800*                        -- BOTTOM OF LIST --                     07180056
071900                         MOVE PC-TSYMSG-00070                     07190056
072000                                   TO DP020-MSG-NUMBER            07200056
072100                         SET DP020-MSG-INFORMATIONAL              07210056
072200                                   TO TRUE                        07220056
072300                     END-IF                                       07230056
072400                 END-IF                                           07240056
072500             ELSE                                                 07250056
072600*                --- VALUE OUT OF RANGE ----                      07260056
072700                 MOVE PC-TSYMSG-00101                             07270056
072800                                   TO DP020-MSG-NUMBER            07280056
072900                 MOVE -1           TO ASTRTITL                    07290056
073000                 SET DP030-SET-CURSOR-APPL-1                      07300056
073100                                   TO TRUE                        07310056
073200                 MOVE DP015-REVERSE                               07320056
073300                                   TO ASTRTITH                    07330056
073400                 MOVE DP015-RED    TO ASTRTITC                    07340056
073500                 MOVE DP015-UNP-NUM-BRT-MDT                       07350056
073600                                   TO ASTRTITA                    07360056
073700                 SET DP020-MSG-FATAL                              07370056
073800                                   TO TRUE                        07380056
073900                 SET PS-ERROR      TO TRUE                        07390056
074000             END-IF                                               07400056
074100                                                                  07410056
074200         ELSE                                                     07420056
074300             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07430056
074400             MOVE -1               TO ASTRTITL                    07440056
074500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07450056
074600             MOVE DP015-REVERSE    TO ASTRTITH                    07460056
074700             MOVE DP015-RED        TO ASTRTITC                    07470056
074800             MOVE DP015-UNP-NUM-BRT-MDT                           07480056
074900                                   TO ASTRTITA                    07490056
075000             SET DP020-MSG-FATAL   TO TRUE                        07500056
075100             SET PS-ERROR          TO TRUE                        07510056
075200         END-IF                                                   07520056
075300     END-IF.                                                      07530056
075400 EJECT                                                            07540056
075500                                                                  07550056
075600*----------------------------------------------------------------*07560056
075700*    GET THE NEXT MESSAGE IF A LIST OF MESSAGES IS BEING         *07570056
075800*    PROCESSED.                                                  *07580056
075900*----------------------------------------------------------------*07590056
076000                                                                  07600056
076100 2140-GET-NEXT-MESSAGE.                                           07610056
076200                                                                  07620056
076300     ADD +1                       TO ASC-SEL-SUB.                 07630056
076400     IF  ASC-SEL-SUB > ET309-MAX-ITEMS                            07640056
076500         ADD +1                   TO ASC-SEL-ITEM                 07650056
076600         MOVE +1                  TO ASC-SEL-SUB                  07660056
076700     END-IF.                                                      07670056
076800     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                07680056
076900         PERFORM 9100-READ-SEL-QUEUE                              07690056
077000         IF  ET309-ITEM (ASC-SEL-SUB) > ZERO                      07700056
077100             MOVE ET309-VENDOR-NAME TO ASC-VENDOR-NAME            07710056
077200             MOVE ET309-FG-CONTROL-NUMBER (ASC-SEL-SUB) TO        07720056
077300                  ASC-FG-CONTROL-NUMBER                           07730056
077400             MOVE ET309-TS-CONTROL-NUMBER (ASC-SEL-SUB) TO        07740056
077500                  ASC-TS-CONTROL-NUMBER                           07750056
077600             MOVE ET309-TRAN-SET (ASC-SEL-SUB) TO                 07760056
077700                  ASC-TRAN-SET                                    07770056
077800             MOVE ET309-DETAIL (ASC-SEL-SUB) TO                   07780056
077900                  ASC-DETAIL                                      07790056
078000             MOVE ET309-TRN-RLSE-TMST (ASC-SEL-SUB) TO            07800056
078100                  ASC-TRN-RLSE-TMST                               07810056
078200             MOVE ET309-TP-DKEY (ASC-SEL-SUB) TO                  07820056
078300                  ASC-TP-DKEY                                     07830056
078400             MOVE ET309-TP-DKEY-TMST (ASC-SEL-SUB) TO             07840056
078500                  ASC-TP-DKEY-TMST                                07850056
078600             MOVE ET309-FUNC-CDE-SEQ-NBR (ASC-SEL-SUB) TO         07860056
078700                  ASC-FUNC-CDE-SEQ-NBR                            07870056
078800             MOVE ET309-TRN-SET-SEQ-NBR (ASC-SEL-SUB) TO          07880056
078900                  ASC-TRN-SET-SEQ-NBR                             07890056
079000             MOVE ET309-TRANSL-ERR-IND (ASC-SEL-SUB) TO           07900056
079100                  ASC-TRANSL-ERR-IND                              07910056
079200             SET ET309-INQ (ASC-SEL-SUB) TO TRUE                  07920056
079300             PERFORM 9200-REWRITE-SEL-QUEUE                       07930056
079400         ELSE                                                     07940056
079500             SUBTRACT +1 FROM ASC-SEL-SUB                         07950056
079600             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             07960056
079700             SET DP020-MSG-INFORMATIONAL TO TRUE                  07970056
079800             SET PS-LIST-END             TO TRUE                  07980056
079900         END-IF                                                   07990056
080000     ELSE                                                         08000056
080100         SUBTRACT +1 FROM ASC-SEL-ITEM                            08010056
080200         MOVE ET309-MAX-ITEMS     TO ASC-SEL-SUB                  08020056
080300         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             08030056
080400         SET DP020-MSG-INFORMATIONAL TO TRUE                      08040056
080500         SET PS-LIST-END             TO TRUE                      08050056
080600     END-IF.                                                      08060056
080700                                                                  08070056
080800*----------------------------------------------------------------*08080056
080900*    GET THE PREVIOUS MESSAGE IF A LIST OF MESSAGES IS BEING     *08090056
081000*    PROCESSED.                                                  *08100056
081100*----------------------------------------------------------------*08110056
081200                                                                  08120056
081300 2150-GET-PREV-MESSAGE.                                           08130056
081400                                                                  08140056
081500     SUBTRACT +1 FROM ASC-SEL-SUB.                                08150056
081600     IF  ASC-SEL-SUB < +1                                         08160056
081700         SUBTRACT +1 FROM ASC-SEL-ITEM                            08170056
081800         MOVE ET309-MAX-ITEMS     TO ASC-SEL-SUB                  08180056
081900     END-IF.                                                      08190056
082000                                                                  08200056
082100     IF  ASC-SEL-ITEM > ZERO                                      08210056
082200         PERFORM 9100-READ-SEL-QUEUE                              08220056
082300         MOVE ET309-VENDOR-NAME TO ASC-VENDOR-NAME                08230056
082400         MOVE ET309-FG-CONTROL-NUMBER (ASC-SEL-SUB) TO            08240056
082500              ASC-FG-CONTROL-NUMBER                               08250056
082600         MOVE ET309-TS-CONTROL-NUMBER (ASC-SEL-SUB) TO            08260056
082700              ASC-TS-CONTROL-NUMBER                               08270056
082800         MOVE ET309-TRAN-SET (ASC-SEL-SUB) TO                     08280056
082900              ASC-TRAN-SET                                        08290056
083000         MOVE ET309-DETAIL (ASC-SEL-SUB) TO                       08300056
083100              ASC-DETAIL                                          08310056
083200         MOVE ET309-TRN-RLSE-TMST (ASC-SEL-SUB) TO                08320056
083300              ASC-TRN-RLSE-TMST                                   08330056
083400         MOVE ET309-TP-DKEY (ASC-SEL-SUB) TO                      08340056
083500              ASC-TP-DKEY                                         08350056
083600         MOVE ET309-TP-DKEY-TMST (ASC-SEL-SUB) TO                 08360056
083700              ASC-TP-DKEY-TMST                                    08370056
083800         MOVE ET309-FUNC-CDE-SEQ-NBR (ASC-SEL-SUB) TO             08380056
083900              ASC-FUNC-CDE-SEQ-NBR                                08390056
084000         MOVE ET309-TRN-SET-SEQ-NBR (ASC-SEL-SUB) TO              08400056
084100              ASC-TRN-SET-SEQ-NBR                                 08410056
084200         MOVE ET309-TRANSL-ERR-IND (ASC-SEL-SUB) TO               08420056
084300              ASC-TRANSL-ERR-IND                                  08430056
084400     ELSE                                                         08440056
084500         MOVE +1                  TO ASC-SEL-ITEM                 08450056
084600                                     ASC-SEL-SUB                  08460056
084700         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             08470056
084800         SET DP020-MSG-INFORMATIONAL TO TRUE                      08480056
084900         SET PS-LIST-END             TO TRUE                      08490056
085000     END-IF.                                                      08500056
085100                                                                  08510056
085200 EJECT                                                            08520056
085300*----------------------------------------------------------------*08530056
085400*    RESET ATTRIBUTES.                                           *08540056
085500*----------------------------------------------------------------*08550056
085600                                                                  08560056
085700 3200-RESET-ATTRIBUTES.                                           08570056
085800                                                                  08580056
085900     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   08590056
086000     MOVE DP015-GREEN              TO ASTRTITC.                   08600056
086100     MOVE DP015-UNDERLINE          TO ASTRTITH.                   08610056
086200     MOVE -1                       TO ASTRTITL.                   08620056
086300     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       08630056
086400                                                                  08640056
086500 EJECT                                                            08650056
086600                                                                  08660056
086700*----------------------------------------------------------------*08670056
086800*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *08680056
086900*    INITIALIZE ALL COUNTERS AND FLAGS.                          *08690056
087000*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *08700056
087100*    DISPLAY THE PANEL TO USER.                                  *08710056
087200*----------------------------------------------------------------*08720056
087300                                                                  08730056
087400 4000-BUILD-INITIAL-PANEL.                                        08740056
087500                                                                  08750056
087600     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            08760056
087700                                 ASC-BLOCK-ENTRIES (2).           08770056
087800     MOVE +1                 TO  ASC-BLK-SUB.                     08780056
087900     SET ASC-ITEMS-LEFT-ON-DB                                     08790056
088000                             TO  TRUE.                            08800056
088100                                                                  08810056
088200     MOVE +0                 TO  ASC-ITEM-SUB                     08820056
088300                                 ASC-NUMBER-OF-ITEMS-READ         08830056
088400                                 ASC-NUMBER-OF-SELECTED-ITEMS     08840056
088500                                 ASC-HIGHEST-BLOCK-WRITTEN        08850056
088600                                 ASC-START-OF-SELECTED-RANGE      08860056
088700                                 ASC-END-OF-SELECTED-RANGE        08870056
088800                                 ASC-ITEM-AT-TOP-OF-PANEL.        08880056
088900                                                                  08890056
089000     MOVE SPACE              TO  ASC-DESC-LINE-IND                08900056
089100                                 ASC-CORR-LINE-IND.               08910056
089200                                                                  08920056
089300     PERFORM 4005-RECEIVED-LINE.                                  08930056
089400                                                                  08940056
089500     PERFORM 4010-OPEN-CURSOR.                                    08950056
089600                                                                  08960056
089700     PERFORM 4300-READ-ITEMS-FROM-DB.                             08970056
089800                                                                  08980056
089900     PERFORM 4020-CLOSE-CURSOR.                                   08990056
090000                                                                  09000056
090100     MOVE +1                 TO  PV-TOP-ITEM.                     09010056
090200     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          09020056
090300         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    09030056
090400         SET DP020-MSG-FATAL   TO  TRUE                           09040056
090500         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               09050056
090600     ELSE                                                         09060056
090700         MOVE -1             TO ASTRTITL                          09070056
090800         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      09080056
090900         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     09090056
091000     END-IF.                                                      09100056
091100 EJECT                                                            09110056
091200                                                                  09120056
091300*----------------------------------------------------------------*09130056
091400* CREATE THE FIRST LINE ON THE SCREEN                            *09140056
091500*----------------------------------------------------------------*09150056
091600 4005-RECEIVED-LINE.                                              09160056
091700                                                                  09170056
091800     MOVE +1 TO ASC-ITEM-SUB.                                     09180056
091900     MOVE +1 TO ASC-NUMBER-OF-ITEMS-READ.                         09190056
092000                                                                  09200056
092100     MOVE ASC-TP-DKEY-TMST TO PS-TIMESTAMP.                       09210056
092200                                                                  09220056
092300     MOVE PS-TIMESTAMP-MONTH TO PS-DATE-MONTH.                    09230056
092400     MOVE '/' TO PS-DATE-SLASH1.                                  09240056
092500     MOVE PS-TIMESTAMP-DAY TO PS-DATE-DAY.                        09250056
092600     MOVE '/' TO PS-DATE-SLASH2.                                  09260056
092700     MOVE PS-TIMESTAMP-YEAR TO PS-DATE-YEAR.                      09270056
092800     MOVE PS-DATE TO ASC-DATE (ASC-BLK-SUB ASC-ITEM-SUB).         09280056
092900                                                                  09290056
093000     MOVE PS-TIMESTAMP-HOUR TO PS-TIME-HOUR.                      09300056
093100     MOVE ':' TO PS-TIME-COLON.                                   09310056
093200     MOVE PS-TIMESTAMP-MINUTE TO PS-TIME-MINUTE.                  09320056
093300     MOVE PS-TIME TO ASC-TIME (ASC-BLK-SUB ASC-ITEM-SUB).         09330056
093400                                                                  09340056
093500     EXEC SQL                                                     09350056
093600         SELECT TRANSL_SESS_ID,                                   09360056
093700                DIR_IND                                           09370056
093800         INTO   :INTTRN-TRANSL-SESS-ID,                           09380056
093900                :INTTRN-DIR-IND                                   09390056
094000         FROM   TINTTRN                                           09400056
094100         WHERE  TP_DKEY =:ASC-TP-DKEY                             09410056
094200           AND  TP_DKEY_TMST =:ASC-TP-DKEY-TMST                   09420056
094300     END-EXEC.                                                    09430056
094400                                                                  09440056
094500     EVALUATE TRUE                                                09450056
094600        WHEN SQLCODE = ZERO                                       09460056
094700             MOVE INTTRN-TRANSL-SESS-ID TO PS-SESSION-ID-NUM      09470056
094800             MOVE PS-SESSION-ID-CHAR TO                           09480056
094900                  ASC-SESSION (ASC-BLK-SUB ASC-ITEM-SUB)          09490056
095000             IF INTTRN-DIR-IND = 'S'                              09500056
095100                MOVE 'SENT' TO                                    09510056
095200                   ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)          09520056
095300             ELSE                                                 09530056
095400                MOVE 'RECEIVED' TO                                09540056
095500                   ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)          09550056
095600             END-IF                                               09560056
095700        WHEN SQLCODE NOT EQUAL ZERO                               09570056
095800             MOVE '4005-RECEIVED-LINE'                            09580056
095900                               TO DP013-PARAGRAPH                 09590056
096000             MOVE 'SELECTING DATA FOR SCREEN'                     09600056
096100                               TO DP013-MESSAGE-TEXT (1)          09610056
096200             MOVE SQLCA        TO DP013-SQLCA                     09620056
096300             MOVE 'TINTTRN'    TO DP013-DB2-TABLE-NAME (1)        09630056
096400             SET DP013-DB2-ABEND                                  09640056
096500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               09650056
096600             PERFORM DP013-0000-PROCESS-ABEND                     09660056
096700     END-EVALUATE.                                                09670056
096800                                                                  09680056
096900*----------------------------------------------------------------*09690056
097000* CREATE THE LAST LINE ON THE SCREEN                             *09700056
097100*----------------------------------------------------------------*09710056
097200 4006-APPLICATION-LINE.                                           09720056
097300                                                                  09730056
097400     ADD 1 TO ASC-ITEM-SUB.                                       09740056
097500     ADD 1 TO ASC-NUMBER-OF-ITEMS-READ.                           09750056
097600                                                                  09760056
097700     MOVE 'APPLICATION' TO ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB). 09770056
097800                                                                  09780056
097900     MOVE ASC-TRN-RLSE-TMST TO PS-TIMESTAMP.                      09790056
098000                                                                  09800056
098100     MOVE PS-TIMESTAMP-MONTH TO PS-DATE-MONTH.                    09810056
098200     MOVE '/' TO PS-DATE-SLASH1.                                  09820056
098300     MOVE PS-TIMESTAMP-DAY TO PS-DATE-DAY.                        09830056
098400     MOVE '/' TO PS-DATE-SLASH2.                                  09840056
098500     MOVE PS-TIMESTAMP-YEAR TO PS-DATE-YEAR.                      09850056
098600     MOVE PS-DATE TO ASC-DATE (ASC-BLK-SUB ASC-ITEM-SUB).         09860056
098700                                                                  09870056
098800     MOVE PS-TIMESTAMP-HOUR TO PS-TIME-HOUR.                      09880056
098900     MOVE ':' TO PS-TIME-COLON.                                   09890056
099000     MOVE PS-TIMESTAMP-MINUTE TO PS-TIME-MINUTE.                  09900056
099100     MOVE PS-TIME TO ASC-TIME (ASC-BLK-SUB ASC-ITEM-SUB).         09910056
099200                                                                  09920056
099300*----------------------------------------------------------------*09930056
099400* OPEN THE CURSOR.                                               *09940056
099500*----------------------------------------------------------------*09950056
099600                                                                  09960056
099700 4010-OPEN-CURSOR.                                                09970056
099800                                                                  09980056
099900     EXEC SQL                                                     09990056
100000          OPEN ERR_CURSOR                                         10000056
100100     END-EXEC.                                                    10010056
100200                                                                  10020056
100300     EVALUATE TRUE                                                10030056
100400         WHEN SQLCODE = ZERO                                      10040056
100500              CONTINUE                                            10050056
100600         WHEN SQLWARN0 NOT EQUAL SPACE                            10060056
100700         WHEN SQLCODE NOT EQUAL ZERO                              10070056
100800              MOVE '4010-OPEN-CURSOR'                             10080056
100900                           TO  DP013-PARAGRAPH                    10090056
101000              MOVE 'OPEN MESSAGE CURSOR'                          10100056
101100                           TO  DP013-MESSAGE-TEXT (1)             10110056
101200              MOVE SQLCA   TO  DP013-SQLCA                        10120056
101300              SET DP013-DB2-ABEND                                 10130056
101400                           TO  TRUE                               10140056
101500              PERFORM DP013-0000-PROCESS-ABEND                    10150056
101600     END-EVALUATE.                                                10160056
101700                                                                  10170056
101800 EJECT                                                            10180056
101900*----------------------------------------------------------------*10190056
102000* CLOSE THE CURSOR.                                              *10200056
102100*----------------------------------------------------------------*10210056
102200                                                                  10220056
102300 4020-CLOSE-CURSOR.                                               10230056
102400                                                                  10240056
102500     EXEC SQL                                                     10250056
102600         CLOSE ERR_CURSOR                                         10260056
102700     END-EXEC.                                                    10270056
102800                                                                  10280056
102900     EVALUATE TRUE                                                10290056
103000         WHEN SQLCODE = ZERO                                      10300056
103100              CONTINUE                                            10310056
103200         WHEN SQLWARN0 NOT EQUAL SPACE                            10320056
103300         WHEN SQLCODE NOT EQUAL ZERO                              10330056
103400              MOVE '4020-CLOSE-CURSOR'                            10340056
103500                           TO  DP013-PARAGRAPH                    10350056
103600              MOVE 'CLOSE MESSAGE CURSOR'                         10360056
103700                           TO  DP013-MESSAGE-TEXT (1)             10370056
103800              MOVE SQLCA   TO  DP013-SQLCA                        10380056
103900              SET DP013-DB2-ABEND                                 10390056
104000                           TO  TRUE                               10400056
104100              PERFORM DP013-0000-PROCESS-ABEND                    10410056
104200     END-EVALUATE.                                                10420056
104300                                                                  10430056
104400 EJECT                                                            10440056
104500*----------------------------------------------------------------*10450056
104600*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *10460056
104700*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *10470056
104800*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *10480056
104900*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *10490056
105000*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *10500056
105100*                                                                *10510056
105200*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *10520056
105300*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *10530056
105400*    UPON INITIALIZATION.                                        *10540056
105500*----------------------------------------------------------------*10550056
105600                                                                  10560056
105700 4300-READ-ITEMS-FROM-DB.                                         10570056
105800                                                                  10580056
105900     PERFORM                                                      10590056
106000         VARYING PV-READ-COUNT                                    10600056
106100         FROM 1 BY 1                                              10610056
106200         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    10620056
106300            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         10630056
106400                                                                  10640056
106500         PERFORM 4310-FETCH                                       10650056
106600                                                                  10660056
106700         IF  ASC-ITEMS-LEFT-ON-DB                                 10670056
106800             PERFORM 4320-GET-SUB                                 10680056
106900             MOVE TNSTCD-TRN-STAT-DESC                            10690056
107000                          TO ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)10700056
107100             MOVE TNSTLC-TRN-AUD-TMST TO PS-TIMESTAMP             10710056
107200             MOVE PS-TIMESTAMP-MONTH TO PS-DATE-MONTH             10720056
107300             MOVE '/' TO PS-DATE-SLASH1                           10730056
107400             MOVE PS-TIMESTAMP-DAY TO PS-DATE-DAY                 10740056
107500             MOVE '/' TO PS-DATE-SLASH2                           10750056
107600             MOVE PS-TIMESTAMP-YEAR TO PS-DATE-YEAR               10760056
107700             MOVE PS-DATE TO ASC-DATE (ASC-BLK-SUB ASC-ITEM-SUB)  10770056
107800             MOVE PS-TIMESTAMP-HOUR TO PS-TIME-HOUR               10780056
107900             MOVE ':' TO PS-TIME-COLON                            10790056
108000             MOVE PS-TIMESTAMP-MINUTE TO PS-TIME-MINUTE           10800056
108100             MOVE PS-TIME TO ASC-TIME (ASC-BLK-SUB ASC-ITEM-SUB)  10810056
108200             MOVE SPACES TO ASC-SESSION (ASC-BLK-SUB ASC-ITEM-SUB)10820056
108300         END-IF                                                   10830056
108400     END-PERFORM.                                                 10840056
108500                                                                  10850056
108600     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          10860056
108700         PERFORM 4320-GET-SUB                                     10870056
108800     END-IF.                                                      10880056
108900                                                                  10890056
109000     MOVE +1                       TO  ASC-BLK-SUB.               10900056
109100     PERFORM 5100-WRITE-TEMP-STORAGE.                             10910056
109200     ADD +1                        TO  ASC-BLK-SUB.               10920056
109300     PERFORM 5100-WRITE-TEMP-STORAGE.                             10930056
109400                                                                  10940056
109500     MOVE 1                        TO  ASC-BLK-SUB                10950056
109600                                       PV-BLOCK-NUMBER.           10960056
109700     PERFORM 4410-READ-TEMP-STORAGE.                              10970056
109800     IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1                 10980056
109900         MOVE 2                    TO  ASC-BLK-SUB                10990056
110000                                       PV-BLOCK-NUMBER            11000056
110100         PERFORM 4410-READ-TEMP-STORAGE                           11010056
110200     END-IF.                                                      11020056
110300 EJECT                                                            11030056
110400*----------------------------------------------------------------*11040056
110500*    FETCH THE TEXT CURSOR.                                      *11050056
110600*----------------------------------------------------------------*11060056
110700                                                                  11070056
110800 4310-FETCH.                                                      11080056
110900                                                                  11090056
111000     PERFORM                                                      11100056
111100         WITH TEST AFTER                                          11110056
111200         VARYING PV-SQL-SUB                                       11120056
111300         FROM 1 BY 1                                              11130056
111400         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES             11140056
111500            OR SQLCODE = 0                                        11150056
111600            OR SQLCODE = +100                                     11160056
111700                                                                  11170056
111800         EXEC SQL                                                 11180056
111900              FETCH ERR_CURSOR                                    11190056
112000              INTO  :TNSTLC-TRN-AUD-TMST,                         11200056
112100                    :TNSTCD-TRN-STAT-DESC                         11210056
112200         END-EXEC                                                 11220056
112300                                                                  11230056
112400         EVALUATE TRUE                                            11240056
112500             WHEN SQLCODE = ZERO                                  11250056
112600             WHEN SQLCODE = +100                                  11260056
112700             WHEN SQLCODE = -904                                  11270056
112800             WHEN SQLCODE = -913                                  11280056
112900                  CONTINUE                                        11290056
113000             WHEN SQLWARN0 NOT EQUAL SPACE                        11300056
113100             WHEN SQLCODE NOT EQUAL ZERO                          11310056
113200                  MOVE '4310-FETCH-CURSOR'                        11320056
113300                               TO  DP013-PARAGRAPH                11330056
113400                  MOVE 'FETCH MESSAGE CURSOR'                     11340056
113500                               TO  DP013-MESSAGE-TEXT (1)         11350056
113600                  MOVE SQLCA   TO  DP013-SQLCA                    11360056
113700                  SET DP013-DB2-ABEND                             11370056
113800                               TO  TRUE                           11380056
113900                  PERFORM DP013-0000-PROCESS-ABEND                11390056
114000         END-EVALUATE                                             11400056
114100     END-PERFORM.                                                 11410056
114200                                                                  11420056
114300     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                   11430056
114400         MOVE '4310-FETCH-CURSOR'                                 11440056
114500                               TO  DP013-PARAGRAPH                11450056
114600         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             11460056
114700                               TO  DP013-MESSAGE-TEXT (1)         11470056
114800         MOVE SQLCA            TO  DP013-SQLCA                    11480056
114900         SET DP013-DB2-ABEND   TO  TRUE                           11490056
115000         PERFORM DP013-0000-PROCESS-ABEND                         11500056
115100     END-IF.                                                      11510056
115200                                                                  11520056
115300     IF  SQLCODE EQUAL +100                                       11530056
115400         SET ASC-NO-ITEMS-LEFT-ON-DB                              11540056
115500                               TO  TRUE                           11550056
115600         IF ASC-TRN-RLSE-TMST NOT EQUAL SPACES                    11560056
115700            PERFORM 4006-APPLICATION-LINE                         11570056
115800         END-IF                                                   11580056
115900     END-IF.                                                      11590056
116000                                                                  11600056
116100 EJECT                                                            11610056
116200*----------------------------------------------------------------*11620056
116300*    GET THE CORRECT SUBSCRIPTS FOR PLACING THE TEXT LINE.       *11630056
116400*----------------------------------------------------------------*11640056
116500                                                                  11650056
116600 4320-GET-SUB.                                                    11660056
116700                                                                  11670056
116800     IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                        11680056
116900         ADD +1            TO  ASC-ITEM-SUB                       11690056
117000     ELSE                                                         11700056
117100         ADD +1            TO  ASC-BLK-SUB                        11710056
117200         MOVE +1           TO  ASC-ITEM-SUB                       11720056
117300                                                                  11730056
117400         IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 11740056
117500             MOVE +1       TO  ASC-BLK-SUB                        11750056
117600             PERFORM 5100-WRITE-TEMP-STORAGE                      11760056
117700             MOVE ASC-BLOCK-ENTRIES                               11770056
117800                       (PC-MAX-BLOCKS-IN-ARRAY)                   11780056
117900             TO   ASC-BLOCK-ENTRIES(ASC-BLK-SUB)                  11790056
118000             ADD +1        TO  ASC-BLK-SUB                        11800056
118100             INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)           11810056
118200         END-IF                                                   11820056
118300     END-IF.                                                      11830056
118400                                                                  11840056
118500     ADD +1            TO ASC-NUMBER-OF-ITEMS-READ.               11850056
118600                                                                  11860056
118700*----------------------------------------------------------------*11870056
118800*    FORMAT THE MAP AND DETERMINE THE CURSOR POSITION.           *11880056
118900*----------------------------------------------------------------*11890056
119000                                                                  11900056
119100 4400-MOVE-COMMAREA-TO-SCREEN.                                    11910056
119200                                                                  11920056
119300     MOVE ASC-VENDOR-NAME TO AVEND01O.                            11930056
119400     MOVE ASC-FG-CONTROL-NUMBER TO AFGCO01O.                      11940056
119500     MOVE ASC-TS-CONTROL-NUMBER TO ATSCO01O.                      11950056
119600     MOVE ASC-TRAN-SET TO ATSET01O.                               11960056
119700     MOVE ASC-DETAIL TO ATDTL01O.                                 11970056
119800                                                                  11980056
119900     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             11990056
120000         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          12000056
120100         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          12010056
120200             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             12020056
120300                 GIVING PV-BLOCK-NUMBER                           12030056
120400                 REMAINDER PV-REMAINDER                           12040056
120500             IF  PV-REMAINDER > ZERO                              12050056
120600                 ADD +1 TO PV-BLOCK-NUMBER                        12060056
120700             END-IF                                               12070056
120800             MOVE +1    TO ASC-BLK-SUB                            12080056
120900             PERFORM 4410-READ-TEMP-STORAGE                       12090056
121000             ADD +1     TO ASC-BLK-SUB                            12100056
121100                           PV-BLOCK-NUMBER                        12110056
121200             PERFORM 4410-READ-TEMP-STORAGE                       12120056
121300     END-IF.                                                      12130056
121400     MOVE +1                       TO ASC-BLK-SUB.                12140056
121500     MOVE 1 TO ASC-LIST-ITEM-NUMBER (1 1).                        12150056
121600     COMPUTE ASC-ITEM-SUB =                                       12160056
121700         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              12170056
121800         + PC-ITEMS-PER-PANEL).                                   12180056
121900                                                                  12190056
122000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12200056
122100         ADD +1   TO ASC-BLK-SUB                                  12210056
122200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            12220056
122300     END-IF.                                                      12230056
122400                                                                  12240056
122500     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           12250056
122600         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                12260056
122700     PERFORM 4420-FORMAT-LIST-LINES                               12270056
122800         VARYING PS-SUB                                           12280056
122900         FROM PC-ITEMS-PER-PANEL BY -1                            12290056
123000         UNTIL PS-SUB < +1.                                       12300056
123100                                                                  12310056
123200     COMPUTE ASC-ITEMS-DISPLAYED =                                12320056
123300         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          12330056
123400     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    12340056
123500                                      ASTRTITO.                   12350056
123600     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    12360056
123700     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    12370056
123800                                                                  12380056
123900     IF  DP020-MSG-NUMBER-X = SPACE                               12390056
124000         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  12400056
124100*            --- MORE ITEMS TO DISPLAY ----                       12410056
124200             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            12420056
124300             SET DP020-MSG-INFORMATIONAL TO TRUE                  12430056
124400         END-IF                                                   12440056
124500     END-IF.                                                      12450056
124600                                                                  12460056
124700*----------------------------------------------------------------*12470056
124800*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *12480056
124900*----------------------------------------------------------------*12490056
125000                                                                  12500056
125100 4410-READ-TEMP-STORAGE.                                          12510056
125200                                                                  12520056
125300     EXEC CICS                                                    12530056
125400         READQ TS                                                 12540056
125500             QUEUE (ASC-DTL-QUEUE-NAME)                           12550056
125600             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               12560056
125700             ITEM  (PV-BLOCK-NUMBER)                              12570056
125800             RESP  (PV-CICS-RESP)                                 12580056
125900     END-EXEC.                                                    12590056
126000                                                                  12600056
126100     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       12610056
126200       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     12620056
126300         CONTINUE                                                 12630056
126400     ELSE                                                         12640056
126500         SET DP013-CICS-ABEND TO  TRUE                            12650056
126600         SET DP013-NO-ROLLBACK TO  TRUE                           12660056
126700         MOVE '4410-READ-TEMP-STORAGE'                            12670056
126800                               TO  DP013-PARAGRAPH                12680056
126900         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      12690056
127000                               TO  DP013-MESSAGE-TEXT(1)          12700056
127100         PERFORM DP013-0000-PROCESS-ABEND                         12710056
127200     END-IF.                                                      12720056
127300                                                                  12730056
127400     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         12740056
127500         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               12750056
127600     END-IF.                                                      12760056
127700 EJECT                                                            12770056
127800*----------------------------------------------------------------*12780056
127900*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *12790056
128000*----------------------------------------------------------------*12800056
128100                                                                  12810056
128200 4420-FORMAT-LIST-LINES.                                          12820056
128300                                                                  12830056
128400     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      12840056
128500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                12850056
128600         MOVE SPACE TO MR-STATUS (PS-SUB)                         12860056
128700                       MR-DATE (PS-SUB)                           12870056
128800                       MR-TIME (PS-SUB)                           12880056
128900                       MR-SESSION (PS-SUB)                        12890056
129000     ELSE                                                         12900056
129100         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           12910056
129200             MOVE ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)           12920056
129300                  TO MR-STATUS (PS-SUB)                           12930056
129400             MOVE ASC-DATE (ASC-BLK-SUB ASC-ITEM-SUB)             12940056
129500                  TO MR-DATE (PS-SUB)                             12950056
129600             MOVE ASC-TIME (ASC-BLK-SUB ASC-ITEM-SUB)             12960056
129700                  TO MR-TIME (PS-SUB)                             12970056
129800             MOVE ASC-SESSION (ASC-BLK-SUB ASC-ITEM-SUB)          12980056
129900                  TO MR-SESSION (PS-SUB)                          12990056
130000         END-IF                                                   13000056
130100     END-IF.                                                      13010056
130200     SUBTRACT +1 FROM ASC-ITEM-SUB.                               13020056
130300     IF  ASC-ITEM-SUB < + 1                                       13030056
130400         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  13040056
130500         MOVE +1                 TO ASC-BLK-SUB                   13050056
130600     END-IF.                                                      13060056
130700                                                                  13070056
130800*----------------------------------------------------------------*13080056
130900*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *13090056
131000*----------------------------------------------------------------*13100056
131100                                                                  13110056
131200 5100-WRITE-TEMP-STORAGE.                                         13120056
131300                                                                  13130056
131400     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     13140056
131500                               TO  PV-LIST-ITEM-NUMBER.           13150056
131600     COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                           13160056
131700         ASC-HIGHEST-BLOCK-WRITTEN + 1.                           13170056
131800                                                                  13180056
131900     EXEC CICS                                                    13190056
132000         WRITEQ TS                                                13200056
132100             QUEUE (ASC-DTL-QUEUE-NAME)                           13210056
132200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               13220056
132300             ITEM  (PV-HIGHEST-BLOCK-WRITTEN)                     13230056
132400             RESP  (PV-CICS-RESP)                                 13240056
132500     END-EXEC.                                                    13250056
132600                                                                  13260056
132700     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      13270056
132800         SET DP013-CICS-ABEND                                     13280056
132900                       TO  TRUE                                   13290056
133000         SET DP013-NO-ROLLBACK                                    13300056
133100                       TO  TRUE                                   13310056
133200         MOVE '5100-WRITE-TEMP-STORAGE'                           13320056
133300                       TO  DP013-PARAGRAPH                        13330056
133400         MOVE 'ATTEMPTING TO WRITE TEMP STORAGE LIST BLOCK'       13340056
133500                       TO  DP013-MESSAGE-TEXT(1)                  13350056
133600         PERFORM DP013-0000-PROCESS-ABEND                         13360056
133700     END-IF.                                                      13370056
133800     ADD +1            TO  ASC-HIGHEST-BLOCK-WRITTEN.             13380056
133900                                                                  13390056
134000 EJECT                                                            13400056
134100*----------------------------------------------------------------*13410056
134200* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *13420056
134300*----------------------------------------------------------------*13430056
134400                                                                  13440056
134500 9100-READ-SEL-QUEUE.                                             13450056
134600     EXEC CICS                                                    13460056
134700         READQ TS                                                 13470056
134800             QUEUE (ASC-SEL-QUEUE-NAME)                           13480056
134900             INTO  (ET309-INTER-APPL-COMMAREA)                    13490056
135000             ITEM  (ASC-SEL-ITEM)                                 13500056
135100             RESP  (PV-CICS-RESP)                                 13510056
135200     END-EXEC.                                                    13520056
135300                                                                  13530056
135400     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       13540056
135500         CONTINUE                                                 13550056
135600     ELSE                                                         13560056
135700         SET DP013-LOGIC-ABEND                                    13570056
135800             DP013-NO-ROLLBACK     TO TRUE                        13580056
135900         MOVE '9100-READ-SEL-QUEUE'                               13590056
136000                                   TO DP013-PARAGRAPH             13600056
136100         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   13610056
136200                                   TO DP013-MESSAGE-TEXT (1)      13620056
136300         PERFORM DP013-0000-PROCESS-ABEND                         13630056
136400     END-IF.                                                      13640056
136500*----------------------------------------------------------------*13650056
136600* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *13660056
136700*----------------------------------------------------------------*13670056
136800 9200-REWRITE-SEL-QUEUE.                                          13680056
136900     EXEC CICS                                                    13690056
137000          WRITEQ TS                                               13700056
137100              QUEUE  (ASC-SEL-QUEUE-NAME)                         13710056
137200              FROM   (ET309-INTER-APPL-COMMAREA)                  13720056
137300              ITEM   (ASC-SEL-ITEM)                               13730056
137400              RESP   (PV-CICS-RESP)                               13740056
137500              REWRITE                                             13750056
137600     END-EXEC.                                                    13760056
137700                                                                  13770056
137800     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   13780056
137900         SET DP013-CICS-ABEND                                     13790056
138000             DP013-NO-ROLLBACK     TO TRUE                        13800056
138100         MOVE '9200-REWRITE-SEL-QUEUE'                            13810056
138200                                   TO DP013-PARAGRAPH             13820056
138300         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   13830056
138400                                   TO DP013-MESSAGE-TEXT (1)      13840056
138500         PERFORM DP013-0000-PROCESS-ABEND                         13850056
138600     END-IF.                                                      13860056
138700                                                                  13870056
138800 EJECT                                                            13880056
138900*----------------------------------------------------------------*13890056
139000*    ABEND PROCESSOR MODULE                                      *13900056
139100*----------------------------------------------------------------*13910056
139200                                                                  13920056
139300     COPY DPPD013.                                                13930056
