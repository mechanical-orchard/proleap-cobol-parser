000100 IDENTIFICATION DIVISION.                                         00010061
000200 TITLE 'MANIFESTING - SCAN CONVEYOR CUTOFF CARTON '.              00020061
000300                                                                  00030061
000400 PROGRAM-ID.             PCKRF874.                                00040061
000500 AUTHOR.                 DENNIS STEFFEN.                          00050061
000600 INSTALLATION.           KOHLS.                                   00060061
000700 DATE-WRITTEN.           MAY 2001.                                00070061
000800 DATE-COMPILED.                                                   00080061
000900                                                                  00090061
001000*   MANIFESTING PROJECT - CONVEYOR CUTOFF - CARTON ID SCAN        00100061
001100                                                                  00110061
001200 ENVIRONMENT DIVISION.                                            00120061
001300 DATA DIVISION.                                                   00130061
001400                                                                  00140061
001500 WORKING-STORAGE SECTION.                                         00150061
001600                                                                  00160061
001700 01  PC-PROGRAM-CONSTANTS.                                        00170061
001800     05  PC-TRANID                    PIC X(04) VALUE 'E874'.     00180061
001900     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'PCKRF874'. 00190061
002000     05  PC-DUMMY-TIMESTAMP           PIC X(26) VALUE             00200061
002100            '9999-09-09-09.09.09.999999'.                         00210061
002200     05  PC-CUTOFF-TIMESTAMP          PIC X(26) VALUE             00220061
002300            '2002-07-29-00.00.01.000000'.                         00230061
002400     05  PC-LOW-TIMESTAMP             PIC X(26) VALUE             00240061
002500            '0001-01-01-01.00.00.000000'.                         00250061
002600     05  PC-MUST-BE-NUM-MSG           PIC X(19) VALUE             00260061
002700                                           'MUST BE NUMERIC    '. 00270061
002800                                                                  00280061
002900                                                                  00290061
003000* ERROR MESSAGES                                                 *00300061
003100     05  PC-UNRECOGNIZED-PF-KEY-MSG   PIC X(19) VALUE             00310061
003200                                           'UNRECOGNIZED PF KEY'. 00320061
003300     05  PC-ENTER-THROUGH-MENU-MSG    PIC X(19) VALUE             00330061
003400                                           'ENTER THROUGH MENU '. 00340061
003500     05  PC-TRANS-UNAVAILABLE-MSG     PIC X(19) VALUE             00350061
003600                                           'TRANS NOT AVAILABLE'. 00360061
003700     05  PC-WRONG-FACILITY            PIC X(19) VALUE             00370061
003800                                           'WRG FCLTY - F2 CONF'. 00380061
003900                                                                  00390061
004000 01  PS-PROGRAM-SWITCHES.                                         00400061
004100     05  PS-ERROR-SW                  PIC X(01)  VALUE 'N'.       00410061
004200         88  PS-ERRORS-YES                        VALUE 'Y'.      00420061
004300         88  PS-ERRORS-NO                         VALUE 'N'.      00430061
004400     05  PS-VALID-INPUT-SW            PIC  X(01)  VALUE 'N'.      00440061
004500         88  PS-VALID-INPUT                       VALUE 'Y'.      00450061
004600         88  PS-INVALID-INPUT                     VALUE 'N'.      00460061
004700     05  PS-XCTL-SW                   PIC X(04)   VALUE SPACES.   00470061
004800         88  PS-XCTL-E871                       VALUE 'E871'.     00480061
004900     05  PS-CSR-SW                    PIC X(01) VALUE 'N'.        00490061
005000         88  PS-START-CSR                         VALUE 'N'.      00500061
005100         88  PS-END-CSR                           VALUE 'Y'.      00510061
005200     05  PS-CONVEYOR-CARTON-SW        PIC X(01)   VALUE 'N'.      00520061
005300         88  PS-CONVEYOR-CARTON-YES               VALUE 'Y'.      00530061
005400         88  PS-CONVEYOR-CARTON-NO                VALUE 'N'.      00540061
005500     05  PS-CUTOFF-SW                 PIC X(01)   VALUE 'N'.      00550061
005600         88  PS-CUTOFFS-YES                       VALUE 'Y'.      00560061
005700         88  PS-CUTOFFS-NO                        VALUE 'N'.      00570061
005800                                                                  00580061
005900 01  PV-PROGRAM-VARIABLES.                                        00590061
005901* DMH - 1/30/13 BEGIN                                             00590161
005902     05  PV-DIVERT-DATE               PIC  X(10)  VALUE SPACES.   00590261
005903     05  PV-DIVERT-TIME               PIC  X(05)  VALUE SPACES.   00590361
005904     05  PV-DIVERT-TMST               PIC  X(26)  VALUE SPACES.   00590461
005905     05  PV-SHIPT-UNT-ID              PIC S9(18)V COMP-3.         00590561
005906     05  PV-SML                       PIC  9(18)  VALUE ZEROES.   00590661
005907* DMH - 1/30/13 END                                               00590761
005908     05  PV-CURRENT-TMST              PIC  X(26).                 00590861
005909     05  PV-DB2-COUNT                 PIC S9(09) VALUE ZERO       00590961
005910                                                     COMP SYNC.   00591061
005920     05  PV-COMMAREA-LENGTH           PIC S9(04)  VALUE +0        00592061
005930                                                     COMP SYNC.   00593061
005940     05  PV-MESSAGE-AREA              PIC  X(19)  VALUE SPACE.    00594061
005950     05  PV-CICS-RESPONSE             PIC S9(09)  VALUE ZEROS     00595061
005960                                                     COMP SYNC.   00596061
005970     05  PV-TRANSFER-PROGRAM          PIC  X(08)  VALUE SPACE.    00597061
005980                                                                  00598061
005990     05  PV-SUB                       PIC S9(4) COMP              00599061
006000                                                VALUE ZERO.       00600061
006100     05  PV-COUNT                     PIC S9(4) COMP              00610061
006200                                                VALUE ZERO.       00620061
006300     05  PV-CTN.                                                  00630061
006400         10  PV-CTN-CHAR              PIC X(01)                   00640061
006500                            OCCURS 20 TIMES.                      00650061
006600     05  PV-CTN-18                    PIC X(18) VALUE ZEROES.     00660061
006700     05  PV-CTN-N REDEFINES PV-CTN-18 PIC 9(18).                  00670061
006800                                                                  00680061
006900     05  PV-BARCODE-CHECKER           PIC X(20).                  00690061
007000* VALID PATTERNS                                                  00700061
007100         88  PV-VALID-BARCODE         VALUES                      00710061
007200             '00499999999999999999'                               00720061
007300             'B049999999999999999B'                               00730061
007400             'BB499999999999999999'                               00740061
007500             '499999999999999999BB'                               00750061
007600             '409999999999999999BB'                               00760061
007700             '449999999999999999BB'                               00770061
007800             'B409999999999999999B'                               00780061
007900             'B499999999999999999B'                               00790061
008000             'B449999999999999999B'.                              00800061
008100         88  PV-2-LEAD-ZEROES         VALUE                       00810061
008200             '00499999999999999999'.                              00820061
008300         88  PV-LEAD-TRAIL-SPACES     VALUE                       00830061
008400             'B499999999999999999B'                               00840061
008500             'B409999999999999999B'                               00850061
008600             'B449999999999999999B'.                              00860061
008700         88  PV-2-LEAD-SPACES         VALUE                       00870061
008800             'BB499999999999999999'.                              00880061
008900         88  PV-TRAIL-SPACES          VALUE                       00890061
009000             '499999999999999999BB'                               00900061
009100             '409999999999999999BB'                               00910061
009200             '449999999999999999BB'.                              00920061
009300         88  PV-ALL-SPACES            VALUE                       00930061
009400             'BBBBBBBBBBBBBBBBBBBB'.                              00940061
009500                                                                  00950061
009600* INVALID PATTERNS                                                00960061
009700         88  PV-NOT-START-WITH-4      VALUES                      00970061
009800             '999999999999999999BB'                               00980061
009900             'B999999999999999999B'                               00990061
010000             'BB999999999999999999'.                              01000061
010100         88  PV-NOT-START-WITH-004    VALUES                      01010061
010200             '00999999999999999999'.                              01020061
010300*        88  PV-INVALID-ALL-BLANK     VALUES                      01030061
010400*            'BBBBBBBBBBBBBBBBBBBB'.                              01040061
010500                                                                  01050061
010600     05  PV-BARCODE-EDIT-MASK REDEFINES                           01060061
010700                              PV-BARCODE-CHECKER.                 01070061
010800         10  PV-BARCODE-CHAR          PIC X(01)                   01080061
010900                              OCCURS 20 TIMES.                    01090061
011000     05  DK-BRCDE-NBR                 PIC X(22) VALUE SPACES.     01100061
011100     05  PV-END-DIVERT-TMST           PIC X(26) VALUE SPACES.     01110061
011200     05  PV-TRIP-END-TMST             PIC X(26) VALUE SPACES.     01120061
011300     05  DK-LAST-STRT-TMST            PIC X(26) VALUE SPACES.     01130061
011400                                                                  01140061
011500                                                                  01150061
011600 01  PV-LOG-MSG.                                                  01160061
011700     05  FILLER                       PIC X(12) VALUE             01170061
011800         ' E874 ERROR '.                                          01180061
011900     05  FILLER                       PIC X(06) VALUE             01190061
012000         'USER= '.                                                01200061
012100     05  PV-USER-ID                   PIC X(08) VALUE SPACES.     01210061
012200     05  FILLER                       PIC X(10) VALUE             01220061
012300         ' SQLCODE= '.                                            01230061
012400     05  PV-SQLCODE                   PIC -9(03).                 01240061
012500     05  FILLER                       PIC X(06) VALUE             01250061
012600         ' ERR= '.                                                01260061
012700     05  PV-ERROR-NBR                 PIC 9(03) VALUE ZERO.       01270061
012800     05  FILLER                       PIC X(07) VALUE             01280061
012900         ' DOOR= '.                                               01290061
013000     05  PV-DISPLAY-DOOR              PIC X(04) VALUE SPACES.     01300061
013100     05  FILLER                       PIC X(07) VALUE             01310061
013200         ' TRIP= '.                                               01320061
013300     05  PV-DISPLAY-TRP               PIC 9(09) VALUE ZEROES.     01330061
013400     05  FILLER                       PIC X(07) VALUE             01340061
013500         ' LAST= '.                                               01350061
013600     05  PV-DISPLAY-LAST              PIC X(08) VALUE SPACES.     01360061
013700 01  PV-LOG-MSG-2.                                                01370061
013800     05  FILLER                       PIC X(12) VALUE             01380061
013900         ' E874 ERROR '.                                          01390061
014000     05  FILLER                       PIC X(06) VALUE             01400061
014100         'TMST= '.                                                01410061
014200     05  PV-TIMESTAMP                 PIC X(26) VALUE SPACES.     01420061
014300     05  FILLER                       PIC X(06) VALUE             01430061
014400         'BARC= '.                                                01440061
014500     05  PV-BARCODE                   PIC X(22) VALUE SPACES.     01450061
014600                                                                  01460061
014700 01  PV-LOG-MSG-3                     PIC X(100) VALUE SPACES.    01470061
014800                                                                  01480061
014900 01  PV-DEBUG-MSG.                                                01490061
015000     05  FILLER                       PIC X(07) VALUE ' OPER= '.  01500061
015100     05  PV-DEBUG-OPER-UNT-ID         PIC 9999.                   01510061
015200     05  FILLER                       PIC X(07) VALUE ' DVRT= '.  01520061
015300     05  PV-DEBUG-DIVERT-NBR          PIC ZZZZZZZZ9.              01530061
015400     05  FILLER                       PIC X(11)                   01540061
015500                             VALUE ' DVRT LOC= '.                 01550061
015600     05  PV-DEBUG-DIVERT-LOC-ID       PIC X(04).                  01560061
015700     05  FILLER                       PIC X(12)                   01570061
015800                             VALUE ' DVRT TMST= '.                01580061
015900     05  PV-DEBUG-DIVERT-TMST         PIC X(26).                  01590061
016000 01  PV-DEBUG-MSG2.                                               01600061
016100     05  FILLER                       PIC X(16)                   01610061
016200                             VALUE ' TRIP END TMST= '.            01620061
016300     05  PV-DEBUG-TRIP-END-TMST       PIC X(26).                  01630061
016400     05  FILLER                       PIC X(06)                   01640061
016500                             VALUE ' STR= '.                      01650061
016600     05  PV-DEBUG-STR-NBR             PIC 9999.                   01660061
016700/                                                                 01670061
016800 01  PV-EDITING-FIELDS.                                           01680061
016900     05  PV-SCREEN-DOOR               PIC X(04).                  01690061
017000     05  PV-SCREEN-DEST               PIC X(04).                  01700061
017100     05  PV-SCREEN-SERIAL-NBR         PIC X(09).                  01710061
017200                                                                  01720061
017300 01  PV-DISPLAY-FIELDS.                                           01730061
017400     05  PV-DISPLAY-DOOR-ID           PIC  X(04)  VALUE SPACE.    01740061
017500     05  PV-DISPLAY-OPER              PIC  9(04)  VALUE ZEROES.   01750061
017600     05  PV-DISPLAY-DEST              PIC  9(04)  VALUE ZEROES.   01760061
017700     05  PV-DISPLAY-SRL-NBR           PIC  9(09)  VALUE ZEROES.   01770061
017800     05  PV-DISPLAY-SCAC              PIC  X(04)  VALUE SPACES.   01780061
017900     05  PV-DISPLAY-TRLR-ID           PIC  X(12)  VALUE ZEROES.   01790061
018000     05  PV-DISPLAY-TRIP              PIC  9(09)  VALUE ZEROES.   01800061
018100                                                                  01810061
018200     05  PV-DISP-DVRT-CNT             PIC  Z(09)  VALUE ZEROES.   01820061
018300     05  PV-DISP-OPER                 PIC  Z(04)  VALUE ZEROES.   01830061
018400     05  PV-DISP-DVRT-NBR             PIC  Z(09)  VALUE ZEROES.   01840061
018500     05  PV-DISP-DVRT-LOC             PIC  X(04)  VALUE SPACES.   01850061
018600     05  PV-DISP-STR-NBR              PIC  Z(04)  VALUE ZEROES.   01860061
018700     05  PV-DISP-BRCDE-NBR            PIC  X(22)  VALUE SPACES.   01870061
018800     05  PV-DISP-SQLCODE              PIC  -999   VALUE ZEROES.   01880061
018900                                                                  01890061
019000 01  CA-COMMAREA.                                                 01900061
019100     COPY PCWS233.                                                01910061
019200     05  CA-PRIVATE-COMMAREA          PIC X(100).                 01920061
019300     05  CA-REDEFINED-COMMAREA REDEFINES CA-PRIVATE-COMMAREA.     01930061
019400         10  CA-CURR-CARTON           PIC 9(18).                  01940061
019500/                                                                 01950061
019600*  MAP LAYOUT                                                     01960061
019700     COPY PCKM874.                                                01970061
019800                                                                  01980061
019900* HELP SCREEN COMMAREA                                            01990061
020000     COPY PCWS192.                                                02000061
020100* HELP SCREEN WORK AREA                                           02010061
020200     COPY PCWS188.                                                02020061
020300/                                                                 02030061
020400     COPY DPWS010I.                                               02040061
020500*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   02050061
020600     COPY DPWS015.                                                02060061
020700                                                                  02070061
020800*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      02080061
020900     COPY DFHAID.                                                 02090061
021000                                                                  02100061
021100*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               02110061
021200     COPY DPWS013.                                                02120061
021300                                                                  02130061
021400/                                                                 02140061
021500*    CARTON DIVERT / CONVEYOR                                     02150061
021600     EXEC SQL                                                     02160061
021700         INCLUDE TSUCRDV                                          02170061
021800     END-EXEC.                                                    02180061
021900                                                                  02190061
022000*    CARTON/TRIP ASSOCIATION TABLE                                02200061
022100     EXEC SQL                                                     02210061
022200         INCLUDE TSUCDOT                                          02220061
022300     END-EXEC.                                                    02230061
022400                                                                  02240061
022500     EXEC SQL                                                     02250061
022600         INCLUDE TCNDCDR                                          02260061
022700     END-EXEC.                                                    02270061
022800                                                                  02280061
022900     EXEC SQL                                                     02290061
023000         INCLUDE SUT00006                                         02300061
023100     END-EXEC.                                                    02310061
023200                                                                  02320061
023300     EXEC SQL                                                     02330061
023400         INCLUDE TSUOBTR                                          02340061
023500     END-EXEC.                                                    02350061
023600                                                                  02360061
023700     EXEC SQL                                                     02370061
023800         INCLUDE TSUOBTS                                          02380061
023900     END-EXEC.                                                    02390061
024000/                                                                 02400061
024100     EXEC SQL                                                     02410061
024200         DECLARE CARTON-CSR CURSOR FOR                            02420061
024300         SELECT CRDV.DIVERT_TMST                                  02430061
024400              , CRDV.SHIPT_UNT_ID                                 02440061
024500              , CRDV.BRCDE_NBR                                    02450061
024600         FROM                                                     02460061
024700             TSUCRDV CRDV                                         02470061
024800         WHERE                                                    02480061
024900            CRDV.OPER_UNT_ID    = :PC233-OPER-UNT-ID    AND       02490061
025000            CRDV.DIVERT_NBR     = :PC233-DIVERT-NBR     AND       02500061
025100            CRDV.DIVERT_LOC_ID  = :PC233-DIVERT-LOC-ID  AND       02510061
025110            CRDV.DOOR_ID        = :PC233-DOOR-ID        AND       02511062
025200            CRDV.ACTV_CDE       = 'A'                   AND       02520061
025300              CRDV.DIVERT_TMST <                                  02530061
025400             ( SELECT MAX(CRDV1.DIVERT_TMST)                      02540061
025500                 FROM TSUCRDV CRDV1                               02550061
025600               WHERE                                              02560061
025700                 CRDV.OPER_UNT_ID    = CRDV1.OPER_UNT_ID   AND    02570061
025800                 CRDV.DIVERT_NBR     = CRDV1.DIVERT_NBR    AND    02580061
025900                 CRDV.DIVERT_LOC_ID  = CRDV1.DIVERT_LOC_ID AND    02590061
026000                 CRDV1.BRCDE_NBR     = :PC233-BRCDE-NBR    AND    02600061
026100                 CRDV1.ACTV_CDE       = 'A'                       02610061
026200             )                                                    02620061
026300                                                                  02630061
026400             AND                                                  02640061
026500                                                                  02650061
026600              CRDV.DIVERT_TMST >                                  02660061
026700            (SELECT MAX(DOT.STRT_DIVERT_TMST)                     02670061
026800             FROM TSUCDOT DOT                                     02680061
026900             WHERE                                                02690061
027000             DOT.OPER_UNT_ID  = CRDV.OPER_UNT_ID                  02700061
027100                AND                                               02710061
027200             DOT.DOOR_ID      = CRDV.DOOR_ID)                     02720061
027300                                                                  02730061
027400              ORDER BY                                            02740061
027500                  CRDV.DIVERT_TMST DESC                           02750061
027600             FETCH FIRST 1 ROW ONLY                               02760061
027700                                                                  02770061
027800     END-EXEC.                                                    02780061
027900                                                                  02790061
028000     EXEC SQL                                                     02800061
028100         INCLUDE SQLCA                                            02810061
028200     END-EXEC.                                                    02820061
028300                                                                  02830061
028400 LINKAGE SECTION.                                                 02840061
028500 01  DFHCOMMAREA.                                                 02850061
028600     05  FILLER                         OCCURS  1 TO 4072 TIMES   02860061
028700                                      DEPENDING ON EIBCALEN.      02870061
028800         10  FILLER                   PIC X.                      02880061
028900/                                                                 02890061
029000 PROCEDURE DIVISION.                                              02900061
029100 0000-PROGRAM-MAINLINE.                                           02910061
029200                                                                  02920061
029300     INITIALIZE CA-COMMAREA                                       02930061
029400     MOVE DFHCOMMAREA                 TO CA-COMMAREA              02940061
029500                                                                  02950061
029600     EVALUATE TRUE                                                02960061
029700         WHEN EIBCALEN = ZERO                                     02970061
029800             MOVE PC-ENTER-THROUGH-MENU-MSG                       02980061
029900                                      TO PV-MESSAGE-AREA          02990061
030000             PERFORM 8110-RETURN                                  03000061
030100                                                                  03010061
030200         WHEN EIBTRNID = 'Z278'                                   03020061
030300*            RETURNING FROM F1 HELP INFO SCREEN                   03030061
030400             MOVE DFHCOMMAREA         TO PC192-COMMAREA           03040061
030500             MOVE PC192-HOST-SAVE-AREA                            03050061
030600                                      TO CA-COMMAREA              03060061
030700             SET PC233-PROCESS-SCREEN TO TRUE                     03070061
030800             MOVE PC192-HOST-SAVE-MAP TO PC874AO                  03080061
030900             MOVE -1                  TO ADOORL                   03090061
031000             PERFORM 8000-SEND-MAP                                03100061
031100             PERFORM 8100-RETURN-TRANID                           03110061
031200                                                                  03120061
031300         WHEN PC233-INITIALIZE-SCREEN                             03130061
031400         WHEN EIBAID = DFHCLEAR                                   03140061
031500             SET PC233-PROCESS-SCREEN TO TRUE                     03150061
031600             PERFORM 1000-INITIALIZE                              03160061
031700             PERFORM 8000-SEND-MAP                                03170061
031800             PERFORM 8100-RETURN-TRANID                           03180061
031900                                                                  03190061
032000         WHEN EIBAID = DFHPF8                                     03200061
032100             MOVE 'PCKRF880'          TO PV-TRANSFER-PROGRAM      03210061
032200             PERFORM 8200-XCTL                                    03220061
032300*                                                                 03230061
032400                                                                  03240061
032500         WHEN EIBAID = DFHPF9                                     03250061
032600             MOVE 'PCKRF743'          TO PV-TRANSFER-PROGRAM      03260061
032700             PERFORM 8200-XCTL                                    03270061
032800                                                                  03280061
032900         WHEN EIBAID = DFHPF3                                     03290061
033000             EVALUATE TRUE                                        03300061
033100             WHEN PC233-CONVEYOR-CUTOFF                           03310061
033200                 MOVE PC233-ROOT-PROGRAM                          03320061
033300                                      TO PV-TRANSFER-PROGRAM      03330061
033400             WHEN PC233-OPEN-TRLR                                 03340061
033500                 MOVE PC233-MENU-PROGRAM                          03350061
033600                                      TO PV-TRANSFER-PROGRAM      03360061
033700             WHEN PC233-CLOSE-TRLR                                03370061
033800                 MOVE PC233-MENU-PROGRAM                          03380061
033900                                      TO PV-TRANSFER-PROGRAM      03390061
034000             WHEN OTHER                                           03400061
034100                 MOVE PC233-MENU-PROGRAM                          03410061
034200                                      TO PV-TRANSFER-PROGRAM      03420061
034300             END-EVALUATE                                         03430061
034400             PERFORM 8200-XCTL                                    03440061
034500*                                                                 03450061
034600         WHEN EIBAID = DFHENTER                                   03460061
034700             PERFORM 8020-RECEIVE-MAP                             03470061
034800             PERFORM 2100-EDIT-INPUT                              03480061
034900                                                                  03490061
035000             IF PS-VALID-INPUT                                    03500061
035100                                                                  03510061
035200                 IF PC233-BRCDE-NBR > SPACES                      03520061
035300                     SET PS-ERRORS-NO TO TRUE                     03530061
035400                     PERFORM 2200-CHECK-TABLES                    03540061
035500                                                                  03550061
035600                     IF PS-ERRORS-NO                              03560061
035700                                                                  03570061
035800                        IF PS-CONVEYOR-CARTON-YES                 03580061
035900                            IF CNDCDR-DIVERT-LOC-ID =             03590061
036000                                       SUCRDV-DIVERT-LOC-ID       03600061
036100                                PERFORM 2000-PROCESS              03610061
036200                                IF PC233-CUTOFF-START-CTN         03620061
036300                                    MOVE PC233-MENU-PROGRAM       03630061
036400                                          TO PV-TRANSFER-PROGRAM  03640061
036500                                    PERFORM 8200-XCTL             03650061
036600                                ELSE                              03660061
036700                                    MOVE PC233-NEXT-PROGRAM       03670061
036800                                          TO PV-TRANSFER-PROGRAM  03680061
036900                                    PERFORM 8200-XCTL             03690061
037000                                END-IF                            03700061
037100                            ELSE                                  03710061
037200                                MOVE PC233-STR-NBR                03720061
037300                                     TO PC233-ERROR-TRLR-STR-NBR  03730061
037400                                MOVE 0                            03740061
037500                                     TO PC233-ERROR-CTN-STR-NBR   03750061
037600                                MOVE 27  TO PC233-PGM-MSG-NBR     03760061
037700                                PERFORM 8210-XCTL-ERROR-SCREEN    03770061
037800                            END-IF                                03780061
037900                                                                  03790061
038000                        ELSE                                      03800061
038100                                                                  03810061
038200                             MOVE PC233-TRAILER                   03820061
038300                                      TO PC233-ERROR-TRLR-ID      03830061
038400                             MOVE PC233-OWNER-SCAC-ID             03840061
038500                                      TO PC233-ERROR-SCAC-ID      03850061
038600                                                                  03860061
038700                             MOVE PC233-TRIP-ID                   03870061
038800                                      TO PC233-ERROR-TRIP-ID      03880061
038900                             MOVE 33  TO PC233-PGM-MSG-NBR        03890061
039000*                            MOVE 'PCKRF870'                      03900061
039100*                                     TO PC233-NEXT-PROGRAM       03910061
039200                             PERFORM 8210-XCTL-ERROR-SCREEN       03920061
039300                        END-IF                                    03930061
039400                                                                  03940061
039500                     ELSE                                         03950061
039600                         IF PS-XCTL-E871                          03960061
039700                            PERFORM 8210-XCTL-ERROR-SCREEN        03970061
039800                         ELSE                                     03980061
039900                            PERFORM 8010-SEND-DATA-ONLY           03990061
040000                            PERFORM 8100-RETURN-TRANID            04000061
040100                         END-IF                                   04010061
040200                                                                  04020061
040300                 ELSE                                             04030061
040400                     MOVE 8           TO PC233-PGM-MSG-NBR        04040061
040500                     PERFORM 8210-XCTL-ERROR-SCREEN               04050061
040600                 END-IF                                           04060061
040700                                                                  04070061
040800             ELSE                                                 04080061
040900                     MOVE -1          TO ASMLL                    04090061
041000                     PERFORM 8010-SEND-DATA-ONLY                  04100061
041100                     PERFORM 8100-RETURN-TRANID                   04110061
041200             END-IF                                               04120061
041300                                                                  04130061
041400                                                                  04140061
041500         WHEN EIBAID = DFHPF1                                     04150061
041600             PERFORM 8020-RECEIVE-MAP                             04160061
041700             MOVE PC874AO             TO PC192-HOST-SAVE-MAP      04170061
041800             PERFORM 1200-HELP-SCREEN                             04180061
041900                                                                  04190061
042000         WHEN OTHER                                               04200061
042100             PERFORM 8020-RECEIVE-MAP                             04210061
042200             MOVE -1                  TO ADOORL                   04220061
042300             MOVE PC-UNRECOGNIZED-PF-KEY-MSG                      04230061
042400                                      TO AMSGLNO                  04240061
042500             PERFORM 8000-SEND-MAP                                04250061
042600             PERFORM 8100-RETURN-TRANID                           04260061
042700     END-EVALUATE.                                                04270061
042800                                                                  04280061
042900     GOBACK.                                                      04290061
043000                                                                  04300061
043100 1000-INITIALIZE.                                                 04310061
043200                                                                  04320061
043300                                                                  04330061
043400     MOVE PC233-DOOR-ID               TO ADOORO                   04340061
043500     MOVE PC233-TRIP-ID               TO ATRIPO                   04350061
043600     MOVE PC233-SERIAL-NBR            TO ASERIALO                 04360061
043700     MOVE PC233-STR-NBR               TO ADESTO                   04370061
043800     MOVE PC233-OWNER-SCAC-ID         TO ASCACO                   04380061
043900     MOVE PC233-TRAILER               TO ATRLRO                   04390061
044000     MOVE -1                          TO ASMLL                    04400061
044100                                                                  04410061
044200     MOVE SPACES                      TO AMSGLNO                  04420061
044300                                                                  04430061
044400     IF EIBTRNID = 'E870' OR 'E875'                               04440061
044500         MOVE ' * TRAILER OPENED *'   TO AMSGLNO                  04450061
044600         MOVE 'FIRST CARTON ID:'      TO ATYPEO                   04460061
044700     ELSE                                                         04470061
044800         IF PC233-FIRST-CTN-ON-NEXT-TRLR                          04480061
044900             MOVE ' NEXT CARTON ID:'  TO ATYPEO                   04490061
045000         ELSE                                                     04500061
045100         IF PC233-LAST-CTN-ON-THIS-TRLR                           04510061
045200             MOVE ' LAST CARTON ID:'  TO ATYPEO                   04520061
045300         ELSE                                                     04530061
045400             MOVE 'FIRST CARTON ID:'  TO ATYPEO                   04540061
045500         END-IF                                                   04550061
045600         END-IF                                                   04560061
045700     END-IF.                                                      04570061
045800                                                                  04580061
045900     INITIALIZE CA-REDEFINED-COMMAREA                             04590061
046000     MOVE PC-TRANID                   TO PC233-TRAN-ID            04600061
046100                                                                  04610061
046200     MOVE PC233-USER-ID               TO PV-USER-ID.              04620061
046300                                                                  04630061
046400*    MOVE PC-CURRENT-PROGRAM-NAME     TO PC233-LAST-PROGRAM.      04640061
046500                                                                  04650061
046600 1200-HELP-SCREEN.                                                04660061
046700     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      04670061
046800     MOVE PC-CURRENT-PROGRAM-NAME     TO PC192-PROGRAM-NAME       04680061
046900     COPY PCPD188.                                                04690061
047000     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      04700061
047100     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA     04710061
047200     PERFORM 8220-XCTL-TO-HELP.                                   04720061
047300/                                                                 04730061
047400 2000-PROCESS.                                                    04740061
047500     IF PC233-CUTOFF-START-CTN                                    04750061
047600         MOVE SUCRDV-DIVERT-TMST      TO SUCDOT-STRT-DIVERT-TMST  04760061
047700         PERFORM 7100-INSERT-TSUCDOT                              04770061
047800     ELSE                                                         04780061
047900         IF PC233-FIRST-CTN-ON-NEXT-TRLR                          04790061
048000             PERFORM 2300-FIND-PREV-CARTON                        04800061
048100             MOVE SUCRDV-DIVERT-TMST  TO SUCDOT-END-DIVERT-TMST   04810061
048200         ELSE                                                     04820061
048300             MOVE SUCRDV-DIVERT-TMST  TO SUCDOT-END-DIVERT-TMST   04830061
048400         END-IF                                                   04840061
048500         PERFORM 7150-UPDATE-TSUCDOT                              04850061
048600     END-IF.                                                      04860061
048700     PERFORM 7400-INSERT-WRKR-AUD.                                04870061
048800/                                                                 04880061
048900 2100-EDIT-INPUT.                                                 04890061
049000                                                                  04900061
049100     SET PS-ERRORS-NO                 TO TRUE                     04910061
049200     MOVE SPACES                      TO AMSGLNO                  04920061
049300                                                                  04930061
049400     IF  ASMLL > ZERO                                             04940061
049500         MOVE ASMLI TO PV-CTN                                     04950061
049600     ELSE                                                         04960061
049700         IF ASMLA = DP015-ERASE-EOF                               04970061
049800             MOVE SPACES TO PV-CTN                                04980061
049900         END-IF                                                   04990061
050000     END-IF.                                                      05000061
050100                                                                  05010061
050200     INSPECT PV-CTN REPLACING ALL LOW-VALUES BY SPACES.           05020061
050300                                                                  05030061
050400     IF  PV-CTN  >  SPACES                                        05040061
050500         PERFORM 2110-EDIT-CTN                                    05050061
050600     END-IF.                                                      05060061
050700                                                                  05070061
050800 2110-EDIT-CTN.                                                   05080061
050900                                                                  05090061
051000     SET PS-VALID-INPUT               TO TRUE                     05100061
051100* BARCODE CAN BE EITHER 20 DIGITS OR 18 DIGITS WITHOUT            05110061
051200* THE LEADING 2 ZEROS                                             05120061
051300                                                                  05130061
051400     PERFORM VARYING PV-SUB FROM 1 BY 1                           05140061
051500             UNTIL PV-SUB > 20                                    05150061
051600                                                                  05160061
051700         EVALUATE TRUE                                            05170061
051800         WHEN PV-CTN-CHAR (PV-SUB) = ZERO                         05180061
051900*            IF PV-SUB < 3 OR > 18                                05190061
052000             IF PV-SUB < 3                                        05200061
052100                 MOVE ZERO            TO PV-BARCODE-CHAR          05210061
052200                                         (PV-SUB)                 05220061
052300             ELSE                                                 05230061
052400                 MOVE '9'             TO PV-BARCODE-CHAR          05240061
052500                                         (PV-SUB)                 05250061
052600             END-IF                                               05260061
052700         WHEN PV-CTN-CHAR (PV-SUB) = '4'                          05270061
052800             IF PV-SUB < 4                                        05280061
052900                 MOVE '4'             TO PV-BARCODE-CHAR          05290061
053000                                         (PV-SUB)                 05300061
053100             ELSE                                                 05310061
053200                 MOVE '9'             TO PV-BARCODE-CHAR          05320061
053300                                         (PV-SUB)                 05330061
053400             END-IF                                               05340061
053500         WHEN PV-CTN-CHAR (PV-SUB) = SPACE                        05350061
053600             MOVE 'B'                 TO PV-BARCODE-CHAR          05360061
053700                                         (PV-SUB)                 05370061
053800         WHEN PV-CTN-CHAR (PV-SUB) NUMERIC                        05380061
053900             MOVE '9'                 TO PV-BARCODE-CHAR          05390061
054000                                         (PV-SUB)                 05400061
054100         WHEN OTHER                                               05410061
054200             MOVE 'X'                 TO PV-BARCODE-CHAR          05420061
054300                                         (PV-SUB)                 05430061
054400             MOVE PC-MUST-BE-NUM-MSG  TO AMSGLNO                  05440061
054500         END-EVALUATE                                             05450061
054600     END-PERFORM.                                                 05460061
054700                                                                  05470061
054800                                                                  05480061
054900     INITIALIZE DK-BRCDE-NBR                                      05490061
055000                PV-CTN-18                                         05500061
055100                PC233-CARTON                                      05510061
055200                PC233-BRCDE-NBR                                   05520061
055300                AMSGLNO                                           05530061
055400     MOVE DP015-UNP-ALP-NOR-MDT       TO ASMLA.                   05540061
055500                                                                  05550061
055600     IF PV-VALID-BARCODE                                          05560061
055700         EVALUATE TRUE                                            05570061
055800             WHEN PV-2-LEAD-ZEROES                                05580061
055900                 MOVE PV-CTN (3:18)   TO PV-CTN-18                05590061
056000                 MOVE PV-CTN          TO DK-BRCDE-NBR             05600061
056100             WHEN PV-LEAD-TRAIL-SPACES                            05610061
056200                 MOVE PV-CTN (2:18)   TO PV-CTN-18                05620061
056300                 MOVE ZEROES          TO DK-BRCDE-NBR (1:2)       05630061
056400                 MOVE PV-CTN (2:18)   TO DK-BRCDE-NBR (3:18)      05640061
056500             WHEN PV-2-LEAD-SPACES                                05650061
056600                 MOVE PV-CTN (3:18)   TO PV-CTN-18                05660061
056700                 MOVE ZEROES          TO DK-BRCDE-NBR (1:2)       05670061
056800                 MOVE PV-CTN (3:18)   TO DK-BRCDE-NBR (3:18)      05680061
056900             WHEN PV-TRAIL-SPACES                                 05690061
057000                 MOVE PV-CTN (1:18)   TO PV-CTN-18                05700061
057100                 MOVE ZEROES          TO DK-BRCDE-NBR (1:2)       05710061
057200                 MOVE PV-CTN (1:18)   TO DK-BRCDE-NBR (3:18)      05720061
057300             WHEN PV-ALL-SPACES                                   05730061
057400                 MOVE SPACES          TO DK-BRCDE-NBR             05740061
057500                 MOVE ZEROES          TO PC233-CARTON             05750061
057600         END-EVALUATE                                             05760061
057700                                                                  05770061
057800                                                                  05780061
057900         MOVE PV-CTN-N                TO PC233-CARTON             05790061
058000         MOVE DK-BRCDE-NBR            TO PC233-BRCDE-NBR          05800061
058100         MOVE PC233-CARTON            TO ASMLO                    05810061
058200                                                                  05820061
058300     ELSE                                                         05830061
058400         SET PS-INVALID-INPUT         TO TRUE                     05840061
058500         MOVE DP015-UNP-ALP-NOR-MDT   TO ASMLA                    05850061
058600         MOVE -1                      TO ASMLL                    05860061
058700                                                                  05870061
058800         MOVE PV-CTN                  TO ASMLO                    05880061
058900         MOVE 'INVALID CTN ID      '  TO AMSGLNO                  05890061
059000     END-IF.                                                      05900061
059100/                                                                 05910061
059200 2200-CHECK-TABLES.                                               05920061
059300                                                                  05930061
059400* SEE IF THIS CARTON IS IN THE CONVEYOR SYSTEM                    05940061
059500                                                                  05950061
059600     IF PC233-BRCDE-NBR > SPACES                                  05960061
059700         PERFORM 7000-SELECT-TSUCRDV                              05970061
059800     END-IF.                                                      05980061
059900                                                                  05990061
060000     PERFORM 7210-SELECT-TCNDCDR                                  06000061
060100*                                                                 06010061
060110* DMH - 4/6/06 - BEGIN                                            06011061
060120     IF PS-ERRORS-NO                                              06012061
060121        IF  CNDCDR-DOOR-TYP-CDE  =  'SH'                          06012161
060122            IF  SUCRDV-DEST-OPER-UNT-ID  =  PC233-STR-NBR         06012261
060123                CONTINUE                                          06012361
060124            ELSE                                                  06012461
060125                SET  PS-ERRORS-YES   TO TRUE                      06012561
060126                MOVE PC233-STR-NBR   TO PC233-ERROR-TRLR-STR-NBR  06012661
060127                MOVE SUCRDV-DEST-OPER-UNT-ID                      06012761
060128                                     TO PC233-ERROR-CTN-STR-NBR   06012861
060129                MOVE PC233-SERIAL-NBR                             06012961
060130                                     TO PC233-ERROR-SRL-NBR       06013061
060140                MOVE 15  TO PC233-PGM-MSG-NBR                     06014061
060150                PERFORM 8210-XCTL-ERROR-SCREEN                    06015061
060160            END-IF                                                06016061
060170        END-IF                                                    06017061
060180     END-IF.                                                      06018061
060190* DMH - 4/6/06 - END                                              06019061
060191*                                                                 06019161
060192     IF PS-ERRORS-NO                                              06019261
060193         IF PC233-OPEN-TRLR                                       06019361
060194             PERFORM 7310-GET-CURRENT-TMST                        06019461
060195             PERFORM 7300-ANY-OTHER-TRLRS-THIS-DOOR               06019561
060196             IF  PV-DB2-COUNT = ZERO                              06019661
060197                 CONTINUE                                         06019761
060198             ELSE                                                 06019861
060199                 IF PC233-CUTOFF-START-CTN                        06019961
060200                    IF  PV-CURRENT-TMST >                         06020061
060300                        PC-CUTOFF-TIMESTAMP                       06030061
060400                        PERFORM 2210-START-END-POINT-EDITS        06040061
060500                    ELSE                                          06050061
060600                        CONTINUE                                  06060061
060700                    END-IF                                        06070061
060800                 ELSE                                             06080061
060900                     PERFORM 2210-START-END-POINT-EDITS           06090061
061000                 END-IF                                           06100061
061100             END-IF                                               06110061
061200         ELSE                                                     06120061
061300             IF  PC233-CUTOFF-START-CTN                           06130061
061400                 PERFORM 7310-GET-CURRENT-TMST                    06140061
061500                 IF  PV-CURRENT-TMST >                            06150061
061600                     PC-CUTOFF-TIMESTAMP                          06160061
061700                     PERFORM 2210-START-END-POINT-EDITS           06170061
061800                 ELSE                                             06180061
061900                     CONTINUE                                     06190061
062000                 END-IF                                           06200061
062100             ELSE                                                 06210061
062200                 PERFORM 2210-START-END-POINT-EDITS               06220061
062300             END-IF                                               06230061
062400         END-IF                                                   06240061
062500     END-IF.                                                      06250061
062600                                                                  06260061
062700 2210-START-END-POINT-EDITS.                                      06270061
062800     IF PS-ERRORS-NO                                              06280061
062900         IF PS-CONVEYOR-CARTON-YES                                06290061
063000             IF PC233-CUTOFF-START-CTN                            06300061
063100                 PERFORM 3000-START-POINT-EDITS                   06310061
063200             ELSE                                                 06320061
063300                 PERFORM 3100-END-POINT-EDITS                     06330061
063400             END-IF                                               06340061
063500         ELSE                                                     06350061
063600             MOVE 'CARTON IS INACTIVE'                            06360061
063700                                      TO AMSGLNO                  06370061
063800             MOVE -1                  TO ASMLL                    06380061
063900             SET PS-ERRORS-YES        TO TRUE                     06390061
064000         END-IF                                                   06400061
064100     END-IF.                                                      06410061
064200                                                                  06420061
064300 3000-START-POINT-EDITS.                                          06430061
064400                                                                  06440061
064500     PERFORM 3010-GET-END-TMST-FOR-TRIP                           06450061
064600     IF SUCRDV-DIVERT-TMST  > PV-TRIP-END-TMST                    06460061
064700         CONTINUE                                                 06470061
064800     ELSE                                                         06480061
064900         SET PS-ERRORS-YES        TO TRUE                         06490061
065000         MOVE 36                  TO PC233-PGM-MSG-NBR            06500061
065100         SET PS-XCTL-E871         TO TRUE                         06510061
065200     END-IF                                                       06520061
065300                                                                  06530061
065400     IF PS-ERRORS-NO                                              06540061
065500         PERFORM 3020-COUNT-UNASSIGNED-CTNS                       06550061
065600     END-IF.                                                      06560061
065700                                                                  06570061
065800     IF PS-ERRORS-NO                                              06580061
065900         IF PV-DB2-COUNT > ZERO                                   06590061
066000             PERFORM 3025-GET-NEXT-DIVERT                         06600061
066100             SET PS-ERRORS-YES        TO TRUE                     06610061
066200             MOVE 34                  TO PC233-PGM-MSG-NBR        06620061
066300* DMH 1/30/13 BEGIN                                               06630061
066400             MOVE PV-DIVERT-DATE      TO PC233-ERROR-DIVERT-DATE  06640061
066500             MOVE PV-DIVERT-TIME      TO PC233-ERROR-DIVERT-TIME  06650061
066600             MOVE PV-SHIPT-UNT-ID     TO PV-SML                   06660061
066700             MOVE PV-SML              TO PC233-ERROR-DIVERT-SML   06670061
066800* DMH 1/30/13 END                                                 06680061
066900             SET PS-XCTL-E871         TO TRUE                     06690061
067000         END-IF                                                   06700061
067100     END-IF.                                                      06710061
067200                                                                  06720061
067300 3010-GET-END-TMST-FOR-TRIP.                                      06730061
067400     PERFORM 7200-SELECT-TSUCDOT.                                 06740061
067500                                                                  06750061
067600     IF PS-CUTOFFS-NO                                             06760061
067700         IF CNDCDR-DOOR-TYP-CDE = 'SH'                            06770061
067800             PERFORM 7220-ENDPT-PREV-TRIP                         06780061
067900         ELSE                                                     06790061
068000             PERFORM 7230-ENDPT-SHUTTLE-STORAGE                   06800061
068100         END-IF                                                   06810061
068200     END-IF.                                                      06820061
068300                                                                  06830061
068400 3020-COUNT-UNASSIGNED-CTNS.                                      06840061
068500     IF CNDCDR-DOOR-TYP-CDE = 'SH'                                06850061
068600         PERFORM 7240-COUNT-SHIP-CTNS                             06860061
068700     ELSE                                                         06870061
068800         PERFORM 7250-COUNT-SHTL-CTNS                             06880061
068900     END-IF.                                                      06890061
069000                                                                  06900061
069001*----------------------------------------------------------------*06900161
069002* DMH - 1/30/13                                                  *06900261
069003* GET THE SML THAT SHOULD HAVE BEEN SELECTED AS THE BEGIN DVRT   *06900361
069004*----------------------------------------------------------------*06900461
069005 3025-GET-NEXT-DIVERT.                                            06900561
069006     IF CNDCDR-DOOR-TYP-CDE = 'SH'                                06900661
069007         PERFORM 7245-SHIP-BEGIN-DIVERT                           06900761
069008     ELSE                                                         06900861
069009         PERFORM 7255-SHTL-BEGIN-DIVERT                           06900961
069010     END-IF.                                                      06901061
069020                                                                  06902061
069030                                                                  06903061
069040 3100-END-POINT-EDITS.                                            06904061
069050     PERFORM 7260-GET-LAST-START-TMST.                            06905061
069060     IF SUCRDV-DIVERT-TMST > SUCDOT-STRT-DIVERT-TMST              06906061
069070         CONTINUE                                                 06907061
069080     ELSE                                                         06908061
069090     IF SUCRDV-DIVERT-TMST = SUCDOT-STRT-DIVERT-TMST              06909061
069100         SET PS-ERRORS-YES            TO TRUE                     06910061
069200         MOVE 46                      TO PC233-PGM-MSG-NBR        06920061
069300         SET PS-XCTL-E871             TO TRUE                     06930061
069400     ELSE                                                         06940061
069500         SET PS-ERRORS-YES            TO TRUE                     06950061
069600         MOVE 35                      TO PC233-PGM-MSG-NBR        06960061
069700         SET PS-XCTL-E871             TO TRUE                     06970061
069800     END-IF                                                       06980061
069900     END-IF.                                                      06990061
070000/                                                                 07000061
070100 2300-FIND-PREV-CARTON.                                           07010061
070200*    PROBLEM:                                                     07020061
070300*    THE USER HAS SCANNED THE NEXT CARTON THAT IS SITTING ON THE  07030061
070400*    DIVERTER LINE WAITING TO GO ONTO A TRAILER.  BUT THEY HAVE   07040061
070500*    CLOSED THE TRAILER BEFORE MARKING THE LAST CARTON LOADED.    07050061
070600*    WE NEED TO KNOW WHAT CARTON THAT LAST CARTON WAS             07060061
070700*    IN ORDER TO MARK IT AS AN END-POINT FOR THE TRIP.            07070061
070800                                                                  07080061
070900*    FIRST FIND THE FIRST CARTON THAT WAS LOADED ON THE           07090061
071000*    LAST TRIP TO LEAVE FROM THIS DIVERTER.  WE WANT TO LIMIT     07100061
071100*    OUR SEARCH TO THE CONTENTS OF THE LAST TRAILER TO LEAVE      07110061
071200*    THE GATE.                                                    07120061
071300                                                                  07130061
071400     PERFORM 7040-SELECT-LAST-STRT-ON-DIVRT.                      07140061
071500                                                                  07150061
071600*    THEN THIS CURSOR WILL FIND THE NEXT CARTON JUST              07160061
071700*    AHEAD OF THE CARTON THAT WAS SCANNED.  WE WILL ONLY          07170061
071800*    FETCH ONE ROW.                                               07180061
071900                                                                  07190061
072000     PERFORM 7050-OPEN-CARTON-CSR.                                07200061
072100     PERFORM 7051-FETCH-CARTON-CSR.                               07210061
072200     PERFORM 7052-CLOSE-CARTON-CSR.                               07220061
072300     IF PS-END-CSR                                                07230061
072400         SET PS-ERRORS-YES            TO TRUE                     07240061
072500         MOVE DP015-UNP-ALP-NOR-MDT   TO ASMLA                    07250061
072600         MOVE -1                      TO ASMLL                    07260061
072700                                                                  07270061
072800         MOVE PV-CTN                  TO ASMLO                    07280061
072900         MOVE 'LAST CTN NOT FOUND  '  TO AMSGLNO                  07290061
073000     END-IF.                                                      07300061
073100/                                                                 07310061
073200 7000-SELECT-TSUCRDV.                                             07320061
073300                                                                  07330061
073400     EXEC SQL                                                     07340061
073500         SELECT                                                   07350061
073600             CRDV.DIVERT_NBR                                      07360061
073700         ,   CRDV.DIVERT_LOC_ID                                   07370061
073800         ,   CRDV.DIVERT_TMST                                     07380061
073900         ,   CRDV.DEST_OPER_UNT_ID                                07390061
074000         INTO                                                     07400061
074100           :SUCRDV-DIVERT-NBR                                     07410061
074200         , :SUCRDV-DIVERT-LOC-ID                                  07420061
074300         , :SUCRDV-DIVERT-TMST                                    07430061
074400         , :SUCRDV-DEST-OPER-UNT-ID                               07440061
074500         FROM                                                     07450061
074600            TSUCRDV CRDV                                          07460061
074700         WHERE CRDV.BRCDE_NBR        = :PC233-BRCDE-NBR           07470061
074800           AND CRDV.OPER_UNT_ID      = :PC233-OPER-UNT-ID         07480061
074900           AND CRDV.ACTV_CDE         = 'A'                        07490061
075000           AND                                                    07500061
075100           CRDV.DIVERT_TMST =                                     07510061
075200           (SELECT MAX(CRDV1.DIVERT_TMST)                         07520061
075300               FROM TSUCRDV CRDV1                                 07530061
075400                                                                  07540061
075500         WHERE CRDV1.BRCDE_NBR        = :PC233-BRCDE-NBR          07550061
075600           AND CRDV1.OPER_UNT_ID      = :PC233-OPER-UNT-ID        07560061
075700           AND CRDV1.ACTV_CDE         = 'A'                       07570061
075800                )                                                 07580061
075900     END-EXEC.                                                    07590061
076000                                                                  07600061
076100     EVALUATE TRUE                                                07610061
076200         WHEN SQLCODE = ZERO                                      07620061
076300             SET PS-CONVEYOR-CARTON-YES                           07630061
076400                                      TO TRUE                     07640061
076500             MOVE SUCRDV-DIVERT-NBR   TO PC233-DIVERT-NBR         07650061
076600             MOVE SUCRDV-DIVERT-LOC-ID                            07660061
076700                                      TO PC233-DIVERT-LOC-ID      07670061
076800         WHEN SQLCODE = +100                                      07680061
076900             SET PS-CONVEYOR-CARTON-NO                            07690061
077000                                      TO TRUE                     07700061
077100         WHEN SQLCODE = -904                                      07710061
077200         WHEN SQLCODE = -913                                      07720061
077300         WHEN SQLCODE = -911                                      07730061
077400             MOVE 1                   TO PV-ERROR-NBR             07740061
077500             PERFORM 9903-WRITE-CICS-LOG                          07750061
077600             PERFORM 9000-SOFT-ABORT                              07760061
077700         WHEN SQLWARN0 NOT = SPACES                               07770061
077800         WHEN SQLCODE NOT EQUAL ZERO                              07780061
077900             MOVE 2                   TO PV-ERROR-NBR             07790061
078000                                         PC233-ERROR-NBR          07800061
078100             PERFORM 9903-WRITE-CICS-LOG                          07810061
078200             MOVE '7000-SELECT-TSUCRDV'                           07820061
078300                                      TO PC233-PARAGRAPH          07830061
078400             MOVE 'PCKRF874 - CHECK TRAILER EXISTENCE'            07840061
078500                                      TO PC233-MESSAGE-TEXT(1)    07850061
078600             MOVE SQLCA               TO PC233-SQLCA              07860061
078700             MOVE 'TSUCRDV'           TO PC233-DB2-TABLE-NAME(1)  07870061
078800             SET PC233-ABEND          TO TRUE                     07880061
078900             MOVE 99                  TO PC233-PGM-MSG-NBR        07890061
079000             PERFORM 8210-XCTL-ERROR-SCREEN                       07900061
079100     END-EVALUATE.                                                07910061
079200/                                                                 07920061
079300 7040-SELECT-LAST-STRT-ON-DIVRT.                                  07930061
079400                                                                  07940061
079500     EXEC SQL                                                     07950061
079600         SELECT                                                   07960061
079700             MAX(DOT.STRT_DIVERT_TMST)                            07970061
079800         INTO                                                     07980061
079900           :DK-LAST-STRT-TMST                                     07990061
080000         FROM                                                     08000061
080100            TSUCDOT DOT                                           08010061
080200         ,  TCNDCDR DR                                            08020061
080300         WHERE                                                    08030061
080400             DOT.OPER_UNT_ID  = DR.OPER_UNT_ID                    08040061
080500         AND                                                      08050061
080600             DOT.DOOR_ID      = DR.DOOR_ID                        08060061
080700         AND                                                      08070061
080800             DR.OPER_UNT_ID   = :PC233-OPER-UNT-ID                08080061
080900         AND                                                      08090061
081000             DR.DIVERT_NBR    = :PC233-DIVERT-NBR                 08100061
081100         AND                                                      08110061
081200             DR.DIVERT_LOC_ID = :PC233-DIVERT-LOC-ID              08120061
081300     END-EXEC.                                                    08130061
081400                                                                  08140061
081500     EVALUATE TRUE                                                08150061
081600         WHEN SQLCODE = ZERO                                      08160061
081700             SET PS-CUTOFFS-YES       TO TRUE                     08170061
081800         WHEN SQLCODE = +100                                      08180061
081900         WHEN SQLCODE = -305                                      08190061
082000             SET PS-CUTOFFS-NO        TO TRUE                     08200061
082100         WHEN SQLCODE = -904                                      08210061
082200         WHEN SQLCODE = -913                                      08220061
082300         WHEN SQLCODE = -911                                      08230061
082400             MOVE 30                  TO PV-ERROR-NBR             08240061
082500             PERFORM 9903-WRITE-CICS-LOG                          08250061
082600             PERFORM 9000-SOFT-ABORT                              08260061
082700         WHEN SQLWARN0 NOT = SPACES                               08270061
082800         WHEN SQLCODE NOT EQUAL ZERO                              08280061
082900             MOVE 31                  TO PV-ERROR-NBR             08290061
083000                                         PC233-ERROR-NBR          08300061
083100             PERFORM 9903-WRITE-CICS-LOG                          08310061
083200             MOVE '7040-SELECT-LAST-STRT-ON-DIVRT'                08320061
083300                                      TO PC233-PARAGRAPH          08330061
083400             MOVE 'PCKRF874 - FIND LAST START POINT '             08340061
083500                                      TO PC233-MESSAGE-TEXT(1)    08350061
083600             MOVE SQLCA               TO PC233-SQLCA              08360061
083700             MOVE 'TCNDCDR'           TO PC233-DB2-TABLE-NAME(1)  08370061
083800             MOVE 'TSUCDOT'           TO PC233-DB2-TABLE-NAME(2)  08380061
083900             SET PC233-ABEND          TO TRUE                     08390061
084000             MOVE 99                  TO PC233-PGM-MSG-NBR        08400061
084100             PERFORM 8210-XCTL-ERROR-SCREEN                       08410061
084200     END-EVALUATE.                                                08420061
084300                                                                  08430061
084400 7050-OPEN-CARTON-CSR.                                            08440061
084500                                                                  08450061
084600     EXEC SQL                                                     08460061
084700         OPEN CARTON-CSR                                          08470061
084800     END-EXEC                                                     08480061
084900                                                                  08490061
085000     EVALUATE TRUE                                                08500061
085100         WHEN SQLCODE = ZERO                                      08510061
085200             SET PS-START-CSR         TO TRUE                     08520061
085300         WHEN SQLCODE = -904                                      08530061
085400         WHEN SQLCODE = -913                                      08540061
085500         WHEN SQLCODE = -911                                      08550061
085600             MOVE 3                   TO PV-ERROR-NBR             08560061
085700             PERFORM 9903-WRITE-CICS-LOG                          08570061
085800             PERFORM 9000-SOFT-ABORT                              08580061
085900         WHEN SQLWARN0 NOT = SPACES                               08590061
086000         WHEN SQLCODE NOT EQUAL ZERO                              08600061
086100             MOVE 4                   TO PV-ERROR-NBR             08610061
086200                                         PC233-ERROR-NBR          08620061
086300             PERFORM 9903-WRITE-CICS-LOG                          08630061
086400             MOVE '7050-OPEN-CARTON-CSR'                          08640061
086500                                      TO PC233-PARAGRAPH          08650061
086600             MOVE 'PCKRF874 - OPEN CURSOR'                        08660061
086700                                      TO PC233-MESSAGE-TEXT(1)    08670061
086800             MOVE SQLCA               TO PC233-SQLCA              08680061
086900             MOVE 'TCNCRDV'           TO PC233-DB2-TABLE-NAME(1)  08690061
087000             SET PC233-ABEND          TO TRUE                     08700061
087100             MOVE 99                  TO PC233-PGM-MSG-NBR        08710061
087200             PERFORM 8210-XCTL-ERROR-SCREEN                       08720061
087300     END-EVALUATE.                                                08730061
087400                                                                  08740061
087500 7051-FETCH-CARTON-CSR.                                           08750061
087600                                                                  08760061
087700     EXEC SQL                                                     08770061
087800         FETCH CARTON-CSR                                         08780061
087900         INTO                                                     08790061
088000               :SUCRDV-DIVERT-TMST                                08800061
088100         ,     :SUCRDV-SHIPT-UNT-ID                               08810061
088200         ,     :SUCRDV-BRCDE-NBR                                  08820061
088300     END-EXEC                                                     08830061
088400                                                                  08840061
088500     EVALUATE TRUE                                                08850061
088600         WHEN SQLCODE = ZERO                                      08860061
088700             MOVE SUCRDV-SHIPT-UNT-ID TO PC233-CARTON             08870061
088800         WHEN SQLCODE = +100                                      08880061
088900             SET PS-END-CSR           TO TRUE                     08890061
089000         WHEN SQLCODE = -904                                      08900061
089100         WHEN SQLCODE = -913                                      08910061
089200         WHEN SQLCODE = -911                                      08920061
089300             MOVE 5                   TO PV-ERROR-NBR             08930061
089400             PERFORM 9903-WRITE-CICS-LOG                          08940061
089500             PERFORM 9000-SOFT-ABORT                              08950061
089600         WHEN SQLWARN0 NOT = SPACES                               08960061
089700         WHEN SQLCODE NOT EQUAL ZERO                              08970061
089800             MOVE 6                   TO PV-ERROR-NBR             08980061
089900                                         PC233-ERROR-NBR          08990061
090000             PERFORM 9903-WRITE-CICS-LOG                          09000061
090100             MOVE '7050-OPEN-CARTON-CSR'                          09010061
090200                                      TO PC233-PARAGRAPH          09020061
090300             MOVE 'PCKRF874 - OPEN CURSOR'                        09030061
090400                                      TO PC233-MESSAGE-TEXT(1)    09040061
090500             MOVE SQLCA               TO PC233-SQLCA              09050061
090600             MOVE 'TCNCRDV'           TO PC233-DB2-TABLE-NAME(1)  09060061
090700             SET PC233-ABEND          TO TRUE                     09070061
090800             MOVE 99                  TO PC233-PGM-MSG-NBR        09080061
090900             PERFORM 8210-XCTL-ERROR-SCREEN                       09090061
091000     END-EVALUATE.                                                09100061
091100                                                                  09110061
091200 7052-CLOSE-CARTON-CSR.                                           09120061
091300                                                                  09130061
091400     EXEC SQL                                                     09140061
091500         CLOSE CARTON-CSR                                         09150061
091600     END-EXEC                                                     09160061
091700                                                                  09170061
091800     EVALUATE TRUE                                                09180061
091900         WHEN SQLCODE = ZERO                                      09190061
092000             CONTINUE                                             09200061
092100         WHEN SQLCODE = -904                                      09210061
092200         WHEN SQLCODE = -913                                      09220061
092300         WHEN SQLCODE = -911                                      09230061
092400             MOVE 7                   TO PV-ERROR-NBR             09240061
092500             PERFORM 9903-WRITE-CICS-LOG                          09250061
092600             PERFORM 9000-SOFT-ABORT                              09260061
092700         WHEN SQLWARN0 NOT = SPACES                               09270061
092800         WHEN SQLCODE NOT EQUAL ZERO                              09280061
092900             MOVE 8                   TO PV-ERROR-NBR             09290061
093000                                         PC233-ERROR-NBR          09300061
093100             PERFORM 9903-WRITE-CICS-LOG                          09310061
093200             MOVE '7052-CLOSE-CARTON-CSR'                         09320061
093300                                      TO PC233-PARAGRAPH          09330061
093400             MOVE 'PCKRF874 - CLOSE CURSOR'                       09340061
093500                                      TO PC233-MESSAGE-TEXT(1)    09350061
093600             MOVE SQLCA               TO PC233-SQLCA              09360061
093700             MOVE 'TCNCRDV'           TO PC233-DB2-TABLE-NAME(1)  09370061
093800             SET PC233-ABEND          TO TRUE                     09380061
093900             MOVE 99                  TO PC233-PGM-MSG-NBR        09390061
094000             PERFORM 8210-XCTL-ERROR-SCREEN                       09400061
094100     END-EVALUATE.                                                09410061
094200/                                                                 09420061
094300 7100-INSERT-TSUCDOT.                                             09430061
094400                                                                  09440061
094500     MOVE SPACES                      TO SUCDOT-END-SCN-USR-ID    09450061
094600     EXEC SQL                                                     09460061
094700         INSERT INTO TSUCDOT                                      09470061
094800                                                                  09480061
094900           (                                                      09490061
095000             OTBND_TRIP_ID                                        09500061
095100         ,   OPER_UNT_ID                                          09510061
095200         ,   DOOR_ID                                              09520061
095300         ,   STRT_DIVERT_TMST                                     09530061
095400         ,   END_DIVERT_TMST                                      09540061
095500         ,   STRT_SCN_TMST                                        09550061
095600         ,   STRT_SCN_USR_ID                                      09560061
095700         ,   END_SCN_TMST                                         09570061
095800         ,   END_SCN_USR_ID                                       09580061
095900           )                                                      09590061
096000                                                                  09600061
096100       VALUES                                                     09610061
096200                                                                  09620061
096300           (                                                      09630061
096400             :PC233-TRIP-ID                                       09640061
096500         ,   :PC233-OPER-UNT-ID                                   09650061
096600         ,   :PC233-DOOR-ID                                       09660061
096700         ,   :SUCDOT-STRT-DIVERT-TMST                             09670061
096800         ,   :PC-DUMMY-TIMESTAMP                                  09680061
096900         ,   CURRENT TIMESTAMP                                    09690061
097000         ,   :PC233-USER-ID                                       09700061
097100         ,   :PC-DUMMY-TIMESTAMP                                  09710061
097200         ,   :SUCDOT-END-SCN-USR-ID                               09720061
097300         )                                                        09730061
097400                                                                  09740061
097500     END-EXEC.                                                    09750061
097600                                                                  09760061
097700     EVALUATE TRUE                                                09770061
097800         WHEN SQLCODE = ZERO                                      09780061
097900             CONTINUE                                             09790061
098000         WHEN SQLCODE = -904                                      09800061
098100         WHEN SQLCODE = -913                                      09810061
098200         WHEN SQLCODE = -911                                      09820061
098300             MOVE 9                   TO PV-ERROR-NBR             09830061
098400             PERFORM 9903-WRITE-CICS-LOG                          09840061
098500             PERFORM 9000-SOFT-ABORT                              09850061
098600         WHEN SQLWARN0 NOT = SPACES                               09860061
098700         WHEN SQLCODE NOT EQUAL ZERO                              09870061
098800             MOVE 10                  TO PV-ERROR-NBR             09880061
098900                                         PC233-ERROR-NBR          09890061
099000             PERFORM 9903-WRITE-CICS-LOG                          09900061
099100             MOVE SUCDOT-STRT-DIVERT-TMST TO PV-TIMESTAMP         09910061
099200             MOVE PC233-BRCDE-NBR  TO PV-BARCODE                  09920061
099300             PERFORM 9902-WRITE-CICS-LOG                          09930061
099400             MOVE '7100-INSERT-TSUCDOT'                           09940061
099500                                      TO PC233-PARAGRAPH          09950061
099600             MOVE 'PCKRF874 - CREATE START CUTOFF POINT'          09960061
099700                                      TO PC233-MESSAGE-TEXT(1)    09970061
099800             MOVE SQLCA               TO PC233-SQLCA              09980061
099900             MOVE 'TSUCDOT'           TO PC233-DB2-TABLE-NAME(1)  09990061
100000             SET PC233-ABEND          TO TRUE                     10000061
100100             MOVE 99                  TO PC233-PGM-MSG-NBR        10010061
100200             PERFORM 8210-XCTL-ERROR-SCREEN                       10020061
100300     END-EVALUATE.                                                10030061
100400                                                                  10040061
100500 7150-UPDATE-TSUCDOT.                                             10050061
100600                                                                  10060061
100700     EXEC SQL                                                     10070061
100800         UPDATE TSUCDOT A                                         10080061
100900         SET                                                      10090061
101000             END_DIVERT_TMST = :SUCDOT-END-DIVERT-TMST            10100061
101100         ,   END_SCN_TMST    = CURRENT TIMESTAMP                  10110061
101200         ,   END_SCN_USR_ID  = :PC233-USER-ID                     10120061
101300         WHERE A.OTBND_TRIP_ID = :PC233-TRIP-ID                   10130061
101400         AND   A.OPER_UNT_ID   = :PC233-OPER-UNT-ID               10140061
101500         AND   A.DOOR_ID       = :PC233-DOOR-ID                   10150061
101600         AND   A.STRT_DIVERT_TMST =                               10160061
101700         (SELECT                                                  10170061
101800             MAX(B.STRT_DIVERT_TMST)                              10180061
101900             FROM TSUCDOT B                                       10190061
102000             WHERE B.OTBND_TRIP_ID = :PC233-TRIP-ID               10200061
102100             AND   B.OPER_UNT_ID   = :PC233-OPER-UNT-ID           10210061
102200             AND   B.DOOR_ID       = :PC233-DOOR-ID               10220061
102300         )                                                        10230061
102400                                                                  10240061
102500     END-EXEC                                                     10250061
102600                                                                  10260061
102700     EVALUATE TRUE                                                10270061
102800         WHEN SQLCODE = ZERO                                      10280061
102900             CONTINUE                                             10290061
103000         WHEN SQLCODE = -904                                      10300061
103100         WHEN SQLCODE = -913                                      10310061
103200         WHEN SQLCODE = -911                                      10320061
103300             MOVE 11                  TO PV-ERROR-NBR             10330061
103400             PERFORM 9903-WRITE-CICS-LOG                          10340061
103500             PERFORM 9000-SOFT-ABORT                              10350061
103600         WHEN SQLWARN0 NOT = SPACES                               10360061
103700         WHEN SQLCODE NOT EQUAL ZERO                              10370061
103800             MOVE 12                  TO PV-ERROR-NBR             10380061
103900                                         PC233-ERROR-NBR          10390061
104000             PERFORM 9903-WRITE-CICS-LOG                          10400061
104100             MOVE SUCDOT-END-DIVERT-TMST  TO PV-TIMESTAMP         10410061
104200             MOVE PC233-BRCDE-NBR  TO PV-BARCODE                  10420061
104300             PERFORM 9902-WRITE-CICS-LOG                          10430061
104400             MOVE '7150-UPDATE-TSUCDOT'                           10440061
104500                                      TO PC233-PARAGRAPH          10450061
104600             MOVE 'PCKRF874 - CREATE END CUTOFF POINT'            10460061
104700                                      TO PC233-MESSAGE-TEXT(1)    10470061
104800             MOVE SQLCA               TO PC233-SQLCA              10480061
104900             MOVE 'TSUCDOT'           TO PC233-DB2-TABLE-NAME(1)  10490061
105000             SET PC233-ABEND          TO TRUE                     10500061
105100             MOVE 99                  TO PC233-PGM-MSG-NBR        10510061
105200             PERFORM 8210-XCTL-ERROR-SCREEN                       10520061
105300     END-EVALUATE.                                                10530061
105400                                                                  10540061
105500 7200-SELECT-TSUCDOT.                                             10550061
105600                                                                  10560061
105700     EXEC SQL                                                     10570061
105800         SELECT                                                   10580061
105900             MAX(DOT.END_DIVERT_TMST)                             10590061
106000         INTO                                                     10600061
106100           :PV-TRIP-END-TMST                                      10610061
106200         FROM                                                     10620061
106300            TSUCDOT DOT                                           10630061
106400*        WHERE DOT.OTBND_TRIP_ID     = :PC233-TRIP-ID             10640061
106500         WHERE DOT.OPER_UNT_ID       = :PC233-OPER-UNT-ID         10650061
106600           AND DOT.DOOR_ID           = :PC233-DOOR-ID             10660061
106700           AND DOT.END_DIVERT_TMST  <> :PC-DUMMY-TIMESTAMP        10670061
106800     END-EXEC.                                                    10680061
106900                                                                  10690061
107000     EVALUATE TRUE                                                10700061
107100         WHEN SQLCODE = ZERO                                      10710061
107200             SET PS-CUTOFFS-YES       TO TRUE                     10720061
107300         WHEN SQLCODE = +100                                      10730061
107400         WHEN SQLCODE = -305                                      10740061
107500             SET PS-CUTOFFS-NO        TO TRUE                     10750061
107600         WHEN SQLCODE = -904                                      10760061
107700         WHEN SQLCODE = -913                                      10770061
107800         WHEN SQLCODE = -911                                      10780061
107900             MOVE 13                  TO PV-ERROR-NBR             10790061
108000             PERFORM 9903-WRITE-CICS-LOG                          10800061
108100             PERFORM 9000-SOFT-ABORT                              10810061
108200         WHEN SQLWARN0 NOT = SPACES                               10820061
108300         WHEN SQLCODE NOT EQUAL ZERO                              10830061
108400             MOVE 14                  TO PV-ERROR-NBR             10840061
108500                                         PC233-ERROR-NBR          10850061
108600             PERFORM 9903-WRITE-CICS-LOG                          10860061
108700             MOVE '7200-SELECT-TSUCDOT'                           10870061
108800                                      TO PC233-PARAGRAPH          10880061
108900             MOVE 'PCKRF874 - CHECK DIVERT END-POINT '            10890061
109000                                      TO PC233-MESSAGE-TEXT(1)    10900061
109100             MOVE SQLCA               TO PC233-SQLCA              10910061
109200             MOVE 'TSUCDOT'           TO PC233-DB2-TABLE-NAME(1)  10920061
109300             SET PC233-ABEND          TO TRUE                     10930061
109400             MOVE 99                  TO PC233-PGM-MSG-NBR        10940061
109500             PERFORM 8210-XCTL-ERROR-SCREEN                       10950061
109600     END-EVALUATE.                                                10960061
109700                                                                  10970061
109800 7210-SELECT-TCNDCDR.                                             10980061
109900                                                                  10990061
110000     EXEC SQL                                                     11000061
110100         SELECT                                                   11010061
110200             DCDR.DOOR_TYP_CDE                                    11020061
110300          ,  DCDR.DIVERT_LOC_ID                                   11030061
110400         INTO                                                     11040061
110500             :CNDCDR-DOOR-TYP-CDE                                 11050061
110600          ,  :CNDCDR-DIVERT-LOC-ID                                11060061
110700         FROM TCNDCDR DCDR                                        11070061
110800         WHERE                                                    11080061
110900             DCDR.OPER_UNT_ID               = :PC233-OPER-UNT-ID  11090061
111000             AND DCDR.DOOR_ID               = :PC233-DOOR-ID      11100061
111100     END-EXEC.                                                    11110061
111200                                                                  11120061
111300     EVALUATE TRUE                                                11130061
111400         WHEN SQLCODE = ZERO                                      11140061
111500             CONTINUE                                             11150061
111600         WHEN SQLCODE = -904                                      11160061
111700         WHEN SQLCODE = -913                                      11170061
111800         WHEN SQLCODE = -911                                      11180061
111900             MOVE 15                  TO PV-ERROR-NBR             11190061
112000             PERFORM 9903-WRITE-CICS-LOG                          11200061
112100             PERFORM 9000-SOFT-ABORT                              11210061
112200         WHEN SQLWARN0 NOT = SPACES                               11220061
112300         WHEN SQLCODE NOT EQUAL ZERO                              11230061
112400             MOVE 16                  TO PV-ERROR-NBR             11240061
112500                                         PC233-ERROR-NBR          11250061
112600             PERFORM 9903-WRITE-CICS-LOG                          11260061
112700             MOVE '7210-SELECT-TCNDCDR'                           11270061
112800                                      TO PC233-PARAGRAPH          11280061
112900             MOVE 'PCKRF874 - GET DOOR TYPE '                     11290061
113000                                      TO PC233-MESSAGE-TEXT(1)    11300061
113100             MOVE SQLCA               TO PC233-SQLCA              11310061
113200             MOVE 'TCNDCDR'           TO PC233-DB2-TABLE-NAME(1)  11320061
113300             MOVE 'TCNDRST'           TO PC233-DB2-TABLE-NAME(2)  11330061
113400             SET PC233-ABEND          TO TRUE                     11340061
113500             MOVE 99                  TO PC233-PGM-MSG-NBR        11350061
113600             PERFORM 8210-XCTL-ERROR-SCREEN                       11360061
113700     END-EVALUATE.                                                11370061
113800                                                                  11380061
113900                                                                  11390061
114000 7220-ENDPT-PREV-TRIP.                                            11400061
114100                                                                  11410061
114200     EXEC SQL                                                     11420061
114300         SELECT                                                   11430061
114400             MAX(DOT.END_DIVERT_TMST)                             11440061
114500         INTO                                                     11450061
114600           :PV-TRIP-END-TMST                                      11460061
114700         FROM                                                     11470061
114800            TSUCDOT DOT                                           11480061
114900         ,  TSUOBTR OBTR                                          11490061
115000         WHERE DOT.OPER_UNT_ID       = :PC233-OPER-UNT-ID         11500061
115100           AND DOT.DOOR_ID           = :PC233-DOOR-ID             11510061
115200           AND DOT.OTBND_TRIP_ID     = OBTR.OTBND_TRIP_ID         11520061
115300           AND OBTR.DEST_OPER_UNT_ID = :PC233-STR-NBR             11530061
115400           AND DOT.END_DIVERT_TMST  <> :PC-DUMMY-TIMESTAMP        11540061
115500     END-EXEC.                                                    11550061
115600                                                                  11560061
115700     EVALUATE TRUE                                                11570061
115800         WHEN SQLCODE = ZERO                                      11580061
115900             CONTINUE                                             11590061
116000         WHEN SQLCODE = -305                                      11600061
116100         WHEN SQLCODE = +100                                      11610061
116200             MOVE PC-LOW-TIMESTAMP    TO PV-TRIP-END-TMST         11620061
116300         WHEN SQLCODE = -904                                      11630061
116400         WHEN SQLCODE = -913                                      11640061
116500         WHEN SQLCODE = -911                                      11650061
116600             MOVE 17                  TO PV-ERROR-NBR             11660061
116700             PERFORM 9903-WRITE-CICS-LOG                          11670061
116800             PERFORM 9000-SOFT-ABORT                              11680061
116900         WHEN SQLWARN0 NOT = SPACES                               11690061
117000         WHEN SQLCODE NOT EQUAL ZERO                              11700061
117100             MOVE 18                  TO PV-ERROR-NBR             11710061
117200                                         PC233-ERROR-NBR          11720061
117300             PERFORM 9903-WRITE-CICS-LOG                          11730061
117400             MOVE '7220-ENDPT-PREV-TRIP'                          11740061
117500                                      TO PC233-PARAGRAPH          11750061
117600             MOVE 'PCKRF874 - FIND EN POINT OF PREV TRIP'         11760061
117700                                      TO PC233-MESSAGE-TEXT(1)    11770061
117800             MOVE SQLCA               TO PC233-SQLCA              11780061
117900             MOVE 'TCNDCDR'           TO PC233-DB2-TABLE-NAME(1)  11790061
118000             MOVE 'TCNDRST'           TO PC233-DB2-TABLE-NAME(2)  11800061
118100             SET PC233-ABEND          TO TRUE                     11810061
118200             MOVE 99                  TO PC233-PGM-MSG-NBR        11820061
118300             PERFORM 8210-XCTL-ERROR-SCREEN                       11830061
118400     END-EVALUATE.                                                11840061
118500                                                                  11850061
118600 7230-ENDPT-SHUTTLE-STORAGE.                                      11860061
118700                                                                  11870061
118800     EXEC SQL                                                     11880061
118900         SELECT                                                   11890061
119000             MAX(DOT.END_DIVERT_TMST)                             11900061
119100         INTO                                                     11910061
119200           :PV-TRIP-END-TMST                                      11920061
119300         FROM                                                     11930061
119400            TSUCDOT DOT                                           11940061
119500         WHERE DOT.OPER_UNT_ID       = :PC233-OPER-UNT-ID         11950061
119600           AND DOT.DOOR_ID           = :PC233-DOOR-ID             11960061
119700           AND DOT.END_DIVERT_TMST  <> :PC-DUMMY-TIMESTAMP        11970061
119800     END-EXEC.                                                    11980061
119900                                                                  11990061
120000     EVALUATE TRUE                                                12000061
120100         WHEN SQLCODE = ZERO                                      12010061
120200             CONTINUE                                             12020061
120300         WHEN SQLCODE = +100                                      12030061
120400         WHEN SQLCODE = -305                                      12040061
120500             MOVE PC-LOW-TIMESTAMP    TO PV-TRIP-END-TMST         12050061
120600         WHEN SQLCODE = -904                                      12060061
120700         WHEN SQLCODE = -913                                      12070061
120800         WHEN SQLCODE = -911                                      12080061
120900             MOVE 17                  TO PV-ERROR-NBR             12090061
121000             PERFORM 9903-WRITE-CICS-LOG                          12100061
121100             PERFORM 9000-SOFT-ABORT                              12110061
121200         WHEN SQLWARN0 NOT = SPACES                               12120061
121300         WHEN SQLCODE NOT EQUAL ZERO                              12130061
121400             MOVE 18                  TO PV-ERROR-NBR             12140061
121500                                         PC233-ERROR-NBR          12150061
121600             PERFORM 9903-WRITE-CICS-LOG                          12160061
121700             MOVE '7230-ENDPT-SHUTTLE-STORAGE'                    12170061
121800                                      TO PC233-PARAGRAPH          12180061
121900             MOVE 'PCKRF874 - FIND END POINT SHUTTLE STORAGE'     12190061
122000                                      TO PC233-MESSAGE-TEXT(1)    12200061
122100             MOVE SQLCA               TO PC233-SQLCA              12210061
122200             MOVE 'TSUCDOT'           TO PC233-DB2-TABLE-NAME(1)  12220061
122300             SET PC233-ABEND          TO TRUE                     12230061
122400             MOVE 99                  TO PC233-PGM-MSG-NBR        12240061
122500             PERFORM 8210-XCTL-ERROR-SCREEN                       12250061
122600     END-EVALUATE.                                                12260061
122700                                                                  12270061
122800 7240-COUNT-SHIP-CTNS.                                            12280061
122900                                                                  12290061
123000     MOVE ZEROES                      TO PV-DB2-COUNT             12300061
123100     EXEC SQL                                                     12310061
123200         SELECT                                                   12320061
123300             COUNT(*)                                             12330061
123400         INTO                                                     12340061
123500           :PV-DB2-COUNT                                          12350061
123600         FROM                                                     12360061
123700            TSUCRDV RDV                                           12370061
123800         WHERE RDV.OPER_UNT_ID       = :PC233-OPER-UNT-ID         12380061
123900           AND RDV.DIVERT_NBR        = :PC233-DIVERT-NBR          12390061
124000           AND RDV.DIVERT_LOC_ID     = :PC233-DIVERT-LOC-ID       12400061
124100           AND RDV.DIVERT_TMST       < :SUCRDV-DIVERT-TMST        12410061
124200           AND RDV.DIVERT_TMST       > :PV-TRIP-END-TMST          12420061
124300           AND RDV.DEST_OPER_UNT_ID  = :PC233-STR-NBR             12430061
124400           AND RDV.BRCDE_NBR        <> :PC233-BRCDE-NBR           12440061
124500           AND RDV.ACTV_CDE          = 'A'                        12450061
124600           AND RDV.DIVERT_TMST =                                  12460061
124700           (SELECT MAX(RDV1.DIVERT_TMST)                          12470061
124800               FROM TSUCRDV RDV1                                  12480061
124900             WHERE RDV1.BRCDE_NBR         =  RDV.BRCDE_NBR        12490061
125000               AND RDV1.ACTV_CDE          = 'A')                  12500061
125100     END-EXEC.                                                    12510061
125200                                                                  12520061
125300     EVALUATE TRUE                                                12530061
125400         WHEN SQLCODE = ZERO                                      12540061
125500         WHEN SQLCODE = +100                                      12550061
125600         WHEN SQLCODE = -305                                      12560061
125700***                                                               12570061
125800*** ADD DISPLAY OF CARTON COUNT INFO IF CARTONS HAVE BEEN         12580061
125900*** MISSED                                                        12590061
126000*** DMH - 3/16/12 - BEGIN                                         12600061
126100***                                                               12610061
126200              IF  PV-DB2-COUNT  > 0                               12620061
126300                  MOVE PV-DB2-COUNT        TO PV-DISP-DVRT-CNT    12630061
126310                  MOVE PC233-OPER-UNT-ID   TO PV-DISP-OPER        12631061
126311                  MOVE PC233-DIVERT-NBR    TO PV-DISP-DVRT-NBR    12631161
126312                  MOVE PC233-DIVERT-LOC-ID TO PV-DISP-DVRT-LOC    12631261
126313                  MOVE PC233-STR-NBR       TO PV-DISP-STR-NBR     12631361
126314                  MOVE PC233-BRCDE-NBR     TO PV-DISP-BRCDE-NBR   12631461
126315                  MOVE SQLCODE             TO PV-DISP-SQLCODE     12631561
126316                                                                  12631661
126317                  MOVE SPACES TO PV-LOG-MSG-3                     12631761
126318                  PERFORM 9905-WRITE-CICS-LOG                     12631861
126319                                                                  12631961
126320                  STRING ' PCKRF874-7240-'                        12632061
126321                         '  DVRT CNT:'     PV-DISP-DVRT-CNT       12632161
126322                         '  OPER:'         PV-DISP-OPER           12632261
126323                         '  DVRT NBR:'     PV-DISP-DVRT-NBR       12632361
126324                         '  DVRT LOC:'     PV-DISP-DVRT-LOC       12632461
126325                         '  STORE:'        PV-DISP-STR-NBR        12632561
126326                         '  SQL:'          PV-DISP-SQLCODE        12632661
126327                                           DELIMITED BY SIZE      12632761
126328                                     INTO  PV-LOG-MSG-3           12632861
126329                  PERFORM 9905-WRITE-CICS-LOG                     12632961
126330                  MOVE SPACES TO PV-LOG-MSG-3                     12633061
126340                                                                  12634061
126341                  STRING ' PCKRF874-7240-'                        12634161
126342                         '  DVRT TMST:'    SUCRDV-DIVERT-TMST     12634261
126343                         '  END TMST:'     PV-TRIP-END-TMST       12634361
126344                                           DELIMITED BY SIZE      12634461
126345                                     INTO  PV-LOG-MSG-3           12634561
126346                  PERFORM 9905-WRITE-CICS-LOG                     12634661
126347                                                                  12634761
126348                  MOVE SPACES TO PV-LOG-MSG-3                     12634861
126349                  STRING ' PCKRF874-7240-'                        12634961
126350                         '  BRCDE NBR:'    PV-DISP-BRCDE-NBR      12635061
126351                                           DELIMITED BY SIZE      12635161
126352                                     INTO  PV-LOG-MSG-3           12635261
126353                  PERFORM 9905-WRITE-CICS-LOG                     12635361
126354                                                                  12635461
126355                  MOVE SPACES TO PV-LOG-MSG-3                     12635561
126356                  PERFORM 9905-WRITE-CICS-LOG                     12635661
126357              END-IF                                              12635761
126358***                                                               12635861
126359*** ADD DISPLAY OF CARTON COUNT INFO IF CARTONS HAVE BEEN         12635961
126360*** MISSED                                                        12636061
126361*** DMH - 3/16/12 - END                                           12636161
126362***                                                               12636261
126363             CONTINUE                                             12636361
126364         WHEN SQLCODE = -904                                      12636461
126365         WHEN SQLCODE = -913                                      12636561
126366         WHEN SQLCODE = -911                                      12636661
126367             MOVE 19                  TO PV-ERROR-NBR             12636761
126368             PERFORM 9903-WRITE-CICS-LOG                          12636861
126369             PERFORM 9000-SOFT-ABORT                              12636961
126370         WHEN SQLWARN0 NOT = SPACES                               12637061
126380         WHEN SQLCODE NOT EQUAL ZERO                              12638061
126390             MOVE 20                  TO PV-ERROR-NBR             12639061
126400                                         PC233-ERROR-NBR          12640061
126500             PERFORM 9903-WRITE-CICS-LOG                          12650061
126600             MOVE PC233-OPER-UNT-ID                               12660061
126700                           TO PV-DEBUG-OPER-UNT-ID                12670061
126800             MOVE PC233-DIVERT-NBR                                12680061
126900                         TO PV-DEBUG-DIVERT-NBR                   12690061
127000             MOVE PC233-DIVERT-LOC-ID                             12700061
127100                         TO PV-DEBUG-DIVERT-LOC-ID                12710061
127200             MOVE SUCRDV-DIVERT-TMST                              12720061
127300                         TO PV-DEBUG-DIVERT-TMST                  12730061
127400             MOVE PV-TRIP-END-TMST                                12740061
127500                         TO PV-DEBUG-TRIP-END-TMST                12750061
127600             MOVE PC233-STR-NBR                                   12760061
127700                         TO PV-DEBUG-STR-NBR                      12770061
127800             PERFORM 9904-WRITE-DEBUG                             12780061
127900                                                                  12790061
128000             MOVE '7240-COUNT-SHIP-CTNS'                          12800061
128100                                      TO PC233-PARAGRAPH          12810061
128200             MOVE 'PCKRF874 - COUNT DIVRTED CTNS'                 12820061
128300                                      TO PC233-MESSAGE-TEXT(1)    12830061
128400             MOVE SQLCA               TO PC233-SQLCA              12840061
128500             MOVE 'TSUCRDV'           TO PC233-DB2-TABLE-NAME(1)  12850061
128600             SET PC233-ABEND          TO TRUE                     12860061
128700             MOVE 99                  TO PC233-PGM-MSG-NBR        12870061
128800             PERFORM 8210-XCTL-ERROR-SCREEN                       12880061
128900     END-EVALUATE.                                                12890061
129000                                                                  12900061
129100*----------------------------------------------------------------*12910061
129200*DMH - 1/30/13  BEGIN DIVERT FOR SHIPPING TRAILER                *12920061
129300*GET THE NEXT SML THAT SHOULD HAVE BEEN SELECTED AND THE BEGIN   *12930061
129400*DIVERT - THIS WILL BE DISPLAYED ON THE ERROR SCREEN             *12940061
129500*----------------------------------------------------------------*12950061
129600 7245-SHIP-BEGIN-DIVERT.                                          12960061
129700     EXEC SQL                                                     12970061
129800         SELECT                                                   12980061
129900                 DATE(RDV.DIVERT_TMST)                            12990061
129910               , TIME(RDV.DIVERT_TMST)                            12991061
129911               , RDV.DIVERT_TMST                                  12991161
129912               , RDV.SHIPT_UNT_ID                                 12991261
129913            INTO :PV-DIVERT-DATE                                  12991361
129914               , :PV-DIVERT-TIME                                  12991461
129915               , :PV-DIVERT-TMST                                  12991561
129916               , :PV-SHIPT-UNT-ID                                 12991661
129917         FROM                                                     12991761
129918            TSUCRDV RDV                                           12991861
129919         WHERE RDV.OPER_UNT_ID       = :PC233-OPER-UNT-ID         12991961
129920           AND RDV.DIVERT_NBR        = :PC233-DIVERT-NBR          12992061
129921           AND RDV.DIVERT_LOC_ID     = :PC233-DIVERT-LOC-ID       12992161
129922           AND RDV.DIVERT_TMST       < :SUCRDV-DIVERT-TMST        12992261
129923           AND RDV.DIVERT_TMST       > :PV-TRIP-END-TMST          12992361
129924           AND RDV.DEST_OPER_UNT_ID  = :PC233-STR-NBR             12992461
129925           AND RDV.BRCDE_NBR        <> :PC233-BRCDE-NBR           12992561
129926           AND RDV.ACTV_CDE          = 'A'                        12992661
129927           AND RDV.DIVERT_TMST =                                  12992761
129928           (SELECT MAX(RDV1.DIVERT_TMST)                          12992861
129929               FROM TSUCRDV RDV1                                  12992961
129930             WHERE RDV1.BRCDE_NBR         =  RDV.BRCDE_NBR        12993061
129931               AND RDV1.ACTV_CDE          = 'A')                  12993161
129932         ORDER BY RDV.DIVERT_TMST                                 12993261
129933         FETCH FIRST 1 ROW ONLY                                   12993361
129934     END-EXEC.                                                    12993461
129935                                                                  12993561
129936     EVALUATE TRUE                                                12993661
129937         WHEN SQLCODE = ZERO                                      12993761
129938         WHEN SQLCODE = +100                                      12993861
129939         WHEN SQLCODE = -305                                      12993961
129940             CONTINUE                                             12994061
129950         WHEN SQLCODE = -904                                      12995061
129960         WHEN SQLCODE = -913                                      12996061
129970         WHEN SQLCODE = -911                                      12997061
129980             MOVE 19                  TO PV-ERROR-NBR             12998061
129990             PERFORM 9903-WRITE-CICS-LOG                          12999061
130000             PERFORM 9000-SOFT-ABORT                              13000061
130001         WHEN SQLWARN0 NOT = SPACES                               13000161
130002         WHEN SQLCODE NOT EQUAL ZERO                              13000261
130003             MOVE 20                  TO PV-ERROR-NBR             13000361
130004                                         PC233-ERROR-NBR          13000461
130005             PERFORM 9903-WRITE-CICS-LOG                          13000561
130006             MOVE PC233-OPER-UNT-ID                               13000661
130007                           TO PV-DEBUG-OPER-UNT-ID                13000761
130008             MOVE PC233-DIVERT-NBR                                13000861
130009                         TO PV-DEBUG-DIVERT-NBR                   13000961
130010             MOVE PC233-DIVERT-LOC-ID                             13001061
130011                         TO PV-DEBUG-DIVERT-LOC-ID                13001161
130012             MOVE SUCRDV-DIVERT-TMST                              13001261
130013                         TO PV-DEBUG-DIVERT-TMST                  13001361
130014             MOVE PV-TRIP-END-TMST                                13001461
130015                         TO PV-DEBUG-TRIP-END-TMST                13001561
130016             MOVE PC233-STR-NBR                                   13001661
130017                         TO PV-DEBUG-STR-NBR                      13001761
130018             PERFORM 9904-WRITE-DEBUG                             13001861
130019                                                                  13001961
130020             MOVE '7245-SHIP-BEGIN-DIVERT'                        13002061
130021                                      TO PC233-PARAGRAPH          13002161
130022             MOVE 'PCKRF874 - GET THE NEXT DIVERT'                13002261
130023                                      TO PC233-MESSAGE-TEXT(1)    13002361
130024             MOVE SQLCA               TO PC233-SQLCA              13002461
130025             MOVE 'TSUCRDV'           TO PC233-DB2-TABLE-NAME(1)  13002561
130026             SET PC233-ABEND          TO TRUE                     13002661
130027             MOVE 99                  TO PC233-PGM-MSG-NBR        13002761
130028             PERFORM 8210-XCTL-ERROR-SCREEN                       13002861
130029     END-EVALUATE.                                                13002961
130030                                                                  13003061
130040                                                                  13004061
130050 7250-COUNT-SHTL-CTNS.                                            13005061
130060                                                                  13006061
130070     MOVE ZEROES                      TO PV-DB2-COUNT             13007061
130080     EXEC SQL                                                     13008061
130090         SELECT                                                   13009061
130100             COUNT(*)                                             13010061
130200         INTO                                                     13020061
130300           :PV-DB2-COUNT                                          13030061
130400         FROM                                                     13040061
130500            TSUCRDV RDV                                           13050061
130600         WHERE RDV.OPER_UNT_ID       = :PC233-OPER-UNT-ID         13060061
130700           AND RDV.DIVERT_NBR        = :PC233-DIVERT-NBR          13070061
130800           AND RDV.DIVERT_LOC_ID     = :PC233-DIVERT-LOC-ID       13080061
130900           AND RDV.DIVERT_TMST       < :SUCRDV-DIVERT-TMST        13090061
131000           AND RDV.DIVERT_TMST       > :PV-TRIP-END-TMST          13100061
131100           AND RDV.BRCDE_NBR        <> :PC233-BRCDE-NBR           13110061
131200           AND RDV.ACTV_CDE          = 'A'                        13120061
131300           AND RDV.DIVERT_TMST =                                  13130061
131400           (SELECT MAX(RDV1.DIVERT_TMST)                          13140061
131500               FROM TSUCRDV RDV1                                  13150061
131600             WHERE RDV1.BRCDE_NBR         =  RDV.BRCDE_NBR        13160061
131700               AND RDV1.ACTV_CDE          = 'A')                  13170061
131800     END-EXEC.                                                    13180061
131900                                                                  13190061
132000     EVALUATE TRUE                                                13200061
132100         WHEN SQLCODE = ZERO                                      13210061
132200         WHEN SQLCODE = +100                                      13220061
132300         WHEN SQLCODE = -305                                      13230061
132400***                                                               13240061
132500*** ADD DISPLAY OF CARTON COUNT INFO IF CARTONS HAVE BEEN         13250061
132600*** MISSED                                                        13260061
132700*** DMH - 3/16/12 - BEGIN                                         13270061
132800***                                                               13280061
132900              IF  PV-DB2-COUNT  > 0                               13290061
132910                  MOVE PV-DB2-COUNT        TO PV-DISP-DVRT-CNT    13291061
132920                  MOVE PC233-OPER-UNT-ID   TO PV-DISP-OPER        13292061
132930                  MOVE PC233-DIVERT-NBR    TO PV-DISP-DVRT-NBR    13293061
132940                  MOVE PC233-DIVERT-LOC-ID TO PV-DISP-DVRT-LOC    13294061
132950                  MOVE PC233-STR-NBR       TO PV-DISP-STR-NBR     13295061
132960                  MOVE PC233-BRCDE-NBR     TO PV-DISP-BRCDE-NBR   13296061
132970                  MOVE SQLCODE             TO PV-DISP-SQLCODE     13297061
132980                                                                  13298061
132990                  MOVE SPACES TO PV-LOG-MSG-3                     13299061
132991                  PERFORM 9905-WRITE-CICS-LOG                     13299161
132992                                                                  13299261
132993                  STRING ' PCKRF874-7250-'                        13299361
132994                         '  DVRT CNT:'     PV-DISP-DVRT-CNT       13299461
132995                         '  OPER:'         PV-DISP-OPER           13299561
132996                         '  DVRT NBR:'     PV-DISP-DVRT-NBR       13299661
132997                         '  DVRT LOC:'     PV-DISP-DVRT-LOC       13299761
132998                         '  STORE:'        PV-DISP-STR-NBR        13299861
132999                         '  SQL:'          PV-DISP-SQLCODE        13299961
133000                                           DELIMITED BY SIZE      13300061
133001                                     INTO  PV-LOG-MSG-3           13300161
133002                  PERFORM 9905-WRITE-CICS-LOG                     13300261
133003                  MOVE SPACES TO PV-LOG-MSG-3                     13300361
133004                                                                  13300461
133005                  STRING ' PCKRF874-7250-'                        13300561
133006                         '  DVRT TMST:'    SUCRDV-DIVERT-TMST     13300661
133007                         '  END TMST:'     PV-TRIP-END-TMST       13300761
133008                                           DELIMITED BY SIZE      13300861
133009                                     INTO  PV-LOG-MSG-3           13300961
133010                  PERFORM 9905-WRITE-CICS-LOG                     13301061
133011                                                                  13301161
133012                  MOVE SPACES TO PV-LOG-MSG-3                     13301261
133013                  STRING ' PCKRF874-7250-'                        13301361
133014                         '  BRCDE NBR:'    PV-DISP-BRCDE-NBR      13301461
133015                                           DELIMITED BY SIZE      13301561
133016                                     INTO  PV-LOG-MSG-3           13301661
133017                  PERFORM 9905-WRITE-CICS-LOG                     13301761
133018                                                                  13301861
133019                  MOVE SPACES TO PV-LOG-MSG-3                     13301961
133020                  PERFORM 9905-WRITE-CICS-LOG                     13302061
133021              END-IF                                              13302161
133022***                                                               13302261
133023*** ADD DISPLAY OF CARTON COUNT INFO IF CARTONS HAVE BEEN         13302361
133024*** MISSED                                                        13302461
133025*** DMH - 3/16/12 - END                                           13302561
133026***                                                               13302661
133027             CONTINUE                                             13302761
133028         WHEN SQLCODE = -904                                      13302861
133029         WHEN SQLCODE = -913                                      13302961
133030         WHEN SQLCODE = -911                                      13303061
133040             MOVE 21                  TO PV-ERROR-NBR             13304061
133050             PERFORM 9903-WRITE-CICS-LOG                          13305061
133060             PERFORM 9000-SOFT-ABORT                              13306061
133070         WHEN SQLWARN0 NOT = SPACES                               13307061
133080         WHEN SQLCODE NOT EQUAL ZERO                              13308061
133090             MOVE 22                  TO PV-ERROR-NBR             13309061
133100                                         PC233-ERROR-NBR          13310061
133200             PERFORM 9903-WRITE-CICS-LOG                          13320061
133300             MOVE '7250-COUNT-SHTL-CTNS'                          13330061
133400                                      TO PC233-PARAGRAPH          13340061
133500             MOVE 'PCKRF874 - COUNT SHUTTLE CTNS'                 13350061
133600                                      TO PC233-MESSAGE-TEXT(1)    13360061
133700             MOVE SQLCA               TO PC233-SQLCA              13370061
133800             MOVE 'TSUCRDV'           TO PC233-DB2-TABLE-NAME(1)  13380061
133900             SET PC233-ABEND          TO TRUE                     13390061
134000             MOVE 99                  TO PC233-PGM-MSG-NBR        13400061
134100             PERFORM 8210-XCTL-ERROR-SCREEN                       13410061
134200     END-EVALUATE.                                                13420061
134300                                                                  13430061
134400*----------------------------------------------------------------*13440061
134500*DMH - 1/30/13  BEGIN DIVERT FOR SHUTTLE TRAILER                 *13450061
134600*GET THE NEXT SML THAT SHOULD HAVE BEEN SELECTED AND THE BEGIN   *13460061
134700*DIVERT - THIS WILL BE DISPLAYED ON THE ERROR SCREEN             *13470061
134800*----------------------------------------------------------------*13480061
134900 7255-SHTL-BEGIN-DIVERT.                                          13490061
135000                                                                  13500061
135100     EXEC SQL                                                     13510061
135200          SELECT                                                  13520061
135210                 DATE(RDV.DIVERT_TMST)                            13521061
135220               , TIME(RDV.DIVERT_TMST)                            13522061
135230               , RDV.DIVERT_TMST                                  13523061
135240               , RDV.SHIPT_UNT_ID                                 13524061
135250            INTO :PV-DIVERT-DATE                                  13525061
135260               , :PV-DIVERT-TIME                                  13526061
135270               , :PV-DIVERT-TMST                                  13527061
135271               , :PV-SHIPT-UNT-ID                                 13527161
135272         FROM                                                     13527261
135273            TSUCRDV RDV                                           13527361
135274         WHERE RDV.OPER_UNT_ID       = :PC233-OPER-UNT-ID         13527461
135275           AND RDV.DIVERT_NBR        = :PC233-DIVERT-NBR          13527561
135276           AND RDV.DIVERT_LOC_ID     = :PC233-DIVERT-LOC-ID       13527661
135277           AND RDV.DIVERT_TMST       < :SUCRDV-DIVERT-TMST        13527761
135278           AND RDV.DIVERT_TMST       > :PV-TRIP-END-TMST          13527861
135279           AND RDV.BRCDE_NBR        <> :PC233-BRCDE-NBR           13527961
135280           AND RDV.ACTV_CDE          = 'A'                        13528061
135281           AND RDV.DIVERT_TMST =                                  13528161
135282           (SELECT MAX(RDV1.DIVERT_TMST)                          13528261
135283               FROM TSUCRDV RDV1                                  13528361
135284             WHERE RDV1.BRCDE_NBR         =  RDV.BRCDE_NBR        13528461
135285               AND RDV1.ACTV_CDE          = 'A')                  13528561
135286         ORDER BY RDV.DIVERT_TMST                                 13528661
135287         FETCH FIRST 1 ROW ONLY                                   13528761
135288     END-EXEC.                                                    13528861
135289                                                                  13528961
135290     EVALUATE TRUE                                                13529061
135291         WHEN SQLCODE = ZERO                                      13529161
135292         WHEN SQLCODE = +100                                      13529261
135293         WHEN SQLCODE = -305                                      13529361
135294             CONTINUE                                             13529461
135295         WHEN SQLCODE = -904                                      13529561
135296         WHEN SQLCODE = -913                                      13529661
135297         WHEN SQLCODE = -911                                      13529761
135298             MOVE 21                  TO PV-ERROR-NBR             13529861
135299             PERFORM 9903-WRITE-CICS-LOG                          13529961
135300             PERFORM 9000-SOFT-ABORT                              13530061
135310         WHEN SQLWARN0 NOT = SPACES                               13531061
135320         WHEN SQLCODE NOT EQUAL ZERO                              13532061
135330             MOVE 22                  TO PV-ERROR-NBR             13533061
135340                                         PC233-ERROR-NBR          13534061
135350             PERFORM 9903-WRITE-CICS-LOG                          13535061
135360             MOVE '7255-SHTL-BEGIN-DIVERT'                        13536061
135361                                      TO PC233-PARAGRAPH          13536161
135362             MOVE 'PCKRF874 - GET NEXT DIVERT SML'                13536261
135363                                      TO PC233-MESSAGE-TEXT(1)    13536361
135364             MOVE SQLCA               TO PC233-SQLCA              13536461
135365             MOVE 'TSUCRDV'           TO PC233-DB2-TABLE-NAME(1)  13536561
135366             SET PC233-ABEND          TO TRUE                     13536661
135367             MOVE 99                  TO PC233-PGM-MSG-NBR        13536761
135368             PERFORM 8210-XCTL-ERROR-SCREEN                       13536861
135369     END-EVALUATE.                                                13536961
135370                                                                  13537061
135371                                                                  13537161
135372 7260-GET-LAST-START-TMST.                                        13537261
135373                                                                  13537361
135374     EXEC SQL                                                     13537461
135375         SELECT MAX(CDOT.STRT_DIVERT_TMST)                        13537561
135376         INTO :SUCDOT-STRT-DIVERT-TMST                            13537661
135377         FROM TSUCDOT CDOT                                        13537761
135378         WHERE CDOT.OTBND_TRIP_ID = :PC233-TRIP-ID                13537861
135379             AND CDOT.OPER_UNT_ID   = :PC233-OPER-UNT-ID          13537961
135380             AND CDOT.DOOR_ID       = :PC233-DOOR-ID              13538061
135390     END-EXEC.                                                    13539061
135400                                                                  13540061
135500     EVALUATE TRUE                                                13550061
135600         WHEN SQLCODE = ZERO                                      13560061
135700         WHEN SQLCODE = +100                                      13570061
135800         WHEN SQLCODE = -305                                      13580061
135900             CONTINUE                                             13590061
136000         WHEN SQLCODE = -904                                      13600061
136100         WHEN SQLCODE = -913                                      13610061
136200         WHEN SQLCODE = -911                                      13620061
136300             MOVE 26                  TO PV-ERROR-NBR             13630061
136400             PERFORM 9903-WRITE-CICS-LOG                          13640061
136500             PERFORM 9000-SOFT-ABORT                              13650061
136600         WHEN SQLWARN0 NOT = SPACES                               13660061
136700         WHEN SQLCODE NOT EQUAL ZERO                              13670061
136800             MOVE 27                  TO PV-ERROR-NBR             13680061
136900                                         PC233-ERROR-NBR          13690061
137000             PERFORM 9903-WRITE-CICS-LOG                          13700061
137100             MOVE '7260-GET-LAST-START-TMST'                      13710061
137200                                      TO PC233-PARAGRAPH          13720061
137300             MOVE 'PCKRF874 - GET STORE/DOOR INFO FROM TRLR'      13730061
137400                                      TO PC233-MESSAGE-TEXT(1)    13740061
137500             MOVE SQLCA               TO PC233-SQLCA              13750061
137600             MOVE 'TSUCDOT'           TO PC233-DB2-TABLE-NAME (1) 13760061
137700             SET PC233-ABEND          TO TRUE                     13770061
137800             MOVE 99                  TO PC233-PGM-MSG-NBR        13780061
137900             PERFORM 8210-XCTL-ERROR-SCREEN                       13790061
138000     END-EVALUATE.                                                13800061
138100                                                                  13810061
138200 7300-ANY-OTHER-TRLRS-THIS-DOOR.                                  13820061
138300                                                                  13830061
138400                                                                  13840061
138500*    CHECK TO SEE IF ANY OTHER TRAILERS WERE EVER OPENED AT THIS  13850061
138600*    DOOR.   IF NONE ARE FOUND, WE'LL SKIP THE START/END EDITS.   13860061
138700*    THERE ARE NO PREVIOUSLY DIVERTED CARTONS BECAUSE THIS IS     13870061
138800*    IN EFFECT A NEW DOOR.  IF PREVIOUS TRAILERS ARE FOUND THEN   13880061
138900*    THE EDITING IS VALID AND THE ERROR WILL BE ISSUED.           13890061
139000*    PV-TRLR-COUNT CAN BE EITHER 1 OR ZERO DEPENDING ON THE       13900061
139100*    RESULT OF THE CALL.                                          13910061
139200                                                                  13920061
139300     MOVE ZERO                        TO PV-DB2-COUNT             13930061
139400     EXEC SQL                                                     13940061
139500         SELECT COUNT(*)                                          13950061
139600         INTO                                                     13960061
139700             :PV-DB2-COUNT                                        13970061
139800         FROM                                                     13980061
139900             TSUOBTS OBTS                                         13990061
140000         WHERE                                                    14000061
140100             OBTS.STAT_OPER_UNT_ID = :PC233-OPER-UNT-ID           14010061
140200         AND OBTS.DOOR_ID          = :PC233-DOOR-ID               14020061
140300         AND OBTS.OTBND_TRIP_ID   <> :PC233-TRIP-ID               14030061
140400     END-EXEC.                                                    14040061
140500                                                                  14050061
140600     EVALUATE TRUE                                                14060061
140700         WHEN SQLCODE = ZERO                                      14070061
140800         WHEN SQLCODE = +100                                      14080061
140900             CONTINUE                                             14090061
141000         WHEN SQLCODE = -904                                      14100061
141100         WHEN SQLCODE = -913                                      14110061
141200         WHEN SQLCODE = -911                                      14120061
141300             MOVE 28                  TO PV-ERROR-NBR             14130061
141400             PERFORM 9903-WRITE-CICS-LOG                          14140061
141500             PERFORM 9000-SOFT-ABORT                              14150061
141600         WHEN SQLWARN0 NOT = SPACES                               14160061
141700         WHEN SQLCODE NOT EQUAL ZERO                              14170061
141800             MOVE 29                  TO PV-ERROR-NBR             14180061
141900                                         PC233-ERROR-NBR          14190061
142000             PERFORM 9903-WRITE-CICS-LOG                          14200061
142100             MOVE '7300-ANY-OTHER-TRLRS-THIS-DOOR'                14210061
142200                                      TO PC233-PARAGRAPH          14220061
142300             MOVE 'PCKRF874 - LOOK FOR OTHER TRAILERS'            14230061
142400                                      TO PC233-MESSAGE-TEXT(1)    14240061
142500             MOVE SQLCA               TO PC233-SQLCA              14250061
142600             MOVE 'TSUOBTS'           TO PC233-DB2-TABLE-NAME(1)  14260061
142700             SET PC233-ABEND          TO TRUE                     14270061
142800             MOVE 99                  TO PC233-PGM-MSG-NBR        14280061
142900             PERFORM 8210-XCTL-ERROR-SCREEN                       14290061
143000     END-EVALUATE.                                                14300061
143100                                                                  14310061
143200/                                                                 14320061
143300                                                                  14330061
143400 7310-GET-CURRENT-TMST.                                           14340061
143500     EXEC SQL                                                     14350061
143600          SELECT CURRENT TIMESTAMP                                14360061
143700            INTO :PV-CURRENT-TMST                                 14370061
143800            FROM SYSIBM.SYSDUMMY1                                 14380061
143900     END-EXEC.                                                    14390061
144000                                                                  14400061
144100     EVALUATE TRUE                                                14410061
144200         WHEN SQLCODE = +0                                        14420061
144300              CONTINUE                                            14430061
144400                                                                  14440061
144500         WHEN SQLWARN0 NOT = SPACES                               14450061
144600         WHEN SQLCODE < +0                                        14460061
144700         WHEN SQLCODE > +0                                        14470061
144800             MOVE 29                  TO PV-ERROR-NBR             14480061
144900                                         PC233-ERROR-NBR          14490061
145000             PERFORM 9903-WRITE-CICS-LOG                          14500061
145100             MOVE '7310-GET-CURRENT-TMST'                         14510061
145200                                      TO PC233-PARAGRAPH          14520061
145300             MOVE 'PCKRF874 - LOOK FOR OTHER TRAILERS'            14530061
145400                                      TO PC233-MESSAGE-TEXT(1)    14540061
145500             MOVE SQLCA               TO PC233-SQLCA              14550061
145600             MOVE 'SYSIBM.SYSDUMMY1' TO PC233-DB2-TABLE-NAME(1)   14560061
145700             SET PC233-ABEND          TO TRUE                     14570061
145800             MOVE 99                  TO PC233-PGM-MSG-NBR        14580061
145900             PERFORM 8210-XCTL-ERROR-SCREEN                       14590061
146000     END-EVALUATE.                                                14600061
146100                                                                  14610061
146200/                                                                 14620061
146300 7400-INSERT-WRKR-AUD.                                            14630061
146400                                                                  14640061
146500     IF  PC233-CUTOFF-START-CTN                                   14650061
146600         MOVE  'PCKR874A'  TO  SUT00006-CRE-BY-PGM-NM             14660061
146700     ELSE                                                         14670061
146800         MOVE  'PCKR874B'  TO  SUT00006-CRE-BY-PGM-NM             14680061
146900     END-IF.                                                      14690061
147000                                                                  14700061
147100     EXEC SQL                                                     14710061
147200         INSERT INTO SUT_TRIP_WRKR_AUD                            14720061
147300             (                                                    14730061
147400               OTBND_TRIP_ID                                      14740061
147500             , USR_ID                                             14750061
147600             , CRE_TMST                                           14760061
147700             , CRE_BY_PGM_NM                                      14770061
147800                 )                                                14780061
147900                                                                  14790061
148000             VALUES                                               14800061
148100                                                                  14810061
148200                 (                                                14820061
148300                 :PC233-TRIP-ID                                   14830061
148400             ,   :PC233-USER-ID                                   14840061
148500             ,   CURRENT TIMESTAMP                                14850061
148600             ,   :SUT00006-CRE-BY-PGM-NM                          14860061
148700                 )                                                14870061
148800     END-EXEC.                                                    14880061
148900                                                                  14890061
149000     EVALUATE TRUE                                                14900061
149100         WHEN SQLCODE = ZERO                                      14910061
149200             CONTINUE                                             14920061
149300         WHEN SQLCODE = -904                                      14930061
149400         WHEN SQLCODE = -913                                      14940061
149500         WHEN SQLCODE = -911                                      14950061
149600             MOVE 12                  TO PV-ERROR-NBR             14960061
149700             PERFORM 9903-WRITE-CICS-LOG                          14970061
149800             PERFORM 9000-SOFT-ABORT                              14980061
149900         WHEN SQLWARN0 NOT = SPACES                               14990061
150000         WHEN SQLCODE NOT EQUAL ZERO                              15000061
150100              MOVE PC233-OPER-UNT-ID      TO PV-DISPLAY-OPER      15010061
150200              MOVE PC233-DOOR-ID          TO PV-DISPLAY-DOOR-ID   15020061
150300              MOVE PC233-STR-NBR          TO PV-DISPLAY-DEST      15030061
150400              MOVE PC233-SERIAL-NBR       TO PV-DISPLAY-SRL-NBR   15040061
150500              MOVE PC233-OWNER-SCAC-ID    TO PV-DISPLAY-SCAC      15050061
150600              MOVE PC233-TRIP-ID          TO PV-DISPLAY-TRIP      15060061
150700              STRING  ' OPER-'               DELIMITED BY SIZE    15070061
150800                      PV-DISPLAY-OPER        DELIMITED BY SIZE    15080061
150900                      '  DOOR-'              DELIMITED BY SIZE    15090061
151000                      PV-DISPLAY-DOOR-ID     DELIMITED BY SIZE    15100061
151100                      '  DEST-'              DELIMITED BY SIZE    15110061
151200                      PV-DISPLAY-DEST        DELIMITED BY SIZE    15120061
151300                                        INTO                      15130061
151400                                        PC233-MESSAGE-TEXT(2)     15140061
151500             STRING   ' TRLR SRL#-'          DELIMITED BY SIZE    15150061
151600                      PV-DISPLAY-SRL-NBR     DELIMITED BY SIZE    15160061
151700                      '   SCAC-'             DELIMITED BY SIZE    15170061
151800                      PV-DISPLAY-SCAC        DELIMITED BY SIZE    15180061
151900                      '   TRIP-'             DELIMITED BY SIZE    15190061
152000                      PV-DISPLAY-TRIP        DELIMITED BY SIZE    15200061
152100                                        INTO                      15210061
152200                                        PC233-MESSAGE-TEXT(3)     15220061
152300                                                                  15230061
152400             MOVE 13                  TO PV-ERROR-NBR             15240061
152500                                         PC233-ERROR-NBR          15250061
152600             PERFORM 9903-WRITE-CICS-LOG                          15260061
152700             MOVE '7400-INSERT-WRKR-AUD'                          15270061
152800                                      TO PC233-PARAGRAPH          15280061
152900             MOVE 'PCKRF874 - INSERT WORKER AUDIT'                15290061
153000                                      TO PC233-MESSAGE-TEXT(1)    15300061
153100             MOVE SQLCA               TO PC233-SQLCA              15310061
153200             MOVE 'SUT00006'          TO PC233-DB2-TABLE-NAME(1)  15320061
153300             SET PC233-ABEND          TO TRUE                     15330061
153400             MOVE 99                  TO PC233-PGM-MSG-NBR        15340061
153500             PERFORM 8210-XCTL-ERROR-SCREEN                       15350061
153600     END-EVALUATE.                                                15360061
153700/                                                                 15370061
153800                                                                  15380061
153900                                                                  15390061
154000 8000-SEND-MAP.                                                   15400061
154100                                                                  15410061
154200     EXEC CICS                                                    15420061
154300         SEND MAP       ('PC874A')                                15430061
154400              MAPSET    ('PCKM874')                               15440061
154500              ERASE                                               15450061
154600              CURSOR                                              15460061
154700              RESP      (PV-CICS-RESPONSE)                        15470061
154800     END-EXEC.                                                    15480061
154900                                                                  15490061
155000     EVALUATE TRUE                                                15500061
155100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 15510061
155200             CONTINUE                                             15520061
155300         WHEN OTHER                                               15530061
155400             MOVE '8000-SEND-MAP'     TO DP013-PARAGRAPH          15540061
155500             MOVE 'PCKRF874 - UNABLE TO SEND MAP'                 15550061
155600                                      TO DP013-MESSAGE-TEXT (1)   15560061
155700             SET DP013-CICS-ABEND                                 15570061
155800                 DP013-ROLLBACK       TO TRUE                     15580061
155900             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               15590061
156000     END-EVALUATE.                                                15600061
156100                                                                  15610061
156200 8010-SEND-DATA-ONLY.                                             15620061
156300                                                                  15630061
156400     EXEC CICS                                                    15640061
156500         SEND MAP       ('PC874A')                                15650061
156600              MAPSET    ('PCKM874')                               15660061
156700              CURSOR                                              15670061
156800              DATAONLY                                            15680061
156900              RESP      (PV-CICS-RESPONSE)                        15690061
157000     END-EXEC.                                                    15700061
157100                                                                  15710061
157200     EVALUATE TRUE                                                15720061
157300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 15730061
157400             CONTINUE                                             15740061
157500         WHEN OTHER                                               15750061
157600             MOVE '8010-SEND-DATA-ONLY'                           15760061
157700                                      TO DP013-PARAGRAPH          15770061
157800             MOVE 'PCKRF874 - UNABLE TO SEND DATA'                15780061
157900                                      TO DP013-MESSAGE-TEXT (1)   15790061
158000             SET DP013-CICS-ABEND                                 15800061
158100                 DP013-ROLLBACK       TO TRUE                     15810061
158200             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               15820061
158300     END-EVALUATE.                                                15830061
158400                                                                  15840061
158500 8020-RECEIVE-MAP.                                                15850061
158600                                                                  15860061
158700     EXEC CICS                                                    15870061
158800         RECEIVE MAP    ('PC874A')                                15880061
158900                 MAPSET ('PCKM874')                               15890061
159000                 RESP   (PV-CICS-RESPONSE)                        15900061
159100     END-EXEC.                                                    15910061
159200                                                                  15920061
159300     EVALUATE TRUE                                                15930061
159400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 15940061
159500             CONTINUE                                             15950061
159600         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                15960061
159700             CONTINUE                                             15970061
159800         WHEN OTHER                                               15980061
159900            MOVE '8020-RECEIVE-MAP'   TO DP013-PARAGRAPH          15990061
160000            MOVE 'PCKRF874 - UNABLE TO RECEIVE MAP'               16000061
160100                                      TO DP013-MESSAGE-TEXT (1)   16010061
160200            SET DP013-LOGIC-ABEND     TO TRUE                     16020061
160300            SET DP013-ROLLBACK        TO TRUE                     16030061
160400            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                16040061
160500     END-EVALUATE.                                                16050061
160600                                                                  16060061
160700 8100-RETURN-TRANID.                                              16070061
160800                                                                  16080061
160900     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       16090061
161000     EXEC CICS                                                    16100061
161100         RETURN TRANSID  (PC-TRANID)                              16110061
161200                COMMAREA (CA-COMMAREA)                            16120061
161300                LENGTH   (PV-COMMAREA-LENGTH)                     16130061
161400                RESP     (PV-CICS-RESPONSE)                       16140061
161500     END-EXEC.                                                    16150061
161600                                                                  16160061
161700     EVALUATE TRUE                                                16170061
161800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 16180061
161900             CONTINUE                                             16190061
162000         WHEN OTHER                                               16200061
162100             MOVE '8100-RETURN-TRANIND'                           16210061
162200                                      TO DP013-PARAGRAPH          16220061
162300             MOVE 'PCKRF874 - UNABLE TO RETURN TO TRANID'         16230061
162400                 TO DP013-MESSAGE-TEXT (1)                        16240061
162500             SET DP013-CICS-ABEND     TO TRUE                     16250061
162600             SET DP013-ROLLBACK       TO TRUE                     16260061
162700             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               16270061
162800     END-EVALUATE.                                                16280061
162900                                                                  16290061
163000 8110-RETURN.                                                     16300061
163100                                                                  16310061
163200     EXEC CICS                                                    16320061
163300         SEND FROM (PV-MESSAGE-AREA)                              16330061
163400              LENGTH (19)                                         16340061
163500              ERASE                                               16350061
163600     END-EXEC.                                                    16360061
163700                                                                  16370061
163800     EXEC CICS                                                    16380061
163900         RETURN                                                   16390061
164000     END-EXEC.                                                    16400061
164100                                                                  16410061
164200 8200-XCTL.                                                       16420061
164300     SET PC233-INITIALIZE-SCREEN      TO TRUE.                    16430061
164400     MOVE PC-CURRENT-PROGRAM-NAME     TO PC233-LAST-PROGRAM.      16440061
164500     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       16450061
164600                                                                  16460061
164700     EXEC CICS                                                    16470061
164800         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    16480061
164900               COMMAREA  (CA-COMMAREA)                            16490061
165000               LENGTH    (PV-COMMAREA-LENGTH)                     16500061
165100               RESP      (PV-CICS-RESPONSE)                       16510061
165200     END-EXEC.                                                    16520061
165300                                                                  16530061
165400     EVALUATE TRUE                                                16540061
165500         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 16550061
165600             CONTINUE                                             16560061
165700         WHEN OTHER                                               16570061
165800             MOVE '8200-XCTL'                                     16580061
165900                                      TO DP013-PARAGRAPH          16590061
166000             MOVE 'PCKRF874 - UNABLE TO XCTL TO PROGRAM: '        16600061
166100                                      TO DP013-MESSAGE-TEXT (1)   16610061
166200             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   16620061
166300             SET DP013-CICS-ABEND                                 16630061
166400                 DP013-ROLLBACK       TO TRUE                     16640061
166500             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               16650061
166600             MOVE PC-TRANS-UNAVAILABLE-MSG                        16660061
166700                                      TO AMSGLNO                  16670061
166800             SET PC233-PROCESS-SCREEN TO TRUE                     16680061
166900             MOVE -1                  TO ADOORL                   16690061
167000             PERFORM 8000-SEND-MAP                                16700061
167100             PERFORM 8100-RETURN-TRANID                           16710061
167200     END-EVALUATE.                                                16720061
167300                                                                  16730061
167400 8210-XCTL-ERROR-SCREEN.                                          16740061
167500     IF NOT PC233-ABEND                                           16750061
167600         SET PC233-INITIALIZE-SCREEN  TO TRUE                     16760061
167700     END-IF                                                       16770061
167800     IF PC233-PGM-MSG-NBR = ZERO                                  16780061
167900         MOVE 2                       TO PC233-PGM-MSG-NBR        16790061
168000     END-IF                                                       16800061
168100                                                                  16810061
168200     MOVE DFHEIBLK                    TO PC233-DFHEIBLK.          16820061
168300     MOVE PC-CURRENT-PROGRAM-NAME     TO PC233-LAST-PROGRAM.      16830061
168400     MOVE LENGTH OF CA-COMMAREA       TO PV-COMMAREA-LENGTH       16840061
168500     MOVE 'PCKRF871'                  TO PV-TRANSFER-PROGRAM      16850061
168600                                                                  16860061
168700     EXEC CICS                                                    16870061
168800         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    16880061
168900               COMMAREA  (CA-COMMAREA)                            16890061
169000               LENGTH    (PV-COMMAREA-LENGTH)                     16900061
169100               RESP      (PV-CICS-RESPONSE)                       16910061
169200     END-EXEC.                                                    16920061
169300                                                                  16930061
169400     EVALUATE TRUE                                                16940061
169500         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 16950061
169600             CONTINUE                                             16960061
169700         WHEN OTHER                                               16970061
169800             MOVE '8200-XCTL'                                     16980061
169900                                      TO DP013-PARAGRAPH          16990061
170000             MOVE 'PCKRF874 - UNABLE TO XCTL TO PROGRAM: '        17000061
170100                                      TO DP013-MESSAGE-TEXT (1)   17010061
170200             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   17020061
170300             SET DP013-CICS-ABEND                                 17030061
170400                 DP013-ROLLBACK       TO TRUE                     17040061
170500             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               17050061
170600             MOVE PC-TRANS-UNAVAILABLE-MSG                        17060061
170700                                      TO AMSGLNO                  17070061
170800             SET PC233-PROCESS-SCREEN TO TRUE                     17080061
170900             MOVE -1                  TO ADOORL                   17090061
171000             PERFORM 8000-SEND-MAP                                17100061
171100             PERFORM 8100-RETURN-TRANID                           17110061
171200     END-EVALUATE.                                                17120061
171300                                                                  17130061
171400*                                                                 17140061
171500 8220-XCTL-TO-HELP.                                               17150061
171600                                                                  17160061
171700     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH       17170061
171800                                                                  17180061
171900     EXEC CICS                                                    17190061
172000         XCTL                                                     17200061
172100             PROGRAM   (PV-TRANSFER-PROGRAM)                      17210061
172200             COMMAREA  (PC192-COMMAREA)                           17220061
172300             LENGTH    (PV-COMMAREA-LENGTH)                       17230061
172400             RESP      (PV-CICS-RESPONSE)                         17240061
172500     END-EXEC.                                                    17250061
172600                                                                  17260061
172700     EVALUATE TRUE                                                17270061
172800         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 17280061
172900              CONTINUE                                            17290061
173000         WHEN OTHER                                               17300061
173100             MOVE '8220-XCTL-TO-HELP' TO DP013-PARAGRAPH          17310061
173200             MOVE 'PCKRF874 - UNABLE TO XCTL TO PROGRAM: '        17320061
173300                                      TO DP013-MESSAGE-TEXT (1)   17330061
173400             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   17340061
173500             SET DP013-CICS-ABEND                                 17350061
173600                 DP013-ROLLBACK       TO TRUE                     17360061
173700             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               17370061
173800             MOVE PC-TRANS-UNAVAILABLE-MSG                        17380061
173900                                      TO AMSGLNO                  17390061
174000             SET PC233-PROCESS-SCREEN TO TRUE                     17400061
174100             MOVE -1                  TO ADOORL                   17410061
174200             PERFORM 8000-SEND-MAP                                17420061
174300             PERFORM 8100-RETURN-TRANID                           17430061
174400     END-EVALUATE.                                                17440061
174500/                                                                 17450061
174600 9000-SOFT-ABORT.                                                 17460061
174700                                                                  17470061
174800     EXEC CICS                                                    17480061
174900         SYNCPOINT ROLLBACK                                       17490061
175000     END-EXEC                                                     17500061
175100                                                                  17510061
175200     MOVE 1                           TO PC233-PGM-MSG-NBR        17520061
175300     MOVE SQLCODE                     TO PC233-SQLCODE            17530061
175400     PERFORM 8210-XCTL-ERROR-SCREEN.                              17540061
175500                                                                  17550061
175600 9902-WRITE-CICS-LOG.                                             17560061
175700                                                                  17570061
175800     EXEC CICS                                                    17580061
175900         WRITEQ TD                                                17590061
176000             QUEUE  ('CSSL')                                      17600061
176100             FROM   (PV-LOG-MSG-2)                                17610061
176200             RESP   (PV-CICS-RESPONSE)                            17620061
176300     END-EXEC.                                                    17630061
176400                                                                  17640061
176500 9903-WRITE-CICS-LOG.                                             17650061
176600                                                                  17660061
176700     MOVE SQLCODE                     TO PV-SQLCODE.              17670061
176800     MOVE PC233-DOOR-ID               TO PV-DISPLAY-DOOR.         17680061
176900     MOVE PC233-TRIP-ID               TO PV-DISPLAY-TRP.          17690061
177000     MOVE PC233-LAST-PROGRAM          TO PV-DISPLAY-LAST.         17700061
177100                                                                  17710061
177200     EXEC CICS                                                    17720061
177300         WRITEQ TD                                                17730061
177400             QUEUE  ('CSSL')                                      17740061
177500             FROM   (PV-LOG-MSG)                                  17750061
177600             RESP   (PV-CICS-RESPONSE)                            17760061
177700     END-EXEC.                                                    17770061
177800                                                                  17780061
177900 9904-WRITE-DEBUG.                                                17790061
178000                                                                  17800061
178100     EXEC CICS                                                    17810061
178200         WRITEQ TD                                                17820061
178300             QUEUE  ('CSSL')                                      17830061
178400             FROM   (PV-DEBUG-MSG)                                17840061
178500             RESP   (PV-CICS-RESPONSE)                            17850061
178600     END-EXEC.                                                    17860061
178700                                                                  17870061
178800     EXEC CICS                                                    17880061
178900         WRITEQ TD                                                17890061
179000             QUEUE  ('CSSL')                                      17900061
179100             FROM   (PV-DEBUG-MSG2)                               17910061
179200             RESP   (PV-CICS-RESPONSE)                            17920061
179300     END-EXEC.                                                    17930061
179400                                                                  17940061
179500 9905-WRITE-CICS-LOG.                                             17950061
179600                                                                  17960061
179700     EXEC CICS                                                    17970061
179800         WRITEQ TD                                                17980061
179900             QUEUE  ('CSSL')                                      17990061
180000             FROM   (PV-LOG-MSG-3)                                18000061
180100             RESP   (PV-CICS-RESPONSE)                            18010061
180200     END-EXEC.                                                    18020061
180300                                                                  18030061
180310                                                                  18031061
180320 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  18032061
180330                                                                  18033061
180340     MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.           18034061
180350     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          18035061
180360     INITIALIZE DP013-SRC-TASK-NUMBER                             18036061
180370                DP013-STACK.                                      18037061
180380     SET DP013-LINK-RETURN            TO TRUE.                    18038061
180390                                                                  18039061
180400     EXEC CICS                                                    18040061
180500         LINK                                                     18050061
180600             PROGRAM   (DP013-NAME)                               18060061
180700             COMMAREA  (DP013-PARAMETERS)                         18070061
180800             LENGTH    (DP013-LENGTH)                             18080061
180900     END-EXEC.                                                    18090061
