000701***************************************************************** 00070101
000702 IDENTIFICATION DIVISION.                                         00070201
000703***************************************************************** 00070301
000704 PROGRAM-ID.    SUKUT048.                                         00070401
000705 AUTHOR.        PATRICK BURKE.                                    00070501
000706 INSTALLATION.  KOHLS.                                            00070601
000800 DATE-WRITTEN   APRIL 2001.                                       00080001
000900 DATE-COMPILED.                                                   00090001
001000***************************************************************** 00100001
001100*  THIS PROGRAM CREATES AN EXTRACT FILE OF DATA FROM THE TABLE  * 00110001
001200*  TSHUNLO THAT PULLS CHECKED IN CARTONS FOR A SPECIFIC DAY     * 00120008
001800***************************************************************** 00180001
002400 ENVIRONMENT DIVISION.                                            00240001
002500***************************************************************** 00250001
002600 INPUT-OUTPUT SECTION.                                            00260001
002700                                                                  00270001
002800 FILE-CONTROL.                                                    00280001
002900                                                                  00290001
003100     SELECT EXTRACT-FILE   ASSIGN TO OUT01.                       00310001
003200                                                                  00320001
003300***************************************************************** 00330001
003400 DATA DIVISION.                                                   00340001
003500***************************************************************** 00350001
003600 FILE SECTION.                                                    00360001
003700*                                                                 00370001
004500*                                                                 00450001
004600 FD  EXTRACT-FILE                                                 00460001
004700     RECORDING MODE IS F                                          00470001
004800     LABEL RECORDS ARE STANDARD                                   00480001
005000     BLOCK CONTAINS 0 RECORDS.                                    00500001
005200 01  EXTRACT-RECORD              PIC X(150).                      00520001
005300*                                                                 00530001
005400***************************************************************** 00540001
005500 WORKING-STORAGE SECTION.                                         00550001
005600                                                                  00560001
005700 01  PS-PROGRAM-SWITCHES.                                         00570001
006100     05  PS-NORMAL-RUN-SW             PIC X(01)  VALUE 'N'.       00610001
006200         88  PS-NORMAL-RUN                       VALUE 'Y'.       00620001
006300         88  PS-SPECIAL-RUN                      VALUE 'N'.       00630001
006400     05  PS-EOF-EXTRACT-SW            PIC X(01)  VALUE 'N'.       00640001
006500         88  PS-EOF-EXTRACT-CSR                  VALUE 'Y'.       00650001
006600         88  PS-NOT-EOF-EXTRACT-CSR              VALUE 'N'.       00660001
006610     05  PS-EOF-TSULBXF-SW            PIC X(01)  VALUE 'N'.       00661008
006620         88  PS-EOF-TSULBXF-CSR                  VALUE 'Y'.       00662008
006630         88  PS-NOT-EOF-TSULBXF-CSR              VALUE 'N'.       00663008
006700     05  PS-INITIAL-FETCH-SW          PIC X(01)  VALUE 'N'.       00670002
006800         88  PS-INITIAL-FETCH                    VALUE 'Y'.       00680002
006900         88  PS-NOT-INITIAL-FETCH                VALUE 'N'.       00690002
007500*                                                                 00750001
007600 01  PV-PROGRAM-VARIABLES.                                        00760001
007700     05 PV-PREVIOUS-PO                PIC S9(09) COMP.            00770017
007701     05 PV-CURRENT-PO                 PIC S9(09) COMP.            00770117
007711     05 PV-DEST-OPER-UNT-ID           PIC X(08).                  00771108
007712     05 PV-CART-LBL-TYP-CDE           PIC X(01).                  00771208
007713     05 PV-BRCDE-NBR                  PIC X(22).                  00771308
007714     05 PV-SHIPT-UNT-ID-X             PIC X(18).                  00771410
007715     05 PV-SHIPT-UNT-ID               PIC S9(18)V COMP-3.         00771510
007716                                                                  00771633
007717     05  PV-DEPT-NBR                  PIC 9(04).                  00771733
007718     05  PV-VENDOR-NAME               PIC X(30).                  00771833
007720*                                                                 00772001
007800     05 PV-SCAN-DATE-TMST             PIC X(10).                  00780003
007900     05 PV-SCAN-TIME-TMST             PIC X(8).                   00790003
008700*                                                                 00870001
016300     05  PV-SQLCODE                   PIC 9(9)   VALUE ZERO.      01630001
016301*                                                                 01630101
016302     05  PV-FETCH-COUNTER             PIC S9(09) VALUE ZERO       01630201
016303                                                  COMP SYNC.      01630301
016304     05  PV-TSULBXF-FETCHED           PIC S9(09) VALUE ZERO       01630408
016305                                                  COMP SYNC.      01630508
016310     05  PV-WRITE-COUNTER             PIC S9(09) VALUE ZERO       01631001
016400                                                  COMP SYNC.      01640001
016410     05  PV-POS-SELECTED              PIC S9(09) VALUE ZERO       01641008
016420                                                  COMP SYNC.      01642008
016500     05  PV-DISPLAY-COUNT             PIC ZZZ,ZZZ,ZZ9.            01650001
020200                                                                  02020001
020201     05 PV-EXTRACT-DATE.                                          02020120
020203       10 PV-EXTRACT-MM               PIC 9(02) VALUE ZEROS.      02020320
020204       10 FILLER                      PIC X(01) VALUE '/'.        02020420
020205       10 PV-EXTRACT-DD               PIC 9(02) VALUE ZEROS.      02020520
020206       10 FILLER                      PIC X(01) VALUE '/'.        02020620
020207       10 PV-EXTRACT-CCYY             PIC 9(04) VALUE ZEROS.      02020720
020208                                                                  02020819
020209     05 PV-PROC-DATE                  PIC X(10) VALUE SPACE.      02020920
020210                                                                  02021020
020211     05 PV-PROCESS-DATE.                                          02021120
020212       10 PV-PROC-CCYY                PIC X(04) VALUE SPACE.      02021220
020213       10 FILLER                      PIC X(01) VALUE SPACE.      02021320
020214       10 PV-PROC-MM                  PIC X(02) VALUE SPACE.      02021420
020215       10 FILLER                      PIC X(01) VALUE SPACE.      02021520
020216       10 PV-PROC-DD                  PIC X(02) VALUE SPACE.      02021620
020217                                                                  02021719
020218 01  DN-DB2-NULL-INDICATORS.                                      02021801
020219     05  DN-VEH-NBR                   PIC S9(04) COMP VALUE +0.   02021901
020220                                                                  02022001
020300 01 PC-PROGRAM-CONSTANTS.                                         02030001
020400     05  PC-PROGRAM-NAME             PIC X(08)  VALUE 'SUKUT048'. 02040003
021000     05  PC-DEFAULT-CC-DATE          PIC X(10) VALUE '9999-09-09'.02100001
021200                                                                  02120001
023400 01  PV-ABEND-FIELDS.                                             02340001
023500     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         02350001
023600                                                 COMP SYNC.       02360001
023700     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'SUKUT048'.02370001
023800     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    02380001
023900     05  PV-ABEND-OPERATION           PIC  X(51) VALUE SPACES.    02390001
026800******************************************************************02680001
026900*  USED FOR DB2 ERROR MESSAGE BUILDING                            02690001
027000******************************************************************02700001
027100     COPY DPWS004.                                                02710045
027200                                                                  02720001
027300******************************************************************02730001
027400*   DB2 SQL COMMUNICATION AREA                                    02740001
027500******************************************************************02750001
027600     EXEC SQL                                                     02760001
027700          INCLUDE SQLCA                                           02770001
027800     END-EXEC.                                                    02780001
027900                                                                  02790001
028610******************************************************************02861001
028620*   DB2 DCLGEN                                                    02862001
028630******************************************************************02863001
028640     EXEC SQL                                                     02864001
028650          INCLUDE TSHUNLO                                         02865001
028660     END-EXEC.                                                    02866001
028670                                                                  02867001
028680******************************************************************02868001
028690*   DB2 DCLGEN                                                    02869001
028691******************************************************************02869101
028692     EXEC SQL                                                     02869201
028693          INCLUDE TINPKSU                                         02869308
028694     END-EXEC.                                                    02869401
028695                                                                  02869501
029400******************************************************************02940001
029500*   DB2 DCLGEN FOR PACKSLIP TABLE                                 02950001
029600******************************************************************02960001
029700     EXEC SQL                                                     02970001
029800          INCLUDE TPKSLIP                                         02980001
029900     END-EXEC.                                                    02990001
030000                                                                  03000001
030010******************************************************************03001001
030020*   DB2 DCLGEN FOR SHIP UNIT TABLE                                03002001
030030******************************************************************03003001
030040     EXEC SQL                                                     03004001
030050          INCLUDE TSHPUNT                                         03005001
030060     END-EXEC.                                                    03006001
030070                                                                  03007001
031500******************************************************************03150001
031600*   DB2 DCLGEN                                                    03160001
031700******************************************************************03170001
031800     EXEC SQL                                                     03180001
031900          INCLUDE TPURCHS                                         03190001
032000     END-EXEC.                                                    03200001
032010                                                                  03201001
032020******************************************************************03202001
032030*   DB2 DCLGEN                                                    03203001
032040******************************************************************03204001
032050     EXEC SQL                                                     03205001
032060          INCLUDE TENTNME                                         03206001
032070     END-EXEC.                                                    03207001
032080                                                                  03208001
032090******************************************************************03209001
032091*   DB2 DCLGEN                                                    03209101
032092******************************************************************03209201
032093     EXEC SQL                                                     03209301
032094          INCLUDE TSULBXF                                         03209401
032095     END-EXEC.                                                    03209501
032096                                                                  03209601
032097******************************************************************03209701
032098*   DB2 DCLGEN                                                    03209801
032099******************************************************************03209901
032100     EXEC SQL                                                     03210001
032101          INCLUDE TCOCNTL                                         03210101
032102     END-EXEC.                                                    03210201
032103                                                                  03210301
032110******************************************************************03211001
032200* EXTRACT CURSOR                                                 *03220001
032300******************************************************************03230001
032400     EXEC SQL                                                     03240001
032500          DECLARE EXTRACT-CSR CURSOR FOR                          03250001
032600          SELECT A.SHIPT_UNT_ID,                                  03260001
032700                 A.OPER_UNT_ID,                                   03270001
032900                 DATE(A.CRE_TMST),                                03290001
033000                 TIME(A.CRE_TMST),                                03300001
033200                 A.TRIP_ID,                                       03320001
033300                 B.PO_NBR,                                        03330001
033400                 B.SEQ_NBR,                                       03340001
033410                 C.REC_SEQ_NBR,                                   03341001
033420                 C.PKSL_STAT_CDE,                                 03342001
033500                 D.ORGN_OPER_UNT_ID,                              03350001
033600                 D.DEST_OPER_UNT_ID                               03360010
033700          FROM   TSHUNLO A,                                       03370001
033720                 TINPKSU B,                                       03372001
033730                 TPKSLIP C,                                       03373001
033750                 TSHPUNT D                                        03375001
033760          WHERE DATE(A.CRE_TMST)   =  :PV-PROC-DATE               03376020
033770            AND A.SCN_LOC_ID       = 'RECV'                       03377044
033780            AND A.ACTV_CDE         = 'A'                          03378044
033900            AND B.SHIPT_UNT_ID     =  A.SHIPT_UNT_ID              03390001
034300            AND C.PO_NBR           =  B.PO_NBR                    03430001
034301            AND C.SEQ_NBR          =  B.SEQ_NBR                   03430101
034302            AND ((C.REC_SEQ_NBR    =  0                           03430201
034303            AND C.PKSL_STAT_CDE    =  'AC'                        03430301
034304            AND C.VER_STAT_CDE     =  'A')                        03430401
034305             OR (C.VER_STAT_CDE    =  'A'                         03430501
034306            AND C.PKSL_STAT_CDE    =  'IN'))                      03430610
034308            AND D.SHIPT_UNT_ID     =  A.SHIPT_UNT_ID              03430810
034309          ORDER BY 6,8,7,1                                        03430943
034310     END-EXEC.                                                    03431001
034400                                                                  03440001
034410******************************************************************03441007
034420* TSULBXF CURSOR                                                 *03442007
034430******************************************************************03443007
034431*                                                                 03443107
034440     EXEC SQL                                                     03444007
034450          DECLARE TSULBXF-CSR CURSOR FOR                          03445008
034600           SELECT  A.DEST_OPER_UNT_ID,                            03460008
034700                   A.CART_LBL_TYP_CDE,                            03470008
034800                   A.BRCDE_NBR                                    03480008
034920           FROM TSULBXF A                                         03492007
034921            WHERE  A.SHIPT_UNT_ID  = :PV-SHIPT-UNT-ID             03492110
034930     END-EXEC.                                                    03493010
034940*                                                                 03494007
035000***********************************************************       03500001
035100*  COPYBOOK USED IN CREATING EXTRACT FILE.                *       03510001
035200***********************************************************       03520001
035300     COPY SURD016.                                                03530045
035400                                                                  03540001
035500 EJECT                                                            03550001
035600***********************************************************       03560001
035700 PROCEDURE DIVISION.                                              03570001
035800***********************************************************       03580001
035900     DISPLAY '***BEGINNING SUKUT048***'.                          03590001
036000*                                                                 03600001
036100     PERFORM 1000-INITIALIZATION.                                 03610001
036200*                                                                 03620001
036300     SET PS-NOT-EOF-EXTRACT-CSR TO TRUE.                          03630001
036400     PERFORM 1900-OPEN-EXTRACT-CURSOR.                            03640001
036410     PERFORM 1950-INITIAL-FETCH.                                  03641002
036411     IF PS-EOF-EXTRACT-CSR                                        03641134
036412        CONTINUE                                                  03641234
036413     ELSE                                                         03641334
036420        PERFORM 2200-LOAD-EXTRACT-RECORD                          03642034
036430        WRITE EXTRACT-RECORD FROM SU016-EXTRACT-RECORD            03643034
036440        ADD +1 TO PV-WRITE-COUNTER                                03644034
036600        PERFORM 2000-PROCESS-EXTRACTS                             03660034
036700            UNTIL PS-EOF-EXTRACT-CSR.                             03670034
036800                                                                  03680034
036900     PERFORM 3000-CLOSE-EXTRACT-CURSOR.                           03690008
037100     CLOSE EXTRACT-FILE.                                          03710001
037200                                                                  03720034
037400     GOBACK.                                                      03740001
037500*                                                                 03750001
038601******************************************************************03860101
038602*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    03860201
038603******************************************************************03860301
038605 1000-INITIALIZATION.                                             03860501
038607                                                                  03860701
038608     OPEN OUTPUT EXTRACT-FILE.                                    03860801
038611                                                                  03861101
038617     DISPLAY '**************************************'.            03861701
038618     DISPLAY '*        PROGRAM - SUKUT048          *'.            03861801
038619     DISPLAY '**************************************'.            03861901
038620     DISPLAY '                                      '.            03862001
038621                                                                  03862101
038622     PERFORM 1200-SELECT-EXTRACT-DATE.                            03862214
038623                                                                  03862314
038624     DISPLAY 'EXTRACT DATE FOR THIS RUN IS:  '                    03862403
038625             PV-EXTRACT-DATE.                                     03862520
038640*                                                                 03864008
043900***************************************************************** 04390001
044000 1200-SELECT-EXTRACT-DATE.                                        04400003
044100***************************************************************** 04410001
044300*                                                                 04430001
044602         EXEC SQL                                                 04460201
044610           SELECT DISTINCT(BTCH_PRC_DTE -1 DAY)                   04461010
044620             INTO :PV-PROC-DATE                                   04462020
044630           FROM TCOCNTL                                           04463001
044640         END-EXEC                                                 04464001
045001                                                                  04500101
045002     EVALUATE TRUE                                                04500201
045003         WHEN SQLCODE = ZERO                                      04500301
045004             SET SU016-HEADER-RECORD TO TRUE                      04500403
045005             MOVE PV-PROC-DATE       TO PV-PROCESS-DATE           04500520
045006             MOVE PV-PROC-CCYY       TO PV-EXTRACT-CCYY           04500620
045007             MOVE PV-PROC-MM         TO PV-EXTRACT-MM             04500720
045008             MOVE PV-PROC-DD         TO PV-EXTRACT-DD             04500820
045009**************************************************************    04500929
045010*  FOR TESTING PURPOSES ONLY.                                     04501029
045011**************************************************************    04501129
045012*            MOVE  '05/26/2001'      TO PV-EXTRACT-DATE           04501241
045013*                                       PV-PROC-DATE              04501341
045014**************************************************************    04501439
045015             MOVE PV-EXTRACT-DATE    TO SU016-SCAN-DATE           04501539
045016             WRITE EXTRACT-RECORD    FROM SU016-EXTRACT-RECORD    04501639
045017         WHEN SQLWARN0 NOT = SPACES                               04501739
045018         WHEN SQLCODE < ZERO                                      04501839
045019         WHEN SQLCODE > ZERO                                      04501939
045020             MOVE '1200-SELECT-EXTRACT-DATE'                      04502039
045021                                 TO PV-ABEND-PARAGRAPH            04502139
045022             MOVE 'ATTEMPTING TO SELECT BATCH PROCESS DATE        04502239
045023-                 'FROM TCOCNTL'                                  04502339
045024                                 TO PV-ABEND-OPERATION            04502439
045030             PERFORM Z999-SQL-ABEND                               04503001
045100     END-EVALUATE.                                                04510001
046300*                                                                 04630001
068800***************************************************************** 06880001
068900 1900-OPEN-EXTRACT-CURSOR.                                        06890001
069000***************************************************************** 06900001
069400*                                                                 06940001
069500     EXEC SQL                                                     06950001
069600         OPEN EXTRACT-CSR                                         06960001
069700     END-EXEC.                                                    06970001
069800*                                                                 06980001
069900     EVALUATE TRUE                                                06990001
070000         WHEN SQLCODE = +0                                        07000001
070010             CONTINUE                                             07001001
070400         WHEN SQLWARN0 NOT = SPACE                                07040001
070500         WHEN SQLCODE  NOT = +0                                   07050001
070600             MOVE '1900-OPEN-EXTRACT-CURSOR'                      07060001
070700                                 TO PV-ABEND-PARAGRAPH            07070001
071000             PERFORM Z999-SQL-ABEND                               07100001
071100     END-EVALUATE.                                                07110001
071200*                                                                 07120001
071300*                                                                 07130001
071310***************************************************************** 07131002
071320 1950-INITIAL-FETCH.                                              07132002
071330***************************************************************** 07133002
071331     INITIALIZE DCLTSHUNLO.                                       07133113
071350*                                                                 07135002
071360     EXEC SQL                                                     07136002
071370          FETCH EXTRACT-CSR                                       07137002
071380           INTO  :SHUNLO-SHIPT-UNT-ID,                            07138002
071390                 :SHUNLO-OPER-UNT-ID,                             07139002
071391                 :PV-SCAN-DATE-TMST,                              07139103
071392                 :PV-SCAN-TIME-TMST,                              07139203
071393                 :SHUNLO-TRIP-ID,                                 07139302
071394                 :INPKSU-PO-NBR,                                  07139402
071395                 :INPKSU-SEQ-NBR,                                 07139502
071396                 :PKSLIP-REC-SEQ-NBR,                             07139602
071397                 :PKSLIP-PKSL-STAT-CDE,                           07139702
071398                 :SHPUNT-ORGN-OPER-UNT-ID,                        07139802
071399                 :SHPUNT-DEST-OPER-UNT-ID                         07139902
071400     END-EXEC.                                                    07140002
071401*                                                                 07140102
071402     EVALUATE TRUE                                                07140202
071403         WHEN SQLCODE = +0                                        07140302
071405              SET PS-INITIAL-FETCH  TO TRUE                       07140502
071406              MOVE INPKSU-PO-NBR TO PV-PREVIOUS-PO                07140608
071407                                    PV-CURRENT-PO                 07140724
071408              MOVE SHUNLO-SHIPT-UNT-ID TO PV-SHIPT-UNT-ID         07140824
071409              PERFORM 4000-SELECT-TPURCHS-TENTNME                 07140924
071410              PERFORM 4100-OPEN-TSULBXF-CURSOR                    07141024
071411              PERFORM 4300-FETCH-TSULBXF-CURSOR                   07141124
071412              ADD +1 TO PV-FETCH-COUNTER                          07141224
071413         WHEN SQLCODE = +100                                      07141324
071414              SET PS-EOF-EXTRACT-CSR TO TRUE                      07141424
071415         WHEN SQLWARN0 NOT = SPACE                                07141524
071416         WHEN SQLCODE  NOT = +0                                   07141624
071417              MOVE '1950-INITIAL-FETCH'                           07141724
071418                                   TO PV-ABEND-PARAGRAPH          07141824
071419              MOVE 'ATTEMPTING TO FETCH EXTRACT CURSOR'           07141924
071420                                   TO PV-ABEND-OPERATION          07142024
071421              PERFORM Z999-SQL-ABEND                              07142124
071422     END-EVALUATE.                                                07142224
071423*                                                                 07142324
071430***************************************************************** 07143008
071500 2000-PROCESS-EXTRACTS.                                           07150001
071600***************************************************************** 07160001
071700     MOVE '2000-PROCESS-EXTRACTS   ' TO PV-ABEND-PARAGRAPH.       07170001
071800*                                                                 07180001
071810     INITIALIZE SU016-EXTRACT-RECORD                              07181026
071900     PERFORM 2100-FETCH-EXTRACT-CURSOR.                           07190008
072000*                                                                 07200001
072100     IF PS-NOT-EOF-EXTRACT-CSR                                    07210001
072300         PERFORM 4300-FETCH-TSULBXF-CURSOR                        07230008
072400         PERFORM 2200-LOAD-EXTRACT-RECORD                         07240008
072500         WRITE EXTRACT-RECORD FROM SU016-EXTRACT-RECORD           07250008
072510         ADD +1 TO PV-WRITE-COUNTER                               07251008
072520     ELSE                                                         07252018
072530         PERFORM 4200-CLOSE-TSULBXF-CURSOR                        07253018
072600     END-IF.                                                      07260001
072700*                                                                 07270001
072800*                                                                 07280001
072900***************************************************************** 07290001
073000 2100-FETCH-EXTRACT-CURSOR.                                       07300008
073100***************************************************************** 07310001
073200     INITIALIZE DCLTSHUNLO.                                       07320012
073300*                                                                 07330001
073400     EXEC SQL                                                     07340001
073500          FETCH EXTRACT-CSR                                       07350001
073600           INTO  :SHUNLO-SHIPT-UNT-ID,                            07360001
073700                 :SHUNLO-OPER-UNT-ID,                             07370001
074010                 :PV-SCAN-DATE-TMST,                              07401003
074020                 :PV-SCAN-TIME-TMST,                              07402003
074200                 :SHUNLO-TRIP-ID,                                 07420001
074900                 :INPKSU-PO-NBR,                                  07490001
074901                 :INPKSU-SEQ-NBR,                                 07490101
074902                 :PKSLIP-REC-SEQ-NBR,                             07490201
074903                 :PKSLIP-PKSL-STAT-CDE,                           07490301
074904                 :SHPUNT-ORGN-OPER-UNT-ID,                        07490401
074906                 :SHPUNT-DEST-OPER-UNT-ID                         07490601
074912     END-EXEC.                                                    07491201
074913*                                                                 07491301
074920     EVALUATE TRUE                                                07492001
075000         WHEN SQLCODE = +0                                        07500001
075001             MOVE INPKSU-PO-NBR TO PV-CURRENT-PO                  07500103
075002             MOVE SHUNLO-SHIPT-UNT-ID TO PV-SHIPT-UNT-ID          07500210
075003             ADD +1 TO PV-FETCH-COUNTER                           07500309
075004             PERFORM 2300-CHECK-FOR-PREVIOUS                      07500409
075200         WHEN SQLCODE = +100                                      07520001
075300              SET PS-EOF-EXTRACT-CSR TO TRUE                      07530001
075400         WHEN SQLWARN0 NOT = SPACE                                07540001
075500         WHEN SQLCODE  NOT = +0                                   07550001
075600              MOVE '2100-FETCH-EXTRACT-CURSOR'                    07560008
075700                                   TO PV-ABEND-PARAGRAPH          07570001
075800              MOVE 'ATTEMPTING TO FETCH EXTRACT CURSOR'           07580001
075900                                   TO PV-ABEND-OPERATION          07590001
076200              PERFORM Z999-SQL-ABEND                              07620001
076300     END-EVALUATE.                                                07630001
076400*                                                                 07640001
076500*                                                                 07650001
076600***************************************************************** 07660001
076700 2200-LOAD-EXTRACT-RECORD.                                        07670001
076800***************************************************************** 07680001
076900     MOVE '2200-LOAD-EXTRACT-RCD   ' TO PV-ABEND-PARAGRAPH.       07690001
077000*                                                                 07700001
077100     SET SU016-DETAIL-RECORD      TO TRUE.                        07710003
077200     MOVE PV-CURRENT-PO           TO SU016-PO-NBR.                07720003
077203     MOVE SHUNLO-SHIPT-UNT-ID     TO SU016-SHIPT-UNT-ID.          07720320
077204     MOVE SHUNLO-TRIP-ID          TO SU016-TRIP-ID.               07720420
077205                                                                  07720540
077511     MOVE PV-SCAN-DATE-TMST       TO PV-PROCESS-DATE.             07751140
077512     MOVE PV-PROC-CCYY            TO PV-EXTRACT-CCYY.             07751240
077513     MOVE PV-PROC-MM              TO PV-EXTRACT-MM.               07751340
077514     MOVE PV-PROC-DD              TO PV-EXTRACT-DD.               07751440
077515     MOVE PV-EXTRACT-DATE         TO SU016-SCAN-DATE.             07751540
077516                                                                  07751640
077520     MOVE PV-SCAN-TIME-TMST       TO SU016-SCAN-TIME.             07752003
077530     MOVE SHUNLO-OPER-UNT-ID      TO SU016-SCAN-DC-NBR.           07753020
077600     MOVE SHPUNT-ORGN-OPER-UNT-ID TO SU016-ORIGIN-DC-NBR.         07760008
077700     MOVE SHPUNT-DEST-OPER-UNT-ID TO SU016-DESTIN-DC-NBR.         07770007
077701     MOVE SULBXF-BRCDE-NBR        TO SU016-BRCDE-NBR.             07770108
077702                                                                  07770208
077703     MOVE PV-DEPT-NBR            TO SU016-DEPT-NBR.               07770333
077704     MOVE PV-VENDOR-NAME         TO SU016-VENDOR-NAME.            07770433
077705                                                                  07770533
077710     IF SULBXF-CART-LBL-TYP-CDE  = 'P'                            07771028
078000         SET SU016-ASSIGN-P2L   TO TRUE                           07800008
078001     ELSE                                                         07800107
078002         MOVE SULBXF-DEST-OPER-UNT-ID TO                          07800208
078003                                SU016-ASSIGN-TEXT.                07800307
078005*                                                                 07800501
078006***************************************************************** 07800603
078007* CHECK TO SEE IF IF THERE IS CHANGE IN THE PURCHASE ORDER NUMBER 07800703
078008* FROM THE ROWS BEING RETURNED FROM THE CURSOR.                   07800803
078009***************************************************************** 07800903
078010 2300-CHECK-FOR-PREVIOUS.                                         07801003
078011*                                                                 07801103
078012     IF PV-CURRENT-PO  = PV-PREVIOUS-PO                           07801208
078013        CONTINUE                                                  07801303
078014     ELSE                                                         07801403
078015        MOVE PV-CURRENT-PO  TO  PV-PREVIOUS-PO                    07801508
078016        PERFORM 4000-SELECT-TPURCHS-TENTNME.                      07801603
078017                                                                  07801703
078020***************************************************************** 07802002
082300 3000-CLOSE-EXTRACT-CURSOR.                                       08230008
082400***************************************************************** 08240001
082500     DISPLAY '3000-CLOSE-EXTRACT-CSR'.                            08250001
082600*                                                                 08260001
082700     EXEC SQL                                                     08270001
082800         CLOSE EXTRACT-CSR                                        08280001
082900     END-EXEC                                                     08290001
082901*                                                                 08290101
082902      MOVE PV-FETCH-COUNTER TO PV-DISPLAY-COUNT.                  08290201
082903      DISPLAY 'FETCH ROUTINE TOTAL '            PV-DISPLAY-COUNT. 08290301
082904      MOVE PV-WRITE-COUNTER TO PV-DISPLAY-COUNT.                  08290401
082905      DISPLAY 'TOTAL EXTRACT RECORDS WRITTEN '  PV-DISPLAY-COUNT. 08290501
082906      DISPLAY 'FETCH TOTAL SHOULD EQUAL WRITE TOTAL '.            08290601
083000*                                                                 08300001
083100     EVALUATE TRUE                                                08310001
083200         WHEN SQLCODE = ZERO                                      08320001
083300             CONTINUE                                             08330001
083400         WHEN OTHER                                               08340001
083500             PERFORM Z999-SQL-ABEND                               08350001
083600     END-EVALUATE.                                                08360001
083700*                                                                 08370001
083900***************************************************************** 08390002
084000 4000-SELECT-TPURCHS-TENTNME.                                     08400003
084100***************************************************************** 08410002
084200*                                                                 08420003
084210         EXEC SQL                                                 08421002
084220           SELECT  A.DEPT_NBR,                                    08422002
084221                   B.ENT_NAME_DESC                                08422102
084231             INTO  :PURCHS-DEPT-NBR,                              08423102
084232                   :ENTNME-ENT-NAME-DESC                          08423202
084240           FROM TPURCHS A,                                        08424010
084241                TENTNME B                                         08424102
084242           WHERE  A.PO_NBR         = :PV-CURRENT-PO               08424223
084243             AND  A.VER_STATUS_CDE = 'A'                          08424316
084244             AND  B.ENT_ID         = A.ENT_ID                     08424416
084245             AND  B.TYPE_CDE       = '01'                         08424517
084250         END-EXEC                                                 08425002
084300                                                                  08430002
084400     EVALUATE TRUE                                                08440002
084500         WHEN SQLCODE = +0                                        08450002
084510             MOVE PURCHS-DEPT-NBR      TO PV-DEPT-NBR             08451033
084520             MOVE ENTNME-ENT-NAME-DESC TO PV-VENDOR-NAME          08452033
084600             ADD +1 TO PV-POS-SELECTED                            08460002
084800         WHEN SQLCODE = +100                                      08480002
084900              CONTINUE                                            08490003
085000         WHEN SQLWARN0 NOT = SPACE                                08500002
085100         WHEN SQLCODE  NOT = +0                                   08510002
085200              MOVE '4000-SELECT-TPURCHS-TENTNME'                  08520003
085300                                   TO PV-ABEND-PARAGRAPH          08530002
085400              MOVE ' SELECT DEPARTMENT NAME AND VENDOR NUMBER'    08540003
085500                                   TO PV-ABEND-OPERATION          08550002
085600              PERFORM Z999-SQL-ABEND                              08560002
085700     END-EVALUATE.                                                08570002
085800*                                                                 08580002
085900***************************************************************** 08590005
086000 4100-OPEN-TSULBXF-CURSOR.                                        08600008
086100***************************************************************** 08610005
086210*                                                                 08621007
086220     EXEC SQL                                                     08622007
086230         OPEN TSULBXF-CSR                                         08623007
086240     END-EXEC.                                                    08624007
086250*                                                                 08625007
086260     EVALUATE TRUE                                                08626007
086270         WHEN SQLCODE = +0                                        08627007
086280             CONTINUE                                             08628007
086290         WHEN SQLWARN0 NOT = SPACE                                08629007
086291         WHEN SQLCODE  NOT = +0                                   08629107
086292             MOVE '4100-OPEN-TSULBXF-CURSOR'                      08629208
086293                                 TO PV-ABEND-PARAGRAPH            08629307
086294             PERFORM Z999-SQL-ABEND                               08629407
086295     END-EVALUATE.                                                08629507
086296*                                                                 08629607
086297***************************************************************** 08629707
086299 4200-CLOSE-TSULBXF-CURSOR.                                       08629907
086300***************************************************************** 08630007
086302*                                                                 08630207
086303     EXEC SQL                                                     08630307
086304         CLOSE TSULBXF-CSR                                        08630407
086305     END-EXEC                                                     08630507
086312*                                                                 08631207
086313     EVALUATE TRUE                                                08631307
086314         WHEN SQLCODE = ZERO                                      08631407
086315             CONTINUE                                             08631507
086316         WHEN OTHER                                               08631607
086317             PERFORM Z999-SQL-ABEND                               08631707
086318     END-EVALUATE.                                                08631807
086319                                                                  08631907
086320*                                                                 08632007
086321***************************************************************** 08632107
086322 4300-FETCH-TSULBXF-CURSOR.                                       08632207
086323***************************************************************** 08632307
086324     MOVE '4300-FETCH-TSULBXF-CURSOR' TO PV-ABEND-PARAGRAPH.      08632407
086325*                                                                 08632507
086326     EXEC SQL                                                     08632607
086327          FETCH TSULBXF-CSR                                       08632707
086328           INTO  :SULBXF-DEST-OPER-UNT-ID,                        08632808
086329                 :SULBXF-CART-LBL-TYP-CDE,                        08632908
086330                 :SULBXF-BRCDE-NBR                                08633008
086339     END-EXEC.                                                    08633907
086340*                                                                 08634007
086341     EVALUATE TRUE                                                08634107
086342         WHEN SQLCODE = +0                                        08634207
086343              MOVE SULBXF-DEST-OPER-UNT-ID TO PV-DEST-OPER-UNT-ID 08634308
086345              ADD +1 TO PV-TSULBXF-FETCHED                        08634508
086348         WHEN SQLCODE = +100                                      08634808
086349              SET PS-EOF-TSULBXF-CSR TO TRUE                      08634908
086351         WHEN SQLWARN0 NOT = SPACE                                08635107
086352         WHEN SQLCODE  NOT = +0                                   08635207
086353              MOVE '4300-FETCH-TSULBXF-CURSOR'                    08635307
086354                                   TO PV-ABEND-PARAGRAPH          08635407
086355              MOVE 'ATTEMPTING TO FETCH TSULBXF CURSOR'           08635507
086356                                   TO PV-ABEND-OPERATION          08635607
086357              PERFORM Z999-SQL-ABEND                              08635707
086358     END-EVALUATE.                                                08635807
086359*                                                                 08635907
086601*                                                                 08660105
086610***************************************************************** 08661004
086700 Z999-SQL-ABEND.                                                  08670001
086800***************************************************************** 08680001
086900                                                                  08690001
087000     MOVE SQLCODE TO PV-SQLCODE.                                  08700001
087100     DISPLAY '*** DB2 ERROR '.                                    08710001
087200     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       08720001
087300     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 08730001
087400     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               08740001
087500     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               08750001
088500                                                                  08850001
088600     COPY DPPD004.                                                08860045
088700                                                                  08870001
088800                                                                  08880001
088900     MOVE +4013                  TO PV-ABEND-CODE.                08890001
089000     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         08900001
