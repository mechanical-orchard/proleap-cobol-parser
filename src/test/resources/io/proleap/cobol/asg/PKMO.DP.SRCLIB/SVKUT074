000100******************************************************************00010031
000200******************************************************************00020031
000300 IDENTIFICATION DIVISION.                                         00030031
000400******************************************************************00040031
000500******************************************************************00050031
000600                                                                  00060031
000700 PROGRAM-ID.     SVKUT074.                                        00070031
000800 AUTHOR.         MADHURA PETHE.                                   00080031
000900 INSTALLATION.   KOHLS DEPARTMENT STORES.                         00090031
001000 DATE-WRITTEN.   07/10/12.                                        00100031
001100 DATE-COMPILED.                                                   00110031
001200                                                                  00120031
001300******************************************************************00130031
001400*  THIS PROGRAM UNSTRINGS A COMMA DELIMITED EXTRACT FROM INCOMM  *00140031
001500******************************************************************00150031
001600*  CHANGES:                                                       00160031
001700*                                                                 00170031
001800******************************************************************00180031
001900******************************************************************00190031
002000 ENVIRONMENT DIVISION.                                            00200031
002100******************************************************************00210031
002200******************************************************************00220031
002300                                                                  00230031
002400******************************************************************00240031
002500 CONFIGURATION SECTION.                                           00250031
002600******************************************************************00260031
002700                                                                  00270031
002800 SOURCE-COMPUTER.        IBM-3090.                                00280031
002900 OBJECT-COMPUTER.        IBM-3090.                                00290031
003000                                                                  00300031
003100******************************************************************00310031
003200 INPUT-OUTPUT SECTION.                                            00320031
003300******************************************************************00330031
003400                                                                  00340031
003500 FILE-CONTROL.                                                    00350031
003600                                                                  00360031
003700     SELECT COMMA-FILE                                            00370031
003800         ASSIGN TO INP01.                                         00380031
003900                                                                  00390031
004000     SELECT FIXED-WIDTH-FILE                                      00400031
004100         ASSIGN TO OUT01.                                         00410031
004200                                                                  00420031
004300******************************************************************00430031
004400******************************************************************00440031
004500 DATA DIVISION.                                                   00450031
004600******************************************************************00460031
004700******************************************************************00470031
004800                                                                  00480031
004900******************************************************************00490031
005000 FILE SECTION.                                                    00500031
005100******************************************************************00510031
005200                                                                  00520031
005300 FD  COMMA-FILE                                                   00530031
005400     RECORDING MODE IS F                                          00540036
005500     LABEL RECORDS ARE STANDARD                                   00550031
005600     BLOCK CONTAINS 0 RECORDS.                                    00560031
005700                                                                  00570031
005800 01  COMMA-FMT-REC           PIC X(1600).                         00580036
005900                                                                  00590031
006000 FD  FIXED-WIDTH-FILE                                             00600031
006100     RECORDING MODE IS F                                          00610031
006200     LABEL RECORDS ARE STANDARD                                   00620031
006300     BLOCK CONTAINS 0 RECORDS.                                    00630031
006400                                                                  00640031
006500 01  FIXED-WIDTH-FMT-REC     PIC X(360).                          00650031
006600                                                                  00660031
006700                                                                  00670031
006800******************************************************************00680031
006900 WORKING-STORAGE SECTION.                                         00690031
007000******************************************************************00700031
007100                                                                  00710031
007200******************************************************************00720031
007300*    PC-PROGRAM CONSTANTS                                        *00730031
007400******************************************************************00740031
007500 01  PC-PROGRAM-CONSTANTS.                                        00750031
007600     05  PC-PROGRAM-NAME         PIC X(08)      VALUE 'SVKUT074'. 00760031
007700                                                                  00770031
007800 01  PS-PROGRAM-SWITCHES.                                         00780031
007900     05  PS-END-OF-COMMA-DATA-SW      PIC X(01)  VALUE 'N'.       00790031
008000         88  PS-END-OF-COMMA-DATA                VALUE 'Y'.       00800031
008100                                                                  00810031
008200                                                                  00820031
008300 01  PV-PROGRAM-VARIABLES.                                        00830031
008400     05  PV-COMMA-DATA              PIC X(1552).                  00840031
008500     05  PV-TRANS-AMOUNT-PART1      PIC X(18).                    00850036
008600     05  PV-TRANS-AMOUNT-PART2      PIC X(18).                    00860031
           05  PV-TRANS-AMOUNT-100        PIC 9(16).                    00861036
           05  PV-TRANS-AMOUNT-TOTAL      PIC 9(16).                    00861136
           05  PV-TRANS-AMOUNT-INT        PIC 9(16).                    00862036
           05  PV-TRANS-AMOUNT-DEC        PIC 9(02).                    00863036
           05  PV-TRANS-AMOUNT-FINAL      PIC 9(18)V99.                 00864036
008700     05  PV-TRANS-COUNT-PART1       PIC S9(2).                    00870031
008800     05  PV-TRANS-COUNT-PART2       PIC X(3).                     00880031
008900     05  PV-TRANS-COUNT-DISPLAY     PIC 99-.                      00890031
009000     05  PV-COUNT                   PIC 9.                        00900031
009100     05  PV-UPC                     PIC X(15).                    00910031
009200     05  PV-UPC-PART1               PIC 9(15).                    00920031
009300     05  PV-UPC-PART2               PIC X(15).                    00930031
009400     05  PV-TRANS-DATE2             PIC X(10).                    00940031
009500     05  PV-TRANS-DATE.                                           00950031
009600         10 PV-TRANS-MM             PIC 9(02) VALUE ZEROES.       00960031
009700         10 FILLER                  PIC X(01) VALUE SPACES.       00970031
009800         10 PV-TRANS-DD             PIC 9(02) VALUE ZEROES.       00980031
009900         10 FILLER                  PIC X(01) VALUE SPACES.       00990031
010000         10 PV-TRANS-YYYY           PIC 9(04) VALUE ZEROES.       01000031
010100     05  PV-REFORMAT-DATE.                                        01010031
010200         10 PV-REFORMAT-YYYY        PIC 9(04) VALUE ZEROES.       01020031
010300         10 FILLER                  PIC X(01) VALUE '/'.          01030031
010400         10 PV-REFORMAT-MM          PIC 9(02) VALUE ZEROES.       01040031
010500         10 FILLER                  PIC X(01) VALUE '/'.          01050031
010600         10 PV-REFORMAT-DD          PIC 9(02) VALUE ZEROES.       01060031
010700     05  PV-PROGRAM-ACCUMULATORS.                                 01070031
010800         10  PV-INCOMM-RECS-READ    PIC S9(11)     COMP-3         01080031
010900                                              VALUE ZEROES.       01090031
011000         10  PV-INCOMM-RECS-WRITTEN PIC S9(11)     COMP-3         01100031
011100                                              VALUE ZEROES.       01110031
011200 01  FW-FIXED-WIDTH-OUTPUT.                                       01120031
011300     05  FW-PARTNER                 PIC X(25).                    01130031
011400     05  FW-PRODUCT                 PIC X(55).                    01140031
011500     05  FW-UPC                     PIC X(15).                    01150031
011600     05  FW-VAN16                   PIC X(30).                    01160031
011700     05  FW-SERIAL-NUM              PIC X(30).                    01170031
011800     05  FW-MERCHANT                PIC X(50).                    01180031
011900     05  FW-LOCATION                PIC X(50).                    01190031
012000     05  FW-TRANS-DATE              PIC X(10).                    01200031
012100     05  FW-TRANS-TIME              PIC X(08).                    01210031
012200     05  FW-POST-DATE               PIC X(10).                    01220031
012300     05  FW-STAN                    PIC X(12).                    01230031
012400     05  FW-INCOMM-REF-NO           PIC 9(12).                    01240031
012500     05  FW-TRANS-TYPE              PIC X(30).                    01250031
012600     05  FW-TRANS-COUNT             PIC X(3).                     01260031
012700     05  FW-TRANS-AMOUNT            PIC X(18).                    01270031
012800                                                                  01280031
012900******************************************************************01290031
013000*    INCOMM SETTLEMENT RECORD LAYOUT                             *01300031
013100******************************************************************01310031
013200     COPY SVRD070.                                                01320031
013300                                                                  01330031
013400******************************************************************01340031
013500******************************************************************01350031
013600 PROCEDURE DIVISION.                                              01360031
013700******************************************************************01370031
013800******************************************************************01380031
013900                                                                  01390031
014000 0000-MAINLINE.                                                   01400031
014100                                                                  01410031
014200     PERFORM 1000-INITIALIZE.                                     01420031
014300                                                                  01430031
014400     PERFORM 2000-UNSTRING                                        01440031
014500             UNTIL PS-END-OF-COMMA-DATA.                          01450031
014600                                                                  01460031
014700     PERFORM 5000-END-OF-JOB.                                     01470031
014800                                                                  01480031
014900     STOP RUN.                                                    01490031
015000                                                                  01500031
015100                                                                  01510031
015200******************************************************************01520031
015300* GET AIM EXTRACT FOR PROCESSING                                * 01530031
015400******************************************************************01540031
015500 1000-INITIALIZE.                                                 01550031
015600                                                                  01560031
015700     OPEN INPUT  COMMA-FILE.                                      01570031
015800     OPEN OUTPUT FIXED-WIDTH-FILE.                                01580031
015900                                                                  01590031
016000     PERFORM 3000-READ-COMMA-RECORD.                              01600031
                                                                        01602035
016100                                                                  01610031
      * IGNORE HEADER RECORD                                            01611035
           IF NOT PS-END-OF-COMMA-DATA                                  01612035
              MOVE ZEROES TO PV-INCOMM-RECS-READ                        01612135
              INITIALIZE PV-COMMA-DATA                                  01612235
016000        PERFORM 3000-READ-COMMA-RECORD                            01613035
           END-IF.                                                      01615035
016200                                                                  01620031
016300******************************************************************01630031
016400* UNSTRING EXTRACT                                               *01640031
016500******************************************************************01650031
016600 2000-UNSTRING.                                                   01660031
016700                                                                  01670031
016800     UNSTRING PV-COMMA-DATA DELIMITED BY ","                      01680031
016900         INTO FW-PARTNER                                          01690031
017000              FW-PRODUCT                                          01700031
017100              FW-UPC                                              01710031
017200              FW-VAN16                                            01720031
017300              FW-SERIAL-NUM                                       01730031
017400              FW-MERCHANT                                         01740031
017500              FW-LOCATION                                         01750031
017600              FW-TRANS-DATE                                       01760031
017700              FW-TRANS-TIME                                       01770031
017800              FW-POST-DATE                                        01780031
017900              FW-STAN                                             01790031
018000              FW-INCOMM-REF-NO                                    01800031
018100              FW-TRANS-TYPE                                       01810031
018200              FW-TRANS-COUNT                                      01820031
018300              FW-TRANS-AMOUNT                                     01830031
018400                                                                  01840031
018500     PERFORM 4000-WRITE-RECORD.                                   01850036
018800     PERFORM 3000-READ-COMMA-RECORD.                              01880031
018900                                                                  01890031
019000******************************************************************01900031
019100* READ DATA FROM THE EXTRACT                                     *01910031
019200******************************************************************01920031
019300 3000-READ-COMMA-RECORD.                                          01930031
019400     READ COMMA-FILE INTO PV-COMMA-DATA                           01940031
019500       AT END SET PS-END-OF-COMMA-DATA TO TRUE.                   01950031
019600                                                                  01960031
           IF NOT PS-END-OF-COMMA-DATA                                  01960733
018700        ADD +1 TO PV-INCOMM-RECS-READ                             01961033
           END-IF.                                                      01962033
019700                                                                  01970031
019800******************************************************************01980031
019900* WRITE DATA TO A FILE                                           *01990031
020000******************************************************************02000031
020100 4000-WRITE-RECORD.                                               02010031
020200       INITIALIZE SV070-SETTLEMENT-RECORD.                        02020034
020300       MOVE   FW-PARTNER(1:25)   TO   SV070-PARTNER.              02030034
020400       MOVE   FW-PRODUCT(1:55)   TO   SV070-PRODUCT.              02040034
020500       MOVE   FW-UPC(1:15)       TO   SV070-UPC.                  02050034
020600       MOVE   FW-VAN16           TO   SV070-VAN16.                02060034
020700       MOVE   FW-SERIAL-NUM      TO   SV070-SERIAL-NUM.           02070034
020800       MOVE   FW-MERCHANT(1:50)  TO   SV070-MERCHANT.             02080034
020900       MOVE   FW-LOCATION(1:50)  TO   SV070-LOCATION.             02090034
021000       MOVE   FW-TRANS-TIME      TO   SV070-TRANS-TIME.           02100034
021100       MOVE   FW-POST-DATE       TO   SV070-POST-DATE.            02110034
021200       MOVE   FW-STAN(1:12)      TO   SV070-STAN.                 02120034
021300       MOVE   FW-INCOMM-REF-NO   TO   SV070-INCOMM-REF-NO.        02130034
021400       MOVE   FUNCTION UPPER-CASE(FW-TRANS-TYPE)                  02140037
021400              TO  SV070-TRANS-TYPE.                               02141037
021500                                                                  02150031
021600******************************************************************02160031
021700* CONVERT THE FOLLOWING TEXT FIELDS TO NUMERIC DATA              *02170031
021800******************************************************************02180031
021900*****  CONVERT TEXT TO DATE FOR TRANS-DATE                        02190031
022000                                                                  02200031
022100       UNSTRING FW-TRANS-DATE                                     02210031
022200              DELIMITED BY ALL SPACES OR "/" OR "-"               02220036
022300              INTO PV-TRANS-MM                                    02230031
022400                   PV-TRANS-DD                                    02240031
022500                   PV-TRANS-YYYY.                                 02250031
022600                                                                  02260031
022700       MOVE   PV-TRANS-YYYY      TO   PV-REFORMAT-YYYY.           02270036
022800       MOVE   PV-TRANS-MM        TO   PV-REFORMAT-MM.             02280036
022900       MOVE   PV-TRANS-DD        TO   PV-REFORMAT-DD.             02290036
023000       MOVE   PV-REFORMAT-DATE   TO   SV070-TRANS-DATE.           02300036
023100                                                                  02310031
023200****** CONVERT TEXT TO NUMERIC FOR UPC                            02320031
023300       MOVE ZEROES               TO   PV-UPC.                     02330031
023400                                                                  02340031
023500       UNSTRING FW-UPC                                            02350031
023600              DELIMITED BY ALL SPACES                             02360031
023700              INTO PV-UPC-PART1                                   02370031
023800                   PV-UPC-PART2.                                  02380031
023900                                                                  02390031
024000       MOVE PV-UPC-PART1         TO SV070-UPC.                    02400031
024100                                                                  02410031
024200*****  CONVERT TEXT TO NUMERIC FOR TRAN-COUNT                     02420031
024300       MOVE ZEROES               TO   PV-COUNT.                   02430031
024400                                                                  02440031
024500       UNSTRING FW-TRANS-COUNT                                    02450031
024600              DELIMITED BY ALL SPACES                             02460031
024700              INTO PV-TRANS-COUNT-PART1                           02470031
024800                   PV-TRANS-COUNT-PART2.                          02480031
024900                                                                  02490031
025000       INSPECT FW-TRANS-COUNT TALLYING PV-COUNT                   02500031
025100               FOR ALL "-".                                       02510031
025200                                                                  02520031
025300       IF     PV-COUNT >= 1                                       02530031
025400              MULTIPLY PV-TRANS-COUNT-PART1 BY -1                 02540031
025500              GIVING   SV070-TRANS-COUNT                          02550031
025600       ELSE                                                       02560031
025700              MOVE   PV-TRANS-COUNT-PART1 TO  SV070-TRANS-COUNT   02570031
025800       END-IF.                                                    02580031
025900                                                                  02590031
026000       MOVE SV070-TRANS-COUNT  TO PV-TRANS-COUNT-DISPLAY.         02600031
026100                                                                  02610031
026200                                                                  02620031
026300****** CONVERT TEXT TO NUMERIC FOR TRAN-AMOUNT                    02630031
026400       UNSTRING FW-TRANS-AMOUNT                                   02640031
026500              DELIMITED BY ALL SPACES                             02650031
026600              INTO PV-TRANS-AMOUNT-PART1                          02660031
026700                   PV-TRANS-AMOUNT-PART2.                         02670031
             UNSTRING PV-TRANS-AMOUNT-PART1                             02671036
                    DELIMITED BY "."                                    02672036
                    INTO PV-TRANS-AMOUNT-INT                            02673036
                         PV-TRANS-AMOUNT-DEC.                           02674036
                                                                        02674136
             MULTIPLY PV-TRANS-AMOUNT-INT BY 100                        02674236
                    GIVING PV-TRANS-AMOUNT-100.                         02674336
                                                                        02674436
             ADD PV-TRANS-AMOUNT-DEC TO PV-TRANS-AMOUNT-100             02674536
                    GIVING PV-TRANS-AMOUNT-TOTAL.                       02674636
                                                                        02674736
             DIVIDE PV-TRANS-AMOUNT-TOTAL BY 100                        02675036
                    GIVING PV-TRANS-AMOUNT-FINAL.                       02676036
026800                                                                  02680031
026900       MULTIPLY PV-TRANS-AMOUNT-FINAL BY SV070-TRANS-COUNT        02690036
027000            GIVING SV070-TRANS-AMOUNT.                            02700031
027100                                                                  02710031
027110****** DETERMINE THE TRANS-ORDER AND WRITE IT TO OUT FILE TO BE   02711032
027120****** IN COMPARE PROGRAM SVKUT072 LATER.                         02712032
027200       EVALUATE SV070-TRANS-TYPE                                  02720031
027300            WHEN 'ACTIVATION'                                     02730037
027400                 MOVE 00 TO SV070-TRANS-ORDER                     02740031
027500            WHEN 'DEACTIVATION'                                   02750037
027600                 MOVE 02 TO SV070-TRANS-ORDER                     02760031
027700            WHEN 'REVERSAL'                                       02770031
027800                 IF SV070-TRANS-COUNT = -1                        02780031
027900                    MOVE 01 TO SV070-TRANS-ORDER                  02790031
028000                 ELSE                                             02800031
028100                    MOVE 03 TO SV070-TRANS-ORDER                  02810031
028200                 END-IF                                           02820031
028300       END-EVALUATE.                                              02830031
                                                                        02831036
028500     WRITE FIXED-WIDTH-FMT-REC FROM SV070-SETTLEMENT-RECORD.      02850031
028600     ADD +1 TO PV-INCOMM-RECS-WRITTEN.                            02860031
028700                                                                  02870031
028800******************************************************************02880031
028900* CLOSE FILES                                                    *02890031
029000******************************************************************02900031
029100 5000-END-OF-JOB.                                                 02910031
029200     CLOSE COMMA-FILE                                             02920031
029300           FIXED-WIDTH-FILE.                                      02930031
029400                                                                  02940031
029500     DISPLAY ' '.                                                 02950031
029600     DISPLAY PC-PROGRAM-NAME                                      02960031
029700             '  RECORDS READ FROM INCOMM REPORT FILE: '           02970031
029800                                        PV-INCOMM-RECS-READ.      02980031
029900     DISPLAY PC-PROGRAM-NAME '  RECS WRITTEN TO OUTPUT FILE:  '   02990031
030000                                        PV-INCOMM-RECS-WRITTEN.   03000031
030100     DISPLAY ' '.                                                 03010031
030200                                                                  03020031
