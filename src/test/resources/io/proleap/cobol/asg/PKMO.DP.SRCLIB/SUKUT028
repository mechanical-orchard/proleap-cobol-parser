000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400                                                                  00040001
000500 PROGRAM-ID.    SUKUT028.                                         00050001
000600 AUTHOR.        GERMAN BANDA.                                     00060001
000700 INSTALLATION.  KOHLS.                                            00070001
000800 DATE-WRITTEN   FEBRUARY 2000.                                    00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100******************************************************************00110001
001200*  THIS PROGRAM WILL TAKE EXTRACTED INFORMATION FROM TSHUNLO AND  00120001
001300*  BUMP IT AGAINST THE LOCATION MASTER TO FIND OUT WHICH DC       00130005
001400*  IS SERVICING THAT STORE                                        00140001
001500******************************************************************00150001
001600***************************************************************** 00160001
001700*  CHANGED 04/20/21 BY JEAN KURK                                * 00170001
001800*   REMOVED TABLE TSTVNDC                                       * 00180001
001900*                                                               * 00190001
002000***************************************************************** 00200001
002100                                                                  00210001
002200******************************************************************00220001
002300 ENVIRONMENT DIVISION.                                            00230001
002400******************************************************************00240001
002500 INPUT-OUTPUT SECTION.                                            00250001
002600                                                                  00260001
002700 FILE-CONTROL.                                                    00270001
002800                                                                  00280001
002900                                                                  00290001
003000     SELECT SU-EXTRACT-FILE-IN ASSIGN TO IN01.                    00300001
003100                                                                  00310001
003200     SELECT SU-EXTRACT-WTHSTR-FILE ASSIGN TO OUT01.               00320006
003300                                                                  00330001
003400******************************************************************00340001
003500 DATA DIVISION.                                                   00350001
003600******************************************************************00360001
003700                                                                  00370001
003800 FILE SECTION.                                                    00380001
003900                                                                  00390001
004000 FD  SU-EXTRACT-FILE-IN                                           00400001
004100     RECORDING MODE IS F                                          00410001
004200     LABEL RECORDS ARE STANDARD                                   00420001
004300     BLOCK CONTAINS 0 RECORDS.                                    00430001
004400                                                                  00440001
004500 01  SU-EXTRACT-RECORD          PIC  X(200).                      00450001
004600                                                                  00460001
004700 FD  SU-EXTRACT-WTHSTR-FILE                                       00470001
004800     RECORDING MODE IS F                                          00480001
004900     LABEL RECORDS ARE STANDARD                                   00490001
005000     BLOCK CONTAINS 0 RECORDS.                                    00500001
005100                                                                  00510001
005200 01  SU-EXTRACT-WTHSTR-RECORD   PIC  X(200).                      00520001
005300                                                                  00530001
005400                                                                  00540001
005500******************************************************************00550001
005600 WORKING-STORAGE SECTION.                                         00560001
005700******************************************************************00570001
005800*-----------------------------------------------------------------00580001
005900*  DB2 FORMATTED MESSAGE AREA                                     00590001
006000*-----------------------------------------------------------------00600001
006100     COPY DPWS004.                                                00610059
006200                                                                  00620001
006300*-----------------------------------------------------------------00630001
006400*  COMMUNICATIONS AREA FOR DB2                                    00640001
006500*-----------------------------------------------------------------00650001
006600     EXEC SQL                                                     00660001
006700          INCLUDE SQLCA                                           00670001
006800     END-EXEC.                                                    00680001
006900                                                                  00690001
007800*-----------------------------------------------------------------00780042
007900*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE STORE VENDOR       00790042
008000*  TABLE                                                          00800042
008100*-----------------------------------------------------------------00810042
008200*    EXEC SQL                                                     00820042
008300*         INCLUDE TSTVNDC                                         00830042
008400*    END-EXEC.                                                    00840042
008500                                                                  00850042
008510*-----------------------------------------------------------------00780042
008520*  PARM TABLE - TKRPRPM                                                   
008540*-----------------------------------------------------------------00810042
008550     EXEC SQL                                                     00820042
008560          INCLUDE TKRPRPM                                         00830042
008570     END-EXEC.                                                    00840042
008580                                                                  00850042
008590*-----------------------------------------------------------------00780042
008591*  PARM TABLE - XLT_LOC                                                   
008592*-----------------------------------------------------------------00810042
008593     EXEC SQL                                                     00820042
008594          INCLUDE XLT00010                                        00830042
008595     END-EXEC.                                                    00840042
008596                                                                  00850042
008600*-----------------------------------------------------------------00860001
008700*                                                                 00870001
008800*-----------------------------------------------------------------00880001
008900 01  ABEND-CODE                    PIC S9(04) VALUE +0            00890001
009000                                              COMP SYNC.          00900001
009100                                                                  00910001
009200 01  PS-PROGRAM-SWITCHES.                                         00920001
009300     05  PS-EOF-EXTRACT-FILE-SW       PIC X(01)  VALUE 'N'.       00930006
009400         88  PS-EOF-EXTRACT-FILE                 VALUE 'Y'.       00940002
009500         88  PS-MORE-EXTRACT-RECORDS             VALUE 'N'.       00950006
009600                                                                  00960001
009700 01  PC-PROGRAM-CONSTANTS.                                        00970001
009800     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08) VALUE 'SUKUT028'.   00980004
009900     05  PC-03                     PIC  X(02) VALUE '03'.         00990017
010000     05  PC-999                    PIC  X(03) VALUE '999'.        01000042
010100                                                                  01010001
010200 01  DK-DB2-KEYS.                                                 01020041
010300     05  DK-OPER-UNT-ID               PIC S9(04) COMP VALUE +0.   01030041
010400                                                                  01040041
010500 01  PV-PROGRAM-VARIABLES.                                        01050001
010600     05  PV-PROCESS-DATE             PIC  X(10).                  01060003
010700     05  PV-PROCESS-DC-NBR           PIC  9(04).                  01070047
010800     05  PV-NULL-IND-1               PIC S9(04) VALUE +0 COMP.    01080047
010900     05  PV-DEST-OPER-UNT-ID         PIC  S9(4).                  01090028
011000     05  PV-DISPLAY-STORE            PIC  9(04).                  01100049
011100     05  PV-DISPLAY-ENTITY           PIC  9(09).                  01110049
011200*                                                                 01120027
011300     05  PV-ORGN-OPER-UNT-ID-N       PIC 9(04).                   01130041
011400     05  PV-ORGN-OPER-UNT-ID.                                     01140041
011500         10  PV-ORGN-OPER-FILLER     PIC 9(01)     VALUE ZEROES.  01150041
011600         10  PV-ORGN-OPER-UNT        PIC 9(03)     VALUE ZEROES.  01160041
011700     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  01170003
011800     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01180001
011900*                                                                 01190024
012000     05  PV-DISPLAY-COUNT            PIC S9(09)    VALUE ZERO     01200001
012100                                                   COMP SYNC.     01210007
012200     05  PV-WRITE-COUNTER            PIC S9(09)    VALUE ZERO     01220001
012300                                                   COMP SYNC.     01230024
012400     05  PV-READ-COUNTER             PIC S9(09)    VALUE ZERO     01240023
012500                                                   COMP SYNC.     01250001
012501* DMH 11/17/17 BEGIN                                                      
012510     05  PV-TKRPRPM-TXT              PIC  X(25) VALUE SPACES.     01240023
012511     05  PV-TKRPRPM-TXT-R REDEFINES PV-TKRPRPM-TXT.                       
012512         10  PV-PARM-TXT-OPER        PIC  9(03).                          
012513         10  FILLER                  PIC  X(22).                          
012520* DMH 11/17/17 BEGIN                                                      
012600                                                                  01260001
012700*---------------------------------------------------------*       01270001
012800*  COPYBOOK USED IN CREATING EXTRACT FILE.                *       01280001
012900*---------------------------------------------------------*       01290001
013000     COPY SURD008.                                                01300059
013100*---------------------------------------------------------*       01310001
013200/                                                                 01320002
013300*  LOGISTICS DOMAIN LOCATION MODULE                               00010000
013400*                                                                 00020000
013500     COPY XLWS071.                                                00030000
013600 EJECT                                                            01330002
013700******************************************************************01340001
013800 PROCEDURE DIVISION.                                              01350001
013900******************************************************************01360001
014000*-----------------------------------------------------------------01370001
014100* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     01380001
014200*      PROGRAM.                                                   01390001
014300*-----------------------------------------------------------------01400001
014400     DISPLAY '***BEGINNING SUKUT028***'.                          01410002
014500 0000-PROGRAM-MAINLINE.                                           01420001
014600                                                                  01430001
014700     PERFORM 1000-INITIALIZE.                                     01440001
014800                                                                  01450006
014900     IF PS-MORE-EXTRACT-RECORDS                                   01460006
015000       PERFORM 2000-PROCESS-RECORDS                               01470006
015100            UNTIL PS-EOF-EXTRACT-FILE                             01480007
015200     END-IF.                                                      01490006
015300                                                                  01500006
015400     PERFORM 9000-EOJ-ROUTINE.                                    01510001
015500                                                                  01520001
015600     GOBACK.                                                      01530003
015700                                                                  01540001
015800                                                                  01550001
015900*-----------------------------------------------------------------01560001
016000*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    01570001
016100*    -- OPEN FILES                                                01580003
016200*    -- INITIAL READ                                              01590023
016300*    -- MOVE PROCESS DATE                                         01600023
016400*-----------------------------------------------------------------01610001
016500 1000-INITIALIZE.                                                 01620001
016600                                                                  01630001
016700     OPEN INPUT  SU-EXTRACT-FILE-IN.                              01640001
016800     OPEN OUTPUT SU-EXTRACT-WTHSTR-FILE.                          01650001
016900                                                                  01660001
017000     PERFORM 1100-READ-EXTRACT-FILE-INITIAL.                      01670020
017100                                                                  01680001
017200*-----------------------------------------------------------------01690001
017300*                                                                 01700001
017400*-----------------------------------------------------------------01710001
017500 1100-READ-EXTRACT-FILE-INITIAL.                                  01720019
017600                                                                  01730003
017700     PERFORM 7700-READ-EXTRACT-FILE.                              01740029
017800                                                                  01750029
017900     IF PS-EOF-EXTRACT-FILE                                       01760059
018000         CONTINUE                                                 01760161
018100     ELSE                                                         01760259
018200         MOVE SU008-SCN-DATE TO PV-PROCESS-DATE                   01761059
018300         DISPLAY 'SUKUT028 PROCESS DATE -- ' SU008-SCN-DATE       01770059
018400         IF SU008-DEST-OPER-UNT-ID = 0 AND                        01780059
018500            SU008-ORGN-OPER-UNT-ID > 0                            01790059
018600            MOVE SU008-ORGN-OPER-UNT-ID TO DK-OPER-UNT-ID         01800059
018700         ELSE                                                     01810059
018800            MOVE SU008-DEST-OPER-UNT-ID TO DK-OPER-UNT-ID         01820059
018900         END-IF                                                   01830059
019000         MOVE SU008-DEST-OPER-UNT-ID TO PV-DEST-OPER-UNT-ID       01850059
019100         PERFORM 7000-SELECT-TYPE-CODE                            01860059
019200         PERFORM 7500-EVALUATE-TYPE-CODE                          01870059
019210* DMH - 11/17/17 BEGIN                                                    
019220         MOVE SPACES  TO  SU008-EBUS-IND                                  
019230         MOVE ZEROES  TO  SU008-EFC-SISTER-DC                             
019240                                                                          
019250         PERFORM 7515-CHECK-DC-EBUS                                       
019260         MOVE XLT00010-E-BUS-IND TO  SU008-EBUS-IND                       
019270         IF  XLT00010-E-BUS-IND = 'Y'                                     
019280             PERFORM 7510-GET-SISTER-DC                                   
019290         END-IF                                                           
019291* DMH - 11/17/17 END                                                      
019300     END-IF.                                                      01871060
019400                                                                  01890001
019410                                                                  01890001
019500*-----------------------------------------------------------------01900001
019600*  PROCESS THE RECORDS FROM THE INPUT EXTRACT FILE                01910023
019700*-----------------------------------------------------------------01920001
019800 2000-PROCESS-RECORDS.                                            01930002
019900                                                                  01940002
020000     PERFORM 8000-WRITE-WTHSTR-RECORD.                            01950019
020100                                                                  01960021
020200     PERFORM 7700-READ-EXTRACT-FILE.                              01970019
020300     IF PS-EOF-EXTRACT-FILE                                       01971059
020400         CONTINUE                                                 01972061
020500     ELSE                                                         01973059
020600         IF SU008-DEST-OPER-UNT-ID = PV-DEST-OPER-UNT-ID          01980059
020700            CONTINUE                                              01990059
020800         ELSE                                                     02000059
020900             IF SU008-DEST-OPER-UNT-ID = 0 AND                    02010059
021000                SU008-ORGN-OPER-UNT-ID > 0                        02020059
021100                 MOVE SU008-ORGN-OPER-UNT-ID TO DK-OPER-UNT-ID    02030059
021200             ELSE                                                 02040059
021300                 MOVE SU008-DEST-OPER-UNT-ID TO DK-OPER-UNT-ID    02050059
021400             END-IF                                               02060059
021500             MOVE SU008-DEST-OPER-UNT-ID TO PV-DEST-OPER-UNT-ID   02070059
021600             PERFORM 7000-SELECT-TYPE-CODE                        02080059
021700          END-IF                                                  02090059
021800          PERFORM 7500-EVALUATE-TYPE-CODE                         02100059
021900     END-IF.                                                      02101059
021901                                                                          
021910* DMH - 11/17/17 BEGIN                                                    
021912     MOVE SPACES  TO  SU008-EBUS-IND.                                     
021913     MOVE ZEROES  TO  SU008-EFC-SISTER-DC.                                
021915                                                                          
021920     PERFORM 7515-CHECK-DC-EBUS.                                          
021930     MOVE XLT00010-E-BUS-IND TO  SU008-EBUS-IND                           
021940     IF  XLT00010-E-BUS-IND = 'Y'                                         
021950         PERFORM 7510-GET-SISTER-DC                                       
021960     END-IF.                                                              
021970* DMH - 11/17/17 END                                                      
022000                                                                  02102059
022100*-----------------------------------------------------------------02110001
022200*  SELECT THE TYPE CODE FROM THE STORE MASTER                     02120023
022300*-----------------------------------------------------------------02130001
022400 7000-SELECT-TYPE-CODE.                                           02140002
022500                                                                  00040001
022600     INITIALIZE XL071-COMMAREA-REC.                               00050001
022700     MOVE DK-OPER-UNT-ID        TO XL071-LOCATION-NUMBER          00060001
022800                                                                  00070001
022900     CALL XL071-LOCATION-MODULE USING XL071-COMMAREA-REC.         00080001
023000                                                                  00090001
023100     EVALUATE TRUE                                                00100001
023200     WHEN XL071-NO-ERRORS                                         00110001
023300         CONTINUE                                                         
023400*        MOVE XL071-LOC-TYP-CDE                                           
023500     WHEN XL071-LOC-NOT-FOUND                                     00130001
023600     WHEN XL071-DC-ASGMT-NOT-FND                                  00140001
023700         MOVE SPACES                TO XL071-LOC-TYP-CDE                  
023800     WHEN XL071-BAD-DB2-RETURN                                    00160001
023900         DISPLAY 'OPER UNIT ID IS' DK-OPER-UNT-ID                 02421056
024000         DISPLAY 'SHIPT UNIT ID  ' SU008-SHIPT-UNT-ID             02422056
024100         DISPLAY '7000-SELECT-TYPE-CODE'                          00170001
024200         DISPLAY 'CALL LOCATION MOD '                             00180001
024300         DISPLAY 'XLT00010'                                       00190001
024400         MOVE '7000-SELECT-TYPE-CODE  '                           02430056
024500                                 TO PV-PARAGRAPH-NAME             02440002
024600         MOVE 'CALL LOCATION MOD'                                 02450006
024700                                 TO PV-DB2-OPERATION-ATTEMPTED    02460002
024800         MOVE XL071-SQLCA             TO SQLCA                    00200001
024900         PERFORM 9100-SQL-ABEND                                   00210001
025000     END-EVALUATE.                                                00220001
025100                                                                  02150001
025200*-----------------------------------------------------------------02500019
025300*  BASED ON THE SELECTED TYPE CODE, DETERMINE WHICH DC            02510023
025400*  THE STORE SHOULD HAVE MERCHANDISE SHIPPED TO                   02520023
025500*-----------------------------------------------------------------02530023
025600 7500-EVALUATE-TYPE-CODE.                                         02540023
025601                                                                          
025700     EVALUATE XL071-LOC-TYP-CDE                                   02550019
025800       WHEN SPACES                                                02560057
025900           MOVE ZEROES TO PV-PROCESS-DC-NBR                       02560157
026000                                                                          
026100       WHEN 'DS'                                                  02561057
026200         EVALUATE TRUE                                            02570019
026300           WHEN (PV-PROCESS-DATE >= XL071-ASGMT-EFF-BEG-DTE AND   02580019
026400                 PV-PROCESS-DATE <= XL071-ASGMT-EFF-STP-DTE)      02590019
026500              MOVE XL071-ASGMT-DC-NBR TO PV-PROCESS-DC-NBR        02600019
026600           WHEN OTHER                                             02650019
026700              DISPLAY 'FALLOUT ' SU008-SHIPT-UNT-ID               02660041
026800              MOVE ZEROES TO PV-PROCESS-DC-NBR                    02670042
026900         END-EVALUATE                                             02680019
027000                                                                          
027100*        PERFORM 7600-GET-STORE-VENDOR                            02681057
031500         MOVE PV-PROCESS-DC-NBR TO SU008-PROCESS-DC-NBR           03141052
027200       WHEN 'DC'                                                  02690019
027300       WHEN 'CS'                                                  02700019
027400       WHEN 'RV'                                                  02710019
027500         MOVE SU008-ORGN-OPER-UNT-ID TO PV-PROCESS-DC-NBR         02760041
027600                                                                          
027700*        MOVE SU008-ORGN-OPER-UNT-ID                              02720041
027800*                                   TO PV-ORGN-OPER-UNT-ID-N      02730041
027900*        MOVE PV-ORGN-OPER-UNT-ID-N TO                            02740041
028000*                                      PV-ORGN-OPER-UNT-ID        02750041
028100*        MOVE PV-ORGN-OPER-UNT TO PV-PROCESS-DC-NBR               02760041
028200*        PERFORM 7600-GET-STORE-VENDOR                            02761057
031500         MOVE PV-PROCESS-DC-NBR TO SU008-PROCESS-DC-NBR           03141052
028300     END-EVALUATE.                                                02770058
028400                                                                  02780019
028401                                                                  02780019
028402*-----------------------------------------------------------------        
028403* GET SISTER DC FOR THE EFC                                               
028404* DMH 11/17/17                                                            
028405*-----------------------------------------------------------------        
028410 7510-GET-SISTER-DC.                                                      
028420                                                                          
028421     MOVE  DK-OPER-UNT-ID     TO  KRPRPM-LOC-ID.                          
028422                                                                          
028430     EXEC SQL                                                             
028440         SELECT  FUNC_TXT                                                 
028450           INTO :PV-TKRPRPM-TXT                                           
028460           FROM  TKRPRPM                                                  
028470          WHERE  LOC_ID             = :KRPRPM-LOC-ID                      
028480            AND  SYS_PRC_FUNC_CDE   = 'ECDCSU'                            
028490            AND  INTFC_SYS_CDE      = 'KHL'                               
028491            AND  FUNC_PRC_STAT_CDE  = 'AC'                                
028492            AND  FUNC_BEG_TMST     <=  CURRENT TIMESTAMP                  
028493            AND  FUNC_END_TMST     >=  CURRENT TIMESTAMP                  
028494           WITH UR                                                        
028496     END-EXEC.                                                            
028497                                                                          
028498*FILL SISTER DC                                                           
028499     EVALUATE TRUE                                                        
028500       WHEN SQLCODE = +0                                                  
028503            MOVE PV-PARM-TXT-OPER TO SU008-EFC-SISTER-DC                  
028512                                                                          
028513       WHEN SQLCODE = +100                                                
028514           MOVE ZEROES            TO SU008-EFC-SISTER-DC                  
028515                                                                          
028516       WHEN OTHER                                                         
028517           DISPLAY '  ** 7510-GET-SISTER-DC    **'                        
028518           MOVE SU008-DEST-OPER-UNT-ID TO PV-DISPLAY-STORE                
028519           MOVE SU008-ENT-ID           TO PV-DISPLAY-ENTITY               
028520           DISPLAY '  STORE NBR = ' PV-DISPLAY-STORE                      
028521                 '    ENT-ID = ' PV-DISPLAY-ENTITY                        
028522*                '    DEPT = ' STVNDC-DEPT-NBR                            
028523           DISPLAY '  SU008-SHP-DT = ' SU008-DONT-SHIP-BEF-DTE            
028524*                  '   BEG-DT = ' STVNDC-EFF-BEG-DTE                      
028525*                  '   END-DT = ' STVNDC-EFF-END-DTE                      
028526           MOVE '7510-GET-SISTER-DC     ' TO PV-PARAGRAPH-NAME            
028527           MOVE 'SELECT SISTER DC '                                       
028528             TO PV-DB2-OPERATION-ATTEMPTED                                
028529           PERFORM 9100-SQL-ABEND                                         
028530     END-EVALUATE.                                                        
028532                                                                          
028533                                                                          
028534*-----------------------------------------------------------------        
028535* CHECK IF PROCESSING DC IS E-BUS                                         
028536* DMH 11/17/17                                                            
028537*-----------------------------------------------------------------        
028538 7515-CHECK-DC-EBUS.                                                      
028539                                                                          
028540     MOVE  SU008-ORGN-OPER-UNT-ID TO XLT00010-LOC-NBR.                    
028541                                                                          
028542     EXEC SQL                                                             
028543         SELECT  E_BUS_IND                                                
028544           INTO :XLT00010-E-BUS-IND                                       
028545           FROM  XLT_LOC                                                  
028546          WHERE  LOC_NBR            = :XLT00010-LOC-NBR                   
028552           WITH UR                                                        
028553     END-EXEC.                                                            
028554                                                                          
028555*FILL SISTER DC                                                           
028556     EVALUATE TRUE                                                        
028557       WHEN SQLCODE = +0                                                  
028559            CONTINUE                                                      
028560                                                                          
028561       WHEN SQLCODE = +100                                                
028562       WHEN SQLCODE = -305                                                
028563           MOVE SPACES            TO XLT00010-E-BUS-IND                   
028564           MOVE ZEROES            TO SU008-EFC-SISTER-DC                  
028565                                                                          
028566       WHEN OTHER                                                         
028567           DISPLAY '  ** 7515-CHECK-DC-EBUS    **'                        
028568           MOVE SU008-DEST-OPER-UNT-ID TO PV-DISPLAY-STORE                
028569           MOVE SU008-ENT-ID           TO PV-DISPLAY-ENTITY               
028570           DISPLAY '  STORE NBR = ' PV-DISPLAY-STORE                      
028571                 '    ENT-ID = ' PV-DISPLAY-ENTITY                        
028572*                '    DEPT = ' STVNDC-DEPT-NBR                            
028573           DISPLAY '  SU008-SHP-DT = ' SU008-DONT-SHIP-BEF-DTE            
028574*                  '   BEG-DT = ' STVNDC-EFF-BEG-DTE                      
028575*                  '   END-DT = ' STVNDC-EFF-END-DTE                      
028576           MOVE '7515-CHECK-DC-EBUS     ' TO PV-PARAGRAPH-NAME            
028577           MOVE 'CHECK IF PROCESS DC IS EBUS'                             
028578             TO PV-DB2-OPERATION-ATTEMPTED                                
028579           PERFORM 9100-SQL-ABEND                                         
028580     END-EVALUATE.                                                        
028581                                                                          
028590                                                                          
028600*-----------------------------------------------------------------02840042
028700*7600-GET-STORE-VENDOR.                                           02850042
028800*                                                                 02860042
028900*    EXEC SQL                                                     02870042
029000*        SELECT  SHIP_TO_TMP_DC_NBR                               02880042
029100*          INTO  :STVNDC-SHIP-TO-TMP-DC-NBR                       02890043
029200*          FROM  TSTVNDC                                          02900042
029300*         WHERE  STR_NBR      = :SU008-DEST-OPER-UNT-ID           02910046
029400*           AND  ENT_ID       = :SU008-ENT-ID                     02920046
029500*           AND (DEPT_NBR     = :SU008-DEPT-NBR                   02930046
029600*            OR  DEPT_NBR     = :PC-999)                          02940046
029700*           AND ((EFF_BEG_DTE <= :SU008-SCN-DATE                  02950055
029800*             AND EFF_END_DTE >= :SU008-SCN-DATE)                 02960055
029900*            OR  (EFF_BEG_DTE <= :SU008-SCN-DATE                  02970055
030000*             AND EFF_END_DTE IS NULL))                           02980049
030100*    END-EXEC.                                                    02990042
030200*                                                                 03000042
030300*FILL PROCESS DC.                                                 03010042
030400*    EVALUATE TRUE                                                03020042
030500*      WHEN SQLCODE = +0                                          03030047
030600*          IF (SU008-PO-TYP-CDE = 'VN')                           03040049
030700*            OR (SU008-NEW-STR-IND = 'Y')                         03050053
030800*              MOVE STVNDC-SHIP-TO-TMP-DC-NBR                     03070049
030900*                                     TO SU008-PROCESS-DC-NBR     03080049
031000*          ELSE                                                   03090049
031100*              MOVE PV-PROCESS-DC-NBR TO SU008-PROCESS-DC-NBR     03100049
031200*          END-IF                                                 03110042
031300*                                                                 03120042
031400*      WHEN SQLCODE = +100                                        03130042
031500*          MOVE PV-PROCESS-DC-NBR TO SU008-PROCESS-DC-NBR         03141052
031600*                                                                 03150042
031700*      WHEN OTHER                                                 03160042
031800*          DISPLAY '  ** 7600-GET-STORE-VENDOR **'                03170048
031900*          MOVE SU008-DEST-OPER-UNT-ID TO PV-DISPLAY-STORE        03180049
032000*          MOVE SU008-ENT-ID           TO PV-DISPLAY-ENTITY       03190049
032100*          DISPLAY '  STORE NBR = ' PV-DISPLAY-STORE              03200049
032200*                '    ENT-ID = ' PV-DISPLAY-ENTITY                03210049
032300*                '    DEPT = ' STVNDC-DEPT-NBR                    03220048
032400*          DISPLAY '  SU008-SHP-DT = ' SU008-DONT-SHIP-BEF-DTE    03230049
032500*                  '   BEG-DT = ' STVNDC-EFF-BEG-DTE              03240049
032600*                  '   END-DT = ' STVNDC-EFF-END-DTE              03250049
032700*          MOVE '7600-GET-STORE-VENDOR  ' TO PV-PARAGRAPH-NAME    03260048
032800*          MOVE 'SELECT DC FROM TSTVNDC '                         03270042
032900*            TO PV-DB2-OPERATION-ATTEMPTED                        03280042
033000*          PERFORM 9100-SQL-ABEND                                 03290042
033100*    END-EVALUATE.                                                03300042
033200                                                                  03310042
033300*-----------------------------------------------------------------03320042
033400 7700-READ-EXTRACT-FILE.                                          03330019
033500     INITIALIZE   SU008-EXTRACT-RECORD.                           03340030
033600                                                                  03350030
033700     READ SU-EXTRACT-FILE-IN  INTO SU008-EXTRACT-RECORD           03360019
033800          AT END                                                  03370030
033900           SET PS-EOF-EXTRACT-FILE TO TRUE                        03380030
034000        NOT AT END                                                03390030
034100           ADD +1 TO PV-READ-COUNTER                              03400030
034200     END-READ.                                                    03410030
034300*-----------------------------------------------------------------03420001
034400*  WRITE THE SHIPMENT-UNIT-RECORD                                 03430001
034500*-----------------------------------------------------------------03440001
034600 8000-WRITE-WTHSTR-RECORD.                                        03450002
034700                                                                  03460002
034800     WRITE SU-EXTRACT-WTHSTR-RECORD FROM SU008-EXTRACT-RECORD.    03470008
034900     ADD +1 TO PV-WRITE-COUNTER.                                  03480001
035000                                                                  03490001
035100                                                                  03500001
035200*-----------------------------------------------------------------03510001
035300*  CLOSE OUTPUT FILE.                                             03520006
035400*-----------------------------------------------------------------03530001
035500 9000-EOJ-ROUTINE.                                                03540001
035600     CLOSE SU-EXTRACT-FILE-IN                                     03550001
035700           SU-EXTRACT-WTHSTR-FILE.                                03560006
035800                                                                  03570001
035900     MOVE PV-READ-COUNTER TO PV-DISPLAY-COUNT.                    03580023
036000     DISPLAY 'TOTAL EXTRACT RECORDS READ ' PV-DISPLAY-COUNT.      03590023
036100     MOVE PV-WRITE-COUNTER TO PV-DISPLAY-COUNT.                   03600023
036200     DISPLAY 'TOTAL EXTRACT RECORDS WRITTEN ' PV-DISPLAY-COUNT.   03610023
036300     DISPLAY 'READ TOTAL SHOULD EQUAL WRITE TOTAL'.               03620023
036400*-----------------------------------------------------------------03630001
036500*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    03640001
036600*  ERROR OR WARNING CODE OCCURS.                                  03650001
036700*-----------------------------------------------------------------03660001
036800 9100-SQL-ABEND.                                                  03670001
036900     DISPLAY '9100-SQL-ABEND'.                                    03680001
037000     DISPLAY '** ABEND     **'.                                   03690001
037100     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        03700001
037200     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              03710001
037300     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     03720001
037400                                                                  03730001
037500******************************************************************03740001
037600* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    03750001
037700* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         03760001
037800* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     03770001
037900* FORMAT.                                                         03780001
038000******************************************************************03790001
038100     COPY DPPD004.                                                03800001
038200                                                                  03810001
038300     MOVE +4013                  TO ABEND-CODE.                   03820001
038400     CALL 'ILBOABN0' USING ABEND-CODE.                            03830001
