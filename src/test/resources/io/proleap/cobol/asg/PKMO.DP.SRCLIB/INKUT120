       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.         INKUT120.                                            
       AUTHOR.             MIKE FURLICK - STRATAGEM.                            
       INSTALLATION.       KOHLS DEPARTMENT STORES.                             
       DATE-WRITTEN.       12/93.                                               
       DATE-COMPILED.                                                           
                                                                                
      ******************************************************************        
      *                                                                *        
      *    READ THE SORTED ADJUSTMENT FILE FROM INKUT116 AND CREATE    *        
      *    THE BOOKING SUMMARIZATION FILE.                             *        
      *                                                                *        
      *    NOTE: THIS PROGRAM HAS BEEN REWRITTEN FOR CLEANER LOGIC     *        
      *          AS PART OF WR24521 ON 4-2-2003.                       *        
      *                                                                *        
      ******************** HISTORY OF CHANGES **************************        
      * CHG ID/                                                        *        
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES (MADE BY)          *        
      * -------  ----------  ----------------------------------------  *        
      * 99999    01/14/1999  REPORT NEGATIVE CUTOFF ONHAND QUANTITIES  *        
      *                                            (SCOTT SWESSEL)     *        
      * 99999    10/25/1999  ADD NEW VARIANCE FILE TO BE USED BY THE   *        
      *                      DATA WAREHOUSE        (JULIE SEIDLER)     *        
      * 99999    04/04/2000  ADDED CODE TO BYPASS THE PROCESSING OF    *        
      *                      ANY STORE THAT IS DESIGNATED AS A CENTRAL *        
      *                      STOCK LOCATION ON TSTR000. BYPASS VARIANCE*        
      *                      DATA TO THE OUTPUT FILES FOR INVENTORY    *        
      *                      AND DATA WAREHOUSE OF ANY RECORDS THAT ARE*        
      *                      'CS' LOCATIONS. ALSO CHANGE PROGRAM TO BE *        
      *                      DB2 TO USE STORE TABLE (TSTR000).         *        
      *                                            (SCOTT JACKSON)     *        
      * 99999    05/08/2000  IN THE NEW LOGIC TO CHECK FOR 'CS'        *        
      *                      LOCATION, THE 'PERIOD' AFTER THE          *        
      *                      'IF STATMENT' WAS MISSING AND THE         *        
      *                      PA-SUB-CLASS-QTY WAS NOT BEING FILLED IN. *        
      *                      CHANGED 'IF STATMENT'                     *        
      *                                            (JULIE SEIDLER)     *        
      * 21015    09/27/2000  REMOVE LOGIC THAT CREATES BOOKING VARIANCE*        
      *                      NOW THIS PROGRAM ONLY CREATES A FILE FOR  *        
      *                      THE DATA WAREHOUSE AND A REPORT.          *        
      *                                            (RONNA BUTZ)        *        
      * 21015    03/14/2001  CHANGE THE CUTOFF ON HAND CALCULATION     *        
      *                      FOR STORES USING MANIFESTING              *        
      *                      FROM:                                     *        
      *                          CUTOFF ONHAND =                       *        
      *                          OLD ONHAND QTY - AFTER RECEIPTS       *        
      *                      TO:                                       *        
      *                          CUTOFF ONHAND =                       *        
      *                          OLD ONHAND QTY - IN016-CUTOFF-INTRANST*        
      *                                                                *        
      *                      MOVE CUTOFF IN-TRANSIT TO                 *        
      *                      PA-SKU-AFTER-RECEIPTS FOR MANIFESTED STORE*        
      *                                                                *        
      *                      CHANGE THE ADJUSTMENT CALCULATION FOR     *        
      *                      STORES USING MANIFESTING                  *        
      *                      FROM:                                     *        
      *                          ADJUSTMENT AMT = QTY - (OLD ONHAND QTY*        
      *                                               - AFTER RECEIPTS)*        
      *                      TO:                                       *        
      *                          ADJUSTMENT AMT = QTY - (OLD ONHAND QTY*        
      *                                             - CUTOFF INTRANSIT)*        
      *                                            (RONNA BUTZ)        *        
      * WR21732  01/20/2003  ADDED NON INTELLIGENT SKU IN PLACE OF     *        
      *                      DEPT,CLASS,SEQ AND 4 DIGIT DEPT, 4 DIGIT  *        
      *                      CLASS ARE ALSO ADDED.                     *        
      *                                            (SUKUMAR,IGSI)      *        
      * WR21732  03/28/2003  FIXING BUGS FROM NIS CHANGES              *        
      *                                            (RONNA BUTZ)        *        
      * WR24521  04/02/2003  CHANGE TO ACCOMMODATE TRUE CUTOFF ONHAND. *        
      *                      REMOVE OBSOLETE CODES, AND CLEAN UP LOGIC *        
      *                                            (V. LEE YANG)       *        
      *                                                                *        
W26600* W26600  07-22-2004 J.M. DRAWS MERCH LEDGER STORE EXPANSION     *        
W26006* W26006  02/24/2005   REMOVE REFERENCES TO OBSOLETE STORE TABLE.*        
W26006*                                            (ERIN SEARL)        *        
      *                                                                *        
      ******************************************************************        
      *    NOTE: IN016-OLD-ONHAND-QTY IS THE CUTOFF ON HAND.                    
      *                                                                         
      *          IN016-AFTER-RECEIPTS IS THE POST FLUSH.                        
      *                                                                         
      *          IN016-QTY IS THE PHYSICAL COUNT(SUMINV AND ADJUSTMENTS)        
      *                                                                         
      *          THE EQUATION FOR NON MANIFESTED ADJUSTMENT IS                  
      *             PHYSICAL COUNT - (CUTOFF - POST FLUSH)                      
      *          AND                                                            
      *          THE EQUATION FOR MANIFESTED ADJUSTMENT IS                      
      *             PHYSICAL COUNT - (CUTOFF - CUTOFF INTRANSIT)                
      *          BUT THIS PROGRAM DOES NOT DO THIS EQUATION, IT JUST            
      *          CALCULATES THE UNIT CUTOFF PORTION OF THE ADJUSTMENT           
      *                                                                         
      *          THE UNIT CUTOFF FOR NON MANIFESTED IS                          
      *             (CUTOFF - POST FLUSH)                                       
      *                                                                         
      *          THE UNIT CUTOFF FOR MANIFESTED IS                              
      *             (CUTOFF - CUTOFF INTRANSIT)                                 
      *                                                                         
      *          THIS PROGRAM WILL PERFORM THE UNIT CUTOFF EQUATION             
      *          AND MOVE THE RESULT TO THE TRUE CUTOFF FIELD, THEN             
      *          IF THE UNIT CUTOFF RESULT IS                                   
      *             A NEGATIVE NUMBER, IT WILL PRINT A DETAIL LINE ON           
      *             THE REPORT, AND THEN MOVE ZEROS TO THE UNIT CUTOFF          
W27808* W27808  08/01/2005   UPDATE PROCESS INCORPORATING STORE EXPECTED        
W27808*              IN PLACE OF INTRANSIT     (SCOTT JACKSON)                  
R27808* R27808  08/01/2005   FIX STORE TOTAL GETTING SKIPPED. R.MCDONALD        
W28545* W28545  08-10-2006   B. GRAHAM - STRATAGEM                              
W28545* W28545               DEPARTMENT INVENTORY PROJECT                       
W28545* W28545               TINVPAR/TINCNTL JOIN                               
      *                                                                *        
W33304* W33304  08-11-2008   D. THEEL - HILO CHANGE                    *        
W33304*         REMOVED SUBSELECT IN 2600 AND ADDED TO WHERE CLAUSE    *        
W33304*         AND TINVPAR.LOC_INV_STAT_CDE = 'IN' AND TINVPAR.ACTL_  *        
W33304*         FIN_BK_DTE = '9999-09-09'. THIS WILL PREVENT RETURNING *        
W33304*         A DELETED LOCATION.                                    *        
W34557*                                                               *         
W34557* W34557  09/13/2011   INVENTORY CONTROL REQUESTED THAT          *        
W34557*                      CENTRAL STOCK VARIANCE DATA BE            *        
W34557*                      SENT TO THE WAREHOUSE.                    *        
W34557*                      REMOVED REFERENCES TO FOLLOWING :         *        
W34557*                      PS-STORE-TYPE-SW                          *        
W34557*                      PS-CS-STORE                               *        
W34557*                      PV-CS-RECS-BYPASSED                       *        
      ******************************************************************        
                                                                                
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
                                                                                
           SELECT BOOKING-SUMMARY-INPUT                                         
               ASSIGN TO INP01.                                                 
                                                                                
           SELECT BOOKING-VARIANCE-DW-OUTPUT                                    
               ASSIGN TO OUT01.                                                 
                                                                                
           SELECT RPT-NEG-OH-FILE                                               
               ASSIGN TO RPT01.                                                 
                                                                                
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
                                                                                
       FD  BOOKING-SUMMARY-INPUT                                                
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
       01  BOOKING-SUMMARY-INPUT-REC       PIC X(80).                           
                                                                                
       FD  BOOKING-VARIANCE-DW-OUTPUT                                           
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
       01  BOOKING-SUMMARY-OUTPUT-REC      PIC X(60).                           
                                                                                
       FD  RPT-NEG-OH-FILE                                                      
           LABEL RECORDS ARE STANDARD                                           
           RECORDING MODE IS F                                                  
           RECORD CONTAINS 132 CHARACTERS                                       
           DATA RECORD IS RPT-NEG-OH-RECORD.                                    
       01  RPT-NEG-OH-RECORD               PIC  X(132).                         
                                                                                
       WORKING-STORAGE SECTION.                                                 
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** WORKING STORAGE AREA BEGIN ***'.                                
                                                                                
       01  ABEND-CODE                      PIC S9(04)      VALUE ZEROES         
                               COMP SYNC.                                       
           88  ABEND-4003                                  VALUE +4003.         
           88  ABEND-4013                                  VALUE +4013.         
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** PROGRAM SWITCH AREA BEGIN ***'.                                 
                                                                                
       01  PS-PROGRAM-SWITCHES.                                                 
           05  PS-END-OF-INPUT-SW          PIC X(01)       VALUE 'N'.           
               88  PS-END-OF-INPUT                         VALUE 'Y'.           
           05  PS-MANIFESTED-STORE-SW      PIC X(01)       VALUE SPACES.        
               88  PS-MANIFESTED-STORE                     VALUE 'Y'.           
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** PROGRAM VARIABLE AREA BEGIN ***'.                               
                                                                                
       01  PV-PROGRAM-VARIABLES.                                                
           05  PV-REC-IN                   PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-REC-OUT                  PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-DEPT-TOT                 PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-DEPT-INT-TOT             PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-DEPT-NET-TOT             PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-STORE-TOT                PIC S9(11)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-STORE-INT-TOT            PIC S9(11)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-STORE-NET-TOT            PIC S9(11)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-GRAND-TOT                PIC S9(13)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-GRAND-INT-TOT            PIC S9(13)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-GRAND-NET-TOT            PIC S9(13)      VALUE ZEROES         
                               COMP-3.                                          
           05  PV-CUTOFF-ONHAND            PIC S9(09)      VALUE ZEROES         
                               COMP-3.                                          
W27808     05  PV-CUTOFF-STR-EXPECTED      PIC S9(09)      VALUE ZEROES         
W27808                         COMP-3.                                          
W26600     05  PV-PREV-STORE-NBR           PIC X(04)       VALUE ZEROES.        
W26600     05  PV-PREV-STORE-NBR-9 REDEFINES PV-PREV-STORE-NBR                  
W26600                                     PIC 9(04).                           
           05  PV-PREV-DEPT-NBR            PIC X(04)       VALUE SPACES.        
           05  PV-PREV-SKU                 PIC X(08).                           
           05  PV-PREV-SKU-9 REDEFINES PV-PREV-SKU                              
                                           PIC 9(08).                           
           05  FILLER REDEFINES PV-PREV-SKU.                                    
               10  PV-PREV-SKU-DEPT        PIC X(03).                           
               10  PV-PREV-SKU-CLASS       PIC X(02).                           
               10  PV-PREV-SKU-SEQ         PIC X(03).                           
           05  PV-PAGE-COUNT               PIC S9(04)      VALUE ZEROES         
                               COMP.                                            
           05  PV-LINE-COUNT               PIC S9(04)      VALUE ZEROES         
                               COMP.                                            
R27808     05  PV-STORE-LINE-COUNT         PIC S9(10)      VALUE ZEROES         
R27808                         COMP.                                            
           05  PV-ADVANCE-LINE             PIC S9(04)      VALUE +1             
                               COMP.                                            
           05  PV-TODAYS-DATE.                                                  
               10  PV-YY                   PIC 9(02)       VALUE ZEROES.        
               10  PV-MM                   PIC 9(02)       VALUE ZEROES.        
               10  PV-DD                   PIC 9(02)       VALUE ZEROES.        
           05  PV-TODAYS-TIME.                                                  
               10  PV-HR                   PIC 9(02)       VALUE ZEROES.        
               10  PV-MIN                  PIC 9(02)       VALUE ZEROES.        
               10  PV-SEC                  PIC 9(02)       VALUE ZEROES.        
               10  FILLER                  PIC 9(02)       VALUE ZEROES.        
           05  PV-DB2-OPER-ATTEMPTED       PIC X(30)       VALUE SPACES.        
           05  PV-PARAGRAPH-NAME           PIC X(30)       VALUE SPACES.        
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** PROGRAM CONSTANT AREA BEGIN ***'.                               
                                                                                
       01  PC-PROGRAM-CONSTANTS.                                                
           05  PC-LINE-MAX                 PIC S9(03)      VALUE +57.           
           05  PC-9S-DATE                  PIC X(10)       VALUE                
               '9999-09-09'.                                                    
W27808     05  PC-STREXPECT                PIC X(10)       VALUE                
W27808         'STR EXPECT'.                                                    
           05  PC-POST-FLUSH               PIC X(10)       VALUE                
               'POST FLUSH'.                                                    
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** REPORT WORK AREA BEGIN ***'.                                    
                                                                                
      ******************************************************************        
      *  HEADER LINE                                                            
      ******************************************************************        
           COPY DPWS133O.                                                       
                                                                                
       01  RH-REPORT-HEADING-1.                                                 
           05  FILLER                      PIC X(50)       VALUE SPACES.        
           05  FILLER                      PIC X(82)       VALUE                
               'NEGATIVE CUTOFF ONHAND QUANTITIES'.                             
                                                                                
       01  RH-REPORT-HEADING-2.                                                 
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(07)       VALUE                
               'STORE: '.                                                       
           05  RH-STORE-NBR                PIC Z999        VALUE ZEROES.        
           05  FILLER                      PIC X(03)       VALUE ' - '.         
           05  RH-STORE-NAME               PIC X(25)       VALUE SPACES.        
           05  FILLER                      PIC X(93)       VALUE SPACES.        
                                                                                
       01  RH-REPORT-HEADING-3.                                                 
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(04)       VALUE SPACES.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(05)       VALUE SPACES.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(08)       VALUE SPACES.        
           05  FILLER                      PIC X(10)       VALUE SPACES.        
           05  FILLER                      PIC X(10)       VALUE                
               '  CUTOFF  '.                                                    
           05  FILLER                      PIC X(09)       VALUE SPACES.        
W27808     05  RH-STREXPECT-POSTFLUSH      PIC X(10)       VALUE SPACES.        
           05  FILLER                      PIC X(09)       VALUE SPACES.        
           05  FILLER                      PIC X(10)       VALUE                
               'NET CTOFF '.                                                    
           05  FILLER                      PIC X(54)       VALUE SPACES.        
                                                                                
       01  RH-REPORT-HEADING-4.                                                 
           05  FILLER                      PIC X(01)       VALUE SPACE.         
           05  FILLER                      PIC X(04)       VALUE 'DEPT'.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(05)       VALUE                
               'CLASS'.                                                         
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(08)       VALUE                
               '   SKU  '.                                                      
           05  FILLER                      PIC X(10)       VALUE SPACES.        
           05  FILLER                      PIC X(10)       VALUE                
              'ONHAND QTY'.                                                     
           05  FILLER                      PIC X(09)       VALUE SPACES.        
           05  FILLER                      PIC X(10)       VALUE                
              'ONHAND QTY'.                                                     
           05  FILLER                      PIC X(09)       VALUE SPACES.        
           05  FILLER                      PIC X(10)       VALUE                
              'ONHAND QTY'.                                                     
           05  FILLER                      PIC X(54)       VALUE SPACES.        
                                                                                
       01  RH-REPORT-HEADING-5.                                                 
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(04)      VALUE ALL '-'.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(05)      VALUE ALL '-'.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  FILLER                      PIC X(08)      VALUE ALL '-'.        
           05  FILLER                      PIC X(10)       VALUE SPACES.        
           05  FILLER                      PIC X(10)      VALUE ALL '-'.        
           05  FILLER                      PIC X(09)       VALUE SPACES.        
           05  FILLER                      PIC X(10)      VALUE ALL '-'.        
           05  FILLER                      PIC X(09)       VALUE SPACES.        
           05  FILLER                      PIC X(10)      VALUE ALL '-'.        
           05  FILLER                      PIC X(54)       VALUE SPACES.        
                                                                                
       01  DL-DETAIL-LINE.                                                      
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  DL-DEPT-NBR                 PIC Z999        VALUE SPACES.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  DL-CLASS-NBR                PIC ZZ99        VALUE SPACES.        
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  DL-SKU-NBR                  PIC X(08)       VALUE SPACES.        
           05  FILLER                      PIC X(10)       VALUE SPACES.        
           05  DL-CUTOFF-ONHAND            PIC Z,ZZZ,ZZ9-  VALUE ZEROES.        
           05  FILLER                      PIC X(09)       VALUE SPACES.        
W27808     05  DL-STREXPECT-POSTFLUSH      PIC Z,ZZZ,ZZ9-  VALUE ZEROES.        
           05  FILLER                      PIC X(09)       VALUE SPACES.        
           05  DL-NET-CUTOFF-ONHAND        PIC Z,ZZZ,ZZ9-  VALUE ZEROES.        
           05  FILLER                      PIC X(54)       VALUE SPACES.        
                                                                                
R27808 01  TL-TOTAL-LINE                   PIC X(132)      VALUE SPACES.        
                                                                                
       01  RT-REPORT-TOTAL-DEPT.                                                
           05  FILLER                      PIC X(20)       VALUE                
               ' DEPARTMENT TOTAL:  '.                                          
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  RT-DEPT-TOT                 PIC Z,ZZZ,ZZZ,ZZZ,ZZ9-               
                                                           VALUE ZEROES.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  RT-DEPT-INT-TOT             PIC Z,ZZZ,ZZZ,ZZZ,ZZ9-               
                                                           VALUE ZEROES.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  RT-DEPT-NET-TOT             PIC Z,ZZZ,ZZZ,ZZZ,ZZ9-               
                                                           VALUE ZEROES.        
           05  FILLER                      PIC X(54)       VALUE SPACES.        
                                                                                
       01  RT-REPORT-TOTAL-STORE.                                               
           05  FILLER                      PIC X(20)       VALUE                
               ' STORE TOTAL:       '.                                          
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  RT-STORE-TOT                PIC Z,ZZZ,ZZZ,ZZZ,ZZ9-               
                                                           VALUE ZEROES.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  RT-STORE-INT-TOT            PIC Z,ZZZ,ZZZ,ZZZ,ZZ9-               
                                                           VALUE ZEROES.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  RT-STORE-NET-TOT            PIC Z,ZZZ,ZZZ,ZZZ,ZZ9-               
                                                           VALUE ZEROES.        
           05  FILLER                      PIC X(54)       VALUE SPACES.        
                                                                                
       01  RT-REPORT-TOTAL-GRAND.                                               
           05  FILLER                      PIC X(20)       VALUE                
               ' GRAND TOTAL:       '.                                          
           05  FILLER                      PIC X(02)       VALUE SPACES.        
           05  RT-GRAND-TOT                PIC Z,ZZZ,ZZZ,ZZZ,ZZ9-               
                                                           VALUE ZEROES.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  RT-GRAND-INT-TOT            PIC Z,ZZZ,ZZZ,ZZZ,ZZ9-               
                                                           VALUE ZEROES.        
           05  FILLER                      PIC X(01)       VALUE SPACES.        
           05  RT-GRAND-NET-TOT            PIC Z,ZZZ,ZZZ,ZZZ,ZZ9-               
                                                           VALUE ZEROES.        
           05  FILLER                      PIC X(54)       VALUE SPACES.        
                                                                                
       01  RE-END-OF-REPORT-MARKER.                                             
           05  FILLER                      PIC X(51)      VALUE ALL '*'.        
           05  FILLER                      PIC X(29)       VALUE                
               '  E N D   O F   R E P O R T  '.                                 
           05  FILLER                      PIC X(51)      VALUE ALL '*'.        
                                                                                
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** INPUT COPYBOOK AREA BEGIN ***'.                                 
                                                                                
      *****************************************************************         
      * INPUT SUMMARIZED DATA FILE                                              
      *****************************************************************         
           COPY INWS016.                                                        
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** OUTPUT COPYBOOK AREA BEGIN ***'.                                
                                                                                
      *****************************************************************         
      * OUTPUT VARIANCE FILE SENT TO DATA WAREHOUSE                             
      *****************************************************************         
           COPY INRD009.                                                        
                                                                                
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** DB2/SQL WORK AREA BEGIN ***'.                                   
                                                                                
      ****************************************************************          
      *  ERROR MESSAGE AREA FOR DB2                                             
      ****************************************************************          
           COPY DPWS004.                                                        
                                                                                
      *****************************************************************         
      *    DB2 COMMUNICATION AREA                                               
      *****************************************************************         
                                                                                
           EXEC SQL                                                             
               INCLUDE SQLCA                                                    
           END-EXEC.                                                            
      *****************************************************************         
      *    DB2 STORE TABLE                                                      
      *****************************************************************         
                                                                                
           EXEC SQL                                                             
W26600         INCLUDE XMT00001                                                 
           END-EXEC.                                                            
28545 *                                                                 01380000
28545 ******************************************************************01320000
28545 *  DCLGEN FOR THE INVENTORY CONTROL TABLE.                        01330000
28545 ******************************************************************01340000
28545      EXEC SQL                                                     01350000
28545          INCLUDE TINCNTL                                          01360000
28545      END-EXEC.                                                    01370000
28545 *                                                                 01380000
                                                                                
      ******************************************************************        
      *  LAYOUT USED FOR INVENTORY PARMS TABLE                                  
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE TINVPAR                                                  
           END-EXEC.                                                            
                                                                                
       01  FILLER                          PIC X(40)       VALUE                
           '*** WORKING STORAGE AREA END ***'.                                  
                                                                                
       LINKAGE SECTION.                                                         
                                                                                
       PROCEDURE DIVISION.                                                      
                                                                                
       1000-MAIN-MODULE.                                                        
                                                                                
           PERFORM 1100-HOUSEKEEPING.                                           
                                                                                
           PERFORM 2000-PROCESS-INPUT                                           
               UNTIL PS-END-OF-INPUT.                                           
                                                                                
           PERFORM 3000-EOJ.                                                    
                                                                                
           STOP RUN.                                                            
                                                                                
      ******************************************************************        
      *                                                                *        
      *    OPEN THE FILES, GET THE FIRST RECORD AND SAVE THE KEYS.     *        
      *                                                                *        
      ******************************************************************        
                                                                                
       1100-HOUSEKEEPING.                                                       
                                                                                
      ******************************************************************        
      * GET THE SYSTEM TIME AND MOVE IT TO THE REPORT HEADING. SET              
      * THE REPORT NAME AND NUMBER.                                             
      ******************************************************************        
                                                                                
           ACCEPT PV-TODAYS-DATE FROM DATE.                                     
           ACCEPT PV-TODAYS-TIME FROM TIME.                                     
           MOVE PV-MM           TO DP133O-RUN-MONTH.                            
           MOVE PV-DD           TO DP133O-RUN-DAY.                              
           MOVE PV-YY           TO DP133O-RUN-YEAR.                             
           MOVE PV-HR           TO DP133O-RUN-HOUR.                             
           MOVE PV-MIN          TO DP133O-RUN-MINUTE.                           
           MOVE 'INKUT120'      TO DP133O-PROGRAM-NAME.                         
                                                                                
           OPEN  INPUT BOOKING-SUMMARY-INPUT                                    
                OUTPUT BOOKING-VARIANCE-DW-OUTPUT                               
                OUTPUT RPT-NEG-OH-FILE.                                         
                                                                                
                                                                                
           PERFORM 5000-READ-BOOKING-SUMMARY.                                   
                                                                                
      ******************************************************************        
      *    PROCESS THE INPUT FILE                                      *        
      ******************************************************************        
       2000-PROCESS-INPUT.                                                      
                                                                                
           MOVE ZEROES               TO PV-LINE-COUNT                           
R27808                                  PV-STORE-LINE-COUNT                     
                                        PV-STORE-TOT                            
                                        PV-STORE-INT-TOT.                       
W26600*    MOVE IN016-STORE          TO PV-PREV-STORE-NBR.                      
W26600     MOVE IN016-STORE-9        TO PV-PREV-STORE-NBR-9.                    
                                                                                
           PERFORM 2600-GET-STORE-ATTR.                                         
                                                                                
           PERFORM 2100-PROCESS-STORE                                           
W26600*        UNTIL IN016-STORE NOT = PV-PREV-STORE-NBR                        
W26600         UNTIL IN016-STORE-9 NOT = PV-PREV-STORE-NBR-9                    
                   OR PS-END-OF-INPUT.                                          
                                                                                
           ADD PV-STORE-TOT          TO PV-GRAND-TOT.                           
           ADD PV-STORE-INT-TOT      TO PV-GRAND-INT-TOT.                       
           COMPUTE PV-GRAND-NET-TOT = PV-GRAND-TOT - PV-GRAND-INT-TOT.          
                                                                                
           IF PV-LINE-COUNT > ZEROES                                            
R27808         OR PV-STORE-LINE-COUNT > ZEROES                                  
               OR PS-END-OF-INPUT                                               
      * PRODUCE A TRAILER FOR BOTH DEPT AND STORE.                              
               PERFORM 4100-PRINT-TRAILER                                       
           END-IF.                                                              
                                                                                
      ******************************************************************        
      *    PROCESS THE INPUT FOR THE STORE                             *        
      ******************************************************************        
       2100-PROCESS-STORE.                                                      
                                                                                
           MOVE ZEROES               TO PV-LINE-COUNT                           
                                        PV-DEPT-TOT                             
                                        PV-DEPT-INT-TOT.                        
           MOVE IN016-DEPT           TO PV-PREV-DEPT-NBR.                       
                                                                                
           PERFORM 2200-PROCESS-DEPT                                            
               UNTIL IN016-DEPT NOT = PV-PREV-DEPT-NBR                          
W26600*            OR IN016-STORE NOT = PV-PREV-STORE-NBR                       
W26600             OR IN016-STORE-9 NOT = PV-PREV-STORE-NBR-9                   
                   OR PS-END-OF-INPUT.                                          
                                                                                
           ADD PV-DEPT-TOT           TO PV-STORE-TOT.                           
           ADD PV-DEPT-INT-TOT       TO PV-STORE-INT-TOT.                       
                                                                                
           COMPUTE PV-DEPT-NET-TOT = PV-DEPT-TOT - PV-DEPT-INT-TOT.             
                                                                                
           COMPUTE PV-STORE-NET-TOT = PV-STORE-TOT - PV-STORE-INT-TOT.          
                                                                                
      * PRODUCE A TRAILER UPON A DEPT CHANGE ONLY.  THE DEPT TRAILER            
      * WILL BE PRODUCE AUTOMATICALLY WHEN A STORE CHANGE ON PREV LEVEL         
W26600*    IF IN016-STORE = PV-PREV-STORE-NBR                                   
W26600     IF IN016-STORE-9 = PV-PREV-STORE-NBR-9                               
               AND NOT PS-END-OF-INPUT                                          
               AND PV-LINE-COUNT > ZEROES                                       
               PERFORM 4100-PRINT-TRAILER                                       
           END-IF.                                                              
                                                                                
      ******************************************************************        
      *    PROCESS THE INPUT FOR THE DEPARTMENT                        *        
      ******************************************************************        
       2200-PROCESS-DEPT.                                                       
                                                                                
           ADD 1      TO  PV-REC-IN.                                            
                                                                                
      * THERE SHOULD NOT BE ANY DUPLICATE SKU, BECAUSE UNIT BOOKING             
      * PROCESS SHOULD HAVE ONLY PRODUCED 1 SKU/STORE COMBINATION               
      * RECORD AND PROCESS ONLY 1 ADJUSTMENT PER SKU/STORE COMBINATION.         
           IF PV-PREV-SKU = IN016-SKU                                           
               DISPLAY '  *** DUPLICATE SKU/STORE COMBINATION ***'              
               DISPLAY '      STORE/SKU: ' IN016-STORE                          
                       '/' IN016-SKU                                            
               DISPLAY '  PARAGRAPH: 2200-PROCESS-DEPT'                         
               SET ABEND-4003 TO TRUE                                           
               PERFORM 9999-ABEND                                               
           END-IF.                                                              
                                                                                
W26600*    MOVE IN016-STORE              TO PV-PREV-STORE-NBR.                  
W26600     MOVE IN016-STORE-9            TO PV-PREV-STORE-NBR-9.                
           MOVE IN016-DEPT               TO PV-PREV-DEPT-NBR.                   
           MOVE IN016-SKU                TO PV-PREV-SKU.                        
                                                                                
W34557     MOVE ZEROES                   TO IN009-UPC-ID                        
                                                                                
W34557     MOVE PV-PREV-STORE-NBR-9      TO IN009-STR-NBR                       
                                                                                
W34557     MOVE IN016-ITEM-NUMBER        TO IN009-ITM-NBR                       
                                                                                
W34557     MOVE IN016-INV-DATE           TO IN009-INV-DTE                       
W34557     MOVE IN016-STAT-CDE           TO IN009-STAT-CDE                      
                                                                                
W34557     MOVE IN016-QTY                TO IN009-PHY-CNT                       
                                                                                
W34557     IF PS-MANIFESTED-STORE                                               
W34557         COMPUTE PV-CUTOFF-ONHAND = IN016-OLD-ONHAND-QTY                  
W34557                              - (IN016-STR-EXP-OH-QTY -                   
W34557                                 IN016-CUTOFF-INTRANSIT)                  
W34557     ELSE                                                                 
W34557         COMPUTE PV-CUTOFF-ONHAND = IN016-OLD-ONHAND-QTY                  
W34557                                  - IN016-AFTER-RECEIPTS                  
W34557     END-IF                                                               
                                                                                
W34557     MOVE PV-CUTOFF-ONHAND         TO IN009-TRUE-CUTOFF-QTY               
                                                                                
W34557     IF PV-CUTOFF-ONHAND < 0                                              
W34557         PERFORM 4000-PREPARE-REPORT                                      
                                                                                
W34557         MOVE ZERO TO IN016-OLD-ONHAND-QTY                                
W34557                      IN016-AFTER-RECEIPTS                                
W34557                      IN016-CUTOFF-INTRANSIT                              
W34557                  IN016-STR-EXP-OH-QTY                                    
W34557                  PV-CUTOFF-ONHAND                                        
W34557     END-IF                                                               
                                                                                
W34557     MOVE PV-CUTOFF-ONHAND         TO IN009-UNT-CTOFF                     
                                                                                
W34557     PERFORM 5100-WRITE-VARIANCE                                          
                                                                                
           PERFORM 5000-READ-BOOKING-SUMMARY.                                   
                                                                                
      ******************************************************************        
      *     GET STORE ATTRIBUTES                                                
      ******************************************************************        
       2600-GET-STORE-ATTR.                                                     
                                                                                
W26600     MOVE PV-PREV-STORE-NBR-9 TO XMT00001-LOC-NBR.                        
W26600                                                                          
           EXEC SQL                                                             
                SELECT                                                          
W34557                   A.LOC_NM                                               
                        ,B.MFSTNG_IND                                           
                INTO                                                            
W34557                :XMT00001-LOC-NM                                          
                     ,:PS-MANIFESTED-STORE-SW                                   
                FROM  XMT_LOC A                                                 
                     ,TINVPAR B                                                 
28545                ,TINCNTL D                                                 
W26600          WHERE A.LOC_NBR    = :XMT00001-LOC-NBR                          
W26600            AND B.LOC_NBR    = A.LOC_NBR                                  
W33304            AND B.LOC_INV_STAT_CDE = 'IN'                                 
W33304            AND B.ACTL_FIN_BK_DTE  = '9999-09-09'                         
28545             AND B.INV_ID = D.INV_ID                                       
28545             AND D.ACTV_IND = 'Y'                                          
           END-EXEC                                                             
                                                                                
           EVALUATE TRUE                                                        
               WHEN SQLCODE = ZERO                                              
W26600             MOVE PV-PREV-STORE-NBR-9 TO RH-STORE-NBR                     
W26600             MOVE XMT00001-LOC-NM     TO RH-STORE-NAME                    
                   IF PS-MANIFESTED-STORE                                       
W27808                 MOVE PC-STREXPECT    TO RH-STREXPECT-POSTFLUSH           
                   ELSE                                                         
W27808                 MOVE PC-POST-FLUSH   TO RH-STREXPECT-POSTFLUSH           
                   END-IF                                                       
               WHEN OTHER                                                       
                   DISPLAY ' STORE: ' PV-PREV-STORE-NBR-9                       
                   MOVE '2600-GET-STORE-ATTR' TO PV-PARAGRAPH-NAME              
                   MOVE 'SELECT FROM TINVPAR/XMTLOC'                            
                                            TO PV-DB2-OPER-ATTEMPTED            
                   PERFORM 9998-SQL-ABEND                                       
           END-EVALUATE.                                                        
                                                                                
      ******************************************************************        
      *     CLEAN UP/END OF JOB/PROGRAM                                         
      ******************************************************************        
       3000-EOJ.                                                                
                                                                                
           DISPLAY '*********************************'.                         
           DISPLAY '*        INKUT120 COUNTS        *'.                         
           DISPLAY '* '                                                         
                   PV-REC-IN                                                    
                   ' RECORDS READ        *'.                                    
           DISPLAY '* '                                                         
                   PV-REC-OUT                                                   
                   ' RECORDS WRITTEN     *'.                                    
           DISPLAY '*                               *'.                         
           DISPLAY '*********************************'.                         
                                                                                
           CLOSE BOOKING-SUMMARY-INPUT                                          
                 BOOKING-VARIANCE-DW-OUTPUT                                     
                 RPT-NEG-OH-FILE.                                               
                                                                                
      ******************************************************************        
      *    PREPARE NEGATIVE ONHAND REPORT                              *        
      ******************************************************************        
       4000-PREPARE-REPORT.                                                     
                                                                                
           MOVE IN016-DEPT-9         TO DL-DEPT-NBR.                            
           MOVE IN016-CLASS-9        TO DL-CLASS-NBR.                           
           MOVE IN016-SKU            TO DL-SKU-NBR.                             
                                                                                
           MOVE IN016-OLD-ONHAND-QTY TO DL-CUTOFF-ONHAND.                       
                                                                                
           IF PS-MANIFESTED-STORE                                               
W27808         COMPUTE PV-CUTOFF-STR-EXPECTED =                                 
W27808           (IN016-STR-EXP-OH-QTY - IN016-CUTOFF-INTRANSIT)                
W27808         MOVE PV-CUTOFF-STR-EXPECTED TO DL-STREXPECT-POSTFLUSH            
W27808         ADD PV-CUTOFF-STR-EXPECTED TO PV-DEPT-INT-TOT                    
           ELSE                                                                 
W27808         MOVE IN016-AFTER-RECEIPTS   TO DL-STREXPECT-POSTFLUSH            
               ADD  IN016-AFTER-RECEIPTS   TO PV-DEPT-INT-TOT                   
           END-IF.                                                              
                                                                                
           MOVE PV-CUTOFF-ONHAND     TO DL-NET-CUTOFF-ONHAND.                   
                                                                                
           PERFORM 4500-PRINT-DETAIL.                                           
                                                                                
           ADD IN016-OLD-ONHAND-QTY  TO PV-DEPT-TOT.                            
                                                                                
      ******************************************************************        
      *    PRINT THE REPORT TOTALS/TRAILER                                      
      ******************************************************************        
       4100-PRINT-TRAILER.                                                      
                                                                                
           IF (IN016-DEPT NOT = PV-PREV-DEPT-NBR                                
               OR PS-END-OF-INPUT)                                              
               AND PV-LINE-COUNT > ZEROES                                       
               MOVE PV-DEPT-TOT             TO RT-DEPT-TOT                      
               MOVE PV-DEPT-INT-TOT         TO RT-DEPT-INT-TOT                  
               MOVE PV-DEPT-NET-TOT         TO RT-DEPT-NET-TOT                  
R27808         MOVE RT-REPORT-TOTAL-DEPT    TO TL-TOTAL-LINE                    
               MOVE 2                       TO PV-ADVANCE-LINE                  
               PERFORM 4700-PRINT-TOTAL                                         
           END-IF.                                                              
                                                                                
W26600*    IF IN016-STORE NOT = PV-PREV-STORE-NBR                               
R27808*    IF IN016-STORE-9 NOT = PV-PREV-STORE-NBR-9                           
R27808     IF (IN016-STORE-9 NOT = PV-PREV-STORE-NBR-9                          
R27808         AND PV-STORE-LINE-COUNT > 0)                                     
               OR PS-END-OF-INPUT                                               
               MOVE PV-STORE-TOT            TO RT-STORE-TOT                     
               MOVE PV-STORE-INT-TOT        TO RT-STORE-INT-TOT                 
               MOVE PV-STORE-NET-TOT        TO RT-STORE-NET-TOT                 
R27808         MOVE RT-REPORT-TOTAL-STORE   TO TL-TOTAL-LINE                    
               MOVE 2                       TO PV-ADVANCE-LINE                  
               PERFORM 4700-PRINT-TOTAL                                         
           END-IF.                                                              
                                                                                
           IF PS-END-OF-INPUT                                                   
               MOVE PV-GRAND-TOT            TO RT-GRAND-TOT                     
               MOVE PV-GRAND-INT-TOT        TO RT-GRAND-INT-TOT                 
               MOVE PV-GRAND-NET-TOT        TO RT-GRAND-NET-TOT                 
R27808         MOVE RT-REPORT-TOTAL-GRAND   TO TL-TOTAL-LINE                    
               MOVE 2                       TO PV-ADVANCE-LINE                  
               PERFORM 4700-PRINT-TOTAL                                         
               MOVE RE-END-OF-REPORT-MARKER TO DL-DETAIL-LINE                   
                                                                                
               MOVE 3                       TO PV-ADVANCE-LINE                  
               PERFORM 4500-PRINT-DETAIL                                        
           END-IF.                                                              
                                                                                
      ******************************************************************        
      *    PRINT NEGATIVE ONHAND REPORT DETAIL LINE                    *        
      ******************************************************************        
       4500-PRINT-DETAIL.                                                       
                                                                                
           IF PV-LINE-COUNT + PV-ADVANCE-LINE > PC-LINE-MAX                     
               OR PV-LINE-COUNT = ZEROES                                        
               PERFORM 4600-PRINT-HEADER                                        
           END-IF.                                                              
                                                                                
           WRITE RPT-NEG-OH-RECORD FROM DL-DETAIL-LINE                          
               AFTER ADVANCING PV-ADVANCE-LINE LINES.                           
                                                                                
           MOVE SPACES         TO DL-DETAIL-LINE.                               
R27808*    ADD PV-ADVANCE-LINE TO PV-LINE-COUNT.                                
R27808     ADD PV-ADVANCE-LINE TO PV-LINE-COUNT                                 
R27808                            PV-STORE-LINE-COUNT.                          
           MOVE 1              TO PV-ADVANCE-LINE.                              
                                                                                
      ******************************************************************        
      *    PRINT THE REPORT HEADINGS                                            
      ******************************************************************        
       4600-PRINT-HEADER.                                                       
                                                                                
           ADD 1                    TO PV-PAGE-COUNT.                           
                                                                                
           MOVE PV-PAGE-COUNT       TO DP133O-PAGE-NUMBER.                      
           MOVE 1                   TO DP133O-REPORT-NUMBER.                    
           WRITE RPT-NEG-OH-RECORD                                              
               FROM DP133O-STANDRD-HEADER-133-COLS                              
               AFTER ADVANCING PAGE.                                            
                                                                                
           WRITE RPT-NEG-OH-RECORD FROM RH-REPORT-HEADING-1.                    
                                                                                
           WRITE RPT-NEG-OH-RECORD FROM RH-REPORT-HEADING-2                     
               AFTER ADVANCING 2 LINES.                                         
                                                                                
           WRITE RPT-NEG-OH-RECORD FROM RH-REPORT-HEADING-3.                    
                                                                                
           WRITE RPT-NEG-OH-RECORD FROM RH-REPORT-HEADING-4.                    
                                                                                
           WRITE RPT-NEG-OH-RECORD FROM RH-REPORT-HEADING-5.                    
                                                                                
           MOVE 8 TO PV-LINE-COUNT.                                             
                                                                                
R27808***************************************************************** *       
R27808*   PRINT NEGATIVE ONHAND REPORT DETAIL LINE                    *         
R27808***************************************************************** *       
R27808 4700-PRINT-TOTAL.                                                        
R27808                                                                          
R27808     IF PV-LINE-COUNT + PV-ADVANCE-LINE > PC-LINE-MAX                     
R27808         PERFORM 4600-PRINT-HEADER                                        
R27808     END-IF.                                                              
R27808                                                                          
R27808     WRITE RPT-NEG-OH-RECORD FROM TL-TOTAL-LINE                           
R27808         AFTER ADVANCING PV-ADVANCE-LINE LINES.                           
R27808                                                                          
R27808     MOVE SPACES         TO TL-TOTAL-LINE.                                
R27808     ADD PV-ADVANCE-LINE TO PV-LINE-COUNT                                 
R27808                            PV-STORE-LINE-COUNT.                          
R27808     MOVE 1              TO PV-ADVANCE-LINE.                              
                                                                                
      ******************************************************************        
      *    READ THE INPUT FILE.                                        *        
      ******************************************************************        
       5000-READ-BOOKING-SUMMARY.                                               
                                                                                
           READ BOOKING-SUMMARY-INPUT INTO IN016-PHYSICAL-COUNT-RECORD          
               AT END SET PS-END-OF-INPUT TO TRUE.                              
                                                                                
      ******************************************************************        
      *    WRITE OUT VARIANCE EXTRACT RECORD                           *        
      ******************************************************************        
       5100-WRITE-VARIANCE.                                                     
                                                                                
           ADD 1           TO  PV-REC-OUT.                                      
                                                                                
           WRITE BOOKING-SUMMARY-OUTPUT-REC FROM IN009-VARIANCE-RECORD.         
                                                                                
      ******************************************************************        
      *    EXECUTE ABEND ROUTINE                                       *        
      ******************************************************************        
       9998-SQL-ABEND.                                                          
                                                                                
           SET ABEND-4013 TO TRUE.                                              
           DISPLAY ' '.                                                         
           DISPLAY '** ABEND **         ** = SQLERROR'.                         
           DISPLAY '** PROGRAM          ** = INKUT120'.                         
           DISPLAY '** PARAGRAPH        ** = ' PV-PARAGRAPH-NAME.               
           DISPLAY '** OPERATION        ** = ' PV-DB2-OPER-ATTEMPTED.           
                                                                                
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE                 
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.                
           COPY DPPD004.                                                        
                                                                                
           PERFORM 9999-ABEND.                                                  
                                                                                
                                                                                
       9999-ABEND.                                                              
                                                                                
           CALL 'ILBOABN0' USING ABEND-CODE.                                    
                                                                                
