000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    VNKCS008.                                         00040000
000500 AUTHOR.        DOUG NOLTNER - STRATAGEM.                         00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  06/93.                                            00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    V008 - VENDOR ADDITIONAL NAME LIST PROGRAM                 * 00110003
001200*                                                               * 00120000
001300*    THIS PROGRAM GENERATES A LIST OF VENDORS NAMES FOR         * 00130000
001400*    MAINTENANCE.                                               * 00140000
001401*---------------------------------------------------------------* 00140107
001402* CHANGE LOG:                                                   * 00140207
001410*  DATE  09/07/2021                                              *00141007
001420*            - CHANGE CALL OF DPKUT100 TO                       * 00142007
001430*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00143007
001440*              MAKING THE CALL DYNAMIC VS STATIC                * 00144007
001450*      MADE BY: GERMAN BANDA            WR/IR #: CHG0261091      *00145009
001460*                                                               * 00146007
001410*  DATE  01/05/2023                                              *00147010
001420*            - CHANGE CALL OF DPKCS030 TO DYNAMIC               * 00148010
001450*      MADE BY: JEAN KURK               WR/IR #: CHG0277999      *00149210
001460*                                                               * 00149310
001500*---------------------------------------------------------------* 00150000
001600 EJECT                                                            00160000
001700 ENVIRONMENT DIVISION.                                            00170000
001800                                                                  00180000
001900 DATA DIVISION.                                                   00190000
002000                                                                  00200000
002100 WORKING-STORAGE SECTION.                                         00210000
002200                                                                  00220000
002300 01  PC-PROGRAM-CONSTANTS.                                        00230000
002400     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00240000
002500                                                    'VN008A  '.   00250000
002600     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00260000
002700                                                    'VNKM008 '.   00270000
002800     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00280000
002900                                                    'VNKCS008'.   00290000
003000     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00300000
003100     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00310000
003200     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00320000
003300     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     00330000
003400                                                    COMP SYNC.    00340000
003500     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00350000
003600                                                    COMP SYNC.    00360000
003700     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00370000
003800                                                    +1000000      00380000
003900                                                    COMP-3.       00390000
004000     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00400000
004100                                                    COMP SYNC.    00410000
004200     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00420000
004300                                                    COMP-3.       00430000
004400     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00440000
004500     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00450000
004600     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00460000
004700     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00470000
004800     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00480000
004900     05  PC-TYPE-CODES.                                           00490000
005000         10  PC-ALIAS                   PIC  X(02)  VALUE '02'.   00500000
005100         10  PC-LABEL                   PIC  X(02)  VALUE '03'.   00510000
005110         10  PC-LONGNAME                PIC  X(02)  VALUE '05'.   00511001
005200*                                                                 00520000
005300     05  PC-TSYMSG-NUMBERS.                                       00530000
005400         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00540000
005500         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00550000
005600         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00560000
005700         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00570000
005800         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00580000
005900         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00590000
006000         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00600000
006100         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00610000
006200         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00620000
006300         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00630000
006400         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00640000
006500         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00650000
006600         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00660000
006700         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00670000
006800*                                                                 00680000
006900 01  PS-PROGRAM-SWITCHES.                                         00690000
007000     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00700000
007100         88  PS-NO-ERROR                            VALUE 'Y'.    00710000
007200         88  PS-ERROR                               VALUE 'N'.    00720000
007300     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00730000
007400         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00740000
007500         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00750000
007600     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    00760000
007700         88  PS-DONE                                VALUE 'Y'.    00770000
007800         88  PS-NOT-DONE                            VALUE 'N'.    00780000
007900*                                                                 00790000
008000 01  PL-PROGRAM-LITERALS.                                         00800000
008100     05  PL-ALIAS                       PIC  X(10)  VALUE         00810000
008200                                                    'ALIAS     '. 00820000
008300     05  PL-LABEL                       PIC  X(10)  VALUE         00830000
008400                                                    'LABEL     '. 00840000
008410     05  PL-LONGNAME                    PIC  X(10)  VALUE         00841001
008420                                                    'LONG NAME '. 00842001
008500*                                                                 00850000
008600 01  PV-PROGRAM-VARIABLES.                                        00860000
008700     05  PV-SUB                         PIC S9(04)  VALUE +0      00870000
008800                                                    COMP SYNC.    00880000
008900     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00890000
009000                                                    COMP SYNC.    00900000
009100     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00910000
009200                                                    COMP-3.       00920000
009300     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00930000
009400                                                    COMP-3.       00940000
009500     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      00950000
009600                                                    COMP-3.       00960000
009700     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00970000
009800                                                    COMP-3.       00980000
009900     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00990000
010000                                                    COMP-3.       01000000
010100     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01010000
010200                                                    COMP-3.       01020000
010300     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01030000
010400                                                    COMP-3.       01040000
010500     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01050000
010600                                                    COMP SYNC.    01060000
010700     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01070000
010800                                                    COMP SYNC.    01080000
010900     05  PV-ITEM                        PIC S9(04)  VALUE +0      01090000
011000                                                    COMP SYNC.    01100000
011100     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01110000
011200                                                    COMP SYNC.    01120000
011300     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01130000
011400                                                    COMP SYNC.    01140000
011500     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01150000
011600                                                    COMP SYNC.    01160000
011700     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01170000
011800                                                    COMP SYNC.    01180000
011900     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01190000
012000                                                    COMP SYNC.    01200000
012100     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01210000
012200                                                    COMP SYNC.    01220000
012300     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01230000
012400                                                    COMP SYNC.    01240000
012500     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01250000
012600                                                    COMP SYNC.    01260000
012700     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01270000
012800                                                    COMP SYNC.    01280000
012900     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01290000
013000                                                    COMP SYNC.    01300000
013100     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01310000
013200                                                    COMP SYNC.    01320000
013300     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01330000
013400                                                    COMP SYNC.    01340000
013500     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01350000
013600                                                    COMP SYNC.    01360000
013700******************************************************************01370000
013800**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01380000
013900**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01390000
014000**  APPLICATION-SPECIFIC COMMAREA.                              **01400000
014100******************************************************************01410000
014200 01  LQW-LIST-QUEUE-WORK-AREA.                                    01420000
014300     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01430000
014400     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           01440000
014500                                        INDEXED BY LQW-IDX.       01450000
014600         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01460000
014700         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01470000
014800         10  LQW-SELECTED-SW            PIC  X(01).               01480000
014900             88  LQW-SELECT                         VALUE 'S'.    01490000
015000             88  LQW-DESELECT                       VALUE ' '.    01500000
015100         10  LQW-ACTION                 PIC  X(03).               01510000
015200         10  LQW-VEND-NAME              PIC  X(49).               01520005
015300         10  LQW-TYPE-CDE               PIC  X(02).               01530000
015400         10  LQW-SEQ-NBR                PIC S9(04)  COMP.         01540000
015500                                                                  01550000
015600     EJECT                                                        01560000
015700*---------------------------------------------------------------* 01570000
015800*  RECORD LAYOUT FOR THE VENDOR  SELECTION TEMP STORAGE QUEUE.  * 01580000
015900*---------------------------------------------------------------* 01590000
016000                                                                  01600000
016100     COPY VNWS003.                                                01610000
016200                                                                  01620000
016300     EJECT                                                        01630000
016400*---------------------------------------------------------------* 01640000
016500*    MAP LAYOUT                                                 * 01650000
016600*---------------------------------------------------------------* 01660000
016700                                                                  01670000
016800     COPY VNKM008.                                                01680000
016900*                                                                 01690000
017000 01  MR-OCCURS-LAYOUT                   REDEFINES  VN008AO.       01700000
017100     05  FILLER                         PIC X(83).                01710000
017200     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          01720000
017300         10  MR-SELECTL                 PIC S9(04) COMP.          01730000
017400         10  MR-SELECTA                 PIC  X(01).               01740000
017500         10  MR-SELECTC                 PIC  X(01).               01750000
017600         10  MR-SELECTH                 PIC  X(01).               01760000
017700         10  MR-SELECTI                 PIC  X(01).               01770000
017800                                                                  01780000
017900         10  MR-ACTIONL                 PIC S9(04) COMP.          01790000
018000         10  MR-ACTIONA                 PIC  X(01).               01800000
018100         10  MR-ACTIONC                 PIC  X(01).               01810000
018200         10  MR-ACTIONH                 PIC  X(01).               01820000
018300         10  MR-ACTION                  PIC  X(03).               01830000
018400                                                                  01840000
018500         10  MR-VEND-NAMEL              PIC S9(04) COMP.          01850000
018600         10  MR-VEND-NAMEA              PIC  X(01).               01860000
018700         10  MR-VEND-NAMEC              PIC  X(01).               01870000
018800         10  MR-VEND-NAMEH              PIC  X(01).               01880000
018900         10  MR-VEND-NAME               PIC  X(49).               01890005
019000                                                                  01900000
019100         10  MR-TYPE-CDEL               PIC S9(04) COMP.          01910000
019200         10  MR-TYPE-CDEA               PIC  X(01).               01920000
019300         10  MR-TYPE-CDEC               PIC  X(01).               01930000
019400         10  MR-TYPE-CDEH               PIC  X(01).               01940000
019500         10  MR-TYPE-CDE                PIC  X(02).               01950000
019600                                                                  01960000
019700         10  MR-TYPE-DSCL               PIC S9(04) COMP.          01970000
019800         10  MR-TYPE-DSCA               PIC  X(01).               01980000
019900         10  MR-TYPE-DSCC               PIC  X(01).               01990000
020000         10  MR-TYPE-DSCH               PIC  X(01).               02000000
020100         10  MR-TYPE-DSC                PIC  X(10).               02010000
020200                                                                  02020000
020300     EJECT                                                        02030000
020400*---------------------------------------------------------------* 02040000
020500*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02050000
020600*---------------------------------------------------------------* 02060000
020700                                                                  02070000
020800     COPY DPWS015.                                                02080000
020900                                                                  02090000
021000*---------------------------------------------------------------* 02100000
021100*    FUNCTION KEYS COPYBOOK.                                    * 02110000
021200*---------------------------------------------------------------* 02120000
021300                                                                  02130000
021400     COPY DPWS016.                                                02140000
021500                                                                  02150000
021600*---------------------------------------------------------------* 02160000
021700*    NUMERIC EDIT LAYOUT.                                       * 02170000
021800*---------------------------------------------------------------* 02180000
021900                                                                  02190000
022000     COPY DPWS010I.                                               02200000
022100 EJECT                                                            02210000
022200*---------------------------------------------------------------* 02220000
022300*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * 02230010
022400*---------------------------------------------------------------* 02240000
022500                                                                  02250000
022600     COPY DPWS030.                                                02260000
022600     COPY DPWS930.                                                02261010
022700 EJECT                                                            02270000
022800*---------------------------------------------------------------* 02280000
022900*    STANDARD COMMAREA.                                         * 02290000
023000*---------------------------------------------------------------* 02300000
023100                                                                  02310000
023200     COPY DPWS020.                                                02320000
023300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02330000
023400                                                                  02340000
023500*---------------------------------------------------------------* 02350000
023600* INTER-APPLICATION COMMAREA.                                   * 02360000
023700*   VNWS004 - INPUT FROM VENDOR MAINTANENCE                     * 02370000
023800*   VNWS002 - OUTPUT FROM SELECTION LIST                        * 02380000
023900*---------------------------------------------------------------* 02390000
024000                                                                  02400000
024100         10  INTER-APPL-COMM-AREA       PIC X(200).               02410000
024200     COPY VNWS004.                                                02420000
024300     COPY VNWS002.                                                02430000
024400*---------------------------------------------------------------* 02440000
024500*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02450000
024600*---------------------------------------------------------------* 02460000
024700         10  ASC-SPECIFIC-COMMAREA.                               02470000
024800             15  ASC-LIST-KEYS.                                   02480000
024900                 20  ASC-ENT-ID                      PIC S9(09)   02490000
025000                                                     COMP.        02500000
025100             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02510000
025200                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02520000
025300                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02530000
025400                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   02540000
025500                                                                  02550000
025600                 20  ASC-ITEM-ARRAY.                              02560000
025700                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        02570000
025800                         30  ASC-LIST-ITEM-NUMBER                 02580000
025900                                                     PIC S9(09)   02590000
026000                                                     COMP-3.      02600000
026100                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  02610000
026200                             88  ASC-VALID-SELECT    VALUE ' '    02620000
026300                                                           'S'    02630000
026400                                                           'B'    02640000
026500                                                           'E'.   02650000
026600                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   02660000
026700                             88  ASC-TEMP-SELECT     VALUE 'S'.   02670000
026800                             88  ASC-TEMP-BEGIN      VALUE 'B'.   02680000
026900                             88  ASC-TEMP-END        VALUE 'E'.   02690000
027000                         30  ASC-SELECTED-SW         PIC  X(01).  02700000
027100                             88  ASC-NO-SELECT       VALUE ' '.   02710000
027200                             88  ASC-SELECT          VALUE 'S'.   02720000
027300                             88  ASC-BEGIN           VALUE 'B'.   02730000
027400                             88  ASC-END             VALUE 'E'.   02740000
027500                         30  ASC-ACTION              PIC  X(03).  02750000
027600                         30  ASC-VEND-NAME           PIC  X(49).  02760005
027700                         30  ASC-TYPE-CDE            PIC  X(02).  02770000
027800                         30  ASC-SEQ-NBR             PIC S9(04)   02780000
027900                                                     COMP.        02790000
028000                                                                  02800000
028100             15  ASC-BLK-SUB                         PIC S9(04)   02810000
028200                                                          COMP    02820000
028300                                                          SYNC.   02830000
028400             15  ASC-ITEM-SUB                        PIC S9(04)   02840000
028500                                                          COMP    02850000
028600                                                          SYNC.   02860000
028700             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   02870000
028800                                                          COMP-3. 02880000
028900             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   02890000
029000                                                          COMP-3. 02900000
029100             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   02910000
029200                                                          COMP-3. 02920000
029300             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   02930000
029400                                                          COMP-3. 02940000
029500             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   02950000
029600                                                          COMP-3. 02960000
029700             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   02970000
029800                                                          COMP    02980000
029900                                                          SYNC.   02990000
030000             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03000000
030100                                                          COMP-3. 03010000
030200             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03020000
030300                                                          COMP-3. 03030000
030400             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03040000
030500                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03050000
030600                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03060000
030700             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03070000
030800                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03080000
030900                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03090000
031000             15  ASC-LIST-QUEUE-NAME.                             03100000
031100                 20  ASC-LIST-TERM-ID                PIC  X(04).  03110000
031200                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03120000
031300                                                          COMP-3. 03130000
031400                 20  ASC-LIST-SEQ                    PIC  9(01).  03140000
031500             15  ASC-SEL-QUEUE-NAME.                              03150000
031600                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03160000
031700                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03170000
031800                                                          COMP-3. 03180000
031900                 20  ASC-SEL-SEQ                     PIC  9(01).  03190000
032000                                                                  03200000
032100             15  ASC-START-ITEM-REQUEST.                          03210000
032200                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03220000
032300             15  ASC-HEAD-VEND-NAME                  PIC  X(30).  03230000
032400     EJECT                                                        03240000
032500*---------------------------------------------------------------* 03250000
032600*    ABEND PROCESSING COPYBOOK.                                 * 03260000
032700*---------------------------------------------------------------* 03270000
032800                                                                  03280000
032900     COPY DPWS013.                                                03290000
033000                                                                  03300000
033100 EJECT                                                            03310000
033200*---------------------------------------------------------------* 03320000
033300*    DB2 AREA FOR ENTERPRISE NAME                               * 03330000
033400*---------------------------------------------------------------* 03340000
033500     EXEC SQL                                                     03350000
033600          INCLUDE TENTNME                                         03360000
033700     END-EXEC.                                                    03370000
033800*---------------------------------------------------------------* 03380000
033900*    DB2 AREA FOR COMMUNICATIONS                                * 03390000
034000*---------------------------------------------------------------* 03400000
034100     EXEC SQL                                                     03410000
034200          INCLUDE SQLCA                                           03420000
034300     END-EXEC.                                                    03430000
034400*---------------------------------------------------------------* 03440000
034500*    VENDOR CURSOR WHEN VENDOR NAME IS ENTERED                  * 03450000
034600*---------------------------------------------------------------* 03460000
034700                                                                  03470000
034800     EXEC SQL                                                     03480000
034900          DECLARE VENDOR-CSR CURSOR FOR                           03490000
035000          SELECT ENT_NAME_DESC,                                   03500000
035100                 TYPE_CDE,                                        03510000
035200                 SEQ_NBR                                          03520000
035300          FROM TENTNME                                            03530000
035400          WHERE ENT_ID = :ASC-ENT-ID                              03540000
035500            AND TYPE_CDE IN ('02', '03', '05')                    03550001
035600          ORDER BY TYPE_CDE,                                      03560000
035700                   ENT_NAME_DESC                                  03570000
035800     END-EXEC.                                                    03580000
035900                                                                  03590000
036000 EJECT                                                            03600000
036100 LINKAGE SECTION.                                                 03610000
036200                                                                  03620000
036300 01  DFHCOMMAREA.                                                 03630000
036400     05  FILLER                         OCCURS  1 TO 4072 TIMES   03640000
036500                                        DEPENDING ON EIBCALEN.    03650000
036600         10  FILLER                     PIC X.                    03660000
036700                                                                  03670000
036800 EJECT                                                            03680000
036900 PROCEDURE DIVISION.                                              03690000
037000 0000-MAIN-MODULE.                                                03700000
037100     INITIALIZE DP030-CICS-API-FIELDS.                            03710000
037200     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03720000
037300     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03730000
037400     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03740000
037500     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03750000
037600     MOVE LENGTH OF VN008AI        TO DP030-MAP-LENGTH (1).       03760000
037700     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03770000
037800     PERFORM 0001-CALL-CICS-ARCH-API.                             03780000
037900*                                                                 03790000
038000     PERFORM 1000-CONTROL-PROCESSING                              03800000
038100*                                                                 03810000
038200     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03820000
038300     PERFORM 0001-CALL-CICS-ARCH-API.                             03830000
038400                                                                  03840000
038500******************************************************************03850000
038600**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **03860000
038700**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **03870000
038800******************************************************************03880000
038900 0001-CALL-CICS-ARCH-API.                                         03890000
039000*    CALL 'DPKCS030' USING DFHEIBLK                               03900010
039000     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03901010
039100                           DFHCOMMAREA                            03910000
039200                           DP030-CICS-API-FIELDS                  03920000
039300                           DP020-STANDARD-COMMAREA                03930000
039400                           VN008AI.                               03940000
039500*                                                                 03950000
039600     IF  DP030-RC-CALL-SUCCESSFUL                                 03960000
039700         CONTINUE                                                 03970000
039800     ELSE                                                         03980000
039900         SET DP013-NO-ROLLBACK                                    03990000
040000             DP013-XCTL-DISPLAY-RESTART                           04000000
040100             DP013-CICS-ABEND      TO TRUE                        04010000
040200         MOVE '0001-CALL-CICS-ARCH-API'                           04020000
040300                                   TO DP013-PARAGRAPH             04030000
040400*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX04040010
040500*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      04050010
040400         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04051010
040500-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04052010
040600         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04060000
040700         PERFORM DP013-0000-PROCESS-ABEND.                        04070000
040800*----------------------------------------------------------------*04080000
040900* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04090000
041000* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04100000
041100*----------------------------------------------------------------*04110000
041200                                                                  04120000
041300 1000-CONTROL-PROCESSING.                                         04130000
041400                                                                  04140000
041500     EVALUATE TRUE                                                04150000
041600         WHEN DP020-NEXT-ACT-INITIAL                              04160000
041700             INITIALIZE ASC-SPECIFIC-COMMAREA                     04170000
041800             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            04180000
041900                                      ASC-SEL-TERM-ID             04190000
042000             MOVE DP020-SRC-TASK-NUMBER                           04200000
042100                                   TO ASC-LIST-TASK-NUMBER        04210000
042200                                      ASC-SEL-TASK-NUMBER         04220000
042300             MOVE PC-LIST-QUEUE-SEQ                               04230000
042400                                   TO ASC-LIST-SEQ                04240000
042500             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 04250000
042600             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04260000
042700             PERFORM 4000-BUILD-INITIAL-PANEL                     04270000
042800                                                                  04280000
042900         WHEN DP020-NEXT-ACT-READ-MAP                             04290000
043000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04300000
043100                                   TO PV-TOP-ITEM                 04310000
043200             PERFORM 2000-PROCESS-PANEL                           04320000
043300                                                                  04330000
043400         WHEN DP020-NEXT-ACT-RETURN                               04340000
043500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04350000
043600                                   TO PV-TOP-ITEM                 04360000
043700             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    04370000
043800             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 04380000
043900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04390000
044000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04400000
044100                                                                  04410000
044200         WHEN OTHER                                               04420000
044300             SET DP013-LOGIC-ABEND TO TRUE                        04430000
044400             SET DP013-NO-ROLLBACK TO TRUE                        04440000
044500             MOVE '1000-CONTROL-PROCESSING'                       04450000
044600                                   TO DP013-PARAGRAPH             04460000
044700             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    04470000
044800                                   TO DP013-MESSAGE-TEXT(1)       04480000
044900             PERFORM DP013-0000-PROCESS-ABEND                     04490000
045000     END-EVALUATE.                                                04500000
045100                                                                  04510000
045200 EJECT                                                            04520000
045300*----------------------------------------------------------------*04530000
045400* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *04540000
045500* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *04550000
045600*----------------------------------------------------------------*04560000
045700                                                                  04570000
045800 1100-PROCESS-INTER-APPL-COMM.                                    04580000
045900                                                                  04590000
046000     SET PS-COMMAREA-VALID         TO TRUE.                       04600000
046100     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     04610000
046200     MOVE VN004-ENT-ID             TO ASC-ENT-ID.                 04620000
046300                                                                  04630000
046400 EJECT                                                            04640000
046500*----------------------------------------------------------------*04650000
046600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04660000
046700* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04670000
046800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04680000
046900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04690000
047000* FUNCTION KEYS CAN GET THIS FAR.                                *04700000
047100*----------------------------------------------------------------*04710000
047200                                                                  04720000
047300 2000-PROCESS-PANEL.                                              04730000
047400     EVALUATE TRUE                                                04740000
047500         WHEN DP020-SRC-AID = DP016-CLEAR                         04750000
047600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    04760000
047700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04770000
047800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04780000
047900                                                                  04790000
048000         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    04800000
048100             PERFORM 2050-DELETE-LIST-QUEUE                       04810000
048200             PERFORM 4000-BUILD-INITIAL-PANEL                     04820000
048300                                                                  04830000
048400         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    04840000
048500             PERFORM 2140-DESELECT-ALL-ITEMS                      04850000
048600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04860000
048700                                                                  04870000
048800         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  04880000
048900             PERFORM 2150-SELECT-ALL-ITEMS                        04890000
049000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04900000
049100                                                                  04910000
049200         WHEN OTHER                                               04920000
049300             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 04930000
049400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04940000
049500             IF  PS-NO-ERROR                                      04950000
049600                 SET DP030-CONTINUE-GO TO TRUE                    04960000
049700                 PERFORM 2100-CHECK-FUNCTION-KEY                  04970000
049800             ELSE                                                 04980000
049900                 SET DP030-OVERRIDE-GO TO TRUE                    04990000
050000             END-IF                                               05000000
050100     END-EVALUATE.                                                05010000
050200 EJECT                                                            05020000
050300*----------------------------------------------------------------*05030000
050400*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *05040000
050500*----------------------------------------------------------------*05050000
050600 2050-DELETE-LIST-QUEUE.                                          05060000
050700                                                                  05070000
050800     EXEC CICS                                                    05080000
050900         DELETEQ TS                                               05090000
051000             QUEUE (ASC-LIST-QUEUE-NAME)                          05100000
051100             RESP  (PV-CICS-RESP)                                 05110000
051200     END-EXEC.                                                    05120000
051300                                                                  05130000
051400     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       05140000
051500        (PV-CICS-RESP = DFHRESP(QIDERR))                          05150000
051600         CONTINUE                                                 05160000
051700     ELSE                                                         05170000
051800         SET DP013-CICS-ABEND      TO TRUE                        05180000
051900         SET DP013-NO-ROLLBACK     TO TRUE                        05190000
052000                                                                  05200000
052100         MOVE '2050-DELETE-LIST-QUEUE'                            05210000
052200                                   TO DP013-PARAGRAPH             05220000
052300         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    05230000
052400                                   TO DP013-MESSAGE-TEXT (1)      05240000
052500         PERFORM DP013-0000-PROCESS-ABEND                         05250000
052600     END-IF.                                                      05260000
052700                                                                  05270000
052800     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  05280000
052900 EJECT                                                            05290000
053000*----------------------------------------------------------------*05300000
053100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*05310000
053200* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *05320000
053300* CICS ARCHITECTURE API.                                         *05330000
053400*----------------------------------------------------------------*05340000
053500 2100-CHECK-FUNCTION-KEY.                                         05350000
053600     EVALUATE TRUE                                                05360000
053700         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  05370000
053800             INITIALIZE VN002-INTER-APPL-COMMAREA                 05380000
053900             MOVE ASC-ENT-ID TO VN002-ENT-ID                      05390000
054000             MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    05400000
054100                                TO VN002-NUMBER-OF-SELECTED-ITEMS 05410000
054200             PERFORM 5000-PREPARE-SEL-QUEUE                       05420000
054300                                                                  05430000
054400         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  05440000
054500             MOVE +1               TO PV-TOP-ITEM                 05450000
054600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05460000
054700             PERFORM 3200-RESET-ATTRIBUTES                        05470000
054800                                                                  05480000
054900         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   05490000
055000             PERFORM 2110-BROWSE-BACKWARD                         05500000
055100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05510000
055200             PERFORM 3200-RESET-ATTRIBUTES                        05520000
055300                                                                  05530000
055400         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   05540000
055500             PERFORM 2120-BROWSE-FORWARD                          05550000
055600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05560000
055700             PERFORM 3200-RESET-ATTRIBUTES                        05570000
055800                                                                  05580000
055900         WHEN DP020-SRC-AID = DP016-ENTER                         05590000
056000             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   05600000
056100             IF  PS-ERROR                                         05610000
056200                 CONTINUE                                         05620000
056300             ELSE                                                 05630000
056400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05640000
056500             END-IF                                               05650000
056600                                                                  05660000
056700         WHEN OTHER                                               05670000
056800             SET DP013-NO-ROLLBACK                                05680000
056900                 DP013-XCTL-DISPLAY-RESTART                       05690000
057000                 DP013-CICS-ABEND  TO TRUE                        05700000
057100             MOVE '2100-CHECK-FUNCTION-KEY'                       05710000
057200                                   TO DP013-PARAGRAPH             05720000
057300             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05730000
057400                                   TO DP013-MESSAGE-TEXT (1)      05740000
057500             PERFORM DP013-0000-PROCESS-ABEND                     05750000
057600     END-EVALUATE.                                                05760000
057700*                                                                 05770000
057800*----------------------------------------------------------------*05780000
057900*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *05790000
058000*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *05800000
058100*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *05810000
058200*    MESSAGE.                                                    *05820000
058300*----------------------------------------------------------------*05830000
058400                                                                  05840000
058500 2110-BROWSE-BACKWARD.                                            05850000
058600     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    05860000
058700         GIVING PV-TOP-ITEM.                                      05870000
058800*                                                                 05880000
058900     IF  ((PV-TOP-ITEM < +1)                                      05890000
059000       OR (PV-TOP-ITEM = +1))                                     05900000
059100         MOVE +1                   TO PV-TOP-ITEM                 05910000
059200*        -- TOP OF LIST --                                        05920000
059300         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            05930000
059400         SET DP020-MSG-INFORMATIONAL TO TRUE                      05940000
059500     END-IF.                                                      05950000
059600                                                                  05960000
059700 EJECT                                                            05970000
059800*----------------------------------------------------------------*05980000
059900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *05990000
060000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *06000000
060100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *06010000
060200*----------------------------------------------------------------*06020000
060300                                                                  06030000
060400 2120-BROWSE-FORWARD.                                             06040000
060500                                                                  06050000
060600     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              06060000
060700         GIVING PV-TOP-ITEM.                                      06070000
060800     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   06080000
060900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06090000
061000                                   TO PV-TOP-ITEM                 06100000
061100*        -- BOTTOM OF LIST --                                     06110000
061200         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06120000
061300         SET DP020-MSG-INFORMATIONAL                              06130000
061400                                   TO TRUE                        06140000
061500     ELSE                                                         06150000
061600         COMPUTE PV-BOTTOM-ITEM =                                 06160000
061700             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 06170000
061800         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            06180000
061900*            -- BOTTOM OF LIST --                                 06190000
062000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06200000
062100             SET DP020-MSG-INFORMATIONAL                          06210000
062200                                   TO TRUE                        06220000
062300         END-IF                                                   06230000
062400     END-IF.                                                      06240000
062500 EJECT                                                            06250000
062600*----------------------------------------------------------------*06260000
062700*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *06270000
062800*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *06280000
062900*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *06290000
063000*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *06300000
063100*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *06310000
063200*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *06320000
063300*----------------------------------------------------------------*06330000
063400                                                                  06340000
063500 2130-CHECK-FOR-JUMP-BROWSE.                                      06350000
063600     SET PS-NO-ERROR               TO TRUE.                       06360000
063700     IF (ASC-START-ITEM-REQUEST = SPACE)                          06370000
063800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06380000
063900                                   TO PV-TOP-ITEM                 06390000
064000     ELSE                                                         06400000
064100         MOVE ASC-START-ITEM-REQUEST                              06410000
064200                                   TO DP010I-UNEDITED-FIELD       06420000
064300         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       06430000
064400         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     06440000
064500         SET DP010I-NEGATIVE-NOT-ALLOWED                          06450000
064600                                   TO TRUE                        06460000
064710         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06471006
064720                         USING DP010I-NUMERIC-EDIT-AREA           06472006
064800                                                                  06480000
064900         IF  NOT DP010I-ERROR-DETECTED                            06490000
065000             MOVE DP010I-NUMERIC-FIELD                            06500000
065100                                   TO  ASC-START-ITEM-REQUEST-N   06510000
065200             IF  ASC-START-ITEM-REQUEST-N > ZERO                  06520000
065300                 IF  ASC-START-ITEM-REQUEST-N >                   06530000
065400                                          ASC-NUMBER-OF-ITEMS-READ06540000
065500                     MOVE SPACE TO ASC-START-ITEM-REQUEST         06550000
065600                     COMPUTE PV-TOP-ITEM =                        06560000
065700                             ASC-NUMBER-OF-ITEMS-READ             06570000
065800                             - PC-ITEMS-PER-PANEL + 1             06580000
065900                     IF  PV-TOP-ITEM < +1                         06590000
066000                         MOVE +1   TO PV-TOP-ITEM                 06600000
066100                         MOVE PC-TSYMSG-00070                     06610000
066200                                   TO DP020-MSG-NUMBER            06620000
066300                         SET DP020-MSG-INFORMATIONAL              06630000
066400                                   TO TRUE                        06640000
066500                     END-IF                                       06650000
066600                 ELSE                                             06660000
066700                     MOVE ASC-START-ITEM-REQUEST-N                06670000
066800                                   TO PV-TOP-ITEM                 06680000
066900                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      06690000
067000                     COMPUTE PV-BOTTOM-ITEM =                     06700000
067100                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     06710000
067200                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ06720000
067300*                        -- BOTTOM OF LIST --                     06730000
067400                         MOVE PC-TSYMSG-00070                     06740000
067500                                   TO DP020-MSG-NUMBER            06750000
067600                         SET DP020-MSG-INFORMATIONAL              06760000
067700                                   TO TRUE                        06770000
067800                     END-IF                                       06780000
067900                 END-IF                                           06790000
068000             ELSE                                                 06800000
068100*                --- VALUE OUT OF RANGE ----                      06810000
068200                 MOVE PC-TSYMSG-00101                             06820000
068300                                   TO DP020-MSG-NUMBER            06830000
068400                 MOVE -1           TO ASTRTITL                    06840000
068500                 SET DP030-SET-CURSOR-APPL-1                      06850000
068600                                   TO TRUE                        06860000
068700                 MOVE DP015-REVERSE                               06870000
068800                                   TO ASTRTITH                    06880000
068900                 MOVE DP015-RED    TO ASTRTITC                    06890000
069000                 MOVE DP015-UNP-NUM-BRT-MDT                       06900000
069100                                   TO ASTRTITA                    06910000
069200                 SET DP020-MSG-FATAL                              06920000
069300                                   TO TRUE                        06930000
069400                 SET PS-ERROR      TO TRUE                        06940000
069500             END-IF                                               06950000
069600                                                                  06960000
069700         ELSE                                                     06970000
069800             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            06980000
069900             MOVE -1               TO ASTRTITL                    06990000
070000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07000000
070100             MOVE DP015-REVERSE    TO ASTRTITH                    07010000
070200             MOVE DP015-RED        TO ASTRTITC                    07020000
070300             MOVE DP015-UNP-NUM-BRT-MDT                           07030000
070400                                   TO ASTRTITA                    07040000
070500             SET DP020-MSG-FATAL   TO TRUE                        07050000
070600             SET PS-ERROR          TO TRUE                        07060000
070700         END-IF                                                   07070000
070800     END-IF.                                                      07080000
070900 EJECT                                                            07090000
071000*----------------------------------------------------------------*07100000
071100*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *07110000
071200*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *07120000
071300*----------------------------------------------------------------*07130000
071400 2140-DESELECT-ALL-ITEMS.                                         07140000
071500     MOVE +1                       TO ASC-BLK-SUB.                07150000
071600                                                                  07160000
071700     PERFORM 2141-CLEAR-SELECTED-INDS                             07170000
071800         VARYING ASC-ITEM-SUB                                     07180000
071900         FROM 1 BY 1                                              07190000
072000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 07200000
072100                                                                  07210000
072200     ADD +1                        TO ASC-BLK-SUB.                07220000
072300                                                                  07230000
072400     PERFORM 2141-CLEAR-SELECTED-INDS                             07240000
072500         VARYING ASC-ITEM-SUB                                     07250000
072600         FROM 1 BY 1                                              07260000
072700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 07270000
072800                                                                  07280000
072900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               07290000
073000                                   TO PV-LIST-ITEM-NUMBER.        07300000
073100                                                                  07310000
073200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            07320000
073300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    07330000
073400                                                                  07340000
073500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     07350000
073600        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      07360000
073700         MOVE +1                   TO ASC-BLK-SUB                 07370000
073800                                                                  07380000
073900         PERFORM 5100-WRITE-TEMP-STORAGE                          07390000
074000                                                                  07400000
074100         MOVE +1                   TO PV-BLOCK-NUMBER             07410000
074200                                                                  07420000
074300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         07430000
074400             PV-FIRST-BLOCK-IN-ARRAY - 1                          07440000
074500                                                                  07450000
074600         PERFORM                                                  07460000
074700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       07470000
074800                                                                  07480000
074900             PERFORM 4410-READ-TEMP-STORAGE                       07490000
075000                                                                  07500000
075100             PERFORM 2141-CLEAR-SELECTED-INDS                     07510000
075200                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 07520000
075300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          07530000
075400                                                                  07540000
075500             PERFORM 5100-WRITE-TEMP-STORAGE                      07550000
075600                                                                  07560000
075700             ADD +1                TO PV-BLOCK-NUMBER             07570000
075800                                                                  07580000
075900         END-PERFORM                                              07590000
076000                                                                  07600000
076100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         07610000
076200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     07620000
076300                                                                  07630000
076400         PERFORM                                                  07640000
076500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       07650000
076600                   ASC-HIGHEST-BLOCK-WRITTEN                      07660000
076700                                                                  07670000
076800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          07680000
076900                                   TO PV-BLOCK-NUMBER             07690000
077000                                                                  07700000
077100             PERFORM 4410-READ-TEMP-STORAGE                       07710000
077200                                                                  07720000
077300             PERFORM 2141-CLEAR-SELECTED-INDS                     07730000
077400                 VARYING ASC-ITEM-SUB                             07740000
077500                 FROM 1 BY 1                                      07750000
077600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          07760000
077700                                                                  07770000
077800             PERFORM 5100-WRITE-TEMP-STORAGE                      07780000
077900                                                                  07790000
078000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      07800000
078100                                                                  07810000
078200         END-PERFORM                                              07820000
078300                                                                  07830000
078400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             07840000
078500                                   TO PV-BLOCK-NUMBER             07850000
078600                                                                  07860000
078700         PERFORM 4410-READ-TEMP-STORAGE                           07870000
078800     END-IF.                                                      07880000
078900                                                                  07890000
079000                                                                  07900000
079100     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 07910000
079200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.07920000
079300     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  07930000
079400                                                                  07940000
079500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        07950000
079600                                                                  07960000
079700 EJECT                                                            07970000
079800*----------------------------------------------------------------*07980000
079900*    MARK EACH ITEM AS BEING NOT SELECTED.                       *07990000
080000*----------------------------------------------------------------*08000000
080100                                                                  08010000
080200 2141-CLEAR-SELECTED-INDS.                                        08020000
080300                                                                  08030000
080400     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           08040000
080500             NOT EQUAL ZERO                                       08050000
080600         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08060000
080700             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08070000
080800                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    08080000
080900                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  08090000
081000                                   TO TRUE                        08100000
081100         END-IF                                                   08110000
081200     END-IF.                                                      08120000
081300                                                                  08130000
081400 EJECT                                                            08140000
081500*----------------------------------------------------------------*08150000
081600*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *08160000
081700*  FOR ALL ITEMS.                                                *08170000
081800*----------------------------------------------------------------*08180000
081900                                                                  08190000
082000 2150-SELECT-ALL-ITEMS.                                           08200000
082100                                                                  08210000
082200     MOVE +1                       TO ASC-BLK-SUB.                08220000
082300                                                                  08230000
082400     PERFORM 2151-SET-SELECTED-INDS                               08240000
082500         VARYING ASC-ITEM-SUB                                     08250000
082600         FROM 1 BY 1                                              08260000
082700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08270000
082800                                                                  08280000
082900     ADD +1                        TO ASC-BLK-SUB.                08290000
083000                                                                  08300000
083100     PERFORM 2151-SET-SELECTED-INDS                               08310000
083200         VARYING ASC-ITEM-SUB                                     08320000
083300         FROM 1 BY 1                                              08330000
083400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08340000
083500                                                                  08350000
083600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               08360000
083700                                   TO PV-LIST-ITEM-NUMBER.        08370000
083800                                                                  08380000
083900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            08390000
084000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    08400000
084100                                                                  08410000
084200     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     08420000
084300        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    08430000
084400         MOVE +1                   TO ASC-BLK-SUB                 08440000
084500                                                                  08450000
084600         PERFORM 5100-WRITE-TEMP-STORAGE                          08460000
084700                                                                  08470000
084800         MOVE +1                   TO PV-BLOCK-NUMBER             08480000
084900                                                                  08490000
085000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         08500000
085100             PV-FIRST-BLOCK-IN-ARRAY - 1                          08510000
085200                                                                  08520000
085300         PERFORM                                                  08530000
085400             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       08540000
085500                                                                  08550000
085600             PERFORM 4410-READ-TEMP-STORAGE                       08560000
085700                                                                  08570000
085800             PERFORM 2151-SET-SELECTED-INDS                       08580000
085900                 VARYING ASC-ITEM-SUB                             08590000
086000                 FROM 1 BY 1                                      08600000
086100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08610000
086200                                                                  08620000
086300             PERFORM 5100-WRITE-TEMP-STORAGE                      08630000
086400                                                                  08640000
086500             ADD +1                TO PV-BLOCK-NUMBER             08650000
086600                                                                  08660000
086700         END-PERFORM                                              08670000
086800                                                                  08680000
086900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         08690000
087000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     08700000
087100                                                                  08710000
087200         PERFORM                                                  08720000
087300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       08730000
087400                   ASC-HIGHEST-BLOCK-WRITTEN                      08740000
087500                                                                  08750000
087600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          08760000
087700                                   TO PV-BLOCK-NUMBER             08770000
087800                                                                  08780000
087900             PERFORM 4410-READ-TEMP-STORAGE                       08790000
088000                                                                  08800000
088100             PERFORM 2151-SET-SELECTED-INDS                       08810000
088200                 VARYING ASC-ITEM-SUB                             08820000
088300                 FROM 1 BY 1                                      08830000
088400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08840000
088500                                                                  08850000
088600             PERFORM 5100-WRITE-TEMP-STORAGE                      08860000
088700                                                                  08870000
088800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      08880000
088900                                                                  08890000
089000         END-PERFORM                                              08900000
089100                                                                  08910000
089200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             08920000
089300                                   TO PV-BLOCK-NUMBER             08930000
089400                                                                  08940000
089500         PERFORM 4410-READ-TEMP-STORAGE                           08950000
089600     END-IF.                                                      08960000
089700                                                                  08970000
089800                                                                  08980000
089900     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             08990000
090000                       ASC-NUMBER-OF-SELECTED-ITEMS.              09000000
090100                                                                  09010000
090200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09020000
090300                                                                  09030000
090400 EJECT                                                            09040000
090500*----------------------------------------------------------------*09050000
090600*    MARK EACH ITEM AS BEING SELECTED.                           *09060000
090700*----------------------------------------------------------------*09070000
090800                                                                  09080000
090900 2151-SET-SELECTED-INDS.                                          09090000
091000                                                                  09100000
091100     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09110000
091200             NOT EQUAL ZERO                                       09120000
091300         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             09130000
091400             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             09140000
091500                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        09150000
091600                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  09160000
091700                               TO  TRUE                           09170000
091800         END-IF                                                   09180000
091900     END-IF.                                                      09190000
092000******************************************************************09200000
092100** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **09210000
092200** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **09220000
092300******************************************************************09230000
092400 2200-MOVE-SCREEN-TO-COMMAREA.                                    09240000
092500                                                                  09250000
092600     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             09260000
092700     MOVE +1                       TO PV-SUB.                     09270000
092800*                                                                 09280000
092900     PERFORM 3100-SET-SUBSCRIPTS.                                 09290000
093000     IF  ASTRTITL > ZERO                                          09300000
093100         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          09310000
093200     ELSE                                                         09320000
093300         IF  ASTRTITF = DP015-ERASE-EOF                           09330000
093400             INITIALIZE ASC-START-ITEM-REQUEST                    09340000
093500         END-IF                                                   09350000
093600     END-IF.                                                      09360000
093700     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          09370000
093800         VARYING PV-SUB                                           09380000
093900         FROM 1 BY 1                                              09390000
094000         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      09400000
094100******************************************************************09410000
094200** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**09420000
094300******************************************************************09430000
094400 2210-MOVE-LINES-TO-COMMAREA.                                     09440000
094500     IF  MR-SELECTL (PV-SUB) > ZERO                               09450000
094600         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             09460000
094700         MOVE MR-SELECTI (PV-SUB)                                 09470000
094800                                   TO ASC-TEMP-SELECTED-SW        09480000
094900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      09490000
095000     ELSE                                                         09500000
095100         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                09510000
095200                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     09520000
095300                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        09530000
095400                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      09540000
095500         END-IF                                                   09550000
095600     END-IF.                                                      09560000
095700     ADD +1                        TO ASC-ITEM-SUB.               09570000
095800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        09580000
095900         ADD +1                    TO ASC-BLK-SUB                 09590000
096000         MOVE +1                   TO ASC-ITEM-SUB                09600000
096100     END-IF.                                                      09610000
096200******************************************************************09620000
096300** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **09630000
096400** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **09640000
096500******************************************************************09650000
096600 3000-EDIT-DATA-IN-COMMAREA.                                      09660000
096700     SET PS-NO-ERROR               TO TRUE.                       09670000
096800     PERFORM 3200-RESET-ATTRIBUTES.                               09680000
096900     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     09690000
097000**                                                                09700000
097100* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              09710000
097200* EDITTING IS DONE FROM THE BOTTOM UP.                            09720000
097300**                                                                09730000
097400     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       09740000
097500         ASC-ITEMS-DISPLAYED - 1.                                 09750000
097600     PERFORM 3100-SET-SUBSCRIPTS.                                 09760000
097700     PERFORM 3300-EDIT-SELECTIONS                                 09770000
097800         VARYING PV-SUB                                           09780000
097900         FROM PV-SUB BY -1                                        09790000
098000         UNTIL PV-SUB < +1                                        09800000
098100*                                                                 09810000
098200     IF  PS-NO-ERROR                                              09820000
098300         PERFORM 3400-CHECK-RANGE-SEQUENCE                        09830000
098400     END-IF.                                                      09840000
098500*                                                                 09850000
098600     IF  ((PS-NO-ERROR)                                           09860000
098700       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   09870000
098800       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    09880000
098900             PERFORM 3500-MARK-RANGE-AS-SELECTED                  09890000
099000     END-IF.                                                      09900000
099100 EJECT                                                            09910000
099200*----------------------------------------------------------------*09920000
099300*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *09930000
099400*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*09940000
099500*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *09950000
099600*                                                                *09960000
099700*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *09970000
099800*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *09980000
099900*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *09990000
100000*    US IN THE 2ND BLOCK OF THE ARRAY.                           *10000000
100100*----------------------------------------------------------------*10010000
100200                                                                  10020000
100300 3100-SET-SUBSCRIPTS.                                             10030000
100400                                                                  10040000
100500     COMPUTE ASC-ITEM-SUB =                                       10050000
100600         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        10060000
100700                                                                  10070000
100800     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         10080000
100900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            10090000
101000                                                                  10100000
101100         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               10110000
101200     ELSE                                                         10120000
101300         MOVE +1                     TO ASC-BLK-SUB               10130000
101400     END-IF.                                                      10140000
101500******************************************************************10150000
101600** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **10160000
101700******************************************************************10170000
101800                                                                  10180000
101900 3200-RESET-ATTRIBUTES.                                           10190000
102000     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   10200000
102100     MOVE DP015-GREEN              TO ASTRTITC.                   10210000
102200     MOVE DP015-UNDERLINE          TO ASTRTITH.                   10220000
102300*                                                                 10230000
102400     IF DP020-NEXT-ACT-RETURN OR                                  10240000
102500        DP020-NEXT-ACT-READ-MAP                                   10250000
102600         PERFORM VARYING PV-SUB  FROM 1 BY 1                      10260000
102700             UNTIL   PV-SUB > ASC-ITEMS-DISPLAYED                 10270000
102800                 MOVE DP015-UNP-ALP-NOR-OFF                       10280000
102900                                      TO MR-SELECTA (PV-SUB)      10290000
103000                 MOVE DP015-GREEN     TO MR-SELECTC (PV-SUB)      10300000
103100                 MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)      10310000
103200         END-PERFORM                                              10320000
103300     ELSE                                                         10330000
103400         PERFORM VARYING PV-SUB FROM 1 BY 1                       10340000
103500             UNTIL PV-SUB > PC-ITEMS-PER-PANEL                    10350000
103600                 MOVE DP015-UNP-ALP-NOR-OFF                       10360000
103700                                      TO MR-SELECTA (PV-SUB)      10370000
103800                 MOVE DP015-GREEN     TO MR-SELECTC (PV-SUB)      10380000
103900                 MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)      10390000
104000         END-PERFORM                                              10400000
104100     END-IF.                                                      10410000
104200******************************************************************10420000
104300** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **10430000
104400** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **10440000
104500** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **10450000
104600** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **10460000
104700******************************************************************10470000
104800 3300-EDIT-SELECTIONS.                                            10480000
104900     EVALUATE TRUE                                                10490000
105000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     10500000
105100             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         10510000
105200                 CONTINUE                                         10520000
105300         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         10530000
105400             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        10540000
105500                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   10550000
105600                 MOVE ASC-TEMP-SELECTED-SW                        10560000
105700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10570000
105800                                TO ASC-SELECTED-SW                10580000
105900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10590000
106000             END-IF                                               10600000
106100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     10610000
106200                 = SPACE                                          10620000
106300             EVALUATE TRUE                                        10630000
106400                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       10640000
106500                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS10650000
106600                     MOVE SPACE TO ASC-SELECTED-SW                10660000
106700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10670000
106800                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        10680000
106900                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    10690000
107000                     MOVE SPACE TO ASC-SELECTED-SW                10700000
107100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10710000
107200                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          10720000
107300                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      10730000
107400                     MOVE SPACE TO ASC-SELECTED-SW                10740000
107500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10750000
107600             END-EVALUATE                                         10760000
107700         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           10770000
107800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            10780000
107900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    10790000
108000             END-IF                                               10800000
108100             PERFORM 3310-EDIT-RANGE                              10810000
108200         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             10820000
108300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            10830000
108400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    10840000
108500             END-IF                                               10850000
108600             PERFORM 3310-EDIT-RANGE                              10860000
108700         WHEN OTHER                                               10870000
108800             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           10880000
108900             SET DP020-MSG-FATAL    TO TRUE                       10890000
109000             MOVE -1                TO MR-SELECTL (PV-SUB)        10900000
109100             SET DP030-SET-CURSOR-APPL-1                          10910000
109200                                    TO TRUE                       10920000
109300             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        10930000
109400             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        10940000
109500             SET PS-ERROR TO TRUE                                 10950000
109600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            10960000
109700                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     10970000
109800                 MOVE SPACE         TO ASC-SELECTED-SW            10980000
109900                                        (ASC-BLK-SUB ASC-ITEM-SUB)10990000
110000             END-IF                                               11000000
110100     END-EVALUATE.                                                11010000
110200                                                                  11020000
110300     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 11030000
110400     SUBTRACT +1 FROM ASC-ITEM-SUB.                               11040000
110500     IF  ASC-ITEM-SUB < 1                                         11050000
110600         SUBTRACT +1 FROM ASC-BLK-SUB                             11060000
110700         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                11070000
110800     END-IF.                                                      11080000
110900******************************************************************11090000
111000** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **11100000
111100** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **11110000
111200** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**11120000
111300** THE ENDING.                                                  **11130000
111400******************************************************************11140000
111500 3310-EDIT-RANGE.                                                 11150000
111600     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                11160000
111700         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   11170000
111800             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)11180000
111900                                   TO ASC-SELECTED-SW             11190000
112000                                        (ASC-BLK-SUB ASC-ITEM-SUB)11200000
112100             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 11210000
112200         ELSE                                                     11220000
112300             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     11230000
112400                 CONTINUE                                         11240000
112500             ELSE                                                 11250000
112600*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        11260000
112700                 MOVE PC-TSYMSG-00054                             11270000
112800                                   TO DP020-MSG-NUMBER            11280000
112900                 SET DP020-MSG-FATAL                              11290000
113000                                   TO TRUE                        11300000
113100                 MOVE -1           TO MR-SELECTL (PV-SUB)         11310000
113200                 SET DP030-SET-CURSOR-APPL-1                      11320000
113300                                   TO TRUE                        11330000
113400                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         11340000
113500                 MOVE DP015-UNDERLINE                             11350000
113600                                   TO MR-SELECTH (PV-SUB)         11360000
113700                 SET PS-ERROR      TO TRUE                        11370000
113800             END-IF                                               11380000
113900         END-IF                                                   11390000
114000     ELSE                                                         11400000
114100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     11410000
114200             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 11420000
114300                                   TO ASC-SELECTED-SW             11430000
114400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11440000
114500             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   11450000
114600         ELSE                                                     11460000
114700             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       11470000
114800                 CONTINUE                                         11480000
114900             ELSE                                                 11490000
115000*                -- ONLY ONE END-OF-RANGE ALLOWED --              11500000
115100                 MOVE PC-TSYMSG-00055                             11510000
115200                                   TO DP020-MSG-NUMBER            11520000
115300                 SET DP020-MSG-FATAL                              11530000
115400                                   TO TRUE                        11540000
115500                 MOVE -1           TO MR-SELECTL (PV-SUB)         11550000
115600                 SET DP030-SET-CURSOR-APPL-1                      11560000
115700                                   TO TRUE                        11570000
115800                 SET PS-ERROR      TO TRUE                        11580000
115900             END-IF                                               11590000
116000         END-IF                                                   11600000
116100     END-IF.                                                      11610000
116200*                                                                 11620000
116300******************************************************************11630000
116400** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **11640000
116500** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **11650000
116600******************************************************************11660000
116700 3400-CHECK-RANGE-SEQUENCE.                                       11670000
116800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       11680000
116900       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      11690000
117000       AND  ASC-START-OF-SELECTED-RANGE >                         11700000
117100                                         ASC-END-OF-SELECTED-RANGE11710000
117200*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                11720000
117300         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 11730000
117400         SET DP020-MSG-FATAL TO TRUE                              11740000
117500         SET PS-ERROR TO TRUE                                     11750000
117600         PERFORM 3410-POSITION-AT-ERROR                           11760000
117700     END-IF.                                                      11770000
117800******************************************************************11780000
117900** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **11790000
118000** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **11800000
118100** SHOULD BE POSITIONED ON A RANGE ERROR.                       **11810000
118200******************************************************************11820000
118300 3410-POSITION-AT-ERROR.                                          11830000
118400     SET DP030-SET-CURSOR-APPL-1                                  11840000
118500                                   TO TRUE.                       11850000
118600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 11860000
118700                    - PV-TOP-ITEM + 1.                            11870000
118800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      11880000
118900         CONTINUE                                                 11890000
119000     ELSE                                                         11900000
119100         MOVE -1                   TO MR-SELECTL (PV-SUB)         11910000
119200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         11920000
119300         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         11930000
119400     END-IF.                                                      11940000
119500*                                                                 11950000
119600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   11960000
119700                    - PV-TOP-ITEM + 1.                            11970000
119800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      11980000
119900         CONTINUE                                                 11990000
120000     ELSE                                                         12000000
120100         MOVE -1                   TO MR-SELECTL (PV-SUB)         12010000
120200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         12020000
120300         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         12030000
120400     END-IF.                                                      12040000
120500 EJECT                                                            12050000
120600*----------------------------------------------------------------*12060000
120700*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *12070000
120800*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *12080000
120900*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *12090000
121000*----------------------------------------------------------------*12100000
121100                                                                  12110000
121200 3500-MARK-RANGE-AS-SELECTED.                                     12120000
121300     MOVE +1                       TO  ASC-BLK-SUB.               12130000
121400     PERFORM 3510-MARK-SELECTED-INDS                              12140000
121500         VARYING ASC-ITEM-SUB                                     12150000
121600         FROM 1 BY 1                                              12160000
121700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12170000
121800                                                                  12180000
121900     ADD +1                        TO ASC-BLK-SUB.                12190000
122000     PERFORM 3510-MARK-SELECTED-INDS                              12200000
122100         VARYING ASC-ITEM-SUB                                     12210000
122200         FROM 1 BY 1                                              12220000
122300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12230000
122400                                                                  12240000
122500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               12250000
122600                                   TO  PV-LIST-ITEM-NUMBER.       12260000
122700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            12270000
122800         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         12280000
122900               PC-ITEMS-PER-PANEL).                               12290000
123000                                                                  12300000
123100     MOVE ASC-START-OF-SELECTED-RANGE                             12310000
123200                                   TO PV-START-OF-SELECTED-RANGE. 12320000
123300     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            12330000
123400         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  12340000
123500               PC-ITEMS-PER-PANEL).                               12350000
123600                                                                  12360000
123700     MOVE ASC-END-OF-SELECTED-RANGE                               12370000
123800                                   TO  PV-END-OF-SELECTED-RANGE.  12380000
123900     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             12390000
124000         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    12400000
124100               PC-ITEMS-PER-PANEL).                               12410000
124200     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             12420000
124300         PV-FIRST-BLOCK-IN-ARRAY + 1.                             12430000
124400                                                                  12440000
124500     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    12450000
124600        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        12460000
124700         MOVE +1                   TO ASC-BLK-SUB                 12470000
124800         PERFORM 5100-WRITE-TEMP-STORAGE                          12480000
124900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12490000
125000             PV-FIRST-BLOCK-IN-ARRAY - 1                          12500000
125100                                                                  12510000
125200         PERFORM                                                  12520000
125300             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      12530000
125400                   PV-PREV-BLOCK-IN-ARRAY                         12540000
125500             MOVE PV-FIRST-BLOCK-IN-RANGE                         12550000
125600                                   TO PV-BLOCK-NUMBER             12560000
125700             PERFORM 4410-READ-TEMP-STORAGE                       12570000
125800             PERFORM 3510-MARK-SELECTED-INDS                      12580000
125900                 VARYING ASC-ITEM-SUB                             12590000
126000                 FROM 1 BY 1                                      12600000
126100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12610000
126200             PERFORM 5100-WRITE-TEMP-STORAGE                      12620000
126300             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     12630000
126400         END-PERFORM                                              12640000
126500                                                                  12650000
126600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12660000
126700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12670000
126800         PERFORM                                                  12680000
126900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12690000
127000                   PV-LAST-BLOCK-IN-RANGE                         12700000
127100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12710000
127200                                   TO PV-BLOCK-NUMBER             12720000
127300             PERFORM 4410-READ-TEMP-STORAGE                       12730000
127400             PERFORM 3510-MARK-SELECTED-INDS                      12740000
127500                 VARYING ASC-ITEM-SUB                             12750000
127600                 FROM 1 BY 1                                      12760000
127700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12770000
127800             PERFORM 5100-WRITE-TEMP-STORAGE                      12780000
127900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12790000
128000         END-PERFORM                                              12800000
128100                                                                  12810000
128200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12820000
128300                                   TO PV-BLOCK-NUMBER             12830000
128400         PERFORM 4410-READ-TEMP-STORAGE                           12840000
128500     END-IF.                                                      12850000
128600                                                                  12860000
128700     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 12870000
128800                                      ASC-END-OF-SELECTED-RANGE.  12880000
128900                                                                  12890000
129000 EJECT                                                            12900000
129100*----------------------------------------------------------------*12910000
129200* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *12920000
129300*----------------------------------------------------------------*12930000
129400                                                                  12940000
129500 3510-MARK-SELECTED-INDS.                                         12950000
129600                                                                  12960000
129700     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         12970000
129800                                ASC-ITEM-SUB) >                   12980000
129900         ASC-START-OF-SELECTED-RANGE)                             12990000
130000     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         13000000
130100                                ASC-ITEM-SUB) =                   13010000
130200         ASC-START-OF-SELECTED-RANGE)                             13020000
130300                                                                  13030000
130400         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     13040000
130500                                    ASC-ITEM-SUB) <               13050000
130600             ASC-END-OF-SELECTED-RANGE)                           13060000
130700         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     13070000
130800                                    ASC-ITEM-SUB) =               13080000
130900             ASC-END-OF-SELECTED-RANGE)                           13090000
131000                                                                  13100000
131100             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          13110000
131200                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   13120000
131300                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   13130000
131400                               TO TRUE                            13140000
131500                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              13150000
131600                               TO TRUE                            13160000
131700                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    13170000
131800             END-IF                                               13180000
131900         END-IF                                                   13190000
132000     END-IF.                                                      13200000
132100                                                                  13210000
132200 EJECT                                                            13220000
132300*----------------------------------------------------------------*13230000
132400*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *13240000
132500*    INITIALIZE ALL COUNTERS AND FLAGS.                          *13250000
132600*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *13260000
132700*    DISPLAY THE PANEL TO USER.                                  *13270000
132800*----------------------------------------------------------------*13280000
132900                                                                  13290000
133000 4000-BUILD-INITIAL-PANEL.                                        13300000
133100                                                                  13310000
133200     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            13320000
133300                                 ASC-BLOCK-ENTRIES (2).           13330000
133400     MOVE +1                 TO ASC-BLK-SUB.                      13340000
133500     SET ASC-ITEMS-LEFT-ON-DB                                     13350000
133600                             TO TRUE.                             13360000
133700                                                                  13370000
133800     MOVE +0                 TO ASC-ITEM-SUB                      13380000
133900                                ASC-NUMBER-OF-ITEMS-READ          13390000
134000                                ASC-NUMBER-OF-SELECTED-ITEMS      13400000
134100                                ASC-HIGHEST-BLOCK-WRITTEN         13410000
134200                                ASC-START-OF-SELECTED-RANGE       13420000
134300                                ASC-END-OF-SELECTED-RANGE         13430000
134400                                ASC-ITEM-AT-TOP-OF-PANEL.         13440000
134500                                                                  13450000
134600     PERFORM 4100-OPEN-CURSOR.                                    13460000
134700                                                                  13470000
134800     PERFORM 4200-READ-ITEMS-FROM-DB.                             13480000
134900                                                                  13490000
135000     PERFORM 4300-CLOSE-CURSOR.                                   13500000
135100     PERFORM 4500-GET-OTHER-SCREEN-FIELDS.                        13510000
135200                                                                  13520000
135300     MOVE +1                   TO  PV-TOP-ITEM.                   13530000
135400     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          13540000
135500         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    13550000
135600         SET DP020-MSG-FATAL   TO  TRUE                           13560000
135700         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               13570000
135800     ELSE                                                         13580000
135900         MOVE -1               TO MR-SELECTL (1)                  13590000
136000         SET DP030-SET-CURSOR-APPL-1                              13600000
136100                               TO TRUE                            13610000
136200         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     13620000
136300     END-IF.                                                      13630000
136400                                                                  13640000
136500                                                                  13650000
136600 EJECT                                                            13660000
136700*----------------------------------------------------------------*13670000
136800* OPEN  THE VENDOR   CURSOR.                                     *13680000
136900*----------------------------------------------------------------*13690000
137000                                                                  13700000
137100 4100-OPEN-CURSOR.                                                13710000
137200     PERFORM                                                      13720000
137300         WITH TEST AFTER                                          13730000
137400         VARYING PV-RETRY-COUNTER                                 13740000
137500         FROM 1 BY 1                                              13750000
137600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13760000
137700                   OR (SQLCODE = ZERO))                           13770000
137800             MOVE 'CURSOR:  VENDOR-CSR'                           13780000
137900                               TO DP013-MESSAGE-TEXT (2)          13790000
138000             EXEC SQL                                             13800000
138100                  OPEN VENDOR-CSR                                 13810000
138200             END-EXEC                                             13820000
138300                                                                  13830000
138400         EVALUATE TRUE                                            13840000
138500             WHEN SQLCODE = ZERO                                  13850000
138600             WHEN SQLCODE = -904                                  13860000
138700             WHEN SQLCODE = -913                                  13870000
138800                 CONTINUE                                         13880000
138900             WHEN SQLWARN0 NOT = SPACES                           13890000
139000             WHEN SQLCODE < ZERO                                  13900000
139100             WHEN SQLCODE > ZERO                                  13910000
139200                 MOVE '4100-OPEN-CURSOR'                          13920000
139300                                   TO DP013-PARAGRAPH             13930000
139400                 MOVE 'OPEN VENDOR CURSOR - '                     13940000
139500                                   TO DP013-MESSAGE-TEXT (1)      13950000
139600                 MOVE SQLCA        TO DP013-SQLCA                 13960000
139700                 MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)    13970000
139800                 SET DP013-DB2-ABEND                              13980000
139900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           13990000
140000                 PERFORM DP013-0000-PROCESS-ABEND                 14000000
140100         END-EVALUATE                                             14010000
140200     END-PERFORM.                                                 14020000
140300*                                                                 14030000
140400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        14040000
140500         MOVE '4100-OPEN-CURSOR'   TO DP013-PARAGRAPH             14050000
140600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   14060000
140700                                   TO DP013-MESSAGE-TEXT (1)      14070000
140800         MOVE SQLCA                TO DP013-SQLCA                 14080000
140900         MOVE 'TSYMSG  '           TO DP013-DB2-TABLE-NAME (1)    14090000
141000         SET DP013-DB2-ABEND                                      14100000
141100             DP013-XCTL-DISPLAY-RESTART                           14110000
141200                                   TO TRUE                        14120000
141300         PERFORM DP013-0000-PROCESS-ABEND                         14130000
141400     END-IF.                                                      14140000
141500                                                                  14150000
141600 EJECT                                                            14160000
141700*----------------------------------------------------------------*14170000
141800*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *14180000
141900*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *14190000
142000*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *14200000
142100*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *14210000
142200*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *14220000
142300*                                                                *14230000
142400*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *14240000
142500*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *14250000
142600*    UPON INITIALIZATION.                                        *14260000
142700*----------------------------------------------------------------*14270000
142800                                                                  14280000
142900 4200-READ-ITEMS-FROM-DB.                                         14290000
143000                                                                  14300000
143100     PERFORM                                                      14310000
143200         VARYING PV-READ-COUNT                                    14320000
143300         FROM 1 BY 1                                              14330000
143400         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    14340000
143500            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         14350000
143600                                                                  14360000
143700         PERFORM 4210-FETCH                                       14370000
143800                                                                  14380000
143900         IF  ASC-ITEMS-LEFT-ON-DB                                 14390000
144000             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                14400000
144100                 ADD +1            TO ASC-ITEM-SUB                14410000
144200             ELSE                                                 14420000
144300                 ADD +1            TO ASC-BLK-SUB                 14430000
144400                 MOVE +1           TO ASC-ITEM-SUB                14440000
144500                                                                  14450000
144600                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         14460000
144700                     MOVE +1       TO ASC-BLK-SUB                 14470000
144800                     SET ASC-BLOCK-MODIFIED (1)                   14480000
144900                                   TO TRUE                        14490000
145000                     PERFORM 5100-WRITE-TEMP-STORAGE              14500000
145100                     MOVE ASC-BLOCK-ENTRIES                       14510000
145200                               (PC-MAX-BLOCKS-IN-ARRAY)           14520000
145300                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 14530000
145400                     ADD +1        TO ASC-BLK-SUB                 14540000
145500                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   14550000
145600                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      14560000
145700                                   TO TRUE                        14570000
145800                 END-IF                                           14580000
145900             END-IF                                               14590000
146000             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    14600000
146100             MOVE ASC-NUMBER-OF-ITEMS-READ                        14610000
146200                                   TO ASC-LIST-ITEM-NUMBER        14620000
146300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14630000
146400             MOVE ENTNME-ENT-NAME-DESC TO ASC-VEND-NAME           14640000
146500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 14650000
146600             MOVE ENTNME-TYPE-CDE      TO ASC-TYPE-CDE            14660000
146700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 14670000
146800             MOVE ENTNME-SEQ-NBR       TO ASC-SEQ-NBR             14680000
146900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 14690000
147000         END-IF                                                   14700000
147100     END-PERFORM.                                                 14710000
147200                                                                  14720000
147300     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          14730000
147400         MOVE +1               TO ASC-BLK-SUB                     14740000
147500         PERFORM 5100-WRITE-TEMP-STORAGE                          14750000
147600         ADD +1                TO ASC-BLK-SUB                     14760000
147700         PERFORM 5100-WRITE-TEMP-STORAGE                          14770000
147800                                                                  14780000
147900         MOVE 1                TO ASC-BLK-SUB                     14790000
148000                                  PV-BLOCK-NUMBER                 14800000
148100         PERFORM 4410-READ-TEMP-STORAGE                           14810000
148200         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             14820000
148300             MOVE 2            TO ASC-BLK-SUB                     14830000
148400                                  PV-BLOCK-NUMBER                 14840000
148500             PERFORM 4410-READ-TEMP-STORAGE                       14850000
148600         END-IF                                                   14860000
148700     END-IF.                                                      14870000
148800 EJECT                                                            14880000
148900*----------------------------------------------------------------*14890000
149000*    FETCH THE MESSAGE CURSOR.                                   *14900000
149100*----------------------------------------------------------------*14910000
149200                                                                  14920000
149300 4210-FETCH.                                                      14930000
149400                                                                  14940000
149500     EXEC SQL                                                     14950000
149600          FETCH VENDOR-CSR                                        14960000
149700          INTO  :ENTNME-ENT-NAME-DESC,                            14970000
149800                :ENTNME-TYPE-CDE,                                 14980000
149900                :ENTNME-SEQ-NBR                                   14990000
150000     END-EXEC                                                     15000000
150100                                                                  15010000
150200     EVALUATE TRUE                                                15020000
150300         WHEN SQLCODE = ZERO                                      15030000
150400         WHEN SQLCODE = +100                                      15040000
150500              CONTINUE                                            15050000
150600         WHEN SQLWARN0 NOT = SPACE                                15060000
150700         WHEN SQLCODE NOT = ZERO                                  15070000
150800              MOVE '4310-FETCH-CURSOR'                            15080000
150900                               TO DP013-PARAGRAPH                 15090000
151000              MOVE 'FETCH VENDOR CURSOR'                          15100000
151100                               TO DP013-MESSAGE-TEXT (1)          15110000
151200              MOVE SQLCA       TO DP013-SQLCA                     15120000
151300              SET DP013-DB2-ABEND                                 15130000
151400                               TO TRUE                            15140000
151500              PERFORM DP013-0000-PROCESS-ABEND                    15150000
151600     END-EVALUATE.                                                15160000
151700                                                                  15170000
151800     IF  SQLCODE EQUAL +100                                       15180000
151900         SET ASC-NO-ITEMS-LEFT-ON-DB                              15190000
152000                                   TO TRUE                        15200000
152100     END-IF.                                                      15210000
152200                                                                  15220000
152300 EJECT                                                            15230000
152400*----------------------------------------------------------------*15240000
152500* CLOSE THE VENDOR   CURSOR.                                     *15250000
152600*----------------------------------------------------------------*15260000
152700                                                                  15270000
152800 4300-CLOSE-CURSOR.                                               15280000
152900     EXEC SQL                                                     15290000
153000         CLOSE VENDOR-CSR                                         15300000
153100     END-EXEC                                                     15310000
153200                                                                  15320000
153300     EVALUATE TRUE                                                15330000
153400         WHEN SQLCODE = ZERO                                      15340000
153500             CONTINUE                                             15350000
153600         WHEN SQLWARN0 NOT = SPACES                               15360000
153700         WHEN SQLCODE < ZERO                                      15370000
153800         WHEN SQLCODE > ZERO                                      15380000
153900             MOVE '4300-CLOSE-CURSOR'                             15390000
154000                               TO DP013-PARAGRAPH                 15400000
154100             MOVE 'CLOSE VENDOR CURSOR '                          15410000
154200                               TO DP013-MESSAGE-TEXT (1)          15420000
154300             MOVE SQLCA        TO DP013-SQLCA                     15430000
154400             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        15440000
154500             SET DP013-DB2-ABEND                                  15450000
154600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15460000
154700             PERFORM DP013-0000-PROCESS-ABEND                     15470000
154800     END-EVALUATE.                                                15480000
154900                                                                  15490000
155000 EJECT                                                            15500000
155100*----------------------------------------------------------------*15510000
155200* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *15520000
155300*----------------------------------------------------------------*15530000
155400                                                                  15540000
155500 4400-MOVE-COMMAREA-TO-SCREEN.                                    15550000
155600     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             15560000
155700         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          15570000
155800         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          15580000
155900             MOVE +1    TO ASC-BLK-SUB                            15590000
156000             PERFORM 5100-WRITE-TEMP-STORAGE                      15600000
156100             ADD +1     TO ASC-BLK-SUB                            15610000
156200             PERFORM 5100-WRITE-TEMP-STORAGE                      15620000
156300             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             15630000
156400                 GIVING PV-BLOCK-NUMBER                           15640000
156500                 REMAINDER PV-REMAINDER                           15650000
156600             IF  PV-REMAINDER > ZERO                              15660000
156700                 ADD +1 TO PV-BLOCK-NUMBER                        15670000
156800             END-IF                                               15680000
156900             MOVE +1    TO ASC-BLK-SUB                            15690000
157000             PERFORM 4410-READ-TEMP-STORAGE                       15700000
157100             ADD +1     TO ASC-BLK-SUB                            15710000
157200                           PV-BLOCK-NUMBER                        15720000
157300             PERFORM 4410-READ-TEMP-STORAGE                       15730000
157400     END-IF.                                                      15740000
157500     MOVE +1            TO ASC-BLK-SUB.                           15750000
157600     COMPUTE ASC-ITEM-SUB =                                       15760000
157700         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              15770000
157800         + PC-ITEMS-PER-PANEL).                                   15780000
157900*                                                                 15790000
158000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        15800000
158100         ADD +1         TO ASC-BLK-SUB                            15810000
158200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            15820000
158300     END-IF.                                                      15830000
158400*                                                                 15840000
158500     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           15850000
158600         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                15860000
158700     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        15870000
158800     PERFORM 4420-FORMAT-LIST-LINES                               15880000
158900         VARYING PV-SUB                                           15890000
159000         FROM PC-ITEMS-PER-PANEL BY -1                            15900000
159100         UNTIL PV-SUB < +1.                                       15910000
159200*                                                                 15920000
159300     COMPUTE ASC-ITEMS-DISPLAYED =                                15930000
159400         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          15940000
159500     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    15950000
159600                                      ASTRTITO.                   15960000
159700     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    15970000
159800     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    15980000
159900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            15990000
160000                                   TO ASELITO.                    16000000
160100     MOVE ASC-HEAD-VEND-NAME   TO AVNNAMEO.                       16010000
160200*                                                                 16020000
160300     IF  DP020-MSG-NUMBER-X = SPACE                               16030000
160400         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  16040000
160500*            --- MORE ITEMS TO DISPLAY ----                       16050000
160600             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            16060000
160700             SET DP020-MSG-INFORMATIONAL TO TRUE                  16070000
160800         END-IF                                                   16080000
160900     END-IF.                                                      16090000
161000*----------------------------------------------------------------*16100000
161100*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *16110000
161200*----------------------------------------------------------------*16120000
161300                                                                  16130000
161400 4410-READ-TEMP-STORAGE.                                          16140000
161500                                                                  16150000
161600     EXEC CICS                                                    16160000
161700         READQ TS                                                 16170000
161800             QUEUE (ASC-LIST-QUEUE-NAME)                          16180000
161900             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               16190000
162000             ITEM  (PV-BLOCK-NUMBER)                              16200000
162100             RESP  (PV-CICS-RESP)                                 16210000
162200     END-EXEC.                                                    16220000
162300                                                                  16230000
162400     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       16240000
162500       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     16250000
162600         CONTINUE                                                 16260000
162700     ELSE                                                         16270000
162800         SET DP013-CICS-ABEND     TO TRUE                         16280000
162900         SET DP013-NO-ROLLBACK    TO TRUE                         16290000
163000         MOVE '4410-READ-TEMP-STORAGE'                            16300000
163100                                  TO DP013-PARAGRAPH              16310000
163200         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      16320000
163300                                  TO DP013-MESSAGE-TEXT(1)        16330000
163400         PERFORM DP013-0000-PROCESS-ABEND                         16340000
163500     END-IF.                                                      16350000
163600                                                                  16360000
163700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             16370000
163800*                                                                 16380000
163900     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         16390000
164000         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               16400000
164100     END-IF.                                                      16410000
164200 EJECT                                                            16420000
164300*----------------------------------------------------------------*16430000
164400*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *16440000
164500*----------------------------------------------------------------*16450000
164600                                                                  16460000
164700 4420-FORMAT-LIST-LINES.                                          16470000
164800     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      16480000
164900         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                16490000
165000         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           16500000
165100         MOVE SPACE              TO MR-SELECTI (PV-SUB)           16510000
165200                                    MR-ACTION (PV-SUB)            16520000
165300                                    MR-VEND-NAME (PV-SUB)         16530000
165400                                    MR-TYPE-CDE (PV-SUB)          16540000
165500                                    MR-TYPE-DSC (PV-SUB)          16550000
165600     ELSE                                                         16560000
165700         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      16570000
165800                                                   > SPACE        16580000
165900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 16590000
166000                                 TO MR-SELECTI (PV-SUB)           16600000
166100         ELSE                                                     16610000
166200             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      16620000
166300                                 TO MR-SELECTI (PV-SUB)           16630000
166400         END-IF                                                   16640000
166500*                                                                 16650000
166600         IF  DP030-SET-CURSOR-TRAILER                             16660000
166700             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)16670000
166800                 > SPACE)                                         16680000
166900               OR (PV-SUB = 1))                                   16690000
167000                SET DP030-SET-CURSOR-APPL-1 TO TRUE               16700000
167100                MOVE -1          TO MR-SELECTL (PV-SUB)           16710000
167200             END-IF                                               16720000
167300         END-IF                                                   16730000
167400*                                                                 16740000
167500         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           16750000
167600             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           16760000
167700                                 TO MR-ACTION (PV-SUB)            16770000
167800             MOVE ASC-VEND-NAME (ASC-BLK-SUB ASC-ITEM-SUB)        16780000
167900                                 TO MR-VEND-NAME (PV-SUB)         16790000
168000             MOVE ASC-TYPE-CDE (ASC-BLK-SUB ASC-ITEM-SUB)         16800000
168100                                 TO MR-TYPE-CDE (PV-SUB)          16810000
168200             EVALUATE ASC-TYPE-CDE (ASC-BLK-SUB ASC-ITEM-SUB)     16820000
168300                 WHEN PC-ALIAS                                    16830000
168400                     MOVE PL-ALIAS    TO MR-TYPE-DSC (PV-SUB)     16840001
168500                 WHEN PC-LABEL                                    16850000
168600                     MOVE PL-LABEL    TO MR-TYPE-DSC (PV-SUB)     16860001
168610                 WHEN PC-LONGNAME                                 16861001
168620                     MOVE PL-LONGNAME TO MR-TYPE-DSC (PV-SUB)     16862001
168700             END-EVALUATE                                         16870000
168800         END-IF                                                   16880000
168900     END-IF.                                                      16890000
169000     SUBTRACT +1 FROM ASC-ITEM-SUB                                16900000
169100     IF  ASC-ITEM-SUB < + 1                                       16910000
169200         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  16920000
169300         MOVE +1                 TO ASC-BLK-SUB                   16930000
169400     END-IF.                                                      16940000
169500******************************************************************16950000
169600** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **16960000
169700** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **16970000
169800** ISSUE A WARNING.                                             **16980000
169900******************************************************************16990000
170000 4430-CHECK-FOR-BEGIN-AND-END.                                    17000000
170100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       17010000
170200         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     17020000
170300*            -- NO END-OF-RANGE SPECFIED ---                      17030000
170400             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            17040000
170500             SET DP020-MSG-WARNING TO TRUE                        17050000
170600             PERFORM 4431-POSITION-AT-WARNING                     17060000
170700         END-IF                                                   17070000
170800     ELSE                                                         17080000
170900         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     17090000
171000*            -- NO BEGINNING-OF-RANGE SPECFIED ---                17100000
171100             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            17110000
171200             SET DP020-MSG-WARNING TO TRUE                        17120000
171300             PERFORM 4431-POSITION-AT-WARNING                     17130000
171400         END-IF                                                   17140000
171500     END-IF.                                                      17150000
171600******************************************************************17160000
171700** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **17170000
171800** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **17180000
171900** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **17190000
172000** POSITION THE CURSOR THERE.                                   **17200000
172100******************************************************************17210000
172200 4431-POSITION-AT-WARNING.                                        17220000
172300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 17230000
172400                    - PV-TOP-ITEM + 1.                            17240000
172500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      17250000
172600         CONTINUE                                                 17260000
172700     ELSE                                                         17270000
172800         SET DP030-SET-CURSOR-APPL-1                              17280000
172900                                   TO TRUE                        17290000
173000         MOVE -1                   TO MR-SELECTL (PV-SUB)         17300000
173100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         17310000
173200         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         17320000
173300     END-IF.                                                      17330000
173400*                                                                 17340000
173500     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   17350000
173600                    - PV-TOP-ITEM + 1.                            17360000
173700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      17370000
173800         CONTINUE                                                 17380000
173900     ELSE                                                         17390000
174000         SET DP030-SET-CURSOR-APPL-1                              17400000
174100                                   TO TRUE                        17410000
174200         MOVE -1                   TO MR-SELECTL (PV-SUB)         17420000
174300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         17430000
174400         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         17440000
174500     END-IF.                                                      17450000
174600                                                                  17460000
174700*----------------------------------------------------------------*17470000
174800* GET NON-LIST SCREEN FIELDS.                                    *17480000
174900*----------------------------------------------------------------*17490000
175000                                                                  17500000
175100 4500-GET-OTHER-SCREEN-FIELDS.                                    17510000
175200     PERFORM                                                      17520000
175300         WITH TEST AFTER                                          17530000
175400         VARYING PV-RETRY-COUNTER                                 17540000
175500         FROM 1 BY 1                                              17550000
175600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17560000
175700                   OR (SQLCODE = ZERO))                           17570000
175800             EXEC SQL                                             17580000
175900                  SELECT ENT_NAME_DESC                            17590000
176000                  INTO  :ASC-HEAD-VEND-NAME                       17600000
176100                  FROM TENTNME                                    17610000
176200                  WHERE ENT_ID = :ASC-ENT-ID                      17620000
176300                  AND TYPE_CDE = '01'                             17630000
176400             END-EXEC                                             17640000
176500         EVALUATE TRUE                                            17650000
176600             WHEN SQLCODE = ZERO                                  17660000
176700             WHEN SQLCODE = -904                                  17670000
176800             WHEN SQLCODE = -913                                  17680000
176900                 CONTINUE                                         17690000
177000             WHEN SQLWARN0 NOT = SPACES                           17700000
177100             WHEN SQLCODE < ZERO                                  17710000
177200             WHEN SQLCODE > ZERO                                  17720000
177300                 MOVE '4500-GET-OTHER-SCREEN-FIELDS'              17730000
177400                                   TO DP013-PARAGRAPH             17740000
177500                 MOVE 'SELECT TENTNME'                            17750000
177600                                   TO DP013-MESSAGE-TEXT (1)      17760000
177700                 MOVE SQLCA        TO DP013-SQLCA                 17770000
177800                 MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (1)    17780000
177900                 SET DP013-DB2-ABEND                              17790000
178000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           17800000
178100                 PERFORM DP013-0000-PROCESS-ABEND                 17810000
178200         END-EVALUATE                                             17820000
178300     END-PERFORM                                                  17830000
178400                                                                  17840000
178500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17850000
178600         MOVE '4500-GET-OTHER-SCREEN-FIELDS'                      17860000
178700                                   TO DP013-PARAGRAPH             17870000
178800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO READ    '   17880000
178900                                   TO DP013-MESSAGE-TEXT (1)      17890000
179000         MOVE SQLCA                TO DP013-SQLCA                 17900000
179100         MOVE 'TENTNME '           TO DP013-DB2-TABLE-NAME (1)    17910000
179200         SET DP013-DB2-ABEND                                      17920000
179300             DP013-XCTL-DISPLAY-RESTART                           17930000
179400                                   TO TRUE                        17940000
179500         PERFORM DP013-0000-PROCESS-ABEND                         17950000
179600     END-IF.                                                      17960000
179700                                                                  17970000
179800 EJECT                                                            17980000
179900*----------------------------------------------------------------*17990000
180000* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *18000000
180100* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *18010000
180200* FOR THE SELECTED ITEMS QUEUE.                                  *18020000
180300*                                                                *18030000
180400* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *18040000
180500* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *18050000
180600* THE ARRAY IS FULL.                                             *18060000
180700*----------------------------------------------------------------*18070000
180800                                                                  18080000
180900 5000-PREPARE-SEL-QUEUE.                                          18090000
181000                                                                  18100000
181100     MOVE +1                   TO  ASC-BLK-SUB.                   18110000
181200     PERFORM 5100-WRITE-TEMP-STORAGE.                             18120000
181300     ADD +1                    TO  ASC-BLK-SUB.                   18130000
181400     PERFORM 5100-WRITE-TEMP-STORAGE.                             18140000
181500                                                                  18150000
181600     MOVE ASC-SEL-QUEUE-NAME   TO  VN002-SEL-QUEUE-NAME.          18160000
181700     PERFORM 6010-DELETE-SEL-QUEUE.                               18170000
181800                                                                  18180000
181900*    SET ASC-UPDATE-TSQ        TO  TRUE.                          18190000
182000                                                                  18200000
182100     SET VN003-IDX             TO  1.                             18210000
182200     MOVE ZERO                 TO VN002-NUMBER-OF-TS-ITEMS.       18220000
182300     INITIALIZE VN003-SELECTED-ITEM-ARRAY.                        18230000
182400                                                                  18240000
182500     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           18250000
182600             VARYING PV-ITEM                                      18260000
182700             FROM 1 BY 1                                          18270000
182800             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     18280000
182900                                                                  18290000
183000     IF  VN003-IDX > 1                                            18300000
183100         PERFORM 5205-WRITE-SEL-QUEUE                             18310000
183200         ADD +1                TO VN002-NUMBER-OF-TS-ITEMS        18320000
183300     END-IF.                                                      18330000
183400 EJECT                                                            18340000
183500*----------------------------------------------------------------*18350000
183600*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *18360000
183700*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *18370000
183800*----------------------------------------------------------------*18380000
183900                                                                  18390000
184000 5100-WRITE-TEMP-STORAGE.                                         18400000
184100     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     18410000
184200                                   TO PV-LIST-ITEM-NUMBER.        18420000
184300     COMPUTE PV-BLOCK-NUMBER =                                    18430000
184400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    18440000
184500                                                                  18450000
184600     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             18460000
184700     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             18470000
184800         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      18480000
184900             PERFORM 5105-REWRITE-ASC-LISTQ                       18490000
185000         END-IF                                                   18500000
185100     ELSE                                                         18510000
185200         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       18520000
185300         ASC-HIGHEST-BLOCK-WRITTEN + 1                            18530000
185400         PERFORM 5110-WRITE-ASC-LISTQ                             18540000
185500         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   18550000
185600     END-IF.                                                      18560000
185700                                                                  18570000
185800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             18580000
185900******************************************************************18590000
186000** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **18600000
186100** SPECIFIC COMMAREA.                                           **18610000
186200******************************************************************18620000
186300 5105-REWRITE-ASC-LISTQ.                                          18630000
186400     EXEC CICS                                                    18640000
186500         WRITEQ TS                                                18650000
186600             QUEUE (ASC-LIST-QUEUE-NAME)                          18660000
186700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               18670000
186800             ITEM  (PV-BLOCK-NUMBER)                              18680000
186900             REWRITE                                              18690000
187000             RESP  (PV-CICS-RESP)                                 18700000
187100     END-EXEC.                                                    18710000
187200                                                                  18720000
187300     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           18730000
187400         CONTINUE                                                 18740000
187500     ELSE                                                         18750000
187600         SET DP013-CICS-ABEND            TO TRUE                  18760000
187700         SET DP013-NO-ROLLBACK           TO TRUE                  18770000
187800         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       18780000
187900         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     18790000
188000                                         TO DP013-MESSAGE-TEXT(1) 18800000
188100         PERFORM DP013-0000-PROCESS-ABEND                         18810000
188200     END-IF.                                                      18820000
188300                                                                  18830000
188400******************************************************************18840000
188500** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **18850000
188600** SPECIFIC COMMAREA.                                           **18860000
188700******************************************************************18870000
188800 5110-WRITE-ASC-LISTQ.                                            18880000
188900     EXEC CICS                                                    18890000
189000         WRITEQ TS                                                18900000
189100             QUEUE (ASC-LIST-QUEUE-NAME)                          18910000
189200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               18920000
189300             ITEM  (PV-BLOCK-NUMBER)                              18930000
189400             RESP  (PV-CICS-RESP)                                 18940000
189500     END-EXEC.                                                    18950000
189600     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      18960000
189700         SET DP013-CICS-ABEND      TO TRUE                        18970000
189800         SET DP013-NO-ROLLBACK     TO TRUE                        18980000
189900         MOVE '5110-WRITE-ASC-LISTQ'                              18990000
190000                                   TO DP013-PARAGRAPH             19000000
190100         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           19010000
190200                                   TO DP013-MESSAGE-TEXT(1)       19020000
190300         PERFORM DP013-0000-PROCESS-ABEND                         19030000
190400     END-IF.                                                      19040000
190500 EJECT                                                            19050000
190600*----------------------------------------------------------------*19060000
190700* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *19070000
190800* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *19080000
190900*----------------------------------------------------------------*19090000
191000                                                                  19100000
191100 5200-FILL-SEL-QUEUE-RECORD.                                      19110000
191200                                                                  19120000
191300     PERFORM 6112-READ-LIST-QUEUE.                                19130000
191400                                                                  19140000
191500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       19150000
191600         PERFORM                                                  19160000
191700         VARYING LQW-IDX                                          19170000
191800         FROM 1 BY 1                                              19180000
191900         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            19190000
192000           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          19200000
192100                                                                  19210000
192200             IF  LQW-SELECT (LQW-IDX)                             19220000
192300                 SET ASC-UPDATE-TSQ        TO  TRUE               19230000
192400                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              19240000
192500                                   TO VN003-ITEM (VN003-IDX)      19250000
192600                 MOVE SPACES       TO VN003-DEPARTMENT (VN003-IDX)19260000
192700                 MOVE ASC-ENT-ID   TO VN003-ENT-ID (VN003-IDX)    19270000
192800                 MOVE LQW-SEQ-NBR (LQW-IDX)                       19280000
192900                                   TO VN003-SEQ-NBR (VN003-IDX)   19290000
193000                 MOVE SPACE        TO VN003-ACTION-SW (VN003-IDX) 19300000
193100                 SET VN003-IDX UP BY 1                            19310000
193200                 IF  VN003-IDX > VN003-MAX-ITEMS                  19320000
193300                     PERFORM 5205-WRITE-SEL-QUEUE                 19330000
193400                     ADD +1        TO VN002-NUMBER-OF-TS-ITEMS    19340000
193500                     INITIALIZE VN003-SELECTED-ITEM-ARRAY         19350000
193600                     SET VN003-IDX TO  1                          19360000
193700                 END-IF                                           19370000
193800             END-IF                                               19380000
193900         END-PERFORM                                              19390000
194000     END-IF.                                                      19400000
194100                                                                  19410000
194200*----------------------------------------------------------------*19420000
194300*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *19430000
194400*----------------------------------------------------------------*19440000
194500                                                                  19450000
194600 5205-WRITE-SEL-QUEUE.                                            19460000
194700                                                                  19470000
194800     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            19480000
194900                                   TO VN003-SELECTED-ITEMS.       19490000
195000                                                                  19500000
195100     EXEC CICS                                                    19510000
195200          WRITEQ TS                                               19520000
195300              QUEUE (ASC-SEL-QUEUE-NAME)                          19530000
195400              FROM  (VN003-VENDOR-SEL-REC)                        19540000
195500              ITEM  (PV-SEL-QUEUE-ITEM)                           19550000
195600              RESP  (PV-CICS-RESP)                                19560000
195700     END-EXEC.                                                    19570000
195800                                                                  19580000
195900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          19590000
196000         CONTINUE                                                 19600000
196100     ELSE                                                         19610000
196200         SET DP013-CICS-ABEND      TO TRUE                        19620000
196300         SET DP013-NO-ROLLBACK     TO TRUE                        19630000
196400         MOVE '5205-WRITE-SEL-QUEUE'                              19640000
196500                                   TO DP013-PARAGRAPH             19650000
196600         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          19660000
196700                                   TO DP013-MESSAGE-TEXT(1)       19670000
196800         PERFORM DP013-0000-PROCESS-ABEND                         19680000
196900     END-IF.                                                      19690000
197000 EJECT                                                            19700000
197100******************************************************************19710000
197200** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **19720000
197300** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **19730000
197400** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **19740000
197500** THE USER.                                                    **19750000
197600******************************************************************19760000
197700 6000-REFRESH-PANEL-FROM-TEMP.                                    19770000
197800     IF  ASC-UPDATE-TSQ                                           19780000
197900         SET ASC-NO-TSQ-UPDATE TO TRUE                            19790000
198000         MOVE ZERO                 TO PV-SAVE-ITEM                19800000
198100                                      PV-SEL-QUEUE-ITEM           19810000
198200         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        19820000
198300                                   TO PV-HOLD-SELECTED-ITEMS      19830000
198400         PERFORM 6100-UPDATE-TSQ                                  19840000
198500             UNTIL PV-ITEMS-PROCESSED >                           19850000
198600                                     ASC-NUMBER-OF-SELECTED-ITEMS 19860000
198700         PERFORM 6010-DELETE-SEL-QUEUE                            19870000
198800         INITIALIZE ASC-BLOCK-ENTRIES (1)                         19880000
198900                    ASC-BLOCK-ENTRIES (2)                         19890000
199000     END-IF.                                                      19900000
199100                                                                  19910000
199200*----------------------------------------------------------------*19920000
199300*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *19930000
199400*----------------------------------------------------------------*19940000
199500 6010-DELETE-SEL-QUEUE.                                           19950000
199600                                                                  19960000
199700     EXEC CICS                                                    19970000
199800         DELETEQ TS                                               19980000
199900             QUEUE (ASC-SEL-QUEUE-NAME)                           19990000
200000             RESP  (PV-CICS-RESP)                                 20000000
200100     END-EXEC.                                                    20010000
200200*                                                                 20020000
200300     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      20030000
200400        (PV-CICS-RESP = DFHRESP(QIDERR)))                         20040000
200500         CONTINUE                                                 20050000
200600     ELSE                                                         20060000
200700         SET DP013-CICS-ABEND TO TRUE                             20070000
200800         SET DP013-NO-ROLLBACK TO TRUE                            20080000
200900         MOVE '6010-DELETE-SEL-QUEUE'                             20090000
201000                        TO DP013-PARAGRAPH                        20100000
201100         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         20110000
201200                        TO DP013-MESSAGE-TEXT (1)                 20120000
201300         PERFORM DP013-0000-PROCESS-ABEND                         20130000
201400     END-IF.                                                      20140000
201500                                                                  20150000
201600*----------------------------------------------------------------*20160000
201700*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *20170000
201800*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *20180000
201900*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *20190000
202000*    THE TEMP QUEUE.                                             *20200000
202100*----------------------------------------------------------------*20210000
202200                                                                  20220000
202300 6100-UPDATE-TSQ.                                                 20230000
202400                                                                  20240000
202500     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             20250000
202600     PERFORM 6105-READ-SEL-QUEUE.                                 20260000
202700     PERFORM                                                      20270000
202800         VARYING VN003-IDX                                        20280000
202900         FROM 1 BY 1                                              20290000
203000         UNTIL ((PV-ITEMS-PROCESSED >                             20300000
203100                              PV-HOLD-SELECTED-ITEMS)             20310000
203200         OR (VN003-IDX GREATER THAN VN003-MAX-ITEMS))             20320000
203300         IF  VN003-ACTION-SW (VN003-IDX) > SPACE                  20330000
203400             PERFORM 6110-PROCESS-ITEMS                           20340000
203500         END-IF                                                   20350000
203600         ADD +1                TO PV-ITEMS-PROCESSED              20360000
203700     END-PERFORM.                                                 20370000
203800     PERFORM 6111-WRITE-LIST-QUEUE.                               20380000
203900*----------------------------------------------------------------*20390000
204000*    READ THE LIST QUEUE RECORD.                                 *20400000
204100*----------------------------------------------------------------*20410000
204200                                                                  20420000
204300 6105-READ-SEL-QUEUE.                                             20430000
204400                                                                  20440000
204500     EXEC CICS                                                    20450000
204600          READQ TS                                                20460000
204700              QUEUE (ASC-SEL-QUEUE-NAME)                          20470000
204800              INTO  (VN003-VENDOR-SEL-REC)                        20480000
204900              ITEM  (PV-SEL-QUEUE-ITEM)                           20490000
205000              RESP  (PV-CICS-RESP)                                20500000
205100     END-EXEC.                                                    20510000
205200*                                                                 20520000
205300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          20530000
205400         CONTINUE                                                 20540000
205500     ELSE                                                         20550000
205600         SET DP013-CICS-ABEND      TO  TRUE                       20560000
205700         SET DP013-NO-ROLLBACK     TO  TRUE                       20570000
205800         MOVE '6105-READ-SEL-QUEUE'                               20580000
205900                                   TO  DP013-PARAGRAPH            20590000
206000         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           20600000
206100                                   TO  DP013-MESSAGE-TEXT(1)      20610000
206200         PERFORM DP013-0000-PROCESS-ABEND                         20620000
206300     END-IF.                                                      20630000
206400 EJECT                                                            20640000
206500*----------------------------------------------------------------*20650000
206600*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*20660000
206700*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*20670000
206800*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *20680000
206900*----------------------------------------------------------------*20690000
207000                                                                  20700000
207100 6110-PROCESS-ITEMS.                                              20710000
207200                                                                  20720000
207300     COMPUTE PV-ITEM = 1 + ((VN003-ITEM (VN003-IDX) - 1)          20730000
207400                     / PC-ITEMS-PER-PANEL).                       20740000
207500                                                                  20750000
207600     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           20760000
207700         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          20770000
207800             PERFORM 6111-WRITE-LIST-QUEUE                        20780000
207900         END-IF                                                   20790000
208000         MOVE PV-ITEM          TO PV-SAVE-ITEM                    20800000
208100                                                                  20810000
208200         PERFORM 6112-READ-LIST-QUEUE                             20820000
208300         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               20830000
208400             CONTINUE                                             20840000
208500         END-IF                                                   20850000
208600     END-IF.                                                      20860000
208700                                                                  20870000
208800     COMPUTE PV-SUB = (VN003-ITEM (VN003-IDX)                     20880000
208900                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              20890000
209000     SET LQW-DESELECT (PV-SUB) TO    TRUE                         20900000
209100     MOVE LQW-SELECTED-SW (PV-SUB)                                20910000
209200                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  20920000
209300     EVALUATE TRUE                                                20930000
209400         WHEN VN003-INQ (VN003-IDX)                               20940000
209500              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             20950000
209600                                                                  20960000
209700         WHEN VN003-UPD (VN003-IDX)                               20970000
209800              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             20980000
209900                                                                  20990000
210000         WHEN VN003-DEL (VN003-IDX)                               21000000
210100              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             21010000
210200                                                                  21020000
210300         WHEN VN003-ERR (VN003-IDX)                               21030000
210400              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             21040000
210500     END-EVALUATE.                                                21050000
210600                                                                  21060000
210700     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                21070000
210800                                                                  21080000
210900*----------------------------------------------------------------*21090000
211000*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *21100000
211100*----------------------------------------------------------------*21110000
211200                                                                  21120000
211300 6111-WRITE-LIST-QUEUE.                                           21130000
211400                                                                  21140000
211500     EXEC CICS                                                    21150000
211600         WRITEQ TS                                                21160000
211700             QUEUE (ASC-LIST-QUEUE-NAME)                          21170000
211800             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     21180000
211900             ITEM  (PV-SAVE-ITEM)                                 21190000
212000             REWRITE                                              21200000
212100             RESP  (PV-CICS-RESP)                                 21210000
212200     END-EXEC.                                                    21220000
212300*                                                                 21230000
212400     IF  ((PV-CICS-RESP = DFHRESP (NORMAL)) OR                    21240000
212500         (PV-CICS-RESP = DFHRESP (ITEMERR)))                      21250000
212600         CONTINUE                                                 21260000
212700     ELSE                                                         21270000
212800         SET DP013-CICS-ABEND  TO  TRUE                           21280000
212900         SET DP013-NO-ROLLBACK TO  TRUE                           21290000
213000         MOVE '6111-WRITE-LIST-QUEUE'                             21300000
213100                               TO  DP013-PARAGRAPH                21310000
213200         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  21320000
213300                               TO  DP013-MESSAGE-TEXT(1)          21330000
213400         PERFORM DP013-0000-PROCESS-ABEND                         21340000
213500     END-IF.                                                      21350000
213600                                                                  21360000
213700 EJECT                                                            21370000
213800*----------------------------------------------------------------*21380000
213900*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*21390000
214000*----------------------------------------------------------------*21400000
214100                                                                  21410000
214200 6112-READ-LIST-QUEUE.                                            21420000
214300                                                                  21430000
214400     EXEC CICS                                                    21440000
214500         READQ TS                                                 21450000
214600             QUEUE (ASC-LIST-QUEUE-NAME)                          21460000
214700             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     21470000
214800             ITEM  (PV-ITEM)                                      21480000
214900             RESP  (PV-CICS-RESP)                                 21490000
215000     END-EXEC.                                                    21500000
215100*                                                                 21510000
215200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          21520000
215300         CONTINUE                                                 21530000
215400     ELSE                                                         21540000
215500         SET DP013-CICS-ABEND        TO TRUE                      21550000
215600         SET DP013-NO-ROLLBACK       TO TRUE                      21560000
215700         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           21570000
215800         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    21580000
215900                                     TO DP013-MESSAGE-TEXT(1)     21590000
216000         PERFORM DP013-0000-PROCESS-ABEND                         21600000
216100     END-IF.                                                      21610000
216200                                                                  21620000
216300 EJECT                                                            21630000
216400*----------------------------------------------------------------*21640000
216500*    ABEND PROCESSOR MODULE                                      *21650000
216600*----------------------------------------------------------------*21660000
216700                                                                  21670000
216800     COPY DPPD013.                                                21680000
