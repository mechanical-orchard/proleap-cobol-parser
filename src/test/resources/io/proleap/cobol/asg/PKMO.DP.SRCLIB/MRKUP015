000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.             MRKUP015.                                00050000
000600 AUTHOR.                 CHRISTINE FOLEY.                         00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            05-XX-05.                                00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100***************************************************************** 00110000
001200*                    ITEM MAINTENANCE                           * 00120000
001300*                                                               * 00130000
001400*  THIS PROGRAM WILL UPDATE THE INFOREM MAINTAINED VALUES ONTO  * 00140000
001500*  OUR ITEM DATABASES.                                          * 00150000
001600*                                                               * 00160000
001700*  THIS PROGRAM IS A REPLACEMENT FOR INFOREM PROGRAM ICB050C.   * 00170000
001800*                                                               * 00180000
001100***************************************************************** 00190000
001300****** PLEASE NOTE ******* PLEASE NOTE ******* PLEASE NOTE ****** 00200000
001100***************************************************************** 00210000
001300* THIS IS COPY OF MRKUP005 AS OF MAY 2005.                      * 00220000
001300* THIS PROGRAM WILL UPDATE ONLY THE DD FIELDS ON THE TMRITST    * 00230000
001300* TABLE.  THE FIELDS THAT ARE ONLY AFFECTED BY ORDER GENERATION * 00240000
001300* WILL ONLY BE UPDATED IN MRKUP005.                             * 00250000
001300* ALSO, THE TMRISFE TABLE WILL CONTINUE TO BE UPDATED.          * 00260003
001900***************************************************************** 00270000
002000*  CHANGE MADE:                                                 * 00280000
002200***************************************************************** 00290000
002300* CHANGED 05/05/2005 BY MARIA KLAMIK.                             00300000
002100* INITIAL INSTALLATION.                                         * 00310000
004800***************************************************************** 00320000
004900 ENVIRONMENT DIVISION.                                            00330000
005000***************************************************************** 00340000
005100                                                                  00350000
005200 CONFIGURATION SECTION.                                           00360000
005300                                                                  00370000
005400 SOURCE-COMPUTER.        IBM-3090.                                00380000
005500 OBJECT-COMPUTER.        IBM-3090.                                00390000
005600                                                                  00400000
005700 INPUT-OUTPUT SECTION.                                            00410000
005800                                                                  00420000
005900 FILE-CONTROL.                                                    00430000
006000*                                                                 00440000
006100     SELECT IC-SUPP-FILE          ASSIGN   TO  INP01.             00450000
006200*                                                                 00460000
006300     SELECT ITEM-STORE-HISTORY    ASSIGN   TO  OUT01.             00470000
006400*                                                                 00480000
006500***************************************************************** 00490000
006600 DATA DIVISION.                                                   00500000
006700***************************************************************** 00510000
006800*                                                                 00520000
006900 FILE SECTION.                                                    00530000
007000*                                                                 00540000
007100 FD  IC-SUPP-FILE                                                 00550000
007200     LABEL RECORDS ARE STANDARD                                   00560000
007300     BLOCK CONTAINS 0 RECORDS                                     00570000
007400     RECORD CONTAINS 2090 CHARACTERS                              00580000
007500     DATA RECORD IS IC-SUPP-REC.                                  00590000
007600 01  IC-SUPP-REC                     PIC  X(2090).                00600000
007700*                                                                 00610000
007800 FD  ITEM-STORE-HISTORY                                           00620000
007900     LABEL RECORDS ARE STANDARD                                   00630000
008000     RECORDING MODE IS F                                          00640000
008100     RECORD CONTAINS 35 CHARACTERS                                00650000
008200     BLOCK CONTAINS 0 RECORDS.                                    00660000
008300 01  ITEM-STORE-HISTORY-REC          PIC  X(35).                  00670000
008400*                                                                 00680000
008500 WORKING-STORAGE SECTION.                                         00690000
008600*                                                                 00700000
008700 01  FILLER.                                                      00710000
008800     05  FILLER                      PIC  X(36)    VALUE          00720000
008900         ' ***** WORKING STORAGE PGM=MRKUP015 '.                  00730000
009000     05  PGM-COMPILED                PIC  X(20)    VALUE SPACE.   00740000
009100     05  FILLER                      PIC  X(10)    VALUE          00750000
009200         ' LOCATION='.                                            00760000
009300     05  PGM-LOCATION                PIC  X(04)    VALUE SPACE.   00770000
009400     05  FILLER                      PIC  X(06)    VALUE          00780000
009500         ' *****'.                                                00790000
009600 EJECT                                                            00800000
009700 01  PROGRAM-SWITCHES.                                            00810000
009800     05  PS-EOF-SUPP-FILE            PIC  X(01)    VALUE 'N'.     00820000
009900         88  EOF-SUPP-FILE                         VALUE 'Y'.     00830000
010000     05  PS-EOC-ITEM-STORE-CSR       PIC  X(01)    VALUE 'N'.     00840000
010100         88  EOC-ITEM-STORE-CSR                    VALUE 'Y'.     00850000
010200     05  PS-END-OF-PARM-REC          PIC  X(01)    VALUE 'N'.     00860000
010300         88  END-OF-PARM-REC                       VALUE 'Y'.     00870000
010400*                                                                 00880000
010500/                                                                 00890000
010600 01  PC-CONSTANTS.                                                00900000
010700     05  PC-DECR-7-DAYS              PIC  9(05)    VALUE 7.       00910000
010800     05  PC-DECR-14-DAYS             PIC  9(05)    VALUE 14.      00920000
010900     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     00930000
011000                                                   COMP SYNC.     00940000
011100     05  PC-NOT-REF-INTEGRAL         PIC S9(04)    VALUE -530     00950000
011200                                                   COMP SYNC.     00960000
011300     05  PC-19                       PIC  X(02)    VALUE '19'.    00970000
011400     05  PC-20                       PIC  X(02)    VALUE '20'.    00980000
011500     05  PC-53                       PIC  9(02)    VALUE 53.      00990000
011600     05  PC-N                        PIC  X(01)    VALUE 'N'.     01000000
011700     05  PC-Y                        PIC  X(01)    VALUE 'Y'.     01010000
011800     05  PC-F2                       PIC  X(02)    VALUE 'F2'.    01020000
011900     05  PC-MRKUP015                 PIC  X(08)    VALUE          01030000
012000                                                   'MRKUP015'.    01040000
012100     05  PC-PGM-DPKUT500             PIC  X(08)    VALUE          01050000
012200                                                   'DPKUT500'.    01060000
012300     05  PC-ASTERISK                 PIC  X(30)    VALUE          01070000
012400         '*****************************'.                         01080000
012500 EJECT                                                            01090000
012600*                                                                 01100000
012700 01  PV-ACCUMULATOR-FIELDS.                                       01110000
012800     05  PV-SYSTEM-INPUT-CNT         PIC S9(03)    VALUE ZERO     01120000
012900                                                   COMP-3.        01130000
013000     05  PV-PARM-INPUT-CNT           PIC S9(03)    VALUE ZERO     01140000
013100                                                   COMP-3.        01150000
013200     05  PV-SYSTEM-OUTPUT-CNT        PIC S9(04)    VALUE ZERO     01160000
013300                                                   COMP-3.        01170000
013400     05  PV-UPDATE-CNT               PIC S9(11)    VALUE ZERO     01180003
013500                                                   COMP-3.        01190000
013600 EJECT                                                            01200000
013700*                                                                 01210000
013800 01  PV-MISC-FIELDS.                                              01220000
013900     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     01230000
014000                                                   COMP SYNC.     01240000
014100     05  PV-RBA                      PIC S9(09)    VALUE ZERO     01250000
014200                                                   COMP SYNC.     01260000
014300     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  01270000
014400     05  PV-CURR-TMST                PIC  X(26)    VALUE SPACE.   01280000
014500     05  PV-COMMIT-TMST              PIC  X(26)    VALUE SPACE.   01290000
014600     05  PV-TODAYS-DAY               PIC  9(01)    VALUE ZERO.    01300000
014700     05  PV-CURRENT-DATE.                                         01310000
014800         10  PV-CURRENT-YEAR.                                     01320000
014900             15 PV-CURRENT-DATE-CC   PIC  9(02)    VALUE ZERO.    01330000
015000             15 PV-CURRENT-DATE-YR   PIC  9(02)    VALUE ZERO.    01340000
015100         10  FILLER                  PIC  X(01)    VALUE '-'.     01350000
015200         10  PV-CURRENT-DATE-MO      PIC  9(02)    VALUE ZERO.    01360000
015300         10  FILLER                  PIC  X(01)    VALUE '-'.     01370000
015400         10  PV-CURRENT-DATE-DY      PIC  9(02)    VALUE ZERO.    01380000
015500     05  CC-DATE.                                                 01390000
015600         10  CC-CURRENT-YEAR.                                     01400000
015700             15 CC-CURRENT-DATE-CC   PIC  9(02)    VALUE ZERO.    01410000
015800             15 CC-CURRENT-DATE-YR   PIC  9(02)    VALUE ZERO.    01420000
015900         10  FILLER                  PIC  X(01)    VALUE '-'.     01430000
016000         10  CC-CURRENT-DATE-MO      PIC  9(02)    VALUE ZERO.    01440000
016100         10  FILLER                  PIC  X(01)    VALUE '-'.     01450000
016200         10  CC-CURRENT-DATE-DY      PIC  9(02)    VALUE ZERO.    01460000
016300     05  PV-FIRST-DATE.                                           01470000
016400         10  PV-FIRST-YEAR.                                       01480000
016500             15 PV-FIRST-DATE-CC     PIC  9(02)    VALUE ZERO.    01490000
016600             15 PV-FIRST-DATE-YR     PIC  9(02)    VALUE ZERO.    01500000
016700         10  FILLER                  PIC  X(01)    VALUE '-'.     01510000
016800         10  PV-FIRST-DATE-MO        PIC  9(02)    VALUE ZERO.    01520000
016900         10  FILLER                  PIC  X(01)    VALUE '-'.     01530000
017000         10  PV-FIRST-DATE-DY        PIC  9(02)    VALUE ZERO.    01540000
017100     05  PV-FISCAL-YEAR.                                          01550000
017200         10  PV-FISCAL-YEAR-CC       PIC  9(02).                  01560000
017300         10  PV-FISCAL-YEAR-YR       PIC  9(02).                  01570000
017400     05  PV-FISCAL-YEAR-NBR REDEFINES PV-FISCAL-YEAR              01580000
017500                                     PIC  9(04).                  01590000
017600     05  PV-MMDDYY.                                               01600000
017700         10  PV-MM                   PIC  9(02)    VALUE ZERO.    01610000
017800         10  PV-DD                   PIC  9(02)    VALUE ZERO.    01620000
017900         10  PV-YY                   PIC  9(02)    VALUE ZERO.    01630000
018000     05  PV-YYMMDD                   PIC  9(06)    VALUE ZERO.    01640000
018100     05  PV-TODAYS-TIME.                                          01650000
018200         10  PV-TODAYS-TIME-HH       PIC  9(02)    VALUE ZERO.    01660000
018300         10  PV-TODAYS-TIME-MM       PIC  9(02)    VALUE ZERO.    01670000
018400         10  PV-TODAYS-TIME-SS       PIC  9(02)    VALUE ZERO.    01680000
018500         10  FILLER                  PIC  9(02)    VALUE ZERO.    01690000
018600     05  PV-SUBSCRIPTS.                                           01700000
018700         10  PV-DD-SUB               PIC  9(02)    VALUE ZERO.    01710000
018800         10  PV-OH-SUB               PIC  9(02)    VALUE ZERO.    01720000
018900         10  PV-CPS-SUB              PIC  9(02)    VALUE ZERO.    01730000
019000         10  PV-MAD-SUB              PIC  9(02)    VALUE ZERO.    01740000
019100         10  PV-LYS-SUB              PIC  9(02)    VALUE ZERO.    01750000
019200         10  PV-FWM-SUB              PIC  9(02)    VALUE ZERO.    01760000
019300         10  PV-LFWM-SUB             PIC  9(02)    VALUE ZERO.    01770000
019400     05  PV-INAME.                                                01780000
019910         10  PV-INAME-SKU            PIC  9(08)    VALUE ZERO.    01790000
020000         10  FILLER                  PIC  X(02)    VALUE SPACES.  01800000
020010         10  FILLER                  PIC  X(05)                   01810000
020100             VALUE ' STR:'.                                       01820000
020200         10  PV-INAME-STORE          PIC  X(05)    VALUE SPACES.  01830000
020300         10  FILLER                  PIC  X(01)    VALUE '/'.     01840000
020400         10  PV-INAME-SKU-DESC       PIC  X(25)    VALUE SPACES.  01850000
020510         10  FILLER                  PIC  X(04)    VALUE SPACES.  01860000
020600     05  PV-SKU.                                                  01870000
020700         10  PV-SKU-STYLE            PIC  X(15)    VALUE SPACES.  01880000
020800         10  FILLER                  PIC  X(01)    VALUE '/'.     01890000
020900         10  PV-SKU-SIZE             PIC  X(05)    VALUE SPACES.  01900000
021000         10  FILLER                  PIC  X(01)    VALUE '/'.     01910000
021100         10  PV-SKU-COLOR            PIC  X(04)    VALUE SPACES.  01920000
021200         10  FILLER                  PIC  X(01)    VALUE ' '.     01930000
021300         10  PV-SKU-VEND-NBR         PIC  X(03)    VALUE SPACES.  01940000
021400     05  PV-SALES-INDCT.                                          01950000
021500         10  PV-SALES-INDCT-YR       PIC  X(02)    VALUE SPACES.  01960000
021600         10  PV-SALES-INDCT-WK       PIC  X(02)    VALUE SPACES.  01970000
021700     05  PV-WEEK-NBR                 PIC  S9(2)    COMP-3.        01980000
021800     05  PV-WN                       PIC   9(2)    VALUE ZERO.    01990000
021900     05  PV-DECR-DAYS                PIC  9(05)    VALUE ZERO.    02000000
022000     05  PV-VENDOR-NMBR              PIC  9(09).                  02010000
022100     05  PV-SUP-KEY.                                              02020000
022200         10 PV-SUP-KEY-1-08          PIC  9(08).                  02030000
022700         10 FILLER                   PIC  X(03).                  02040000
022710         10 FILLER                   PIC  X(04).                  02050000
022800         10 PV-SUP-KEY-16-20         PIC  9(05).                  02060000
022900         10 FILLER                   PIC  X(10).                  02070000
023000     10  PV-PREV-YEAR.                                            02080000
023100         15 PV-PREV-YEAR-CC          PIC  9(02)    VALUE ZERO.    02090000
023200         15 PV-PREV-YEAR-YR          PIC  9(02)    VALUE ZERO.    02100000
023300 EJECT                                                            02110000
023400*                                                                 02120000
023500     COPY ISWS006.                                                02130000
023600*                                                                 02140000
023601     COPY DPWS500.                                                02150000
023602*                                                                 02160000
023700     COPY MRRD015O.                                               02170000
023800*                                                                 02180000
023900 01 SUPP-RECORD.                                                  02190000
024000     COPY ICI165C.                                                02200000
024100  02 TR-INPUT-RECORD REDEFINES SUP-TR-RCD-IN.                     02210000
024200     COPY ICI030C.                                                02220000
024300     COPY MRRD165.                                                02230000
024400 EJECT                                                            02240000
024500* DB2 TABLE LAYOUTS                                               02250000
024600     EXEC SQL                                                     02260000
024700         INCLUDE TMRITST                                          02270000
024800     END-EXEC.                                                    02280000
024900 EJECT                                                            02290000
025000     EXEC SQL                                                     02300000
025100         INCLUDE TCKRSTCN                                         02310000
025200     END-EXEC.                                                    02320000
025300 EJECT                                                            02330000
025400     EXEC SQL                                                     02340000
025500         INCLUDE TMRISFE                                          02350000
025600     END-EXEC.                                                    02360000
025700 EJECT                                                            02370000
025800     EXEC SQL                                                     02380000
025900         INCLUDE TMRISFL                                          02390000
026000     END-EXEC.                                                    02400000
026100 EJECT                                                            02410000
026510     EXEC SQL                                                     02420000
026520         INCLUDE TSKXREF                                          02430000
026530     END-EXEC.                                                    02440000
026540 EJECT                                                            02450000
026600* DB2 COMMUNICATION AREA                                          02460000
026700*                                                                 02470000
026800     EXEC SQL                                                     02480000
026900         INCLUDE SQLCA                                            02490000
027000     END-EXEC.                                                    02500000
027100 EJECT                                                            02510000
027200* DB2 COMMUNICATION AREA2                                         02520000
027300*                                                                 02530000
027400     COPY SQLCA2.                                                 02540000
027500 EJECT                                                            02550000
027600*                                                                 02560000
027700 LINKAGE SECTION.                                                 02570000
027800***************************************************************** 02580000
027900*PROCEDURE DIVISION.                                              02590000
028000***************************************************************** 02600000
028100 PROCEDURE DIVISION.                                              02610000
028200*                                                                 02620000
028300 A000-MAINLINE-PROCESSING.                                        02630000
028400*                                                                 02640000
028500     PERFORM A100-INITIALIZATION.                                 02650000
028600*                                                                 02660000
028700     PERFORM B000-PROCESS-SUPPLEMENTAL-REC                        02670000
028800             UNTIL EOF-SUPP-FILE.                                 02680000
028900*                                                                 02690000
029000     PERFORM Y100-END-ROUTINE.                                    02700000
029100*                                                                 02710000
029200     GOBACK.                                                      02720000
029300*                                                                 02730000
029400 EJECT                                                            02740000
029500******************************************************************02750000
029600** OPEN THE SYSTEM FILE AND ACCEPT CONTROL CARDS.                 02760000
029700** READ THE FIRST RECORD.                                         02770000
029800******************************************************************02780000
029900 A100-INITIALIZATION.                                             02790000
030000*                                                                 02800000
030100     OPEN  INPUT IC-SUPP-FILE.                                    02810000
030200     OPEN OUTPUT ITEM-STORE-HISTORY.                              02820000
030300*                                                                 02830000
030500     ACCEPT CC-DATE.                                              02840000
030600*                                                                 02850000
031600     PERFORM S300-SELECT-SEQ-NBR.                                 02860000
031700*                                                                 02870000
031800     PERFORM R000-READ-SUPP-FILE.                                 02880000
031900*                                                                 02890000
032000      IF EOF-SUPP-FILE                                            02900000
032100         CLOSE  IC-SUPP-FILE                                      02910000
032200         CLOSE  ITEM-STORE-HISTORY                                02920000
032300         GOBACK.                                                  02930000
032400*                                                                 02940000
032500*  SET UP FIRST SCHEDULED COMMIT TIME                             02950000
032600                                                                  02960000
032700     EXEC SQL                                                     02970000
032800         SELECT  (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)    02980000
032900           INTO  :PV-COMMIT-TMST                                  02990000
033000           FROM  TCKRSTCNTL                                       03000000
033100          WHERE  PLAN_NAME = 'MRKUP015'                           03010000
033200     END-EXEC.                                                    03020000
033300                                                                  03030000
033400     IF SQLCODE = +0                                              03040000
033500         CONTINUE                                                 03050000
033600     ELSE                                                         03060000
033700         DISPLAY 'PARAGRAPH A100, BAD SELECT FOR TIMESTAMP'       03070000
033800         DISPLAY ' '                                              03080000
033900         PERFORM Z999-SQL-ERROR.                                  03090000
034000*                                                                 03100000
034100     PERFORM T000-DATE-ROUTINE.                                   03110000
034200*                                                                 03120000
034300 EJECT                                                            03130000
034400******************************************************************03140000
034500*  THIS IS THE MAIN CONTROLLING PARAGRAPH FOR PROCESSING THE     *03150000
034600*  SUPPLEMENTAL RECORD.                                          *03160000
034700******************************************************************03170000
034800 B000-PROCESS-SUPPLEMENTAL-REC.                                   03180000
034900*                                                                 03190000
035000     MOVE SUP-KEY TO PV-SUP-KEY.                                  03200000
035310     MOVE PV-SUP-KEY-1-08  TO NI-SKU-9-8.                         03210000
035311     MOVE NI-SKU-9-8       TO SKXREF-SKU.                         03220000
035400     PERFORM S400-READ-SKU-TABLE.                                 03230000
035500*                                                                 03240000
035600     IF SQLCODE = 100                                             03250000
035700        CONTINUE                                                  03260000
035800     ELSE                                                         03270000
035900         PERFORM F000-FORMAT-UPDATE-ITEM-STORE                    03280000
036000         PERFORM G000-FORMAT-ITEM-STR-HIST                        03290000
036100         PERFORM H000-SEL-UPDATE-FE-TABLE                         03300000
036200         PERFORM Z900-COMMIT-TEST                                 03310000
036300     END-IF.                                                      03320000
036400*                                                                 03330000
036500     PERFORM R000-READ-SUPP-FILE.                                 03340000
036600*                                                                 03350000
036700 EJECT                                                            03360000
036800******************************************************************03370000
036900*    THIS SECTION CALLS THE CALENDAR ROUTINE                     *03380000
037000******************************************************************03390000
037100 E000-CALENDAR-ROUTINE.                                           03400000
037200*                                                                 03410000
037300*    DISPLAY 'E000-CALENDAR-ROUTINE'.                             03420000
037400*                                                                 03430000
037500     CALL PC-PGM-DPKUT500 USING DPG51 DPG52                       03440000
037600                                DPG53 DPG54                       03450000
037700                                DPG55 DPG56.                      03460000
037800     EVALUATE TRUE                                                03470000
037900     WHEN DPG54-SEVERE-ERROR                                      03480000
038000         DISPLAY 'SEVERE ERROR IN CALENDAR ROUTINE'               03490000
038100         DISPLAY DPG54-ERROR-MESSAGE                              03500000
038200         CALL 'ILBOABN0'        USING PV-ABEND-CODE               03510000
038300     WHEN DPG54-WARNING-ERROR                                     03520000
038400         DISPLAY 'WARNING ERROR IN CALENDAR ROUTINE'              03530000
038500         DISPLAY DPG54-ERROR-MESSAGE                              03540000
038600     WHEN DPG54-NO-ERROR                                          03550000
038700         CONTINUE                                                 03560000
038800     END-EVALUATE.                                                03570000
038900*                                                                *03580000
039000******************************************************************03590000
039100*   FORMAT FIELDS AND UPDATE ON THE ITEM/STORE TABLE WITH THE    *03600000
039200*   DATA FROM THE SUPPLEMENTAL RECORD.                           *03610000
039300******************************************************************03620000
039400 F000-FORMAT-UPDATE-ITEM-STORE.                                   03630000
039500*                                                                 03640000
039600*    DISPLAY 'F000-FORMAT-UPDATE-ITEM-STORE'.                     03650000
039700*                                                                 03660000
039800* @@@                                                             03670000
040000     MOVE DD                   TO  MRITST-DD-FCTR.                03680000
040100     MOVE DDI                  TO  MRITST-DDI-FCTR.               03690000
040200     MOVE LPP                  TO  MRITST-LPP-QTY.                03700000
040300     MOVE MADSS                TO  MRITST-MADSS-QTY.              03710000
040400     MOVE FWMAD                TO  MRITST-FWMAD-QTY.              03720000
040500     MOVE TRNDP                TO  MRITST-TRNDP-PCT.              03730000
040600     MOVE MSDTS                TO  MRITST-MSDTS-QTY.              03740000
040700     MOVE MADTS                TO  MRITST-MADTS-QTY.              03750000
040800     MOVE LTVFACT              TO  MRITST-LTVFACT-FCTR.           03760000
040900     MOVE PCTZ                 TO  MRITST-PCTZ-PCT.               03770000
041000     MOVE MADSTAT              TO  MRITST-MADSTAT-CDE.            03780000
041100     MOVE DFLREG               TO  MRITST-DFLREG-CDE.             03790000
041200     MOVE TSREG                TO  MRITST-TSREG-CDE.              03800000
041300     MOVE DIREG                TO  MRITST-DIREG-CDE.              03810000
041400     MOVE BYPREG               TO  MRITST-BYPREG-CDE.             03820000
041500     MOVE LDD                  TO  MRITST-LDD-FCTR.               03830000
041600     MOVE LDDI                 TO  MRITST-LDDI-FCTR.              03840000
041700     MOVE LMADSS               TO  MRITST-LMADSS-QTY.             03850000
041800     MOVE LFWMAD               TO  MRITST-LFWMAD-QTY.             03860000
041900     MOVE LCPS                 TO  MRITST-LCPS-QTY.               03870000
042300     MOVE PV-SUP-KEY-16-20     TO  MRITST-STR-NBR.                03880000
042700*                                                                *03890000
042800     PERFORM S100-UPDATE-TMRITST.                                 03900000
042900*                                                                *03910000
043000******************************************************************03920000
043100*  FORMAT FIELDS AND UPDATE THE HISTORY TABLE WITH THE DATA      *03930000
043200*  FROM THE SUPPLEMENTAL FILE.                                   *03940000
043300******************************************************************03950000
043400 G000-FORMAT-ITEM-STR-HIST.                                       03960000
043500*                                                                 03970000
043600*    DISPLAY 'G000-FORMAT-ITEM-STR-HIST'.                         03980000
043700*                                                                 03990000
043800     MOVE DD                   TO  MR015O-HISTDD-FCTR.            04000000
043900     MOVE MADSS                TO  MR015O-HISTMAD-QTY.            04010000
044000*                                                                 04020000
044100     MOVE CPS                  TO  MR015O-HISTCPS-QTY.            04030000
044200     MOVE OH                   TO  MR015O-HISTOH-QTY.             04040000
044300*                                                                 04050000
044410     MOVE SKXREF-ITM-NBR       TO  MR015O-ITEM-NBR.               04060000
044500     MOVE INAME                TO  PV-INAME.                      04070000
044510                                                                  04080000
044600     IF PV-INAME-STORE = SPACES                                   04090000
044700         MOVE ZEROES           TO  MR015O-STR-NBR                 04100000
044800     ELSE                                                         04110000
044900         MOVE PV-INAME-STORE   TO  MR015O-STR-NBR                 04120000
045000     END-IF.                                                      04130000
045100     MOVE PV-FISCAL-YEAR       TO  MR015O-YEAR-NBR.               04140000
045200     MOVE PV-WEEK-NBR          TO  MR015O-WEEK-NBR.               04150000
045300*                                                                 04160000
045400     PERFORM W800-WRITE-ITEM-STR-HIST.                            04170000
045500*                                                                 04180000
045600******************************************************************04190000
045700*  UPDATE THE FIELDS ON THE FORECAST ERROR TABLE WITH THE DATA   *04200000
045800*  FROM THE SUPPLEMENTAL FILE.                                   *04210000
045900******************************************************************04220000
046000 H000-SEL-UPDATE-FE-TABLE.                                        04230000
046100*                                                                 04240000
046200*    DISPLAY 'H000-UPDATE-FE-TABLE'.                              04250000
046300*                                                                 04260000
046400     MOVE FWM(1)               TO  MRISFE-FWM-QTY.                04270000
046500     MOVE LFWM(1)              TO  MRISFE-LFWM-QTY.               04280000
046610     MOVE SKXREF-ITM-NBR       TO  MRISFE-ITEM-NBR.               04290000
042300     MOVE PV-SUP-KEY-16-20     TO  MRISFE-STR-NBR.                04300000
046800     MOVE MRISFL-SEQ-NBR       TO  MRISFE-SEQ-NBR.                04310000
046900*                                                                 04320000
047000     PERFORM S200-UPDATE-TMRISFE.                                 04330000
047100*                                                                 04340000
047200******************************************************************04350000
047300*  THIS PARAGRAPH READS THE SUPPLEMENTAL FILE FOR PROCESSING     *04360000
047400******************************************************************04370000
047500 R000-READ-SUPP-FILE.                                             04380000
047600*                                                                 04390000
047700     READ IC-SUPP-FILE  INTO  SUPP-RECORD                         04400000
047800         AT END                                                   04410000
047900            MOVE PC-Y TO PS-EOF-SUPP-FILE.                        04420000
048000*                                                                 04430000
048100*                                                                 04440000
048200******************************************************************04450000
048300* THIS PARAGRAPH PERFORMS THE UPDATE OF THE ITEM/STORE TABLE     *04460000
048400******************************************************************04470000
048500 S100-UPDATE-TMRITST.                                             04480000
048600*                                                                 04490000
048700*    DISPLAY 'S100-UPDATE-TMRITST'.                               04500000
048800*                                                                 04510000
048900     MOVE 'S100'                   TO PGM-LOCATION.               04520000
049000     MOVE 'S100-UPDATE-TMRITST'    TO PV-ABEND-PARAGRAPH.         04530000
049100*                                                                 04540000
049200     EXEC SQL                                                     04550000
049300         UPDATE TMRITST                                           04560000
049400            SET   DD_FCTR      =  :MRITST-DD-FCTR,                04570000
049500                  DDI_FCTR     =  :MRITST-DDI-FCTR,               04580000
049600                  LPP_QTY      =  :MRITST-LPP-QTY,                04590000
049700                  MADSS_QTY    =  :MRITST-MADSS-QTY,              04600000
049800                  FWMAD_QTY    =  :MRITST-FWMAD-QTY,              04610000
049900                  TRNDP_PCT    =  :MRITST-TRNDP-PCT,              04620000
050000                  MSDTS_QTY    =  :MRITST-MSDTS-QTY,              04630000
050100                  MADTS_QTY    =  :MRITST-MADTS-QTY,              04640000
050200                  LTVFACT_FCTR =  :MRITST-LTVFACT-FCTR,           04650000
050300                  PCTZ_PCT     =  :MRITST-PCTZ-PCT,               04660000
050400                  MADSTAT_CDE  =  :MRITST-MADSTAT-CDE,            04670000
050500                  DFLREG_CDE   =  :MRITST-DFLREG-CDE,             04680000
050600                  TSREG_CDE    =  :MRITST-TSREG-CDE,              04690000
050700                  DIREG_CDE    =  :MRITST-DIREG-CDE,              04700000
050800                  BYPREG_CDE   =  :MRITST-BYPREG-CDE,             04710000
050900                  LDD_FCTR     =  :MRITST-LDD-FCTR,               04720000
051000                  LDDI_FCTR    =  :MRITST-LDDI-FCTR,              04730000
051100                  LMADSS_QTY   =  :MRITST-LMADSS-QTY,             04740000
051200                  LFWMAD_QTY   =  :MRITST-LFWMAD-QTY,             04750000
051300                  LCPS_QTY     =  :MRITST-LCPS-QTY                04760001
052110          WHERE   ITEM_NBR     =  :SKXREF-ITM-NBR                 04770000
052200            AND   STR_NBR      =  :MRITST-STR-NBR                 04780000
052300     END-EXEC.                                                    04790000
052400*                                                                 04800000
052500     EVALUATE TRUE                                                04810000
052600       WHEN SQLCODE         = ZERO                                04820000
052700         ADD 1 TO PV-UPDATE-CNT                                   04830000
053100       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    04840000
053200         CONTINUE                                                 04850000
053300       WHEN OTHER                                                 04860000
053400         DISPLAY PV-ABEND-PARAGRAPH                               04870000
053500         PERFORM Z999-SQL-ERROR                                   04880000
053600     END-EVALUATE.                                                04890000
053700*                                                                 04900000
053800 EJECT                                                            04910000
053900******************************************************************04920000
054000* THIS PARAGRAPH PERFORMS THE UPDATE OF THE FORECAST ERROR TABLE *04930000
054100******************************************************************04940000
054200 S200-UPDATE-TMRISFE.                                             04950000
054300*                                                                 04960000
054400*    DISPLAY 'S200-UPDATE-TMRISFE'.                               04970000
054500*                                                                 04980000
054600     MOVE 'S200'                   TO PGM-LOCATION.               04990000
054700     MOVE 'S200-UPDATE-TMRISFE'    TO PV-ABEND-PARAGRAPH.         05000000
054800*                                                                 05010000
054900     EXEC SQL                                                     05020000
055000         UPDATE TMRISFE                                           05030000
055100            SET   FWM_QTY      =  :MRISFE-FWM-QTY,                05040000
055200                  LFWM_QTY     =  :MRISFE-LFWM-QTY                05050000
055300          WHERE   SEQ_NBR      =  :MRISFE-SEQ-NBR                 05060000
055400            AND   ITEM_NBR     =  :MRISFE-ITEM-NBR                05070000
055500            AND   STR_NBR      =  :MRISFE-STR-NBR                 05080000
055600     END-EXEC.                                                    05090000
055700*                                                                 05100000
055800                                                                  05110000
055900*                                                                 05120000
056000     EVALUATE TRUE                                                05130000
056100       WHEN SQLCODE         = ZERO                                05140000
056200         CONTINUE                                                 05150000
056300       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    05160000
056400         PERFORM S1000-INSERT-TMRISFE                             05170000
056500       WHEN OTHER                                                 05180000
056600         DISPLAY PV-ABEND-PARAGRAPH                               05190000
056700         PERFORM Z999-SQL-ERROR                                   05200000
056800     END-EVALUATE.                                                05210000
056900*                                                                 05220000
057000******************************************************************05230000
057100*  THIS PARAGRAPH SELECTS THE SEQUENCE NUMBER FOR RENUMBERING    *05240000
057200******************************************************************05250000
057300 S300-SELECT-SEQ-NBR.                                             05260000
057400*                                                                 05270000
057500     MOVE 'S300'                   TO PGM-LOCATION.               05280000
057600     MOVE 'S300-SELECT-SEQ-NBR'    TO PV-ABEND-PARAGRAPH.         05290000
057700*                                                                 05300000
057800     EXEC SQL                                                     05310000
057900         SELECT   SEQ_NBR                                         05320000
058000           INTO   :MRISFL-SEQ-NBR                                 05330000
058100           FROM   TMRISFL                                         05340000
058200          WHERE   WEEK_NBR     =                                  05350000
058300                  (SELECT MAX(WEEK_NBR)                           05360000
058400                     FROM TMRISFL)                                05370000
058500     END-EXEC.                                                    05380000
058600*                                                                 05390000
058700     EVALUATE TRUE                                                05400000
058800       WHEN SQLCODE         = ZERO                                05410000
058900       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    05420000
059000         CONTINUE                                                 05430000
059100       WHEN OTHER                                                 05440000
059200         DISPLAY PV-ABEND-PARAGRAPH                               05450000
059300         PERFORM Z999-SQL-ERROR                                   05460000
059400     END-EVALUATE.                                                05470000
059500*                                                                 05480000
059600******************************************************************05490000
059700*  THIS PARAGRAPH READS THE SKU TABLE FOR PROCESSING             *05500000
059800******************************************************************05510000
059900 S400-READ-SKU-TABLE.                                             05520000
060000*                                                                 05530000
060100     MOVE 'S400'                   TO PGM-LOCATION.               05540000
060200     MOVE 'S400-READ-SKU-TABLE '   TO PV-ABEND-PARAGRAPH.         05550000
060300*                                                                 05560000
061110     EXEC SQL                                                     05570000
061120         SELECT   ITM_NBR                                         05580000
061130           INTO   :SKXREF-ITM-NBR                                 05590000
061140           FROM   TSKXREF                                         05600000
061150          WHERE   SKU = :SKXREF-SKU                               05610000
061180     END-EXEC.                                                    05620000
061200*                                                                 05630000
061300     EVALUATE TRUE                                                05640000
061400       WHEN SQLCODE         = ZERO                                05650000
061500       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    05660000
061600         CONTINUE                                                 05670000
061700       WHEN OTHER                                                 05680000
061800         DISPLAY PV-ABEND-PARAGRAPH                               05690000
061900         PERFORM Z999-SQL-ERROR                                   05700000
062000     END-EVALUATE.                                                05710000
062100*                                                                 05720000
062200******************************************************************05730000
062300* THIS PARAGRAPH WRITES A RECORD TO THE SALES HISTORY FILE       *05740000
062400******************************************************************05750000
062500 W800-WRITE-ITEM-STR-HIST.                                        05760000
062600*                                                                 05770000
062700     MOVE 'W800'                   TO PGM-LOCATION.               05780000
062800     MOVE 'W800-WRITE-ITEM-STR-HIST    '                          05790000
062900                                   TO PV-ABEND-PARAGRAPH.         05800000
063000*                                                                 05810000
063100     WRITE ITEM-STORE-HISTORY-REC FROM ITEM-STORE-REPL-RECORD.    05820000
063200*                                                                 05830000
063300*                                                                 05840000
063400******************************************************************05850000
063500* THIS PARAGRAPH INSERTS TO THE FORECAST ERROR TABLE AFTER A NOT *05860000
063600* FOUND CONDITION WAS OBTAINED ON THE UPDATE.                    *05870000
063700******************************************************************05880000
063800 S1000-INSERT-TMRISFE.                                            05890000
063900*                                                                 05900000
064000     MOVE 'S1000'                  TO PGM-LOCATION.               05910000
064100     MOVE 'S1000-INSERT-TMRISFE '                                 05920000
064200                                   TO PV-ABEND-PARAGRAPH.         05930000
064300     EXEC SQL                                                     05940000
064400         INSERT INTO TMRISFE                                      05950000
064500                ( ITEM_NBR,                                       05960000
064600                  STR_NBR,                                        05970000
064700                  SEQ_NBR,                                        05980000
064800                  FWM_QTY,                                        05990000
064900                  LFWM_QTY                                        06000000
065000                )                                                 06010000
065100         VALUES (:MRISFE-ITEM-NBR,                                06020000
065200                 :MRISFE-STR-NBR,                                 06030000
065300                 :MRISFE-SEQ-NBR,                                 06040000
065400                 :MRISFE-FWM-QTY,                                 06050000
065500                 :MRISFE-LFWM-QTY                                 06060000
065600                )                                                 06070000
065700     END-EXEC.                                                    06080000
065800*                                                                 06090000
065900     EVALUATE TRUE                                                06100000
066000       WHEN SQLCODE         = ZERO                                06110000
066100       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    06120000
066200         CONTINUE                                                 06130000
066300       WHEN SQLCODE         = PC-NOT-REF-INTEGRAL                 06140000
066400         CONTINUE                                                 06150000
066500       WHEN OTHER                                                 06160000
066600         DISPLAY 'ITEM NBR:  ' MRISFE-ITEM-NBR                    06170000
066700         DISPLAY 'STORE NBR: ' MRISFE-STR-NBR                     06180000
066800         DISPLAY PV-ABEND-PARAGRAPH                               06190000
066900         PERFORM Z999-SQL-ERROR                                   06200000
067000     END-EVALUATE.                                                06210000
067100*                                                                 06220000
067200******************************************************************06230000
067300*T000-DATE-ROUTINE.                                               06240000
067400*                                                                 06250000
067500*  THIS ROUTINE GETS THE FISCAL WEEK NUMBER FOR THE CURRENT WEEK. 06260000
067600*  THE FISCAL WEEK IS THEN COMPARED TO THE INPUT WEEK.  IF THEY   06270000
067700*  ARE NOT THE SAME, ABEND.                                       06280002
067800*  IF FISCAL WEEK = 53, GO BACK 1 WEEK FOR FISCAL YEAR.           06290002
067900*                                                                 06300000
068200******************************************************************06310000
068300 T000-DATE-ROUTINE.                                               06320000
068400*                                                                 06330000
068500     MOVE ZEROES              TO DPG51-INCR-DECR-DAYS-9.          06340000
068700     MOVE CC-DATE             TO DPG52-LK-DATE-INPUT.             06350000
068800     MOVE PC-F2               TO DPG51-CALENDAR-TYPE.             06360000
068900     SET DPG52-LK-DTE-ISO-FMT TO TRUE.                            06370000
069000     PERFORM E000-CALENDAR-ROUTINE.                               06380000
069100*                                                                 06390000
069200     IF DPG56-FISCAL-WEEK-NBR = WN                                06400000
069300        MOVE ZERO TO PV-DECR-DAYS                                 06410002
069400     ELSE                                                         06420000
069500        IF DPG56-FISCAL-WEEK-NBR = PC-53                          06430000
069600           MOVE PC-DECR-7-DAYS TO PV-DECR-DAYS                    06440002
069700        ELSE                                                      06450000
069800           DISPLAY '** ABEND **'                                  06460000
069900           DISPLAY '** PROGRAM    = MRKUP015'                     06470000
070000           DISPLAY '** PARAGRAPH  = T000-DATE-ROUTINE'            06480000
070100           DISPLAY '** MESSAGE    = '                             06490000
070200                   'FISCAL WEEK AND INPUT WEEK DO NOT MATCH'      06500000
070300           DISPLAY '** FISCAL WK  = ' DPG56-FISCAL-WEEK-NBR       06510000
070400           DISPLAY '** INPUT WN   = ' WN                          06520000
070500           MOVE +4005      TO PV-ABEND-CODE                       06530000
070600           CALL 'ILBOABN0' USING PV-ABEND-CODE                    06540000
070700        END-IF                                                    06550000
070800     END-IF.                                                      06560000
070900*                                                                 06570000
070900*  GET LAST WEEK IF WEEK NUMBER IS 53:                            06580002
070900*                                                                 06590002
           IF PV-DECR-DAYS > 0                                          06600002
071000        INITIALIZE DPG51                                          06610002
071100                   DPG52                                          06620002
071200                   DPG53                                          06630002
071300                   DPG54                                          06640002
071400                   DPG55                                          06650002
071500                   DPG56                                          06660002
071600*                                                                 06670000
071800        MOVE CC-DATE             TO DPG52-LK-DATE-INPUT           06680002
071900        SET DPG52-LK-DTE-ISO-FMT TO TRUE                          06690002
072000        MOVE PC-F2               TO DPG51-CALENDAR-TYPE           06700002
072100        MOVE PV-DECR-DAYS        TO DPG51-INCR-DECR-DAYS-9        06710002
072200        SET DPG51-DECREMENT-DATE TO TRUE                          06720002
072300                                                                  06730000
072400        PERFORM E000-CALENDAR-ROUTINE                             06740002
           END-IF.                                                      06750002
      *                                                                 06760002
072500     MOVE DPG56-FISCAL-YEAR-CCYY TO PV-FISCAL-YEAR-NBR.           06770000
072600*                                                                 06780000
072700     MOVE WN TO PV-WEEK-NBR.                                      06790002
072800*                                                                 06800000
072900     IF PV-WEEK-NBR = 53                                          06810002
073000        MOVE 52 TO PV-WEEK-NBR                                    06820000
073100     END-IF.                                                      06830000
073200*                                                                 06840000
073300 EJECT                                                            06850000
073400******************************************************************06860000
073500*   CLOSES FILES AND DISPLAYS MESSAGES.                          *06870000
073600******************************************************************06880000
073700 Y100-END-ROUTINE.                                                06890000
073800*                                                                 06900000
179903     DISPLAY '***************************************'.           06910003
179904     DISPLAY '*  --- MRKUP015 --- '.                              06920004
179904     DISPLAY '*  TOTAL TMRITST UPDATES: ' PV-UPDATE-CNT.          06930003
179905     DISPLAY '***************************************'.           06940003
073800*                                                                 06950003
073900     CLOSE  IC-SUPP-FILE.                                         06960000
074000     CLOSE  ITEM-STORE-HISTORY.                                   06970000
074100*                                                                 06980000
074200 EJECT                                                            06990000
074300******************************************************************07000000
074400*     DB2 COMMIT TEST                                            *07010000
074500*                                                                *07020000
074600******************************************************************07030000
074700                                                                  07040000
074800 Z900-COMMIT-TEST.                                                07050000
074900*-----------------                                                07060000
075000                                                                  07070000
075100*  GET THE CURRENT TIMESTAMP                                      07080000
075200                                                                  07090000
075300     EXEC SQL                                                     07100000
075400         SET :PV-CURR-TMST = CURRENT TIMESTAMP                    07110000
075500     END-EXEC.                                                    07120000
075600                                                                  07130000
075700     IF SQLCODE = +0                                              07140000
075800         CONTINUE                                                 07150000
075900     ELSE                                                         07160000
076000         DISPLAY 'PARAGRAPH Z900, BAD SET FOR CURRENT TIMESTAMP'  07170000
076100         DISPLAY ' '                                              07180000
076200         PERFORM Z999-SQL-ERROR.                                  07190000
076300                                                                  07200000
076400*  COMPARE TO THE NEXT SCHEDULED COMMIT TIME                      07210000
076500                                                                  07220000
076600     IF PV-CURR-TMST > PV-COMMIT-TMST                             07230000
076700         PERFORM Z910-COMMIT.                                     07240000
076800                                                                  07250000
076900 EJECT                                                            07260000
077000******************************************************************07270000
077100*     DB2 COMMIT PROCESSING                                      *07280000
077200*                                                                *07290000
077300******************************************************************07300000
077400                                                                  07310000
077500 Z910-COMMIT.                                                     07320000
077600*------------                                                     07330000
077700                                                                  07340000
077800*  TAKE COMMIT                                                    07350000
077900                                                                  07360000
078000     EXEC SQL                                                     07370000
078100         COMMIT                                                   07380000
078200     END-EXEC.                                                    07390000
078300                                                                  07400000
078400     IF SQLCODE = +0                                              07410000
078500         CONTINUE                                                 07420000
078600     ELSE                                                         07430000
078700         DISPLAY 'PARAGRAPH Z910, BAD COMMIT'                     07440000
078800         DISPLAY ' '                                              07450000
078900         PERFORM Z999-SQL-ERROR.                                  07460000
079000                                                                  07470000
079100*  GET THE NEXT SCHEDULED COMMIT TIME                             07480000
079200                                                                  07490000
079300     EXEC SQL                                                     07500000
079400         SELECT  (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)    07510000
079500           INTO  :PV-COMMIT-TMST                                  07520000
079600           FROM  TCKRSTCNTL                                       07530000
079700          WHERE  PLAN_NAME = 'MRKUP015'                           07540000
079800     END-EXEC.                                                    07550000
079900                                                                  07560000
080000     IF SQLCODE = +0                                              07570000
080100         CONTINUE                                                 07580000
080200     ELSE                                                         07590000
080300         DISPLAY 'PARAGRAPH Z910, SELECT FOR NEXT TIMESTAMP'      07600000
080400         DISPLAY ' '                                              07610000
080500         PERFORM Z999-SQL-ERROR.                                  07620000
080600                                                                  07630000
080700*                                                                 07640000
080800 Z999-SQL-ERROR.                                                  07650000
080900*---------------                                                  07660000
081000                                                                  07670000
081100     MOVE SQLCODE    TO SQLCODE2.                                 07680000
081200     MOVE SQLERRD(3) TO SQLERRD3.                                 07690000
081300     DISPLAY '** ABEND **       ** = SQLERROR'.                   07700000
081400     DISPLAY '** PROGRAM        ** = MRKUP015'.                   07710000
081500     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  07720000
081600     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  07730000
081700     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   07740000
081800     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  07750000
081900     MOVE +4013 TO PV-ABEND-CODE.                                 07760000
082000     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         07770000
082100*                                                                 07780000
082300******************************************************************07790000
