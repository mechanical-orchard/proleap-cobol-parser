000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    VNKCS022.                                         00040000
000500 AUTHOR.        JOAN PRENGEL.                                     00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  09/26/97.                                         00070000
000800 DATE-COMPILED. 12/97.                                            00080099
000900*----------------------------------------------------------------*00090000
001000*    V022 - VENDOR PAYMENT TERMS MAINTENANCE                     *00100000
001100*                                                                *00110000
001200*    THIS PROGRAM ALLOWS THE USER TO ADD OR UPDATE               *00120000
001300*    A PAYMENT TERM FOR A VENDOR.                                *00130000
001400*                                                                *00140099
001500*    DELETION OF PAYMENT TERMS CAN ONLY BE DONE BY AN ASSIGNED   *00150099
001600*    INFORMATION SYSTEMS PROJECT LEADER.                         *00160099
001601*                                                                 00160199
001602* CHANGE LOG:                                                     00160299
001610*  DATE  09/07/2021                                              *00161099
001620*            - CHANGE CALL OF DPKUT100 TO                       * 00162099
001630*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00163099
001640*              MAKING THE CALL DYNAMIC VS STATIC                * 00164099
001650*      MADE BY: GERMAN BANDA            WR/IR #: CHG0261091      *00165099
001660*                                                               * 00166099
001610*  DATE  01/05/2023                                              *00167099
001620*            - CHANGE CALL OF DPKCS030 TO DYNAMIC               * 00168099
001650*      MADE BY: JEAN KURK               WR/IR #: CHG0277999      *00169299
001660*                                                               * 00169399
001700*----------------------------------------------------------------*00170000
001800                                                                  00180000
001900 ENVIRONMENT DIVISION.                                            00190000
002000                                                                  00200000
002100 DATA DIVISION.                                                   00210000
002200                                                                  00220000
002300 WORKING-STORAGE SECTION.                                         00230000
002400                                                                  00240000
002500 01  DK-DB2-KEYS.                                                 00250043
002600     05  DK-PAYT-TERM-ID              PIC S9(04) VALUE +0         00260046
002700                                                 COMP.            00270046
002800 01  DN-DB2-NULL-INDICATORS.                                      00280099
002900     05  DN-PAY-TERM-ID               PIC S9(04) VALUE +0         00290099
003000                                                  COMP.           00300099
003100     05  DN-DISCOUNT-DAYS-QTY         PIC S9(04) VALUE +0         00310099
003200                                                  COMP.           00320099
003300     05  DN-DISCOUNT-PCT              PIC S9(04) VALUE +0         00330099
003400                                                  COMP.           00340099
003500     05  DN-DUE-DAY-QTY               PIC S9(04) VALUE +0         00350099
003600                                                  COMP.           00360099
003700     05  DN-DUE-DAY-FR-DTE-TXT        PIC S9(04) VALUE +0         00370099
003800                                                  COMP.           00380099
003900     05  DN-OTHER-TXT                 PIC S9(04) VALUE +0         00390099
004000                                                  COMP.           00400099
004100     05  DN-RANKING-NBR               PIC S9(04) VALUE +0         00410099
004200                                                  COMP.           00420099
004300                                                                  00430043
004400 01  PC-PROGRAM-CONSTANTS.                                        00440000
004500     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'VNKCS022'.  00450000
004600     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'VN022A  '.  00460000
004700     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'VNKM022 '.  00470000
004800     05  PC-APPL-MAP              PIC S9(04)  VALUE  +1           00480000
004900                                              COMP.               00490000
005000     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00500000
005100                                              COMP.               00510000
005200     05  PC-ZERO                  PIC 9(01)  VALUE  0.            00520075
005300     05  PC-INTER-APPL-CODES.                                     00530000
005400         10  PC-INTER-APPL-ADD    PIC  X(01)  VALUE '1'.          00540000
005500         10  PC-INTER-APPL-UPDATE PIC  X(01)  VALUE '2'.          00550000
005600     05  PC-FIELDS-POPULATED             PIC X(01).               00560000
005700         88  PC-REGULAR-PAYMENT-TERMS         VALUE '1'.          00570000
005800         88  PC-SPECIAL-PAYMENT-TERMS         VALUE '2'.          00580000
005900         88  PC-CHECK-REG-AND-SPECIAL         VALUE '3'.          00590000
006000                                                                  00600000
006100     05  PC-TSYMSG-NUMBERS.                                       00610000
006200** PRESS F2 TO CONFIRM                                            00620000
006300         10  PC-TSYMSG-00004      PIC  9(05)  VALUE  00004.       00630000
006400** MUST BE NUMERIC                                                00640000
006500         10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       00650000
006600** ADD SUCCESSFUL                                                 00660099
006700         10  PC-TSYMSG-00034      PIC  9(05)  VALUE  00034.       00670000
006800** A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION                 00680000
006900         10  PC-TSYMSG-00057      PIC  9(05)  VALUE  00057.       00690000
007000** UPDATE SUCCESSFUL                                              00700000
007100         10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       00710000
007200** TOP OF LIST                                                    00720000
007300         10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.       00730000
007400** BOTTOM OF LIST                                                 00740000
007500         10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.       00750000
007600** DATA DOES NOT EXIST                                            00760000
007700         10  PC-TSYMSG-00148      PIC  9(05)  VALUE  00148.       00770000
007800** DISCOUNT DAYS IS REQUIRED                                      00780071
007900         10  PC-TSYMSG-01647      PIC  9(05)  VALUE  01647.       00790071
008000** DISCOUNT PERCENT IS REQUIRED                                   00800000
008100         10  PC-TSYMSG-01648      PIC  9(05)  VALUE  01648.       00810071
008200** EITHER SPECIAL TERMS OR OTHER PAYMENT TERMS FIELDS ARE REQUIRED00820000
008300         10  PC-TSYMSG-01649      PIC  9(05)  VALUE  01649.       00830071
008400** CANNOT BE ENTERED BY ITSELF (REFERS TO DUE DAYS FROM DATE TEXT)00840071
008500         10  PC-TSYMSG-01650      PIC  9(05)  VALUE  01650.       00850071
008600*                                                                 00860000
008700     05  PC-QMGR-NAME             PIC X(04)   VALUE SPACES.       00870099
008800         88  PC-PROD-QMGR-NAME                VALUE 'QKSP'.       00880099
008900         88  PC-TEST-QMGR-NAME                VALUE 'QKST'.       00890099
009000         88  PC-QA-QMGR-NAME                  VALUE 'QKSQ'.       00900099
009100     05  PC-QNAME                 PIC X(48)   VALUE               00910099
009200                              'RS.SUPPLIER.PARTNER.LOAD.Q'.       00920099
009300     05  PC-VNKCS025              PIC X(08)   VALUE 'VNKCS025'.   00930099
009400*                                                                 00940000
009500 01  PS-PROGRAM-SWITCHES.                                         00950000
009600     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         00960000
009700         88  PS-ERROR                         VALUE  'Y'.         00970000
009800         88  PS-NO-ERROR                      VALUE  'N'.         00980000
009900     05  PS-ADD-UPDATE-SW         PIC  X(01)  VALUE  'N'.         00990000
010000         88  PS-ADD-UPDATE                    VALUE  'Y'.         01000000
010100         88  PS-UPDATE                        VALUE  'N'.         01010099
010200     05  PS-MQ-FLAG-SW            PIC  X(01)  VALUE  'N'.         01020000
010300         88  MQ-FLAG                          VALUE  'Y'.         01030000
010400         88  NOT-MQ-FLAG                      VALUE  'N'.         01040099
010500                                                                  01050099
010600*                                                                 01060099
010700 01  PV-PROGRAM-VARIABLES.                                        01070099
010800     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            01080099
010900                                              COMP SYNC.          01090099
011000     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            01100099
011100                                              COMP SYNC.          01110099
011200     05  PV-IND-VAR               PIC S9(04)  VALUE +0            01120099
011300                                              COMP SYNC.          01130099
011400     05  PV-OLD-SI-NBR            PIC  9(06).                     01140099
011500** VARIABLE USED TO FORMAT THE PAYMENT TERMS FIELD:               01150099
011600     05  PV-EDIT-PAYT-TERM-ID         PIC ZZ9.                    01160099
011700     05  PV-PAYTRM-DISCOUNT-PCT-N     PIC SV9(4).                 01170099
011800     05  PV-CURRENT-SYSID             PIC X(4)  VALUE SPACES.     01180099
011900     05  PV-CURRENT-NETNAME                                       01190099
012000                                      PIC X(8)  VALUE SPACES.     01200099
012100                                                                  01210099
012200     EJECT                                                        01220099
012300* --------------------------------------------------------------**01230099
012400** THE LAYOUT FOR THE TEMPORARY STORAGE QUEUE CONTAINING        **01240099
012500** SELECTED LIST ITEMS TO BE PROCESSED BY THIS PROGRAM.         **01250099
012600** THIS COPYBOOK WILL BE USED FOR THE EDITING OF THE PAYMENT    **01260099
012700** TERMS COMPILATION FIELD                                      **01270099
012800**--------------------------------------------------------------**01280099
012900     COPY POWS020.                                                01290099
013000                                                                  01300099
013100* --------------------------------------------------------------**01310099
013200** THE LAYOUT FOR THE TEMPORARY STORAGE QUEUE CONTAINING        **01320099
013300** SELECTED LIST ITEMS TO BE PROCESSED BY THIS PROGRAM.         **01330099
013400**--------------------------------------------------------------**01340099
013500     COPY VNWS010.                                                01350099
013600                                                                  01360099
013700 EJECT                                                            01370099
013800                                                                  01380099
013900*----------------------------------------------------------------*01390099
014000*    MAP LAYOUT                                                  *01400099
014100*----------------------------------------------------------------*01410099
014200                                                                  01420099
014300     COPY VNKM022.                                                01430099
014400                                                                  01440099
014500 EJECT                                                            01450099
014600*----------------------------------------------------------------*01460099
014700*    ATTRIBUTE SETTINGS COPYBOOK.                                *01470099
014800*----------------------------------------------------------------*01480099
014900                                                                  01490099
015000     COPY DPWS015.                                                01500099
015100                                                                  01510099
015200*----------------------------------------------------------------*01520099
015300*    FUNCTION KEYS COPYBOOK                                      *01530099
015400*----------------------------------------------------------------*01540099
015500                                                                  01550099
015600     COPY DPWS016.                                                01560099
015700                                                                  01570099
015800 EJECT                                                            01580099
015900**--------------------------------------------------------------**01590099
016000** NUMERIC EDIT LAYOUT (DPKUT100)                               **01600099
016100**--------------------------------------------------------------**01610099
016200     COPY DPWS010I.                                               01620099
016300 EJECT                                                            01630099
016400**--------------------------------------------------------------**01640099
016500** PARAMETERS FOR CALLING CICS ARCHITECTURE API                 **01650099
016600**--------------------------------------------------------------**01660099
016700     COPY DPWS030.                                                01670099
016700     COPY DPWS930.                                                01671099
016800 EJECT                                                            01680099
016900**--------------------------------------------------------------**01690000
017000** PAYMENT TERMS MESSAGE FORMAT LAYOUT                          **01700000
017100**--------------------------------------------------------------**01710099
017200                                                                  01720099
017300 01 VN004-COMMAREA.                                               01730099
017400     COPY VNRD004.                                                01740099
017500 EJECT                                                            01750099
017600**--------------------------------------------------------------**01760099
017700*    STANDARD COMMAREA.                                           01770099
017800**--------------------------------------------------------------**01780099
017900                                                                  01790099
018000     COPY DPWS020.                                                01800099
018100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01810099
018200                                                                  01820099
018300***************************************************************** 01830099
018400*    INTER-APPLICATION COMMAREA.                                  01840099
018500***************************************************************** 01850099
018600                                                                  01860099
018700         10  INTER-APPL-COMM-AREA PIC X(200).                     01870099
018800* --------------------------------------------------------------**01880099
018900** THE INTER-APPLICATION COMMAREA CONTAINING THE ADDRESS &      **01890099
019000** THE NUMBER OF SELECTED ROWS FROM THE LIST                    **01900099
019100**--------------------------------------------------------------**01910099
019200     COPY VNWS011.                                                01920099
019300                                                                  01930099
019400***************************************************************** 01940099
019500*    SPECIFIC COMMMAREA FOR VNKCS022.                             01950099
019600***************************************************************** 01960099
019700         10  ASC-SPECIFIC-COMMAREA.                               01970099
019800             15  ASC-USE-SELECTION-QUEUE-IND                      01980099
019900                                           PIC  X(01).            01990099
020000                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 02000099
020100             15  ASC-INTER-APPL-CODES      PIC  X(01).            02010099
020200                 88  ASC-INTER-APPL-ADD                VALUE '1'. 02020099
020300                 88  ASC-INTER-APPL-UPDATE             VALUE '2'. 02030099
020400                                                                  02040099
020500             15  ASC-SEL-QUEUE-NAME        PIC  X(08).            02050099
020600             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05)  COMP-3.    02060099
020700             15  ASC-NUMBER-OF-SELECTED-ITEMS                     02070099
020800                                           PIC S9(09)  COMP-3.    02080099
020900             15  ASC-SEL-SUB               PIC S9(04)  COMP.      02090099
021000             15  ASC-SEL-ITEM              PIC S9(04)  COMP.      02100099
021100** THE VARIBLES USED FOR THE PAYMENT TERMS                        02110099
021200             15  ASC-PAYTRM-PAY-TERM-ID           PIC 9(04).      02120099
021300             15  ASC-PAYTRM-DISCOUNT-DAYS-QTY     PIC X(03).      02130099
021400             15  ASC-PAYTRM-DISCOUNT-DAYS-QTY-N REDEFINES         02140099
021500                     ASC-PAYTRM-DISCOUNT-DAYS-QTY PIC  9(03).     02150099
021600             15  ASC-PAYTRM-DISCOUNT-PCT          PIC X(5).       02160099
021700             15  ASC-PAYTRM-DISCOUNT-PCT-N        PIC 99V99.      02170099
021800             15  ASC-PAYTRM-DISCOUNT-PCT-D        PIC SV9(4).     02180099
021900             15  ASC-PAYTRM-DUE-DAY-QTY           PIC X(03).      02190099
022000             15  ASC-PAYTRM-DUE-DAY-QTY-N   REDEFINES             02200099
022100                 ASC-PAYTRM-DUE-DAY-QTY           PIC 9(03).      02210099
022200             15  ASC-PAYTRM-OTHER-TXT             PIC X(25).      02220099
022300             15  ASC-PAYTRM-RANKING-NBR           PIC 9(04).      02230099
022400             15  ASC-PAYTRM-DUE-DAY-FR-DTE-TXT    PIC X(17).      02240099
022500             15  ASC-PAYT-TERM-ID-DESC            PIC X(28).      02250099
022600* USE THE FOLLOWING SWITCHES TO DETERMINE WHEN A FIELD IS EMPTY   02260099
022700* OR NOT.                                                         02270099
022800             15  ASC-PS-EMPTY-DISC-DAYS-QTY-SW         PIC X(01). 02280099
022900                   88  ASC-PS-EMPTY-DISC-DAYS-QTY      VALUE  'Y'.02290099
023000                   88  ASC-PS-NOT-EMPTY-DISC-DAYS-QTY  VALUE  'N'.02300099
023100             15  ASC-PS-EMPTY-DISC-PCT-SW              PIC X(01). 02310099
023200                   88  ASC-PS-EMPTY-DISC-PCT           VALUE  'Y'.02320099
023300                   88  ASC-PS-NOT-EMPTY-DISC-PCT       VALUE  'N'.02330099
023400             15  ASC-PS-EMPTY-DUE-DAY-QTY-SW           PIC X(01). 02340099
023500                   88  ASC-PS-EMPTY-DUE-DAY-QTY        VALUE  'Y'.02350099
023600                   88  ASC-PS-NOT-EMPTY-DUE-DAY-QTY    VALUE  'N'.02360099
023700             15  ASC-PS-EMPTY-DUE-DAY-TXT-SW           PIC X(01). 02370099
023800                   88  ASC-PS-EMPTY-DUE-DAY-TXT        VALUE  'Y'.02380099
023900                   88  ASC-PS-NOT-EMPTY-DUE-DAY-TXT    VALUE  'N'.02390099
024000             15  ASC-PS-EMPTY-OTHER-TXT-SW             PIC X(01). 02400099
024100                   88  ASC-PS-EMPTY-OTHER-TXT          VALUE  'Y'.02410099
024200                   88  ASC-PS-NOT-EMPTY-OTHER-TXT      VALUE  'N'.02420099
024300                                                                  02430099
024400             15  ASC-HOLD-PAYTRM-DISCOUNT-PCT-Z        PIC SV9(4).02440099
024500             15  ASC-HOLD-PAYTRM-DISCOUNT-PCT          PIC 99V99. 02450099
024600             15  ASC-HOLD-PAYTRM-DSCNT-DAYS-QTY        PIC 9(3).  02460099
024700             15  ASC-HOLD-PAYTRM-DUE-DAY-QTY           PIC 9(3).  02470099
024800             15  ASC-HOLD-DUE-DAY-FR-DTE-TXT           PIC X(17). 02480099
024900             15  ASC-HOLD-PAYTRM-OTHER-TXT             PIC X(25). 02490099
025000             15  ASC-HOLD-PAYT-TERM-ID-DESC            PIC X(28). 02500099
025100     EJECT                                                        02510099
025200*----------------------------------------------------------------*02520099
025300*    DB2 AREA FOR PAYMENT TERMS                                  *02530099
025400*----------------------------------------------------------------*02540099
025500     EXEC SQL                                                     02550099
025600          INCLUDE TPAYTRM                                         02560099
025700     END-EXEC.                                                    02570099
025800                                                                  02580099
025900*----------------------------------------------------------------*02590099
026000*    ABEND PROCESSING COPYBOOK.                                  *02600099
026100*----------------------------------------------------------------*02610099
026200     COPY DPWS013.                                                02620099
026300                                                                  02630099
026400 EJECT                                                            02640099
026500*----------------------------------------------------------------*02650099
026600*    DB2 AREA FOR COMMUNICATIONS                                 *02660099
026700*----------------------------------------------------------------*02670099
026800     EXEC SQL                                                     02680099
026900          INCLUDE SQLCA                                           02690099
027000     END-EXEC.                                                    02700099
027100                                                                  02710099
027200 EJECT                                                            02720099
027300 LINKAGE SECTION.                                                 02730099
027400                                                                  02740099
027500 01  DFHCOMMAREA.                                                 02750099
027600     05  FILLER                         OCCURS  1 TO 4072 TIMES   02760099
027700                                        DEPENDING ON EIBCALEN.    02770099
027800         10  FILLER                     PIC X.                    02780099
027900                                                                  02790099
028000                                                                  02800099
028100 PROCEDURE DIVISION.                                              02810099
028200***************************************************************** 02820099
028300** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 02830099
028400** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 02840099
028500** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 02850099
028600**                                                             ** 02860099
028700** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 02870099
028800** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 02880099
028900***************************************************************** 02890099
029000 0000-MAIN-MODULE.                                                02900099
029100     INITIALIZE DP030-CICS-API-FIELDS.                            02910099
029200     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02920099
029300     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02930099
029400     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02940099
029500     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02950099
029600     MOVE LENGTH OF VN022AI        TO DP030-MAP-LENGTH (1).       02960099
029700     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02970099
029800     PERFORM 0001-CALL-CICS-ARCH-API.                             02980099
029900*                                                                 02990099
030000     PERFORM 1000-CONTROL-PROCESSING                              03000099
030100*                                                                 03010099
030200     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03020099
030300     PERFORM 0001-CALL-CICS-ARCH-API.                             03030099
030400                                                                  03040099
030500 0001-CALL-CICS-ARCH-API.                                         03050099
030600*    CALL 'DPKCS030' USING DFHEIBLK                               03060099
030600     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03061099
030700                           DFHCOMMAREA                            03070099
030800                           DP030-CICS-API-FIELDS                  03080099
030900                           DP020-STANDARD-COMMAREA                03090099
031000                           VN022AI.                               03100099
031100*                                                                 03110099
031200     IF  DP030-RC-CALL-SUCCESSFUL                                 03120099
031300         CONTINUE                                                 03130099
031400     ELSE                                                         03140099
031500         SET DP013-NO-ROLLBACK                                    03150099
031600             DP013-XCTL-DISPLAY-RESTART                           03160099
031700             DP013-CICS-ABEND      TO TRUE                        03170099
031800         MOVE 'BEFORE 0000-MAIN-MODULE'                           03180099
031900                                   TO DP013-PARAGRAPH             03190099
032000*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX03200099
032100*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      03210099
032000         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03211099
032100-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03212099
032200         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      03220099
032300         PERFORM DP013-0000-PROCESS-ABEND                         03230099
032400     END-IF.                                                      03240099
032500 EJECT                                                            03250099
032600*----------------------------------------------------------------*03260099
032700*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03270099
032800*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *03280099
032900*----------------------------------------------------------------*03290099
033000                                                                  03300099
033100 1000-CONTROL-PROCESSING.                                         03310099
033200                                                                  03320099
033300     SET PS-NO-ERROR TO TRUE.                                     03330099
033400                                                                  03340099
033500     EVALUATE TRUE                                                03350099
033600         WHEN DP020-NEXT-ACT-INITIAL                              03360099
033700             PERFORM 1100-FIND-OBJECT-KEYS                        03370099
033800             IF  PS-ERROR                                         03380099
033900                 CONTINUE                                         03390099
034000             ELSE                                                 03400099
034100                 PERFORM 4000-BUILD-INITIAL-PANEL                 03410099
034200                 PERFORM 3200-RESET-ATTRIBUTES                    03420099
034300             END-IF                                               03430099
034400                                                                  03440099
034500         WHEN DP020-NEXT-ACT-READ-MAP                             03450099
034600             PERFORM 2000-PROCESS-PANEL                           03460099
034700                                                                  03470099
034800         WHEN DP020-NEXT-ACT-RETURN                               03480099
034900              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  03490099
035000              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                03500099
035100                                                                  03510099
035200         WHEN OTHER                                               03520099
035300             SET DP013-LOGIC-ABEND TO TRUE                        03530099
035400             SET DP013-NO-ROLLBACK TO TRUE                        03540099
035500             MOVE '1000-CONTROL-PROCESSING'                       03550099
035600                                   TO DP013-PARAGRAPH             03560099
035700             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   03570099
035800                                   TO DP013-MESSAGE-TEXT(1)       03580099
035900             MOVE DP020-NEXT-APPL-ACTIVITY                        03590099
036000                                   TO DP013-MESSAGE-TEXT(2)       03600099
036100             PERFORM DP013-0000-PROCESS-ABEND                     03610099
036200     END-EVALUATE.                                                03620099
036300******************************************************************03630099
036400** DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE   **03640099
036500** INTER-APPLICATION FORMAT CODE.                               **03650099
036600******************************************************************03660099
036700 1100-FIND-OBJECT-KEYS.                                           03670099
036800     INITIALIZE ASC-SPECIFIC-COMMAREA.                            03680099
036900     EVALUATE DP020-INT-APPL-FORMAT-IND                           03690099
037000         WHEN PC-INTER-APPL-ADD                                   03700099
037100             SET ASC-INTER-APPL-ADD                               03710099
037200                                   TO TRUE                        03720099
037300         WHEN PC-INTER-APPL-UPDATE                                03730099
037400             SET ASC-INTER-APPL-UPDATE                            03740099
037500                                   TO TRUE                        03750099
037600* CHECK THE NUMBER OF SELECTED PAYMENT TERMS ON THE LIST          03760099
037700* RIGHT NOW, JUST HAVE THE TOTAL NUMBER OF SELECTED ROWS,         03770099
037800* WE NEED THE ADDRESS TO ACTUALLY GET THE INFO.                   03780099
037900** FIRST OBTAIN THE VALUES FROM THE INTER-APPL COMMAREA           03790099
038000** THESE VALUES WILL BE USED TO ACCESS INFORMATION FROM THE       03800099
038100** TEMP STORAGE QUEUE IF ROWS WERE SELECTED ON THE LIST           03810099
038200             MOVE VN011-NUMBER-OF-SELECTED-ITEMS                  03820099
038300                                TO ASC-NUMBER-OF-SELECTED-ITEMS   03830099
038400             MOVE VN011-NUMBER-OF-TS-ITEMS                        03840099
038500                                TO ASC-NUMBER-OF-TS-ITEMS         03850099
038600             MOVE VN011-SEL-QUEUE-NAME                            03860099
038700                                TO ASC-SEL-QUEUE-NAME             03870099
038800             IF VN011-NUMBER-OF-SELECTED-ITEMS = ZERO             03880099
038900* THE MESSAGE "A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION"    03890099
039000                 MOVE PC-TSYMSG-00057                             03900099
039100                                   TO DP020-MSG-NUMBER            03910099
039200                 SET DP020-MSG-FATAL                              03920099
039300                                   TO TRUE                        03930099
039400                 SET DP020-NEXT-ACT-APPL-ERROR                    03940099
039500                                   TO TRUE                        03950099
039600                 SET PS-ERROR      TO TRUE                        03960099
039700             ELSE                                                 03970099
039800* A LIST ITEM WAS SELECTED FOR UPDATE                             03980099
039900                 SET ASC-USE-SELECTION-QUEUE                      03990099
040000                                       TO TRUE                    04000099
040100                 MOVE VN011-NUMBER-OF-SELECTED-ITEMS              04010099
040200                            TO ASC-NUMBER-OF-SELECTED-ITEMS       04020099
040300                 MOVE VN011-NUMBER-OF-TS-ITEMS                    04030099
040400                                       TO ASC-NUMBER-OF-TS-ITEMS  04040099
040500                 MOVE VN011-SEL-QUEUE-NAME                        04050099
040600                                       TO ASC-SEL-QUEUE-NAME      04060099
040700                 PERFORM 1120-PREPARE-LIST-ENTRY                  04070099
040800             END-IF                                               04080099
040900                                                                  04090099
041000     END-EVALUATE.                                                04100099
041100                                                                  04110099
041200*----------------------------------------------------------------*04120099
041300* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *04130099
041400* STORAGE QUEUE PASSED FROM THE LIST.                            *04140099
041500*----------------------------------------------------------------*04150099
041600 1120-PREPARE-LIST-ENTRY.                                         04160099
041700     MOVE VN010-MAX-ITEMS          TO ASC-SEL-SUB.                04170099
041800     MOVE ZERO                     TO ASC-SEL-ITEM.               04180099
041900     PERFORM 2110-GET-NEXT-PAYMENT-TERM.                          04190099
042000* SET THE SWITCHES FOR THE FIELDS BASED ON WHAT WAS RETURNED FROM 04200099
042100* THE SELECT STATEMENT.                                           04210099
042200     PERFORM 1200-SET-FIELD-SWITCHES.                             04220099
042300/                                                                 04230099
042400*----------------------------------------------------------------*04240099
042500* SET THE FIELD SWITCHES IN ASC-SPECIFIC-COMMAREA APPROPRIATELY  *04250099
042600* FOR THE INITIAL OPENING OF THE SCREEN & WHEN A NEXT SELECTION  *04260099
042700* PAYMENT TERM IS RETRIEVED FROM THE SELECTION QUEUE. (UPDATE)   *04270099
042800*----------------------------------------------------------------*04280099
042900 1200-SET-FIELD-SWITCHES.                                         04290099
043000     IF  ASC-INTER-APPL-ADD                                       04300099
043100        SET  ASC-PS-EMPTY-DISC-DAYS-QTY TO TRUE                   04310099
043200        SET  ASC-PS-EMPTY-DISC-PCT      TO TRUE                   04320099
043300        SET  ASC-PS-EMPTY-DUE-DAY-QTY   TO TRUE                   04330099
043400        SET  ASC-PS-EMPTY-DUE-DAY-TXT   TO TRUE                   04340099
043500        SET  ASC-PS-EMPTY-OTHER-TXT     TO TRUE                   04350099
043600     END-IF.                                                      04360099
043700                                                                  04370099
043800     IF  ASC-INTER-APPL-UPDATE                                    04380099
043900*        DISCOUNT DAYS QUANTITY                                   04390099
044000         IF ASC-PAYTRM-DISCOUNT-DAYS-QTY-N EQUAL ZERO             04400099
044100            SET  ASC-PS-EMPTY-DISC-DAYS-QTY TO TRUE               04410099
044200         ELSE                                                     04420099
044300            SET  ASC-PS-NOT-EMPTY-DISC-DAYS-QTY TO TRUE           04430099
044400         END-IF                                                   04440099
044500*        DISCOUNT PERCENT                                         04450099
044600         IF ASC-PAYTRM-DISCOUNT-PCT-N EQUAL ZERO                  04460099
044700           SET  ASC-PS-EMPTY-DISC-PCT      TO TRUE                04470099
044800         ELSE                                                     04480099
044900           SET  ASC-PS-NOT-EMPTY-DISC-PCT      TO TRUE            04490099
045000         END-IF                                                   04500099
045100*        DUE DAY QUANTITY                                         04510099
045200         IF ASC-PAYTRM-DUE-DAY-QTY-N  EQUAL ZERO                  04520099
045300            SET  ASC-PS-EMPTY-DUE-DAY-QTY   TO TRUE               04530099
045400         ELSE                                                     04540099
045500            SET  ASC-PS-NOT-EMPTY-DUE-DAY-QTY   TO TRUE           04550099
045600         END-IF                                                   04560099
045700*        DUE DAY FROM DATE TEXT                                   04570099
045800         IF ASC-PAYTRM-DUE-DAY-FR-DTE-TXT  EQUAL SPACES           04580099
045900            SET  ASC-PS-EMPTY-DUE-DAY-TXT   TO TRUE               04590099
046000         ELSE                                                     04600099
046100            SET  ASC-PS-NOT-EMPTY-DUE-DAY-TXT   TO TRUE           04610099
046200         END-IF                                                   04620099
046300*        SPECIAL TERMS                                            04630099
046400         IF ASC-PAYTRM-OTHER-TXT      EQUAL SPACES                04640099
046500            SET  ASC-PS-EMPTY-OTHER-TXT     TO TRUE               04650099
046600         ELSE                                                     04660099
046700            SET  ASC-PS-NOT-EMPTY-OTHER-TXT     TO TRUE           04670099
046800         END-IF                                                   04680099
046900     END-IF.                                                      04690099
047000/                                                                 04700099
047100*----------------------------------------------------------------*04710099
047200* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04720099
047300* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04730099
047400* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04740099
047500* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04750099
047600* FUNCTION KEYS CAN GET THIS FAR.                                *04760099
047700*----------------------------------------------------------------*04770099
047800                                                                  04780099
047900 2000-PROCESS-PANEL.                                              04790099
048000                                                                  04800099
048100     EVALUATE TRUE                                                04810099
048200                                                                  04820099
048300         WHEN DP020-SRC-AID = DP016-CLEAR                         04830099
048400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04840099
048500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04850099
048600                                                                  04860099
048700         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     04870099
048800             SET DP030-DONT-ERASE                                 04880099
048900                 DP030-SEND-DATAONLY (PC-APPL-MAP)                04890099
049000                                   TO TRUE                        04900099
049100             PERFORM 4000-BUILD-INITIAL-PANEL                     04910099
049200             PERFORM 3200-RESET-ATTRIBUTES                        04920099
049300                                                                  04930099
049400         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             04940099
049500             IF  ASC-USE-SELECTION-QUEUE                          04950099
049600                 PERFORM 2110-GET-NEXT-PAYMENT-TERM               04960099
049700                 PERFORM 4000-BUILD-INITIAL-PANEL                 04970099
049800                 PERFORM 3200-RESET-ATTRIBUTES                    04980099
049900             ELSE                                                 04990099
050000*                --- BOTTOM OF LIST ---                           05000099
050100                 MOVE PC-TSYMSG-00070                             05010099
050200                                   TO DP020-MSG-NUMBER            05020099
050300                 SET DP020-MSG-INFORMATIONAL                      05030099
050400                                   TO TRUE                        05040099
050500             END-IF                                               05050099
050600                                                                  05060099
050700         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             05070099
050800             IF  ASC-USE-SELECTION-QUEUE                          05080099
050900                 PERFORM 2120-GET-PREV-PAYMENT-TERM               05090099
051000                 PERFORM 4000-BUILD-INITIAL-PANEL                 05100099
051100                 PERFORM 3200-RESET-ATTRIBUTES                    05110099
051200             ELSE                                                 05120099
051300*                --- TOP OF LIST ---                              05130099
051400                 MOVE PC-TSYMSG-00069                             05140099
051500                                   TO DP020-MSG-NUMBER            05150099
051600                 SET DP020-MSG-INFORMATIONAL                      05160099
051700                                   TO TRUE                        05170099
051800             END-IF                                               05180099
051900                                                                  05190099
052000         WHEN OTHER                                               05200099
052100             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05210099
052200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05220099
052300             IF  PS-NO-ERROR                                      05230099
052400*                ONLY POPULATE THE PAYMENT TERM FIELD             05240099
052500*                IF THERE IS NO ERROR.                            05250099
052600                 PERFORM 4300-POPULATE-PAYTRM-FIELDS              05260099
052700*                POPULATE THE PAYMENT TERM                        05270099
052800*                DESCRIPTION FIELD (COMPILATION)                  05280099
052900                 PERFORM 3170-FORMAT-PAYMENT-TERM-DESC            05290099
053000                 SET DP030-CONTINUE-GO                            05300099
053100                                   TO TRUE                        05310099
053200                 PERFORM 2100-CHECK-FUNCTION-KEY                  05320099
053300             ELSE                                                 05330099
053400                 SET DP030-OVERRIDE-GO                            05340099
053500                                   TO TRUE                        05350099
053600             END-IF                                               05360099
053700     END-EVALUATE.                                                05370099
053800*----------------------------------------------------------------*05380099
053900* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *05390099
054000* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *05400099
054100* FROM THE CICS ARCHITECTURE API.                                *05410099
054200*----------------------------------------------------------------*05420099
054300                                                                  05430099
054400 2100-CHECK-FUNCTION-KEY.                                         05440099
054500     EVALUATE TRUE                                                05450099
054600         WHEN DP020-SRC-AID = DP016-ENTER                         05460099
054700             CONTINUE                                             05470099
054800         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              05480099
054900** ADD A PAYMENT TERM FUNCTION KEY WAS CHOSEN                     05490099
055000             SET DP030-CONTINUE-GO TO TRUE                        05500099
055100             PERFORM 5000-ADD-PAYMENT-TERM                        05510099
055200*            --- ADD SUCCESSFUL ---                               05520099
055300             MOVE PC-TSYMSG-00034  TO DP020-MSG-NUMBER            05530099
055400             SET DP020-MSG-INFORMATIONAL                          05540099
055500                                   TO TRUE                        05550099
055600             SET DP030-ERASE-UNPROT                               05560099
055700                                   TO TRUE                        05570099
055800             PERFORM 4000-BUILD-INITIAL-PANEL                     05580099
055900                                                                  05590099
056000         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              05600099
056100** UPDATE A PAYMENT TERM FUNCTION KEY WAS CHOSEN                  05610099
056200             SET DP030-CONTINUE-GO TO TRUE                        05620099
056300             PERFORM 6000-UPDATE-PAYMENT-TERM                     05630099
056400             IF NOT PS-ADD-UPDATE                                 05640099
056500*                --- UPDATES SUCCESSFUL ---                       05650099
056600                 MOVE PC-TSYMSG-00059                             05660099
056700                                   TO DP020-MSG-NUMBER            05670099
056800                 SET DP020-MSG-INFORMATIONAL                      05680099
056900                                   TO TRUE                        05690099
057000             END-IF                                               05700099
057100                                                                  05710099
057200         WHEN OTHER                                               05720099
057300             SET DP013-NO-ROLLBACK                                05730099
057400                 DP013-XCTL-DISPLAY-RESTART                       05740099
057500                 DP013-CICS-ABEND  TO TRUE                        05750099
057600             MOVE '2100-CHECK-FUNCTION-KEY'                       05760099
057700                                   TO DP013-PARAGRAPH             05770099
057800             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      05780099
057900                                   TO DP013-MESSAGE-TEXT (1)      05790099
058000             PERFORM DP013-0000-PROCESS-ABEND                     05800099
058100     END-EVALUATE.                                                05810099
058200                                                                  05820099
058300******************************************************************05830099
058400** GET THE PAYMENT TERM INFORMATION FOR THE NEXT SELECTED       **05840099
058500** OBJECT FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.          **05850099
058600******************************************************************05860099
058700 2110-GET-NEXT-PAYMENT-TERM.                                      05870099
058800     ADD +1                        TO ASC-SEL-SUB.                05880099
058900     IF  ASC-SEL-SUB > VN010-MAX-ITEMS                            05890099
059000         ADD +1                    TO ASC-SEL-ITEM                05900099
059100         MOVE +1                   TO ASC-SEL-SUB                 05910099
059200     END-IF.                                                      05920099
059300** ASC-NUMBER-OF-TS-ITEMS IS THE FIELD I SHOULD BE COMPARING TOO, 05930099
059400** HOWEVER, ASC-NUMBER-OF-SELECTED-ITEMS SEEMS TO BE THE FIELD    05940099
059500** THAT CONTAINS THE CORRECT NUMBER OF TOTAL SELECTED ITEMS.      05950099
059600     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                05960099
059700         PERFORM 9100-READ-SEL-QUEUE                              05970099
059800         IF  VN010-PAY-TERM-ID (ASC-SEL-SUB) > ZERO               05980099
059900             MOVE VN010-PAY-TERM-ID (ASC-SEL-SUB)                 05990099
060000                                  TO ASC-PAYTRM-PAY-TERM-ID       06000099
060100             MOVE VN010-PAYT-TERM-ID-DESC (ASC-SEL-SUB)           06010099
060200                                  TO ASC-PAYT-TERM-ID-DESC        06020099
060300             SET VN010-INQ (ASC-SEL-SUB)                          06030099
060400                                   TO TRUE                        06040099
060500** PERFORM A SELECT STATEMENT TO RETRIEVE ALL THE PAYMENT TERM INF06050099
060600             PERFORM 2150-GET-TPAYTRM                             06060099
060700             PERFORM 9200-REWRITE-LIST-QUEUE                      06070099
060800         ELSE                                                     06080099
060900             SUBTRACT +1 FROM ASC-SEL-SUB                         06090099
061000*            --- BOTTOM OF LIST ---                               06100099
061100             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06110099
061200             SET DP020-MSG-INFORMATIONAL                          06120099
061300                                   TO TRUE                        06130099
061400         END-IF                                                   06140099
061500     ELSE                                                         06150099
061600         SUBTRACT +1 FROM ASC-SEL-ITEM                            06160099
061700         MOVE VN010-MAX-ITEMS      TO ASC-SEL-SUB                 06170099
061800** BOTTOM OF LIST                                                 06180099
061900         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06190099
062000         SET DP020-MSG-INFORMATIONAL                              06200099
062100                                   TO TRUE                        06210099
062200     END-IF.                                                      06220099
062300******************************************************************06230099
062400** GET THE PAYMENT TERM  OF THE PREVIOUS SELECTED OBJECT        **06240099
062500** OBJECT FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.          **06250099
062600******************************************************************06260099
062700 2120-GET-PREV-PAYMENT-TERM.                                      06270099
062800     SUBTRACT +1 FROM ASC-SEL-SUB.                                06280099
062900     IF  ASC-SEL-SUB < +1                                         06290099
063000         SUBTRACT +1 FROM ASC-SEL-ITEM                            06300099
063100         MOVE VN010-MAX-ITEMS      TO ASC-SEL-SUB                 06310099
063200     END-IF.                                                      06320099
063300*                                                                 06330099
063400     IF  ASC-SEL-ITEM > ZERO                                      06340099
063500         PERFORM 9100-READ-SEL-QUEUE                              06350099
063600         IF  VN010-PAY-TERM-ID (ASC-SEL-SUB) > ZERO               06360099
063700             MOVE VN010-PAY-TERM-ID (ASC-SEL-SUB)                 06370099
063800                                  TO ASC-PAYTRM-PAY-TERM-ID       06380099
063900             MOVE VN010-PAYT-TERM-ID-DESC (ASC-SEL-SUB)           06390099
064000                                  TO ASC-PAYT-TERM-ID-DESC        06400099
064100** THIS MAY NOT ALWAYS BE TRUE, IT COULD BE UPDATED, ETC.         06410099
064200             SET VN010-INQ (ASC-SEL-SUB)                          06420099
064300                                   TO TRUE                        06430099
064400** PERFORM A SELECT STATEMENT TO RETRIEVE ALL THE PAYMENT TERM INF06440099
064500             PERFORM 2150-GET-TPAYTRM                             06450099
064600         END-IF                                                   06460099
064700     ELSE                                                         06470099
064800         MOVE +1                   TO ASC-SEL-ITEM                06480099
064900                                      ASC-SEL-SUB                 06490099
065000*        --- TOP OF LIST ---                                      06500099
065100         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06510099
065200         SET DP020-MSG-INFORMATIONAL                              06520099
065300                                   TO TRUE                        06530099
065400     END-IF.                                                      06540099
065500 EJECT                                                            06550099
065600                                                                  06560099
065700*----------------------------------------------------------------*06570099
065800*  OBTAIN THE PAYMENT TERM INFORMATION                            06580099
065900*----------------------------------------------------------------*06590099
066000 2150-GET-TPAYTRM.                                                06600099
066100                                                                  06610099
066200     MOVE ASC-PAYTRM-PAY-TERM-ID TO DK-PAYT-TERM-ID.              06620099
066300     PERFORM                                                      06630099
066400         WITH TEST AFTER                                          06640099
066500         VARYING PV-RETRY-COUNTER                                 06650099
066600         FROM 1 BY 1                                              06660099
066700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06670099
066800                   OR (SQLCODE = ZERO))                           06680099
066900         EXEC SQL                                                 06690099
067000             SELECT PAY_TERM_ID                                   06700099
067100                   ,DISCOUNT_DAYS_QTY                             06710099
067200                   ,DISCOUNT_PCT                                  06720099
067300                   ,DUE_DAY_QTY                                   06730099
067400                   ,OTHER_TXT                                     06740099
067500                   ,RANKING_NBR                                   06750099
067600                   ,DUE_DAY_FR_DTE_TXT                            06760099
067700             INTO :PAYTRM-PAY-TERM-ID                             06770099
067800                         :DN-PAY-TERM-ID                          06780099
067900                 ,:PAYTRM-DISCOUNT-DAYS-QTY                       06790099
068000                         :DN-DISCOUNT-DAYS-QTY                    06800099
068100                 ,:PAYTRM-DISCOUNT-PCT                            06810099
068200                         :DN-DISCOUNT-PCT                         06820099
068300                 ,:PAYTRM-DUE-DAY-QTY                             06830099
068400                         :DN-DUE-DAY-QTY                          06840099
068500                 ,:PAYTRM-OTHER-TXT                               06850099
068600                         :DN-OTHER-TXT                            06860099
068700                 ,:PAYTRM-RANKING-NBR                             06870099
068800                         :DN-RANKING-NBR                          06880099
068900                 ,:PAYTRM-DUE-DAY-FR-DTE-TXT                      06890099
069000                         :DN-DUE-DAY-FR-DTE-TXT                   06900099
069100             FROM TPAYTRM                                         06910099
069200             WHERE PAY_TERM_ID = :DK-PAYT-TERM-ID                 06920099
069300         END-EXEC                                                 06930099
069400                                                                  06940099
069500         EVALUATE TRUE                                            06950099
069600             WHEN SQLCODE = ZERO                                  06960099
069700                  MOVE PAYTRM-PAY-TERM-ID  TO                     06970099
069800                         ASC-PAYTRM-PAY-TERM-ID                   06980099
069900                  MOVE PAYTRM-DISCOUNT-DAYS-QTY  TO               06990099
070000                         ASC-PAYTRM-DISCOUNT-DAYS-QTY-N           07000099
070100                         ASC-HOLD-PAYTRM-DSCNT-DAYS-QTY           07010099
070200                  IF  DN-DISCOUNT-PCT = -1                        07020099
070300                      MOVE ZEROES  TO ASC-PAYTRM-DISCOUNT-PCT-N   07030099
070400                                   ASC-HOLD-PAYTRM-DISCOUNT-PCT-Z 07040099
070500                      MOVE SPACES  TO ASC-PAYTRM-DISCOUNT-PCT     07050099
070600                  ELSE                                            07060099
070700                      COMPUTE ASC-PAYTRM-DISCOUNT-PCT-N =         07070099
070800                              PAYTRM-DISCOUNT-PCT * 100           07080099
070900                      MOVE PAYTRM-DISCOUNT-PCT TO                 07090099
071000                           ASC-HOLD-PAYTRM-DISCOUNT-PCT-Z         07100099
071100*                 MOVE THE PERCENT TO THE SCREEN IN ORDER TO SET  07110099
071200*                 THE ASC- FIELD CORRECTLY & PREVENT PROBLEMS     07120099
071300                      MOVE ASC-PAYTRM-DISCOUNT-PCT-N TO ADSCPCTO  07130099
071400                      MOVE ADSCPCTO TO ASC-PAYTRM-DISCOUNT-PCT    07140099
071500                  END-IF                                          07150099
071600                  MOVE PAYTRM-DUE-DAY-QTY        TO               07160099
071700                         ASC-PAYTRM-DUE-DAY-QTY-N                 07170099
071800                         ASC-HOLD-PAYTRM-DUE-DAY-QTY              07180099
071900                  MOVE PAYTRM-OTHER-TXT          TO               07190099
072000                         ASC-PAYTRM-OTHER-TXT                     07200099
072100                         ASC-HOLD-PAYTRM-OTHER-TXT                07210099
072200                  MOVE PAYTRM-RANKING-NBR        TO               07220099
072300                         ASC-PAYTRM-RANKING-NBR                   07230099
072400                  MOVE PAYTRM-DUE-DAY-FR-DTE-TXT TO               07240099
072500                         ASC-PAYTRM-DUE-DAY-FR-DTE-TXT            07250099
072600                         ASC-HOLD-DUE-DAY-FR-DTE-TXT              07260099
072700                                                                  07270099
072800             WHEN SQLCODE = -904                                  07280099
072900             WHEN SQLCODE = -913                                  07290099
073000                 CONTINUE                                         07300099
073100             WHEN SQLWARN0 NOT = SPACES                           07310099
073200             WHEN SQLCODE < ZERO                                  07320099
073300             WHEN SQLCODE > ZERO                                  07330099
073400                 MOVE '2150-GET-TPAYTRM'                          07340099
073500                                   TO DP013-PARAGRAPH             07350099
073600                 MOVE 'UNSUCCESSFUL SELECT PAYMENT TERMS  '       07360099
073700                                   TO DP013-MESSAGE-TEXT(1)       07370099
073800                 MOVE SQLCA        TO DP013-SQLCA                 07380099
073900                 MOVE 'TPAYTRM'    TO DP013-DB2-TABLE-NAME (1)    07390099
074000                 SET DP013-DB2-ABEND                              07400099
074100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           07410099
074200                 PERFORM DP013-0000-PROCESS-ABEND                 07420099
074300         END-EVALUATE                                             07430099
074400     END-PERFORM.                                                 07440099
074500*                                                                 07450099
074600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07460099
074700         MOVE '2150-GET-TPAYTRM'                                  07470099
074800                                   TO DP013-PARAGRAPH             07480099
074900         MOVE 'MAXIMUM RETRIES EXCEEDED ON SELECT PAYMENT TERMS'  07490099
075000                                   TO DP013-MESSAGE-TEXT (1)      07500099
075100         MOVE SQLCA                TO DP013-SQLCA                 07510099
075200         MOVE 'TPAYTRM'            TO DP013-DB2-TABLE-NAME (1)    07520099
075300         SET DP013-DB2-ABEND                                      07530099
075400             DP013-XCTL-DISPLAY-RESTART                           07540099
075500                                   TO TRUE                        07550099
075600         PERFORM DP013-0000-PROCESS-ABEND                         07560099
075700     END-IF.                                                      07570099
075800                                                                  07580099
075900 EJECT                                                            07590099
076000*----------------------------------------------------------------*07600099
076100* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS   *07610099
076200* IN THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN   *07620099
076300* THE APPLICATION-SPECIFIC COMMAERA, NOT ON THE SCREEN.          *07630099
076400*----------------------------------------------------------------*07640099
076500                                                                  07650099
076600 2200-MOVE-SCREEN-TO-COMMAREA.                                    07660099
076700*    DISCOUNT DAYS                                                07670099
076800     IF ADSCDYSL > ZERO                                           07680099
076900            MOVE ADSCDYSI       TO ASC-PAYTRM-DISCOUNT-DAYS-QTY   07690099
077000            SET ASC-PS-NOT-EMPTY-DISC-DAYS-QTY TO TRUE            07700099
077100     ELSE                                                         07710099
077200         IF ADSCDYSF = DP015-ERASE-EOF                            07720099
077300             MOVE ZERO          TO ASC-PAYTRM-DISCOUNT-DAYS-QTY   07730099
077400             SET ASC-PS-EMPTY-DISC-DAYS-QTY TO TRUE               07740099
077500         END-IF                                                   07750099
077600     END-IF.                                                      07760099
077700                                                                  07770099
077800*    DISCOUNT PERCENT                                             07780099
077900     IF ADSCPCTL > ZERO                                           07790099
078000            MOVE ADSCPCTI          TO ASC-PAYTRM-DISCOUNT-PCT     07800099
078100            MOVE ADSCPCTI          TO ASC-PAYTRM-DISCOUNT-PCT-N   07810099
078200            SET ASC-PS-NOT-EMPTY-DISC-PCT TO TRUE                 07820099
078300     ELSE                                                         07830099
078400         IF ADSCPCTF = DP015-ERASE-EOF                            07840099
078500             MOVE SPACES           TO ASC-PAYTRM-DISCOUNT-PCT     07850099
078600             MOVE ZERO             TO ASC-PAYTRM-DISCOUNT-PCT-N   07860099
078700             SET ASC-PS-EMPTY-DISC-PCT TO TRUE                    07870099
078800         END-IF                                                   07880099
078900     END-IF.                                                      07890099
079000                                                                  07900099
079100*    NET DUE DAYS                                                 07910099
079200     IF ANTDDYSL > ZERO                                           07920099
079300            MOVE ANTDDYSI          TO ASC-PAYTRM-DUE-DAY-QTY      07930099
079400            SET ASC-PS-NOT-EMPTY-DUE-DAY-QTY TO TRUE              07940099
079500     ELSE                                                         07950099
079600         IF ANTDDYSF = DP015-ERASE-EOF                            07960099
079700             MOVE SPACES           TO ASC-PAYTRM-DUE-DAY-QTY      07970099
079800             MOVE ZERO             TO ASC-PAYTRM-DUE-DAY-QTY-N    07980099
079900             SET ASC-PS-EMPTY-DUE-DAY-QTY TO TRUE                 07990099
080000         END-IF                                                   08000099
080100     END-IF.                                                      08010099
080200                                                                  08020099
080300*    DUE DAYS FROM DATE TEXT                                      08030099
080400     IF ADYSTXTL > ZERO                                           08040099
080500*    WHEN A USER SPACES OUT A FIELD, THE LENGTH ATTRIBUTE WILL    08050099
080600*    BE GREATER THAN ZERO, THEREFORE CHECK THE VALUE OF THE FIELD 08060099
080700        IF ADYSTXTI NOT EQUAL SPACES                              08070099
080800            MOVE ADYSTXTI      TO ASC-PAYTRM-DUE-DAY-FR-DTE-TXT   08080099
080900            SET ASC-PS-NOT-EMPTY-DUE-DAY-TXT TO TRUE              08090099
081000        ELSE                                                      08100099
081100             MOVE SPACE          TO ASC-PAYTRM-DUE-DAY-FR-DTE-TXT 08110099
081200             SET ASC-PS-EMPTY-DUE-DAY-TXT TO TRUE                 08120099
081300        END-IF                                                    08130099
081400     ELSE                                                         08140099
081500         IF ADYSTXTF = DP015-ERASE-EOF                            08150099
081600             MOVE SPACE          TO ASC-PAYTRM-DUE-DAY-FR-DTE-TXT 08160099
081700             SET ASC-PS-EMPTY-DUE-DAY-TXT TO TRUE                 08170099
081800         END-IF                                                   08180099
081900     END-IF.                                                      08190099
082000                                                                  08200099
082100*    SPECIAL TERMS                                                08210099
082200     IF ASPCTRML > ZERO                                           08220099
082300*    WHEN A USER SPACES OUT A FIELD, THE LENGTH ATTRIBUTE WILL    08230099
082400*    BE GREATER THAN ZERO, THEREFORE CHECK THE VALUE OF THE FIELD 08240099
082500        IF ASPCTRMI NOT EQUAL SPACES                              08250099
082600            MOVE ASPCTRMI          TO ASC-PAYTRM-OTHER-TXT        08260099
082700            SET ASC-PS-NOT-EMPTY-OTHER-TXT TO TRUE                08270099
082800        ELSE                                                      08280099
082900             MOVE SPACE            TO ASC-PAYTRM-OTHER-TXT        08290099
083000             SET ASC-PS-EMPTY-OTHER-TXT TO TRUE                   08300099
083100        END-IF                                                    08310099
083200     ELSE                                                         08320099
083300         IF ASPCTRMF = DP015-ERASE-EOF                            08330099
083400             MOVE SPACE            TO ASC-PAYTRM-OTHER-TXT        08340099
083500             SET ASC-PS-EMPTY-OTHER-TXT TO TRUE                   08350099
083600         END-IF                                                   08360099
083700     END-IF.                                                      08370099
083800                                                                  08380099
083900 EJECT                                                            08390099
084000*----------------------------------------------------------------*08400099
084100* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *08410099
084200* IS FOUND, THE CURSOR IS POSITIONED AT THAT FIELD AND AN        *08420099
084300* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *08430099
084400*----------------------------------------------------------------*08440099
084500                                                                  08450099
084600 3000-EDIT-DATA-IN-COMMAREA.                                      08460099
084700                                                                  08470099
084800** DETERMINE WHICH FIELDS HAVE BEEN POPULATED                     08480099
084900     IF (ASC-PS-NOT-EMPTY-DISC-DAYS-QTY                           08490099
085000        OR ASC-PS-NOT-EMPTY-DISC-PCT                              08500099
085100        OR ASC-PS-NOT-EMPTY-DUE-DAY-QTY                           08510099
085200        OR ASC-PS-NOT-EMPTY-DUE-DAY-TXT)                          08520099
085300        AND ASC-PS-EMPTY-OTHER-TXT                                08530099
085400** THE REGULAR PAYMENT TERMS FIELDS ARE POPULATED:                08540099
085500          SET PC-REGULAR-PAYMENT-TERMS TO TRUE                    08550099
085600     ELSE IF (ASC-PS-NOT-EMPTY-OTHER-TXT)                         08560099
085700          AND  (ASC-PS-EMPTY-DISC-DAYS-QTY                        08570099
085800          AND   ASC-PS-EMPTY-DISC-PCT                             08580099
085900          AND   ASC-PS-EMPTY-DUE-DAY-QTY                          08590099
086000          AND   ASC-PS-EMPTY-DUE-DAY-TXT)                         08600099
086100** THE SPECIAL TERMS FIELD IS POPULATED:                          08610099
086200           SET PC-SPECIAL-PAYMENT-TERMS TO TRUE                   08620099
086300     ELSE                                                         08630099
086400** BOTH OR NONE OF THE FIELDS ARE POPULATED (SHOULDN'T HAPPEN)    08640099
086500** MAKE EVERYTHING GREEN AND UNPROTECTED:                         08650099
086600        SET PC-CHECK-REG-AND-SPECIAL    TO TRUE                   08660099
086700     END-IF.                                                      08670099
086800                                                                  08680099
086900     PERFORM 3200-RESET-ATTRIBUTES.                               08690099
087000     PERFORM 3010-VALIDATE-NUMERIC-FIELDS.                        08700099
087100     PERFORM 3020-VALIDATE-BUSINESS-LOGIC.                        08710099
087200                                                                  08720099
087300*  DEFAULT THE CURSOR LOCATION TO DISCOUNT DAYS                   08730099
087400     IF  PS-NO-ERROR                                              08740099
087500             MOVE -1               TO ADSCDYSL                    08750099
087600             SET DP030-SET-CURSOR-APPL-1                          08760099
087700                                   TO TRUE                        08770099
087800     END-IF.                                                      08780099
087900                                                                  08790099
088000*----------------------------------------------------------------*08800099
088100* PERFORM NUMERIC FIELD CHECKING AND FORMATTING OF NUMERIC FIELDS*08810099
088200*    DISCOUNT DAYS                                               *08820099
088300*    DISCOUNT PERCENT                                            *08830099
088400*    NET DUE DAYS                                                *08840099
088500* IF AN ERROR IS FOUND, THE CURSOR IS POSITIONED AT THAT         *08850099
088600* FIELD AND AN APPROPRIATE ERROR MESSAGE IS DISPLAYED.           *08860099
088700*----------------------------------------------------------------*08870099
088800 3010-VALIDATE-NUMERIC-FIELDS.                                    08880099
088900                                                                  08890099
089000*    DISCOUNT DAYS                                                08900099
089100        IF  ASC-PAYTRM-DISCOUNT-DAYS-QTY > SPACES                 08910099
089200            MOVE ASC-PAYTRM-DISCOUNT-DAYS-QTY                     08920099
089300                                      TO DP010I-UNEDITED-FIELD    08930099
089400            MOVE LENGTH OF ASC-PAYTRM-DISCOUNT-DAYS-QTY           08940099
089500                                      TO DP010I-MAXIMUM-DIGITS    08950099
089600            MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS  08960099
089700            SET DP010I-NEGATIVE-NOT-ALLOWED                       08970099
089800                                      TO TRUE                     08980099
089910            CALL DP010I-NUMERIC-EDIT-ROUTINE                      08991099
089920                         USING DP010I-NUMERIC-EDIT-AREA           08992099
090000            IF  DP010I-ERROR-DETECTED                             09000099
090100                SET PS-ERROR                                      09010099
090200                   DP020-MSG-FATAL   TO TRUE                      09020099
090300                MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER         09030099
090400                MOVE DP015-UNP-ALP-BRT-OFF                        09040099
090500                                      TO ADSCDYSA                 09050099
090600                MOVE DP015-RED        TO ADSCDYSC                 09060099
090700                MOVE DP015-REVERSE    TO ADSCDYSH                 09070099
090800                MOVE -1               TO ADSCDYSL                 09080099
090900                SET DP030-SET-CURSOR-APPL-1                       09090099
091000                                      TO TRUE                     09100099
091100            ELSE                                                  09110099
091200                MOVE DP010I-NUMERIC-FIELD                         09120099
091300                                TO ASC-PAYTRM-DISCOUNT-DAYS-QTY-N 09130099
091400                IF ASC-PAYTRM-DISCOUNT-DAYS-QTY-N > 0             09140099
091500                   CONTINUE                                       09150099
091600                ELSE                                              09160099
091700                   MOVE ZEROES TO ASC-PAYTRM-DISCOUNT-DAYS-QTY-N  09170099
091800                   SET ASC-PS-EMPTY-DISC-DAYS-QTY TO TRUE         09180099
091900                END-IF                                            09190099
092000                MOVE ASC-PAYTRM-DISCOUNT-DAYS-QTY                 09200099
092100                                TO ADSCDYSO                       09210099
092200            END-IF                                                09220099
092300* THIS FIELD WAS SPACED OUT, MOVE ZEROES TO THE NUMERIC VALUE &   09230099
092400* SET THE EMPTY FIELD INDICATOR TO TRUE                           09240099
092500        ELSE                                                      09250099
092600            IF ASC-PAYTRM-DISCOUNT-DAYS-QTY = SPACES              09260099
092700               MOVE ZEROES TO ASC-PAYTRM-DISCOUNT-DAYS-QTY-N      09270099
092800              SET ASC-PS-EMPTY-DISC-DAYS-QTY TO TRUE              09280099
092900            END-IF                                                09290099
093000                                                                  09300099
093100        END-IF.                                                   09310099
093200                                                                  09320099
093300*    DISCOUNT PERCENT                                             09330099
093400        IF  ASC-PAYTRM-DISCOUNT-PCT > SPACES                      09340099
093500            MOVE ASC-PAYTRM-DISCOUNT-PCT  TO DP010I-UNEDITED-FIELD09350099
093600            MOVE 2                        TO DP010I-MAXIMUM-DIGITS09360099
093700            MOVE 2                      TO DP010I-MAXIMUM-DECIMALS09370099
093800            SET DP010I-NEGATIVE-NOT-ALLOWED                       09380099
093900                                        TO TRUE                   09390099
094010            CALL DP010I-NUMERIC-EDIT-ROUTINE                      09401099
094020                         USING DP010I-NUMERIC-EDIT-AREA           09402099
094100            IF  DP010I-ERROR-DETECTED                             09410099
094200                SET PS-ERROR                                      09420099
094300                    DP020-MSG-FATAL   TO TRUE                     09430099
094400                MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER         09440099
094500                MOVE DP015-UNP-ALP-BRT-OFF                        09450099
094600                                      TO ADSCPCTA                 09460099
094700                MOVE DP015-RED        TO ADSCPCTC                 09470099
094800                MOVE DP015-REVERSE    TO ADSCPCTH                 09480099
094900                MOVE -1               TO ADSCPCTL                 09490099
095000                SET DP030-SET-CURSOR-APPL-1                       09500099
095100                                      TO TRUE                     09510099
095200            ELSE                                                  09520099
095300                MOVE DP010I-NUMERIC-FIELD                         09530099
095400                                      TO ASC-PAYTRM-DISCOUNT-PCT-N09540099
095500                IF ASC-PAYTRM-DISCOUNT-PCT-N > 0000               09550099
095600                   CONTINUE                                       09560099
095700                ELSE                                              09570099
095800                   MOVE ZEROES TO ASC-PAYTRM-DISCOUNT-PCT-N       09580099
095900                   MOVE SPACES TO ASC-PAYTRM-DISCOUNT-PCT         09590099
096000                   SET ASC-PS-EMPTY-DISC-PCT TO TRUE              09600099
096100                END-IF                                            09610099
096200                MOVE ASC-PAYTRM-DISCOUNT-PCT-N                    09620099
096300                                      TO ADSCPCTO                 09630099
096400** NOTE: THIS VALUE CANNOT BE MOVED TO AN ALPHANUMERIC VALUE BELOW09640099
096500*            MOVE ADSCPCTO         TO ASC-PAYTRM-DISCOUNT-PCT     09650099
096600            END-IF                                                09660099
096700* THIS FIELD WAS SPACED OUT, MOVE ZEROES TO THE NUMERIC VALUE &   09670099
096800* SET THE EMPTY FIELD INDICATOR TO TRUE                           09680099
096900        ELSE                                                      09690099
097000            IF ASC-PAYTRM-DISCOUNT-PCT = SPACES                   09700099
097100               MOVE ZEROES TO ASC-PAYTRM-DISCOUNT-PCT-N           09710099
097200              SET ASC-PS-EMPTY-DISC-PCT TO TRUE                   09720099
097300            END-IF                                                09730099
097400        END-IF.                                                   09740099
097500                                                                  09750099
097600*    NET DUE DAYS                                                 09760099
097700        IF  ASC-PAYTRM-DUE-DAY-QTY  > SPACES                      09770099
097800            MOVE ASC-PAYTRM-DUE-DAY-QTY   TO DP010I-UNEDITED-FIELD09780099
097900            MOVE 3                        TO DP010I-MAXIMUM-DIGITS09790099
098000            MOVE ZERO                   TO DP010I-MAXIMUM-DECIMALS09800099
098100            SET DP010I-NEGATIVE-NOT-ALLOWED                       09810099
098200                                       TO TRUE                    09820099
098310            CALL DP010I-NUMERIC-EDIT-ROUTINE                      09831099
098320                         USING DP010I-NUMERIC-EDIT-AREA           09832099
098400            IF  DP010I-ERROR-DETECTED                             09840099
098500                SET PS-ERROR                                      09850099
098600                    DP020-MSG-FATAL   TO TRUE                     09860099
098700*                --- CODE MUST BE NUMERIC   ---                   09870099
098800                MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER         09880099
098900                MOVE DP015-UNP-ALP-BRT-OFF                        09890099
099000                                      TO ANTDDYSA                 09900099
099100                MOVE DP015-RED        TO ANTDDYSC                 09910099
099200                MOVE DP015-REVERSE    TO ANTDDYSH                 09920099
099300                MOVE -1               TO ANTDDYSL                 09930099
099400                SET DP030-SET-CURSOR-APPL-1                       09940099
099500                                      TO TRUE                     09950099
099600            ELSE                                                  09960099
099700                MOVE DP010I-NUMERIC-FIELD                         09970099
099800                                      TO ASC-PAYTRM-DUE-DAY-QTY-N 09980099
099900                IF ASC-PAYTRM-DUE-DAY-QTY-N  > 0                  09990099
100000                   CONTINUE                                       10000099
100100                ELSE                                              10010099
100200                   MOVE ZEROES TO ASC-PAYTRM-DUE-DAY-QTY-N        10020099
100300                   SET ASC-PS-EMPTY-DUE-DAY-QTY TO TRUE           10030099
100400                END-IF                                            10040099
100500                MOVE ASC-PAYTRM-DUE-DAY-QTY                       10050099
100600                                      TO ANTDDYSO                 10060099
100700            END-IF                                                10070099
100800* THIS FIELD WAS SPACED OUT, MOVE ZEROES TO THE NUMERIC VALUE &   10080099
100900* SET THE EMPTY FIELD INDICATOR TO TRUE                           10090099
101000        ELSE                                                      10100099
101100            IF ASC-PAYTRM-DUE-DAY-QTY  = SPACES                   10110099
101200               MOVE ZEROES TO ASC-PAYTRM-DUE-DAY-QTY              10120099
101300              SET ASC-PS-EMPTY-DUE-DAY-QTY TO TRUE                10130099
101400            END-IF                                                10140099
101500        END-IF.                                                   10150099
101600                                                                  10160099
101700*                                                                 10170099
101800*----------------------------------------------------------------*10180099
101900* PERFORM BUSINESS LOGIC CHECKING FOR THE FOLLOWING SITUATIONS   *10190099
102000*    REGULAR PAYMENT TERMS WERE ENTERED:                         *10200099
102100*    SPECIAL PAYMENT TERMS WERE ENTERED:                         *10210099
102200*    UNKNOWN/CHECK REGULAR AND SPECIAL TERMS:                    *10220099
102300* IF AN ERROR IS FOUND, THE CURSOR IS POSITIONED AT THAT         *10230099
102400* FIELD AND AN APPROPRIATE ERROR MESSAGE IS DISPLAYED.           *10240099
102500*----------------------------------------------------------------*10250099
102600 3020-VALIDATE-BUSINESS-LOGIC.                                    10260099
102700                                                                  10270099
102800*    REGULAR PAYMENT TERMS WERE ENTERED:                          10280099
102900     IF PC-REGULAR-PAYMENT-TERMS                                  10290099
103000        AND PS-NO-ERROR                                           10300099
103100*  COMPARE DISCOUNT DAYS AND PCT                                  10310099
103200*  BOTH DISCOUNT DOLLAR AMOUNT AND DISCOUNT PERCENT MUST BE ADDED 10320099
103300*  IF ONE IS ENTERED                                              10330099
103400        IF   ASC-PS-NOT-EMPTY-DISC-PCT                            10340099
103500        AND  ASC-PS-EMPTY-DISC-DAYS-QTY                           10350099
103600              SET PS-ERROR                                        10360099
103700                  DP020-MSG-FATAL     TO TRUE                     10370099
103800              MOVE PC-TSYMSG-01647    TO DP020-MSG-NUMBER         10380099
103900              MOVE DP015-UNP-ALP-BRT-OFF                          10390099
104000                                      TO ADSCDYSA                 10400099
104100              MOVE DP015-RED          TO ADSCDYSC                 10410099
104200              MOVE DP015-REVERSE      TO ADSCDYSH                 10420099
104300              MOVE -1                 TO ADSCDYSL                 10430099
104400              SET DP030-SET-CURSOR-APPL-1                         10440099
104500                                      TO TRUE                     10450099
104600        ELSE                                                      10460099
104700            IF ASC-PS-NOT-EMPTY-DISC-DAYS-QTY                     10470099
104800            AND ASC-PS-EMPTY-DISC-PCT                             10480099
104900                SET PS-ERROR                                      10490099
105000                    DP020-MSG-FATAL     TO TRUE                   10500099
105100                MOVE PC-TSYMSG-01648    TO DP020-MSG-NUMBER       10510099
105200                MOVE DP015-UNP-ALP-BRT-OFF                        10520099
105300                                        TO ADSCPCTA               10530099
105400                MOVE DP015-RED          TO ADSCPCTC               10540099
105500                MOVE DP015-REVERSE      TO ADSCPCTH               10550099
105600                MOVE -1                 TO ADSCPCTL               10560099
105700                SET DP030-SET-CURSOR-APPL-1                       10570099
105800                                        TO TRUE                   10580099
105900            END-IF                                                10590099
106000        END-IF                                                    10600099
106100                                                                  10610099
106200*    IF DUE DAYS FROM DATE TEXT IS  ENTERED, THEN REQUIRE ANY     10620099
106300*    OTHER FIELD     (MEANING OTHER REGULAR PAYMENT TERMS FIELDS).10630099
106400        IF ASC-PS-EMPTY-OTHER-TXT                                 10640099
106500           AND  ASC-PS-EMPTY-DISC-DAYS-QTY                        10650099
106600           AND  ASC-PS-EMPTY-DISC-PCT                             10660099
106700           AND  ASC-PS-EMPTY-DUE-DAY-QTY                          10670099
106800           AND  ASC-PS-NOT-EMPTY-DUE-DAY-TXT                      10680099
106900             SET PS-ERROR                                         10690099
107000                 DP020-MSG-FATAL     TO TRUE                      10700099
107100             MOVE PC-TSYMSG-01650    TO DP020-MSG-NUMBER          10710099
107200             MOVE DP015-UNP-ALP-BRT-OFF                           10720099
107300                                     TO ADYSTXTA                  10730099
107400             MOVE DP015-RED          TO ADYSTXTC                  10740099
107500             MOVE DP015-REVERSE      TO ADYSTXTH                  10750099
107600             MOVE -1                 TO ADYSTXTL                  10760099
107700             SET DP030-SET-CURSOR-APPL-1                          10770099
107800                                     TO TRUE                      10780099
107900        END-IF                                                    10790099
108000                                                                  10800099
108100*       TEST FOR OTHER POSSIBILITIES IF NO ERRORS HAVE BEEN FOUND.10810099
108200        IF PS-NO-ERROR                                            10820099
108300*       FIRST MAKE SURE THE CORRECT INDICATORS HAVE BEEN SET.     10830099
108400           IF ASC-PAYTRM-DUE-DAY-FR-DTE-TXT = SPACES              10840099
108500              SET ASC-PS-EMPTY-DUE-DAY-TXT TO TRUE                10850099
108600           END-IF                                                 10860099
108700           SET PC-SPECIAL-PAYMENT-TERMS TO TRUE                   10870099
108800        END-IF                                                    10880099
108900                                                                  10890099
109000** IF PC-REGULAR-PAYMENT-TERMS                                    10900099
109100     END-IF.                                                      10910099
109200                                                                  10920099
109300*    SPECIAL PAYMENT TERMS WERE ENTERED:                          10930099
109400*  IF PC-SPECIAL-PAYMENT-TERMS                                    10940099
109500*    SPACES WERE ENTERED, THE FIELD IS REALLY EMPTY THEN, TURN ON 10950099
109600*    THE EMPTY INDICATOR FOR THE FIELD & CHECK FOR OTHER POTENTIAL10960099
109700*    PROBLEMS                                                     10970099
109800     IF PC-SPECIAL-PAYMENT-TERMS                                  10980099
109900        AND PS-NO-ERROR                                           10990099
110000        IF ASC-PAYTRM-OTHER-TXT = SPACES                          11000099
110100           SET ASC-PS-EMPTY-OTHER-TXT TO TRUE                     11010099
110200        END-IF                                                    11020099
110300        SET PC-CHECK-REG-AND-SPECIAL TO TRUE                      11030099
110400*  IF PC-SPECIAL-PAYMENT-TERMS                                    11040099
110500     END-IF.                                                      11050099
110600                                                                  11060099
110700*    UNKNOWN/CHECK REGULAR AND SPECIAL TERMS:                    *11070099
110800     IF PC-CHECK-REG-AND-SPECIAL                                  11080099
110900        AND PS-NO-ERROR                                           11090099
111000* A.                                                              11100099
111100*    CHECK ALL FIELDS, IF ALL ARE BLANK, SEND A MESSAGE IF THE    11110099
111200*    USER WANTS TO ADD OR UPDATE  (ERROR)                         11120099
111300         IF ASC-PS-EMPTY-DISC-DAYS-QTY                            11130099
111400            AND ASC-PS-EMPTY-DISC-PCT                             11140099
111500            AND ASC-PS-EMPTY-DUE-DAY-QTY                          11150099
111600            AND ASC-PS-EMPTY-DUE-DAY-TXT                          11160099
111700            AND ASC-PS-EMPTY-OTHER-TXT                            11170099
111800            SET PS-ERROR                                          11180099
111900                DP020-MSG-FATAL     TO TRUE                       11190099
112000            MOVE PC-TSYMSG-01649    TO DP020-MSG-NUMBER           11200099
112100* B.                                                              11210099
112200*    IF BOTH SPECIAL-PAYMENT-TERMS AND REGULAR-PAYMENT-TERMS ARE  11220099
112300*       POPULATED, SEND A MESSAGE (ERROR)                         11230099
112400         ELSE                                                     11240099
112500            IF (ASC-PS-NOT-EMPTY-DISC-DAYS-QTY                    11250099
112600            OR  ASC-PS-NOT-EMPTY-DISC-PCT                         11260099
112700            OR  ASC-PS-NOT-EMPTY-DUE-DAY-QTY                      11270099
112800            OR  ASC-PS-NOT-EMPTY-DUE-DAY-TXT)                     11280099
112900            AND ASC-PS-NOT-EMPTY-OTHER-TXT                        11290099
113000              SET PS-ERROR                                        11300099
113100                  DP020-MSG-FATAL     TO TRUE                     11310099
113200              MOVE PC-TSYMSG-01649    TO DP020-MSG-NUMBER         11320099
113300            END-IF                                                11330099
113400         END-IF                                                   11340099
113500                                                                  11350099
113600         IF PS-ERROR                                              11360099
113700               MOVE DP015-UNP-ALP-BRT-OFF                         11370099
113800                                      TO ADSCDYSA                 11380099
113900                                         ADSCPCTA                 11390099
114000                                         ANTDDYSA                 11400099
114100                                         ADYSTXTA                 11410099
114200                                         ASPCTRMA                 11420099
114300               MOVE DP015-RED         TO ADSCDYSC                 11430099
114400                                         ADSCPCTC                 11440099
114500                                         ANTDDYSC                 11450099
114600                                         ADYSTXTC                 11460099
114700                                         ASPCTRMC                 11470099
114800               MOVE DP015-REVERSE     TO ADSCDYSH                 11480099
114900                                         ADSCPCTH                 11490099
115000                                         ANTDDYSH                 11500099
115100                                         ADYSTXTH                 11510099
115200                                         ASPCTRMH                 11520099
115300               MOVE -1                 TO ADSCDYSL                11530099
115400               SET DP030-SET-CURSOR-APPL-1                        11540099
115500                                       TO TRUE                    11550099
115600         END-IF                                                   11560099
115700*    IF PC-CHECK-REG-AND-SPECIAL                                  11570099
115800     END-IF.                                                      11580099
115900                                                                  11590099
116000/                                                                 11600099
116100*----------------------------------------------------------------*11610099
116200*    FORMAT PAYMENT TERM DESCRIPTION                             *11620099
116300*----------------------------------------------------------------*11630099
116400 3170-FORMAT-PAYMENT-TERM-DESC.                                   11640099
116500                                                                  11650099
116600     INITIALIZE ASC-PAYT-TERM-ID-DESC.                            11660099
116700                                                                  11670099
116800     MOVE PAYTRM-PAY-TERM-ID       TO PV-EDIT-PAYT-TERM-ID.       11680099
116900     COPY POPD001.                                                11690099
117000                                                                  11700099
117100     MOVE ASC-PAYT-TERM-ID-DESC  TO ATERMDEO                      11710099
117200                                    ASC-HOLD-PAYT-TERM-ID-DESC.   11720099
117300                                                                  11730099
117400/                                                                 11740099
117500*----------------------------------------------------------------*11750099
117600* MOVE THE DEFAULT ATTRIBUTE VALUES TO THE ENTERABLE FIELDS ON   *11760099
117700* MAP.                                                           *11770099
117800*----------------------------------------------------------------*11780099
117900 3200-RESET-ATTRIBUTES.                                           11790099
118000                                                                  11800099
118100        MOVE DP015-UNP-ALP-NOR-OFF TO ADSCDYSA                    11810099
118200                                      ADSCPCTA                    11820099
118300                                      ANTDDYSA                    11830099
118400                                      ADYSTXTA                    11840099
118500                                      ASPCTRMA.                   11850099
118600        MOVE DP015-GREEN           TO ADSCDYSC                    11860099
118700                                      ADSCPCTC                    11870099
118800                                      ANTDDYSC                    11880099
118900                                      ADYSTXTC                    11890099
119000                                      ASPCTRMC.                   11900099
119100        MOVE DP015-UNDERLINE       TO ADSCDYSH                    11910099
119200                                      ADSCPCTH                    11920099
119300                                      ANTDDYSH                    11930099
119400                                      ADYSTXTH                    11940099
119500                                      ASPCTRMH.                   11950099
119600                                                                  11960099
119700 EJECT                                                            11970099
119800*----------------------------------------------------------------*11980099
119900*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *11990099
120000*    ENTRY.                                                      *12000099
120100*    EITHER A. ADD    LOGIC  OR                                  *12010099
120200*           B. UPDATE LOGIC  OR                                  *12020099
120300*           C. RETURN LOGIC  OR                                  *12030099
120400*----------------------------------------------------------------*12040099
120500                                                                  12050099
120600 4000-BUILD-INITIAL-PANEL.                                        12060099
120700                                                                  12070099
120800* A.  ADDITION OF A PAYMENT TERM (CLEAR ALL FIELDS)               12080099
120900     IF ASC-INTER-APPL-ADD                                        12090099
121000         PERFORM 1200-SET-FIELD-SWITCHES                          12100099
121100         MOVE ZEROES             TO ASC-PAYTRM-PAY-TERM-ID        12110099
121200                                    ASC-PAYTRM-DISCOUNT-DAYS-QTY-N12120099
121300                                    ASC-PAYTRM-DISCOUNT-PCT-N     12130099
121400                                    ASC-PAYTRM-DUE-DAY-QTY-N      12140099
121500                                    ASC-PAYTRM-RANKING-NBR        12150099
121600         MOVE SPACES             TO ASC-PAYTRM-DUE-DAY-FR-DTE-TXT 12160099
121700                                    ASC-PAYTRM-DISCOUNT-PCT       12170099
121800                                    ASC-PAYTRM-OTHER-TXT          12180099
121900                                    ASC-PAYT-TERM-ID-DESC         12190099
122000         SET DP030-SET-CURSOR-APPL-1                              12200099
122100                                   TO TRUE                        12210099
122200         MOVE -1                   TO ADSCDYSL                    12220099
122300         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     12230099
122400     END-IF.                                                      12240099
122500                                                                  12250099
122600* B.  UPDATE OF A PAYMENT TERM                                    12260099
122700     IF ASC-INTER-APPL-UPDATE                                     12270099
122800         PERFORM 1200-SET-FIELD-SWITCHES                          12280099
122900         SET DP030-SET-CURSOR-APPL-1                              12290099
123000                                   TO TRUE                        12300099
123100         MOVE -1                   TO ADSCDYSL                    12310099
123200         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     12320099
123300     END-IF.                                                      12330099
123400                                                                  12340099
123500*----------------------------------------------------------------*12350099
123600*    MOVE THE VALUES FROM THE COMMAREA TO THE PAYTRM FIELDS      *12360099
123700*    DEFINED IN ON THE PAYMENT TERM TABLE.  THESE FIELDS WILL BE *12370099
123800*    USED BY POPD001(SEE 3170-) TO POPULATE THE PAYMENT TERM     *12380099
123900*    FIELD ON THE SCREEN.                                        *12390099
124000*----------------------------------------------------------------*12400099
124100 4300-POPULATE-PAYTRM-FIELDS.                                     12410099
124200                                                                  12420099
124300                                                                  12430099
124400     MOVE ASC-PAYTRM-DISCOUNT-DAYS-QTY-N                          12440099
124500                            TO PAYTRM-DISCOUNT-DAYS-QTY.          12450099
124600*    MOVE THE DECIMAL PLACE OVER TWO PLACES TO THE LEFT FOR       12460099
124700*    FORMATTING PURPOSES:                                         12470099
124800     COMPUTE ASC-PAYTRM-DISCOUNT-PCT-D =                          12480099
124900                         ASC-PAYTRM-DISCOUNT-PCT-N / 100.         12490099
125000     MOVE ASC-PAYTRM-DISCOUNT-PCT-D                               12500099
125100                            TO PAYTRM-DISCOUNT-PCT.               12510099
125200     MOVE ASC-PAYTRM-DUE-DAY-QTY-N                                12520099
125300                            TO PAYTRM-DUE-DAY-QTY.                12530099
125400     MOVE ASC-PAYTRM-DUE-DAY-FR-DTE-TXT                           12540099
125500                            TO PAYTRM-DUE-DAY-FR-DTE-TXT.         12550099
125600     MOVE ASC-PAYTRM-OTHER-TXT                                    12560099
125700                            TO PAYTRM-OTHER-TXT.                  12570099
125800                                                                  12580099
125900*----------------------------------------------------------------*12590099
126000*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *12600099
126100*----------------------------------------------------------------*12610099
126200                                                                  12620099
126300 4400-MOVE-COMMAREA-TO-SCREEN.                                    12630099
126400     MOVE ASC-PAYTRM-DISCOUNT-DAYS-QTY-N     TO ADSCDYSO.         12640099
126500     MOVE ASC-PAYTRM-DISCOUNT-PCT-N          TO ADSCPCTO.         12650099
126600     MOVE ASC-PAYTRM-DUE-DAY-QTY-N           TO ANTDDYSO.         12660099
126700     MOVE ASC-PAYTRM-DUE-DAY-FR-DTE-TXT      TO ADYSTXTO.         12670099
126800     MOVE ASC-PAYTRM-OTHER-TXT               TO ASPCTRMO.         12680099
126900*    ONLY POPULATE THE PAYMENT TERM FIELD IF THERE IS NO ERROR.   12690099
127000     IF PS-NO-ERROR                                               12700099
127100        PERFORM 4300-POPULATE-PAYTRM-FIELDS                       12710099
127200*    POPULATE THE PAYMENT TERM DESCRIPTION FIELD (COMPILATION)    12720099
127300        PERFORM 3170-FORMAT-PAYMENT-TERM-DESC                     12730099
127400     END-IF.                                                      12740099
127500                                                                  12750099
127600 EJECT                                                            12760099
127700*----------------------------------------------------------------*12770099
127800* ADD THE INPUT TO THE DB2 TABLE.                                *12780099
127900*----------------------------------------------------------------*12790099
128000 5000-ADD-PAYMENT-TERM.                                           12800099
128100     IF ASC-PAYTRM-PAY-TERM-ID  EQUAL ZERO                        12810099
128200         PERFORM 5100-GET-MAX-TERM-NBR                            12820099
128300         IF PV-IND-VAR < 0                                        12830099
128400             MOVE +1               TO PAYTRM-PAY-TERM-ID          12840099
128500         END-IF                                                   12850099
128600         MOVE ASC-PAYTRM-DISCOUNT-DAYS-QTY-N                      12860099
128700                                   TO PAYTRM-DISCOUNT-DAYS-QTY    12870099
128800*    MOVE THE DECIMAL PLACE OVER TWO PLACES TO THE LEFT FOR       12880099
128900*    FORMATTING PURPOSES:                                         12890099
129000         COMPUTE ASC-PAYTRM-DISCOUNT-PCT-D =                      12900099
129100                         ASC-PAYTRM-DISCOUNT-PCT-N / 100          12910099
129200         MOVE ASC-PAYTRM-DISCOUNT-PCT-D                           12920099
129300                                   TO PAYTRM-DISCOUNT-PCT         12930099
129400         MOVE ASC-PAYTRM-DUE-DAY-QTY-N                            12940099
129500                                   TO PAYTRM-DUE-DAY-QTY          12950099
129600         MOVE ASC-PAYTRM-OTHER-TXT                                12960099
129700                                   TO PAYTRM-OTHER-TXT            12970099
129800         MOVE PC-ZERO                                             12980099
129900                                   TO PAYTRM-RANKING-NBR          12990099
130000         MOVE ASC-PAYTRM-DUE-DAY-FR-DTE-TXT                       13000099
130100                                   TO PAYTRM-DUE-DAY-FR-DTE-TXT   13010099
130200         PERFORM 5200-ADD-TPAYTRM                                 13020099
130300         PERFORM 7000-POPULATE-PAYMENT-TERM-MSG                   13030099
130400     END-IF.                                                      13040099
130500                                                                  13050099
130600*----------------------------------------------------------------*13060099
130700*  GET THE MAX PAYMENT TERM NUMBER PLUS 1 FOR THE ADDITION OF     13070099
130800*  A NEW PAYMENT TERM                                             13080099
130900*----------------------------------------------------------------*13090099
131000 5100-GET-MAX-TERM-NBR.                                           13100099
131100     PERFORM                                                      13110099
131200         WITH TEST AFTER                                          13120099
131300         VARYING PV-RETRY-COUNTER                                 13130099
131400         FROM 1 BY 1                                              13140099
131500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13150099
131600                   OR (SQLCODE = ZERO))                           13160099
131700*                                                                 13170099
131800         EXEC SQL                                                 13180099
131900             SELECT MAX(PAY_TERM_ID) + 1                          13190099
132000             INTO :PAYTRM-PAY-TERM-ID:PV-IND-VAR                  13200099
132100             FROM TPAYTRM                                         13210099
132200         END-EXEC                                                 13220099
132300                                                                  13230099
132400         EVALUATE TRUE                                            13240099
132500             WHEN SQLCODE = ZERO                                  13250099
132600             WHEN SQLCODE = -904                                  13260099
132700             WHEN SQLCODE = -913                                  13270099
132800                 CONTINUE                                         13280099
132900             WHEN SQLWARN0 NOT = SPACES                           13290099
133000             WHEN SQLCODE < ZERO                                  13300099
133100             WHEN SQLCODE > ZERO                                  13310099
133200                 MOVE '5100-GET-MAX-TERM-NBR'                     13320099
133300                                   TO DP013-PARAGRAPH             13330099
133400                 MOVE 'SELECT MAX TERM NBR'                       13340099
133500                                   TO DP013-MESSAGE-TEXT (1)      13350099
133600                 MOVE SQLCA        TO DP013-SQLCA                 13360099
133700                 MOVE 'TPAYTRM'    TO DP013-DB2-TABLE-NAME (1)    13370099
133800                 SET DP013-DB2-ABEND                              13380099
133900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           13390099
134000                 PERFORM DP013-0000-PROCESS-ABEND                 13400099
134100         END-EVALUATE                                             13410099
134200     END-PERFORM.                                                 13420099
134300*                                                                 13430099
134400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13440099
134500         MOVE '5100-GET-MAX-TERM-NBR'                             13450099
134600                                   TO DP013-PARAGRAPH             13460099
134700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     13470099
134800                                   TO DP013-MESSAGE-TEXT (1)      13480099
134900         MOVE 'MAX PAY-TERM-ID'                                   13490099
135000                                   TO DP013-MESSAGE-TEXT (2)      13500099
135100         MOVE SQLCA                TO DP013-SQLCA                 13510099
135200         MOVE 'TPAYTRM'            TO DP013-DB2-TABLE-NAME (1)    13520099
135300         SET DP013-DB2-ABEND                                      13530099
135400             DP013-XCTL-DISPLAY-RESTART                           13540099
135500                                   TO TRUE                        13550099
135600         PERFORM DP013-0000-PROCESS-ABEND                         13560099
135700     END-IF.                                                      13570099
135800                                                                  13580099
135900*----------------------------------------------------------------*13590099
136000*  INSERT A NEW PAYMENT TERM                                      13600099
136100*----------------------------------------------------------------*13610099
136200 5200-ADD-TPAYTRM.                                                13620099
136300     PERFORM                                                      13630099
136400         WITH TEST AFTER                                          13640099
136500         VARYING PV-RETRY-COUNTER                                 13650099
136600         FROM 1 BY 1                                              13660099
136700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13670099
136800                   OR (SQLCODE = ZERO))                           13680099
136900         EXEC SQL                                                 13690099
137000             INSERT INTO TPAYTRM                                  13700099
137100                 (PAY_TERM_ID                                     13710099
137200                 ,DISCOUNT_DAYS_QTY                               13720099
137300                 ,DISCOUNT_PCT                                    13730099
137400                 ,DUE_DAY_QTY                                     13740099
137500                 ,OTHER_TXT                                       13750099
137600                 ,RANKING_NBR                                     13760099
137700                 ,DUE_DAY_FR_DTE_TXT)                             13770099
137800             VALUES                                               13780099
137900                 (:PAYTRM-PAY-TERM-ID                             13790099
138000                 ,:PAYTRM-DISCOUNT-DAYS-QTY                       13800099
138100                 ,:PAYTRM-DISCOUNT-PCT                            13810099
138200                 ,:PAYTRM-DUE-DAY-QTY                             13820099
138300                 ,:PAYTRM-OTHER-TXT                               13830099
138400                 ,:PAYTRM-RANKING-NBR                             13840099
138500                 ,:PAYTRM-DUE-DAY-FR-DTE-TXT)                     13850099
138600         END-EXEC                                                 13860099
138700                                                                  13870099
138800         EVALUATE TRUE                                            13880099
138900             WHEN SQLCODE = ZERO                                  13890099
139000             WHEN SQLCODE = -904                                  13900099
139100             WHEN SQLCODE = -913                                  13910099
139200                 CONTINUE                                         13920099
139300             WHEN SQLWARN0 NOT = SPACES                           13930099
139400             WHEN SQLCODE < ZERO                                  13940099
139500             WHEN SQLCODE > ZERO                                  13950099
139600                 MOVE '5200-ADD-TPAYTRM'                          13960099
139700                                   TO DP013-PARAGRAPH             13970099
139800                 MOVE 'ADD A ROW TO THE PAYMENT TERM TABLE'       13980099
139900                                   TO DP013-MESSAGE-TEXT(1)       13990099
140000                 MOVE SQLCA        TO DP013-SQLCA                 14000099
140100                 MOVE 'TPAYTRM'    TO DP013-DB2-TABLE-NAME (1)    14010099
140200                 SET DP013-DB2-ABEND                              14020099
140300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           14030099
140400                 PERFORM DP013-0000-PROCESS-ABEND                 14040099
140500         END-EVALUATE                                             14050099
140600     END-PERFORM.                                                 14060099
140700*                                                                 14070099
140800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        14080099
140900         MOVE '5200-ADD-TPAYTRM'                                  14090099
141000                                   TO DP013-PARAGRAPH             14100099
141100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO ADD A NEW   14110099
141200-             'PAYMENT TERM '      TO DP013-MESSAGE-TEXT (1)      14120099
141300         MOVE SQLCA                TO DP013-SQLCA                 14130099
141400         MOVE 'TPAYTRM'            TO DP013-DB2-TABLE-NAME (1)    14140099
141500         SET DP013-DB2-ABEND                                      14150099
141600             DP013-XCTL-DISPLAY-RESTART                           14160099
141700                                   TO TRUE                        14170099
141800         PERFORM DP013-0000-PROCESS-ABEND                         14180099
141900     END-IF.                                                      14190099
142000                                                                  14200099
142100 EJECT                                                            14210099
142200*----------------------------------------------------------------*14220099
142300* APPLY THE CHANGE TO PAYMENT TERMS TABLE.                       *14230099
142400*----------------------------------------------------------------*14240099
142500 6000-UPDATE-PAYMENT-TERM.                                        14250099
142600     MOVE ASC-PAYTRM-PAY-TERM-ID   TO PAYTRM-PAY-TERM-ID.         14260099
142700     PERFORM 6200-UPDATE-TPAYTRM.                                 14270099
142800     SET PS-UPDATE             TO TRUE.                           14280099
142900                                                                  14290099
143000     IF (ASC-HOLD-PAYTRM-DSCNT-DAYS-QTY NOT =                     14300099
143100                        PAYTRM-DISCOUNT-DAYS-QTY) OR              14310099
143200        (ASC-HOLD-PAYTRM-DISCOUNT-PCT-Z NOT =                     14320099
143300                        PAYTRM-DISCOUNT-PCT) OR                   14330099
143400        (ASC-HOLD-PAYTRM-DUE-DAY-QTY    NOT =                     14340099
143500                        PAYTRM-DUE-DAY-QTY) OR                    14350099
143600        (ASC-HOLD-DUE-DAY-FR-DTE-TXT    NOT =                     14360099
143700                 PAYTRM-DUE-DAY-FR-DTE-TXT) OR                    14370099
143800        (ASC-HOLD-PAYTRM-OTHER-TXT      NOT =                     14380099
143900                        PAYTRM-OTHER-TXT)   OR                    14390099
144000        (ASC-HOLD-PAYT-TERM-ID-DESC     NOT =                     14400099
144100                        ASC-PAYT-TERM-ID-DESC)                    14410099
144200                                                                  14420099
144300         PERFORM 7000-POPULATE-PAYMENT-TERM-MSG                   14430099
144400     END-IF.                                                      14440099
144500                                                                  14450099
144600                                                                  14460099
144700     PERFORM 6300-UPDATE-SELECT-QUE-UPD.                          14470099
144800                                                                  14480099
144900*----------------------------------------------------------------*14490099
145000* UPDATE PAYMENT TERM                                            *14500099
145100*----------------------------------------------------------------*14510099
145200 6200-UPDATE-TPAYTRM.                                             14520099
145300     PERFORM                                                      14530099
145400         WITH TEST AFTER                                          14540099
145500         VARYING PV-RETRY-COUNTER                                 14550099
145600         FROM 1 BY 1                                              14560099
145700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14570099
145800                   OR (SQLCODE = ZERO))                           14580099
145900*                                                                 14590099
146000         EXEC SQL                                                 14600099
146100             UPDATE TPAYTRM                                       14610099
146200             SET DISCOUNT_DAYS_QTY = :PAYTRM-DISCOUNT-DAYS-QTY    14620099
146300                ,DISCOUNT_PCT      = :PAYTRM-DISCOUNT-PCT         14630099
146400                ,DUE_DAY_QTY       = :PAYTRM-DUE-DAY-QTY          14640099
146500                ,OTHER_TXT         = :PAYTRM-OTHER-TXT            14650099
146600                ,DUE_DAY_FR_DTE_TXT= :PAYTRM-DUE-DAY-FR-DTE-TXT   14660099
146700             WHERE PAY_TERM_ID     = :PAYTRM-PAY-TERM-ID          14670099
146800         END-EXEC                                                 14680099
146900                                                                  14690099
147000         EVALUATE TRUE                                            14700099
147100             WHEN SQLCODE = ZERO                                  14710099
147200             WHEN SQLCODE = -904                                  14720099
147300             WHEN SQLCODE = -913                                  14730099
147400                 CONTINUE                                         14740099
147500             WHEN SQLWARN0 NOT = SPACES                           14750099
147600             WHEN SQLCODE < ZERO                                  14760099
147700             WHEN SQLCODE > ZERO                                  14770099
147800                 MOVE '6200-UPDATE-TPAYTRM'                       14780099
147900                                   TO DP013-PARAGRAPH             14790099
148000                 MOVE 'UPDATE TPAYTRM'                            14800099
148100                                   TO DP013-MESSAGE-TEXT (1)      14810099
148200                 MOVE SQLCA        TO DP013-SQLCA                 14820099
148300                 MOVE 'TPAYTRM'    TO DP013-DB2-TABLE-NAME (1)    14830099
148400                 SET DP013-DB2-ABEND                              14840099
148500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           14850099
148600                 PERFORM DP013-0000-PROCESS-ABEND                 14860099
148700         END-EVALUATE                                             14870099
148800     END-PERFORM.                                                 14880099
148900*                                                                 14890099
149000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        14900099
149100         MOVE '6200-UPDATE-TPAYTRM'                               14910099
149200                                   TO DP013-PARAGRAPH             14920099
149300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE'     14930099
149400                                   TO DP013-MESSAGE-TEXT (1)      14940099
149500         MOVE 'PAYMENT TERM'                                      14950099
149600                                   TO DP013-MESSAGE-TEXT (2)      14960099
149700         MOVE SQLCA                TO DP013-SQLCA                 14970099
149800         MOVE 'TPAYTRM'            TO DP013-DB2-TABLE-NAME (1)    14980099
149900         SET DP013-DB2-ABEND                                      14990099
150000             DP013-XCTL-DISPLAY-RESTART                           15000099
150100                                   TO TRUE                        15010099
150200         PERFORM DP013-0000-PROCESS-ABEND                         15020099
150300     END-IF.                                                      15030099
150400                                                                  15040099
150500*----------------------------------------------------------------*15050099
150600* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *15060099
150700* OBJECT WAS UDPATED.                                            *15070099
150800*----------------------------------------------------------------*15080099
150900 6300-UPDATE-SELECT-QUE-UPD.                                      15090099
151000     PERFORM 9100-READ-SEL-QUEUE.                                 15100099
151100     SET VN010-UPD (ASC-SEL-SUB)   TO TRUE.                       15110099
151200     PERFORM 9200-REWRITE-LIST-QUEUE.                             15120099
151300 EJECT                                                            15130099
151400                                                                  15140099
151500*----------------------------------------------------------------*15150099
151600* CHECK TO DETERMINE IF THE DISCOUNT DAYS QUANTITY, PERCENT OR   *15160099
151700* DUE DAY QUANTITY HAS BEEN UPDATED, IF ONE OF THESE FIELDS HAVE *15170099
151800* BEEN CHANGED, THE PAYMENT TERMS COPYBOOK NEEDS TO BE POPULATED *15180099
151900* AND CALL PROGRAM VNKCS025.                                     *15190099
152000*----------------------------------------------------------------*15200099
152100                                                                  15210099
152200 7000-POPULATE-PAYMENT-TERM-MSG.                                  15220099
152300                                                                  15230099
152400     SET  VN004-PAY-TERM-SEGMENT   TO TRUE.                       15240099
152500     MOVE PAYTRM-PAY-TERM-ID       TO VN004-PAY-TERM-ID.          15250099
152600     MOVE PAYTRM-DISCOUNT-DAYS-QTY TO VN004-PAY-TERM-DAYS.        15260099
152700     MOVE PAYTRM-DISCOUNT-PCT      TO VN004-PAY-TERM-DISC.        15270099
152800     MOVE PAYTRM-DUE-DAY-QTY       TO VN004-PAY-TERM-DUE-DAYS.    15280099
152900     MOVE ASC-PAYT-TERM-ID-DESC    TO VN004-PAY-TERM-DESC.        15290099
153000                                                                  15300099
153100     EXEC CICS LINK PROGRAM (PC-VNKCS025)                         15310099
153200                    COMMAREA(VN004-COMMAREA)                      15320099
153300                    RESP    (PV-CICS-RESPONSE)                    15330099
153400     END-EXEC.                                                    15340099
153500                                                                  15350099
153600     IF  PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                   15360099
153700         MOVE '7000-POPULATE-PAYMENT-TERM-MSG'                    15370099
153800                         TO DP013-PARAGRAPH                       15380099
153900         MOVE 'UNSUCCESSFUL LINK TO VNKCS025'                     15390099
154000                         TO DP013-MESSAGE-TEXT (1)                15400099
154100         SET DP013-CICS-ABEND                                     15410099
154200             DP013-ROLLBACK                                       15420099
154300             DP013-XCTL-DISPLAY-RESTART                           15430099
154400                         TO TRUE                                  15440099
154500         PERFORM DP013-0000-PROCESS-ABEND                         15450099
154600     ELSE                                                         15460099
154700         IF VN004-NO-ERRORS                                       15470099
154800            NEXT SENTENCE                                         15480099
154900         ELSE                                                     15490099
155000            IF VN004-MQ-ERROR                                     15500099
155100               SET DP013-XCTL-DISPLAY-RESTART                     15510099
155200                   DP013-ROLLBACK                                 15520099
155300                   DP013-OTHER-ABEND     TO TRUE                  15530099
155400                                                                  15540099
155500               MOVE VN004-PROGRAM-NAME   TO DP013-PROGRAM         15550099
155600               MOVE VN004-PARAGRAPH-NAME TO DP013-PARAGRAPH       15560099
155700               MOVE VN004-REASON-CODE    TO DP013-MESSAGE-TEXT (1)15570099
155800               MOVE VN004-MESSAGE        TO DP013-MESSAGE-TEXT (2)15580099
155900               PERFORM DP013-0000-PROCESS-ABEND                   15590099
156000            END-IF                                                15600099
156100         END-IF                                                   15610099
156200     END-IF.                                                      15620099
156300                                                                  15630099
156400*----------------------------------------------------------------*15640099
156500* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *15650099
156600*----------------------------------------------------------------*15660099
156700                                                                  15670099
156800 9100-READ-SEL-QUEUE.                                             15680099
156900     EXEC CICS                                                    15690099
157000         READQ TS                                                 15700099
157100             QUEUE (ASC-SEL-QUEUE-NAME)                           15710099
157200             INTO  (VN010-PAYT-TERM-SELECT-RECORD)                15720099
157300             ITEM  (ASC-SEL-ITEM)                                 15730099
157400             RESP  (PV-CICS-RESPONSE)                             15740099
157500     END-EXEC.                                                    15750099
157600                                                                  15760099
157700     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   15770099
157800         CONTINUE                                                 15780099
157900     ELSE                                                         15790099
158000         SET DP013-LOGIC-ABEND                                    15800099
158100             DP013-NO-ROLLBACK     TO TRUE                        15810099
158200         MOVE '9100-READ-SEL-QUEUE'                               15820099
158300                                   TO DP013-PARAGRAPH             15830099
158400         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   15840099
158500                                   TO DP013-MESSAGE-TEXT (1)      15850099
158600         PERFORM DP013-0000-PROCESS-ABEND                         15860099
158700     END-IF.                                                      15870099
158800*----------------------------------------------------------------*15880099
158900* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *15890099
159000*----------------------------------------------------------------*15900099
159100 9200-REWRITE-LIST-QUEUE.                                         15910099
159200     EXEC CICS                                                    15920099
159300          WRITEQ TS                                               15930099
159400              QUEUE  (ASC-SEL-QUEUE-NAME)                         15940099
159500              FROM   (VN010-PAYT-TERM-SELECT-RECORD)              15950099
159600              ITEM   (ASC-SEL-ITEM)                               15960099
159700              RESP   (PV-CICS-RESPONSE)                           15970099
159800              REWRITE                                             15980099
159900     END-EXEC.                                                    15990099
160000                                                                  16000099
160100     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               16010099
160200         SET DP013-CICS-ABEND                                     16020099
160300             DP013-NO-ROLLBACK     TO TRUE                        16030099
160400         MOVE '9200-REWRITE-LIST-QUEUE'                           16040099
160500                                   TO DP013-PARAGRAPH             16050099
160600         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   16060099
160700                                   TO DP013-MESSAGE-TEXT (1)      16070099
160800         PERFORM DP013-0000-PROCESS-ABEND                         16080099
160900     END-IF.                                                      16090099
161000                                                                  16100099
161100 EJECT                                                            16110099
161200*----------------------------------------------------------------*16120099
161300*    ABEND PROCESSOR MODULE                                      *16130099
161400*----------------------------------------------------------------*16140099
161500                                                                  16150099
161600     COPY DPPD013.                                                16160099
